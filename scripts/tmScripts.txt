{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"Google youtube search link","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["/https?:\\/\\/(www\\.)?google\\.(com|(?:com?\\.)?\\w\\w)\\/.*/"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469644799686,"data":{}},"enabled":true,"position":1,"file_url":"https://greasyfork.org/scripts/7784-google-youtube-search-link/code/Google%20youtube%20search%20link.user.js","uuid":"fcc5d484-f1eb-4ff4-9ac7-b8acb61b824d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgR29vZ2xlIHlvdXR1YmUgc2VhcmNoIGxpbmsKLy8gQGluY2x1ZGUgICAgICAgL2h0dHBzPzpcL1wvKHd3d1wuKT9nb29nbGVcLihjb218KD86Y29tP1wuKT9cd1x3KVwvLiovCi8vIEBkZXNjcmlwdGlvbiAgIEFkZHMgYSBZb3V0dWJlIHNlYXJjaCBsaW5rOiBXZWIsIEltYWdlcywgVmlkZW9zLCBZb3V0dWJlLCBOZXdzLCBNYXBzLCBTaG9wcGluZywgLi4uCi8vIEB2ZXJzaW9uICAgICAgIDEuMS4xYQovLyBAYXV0aG9yICAgICAgICB3T3h4T20KLy8gQG5hbWVzcGFjZSAgICAgd094eE9tLnNjcmlwdHMKLy8gQGxpY2Vuc2UgICAgICAgTUlUIExpY2Vuc2UKLy8gQHJ1bi1hdCAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQHJlcXVpcmUgICAgICBmaWxlOi8vajpcR09PR0xFXGV4dF9zZXR0aW5nc1xzY3JpcHRzXFNlYXJjaEJ1dHRvbnNcc2V0TXV0YXRpb25IYW5kbGVyLmpzCi8vIEByZXF1aXJlICAgICAgZmlsZTovL2o6XEdPT0dMRVxleHRfc2V0dGluZ3Ncc2NyaXB0c1xTaGFyZWRcd2FpdEZvcktleUVsZW1lbnRzLmpzCi8vIEByZXF1aXJlICAgICAgZmlsZTovL2o6XEdPT0dMRVxleHRfc2V0dGluZ3Ncc2NyaXB0c1xTaGFyZWRcanF1ZXJ5Lm1pbl8xXzdfMi5qcwovLyBAcmVxdWlyZSAgICAgIGZpbGU6Ly9qOlxHT09HTEVcZXh0X3NldHRpbmdzXHNjcmlwdHNcU2VhcmNoQnV0dG9uc1xTZWFyY2hfRW5naW5lc19idXR0b25zLnVzZXIuanMKLy8vLyBAcmVxdWlyZSAgICAgICBodHRwczovL2dyZWFzeWZvcmsub3JnL3NjcmlwdHMvMTIyMjgvY29kZS9zZXRNdXRhdGlvbkhhbmRsZXIuanMKLy8vLyBAcmVxdWlyZSAgICAgICBodHRwOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzEuNy4yL2pxdWVyeS5taW4uanMKLy8vLyBAcmVxdWlyZSAgICAgICBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9yYXcvMjYyNTg5MS93YWl0Rm9yS2V5RWxlbWVudHMuanMKLy8vLyBAZ3JhbnQgICAgICAgICBHTV9hZGRTdHlsZQovLyA9PS9Vc2VyU2NyaXB0PT0K"},{"name":"SaveFrom.net helper","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"excludes":false,"includes":false,"matches":false,"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["vk.com","vk.me","vk-cdn.net","youtube.com","youtube-nocookie.com","ytimg.com","googlevideo.com","video.google.com","google-analytics.com","dailymotion.com","vimeo.com","vimeocdn.com","odnoklassniki.ru","ok.ru","cdn-ok.com","mycdn.me","pladform.ru","clipyou.ru","soundcloud.com","sndcdn.com","mail.ru","cdninstagram.com","fbcdn.net","facebook.com","sf-helper.com","aviasales.ru","travelpayouts.com","skyscanner.net","hotellook.com","savefrom.net","self","*"],"orig_excludes":["*://google.*/*","*://*.google.*/*","*://acidtests.org/*","*://*.acidtests.org/*"],"orig_includes":["http://*","https://*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":["*"],"use_connects":["www.google-analytics.com"],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"$":"sisMonoEmptyValue","$_expire_":"sisMonoEmptyValue","attr":"sisMonoEmptyValue","attr_expire_":"sisMonoEmptyValue","aviaBarNewStyle":"btrue","bind":"sisMonoEmptyValue","bind_expire_":"sisMonoEmptyValue","country":"s{\"w\":\"ru\"}","country_expire_":"s{\"w\":1469643498}","css":"sisMonoEmptyValue","css_expire_":"sisMonoEmptyValue","dblTrack":"s{\"w\":\"67d5449b-872d-4d5d-9dee-0b405833fafe,1473199017133\"}","detach":"sisMonoEmptyValue","detach_expire_":"sisMonoEmptyValue","each":"sisMonoEmptyValue","each_expire_":"sisMonoEmptyValue","fade":"sisMonoEmptyValue","fade_expire_":"sisMonoEmptyValue","focus":"sisMonoEmptyValue","focus_expire_":"sisMonoEmptyValue","form":"sisMonoEmptyValue","form_expire_":"sisMonoEmptyValue","fromId":"n-1","fromIdTimeout":"n1465732002","gmNativeDownload":"n1","hasDP":"uundefined","html":"sisMonoEmptyValue","html_expire_":"sisMonoEmptyValue","lastCountryRequest":"s{\"w\":1467659753}","lastVersion":"s{\"w\":\"6.42.2\"}","lastVersionExpire":"s1438677205","lastVersion_expire_":"s{\"w\":1468049398}","liteStorage":"s{\"w\":{\"metaTimeout\":1473251328,\"metaExpire\":1473228881,\"lastVersion\":\"6.60.2\",\"lastVersionExpire\":1473649376,\"fromIdTimeout\":1467729394,\"trackTimeout\":1473242165,\"fromId\":-1,\"countryRequestTimeout\":1469470697,\"countryTimeout\":1473228880,\"countryExpire\":1473401681}}","meta":"s{\"w\":{\"dp\":{\"enable\":true,\"percent\":100,\"listExp\":true},\"exp\":{\"34\":{\"enable\":true,\"percent\":50},\"51\":{\"enable\":true,\"percent\":50}}}}","metaExpire":"s1438120641","meta_expire_":"s{\"w\":1467792888}","onceTrackAviaBar":"n0","onceYtUmmyBtn":"n1","remove":"sisMonoEmptyValue","remove_expire_":"sisMonoEmptyValue","sel":"sisMonoEmptyValue","sel_expire_":"sisMonoEmptyValue","showUmmyInfo":"n0","sovetnikBlacklist":"o{}","sovetnikEnabled":"n0","sovetnikOfferAccepted":"bfalse","sovetnikRemoved":"bfalse","sovetnikUpdateTime":"n1431647065318","statOpt":"o{\"isAllow\":false}","submit":"sisMonoEmptyValue","submit_expire_":"sisMonoEmptyValue","toggle":"sisMonoEmptyValue","toggle_expire_":"sisMonoEmptyValue","trackTime":"s{\"w\":\"1467706996854\"}","uRadio":"o{\"siteList\":{\"radiorecord.ru\":3,\"tunein.com\":3}}","ummyDetected":"n1","uuid":"sdf53c2ea-58eb-41db-8033-3578bbb7662b","val":"sisMonoEmptyValue","val_expire_":"sisMonoEmptyValue","version":"s{\"w\":\"6.60.2\"}","wheel":"sisMonoEmptyValue","wheel_expire_":"sisMonoEmptyValue","ytDechipList":"s{\"w\":{\"16966\":[[\"swap\",36],[\"splice\",2],[\"swap\",65],[\"reverse\",null],[\"splice\",2],[\"swap\",11],[\"swap\",31]],\"16974\":[[\"reverse\",null],[\"swap\",45],[\"reverse\",null]],\"16976\":[[\"swap\",57],[\"reverse\",null],[\"swap\",57],[\"swap\",38],[\"splice\",3],[\"swap\",47],[\"splice\",2]]}}","ytHide3D":"n1","ytHide3GP":"n1","ytHideAudio_MP4":"n1","ytHideMP4NoAudio":"n1","ytHideWebM":"n1","ytLastITag":"summy"},"ts":1473229729429},"enabled":true,"position":2,"file_url":"https://download.sf-helper.com/chrome/helper.user.js","uuid":"85b71f56-8d95-4978-94c7-f08ffac864fe","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIFNhdmVGcm9tLm5ldCBoZWxwZXIKLy8gQG5hbWVzcGFjZSAgIGh0dHA6Ly9zYXZlZnJvbS5uZXQvCi8vIEB2ZXJzaW9uICAgICA2LjYwLjIKLy8gQGRhdGUgICAgICAgIDIwMTYtMDgtMjIKLy8gQGF1dGhvciAgICAgIE1hZ2ljYml0LCBJbmMKLy8gQGRlc2NyaXB0aW9uIFlvdXR1YmUgRG93bmxvYWRlcjogYWxsIGluIG9uZSBzY3JpcHQgdG8gZ2V0IFZpbWVvLCBGYWNlYm9vaywgRGFpbHltb3Rpb24gdmlkZW9zIGZvciBmcmVlCi8vIEBob21lcGFnZSAgICBodHRwOi8vc2F2ZWZyb20ubmV0L3VzZXIucGhwP2hlbHBlcj11c2VyanMKLy8gQGljb24gICAgICAgIGh0dHA6Ly9zZi1oZWxwZXIuY29tL2ltZy9pY29uXzE2LnBuZwovLyBAaWNvbjY0ICAgICAgaHR0cDovL3NmLWhlbHBlci5jb20vaW1nL2ljb25fNjQucG5nCi8vIEB1cGRhdGVVUkwgICBodHRwczovL2Rvd25sb2FkLnNmLWhlbHBlci5jb20vY2hyb21lL2hlbHBlci5tZXRhLmpzCi8vIEBkb3dubG9hZFVSTCBodHRwczovL2Rvd25sb2FkLnNmLWhlbHBlci5jb20vY2hyb21lL2hlbHBlci51c2VyLmpzCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly8qCi8vIEBleGNsdWRlICAgICAqOi8vZ29vZ2xlLiovKgovLyBAZXhjbHVkZSAgICAgKjovLyouZ29vZ2xlLiovKgovLyBAZXhjbHVkZSAgICAgKjovL2FjaWR0ZXN0cy5vcmcvKgovLyBAZXhjbHVkZSAgICAgKjovLyouYWNpZHRlc3RzLm9yZy8qCi8vIEBydW4tYXQgICAgICBkb2N1bWVudC1lbmQKLy8gQGdyYW50ICAgICAgIEdNX2xpc3RWYWx1ZXMKLy8gQGdyYW50ICAgICAgIEdNX3NldFZhbHVlCi8vIEBncmFudCAgICAgICBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgR01fZGVsZXRlVmFsdWUKLy8gQGdyYW50ICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBncmFudCAgICAgICBHTV9pbmZvCi8vIEBncmFudCAgICAgICBHTV9vcGVuSW5UYWIKLy8gQGdyYW50ICAgICAgIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQKLy8gQGdyYW50ICAgICAgIEdNX3VucmVnaXN0ZXJNZW51Q29tbWFuZAovLyBAZ3JhbnQgICAgICAgR01fbm90aWZpY2F0aW9uCi8vIEBncmFudCAgICAgICBHTV9kb3dubG9hZAovLyBAY29ubmVjdCAgICAgdmsuY29tCi8vIEBjb25uZWN0ICAgICB2ay5tZQovLyBAY29ubmVjdCAgICAgdmstY2RuLm5ldAovLyBAY29ubmVjdCAgICAgeW91dHViZS5jb20KLy8gQGNvbm5lY3QgICAgIHlvdXR1YmUtbm9jb29raWUuY29tCi8vIEBjb25uZWN0ICAgICB5dGltZy5jb20KLy8gQGNvbm5lY3QgICAgIGdvb2dsZXZpZGVvLmNvbQovLyBAY29ubmVjdCAgICAgdmlkZW8uZ29vZ2xlLmNvbQovLyBAY29ubmVjdCAgICAgZ29vZ2xlLWFuYWx5dGljcy5jb20KLy8gQGNvbm5lY3QgICAgIGRhaWx5bW90aW9uLmNvbQovLyBAY29ubmVjdCAgICAgdmltZW8uY29tCi8vIEBjb25uZWN0ICAgICB2aW1lb2Nkbi5jb20KLy8gQGNvbm5lY3QgICAgIG9kbm9rbGFzc25pa2kucnUKLy8gQGNvbm5lY3QgICAgIG9rLnJ1Ci8vIEBjb25uZWN0ICAgICBjZG4tb2suY29tCi8vIEBjb25uZWN0ICAgICBteWNkbi5tZQovLyBAY29ubmVjdCAgICAgcGxhZGZvcm0ucnUKLy8gQGNvbm5lY3QgICAgIGNsaXB5b3UucnUKLy8gQGNvbm5lY3QgICAgIHNvdW5kY2xvdWQuY29tCi8vIEBjb25uZWN0ICAgICBzbmRjZG4uY29tCi8vIEBjb25uZWN0ICAgICBtYWlsLnJ1Ci8vIEBjb25uZWN0ICAgICBjZG5pbnN0YWdyYW0uY29tCi8vIEBjb25uZWN0ICAgICBmYmNkbi5uZXQKLy8gQGNvbm5lY3QgICAgIGZhY2Vib29rLmNvbQovLyBAY29ubmVjdCAgICAgc2YtaGVscGVyLmNvbQovLyBAY29ubmVjdCAgICAgYXZpYXNhbGVzLnJ1Ci8vIEBjb25uZWN0ICAgICB0cmF2ZWxwYXlvdXRzLmNvbQovLyBAY29ubmVjdCAgICAgc2t5c2Nhbm5lci5uZXQKLy8gQGNvbm5lY3QgICAgIGhvdGVsbG9vay5jb20KLy8gQGNvbm5lY3QgICAgIHNhdmVmcm9tLm5ldAovLyBAY29ubmVjdCAgICAgc2VsZgovLyBAY29ubmVjdCAgICAgKgovLyA9PS9Vc2VyU2NyaXB0PT0KCihmdW5jdGlvbigpIHsKICBpZiAodHlwZW9mIEpTT04gPT09ICd1bmRlZmluZWQnKSB7CiAgICBpZiAod2luZG93LkpTT04pIHsKICAgICAgSlNPTiA9IHdpbmRvdy5KU09OOwogICAgfSBlbHNlCiAgICBpZiAoZG9jdW1lbnQuZGVmYXVsdFZpZXcgJiYgZG9jdW1lbnQuZGVmYXVsdFZpZXcuSlNPTikgewogICAgICBKU09OID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuSlNPTjsKICAgIH0KICB9CgogIGlmICh0eXBlb2YgR01fZ2V0VmFsdWUgPT09ICd1bmRlZmluZWQnIHx8CiAgICB0eXBlb2YgR01fc2V0VmFsdWUgPT09ICd1bmRlZmluZWQnIHx8CiAgICB0eXBlb2YgR01feG1saHR0cFJlcXVlc3QgPT09ICd1bmRlZmluZWQnIHx8CiAgICB0eXBlb2YgSlNPTiA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdHTSBBUEkgaXMgbm90IHJlYWR5IScpOwogIH0KCiAgdmFyIF9tb2R1bGVOYW1lID0gbnVsbDsKCiAgdmFyIF9tZW51OwogIHZhciBfb3B0aW9uczsKICB2YXIgX21vZHVsZXMgPSB7fTsKICB2YXIgX2xhbmd1YWdlTGlzdCA9IHt9OwoKICB0cnkgewogICAgd2luZG93LnNlc3Npb25TdG9yYWdlWydzYXZlZnJvbS1oZWxwZXItdXNlcmpzJ10gPSAnMSc7CiAgfSBjYXRjaCAoZSkge30KICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgLy8gTUVOVQogIF9tZW51ID0gewogICAgYWN0aXZlRGF0YUF0dHI6ICdkYXRhLXNmaC1hY3RpdmUnLAogICAgaWQ6ICdzZmgtLXVqcy1tZW51JywKICAgIHRvb2x0aXBJZDogJ3NmaC0tdWpzLW1lbnUtdG9vbHRpcCcsCiAgICBlbmFibGVkOiB0cnVlLAogICAgYWN0aXZlOiBmYWxzZSwKICAgIGhvdmVyOiBmYWxzZSwKICAgIG1vdmU6IGZhbHNlLAogICAgdGl0bGU6ICcnLAogICAgc2hha2VUaW1lcjogMCwKICAgIHNoYWtlSW50ZXJ2YWw6IDEwMDAwLAoKICAgIG1lbnU6IG51bGwsCiAgICBpY29uOiBudWxsLAoKICAgIGluaXRNZW51OiBudWxsLAoKICAgIHN0eWxlOiB7CiAgICAgIG1lbnU6IHsKICAgICAgICBpbml0aWFsOiB7CiAgICAgICAgICBiYWNrZ3JvdW5kOiAnI2ZmZicsCiAgICAgICAgICBib3JkZXJTdHlsZTogJ3NvbGlkJywKICAgICAgICAgIGJvcmRlcldpZHRoOiAnMnB4IDAgMnB4IDJweCcsCiAgICAgICAgICBib3JkZXJSYWRpdXM6ICc1cHggMCAwIDVweCcsCiAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsCiAgICAgICAgICBib3hTaXppbmc6ICdjb250ZW50LWJveCcsCiAgICAgICAgICBmb250OiAnMTNweC8xOHB4IEFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmJywKICAgICAgICAgIHdpZHRoOiAnYXV0bycsCiAgICAgICAgICBoZWlnaHQ6ICdhdXRvJywKICAgICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgICBtYXJnaW46IDAsCiAgICAgICAgICBvdmVyZmxvdzogJ3Zpc2libGUnLAogICAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsCiAgICAgICAgICB0b3A6ICc1MHB4JywKICAgICAgICAgIHJpZ2h0OiAnMCcsCiAgICAgICAgICB0ZXh0QWxpZ246ICdsZWZ0JywKICAgICAgICAgIFdlYmtpdFRyYW5zaXRpb246ICdhbGwgMC4ycycsCiAgICAgICAgICB0cmFuc2l0aW9uOiAnYWxsIDAuMnMnLAogICAgICAgICAgekluZGV4OiA5OTk5OQogICAgICAgIH0sCgogICAgICAgIGVuYWJsZWQ6IHsKICAgICAgICAgIGJvcmRlckNvbG9yOiAnIzhkYzUwYicKICAgICAgICB9LAoKICAgICAgICBkaXNhYmxlZDogewogICAgICAgICAgYm9yZGVyQ29sb3I6ICcjZDBkMGQwJwogICAgICAgIH0sCgogICAgICAgIHRhZzogewogICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgIHdpZHRoOiAnMTBweCcsCiAgICAgICAgICBoZWlnaHQ6ICcyMHB4JywKICAgICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJywKICAgICAgICAgIG9wYWNpdHk6IDAuNQogICAgICAgIH0sCgogICAgICAgIHRhZ0hvdmVyOiB7CiAgICAgICAgICB3aWR0aDogJzIwcHgnLAogICAgICAgICAgb3BhY2l0eTogMC44CiAgICAgICAgfSwKCiAgICAgICAgYWN0aXZlOiB7CiAgICAgICAgICB3aWR0aDogJ2F1dG8nLAogICAgICAgICAgaGVpZ2h0OiAnYXV0bycsCiAgICAgICAgICBvdmVyZmxvdzogJ3Zpc2libGUnLAogICAgICAgICAgb3BhY2l0eTogMC45CiAgICAgICAgfQogICAgICB9LAoKICAgICAgaWNvbjogewogICAgICAgIGluaXRpYWw6IHsKICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgYm94U2l6aW5nOiAnY29udGVudC1ib3gnLAogICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAnNTAlIDUwJScsCiAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAnbm8tcmVwZWF0JywKICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICBoZWlnaHQ6ICcxNnB4JywKICAgICAgICAgIG1hcmdpbjogMCwKICAgICAgICAgIHBhZGRpbmc6ICcycHgnLAogICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLAogICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgIH0sCgogICAgICAgIGVuYWJsZWQ6IHsKICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJ3VybChkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJBQUFBQVFDQVlBQUFBZjgvOWhBQUFCcVVsRVFWUTRqWTJTelN0RVVSaUhmMmJNbCt3MFNySFJaS1BZK1J0a1l5ZVJzcFBGc0VFWkl0TE0zRENSanhvZncwd3lLMGsrQ2xOR2hCaUVtSWl3c3JDaFpxdmovc1pjem5ESjR1bTg1MzJmOSszY2N5NWlzUmcwUXJlMlY2N2h4eXp4bmZrSG01QWREY2liNlN2TEM5ZTVlNXY0VHVqdVk0RG02QTRZUGM2ODR4cThzYjZGYnExQ1prYk55VTdhQUNWcWRQaFA4dXNHb3VaVDdxY3VMSW5wdUZuSVRKNmJFNnpSb2N1ZXp3RWRTL0IyTHVPK2V3WEpZNDRkbVo3OTV5WWhNNkxtV0tORGx6MXBuK0QwbzZKNUZqZU1mYnZHeDlFVGc1QmhqalU2ZEhYdlFNTWRNY1o5QnhBeTdrMURYTS9GMEo2dFlTeG05d2JPSEo2NXk5TGg0Rm5KdkxLWmZhM3NRS1NoNWxpalE1Yzk3RVg3R25KNjFuSFlGNEVnbmkwa2xHM2prN2JYWUk0MWJjOGU5aWFQMFJoQXJtc1IrOTJyRVArQkxudlNMM0VTZWExaDdMb1dWT0VQNk5EVnZjVGFRUlE0WnhCdENVUG93UnFkWC85RVV0T0Z3b1p4YkRUTlFzZ3d4OXFQVjlCN21xb09GTlgzWTYxeEFvSXdaazczR2ZXU3lTRnRLSzd1eFNwaC9KdjNGUUFaS2dZVmswcTJpcjJzRXVXRWNTcG5TamtaV3Q4N0c3c1pnVng2SnZnQUFBQUFTVVZPUks1Q1lJST0pJwogICAgICAgIH0sCgogICAgICAgIGRpc2FibGVkOiB7CiAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICd1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQUNYQklXWE1BQUEzWEFBQU4xd0ZDS0p0NEFBQUtUMmxEUTFCUWFHOTBiM05vYjNBZ1NVTkRJSEJ5YjJacGJHVUFBSGphblZOblZGUHBGajMzM3ZSQ1M0aUFsRXR2VWhVSUlGSkNpNEFVa1NZcUlRa1FTb2dob2RrVlVjRVJSVVVFRzhpZ2lBT09qb0NNRlZFc0RJb0syQWZrSWFLT2c2T0lpc3I3NFh1amE5YTg5K2JOL3JYWFB1ZXM4NTJ6endmQUNBeVdTRE5STllBTXFVSWVFZUNEeDhURzRlUXVRSUVLSkhBQUVBaXpaQ0Z6L1NNQkFQaCtQRHdySXNBSHZnQUJlTk1MQ0FEQVRadkFNQnlIL3cvcVFwbGNBWUNFQWNCMGtUaExDSUFVQUVCNmprS21BRUJHQVlDZG1DWlRBS0FFQUdETFkyTGpBRkF0QUdBbmYrYlRBSUNkK0psN0FRQmJsQ0VWQWFDUkFDQVRaWWhFQUdnN0FLelBWb3BGQUZnd0FCUm1TOFE1QU5ndEFEQkpWMlpJQUxDM0FNRE9FQXV5QUFnTUFEQlJpSVVwQUFSN0FHRElJeU40QUlTWkFCUkc4bGM4OFN1dUVPY3FBQUI0bWJJOHVTUTVSWUZiQ0MxeEIxZFhMaDRvemtrWEt4UTJZUUpobWtBdXdubVpHVEtCTkEvZzg4d0FBS0NSRlJIZ2cvUDllTTRPcnM3T05vNjJEbDh0NnI4Ry95SmlZdVArNWMrcmNFQUFBT0YwZnRIK0xDK3pHb0E3Qm9CdC9xSWw3Z1JvWGd1Z2RmZUxacklQUUxVQW9PbmFWL053K0g0OFBFV2hrTG5aMmVYazVOaEt4RUpiWWNwWGZmNW53bC9BVi8xcytYNDgvUGYxNEw3aUpJRXlYWUZIQlBqZ3dzejBUS1VjejVJSmhHTGM1bzlIL0xjTC8vd2QweUxFU1dLNVdDb1U0MUVTY1k1RW1venpNcVVpaVVLU0tjVWwwdjlrNHQ4cyt3TSszelVBc0dvK0FYdVJMYWhkWXdQMlN5Y1FXSFRBNHZjQUFQSzdiOEhVS0FnRGdHaUQ0YzkzLys4Ly9VZWdKUUNBWmttU2NRQUFYa1FrTGxUS3N6L0hDQUFBUktDQktyQkJHL1RCR0N6QUJoekJCZHpCQy94Z05vUkNKTVRDUWhCQ0NtU0FISEpnS2F5Q1FpaUd6YkFkS21BdjFFQWROTUJSYUlhVGNBNHV3bFc0RGoxd0QvcGhDSjdCS0x5QkNRUkJ5QWdUWVNIYWlBRmlpbGdqamdnWG1ZWDRJY0ZJQkJLTEpDREppQlJSSWt1Uk5VZ3hVb3BVSUZWSUhmSTljZ0k1aDF4R3VwRTd5QUF5Z3Z5R3ZFY3hsSUd5VVQzVURMVkR1YWczR29SR29ndlFaSFF4bW84V29KdlFjclFhUFl3Mm9lZlFxMmdQMm84K1E4Y3d3T2dZQnpQRWJEQXV4c05Dc1Rnc0NaTmp5N0VpckF5cnhocXdWcXdEdTRuMVk4K3hkd1FTZ1VYQUNUWUVkMElnWVI1QlNGaE1XRTdZU0tnZ0hDUTBFZG9KTndrRGhGSENKeUtUcUV1MEpyb1IrY1FZWWpJeGgxaElMQ1BXRW84VEx4QjdpRVBFTnlRU2lVTXlKN21RQWtteHBGVFNFdEpHMG01U0kra3NxWnMwU0Jvams4bmFaR3V5QnptVUxDQXJ5SVhrbmVURDVEUGtHK1FoOGxzS25XSkFjYVQ0VStJb1VzcHFTaG5sRU9VMDVRWmxtREpCVmFPYVV0Mm9vVlFSTlk5YVFxMmh0bEt2VVllb0V6UjFtam5OZ3haSlM2V3RvcFhUR21nWGFQZHByK2gwdWhIZGxSNU9sOUJYMHN2cFIraVg2QVAwZHd3TmhoV0R4NGhuS0JtYkdBY1laeGwzR0srWVRLWVowNHNaeDFRd056SHJtT2VaRDVsdlZWZ3F0aXA4RlpIS0NwVktsU2FWR3lvdlZLbXFwcXJlcWd0VjgxWExWSStwWGxOOXJrWlZNMVBqcVFuVWxxdFZxcDFRNjFNYlUyZXBPNmlIcW1lb2IxUS9wSDVaL1lrR1djTk13MDlEcEZHZ3NWL2p2TVlnQzJNWnMzZ3NJV3NOcTRaMWdUWEVKckhOMlh4MktydVkvUjI3aXoycXFhRTVRek5LTTFlelV2T1VaajhINDVoeCtKeDBUZ25uS0tlWDgzNkszaFR2S2VJcEc2WTBUTGt4WlZ4cnFwYVhsbGlyU0t0UnEwZnJ2VGF1N2FlZHByMUZ1MW43Z1E1Qngwb25YQ2RIWjQvT0JaM25VOWxUM2FjS3B4Wk5QVHIxcmk2cWE2VWJvYnRFZDc5dXArNllucjVlZ0o1TWI2ZmVlYjNuK2h4OUwvMVUvVzM2cC9WSERGZ0dzd3drQnRzTXpoZzh4VFZ4Ynp3ZEw4ZmI4VkZEWGNOQVE2VmhsV0dYNFlTUnVkRThvOVZHalVZUGpHbkdYT01rNDIzR2JjYWpKZ1ltSVNaTFRlcE43cHBTVGJtbUthWTdURHRNeDgzTXphTE4xcGsxbXoweDF6TG5tK2ViMTV2ZnQyQmFlRm9zdHFpMnVHVkpzdVJhcGxudXRyeHVoVm81V2FWWVZWcGRzMGF0bmEwbDFydXR1NmNScDdsT2swNnJudFpudzdEeHRzbTJxYmNac09YWUJ0dXV0bTIyZldGblloZG50OFd1dys2VHZaTjl1bjJOL1QwSERZZlpEcXNkV2gxK2M3UnlGRHBXT3Q2YXpwenVQMzNGOUpicEwyZFl6eERQMkRQanRoUExLY1JwblZPYjAwZG5GMmU1YzRQemlJdUpTNExMTHBjK0xwc2J4dDNJdmVSS2RQVnhYZUY2MHZXZG03T2J3dTJvMjYvdU51NXA3b2Zjbjh3MG55bWVXVE56ME1QSVErQlI1ZEUvQzUrVk1HdmZySDVQUTArQlo3WG5JeTlqTDVGWHJkZXd0NlYzcXZkaDd4Yys5ajV5bitNKzR6dzMzakxlV1YvTU44QzN5TGZMVDhOdm5sK0YzME4vSS85ay8zci8wUUNuZ0NVQlp3T0pnVUdCV3dMNytIcDhJYitPUHpyYlpmYXkyZTFCaktDNVFSVkJqNEt0Z3VYQnJTRm95T3lRclNIMzU1ak9rYzVwRG9WUWZ1alcwQWRoNW1HTHczNE1KNFdIaFZlR1A0NXdpRmdhMFRHWE5YZlIzRU56MzBUNlJKWkUzcHRuTVU4NXJ5MUtOU28rcWk1cVBObzN1alM2UDhZdVpsbk0xVmlkV0Vsc1N4dzVMaXF1Tm01c3Z0Lzg3Zk9INHAzaUMrTjdGNWd2eUYxd2VhSE93dlNGcHhhcExoSXNPcFpBVEloT09KVHdRUkFxcUJhTUpmSVRkeVdPQ25uQ0hjSm5JaS9STnRHSTJFTmNLaDVPOGtncVRYcVM3Skc4Tlhra3hUT2xMT1c1aENlcGtMeE1EVXpkbXpxZUZwcDJJRzB5UFRxOU1ZT1NrWkJ4UXFvaFRaTzJaK3BuNW1aMnk2eGxoYkwreFc2THR5OGVsUWZKYTdPUXJBVlpMUXEyUXFib1ZGb28xeW9Ic21kbFYyYS96WW5LT1phcm5pdk43Y3l6eXR1UU41enZuLy90RXNJUzRaSzJwWVpMVnkwZFdPYTlyR281c2p4eGVkc0s0eFVGSzRaV0Jxdzh1SXEyS20zVlQ2dnRWNWV1ZnIwbWVrMXJnVjdCeW9MQnRRRnI2d3RWQ3VXRmZldmMxKzFkVDFndldkKzFZZnFHblJzK0ZZbUtyaFRiRjVjVmY5Z28zSGpsRzRkdnlyK1ozSlMwcWF2RXVXVFBadEptNmViZUxaNWJEcGFxbCthWERtNE4yZHEwRGQ5V3RPMzE5a1hiTDVmTktOdTdnN1pEdWFPL1BMaThaYWZKenMwN1AxU2tWUFJVK2xRMjd0TGR0V0hYK0c3UjdodDd2UFkwN05YYlc3ejMvVDdKdnR0VkFWVk4xV2JWWmZ0Sis3UDNQNjZKcXVuNGx2dHRYYTFPYlhIdHh3UFNBLzBISXc2MjE3blUxUjNTUFZSU2o5WXI2MGNPeHgrKy9wM3ZkeTBOTmcxVmpaekc0aU53UkhuazZmY0ozL2NlRFRyYWRveDdyT0VIMHg5MkhXY2RMMnBDbXZLYVJwdFRtdnRiWWx1NlQ4dyswZGJxM25yOFI5c2ZENXcwUEZsNVN2TlV5V25hNllMVGsyZnl6NHlkbFoxOWZpNzUzR0Rib3JaNzUyUE8zMm9QYisrNkVIVGgwa1gvaStjN3ZEdk9YUEs0ZFBLeTIrVVRWN2hYbXE4NlgyM3FkT284L3BQVFQ4ZTduTHVhcnJsY2E3bnVlcjIxZTJiMzZSdWVOODdkOUwxNThSYi8xdFdlT1QzZHZmTjZiL2ZGOS9YZkZ0MStjaWY5enN1NzJYY243cTI4VDd4ZjlFRHRRZGxEM1lmVlAxdiszTmp2M0g5cXdIZWc4OUhjUi9jR2hZUFAvcEgxanc5REJZK1pqOHVHRFlicm5qZytPVG5pUDNMOTZmeW5RODlrenlhZUYvNmkvc3V1RnhZdmZ2alY2OWZPMFpqUm9aZnlsNU8vYlh5bC9lckE2eG12MjhiQ3hoNit5WGd6TVY3MFZ2dnR3WGZjZHgzdm85OFBUK1I4SUg4by8yajVzZlZUMEtmN2t4bVRrLzhFQTVqei9HTXpMZHNBQUFBZ1kwaFNUUUFBZWlVQUFJQ0RBQUQ1L3dBQWdPa0FBSFV3QUFEcVlBQUFPcGdBQUJkdmtsL0ZSZ0FBQWlOSlJFRlVlTnFNa2orb1VsRWN4Ny9uSHUvVjdsTVR4YWdocUlnb1dwSVFpc0NtaGpmbG9EUzlRUWdNSGtwVE9EYzJoUzQ1T1FSQjZHQ0xiMmhxaUFJSnB6QjZVVWhEa3FpMzQvMTdydGZUb25JMWlmZURzL3pPNS9lQjgvMGR3aGpEcWpSTit4T0x4VTRiaGlHd1ZVSUloTU5oc21KVy9ZQWZzbTFiQUlEbmVkZ2w4RE03QllaaGpBSEFkZDBGcFZUeTM4M244NFdmMlJEMGVyM0w4WGo4dHE3ckRBQWN4N0VvcFh0YkFnc0FkRjFuZzhIZ1lES1pmRWlsVXQ4Q0FEQ2J6UjdxdXY1QWtxUUxBR0JabGhVTUJqY0VqdU9zQkRjWVkwK0ZFSzhCVkNRQXlHUXlsZWwwZXFocDJ2SHluU2JuSFA1ajI3YTVEUHA0T3AwZVpqS1pDZ0FRL3haVzFlMTIrK0Z3K0txL3ArdjZsM1E2ZlcyYkRmVDcvYUtpS0JkRG9aQlFGRVgxUEM5SkNKRTQ1eHNnSVVRYURvZXZLS1VqenJscDJ6YmhuUDhnblU0bkljdnlFYVUwdlFRTlNaSm1udWVkOVFzb3BjUEZZaEVSUXV3dFY5MTFYWGVmTU1iUWJEYlBKSlBKTjdJczM4SUp5blhkajZQUjZINCtuLys5enFEZGJwOVRWYldwS01xZC93MXp6dCticHBuUFpyTy8vZ214MFdpY1R5UVNMME9oME4xZHc3WnR2eHVQeHdlRlF1SG5PcHZ0TGRUcjlVdXhXT3lGcXFyMy9IM1ROTjlxbXZhb1dDeCszd2gzMXhwcnRkcVZhRFQ2UEJLSjdDOC8yaEZqN0hHcFZQcTZ6ZTRVQUVDMVdyMHV5L0t6WldoUHl1WHk1MTNjV2hDTlJna0FBb0FDQ0FJNGxjdmxiZ0pBcTlYNkJNQUM0QUR3QUFqR21BQ0F2d01BWFg4a2hORTcyVklBQUFBQVNVVk9SSzVDWUlJPSknCiAgICAgICAgfSwKCiAgICAgICAgdGFnOiB7CiAgICAgICAgICBwYWRkaW5nOiAnMnB4JwogICAgICAgIH0sCiAgICAgICAgYWN0aXZlOiB7CiAgICAgICAgICBwYWRkaW5nOiAnNXB4JwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIHRpdGxlOiB7CiAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgZm9udDogJ2JvbGQgMTNweC8xOHB4IEFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmJywKICAgICAgICBsaW5lSGVpZ2h0OiAnMjZweCcsCiAgICAgICAgbWFyZ2luOiAwLAogICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgdGV4dEFsaWduOiAnbGVmdCcsCiAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgfQogICAgfSwKCiAgICBzZXRUaXRsZTogZnVuY3Rpb24odGl0bGUsIHZlcnNpb24pIHsKICAgICAgdGhpcy50aXRsZSA9IHRpdGxlOwogICAgICBpZiAodmVyc2lvbikKICAgICAgICB0aGlzLnRpdGxlICs9ICcgJyArIHZlcnNpb247CiAgICB9LAoKICAgIGhpZGU6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMubWVudSB8fCAhZG9jdW1lbnQuYm9keSkKICAgICAgICByZXR1cm47CiAgICAgIHRoaXMubWVudS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubWVudSk7CiAgICAgIHRoaXMubWVudSA9IG51bGw7CiAgICAgIHRoaXMuaWNvbiA9IG51bGw7CiAgICB9LAoKICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLm1lbnUgfHwgIWRvY3VtZW50LmJvZHkpCiAgICAgICAgcmV0dXJuOwoKICAgICAgdGhpcy5tb2R1bGVOYW1lID0gX21vZHVsZU5hbWU7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIG1lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCiAgICAgIG1lbnUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKCFfdGhpcy5hY3RpdmUpIHsKICAgICAgICAgIF90aGlzLmhvdmVyID0gdHJ1ZTsKICAgICAgICAgIF90aGlzLnNldEVsZW1lbnRzU3R5bGUoJ3RhZ0hvdmVyJyk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIG1lbnUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIV90aGlzLmFjdGl2ZSkgewogICAgICAgICAgX3RoaXMuaG92ZXIgPSBmYWxzZTsKICAgICAgICAgIF90aGlzLnNldEVsZW1lbnRzU3R5bGUoJ3RhZycpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBpY29uLnRpdGxlID0gdGhpcy50aXRsZTsKCiAgICAgIGljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkgewogICAgICAgIGlmIChfdGhpcy5tb3ZlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgIGlmIChldmVudC5idXR0b24gPT09IDApIHsKICAgICAgICAgIF90aGlzLnRvZ2dsZU1lbnVJdGVtcygpOwogICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuYnV0dG9uID09IDIpIHsKICAgICAgICAgIF90aGlzLnJlbW92ZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9LCBmYWxzZSk7CgogICAgICBpY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBpZiAoX3RoaXMubW92ZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIF90aGlzLnJlbW92ZSgpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwgZmFsc2UpOwoKICAgICAgdGhpcy5pY29uID0gbWVudS5hcHBlbmRDaGlsZChpY29uKTsKICAgICAgdGhpcy5tZW51ID0gZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtZW51KTsKCiAgICAgIHZhciBpY29uVG9wUG9zID0gcGFyc2VJbnQoX21lbnUuc3R5bGUubWVudS5pbml0aWFsLnRvcCk7CiAgICAgIGlmIChpY29uVG9wUG9zIDwgMCkgewogICAgICAgIGljb25Ub3BQb3MgPSAwOwogICAgICB9IGVsc2UKICAgICAgaWYgKHRoaXMubW9kdWxlTmFtZSA9PT0gJ3lvdXR1YmUnICYmIGljb25Ub3BQb3MgPCA5MikgewogICAgICAgIGljb25Ub3BQb3MgPSA5MjsKICAgICAgfSBlbHNlCiAgICAgIGlmIChpY29uVG9wUG9zICsgMjQgPiBwYXJzZUludCh3aW5kb3cuaW5uZXJIZWlnaHQpKSB7CiAgICAgICAgaWNvblRvcFBvcyA9IHBhcnNlSW50KHdpbmRvdy5pbm5lckhlaWdodCkgLSBwYXJzZUludChfbWVudS5zdHlsZS5tZW51LnRhZy5oZWlnaHQpIC0gNDsKICAgICAgfQoKICAgICAgX21lbnUuc3R5bGUubWVudS5pbml0aWFsLnRvcCA9IGljb25Ub3BQb3MgKyAncHgnOwoKICAgICAgdGhpcy5zZXRFbGVtZW50c1N0eWxlKCdpbml0aWFsJyk7CiAgICAgIHRoaXMuc2V0RW5hYmxlZCgxKTsKICAgICAgdGhpcy5zaG93VGFnKCk7CiAgICAgIHRoaXMuZW5hYmxlTW92ZSgpOwogICAgfSwKCiAgICBlbmFibGVNb3ZlOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGlzU3RhcnQgPSBmYWxzZTsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGljb24gPSBfdGhpcy5pY29uOwogICAgICB2YXIgbWVudSA9IF90aGlzLm1lbnU7CiAgICAgIHZhciBzdGFydFRpbWVyID0gdW5kZWZpbmVkOwogICAgICB2YXIgc1QgPSAocGFyc2VJbnQobWVudS5zdHlsZS5oZWlnaHQpIC8gMikgfHwgMDsKICAgICAgdmFyIG5vU2VsZWN0U3R5bGUgPSBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgdGV4dDogJ2JvZHkgey13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7LW1vei11c2VyLXNlbGVjdDogbm9uZTstby11c2VyLXNlbGVjdDogbm9uZTt1c2VyLXNlbGVjdDogbm9uZTt9JwogICAgICB9KTsKCiAgICAgIHZhciByYkljb24gPSBmdW5jdGlvbigpIHsKICAgICAgICBfdGhpcy5tb3ZlID0gZmFsc2U7CiAgICAgICAgbWVudS5zdHlsZS5wb3NpdGlvbiA9IF90aGlzLnN0eWxlLm1lbnUuaW5pdGlhbC5wb3NpdGlvbjsKICAgICAgICBtZW51LnN0eWxlLldlYmtpdFRyYW5zaXRpb24gPSBfdGhpcy5zdHlsZS5tZW51LmluaXRpYWwuV2Via2l0VHJhbnNpdGlvbjsKICAgICAgICBtZW51LnN0eWxlLnRyYW5zaXRpb24gPSBfdGhpcy5zdHlsZS5tZW51LmluaXRpYWwudHJhbnNpdGlvbjsKICAgICAgICBtZW51LnN0eWxlLmJvcmRlclN0eWxlID0gX3RoaXMuc3R5bGUubWVudS5pbml0aWFsLmJvcmRlclN0eWxlOwoKICAgICAgICBpZiAobm9TZWxlY3RTdHlsZS5wYXJlbnROb2RlKSB7CiAgICAgICAgICBub1NlbGVjdFN0eWxlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9TZWxlY3RTdHlsZSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIGluaXRJY29uID0gZnVuY3Rpb24oZSkgewogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICBfbWVudS5oaWRlTWVudUl0ZW1zKCk7CgogICAgICAgIF90aGlzLmhvdmVyID0gdHJ1ZTsKICAgICAgICBfdGhpcy5zZXRFbGVtZW50c1N0eWxlKCd0YWdIb3ZlcicpOwoKICAgICAgICBfdGhpcy5tb3ZlID0gdHJ1ZTsKICAgICAgICBtZW51LnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKICAgICAgICB2YXIgZVggPSBlLnkgfHwgZS5jbGllbnRZOwogICAgICAgIG1lbnUuc3R5bGUudG9wID0gKGVYIC0gc1QpICsgJ3B4JzsKICAgICAgICBtZW51LnN0eWxlLldlYmtpdFRyYW5zaXRpb24gPSAnaW5pdGlhbCc7CiAgICAgICAgbWVudS5zdHlsZS50cmFuc2l0aW9uID0gJ2luaXRpYWwnOwogICAgICAgIG1lbnUuc3R5bGUuYm9yZGVyU3R5bGUgPSAnZG90dGVkJzsKCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub1NlbGVjdFN0eWxlKTsKICAgICAgfTsKCiAgICAgIHZhciBvbk1vdXNlTW92ZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgZVggPSBlLnkgfHwgZS5jbGllbnRZOwogICAgICAgIHZhciB0b3BWYWx1ZSA9IGVYIC0gc1Q7CiAgICAgICAgaWYgKF90aGlzLm1vZHVsZU5hbWUgPT09ICd5b3V0dWJlJyAmJiB0b3BWYWx1ZSA8IDUwKSB7CiAgICAgICAgICB0b3BWYWx1ZSA9IDUwOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh0b3BWYWx1ZSA8IDApIHsKICAgICAgICAgIHRvcFZhbHVlID0gMDsKICAgICAgICB9CiAgICAgICAgbWVudS5zdHlsZS50b3AgPSBfdGhpcy5zdHlsZS5tZW51LmluaXRpYWwudG9wID0gdG9wVmFsdWUgKyAncHgnOwogICAgICB9OwoKICAgICAgdmFyIG9uU3RhcnRUaW1lciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICBpc1N0YXJ0ID0gdHJ1ZTsKICAgICAgICBpbml0SWNvbihlKTsKICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKTsKICAgICAgfTsKCiAgICAgIG1lbnUuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZnVuY3Rpb24oZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgfSk7CiAgICAgIG1lbnUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgIGlmIChlLnRhcmdldCAhPT0gX3RoaXMuaWNvbikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpc1N0YXJ0ID0gZmFsc2U7CiAgICAgICAgc3RhcnRUaW1lciA9IHNldFRpbWVvdXQob25TdGFydFRpbWVyLmJpbmQobnVsbCwgZSksIDUwMCk7CiAgICAgICAgdmFyIG1sID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQoc3RhcnRUaW1lcik7CiAgICAgICAgICBtb25vLm9mZihtZW51LCAnbW91c2VsZWF2ZScsIG1sKTsKICAgICAgICB9OwogICAgICAgIG1vbm8ub24obWVudSwgJ21vdXNlbGVhdmUnLCBtbCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZnVuY3Rpb24gbXUoKSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQoc3RhcnRUaW1lcik7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBtdSk7CiAgICAgICAgICBtb25vLm9mZihtZW51LCAnbW91c2VsZWF2ZScsIG1sKTsKICAgICAgICAgIGlmIChpc1N0YXJ0KSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQocmJJY29uLCAxMDApOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKTsKICAgICAgICAgICAgbW9uby5zdG9yYWdlLnNldCh7CiAgICAgICAgICAgICAgZ21JY29uVG9wOiBwYXJzZUludChfdGhpcy5zdHlsZS5tZW51LmluaXRpYWwudG9wKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAoKICAgIHNldFN0eWxlOiBmdW5jdGlvbihlbGVtZW50LCBzdHlsZSkgewogICAgICBpZiAodGhpc1tlbGVtZW50XSAmJiB0aGlzLnN0eWxlW2VsZW1lbnRdICYmIHRoaXMuc3R5bGVbZWxlbWVudF1bc3R5bGVdKQogICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKHRoaXNbZWxlbWVudF0sIHRoaXMuc3R5bGVbZWxlbWVudF1bc3R5bGVdKTsKICAgIH0sCgogICAgc2V0RWxlbWVudHNTdHlsZTogZnVuY3Rpb24oc3R5bGUpIHsKICAgICAgaWYgKCFzdHlsZSkKICAgICAgICByZXR1cm47CgogICAgICB2YXIgZWxlbWVudHMgPSBbJ21lbnUnLCAnaWNvbiddOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykKICAgICAgICB0aGlzLnNldFN0eWxlKGVsZW1lbnRzW2ldLCBzdHlsZSk7CiAgICB9LAoKICAgIHNldEVuYWJsZWQ6IGZ1bmN0aW9uKGVuYWJsZWQpIHsKICAgICAgdGhpcy5lbmFibGVkID0gZW5hYmxlZDsKICAgICAgdGhpcy5zZXRFbGVtZW50c1N0eWxlKHRoaXMuZW5hYmxlZCA/ICdlbmFibGVkJyA6ICdkaXNhYmxlZCcpOwogICAgfSwKCiAgICBzaG93VGFnOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5zZXRFbGVtZW50c1N0eWxlKCd0YWcnKTsKICAgIH0sCgogICAgdG9nZ2xlTWVudUl0ZW1zOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIF9tZW51LmFjdGl2ZSA/IF9tZW51LmhpZGVNZW51SXRlbXMoKSA6IF9tZW51LnNob3dNZW51SXRlbXMoKTsKICAgIH0sCgogICAgcmVtb3ZlOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKF9tZW51Lm1lbnUpCiAgICAgICAgX21lbnUubWVudS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKF9tZW51Lm1lbnUpOwoKICAgICAgLy8gX21lbnUucmVtb3ZlVG9vbHRpcCgpOwogICAgfSwKCiAgICBtZW51SFRNTDogJ1BITjBlV3hsSUhSNWNHVTlJblJsZUhRdlkzTnpJajRLTG5ObUxXMWxiblV0WTI5dWRHRnBibVZ5SUhzS0lDQWdJSGRwWkhSb09pQTBPREp3ZURzS0lDQWdJR1p2Ym5RNklERXljSGd2TVRkd2VDQlVZV2h2YldFc0lFaGxiSFpsZEdsallTd2dUM0JsYmxOaGJuTXNJSE5oYm5NdGMyVnlhV1k3Q2lBZ0lDQmpiMnh2Y2pvZ0l6QXdNRHNLSUNBZ0lHSmhZMnRuY205MWJtUXRZMjlzYjNJNklDTm1abVk3Q2lBZ0lDQnRZWEpuYVc0NklEQTdDaUFnSUNCaWIzZ3RjMmw2YVc1bk9pQnBibWhsY21sME93b2dJQ0FnYjNabGNtWnNiM2M2SUdocFpHUmxianNLSUNBZ0lHWnNaWGd0WkdseVpXTjBhVzl1T2lCcGJtbDBhV0ZzT3dwOUNpNXpaaTF0Wlc1MUxXTnZiblJoYVc1bGNpNXNiMkZrYVc1bklENGdLaUI3Q2lBZ0lDQjJhWE5wWW1sc2FYUjVPaUJvYVdSa1pXNDdDbjBLTG5ObUxXMWxiblV0WTI5dWRHRnBibVZ5SUQ0Z0tpQjdDaUFnSUNCaWIzZ3RjMmw2YVc1bk9pQnBibWhsY21sME93b2dJQ0FnWm14bGVDMWthWEpsWTNScGIyNDZJR2x1YVhScFlXdzdDbjBLTG5ObUxXMWxiblV0WTI5dWRHRnBibVZ5SUhBZ2V3b2dJQ0FnWm05dWRDMXphWHBsT2lBeE1uQjRPd3A5Q2k1elppMXRaVzUxTFdOdmJuUmhhVzVsY2lCa2FYWXVjMll0YldWdWRTMXNhWE4wTEFvdWMyWXRiV1Z1ZFMxamIyNTBZV2x1WlhJZ1pHbDJMbk5tTFcxbGJuVXRaR1Z6WXlCN0NpQWdJQ0JrYVhOd2JHRjVPaUJwYm14cGJtVXRZbXh2WTJzN0NpQWdJQ0IyWlhKMGFXTmhiQzFoYkdsbmJqb2dkRzl3T3dvZ0lDQWdabXh2WVhRNklHeGxablE3Q24wS0xuTm1MVzFsYm5VdFkyOXVkR0ZwYm1WeUlHUnBkaTV6WmkxdFpXNTFMV1JsYzJNZ2V3b2dJQ0FnZDJsa2RHZzZJREUyTm5CNE93b2dJQ0FnY0dGa1pHbHVaem9nTWpCd2VDQXpNSEI0T3dvZ0lDQWdjR0ZrWkdsdVp5MWliM1IwYjIwNklETTJjSGc3Q2lBZ0lDQmpiMnh2Y2pvZ0l6WmhObUUyWVRzS2ZRb3VjMll0YldWdWRTMWpiMjUwWVdsdVpYSWdaR2wyTG5ObUxXMWxiblV0WkdWell5QmhJSHNLSUNBZ0lIUmxlSFF0WkdWamIzSmhkR2x2YmpvZ2JtOXVaVHNLSUNBZ0lHTnZiRzl5T2lBak5FRTVNRVV5T3dwOUNpNXpaaTF0Wlc1MUxXTnZiblJoYVc1bGNpQmthWFl1YzJZdGJXVnVkUzFrWlhOaklHRTZibTkwS0M1emIyTnBZV3d0WW5SdUtUcG9iM1psY2lCN0NpQWdJQ0IwWlhoMExXUmxZMjl5WVhScGIyNDZJSFZ1WkdWeWJHbHVaVHNLZlFvdWMyWXRiV1Z1ZFMxamIyNTBZV2x1WlhJZ0xuTm1MVzFsYm5VdFpHVnpZeUF1YVdOdmJpQjdDaUFnSUNCM2FXUjBhRG9nTnpSd2VEc0tJQ0FnSUdobGFXZG9kRG9nTnpSd2VEc0tJQ0FnSUdScGMzQnNZWGs2SUdsdWJHbHVaUzFpYkc5amF6c0tJQ0FnSUdKaFkydG5jbTkxYm1RdGMybDZaVG9nTnpSd2VEc0tJQ0FnSUdKaFkydG5jbTkxYm1RdGNtVndaV0YwT2lCdWJ5MXlaWEJsWVhRN0NpQWdJQ0JpWVdOclozSnZkVzVrTFhCdmMybDBhVzl1T2lCalpXNTBaWEk3Q2lBZ0lDQndZV1JrYVc1bk9pQXdPd29nSUNBZ2JXRnlaMmx1T2lBd093cDlDaTV6WmkxdFpXNTFMV052Ym5SaGFXNWxjaUF1YzJZdGJXVnVkUzFrWlhOaklDNTJaWEp6YVc5dUlIc0tJQ0FnSUhabGNuUnBZMkZzTFdGc2FXZHVPaUIwYjNBN0NpQWdJQ0JrYVhOd2JHRjVPaUJwYm14cGJtVXRZbXh2WTJzN0NpQWdJQ0JtYkc5aGREb2djbWxuYUhRN0NpQWdJQ0J0WVhKbmFXNHRjbWxuYUhRNklDMHpNSEI0T3dvZ0lDQWdkMmxrZEdnNklERXhNSEI0T3dwOUNpNXpaaTF0Wlc1MUxXTnZiblJoYVc1bGNpQXVjMll0YldWdWRTMWtaWE5qSUM1MlpYSnphVzl1SUQ0Z2MzQmhiaXdLTG5ObUxXMWxiblV0WTI5dWRHRnBibVZ5SUM1elppMXRaVzUxTFdSbGMyTWdMblpsY25OcGIyNGdQaUJoSUhzS0lDQWdJR1JwYzNCc1lYazZJR0pzYjJOck93cDlDaTV6WmkxdFpXNTFMV052Ym5SaGFXNWxjaUF1YzJZdGJXVnVkUzFrWlhOaklDNXBZMjl1SUhCaGRHZ2dld29nSUNBZ1ptbHNiRG9nSTJOalkyTmpZeUFoYVcxd2IzSjBZVzUwT3dwOUNpNXpaaTF0Wlc1MUxXTnZiblJoYVc1bGNpQXVjMll0YldWdWRTMWtaWE5qSUM1MGFYUnNaU0I3Q2lBZ0lDQm1iMjUwTFhOcGVtVTZJREl3Y0hnN0NpQWdJQ0JzYVc1bExXaGxhV2RvZERvZ01TNHlPd29nSUNBZ1ptOXVkQzEzWldsbmFIUTZJRzV2Y20xaGJEc0tJQ0FnSUcxaGNtZHBiaTEwYjNBNklERTBjSGc3Q2lBZ0lDQnRZWEpuYVc0dFltOTBkRzl0T2lBeE5uQjRPd3A5Q2k1elppMXRaVzUxTFdOdmJuUmhhVzVsY2lBdWMyWXRiV1Z1ZFMxa1pYTmpJQzV0YjNKbElIc0tJQ0FnSUhCdmMybDBhVzl1T2lCaFluTnZiSFYwWlRzS0lDQWdJR0p2ZEhSdmJUb2dOREJ3ZURzS2ZRb3VjMll0YldWdWRTMWpiMjUwWVdsdVpYSWdMbk5tTFcxbGJuVXRiR2x6ZENCN0NpQWdJQ0JvWldsbmFIUTZJRE0wT0hCNE93b2dJQ0FnZDJsa2RHZzZJREkwTTNCNE93b2dJQ0FnWm05dWRDMXphWHBsT2lBeE5IQjRPd29nSUNBZ2NHRmtaR2x1WnpvZ01UUndlQ0EyY0hnN0NpQWdJQ0JpYjNKa1pYSXRiR1ZtZERvZ01YQjRJSE52Ykdsa0lDTkVPRVE0UkRnN0NuMEtMbk5tTFcxbGJuVXRZMjl1ZEdGcGJtVnlJQzV6WmkxdFpXNTFMV3hwYzNRZ0xuTmxjR0Z5WVhSdmNpQjdDaUFnSUNCaWIzSmtaWEl0ZEc5d09pQXhjSGdnYzI5c2FXUWdJMFE0UkRoRU9Ec0tJQ0FnSUcxaGNtZHBiaTEwYjNBNklERXdjSGc3Q2lBZ0lDQnRZWEpuYVc0dFltOTBkRzl0T2lBNWNIZzdDaUFnSUNCdFlYSm5hVzR0YkdWbWREb2dOVGx3ZURzS2ZRb3VjMll0YldWdWRTMWpiMjUwWVdsdVpYSWdMbk5tTFcxbGJuVXRiR2x6ZENBdWFYUmxiU0I3Q2lBZ0lDQm9aV2xuYUhRNklEUXdjSGc3Q2lBZ0lDQmpkWEp6YjNJNklIQnZhVzUwWlhJN0NpQWdJQ0JpYjNKa1pYSXRjbUZrYVhWek9pQTFjSGc3Q2lBZ0lDQnRZWEpuYVc0dGRHOXdPaUF0TW5CNE93b2dJQ0FnYldGeVoybHVMV0p2ZEhSdmJUb2dMVEp3ZURzS0lDQWdJRzkyWlhKbWJHOTNPaUJvYVdSa1pXNDdDaUFnSUNCa2FYTndiR0Y1T2lCaWJHOWphenNLZlFvS0xuTm1MVzFsYm5VdFkyOXVkR0ZwYm1WeUlDNXpaaTF0Wlc1MUxXeHBjM1FnTG1sMFpXMGdMbWxqYjI0Z2V3b2dJQ0FnYldGeVoybHVPaUF3T3dvZ0lDQWdiV0Z5WjJsdUxXeGxablE2SURFNGNIZzdDaUFnSUNCM2FXUjBhRG9nTWpSd2VEc0tJQ0FnSUdobGFXZG9kRG9nTWpSd2VEc0tJQ0FnSUcxaGNtZHBiaTFpYjNSMGIyMDZJRGh3ZURzS0lDQWdJRzFoY21kcGJpMTBiM0E2SURod2VEc0tJQ0FnSUdac2IyRjBPaUJzWldaME93b2dJQ0FnWkdsemNHeGhlVG9nWW14dlkyczdDaUFnSUNCd1lXUmthVzVuT2lBd093cDlDaTV6WmkxdFpXNTFMV052Ym5SaGFXNWxjaUF1YzJZdGJXVnVkUzFzYVhOMElDNXBkR1Z0SUM1c1lXSmxiQ0I3Q2lBZ0lDQndZV1JrYVc1bkxXeGxablE2SURFNGNIZzdDaUFnSUNCd1lXUmthVzVuTFhKcFoyaDBPaUF4T0hCNE93b2dJQ0FnYkdsdVpTMW9aV2xuYUhRNklEUXdjSGc3Q2lBZ0lDQm1iMjUwTFhOcGVtVTZJREUwY0hnN0NpQWdJQ0IzYUdsMFpTMXpjR0ZqWlRvZ2JtOTNjbUZ3T3dvZ0lDQWdkMmxrZEdnNklERTJOWEI0T3dvZ0lDQWdaR2x6Y0d4aGVUb2dhVzVzYVc1bExXSnNiMk5yT3dvZ0lDQWdkR1Y0ZEMxdmRtVnlabXh2ZHpvZ1pXeHNhWEJ6YVhNN0NpQWdJQ0J2ZG1WeVpteHZkem9nYUdsa1pHVnVPd3A5Q2k1elppMXRaVzUxTFdOdmJuUmhhVzVsY2lBdWMyWXRiV1Z1ZFMxc2FYTjBJQzVwZEdWdElDNXNZV0psYkM1a1ltd2dld29nSUNBZ2JHbHVaUzFvWldsbmFIUTZJRzV2Y20xaGJEc0tJQ0FnSUhCaFpHUnBibWN0ZEc5d09pQXljSGc3Q2lBZ0lDQjNhR2wwWlMxemNHRmpaVG9nYm05eWJXRnNPd29nSUNBZ2FHVnBaMmgwT2lBME1IQjRPd3A5Q2k1elppMXRaVzUxTFdOdmJuUmhhVzVsY2k1dWJ5MXdiMnhzSUM1elppMXRaVzUxTFd4cGMzUWdaR2wyVzJSaGRHRXRZV04wYVc5dVBTSnZjR1Z1VUc5c2JDSmRJSHNLSUNBZ0lHUnBjM0JzWVhrNklHNXZibVU3Q24wS0xuTm1MVzFsYm5VdFkyOXVkR0ZwYm1WeUxtNXZMWEJ2Ykd3Z0xuTm1MVzFsYm5VdGJHbHpkQ0F1YVhSbGJTQXVhV052YmlCN0NpQWdJQ0J0WVhKbmFXNHRZbTkwZEc5dE9pQXhNSEI0T3dvZ0lDQWdiV0Z5WjJsdUxYUnZjRG9nTVRCd2VEc0tmUW91YzJZdGJXVnVkUzFqYjI1MFlXbHVaWEl1Ym04dGNHOXNiQ0F1YzJZdGJXVnVkUzFzYVhOMElDNXBkR1Z0SUhzS0lDQWdJR2hsYVdkb2REb2dORFJ3ZURzS2ZRb3VjMll0YldWdWRTMWpiMjUwWVdsdVpYSXVibTh0Y0c5c2JDQXVjMll0YldWdWRTMXNhWE4wSUM1cGRHVnRJQzVzWVdKbGJDQjdDaUFnSUNCc2FXNWxMV2hsYVdkb2REb2dORFJ3ZURzS2ZRb0tMbk5tTFcxbGJuVXRZMjl1ZEdGcGJtVnlJQzV6WmkxdFpXNTFMV3hwYzNRZ0xtbDBaVzA2YUc5MlpYSWdld29nSUNBZ1ltRmphMmR5YjNWdVpDMWpiMnh2Y2pvZ0l6VTVOMEU1UlRzS0lDQWdJR052Ykc5eU9pQWpabVptT3dwOUNnb3VjMll0YldWdWRTMWpiMjUwWVdsdVpYSWdMbk5tTFcxbGJuVXRiR2x6ZENBdWFYUmxiUzVwYm1GamRHbDJaU0I3Q2lBZ0lDQnZjR0ZqYVhSNU9pQXdMalU3Q2lBZ0lDQmpkWEp6YjNJNklHUmxabUYxYkhRN0NuMEtMbk5tTFcxbGJuVXRZMjl1ZEdGcGJtVnlJQzV6WmkxdFpXNTFMV3hwYzNRZ0xtbDBaVzB1YVc1aFkzUnBkbVVnTG1samIyNGdjR0YwYUNCN0NpQWdJQ0JtYVd4c09pQWpZekpqTW1NeUlDRnBiWEJ2Y25SaGJuUTdDbjBLTG5ObUxXMWxiblV0WTI5dWRHRnBibVZ5SUM1elppMXRaVzUxTFd4cGMzUWdMbWwwWlcwdWFXNWhZM1JwZG1VNmFHOTJaWElnZXdvZ0lDQWdZbUZqYTJkeWIzVnVaQzFqYjJ4dmNqb2dJMlptWmpzS0lDQWdJR052Ykc5eU9pQWpNREF3T3dwOUNpNXpaaTF0Wlc1MUxXTnZiblJoYVc1bGNpQXVjMll0YldWdWRTMXNhWE4wSUM1cFkyOXVXMlJoZEdFdGRIbHdaVDBpYzJodmQwRmliM1YwVUdGblpTSmRJSHNLSUNBZ0lIWnBjMmxpYVd4cGRIazZJR2hwWkdSbGJqc0tmUW9LTG5ObUxXMWxiblV0WTI5dWRHRnBibVZ5SUM1elppMXRaVzUxTFd4cGMzUWdMbk5DZEc0Z2V3b2dJQ0FnZEdWNGRDMWtaV052Y21GMGFXOXVPaUJ1YjI1bE93cDlDaTV6WmkxdFpXNTFMV052Ym5SaGFXNWxjaUF1YzJZdGJXVnVkUzFzYVhOMElDNXpRblJ1T21odmRtVnlJSHNLSUNBZ0lIUmxlSFF0WkdWamIzSmhkR2x2YmpvZ2JtOXVaVHNLZlFvS0xuTm1MVzFsYm5VdFkyOXVkR0ZwYm1WeUlDNXpiMk5wWVd3dFlteHZZMnNnZXdvZ0lDQWdjRzl6YVhScGIyNDZJR0ZpYzI5c2RYUmxPd29nSUNBZ1ltOTBkRzl0T2lBeU1IQjRPd29nSUNBZ2FHVnBaMmgwT2lBeE5uQjRPd29nSUNBZ1kzVnljMjl5T2lCa1pXWmhkV3gwT3dvZ0lDQWdabXhsZUMxa2FYSmxZM1JwYjI0NklHbHVhWFJwWVd3N0NuMEtMbk5tTFcxbGJuVXRZMjl1ZEdGcGJtVnlJQzV6YjJOcFlXd3RZblJ1SUhzS0lDQWdJR1JwYzNCc1lYazZJR2x1YkdsdVpTMWliRzlqYXpzS0lDQWdJSGRwWkhSb09pQXhObkI0T3dvZ0lDQWdhR1ZwWjJoME9pQXhObkI0T3dvZ0lDQWdZbUZqYTJkeWIzVnVaQzF3YjNOcGRHbHZiam9nWTJWdWRHVnlPd29nSUNBZ1ltRmphMmR5YjNWdVpDMXlaWEJsWVhRNklHNXZMWEpsY0dWaGREc0tJQ0FnSUdac2IyRjBPaUJwYm1sMGFXRnNPd29nSUNBZ2JXRnlaMmx1T2lCcGJtbDBhV0ZzT3dvZ0lDQWdjR0ZrWkdsdVp6b2dhVzVwZEdsaGJEc0tJQ0FnSUd4cGMzUXRjM1I1YkdVNklHbHVhWFJwWVd3N0NuMEtMbk5tTFcxbGJuVXRZMjl1ZEdGcGJtVnlJQzV6YjJOcFlXd3RZblJ1T21odmRtVnlJSHNLSUNBZ0lHOXdZV05wZEhrNklEQXVPRHNLZlFvdWMyWXRiV1Z1ZFMxamIyNTBZV2x1WlhJZ0xuTnZZMmxoYkMxaWRHNHVkbXNnZXdvZ0lDQWdZbUZqYTJkeWIzVnVaQzFwYldGblpUb2dkWEpzS0dSaGRHRTZhVzFoWjJVdmNHNW5PMkpoYzJVMk5DeHBWa0pQVW5jd1MwZG5iMEZCUVVGT1UxVm9SVlZuUVVGQlFrRkJRVUZCVVVOQldVRkJRVUZtT0M4NWFFRkJRVUZCV0U1VFVqQkpRWEp6TkdNMlVVRkJRVUZTYmxGVk1VSkJRVU40YW5kMk9GbFJWVUZCUVVGS1kwVm9XbU4zUVVGRWMwMUJRVUUzUkVGalpIWnhSMUZCUVVGQldXUkZWbGxrUms1MldtNVNNMWxZU214QlNFSm9ZVmMxTUV4dE5XeGtRMEV3VEdwQmRVMDBlbTFzTVVGQlFVRkhWMU5WVWtKV1JHaFFibHBFWWtzNFRtaEhUV1ptWmpCaVIxZHdTbE5UYVRKSVRXdDRRMkp2VkdzeFRXZG9hSGQwYVZreWRFNUpVMHA2WVVKbFlXRkZOalZYUlVwSmMyaDJZV2hUUzFSamJUZE5TMVZWVDJ3eEt5ODFLekp1ZGxjNWVYTllNM0pWT0M5Nk9WQnNaWFpET0hwMVdETTJlRzF1TDFGaVVHSnFNR2xuUkc1V1dqVlpVWFpXUkVOM1p6SjZTRlpyVWxGb04yOXpNVGMyUWt4T2REWldSa05ZV2xweE9VVkRhMkl6YjFweVRTOURTSFZ6YXpsNVpuVkdjRmhWYzFFMlZFNTBXWFl2TUdwMU0wdzNhMFV3TjJRMVNVNU1hVE5HVWpGWlIzcEthRGcyU2xaaWVDOW1kbEJrWmpOWmJuVlJVa3hpV0VwRWNFaHNNR3BqZFZWNGJVVjJWV3Q0VkVOR2R6azRTREZzT1RGb2VVTmFXbWxqYVd4VGJVbFphRXcxWTNCd09XUlFUMHd4TlRWdVVIYzRVbGh3T1ZVM1NrcFdhSGt4VkdoRk5uWjBXR1ZKUlZOMVRIcElMM1pGYkROcU5pc3JURGQwVURWa1kyZHBWMVpxTUVSRk5VWnFhMDF4V0VkUFowNWthMUpYZEVGM2RuRkNVMnAwT0ZWbksxTjVkMXBvUldsME0yRlBjVFJFVUdSaVJsQm9aalp0TVhvd2N5dFRlV3AxWnpCcFRtUldXbFpuV2sxTU5WRnNTRllyYjBjelNWcGxiME4xTUZOVU4xUkdaSEZXV1RWb2NXa3hkbFkxWVhwMlNGTkxlbmRwUnpWQ1RsQnRWM2xGVTFvcmVFZFVSV0pVU0RKTGVqSm9SMlphTlVaaloyMXNlWFZ2VUhoU1ozVnBaMkp3VFdGNlVXSk9TV0pQYTBOaGJsTjZiRVZuVGt4U1IzTXlSMGg2WVd0dGJXOU5kbXh4WjBGQlFVRkJSV3hHVkd0VGRWRnRRME1wT3dwOUNpNXpaaTF0Wlc1MUxXTnZiblJoYVc1bGNpQXVjMjlqYVdGc0xXSjBiaTV2YXlCN0NpQWdJQ0JpWVdOclozSnZkVzVrTFdsdFlXZGxPaUIxY213b1pHRjBZVHBwYldGblpTOXdibWM3WW1GelpUWTBMR2xXUWs5U2R6QkxSMmR2UVVGQlFVNVRWV2hGVldkQlFVRkNRVUZCUVVGUlEwRlpRVUZCUVdZNEx6bG9RVUZCUVVGWVRsTlNNRWxCY25NMFl6WlJRVUZCUVZKdVVWVXhRa0ZCUTNocWQzWTRXVkZWUVVGQlFVcGpSV2hhWTNkQlFVUnpUVUZCUVRkRVFXTmtkbkZIVVVGQlFVRlpaRVZXV1dSR1RuWmFibEl6V1ZoS2JFRklRbWhoVnpVd1RHMDFiR1JEUVRCTWFrRjFUVFI2Yld3eFFVRkJRVWxNVTFWU1FsWkVhRkJzWkVaUVlVNU9VVWhCWm5ka2VHUmhjWGhPUWxaTFVVODRZVWxuWlVKS2JEUkhhMDFDVG14M2VVazFaVTU0UWtKNVVtaFVhRFJwV0VoU1VtTjRaR3hPU25GT1QxVlJXa1F6WTFOd1VHRlVaM2hzUVRKVlNucFRNbXROYm1KYVQzVmhZa3c0WWxwd09IcFpkRll6TlhWdUwyVkNSSGxKTDNZNU5VWklhVXBZY0dKSVRWZDZlVGcyVTNveldXdHhRa1IxT0ZGVmVuaFRkRGs0WkdoNlVpOHJlUzgzVVVKVk9VdDNNMlZ4T0Vrd1F6Tk9kMjl5VEdSSWRWRjZkREJETm5oWWFDdENUbEpqYzIxMWVETndLMEphUlhWcU5GaHBUamd3YmtoNlMxTTBXRU55Y2tWdVJHdEZiSFl4TlU5RGVHOW9VWGhYVlRJek5EaG1TVU4yVEc5S2RpdElRV1Z1VDJGNU1VeEZaazQwUzJ4eU5EWkdValZSUm05bFoxQnFNa2xUYVc5UGRUVnZUR1F2Y0RoT05XVnNhVkJyTkVSd1lXTkdjMHQzY1N0U1oya3pNbTlNT1N0dFpEUkdja3RzUTJWQ1VHWmxiRU5tUjNoSU5uZFRkbU5RVVUxMVREUlRTSE5HUmpWa2FIWmFkMGcxWld4cFNraGpRelZaTldWUmVqVkNlV1Y0VG01alZuUmhLM3B4U0hsaFVXcGlWa0V6Ym1sQ1NYcDRUMHBsYkdsS04xbEJOV0Z1Um5WQldrMXlVMFpGV2xKdFRHdExZVVpYUWpsbGQwVkZaamhTV25WemRHeExZa3A0V25wa1dYbHpjREE0TmxBMVkyWldNVlpMV2pkMVUzaEdUbTlhTTJkYVZ6a3hiMHgyYVZFM1ZXRTRWbTFHVm1vdkswRjRabWhzY0ZKMlRtNURXbE50YVROa2NVcDZXWGxHV2t4UU5tVjRjV0ZDU0RKNU5qYzRZMUppVVdKUE9FTjVUVFJ0ZHpWT2F6WnpkbVUyVlZVMlVHaDFLeXMyT0VGWk5pdERlVVpHUjNaaWQyVnliR2h0U0ZVdk1rbzNUV2MxYkVGYWFYbEdNa3BSYUVsbWQyUldhMHROYlhwWVNsbHBlWFZETWs1WVZYZHBhaXQ1YkhsS1dUWlpkV2xLVUVNM05XUTBiM2wyTXk5a2FGUjBSV3h0U1hSaGRqbHJZVWsyUlUxSFYwSkNNVnBwVEZndlFYVTBRVGh6YmtNdmFYcDVRVUZCUVVGRmJFWlVhMU4xVVcxRFF5azdDbjBLTG5ObUxXMWxiblV0WTI5dWRHRnBibVZ5SUM1emIyTnBZV3d0WW5SdUxtWmlJSHNLSUNBZ0lHSmhZMnRuY205MWJtUXRhVzFoWjJVNklIVnliQ2hrWVhSaE9tbHRZV2RsTDNCdVp6dGlZWE5sTmpRc2FWWkNUMUozTUV0SFoyOUJRVUZCVGxOVmFFVlZaMEZCUVVKQlFVRkJRVkZEUVZsQlFVRkJaamd2T1doQlFVRkJRVmhPVTFJd1NVRnljelJqTmxGQlFVRkJVbTVSVlRGQ1FVRkRlR3AzZGpoWlVWVkJRVUZCU21ORmFGcGpkMEZCUkhOTlFVRkJOMFJCWTJSMmNVZFJRVUZCUVZsa1JWWlpaRVpPZGxwdVVqTlpXRXBzUVVoQ2FHRlhOVEJNYlRWc1pFTkJNRXhxUVhWTk5IcHRiREZCUVVGQlJrcFRWVkpDVmtSb1VHeFpka0pMTkU1NFIwMWxabVk0Vm0xRFZXNVVaWFIwV1haaFYzUktjRzFLYlcxS2IwOUJiRWhDTVhONVV6TkpVVEJtV1cxcVJqVndNamhGVDJ4TGVUQnRWbG95TWtkcldFNTRaRnBWVVRkTFkySTJPRkF2TVZjNWRtRXJZaTkyVlRVdlNqaHVhVGhHYjI4dmFWaExVbU50Ynl0WE1GbDZTMUowYlZObU4xWlpaRk16YXpSYWVUbGhNSEJzYnpKNFNrUkhZbEpPTXpKeU5pdENhVVJxWmtaV2VuYzVaamxpTVV4MVpXaGlUV3Q0WlZGVmFsTTFWVE5PVDBwaWVYSktSM2QyWjJ3NVRGSlFXa1pEY21aaVVGSXJPR05ZZEdjMFRGZEVMMGxSV25wS2MwVTJNbk5TVkRCR1VIaHdUbXhhU1Zoc1pHZElWRFpDTVZwbFFXSlVWRXBQZGxkTmVVUkRVMk0xVVhWeGVIQXhSSGd4UkZONk1EaDNVbFEzYjJFMFFrTldjbkUwVVRkSk4wbGpOak5tZGxFd2RFbGlXVzVKYTNWV1F5OWtZbW95TWtFck1Ua3JMMEZUU1RVd1dHdFNhbTk2V25oSE1GcDVOSFpMUkhGd1NFWjFVV3RxVDJaSGVtVXhWMnBXYzJOSGFrOVVSVlIyVDNGU2JWbG9MMGRMTW5Jd1JsQlVhWGxTS3prNUszUXlVVk4zY0RSWFZ6Wm9jVVZyVEZGamFWWjVkMlpTVHpka1duWm1OWFYzTlhka1pVNHpSSEl6TURkU1YwRkJRVUZCUWtwU1ZUVkZjbXRLWjJkblBUMHBPd3A5Q2k1elppMXRaVzUxTFdOdmJuUmhhVzVsY2lBdWMyOWphV0ZzTFdKMGJpNTBkeUI3Q2lBZ0lDQmlZV05yWjNKdmRXNWtMV2x0WVdkbE9pQjFjbXdvWkdGMFlUcHBiV0ZuWlM5d2JtYzdZbUZ6WlRZMExHbFdRazlTZHpCTFIyZHZRVUZCUVU1VFZXaEZWV2RCUVVGQ1FVRkJRVUZSUTBGWlFVRkJRV1k0THpsb1FVRkJRVUZZVGxOU01FbEJjbk0wWXpaUlFVRkJRVkp1VVZVeFFrRkJRM2hxZDNZNFdWRlZRVUZCUVVwalJXaGFZM2RCUVVSelRVRkJRVGRFUVdOa2RuRkhVVUZCUVVGWlpFVldXV1JHVG5aYWJsSXpXVmhLYkVGSVFtaGhWelV3VEcwMWJHUkRRVEJNYWtGMVRUUjZiV3d4UVVGQlFVaExVMVZTUWxaRWFGQnVaRVJRVTNoU2FFaEJZbmM1ZVN0YVdGUlhXRTFKYlZGb1FWUkthekpSUjBOU05qZERUMGRzWW5BemN6UjBiVGR4VjJsS1ltMVdTa1ZyV1dWRVJHOXpLelJPUzNkNFVYRXZTVWhHWW5VeGRYRjZTWG8yVDNwUGRuVXZUemR6TjFRck16TmtNR05YVjFsUU0wTkNPVFphT1ROdWJVaFdOVEphTVU0d1JGZDNOM0YzVFRkRWRXOXBUemxTYkM5a09UUTFkbkZIVVZCMVdGRnNNbTlSTVRFeU4xaE5RbFl4WmxCb04zRnpOMkZOUVRaV05ISnZSMUJzWlVZeWRGUTFORlZOWTNSSlkyaGxlbkZTU1VkMmVHUjNWaTlNTWpKYVZXOUNOV3hMVDA1cVRXeDBTRFZSWVdodU1HbGlPWHB3Wkhoa2NXSnFjSGhzTWs5alVrSm9kRmwwZEZocloxaEpla2xUSzNGTFEyUjZLMHBPVXpjMmFrWkdRMkl3YUZVelZVbGhNekptUWl0clRFZ3JTMEZHZVhONGQwcEZTRm92YVM5d01pOXZTRXBtWlZkaGNFUlhUWFI1U0hWVVFsZHlORk1yWmlzNGFtUnpjVGN5UlZoc01ubFJkMGR6WkV3M1lWQlZTRXhrVTNKVU1qTkpPR0ZMZFRsb1oxUmpOV1ZCV2tSU2FWWlhaVE5hVFdkalFYSXZVMUpRVjFCT1EwUndORXhNZHpBNGFrOTZhbFFyTnpCTWNuZHdiR3d6WTFkcmVXWmFSREp6WVZRMFRHTnRVRnA0Y2pCWmVDOW9XRWQ2YlRaM1lYQktXbmd6TUV4NVlsSlBSMlZ4WWtSWVYwNURZMWd3Y3pCc1F6Z3JNMDlJTlZwU1dtazRhRXBVYkVsS2VYZE5VM292Y1U5V2VFaEpNVUpSSzFoUFdXY3pVRXhDUkM5eVFVaG1Xa0Z5WVRKRk9XOXZOM1pSU0hZeVFVNXdSMEV2T0d0bFIzQTBaWEZWZDNSVVNuTTFWRkJ0UkRoblVHNVJSakp0UW1aVlpUTTNVMVk0WXpGWmNVbDJjMkZGUnprMWVTOUZRM2xPTUZWdlZYWmpVVUZCUVVGQ1NsSlZOVVZ5YTBwbloyYzlQU2s3Q24wS0xuTm1MVzFsYm5VdFkyOXVkR0ZwYm1WeUlDNXpiMk5wWVd3dFluUnVMbXhxSUhzS0lDQWdJR0poWTJ0bmNtOTFibVF0YVcxaFoyVTZJSFZ5YkNoa1lYUmhPbWx0WVdkbEwzQnVaenRpWVhObE5qUXNhVlpDVDFKM01FdEhaMjlCUVVGQlRsTlZhRVZWWjBGQlFVSkJRVUZCUVZGRFFWbEJRVUZCWmpndk9XaEJRVUZCUVZoT1UxSXdTVUZ5Y3pSak5sRkJRVUZCVW01UlZURkNRVUZEZUdwM2RqaFpVVlZCUVVGQlNtTkZhRnBqZDBGQlJITk5RVUZCTjBSQlkyUjJjVWRSUVVGQlFWbGtSVlpaWkVaT2RscHVVak5aV0Vwc1FVaENhR0ZYTlRCTWJUVnNaRU5CTUV4cVFYVk5OSHB0YkRGQlFVRkJSalJUVlZKQ1ZrUm9VRmt2YWk4dmVqaEVaekJIV1V0SmRIVXJiRWx0TDJKUkwySkJXVm92Tlc0d01EZGplbUZUVWt0blQxRkpXVkZoVVZGeFJFY3llRFZsZUdZdk4ydHRkaTlVTUdsd0wyVXZjMVptTm1aVFUyWnFRbXBIUjAxQlFURmlMMUZGWVdkYWNFeEZNM1lyTWl0WWRTODFMMVZOVDJVdmVEZGFUVFJyZVVKSFZFRklOVVJPV21WdE9TOTVNWHBPTHpBdlpYVlZiRlZRZWk4dmVYUXpXQzk0V0VOMWQycGhRV2RFYXpBM1lYcDRObWRCVVRZMVlTODVkakpJTHpFdkwzTlFTQzh2V0V4NmNqTXpOekV5THk4dk9GSm1aaXNyT1ZaMWVHMXpTVUUwZEU5NGJuYzNPVGxNTHpkMVYySXZOVGcxWXl0YUx6bHpVMFF2TVRCeFpDOHlabU5sVERNdk5XdHVMelJKZUZCclRWbEhSRmhFWlVsRGFHWnpkelJ5VDFndmFrdFhZaTh4YzFnM1VHaDJhMkoyTldZd2FqZEpZVWxOUVZKTmQxRjRWRGxQTHpnM2JFRkdaRlZJTUZOaVJXaHZlREpIUTJoelFrNW5hSE5UVDBKV2MwRkdOVVE1UkV3eVdXaG9RV2xwUlU5bFZYWXZjeXRvYkVGTVYyZEhVVVJEV1VWT01EQm5LMnBISzBwWmRYWlhMMU5tYjJGUFRWcHdRVUZvYWsxM1UyczJaaXRHUzFoRFRURjNRVkZTYW1WRldrRk9RVWRIVVVscE0ySkhTRVJ0TDJsVFowZFVUM2h4UVdoelFXbG5Nbk5IZEVWNFUwUkZNa1JOY1RGWFJGVlJkMmxEWW0xWVVYcGtha1p4ZUhGdlFVRktWRmRrUlhGeU5TdGpVVUZCUVVGQlJXeEdWR3RUZFZGdFEwTXBPd3A5Q2k1elppMXRaVzUxTFdOdmJuUmhhVzVsY2lBdWMyOWphV0ZzTFdKMGJpNXRZV2xzY25VZ2V3b2dJQ0FnWW1GamEyZHliM1Z1WkMxcGJXRm5aVG9nZFhKc0tHUmhkR0U2YVcxaFoyVXZjRzVuTzJKaGMyVTJOQ3hwVmtKUFVuY3dTMGRuYjBGQlFVRk9VMVZvUlZWblFVRkJRa0ZCUVVGQlVVTkJXVUZCUVVGbU9DODVhRUZCUVVGQldFNVRVakJKUVhKek5HTTJVVUZCUVVGU2JsRlZNVUpCUVVONGFuZDJPRmxSVlVGQlFVRktZMFZvV21OM1FVRkVjMDFCUVVFM1JFRmpaSFp4UjFGQlFVRkJXV1JGVmxsa1JrNTJXbTVTTTFsWVNteEJTRUpvWVZjMU1FeHROV3hrUTBFd1RHcEJkVTAwZW0xc01VRkJRVUZMU1ZOVlVrSldSR2hRYkdSS1lsTktUbWhJUVdKM09TOTJiVmxWVkdsU1dGRllhR3BvYmpOa2FIbGliRkI0VEV4dFdrVTJXVzlQZW1ka1ZUVm1WR1ZhYWxwMFEyNWFXVlYyVTFwYWRGVlhUMjVKWlZOeGFuTnBRVWwxYVdkTU5sbENXRmhWVkZGVVZHVlhaVVpPTUhkTGFXSndMMlE1V0ZwS01UVmpWVkIwZGk4M1VGQXZNeXM1YVVsM2NqbFpiMFI1ZWpsRmNuQm1ORFYwYjFJelYwcFlUSFpyT1ZkRmJHOWxVVTVFZWxsR2RGcG9XRk5LZEhWQkswcGlWMFZNYWxoelJYZFhSV3BZYnpadU5EaFhNVUYzWjAxdFdraGFSMlozZG5nM2NFVlpjRE5JU0hwMGREQTNaMVpMYzBkMmJYZFVVSGgwU1hobFRuRkJSVlk0UmpOdlZETTRkR3hOYzBKUk56WnRZek00ZDNsU2JVdGlRbmhLYzI0NFpXbDVSMmwxVWxKRGFuRnFhVWhXWldkTGJVeHBaRXRZVGpKUlIyZE1VVTV5Wm1jd05IbEphR1JGT0hoS2FXNWxTV05vV1c1VldWUkZUbEJOTnpsR1duVndSbXM0WlVJNVVuTkZZbmxtTWpoSlYzWjRNbFpaUTBkaVJETnRTR2h0VVhBelRpczRkMUpFVTAxblZtMHJTV3RRYTJKQk5GVTVialJsUzNKWk0xRlVlbXRSTlhwMVJrczNOamgyYTNOeVlsbG1aSGROV25WSVRTdHBNMk5aU1hWd1JGbE9ZbTVEUjNkMVJUUmFVRWh6WW1saFFuSkZjMmxGSzBZdlZrSktSbFkxT0VjeVYxRkhOM0JuTjJSSWFqZFhjSFZQYUZwcFF6ZFJNRk5FTVd4UlluTmlVMWxOT1hCV2RVeEphazl0WlZOaE5DOW9UMHcxUVdKUVprSTFkR1puTkV0a01EaEpLM2Q0YldObGFGWk9kMlY2YjBNNGMyaFZMelpsVDFkT1ZGaDVaVlZNTlVGUFlsQnhabWR5TjB0ME1sa3JiV2xFU0ZBclJFZzNSMFZNUmpSQlNYbG9kbkJ4U0RocGVVNUxTeXQwZDJ4dmEwSjFPRzFrYlUweFJXOHJibTk1YmpSalJqSkxaWGRGUm5vclVXSnlZbnBFUlV4SVFVTXdZa2szVlZvME5FTkRMM1pqTlZKcFpqRnNWbTFvVGxaa1FWbHFUbWhXTmtWQ1pscDVTR1ZvZUZCU01WWnZSVWxqTDBSUGQzZFNZeXR0V0V0RlNHUkRkaTlTWWxCNVoxQXJTRzVoWm5CdWIycGpkbGd3Y2tOc2VHMURSa3N3WkZGMVdWSkRSbTUwYlROdFIwTkViR1F5UlV4c1VraExVa1ZaTjBkRmIxSTJWbUpxVVc4d1MwNVNXWFkwTTFCaGRIVlRaMmx4VG5SWGFFdDNUM1YyYTNadGFtRXJVMFpCTms1eVJGQXZNbGxaTW1sWGVFZHhaRTk1U0ZOMFEyMXZXRWhYZDBRM1kxSnhia3h5WmxkRlVWQkRkelphSzFkalFVRkJRVUZUVlZaUFVrczFRMWxKU1QwcE93cDlDaTV6WmkxdFpXNTFMV052Ym5SaGFXNWxjaUF1YzI5amFXRnNMV0owYmk1bmNDQjdDaUFnSUNCaVlXTnJaM0p2ZFc1a0xXbHRZV2RsT2lCMWNtd29aR0YwWVRwcGJXRm5aUzl3Ym1jN1ltRnpaVFkwTEdsV1FrOVNkekJMUjJkdlFVRkJRVTVUVldoRlZXZEJRVUZDUVVGQlFVRlJRMEZaUVVGQlFXWTRMemxvUVVGQlFVRllUbE5TTUVsQmNuTTBZelpSUVVGQlFWSnVVVlV4UWtGQlEzaHFkM1k0V1ZGVlFVRkJRVXBqUldoYVkzZEJRVVJ6VFVGQlFUZEVRV05rZG5GSFVVRkJRVUZaWkVWV1dXUkdUblphYmxJeldWaEtiRUZJUW1oaFZ6VXdURzAxYkdSRFFUQk1ha0YxVFRSNmJXd3hRVUZCUVVsbVUxVlNRbFpFYUZCc1pFd3ZVM2hPYUVoQlpuYzFOQ3RTY1Zrd1kyc3lRMVUzVDFwTk1tSnRLMHhMVG1sRlUyaE9lVzloZUc5blZFcDJiMEZYVmtGWlNrSlZXRGxGUWxKU1JXOXhiRmswY1dFeGEzSmtjRmQ2VDNWV1Z6SnNiSFpNVlRKMWNrOVlWbTB5WW5VM1FqZDRNbmxSYjJabFFqTlFOUzh6ZHl0bVJHTmpWMVI1VTNCVmRXTjBXRWREWWtKUGJrNW9URkZuTUVncldXdGhSVGszV1VSUGMyazViMms1TlU4emNDOWFhQ3N5YnpVelZHTm1kemhtUldSTVNDdE9VVlo1Y0RaVkswbGxNWGxKZEU0MlJYWTNjRVZyY0hKc2NGZ3pRVlpuY25sWmVVZEtkMGt3ZWpoQ2VsTlpPV3BEV1UxRE1rTTBkWGg2TldwdWJ5dERUMkp6WlVsclNURldSbFZ1UlZCTU1HMHpOVTU2WlVaWGFHaGhaWGxyU0VsTVJHVk9NM0k1Um1KNlRIcHZiSFpLVm5saGJVbHlRMkpNT0ROTldVVlJZV3RqTVcxT1pFVkJhUzlDTnlzNE5HWndVSFJOYVRSdFVEaG5hRmQxUVRGemEyNUhWWEpRV25oNVQyWklVM0pGU0dKRWNsVnJSVkUzU21GcWIyYzNiazVxTUV4M1drRXZjekJzVEN0NFJtb3JXR3gxUTNOTFdtVjVWbGxzZDFWR1lWUjNZMWsyY0U5S1prVklUVkJaWmxOVlFtSTNObUZ6ZUhsNk9VWjZiMmRMT1hCdWR6UmtNaXRUSzJaYWFGRnNXVlIxZWtWUU9UUjFWalpEZUc1RlltaGxWRFk0S3pGSVFXTllaSFJWTms0cmNGaDFUbWhwVmtwWGF6RTJha054UzNVd2FuZzBiVGczVWtGVVNHaHNabkpNVGtSVUwwZzVTbXBXVFU0M09XZHBRM1I1T1doemNVMWFkakZhVnpaS1FtczRSRmRsTjFkWVVXSmthalJVTWxGNFIzTmhiemhPUm1FeVNIcGpXWGhUTkZaaGFFVllOVEJXUzJWR2JsZHZhVVV3Um1SWFowMDNhVVJTYTFKU0sxVmxVRTVCY1RCTFNGQm9ZVTF2UmpOYVFuTjZXV0p5VjFsRWRsa3pkalJyYldGYU1FbGxSbGRTUmpkaWNITXZTekZHUjBSeWFraFpZbTVqZFRKaGMzb3JlVzl6VkVKeGRHZ3lVbk5GVEd0Tk5uVjVOa2d2TDFKTlZFazRkbFE0UnpNMlNGQlpNMWRHUzJsQlptZFNOVGc0UVVGQlFVRlRWVlpQVWtzMVExbEpTVDBwT3dwOUNnb3VjMll0YldWdWRTMWpiMjUwWVdsdVpYSWdMbk5tTFdOb1pXTnJZbTk0SUhzS0lDQWdJR1pzYjJGME9pQnNaV1owT3dvZ0lDQWdaR2x6Y0d4aGVUb2dZbXh2WTJzN0Nnb2dJQ0FnY0dGa1pHbHVaeTEwYjNBNklERXljSGc3Q2lBZ0lDQndZV1JrYVc1bkxXeGxablE2SURFMmNIZzdDaUFnSUNCd1lXUmthVzVuTFdKdmRIUnZiVG9nTVRKd2VEc0tDaUFnSUNBdGQyVmlhMmwwTFhWelpYSXRjMlZzWldOME9pQnViMjVsT3dvZ0lDQWdMVzF2ZWkxMWMyVnlMWE5sYkdWamREb2dibTl1WlRzS0lDQWdJSFZ6WlhJdGMyVnNaV04wT2lCdWIyNWxPd3A5Q2dvdWMyWXRiV1Z1ZFMxamIyNTBZV2x1WlhJdWJtOHRjRzlzYkNBdWMyWXRZMmhsWTJ0aWIzZ2dld29nSUNBZ2NHRmtaR2x1WnkxMGIzQTZJREUwY0hnN0NuMEtDaTV6WmkxdFpXNTFMV052Ym5SaGFXNWxjaUF1YzJZdFkyaGxZMnRpYjNnZ1BpQnBJSHNLSUNBZ0lIZHBaSFJvT2lBeU5IQjRPd29nSUNBZ2FHVnBaMmgwT2lBeE5IQjRPd29nSUNBZ1pHbHpjR3hoZVRvZ1lteHZZMnM3Q2lBZ0lDQndZV1JrYVc1bk9pQXdPd29LSUNBZ0lHSnZjbVJsY2kxM2FXUjBhRG9nTVhCNE93b2dJQ0FnWW05eVpHVnlMWE4wZVd4bE9pQnpiMnhwWkRzS0lDQWdJR0p2Y21SbGNpMXlZV1JwZFhNNklEaHdlRHNLSUNBZ0lIQnZjMmwwYVc5dU9pQnlaV3hoZEdsMlpUc0tDaUFnSUNCaWIzSmtaWEl0WTI5c2IzSTZJQ00zT0VNME16VTdDaUFnSUNCaVlXTnJaM0p2ZFc1a0xXTnZiRzl5T2lBak56aERORE0xT3dwOUNpNXpaaTF0Wlc1MUxXTnZiblJoYVc1bGNpQXVjMll0WTJobFkydGliM2dnUGlCcElENGdhU0I3Q2lBZ0lDQmthWE53YkdGNU9pQmliRzlqYXpzS0lDQWdJR0poWTJ0bmNtOTFibVF0WTI5c2IzSTZJQ05tWm1ZN0NpQWdJQ0JpYjNKa1pYSXRkMmxrZEdnNklERndlRHNLSUNBZ0lHSnZjbVJsY2kxemRIbHNaVG9nYzI5c2FXUTdDaUFnSUNCaWIzSmtaWEl0Y21Ga2FYVnpPaUE0Y0hnN0Nnb2dJQ0FnYUdWcFoyaDBPaUF4TW5CNE93b2dJQ0FnZDJsa2RHZzZJREV5Y0hnN0NpQWdJQ0JpYjNKa1pYSXRZMjlzYjNJNklDTTNPRU0wTXpVN0NpQWdJQ0J0WVhKbmFXNHRiR1ZtZERvZ01UQndlRHNLZlFvdWMyWXRiV1Z1ZFMxamIyNTBZV2x1WlhJZ0xuTm1MV05vWldOclltOTRMbk5tTFhSeVlXNXphWFJwYjI0Z1BpQnBJRDRnYVNCN0NpQWdJQ0IwY21GdWMybDBhVzl1T2lCdFlYSm5hVzR0YkdWbWRDQXdMakp6T3dvZ0lDQWdMVzh0ZEhKaGJuTnBkR2x2YmpvZ2JtOXVaVHNLZlFvdWMyWXRiV1Z1ZFMxamIyNTBZV2x1WlhJZ0xtbHVZV04wYVhabElDNXpaaTFqYUdWamEySnZlRHB1YjNRb0xtVnVZV0pzWlVadmNtTmxLU0ErSUdrc0NpNXpaaTF0Wlc1MUxXTnZiblJoYVc1bGNpQXVjMll0WTJobFkydGliM2d1WkdsellXSnNaV1FnUGlCcElIc0tJQ0FnSUdKdmNtUmxjaTFqYjJ4dmNqb2dJMEpGTTBZeVJUc0tJQ0FnSUdKaFkydG5jbTkxYm1RdFkyOXNiM0k2SUNObVptWTdDbjBLTG5ObUxXMWxiblV0WTI5dWRHRnBibVZ5SUM1cGJtRmpkR2wyWlNBdWMyWXRZMmhsWTJ0aWIzZzZibTkwS0M1bGJtRmliR1ZHYjNKalpTa2dQaUJwSUQ0Z2FTd0tMbk5tTFcxbGJuVXRZMjl1ZEdGcGJtVnlJQzV6WmkxamFHVmphMkp2ZUM1a2FYTmhZbXhsWkNBK0lHa2dQaUJwSUhzS0lDQWdJR2hsYVdkb2REb2dNVFJ3ZURzS0lDQWdJSGRwWkhSb09pQXhOSEI0T3dvZ0lDQWdZbTl5WkdWeUxXTnZiRzl5T2lBalFrVXpSakpGT3dvZ0lDQWdiV0Z5WjJsdU9pQXRNWEI0T3dwOUNqd3ZjM1I1YkdVK0NqeGthWFlnWTJ4aGMzTTlJbk5tTFcxbGJuVXRaR1Z6WXlJK0NpQWdJQ0FnSUNBZ1BHUnBkaUJqYkdGemN6MGlhV052YmkxaWIyUjVJajRLSUNBZ0lDQWdJQ0FnSUNBZ1BHUnBkaUJqYkdGemN6MGlhV052YmlJK1BDOWthWFkrQ2lBZ0lDQWdJQ0FnSUNBZ0lEeGthWFlnWTJ4aGMzTTlJblpsY25OcGIyNGlQand2WkdsMlBnb2dJQ0FnSUNBZ0lEd3ZaR2wyUGdvZ0lDQWdJQ0FnSUR4a2FYWWdZMnhoYzNNOUluUnBkR3hsSWo0OEwyUnBkajRLSUNBZ0lDQWdJQ0E4WkdsMklHTnNZWE56UFNKa1pYTmpJajQ4TDJScGRqNEtJQ0FnSUNBZ0lDQThZU0JvY21WbVBTSWpJaUJqYkdGemN6MGliVzl5WlNJZ2RHRnlaMlYwUFNKZllteGhibXNpSUdSaGRHRXRhVEU0YmowaWNtVmhaRTF2Y21VaVBreGxZWEp1SUUxdmNtVThMMkUrQ2lBZ0lDQWdJQ0FnUEdScGRpQmpiR0Z6Y3owaWMyOWphV0ZzTFdKc2IyTnJJajRLSUNBZ0lDQWdJQ0FnSUNBZ1BHRWdhSEpsWmowaUl5SWdZMnhoYzNNOUluTnZZMmxoYkMxaWRHNGdkbXNpSUhSaGNtZGxkRDBpWDJKc1lXNXJJajQ4TDJFK0NpQWdJQ0FnSUNBZ0lDQWdJRHhoSUdoeVpXWTlJaU1pSUdOc1lYTnpQU0p6YjJOcFlXd3RZblJ1SUdaaUlpQjBZWEpuWlhROUlsOWliR0Z1YXlJK1BDOWhQZ29nSUNBZ0lDQWdJQ0FnSUNBOFlTQm9jbVZtUFNJaklpQmpiR0Z6Y3owaWMyOWphV0ZzTFdKMGJpQnZheUlnZEdGeVoyVjBQU0pmWW14aGJtc2lQand2WVQ0S0lDQWdJQ0FnSUNBZ0lDQWdQR0VnYUhKbFpqMGlJeUlnWTJ4aGMzTTlJbk52WTJsaGJDMWlkRzRnZEhjaUlIUmhjbWRsZEQwaVgySnNZVzVySWo0OEwyRStDaUFnSUNBZ0lDQWdJQ0FnSUR4aElHaHlaV1k5SWlNaUlHTnNZWE56UFNKemIyTnBZV3d0WW5SdUlHMWhhV3h5ZFNJZ2RHRnlaMlYwUFNKZllteGhibXNpUGp3dllUNEtJQ0FnSUNBZ0lDQWdJQ0FnUEdFZ2FISmxaajBpSXlJZ1kyeGhjM005SW5OdlkybGhiQzFpZEc0Z2JHb2lJSFJoY21kbGREMGlYMkpzWVc1cklqNDhMMkUrQ2lBZ0lDQWdJQ0FnSUNBZ0lEeGhJR2h5WldZOUlpTWlJR05zWVhOelBTSnpiMk5wWVd3dFluUnVJR2R3SWlCMFlYSm5aWFE5SWw5aWJHRnVheUkrUEM5aFBnb2dJQ0FnSUNBZ0lEd3ZaR2wyUGdvZ0lDQWdQQzlrYVhZK0NpQWdJQ0E4WkdsMklHTnNZWE56UFNKelppMXRaVzUxTFd4cGMzUWlQZ29nSUNBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW1sMFpXMGdZbTl2YTIxaGNtdHNaWFFpSUdSaGRHRXRZV04wYVc5dVBTSmtiM2R1Ykc5aFpFWnliMjFEZFhKeVpXNTBVR0ZuWlNJK0NpQWdJQ0FnSUNBZ0lDQWdJRHh6ZG1jZ1kyeGhjM005SW1samIyNGlJR1JoZEdFdGRIbHdaVDBpWkc5M2JteHZZV1JHY205dFEzVnljbVZ1ZEZCaFoyVWlJSGRwWkhSb1BTSXlOSEI0SWlCb1pXbG5hSFE5SWpJd2NIZ2lJSFpwWlhkQ2IzZzlJakFnTUNBeU5DQXlNQ0lnZG1WeWMybHZiajBpTVM0eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWo0S0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR4d1lYUm9JR1E5SWswekxEY3VOamsyT0RFME16VWdURE1zTVRVdU16Z3dNVEE0TnlCRE15d3hOaTR5TXpJeU5qWTFJRE11Tmpnek5EazJOVGtzTVRZdU9USXpNRGMyT1NBMExqUTVNekE1TmpNMUxERTJMamt5TXpBM05qa2dUREUyTGpVd05qa3dNellzTVRZdU9USXpNRGMyT1NCRE1UY3VNek13TURrMk1pd3hOaTQ1TWpNd056WTVJREUzTGprNU56WTVORE1zTVRZdU1qVXhOek0wTkNBeE55NDVPVGs1T1RRc01UVXVNemcwTmpFMU5DQk1NVGt1TlN3eE5TNHpPRFEyTVRVMElFd3hPUzQxTERFekxqZzBOakUxTXpnZ1RESXhMREV6TGpnME5qRTFNemdnVERJeExERTJMamt6TlRNMU9EUWdRekl4TERFNExqWXhOVEV4TXpZZ01Ua3VOalV5T1RFNU55d3lNQ0F4Tnk0NU9URXlNVElzTWpBZ1RETXVNREE0TnpnM09Ua3NNakFnUXpFdU16UTFOVGt3TVRrc01qQWdNQ3d4T0M0Mk1qYzVNVE15SURBc01UWXVPVE0xTXpVNE5DQk1NQ3cyTGpFME1UVTJORFkwSUVNd0xEUXVORFl4T0RBNU5Ea2dNUzR6TkRjd09EQXlOeXd6TGpBM05qa3lNekE0SURNdU1EQTROemczT1Rrc015NHdOelk1TWpNd09DQk1PU3d6TGpBM05qa3lNekE0SUV3NUxEUXVOakUxTXpnME5qSWdURGN1TlN3MExqWXhOVE00TkRZeUlFdzNMalVzTmk0eE5UTTRORFl4TlNCTU5DNDBPVE13T1RZek5TdzJMakUxTXpnME5qRTFJRU16TGpZMk9EUTRNakF4TERZdU1UVXpPRFEyTVRVZ015dzJMamd5TnpVd09UYzNJRE1zTnk0Mk9UWTRNVFF6TlNCYUlFMHhOaTQxTERRdU5qTXpPRGc1TnpVZ1RERTJMalVzTUNCTU1qUXNOaTQ1TWpNd056WTVNaUJNTVRZdU5Td3hNeTQ0TkRZeE5UTTRJRXd4Tmk0MUxEa3VNalExT1RBNU56a2dRekV4TGpNNU5ETTROVE1zT1M0ME5USTNNVGs0TkNBM0xqSXhPVEV6TURneUxERXhMamMxTlRVek5UWWdOaTR5TWpVd05EQTNNeXd4TkM0M05qa3lNekE0SUVNMkxqQTNOelEyT0RBM0xERTBMakl5TWpReU9UTWdOaXd4TXk0Mk5UWTBPREEzSURZc01UTXVNRGMyT1RJek1TQkROaXc0TGpVNU16STVOakUySURFd0xqWXpOalE0TVRJc05DNDVNalF4TmpRM09TQXhOaTQxTERRdU5qTXpPRGc1TnpVZ1dpSWdhV1E5SWxOb1lYSmxJaUJtYVd4c1BTSWpNREF3TURBd0lqNDhMM0JoZEdnK0NpQWdJQ0FnSUNBZ0lDQWdJRHd2YzNablBnb2dJQ0FnSUNBZ0lDQWdJQ0E4YzNCaGJpQmpiR0Z6Y3owaWJHRmlaV3dpSUdSaGRHRXRhVEU0YmowaVpHOTNibXh2WVdSR2NtOXRRM1Z5Y21WdWRGQmhaMlVpUGtkdklIUnZJRk5oZG1WR2NtOXRMbTVsZER3dmMzQmhiajRLSUNBZ0lDQWdJQ0E4TDJScGRqNEtJQ0FnSUNBZ0lDQThaR2wySUdOc1lYTnpQU0ppYjI5cmJXRnlhMnhsZENCelpYQmhjbUYwYjNJaVBqd3ZaR2wyUGdvZ0lDQWdJQ0FnSUR4a2FYWWdZMnhoYzNNOUltbDBaVzBnYlc5a2RXeGxJSFpySUc5a2JtOXJiR0Z6YzI1cGEya2dabUZqWldKdmIyc2diRzBnZVc5MWRIVmlaU0JrWVdsc2VXMXZkR2x2YmlCcGJuTjBZV2R5WVcwZ2NuVjBkV0psSWlCa1lYUmhMV0ZqZEdsdmJqMGlkWEJrWVhSbFRHbHVhM01pUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjM1puSUdOc1lYTnpQU0pwWTI5dUlpQmtZWFJoTFhSNWNHVTlJblZ3WkdGMFpVeHBibXR6SWlCM2FXUjBhRDBpTWpKd2VDSWdhR1ZwWjJoMFBTSXlOSEI0SWlCMmFXVjNRbTk0UFNJd0lEQWdNaklnTWpRaUlIWmxjbk5wYjI0OUlqRXVNU0lnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUI0Yld4dWN6cDRiR2x1YXowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YkdsdWF5SStDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQThjR0YwYUNCa1BTSk5NakV1TWpNd056WTVNaXd4TXk0M01UUXlPRFUzSUVNeU1TNHlNekEzTmpreUxERTVMak01TkRreU9URWdNVFl1TkRjNE1EazVPU3d5TkNBeE1DNDJNVFV6T0RRMkxESTBJRU0wTGpjMU1qWTJPVEk1TERJMElEQXNNVGt1TXprME9USTVNU0F3TERFekxqY3hOREk0TlRjZ1F6QXNPQzR3TXpNMk5ESXlPU0EwTGpjMU1qWTJPVEk1TERNdU5ESTROVGN4TkRNZ01UQXVOakUxTXpnME5pd3pMalF5T0RVM01UUXpJRXd4TUM0Mk1UVXpPRFEyTERZdU9EVTNNVFF5T0RZZ1F6WXVOekEyT1RBM056TXNOaTQ0TlRjeE5ESTROaUF6TGpVek9EUTJNVFUwTERrdU9USTNNVGt3TVNBekxqVXpPRFEyTVRVMExERXpMamN4TkRJNE5UY2dRek11TlRNNE5EWXhOVFFzTVRjdU5UQXhNemd4TXlBMkxqY3dOamt3TnpjekxESXdMalUzTVRReU9EWWdNVEF1TmpFMU16ZzBOaXd5TUM0MU56RTBNamcySUVNeE5DNDFNak00TmpFMUxESXdMalUzTVRReU9EWWdNVGN1TmpreU16QTNOeXd4Tnk0MU1ERXpPREV6SURFM0xqWTVNak13Tnpjc01UTXVOekUwTWpnMU55Qk1NakV1TWpNd056WTVNaXd4TXk0M01UUXlPRFUzSUV3eU1TNHlNekEzTmpreUxERXpMamN4TkRJNE5UY2dXaUJOTVRBdU5qRTFNemcwTml3eE1DNHlPRFUzTVRReklFd3hNQzQyTVRVek9EUTJMREFnVERFNUxqUTJNVFV6T0RVc05TNHhOREk0TlRjeE5DQk1NVEF1TmpFMU16ZzBOaXd4TUM0eU9EVTNNVFF6SUZvaUlHbGtQU0pTWldaeVpYTm9JaUJtYVd4c1BTSWpNREF3TURBd0lqNDhMM0JoZEdnK0NpQWdJQ0FnSUNBZ0lDQWdJRHd2YzNablBnb2dJQ0FnSUNBZ0lDQWdJQ0E4YzNCaGJpQmpiR0Z6Y3owaWJHRmlaV3dpSUdSaGRHRXRhVEU0YmowaWRYQmtZWFJsVEdsdWEzTWlQbEpsWm5KbGMyZ2diR2x1YTNNOEwzTndZVzQrQ2lBZ0lDQWdJQ0FnUEM5a2FYWStDaUFnSUNBZ0lDQWdQR1JwZGlCamJHRnpjejBpYVhSbGJTQnRiMlIxYkdVZ2Rtc2diMlJ1YjJ0c1lYTnpibWxyYVNCdFlXbHNjblVpSUdSaGRHRXRZV04wYVc5dVBTSmtiM2R1Ykc5aFpFMVFNMFpwYkdWeklqNEtJQ0FnSUNBZ0lDQWdJQ0FnUEhOMlp5QmpiR0Z6Y3owaWFXTnZiaUlnWkdGMFlTMTBlWEJsUFNKa2IzZHViRzloWkUxUU0wWnBiR1Z6SWlCM2FXUjBhRDBpTWpGd2VDSWdhR1ZwWjJoMFBTSXlOSEI0SWlCMmFXVjNRbTk0UFNJd0lEQWdNakVnTWpRaUlIWmxjbk5wYjI0OUlqRXVNU0lnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUI0Yld4dWN6cDRiR2x1YXowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YkdsdWF5SStDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQThjR0YwYUNCa1BTSk5NakVzTWk0M05qa3lNekEzTnlCTU1qRXNNVGN1TmpRNE56STRPQ0JETWpFc01UY3VOalE0TnpJNE9DQXlNU3d4Tnk0Mk5EZzNNamc0SURJeExERTNMalkwT0RjeU9EZ2dUREl4TERFNExqUTJNVFV6T0RVZ1RESXdMamt3TmpnM01qa3NNVGd1TkRZeE5UTTROU0JETWpBdU56SXpOVGsxTERFNUxqSTNNVEl5TkRrZ01qQXVNamN4TmpBeE15d3lNQzR3T0RZMU56a3hJREU1TGpVMk5qa3lPVFlzTWpBdU56WTRNREU1T0NCRE1UY3VPVEl3TXpVek55d3lNaTR6TmpBek1UTWdNVFV1TlRFM05qZzVOaXd5TWk0Mk1UZzBOelEzSURFMExqSXdNRFF5T0Rrc01qRXVNelEwTmpRd01pQkRNVEl1T0Rnek1UWTRNaXd5TUM0d056QTRNRFUySURFekxqRTFNREV6TURrc01UY3VOelEzTXpVd015QXhOQzQzT1RZM01EWTRMREUyTGpFMU5UQTFOekVnUXpFMkxqQTJNREkxTVRZc01UUXVPVE16TVRZM05pQXhOeTQzTmprd016STBMREUwTGpRNU5qa3dOVEVnTVRrdU1Ea3dPVEE1TVN3eE5DNDVNelUyT0RFMklFd3hPUzR3T1RBNU1Ea3hMREUwTGprek5UWTRNVFlnVERFNUxqQTVNRGt3T1RFc05DNHhOVE00TkRZeE5TQk1OeTQyTXpZek5qTTJOQ3cyTGpreU16QTNOamt5SUV3M0xqWXpOak0yTXpZMExERTVMalE1TkRnNE1qWWdRemN1TmpNMk16WXpOalFzTVRrdU5EazBPRGd5TmlBM0xqWXpOak0yTXpZMExERTVMalE1TkRnNE1qWWdOeTQyTXpZek5qTTJOQ3d4T1M0ME9UUTRPREkySUV3M0xqWXpOak0yTXpZMExESXdMak13TnpZNU1qTWdURGN1TlRRek1qTTJOU3d5TUM0ek1EYzJPVEl6SUVNM0xqTTFPVGsxT0RVNUxESXhMakV4TnpNM09EZ2dOaTQ1TURjNU5qUTVNeXd5TVM0NU16STNNekk1SURZdU1qQXpNamt6TWpNc01qSXVOakUwTVRjek55QkROQzQxTlRZM01UY3pNaXd5TkM0eU1EWTBOalk1SURJdU1UVTBNRFV6TWpnc01qUXVORFkwTmpJNE5pQXdMamd6TmpjNU1qVTFNaXd5TXk0eE9UQTNPVFFnUXkwd0xqUTRNRFEyT0RFM015d3lNUzQ1TVRZNU5UazFJQzB3TGpJeE16VXdOVFV3TVN3eE9TNDFPVE0xTURReElERXVORE16TURjd05ERXNNVGd1TURBeE1qRXdPU0JETWk0Mk9UWTJNVFV5TXl3eE5pNDNOemt6TWpFMElEUXVOREExTXprMk1ERXNNVFl1TXpRek1EVTVJRFV1TnpJM01qY3lOek1zTVRZdU56Z3hPRE0xTkNCTU5TNDNNamN5TnpJM015d3hOaTQzT0RFNE16VTBJRXcxTGpjeU56STNNamN6TERZdU5EWXhOVE00TkRZZ1REVXVOekkzTWpjeU56TXNNeTQyT1RJek1EYzJPU0JNTWpFc01DQk1NakVzTWk0M05qa3lNekEzTnlCYUlpQnBaRDBpVFhWemFXTXRNaUlnWm1sc2JEMGlJekF3TURBd01DSStQQzl3WVhSb1Bnb2dJQ0FnSUNBZ0lDQWdJQ0E4TDNOMlp6NEtJQ0FnSUNBZ0lDQWdJQ0FnUEhOd1lXNGdZMnhoYzNNOUlteGhZbVZzSWlCa1lYUmhMV2t4T0c0OUltUnZkMjVzYjJGa1RWQXpSbWxzWlhNaVBrUnZkMjVzYjJGa0lHRjFaR2x2SUdacGJHVnpQQzl6Y0dGdVBnb2dJQ0FnSUNBZ0lEd3ZaR2wyUGdvZ0lDQWdJQ0FnSUR4a2FYWWdZMnhoYzNNOUltbDBaVzBnYlc5a2RXeGxJSFpySUc5a2JtOXJiR0Z6YzI1cGEya2djR3haYjNWMGRXSmxJRzFoYVd4eWRTSWdaR0YwWVMxaFkzUnBiMjQ5SW1SdmQyNXNiMkZrVUd4aGVXeHBjM1FpUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjM1puSUdOc1lYTnpQU0pwWTI5dUlpQmtZWFJoTFhSNWNHVTlJbVJ2ZDI1c2IyRmtVR3hoZVd4cGMzUWlJSGRwWkhSb1BTSXlOSEI0SWlCb1pXbG5hSFE5SWpFNGNIZ2lJSFpwWlhkQ2IzZzlJakFnTUNBeU5DQXhPQ0lnZG1WeWMybHZiajBpTVM0eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWo0S0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR4d1lYUm9JR1E5SWswd0xEQWdUREFzTXk0MklFd3pMalF5T0RVM01UUXpMRE11TmlCTU15NDBNamcxTnpFME15d3dJRXd3TERBZ1dpQk5NQ3czTGpJZ1REQXNNVEF1T0NCTU15NDBNamcxTnpFME15d3hNQzQ0SUV3ekxqUXlPRFUzTVRRekxEY3VNaUJNTUN3M0xqSWdXaUJOTlM0eE5ESTROVGN4TkN3d0lFdzFMakUwTWpnMU56RTBMRE11TmlCTU1qUXNNeTQySUV3eU5Dd3dJRXcxTGpFME1qZzFOekUwTERBZ1dpQk5OUzR4TkRJNE5UY3hOQ3czTGpJZ1REVXVNVFF5T0RVM01UUXNNVEF1T0NCTU1qQXVOVGN4TkRJNE5pd3hNQzQ0SUV3eU1DNDFOekUwTWpnMkxEY3VNaUJNTlM0eE5ESTROVGN4TkN3M0xqSWdXaUJOTUN3eE5DNDBJRXd3TERFNElFd3pMalF5T0RVM01UUXpMREU0SUV3ekxqUXlPRFUzTVRRekxERTBMalFnVERBc01UUXVOQ0JhSUUwMUxqRTBNamcxTnpFMExERTBMalFnVERVdU1UUXlPRFUzTVRRc01UZ2dUREl5TGpJNE5UY3hORE1zTVRnZ1RESXlMakk0TlRjeE5ETXNNVFF1TkNCTU5TNHhOREk0TlRjeE5Dd3hOQzQwSUZvaUlHbGtQU0pDZFd4c1pYUXRUR2x6ZENJZ1ptbHNiRDBpSXpBd01EQXdNQ0krUEM5d1lYUm9QZ29nSUNBZ0lDQWdJQ0FnSUNBOEwzTjJaejRLSUNBZ0lDQWdJQ0FnSUNBZ1BITndZVzRnWTJ4aGMzTTlJbXhoWW1Wc0lpQmtZWFJoTFdreE9HNDlJbVJ2ZDI1c2IyRmtVR3hoZVd4cGMzUWlQa1J2ZDI1c2IyRmtJR0VnY0d4aGVXeHBjM1E4TDNOd1lXNCtDaUFnSUNBZ0lDQWdQQzlrYVhZK0NpQWdJQ0FnSUNBZ1BHUnBkaUJqYkdGemN6MGlhWFJsYlNCdGIyUjFiR1VnZG1zaUlHUmhkR0V0WVdOMGFXOXVQU0prYjNkdWJHOWhaRkJvYjNSdmN5SStDaUFnSUNBZ0lDQWdJQ0FnSUR4emRtY2dZMnhoYzNNOUltbGpiMjRpSUdSaGRHRXRkSGx3WlQwaVpHOTNibXh2WVdSUWFHOTBiM01pSUhkcFpIUm9QU0l5TkhCNElpQm9aV2xuYUhROUlqRTRjSGdpSUhacFpYZENiM2c5SWpBZ01DQXlOQ0F4T0NJZ2RtVnljMmx2YmowaU1TNHhJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGh0Ykc1ek9uaHNhVzVyUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hzYVc1cklqNEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lEeHdZWFJvSUdROUlrMHhPUzQxTERNZ1RESXhMakF3T0Rrd09UWXNNeUJETWpJdU5qVTRNakk1TkN3eklESTBMRFF1TXpReU9EZzNNVGdnTWpRc05TNDVPVGswTWpJME9DQk1NalFzTVRVdU1EQXdOVGMzTlNCRE1qUXNNVFl1TmpVMU5qUTVNeUF5TWk0Mk5qQTRORE15TERFNElESXhMakF3T0Rrd09UWXNNVGdnVERJdU9Ua3hNRGt3TkRJc01UZ2dRekV1TXpReE56Y3dOak1zTVRnZ01Dd3hOaTQyTlRjeE1USTRJREFzTVRVdU1EQXdOVGMzTlNCTU1DdzFMams1T1RReU1qUTRJRU13TERRdU16UTBNelV3TnpNZ01TNHpNemt4TlRZM09Td3pJREl1T1RreE1Ea3dORElzTXlCTU55NDFMRE1nUXpjdU5Td3hMak0wTmpVeE56RXlJRGd1T0RReE9EY3dOamNzTUNBeE1DNDBPVGN4TlRJc01DQk1NVFl1TlRBeU9EUTRMREFnUXpFNExqRTFPRE0zTnpJc01DQXhPUzQxTERFdU16UXpNVFExTnpVZ01Ua3VOU3d6SUV3eE9TNDFMRE1nV2lCTk1UTXVOU3d4Tmk0MUlFTXhOaTQ0TVRNM01EZzNMREUyTGpVZ01Ua3VOU3d4TXk0NE1UTTNNRGczSURFNUxqVXNNVEF1TlNCRE1Ua3VOU3czTGpFNE5qSTVNVE0wSURFMkxqZ3hNemN3T0Rjc05DNDFJREV6TGpVc05DNDFJRU14TUM0eE9EWXlPVEV6TERRdU5TQTNMalVzTnk0eE9EWXlPVEV6TkNBM0xqVXNNVEF1TlNCRE55NDFMREV6TGpneE16Y3dPRGNnTVRBdU1UZzJNamt4TXl3eE5pNDFJREV6TGpVc01UWXVOU0JhSUUweE15NDFMREUxSUVNeE5TNDVPRFV5T0RFMUxERTFJREU0TERFeUxqazROVEk0TVRVZ01UZ3NNVEF1TlNCRE1UZ3NPQzR3TVRRM01UZzFJREUxTGprNE5USTRNVFVzTmlBeE15NDFMRFlnUXpFeExqQXhORGN4T0RVc05pQTVMRGd1TURFME56RTROU0E1TERFd0xqVWdRemtzTVRJdU9UZzFNamd4TlNBeE1TNHdNVFEzTVRnMUxERTFJREV6TGpVc01UVWdXaUlnYVdROUlrTmhiV1Z5WVMweUlpQm1hV3hzUFNJak1EQXdNREF3SWo0OEwzQmhkR2crQ2lBZ0lDQWdJQ0FnSUNBZ0lEd3ZjM1puUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjM0JoYmlCamJHRnpjejBpYkdGaVpXd2lJR1JoZEdFdGFURTRiajBpWkc5M2JteHZZV1JRYUc5MGIzTWlQa1J2ZDI1c2IyRmtJSEJwWTNSMWNtVnpQQzl6Y0dGdVBnb2dJQ0FnSUNBZ0lEd3ZaR2wyUGdvZ0lDQWdJQ0FnSUR4a2FYWWdZMnhoYzNNOUltMXZaSFZzWlNCMmF5QnZaRzV2YTJ4aGMzTnVhV3RwSUdaaFkyVmliMjlySUd4dElITmxjR0Z5WVhSdmNpSStQQzlrYVhZK0NpQWdJQ0FnSUNBZ1BHUnBkaUJqYkdGemN6MGlhWFJsYlNJZ1pHRjBZUzFoWTNScGIyNDlJbkpsY0c5eWRFSjFaeUkrQ2lBZ0lDQWdJQ0FnSUNBZ0lEeGthWFlnWTJ4aGMzTTlJbWxqYjI0aVBqd3ZaR2wyUGp4emNHRnVJR05zWVhOelBTSnNZV0psYkNJZ1pHRjBZUzFwTVRodVBTSnlaWEJ2Y25SQ2RXY2lQbEpsY0c5eWRDQmhJR0oxWnp3dmMzQmhiajRLSUNBZ0lDQWdJQ0E4TDJScGRqNEtJQ0FnSUNBZ0lDQThaR2wySUdOc1lYTnpQU0pwZEdWdElpQmtZWFJoTFdGamRHbHZiajBpYzJodmQwOXdkR2x2Ym5NaVBnb2dJQ0FnSUNBZ0lDQWdJQ0E4WkdsMklHTnNZWE56UFNKcFkyOXVJajQ4TDJScGRqNDhjM0JoYmlCamJHRnpjejBpYkdGaVpXd2lJR1JoZEdFdGFURTRiajBpYzJodmQwOXdkR2x2Ym5NaVBrOXdkR2x2Ym5NOEwzTndZVzQrQ2lBZ0lDQWdJQ0FnUEM5a2FYWStDaUFnSUNBZ0lDQWdQR1JwZGlCamJHRnpjejBpYVhSbGJTSWdaR0YwWVMxaFkzUnBiMjQ5SW05d1pXNVFiMnhzSWo0S0lDQWdJQ0FnSUNBZ0lDQWdQR1JwZGlCamJHRnpjejBpYVdOdmJpSStQQzlrYVhZK1BITndZVzRnWTJ4aGMzTTlJbXhoWW1Wc0lpQmtZWFJoTFdreE9HNDlJbTl3Wlc1UWIyeHNJajVDWldOdmJXVWdZbVYwZEdWeVBDOXpjR0Z1UGdvZ0lDQWdJQ0FnSUR3dlpHbDJQZ29nSUNBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW1sMFpXMGdaVzVoWW14bFRXOWtkV3hsSWlCa1lYUmhMV0ZqZEdsdmJqMGlaVzVoWW14bFRXOWtkV3hsSWo0S0lDQWdJQ0FnSUNBZ0lDQWdQR2tnWTJ4aGMzTTlJbk5tTFdOb1pXTnJZbTk0SWo0OGFUNDhhVDQ4TDJrK1BDOXBQand2YVQ0S0lDQWdJQ0FnSUNBZ0lDQWdQSE53WVc0Z2FXUTlJbVJwYzJGaWJHVk5iMlIxYkdVaUlHTnNZWE56UFNKc1lXSmxiQ0lnWkdGMFlTMXBNVGh1UFNKa2FYTmhZbXhsVFc5a2RXeGxJajVFYVhOaFlteGxJRzF2WkhWc1pUd3ZjM0JoYmo0S0lDQWdJQ0FnSUNBOEwyUnBkajRLSUNBZ0lDQWdJQ0E4WkdsMklITjBlV3hsUFNKa2FYTndiR0Y1T2lCdWIyNWxPeUlnWkdGMFlTMWhZM1JwYjI0OUluTm9iM2RCWW05MWRGQmhaMlVpUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjM1puSUdOc1lYTnpQU0pwWTI5dUlpQmtZWFJoTFhSNWNHVTlJbk5vYjNkQlltOTFkRkJoWjJVaUlIZHBaSFJvUFNJeU5IQjRJaUJvWldsbmFIUTlJakkwY0hnaUlIWnBaWGRDYjNnOUlqQWdNQ0F4TmlBeE5pSWdkbVZ5YzJsdmJqMGlNUzR4SWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhodGJHNXpPbmhzYVc1clBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHhPVGs1TDNoc2FXNXJJajQ4Y0dGMGFDQmtQU0p0TXk0d09Td3VOekU1WXpBc0xqZzFNU0F3TERFdU56RXhJREFzTWk0MU5qRXRMalkzTERBdE1TNHpOQ3d3TFRJdU1ERXNNQ0F4TGpBM0xERXVNRGNnTWk0eE5Td3lMakUxSURNdU1qSXNNeTR5TWlBd0xURXVPVE1nTUMwekxqZzFJREF0TlM0M09ERXRMalF5TERBdExqZ3pMREF0TVM0eU5Td3dlbTB4TGpreExEQmpMakEwTERJdU1Ea3hJQzR3TkN3MExqRTVNU0F1TURRc05pNHlPREV0TVM0Mk55d3dMVE11TXpNc01DMDFMREFnTWk0Mk55d3lMamMzSURVdU16TXNOUzQxSURnc09DNHpJREl1TnkweUxqZ2dOUzR6TFRVdU5UTWdPQzA0TGpNdE1TNDNMREF0TXk0ekxEQXROU3d3SURBdE1pNHdPU0F3TFRRdU1Ua2dNQzAyTGpJNE1TMHlMREF0TkN3d0xUWXNNSHB0Tmk0M0xEQmpNQ3d4TGprek1TQXdMRE11T0RVeElEQXNOUzQzT0RFZ01TNHhMVEV1TURjZ01pNHhMVEl1TVRVZ015NHlMVE11TWpJdExqY3NNQzB4TGpNc01DMHlMREFnTUMwdU9EVWdNQzB4TGpjeElEQXRNaTQxTmpFdExqUXNNQzB1T0N3d0xURXVNaXd3ZWlJdlBqd3ZjM1puUGdvZ0lDQWdJQ0FnSUR3dlpHbDJQZ29nSUNBZ1BDOWthWFkrJywKCiAgICBnZXRNZW51OiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNvZGUgPSBhdG9iKHRoaXMubWVudUhUTUwpOwogICAgICB2YXIgbWVudSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBtZW51LmNsYXNzTGlzdC5hZGQoJ3NmLW1lbnUtY29udGFpbmVyJyk7CiAgICAgIG1lbnUuc2V0QXR0cmlidXRlKHRoaXMuYWN0aXZlRGF0YUF0dHIsICcxJyk7CiAgICAgIG1lbnUuc3R5bGUubWFyZ2luVG9wID0gJy0yNHB4JzsKICAgICAgbWVudS5zdHlsZS53aWR0aCA9ICdhdXRvJzsKICAgICAgbWVudS5zdHlsZS5taW5XaWR0aCA9ICc0ODJweCc7CiAgICAgIG1lbnUuaW5uZXJIVE1MID0gY29kZTsKICAgICAgcmV0dXJuIG1lbnU7CiAgICB9LAoKICAgIHNob3dNZW51SXRlbXM6IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5hY3RpdmUpCiAgICAgICAgcmV0dXJuOwoKICAgICAgdGhpcy5tZW51LnN0eWxlLnRvcCA9IHRoaXMuc3R5bGUubWVudS5pbml0aWFsLnRvcDsKCiAgICAgIHRoaXMucmVtb3ZlQWN0aXZlSXRlbXMoKTsKCiAgICAgIHZhciBtZW51ID0gdGhpcy5nZXRNZW51KCk7CiAgICAgIGlmIChtZW51KSB7CiAgICAgICAgdGhpcy5tZW51LmFwcGVuZENoaWxkKG1lbnUpOwogICAgICAgIF9tZW51LmluaXRNZW51KHRoaXMubWVudSk7CiAgICAgIH0KCiAgICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTsKICAgICAgdGhpcy5zZXRFbGVtZW50c1N0eWxlKCdhY3RpdmUnKTsKCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkRvY3VtZW50Q2xpY2ssIGZhbHNlKTsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMub25Eb2N1bWVudEtleURvd24sIGZhbHNlKTsKCiAgICAgIHZhciBtZW51SGVpZ2h0ID0gdGhpcy5tZW51LmNsaWVudEhlaWdodDsKICAgICAgdmFyIG1lbnVUb3AgPSBwYXJzZUludCh0aGlzLm1lbnUuc3R5bGUudG9wKTsKICAgICAgdmFyIHdpbkhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDsKICAgICAgaWYgKG1lbnVUb3AgKyBtZW51SGVpZ2h0ID4gd2luSGVpZ2h0KSB7CiAgICAgICAgdGhpcy5tZW51LnN0eWxlLnRvcCA9ICh3aW5IZWlnaHQgLSBtZW51SGVpZ2h0IC0gNCkgKyAncHgnCiAgICAgIH0gZWxzZQogICAgICBpZiAobWVudVRvcCA8IDApIHsKICAgICAgICB0aGlzLm1lbnUuc3R5bGUudG9wID0gJzBweCc7CiAgICAgIH0KICAgIH0sCgogICAgaGlkZU1lbnVJdGVtczogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubWVudS5zdHlsZS50b3AgPSB0aGlzLnN0eWxlLm1lbnUuaW5pdGlhbC50b3A7CgogICAgICAvLyB0aGlzLnJlbW92ZVRvb2x0aXAoKTsKICAgICAgdGhpcy5yZW1vdmVBY3RpdmVJdGVtcygpOwogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25Eb2N1bWVudENsaWNrLCBmYWxzZSk7CiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLm9uRG9jdW1lbnRLZXlEb3duLCBmYWxzZSk7CgogICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlOwogICAgICB0aGlzLnNob3dUYWcoKTsKICAgIH0sCgogICAgb25Eb2N1bWVudENsaWNrOiBmdW5jdGlvbihldmVudCkgewogICAgICB2YXIgbm9kZSA9IGV2ZW50LnRhcmdldDsKICAgICAgaWYgKG5vZGUgIT0gX21lbnUubWVudSAmJiAhU2F2ZUZyb21fVXRpbHMuaXNQYXJlbnQobm9kZSwgX21lbnUubWVudSkpIHsKICAgICAgICBfbWVudS5oaWRlTWVudUl0ZW1zKCk7CiAgICAgIH0KICAgIH0sCgogICAgb25Eb2N1bWVudEtleURvd246IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDI3KSB7CiAgICAgICAgX21lbnUuaGlkZU1lbnVJdGVtcygpOwogICAgICB9CiAgICB9LAoKICAgIHJlbW92ZUFjdGl2ZUl0ZW1zOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGUgPSBudWxsOwogICAgICB3aGlsZSAoZSA9IHRoaXMubWVudS5xdWVyeVNlbGVjdG9yKCdkaXZbJyArIHRoaXMuYWN0aXZlRGF0YUF0dHIgKyAnXScpKSB7CiAgICAgICAgZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGUpOwogICAgICB9CiAgICB9CiAgfTsKICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgLy8gT1BUSU9OUwogIF9vcHRpb25zID0gewogICAgY2xhc3NQcmVmaXg6ICdzZmgtLScsCiAgICBkYXRhQXR0cjogJ2RhdGEtc2ZoLW9wdGlvbicsCiAgICBodG1sOiAnUEhOMGVXeGxJSFI1Y0dVOUluUmxlSFF2WTNOeklqNEtMbk5tYUMwdGIzQjBhVzl1Y3lCN0NpQWdJQ0JpWVdOclozSnZkVzVrTFdOdmJHOXlPaUFqWm1abU93b2dJQ0FnWW05eVpHVnlPaUJ1YjI1bE93b2dJQ0FnWm05dWREb2dNVE53ZUM4eElFRnlhV0ZzTENCSVpXeDJaWFJwWTJFc0lITmhibk10YzJWeWFXWTdDaUFnSUNCM2FXUjBhRG9nTlRnd2NIZzdDaUFnSUNCdFlYSm5hVzQ2SURBN0NpQWdJQ0J3WVdSa2FXNW5PaUE1Y0hnN0NpQWdJQ0IwWlhoMExXRnNhV2R1T2lCc1pXWjBDbjBLQ2k1elptZ3RMVzl3ZEdsdmJuTWdMbk5tYUMwdGRHbDBiR1VnZXdvZ0lDQWdabTl1ZEMxemFYcGxPaUF4TGpObGJUc0tJQ0FnSUcxaGNtZHBiam9nTUNBd0lERXVNMlZ0SURBS2ZRb0tMbk5tYUMwdGIzQjBhVzl1Y3lCbWIzSnRJSHNLSUNBZ0lHMWhjbWRwYmpvZ01Ec0tJQ0FnSUhCaFpHUnBibWM2SURBS2ZRb0tMbk5tYUMwdGIzQjBhVzl1Y3lCcGJuQjFkRnQwZVhCbFBTSmphR1ZqYTJKdmVDSmRJSHNLSUNBZ0lHMXBiaTEzYVdSMGFEb2dNVEp3ZURzS0lDQWdJRzFwYmkxb1pXbG5hSFE2SURFeWNIZ0tmUW9LTG5ObWFDMHRiM0IwYVc5dWN5QnNZV0psYkNCN0NpQWdJQ0JrYVhOd2JHRjVPaUJpYkc5amF6c0tJQ0FnSUcxaGNtZHBiam9nTGpKbGJTQXdPd29nSUNBZ2NHRmtaR2x1WnpvZ01Ec0tJQ0FnSUhSbGVIUXRZV3hwWjI0NklHeGxablE3Q2lBZ0lDQm1iMjUwTFhOcGVtVTZJREV6Y0hnN0NpQWdJQ0JtYkc5aGREb2dibTl1WlRzS2ZRb0tMbk5tYUMwdGIzQjBhVzl1Y3lBdWMyWm9MUzFwYm14cGJtVXRZMjl1ZEdWdWRDQnNZV0psYkNCN0NpQWdJQ0JrYVhOd2JHRjVPaUJwYm14cGJtVXRZbXh2WTJzN0NpQWdJQ0J0WVhKbmFXNHRiR1ZtZERvZ01UQndlQXA5Q2dvdWMyWm9MUzF2Y0hScGIyNXpJQzV6Wm1ndExXWnNaV1owSUhzS0lDQWdJR1pzYjJGME9pQnNaV1owQ24wS0NpNXpabWd0TFc5d2RHbHZibk1nTG5ObWFDMHRabXd0WTI5c2RXMXVJSHNLSUNBZ0lHWnNiMkYwT2lCc1pXWjBPd29nSUNBZ2JXRnlaMmx1TFhKcFoyaDBPaUF5TUhCNENuMEtDaTV6Wm1ndExXOXdkR2x2Ym5NZ0xuTm1hQzB0WTJ4bFlYSWdld29nSUNBZ1kyeGxZWEk2SUdKdmRHZzdDaUFnSUNCb1pXbG5hSFE2SURBN0NpQWdJQ0JtYjI1MExYTnBlbVU2SURBN0NpQWdJQ0JzYVc1bExXaGxhV2RvZERvZ01BcDlDZ291YzJab0xTMXZjSFJwYjI1eklDNXpabWd0TFdKc2IyTnJJSHNLSUNBZ0lHSnZjbVJsY2kxMGIzQTZJREZ3ZUNCemIyeHBaQ0FqWkdabE1XVTRPd29nSUNBZ2NHRmtaR2x1WnpvZ01TNDFaVzBnTUNBd0lEQTdDaUFnSUNCdFlYSm5hVzQ2SURFdU5XVnRJREFnTUNBd093b2dJQ0FnYldsdUxYZHBaSFJvT2lBeE5qQndlQXA5Q2dvdWMyWm9MUzF2Y0hScGIyNXpJQzV6Wm1ndExXSnNiMk5yTFhScGRHeGxJSHNLSUNBZ0lHWnZiblF0ZDJWcFoyaDBPaUJpYjJ4a093b2dJQ0FnYldGeVoybHVMV0p2ZEhSdmJUb2dMalZsYlFwOUNnb3VjMlpvTFMxdmNIUnBiMjV6SUM1elptZ3RMVzF2WkhWc1pTQjdDaUFnSUNCbWIyNTBMWGRsYVdkb2REb2dZbTlzWkRzS0lDQWdJRzFoY21kcGJpMTBiM0E2SURGbGJRcDlDZ291YzJab0xTMXZjSFJwYjI1eklDNXpabWd0TFcxdlpIVnNaVHBtYVhKemRDMWphR2xzWkNCN0NpQWdJQ0J0WVhKbmFXNHRkRzl3T2lBd0NuMEtDaTV6Wm1ndExXOXdkR2x2Ym5NZ0xuTm1hQzB0Ylc5a2RXeGxYMjl3ZEdsdmJuTWdld29nSUNBZ1ptOXVkQzF6YVhwbE9pQXVPV1Z0T3dvZ0lDQWdabTl1ZEMxM1pXbG5hSFE2SUc1dmNtMWhiRHNLSUNBZ0lHMWhjbWRwYmkxc1pXWjBPaUF5WlcwS2ZRb0tQQzl6ZEhsc1pUNEtQR1JwZGlCamJHRnpjejBpYzJab0xTMXZjSFJwYjI1eklqNEtJQ0E4WkdsMklHTnNZWE56UFNKelptZ3RMWFJwZEd4bElpQmtZWFJoTFdreE9HNDlJbTl3ZEdsdmJuTlVhWFJzWlNJK1UyRjJaVVp5YjIwdWJtVjBJRWhsYkhCbGNpQXRJRkJ5WldabGNtVnVZMlZ6UEM5a2FYWStDZ29nSUR4bWIzSnRQZ29nSUNBZ1BHUnBkaUJqYkdGemN6MGljMlpvTFMxaWJHOWpheUkrQ2lBZ0lDQWdJRHhzWVdKbGJENDhhVzV3ZFhRZ2RIbHdaVDBpWTJobFkydGliM2dpSUdSaGRHRXRjMlpvTFc5d2RHbHZiajBpWW5WMGRHOXVJaUJqYUdWamEyVmtQU0l4SWo0bWJtSnpjRHM4YzNCaGJpQmtZWFJoTFdreE9HNDlJbk5vYjNkQ2RYUjBiMjRpUGxOb2IzY2daWGgwWlc1emFXOXVJR0oxZEhSdmJqd3ZjM0JoYmo0OEwyeGhZbVZzUGdvZ0lDQWdQQzlrYVhZK0Nnb2dJQ0FnUEdScGRpQmpiR0Z6Y3owaWMyWm9MUzFpYkc5amF5SStDaUFnSUNBZ0lEeGthWFlnWkdGMFlTMXBNVGh1UFNKdmNIUnBiMjV6U0dGdVpHeGxUR2x1YTNNaUlHTnNZWE56UFNKelptZ3RMV0pzYjJOckxYUnBkR3hsSWo1SVlXNWtiR1VnYkdsdWEzTThMMlJwZGo0S0lDQWdJQ0FnUEd4aFltVnNQanhwYm5CMWRDQjBlWEJsUFNKamFHVmphMkp2ZUNJZ1pHRjBZUzF6Wm1ndGIzQjBhVzl1UFNKc2JVWnBiR1ZJYjNOMGFXNW5JaUJqYUdWamEyVmtQU0l4SWo0bWJtSnpjRHM4YzNCaGJpQmtZWFJoTFdreE9HNDlJbTl3ZEdsdmJuTkdhV3hsU0c5emRHbHVaM01pUGxSdklHWnBiR1ZvYjNOMGFXNW5jend2YzNCaGJqNDhMMnhoWW1Wc1Bnb2dJQ0FnSUNBOGJHRmlaV3crUEdsdWNIVjBJSFI1Y0dVOUltTm9aV05yWW05NElpQmtZWFJoTFhObWFDMXZjSFJwYjI0OUlteHRUV1ZrYVdGSWIzTjBhVzVuSWlCamFHVmphMlZrUFNJeElqNG1ibUp6Y0RzOGMzQmhiaUJrWVhSaExXa3hPRzQ5SW05d2RHbHZibk5OWldScFlVaHZjM1JwYm1keklqNVVieUJ0WldScFlXaHZjM1JwYm1kelBDOXpjR0Z1UGp3dmJHRmlaV3crQ2lBZ0lDQThMMlJwZGo0S0NpQWdJQ0E4WkdsMklHTnNZWE56UFNKelptZ3RMV0pzYjJOcklqNEtJQ0FnSUNBZ1BHUnBkaUJrWVhSaExXa3hPRzQ5SW05d2RHbHZibk5OYjJSMWJHVnpJaUJqYkdGemN6MGljMlpvTFMxaWJHOWpheTEwYVhSc1pTSStUVzlrZFd4bGN6d3ZaR2wyUGdvZ0lDQWdJQ0E4WkdsMklHTnNZWE56UFNKelptZ3RMWGx2ZFhSMVltVmZZbTk0SWlCamJHRnpjejBpYzJab0xTMXRiMlIxYkdVaVBqeHNZV0psYkQ0OGFXNXdkWFFnZEhsd1pUMGlZMmhsWTJ0aWIzZ2lJR1JoZEdFdGMyWm9MVzl3ZEdsdmJqMGliVzlrZFd4bFdXOTFkSFZpWlNJZ1kyaGxZMnRsWkQwaU1TSStKbTVpYzNBN1BITndZVzRnWkdGMFlTMXBNVGh1UFNKdmNIUnBiMjV6V1c5MWRIVmlaU0krV1c5MVZIVmlaVHd2YzNCaGJqNDhMMnhoWW1Wc1Bnb2dJQ0FnSUNBZ0lEeGthWFlnWTJ4aGMzTTlJbk5tYUMwdGJXOWtkV3hsWDI5d2RHbHZibk1pUGdvZ0lDQWdJQ0FnSUNBZ1BHUnBkaUJqYkdGemN6MGljMlpvTFMxbWJDMWpiMngxYlc0aVBqeHpjR0Z1SUdSaGRHRXRhVEU0YmowaWIzQjBhVzl1YzFsVVNHbGtaVXhwYm10eklqNUlhV1JsSUd4cGJtdHpQQzl6Y0dGdVBqbzhMMlJwZGo0S0lDQWdJQ0FnSUNBZ0lEeGthWFlnWTJ4aGMzTTlJbk5tYUMwdFpteGxablFnYzJab0xTMXBibXhwYm1VdFkyOXVkR1Z1ZENJK0NpQWdJQ0FnSUNBZ0lDQWdJRHhzWVdKbGJENDhhVzV3ZFhRZ2RIbHdaVDBpWTJobFkydGliM2dpSUdSaGRHRXRjMlpvTFc5d2RHbHZiajBpZVhSSWFXUmxSa3hXSWlCamFHVmphMlZrUFNJd0lqNG1ibUp6Y0R0R1RGWThMMnhoWW1Wc1Bnb2dJQ0FnSUNBZ0lDQWdJQ0E4YkdGaVpXdytQR2x1Y0hWMElIUjVjR1U5SW1Ob1pXTnJZbTk0SWlCa1lYUmhMWE5tYUMxdmNIUnBiMjQ5SW5sMFNHbGtaVTFRTkNJZ1kyaGxZMnRsWkQwaU1DSStKbTVpYzNBN1RWQTBQQzlzWVdKbGJENEtJQ0FnSUNBZ0lDQWdJQ0FnUEd4aFltVnNQanhwYm5CMWRDQjBlWEJsUFNKamFHVmphMkp2ZUNJZ1pHRjBZUzF6Wm1ndGIzQjBhVzl1UFNKNWRFaHBaR1ZYWldKTklpQmphR1ZqYTJWa1BTSXhJajRtYm1KemNEdFhaV0pOUEM5c1lXSmxiRDRLSUNBZ0lDQWdJQ0FnSUNBZ1BHSnlQZ29nSUNBZ0lDQWdJQ0FnSUNBOGJHRmlaV3crUEdsdWNIVjBJSFI1Y0dVOUltTm9aV05yWW05NElpQmtZWFJoTFhObWFDMXZjSFJwYjI0OUlubDBTR2xrWlROSFVDSWdZMmhsWTJ0bFpEMGlNU0krSm01aWMzQTdNMGRRUEM5c1lXSmxiRDRLSUNBZ0lDQWdJQ0FnSUNBZ1BHeGhZbVZzUGp4cGJuQjFkQ0IwZVhCbFBTSmphR1ZqYTJKdmVDSWdaR0YwWVMxelptZ3RiM0IwYVc5dVBTSjVkRWhwWkdVelJDSWdZMmhsWTJ0bFpEMGlNU0krSm01aWMzQTdNMFE4TDJ4aFltVnNQZ29nSUNBZ0lDQWdJQ0FnSUNBOGJHRmlaV3crUEdsdWNIVjBJSFI1Y0dVOUltTm9aV05yWW05NElpQmtZWFJoTFhObWFDMXZjSFJwYjI0OUlubDBTR2xrWlUxUU5FNXZRWFZrYVc4aUlHTm9aV05yWldROUlqRWlQaVp1WW5Od08wMVFOQ1p1WW5Od095aHVieVp1WW5Od08yRjFaR2x2S1R3dmJHRmlaV3crQ2lBZ0lDQWdJQ0FnSUNBZ0lEeHNZV0psYkQ0OGFXNXdkWFFnZEhsd1pUMGlZMmhsWTJ0aWIzZ2lJR1JoZEdFdGMyWm9MVzl3ZEdsdmJqMGllWFJJYVdSbFFYVmthVzlmVFZBMElpQmphR1ZqYTJWa1BTSXhJajRtYm1KemNEdEJkV1JwYnp3dmJHRmlaV3crQ2lBZ0lDQWdJQ0FnSUNBOEwyUnBkajRLSUNBZ0lDQWdJQ0FnSUR4a2FYWWdZMnhoYzNNOUluTm1hQzB0WTJ4bFlYSWlQand2WkdsMlBnb2dJQ0FnSUNBZ0lEd3ZaR2wyUGdvZ0lDQWdJQ0E4TDJScGRqNEtDaUFnSUNBZ0lEeGthWFlnWTJ4aGMzTTlJbk5tYUMwdGJXOWtkV3hsSWo0OGJHRmlaV3crUEdsdWNIVjBJSFI1Y0dVOUltTm9aV05yWW05NElpQmtZWFJoTFhObWFDMXZjSFJwYjI0OUltMXZaSFZzWlVSaGFXeDViVzkwYVc5dUlpQmphR1ZqYTJWa1BTSXhJajRtYm1KemNEczhjM0JoYmlCa1lYUmhMV2t4T0c0OUltOXdkR2x2Ym5ORVlXbHNlVzF2ZEdsdmJpSStSR0ZwYkhsdGIzUnBiMjQ4TDNOd1lXNCtQQzlzWVdKbGJENDhMMlJwZGo0S0NpQWdJQ0FnSUR4a2FYWWdZMnhoYzNNOUluTm1hQzB0Ylc5a2RXeGxJajQ4YkdGaVpXdytQR2x1Y0hWMElIUjVjR1U5SW1Ob1pXTnJZbTk0SWlCa1lYUmhMWE5tYUMxdmNIUnBiMjQ5SW0xdlpIVnNaVlpwYldWdklpQmphR1ZqYTJWa1BTSXhJajRtYm1KemNEczhjM0JoYmlCa1lYUmhMV2t4T0c0OUltOXdkR2x2Ym5OV2FXMWxieUkrVm1sdFpXODhMM053WVc0K1BDOXNZV0psYkQ0OEwyUnBkajRLQ2lBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW5ObWFDMHRiVzlrZFd4bElqNDhiR0ZpWld3K1BHbHVjSFYwSUhSNWNHVTlJbU5vWldOclltOTRJaUJrWVhSaExYTm1hQzF2Y0hScGIyNDlJbTF2WkhWc1pVWmhZMlZpYjI5cklpQmphR1ZqYTJWa1BTSXhJajRtYm1KemNEczhjM0JoYmlCa1lYUmhMV2t4T0c0OUltOXdkR2x2Ym5OR1lXTmxZbTl2YXlJK1JtRmpaV0p2YjJzOEwzTndZVzQrUEM5c1lXSmxiRDQ4TDJScGRqNEtDaUFnSUNBZ0lEeGthWFlnWTJ4aGMzTTlJbk5tYUMwdGJXOWtkV3hsSWo0OGJHRmlaV3crUEdsdWNIVjBJSFI1Y0dVOUltTm9aV05yWW05NElpQmtZWFJoTFhObWFDMXZjSFJwYjI0OUltMXZaSFZzWlZOdmRXNWtZMnh2ZFdRaUlHTm9aV05yWldROUlqRWlQaVp1WW5Od096eHpjR0Z1SUdSaGRHRXRhVEU0YmowaWIzQjBhVzl1YzFOdmRXNWtZMnh2ZFdRaVBsTnZkVzVrUTJ4dmRXUThMM053WVc0K1BDOXNZV0psYkQ0OEwyUnBkajRLQ2lBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW5ObWFDMHRiVzlrZFd4bElqNDhiR0ZpWld3K1BHbHVjSFYwSUhSNWNHVTlJbU5vWldOclltOTRJaUJrWVhSaExYTm1hQzF2Y0hScGIyNDlJbTF2WkhWc1pWWnJiMjUwWVd0MFpTSWdZMmhsWTJ0bFpEMGlNU0krSm01aWMzQTdQSE53WVc0Z1pHRjBZUzFwTVRodVBTSnZjSFJwYjI1elZtdHZiblJoYTNSbElqNVdTend2YzNCaGJqNDhMMnhoWW1Wc1Bnb2dJQ0FnSUNBZ0lEeGthWFlnWTJ4aGMzTTlJbk5tYUMwdGJXOWtkV3hsWDI5d2RHbHZibk1pUGp4c1lXSmxiRDQ4YVc1d2RYUWdkSGx3WlQwaVkyaGxZMnRpYjNnaUlHUmhkR0V0YzJab0xXOXdkR2x2YmowaWRtdFRhRzkzUW1sMGNtRjBaU0lnWTJobFkydGxaRDBpTUNJK0ptNWljM0E3UEhOd1lXNGdaR0YwWVMxcE1UaHVQU0p2Y0hScGIyNXpRbWwwY21GMFpTSStVMmh2ZHlCaWFYUnlZWFJsSUdsdWMzUmhiblJzZVR3dmMzQmhiajQ4TDJ4aFltVnNQand2WkdsMlBnb2dJQ0FnSUNBOEwyUnBkajRLQ2lBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW5ObWFDMHRiVzlrZFd4bElqNDhiR0ZpWld3K1BHbHVjSFYwSUhSNWNHVTlJbU5vWldOclltOTRJaUJrWVhSaExYTm1hQzF2Y0hScGIyNDlJbTF2WkhWc1pVOWtibTlyYkdGemMyNXBhMmtpSUdOb1pXTnJaV1E5SWpFaVBpWnVZbk53T3p4emNHRnVJR1JoZEdFdGFURTRiajBpYjNCMGFXOXVjMDlrYm05cmJHRnpjMjVwYTJraVBrOWtibTlyYkdGemMyNXBhMms4TDNOd1lXNCtQQzlzWVdKbGJENDhMMlJwZGo0S0NpQWdJQ0FnSUR4a2FYWWdZMnhoYzNNOUluTm1hQzB0Ylc5a2RXeGxJajQ4YkdGaVpXdytQR2x1Y0hWMElIUjVjR1U5SW1Ob1pXTnJZbTk0SWlCa1lYUmhMWE5tYUMxdmNIUnBiMjQ5SW0xdlpIVnNaVTFoYVd4eWRTSWdZMmhsWTJ0bFpEMGlNU0krSm01aWMzQTdQSE53WVc0Z1pHRjBZUzFwTVRodVBTSnZjSFJwYjI1elRXRnBiSEoxSWo1TllXbHNMbkoxUEM5emNHRnVQand2YkdGaVpXdytQQzlrYVhZK0Nnb2dJQ0FnSUNBOFpHbDJJR05zWVhOelBTSnpabWd0TFcxdlpIVnNaU0krUEd4aFltVnNQanhwYm5CMWRDQjBlWEJsUFNKamFHVmphMkp2ZUNJZ1pHRjBZUzF6Wm1ndGIzQjBhVzl1UFNKdGIyUjFiR1ZKYm5OMFlXZHlZVzBpSUdOb1pXTnJaV1E5SWpFaVBpWnVZbk53T3p4emNHRnVJR1JoZEdFdGFURTRiajBpYjNCMGFXOXVjMGx1YzNSaFozSmhiU0krU1c1emRHRm5jbUZ0UEM5emNHRnVQand2YkdGaVpXdytQQzlrYVhZK0Nnb2dJQ0FnSUNBOFpHbDJJR05zWVhOelBTSnpabWd0TFcxdlpIVnNaU0krUEd4aFltVnNQanhwYm5CMWRDQjBlWEJsUFNKamFHVmphMkp2ZUNJZ1pHRjBZUzF6Wm1ndGIzQjBhVzl1UFNKdGIyUjFiR1ZTZFhSMVltVWlJR05vWldOclpXUTlJakVpUGladVluTndPenh6Y0dGdUlHUmhkR0V0YVRFNGJqMGliM0IwYVc5dWMxSjFkSFZpWlNJK1VuVjBkV0psUEM5emNHRnVQand2YkdGaVpXdytQQzlrYVhZK0NpQWdJQ0E4TDJScGRqNEtJQ0FnSUR4a2FYWWdZMnhoYzNNOUluTm1hQzB0WW14dlkyc2dZbXh2WTJ0VmJXMTVTVzVtYnlJK0NpQWdJQ0FnSUR4c1lXSmxiRDQ4YVc1d2RYUWdkSGx3WlQwaVkyaGxZMnRpYjNnaUlHUmhkR0V0YzJab0xXOXdkR2x2YmowaWMyaHZkMVZ0YlhsSmJtWnZJaUJqYUdWamEyVmtQU0l4SWo0bWJtSnpjRHM4YzNCaGJpQmtZWFJoTFdreE9HNDlJbTl3ZEdsdmJuTlRhRzkzVlcxdGVVbHVabThpUGxOb2IzY2dWVzF0ZVNCcGJtWnZJSEJ2Y0hWd1BDOXpjR0Z1UGp3dmJHRmlaV3crQ2lBZ0lDQWdJRHhzWVdKbGJENDhhVzV3ZFhRZ2RIbHdaVDBpWTJobFkydGliM2dpSUdSaGRHRXRjMlpvTFc5d2RHbHZiajBpYzJodmQxVnRiWGxDZEc0aUlHTm9aV05yWldROUlqRWlQaVp1WW5Od096eHpjR0Z1SUdSaGRHRXRhVEU0YmowaWIzQjBhVzl1YzFOb2IzZFZiVzE1UW5SdUlqNVRhRzkzSUhSb1pTQlZiVzE1SUdKMWRIUnZiand2YzNCaGJqNDhMMnhoWW1Wc1Bnb2dJQ0FnUEM5a2FYWStDaUFnSUNBOFpHbDJJR05zWVhOelBTSnpabWd0TFdKc2IyTnJJR0pzYjJOclIyMU9ZWFJwZG1WRWIzZHViRzloWkNJZ2MzUjViR1U5SW1ScGMzQnNZWGs2SUc1dmJtVTdJajRLSUNBZ0lDQWdQR3hoWW1Wc1BqeHBibkIxZENCMGVYQmxQU0pqYUdWamEySnZlQ0lnWkdGMFlTMXpabWd0YjNCMGFXOXVQU0puYlU1aGRHbDJaVVJ2ZDI1c2IyRmtJaUJqYUdWamEyVmtQU0l3SWo0bWJtSnpjRHM4YzNCaGJpQmtZWFJoTFdreE9HNDlJbTl3ZEdsdmJuTkhiVTVoZEdsMlpVUnZkMjVzYjJGa0lqNUJaSFpoYm1ObFpDQmtiM2R1Ykc5aFpDQnRiMlJsUEM5emNHRnVQand2YkdGaVpXdytDaUFnSUNBOEwyUnBkajRLSUNBZ0lEeGthWFlnWTJ4aGMzTTlJbk5tYUMwdFlteHZZMnNnWW14dlkydFRiM1psZEc1cGEwVnVZV0pzWldRaVBnb2dJQ0FnSUNBOGJHRmlaV3crUEdsdWNIVjBJSFI1Y0dVOUltTm9aV05yWW05NElpQmtZWFJoTFhObWFDMXZjSFJwYjI0OUluTnZkbVYwYm1sclJXNWhZbXhsWkNJZ1kyaGxZMnRsWkQwaU1TSStKbTVpYzNBN1BITndZVzRnWkdGMFlTMXBNVGh1UFNKdmNIUnBiMjV6VTI5MlpYUnVhV3RGYm1GaWJHVmtJajVGYm1GaWJHVWdjMjkyWlhSdWFXczhMM053WVc0K1BDOXNZV0psYkQ0S0lDQWdJRHd2WkdsMlBnb2dJQ0FnUEdScGRpQmpiR0Z6Y3owaWMyWm9MUzFpYkc5amF5QmliRzlqYTBGMmFXRkNZWEpGYm1GaWJHVmtJajRLSUNBZ0lDQWdQR3hoWW1Wc1BqeHBibkIxZENCMGVYQmxQU0pqYUdWamEySnZlQ0lnWkdGMFlTMXpabWd0YjNCMGFXOXVQU0poZG1saFFtRnlSVzVoWW14bFpDSWdZMmhsWTJ0bFpEMGlNU0krSm01aWMzQTdQSE53WVc0Z1pHRjBZUzFwTVRodVBTSnZjSFJwYjI1elFYWnBZVUpoY2tWdVlXSnNaV1FpUGtWdVlXSnNaU0JoZG1saFFtRnlQQzl6Y0dGdVBqd3ZiR0ZpWld3K0NpQWdJQ0E4TDJScGRqNEtJQ0FnSUR4a2FYWWdZMnhoYzNNOUluTm1hQzB0WTJ4bFlYSWlQand2WkdsMlBnb2dJRHd2Wm05eWJUNEtQQzlrYVhZKycsCgogICAgdHJhbnNsYXRlOiBmdW5jdGlvbihwYXJlbnQpIHsKICAgICAgcGFyZW50ID0gcGFyZW50IHx8IGRvY3VtZW50OwogICAgICB2YXIgZV9saXN0ID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJypbZGF0YS1pMThuXScpOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZV9saXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGVsID0gZV9saXN0W2ldOwogICAgICAgIGVsLnRleHRDb250ZW50ID0gZW5naW5lLmxhbmd1YWdlW2VsLmRhdGFzZXQuaTE4bl07CiAgICAgIH0KICAgIH0sCgogICAgb25DYkNoYW5nZTogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgdmFyIGVsID0gZXZlbnQudGFyZ2V0OwogICAgICB2YXIga2V5ID0gZWwuZ2V0QXR0cmlidXRlKF9vcHRpb25zLmRhdGFBdHRyKTsKICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgYWN0aW9uOiAndXBkYXRlT3B0aW9uJywKICAgICAgICBrZXk6IGtleSwKICAgICAgICB2YWx1ZTogZWwuY2hlY2tlZCA/IDEgOiAwCiAgICAgIH0pOwogICAgfSwKCiAgICBjcmVhdGVTdGF0QmxvY2s6IGZ1bmN0aW9uKHBhcmVudCkgewogICAgICB2YXIgaWQgPSAnYmxvY2tTdGF0RW5hYmxlZCc7CiAgICAgIHZhciBub2RlID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwogICAgICBpZiAoIW5vZGUpIHsKICAgICAgICB2YXIgYmxvY2sgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgY2xhc3M6IFsnc2ZoLS1ibG9jaycsIGlkXSwKICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICBtb25vLmNyZWF0ZSgnbGFiZWwnLCB7CiAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnaW5wdXQnLCB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBzZmhPcHRpb246ICdzdGF0RW5hYmxlZCcKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgY2hlY2tlZDogdHJ1ZQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBTdHJpbmcuZnJvbUNoYXJDb2RlKDE2MCksCiAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogJ1dlYiBTdGF0aXN0aWMgVHJhY2tlcicKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9KQogICAgICAgICAgXQogICAgICAgIH0pOwogICAgICAgIHZhciBjbGVhckJsb2NrID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm0gPiAuc2ZoLS1jbGVhcicpOwogICAgICAgIGNsZWFyQmxvY2sucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYmxvY2ssIGNsZWFyQmxvY2spOwogICAgICB9CiAgICB9LAoKICAgIGluaXQ6IGZ1bmN0aW9uKHByZWZlcmVuY2UpIHsKICAgICAgdmFyIHBhcmVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZmgtLW9wdGlvbnMnKTsKCiAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIXByZWZlcmVuY2UuaGFzU292ZXRuaWsgJiYgIXByZWZlcmVuY2UuaGFzRFApIHsKICAgICAgICB2YXIgc292QmxvY2sgPSBwYXJlbnQucXVlcnlTZWxlY3RvcignLmJsb2NrU292ZXRuaWtFbmFibGVkJyk7CiAgICAgICAgaWYgKHNvdkJsb2NrKSB7CiAgICAgICAgICBzb3ZCbG9jay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFwcmVmZXJlbmNlLmhhc0F2aWFCYXIpIHsKICAgICAgICB2YXIgYXZpYUJsb2NrID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5ibG9ja0F2aWFCYXJFbmFibGVkJyk7CiAgICAgICAgaWYgKGF2aWFCbG9jaykgewogICAgICAgICAgYXZpYUJsb2NrLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIXByZWZlcmVuY2Uuc2hvd1VtbXlJdGVtKSB7CiAgICAgICAgdmFyIHVtbXlCbG9jayA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcuYmxvY2tVbW15SW5mbycpOwogICAgICAgIGlmICh1bW15QmxvY2spIHsKICAgICAgICAgIHVtbXlCbG9jay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHByZWZlcmVuY2UuaGFzU3dTdGF0IHx8IHByZWZlcmVuY2UuaGFzRnNTdGF0KSB7CiAgICAgICAgX29wdGlvbnMuY3JlYXRlU3RhdEJsb2NrKHBhcmVudCk7CiAgICAgIH0KCiAgICAgIF9vcHRpb25zLnRyYW5zbGF0ZShwYXJlbnQpOwoKICAgICAgdmFyIGMgPSBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgnZm9ybSBpbnB1dFt0eXBlPSJjaGVja2JveCJdJyk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBlbCA9IGNbaV07CiAgICAgICAgdmFyIG5hbWUgPSBlbC5nZXRBdHRyaWJ1dGUoX29wdGlvbnMuZGF0YUF0dHIpOwogICAgICAgIGlmIChuYW1lICYmIHByZWZlcmVuY2VbbmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZWwuY2hlY2tlZCA9IHByZWZlcmVuY2VbbmFtZV0gIT09IDA7CiAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBfb3B0aW9ucy5vbkNiQ2hhbmdlLCBmYWxzZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodHlwZW9mIEdNX2Rvd25sb2FkICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIHZhciBibG9ja0dtTmF0aXZlRG93bmxvYWQgPSBwYXJlbnQucXVlcnlTZWxlY3RvcignLmJsb2NrR21OYXRpdmVEb3dubG9hZCcpOwogICAgICAgIGlmIChibG9ja0dtTmF0aXZlRG93bmxvYWQpIHsKICAgICAgICAgIGJsb2NrR21OYXRpdmVEb3dubG9hZC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgaGlkZUJsb2NrOiBmdW5jdGlvbihuYW1lLCBoaWRlKSB7CiAgICAgIHZhciBub2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicgKyBfb3B0aW9ucy5jbGFzc1ByZWZpeCArIG5hbWUpOwogICAgICBpZiAobm9kZSkKICAgICAgICBub2RlLnN0eWxlLmRpc3BsYXkgPSBoaWRlID8gJ25vbmUnIDogJyc7CiAgICB9LAoKICAgIHNob3c6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgaGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgfHwgMDsKICAgICAgaWYgKGhlaWdodCA+IDYwMCkgewogICAgICAgIGhlaWdodCA9IDYwMDsKICAgICAgfQogICAgICBTYXZlRnJvbV9VdGlscy5wb3B1cERpdihmdW5jdGlvbihjbnQpIHsKICAgICAgICB2YXIgX2F0b2IgPSBtb25vLmlzVE0gPyB3aW5kb3cuYXRvYiA6IGF0b2I7CiAgICAgICAgY250LmlubmVySFRNTCA9IF9hdG9iKF9vcHRpb25zLmh0bWwpOwogICAgICB9LCBudWxsLCA2NDAsIGhlaWdodCk7CgogICAgICBtb25vLmluaXRHbG9iYWwoZnVuY3Rpb24ocmVzcCkgewogICAgICAgIF9vcHRpb25zLmluaXQobW9uby5nbG9iYWwucHJlZmVyZW5jZSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIF9sYW5ndWFnZUxpc3QuZGUgPSAiJTdCJTBBJTIwJTIyZXh0TmFtZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMEhlbGZlciUyMiU3RCwlMEElMjAlMjJleHREZXNjcmlwdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxhZGVuJTIwU2llJTIwdm9uJTIwWW91VHViZSwlMjBGYWNlYm9vaywlMjBWSy5jb20lMjB1bmQlMjBtZWhyJTIwYWxzJTIwNDAlMjBhbmRlcmVuJTIwU2VpdGVuJTIwbWl0JTIwZWluZW0lMjBLbGljayUyMGhlcnVudGVyLiUyMiU3RCwlMEElMEElMjAlMjJleHROYW1lTGl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMEhlbGZlciUyMExpdGUlMjIlN0QsJTBBJTIwJTIyZXh0RGVzY3JpcHRpb25MaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySGVydW50ZXJsYWRlbiUyMHZvbiUyMEZhY2Vib29rLCUyMFZLLmNvbSUyMHVuZCUyMG1laHIlMjBhbHMlMjA0MCUyMHdlaXRlcmVuJTIwU2VpdGVuJTIwbWl0JTIwZWluZW0lMjBLbGljayUyMGhlcnVudGVyLiUyMiU3RCwlMEElMEElMjAlMjJsYW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyZGUlMjIlN0QsJTBBJTBBJTIwJTIydGl0bGVEZWZhdWx0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwSGVsZmVyJTIyJTdELCUwQSUyMCUyMnRpdGxlRGVzYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBIZWxmZXIlMjBkZWFrdGl2aWVydCUyMiU3RCwlMEElMEElMjAlMjJtZW51RW5hYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQWt0aXZpZXJlbiUyMiU3RCwlMEElMjAlMjJtZW51RGlzYWJsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRlYWt0aXZpZXJlbiUyMiU3RCwlMEElMEElMjAlMjJzaG93QnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRXJ3ZWl0ZXJ1bmdzJTIwS25vcGYlMjBhbnplaWdlbiUyMiU3RCwlMEElMEElMjAlMjJjb3B5JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyS29waWUlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIZXJ1bnRlcmxhZGVuJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJLbGlja2VuJTIwU2llJTIwZGVuJTIwTGluayUyMHclQzMlQTRocmVuZCUyMFNpZSUyMGRpZSUyMEFsdC9FaW5zdGVsbHVuZyUyMG9kZXIlMjBDdHJsL1N0cmclMjBUYXN0ZSUyMGRyJUMzJUJDY2tlbiUyMHp1bSUyMEhlcnVudGVybGFkZW4lMjBkZXIlMjBEYXRlaWVuLiUyMiU3RCwlMEElMjAlMjJub0xpbmtzRm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJLZWluZSUyMExpbmtzJTIwd3VyZGVuJTIwZ2VmdW5kZW4lMjIlN0QsJTBBJTIwJTIybW9yZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1laHIlMjIlN0QsJTBBJTIwJTIyY2xvc2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTY2hsaWUlQzMlOUZlbiUyMiU3RCwlMEElMjAlMjJrYnBzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIya2JwcyUyMiU3RCwlMEElMjAlMjJ3aXRob3V0QXVkaW8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJ3aXRob3V0JTIwYXVkaW8lMjIlN0QsJTBBJTIwJTIyc2l6ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmdyJUMzJUI2JUMzJTlGZSUyMiU3RCwlMEElMEElMjAlMjJzdWJ0aXRsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJVbnRlcnRpdGVsJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyV2llZGVyZ2FibGlzdGUlMjIlN0QsJTBBJTIwJTIyZmlsZWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMaXN0JTIwb2YlMjBmaWxlcyUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFdob2xlUGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEaWUlMjBrb21wbGV0dGUlMjBXaWVkZXJnYWJsaXN0ZSUyMGhlcnVudGVybGFkZW4lMjIlN0QsJTBBJTBBJTIwJTIyZ2V0RmlsZVNpemVUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRhdGVpZ3IlQzMlQjYlQzMlOUZlJTIwYmVzdGltbWVuJTIyJTIwJTdELCUwQSUyMCUyMmdldEZpbGVTaXplRmFpbFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRmVobGVyJTIwYmVpJTIwYmVzdGltbXVuZyUyMGRlciUyMERhdGVpZ3IlQzMlQjYlQzMlOUZlLiUyMEJpdHRlJTIwdmVyc3VjaGVuJTIwU2llJTIwZXMlMjBlcm5ldXQuJTIyJTdELCUwQSUwQSUyMCUyMmxtQnV0dG9uVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIb2xlbiUyMFNpZSUyMHNpY2glMjBlaW5lbiUyMGRpcmVrdGVuJTIwTGluay4lMjIlN0QsJTBBJTBBJTIwJTIyZG93bmxvYWRGcm9tQ3VycmVudFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJadSUyMFNhdmVGcm9tLm5ldCUyMiU3RCwlMEElMjAlMjJ1cGRhdGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpbmtzJTIwYWt0dWFsaXNpZXJlbiUyMiU3RCwlMEElMjAlMjJ1cGRhdGVMaW5rc05vdGlmaWNhdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpbmtzJTIwYWt0dWFsaXNpZXJ0JTIyJTdELCUwQSUyMCUyMmRvd25sb2FkTVAzRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEb3dubG9hZCUyMEF1ZGlvZGF0ZWllbiUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG93bmxvYWQlMjBQbGF5bGlzdCUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRvd25sb2FkJTIwQmlsZGVyJTIyJTdELCUwQSUyMCUyMmluc3RhbGxGdWxsVmVyc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkluc3RhbGwlMjBmdWxsJTIwdmVyc2lvbiUyMiU3RCwlMEElMjAlMjJkaXNhYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVha3RpdmllcmVuJTIyJTdELCUwQSUyMCUyMnNob3dPcHRpb25zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRWluc3RlbGx1bmdlbiUyMiU3RCwlMEElMjAlMjJyZXBvcnRCdWclMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJGZWhsZXIlMjBtZWxkZW4lMjIlN0QsJTBBJTIwJTIyb3BlblBvbGwlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCZWNvbWUlMjBiZXR0ZXIlMjIlN0QsJTBBJTIwJTIyZGlzYWJsZU1vZHVsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkF1ZiUyMGRpZXNlciUyMFdlYnNlaXRlJTIwZGVha3RpdmllcmVuJTIyJTdELCUwQSUyMCUyMmVuYWJsZU1vZHVsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkF1ZiUyMGRpZXNlciUyMFdlYnNlaXRlJTIwYWt0aXZpZXJlbiUyMiU3RCwlMEElMjAlMjJlbmFibGVEaXNhYmxlTW9kdWxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRWluL0F1cyUyMGF1ZiUyMGRpZXNlciUyMFdlYnNlaXRlJTIyJTdELCUwQSUyMCUyMnNob3dIaWRlQnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRXJ3ZWl0ZXJuJTIwRWluLS9BdXNibGVuZGVuJTIyJTdELCUwQSUyMCUyMnVwZGF0ZVRvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVXBkYXRlJTIwYXVmJTIwJTI1ZCUyMiU3RCwlMEElMEElMjAlMjJhYm91dFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlQzMlOUNiZXIlMjIlN0QsJTBBJTIwJTIyYWJvdXRUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMEhlbGZlciUyMiU3RCwlMEElMjAlMjJhYm91dFZlcnNpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJWZXJzaW9uJTIyJTdELCUwQSUyMCUyMmFib3V0RGVzY3JpcHRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIaWxmdCUyMGRlbiUyME51dHplcm4lMjBkaXJla3RlJTIwTGlua3MlMjB6dSUyMEhlcnVudGVybGFkZW4lMjB2b24lMjBtZWhyJTIwYWxzJTIwNDAlMjBXZWJzZWl0ZW4sJTIwaW5rbHVzaXZlJTIwRGFpbHltb3Rpb24uY29tLCUyMFlvdVR1YmUuY29tLCUyMFZLLmNvbSUyMHVuZCUyMHdlaXRlcmVuJTIwenUlMjBiZWtvbW1lbi4lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIaWxmdCUyMGRlbiUyME51dHplcm4lMjBkaXJla3RlJTIwTGlua3MlMjB6dSUyMEhlcnVudGVybGFkZW4lMjB2b24lMjBtZWhyJTIwYWxzJTIwNDAlMjBXZWJzZWl0ZW4sJTIwaW5rbHVzaXZlJTIwRGFpbHltb3Rpb24uY29tLCUyMFZLLmNvbSUyMHVuZCUyMHdlaXRlcmVuJTIwenUlMjBiZWtvbW1lbi4lMjIlN0QsJTBBJTIwJTIyYWJvdXRTdXBwb3J0ZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJVbnRlcnN0JUMzJUJDdHp0ZSUyMFJlc3NvdXJjZW4lMjIlN0QsJTBBJTIwJTIyaG9tZVBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIb21lcGFnZSUyMiU3RCwlMEElMEElMjAlMjJvcHRpb25zVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBIZWxmZXIlMjAtJTIwRWluc3RlbGx1bmdlbiUyMiU3RCwlMEElMjAlMjJvcHRpb25zSGFuZGxlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMaW5rcyUyMGhhbmRoYWJlbiUyMiU3RCwlMEElMjAlMjJvcHRpb25zRmlsZUhvc3RpbmdzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyWnUlMjBEYXRlaWhvc3RlciUyMiU3RCwlMEElMjAlMjJvcHRpb25zTWVkaWFIb3N0aW5ncyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlp1JTIwTWVkaWVuaG9zdGVyJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNNb2R1bGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTW9kdWxlJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNZb3V0dWJlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyWW91VHViZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zWVRIaWRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMaW5rcyUyMGF1c2JsZW5kZW4lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0RhaWx5bW90aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGFpbHltb3Rpb24lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1ZpbWVvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVmltZW8lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0ZhY2Vib29rJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRmFjZWJvb2slMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1NvdW5kY2xvdWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTb3VuZENsb3VkJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNWa29udGFrdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJWSyUyMiU3RCwlMEElMjAlMjJvcHRpb25zT2Rub2tsYXNzbmlraSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk9kbm9rbGFzc25pa2klMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01haWxydSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1veSUyME1pciUyMiU3RCwlMEElMjAlMjJvcHRpb25zSW5zdGFncmFtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySW5zdGFncmFtJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNSdXR1YmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJSdXR1YmUlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0JpdHJhdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCaXRyYXRlJTIwc29mb3J0JTIwemVpZ2VuJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTb3ZldG5pa0VuYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBZHZpc29yJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUluZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUaXBwcyUyMGYlQzMlQkNyJTIwVVZEJTIwZWluYmxlbmRlbiUyMiU3RCwlMEElMjAlMjJvcHRpb25zR21OYXRpdmVEb3dubG9hZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkVyd2VpdGVydGVyJTIwRG93bmxvYWQtTW9kdXMlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1Nob3dVbW15QnRuJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2NoYWx0ZmwlQzMlQTRjaGUlMjBVbW15JTIwYW56ZWlnZW4lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0F2aWFCYXJFbmFibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQ2hlYXAlMjBGbGlnaHRzJTIwQWR2aXNvciUyMiU3RCwlMEElMEElMjAlMjJtZW51RG93bmxvYWRGcm9tQ3VycmVudFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMYWRlbiUyMFNpZSUyMGRpZSUyMERhdGVpZW4lMjBtaXQlMjBTYXZlRnJvbS5uZXQlMjB2b24lMjBkZXIlMjBha3R1ZWxsZW4lMjBTZWl0ZSUyMiU3RCwlMEElMjAlMjJtZW51VXBkYXRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIaWVyJTIwa2xpY2tlbiwlMjB3ZW5uJTIwZGllJTIwRG93bmxvYWQtVGFzdGUlMjBuaWNodCUyMGVyc2NoZWludCUyMiU3RCwlMEElMjAlMjJtZW51RG93bmxvYWRNUDNGaWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFsbGUlMjBhdWYlMjBkaWVzZXIlMjBTZWl0ZSUyMGdlZnVuZGVuZW4lMjBBdWRpb2RhdGVpZW4lMjBoZXJ1bnRlcmxhZGVuJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUGxheWxpc3RlJTIwbWl0JTIwZGVuJTIwTGlua3MlMjB6dSUyMGRlbiUyMEF1ZGlvZGF0ZWllbiUyMGdlbmVyaWVyZW4lMjB1bmQlMjBkb3dubG9hZGVuJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFsbGUlMjBhdWYlMjBkZXIlMjBha3R1ZWxsZW4lMjBTZWl0ZSUyMGdlZnVuZGVuZW4lMjBCaWxkZXIlMjBoZXJ1bnRlcmxhZGVuJTIyJTdELCUwQSUyMCUyMm1lbnVSZXBvcnRCdWclMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTY2hyZWliZW4lMjBTaWUlMjB1bnMsJTIwd2VubiUyMFByb2JsZW1lJTIwYXVmdHJldGVuJTIyJTdELCUwQSUyMCUyMm1lbnVTaG93T3B0aW9ucyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFOL0FVUyUyMHVudGVyc3QlQzMlQkN0enRlJTIwUmVzc291cmNlbiUyMHVuZCUyMEhlbHBlcm9wdGlvbmVuJTIyJTdELCUwQSUyMCUyMm1lbnVFbmFibGVFeHRlbnNpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlMjIlN0QsJTBBJTIwJTIybWVudU9wZW5Qb2xsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTIyJTdELCUwQSUwQSUyMCUyMnF1YWxpdHklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJRdWFsaXQlQzMlQTR0JTIyJTdELCUwQSUyMCUyMnF1YWxpdHlOb3RlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyV2VubiUyMGVzJTIwbmljaHQlMjB1bSUyMFF1YWxpdCVDMyVBNHQlMjBnZWh0LCUyMHdpcmQlMjBkYXMlMjBuJUMzJUE0Y2hzdGUlMjB2ZXJmJUMzJUJDZ2JhcmUlMjBWaWRlbyUyMGhlcnVudGVyZ2VsYWRlbi4lMjIlN0QsJTBBJTIwJTIyZmlsZWxpc3RUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRpZSUyMExpc3RlJTIwZGVyJTIwZ2VmdW5kZW5lbiUyMGRhdGVpZW4lMjIlN0QsJTBBJTIwJTIyZmlsZWxpc3RJbnN0cnVjdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidadW0lMjBIZXJ1bnRlcmxhZGVuJTIwYWxsZXIlMjBkYXRpZW4lMjBrb3BpZXJlbiUyMFNpZSUyMGRpZSUyMGxpc3RlJTIwZGVyJTIwTGlua3MlMjBpbiUyMElocmVuJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRG93bmxvYWRfbWFuYWdlcicsdGV4dDonRG93bmxvYWQlMjBNYW5hZ2VyJyU3RCU3RCwnLiUyMFdlbm4lMjBTaWUlMjBub2NoJTIwa2VpbmVuJTIwRG93bmxvYWQlMjBNYW5hZ2VyJTIwaGFiZW4lMjB3ZSUyMGVtcGZlaGxlbiUyMHdpciUyMElobmVuJTIwZGllJTIwSW5zdGFsbGF0aW9uJTIwZGVzJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly93d3cuZnJlZWRvd25sb2FkbWFuYWdlci5vcmcvJyx0ZXh0OidGcmVlJTIwRG93bmxvYWQlMjBNYW5hZ2VyJyU3RCU3RCwnLiclNUQlMjIlN0QsJTBBJTIwJTIycGxheWxpc3RUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMldpZWRlcmdhYmxpc3RlJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJadXIlMjBXaWVkZXJnYWJlJTIwSWhyZXIlMjBnZXNwZWljaGVydGVuJTIwV2llZGVyZ2FibGlzdGUlMjBrYW5uJTIwZXMlMjBudW4lMjBtaXQlMjBlaW5lbSUyME11c2lrLVBsYXllciUyMGdlJUMzJUI2ZmZuZXQlMjB3ZXJkZW4uJTIyJTdELCUwQSUwQSUyMCUyMnVtbXlTZlRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySEQlMjBvZGVyJTIwTVAzJTIyJTdELCUwQSUyMCUyMnVtbXlNZW51SXRlbSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyJTIwOiUyMCUyMiU1QiU3QnNwYW46JTdCJTdEJTdELCclMjBtaXRoaWxmZSUyMHZvbiUyMFVtbXklMjBoZXJ1bnRlcmxhZGVuJyU1RCUyMiU3RCwlMEElMjAlMjJ1bW15TWVudUluZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUIlN0JwOiU3QnRleHQ6J1NjaG5lbGwlMjB1bmQlMjBlaW5mYWNoJTIwSEQlMjBWaWRlb3MlMjB1bmQlMjBNUDMlMjAlQzMlQkNiZXIlMjBVbW15JTIwVmlkZW8lMjBEb3dubG9hZGVyJTIwaGVydW50ZXJsYWRlbiEnJTdEJTdELCU3QnA6JTdCY2xhc3M6J2NlbnRlcicsYXBwZW5kOiU1QiU3QmE6JTdCY2xhc3M6J2dyZWVuLWJ0bi0yJTIwYXJyb3cnLGhyZWY6JyU3QnVybCU3RCcsdGFyZ2V0OidfYmxhbmsnLHRleHQ6J0pldHp0JTIwaW5zdGFsbGllcmVuJyU3RCU3RCU1RCU3RCU3RCwlN0JwOiU3QmFwcGVuZDolNUInTmFjaCUyMGRlciUyMEluc3RhbGxhdGlvbiUyMHN0YXJ0ZXQlMjBqZWRlcnplaXQlMjBlaW4lMjBEb3dubG9hZCwlMjB3ZW5uJTIwU2llJTIwYXVmJTIwJywlN0JpbWc6JTdCc3JjOicjJyU3RCU3RCwnJTIwa2xpY2tlbiclNUQlN0QlN0QlNUQlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlQzMlOUNiZXJwciVDMyVCQ2ZlbiUyMFNpZSUyMGRpZSUyMEJyb3dzZXJlaW5zdGVsbHVuZ2VuJTIyJTdELCUwQSUyMCUyMndhcm5pbmdQb3B1cERlc2MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEaWUlMjBPcHRpb24lMjAlNUMlMjJKZWRlcyUyME1hbCUyMG5hY2hmcmFnZW4sJTIwd28lMjBlaW5lJTIwRGF0ZWklMjBnZXNwZWljaGVydCUyMHdlcmRlbiUyMHNvbGwlNUMlMjIlMjBtdXNzJTIwZGVha3RpdmllcnQlMjBzZWluLiUyMiU3RCwlMEElMjAlMjJyZWFkTW9yZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1laHIlMjIlN0QsJTBBJTIwJTIybm9XYXJuaW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTmljaHQlMjBiZW5hY2hyaWNodGlnZW4lMjIlN0QsJTBBJTIwJTIyY2FuY2VsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQWJicmVjaGVuJTIyJTdELCUwQSUyMCUyMmNvbnRpbnVlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRm9ydHNldHplbiUyMiU3RCwlMEElMjAlMjJiZWZvcmVEb3dubG9hZFBvcHVwV2FybiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFjaHR1bmchJTIwRGVyJTIwRG93bmxvYWQlMjBrYW5uJTIwbmljaHQlMjBhYmdlYnJvY2hlbiUyMG9kZXIlMjBhbmdlaGFsdGVuJTIwd2VyZGVuLiUyMiU3RCwlMEElMEElMjAlMjJ2a0luZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbmZvJTIyJTdELCUwQSUyMCUyMnZrSW5mb1RpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGF0ZWlnciVDMyVCNiVDMyU5RmUlMjB1bmQlMjBCaXRyYXRlJTIyJTdELCUwQSUyMCUyMnZrTXAzTGlua3NOb3RGb3VuZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpbmtzJTIwenUlMjBNUDMlMjBEYXRlaWVuJTIwd3VyZGVuJTIwbmljaHQlMjBnZWZ1bmRlbiUyMiU3RCwlMEElMjAlMjJ2a1Bob3RvTGlua3NOb3RGb3VuZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBob3RvcyUyMGFyZSUyMG5vdCUyMGZvdW5kJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRQaG90b0FsYnVtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQWxidW0lMjBoZXJ1bnRlcmxhZGVuJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRBbGxQaG90b0FsYnVtcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFsbGUlMjBBbGJlbiUyMGhlcnVudGVybGFkZW4lMjIlN0QsJTBBJTIwJTIydmtGb3VuZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkdlZnVuZGVuZSUyMEZvdG9zJTIyJTdELCUwQSUyMCUyMnZrTm90QXZhaWxhYmxlUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTI1ZCUyMEZvdG8ocyklMjB2b3IlQzMlQkNiZXJnZWhlbmQlMjBuaWNodCUyMHZlcmYlQzMlQkNnYmFyJTIyJTdELCUwQSUyMCUyMnZrRm91bmRMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkdlZnVuZGVuZSUyMExpbmtzJTIyJTdELCUwQSUyMCUyMnZrRm91bmRPZiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMnZvbiUyMiU3RCwlMEElMjAlMjJ2a1Nob3dBcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlplaWdlbiUyMGFscyUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZkxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGlzdGUlMjBkZXIlMjBMaW5rcyUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZkxpbmtzSW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInVW0lMjBhbGxlJTIwRm90b3MlMjBoZXJ1bnRlcnp1bGFkZW4sJTIwa29waWVyZW4lMjBTaWUlMjBkaWUlMjBMaW5rcyUyMGF1cyUyMGRlciUyMExpc3RlJTIwdW5kJTIwZiVDMyVCQ2dlbiUyMFNpZSUyMGRpZXNlJTIwaW4lMjBJaHJlbiUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Rvd25sb2FkX21hbmFnZXInLHRleHQ6J0Rvd25sb2FkJTIwTWFuYWdlciclN0QlN0QsJyUyMGVpbi4lMjBXZW5uJTIwU2llJTIwbm9jaCUyMGtlaW5lbiUyMERvd25sb2FkJTIwTWFuYWdlciUyMGhhYmVuJTIwd2UlMjBlbXBmZWhsZW4lMjB3aXIlMjBJaG5lbiUyMGRpZSUyMEluc3RhbGxhdGlvbiUyMGRlcyUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vd3d3LmZyZWVkb3dubG9hZG1hbmFnZXIub3JnLycsdGV4dDonRnJlZSUyMERvd25sb2FkJTIwTWFuYWdlciclN0QlN0QsJy4nJTVEJTIyJTdELCUwQSUyMCUyMnZrVGFibGVPZlRodW1ibmFpbHMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUYWJlbGxlJTIwZGVyJTIwVGh1bWJuYWlscyUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZlBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpc3RlJTIwZGVyJTIwRm90b3MlMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZQaG90b3NJbnN0cnVjdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMktsaWNrZW4lMjBTaWUlMjBhdWYlMjBlaW4lMjBGb3RvJTIwdW0lMjBlcyUyMGhlcnVudGVyenVsYWRlbi4lMjIlN0QsJTBBJTIwJTIydmtLYnBzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIya2JwcyUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkIlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZUtCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIya0IlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZU1CeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTUIlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZUdCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR0IlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZVRCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVEIlMjIlN0QsJTBBJTIwJTIydmtEb3dubG9hZEZyb21Zb3V0dWJlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ0hlcnVudGVybGFkZW46JTIwJUMzJTk2ZmZuZW4lMjBTaWUlMjAnLCU3QmE6JTdCaHJlZjonJTdCdXJsJTdEJyx0ZXh0OidkaWUlMjBWaWRlbyUyMFNlaXRlJyU3RCU3RCwnJTIwdW5kJTIwZHIlQzMlQkNja2VuJTIwU2llJTIwZGVuJTIwJTVDJTIySGVydW50ZXJsYWRlbiU1QyUyMiUyMEtub3BmJTIwJUMzJUJDYmVyJTIwZGVtJTIwVmlkZW8tU3BpZWxlciclNUQlMjIlN0QsJTBBJTIwJTIydmtGb3VuZEZpbGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGF0ZWllbiUyMGdlZnVuZGVuOiUyMCUyNWQlMjIlN0QsJTBBJTBBJTIwJTIyc2hhcmVJbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkluJTIwJTI1dyUyMHRlaWxlbiUyMiU3RCwlMEElMjAlMjJzb2NpYWxEZXNjJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVyJTIwU2F2ZUZyb20ubmV0JTIwSGVscGVyJTIwZXJtJUMzJUI2Z2xpY2h0JTIwZXMlMjBJaG5lbiUyMERhdGVpZW4lMjBZb3VUdWJlLmNvbSwlMjBGYWNlYm9vay5jb20sJTIwVksuY29tJTIwdW5kJTIwbWVociUyMGFscyUyMDQwJTIwYW5kZXJlJTIwU2VpdGVuJTIwbWl0JTIwZWluZW0lMjBLbGljayUyMGhlcnVudGVyenVsYWRlbiUyMiU3RCwlMEElMEElMjAlMjJ0dXRvcmlhbFMxVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJHdXRlJTIwTmFjaHJpY2h0ZW4hJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzFNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1NhdmVGcm9tLm5ldCUyMEhlbHBlciUyMCcsJTdCaW1nOiUyMCU3QnNyYzolMjAnI2xvZ28nJTdEJTdELCclMjB3dXJkZSUyMGVyZm9sZ3JlaWNoJTIwaW5zdGFsbGllcnQuJTIwSmV0enQlMjBrYW5uc3QlMjBkdWUlMjBqZWRlcyUyMFZpZGVvJTIwbWl0JTIwZWluZW0lMjBLbGljayUyMHZvbiUyMFlvdVR1YmUlMjBoZXJ1bnRlcmxhZGVuJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMxQXJyb3clMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInV2llJTIwZGFzJTIwZ2VodD8nLCU3QmJyOiU3QiU3RCU3RCwnSGllciUyMGVyZiVDMyVBNGhyc3QlMjBkdSUyMGVzJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMyTWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlclQzMlQTRobGUlMjBkYXMlMjBGb3JtYXQlMjBkZXMlMjBWaWRlb3MsJTIwZGFzJTIwZHUlMjBoZXJ1bnRlcmxhZGVuJTIwbSVDMyVCNmNodGVzdCUyMHVuZCUyMGtsaWNrZW4lMjBhdWYlMjAlNUMlMjJIZXJ1bnRlcmxhZGVuJTVDJTIyJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzNIaXN0b3J5JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySGlzdG9yaWUlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTM01haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInRHUlMjBtJUMzJUI2Y2h0ZXN0JTIwZWluJTIwVmlkZW8lMjBhdXMlMjBIaXN0b3JpZSUyMGhlcnVudGVybGFkZW4/JTIwS2xpY2tlbiUyMGVpbmZhY2glMjBpbiUyMGRlciUyMFZvcnNjaGF1JTIwZGVzJTIwenVsZXR6dCUyMGdlc2VoZW5lbiUyMFZpZGVvcyUyMGF1ZiUyMCcsJTIwJTdCaW1nOiUyMCU3QnNyYzolMjAnI2Fycm93JyU3RCU3RCU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFM0TWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidEdSUyMG11c3N0JTIwZGlyJTIwZGFzJTIwVmlkZW8lMjBuaWNodCUyMGFuc2VoZW4lMjAlRTIlODAlOTQlMjBrbGlja2UlMjBlaW5mYWNoJTIwYXVmJTIwJywlMjAlN0JpbWc6JTIwJTdCc3JjOiUyMCcjYXJyb3cnJTdEJTdELCUyMCcsJTIwdyVDMyVBNGhsZSUyMGRpZSUyMFF1YWxpdCVDMyVBNHQlMjB1bmQlMjBsYWRlJTIwZXMlMjBoZXJ1bnRlci4lMjBHYW56JTIwZWluZmFjaCwlMjBvZGVyPyclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVmllbCUyMFNwYSVDMyU5RiUyMG1pdCUyMFNhdmVGcm9tLm5ldCUyMEhlbHBlciElMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNU1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInTm9jaCUyMEZyYWdlbj8lMjBWb3JzY2hsJUMzJUE0Z2U/JTIwV2lsbGtvbW1lbiUyMGF1ZiUyMHVuc2VyZXIlMjAnLCUyMCU3QmE6JTIwJTdCdGV4dDolMjAnU3VwcG9ydC1TZWl0ZScsJTIwaHJlZjolMjAnI3N1cHBvcnQnJTdEJTdEJTIwLCcuJTIwU2NobGllJUMzJTlGZSUyMGRpY2glMjB1bnMlMjBiZWklMjAnLCUyMCU3QmE6JTIwJTdCdGV4dDolMjAnRmFjZWJvb2snLCUyMGhyZWY6JTIwJyNmYiclN0QlN0QlMjAsJyUyMGFuJyU1RCUyMiU3RCwlMEElMEElMjAlMjJ0dXRvcmlhbFRvb2x0aXBUZXh0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ0tsaWNrZW4lMjBTaWUlMjB6dW0lMjAnLCU3QmI6JTIwJTdCdGV4dDolMjAnRG93bmxvYWQnJTdEJTdELCcsJTIwZWluZmFjaCUyMGF1ZiUyMGRpZSUyMFNjaGFsdGZsJUMzJUE0Y2hlJyU1RCUyMiU3RCwlMEElMEElMjAlMjJ1bW15VG9vbHRpcENvbmZpcm0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInSGF0dGVuJTIwU2llJTIwJywlN0JpbWc6JTdCJTdEJTdELCclMjBVbW15JTIwVmlkZW8lMjBEb3dubG9hZGVyJTIwYmVyZWl0cyUyMHp1dm9yJTIwaW5zdGFsbGllcnQ/JyU1RCUyMiU3RCwlMEElMjAlMjJ5ZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJKYSUyMiU3RCwlMEElMjAlMjJubyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk5laW4lMjIlN0QsJTBBJTIwJTIydG9vbHRpcEhpZGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEaWVzZSUyME1lbGR1bmclMjBuaWNodCUyMHdpZWRlciUyMGFuemVpZ2VuJTIyJTdEJTBBJTdEIjsKICBfbGFuZ3VhZ2VMaXN0LmVuID0gIiU3QiUwQSUyMCUyMmV4dE5hbWUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBoZWxwZXIlMjIlN0QsJTBBJTIwJTIyZXh0RGVzY3JpcHRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEb3dubG9hZCUyMFlvdVR1YmUsJTIwRmFjZWJvb2ssJTIwVksuY29tJTIwYW5kJTIwNDArJTIwc2l0ZXMlMjBpbiUyMG9uZSUyMGNsaWNrLiUyMiU3RCwlMEElMEElMjAlMjJleHROYW1lTGl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMGhlbHBlciUyMGxpdGUlMjIlN0QsJTBBJTIwJTIyZXh0RGVzY3JpcHRpb25MaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG93bmxvYWQlMjBGYWNlYm9vaywlMjBWSy5jb20lMjBhbmQlMjA0MCslMjBzaXRlcyUyMGluJTIwb25lJTIwY2xpY2suJTIyJTdELCUwQSUwQSUyMCUyMmxhbmclMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJlbiUyMiU3RCwlMEElMEElMjAlMjJ0aXRsZURlZmF1bHQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBoZWxwZXIlMjIlN0QsJTBBJTIwJTIydGl0bGVEZXNhYmxlZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMGhlbHBlciUyMGRpc2FibGVkJTIyJTdELCUwQSUwQSUyMCUyMm1lbnVFbmFibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJFbmFibGUlMjIlN0QsJTBBJTIwJTIybWVudURpc2FibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEaXNhYmxlJTIyJTdELCUwQSUwQSUyMCUyMnNob3dCdXR0b24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTaG93JTIwZXh0ZW5zaW9uJTIwYnV0dG9uJTIyJTdELCUwQSUwQSUyMCUyMmNvcHklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJDb3B5JTIyJTdELCUwQSUyMCUyMmRvd25sb2FkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG93bmxvYWQlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNsaWNrJTIwdGhlJTIwbGluayUyMHdoaWxlJTIwaG9sZGluZyUyMEFsdC9PcHRpb24lMjBvciUyMEN0cmwlMjBrZXklMjB0byUyMGRvd25sb2FkJTIwdGhlJTIwZmlsZS4lMjIlN0QsJTBBJTIwJTIybm9MaW5rc0ZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTm8lMjBsaW5rcyUyMHdlcmUlMjBmb3VuZCUyMiU3RCwlMEElMjAlMjJtb3JlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTW9yZSUyMiU3RCwlMEElMjAlMjJjbG9zZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNsb3NlJTIyJTdELCUwQSUyMCUyMmticHMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJrYnBzJTIyJTdELCUwQSUyMCUyMndpdGhvdXRBdWRpbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMndpdGhvdXQlMjBhdWRpbyUyMiU3RCwlMEElMjAlMjJzaXplJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyc2l6ZSUyMiU3RCwlMEElMEElMjAlMjJzdWJ0aXRsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTdWJ0aXRsZXMlMjIlN0QsJTBBJTIwJTIycGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQbGF5bGlzdCUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpc3QlMjBvZiUyMGZpbGVzJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkV2hvbGVQbGF5bGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRvd25sb2FkJTIwdGhlJTIwd2hvbGUlMjBwbGF5bGlzdCUyMiU3RCwlMEElMEElMjAlMjJnZXRGaWxlU2l6ZVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR2V0JTIwZmlsZSUyMHNpemUlMjIlMjAlN0QsJTBBJTIwJTIyZ2V0RmlsZVNpemVGYWlsVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJVbmFibGUlMjB0byUyMGdldCUyMHRoZSUyMGZpbGUlMjBzaXplLiUyMFBsZWFzZSUyMHRyeSUyMGFnYWluLiUyMiU3RCwlMEElMEElMjAlMjJsbUJ1dHRvblRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR2V0JTIwYSUyMGRpcmVjdCUyMGxpbmslMjIlN0QsJTBBJTBBJTIwJTIyZG93bmxvYWRGcm9tQ3VycmVudFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJHbyUyMHRvJTIwU2F2ZUZyb20ubmV0JTIyJTdELCUwQSUyMCUyMnVwZGF0ZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUmVmcmVzaCUyMGxpbmtzJTIyJTdELCUwQSUyMCUyMnVwZGF0ZUxpbmtzTm90aWZpY2F0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGlua3MlMjB1cGRhdGVkJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkTVAzRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEb3dubG9hZCUyMGF1ZGlvJTIwZmlsZXMlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRQbGF5bGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRvd25sb2FkJTIwYSUyMHBsYXlsaXN0JTIyJTdELCUwQSUyMCUyMmRvd25sb2FkUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG93bmxvYWQlMjBwaWN0dXJlcyUyMiU3RCwlMEElMjAlMjJpbnN0YWxsRnVsbFZlcnNpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbnN0YWxsJTIwZnVsbCUyMHZlcnNpb24lMjIlN0QsJTBBJTIwJTIyZGlzYWJsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRpc2FibGUlMjIlN0QsJTBBJTIwJTIyc2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTZXR0aW5ncyUyMiU3RCwlMEElMjAlMjJyZXBvcnRCdWclMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJSZXBvcnQlMjBhJTIwYnVnJTIyJTdELCUwQSUyMCUyMm9wZW5Qb2xsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQmVjb21lJTIwYmV0dGVyJTIyJTdELCUwQSUyMCUyMmRpc2FibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEaXNhYmxlJTIwb24lMjB0aGlzJTIwd2Vic2l0ZSUyMiU3RCwlMEElMjAlMjJlbmFibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJFbmFibGUlMjBvbiUyMHRoaXMlMjB3ZWJzaXRlJTIyJTdELCUwQSUyMCUyMmVuYWJsZURpc2FibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUdXJuJTIwT24vT2ZmJTIwb24lMjB0aGlzJTIwd2Vic2l0ZSUyMiU3RCwlMEElMjAlMjJzaG93SGlkZUJ1dHRvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNob3cvaGlkZSUyMGV4dGVuc2lvbiUyMGJ1dHRvbiUyMiU3RCwlMEElMjAlMjJ1cGRhdGVUbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlVwZGF0ZSUyMHRvJTIwJTI1ZCUyMiU3RCwlMEElMEElMjAlMjJhYm91dFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBYm91dCUyMiU3RCwlMEElMjAlMjJhYm91dFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwSGVscGVyJTIyJTdELCUwQSUyMCUyMmFib3V0VmVyc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlZlcnNpb24lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhlbHBzJTIwdXNlcnMlMjB0byUyMGdldCUyMGRpcmVjdCUyMGxpbmtzJTIwdG8lMjBkb3dubG9hZCUyMGZyb20lMjBtb3JlJTIwdGhhbiUyMDQwJTIwd2Vic2l0ZXMsJTIwaW5jbHVkaW5nJTIwRGFpbHltb3Rpb24uY29tLCUyMFlvdVR1YmUuY29tLCUyMFZLLmNvbSUyMGFuZCUyMG90aGVycy4lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIZWxwcyUyMHVzZXJzJTIwdG8lMjBnZXQlMjBkaXJlY3QlMjBsaW5rcyUyMHRvJTIwZG93bmxvYWQlMjBmcm9tJTIwbW9yZSUyMHRoYW4lMjA0MCUyMHdlYnNpdGVzLCUyMGluY2x1ZGluZyUyMERhaWx5bW90aW9uLmNvbSwlMjBWSy5jb20lMjBhbmQlMjBvdGhlcnMuJTIyJTdELCUwQSUyMCUyMmFib3V0U3VwcG9ydGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU3VwcG9ydGVkJTIwcmVzb3VyY2VzJTIyJTdELCUwQSUyMCUyMmhvbWVQYWdlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySG9tZSUyMHBhZ2UlMjIlN0QsJTBBJTBBJTIwJTIyb3B0aW9uc1RpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwSGVscGVyJTIwLSUyMFByZWZlcmVuY2VzJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNIYW5kbGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhhbmRsZSUyMGxpbmtzJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNGaWxlSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUbyUyMGZpbGVob3N0aW5ncyUyMiU3RCwlMEElMjAlMjJvcHRpb25zTWVkaWFIb3N0aW5ncyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRvJTIwbWVkaWFob3N0aW5ncyUyMiU3RCwlMEElMjAlMjJvcHRpb25zTW9kdWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1vZHVsZXMlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1lvdXR1YmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJZb3VUdWJlJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNZVEhpZGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhpZGUlMjBsaW5rcyUyMiU3RCwlMEElMjAlMjJvcHRpb25zRGFpbHltb3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEYWlseW1vdGlvbiUyMiU3RCwlMEElMjAlMjJvcHRpb25zVmltZW8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJWaW1lbyUyMiU3RCwlMEElMjAlMjJvcHRpb25zRmFjZWJvb2slMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJGYWNlYm9vayUyMiU3RCwlMEElMjAlMjJvcHRpb25zU291bmRjbG91ZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNvdW5kQ2xvdWQlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1Zrb250YWt0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlZLJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNPZG5va2xhc3NuaWtpJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyT2Rub2tsYXNzbmlraSUyMiU3RCwlMEElMjAlMjJvcHRpb25zTWFpbHJ1JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTW95JTIwTWlyJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNJbnN0YWdyYW0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbnN0YWdyYW0lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1J1dHViZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlJ1dHViZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zQml0cmF0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNob3clMjBiaXRyYXRlJTIwaW5zdGFudGx5JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTb3ZldG5pa0VuYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBZHZpc29yJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUluZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTaG93JTIwdGlwcyUyMGZvciUyMFVtbXklMjBWaWRlbyUyMERvd25sb2FkZXIlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0dtTmF0aXZlRG93bmxvYWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBZHZhbmNlZCUyMGRvd25sb2FkJTIwbW9kZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zU2hvd1VtbXlCdG4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTaG93JTIwdGhlJTIwVW1teSUyMGJ1dHRvbiUyMiU3RCwlMEElMjAlMjJvcHRpb25zQXZpYUJhckVuYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJDaGVhcCUyMEZsaWdodHMlMjBBZHZpc29yJTIyJTdELCUwQSUwQSUyMCUyMm1lbnVEb3dubG9hZEZyb21DdXJyZW50UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRvd25sb2FkJTIwZmlsZXMlMjBmcm9tJTIwdGhlJTIwY3VycmVudCUyMHBhZ2UlMjB1c2luZyUyMFNhdmVGcm9tLm5ldCUyMiU3RCwlMEElMjAlMjJtZW51VXBkYXRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQcmVzcyUyMGlmJTIwRG93bmxvYWQlMjBidXR0b24lMjBkb2Vzbid0JTIwYXBwZWFyJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZE1QM0ZpbGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG93bmxvYWQlMjBhbGwlMjBhdWRpbyUyMGZpbGVzJTIwZm91bmQlMjBvbiUyMHRoZSUyMGN1cnJlbnQlMjBwYWdlJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR2VuZXJhdGVzJTIwYW5kJTIwZG93bmxvYWRzJTIwdGhlJTIwcGxheWxpc3QlMjBjb25zaXN0aW5nJTIwb2YlMjBsaW5rcyUyMHRvJTIwYXVkaW8lMjBmaWxlcyUyMiU3RCwlMEElMjAlMjJtZW51RG93bmxvYWRQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEb3dubG9hZCUyMGFsbCUyMHBpY3R1cmVzJTIwZm91bmQlMjBvbiUyMHRoZSUyMGN1cnJlbnQlMjBwYWdlJTIyJTdELCUwQSUyMCUyMm1lbnVSZXBvcnRCdWclMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMZXQlMjB1cyUyMGtub3clMjBpZiUyMHlvdSUyMGhhdmUlMjBhbnklMjBwcm9ibGVtcyUyMiU3RCwlMEElMjAlMjJtZW51U2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJPTi9PRkYlMjBzdXBwb3J0ZWQlMjByZXNvdXJjZXMlMjBhbmQlMjBIZWxwZXIlMjBvcHRpb25zJTIyJTdELCUwQSUyMCUyMm1lbnVFbmFibGVFeHRlbnNpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlMjIlN0QsJTBBJTIwJTIybWVudU9wZW5Qb2xsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyV2UlMjB3b3JrJTIwaGFyZCUyMHRvJTIwYmVjb21lJTIwYmV0dGVyLiUyMFBsZWFzZSwlMjBnaXZlJTIwdXMlMjBhJTIwaGFuZCElMjIlN0QsJTBBJTBBJTIwJTIycXVhbGl0eSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlF1YWxpdHklMjIlN0QsJTBBJTIwJTIycXVhbGl0eU5vdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUaGUlMjBiZXN0JTIwYXZhaWxhYmxlJTIwdmlkZW8lMjB3aWxsJTIwYmUlMjBkb3dubG9hZGVkJTIwSWYlMjB0aGVyZSUyMGlzJTIwbm8lMjBjaG9zZW4lMjBxdWFsaXR5LiUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVGhlJTIwbGlzdCUyMG9mJTIwdGhlJTIwZm91bmQlMjBmaWxlcyUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdEluc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1RvJTIwZG93bmxvYWQlMjBhbGwlMjBmaWxlcyUyMGNvcHklMjB0aGUlMjBsaXN0JTIwb2YlMjBsaW5rcyUyMGFuZCUyMHBhc3RlJTIwaXQlMjBpbnRvJTIwdGhlJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRG93bmxvYWRfbWFuYWdlcicsdGV4dDonZG93bmxvYWQlMjBtYW5hZ2VyJyU3RCU3RCwnLiUyMElmJTIweW91JTIwZG8lMjBub3QlMjBoYXZlJTIwYSUyMGRvd25sb2FkJTIwbWFuYWdlciUyMGluc3RhbGxlZCUyMHdlJTIwcmVjb21tZW5kJTIwaW5zdGFsbGluZyUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vd3d3LmZyZWVkb3dubG9hZG1hbmFnZXIub3JnLycsdGV4dDonRnJlZSUyMERvd25sb2FkJTIwTWFuYWdlciclN0QlN0QsJy4nJTVEJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0VGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQbGF5bGlzdCUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdEluc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVG8lMjBwbGF5YmFjayUyMHRoZSUyMHNhdmVkJTIwcGxheWxpc3QlMjBpdCUyMG1heSUyMGJlJTIwbm93JTIwb3BlbmVkJTIwaW4lMjB0aGUlMjBtdXNpYyUyMHBsYXllci4lMjIlN0QsJTBBJTBBJTIwJTIydW1teVNmVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIRCUyMG9yJTIwTVAzJTIyJTdELCUwQSUyMCUyMnVtbXlNZW51SXRlbSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyJTIwOiUyMCUyMiU1QiU3QnNwYW46JTdCJTdEJTdELCclMjB2aWElMjBVbW15JyU1RCUyMiU3RCwlMEElMjAlMjJ1bW15TWVudUluZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUIlN0JwOiU3QnRleHQ6J0Zhc3QlMjBhbmQlMjBlYXN5JTIwZG93bmxvYWQlMjBIRCUyMHZpZGVvcyUyMGFuZCUyME1QMyUyMHZpYSUyMFVtbXklMjBWaWRlbyUyMERvd25sb2FkZXIhJyU3RCU3RCwlN0JwOiU3QmNsYXNzOidjZW50ZXInLGFwcGVuZDolNUIlN0JhOiU3QmNsYXNzOidncmVlbi1idG4tMiUyMGFycm93JyxocmVmOiclN0J1cmwlN0QnLHRhcmdldDonX2JsYW5rJyx0ZXh0OidJbnN0YWxsJTIwTm93JyU3RCU3RCU1RCU3RCU3RCwlN0JwOiU3QmFwcGVuZDolNUInV2hlbiUyMGluc3RhbGxlZCwlMjBhJTIwZG93bmxvYWQlMjB3aWxsJTIwc3RhcnQlMjBhbnl0aW1lJTIweW91JTIwY2xpY2slMjBvbiUyMCcsJTdCaW1nOiU3QnNyYzonIyclN0QlN0QlNUQlN0QlN0QlNUQlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJDaGVjayUyMGJyb3dzZXIlMjBzZXR0aW5ncyUyMiU3RCwlMEElMjAlMjJ3YXJuaW5nUG9wdXBEZXNjJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVGhlJTIwb3B0aW9uJTIwJTVDJTIyQWx3YXlzJTIwYXNrJTIwbWUlMjB3aGVyZSUyMHRvJTIwc2F2ZSUyMGZpbGVzJTVDJTIyJTIwbXVzdCUyMGJlJTIwdHVybmVkJTIwb2ZmLiUyMiU3RCwlMEElMjAlMjJyZWFkTW9yZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1vcmUlMjIlN0QsJTBBJTIwJTIybm9XYXJuaW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG9uJ3QlMjBub3RpZnklMjIlN0QsJTBBJTIwJTIyY2FuY2VsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQ2FuY2VsJTIyJTdELCUwQSUyMCUyMmNvbnRpbnVlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQ29udGludWUlMjIlN0QsJTBBJTIwJTIyYmVmb3JlRG93bmxvYWRQb3B1cFdhcm4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJXYXJuaW5nISUyMERvd25sb2FkaW5nJTIwY2Fubm90JTIwYmUlMjBjYW5jZWxlZCUyMG9yJTIwc3VzcGVuZGVkLiUyMiU3RCwlMEElMEElMjAlMjJ2a0luZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbmZvJTIyJTdELCUwQSUyMCUyMnZrSW5mb1RpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRmlsZSUyMHNpemUlMjBhbmQlMjBiaXRyYXRlJTIyJTdELCUwQSUyMCUyMnZrTXAzTGlua3NOb3RGb3VuZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpbmtzJTIwdG8lMjBNUDMlMjBmaWxlcyUyMGFyZSUyMG5vdCUyMGZvdW5kJTIyJTdELCUwQSUyMCUyMnZrUGhvdG9MaW5rc05vdEZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUGhvdG9zJTIwYXJlJTIwbm90JTIwZm91bmQlMjIlN0QsJTBBJTIwJTIydmtEb3dubG9hZFBob3RvQWxidW0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEb3dubG9hZCUyMGFsYnVtJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRBbGxQaG90b0FsYnVtcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRvd25sb2FkJTIwYWxsJTIwYWxidW1zJTIyJTdELCUwQSUyMCUyMnZrRm91bmRQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJGb3VuZCUyMHBob3RvcyUyMiU3RCwlMEElMjAlMjJ2a05vdEF2YWlsYWJsZVBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiUyNWQlMjBwaG90b3MlMjBhcmUlMjB0ZW1wb3JhcmlseSUyMHVuYXZhaWxhYmxlJTIyJTdELCUwQSUyMCUyMnZrRm91bmRMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkZvdW5kJTIwbGlua3MlMjIlN0QsJTBBJTIwJTIydmtGb3VuZE9mJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyb2YlMjIlN0QsJTBBJTIwJTIydmtTaG93QXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTaG93JTIwYXMlMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpc3QlMjBvZiUyMGxpbmtzJTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mTGlua3NJbnN0cnVjdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidUbyUyMGRvd25sb2FkJTIwYWxsJTIwcGhvdG9zJTIwY29weSUyMHRoZSUyMGxpc3QlMjBvZiUyMGxpbmtzJTIwYW5kJTIwcGFzdGUlMjBpdCUyMGludG8lMjB0aGUlMjAnLCU3QmE6JTdCaHJlZjonaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb3dubG9hZF9tYW5hZ2VyJyx0ZXh0Oidkb3dubG9hZCUyMG1hbmFnZXInJTdEJTdELCcuJTIwSWYlMjB5b3UlMjBkbyUyMG5vdCUyMGhhdmUlMjBhJTIwZG93bmxvYWQlMjBtYW5hZ2VyJTIwaW5zdGFsbGVkJTIwd2UlMjByZWNvbW1lbmQlMjBpbnN0YWxsaW5nJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly93d3cuZnJlZWRvd25sb2FkbWFuYWdlci5vcmcvJyx0ZXh0OidGcmVlJTIwRG93bmxvYWQlMjBNYW5hZ2VyJyU3RCU3RCwnLiclNUQlMjIlN0QsJTBBJTIwJTIydmtUYWJsZU9mVGh1bWJuYWlscyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRhYmxlJTIwb2YlMjB0aHVtYm5haWxzJTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGlzdCUyMG9mJTIwcGhvdG9zJTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mUGhvdG9zSW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJDbGljayUyMG9uJTIwdGhlJTIwcGhvdG8lMjB0byUyMGRvd25sb2FkJTIwaXQuJTIyJTdELCUwQSUyMCUyMnZrS2JwcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmticHMlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZUJ5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVLQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmtCJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVNQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1CJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVHQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkdCJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVUQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRCJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRGcm9tWW91dHViZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidEb3dubG9hZDolMjBvcGVuJTIwJywlN0JhOiU3QmhyZWY6JyU3QnVybCU3RCcsdGV4dDondGhlJTIwdmlkZW8lMjBwYWdlJyU3RCU3RCwnJTIwYW5kJTIwcHJlc3MlMjB0aGUlMjAlNUMlMjJEb3dubG9hZCU1QyUyMiUyMGJ1dHRvbiUyMGFib3ZlJTIwdGhlJTIwcGxheWVyJyU1RCUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJGaWxlcyUyMGZvdW5kOiUyMCUyNWQlMjIlN0QsJTBBJTBBJTIwJTIyc2hhcmVJbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNoYXJlJTIwb24lMjAlMjV3JTIyJTdELCUwQSUyMCUyMnNvY2lhbERlc2MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBoZWxwZXIlMjBlbmFibGVzJTIweW91JTIwdG8lMjBkb3dubG9hZCUyMGZpbGVzJTIwZnJvbSUyMFlvdVR1YmUuY29tLCUyMEZhY2Vib29rLmNvbSwlMjBWSy5jb20lMjBhbmQlMjBtb3JlJTIwdGhhbiUyMDQwJTIwb3RoZXIlMjBqdXN0JTIwaW4lMjBvbmUlMjBjbGljayUyMGZvciUyMGZyZWUlMjIlN0QsJTBBJTBBJTIwJTIydHV0b3JpYWxTMVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR29vZCUyMG5ld3MhJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzFNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1NhdmVGcm9tLm5ldCUyMEhlbHBlciUyMCcsJTdCaW1nOiUyMCU3QnNyYzolMjAnI2xvZ28nJTdEJTdELCclMjBoYXMlMjBiZWVuJTIwc3VjY2Vzc2Z1bGx5JTIwaW5zdGFsbGVkJTIwYW5kJTIwbm93JTIweW91JTIwY2FuJTIwZG93bmxvYWQlMjBhbnklMjB2aWRlbyUyMGZyb20lMjBZb3VUdWJlJTIwaW4lMjBvbmUlMjBjbGljayclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTMUFycm93JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1dhbnQlMjB0byUyMGtub3clMjBob3c/JywlN0JicjolN0IlN0QlN0QsJ0NsaWNrJTIwaGVyZSclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTMk1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUbyUyMGRvd25sb2FkJTIwYSUyMHZpZGVvJTIwY2hvb3NlJTIwYSUyMGZvcm1hdCUyMGFuZCUyMGNsaWNrJTIwdGhlJTIwJTVDJTIyRG93bmxvYWQlNUMlMjIlMjBidXR0b24lMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTM0hpc3RvcnklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIaXN0b3J5JTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzNNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ0RvJTIweW91JTIwd2FudCUyMHRvJTIwZG93bmxvYWQlMjBhJTIwdmlkZW8lMjBmcm9tJTIwSGlzdG9yeT8nLCU3QmJyOiU3QiU3RCU3RCwnSnVzdCUyMGNsaWNrJTIwJywlMjAlN0JpbWc6JTIwJTdCc3JjOiUyMCcjYXJyb3cnJTdEJTdELCclMjBvbiUyMHRoZSUyMHByZXZpZXclMjBvZiUyMHRoZSUyMHByZXZpb3VzbHklMjB3YXRjaGVkJTIwdmlkZW8nJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzRNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ05vJTIwbmVlZCUyMHRvJTIwd2F0Y2glMjBhJTIwdmlkZW8lMjAlRTIlODAlOTQlMjBqdXN0JTIwY2xpY2slMjBvbiUyMCcsJTIwJTdCaW1nOiUyMCU3QnNyYzolMjAnI2Fycm93JyU3RCU3RCwnLCUyMGNob29zZSUyMHRoZSUyMHF1YWxpdHksJTIwYW5kJTIwZG93bmxvYWQuJTIwUXVpdGUlMjBlYXN5LCUyMGlzbiVFMiU4MCU5OXQlMjBpdD8nJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzVUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkVuam95JTIwU2F2ZUZyb20ubmV0JTIwSGVscGVyISUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFM1TWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidTdGlsbCUyMGhhdmUlMjBxdWVzdGlvbnM/JTIwV2FudCUyMHRvJTIwc2hhcmUlMjB5b3VyJTIwaWRlYXM/JTIwV2VsY29tZSUyMHRvJTIwJywlN0JhOiUyMCU3QnRleHQ6JTIwJ291ciUyMHN1cHBvcnQlMjBwYWdlJywlMjBocmVmOiUyMCcjc3VwcG9ydCclN0QlN0QsJyUyMG9yJTIwam9pbiUyMHVzJTIwb24lMjAnLCUyMCU3QmE6JTIwJTdCdGV4dDolMjAnRmFjZWJvb2snLCUyMGhyZWY6JTIwJyNmYiclN0QlN0QlNUQlMjIlN0QsJTBBJTBBJTIwJTIydHV0b3JpYWxUb29sdGlwVGV4dCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidKdXN0JTIwY2xpY2slMjB0aGUlMjBidXR0b24lMjB0byUyMCcsJTdCYjolMjAlN0J0ZXh0OiUyMCdkb3dubG9hZCclN0QlN0QlNUQlMjIlN0QsJTBBJTBBJTIwJTIydW1teVRvb2x0aXBDb25maXJtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ0hhdmUlMjB5b3UlMjBhbHJlYWR5JTIwaW5zdGFsbGVkJywlN0JicjolN0IlN0QlN0QsJTdCaW1nOiU3QiU3RCU3RCwnJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMGVhcmxpZXI/JyU1RCUyMiU3RCwlMEElMjAlMjJ5ZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJZZXMlMjIlN0QsJTBBJTIwJTIybm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJObyUyMiU3RCwlMEElMjAlMjJ0b29sdGlwSGlkZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRvJTIwbm90JTIwc2hvdyUyMHRoaXMlMjBtZXNzYWdlJTIwYWdhaW4lMjIlN0QlMEElN0QiOwogIF9sYW5ndWFnZUxpc3QuZXMgPSAiJTdCJTBBJTIwJTIyZXh0TmFtZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMGhlbHBlciUyMiU3RCwlMEElMjAlMjJleHREZXNjcmlwdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRlc2NhcmdhcyUyMGRlc2RlJTIwWW91VHViZSwlMjBGYWNlYm9vaywlMjBWSy5jb20lMjB5JTIwNDArJTIwc2l0aW9zJTIwZW4lMjB1biUyMHMlQzMlQjNsbyUyMGNsaWMuJTIyJTdELCUwQSUwQSUyMCUyMmV4dE5hbWVMaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwaGVscGVyJTIwbGl0ZSUyMiU3RCwlMEElMjAlMjJleHREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEZXNjYXJnYXMlMjBkZXNkZSUyMEZhY2Vib29rLCUyMFZLLmNvbSUyMHklMjA0MCslMjBzaXRpb3MlMjBlbiUyMHVuJTIwcyVDMyVCM2xvJTIwY2xpYy4lMjIlN0QsJTBBJTBBJTIwJTIybGFuZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmVzJTIyJTdELCUwQSUwQSUyMCUyMnRpdGxlRGVmYXVsdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMGhlbHBlciUyMiU3RCwlMEElMjAlMjJ0aXRsZURlc2FibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwaGVscGVyJTIwZGVzaGFiaWxpdGFkbyUyMiU3RCwlMEElMEElMjAlMjJtZW51RW5hYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySGFiaWxpdGFyJTIyJTdELCUwQSUyMCUyMm1lbnVEaXNhYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVzaGFiaWxpdGFyJTIyJTdELCUwQSUwQSUyMCUyMnNob3dCdXR0b24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNb3N0cmFyJTIwYm90JUMzJUIzbiUyMGRlJTIwZXh0ZW5zaSVDMyVCM24lMjIlN0QsJTBBJTBBJTIwJTIyY29weSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNvcGlhciUyMiU3RCwlMEElMjAlMjJkb3dubG9hZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRlc2NhcmdhciUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySGFnYSUyMGNsaWMlMjBlbiUyMGVsJTIwZW5sYWNlJTIwbWllbnRyYXMlMjBwcmVzaW9uYSUyMGxhJTIwdGVjbGElMjBBbHQvT3BjaSVDMyVCM24lMjBvJTIwQ3RybCUyMHBhcmElMjBkZXNjYXJnYXIlMjBlbCUyMGFyY2hpdm8uJTIyJTdELCUwQSUyMCUyMm5vTGlua3NGb3VuZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk5vJTIwc2UlMjBoYW4lMjBlbmNvbnRyYWRvJTIwZW5sYWNlcyUyMiU3RCwlMEElMjAlMjJtb3JlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTSVDMyVBMXMlMjIlN0QsJTBBJTIwJTIyY2xvc2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJDZXJyYXIlMjIlN0QsJTBBJTIwJTIya2JwcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmticHMlMjIlN0QsJTBBJTIwJTIyd2l0aG91dEF1ZGlvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyc2luJTIwYXVkaW8lMjIlN0QsJTBBJTIwJTIyc2l6ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMnRhbWElQzMlQjFvJTIyJTdELCUwQSUwQSUyMCUyMnN1YnRpdGxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlN1YnQlQzMlQUR0dWxvcyUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpc3RhJTIwZGUlMjByZXByb2R1Y2NpJUMzJUIzbiUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpc3RhJTIwZGUlMjBhcmNoaXZvcyUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFdob2xlUGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEZXNjYXJnYXIlMjB0b2RhJTIwbGElMjBsaXN0YSUyMGRlJTIwcmVwcm9kdWNjaSVDMyVCM24lMjIlN0QsJTBBJTBBJTIwJTIyZ2V0RmlsZVNpemVUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk9idGVuZXIlMjB0YW1hJUMzJUIxbyUyMGRlJTIwYXJjaGl2byUyMiUyMCU3RCwlMEElMjAlMjJnZXRGaWxlU2l6ZUZhaWxUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk5vJTIwc2UlMjBwdWRvJTIwb2J0ZW5lciUyMGVsJTIwdGFtYSVDMyVCMW8lMjBkZWwlMjBhcmNoaXZvLiUyMFBvciUyMGZhdm9yLCUyMGludCVDMyVBOW50ZWxvJTIwZGUlMjBudWV2by4lMjIlN0QsJTBBJTBBJTIwJTIybG1CdXR0b25UaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk9idGVuZXIlMjB1biUyMGVubGFjZSUyMGRpcmVjdG8lMjIlN0QsJTBBJTBBJTIwJTIyZG93bmxvYWRGcm9tQ3VycmVudFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJciUyMGElMjBTYXZlRnJvbS5uZXQlMjIlN0QsJTBBJTIwJTIydXBkYXRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBY3R1YWxpemFyJTIwZW5sYWNlcyUyMiU3RCwlMEElMjAlMjJ1cGRhdGVMaW5rc05vdGlmaWNhdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkVubGFjZXMlMjBhY3R1YWxpemFkb3MlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRNUDNGaWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRlc2NhcmdhciUyMGFyY2hpdm9zJTIwZGUlMjBhdWRpbyUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVzY2FyZ2FyJTIwdW5hJTIwbGlzdGElMjBkZSUyMHJlcHJvZHVjY2klQzMlQjNuJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVzY2FyZ2FyJTIwaW0lQzMlQTFnZW5lcyUyMiU3RCwlMEElMjAlMjJpbnN0YWxsRnVsbFZlcnNpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbnN0YWxhciUyMGxhJTIwdmVyc2klQzMlQjNuJTIwY29tcGxldGElMjIlN0QsJTBBJTIwJTIyZGlzYWJsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRlc2hhYmlsaXRhciUyMiU3RCwlMEElMjAlMjJzaG93T3B0aW9ucyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFqdXN0ZXMlMjIlN0QsJTBBJTIwJTIycmVwb3J0QnVnJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySW5mb3JtYXIlMjBzb2JyZSUyMHVuJTIwcHJvYmxlbWElMjIlN0QsJTBBJTIwJTIyb3BlblBvbGwlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNZWpvcmFyJTIyJTdELCUwQSUyMCUyMmRpc2FibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEZXNhY3RpdmFyJTIwZW4lMjBlc3RlJTIwc2l0aW8lMjB3ZWIlMjIlN0QsJTBBJTIwJTIyZW5hYmxlTW9kdWxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQWN0aXZhciUyMGVuJTIwZXN0ZSUyMHNpdGlvJTIwd2ViJTIyJTdELCUwQSUyMCUyMmVuYWJsZURpc2FibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBY3Rpdi4vRGVzYWN0aXYuJTIwZW4lMjBlc3RhJTIwd2ViJTIyJTdELCUwQSUyMCUyMnNob3dIaWRlQnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTW9zdHJhci9vY3VsdGFyJTIwYm90JUMzJUIzbiUyMGV4dGVucyUyMiU3RCwlMEElMjAlMjJ1cGRhdGVUbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFjdHVhbGl6YXIlMjBhJTIwbGElMjAlMjVkJTIyJTdELCUwQSUwQSUyMCUyMmFib3V0UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFjZXJjYSUyMGRlJTIyJTdELCUwQSUyMCUyMmFib3V0VGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBIZWxwZXIlMjIlN0QsJTBBJTIwJTIyYWJvdXRWZXJzaW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVmVyc2klQzMlQjNuJTIyJTdELCUwQSUyMCUyMmFib3V0RGVzY3JpcHRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBeXVkYSUyMGElMjBsb3MlMjB1c3VhcmlvcyUyMGElMjBvYnRlbmVyJTIwZW5sYWNlcyUyMGRpcmVjdG9zJTIwcGFyYSUyMGRlc2NhcmdhciUyMGRlc2RlJTIwbSVDMyVBMXMlMjBkZSUyMDQwJTIwc2l0aW9zJTIwd2ViLCUyMGluY2x1aWRvcyUyMERhaWx5bW90aW9uLmNvbSwlMjBZb3VUdWJlLmNvbSwlMjBWSy5jb20lMjB5JTIwb3Ryb3MuJTIyJTdELCUwQSUyMCUyMmFib3V0RGVzY3JpcHRpb25MaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQXl1ZGElMjBhJTIwbG9zJTIwdXN1YXJpb3MlMjBhJTIwb2J0ZW5lciUyMGVubGFjZXMlMjBkaXJlY3RvcyUyMHBhcmElMjBkZXNjYXJnYXIlMjBkZXNkZSUyMG0lQzMlQTFzJTIwZGUlMjA0MCUyMHNpdGlvcyUyMHdlYiwlMjBpbmNsdWlkb3MlMjBEYWlseW1vdGlvbi5jb20sJTIwVksuY29tJTIweSUyMG90cm9zLiUyMiU3RCwlMEElMjAlMjJhYm91dFN1cHBvcnRlZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlJlY3Vyc29zJTIwYWRtaXRpZG9zJTIyJTdELCUwQSUyMCUyMmhvbWVQYWdlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUCVDMyVBMWdpbmElMjBkZSUyMGluaWNpbyUyMiU3RCwlMEElMEElMjAlMjJvcHRpb25zVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBIZWxwZXIlMjAtJTIwUHJlZmVyZW5jaWFzJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNIYW5kbGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1hbmVqYXIlMjBlbmxhY2VzJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNGaWxlSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBJTIwc2Vydmlkb3JlcyUyMGRlJTIwYXJjaGl2b3MlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01lZGlhSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBJTIwc2Vydmlkb3JlcyUyMG11bHRpbWVkaWElMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01vZHVsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNJUMzJUIzZHVsb3MlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1lvdXR1YmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJZb3VUdWJlJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNZVEhpZGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk9jdWx0YXIlMjBlbmxhY2VzJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNEYWlseW1vdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRhaWx5bW90aW9uJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNWaW1lbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlZpbWVvJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNGYWNlYm9vayUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkZhY2Vib29rJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTb3VuZGNsb3VkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU291bmRDbG91ZCUyMiU3RCwlMEElMjAlMjJvcHRpb25zVmtvbnRha3RlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVkslMjIlN0QsJTBBJTIwJTIyb3B0aW9uc09kbm9rbGFzc25pa2klMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJPZG5va2xhc3NuaWtpJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNNYWlscnUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNb3klMjBNaXIlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0luc3RhZ3JhbSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkluc3RhZ3JhbSUyMiU3RCwlMEElMjAlMjJvcHRpb25zUnV0dWJlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUnV0dWJlJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNCaXRyYXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTW9zdHJhciUyMHZlbG9jaWRhZCUyMGRlJTIwYml0cyUyMGluc3RhbnQlQzMlQTFuZWFtZW50ZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zU292ZXRuaWtFbmFibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQ29uc2VqZXJvJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUluZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNdWVzdHJhJTIwY29uc2Vqb3MlMjBwYXJhJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMiU3RCwlMEElMjAlMjJvcHRpb25zR21OYXRpdmVEb3dubG9hZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk0lQzMlQjN1ZGxvJTIwZGUlMjBkZXNjYXJnYSUyMGF2YW56YWRhJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUJ0biUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1vc3RyYXIlMjBlbCUyMGJvdCVDMyVCM24lMjBVbW15JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNBdmlhQmFyRW5hYmxlZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNoZWFwJTIwRmxpZ2h0cyUyMEFkdmlzb3IlMjIlN0QsJTBBJTBBJTIwJTIybWVudURvd25sb2FkRnJvbUN1cnJlbnRQYWdlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVzY2FyZ2FyJTIwYXJjaGl2b3MlMjBkZSUyMGxhJTIwcCVDMyVBMWdpbmElMjBhY3R1YWwlMjB1c2FuZG8lMjBTYXZlRnJvbS5uZXQlMjIlN0QsJTBBJTIwJTIybWVudVVwZGF0ZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUHVsc2UlMjBzaSUyMG5vJTIwYXBhcmVjZSUyMGVsJTIwYm90JUMzJUIzbiUyMERlc2NhcmdhciUyMiU3RCwlMEElMjAlMjJtZW51RG93bmxvYWRNUDNGaWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRlc2NhcmdhciUyMHRvZG9zJTIwbG9zJTIwYXJjaGl2b3MlMjBkZSUyMGF1ZGlvJTIwZGUlMjBsYSUyMHAlQzMlQTFnaW5hJTIwYWN0dWFsJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR2VuZXJhJTIweSUyMGRlc2NhcmdhJTIwbGElMjBsaXN0YSUyMGRlJTIwcmVwcm9kdWNjaSVDMyVCM24lMjBxdWUlMjBjb25zaXN0ZSUyMGVuJTIwZW5sYWNlcyUyMGElMjBhcmNoaXZvcyUyMGRlJTIwYXVkaW8lMjIlN0QsJTBBJTIwJTIybWVudURvd25sb2FkUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVzY2FyZ2FyJTIwdG9kYXMlMjBsYXMlMjBpbSVDMyVBMWdlbmVzJTIwZW5jb250cmFkYXMlMjBlbiUyMGxhJTIwcCVDMyVBMWdpbmElMjBhY3R1YWwlMjIlN0QsJTBBJTIwJTIybWVudVJlcG9ydEJ1ZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkglQzMlQTFnYW5vcyUyMHNhYmVyJTIwc2klMjB0aWVuZSUyMGFsZyVDMyVCQW4lMjBwcm9ibGVtYSUyMiU3RCwlMEElMjAlMjJtZW51U2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBQ1RJVkFSL0RFU0FDVElWQVIlMjByZWN1cnNvcyUyMGFkbWl0aWRvcyUyMHklMjBvcGNpb25lcyUyMGRlbCUyMEhlbHBlciUyMiU3RCwlMEElMjAlMjJtZW51RW5hYmxlRXh0ZW5zaW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTIyJTdELCUwQSUyMCUyMm1lbnVPcGVuUG9sbCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRyYWJhamFtb3MlMjBkdXJvJTIwcGFyYSUyMG1lam9yYXIuJTIwJUMyJUExJUMzJTg5Y2hlbm9zJTIwdW5hJTIwbWFubyElMjIlN0QsJTBBJTBBJTIwJTIycXVhbGl0eSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNhbGlkYWQlMjIlN0QsJTBBJTIwJTIycXVhbGl0eU5vdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTaSUyMG5vJTIwc2UlMjBlbGlnZSUyMG5pbmd1bmElMjBjYWxpZGFkLCUyMHNlJTIwZGVzY2FyZ2FyJUMzJUExJTIwZWwlMjBtZWpvciUyMHYlQzMlQURkZW8lMjBkaXNwb25pYmxlLiUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGElMjBsaXN0YSUyMGRlJTIwbG9zJTIwYXJjaGl2b3MlMjBlbmNvbnRyYWRvcyUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdEluc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1BhcmElMjBkZXNjYXJnYXIlMjB0b2RvcyUyMGxvcyUyMGFyY2hpdm9zLCUyMGNvcGllJTIwbGElMjBsaXN0YSUyMGRlJTIwZW5sYWNlcyUyMHklMjBwJUMzJUE5Z3VlbGElMjBlbiUyMGVsJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRG93bmxvYWRfbWFuYWdlcicsdGV4dDonZ2VzdG9yJTIwZGUlMjBkZXNjYXJnYXMnJTdEJTdELCcuJTIwU2klMjBubyUyMHRpZW5lJTIwaW5zdGFsYWRvJTIwdW4lMjBnZXN0b3IlMjBkZSUyMGRlc2NhcmdhcywlMjBsZSUyMHJlY29tZW5kYW1vcyUyMHF1ZSUyMGluc3RhbGUlMjAnLCU3QmE6JTdCaHJlZjonaHR0cDovL3d3dy5mcmVlZG93bmxvYWRtYW5hZ2VyLm9yZy8nLHRleHQ6J0ZyZWUlMjBEb3dubG9hZCUyME1hbmFnZXInJTdEJTdELCcuJyU1RCUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGlzdGElMjBkZSUyMHJlcHJvZHVjY2klQzMlQjNuJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQYXJhJTIwcmVwcm9kdWNpciUyMGxhJTIwbGlzdGElMjBkZSUyMHJlcHJvZHVjY2klQzMlQjNuJTIwZ3VhcmRhZGEsJTIwcHVlZGUlMjBhYnJpcmxhJTIwYWhvcmElMjBlbiUyMGVsJTIwcmVwcm9kdWN0b3IlMjBkZSUyMG0lQzMlQkFzaWNhLiUyMiU3RCwlMEElMEElMjAlMjJ1bW15U2ZUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhEJTIwbyUyME1QMyUyMiU3RCwlMEElMjAlMjJ1bW15TWVudUl0ZW0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMiUyMDolMjAlMjIlNUIlN0JzcGFuOiU3QiU3RCU3RCwnJTIwdmlhJTIwVW1teSclNUQlMjIlN0QsJTBBJTIwJTIydW1teU1lbnVJbmZvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJTdCcDolN0J0ZXh0OidJbnN0YWxlJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMHklMjBkZXNjYXJndWUlMjBzdXMlMjB2JUMzJUFEZGVvcyUyMGZhdm9yaXRvcyUyMGVuJTIwSEQlMjBvJTIwTVAzLiclN0QlN0QsJTdCcDolN0JjbGFzczonY2VudGVyJyxhcHBlbmQ6JTVCJTdCYTolN0JjbGFzczonZ3JlZW4tYnRuLTIlMjBhcnJvdycsaHJlZjonJTdCdXJsJTdEJyx0YXJnZXQ6J19ibGFuaycsdGV4dDonRGVzY2FyZ2FyJyU3RCU3RCU1RCU3RCU3RCwlN0JwOiU3QmFwcGVuZDolNUInRGVzcHUlQzMlQTlzJTIwZGUlMjBsYSUyMGluc3RhbGFjaSVDMyVCM24sJTIwc2UlMjBpbmljaWFyJUMzJUExJTIwdW5hJTIwZGVzY2FyZ2ElMjBhdXRvbSVDMyVBMXRpY2FtZW50ZSUyMHNpZW1wcmUlMjBxdWUlMjBoYWdhJTIwY2xpYyUyMGVuJTIwJywlN0JpbWc6JTdCc3JjOicjJyU3RCU3RCU1RCU3RCU3RCU1RCUyMiU3RCwlMEElMjAlMjJ3YXJuaW5nUG9wdXBUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNvbXBydWViZSUyMGxhJTIwY29uZmlndXJhY2klQzMlQjNuJTIwZGUlMjBzdSUyMG5hdmVnYWRvciUyMiU3RCwlMEElMjAlMjJ3YXJuaW5nUG9wdXBEZXNjJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGElMjBvcGNpJUMzJUIzbiUyMCU1QyUyMlByZWd1bnRhcm1lJTIwc2llbXByZSUyMGQlQzMlQjNuZGUlMjBndWFyZGFyJTIwbG9zJTIwYXJjaGl2b3MlNUMlMjIlMjBkZWJlJTIwZXN0YXIlMjBkZXNhY3RpdmFkYS4lMjIlN0QsJTBBJTIwJTIycmVhZE1vcmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNJUMzJUExcyUyMiU3RCwlMEElMjAlMjJub1dhcm5pbmclMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJObyUyMG5vdGlmaWNhciUyMiU3RCwlMEElMjAlMjJjYW5jZWwlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJDYW5jZWxhciUyMiU3RCwlMEElMjAlMjJjb250aW51ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNvbnRpbnVhciUyMiU3RCwlMEElMjAlMjJiZWZvcmVEb3dubG9hZFBvcHVwV2FybiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVDMiVBMUFkdmVydGVuY2lhISUyMExhJTIwZGVzY2FyZ2ElMjBubyUyMHNlJTIwcHVlZGUlMjBjYW5jZWxhciUyMG8lMjBzdXNwZW5kZXIuJTIyJTdELCUwQSUwQSUyMCUyMnZrSW5mbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkluZm9ybWFjaSVDMyVCM24lMjIlN0QsJTBBJTIwJTIydmtJbmZvVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUYW1hJUMzJUIxbyUyMGRlJTIwYXJjaGl2byUyMHklMjB2ZWxvY2lkYWQlMjBkZSUyMGJpdHMlMjIlN0QsJTBBJTIwJTIydmtNcDNMaW5rc05vdEZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTm8lMjBzZSUyMGhhbiUyMGVuY29udHJhZG8lMjBlbmxhY2VzJTIwYSUyMGFyY2hpdm9zJTIwTVAzJTIyJTdELCUwQSUyMCUyMnZrUGhvdG9MaW5rc05vdEZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTm8lMjBzZSUyMGhhbiUyMGVuY29udHJhZG8lMjBpbSVDMyVBMWdlbmVzJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRQaG90b0FsYnVtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVzY2FyZ2FyJTIwJUMzJUExbGJ1bSUyMiU3RCwlMEElMjAlMjJ2a0Rvd25sb2FkQWxsUGhvdG9BbGJ1bXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEZXNjYXJnYXIlMjB0b2RvcyUyMGxvcyUyMCVDMyVBMWxidW1zJTIyJTdELCUwQSUyMCUyMnZrRm91bmRQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbSVDMyVBMWdlbmVzJTIwZW5jb250cmFkYXMlMjIlN0QsJTBBJTIwJTIydmtOb3RBdmFpbGFibGVQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlMjVkJTIwaW0lQzMlQTFnZW5lcyUyMGVzdCVDMyVBMW4lMjB0ZW1wb3JhbG1lbnRlJTIwbm8lMjBkaXNwb25pYmxlcyUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJFbmxhY2VzJTIwZW5jb250cmFkb3MlMjIlN0QsJTBBJTIwJTIydmtGb3VuZE9mJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyZGUlMjIlN0QsJTBBJTIwJTIydmtTaG93QXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNb3N0cmFyJTIwY29tbyUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZkxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGlzdGElMjBkZSUyMGVubGFjZXMlMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZMaW5rc0luc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1BhcmElMjBkZXNjYXJnYXIlMjB0b2RhcyUyMGxhcyUyMGltJUMzJUExZ2VuZXMsJTIwY29waWUlMjBsYSUyMGxpc3RhJTIwZGUlMjBlbmxhY2VzJTIweSUyMHAlQzMlQTlndWVsYSUyMGVuJTIwZWwlMjAnLCU3QmE6JTdCaHJlZjonaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb3dubG9hZF9tYW5hZ2VyJyx0ZXh0OidnZXN0b3IlMjBkZSUyMGRlc2NhcmdhcyclN0QlN0QsJy4lMjBTaSUyMG5vJTIwdGllbmUlMjBpbnN0YWxhZG8lMjB1biUyMGdlc3RvciUyMGRlJTIwZGVzY2FyZ2FzLCUyMGxlJTIwcmVjb21lbmRhbW9zJTIwcXVlJTIwaW5zdGFsZSUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vd3d3LmZyZWVkb3dubG9hZG1hbmFnZXIub3JnLycsdGV4dDonRnJlZSUyMERvd25sb2FkJTIwTWFuYWdlciclN0QlN0QsJy4nJTVEJTIyJTdELCUwQSUyMCUyMnZrVGFibGVPZlRodW1ibmFpbHMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUYWJsYSUyMGRlJTIwbWluaWF0dXJhcyUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZlBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpc3RhJTIwZGUlMjBpbSVDMyVBMWdlbmVzJTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mUGhvdG9zSW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIYWdhJTIwY2xpYyUyMGVuJTIwbGElMjBpbWFnZW4lMjBwYXJhJTIwZGVzY2FyZ2FybGEuJTIyJTdELCUwQSUyMCUyMnZrS2JwcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmticHMlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZUJ5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVLQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmtCJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVNQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1CJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVHQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkdCJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVUQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRCJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRGcm9tWW91dHViZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidEZXNjYXJnYXI6JTIwYWJyYSUyMCcsJTdCYTolN0JocmVmOiclN0J1cmwlN0QnLHRleHQ6J2xhJTIwcCVDMyVBMWdpbmElMjBkZWwlMjB2JUMzJUFEZGVvJyU3RCU3RCwnJTIweSUyMHB1bHNlJTIwZWwlMjBib3QlQzMlQjNuJTIwJTVDJTIyRGVzY2FyZ2FyJTVDJTIyJTIwc29icmUlMjBlbCUyMHJlcHJvZHVjdG9yJyU1RCUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBcmNoaXZvcyUyMGVuY29udHJhZG9zOiUyMCUyNWQlMjIlN0QsJTBBJTBBJTIwJTIyc2hhcmVJbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNvbXBhcnRpciUyMGVuJTIwJTI1dyUyMiU3RCwlMEElMjAlMjJzb2NpYWxEZXNjJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwaGVscGVyJTIwbGUlMjBwZXJtaXRlJTIwZGVzY2FyZ2FyJTIwYXJjaGl2b3MlMjBkZXNkZSUyMFlvdVR1YmUuY29tLCUyMEZhY2Vib29rLmNvbSwlMjBWSy5jb20lMjB5JTIwbSVDMyVBMXMlMjBkZSUyMDQwJTIwc2l0aW9zJTIwZGlzdGludG9zJTIwY29uJTIwdGFuJTIwcyVDMyVCM2xvJTIwdW4lMjBjbGljJTIweSUyMGdyYXRpcyUyMiU3RCwlMEElMEElMjAlMjJ0dXRvcmlhbFMxVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlQzIlQTFFeGNlbGVudGVzJTIwbm90aWNpYXMhJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzFNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1NhdmVGcm9tLm5ldCUyMEhlbHBlciUyMCcsJTdCaW1nOiUyMCU3QnNyYzolMjAnI2xvZ28nJTdEJTdELCUyMCclMjBzZSUyMGluc3RhbCVDMyVCMyUyMGNvbiUyMCVDMyVBOXhpdG8lMjB5JTIwYWhvcmElMjBwdWVkZXMlMjBkZXNjYXJnYXIlMjBjdWFscXVpZXIlMjB2aWRlbyUyMGRlJTIwWW91VHViZSUyMGNvbiUyMHVuJTIwc29sbyUyMGNsaWMnJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzFBcnJvdyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiclQzIlQkZRdWllcmVzJTIwc2FiZXIlMjBjJUMzJUIzbW8/JywlMjAlN0JicjolN0IlN0QlN0QsJTIwJ0hheiUyMGNsaWMlMjBhcXUlQzMlQUQnJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzJNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUGFyYSUyMGRlc2NhcmdhciUyMHVuJTIwdmlkZW8sJTIwZWxpZ2UlMjBlbCUyMGZvcm1hdG8lMjB5JTIwaGF6JTIwY2xpYyUyMGVuJTIwZWwlMjBib3QlQzMlQjNuJTIwJTVDJTIyRGVzY2FyZ2FyJTVDJTIyJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzNIaXN0b3J5JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySGlzdG9yaWFsJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzNNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJyVDMiVCRkRlc2VhcyUyMGRlc2NhcmdhciUyMHVuJTIwdmlkZW8lMjBkZWwlMjBIaXN0b3JpYWw/JywlMjAlN0JicjolN0IlN0QlN0QsJTIwJ1NpbXBsZW1lbnRlJTIwaGF6JTIwY2xpYyUyMGVuJTIwJywlMjAlN0JpbWc6JTIwJTdCc3JjOiUyMCcjYXJyb3cnJTdEJTdELCUyMCclMjBlbiUyMGxhJTIwdmlzdGElMjBwcmV2aWElMjBkZWwlMjB2aWRlbyUyMHZpc3RvJTIwYW50ZXJpb3JtZW50ZS4nJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzRNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ05vJTIwZXMlMjBuZWNlc2FyaW8lMjBtaXJhciUyMHVuJTIwdmlkZW86JTIwc2ltcGxlbWVudGUlMjBoYXolMjBjbGljJTIwZW4lMjAnLCUyMCU3QmltZzolMjAlN0JzcmM6JTIwJyNhcnJvdyclN0QlN0QsJTIwJywlMjBlbGlnZSUyMGxhJTIwY2FsaWRhZCUyMHklMjBkZXNjJUMzJUExcmdhbG8uJTIwRiVDMyVBMWNpbCwlMjAlQzIlQkZ2ZXJkYWQ/JyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFM1VGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlQzIlQTFEaXNmcnV0YSUyMGRlJTIwU2F2ZUZvcm0ubmV0JTIwSGVscGVyISUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFM1TWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiclQzIlQkZUb2RhdiVDMyVBRGElMjB0aWVuZXMlMjBwcmVndW50YXM/JTIwJUMyJUJGUXVpZXJlcyUyMGNvbXBhcnRpciUyMHR1cyUyMGlkZWFzPyUyMFB1ZWRlcyUyMGlyJTIwYSUyMG51ZXN0cmElMjAnLCU3QmE6JTIwJTdCdGV4dDolMjAncCVDMyVBMWdpbmElMjBkZSUyMHNvcG9ydGUnLCUyMGhyZWY6JTIwJyNzdXBwb3J0JyU3RCU3RCwnJTIwbyUyMHVuaXJ0ZSUyMGElMjBub3NvdHJvcyUyMGVuJTIwJywlMjAlN0JhOiUyMCU3QnRleHQ6JTIwJ0ZhY2Vib29rJywlMjBocmVmOiUyMCcjZmInJTdEJTdEJTVEJTIyJTdELCUwQSUwQSUyMCUyMnR1dG9yaWFsVG9vbHRpcFRleHQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInU2ltcGxlbWVudGUlMjBoYXolMjBjbGljJTIwZW4lMjBlbCUyMGJvdCVDMyVCM24lMjBwYXJhJTIwJywlN0JiOiUyMCU3QnRleHQ6JTIwJ2Rlc2NhcmdhciclN0QlN0QlNUQlMjIlN0QsJTBBJTBBJTIwJTIydW1teVRvb2x0aXBDb25maXJtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJyVDMiVCRllhJTIwaGFzJTIwaW5zdGFsYWRvJywlN0JicjolN0IlN0QlN0QsJTdCaW1nOiU3QiU3RCU3RCwnJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMGFudGVzPyclNUQlMjIlN0QsJTBBJTIwJTIyeWVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUyVDMyVBRCUyMiU3RCwlMEElMjAlMjJubyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk5vJTIyJTdELCUwQSUyMCUyMnRvb2x0aXBIaWRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTm8lMjBtb3N0cmFyJTIwZGUlMjBudWV2byUyMGVzdGUlMjBtZW5zYWplJTIyJTdEJTBBJTdEIjsKICBfbGFuZ3VhZ2VMaXN0LmZyID0gIiU3QiUwQSUyMCUyMmV4dE5hbWUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBIZWxwZXIlMjIlN0QsJTBBJTIwJTIyZXh0RGVzY3JpcHRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUE5bCVDMyVBOWNoYXJnZXolMjBZb3VUdWJlLCUyMEZhY2Vib29rLCUyMFZLLmNvbSUyMGV0JTIwNDArJTIwc2l0ZXMlMjBlbiUyMHVuJTIwc2V1bCUyMGNsaWMuJTIyJTdELCUwQSUwQSUyMCUyMmV4dE5hbWVMaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwSGVscGVyJTIwbGl0ZSUyMiU3RCwlMEElMjAlMjJleHREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUE5bCVDMyVBOWNoYXJnZXolMjBGYWNlYm9vaywlMjBWSy5jb20lMjBldCUyMDQwKyUyMHNpdGVzJTIwZW4lMjB1biUyMHNldWwlMjBjbGljLiUyMiU3RCwlMEElMEElMjAlMjJsYW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyZnIlMjIlN0QsJTBBJTBBJTIwJTIydGl0bGVEZWZhdWx0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwSGVscGVyJTIyJTdELCUwQSUyMCUyMnRpdGxlRGVzYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBc3Npc3RhbnQlMjBTYXZlRnJvbS5uZXQlMjBkJUMzJUE5c2FjdGl2JUMzJUE5JTIyJTdELCUwQSUwQSUyMCUyMm1lbnVFbmFibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBY3RpdmVyJTIyJTdELCUwQSUyMCUyMm1lbnVEaXNhYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRCVDMyVBOXNhY3RpdmVyJTIyJTdELCUwQSUwQSUyMCUyMnNob3dCdXR0b24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBZmZpY2hlciUyMGxlJTIwYm91dG9uJTIwZCdleHRlbnNpb24lMjIlN0QsJTBBJTBBJTIwJTIyY29weSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNvcGllciUyMiU3RCwlMEElMjAlMjJkb3dubG9hZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlQlQzMlQTlsJUMzJUE5Y2hhcmdlciUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQ2xpcXVlciUyMHN1ciUyMGxlJTIwbGllbiUyMHRvdXQlMjBlbiUyMG1haW50ZW5hbnQlMjBsYSUyMHRvdWNoZSUyMEFsdC9PcHRpb24lMjBvdSUyMEN0cmwlMjBwb3VyJTIwdCVDMyVBOWwlQzMlQTljaGFyZ2VyJTIwbGUlMjBmaWNoaWVyLiUyMiU3RCwlMEElMjAlMjJub0xpbmtzRm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBdWN1biUyMGxpZW4lMjBuJ2ElMjAlQzMlQTl0JUMzJUE5JTIwdHJvdXYlQzMlQTklMjIlN0QsJTBBJTIwJTIybW9yZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBsdXMlMjIlN0QsJTBBJTIwJTIyY2xvc2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJGZXJtZXIlMjIlN0QsJTBBJTIwJTIya2JwcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmticHMlMjIlN0QsJTBBJTIwJTIyd2l0aG91dEF1ZGlvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyc2FucyUyMGF1ZGlvJTIyJTdELCUwQSUyMCUyMnNpemUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJ0YWlsbGUlMjIlN0QsJTBBJTBBJTIwJTIyc3VidGl0bGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU291cy10aXRyZXMlMjIlN0QsJTBBJTIwJTIycGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQbGF5bGlzdCUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpc3RlJTIwZGUlMjBmaWNoaWVycyUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFdob2xlUGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUE5bCVDMyVBOWNoYXJnZXIlMjB0b3V0ZSUyMGxhJTIwcGxheWxpc3QlMjIlN0QsJTBBJTBBJTIwJTIyZ2V0RmlsZVNpemVUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk9idGVuaXIlMjBsYSUyMHRhaWxsZSUyMGR1JTIwZmljaGllciUyMiUyMCU3RCwlMEElMjAlMjJnZXRGaWxlU2l6ZUZhaWxUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkltcG9zc2libGUlMjBkJ29idGVuaXIlMjBsYSUyMHRhaWxsZSUyMGR1JTIwZmljaGllci4lMjBWZXVpbGxleiUyMHIlQzMlQTllc3NheWVyLiUyMiU3RCwlMEElMEElMjAlMjJsbUJ1dHRvblRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyT2J0ZW5pciUyMHVuJTIwbGllbiUyMGRpcmVjdCUyMiU3RCwlMEElMEElMjAlMjJkb3dubG9hZEZyb21DdXJyZW50UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFsbGVyJTIwJUMzJUEwJTIwU2F2ZUZyb20ubmV0JTIyJTdELCUwQSUyMCUyMnVwZGF0ZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUmFmcmElQzMlQUVjaGlyJTIwbGVzJTIwbGllbnMlMjIlN0QsJTBBJTIwJTIydXBkYXRlTGlua3NOb3RpZmljYXRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMaWVucyUyMG1pcyUyMCVDMyVBMCUyMGpvdXIlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRNUDNGaWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlQlQzMlQTlsJUMzJUE5Y2hhcmdlciUyMGxlcyUyMGZpY2hpZXJzJTIwYXVkaW8lMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRQbGF5bGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlQlQzMlQTlsJUMzJUE5Y2hhcmdlciUyMHVuZSUyMHBsYXlsaXN0JTIyJTdELCUwQSUyMCUyMmRvd25sb2FkUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVCVDMyVBOWwlQzMlQTljaGFyZ2VyJTIwbGVzJTIwaW1hZ2VzJTIyJTdELCUwQSUyMCUyMmluc3RhbGxGdWxsVmVyc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkluc3RhbGxlciUyMGxhJTIwdmVyc2lvbiUyMGNvbXBsJUMzJUE4dGUlMjIlN0QsJTBBJTIwJTIyZGlzYWJsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkQlQzMlQTlzYWN0aXZlciUyMiU3RCwlMEElMjAlMjJzaG93T3B0aW9ucyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBhcmFtJUMzJUE4dHJlcyUyMiU3RCwlMEElMjAlMjJyZXBvcnRCdWclMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTaWduYWxlciUyMHVuJTIwYnVnJTIyJTdELCUwQSUyMCUyMm9wZW5Qb2xsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQW0lQzMlQTlsaW9yZXIlMjIlN0QsJTBBJTIwJTIyZGlzYWJsZU1vZHVsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkQlQzMlQTlzYWN0aXZlciUyMHN1ciUyMGNlJTIwc2l0ZSUyMiU3RCwlMEElMjAlMjJlbmFibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBY3RpdmVyJTIwc3VyJTIwY2UlMjBzaXRlJTIyJTdELCUwQSUyMCUyMmVuYWJsZURpc2FibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBY3RpdmVyJTIwT24vT2ZmJTIwc3VyJTIwY2UlMjBzaXRlJTIwd2ViJTIyJTdELCUwQSUyMCUyMnNob3dIaWRlQnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQWZmaWNoZXIvbWFzcXVlciUyMGxlJTIwYm91dG9uJTIwZCdleHRlbnNpb24lMjIlN0QsJTBBJTIwJTIydXBkYXRlVG8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQYXNzZXIlMjAlQzMlQTAlMjBsYSUyMHZlcnNpb24lMjAlMjVkJTIyJTdELCUwQSUwQSUyMCUyMmFib3V0UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVDMyU4MCUyMHByb3BvcyUyMiU3RCwlMEElMjAlMjJhYm91dFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwSGVscGVyJTIyJTdELCUwQSUyMCUyMmFib3V0VmVyc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlZlcnNpb24lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFpZGUlMjBsZXMlMjB1dGlsaXNhdGV1cnMlMjAlQzMlQTAlMjBvYnRlbmlyJTIwZGVzJTIwbGllbnMlMjBkaXJlY3RzJTIwcG91ciUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlciUyMGRlcHVpcyUyMHBsdXMlMjBkZSUyMDQwJTIwc2l0ZXMlMjB3ZWIsJTIweSUyMGNvbXByaXMlMjBEYWlseW1vdGlvbi5jb20sJTIwWW91VHViZS5jb20sJTIwVksuY29tJTIwZXQlMjBkJ2F1dHJlcy4lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBaWRlJTIwbGVzJTIwdXRpbGlzYXRldXJzJTIwJUMzJUEwJTIwb2J0ZW5pciUyMGRlcyUyMGxpZW5zJTIwZGlyZWN0cyUyMHBvdXIlMjB0JUMzJUE5bCVDMyVBOWNoYXJnZXIlMjBkZXB1aXMlMjBwbHVzJTIwZGUlMjA0MCUyMHNpdGVzJTIwd2ViLCUyMHklMjBjb21wcmlzJTIwRGFpbHltb3Rpb24uY29tLCUyMFZLLmNvbSUyMGV0JTIwZCdhdXRyZXMuJTIyJTdELCUwQSUyMCUyMmFib3V0U3VwcG9ydGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUmVzc291cmNlcyUyMHByaXNlcyUyMGVuJTIwY2hhcmdlJTIyJTdELCUwQSUyMCUyMmhvbWVQYWdlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUGFnZSUyMGQnYWNjdWVpbCUyMiU3RCwlMEElMEElMjAlMjJvcHRpb25zVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBIZWxwZXIlMjAtJTIwUHIlQzMlQTlmJUMzJUE5cmVuY2VzJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNIYW5kbGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMm1hbmlwdWxlciUyMGxlcyUyMGxpZW5zJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNGaWxlSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJWZXJzJTIwbCdoJUMzJUE5YmVyZ2VtZW50JTIwZGUlMjBmaWNoaWVycyUyMiU3RCwlMEElMjAlMjJvcHRpb25zTWVkaWFIb3N0aW5ncyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlZlcnMlMjBsJ2glQzMlQTliZXJnZW1lbnQlMjBkZSUyMG0lQzMlQTlkaWFzJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNNb2R1bGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTW9kdWxlcyUyMiU3RCwlMEElMjAlMjJvcHRpb25zWW91dHViZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMllvdVR1YmUlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1lUSGlkZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTWFzcXVlciUyMGxlcyUyMGxpZW5zJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNEYWlseW1vdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRhaWx5bW90aW9uJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNWaW1lbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlZpbWVvJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNGYWNlYm9vayUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkZhY2Vib29rJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTb3VuZGNsb3VkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU291bmRDbG91ZCUyMiU3RCwlMEElMjAlMjJvcHRpb25zVmtvbnRha3RlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVkslMjIlN0QsJTBBJTIwJTIyb3B0aW9uc09kbm9rbGFzc25pa2klMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJPZG5va2xhc3NuaWtpJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNNYWlscnUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNb3klMjBNaXIlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0luc3RhZ3JhbSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkluc3RhZ3JhbSUyMiU3RCwlMEElMjAlMjJvcHRpb25zUnV0dWJlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUnV0dWJlJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNCaXRyYXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQWZmaWNoZXIlMjBpbnN0YW50YW4lQzMlQTltZW50JTIwbGUlMjBiaXRyYXRlJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTb3ZldG5pa0VuYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBZHZpc29yJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUluZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBZmZpY2hlciUyMGxlcyUyMGFzdHVjZXMlMjBwb3VyJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMiU3RCwlMEElMjAlMjJvcHRpb25zR21OYXRpdmVEb3dubG9hZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1vZGUlMjBkZSUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlbWVudCUyMGF2YW5jJUMzJUE5JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUJ0biUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1vbnRyZXIlMjBsZSUyMGJvdXRvbiUyMFVtbXklMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0F2aWFCYXJFbmFibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQ2hlYXAlMjBGbGlnaHRzJTIwQWR2aXNvciUyMiU3RCwlMEElMEElMjAlMjJtZW51RG93bmxvYWRGcm9tQ3VycmVudFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUE5bCVDMyVBOWNoYXJnZW1lbnQlMjBkZXMlMjBmaWNoaWVycyUyMGRlcHVpcyUyMGxhJTIwcGFnZSUyMGFjdHVlbGxlJTIwZW4lMjB1dGlsaXNhbnQlMjBTYXZlRnJvbS5uZXQlMjIlN0QsJTBBJTIwJTIybWVudVVwZGF0ZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQXBwdXlleiUyMHNpJTIwbGUlMjBib3V0b24lMjBUJUMzJUE5bCVDMyVBOWNoYXJnZXIlMjBuJ2FwcGFyYSVDMyVBRXQlMjBwYXMlMjIlN0QsJTBBJTIwJTIybWVudURvd25sb2FkTVAzRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUE5bCVDMyVBOWNoYXJnZXIlMjB0b3VzJTIwbGVzJTIwZmljaGllcnMlMjBhdWRpbyUyMHRyb3V2JUMzJUE5cyUyMHN1ciUyMGxhJTIwcGFnZSUyMGFjdHVlbGxlJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRyVDMyVBOW4lQzMlQThyZSUyMGV0JTIwdCVDMyVBOWwlQzMlQTljaGFyZ2UlMjBsYSUyMHBsYXlsaXN0JTIwY29uc2lzdGFudCUyMGVuJTIwbGllbnMlMjB2ZXJzJTIwbGVzJTIwZmljaGllcnMlMjBhdWRpbyUyMiU3RCwlMEElMjAlMjJtZW51RG93bmxvYWRQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUE5bCVDMyVBOWNoYXJnZXIlMjB0b3V0ZXMlMjBsZXMlMjBpbWFnZXMlMjB0cm91diVDMyVBOWVzJTIwc3VyJTIwbGElMjBwYWdlJTIwYWN0dWVsbGUlMjIlN0QsJTBBJTIwJTIybWVudVJlcG9ydEJ1ZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlByJUMzJUE5dmVuZXotbm91cyUyMHNpJTIwdm91cyUyMGF2ZXolMjBkZXMlMjBwcm9ibCVDMyVBOG1lcyUyMiU3RCwlMEElMjAlMjJtZW51U2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJPTi9PRkYlMjByZXNzb3VyY2VzJTIwcHJpc2VzJTIwZW4lMjBjaGFyZ2UlMjBldCUyMG9wdGlvbnMlMjBIZWxwZXIlMjIlN0QsJTBBJTIwJTIybWVudUVuYWJsZUV4dGVuc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiUyMiU3RCwlMEElMjAlMjJtZW51T3BlblBvbGwlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJOb3VzJTIwZmFpc29ucyUyMHRvdXQlMjBwb3VyJTIwbm91cyUyMGFtJUMzJUE5bGlvcmVyLiUyME4naCVDMyVBOXNpdGV6JTIwcGFzJTIwJUMzJUEwJTIwbm91cyUyMGFpZGVyJTIwISUyMiU3RCwlMEElMEElMjAlMjJxdWFsaXR5JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUXVhbGl0JUMzJUE5JTIyJTdELCUwQSUyMCUyMnF1YWxpdHlOb3RlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGElMjBtZWlsbGV1cmUlMjB2aWQlQzMlQTlvJTIwZGlzcG9uaWJsZSUyMHNlcmElMjB0JUMzJUE5bCVDMyVBOWNoYXJnJUMzJUE5ZSUyMHMnaWwlMjBuJ3klMjBhJTIwcGFzJTIwZGUlMjBxdWFsaXQlQzMlQTklMjBjaG9pc2llLiUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGElMjBsaXN0ZSUyMGRlcyUyMGZpY2hpZXJzJTIwdHJvdXYlQzMlQTlzJTIyJTdELCUwQSUyMCUyMmZpbGVsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInUG91ciUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlciUyMHRvdXMlMjBsZXMlMjBmaWNoaWVycyUyMGNvcGlleiUyMGxhJTIwbGlzdGUlMjBkZXMlMjBsaWVucyUyMGV0JTIwY29sbGV6LWxhJTIwZGFucyUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Rvd25sb2FkX21hbmFnZXInLHRleHQ6J2Rvd25sb2FkJTIwbWFuYWdlciclN0QlN0QsJy4lMjBTaSUyMHZvdXMlMjBuJTVDJTVDJ2F2ZXolMjBwYXMlMjBpbnN0YWxsJUMzJUE5JTIwZGUlMjBnZXN0aW9ubmFpcmUlMjBkZSUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlbWVudCwlMjBub3VzJTIwdm91cyUyMHJlY29tbWFuZG9ucyUyMGQlNUMlNUMnaW5zdGFsbGVyJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly93d3cuZnJlZWRvd25sb2FkbWFuYWdlci5vcmcvJyx0ZXh0OidGcmVlJTIwRG93bmxvYWQlMjBNYW5hZ2VyJyU3RCU3RCwnLiclNUQlMjIlN0QsJTBBJTIwJTIycGxheWxpc3RUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBsYXlsaXN0JTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQb3VyJTIwbGlyZSUyMGxhJTIwcGxheWxpc3QlMjBzYXV2ZWdhcmQlQzMlQTllLCUyMG91dnJlei1sYSUyMGRhbnMlMjBsZSUyMGxlY3RldXIlMjBtdXNpY2FsLiUyMiU3RCwlMEElMEElMjAlMjJ1bW15U2ZUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhEJTIwb3UlMjBNUDMlMjIlN0QsJTBBJTIwJTIydW1teU1lbnVJdGVtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjIlMjA6JTIwJTIyJTVCJTdCc3BhbjolN0IlN0QlN0QsJyUyMHZpYSUyMFVtbXknJTVEJTIyJTdELCUwQSUyMCUyMnVtbXlNZW51SW5mbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiU3QnA6JTdCdGV4dDonSW5zdGFsbGV6JTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMGV0JTIwdCVDMyVBOWwlQzMlQTljaGFyZ2V6JTIwdm9zJTIwdmlkJUMzJUE5b3MlMjBmYXZvcml0ZXMlMjBlbiUyMEhEJTIwb3UlMjBNUDMuJyU3RCU3RCwlN0JwOiU3QmNsYXNzOidjZW50ZXInLGFwcGVuZDolNUIlN0JhOiU3QmNsYXNzOidncmVlbi1idG4tMiUyMGFycm93JyxocmVmOiclN0J1cmwlN0QnLHRhcmdldDonX2JsYW5rJyx0ZXh0OidEb3dubG9hZCclN0QlN0QlNUQlN0QlN0QsJTdCcDolN0JhcHBlbmQ6JTVCJ0FwciVDMyVBOHMlMjBsJTVDJTVDJ2luc3RhbGxhdGlvbiwlMjB1biUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlbWVudCUyMGQlQzMlQTltYXJyZXJhJTIwYXV0b21hdGlxdWVtZW50JTIwZCVDMyVBOHMlMjBxdWUlMjB2b3VzJTIwY2xpcXVleiUyMHN1ciUyMCcsJTdCaW1nOiU3QnNyYzonIyclN0QlN0QlNUQlN0QlN0QlNUQlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJWJUMzJUE5cmlmaWVyJTIwbGVzJTIwcGFyYW0lQzMlQTh0cmVzJTIwZHUlMjBuYXZpZ2F0ZXVyJTIyJTdELCUwQSUyMCUyMndhcm5pbmdQb3B1cERlc2MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMJ29wdGlvbiUyMCU1QyUyMlRvdWpvdXJzJTIwbWUlMjBkZW1hbmRlciUyMG8lQzMlQjklMjBzYXV2ZWdhcmRlciUyMGxlcyUyMGZpY2hpZXJzJTVDJTIyJTIwZG9pdCUyMCVDMyVBQXRyZSUyMGQlQzMlQTlzYWN0aXYlQzMlQTllLiUyMiU3RCwlMEElMjAlMjJyZWFkTW9yZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBsdXMlMjIlN0QsJTBBJTIwJTIybm9XYXJuaW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIybmUlMjBwYXMlMjBub3RpZmllciclMjIlN0QsJTBBJTIwJTIyY2FuY2VsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQW5udWxlciUyMiU3RCwlMEElMjAlMjJjb250aW51ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNvbnRpbnVlciUyMiU3RCwlMEElMjAlMjJiZWZvcmVEb3dubG9hZFBvcHVwV2FybiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkF0dGVudGlvbiElMjBMZSUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlbWVudCUyMG5lJTIwcGV1dCUyMHBhcyUyMCVDMyVBQXRyZSUyMGFubnVsJUMzJUE5JTIwb3UlMjBzdXNwZW5kdS4lMjIlN0QsJTBBJTBBJTIwJTIydmtJbmZvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySW5mbyUyMiU3RCwlMEElMjAlMjJ2a0luZm9UaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRhaWxsZSUyMGRlJTIwZmljaGllciUyMGV0JTIwYml0cmF0ZSUyMiU3RCwlMEElMjAlMjJ2a01wM0xpbmtzTm90Rm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMZXMlMjBsaWVucyUyMHZlcnMlMjBsZXMlMjBmaWNoaWVycyUyME1QMyUyMHNvbnQlMjBpbnRyb3V2YWJsZXMlMjIlN0QsJTBBJTIwJTIydmtQaG90b0xpbmtzTm90Rm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQaG90b3MlMjBpbnRyb3V2YWJsZXMlMjIlN0QsJTBBJTIwJTIydmtEb3dubG9hZFBob3RvQWxidW0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUE5bCVDMyVBOWNoYXJnZXIlMjBsJ2FsYnVtJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRBbGxQaG90b0FsYnVtcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlQlQzMlQTlsJUMzJUE5Y2hhcmdlciUyMHRvdXMlMjBsZXMlMjBhbGJ1bXMlMjIlN0QsJTBBJTIwJTIydmtGb3VuZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBob3RvcyUyMHRyb3V2JUMzJUE5ZXMlMjIlN0QsJTBBJTIwJTIydmtOb3RBdmFpbGFibGVQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlMjVkJTIwcGhvdG9zJTIwc29udCUyMHRlbXBvcmFpcmVtZW50JTIwaW5kaXNwb25pYmxlcyUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMaWVucyUyMHRyb3V2JUMzJUE5cyUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kT2YlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJkZSUyMiU3RCwlMEElMjAlMjJ2a1Nob3dBcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFmZmljaGVyJTIwY29tbWUlMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxpc3RlJTIwZGVzJTIwbGllbnMlMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZMaW5rc0luc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1BvdXIlMjB0JUMzJUE5bCVDMyVBOWNoYXJnZXIlMjB0b3V0ZXMlMjBsZXMlMjBwaG90b3MlMjBjb3BpZXolMjBsYSUyMGxpc3RlJTIwZGVzJTIwbGllbnMlMjBldCUyMGNvbGxlei1sYSUyMGRhbnMlMjAnLCU3QmE6JTdCaHJlZjonaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb3dubG9hZF9tYW5hZ2VyJyx0ZXh0Oidkb3dubG9hZCUyMG1hbmFnZXInJTdEJTdELCcuJTIwU2klMjB2b3VzJTIwbiU1QyU1QydhdmV6JTIwcGFzJTIwaW5zdGFsbCVDMyVBOSUyMGRlJTIwZ2VzdGlvbm5haXJlJTIwZGUlMjB0JUMzJUE5bCVDMyVBOWNoYXJnZW1lbnQlMjBub3VzJTIwdm91cyUyMHJlY29tbWFuZG9ucyUyMGQlNUMlNUMnaW5zdGFsbGVyJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly93d3cuZnJlZWRvd25sb2FkbWFuYWdlci5vcmcvJyx0ZXh0OidGcmVlJTIwRG93bmxvYWQlMjBNYW5hZ2VyJyU3RCU3RCwnLiclNUQlMjIlN0QsJTBBJTIwJTIydmtUYWJsZU9mVGh1bWJuYWlscyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRhYmxlYXUlMjBkZXMlMjB2aWduZXR0ZXMlMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMaXN0ZSUyMGRlcyUyMHBob3RvcyUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZlBob3Rvc0luc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQ2xpcXVleiUyMHN1ciUyMGxhJTIwcGhvdG8lMjBwb3VyJTIwbGElMjB0JUMzJUE5bCVDMyVBOWNoYXJnZXIuJTIyJTdELCUwQSUyMCUyMnZrS2JwcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmticHMlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZUJ5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJPJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVLQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmtvJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVNQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1vJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVHQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkdvJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVUQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRvJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRGcm9tWW91dHViZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidEb3dubG9hZDolMjBvcGVuJTIwJywlN0JhOiU3QmhyZWY6JyU3QnVybCU3RCcsdGV4dDondGhlJTIwdmlkZW8lMjBwYWdlJyU3RCU3RCwnJTIwZXQlMjBhcHB1eWV6JTIwc3VyJTIwbGUlMjBib3V0b24lMjAlNUMlMjJUJUMzJUE5bCVDMyVBOWNoYXJnZXIlNUMlMjIlMjBhdS1kZXNzdXMlMjBkdSUyMGxlY3RldXInJTVEJTIyJTdELCUwQSUyMCUyMnZrRm91bmRGaWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkZpY2hpZXJzJTIwdHJvdXYlQzMlQTlzJTIwOiUyMCUyNWQlMjIlN0QsJTBBJTBBJTIwJTIyc2hhcmVJbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBhcnRhZ2VyJTIwc3VyJTIwJTI1dyUyMiU3RCwlMEElMjAlMjJzb2NpYWxEZXNjJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwaGVscGVyJTIwdm91cyUyMHBlcm1ldCUyMGRlJTIwdCVDMyVBOWwlQzMlQTljaGFyZ2VyJTIwZGVzJTIwZmljaGllcnMlMjBkZSUyMFlvdVR1YmUuY29tLCUyMEZhY2Vib29rLmNvbSwlMjBWSy5jb20lMjBldCUyMHBsdXMlMjBkZSUyMDQwJTIwYXV0cmVzJTIwZ3JhdHVpdGVtZW50JTIwZXQlMjBlbiUyMHVuJTIwc2V1bCUyMGNsaWMlMjIlN0QsJTBBJTBBJTIwJTIydHV0b3JpYWxTMVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQm9ubmVzJTIwbm91dmVsbGVzJTIwISUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMxTWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidTYXZlRnJvbS5uZXQlMjBIZWxwZXIlMjAnLCU3QmltZzolMjAlN0JzcmM6JTIwJyNsb2dvJyU3RCU3RCwlMjAnJTIwYSUyMCVDMyVBOXQlQzMlQTklMjBpbnN0YWxsJUMzJUE5JTIwYXZlYyUyMHN1Y2MlQzMlQThzJTIwZXQlMjBtYWludGVuYW50JTIwdm91cyUyMHBvdXZleiUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlciUyMGxlcyUyMHZpZCVDMyVBOW9zJTIwZGUlMjBZb3VUdWJlJTIwZW4lMjB1biUyMGNsaWMnJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzFBcnJvdyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidWb3VzJTIwdm91bGV6JTIwc2F2b2lyJTIwY29tbWVudCUyMD8lMjBDbGlxdWV6JTIwaWNpJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMyTWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBvdXIlMjB0JUMzJUE5bCVDMyVBOWNoYXJnZXIlMjB1bmUlMjB2aWQlQzMlQTlvLCUyMGNob2lzaXNzZXolMjB1biUyMGZvcm1hdCUyMGV0JTIwY2xpcXVleiUyMHN1ciUyMGxlJTIwYm91dG9uJTIwJTVDJTIyVCVDMyVBOWwlQzMlQTljaGFyZ2VyJTVDJTIyJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzNIaXN0b3J5JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySGlzdG9yaXF1ZSUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMzTWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidWb3VsZXotdm91cyUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlciUyMHVuZSUyMHZpZCVDMyVBOW8lMjBkZXB1aXMlMjBsJUUyJTgwJTk5aGlzdG9yaXF1ZSUyMD8nLCUyMCU3QmJyOiU3QiU3RCU3RCwlMjAnSWwlMjBzdWZmaXQlMjBkZSUyMGNsaXF1ZXIlMjBzdXIlMjAnLCUyMCU3QmltZzolMjAlN0JzcmM6JTIwJyNhcnJvdyclN0QlN0QsJTIwJyUyMHNpdHUlQzMlQTllJTIwc3VyJTIwbCU1QyU1QydhcGVyJUMzJUE3dSUyMGRlJTIwbGElMjB2aWQlQzMlQTlvJTIwcHIlQzMlQTljJUMzJUE5ZGVtbWVudCUyMHJlZ2FyZCVDMyVBOWUnJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzRNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ1BhcyUyMGJlc29pbiUyMGRlJTIwcmVnYXJkZXIlMjB1bmUlMjB2aWQlQzMlQTlvJTIwJUUyJTgwJTk0JTIwaWwlMjBzdWZmaXQlMjBkZSUyMGNsaXF1ZXIlMjBzdXIlMjAnLCUyMCU3QmltZzolMjAlN0JzcmM6JTIwJyNhcnJvdyclN0QlN0QsJTIwJywlMjBmYWl0ZXMlMjBsZSUyMGNob2l4JTIwZGUlMjBsYSUyMHF1YWxpdCVDMyVBOSwlMjBldCUyMHQlQzMlQTlsJUMzJUE5Y2hhcmdlci4lMjBGYWNpbGUsJTIwZXN0LWNlJTIwcGFzJTIwPyclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUHJvZml0ZXolMjBkZSUyMFNhdmVGcm9tLm5ldCUyMEhlbHBlciUyMCElMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNU1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInVm91cyUyMGF2ZXolMjBlbmNvcmUlMjBkZXMlMjBxdWVzdGlvbnMlMjA/JTIwVm91cyUyMHZvdWxleiUyMHBhcnRhZ2VyJTIwdm9zJTIwaWQlQzMlQTllcyUyMD8lMjBCaWVudmVudWUlMjBzdXIlMjBub3RyZSUyMHBhZ2UlMjAnLCU3QmE6JTIwJTdCdGV4dDolMjAnZGUlMjBkJUUyJTgwJTk5QWlkZScsJTIwaHJlZjolMjAnI3N1cHBvcnQnJTdEJTdELCclMjBvdSUyMHJlam9pZ25lei1ub3VzJTIwc3VyJTIwJywlMjAlN0JhOiUyMCU3QnRleHQ6JTIwJ0ZhY2Vib29rJywlMjBocmVmOiUyMCcjZmInJTdEJTdEJTVEJTIyJTdELCUwQSUwQSUyMCUyMnR1dG9yaWFsVG9vbHRpcFRleHQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInSWwlMjBzdWZmaXQlMjBkZSUyMGNsaXF1ZXIlMjBzdXIlMjBsZSUyMGJvdXRvbiUyMHBvdXIlMjAnLCU3QmI6JTIwJTdCdGV4dDolMjAndCVDMyVBOWwlQzMlQTljaGFyZ2VyJyU3RCU3RCU1RCUyMiU3RCwlMEElMEElMjAlMjJ1bW15VG9vbHRpcENvbmZpcm0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInQXZlei12b3VzJTIwZCVDMyVBOWolQzMlQTAlMjBpbnN0YWxsJUMzJUE5JywlN0JicjolN0IlN0QlN0QsJTdCaW1nOiU3QiU3RCU3RCwnJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMGF2YW50JTIwPyclNUQlMjIlN0QsJTBBJTIwJTIyeWVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyT3VpJTIyJTdELCUwQSUyMCUyMm5vJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTm9uJTIyJTdELCUwQSUyMCUyMnRvb2x0aXBIaWRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTmUlMjBwbHVzJTIwYWZmaWNoZXIlMjBjZSUyMG1lc3NhZ2UlMjIlN0QlMEElN0QiOwogIF9sYW5ndWFnZUxpc3QuaWQgPSAiJTdCJTBBJTIwJTIyZXh0TmFtZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJhbnR1YW4lMjBTYXZlRnJvbS5uZXQlMjIlN0QsJTBBJTIwJTIyZXh0RGVzY3JpcHRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJVbmR1aCUyMFlvdVR1YmUsJTIwRmFjZWJvb2ssJTIwVksuY29tLCUyMGRhbiUyMDQwKyUyMHNpdHVzJTIwZGVuZ2FuJTIwc2F0dSUyMGtsaWsuJTIyJTdELCUwQSUwQSUyMCUyMmV4dE5hbWVMaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQmFudHVhbiUyMFNhdmVGcm9tLm5ldCUyMGxpdGUlMjIlN0QsJTBBJTIwJTIyZXh0RGVzY3JpcHRpb25MaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVW5kdWglMjBGYWNlYm9vaywlMjBWSy5jb20sJTIwZGFuJTIwNDArJTIwc2l0dXMlMjBkZW5nYW4lMjBzYXR1JTIwa2xpay4lMjIlN0QsJTBBJTBBJTIwJTIybGFuZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmlkJTIyJTdELCUwQSUwQSUyMCUyMnRpdGxlRGVmYXVsdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJhbnR1YW4lMjBTYXZlRnJvbS5uZXQlMjIlN0QsJTBBJTIwJTIydGl0bGVEZXNhYmxlZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJhbnR1YW4lMjBTYXZlRnJvbS5uZXQlMjBub25ha3RpZiUyMiU3RCwlMEElMEElMjAlMjJtZW51RW5hYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQWt0aWZrYW4lMjIlN0QsJTBBJTIwJTIybWVudURpc2FibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJOb25ha3RpZmthbiUyMiU3RCwlMEElMEElMjAlMjJzaG93QnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVGFtcGlsa2FuJTIwdG9tYm9sJTIwZWtzdGVuc2klMjIlN0QsJTBBJTBBJTIwJTIyY29weSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhbGluJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVW5kdWglMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMktsaWslMjB0YXV0YW4lMjBzYW1iaWwlMjBtZW5haGFuJTIwdG9tYm9sJTIwQWx0L09wdGlvbiUyMGF0YXUlMjBDdHJsJTIwdW50dWslMjBtZW5ndW5kdWglMjBmaWxlLiUyMiU3RCwlMEElMjAlMjJub0xpbmtzRm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUYXV0YW4lMjB0aWRhayUyMGRpdGVtdWthbiUyMiU3RCwlMEElMjAlMjJtb3JlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGFpbm55YSUyMiU3RCwlMEElMjAlMjJjbG9zZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlR1dHVwJTIyJTdELCUwQSUyMCUyMmticHMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJrYnBzJTIyJTdELCUwQSUyMCUyMndpdGhvdXRBdWRpbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMnRhbnBhJTIwYXVkaW8lMjIlN0QsJTBBJTIwJTIyc2l6ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMnVrdXJhbiUyMiU3RCwlMEElMEElMjAlMjJzdWJ0aXRsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTdWJ0aXRlbCUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRhZnRhciUyMHB1dGFyJTIyJTdELCUwQSUyMCUyMmZpbGVsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGFmdGFyJTIwZmlsZSUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFdob2xlUGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJVbmR1aCUyMHNlbHVydWglMjBkYWZ0YXIlMjBwdXRhciUyMiU3RCwlMEElMEElMjAlMjJnZXRGaWxlU2l6ZVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGFwYXRrYW4lMjB1a3VyYW4lMjBmaWxlJTIyJTIwJTdELCUwQSUyMCUyMmdldEZpbGVTaXplRmFpbFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR2FnYWwlMjBtZW5kYXBhdGthbiUyMHVrdXJhbiUyMGZpbGUuJTIwTW9ob24lMjBjb2JhJTIwbGFnaS4lMjIlN0QsJTBBJTBBJTIwJTIybG1CdXR0b25UaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRhcGF0a2FuJTIwdGF1dGFuJTIwbGFuZ3N1bmclMjIlN0QsJTBBJTBBJTIwJTIyZG93bmxvYWRGcm9tQ3VycmVudFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCdWthJTIwU2F2ZUZyb20ubmV0JTIyJTdELCUwQSUyMCUyMnVwZGF0ZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2VnYXJrYW4lMjB0YXV0YW4lMjIlN0QsJTBBJTIwJTIydXBkYXRlTGlua3NOb3RpZmljYXRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUYXV0YW4lMjBkaXBlcmJhcnVpJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkTVAzRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJVbmR1aCUyMGZpbGUlMjBhdWRpbyUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVW5kdWglMjBkYWZ0YXIlMjBwdXRhciUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlVuZHVoJTIwZ2FtYmFyJTIyJTdELCUwQSUyMCUyMmluc3RhbGxGdWxsVmVyc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBhc2FuZyUyMHZlcnNpJTIwbGVuZ2thcCUyMiU3RCwlMEElMjAlMjJkaXNhYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTm9uYWt0aWZrYW4lMjIlN0QsJTBBJTIwJTIyc2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTZXRlbGFuJTIyJTdELCUwQSUyMCUyMnJlcG9ydEJ1ZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxhcG9ya2FuJTIwYnVnJTIyJTdELCUwQSUyMCUyMm9wZW5Qb2xsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySmFkaWthbiUyMGxlYmloJTIwYmFpayUyMiU3RCwlMEElMjAlMjJkaXNhYmxlTW9kdWxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTm9uYWt0aWZrYW4lMjBkaSUyMHNpdHVzJTIwd2ViJTIwaW5pJTIyJTdELCUwQSUyMCUyMmVuYWJsZU1vZHVsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFrdGlma2FuJTIwZGklMjBzaXR1cyUyMHdlYiUyMGluaSUyMiU3RCwlMEElMjAlMjJlbmFibGVEaXNhYmxlTW9kdWxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTnlhbGFrYW4vTWF0aWthbiUyMGRpJTIwc2l0dXMlMjBpbmklMjIlN0QsJTBBJTIwJTIyc2hvd0hpZGVCdXR0b24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUYW1waWxrYW4vdHV0dXAlMjB0YmwlMjBla3N0ZW5zaSUyMiU3RCwlMEElMjAlMjJ1cGRhdGVUbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBlcmJhcnVpJTIwa2UlMjAlMjVkJTIyJTdELCUwQSUwQSUyMCUyMmFib3V0UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRlbnRhbmclMjIlN0QsJTBBJTIwJTIyYWJvdXRUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJhbnR1YW4lMjBTYXZlRnJvbS5uZXQlMjIlN0QsJTBBJTIwJTIyYWJvdXRWZXJzaW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVmVyc2klMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1lbWJhbnR1JTIwcGVuZ2d1bmElMjBtZW5kYXBhdGthbiUyMHRhdXRhbiUyMGxhbmdzdW5nJTIwZGFyaSUyMDQwKyUyMHNpdHVzJTIwd2ViLCUyMHRlcm1hc3VrJTIwRGFpbHltb3Rpb24uY29tLCUyMFlvdVR1YmUuY29tLCUyMFZLLmNvbSUyMGRhbiUyMGxhaW4tbGFpbi4lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNZW1iYW50dSUyMHBlbmdndW5hJTIwbWVuZGFwYXRrYW4lMjB0YXV0YW4lMjBsYW5nc3VuZyUyMHVudHVrJTIwbWVuZ3VuZHVoJTIwZGFyaSUyMDQwKyUyMHNpdHVzJTIwd2ViLCUyMHRlcm1hc3VrJTIwRGFpbHltb3Rpb24uY29tLCUyMFZLLmNvbSUyMGRhbiUyMGxhaW4tbGFpbi4lMjIlN0QsJTBBJTIwJTIyYWJvdXRTdXBwb3J0ZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTdW1iZXIlMjBkYXlhJTIweWFuZyUyMGRpZHVrdW5nJTIyJTdELCUwQSUyMCUyMmhvbWVQYWdlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTGFtYW4lMjBiZXJhbmRhJTIyJTdELCUwQSUwQSUyMCUyMm9wdGlvbnNUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJhbnR1YW4lMjBTYXZlRnJvbS5uZXQlMjAtJTIwUHJlZmVyZW5zaSUyMiU3RCwlMEElMjAlMjJvcHRpb25zSGFuZGxlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUYW5nYW5pJTIwdGF1dGFuJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNGaWxlSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJLZSUyMGZpbGVob3N0aW5nJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNNZWRpYUhvc3RpbmdzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyS2UlMjBtZWRpYWhvc3RpbmclMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01vZHVsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNb2R1bCUyMiU3RCwlMEElMjAlMjJvcHRpb25zWW91dHViZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMllvdVR1YmUlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1lUSGlkZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2VtYnVueWlrYW4lMjB0YXV0YW4lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0RhaWx5bW90aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGFpbHltb3Rpb24lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1ZpbWVvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVmltZW8lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0ZhY2Vib29rJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRmFjZWJvb2slMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1NvdW5kY2xvdWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTb3VuZENsb3VkJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNWa29udGFrdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJWSyUyMiU3RCwlMEElMjAlMjJvcHRpb25zT2Rub2tsYXNzbmlraSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk9kbm9rbGFzc25pa2klMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01haWxydSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1veSUyME1pciUyMiU3RCwlMEElMjAlMjJvcHRpb25zSW5zdGFncmFtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySW5zdGFncmFtJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNSdXR1YmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJSdXR1YmUlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0JpdHJhdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMYW5nc3VuZyUyMHRhbXBpbGthbiUyMGJpdHJhdGUlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1NvdmV0bmlrRW5hYmxlZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBlbmFzaWhhdCUyMiU3RCwlMEElMjAlMjJvcHRpb25zU2hvd1VtbXlJbmZvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVGFtcGlsa2FuJTIwdGlwcyUyMHVudHVrJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMiU3RCwlMEElMjAlMjJvcHRpb25zR21OYXRpdmVEb3dubG9hZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk1vZGUlMjB1bmR1aCUyMGxhbmp1dGFuJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUJ0biUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlBlcmxpaGF0a2FuJTIwdG9tYm9sJTIwVW1teSUyMiU3RCwlMEElMjAlMjJvcHRpb25zQXZpYUJhckVuYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJDaGVhcCUyMEZsaWdodHMlMjBBZHZpc29yJTIyJTdELCUwQSUwQSUyMCUyMm1lbnVEb3dubG9hZEZyb21DdXJyZW50UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlVuZHVoJTIwZmlsZSUyMGRhcmklMjBsYW1hbiUyMHNhYXQlMjBpbmklMjBkZW5nYW4lMjBTYXZlRnJvbS5uZXQlMjIlN0QsJTBBJTIwJTIybWVudVVwZGF0ZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVGVrYW4lMjBqaWthJTIwdG9tYm9sJTIwVW5kdWglMjB0aWRhayUyMG11bmN1bCUyMiU3RCwlMEElMjAlMjJtZW51RG93bmxvYWRNUDNGaWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlVuZHVoJTIwc2VtdWElMjBmaWxlJTIwYXVkaW8lMjB5YW5nJTIwYWRhJTIwZGklMjBsYW1hbiUyMHNhYXQlMjBpbmklMjIlN0QsJTBBJTIwJTIybWVudURvd25sb2FkUGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCdWF0JTIwZGFuJTIwdW5kdWglMjBkYWZ0YXIlMjBwdXRhciUyMGJlcmlzaSUyMHRhdXRhbiUyMGtlJTIwZmlsZSUyMGF1ZGlvJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlVuZHVoJTIwc2VtdWElMjBnYW1iYXIlMjB5YW5nJTIwYWRhJTIwZGklMjBsYW1hbiUyMHNhYXQlMjBpbmklMjIlN0QsJTBBJTIwJTIybWVudVJlcG9ydEJ1ZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJlcmklMjB0YWh1JTIwa2FtaSUyMGppa2ElMjBBbmRhJTIwbWVuZ2FsYW1pJTIwbWFzYWxhaCUyMiU3RCwlMEElMjAlMjJtZW51U2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBS1RJRktBTi9OT05BS1RJRktBTiUyMHN1bWJlciUyMGRheWElMjB5YW5nJTIwZGlkdWt1bmclMjBkYW4lMjBvcHNpJTIwQmFudHVhbiUyMiU3RCwlMEElMjAlMjJtZW51RW5hYmxlRXh0ZW5zaW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTIyJTdELCUwQSUyMCUyMm1lbnVPcGVuUG9sbCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkthbWklMjBiZWtlcmphJTIwa2VyYXMlMjB1bnR1ayUyMGphZGklMjBsZWJpaCUyMGJhaWsuJTIwVG9sb25nLCUyMGJhbnR1JTIwa2FtaSElMjIlN0QsJTBBJTBBJTIwJTIycXVhbGl0eSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkt1YWxpdGFzJTIyJTdELCUwQSUyMCUyMnF1YWxpdHlOb3RlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVmlkZW8lMjB0ZXJiYWlrJTIweWFuZyUyMHRlcnNlZGlhJTIwYWthbiUyMGRpdW5kdWglMjBqaWthJTIwdGlkYWslMjBhZGElMjBrdWFsaXRhcyUyMHlhbmclMjBkaXBpbGloLiUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGFmdGFyJTIwZmlsZSUyMHlhbmclMjBkaXRlbXVrYW4lMjIlN0QsJTBBJTIwJTIyZmlsZWxpc3RJbnN0cnVjdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidVbnR1ayUyMG1lbmd1bmR1aCUyMHNlbXVhJTIwZmlsZSwlMjBzYWxpbiUyMGRhZnRhciUyMHRhdXRhbiUyMGRhbiUyMHRlbXBlbGthbiUyMGtlJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRG93bmxvYWRfbWFuYWdlcicsdGV4dDoncGVuZ2Vsb2xhJTIwdW5kdWhhbiclN0QlN0QsJy4lMjBKaWthJTIwQW5kYSUyMHRpZGFrJTIwbWVtaWxpa2klMjBwZW5nZWxvbGElMjB1bmR1aGFuLCUyMGthbWklMjBtZW55YXJhbmthbiUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vd3d3LmZyZWVkb3dubG9hZG1hbmFnZXIub3JnLycsdGV4dDonRnJlZSUyMERvd25sb2FkJTIwTWFuYWdlciclN0QlN0QsJy4nJTVEJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0VGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEYWZ0YXIlMjBwdXRhciUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdEluc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVW50dWslMjBtZW11dGFyJTIwZGFmdGFyJTIwcHV0YXIlMjB5YW5nJTIwZGlzaW1wYW4sJTIwc2VrYXJhbmclMjBiaXNhJTIwZGlidWthJTIwZGklMjBwZW11dGFyJTIwbXVzaWsuJTIyJTdELCUwQSUwQSUyMCUyMnVtbXlTZlRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySEQlMjBhdGF1JTIwTVAzJTIyJTdELCUwQSUyMCUyMnVtbXlNZW51SXRlbSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyJTIwOiUyMCUyMiU1QiU3QnNwYW46JTdCJTdEJTdELCclMjB2aWElMjBVbW15JyU1RCUyMiU3RCwlMEElMjAlMjJ1bW15TWVudUluZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUIlN0JwOiU3QnRleHQ6J1Bhc2FuZyUyMFVtbXklMjBWaWRlbyUyMERvd25sb2FkZXIlMjAlMjBkYW4lMjB1bmR1aCUyMHZpZGVvJTIwZmF2b3JpdCUyMEFuZGElMjBkYWxhbSUyMGZvcm1hdCUyMEhEJTIwYXRhdSUyME1QMy4nJTdEJTdELCU3QnA6JTdCY2xhc3M6J2NlbnRlcicsYXBwZW5kOiU1QiU3QmE6JTdCY2xhc3M6J2dyZWVuLWJ0bi0yJTIwYXJyb3cnLGhyZWY6JyU3QnVybCU3RCcsdGFyZ2V0OidfYmxhbmsnLHRleHQ6J1VuZHVoJyU3RCU3RCU1RCU3RCU3RCwlN0JwOiU3QmFwcGVuZDolNUInU2V0ZWxhaCUyMHBlbWFzYW5nYW4sJTIwdW5kdWhhbiUyMGFrYW4lMjBvdG9tYXRpcyUyMGRpbXVsYWklMjBzZXRpYXAlMjBrYWxpJTIwQW5kYSUyMG1lbmdla2xpayUyMCcsJTdCaW1nOiU3QnNyYzonIyclN0QlN0QlNUQlN0QlN0QlNUQlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQZXJpa3NhJTIwc2V0ZWxhbiUyMGJyb3dzZXIlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwRGVzYyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk9wc2klMjAlNUMlMjJTZWxhbHUlMjB0YW55YSUyMHNheWElMjBkaSUyMG1hbmElMjBtZW55aW1wYW4lMjBmaWxlJTVDJTIyJTIwaGFydXMlMjBkaW5vbmFrdGlma2FuLiUyMiU3RCwlMEElMjAlMjJyZWFkTW9yZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkxhaW5ueWElMjIlN0QsJTBBJTIwJTIybm9XYXJuaW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySmFuZ2FuJTIwYmVyaSUyMHRhaHUlMjIlN0QsJTBBJTIwJTIyY2FuY2VsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQmF0YWwlMjIlN0QsJTBBJTIwJTIyY29udGludWUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMYW5qdXRrYW4lMjIlN0QsJTBBJTIwJTIyYmVmb3JlRG93bmxvYWRQb3B1cFdhcm4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJQZXJoYXRpYW4hJTIwUGVuZ3VuZHVoYW4lMjB0aWRhayUyMGRhcGF0JTIwZGliYXRhbGthbiUyMGF0YXUlMjBkaXR1bmRhLiUyMiU3RCwlMEElMEElMjAlMjJ2a0luZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbmZvJTIyJTdELCUwQSUyMCUyMnZrSW5mb1RpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVWt1cmFuJTIwZmlsZSUyMGRhbiUyMGJpdHJhdGUlMjIlN0QsJTBBJTIwJTIydmtNcDNMaW5rc05vdEZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVGF1dGFuJTIwYXRhdSUyMGZpbGUlMjBNUDMlMjB0aWRhayUyMGRpdGVtdWthbiUyMiU3RCwlMEElMjAlMjJ2a1Bob3RvTGlua3NOb3RGb3VuZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkZvdG8lMjB0aWRhayUyMGRpdGVtdWthbiUyMiU3RCwlMEElMjAlMjJ2a0Rvd25sb2FkUGhvdG9BbGJ1bSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlVuZHVoJTIwYWxidW0lMjIlN0QsJTBBJTIwJTIydmtEb3dubG9hZEFsbFBob3RvQWxidW1zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVW5kdWglMjBzZW11YSUyMGFsYnVtJTIyJTdELCUwQSUyMCUyMnZrRm91bmRQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJGb3RvJTIwZGl0ZW11a2FuJTIyJTdELCUwQSUyMCUyMnZrTm90QXZhaWxhYmxlUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTI1ZCUyMGZvdG8lMjBzZW1lbnRhcmElMjBpbmklMjB0aWRhayUyMHRlcnNlZGlhJTIyJTdELCUwQSUyMCUyMnZrRm91bmRMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRhdXRhbiUyMGRpdGVtdWthbiUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kT2YlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJkYXJpJTIyJTdELCUwQSUyMCUyMnZrU2hvd0FzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVGFtcGlsa2FuJTIwc2ViYWdhaSUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZkxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGFmdGFyJTIwdGF1dGFuJTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mTGlua3NJbnN0cnVjdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidVbnR1ayUyMG1lbmd1bmR1aCUyMHNlbXVhJTIwZm90bywlMjBzYWxpbiUyMGRhZnRhciUyMHRhdXRhbiUyMGRhbiUyMHRlbXBlbGthbiUyMGtlJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRG93bmxvYWRfbWFuYWdlcicsdGV4dDoncGVuZ2Vsb2xhJTIwdW5kdWhhbiclN0QlN0QsJy4lMjBKaWthJTIwQW5kYSUyMHRpZGFrJTIwbWVtaWxpa2klMjBwZW5nZWxvbGElMjB1bmR1aGFuLCUyMGthbWklMjBtZW55YXJhbmthbiUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vd3d3LmZyZWVkb3dubG9hZG1hbmFnZXIub3JnLycsdGV4dDonRnJlZSUyMERvd25sb2FkJTIwTWFuYWdlciclN0QlN0QsJy4nJTVEJTIyJTdELCUwQSUyMCUyMnZrVGFibGVPZlRodW1ibmFpbHMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUYWJlbCUyMGdhbWJhciUyMG1pbmklMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEYWZ0YXIlMjBmb3RvJTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mUGhvdG9zSW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJLbGlrJTIwZm90byUyMHVudHVrJTIwbWVuZ3VuZHVobnlhLiUyMiU3RCwlMEElMjAlMjJ2a0ticHMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJrYnBzJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQiUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplS0J5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJrQiUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplTUJ5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNQiUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplR0J5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJHQiUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplVEJ5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUQiUyMiU3RCwlMEElMjAlMjJ2a0Rvd25sb2FkRnJvbVlvdXR1YmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInTWVuZ3VuZHVoOiUyMGJ1a2ElMjAnLCU3QmE6JTdCaHJlZjonJTdCdXJsJTdEJyx0ZXh0OidsYW1hbiUyMHZpZGVvJyU3RCU3RCwnJTIwZGFuJTIwdGVrYW4lMjB0b21ib2wlMjAlNUMlMjJVbmR1aCU1QyUyMiUyMGRpJTIwYXRhcyUyMHBlbXV0YXInJTVEJTIyJTdELCUwQSUyMCUyMnZrRm91bmRGaWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkZpbGUlMjBkaXRlbXVrYW46JTIwJTI1ZCUyMiU3RCwlMEElMEElMjAlMjJzaGFyZUluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQmFnaWthbiUyMGRpJTIwJTI1dyUyMiU3RCwlMEElMjAlMjJzb2NpYWxEZXNjJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVuZ2FuJTIwYmFudHVhbiUyMFNhdmVGcm9tLm5ldCwlMjBBbmRhJTIwZGFwYXQlMjBtZW5ndW5kdWglMjBmaWxlJTIwZGFyaSUyMFlvdVR1YmUuY29tLCUyMEZhY2Vib29rLmNvbSwlMjBWSy5jb20sJTIwZGFuJTIwbGViaWglMjBkYXJpJTIwNDAlMjBsYWlubnlhJTIwaGFueWElMjBkZW5nYW4lMjBzYXR1JTIwa2xpayUyMGdyYXRpcyUyMiU3RCwlMEElMEElMjAlMjJ0dXRvcmlhbFMxVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCZXJpdGElMjBiYWd1cyElMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTMU1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInU2F2ZUZyb20ubmV0JTIwSGVscGVyJTIwJywlN0JpbWc6JTIwJTdCc3JjOiUyMCcjbG9nbyclN0QlN0QsJyUyMHRlbGFoJTIwYmVyaGFzaWwlMjBkaWluc3RhbCUyMGRhbiUyMGtpbmklMjBBbmRhJTIwZGFwYXQlMjBtZW5ndW5kdWglMjB2aWRlbyUyMGFwYSUyMHB1biUyMGRhcmklMjBZb3VUdWJlJTIwZGVuZ2FuJTIwc2F0dSUyMGtsaWsnJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzFBcnJvdyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidBbmRhJTIwaW5naW4lMjB0YWh1JTIwY2FyYW55YT8nLCUyMCU3QmJyOiU3QiU3RCU3RCwlMjAnS2xpayUyMGRpJTIwc2luaSclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTMk1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJVbnR1ayUyMG1lbmd1bmR1aCUyMHZpZGVvLCUyMHBpbGloJTIwc3VhdHUlMjBmb3JtYXQlMjBkYW4lMjBrbGlrJTIwdG9tYm9sJTIwJTVDJTIyVW5kdWglNUMlMjIlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTM0hpc3RvcnklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJSaXdheWF0JTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzNNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ0FwYWthaCUyMEFuZGElMjBpbmdpbiUyMG1lbmd1bmR1aCUyMHZpZGVvJTIwZGFyaSUyMFJpd2F5YXQ/JywlMjAlN0JicjolN0IlN0QlN0QsJTIwJ0N1a3VwJTIwa2xpayUyMCcsJTIwJTdCaW1nOiUyMCU3QnNyYzolMjAnI2Fycm93JyU3RCU3RCwlMjAnJTIwcGFkYSUyMHByYXRpbmphdSUyMHZpZGVvJTIweWFuZyUyMHRlbGFoJTIwZGl0b250b24lMjBzZWJlbHVtbnlhJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFM0TWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidUaWRhayUyMHBlcmx1JTIwbWVub250b24lMjB2aWRlbyUyMCVFMiU4MCU5NCUyMGN1a3VwJTIwa2xpayUyMHBhZGElMjAnLCUyMCU3QmltZzolMjAlN0JzcmM6JTIwJyNhcnJvdyclN0QlN0QsJTIwJywlMjBwaWxpaCUyMG11dHVueWEsJTIwZGFuJTIwdW5kdWguJTIwQ3VrdXAlMjBtdWRhaCwlMjB5YT8nJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzVUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMk5pa21hdGklMjBTYXZlRnJvbS5uZXQlMjBIZWxwZXIhJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzVNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJ01hc2loJTIwcHVueWElMjBwZXJ0YW55YWFuPyUyMEluZ2luJTIwYmVyYmFnaSUyMGlkZT8lMjBTZWxhbWF0JTIwZGF0YW5nJTIwZGklMjAnLCUyMCU3QmE6JTIwJTdCdGV4dDolMjAnaGFsYW1hbiUyMGR1a3VuZ2FuJywlMjBocmVmOiUyMCcjc3VwcG9ydCclN0QlN0QsJyUyMGthbWklMjBhdGF1JTIwYmVyZ2FidW5nbGFoJTIwZGVuZ2FuJTIwa2FtaSUyMGRpJTIwJywlMjAlN0JhOiUyMCU3QnRleHQ6JTIwJ0ZhY2Vib29rJywlMjBocmVmOiUyMCcjZmInJTdEJTdEJTVEJTIyJTdELCUwQSUwQSUyMCUyMnR1dG9yaWFsVG9vbHRpcFRleHQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInQ3VrdXAlMjBrbGlrJTIwdG9tYm9sJTIwdW50dWslMjAnLCU3QmI6JTIwJTdCdGV4dDolMjAnbWVuZ3VuZHVoJyU3RCU3RCU1RCUyMiU3RCwlMEElMEElMjAlMjJ1bW15VG9vbHRpcENvbmZpcm0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInQXBha2FoJTIwQW5kYSUyMHN1ZGFoJTIwbWVuZ2luc3RhbCcsJTdCYnI6JTdCJTdEJTdELCU3QmltZzolN0IlN0QlN0QsJyUyMFVtbXklMjBWaWRlbyUyMERvd25sb2FkZXIlMjBzZWJlbHVtbnlhPyclNUQlMjIlN0QsJTBBJTIwJTIyeWVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyWWElMjIlN0QsJTBBJTIwJTIybm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUaWRhayUyMiU3RCwlMEElMjAlMjJ0b29sdGlwSGlkZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkphbmdhbiUyMHBlcmxpaGF0a2FuJTIwcGVzYW4lMjBpbmklMjBsYWdpJTIyJTdEJTBBJTdEIjsKICBfbGFuZ3VhZ2VMaXN0LnJ1ID0gIiU3QiUwQSUyMCUyMmV4dE5hbWUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjAlRDAlQkYlRDAlQkUlRDAlQkMlRDAlQkUlRDElODklRDAlQkQlRDAlQjglRDAlQkElMjIlN0QsJTBBJTIwJTIyZXh0RGVzY3JpcHRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDAlQkElRDAlQjAlRDElODclRDAlQjglRDAlQjIlRDAlQjAlRDAlQjklRDElODIlRDAlQjUlMjAlRDElODElMjAlRDAlOTIlRDAlQkElRDAlQkUlRDAlQkQlRDElODIlRDAlQjAlRDAlQkElRDElODIlRDAlQjUsJTIwWW91VHViZSwlMjAlRDAlOUUlRDAlQjQlRDAlQkQlRDAlQkUlRDAlQkElRDAlQkIlRDAlQjAlRDElODElRDElODElRDAlQkQlRDAlQjglRDAlQkElRDAlQjglMjAlRDAlQjglMjAlRDAlQjUlRDElODklRDAlQjUlMjA0MCUyMCVEMSU4MSVEMCVCMCVEMCVCOSVEMSU4MiVEMCVCRSVEMCVCMiUyMCVEMCVCNyVEMCVCMCUyMDElMjAlRDAlQkElRDAlQkIlRDAlQjglRDAlQkEuJTIyJTdELCUwQSUwQSUyMCUyMmV4dE5hbWVMaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQwJUJFJUQxJTg5JUQwJUJEJUQwJUI4JUQwJUJBJTIwbGl0ZSUyMiU3RCwlMEElMjAlMjJleHREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDAlQkElRDAlQjAlRDElODclRDAlQjglRDAlQjIlRDAlQjAlRDAlQjklRDElODIlRDAlQjUlMjAlRDElODElMjAlRDAlOTIlRDAlQkElRDAlQkUlRDAlQkQlRDElODIlRDAlQjAlRDAlQkElRDElODIlRDAlQjUsJTIwJUQwJTlFJUQwJUI0JUQwJUJEJUQwJUJFJUQwJUJBJUQwJUJCJUQwJUIwJUQxJTgxJUQxJTgxJUQwJUJEJUQwJUI4JUQwJUJBJUQwJUI4JTIwJUQwJUI4JTIwJUQwJUI1JUQxJTg5JUQwJUI1JTIwNDAlMjAlRDElODElRDAlQjAlRDAlQjklRDElODIlRDAlQkUlRDAlQjIlMjAlRDAlQjclRDAlQjAlMjAxJTIwJUQwJUJBJUQwJUJCJUQwJUI4JUQwJUJBLiUyMiU3RCwlMEElMEElMjAlMjJsYW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIycnUlMjIlN0QsJTBBJTBBJTIwJTIydGl0bGVEZWZhdWx0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQwJUJFJUQxJTg5JUQwJUJEJUQwJUI4JUQwJUJBJTIyJTdELCUwQSUyMCUyMnRpdGxlRGVzYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjAlRDAlQkYlRDAlQkUlRDAlQkMlRDAlQkUlRDElODklRDAlQkQlRDAlQjglRDAlQkElMjAlRDAlQjIlRDElOEIlRDAlQkElRDAlQkIlRDElOEUlRDElODclRDAlQjUlRDAlQkQlMjIlN0QsJTBBJTBBJTIwJTIybWVudUVuYWJsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MiVEMCVCQSVEMCVCQiVEMSU4RSVEMSU4NyVEMCVCOCVEMSU4MiVEMSU4QyUyMiU3RCwlMEElMjAlMjJtZW51RGlzYWJsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MiVEMSU4QiVEMCVCQSVEMCVCQiVEMSU4RSVEMSU4NyVEMCVCOCVEMSU4MiVEMSU4QyUyMiU3RCwlMEElMEElMjAlMjJzaG93QnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJFJUQwJUJBJUQwJUIwJUQwJUI3JUQxJThCJUQwJUIyJUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUJBJUQwJUJEJUQwJUJFJUQwJUJGJUQwJUJBJUQxJTgzJTIwJUQxJTgwJUQwJUIwJUQxJTgxJUQxJTg4JUQwJUI4JUQxJTgwJUQwJUI1JUQwJUJEJUQwJUI4JUQxJThGJTIyJTdELCUwQSUwQSUyMCUyMmNvcHklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUElRDAlQkUlRDAlQkYlRDAlQjglRDElODAlRDAlQkUlRDAlQjIlRDAlQjAlRDElODIlRDElOEMlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDAlQkElRDAlQjAlRDElODclRDAlQjAlRDElODIlRDElOEMlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RCVEMCVCMCVEMCVCNiVEMCVCQyVEMCVCOCVEMSU4MiVEMCVCNSUyMCVEMCVCRCVEMCVCMCUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCQSVEMSU4MywlMjAlRDElODMlRDAlQjQlRDAlQjUlRDElODAlRDAlQjYlRDAlQjglRDAlQjIlRDAlQjAlRDElOEYlMjAlRDAlQkElRDAlQkIlRDAlQjAlRDAlQjIlRDAlQjglRDElODglRDElODMlMjBBbHQlMjAlRDAlQjglRDAlQkIlRDAlQjglMjBDdHJsLCUyMCVEMSU4NyVEMSU4MiVEMCVCRSVEMCVCMSVEMSU4QiUyMCVEMSU4MSVEMCVCRSVEMSU4NSVEMSU4MCVEMCVCMCVEMCVCRCVEMCVCOCVEMSU4MiVEMSU4QyUyMCVEMSU4NCVEMCVCMCVEMCVCOSVEMCVCQi4lMjIlN0QsJTBBJTIwJTIybm9MaW5rc0ZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUI1JTIwJUQxJTgzJUQwJUI0JUQwJUIwJUQwJUJCJUQwJUJFJUQxJTgxJUQxJThDJTIwJUQwJUJEJUQwJUIwJUQwJUI5JUQxJTgyJUQwJUI4JTIwJUQxJTgxJUQxJTgxJUQxJThCJUQwJUJCJUQwJUJBJUQwJUI4JTIyJTdELCUwQSUyMCUyMm1vcmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTUlRDElODklRDElOTElMjIlN0QsJTBBJTIwJTIyY2xvc2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTclRDAlQjAlRDAlQkElRDElODAlRDElOEIlRDElODIlRDElOEMlMjIlN0QsJTBBJTIwJTIya2JwcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVCQSVEMCVCMS8lRDElODElMjIlN0QsJTBBJTIwJTIyd2l0aG91dEF1ZGlvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUIxJUQwJUI1JUQwJUI3JTIwJUQwJUIwJUQxJTgzJUQwJUI0JUQwJUI4JUQwJUJFJTIyJTdELCUwQSUyMCUyMnNpemUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDElODAlRDAlQjAlRDAlQjclRDAlQkMlRDAlQjUlRDElODAlMjIlN0QsJTBBJTBBJTIwJTIyc3VidGl0bGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQxJTgzJUQwJUIxJUQxJTgyJUQwJUI4JUQxJTgyJUQxJTgwJUQxJThCJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJCJUQwJUI1JUQwJUI5JUQwJUJCJUQwJUI4JUQxJTgxJUQxJTgyJTIyJTdELCUwQSUyMCUyMmZpbGVsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJGJUQwJUI4JUQxJTgxJUQwJUJFJUQwJUJBJTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUJFJUQwJUIyJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkV2hvbGVQbGF5bGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCMCVEMSU4MiVEMSU4QyUyMCVEMCVCMiVEMCVCNSVEMSU4MSVEMSU4QyUyMCVEMCVCRiVEMCVCQiVEMCVCNSVEMCVCOSVEMCVCQiVEMCVCOCVEMSU4MSVEMSU4MiUyMiU3RCwlMEElMEElMjAlMjJnZXRGaWxlU2l6ZVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlFJUQwJUJGJUQxJTgwJUQwJUI1JUQwJUI0JUQwJUI1JUQwJUJCJUQwJUI4JUQxJTgyJUQxJThDJTIwJUQxJTgwJUQwJUIwJUQwJUI3JUQwJUJDJUQwJUI1JUQxJTgwJTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUIwJTIyJTIwJTdELCUwQSUyMCUyMmdldEZpbGVTaXplRmFpbFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUI1JTIwJUQxJTgzJUQwJUI0JUQwJUIwJUQwJUJCJUQwJUJFJUQxJTgxJUQxJThDJTIwJUQwJUJFJUQwJUJGJUQxJTgwJUQwJUI1JUQwJUI0JUQwJUI1JUQwJUJCJUQwJUI4JUQxJTgyJUQxJThDJTIwJUQxJTgwJUQwJUIwJUQwJUI3JUQwJUJDJUQwJUI1JUQxJTgwJTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUIwLiUyMCVEMCU5RiVEMCVCRSVEMCVCRiVEMSU4MCVEMCVCRSVEMCVCMSVEMSU4MyVEMCVCOSVEMSU4MiVEMCVCNSUyMCVEMCVCRiVEMCVCRSVEMCVCMiVEMSU4MiVEMCVCRSVEMSU4MCVEMCVCOCVEMSU4MiVEMSU4QyUyMCVEMCVCRiVEMCVCRSVEMCVCRiVEMSU4QiVEMSU4MiVEMCVCQSVEMSU4My4lMjIlN0QsJTBBJTBBJTIwJTIybG1CdXR0b25UaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCRSVEMCVCQiVEMSU4MyVEMSU4NyVEMCVCOCUyMCVEMCVCRiVEMSU4MCVEMSU4RiVEMCVCQyVEMSU4MyVEMSU4RSUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCQSVEMSU4MyUyMiU3RCwlMEElMEElMjAlMjJkb3dubG9hZEZyb21DdXJyZW50UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCNSVEMSU4MCVEMCVCNSVEMCVCOSVEMSU4MiVEMCVCOCUyMCVEMCVCRCVEMCVCMCUyMFNhdmVGcm9tLm5ldCUyMiU3RCwlMEElMjAlMjJ1cGRhdGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RSVEMCVCMSVEMCVCRCVEMCVCRSVEMCVCMiVEMCVCOCVEMSU4MiVEMSU4QyUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCQSVEMCVCOCUyMiU3RCwlMEElMjAlMjJ1cGRhdGVMaW5rc05vdGlmaWNhdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCQSVEMCVCOCUyMCVEMCVCRSVEMCVCMSVEMCVCRCVEMCVCRSVEMCVCMiVEMCVCQiVEMCVCNSVEMCVCRCVEMSU4QiUyMiU3RCwlMEElMjAlMjJkb3dubG9hZE1QM0ZpbGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUIwJUQxJTgzJUQwJUI0JUQwJUI4JUQwJUJFJTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQxJThCJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkUGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDAlQkElRDAlQjAlRDElODclRDAlQjAlRDElODIlRDElOEMlMjAlRDAlQkYlRDAlQkIlRDAlQjUlRDAlQjklRDAlQkIlRDAlQjglRDElODElRDElODIlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDAlQkElRDAlQjAlRDElODclRDAlQjAlRDElODIlRDElOEMlMjAlRDElODQlRDAlQkUlRDElODIlRDAlQkUlRDAlQjMlRDElODAlRDAlQjAlRDElODQlRDAlQjglRDAlQjglMjIlN0QsJTBBJTIwJTIyaW5zdGFsbEZ1bGxWZXJzaW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUEzJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUI4JUQxJTgyJUQxJThDJTIwJUQwJUJGJUQwJUJFJUQwJUJCJUQwJUJEJUQxJTgzJUQxJThFJTIwJUQwJUIyJUQwJUI1JUQxJTgwJUQxJTgxJUQwJUI4JUQxJThFJTIyJTdELCUwQSUyMCUyMmRpc2FibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDElOEIlRDAlQkElRDAlQkIlRDElOEUlRDElODclRDAlQjglRDElODIlRDElOEMlMjIlN0QsJTBBJTIwJTIyc2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjAlRDElODElRDElODIlRDElODAlRDAlQkUlRDAlQjklRDAlQkElRDAlQjglMjIlN0QsJTBBJTIwJTIycmVwb3J0QnVnJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJFJUQwJUJFJUQwJUIxJUQxJTg5JUQwJUI4JUQxJTgyJUQxJThDJTIwJUQwJUJFJUQwJUIxJTIwJUQwJUJFJUQxJTg4JUQwJUI4JUQwJUIxJUQwJUJBJUQwJUI1JTIyJTdELCUwQSUyMCUyMm9wZW5Qb2xsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQxJTgyJUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUJCJUQxJTgzJUQxJTg3JUQxJTg4JUQwJUI1JTIyJTdELCUwQSUyMCUyMmRpc2FibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUUlRDElODIlRDAlQkElRDAlQkIlRDElOEUlRDElODclRDAlQjglRDElODIlRDElOEMlMjAlRDAlQkQlRDAlQjAlMjAlRDElOEQlRDElODIlRDAlQkUlRDAlQkMlMjAlRDElODElRDAlQjAlRDAlQjklRDElODIlRDAlQjUlMjIlN0QsJTBBJTIwJTIyZW5hYmxlTW9kdWxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTkyJUQwJUJBJUQwJUJCJUQxJThFJUQxJTg3JUQwJUI4JUQxJTgyJUQxJThDJTIwJUQwJUJEJUQwJUIwJTIwJUQxJThEJUQxJTgyJUQwJUJFJUQwJUJDJTIwJUQxJTgxJUQwJUIwJUQwJUI5JUQxJTgyJUQwJUI1JTIyJTdELCUwQSUyMCUyMmVuYWJsZURpc2FibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDAlQkElRDAlQkIvJUQwJTkyJUQxJThCJUQwJUJBJUQwJUJCJTIwJUQwJUJEJUQwJUIwJTIwJUQxJThEJUQxJTgyJUQwJUJFJUQwJUJDJTIwJUQxJTgxJUQwJUIwJUQwJUI5JUQxJTgyJUQwJUI1JTIyJTdELCUwQSUyMCUyMnNob3dIaWRlQnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJFJUQwJUJBJUQwJUIwJUQwJUI3Li8lRDElODElRDAlQkElRDElODAuJTIwJUQwJUJBJUQwJUJEJUQwJUJFJUQwJUJGJUQwJUJBJUQxJTgzJTIwJUQxJTgwJUQwJUIwJUQxJTgxJUQxJTg4JUQwJUI4JUQxJTgwJUQwJUI1JUQwJUJEJUQwJUI4JUQxJThGJTIyJTdELCUwQSUyMCUyMnVwZGF0ZVRvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlFJUQwJUIxJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUI4JUQxJTgyJUQxJThDJTIwJUQwJUI0JUQwJUJFJTIwJTI1ZCUyMiU3RCwlMEElMEElMjAlMjJhYm91dFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUUlMjAlRDElODAlRDAlQjAlRDElODElRDElODglRDAlQjglRDElODAlRDAlQjUlRDAlQkQlRDAlQjglRDAlQjglMjIlN0QsJTBBJTIwJTIyYWJvdXRUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMCVCRSVEMSU4OSVEMCVCRCVEMCVCOCVEMCVCQSUyMiU3RCwlMEElMjAlMjJhYm91dFZlcnNpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDAlQjUlRDElODAlRDElODElRDAlQjglRDElOEYlMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCRSVEMCVCNyVEMCVCMiVEMCVCRSVEMCVCQiVEMSU4RiVEMCVCNSVEMSU4MiUyMCVEMCVCRiVEMCVCRSVEMCVCQiVEMSU4MyVEMSU4NyVEMCVCMCVEMSU4MiVEMSU4QyUyMCVEMCVCRiVEMSU4MCVEMSU4RiVEMCVCQyVEMSU4QiVEMCVCNSUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCQSVEMCVCOCUyMCVEMCVCNCVEMCVCQiVEMSU4RiUyMCVEMSU4MSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCOCVEMCVCMiVEMCVCMCVEMCVCRCVEMCVCOCVEMSU4RiUyMCVEMSU4MSUyMCVEMCVCMSVEMCVCRSVEMCVCQiVEMCVCNSVEMCVCNSUyMCVEMSU4NyVEMCVCNSVEMCVCQyUyMDQwJTIwJUQxJTgxJUQwJUIwJUQwJUI5JUQxJTgyJUQwJUJFJUQwJUIyLCUyMCVEMSU4MSVEMSU4MCVEMCVCNSVEMCVCNCVEMCVCOCUyMCVEMCVCQSVEMCVCRSVEMSU4MiVEMCVCRSVEMSU4MCVEMSU4QiVEMSU4NSUyMCUyMFZLLmNvbSwlMjBZb3VUdWJlLmNvbSUyMCVEMCVCOCUyMCVEMCVCNCVEMSU4MCVEMSU4MyVEMCVCMyVEMCVCOCVEMCVCNS4lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQkUlRDAlQjclRDAlQjIlRDAlQkUlRDAlQkIlRDElOEYlRDAlQjUlRDElODIlMjAlRDAlQkYlRDAlQkUlRDAlQkIlRDElODMlRDElODclRDAlQjAlRDElODIlRDElOEMlMjAlRDAlQkYlRDElODAlRDElOEYlRDAlQkMlRDElOEIlRDAlQjUlMjAlRDElODElRDElODElRDElOEIlRDAlQkIlRDAlQkElRDAlQjglMjAlRDAlQjQlRDAlQkIlRDElOEYlMjAlRDElODElRDAlQkElRDAlQjAlRDElODclRDAlQjglRDAlQjIlRDAlQjAlRDAlQkQlRDAlQjglRDElOEYlMjAlRDElODElMjAlRDAlQjElRDAlQkUlRDAlQkIlRDAlQjUlRDAlQjUlMjAlRDElODclRDAlQjUlRDAlQkMlMjA0MCUyMCVEMSU4MSVEMCVCMCVEMCVCOSVEMSU4MiVEMCVCRSVEMCVCMiwlMjAlRDElODElRDElODAlRDAlQjUlRDAlQjQlRDAlQjglMjAlRDAlQkElRDAlQkUlRDElODIlRDAlQkUlRDElODAlRDElOEIlRDElODUlMjAlMjBWSy5jb20sJTIwVmltZW8lMjAlRDAlQjglMjAlRDAlQjQlRDElODAlRDElODMlRDAlQjMlRDAlQjglRDAlQjUuJTIyJTdELCUwQSUyMCUyMmFib3V0U3VwcG9ydGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJFJUQwJUI0JUQwJUI0JUQwJUI1JUQxJTgwJUQwJUI2JUQwJUI4JUQwJUIyJUQwJUIwJUQwJUI1JUQwJUJDJUQxJThCJUQwJUI1JTIwJUQxJTgwJUQwJUI1JUQxJTgxJUQxJTgzJUQxJTgwJUQxJTgxJUQxJThCJTIyJTdELCUwQSUyMCUyMmhvbWVQYWdlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk0JUQwJUJFJUQwJUJDJUQwJUIwJUQxJTg4JUQwJUJEJUQxJThGJUQxJThGJTIwJUQxJTgxJUQxJTgyJUQxJTgwJUQwJUIwJUQwJUJEJUQwJUI4JUQxJTg2JUQwJUIwJTIyJTdELCUwQSUwQSUyMCUyMm9wdGlvbnNUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMCVCRSVEMSU4OSVEMCVCRCVEMCVCOCVEMCVCQSUyMC0lMjAlRDAlOUQlRDAlQjAlRDElODElRDElODIlRDElODAlRDAlQkUlRDAlQjklRDAlQkElRDAlQjglMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0hhbmRsZUxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlFJUQwJUIxJUQxJTgwJUQwJUIwJUQwJUIxJUQwJUIwJUQxJTgyJUQxJThCJUQwJUIyJUQwJUIwJUQxJTgyJUQxJThDJTIwJUQxJTgxJUQxJTgxJUQxJThCJUQwJUJCJUQwJUJBJUQwJUI4JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNGaWxlSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjAlMjAlRDElODQlRDAlQjAlRDAlQjklRDAlQkIlRDAlQkUlRDAlQkUlRDAlQjElRDAlQkMlRDAlQjUlRDAlQkQlRDAlQkQlRDAlQjglRDAlQkElRDAlQjglMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01lZGlhSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjAlMjAlRDAlQkMlRDAlQjUlRDAlQjQlRDAlQjglRDAlQjAlRDElODUlRDAlQkUlRDElODElRDElODIlRDAlQjglRDAlQkQlRDAlQjMlRDAlQjglMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01vZHVsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUMlRDAlQkUlRDAlQjQlRDElODMlRDAlQkIlRDAlQjglMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1lvdXR1YmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJZb3VUdWJlJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNZVEhpZGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCQSVEMSU4MCVEMSU4QiVEMCVCMiVEMCVCMCVEMSU4MiVEMSU4QyUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCQSVEMCVCOCUyMiU3RCwlMEElMjAlMjJvcHRpb25zRGFpbHltb3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEYWlseW1vdGlvbiUyMiU3RCwlMEElMjAlMjJvcHRpb25zVmltZW8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJWaW1lbyUyMiU3RCwlMEElMjAlMjJvcHRpb25zRmFjZWJvb2slMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJGYWNlYm9vayUyMiU3RCwlMEElMjAlMjJvcHRpb25zU291bmRjbG91ZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNvdW5kQ2xvdWQlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1Zrb250YWt0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MiVEMCVCQSVEMCVCRSVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCQSVEMSU4MiVEMCVCNSUyMiU3RCwlMEElMjAlMjJvcHRpb25zT2Rub2tsYXNzbmlraSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RSVEMCVCNCVEMCVCRCVEMCVCRSVEMCVCQSVEMCVCQiVEMCVCMCVEMSU4MSVEMSU4MSVEMCVCRCVEMCVCOCVEMCVCQSVEMCVCOCUyMiU3RCwlMEElMjAlMjJvcHRpb25zTWFpbHJ1JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlDJUQwJUJFJUQwJUI5JTIwJUQwJUJDJUQwJUI4JUQxJTgwJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNJbnN0YWdyYW0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbnN0YWdyYW0lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1J1dHViZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlJ1dHViZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zQml0cmF0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCRSVEMCVCQSVEMCVCMCVEMCVCNyVEMSU4QiVEMCVCMiVEMCVCMCVEMSU4MiVEMSU4QyUyMCVEMCVCMSVEMCVCOCVEMSU4MiVEMSU4MCVEMCVCNSVEMCVCOSVEMSU4MiUyMCVEMSU4MSVEMSU4MCVEMCVCMCVEMCVCNyVEMSU4MyUyMiU3RCwlMEElMjAlMjJvcHRpb25zU292ZXRuaWtFbmFibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJFJUQwJUIyJUQwJUI1JUQxJTgyJUQwJUJEJUQwJUI4JUQwJUJBJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUluZm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQkUlRDAlQkElRDAlQjAlRDAlQjclRDElOEIlRDAlQjIlRDAlQjAlRDElODIlRDElOEMlMjAlRDAlQkYlRDAlQkUlRDAlQjQlRDElODElRDAlQkElRDAlQjAlRDAlQjclRDAlQkElRDAlQjglMjAlRDAlQjQlRDAlQkIlRDElOEYlMjBVbW15JTIwVmlkZW8lMjBEb3dubG9hZGVyJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNHbU5hdGl2ZURvd25sb2FkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUEwJUQwJUIwJUQxJTgxJUQxJTg4JUQwJUI4JUQxJTgwJUQwJUI1JUQwJUJEJUQwJUJEJUQxJThCJUQwJUI5JTIwJUQxJTgwJUQwJUI1JUQwJUI2JUQwJUI4JUQwJUJDJTIwJUQwJUI3JUQwJUIwJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUJBJUQwJUI4JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNTaG93VW1teUJ0biUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RSVEMSU4MiVEMCVCRSVEMCVCMSVEMSU4MCVEMCVCMCVEMCVCNiVEMCVCMCVEMSU4MiVEMSU4QyUyMCVEMCVCQSVEMCVCRCVEMCVCRSVEMCVCRiVEMCVCQSVEMSU4MyUyMFVtbXklMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0F2aWFCYXJFbmFibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJFJUQwJUIyJUQwJUI1JUQxJTgyJUQwJUJEJUQwJUI4JUQwJUJBJTIwJUQwJTk0JUQwJUI1JUQxJTg4JUQwJUI1JUQwJUIyJUQxJThCJUQxJTg1JTIwJUQwJTkwJUQwJUIyJUQwJUI4JUQwJUIwJUQwJUIxJUQwJUI4JUQwJUJCJUQwJUI1JUQxJTgyJUQwJUJFJUQwJUIyJTIyJTdELCUwQSUwQSUyMCUyMm1lbnVEb3dubG9hZEZyb21DdXJyZW50UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCMCVEMSU4MiVEMSU4QyUyMCVEMSU4NCVEMCVCMCVEMCVCOSVEMCVCQiVEMSU4QiUyMCVEMSU4MSUyMCVEMSU4MiVEMCVCNSVEMCVCQSVEMSU4MyVEMSU4OSVEMCVCNSVEMCVCOSUyMCVEMSU4MSVEMSU4MiVEMSU4MCVEMCVCMCVEMCVCRCVEMCVCOCVEMSU4NiVEMSU4QiUyMCVEMSU4MSUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMCVCRSVEMSU4OSVEMSU4QyVEMSU4RSUyMCVEMSU4MSVEMCVCNSVEMSU4MCVEMCVCMiVEMCVCOCVEMSU4MSVEMCVCMCUyMFNhdmVGcm9tLm5ldCUyMiU3RCwlMEElMjAlMjJtZW51VXBkYXRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjAlRDAlQjYlRDAlQkMlRDAlQjglRDElODIlRDAlQjUsJTIwJUQwJUI1JUQxJTgxJUQwJUJCJUQwJUI4JTIwJUQxJTgxJUQxJTgxJUQxJThCJUQwJUJCJUQwJUJBJUQwJUIwJTIwJUQwJUI0JUQwJUJCJUQxJThGJTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUI4JUQwJUIyJUQwJUIwJUQwJUJEJUQwJUI4JUQxJThGJTIwJUQwJUJEJUQwJUI1JTIwJUQwJUJGJUQwJUJFJUQxJThGJUQwJUIyJUQwJUJCJUQxJThGJUQwJUI1JUQxJTgyJUQxJTgxJUQxJThGJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZE1QM0ZpbGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUIyJUQxJTgxJUQwJUI1JTIwJUQwJUJEJUQwJUIwJUQwJUI5JUQwJUI0JUQwJUI1JUQwJUJEJUQwJUJEJUQxJThCJUQwJUI1JTIwJUQwJUJEJUQwJUIwJTIwJUQxJTgxJUQxJTgyJUQxJTgwJUQwJUIwJUQwJUJEJUQwJUI4JUQxJTg2JUQwJUI1JTIwJUQwJUIwJUQxJTgzJUQwJUI0JUQwJUI4JUQwJUJFJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQxJThCJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUE0JUQwJUJFJUQxJTgwJUQwJUJDJUQwJUI4JUQxJTgwJUQxJTgzJUQwJUI1JUQxJTgyJTIwJUQwJUI4JTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUI4JUQwJUIyJUQwJUIwJUQwJUI1JUQxJTgyJTIwJUQwJUJGJUQwJUJCJUQwJUI1JUQwJUI5JUQwJUJCJUQwJUI4JUQxJTgxJUQxJTgyJTIwJUQxJTgxJTIwJUQxJTgxJUQxJTgxJUQxJThCJUQwJUJCJUQwJUJBJUQwJUIwJUQwJUJDJUQwJUI4JTIwJUQwJUJEJUQwJUIwJTIwJUQwJUIwJUQxJTgzJUQwJUI0JUQwJUI4JUQwJUJFJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQxJThCJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCMCVEMSU4MiVEMSU4QyUyMCVEMCVCMiVEMSU4MSVEMCVCNSUyMCVEMCVCRCVEMCVCMCVEMCVCOSVEMCVCNCVEMCVCNSVEMCVCRCVEMCVCRCVEMSU4QiVEMCVCNSUyMCVEMCVCRCVEMCVCMCUyMCVEMSU4MSVEMSU4MiVEMSU4MCVEMCVCMCVEMCVCRCVEMCVCOCVEMSU4NiVEMCVCNSUyMCVEMSU4NCVEMCVCRSVEMSU4MiVEMCVCRSVEMCVCMyVEMSU4MCVEMCVCMCVEMSU4NCVEMCVCOCVEMCVCOCUyMiU3RCwlMEElMjAlMjJtZW51UmVwb3J0QnVnJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk0JUQwJUIwJUQwJUI5JUQxJTgyJUQwJUI1JTIwJUQwJUJEJUQwJUIwJUQwJUJDJTIwJUQwJUI3JUQwJUJEJUQwJUIwJUQxJTgyJUQxJThDLCUyMCVEMCVCNSVEMSU4MSVEMCVCQiVEMCVCOCUyMCVEMCVCMiVEMCVCRSVEMCVCNyVEMCVCRCVEMCVCOCVEMCVCQSVEMCVCQiVEMCVCOCUyMCVEMCVCRiVEMSU4MCVEMCVCRSVEMCVCMSVEMCVCQiVEMCVCNSVEMCVCQyVEMSU4QiUyMiU3RCwlMEElMjAlMjJtZW51U2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDAlQkElRDAlQkIuLyVEMCVCRSVEMSU4MiVEMCVCQSVEMCVCQi4lMjAlRDAlQkYlRDAlQkUlRDAlQjQlRDAlQjQlRDAlQjUlRDElODAlRDAlQjYlRDAlQjglRDAlQjIlRDAlQjAlRDAlQjUlRDAlQkMlRDElOEIlRDAlQjUlMjAlRDElODAlRDAlQjUlRDElODElRDElODMlRDElODAlRDElODElRDElOEIlMjAlRDAlQjglMjAlRDAlQjIlRDAlQkUlRDAlQjclRDAlQkMlRDAlQkUlRDAlQjYlRDAlQkQlRDAlQkUlRDElODElRDElODIlRDAlQjglMjAlRDAlQkYlRDAlQkUlRDAlQkMlRDAlQkUlRDElODklRDAlQkQlRDAlQjglRDAlQkElRDAlQjAlMjIlN0QsJTBBJTIwJTIybWVudUVuYWJsZUV4dGVuc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiUyMiU3RCwlMEElMjAlMjJtZW51T3BlblBvbGwlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQkUlRDAlQjYlRDAlQjAlRDAlQkIlRDElODMlRDAlQjklRDElODElRDElODIlRDAlQjAsJTIwJUQwJUJFJUQxJTg2JUQwJUI1JUQwJUJEJUQwJUI4JUQxJTgyJUQwJUI1JTIwJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUI1JUQxJTgxJUQxJTgyJUQwJUIyJUQwJUJFJTIwJUQxJTgwJUQwJUIwJUQxJTgxJUQxJTg4JUQwJUI4JUQxJTgwJUQwJUI1JUQwJUJEJUQwJUI4JUQxJThGJTIwJTVDJTIyU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQwJUJFJUQxJTg5JUQwJUJEJUQwJUI4JUQwJUJBJTVDJTIyJTIyJTdELCUwQSUwQSUyMCUyMnF1YWxpdHklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUElRDAlQjAlRDElODclRDAlQjUlRDElODElRDElODIlRDAlQjIlRDAlQkUlMjIlN0QsJTBBJTIwJTIycXVhbGl0eU5vdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTUlRDElODElRDAlQkIlRDAlQjglMjAlRDAlQjIlRDAlQjglRDAlQjQlRDAlQjUlRDAlQkUlMjAlRDAlQjIlMjAlRDAlQkQlRDElODMlRDAlQjYlRDAlQkQlRDAlQkUlRDAlQkMlMjAlRDAlQkElRDAlQjAlRDElODclRDAlQjUlRDElODElRDElODIlRDAlQjIlRDAlQjUlMjAlRDAlQkQlRDAlQjUlRDElODIsJTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQwJUI1JUQxJTgyJUQxJTgxJUQxJThGJTIwJUQwJUJCJUQxJTgzJUQxJTg3JUQxJTg4JUQwJUI1JUQwJUI1JTIwJUQwJUI4JUQwJUI3JTIwJUQwJUIyJUQwJUJFJUQwJUI3JUQwJUJDJUQwJUJFJUQwJUI2JUQwJUJEJUQwJUJFJUQwJUIzJUQwJUJFLiUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJGJUQwJUI4JUQxJTgxJUQwJUJFJUQwJUJBJTIwJUQwJUJEJUQwJUIwJUQwJUI5JUQwJUI0JUQwJUI1JUQwJUJEJUQwJUJEJUQxJThCJUQxJTg1JTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUJFJUQwJUIyJTIyJTdELCUwQSUyMCUyMmZpbGVsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUE3JUQxJTgyJUQwJUJFJUQwJUIxJUQxJThCJTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUIyJUQxJTgxJUQwJUI1JTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQxJThCLCUyMCVEMSU4MSVEMCVCQSVEMCVCRSVEMCVCRiVEMCVCOCVEMSU4MCVEMSU4MyVEMCVCOSVEMSU4MiVEMCVCNSUyMCVEMSU4MSVEMCVCRiVEMCVCOCVEMSU4MSVEMCVCRSVEMCVCQSUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCRSVEMCVCQSUyMCVEMCVCOCUyMCVEMCVCMiVEMSU4MSVEMSU4MiVEMCVCMCVEMCVCMiVEMSU4QyVEMSU4MiVEMCVCNSUyMCVEMCVCNSVEMCVCMyVEMCVCRSUyMCVEMCVCMiUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vcnUud2lraXBlZGlhLm9yZy93aWtpLyVEMCU5QyVEMCVCNSVEMCVCRCVEMCVCNSVEMCVCNCVEMCVCNiVEMCVCNSVEMSU4MF8lRDAlQjclRDAlQjAlRDAlQjMlRDElODAlRDElODMlRDAlQjclRDAlQkUlRDAlQkEnLHRleHQ6JyVEMCVCQyVEMCVCNSVEMCVCRCVEMCVCNSVEMCVCNCVEMCVCNiVEMCVCNSVEMSU4MCUyMCVEMCVCNyVEMCVCMCVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCNSVEMCVCQSclN0QlN0QsJy4lMjAlRDAlOTUlRDElODElRDAlQkIlRDAlQjglMjAlRDElODMlMjAlRDAlQjIlRDAlQjAlRDElODElMjAlRDAlQkQlRDAlQjUlMjAlRDElODMlRDElODElRDElODIlRDAlQjAlRDAlQkQlRDAlQkUlRDAlQjIlRDAlQkIlRDAlQjUlRDAlQkQlMjAlRDAlQkMlRDAlQjUlRDAlQkQlRDAlQjUlRDAlQjQlRDAlQjYlRDAlQjUlRDElODAlMjAlRDAlQjclRDAlQjAlRDAlQkElRDAlQjAlRDElODclRDAlQjUlRDAlQkEsJTIwJUQxJTgwJUQwJUI1JUQwJUJBJUQwJUJFJUQwJUJDJUQwJUI1JUQwJUJEJUQwJUI0JUQxJTgzJUQwJUI1JUQwJUJDJTIwJUQxJTgzJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUI4JUQxJTgyJUQxJThDJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly93d3cud2VzdGJ5dGUuY29tL2RtLycsdGV4dDonRG93bmxvYWQlMjBNYXN0ZXInJTdEJTdELCcuJyU1RCUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJCJUQwJUI1JUQwJUI5JUQwJUJCJUQwJUI4JUQxJTgxJUQxJTgyJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDAlQkUlRDElODUlRDElODAlRDAlQjAlRDAlQkQlRDAlQjUlRDAlQkQlRDAlQkQlRDElOEIlRDAlQjklMjAlRDAlQkYlRDAlQkIlRDAlQjUlRDAlQjklRDAlQkIlRDAlQjglRDElODElRDElODIlMjAlRDAlQkMlRDAlQkUlRDAlQjYlRDAlQkQlRDAlQkUlMjAlRDAlQkUlRDElODIlRDAlQkElRDElODAlRDElOEIlRDElODIlRDElOEMlMjAlRDAlQjIlMjAlRDAlQkYlRDAlQkIlRDAlQjUlRDAlQjUlRDElODAlRDAlQjUlMjAlRDAlQjQlRDAlQkIlRDElOEYlMjAlMjAlRDAlQjIlRDAlQkUlRDElODElRDAlQkYlRDElODAlRDAlQkUlRDAlQjglRDAlQjclRDAlQjIlRDAlQjUlRDAlQjQlRDAlQjUlRDAlQkQlRDAlQjglRDElOEYuJTIyJTdELCUwQSUwQSUyMCUyMnVtbXlTZlRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySEQlMjAlRDAlQjglRDAlQkIlRDAlQjglMjBNUDMlMjIlN0QsJTBBJTIwJTIydW1teU1lbnVJdGVtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjIlMjA6JTIwJTIyJTVCJTdCc3BhbjolN0IlN0QlN0QsJyUyMCVEMSU4MSUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMCVCRSVEMSU4OSVEMSU4QyVEMSU4RSUyMFVtbXknJTVEJTIyJTdELCUwQSUyMCUyMnVtbXlNZW51SW5mbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiU3QnA6JTdCYXBwZW5kOiU1QiclRDAlQTElRDAlQkElRDAlQjAlRDElODclRDAlQjglRDAlQjIlRDAlQjAlRDAlQjklRDElODIlRDAlQjUlMjBIRCUyMCVEMCVCOCUyME1QMyUyMCVEMSU4MSUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMCVCRSVEMSU4OSVEMSU4QyVEMSU4RSUyMCVEMCVCMSVEMCVCNSVEMSU4MSVEMCVCRiVEMCVCQiVEMCVCMCVEMSU4MiVEMCVCRCVEMCVCRSVEMCVCOSUyMCVEMCVCRiVEMSU4MCVEMCVCRSVEMCVCMyVEMSU4MCVEMCVCMCVEMCVCQyVEMCVCQyVEMSU4QicsJTIwJTdCYnI6JTdCJTdEJTdELCUyMCdVbW15JTIwVmlkZW8lMjBEb3dubG9hZGVyISclNUQlN0QlN0QsJTdCcDolN0JjbGFzczonY2VudGVyJyxhcHBlbmQ6JTVCJTdCYTolN0JjbGFzczonZ3JlZW4tYnRuLTIlMjBhcnJvdycsaHJlZjonJTdCdXJsJTdEJyx0YXJnZXQ6J19ibGFuaycsdGV4dDonJUQwJUEzJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUI4JUQxJTgyJUQxJThDJyU3RCU3RCU1RCU3RCU3RCwlN0JwOiU3QmFwcGVuZDolNUInJUQwJTlGJUQwJUJFJUQxJTgxJUQwJUJCJUQwJUI1JTIwJUQxJTgzJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUJBJUQwJUI4JTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUI4JUQwJUIyJUQwJUIwJUQwJUJEJUQwJUI4JUQwJUI1JTIwJUQwJUIxJUQxJTgzJUQwJUI0JUQwJUI1JUQxJTgyJTIwJUQwJUJEJUQwJUIwJUQxJTg3JUQwJUI4JUQwJUJEJUQwJUIwJUQxJTgyJUQxJThDJUQxJTgxJUQxJThGJTIwJUQwJUIwJUQwJUIyJUQxJTgyJUQwJUJFJUQwJUJDJUQwJUIwJUQxJTgyJUQwJUI4JUQxJTg3JUQwJUI1JUQxJTgxJUQwJUJBJUQwJUI4JywlMjAlN0JicjolN0IlN0QlN0QsJTIwJyVEMCVCRiVEMSU4MCVEMCVCOCUyMCVEMCVCQSVEMCVCQiVEMCVCOCVEMCVCQSVEMCVCNSUyMCVEMCVCRCVEMCVCMCUyMCcsJTdCaW1nOiU3QnNyYzonIyclN0QlN0QlNUQlN0QlN0QlNUQlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDElODAlRDAlQkUlRDAlQjIlRDAlQjUlRDElODAlRDElOEMlRDElODIlRDAlQjUlMjAlRDAlQkQlRDAlQjAlRDElODElRDElODIlRDElODAlRDAlQkUlRDAlQjklRDAlQkElRDAlQjglMjAlRDAlQjElRDElODAlRDAlQjAlRDElODMlRDAlQjclRDAlQjUlRDElODAlRDAlQjAlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwRGVzYyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MiVEMSU4QiVEMCVCMSVEMCVCRSVEMSU4MCUyMCVEMCVCRiVEMCVCMCVEMCVCRiVEMCVCQSVEMCVCOCUyMCVEMCVCRiVEMSU4MCVEMCVCOCUyMCVEMSU4MSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCOCVEMCVCMiVEMCVCMCVEMCVCRCVEMCVCOCVEMCVCOCUyMCVEMCVCNCVEMCVCRSVEMCVCQiVEMCVCNiVEMCVCNSVEMCVCRCUyMCVEMCVCMSVEMSU4QiVEMSU4MiVEMSU4QyUyMCVEMCVCRSVEMSU4MiVEMCVCQSVEMCVCQiVEMSU4RSVEMSU4NyVEMCVCNSVEMCVCRC4lMjIlN0QsJTBBJTIwJTIycmVhZE1vcmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQkUlRDAlQjQlRDElODAlRDAlQkUlRDAlQjElRDAlQkQlRDAlQjUlRDAlQjUuLi4lMjIlN0QsJTBBJTIwJTIybm9XYXJuaW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUI1JTIwJUQwJUJGJUQxJTgwJUQwJUI1JUQwJUI0JUQxJTgzJUQwJUJGJUQxJTgwJUQwJUI1JUQwJUI2JUQwJUI0JUQwJUIwJUQxJTgyJUQxJThDJTIyJTdELCUwQSUyMCUyMmNhbmNlbCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RSVEMSU4MiVEMCVCQyVEMCVCNSVEMCVCRCVEMCVCMCUyMiU3RCwlMEElMjAlMjJjb250aW51ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMSU4MCVEMCVCRSVEMCVCNCVEMCVCRSVEMCVCQiVEMCVCNiVEMCVCOCVEMSU4MiVEMSU4QyUyMiU3RCwlMEElMjAlMjJiZWZvcmVEb3dubG9hZFBvcHVwV2FybiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MiVEMCVCRCVEMCVCOCVEMCVCQyVEMCVCMCVEMCVCRCVEMCVCOCVEMCVCNTolMjAlRDAlQkUlRDElODIlRDAlQkMlRDAlQjUlRDAlQkQlRDAlQjglRDElODIlRDElOEMlMjAlRDAlQjglRDAlQkIlRDAlQjglMjAlRDAlQkYlRDElODAlRDAlQjglRDAlQkUlRDElODElRDElODIlRDAlQjAlRDAlQkQlRDAlQkUlRDAlQjIlRDAlQjglRDElODIlRDElOEMlMjAlRDAlQjclRDAlQjAlRDAlQkElRDAlQjAlRDElODclRDAlQkElRDElODMlMjAlRDAlQjElRDElODMlRDAlQjQlRDAlQjUlRDElODIlMjAlRDAlQkQlRDAlQjUlRDAlQjIlRDAlQkUlRDAlQjclRDAlQkMlRDAlQkUlRDAlQjYlRDAlQkQlRDAlQkUuJTIyJTdELCUwQSUwQSUyMCUyMnZrSW5mbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCMCVEMSU4MCVEMCVCMCVEMCVCQyVEMCVCNSVEMSU4MiVEMSU4MCVEMSU4QiUyMiU3RCwlMEElMjAlMjJ2a0luZm9UaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMCVEMCVCMCVEMCVCNyVEMCVCQyVEMCVCNSVEMSU4MCUyMCVEMSU4NCVEMCVCMCVEMCVCOSVEMCVCQiVEMCVCMCUyMCVEMCVCOCUyMCVEMCVCMSVEMCVCOCVEMSU4MiVEMSU4MCVEMCVCNSVEMCVCOSVEMSU4MiUyMiU3RCwlMEElMjAlMjJ2a01wM0xpbmtzTm90Rm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjUlMjAlRDAlQkQlRDAlQjAlRDAlQjklRDAlQjQlRDAlQjUlRDAlQkQlRDElOEIlMjAlRDElODElRDElODElRDElOEIlRDAlQkIlRDAlQkElRDAlQjglMjAlRDAlQkQlRDAlQjAlMjBNUDMlMjAlRDElODQlRDAlQjAlRDAlQjklRDAlQkIlRDElOEIlMjIlN0QsJTBBJTIwJTIydmtQaG90b0xpbmtzTm90Rm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjUlMjAlRDAlQkQlRDAlQjAlRDAlQjklRDAlQjQlRDAlQjUlRDAlQkQlRDElOEIlMjAlRDElODElRDElODElRDElOEIlRDAlQkIlRDAlQkElRDAlQjglMjAlRDAlQkQlRDAlQjAlMjAlRDElODQlRDAlQkUlRDElODIlRDAlQkUlRDAlQjMlRDElODAlRDAlQjAlRDElODQlRDAlQjglRDAlQjglMjIlN0QsJTBBJTIwJTIydmtEb3dubG9hZFBob3RvQWxidW0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDAlQkElRDAlQjAlRDElODclRDAlQjAlRDElODIlRDElOEMlMjAlRDAlQjAlRDAlQkIlRDElOEMlRDAlQjElRDAlQkUlRDAlQkMlMjIlN0QsJTBBJTIwJTIydmtEb3dubG9hZEFsbFBob3RvQWxidW1zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUIyJUQxJTgxJUQwJUI1JTIwJUQwJUIwJUQwJUJCJUQxJThDJUQwJUIxJUQwJUJFJUQwJUJDJUQxJThCJTIyJTdELCUwQSUyMCUyMnZrRm91bmRQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjAlRDAlQjklRDAlQjQlRDAlQjUlRDAlQkQlRDAlQkUlMjAlRDElODQlRDAlQkUlRDElODIlRDAlQkUlRDAlQjMlRDElODAlRDAlQjAlRDElODQlRDAlQjglRDAlQjklMjIlN0QsJTBBJTIwJTIydmtOb3RBdmFpbGFibGVQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlMjVkJTIwJUQxJTg0JUQwJUJFJUQxJTgyJUQwJUJFJTIwJUQwJUIyJUQxJTgwJUQwJUI1JUQwJUJDJUQwJUI1JUQwJUJEJUQwJUJEJUQwJUJFJTIwJUQwJUJEJUQwJUI1JTIwJUQwJUI0JUQwJUJFJUQxJTgxJUQxJTgyJUQxJTgzJUQwJUJGJUQwJUJEJUQwJUJFJTIyJTdELCUwQSUyMCUyMnZrRm91bmRMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RCVEMCVCMCVEMCVCOSVEMCVCNCVEMCVCNSVEMCVCRCVEMCVCRSUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCRSVEMCVCQSUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kT2YlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQjglRDAlQjclMjIlN0QsJTBBJTIwJTIydmtTaG93QXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQkUlRDAlQkElRDAlQjAlRDAlQjclRDAlQjAlRDElODIlRDElOEMlMjAlRDAlQkElRDAlQjAlRDAlQkElMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCRiVEMCVCOCVEMSU4MSVEMCVCRSVEMCVCQSUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCRSVEMCVCQSUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZkxpbmtzSW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUE3JUQxJTgyJUQwJUJFJUQwJUIxJUQxJThCJTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUIyJUQxJTgxJUQwJUI1JTIwJUQxJTg0JUQwJUJFJUQxJTgyJUQwJUJFJUQwJUIzJUQxJTgwJUQwJUIwJUQxJTg0JUQwJUI4JUQwJUI4LCUyMCVEMSU4MSVEMCVCQSVEMCVCRSVEMCVCRiVEMCVCOCVEMSU4MCVEMSU4MyVEMCVCOSVEMSU4MiVEMCVCNSUyMCVEMSU4MSVEMCVCRiVEMCVCOCVEMSU4MSVEMCVCRSVEMCVCQSUyMCVEMSU4MSVEMSU4MSVEMSU4QiVEMCVCQiVEMCVCRSVEMCVCQSUyMCVEMCVCOCUyMCVEMCVCMiVEMSU4MSVEMSU4MiVEMCVCMCVEMCVCMiVEMSU4QyVEMSU4MiVEMCVCNSUyMCVEMCVCNSVEMCVCMyVEMCVCRSUyMCVEMCVCMiUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vcnUud2lraXBlZGlhLm9yZy93aWtpLyVEMCU5QyVEMCVCNSVEMCVCRCVEMCVCNSVEMCVCNCVEMCVCNiVEMCVCNSVEMSU4MF8lRDAlQjclRDAlQjAlRDAlQjMlRDElODAlRDElODMlRDAlQjclRDAlQkUlRDAlQkEnLHRleHQ6JyVEMCVCQyVEMCVCNSVEMCVCRCVEMCVCNSVEMCVCNCVEMCVCNiVEMCVCNSVEMSU4MCUyMCVEMCVCNyVEMCVCMCVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCNSVEMCVCQSclN0QlN0QsJy4lMjAlRDAlOTUlRDElODElRDAlQkIlRDAlQjglMjAlRDElODMlMjAlRDAlQjIlRDAlQjAlRDElODElMjAlRDAlQkQlRDAlQjUlMjAlRDElODMlRDElODElRDElODIlRDAlQjAlRDAlQkQlRDAlQkUlRDAlQjIlRDAlQkIlRDAlQjUlRDAlQkQlMjAlRDAlQkMlRDAlQjUlRDAlQkQlRDAlQjUlRDAlQjQlRDAlQjYlRDAlQjUlRDElODAlMjAlRDAlQjclRDAlQjAlRDAlQkElRDAlQjAlRDElODclRDAlQjUlRDAlQkEsJTIwJUQxJTgwJUQwJUI1JUQwJUJBJUQwJUJFJUQwJUJDJUQwJUI1JUQwJUJEJUQwJUI0JUQxJTgzJUQwJUI1JUQwJUJDJTIwJUQxJTgzJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUI4JUQxJTgyJUQxJThDJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly93d3cud2VzdGJ5dGUuY29tL2RtLycsdGV4dDonRG93bmxvYWQlMjBNYXN0ZXInJTdEJTdELCcuJyU1RCUyMiU3RCwlMEElMjAlMjJ2a1RhYmxlT2ZUaHVtYm5haWxzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUEyJUQwJUIwJUQwJUIxJUQwJUJCJUQwJUI4JUQxJTg2JUQxJTgzJTIwJUQxJThEJUQxJTgxJUQwJUJBJUQwJUI4JUQwJUI3JUQwJUJFJUQwJUIyJTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJGJUQwJUI4JUQxJTgxJUQwJUJFJUQwJUJBJTIwJUQxJTg0JUQwJUJFJUQxJTgyJUQwJUJFJUQwJUIzJUQxJTgwJUQwJUIwJUQxJTg0JUQwJUI4JUQwJUI5JTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mUGhvdG9zSW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTclRDElODIlRDAlQkUlRDAlQjElRDElOEIlMjAlRDElODElRDAlQkElRDAlQjAlRDElODclRDAlQjAlRDElODIlRDElOEMlMjAlRDElODQlRDAlQkUlRDElODIlRDAlQkUlRDAlQjMlRDElODAlRDAlQjAlRDElODQlRDAlQjglRDElOEUsJTIwJUQxJTg5JUQwJUI1JUQwJUJCJUQwJUJBJUQwJUJEJUQwJUI4JUQxJTgyJUQwJUI1JTIwJUQwJUJEJUQwJUIwJTIwJUQwJUJEJUQwJUI1JUQwJUI5JTIwJUQwJUJCJUQwJUI1JUQwJUIyJUQwJUJFJUQwJUI5JTIwJUQwJUJBJUQwJUJEJUQwJUJFJUQwJUJGJUQwJUJBJUQwJUJFJUQwJUI5JTIwJUQwJUJDJUQxJThCJUQxJTg4JUQwJUI4LiUyMiU3RCwlMEElMjAlMjJ2a0ticHMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQkElRDAlQjEvJUQxJTgxJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTkxJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVLQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVCQSVEMCU5MSUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplTUJ5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUMlRDAlOTElMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZUdCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTkzJUQwJTkxJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVUQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMiVEMCU5MSUyMiU3RCwlMEElMjAlMjJ2a0Rvd25sb2FkRnJvbVlvdXR1YmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUExJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQxJThDOiUyMCVEMCVCRSVEMSU4MiVEMCVCQSVEMSU4MCVEMCVCRSVEMCVCOSVEMSU4MiVEMCVCNSUyMCcsJTdCYTolN0JocmVmOiclN0J1cmwlN0QnLHRleHQ6JyVEMSU4MSVEMSU4MiVEMSU4MCVEMCVCMCVEMCVCRCVEMCVCOCVEMSU4NiVEMSU4MyUyMCVEMCVCMiVEMCVCOCVEMCVCNCVEMCVCNSVEMCVCRSUyMCVEMSU4MCVEMCVCRSVEMCVCQiVEMCVCOCVEMCVCQSVEMCVCMCclN0QlN0QsJyUyMCVEMCVCOCUyMCVEMCVCRCVEMCVCMCVEMCVCNiVEMCVCQyVEMCVCOCVEMSU4MiVEMCVCNSUyMCVEMCVCQSVEMCVCRCVEMCVCRSVEMCVCRiVEMCVCQSVEMSU4MyUyMCU1QyUyMiVEMCVBMSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCMCVEMSU4MiVEMSU4QyU1QyUyMiUyMCVEMCVCRCVEMCVCMCVEMCVCNCUyMCVEMCVCRiVEMCVCQiVEMCVCNSVEMCVCNSVEMSU4MCVEMCVCRSVEMCVCQyclNUQlMjIlN0QsJTBBJTIwJTIydmtGb3VuZEZpbGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUIwJUQwJUI5JUQwJUI0JUQwJUI1JUQwJUJEJUQwJUJFJTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUJFJUQwJUIyOiUyMCUyNWQlMjIlN0QsJTBBJTBBJTIwJTIyc2hhcmVJbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCRSVEMCVCNCVEMCVCNSVEMCVCQiVEMCVCOCVEMSU4MiVEMSU4QyVEMSU4MSVEMSU4RiUyMCVEMCVCMiUyMCUyNXclMjIlN0QsJTBBJTIwJTIyc29jaWFsRGVzYyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMCVCRSVEMSU4OSVEMCVCRCVEMCVCOCVEMCVCQSUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMCVCRSVEMCVCMyVEMCVCMCVEMCVCNSVEMSU4MiUyMCVEMCVCMSVEMCVCNSVEMSU4MSVEMCVCRiVEMCVCQiVEMCVCMCVEMSU4MiVEMCVCRCVEMCVCRSUyMCVEMSU4MSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCOCVEMCVCMiVEMCVCMCVEMSU4MiVEMSU4QyUyMCVEMSU4MSUyMFZLLmNvbSwlMjBZb3VUdWJlLmNvbSwlMjBPZG5va2xhc3NuaWtpLnJ1JTIwJUQwJUI4JTIwJUQwJUIxJUQwJUJFJUQwJUJCJUQwJUI1JUQwJUI1JTIwNDAlMjAlRDAlQjQlRDElODAlRDElODMlRDAlQjMlRDAlQjglRDElODUlMjAlRDElODElRDAlQjAlRDAlQjklRDElODIlRDAlQkUlRDAlQjIlMjAlRDAlQjIlMjAxJTIwJUQwJUJBJUQwJUJCJUQwJUI4JUQwJUJBJTIyJTdELCUwQSUwQSUyMCUyMnR1dG9yaWFsUzFUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBNSVEMCVCRSVEMSU4MCVEMCVCRSVEMSU4OCVEMCVCOCVEMCVCNSUyMCVEMCVCRCVEMCVCRSVEMCVCMiVEMCVCRSVEMSU4MSVEMSU4MiVEMCVCOCElMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTMU1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUEzJTIwJUQxJTgyJUQwJUI1JUQwJUIxJUQxJThGJTIwJUQxJTgzJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUJCJUQwJUI1JUQwJUJEJTIwU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQwJUJFJUQxJTg5JUQwJUJEJUQwJUI4JUQwJUJBJTIwJywlN0JpbWc6JTIwJTdCc3JjOiUyMCcjbG9nbyclN0QlN0QsJywlMjAlRDAlQjglMjAlRDElODIlRDAlQjUlRDAlQkYlRDAlQjUlRDElODAlRDElOEMlMjAlRDElODIlRDElOEIlMjAlRDAlQkMlRDAlQkUlRDAlQjYlRDAlQjUlRDElODglRDElOEMlMjAlRDElODElRDAlQkElRDAlQjAlRDElODclRDAlQjAlRDElODIlRDElOEMlMjAlRDAlQkIlRDElOEUlRDAlQjElRDAlQkUlRDAlQjUlMjAlRDAlQjIlRDAlQjglRDAlQjQlRDAlQjUlRDAlQkUlMjAlRDElODElMjBZb3VUdWJlJTIwJUQwJUIyJTIwJUQwJUJFJUQwJUI0JUQwJUI4JUQwJUJEJTIwJUQwJUJBJUQwJUJCJUQwJUI4JUQwJUJBJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMxQXJyb3clMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUE1JUQwJUJFJUQxJTg3JUQwJUI1JUQxJTg4JUQxJThDJTIwJUQxJTgzJUQwJUI3JUQwJUJEJUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUJBJUQwJUIwJUQwJUJBPycsJTdCYnI6JTdCJTdEJTdELCclRDAlOUQlRDAlQjAlRDAlQjYlRDAlQkMlRDAlQjglMjAlRDAlQjclRDAlQjQlRDAlQjUlRDElODElRDElOEMnJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzJNYWluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUE3JUQxJTgyJUQwJUJFJUQwJUIxJUQxJThCJTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQxJThDJTIwJUQwJUIyJUQwJUI4JUQwJUI0JUQwJUI1JUQwJUJFLCUyMCVEMCVCMiVEMSU4QiVEMCVCMSVEMCVCNSVEMSU4MCVEMCVCOCUyMCVEMSU4NCVEMCVCRSVEMSU4MCVEMCVCQyVEMCVCMCVEMSU4MiUyMCVEMCVCOCUyMCVEMCVCRCVEMCVCMCVEMCVCNiVEMCVCQyVEMCVCOCUyMCVEMCVCQSVEMCVCRCVEMCVCRSVEMCVCRiVEMCVCQSVEMSU4MyUyMCU1QyUyMiVEMCVBMSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCMCVEMSU4MiVEMSU4QyU1QyUyMiUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMzSGlzdG9yeSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMSU4MCVEMCVCRSVEMSU4MSVEMCVCQyVEMCVCRSVEMSU4MiVEMSU4MCVEMCVCNSVEMCVCRCVEMCVCRCVEMSU4QiVEMCVCNSUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMzTWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiclRDAlQTUlRDAlQkUlRDElODclRDAlQjUlRDElODglRDElOEMlMjAlRDElODElRDAlQkElRDAlQjAlRDElODclRDAlQjAlRDElODIlRDElOEMlMjAlRDElODMlRDAlQjYlRDAlQjUlMjAlRDAlQkYlRDElODAlRDAlQkUlRDElODElRDAlQkMlRDAlQkUlRDElODIlRDElODAlRDAlQjUlRDAlQkQlRDAlQkQlRDAlQkUlRDAlQjUlMjAlRDAlQjIlRDAlQjglRDAlQjQlRDAlQjUlRDAlQkU/JywlN0JicjolN0IlN0QlN0QsJyVEMCU5RCVEMCVCMCVEMCVCNiVEMCVCOCVEMCVCQyVEMCVCMCVEMCVCOSUyMCVEMCVCRCVEMCVCMCUyMCcsJTIwJTdCaW1nOiUyMCU3QnNyYzolMjAnI2Fycm93JyU3RCU3RCwnJTIwJUQwJUJEJUQwJUIwJTIwJUQwJUJGJUQxJTgwJUQwJUI1JUQwJUIyJUQxJThDJUQxJThFJTIwJUQwJUIyJTIwJUQwJTlGJUQxJTgwJUQwJUJFJUQxJTgxJUQwJUJDJUQwJUJFJUQxJTgyJUQxJTgwJUQwJUI1JUQwJUJEJUQwJUJEJUQxJThCJUQxJTg1JTIwJUQwJUIyJUQwJUI4JUQwJUI0JUQwJUI1JUQwJUJFJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFM0TWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiclRDAlOTIlRDAlQjglRDAlQjQlRDAlQjUlRDAlQkUlMjAlRDAlQkQlRDAlQjUlMjAlRDAlQkUlRDAlQjElRDElOEYlRDAlQjclRDAlQjAlRDElODIlRDAlQjUlRDAlQkIlRDElOEMlRDAlQkQlRDAlQkUlMjAlRDAlQkYlRDElODAlRDAlQkUlRDElODElRDAlQkMlRDAlQjAlRDElODIlRDElODAlRDAlQjglRDAlQjIlRDAlQjAlRDElODIlRDElOEMlMjAlRTIlODAlOTQnLCU3QmJyOiU3QiU3RCU3RCwnJUQwJUJEJUQwJUIwJUQwJUI2JUQwJUI4JUQwJUJDJUQwJUIwJUQwJUI5JTIwJUQwJUJEJUQwJUIwJTIwJywlMjAlN0JpbWc6JTIwJTdCc3JjOiUyMCcjYXJyb3cnJTdEJTdELCcsJTIwJUQwJUIyJUQxJThCJUQwJUIxJUQwJUI4JUQxJTgwJUQwJUIwJUQwJUI5JTIwJUQxJTg0JUQwJUJFJUQxJTgwJUQwJUJDJUQwJUIwJUQxJTgyJTIwJUQwJUI4JTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUI4JUQwJUIyJUQwJUIwJUQwJUI5LiUyMCVEMCVBRCVEMSU4MiVEMCVCRSUyMCVEMSU4MyVEMCVCNCVEMCVCRSVEMCVCMSVEMCVCRCVEMCVCRSEnJTVEJTIyJTdELCUwQSUyMCUyMnR1dG9yaWFsUzVUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMSU4MCVEMCVCOCVEMSU4RiVEMSU4MiVEMCVCRCVEMCVCRSVEMCVCOSUyMCVEMSU4MCVEMCVCMCVEMCVCMSVEMCVCRSVEMSU4MiVEMSU4QiElMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNU1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJTlFJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJCJUQwJUI4JUQxJTgxJUQxJThDJTIwJUQwJUIyJUQwJUJFJUQwJUJGJUQxJTgwJUQwJUJFJUQxJTgxJUQxJThCPyUyMCVEMCU5NSVEMSU4MSVEMSU4MiVEMSU4QyUyMCVEMCVCRiVEMSU4MCVEMCVCNSVEMCVCNCVEMCVCQiVEMCVCRSVEMCVCNiVEMCVCNSVEMCVCRCVEMCVCOCVEMSU4Rj8lMjAlRDAlOTclRDAlQjAlRDAlQjMlRDAlQkIlRDElOEYlRDAlQkQlRDAlQjglRDElODIlRDAlQjUlMjAlRDAlQkQlRDAlQjAlMjAnLCUyMCU3QmE6JTIwJTdCdGV4dDolMjAnJUQxJTgxJUQxJTgyJUQxJTgwJUQwJUIwJUQwJUJEJUQwJUI4JUQxJTg2JUQxJTgzJTIwJUQwJUJGJUQwJUJFJUQwJUI0JUQwJUI0JUQwJUI1JUQxJTgwJUQwJUI2JUQwJUJBJUQwJUI4JywlMjBocmVmOiUyMCcjc3VwcG9ydCclN0QlN0QsJyUyMCVEMCVCOCVEMCVCQiVEMCVCOCUyMCVEMCVCMiVEMSU4MSVEMSU4MiVEMSU4MyVEMCVCRiVEMCVCMCVEMCVCOSVEMSU4MiVEMCVCNSUyMCVEMCVCMiUyMCVEMCVCRCVEMCVCMCVEMSU4OCVEMCVCNSUyMCcsJTIwJTdCYTolMjAlN0J0ZXh0OiUyMCclRDAlOTIlRDAlOUEtJUQxJTgxJUQwJUJFJUQwJUIxJUQxJTg5JUQwJUI1JUQxJTgxJUQxJTgyJUQwJUIyJUQwJUJFJywlMjBocmVmOiUyMCcjdmsnJTdEJTdEJTVEJTIyJTdELCUwQSUwQSUyMCUyMnR1dG9yaWFsVG9vbHRpcFRleHQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUE3JUQxJTgyJUQwJUJFJUQwJUIxJUQxJThCJTIwJywlN0JiOiUyMCU3QnRleHQ6JTIwJyVEMSU4MSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCMCVEMSU4MiVEMSU4QyclN0QlN0QsJywlMjAlRDAlQkYlRDElODAlRDAlQkUlRDElODElRDElODIlRDAlQkUlMjAlRDAlQkElRDAlQkIlRDAlQjglRDAlQkElRDAlQkQlRDAlQjglRDElODIlRDAlQjUlMjAlRDAlQkYlRDAlQkUlMjAlRDAlQkElRDAlQkQlRDAlQkUlRDAlQkYlRDAlQkElRDAlQjUnJTVEJTIyJTdELCUwQSUwQSUyMCUyMnVtbXlUb29sdGlwQ29uZmlybSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiclRDAlOTIlRDElOEIlMjAlRDElODMlRDAlQjYlRDAlQjUlMjAlRDElODMlRDElODElRDElODIlRDAlQjAlRDAlQkQlRDAlQkUlRDAlQjIlRDAlQjglRDAlQkIlRDAlQjgnLCU3QmJyOiU3QiU3RCU3RCwlN0JpbWc6JTdCJTdEJTdELCclMjBVbW15JTIwVmlkZW8lMjBEb3dubG9hZGVyPyclNUQlMjIlN0QsJTBBJTIwJTIyeWVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk0JUQwJUIwJTIyJTdELCUwQSUyMCUyMm5vJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUI1JUQxJTgyJTIyJTdELCUwQSUyMCUyMnRvb2x0aXBIaWRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTkxJUQwJUJFJUQwJUJCJUQxJThDJUQxJTg4JUQwJUI1JTIwJUQwJUJEJUQwJUI1JTIwJUQwJUJGJUQwJUJFJUQwJUJBJUQwJUIwJUQwJUI3JUQxJThCJUQwJUIyJUQwJUIwJUQxJTgyJUQxJThDJTIwJUQxJThEJUQxJTgyJUQwJUJFJTIwJUQxJTgxJUQwJUJFJUQwJUJFJUQwJUIxJUQxJTg5JUQwJUI1JUQwJUJEJUQwJUI4JUQwJUI1JTIyJTdEJTBBJTdEIjsKICBfbGFuZ3VhZ2VMaXN0LnRyID0gIiU3QiUwQSUyMCUyMmV4dE5hbWUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBhc2lzdGFuJTIyJTdELCUwQSUyMCUyMmV4dERlc2NyaXB0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2FkZWNlJTIwYmlyJTIwdCVDNCVCMWtsYW1hJTIwaWxlJTIwWW91VHViZSwlMjBGYWNlYm9vaywlMjBWSy5jb20lMjB2ZSUyMDQwJ2RhbiUyMGZhemxhJTIwc2l0ZWRlbiUyMGRvc3lhJTIwaW5kaXJpbi4lMjIlN0QsJTBBJTBBJTIwJTIyZXh0TmFtZUxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBhc2lzdGFuJTIwbGl0ZSUyMiU3RCwlMEElMjAlMjJleHREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYWRlY2UlMjBiaXIlMjB0JUM0JUIxa2xhbWElMjBpbGUlMjBGYWNlYm9vaywlMjBWSy5jb20lMjB2ZSUyMDQwJ2RhbiUyMGZhemxhJTIwc2l0ZWRlbiUyMGRvc3lhJTIwaW5kaXJpbiUyMiU3RCwlMEElMEElMjAlMjJsYW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIydHIlMjIlN0QsJTBBJTBBJTIwJTIydGl0bGVEZWZhdWx0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwYXNpc3RhbiUyMiU3RCwlMEElMjAlMjJ0aXRsZURlc2FibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwYXNpc3RhbiUyMGRldnJlJTIwZCVDNCVCMSVDNSU5RiVDNCVCMSUyMiU3RCwlMEElMEElMjAlMjJtZW51RW5hYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRXRraW4lMjIlN0QsJTBBJTIwJTIybWVudURpc2FibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEZXZyZSUyMGQlQzQlQjElQzUlOUYlQzQlQjElMjIlN0QsJTBBJTBBJTIwJTIyc2hvd0J1dHRvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkVrbGVudGklMjBkJUMzJUJDJUM0JTlGbWVzaW5pJTIwZyVDMyVCNnN0ZXIlMjIlN0QsJTBBJTBBJTIwJTIyY29weSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMktvcHlhbGElMjIlN0QsJTBBJTIwJTIyZG93bmxvYWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlQzQlQjBuZGlyJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEb3N5YXklQzQlQjElMjBpbmRpcm1layUyMGklQzMlQTdpbiUyMEFsdC9PcHRpb24lMjB2ZXlhJTIwQ3RybCUyMHR1JUM1JTlGdW5hJTIwYmFzJUM0JUIxbCVDNCVCMSUyMHR1dGFyYWslMjBiYSVDNCU5RmxhbnQlQzQlQjF5JUM0JUIxJTIwdCVDNCVCMWtsYXklQzQlQjFuLiUyMiU3RCwlMEElMjAlMjJub0xpbmtzRm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIaSVDMyVBN2JpciUyMGJhJUM0JTlGbGFudCVDNCVCMSUyMGJ1bHVuYW1hZCVDNCVCMSUyMiU3RCwlMEElMjAlMjJtb3JlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGFoYSUyMGZhemxhJTIyJTdELCUwQSUyMCUyMmNsb3NlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyS2FwYXQlMjIlN0QsJTBBJTIwJTIya2JwcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMmticHMlMjIlN0QsJTBBJTIwJTIyd2l0aG91dEF1ZGlvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyd2l0aG91dCUyMGF1ZGlvJTIyJTdELCUwQSUyMCUyMnNpemUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJib3l1dCUyMiU3RCwlMEElMEElMjAlMjJzdWJ0aXRsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBbHQlMjB5YXolQzQlQjElMjIlN0QsJTBBJTIwJTIycGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlQzMlODdhbG1hJTIwbGlzdGVzaSUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRvc3lhJTIwbGlzdGVzaSUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFdob2xlUGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUJDbSUyMCVDMyVBN2FsbWElMjBsaXN0ZXNpbmklMjBpbmRpciUyMiU3RCwlMEElMEElMjAlMjJnZXRGaWxlU2l6ZVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG9zeWElMjBib3l1dHVudSUyMGFsJTIyJTIwJTdELCUwQSUyMCUyMmdldEZpbGVTaXplRmFpbFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG9zeWElMjBib3l1dHUlMjBhbCVDNCVCMW5hbWFkJUM0JUIxLiUyMEwlQzMlQkN0ZmVuJTIwdGVrcmFyJTIwZGVuZXlpbml6LiUyMiU3RCwlMEElMEElMjAlMjJsbUJ1dHRvblRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRG8lQzQlOUZydWRhbiUyMGJhJUM0JTlGbGFudCVDNCVCMSUyMGFsJTIyJTdELCUwQSUwQSUyMCUyMmRvd25sb2FkRnJvbUN1cnJlbnRQYWdlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0J2UlMjBnaXQlMjIlN0QsJTBBJTIwJTIydXBkYXRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCYSVDNCU5RmxhbnQlQzQlQjFsYXIlQzQlQjElMjB5ZW5pbGUlMjIlN0QsJTBBJTIwJTIydXBkYXRlTGlua3NOb3RpZmljYXRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCYSVDNCU5RmxhbnQlQzQlQjFsYXIlMjBnJUMzJUJDbmNlbGxlbmRpJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkTVAzRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTZXMlMjBkb3N5YWxhciVDNCVCMW4lQzQlQjElMjBpbmRpciUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUMzJTg3YWxtYSUyMGxpc3Rlc2luaSUyMGluZGlyJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyUmVzaW1sZXJpJTIwaW5kaXIlMjIlN0QsJTBBJTIwJTIyaW5zdGFsbEZ1bGxWZXJzaW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVGFtJTIwdmVyc2l5b251JTIwa3VyJTIyJTdELCUwQSUyMCUyMmRpc2FibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEZXZyZSUyMGQlQzQlQjElQzUlOUYlQzQlQjElMjIlN0QsJTBBJTIwJTIyc2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBeWFybGFyJTIyJTdELCUwQSUyMCUyMnJlcG9ydEJ1ZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhhdGElMjBiaWxkaXIlMjIlN0QsJTBBJTIwJTIyb3BlblBvbGwlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCZWNvbWUlMjBiZXR0ZXIlMjIlN0QsJTBBJTIwJTIyZGlzYWJsZU1vZHVsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJ1JTIwd2ViJTIwc2l0ZXNpbmRlJTIwZGV2cmUlMjBkJUM0JUIxJUM1JTlGJUM0JUIxJTIwYiVDNCVCMXJhayUyMiU3RCwlMEElMjAlMjJlbmFibGVNb2R1bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCdSUyMHdlYiUyMHNpdGVzaW5kZSUyMGV0a2lubGUlQzUlOUZ0aXIlMjIlN0QsJTBBJTIwJTIyZW5hYmxlRGlzYWJsZU1vZHVsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJ1JTIwc2l0ZWRlJTIwZXRraW4vZGV2cmUlMjBkJUM0JUIxJUM1JTlGJUM0JUIxJTIyJTdELCUwQSUyMCUyMnNob3dIaWRlQnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRWtsZW50aSUyMGJ1dG9udW51JTIwZyVDMyVCNnN0ZXIvZ2l6bGUlMjIlN0QsJTBBJTIwJTIydXBkYXRlVG8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlMjVkJTIwcyVDMyVCQ3IlQzMlQkNtJUMzJUJDbmUlMjBnJUMzJUJDbmNlbGxlJTIyJTdELCUwQSUwQSUyMCUyMmFib3V0UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhha2slQzQlQjFuZGElMjIlN0QsJTBBJTIwJTIyYWJvdXRUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMEFzaXN0YW4lMjIlN0QsJTBBJTIwJTIyYWJvdXRWZXJzaW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVmVyc2l5b24lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkt1bGxhbiVDNCVCMWMlQzQlQjFsYXIlQzQlQjFuLCUyMERhaWx5bW90aW9uLmNvbSwlMjBZb3VUdWJlLmNvbSwlMjBWSy5jb20lMjB2ZSUyMGRpJUM0JTlGZXJsZXJpJTIwZGUlMjBkYWhpbCUyMG9sbWFrJTIwJUMzJUJDemVyZSUyMDQwJ2RhbiUyMGZhemxhJTIwd2ViJTIwc2l0ZXNpbmRlbiUyMGRvc3lhJTIwaW5kaXJtZWslMjBpJUMzJUE3aW4lMjBkbyVDNCU5RnJ1ZGFuJTIwYmElQzQlOUZsYW50JUM0JUIxbGFyJTIwYWxtYWxhciVDNCVCMW4lQzQlQjElMjBzYSVDNCU5Rmxhci4lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJLdWxsYW4lQzQlQjFjJUM0JUIxbGFyJUM0JUIxbiwlMjBEYWlseW1vdGlvbi5jb20sJTIwVksuY29tJTIwdmUlMjBkaSVDNCU5RmVybGVyaSUyMGRlJTIwZGFoaWwlMjBvbG1hayUyMCVDMyVCQ3plcmUlMjA0MCdkYW4lMjBmYXpsYSUyMHdlYiUyMHNpdGVzaW5kZW4lMjBkb3N5YSUyMGluZGlybWVrJTIwaSVDMyVBN2luJTIwZG8lQzQlOUZydWRhbiUyMGJhJUM0JTlGbGFudCVDNCVCMWxhciUyMGFsbWFsYXIlQzQlQjFuJUM0JUIxJTIwc2ElQzQlOUZsYXIuJTIyJTdELCUwQSUyMCUyMmFib3V0U3VwcG9ydGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGVzdGVrbGVuZW4lMjBrYXluYWtsYXIlMjIlN0QsJTBBJTIwJTIyaG9tZVBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJBbmElMjBTYXlmYSUyMiU3RCwlMEElMEElMjAlMjJvcHRpb25zVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjBBc2lzdGFuJTIwLSUyMFRlcmNpaGxlciUyMiU3RCwlMEElMjAlMjJvcHRpb25zSGFuZGxlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJMaW5rbGVyaSUyMHRhJUM1JTlGJUM0JUIxJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNGaWxlSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEb3N5YSUyMHBheWxhJUM1JTlGJUM0JUIxbWElMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01lZGlhSG9zdGluZ3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNZWR5YSUyMHBheWxhJUM1JTlGJUM0JUIxbWElMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01vZHVsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJNb2QlQzMlQkNsbGVyJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNZb3V0dWJlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyWW91VHViZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zWVRIaWRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCYSVDNCU5RmxhbnQlQzQlQjFsYXIlQzQlQjElMjBnaXpsZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zRGFpbHltb3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEYWlseW1vdGlvbiUyMiU3RCwlMEElMjAlMjJvcHRpb25zVmltZW8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJWaW1lbyUyMiU3RCwlMEElMjAlMjJvcHRpb25zRmFjZWJvb2slMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJGYWNlYm9vayUyMiU3RCwlMEElMjAlMjJvcHRpb25zU291bmRjbG91ZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNvdW5kQ2xvdWQlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1Zrb250YWt0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlZLJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNPZG5va2xhc3NuaWtpJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyT2Rub2tsYXNzbmlraSUyMiU3RCwlMEElMjAlMjJvcHRpb25zTWFpbHJ1JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTW95JTIwTWlyJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNJbnN0YWdyYW0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJJbnN0YWdyYW0lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1J1dHViZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlJ1dHViZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zQml0cmF0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJpdCUyMGglQzQlQjF6JUM0JUIxbiVDNCVCMSUyMGFubCVDNCVCMWslMjBvbGFyYWslMjBnJUMzJUI2c3RlciUyMiU3RCwlMEElMjAlMjJvcHRpb25zU292ZXRuaWtFbmFibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQWR2aXNvciUyMiU3RCwlMEElMjAlMjJvcHRpb25zU2hvd1VtbXlJbmZvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVVZEJTIwaSVDMyVBN2luJTIwaXB1JUMzJUE3bGFyJUM0JUIxbiVDNCVCMSUyMGclQzMlQjZzdGVyJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNHbU5hdGl2ZURvd25sb2FkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR2VsaSVDNSU5Rm1pJUM1JTlGJTIwaW5kaXJtZSUyMG1vZHUlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1Nob3dVbW15QnRuJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVW1teSUyMGQlQzMlQkMlQzQlOUZtZXNpbmklMjBnJUMzJUI2c3RlciUyMiU3RCwlMEElMjAlMjJvcHRpb25zQXZpYUJhckVuYWJsZWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJDaGVhcCUyMEZsaWdodHMlMjBBZHZpc29yJTIyJTdELCUwQSUwQSUyMCUyMm1lbnVEb3dubG9hZEZyb21DdXJyZW50UGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCdpJTIwa3VsbGFuYXJhayUyMGdlJUMzJUE3ZXJsaSUyMHNheWZhZGFuJTIwZG9zeWElMjBpbmRpcmluJTIyJTdELCUwQSUyMCUyMm1lbnVVcGRhdGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRvd25sb2FkJTIwZCVDMyVCQyVDNCU5Rm1lc2klMjBnJUMzJUI2ciVDMyVCQ25tJUMzJUJDeW9yc2ElMjB0JUM0JUIxa2xheSVDNCVCMW4lMjIlN0QsJTBBJTIwJTIybWVudURvd25sb2FkTVAzRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJHZSVDMyVBN2VybGklMjBzYXlmYWRhJTIwYnVsdW5hbiUyMHQlQzMlQkNtJTIwc2VzJTIwZG9zeWFsYXIlQzQlQjFuJUM0JUIxJTIwaW5kaXJpbiUyMiU3RCwlMEElMjAlMjJtZW51RG93bmxvYWRQbGF5bGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNlcyUyMGRvc3lhbGFyJUM0JUIxbmRhbiUyMG9sdSVDNSU5RmFuJTIwYmlyJTIwJUMzJUE3YWxtYSUyMGxpc3Rlc2klMjBvbHUlQzUlOUZ0dXJ1ciUyMHZlJTIwaW5kaXJpciUyMiU3RCwlMEElMjAlMjJtZW51RG93bmxvYWRQaG90b3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJHZSVDMyVBN2VybGklMjBzYXlmYWRhJTIwYnVsdW5hbiUyMHQlQzMlQkNtJTIwcmVzaW1sZXJpJTIwaW5kaXJpbiUyMiU3RCwlMEElMjAlMjJtZW51UmVwb3J0QnVnJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySGVyaGFuZ2klMjBiaXIlMjBzb3J1biUyMG9sbWFzJUM0JUIxJTIwZHVydW11bmRhJTIwYml6ZSUyMGJpbGRpcmluJTIyJTdELCUwQSUyMCUyMm1lbnVTaG93T3B0aW9ucyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRlc3Rla2xlbmVuJTIwa2F5bmFrbGFyJUM0JUIxJTIwdmUlMjBIZWxwZXIlMjBzZSVDMyVBN2VuZWtsZXJpbmklMjBBJUMzJTg3L0tBUEFUJTIyJTdELCUwQSUyMCUyMm1lbnVFbmFibGVFeHRlbnNpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlMjIlN0QsJTBBJTIwJTIybWVudU9wZW5Qb2xsJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTIyJTdELCUwQSUwQSUyMCUyMnF1YWxpdHklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJLYWxpdGUlMjIlN0QsJTBBJTIwJTIycXVhbGl0eU5vdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJIZXJoYW5naSUyMGJpciUyMHNlJUMzJUE3aWxlYmlsaXIlMjBrYWxpdGVuaW4lMjBvbG1hbWFzJUM0JUIxJTIwZHVydW11bmRhJTIwbWV2Y3V0JTIwb2xhbiUyMGVuJTIwaXlpJTIwdmlkZW8lMjBpbmRpcmlsZWNla3Rpci4lMjIlN0QsJTBBJTIwJTIyZmlsZWxpc3RUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJ1bHVuYW4lMjBkb3N5YWxhciVDNCVCMW4lQzQlQjElMjBsaXN0ZXNpJTIyJTdELCUwQSUyMCUyMmZpbGVsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInVCVDMyVCQ20lMjBkb3N5YWxhciVDNCVCMW4lQzQlQjElMjBpbmRpcm1layUyMGklQzMlQTdpbiUyMGJhJUM0JTlGbGFudCVDNCVCMSUyMGxpc3Rlc2luaSUyMGtvcHlhbGF5JUM0JUIxbiUyMHZlJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRG93bmxvYWRfbWFuYWdlcicsdGV4dDonaW5kaXJtZSUyMHklQzMlQjZuZXRpY2lzaW5lJyU3RCU3RCwnJTIweWFwJUM0JUIxJUM1JTlGdCVDNCVCMXIlQzQlQjFuLiUyMEt1cnVsdSUyMGJpciUyMGluZGlybWUlMjB5JUMzJUI2bmV0aWNpbml6JTIweW9rc2ElMjAnLCU3QmE6JTdCaHJlZjonaHR0cDovL3d3dy5mcmVlZG93bmxvYWRtYW5hZ2VyLm9yZy8nLHRleHQ6J0ZyZWUlMjBEb3dubG9hZCUyME1hbmFnZXInJTdEJTdELCclMjB5JUMzJUJDa2xlbWVuaXppJTIwdGF2c2l5ZSUyMGVkZXJpei4nJTVEJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0VGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlQzMlODdhbG1hJTIwTGlzdGVzaSUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdEluc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQXJ0JUM0JUIxayUyMGtheWRlZGlsZW4lMjAlQzMlQTdhbG1hJTIwbGlzdGVuaXppJTIweSVDMyVCQ3IlQzMlQkN0bWVrJTIwaSVDMyVBN2luJTIwbSVDMyVCQ3ppayUyMCVDMyVBN2FsYXIlQzQlQjFuJUM0JUIxemRhJTIwYSVDMyVBN2FiaWxpcnNpbml6LiUyMiU3RCwlMEElMEElMjAlMjJ1bW15U2ZUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhEJTIwdmV5YSUyME1QMyUyMiU3RCwlMEElMjAlMjJ1bW15TWVudUl0ZW0lMjI6JTIwJTdCJTIybWVzc2FnZSUyMiUyMDolMjAlMjIlNUInVW1teSUyMGlsZSUyMCcsJTdCc3BhbjolN0IlN0QlN0QlNUQlMjIlN0QsJTBBJTIwJTIydW1teU1lbnVJbmZvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJTdCcDolN0J0ZXh0OidVbW15JTIwVmlkZW8lMjAlQzQlQjBuZGlyaWNpJTVDJTVDJ3lpJTIweSVDMyVCQ2tsZXlpbiUyMHZlJTIwZW4lMjBzZXZkaSVDNCU5RmluaXolMjBIRCUyMHZpZGVvbGFyJUM0JUIxJTIweWElMjBkYSUyME1QMyU1QyU1QydsZXJpJTIwaGVtZW4lMjBpbmRpcmluLiclN0QlN0QsJTdCcDolN0JjbGFzczonY2VudGVyJyxhcHBlbmQ6JTVCJTdCYTolN0JjbGFzczonZ3JlZW4tYnRuLTIlMjBhcnJvdycsaHJlZjonJTdCdXJsJTdEJyx0YXJnZXQ6J19ibGFuaycsdGV4dDonJUM0JUIwbmRpciclN0QlN0QlNUQlN0QlN0QsJTdCcDolN0JhcHBlbmQ6JTVCJ0t1cnVsdW1kYW4lMjBzb25yYSUyMCcsJTdCaW1nOiU3QnNyYzonIyclN0QlN0QsJyUyMHNpbWdlc2luZSUyMHQlQzQlQjFrbGF5YXJhayUyMGRvc3lhJTIwaW5kaXJtZSUyMGklQzUlOUZsZW1pbmklMjBvdG9tYXRpayUyMG9sYXJhayUyMGJhJUM1JTlGbGF0YWJpbGlyc2luaXouJyU1RCU3RCU3RCU1RCUyMiU3RCwlMEElMjAlMjJ3YXJuaW5nUG9wdXBUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlRhcmF5JUM0JUIxYyVDNCVCMSUyMGF5YXJsYXIlQzQlQjFuJUM0JUIxJTIwa29udHJvbCUyMGVkaW4lMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwRGVzYyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QyUyMkRvc3lhbGFyJUM0JUIxbiUyMG5lcmV5ZSUyMGtheWRlZGlsZWNlJUM0JTlGaW5pJTIwaGVyJTIwc2VmZXJpbmRlJTIwc29yJTVDJTIyJTIwc2UlQzMlQTdlbmUlQzQlOUZpJTIwa2FwYWwlQzQlQjElMjBvbG1hbCVDNCVCMWQlQzQlQjFyLiUyMiU3RCwlMEElMjAlMjJyZWFkTW9yZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkRhaGElMjBmYXpsYSUyMiU3RCwlMEElMjAlMjJub1dhcm5pbmclMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCaWxkaXJtZSUyMiU3RCwlMEElMjAlMjJjYW5jZWwlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlQzQlQjBwdGFsJTIyJTdELCUwQSUyMCUyMmNvbnRpbnVlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGV2YW0lMjIlN0QsJTBBJTIwJTIyYmVmb3JlRG93bmxvYWRQb3B1cFdhcm4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJVeWFyJUM0JUIxISUyMCVDNCVCMG5kaXJtZSUyMGklQzUlOUZsZW1pJTIwaXB0YWwlMjBlZGlsZW1leiUyMHlhJTIwZGElMjBlcnRlbGVuZW1lei4lMjIlN0QsJTBBJTBBJTIwJTIydmtJbmZvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQmlsZ2klMjIlN0QsJTBBJTIwJTIydmtJbmZvVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJEb3N5YSUyMGJveXV0dSUyMHZlJTIwYml0JTIwaCVDNCVCMXolQzQlQjElMjIlN0QsJTBBJTIwJTIydmtNcDNMaW5rc05vdEZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTVAzJTIwZG9zeWFsYXIlQzQlQjElMjBpJUMzJUE3aW4lMjBiYSVDNCU5RmxhbnQlQzQlQjFsYXIlMjBidWx1bmFtJUM0JUIxeW9yJTIyJTdELCUwQSUyMCUyMnZrUGhvdG9MaW5rc05vdEZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRm90byVDNCU5RnJhZmxhciUyMGJ1bHVuYW1hZCVDNCVCMSUyMiU3RCwlMEElMjAlMjJ2a0Rvd25sb2FkUGhvdG9BbGJ1bSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkFsYiVDMyVCQ20lQzMlQkMlMjBpbmRpciUyMiU3RCwlMEElMjAlMjJ2a0Rvd25sb2FkQWxsUGhvdG9BbGJ1bXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJUJUMzJUJDbSUyMGFsYiVDMyVCQ21sZXJpJTIwaW5kaXIlMjIlN0QsJTBBJTIwJTIydmtGb3VuZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkJ1bHVuYW4lMjBmb3RvJUM0JTlGcmFmbGFyJTIyJTdELCUwQSUyMCUyMnZrTm90QXZhaWxhYmxlUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTI1ZCUyMHJlc2ltJTIwZ2UlQzMlQTdpY2klMjBvbGFyYWslMjBrdWxsYW4lQzQlQjFsYW0lQzQlQjF5b3IlMjIlN0QsJTBBJTIwJTIydmtGb3VuZExpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQnVsdW5hbiUyMGJhJUM0JTlGbGFudCVDNCVCMWxhciUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kT2YlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJkZW4lMjIlN0QsJTBBJTIwJTIydmtTaG93QXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJPbGFyYWslMjBnJUMzJUI2c3RlciUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZkxpbmtzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyQmElQzQlOUZsYW50JUM0JUIxJTIwbGlzdGVzaSUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZkxpbmtzSW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInVCVDMyVCQ20lMjBmb3RvJUM0JTlGcmFmbGFyJUM0JUIxJTIwaW5kaXJtZWslMjBpJUMzJUE3aW4lMjBiYSVDNCU5RmxhbnQlQzQlQjElMjBsaXN0ZXNpbmklMjBrb3B5YWxheSVDNCVCMW4lMjB2ZSUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Rvd25sb2FkX21hbmFnZXInLHRleHQ6J2luZGlybWUlMjB5JUMzJUI2bmV0aWNpc2luZSclN0QlN0QsJyUyMHlhcCVDNCVCMSVDNSU5RnQlQzQlQjFyJUM0JUIxbi4lMjBLdXJ1bHUlMjBiaXIlMjBpbmRpcm1lJTIweSVDMyVCNm5ldGljaW5peiUyMHlva3NhJTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly93d3cuZnJlZWRvd25sb2FkbWFuYWdlci5vcmcvJyx0ZXh0OidGcmVlJTIwRG93bmxvYWQlMjBNYW5hZ2VyJyU3RCU3RCwnJTIweSVDMyVCQ2tsZW1lbml6aSUyMHRhdnNpeWUlMjBlZGVyaXouJyU1RCUyMiU3RCwlMEElMjAlMjJ2a1RhYmxlT2ZUaHVtYm5haWxzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySyVDMyVCQyVDMyVBNyVDMyVCQ2trJTIwcmVzaW1sZXIlMjB0YWJsb3N1JTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRm90byVDNCU5RnJhZiUyMGxpc3Rlc2klMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZQaG90b3NJbnN0cnVjdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVDNCVCMG5kaXJtZWslMjBpJUMzJUE3aW4lMjBmb3RvJUM0JTlGcmFmJUM0JUIxbiUyMCVDMyVCQ3plcmluZSUyMHQlQzQlQjFrbGF5JUM0JUIxbi4lMjIlN0QsJTBBJTIwJTIydmtLYnBzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIya2JwcyUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkIlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZUtCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIya0IlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZU1CeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyTUIlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZUdCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyR0IlMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZVRCeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVEIlMjIlN0QsJTBBJTIwJTIydmtEb3dubG9hZEZyb21Zb3V0dWJlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJyVDNCVCMG5kaXJtZTolMjAnLCU3QmE6JTdCaHJlZjonJTdCdXJsJTdEJyx0ZXh0Oid2aWRlbyUyMHNheWZhcyVDNCVCMW4lQzQlQjEnJTdEJTdELCclMjBhJUMzJUE3JUM0JUIxbiUyMHZlJTIwb3luYXQlQzQlQjFjJUM0JUIxJTIwJUMzJUJDemVyaW5kZWtpJTIwJTVDJTIyJUM0JUIwbmRpciU1QyUyMiUyMGQlQzMlQkNtZXNpbmUlMjBiYXMlQzQlQjFuJyU1RCUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCdWx1bmFuJTIwZG9zeWFsYXI6JTIwJTI1ZCUyMiU3RCwlMEElMEElMjAlMjJzaGFyZUluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTI1dyUyMCVDMyVCQ3plcmluZGVuJTIwcGF5bGElQzUlOUYlMjIlN0QsJTBBJTIwJTIyc29jaWFsRGVzYyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMEhlbHBlciwlMjBzYWRlY2UlMjBiaXIlMjB0JUM0JUIxa2xhbWElMjBpbGUlMjBZb3VUdWJlLmNvbSwlMjBGYWNlYm9vay5jb20sJTIwVksuY29tJTIwdmUlMjA0MCdkYW4lMjBmYXpsYSUyMHNpdGVkZW4lMjAlQzMlQkNjcmV0c2l6JTIwb2xhcmFrJTIwZG9zeWElMjBpbmRpcm1lbml6aSUyMHNhJUM0JTlGbGFyLiUyMiU3RCwlMEElMEElMjAlMjJ0dXRvcmlhbFMxVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTaXplJTIwaGFyaWthJTIwYmlyJTIwaGFiZXJpbWl6JTIwdmFyISUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMxTWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidTYXZlRnJvbS5uZXQlMjBIZWxwZXIlMjAnLCU3QmltZzolMjAlN0JzcmM6JTIwJyNsb2dvJyU3RCU3RCwlMjAnJTIwYmElQzUlOUZhciVDNCVCMXlsYSUyMGt1cnVsZHUuJTIwQXJ0JUM0JUIxayUyMHRlayUyMGJpciUyMHQlQzQlQjFrbGFtYSUyMGlsZSUyMFlvdVR1YmUlNUMlNUMnZGFuJTIwaXN0ZWRpJUM0JTlGaW5peiUyMHZpZGVveXUlMjBpbmRpcmViaWxpcnNpbml6JyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMxQXJyb3clMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInTmFzJUM0JUIxbCUyMG9sZHUlQzQlOUZ1bnUlMjAlQzMlQjYlQzQlOUZyZW5tZWslMjBpc3RlciUyMG1pc2luaXo/JTIwQnVyYXlhJTIwdCVDNCVCMWtsYXklQzQlQjFuJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMyTWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhZGVjZSUyMGluZGlybWVrJTIwaXN0ZWRpJUM0JTlGaW5peiUyMHZpZGVvbnVuJTIwZm9ybWF0JUM0JUIxbiVDNCVCMSUyMHNlJUMzJUE3aW4lMjB2ZSUyMCU1QyUyMiVDNCVCMG5kaXIlNUMlMjIlMjBidXRvbnVuYSUyMHQlQzQlQjFrbGF5JUM0JUIxbiUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMzSGlzdG9yeSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkdlJUMzJUE3bWklQzUlOUYlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTM01haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInV2ViJTIwZ2UlQzMlQTdtaSVDNSU5RmluaXpkZWtpJTIwdmlkZW9sYXIlQzQlQjElMjBpbmRpcm1layUyMGlzdGVyJTIwbWlzaW5pej8nLCUyMCU3QmJyOiU3QiU3RCU3RCwlMjAnJTIwU2FkZWNlJTIwZGFoYSUyMCVDMyVCNm5jZSUyMGl6bGVkaSVDNCU5RmluaXolMjBiaXIlMjB2aWRlb251biUyMCVDMyVCNm5pemxlbWVzaSUyMCVDMyVCQ3plcmluZGVraSUyMCcsJTIwJTdCaW1nOiUyMCU3QnNyYzolMjAnI2Fycm93JyU3RCU3RCwlMjAnJTIwc2ltZ2VzaW5lJTIwdCVDNCVCMWtsYXklQzQlQjFuJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFM0TWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QidWaWRlb2xhciVDNCVCMSUyMGl6bGVtZW5pemUlMjBnZXJlayUyMHlvayUyMCVFMiU4MCU5NCUyMHNhZGVjZSUyMCcsJTIwJTdCaW1nOiUyMCU3QnNyYzolMjAnI2Fycm93JyU3RCU3RCwlMjAnJTIwc2ltZ2VzaW5lJTIwdCVDNCVCMWtsYXklQzQlQjFuLCUyMGthbGl0ZSUyMGRlJUM0JTlGZXJpbmklMjBzZSVDMyVBN2luJTIwdmUlMjBhbiVDNCVCMW5kYSUyMGluZGlyaW4uJTIwT2xkdWslQzMlQTdhJTIwa29sYXksJTIwZGUlQzQlOUZpbCUyMG1pPyclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySGVtZW4lMjBTYXZlRnJvbS5uZXQlMjBIZWxwZXInaW4lMjBrZXlmaW5pJTIwJUMzJUE3JUM0JUIxa2FybWF5YSUyMGJhJUM1JTlGbGF5JUM0JUIxbiElMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNU1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInSGFsYSUyMGthZmFuJUM0JUIxemElMjB0YWslQzQlQjFsYW4lMjBzb3J1bGFyJTIwbSVDNCVCMSUyMHZhcj8lMjBEJUMzJUJDJUM1JTlGJUMzJUJDbmNlbGVyaW5pemklMjBwYXlsYSVDNSU5Rm1hayUyMG0lQzQlQjElMjBpc3RpeW9yc3VudXo/JTIwJywlN0JhOiUyMCU3QnRleHQ6JTIwJ0Rlc3RlayUyMHNheWZhbSVDNCVCMXolQzQlQjEnLCUyMGhyZWY6JTIwJyNzdXBwb3J0JyU3RCU3RCwnJTIweml5YXJldCUyMGVkaW4lMjB2ZXlhJTIwJywlN0JhOiUyMCU3QnRleHQ6JTIwJ0ZhY2Vib29rJywlMjBocmVmOiUyMCcjZmInJTdEJTdELCclMjB0b3BsdWx1JUM0JTlGdW11emElMjBrYXQlQzQlQjFsJUM0JUIxbiclNUQlMjIlN0QsJTBBJTBBJTIwJTIydHV0b3JpYWxUb29sdGlwVGV4dCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiU3QmI6JTIwJTdCdGV4dDolMjAnJUM0JUIwbmRpcm1layclN0QlN0QsJTIwJyUyMGklQzMlQTdpbiUyMHNhZGVjZSUyMGJ1dG9uYSUyMHQlQzQlQjFrbGF5JUM0JUIxbiclNUQlMjIlN0QsJTBBJTBBJTIwJTIydW1teVRvb2x0aXBDb25maXJtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJTdCaW1nOiU3QiU3RCU3RCwnJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMHByb2dyYW0lQzQlQjFuJUM0JUIxJTIwZGFoYSUyMCVDMyVCNm5jZSUyMHklQzMlQkNrbGVkaW5peiUyMG1pPyclNUQlMjIlN0QsJTBBJTIwJTIyeWVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRXZldCUyMiU3RCwlMEElMjAlMjJubyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkhheSVDNCVCMXIlMjIlN0QsJTBBJTIwJTIydG9vbHRpcEhpZGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJCdSUyMG1lc2FqJUM0JUIxJTIwdGVrcmFyJTIwZyVDMyVCNnN0ZXJtZSUyMiU3RCUwQSU3RCI7CiAgX2xhbmd1YWdlTGlzdC51ayA9ICIlN0IlMEElMjAlMjJleHROYW1lJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQxJTk2JUQxJTg3JUQwJUJEJUQwJUI4JUQwJUJBJTIyJTdELCUwQSUyMCUyMmV4dERlc2NyaXB0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQxJTgzJUQwJUI5JUQxJTgyJUQwJUI1JTIwJUQwJUI3JTIwJUMyJUFCJUQwJTkyJUQwJTlBJUQwJUJFJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUJBJUQxJTgyJUQwJUI1JUMyJUJCLCUyMFlvdVR1YmUsJTIwRmFjZWJvb2slMjAlRDElOTYlMjAlRDElODklRDAlQjUlMjA0MCUyMCVEMSU4MSVEMCVCMCVEMCVCOSVEMSU4MiVEMSU5NiVEMCVCMiUyMCVEMCVCNyVEMCVCMCUyMDElMjAlRDAlQkElRDAlQkIlRDElOTYlRDAlQkEuJTIyJTdELCUwQSUwQSUyMCUyMmV4dE5hbWVMaXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQxJTk2JUQxJTg3JUQwJUJEJUQwJUI4JUQwJUJBJTIwbGl0ZSUyMiU3RCwlMEElMjAlMjJleHREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTclRDAlQjAlRDAlQjIlRDAlQjAlRDAlQkQlRDElODIlRDAlQjAlRDAlQjYlRDElODMlRDAlQjklRDElODIlRDAlQjUlMjAlRDAlQjclMjAlQzIlQUIlRDAlOTIlRDAlOUElRDAlQkUlRDAlQkQlRDElODIlRDAlQjAlRDAlQkElRDElODIlRDAlQjUlQzIlQkIsJTIwWW91VHViZSwlMjBGYWNlYm9vayUyMCVEMSU5NiUyMCVEMSU4OSVEMCVCNSUyMDQwJTIwJUQxJTgxJUQwJUIwJUQwJUI5JUQxJTgyJUQxJTk2JUQwJUIyJTIwJUQwJUI3JUQwJUIwJTIwMSUyMCVEMCVCQSVEMCVCQiVEMSU5NiVEMCVCQS4lMjIlN0QsJTBBJTBBJTIwJTIybGFuZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMnVrJTIyJTdELCUwQSUwQSUyMCUyMnRpdGxlRGVmYXVsdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMSU5NiVEMSU4NyVEMCVCRCVEMCVCOCVEMCVCQSUyMiU3RCwlMEElMjAlMjJ0aXRsZURlc2FibGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQxJTk2JUQxJTg3JUQwJUJEJUQwJUI4JUQwJUJBJTIwJUQwJUIyJUQwJUI4JUQwJUJDJUQwJUJBJUQwJUJEJUQwJUI1JUQwJUJEJUQwJUI4JUQwJUI5JTIyJTdELCUwQSUwQSUyMCUyMm1lbnVFbmFibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTMlRDAlQjIlRDElOTYlRDAlQkMlRDAlQkElRDAlQkQlRDElODMlRDElODIlRDAlQjglMjIlN0QsJTBBJTIwJTIybWVudURpc2FibGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDAlQjglRDAlQkMlRDAlQkElRDAlQkQlRDElODMlRDElODIlRDAlQjglMjIlN0QsJTBBJTBBJTIwJTIyc2hvd0J1dHRvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCRSVEMCVCQSVEMCVCMCVEMCVCNyVEMSU4MyVEMCVCMiVEMCVCMCVEMSU4MiVEMCVCOCUyMCVEMCVCQSVEMCVCRCVEMCVCRSVEMCVCRiVEMCVCQSVEMSU4MyUyMCVEMSU4MCVEMCVCRSVEMCVCNyVEMSU4OCVEMCVCOCVEMSU4MCVEMCVCNSVEMCVCRCVEMCVCRCVEMSU4RiUyMiU3RCwlMEElMEElMjAlMjJjb3B5JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlBJUQwJUJFJUQwJUJGJUQxJTk2JUQxJThFJUQwJUIyJUQwJUIwJUQxJTgyJUQwJUI4JTIyJTdELCUwQSUyMCUyMmRvd25sb2FkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQwJUI4JUQxJTgyJUQwJUI4JTIyJTdELCUwQSUyMCUyMmRvd25sb2FkVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjAlRDElODIlRDAlQjglRDElODElRDAlQkQlRDElOTYlRDElODIlRDElOEMlMjAlRDAlQkQlRDAlQjAlMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYsJTIwJUQxJTgzJUQxJTgyJUQxJTgwJUQwJUI4JUQwJUJDJUQxJTgzJUQxJThFJUQxJTg3JUQwJUI4JTIwJUQwJUJBJUQwJUJCJUQwJUIwJUQwJUIyJUQxJTk2JUQxJTg4JUQxJTgzJTIwQWx0JTIwJUQxJTg3JUQwJUI4JTIwQ3RybCwlMjAlRDElODklRDAlQkUlRDAlQjElMjAlRDAlQjclRDAlQjElRDAlQjUlRDElODAlRDAlQjUlRDAlQjMlRDElODIlRDAlQjglMjAlRDElODQlRDAlQjAlRDAlQjklRDAlQkIuJTIyJTdELCUwQSUyMCUyMm5vTGlua3NGb3VuZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RCVEMCVCNSUyMCVEMCVCMiVEMCVCNCVEMCVCMCVEMCVCQiVEMCVCRSVEMSU4MSVEMSU4RiUyMCVEMCVCNyVEMCVCRCVEMCVCMCVEMCVCOSVEMSU4MiVEMCVCOCUyMCVEMCVCRiVEMCVCRSVEMSU4MSVEMCVCOCVEMCVCQiVEMCVCMCVEMCVCRCVEMCVCRCVEMSU4RiUyMiU3RCwlMEElMjAlMjJtb3JlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUE5JUQwJUI1JTIyJTdELCUwQSUyMCUyMmNsb3NlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk3JUQwJUIwJUQwJUJBJUQxJTgwJUQwJUI4JUQxJTgyJUQwJUI4JTIyJTdELCUwQSUyMCUyMmticHMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQkElRDAlQjEvJUQxJTgxJTIyJTdELCUwQSUyMCUyMndpdGhvdXRBdWRpbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVCMSVEMCVCNSVEMCVCNyUyMCVEMCVCMCVEMSU4MyVEMCVCNCVEMSU5NiVEMCVCRSUyMiU3RCwlMEElMjAlMjJzaXplJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQxJTgwJUQwJUJFJUQwJUI3JUQwJUJDJUQxJTk2JUQxJTgwJTIyJTdELCUwQSUwQSUyMCUyMnN1YnRpdGxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMSU4MyVEMCVCMSVEMSU4MiVEMCVCOCVEMSU4MiVEMSU4MCVEMCVCOCUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCQiVEMCVCNSVEMCVCOSVEMCVCQiVEMSU5NiVEMSU4MSVEMSU4MiUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCRiVEMCVCOCVEMSU4MSVEMCVCRSVEMCVCQSUyMCVEMSU4NCVEMCVCMCVEMCVCOSVEMCVCQiVEMSU5NiVEMCVCMiUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFdob2xlUGxheWxpc3QlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTclRDAlQjAlRDAlQjIlRDAlQjAlRDAlQkQlRDElODIlRDAlQjAlRDAlQjYlRDAlQjglRDElODIlRDAlQjglMjAlRDAlQjIlRDAlQjUlRDElODElRDElOEMlMjAlRDAlQkYlRDAlQkIlRDAlQjUlRDAlQjklRDAlQkIlRDElOTYlRDElODElRDElODIlMjIlN0QsJTBBJTBBJTIwJTIyZ2V0RmlsZVNpemVUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MiVEMCVCOCVEMCVCNyVEMCVCRCVEMCVCMCVEMSU4NyVEMCVCOCVEMSU4MiVEMCVCOCUyMCVEMSU4MCVEMCVCRSVEMCVCNyVEMCVCQyVEMSU5NiVEMSU4MCUyMCVEMSU4NCVEMCVCMCVEMCVCOSVEMCVCQiVEMSU4MyUyMiUyMCU3RCwlMEElMjAlMjJnZXRGaWxlU2l6ZUZhaWxUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RCVEMCVCNSUyMCVEMCVCMiVEMCVCNCVEMCVCMCVEMCVCQiVEMCVCRSVEMSU4MSVEMSU4RiUyMCVEMCVCMiVEMCVCOCVEMCVCNyVEMCVCRCVEMCVCMCVEMSU4NyVEMCVCOCVEMSU4MiVEMCVCOCUyMCVEMSU4MCVEMCVCRSVEMCVCNyVEMCVCQyVEMSU5NiVEMSU4MCUyMCVEMSU4NCVEMCVCMCVEMCVCOSVEMCVCQiVEMSU4My4lMjAlRDAlQTElRDAlQkYlRDElODAlRDAlQkUlRDAlQjElRDElODMlRDAlQjklRDElODIlRDAlQjUlMjAlRDElODklRDAlQjUlMjAlRDElODAlRDAlQjAlRDAlQjcuJTIyJTdELCUwQSUwQSUyMCUyMmxtQnV0dG9uVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUUlRDElODIlRDElODAlRDAlQjglRDAlQkMlRDAlQjAlRDAlQjklMjAlRDAlQkYlRDElODAlRDElOEYlRDAlQkMlRDAlQjUlMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYlMjIlN0QsJTBBJTBBJTIwJTIyZG93bmxvYWRGcm9tQ3VycmVudFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQjUlRDElODAlRDAlQjUlRDAlQjklRDElODIlRDAlQjglMjAlRDAlQkQlRDAlQjAlMjBTYXZlRnJvbS5uZXQlMjIlN0QsJTBBJTIwJTIydXBkYXRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDElOTYlRDAlQjQlRDAlQkQlRDAlQkUlRDAlQjIlRDAlQjglRDElODIlRDAlQjglMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYlMjIlN0QsJTBBJTIwJTIydXBkYXRlTGlua3NOb3RpZmljYXRpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYlMjAlRDAlQkUlRDAlQkQlRDAlQkUlRDAlQjIlRDAlQkIlRDAlQjUlRDAlQkQlRDElOTYlMjIlN0QsJTBBJTIwJTIyZG93bmxvYWRNUDNGaWxlcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCQSVEMCVCMCVEMSU4NyVEMCVCMCVEMSU4MiVEMCVCOCUyMCVEMCVCMCVEMSU4MyVEMCVCNCVEMSU5NiVEMCVCRSUyMCVEMSU4NCVEMCVCMCVEMCVCOSVEMCVCQiVEMCVCOCUyMiU3RCwlMEElMjAlMjJkb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQwJUI4JTIwJUQwJUJGJUQwJUJCJUQwJUI1JUQwJUI5JUQwJUJCJUQwJUI4JUQxJTgxJUQxJTgyJTIyJTdELCUwQSUyMCUyMmRvd25sb2FkUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQwJUI4JTIwJUQxJTg0JUQwJUJFJUQxJTgyJUQwJUJFJUQwJUIzJUQxJTgwJUQwJUIwJUQxJTg0JUQxJTk2JUQxJTk3JTIyJTdELCUwQSUyMCUyMmluc3RhbGxGdWxsVmVyc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MiVEMSU4MSVEMSU4MiVEMCVCMCVEMCVCRCVEMCVCRSVEMCVCMiVEMCVCOCVEMSU4MiVEMCVCOCUyMCVEMCVCRiVEMCVCRSVEMCVCMiVEMCVCRCVEMSU4MyUyMCVEMCVCMiVEMCVCNSVEMSU4MCVEMSU4MSVEMSU5NiVEMSU4RSUyMiU3RCwlMEElMjAlMjJkaXNhYmxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTkyJUQwJUI4JUQwJUJDJUQwJUJBJUQwJUJEJUQxJTgzJUQxJTgyJUQwJUI4JTIyJTdELCUwQSUyMCUyMnNob3dPcHRpb25zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUIwJUQwJUJCJUQwJUIwJUQxJTg4JUQxJTgyJUQxJTgzJUQwJUIyJUQwJUIwJUQwJUJEJUQwJUJEJUQxJThGJTIyJTdELCUwQSUyMCUyMnJlcG9ydEJ1ZyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCRSVEMCVCMiVEMSU5NiVEMCVCNCVEMCVCRSVEMCVCQyVEMCVCOCVEMSU4MiVEMCVCOCUyMCVEMCVCRiVEMSU4MCVEMCVCRSUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMCVCOCVEMCVCQiVEMCVCQSVEMSU4MyUyMiU3RCwlMEElMjAlMjJvcGVuUG9sbCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMSU4MiVEMCVCMCVEMSU4MiVEMCVCOCUyMCVEMCVCQSVEMSU4MCVEMCVCMCVEMSU4OSVEMCVCNSUyMiU3RCwlMEElMjAlMjJkaXNhYmxlTW9kdWxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTkyJUQwJUI4JUQwJUJDJUQwJUJBJUQwJUJEJUQxJTgzJUQxJTgyJUQwJUI4JTIwJUQwJUJEJUQwJUIwJTIwJUQxJTg2JUQxJThDJUQwJUJFJUQwJUJDJUQxJTgzJTIwJUQxJTgxJUQwJUIwJUQwJUI5JUQxJTgyJUQxJTk2JTIyJTdELCUwQSUyMCUyMmVuYWJsZU1vZHVsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMyVEMCVCMiVEMSU5NiVEMCVCQyVEMCVCQSVEMCVCRCVEMSU4MyVEMSU4MiVEMCVCOCUyMCVEMCVCRCVEMCVCMCUyMCVEMSU4NiVEMSU4QyVEMCVCRSVEMCVCQyVEMSU4MyUyMCVEMSU4MSVEMCVCMCVEMCVCOSVEMSU4MiVEMSU5NiUyMiU3RCwlMEElMjAlMjJlbmFibGVEaXNhYmxlTW9kdWxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTkyJUQwJUJBJUQwJUJCLi8lRDAlQjIlRDAlQjglRDAlQkMlRDAlQkEuJTIwJUQwJUJEJUQwJUIwJTIwJUQxJTg2JUQxJThDJUQwJUJFJUQwJUJDJUQxJTgzJTIwJUQxJTgxJUQwJUIwJUQwJUI5JUQxJTgyJUQxJTk2JTIyJTdELCUwQSUyMCUyMnNob3dIaWRlQnV0dG9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJFJUQwJUJBJUQwJUIwJUQwJUI3Li8lRDElODElRDAlQkElRDElODAuJTIwJUQwJUJBJUQwJUJEJUQwJUJFJUQwJUJGJUQwJUJBJUQxJTgzJTIwJUQxJTgwJUQwJUJFJUQwJUI3JUQxJTg4JUQwJUI4JUQxJTgwJUQwJUI1JUQwJUJEJUQwJUJEJUQxJThGJTIyJTdELCUwQSUyMCUyMnVwZGF0ZVRvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlFJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUI4JUQxJTgyJUQwJUI4JTIwJUQwJUI0JUQwJUJFJTIwJTI1ZCUyMiU3RCwlMEElMEElMjAlMjJhYm91dFBhZ2UlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDElODAlRDAlQkUlMjAlRDElODAlRDAlQkUlRDAlQjclRDElODglRDAlQjglRDElODAlRDAlQjUlRDAlQkQlRDAlQkQlRDElOEYlMjIlN0QsJTBBJTIwJTIyYWJvdXRUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMlNhdmVGcm9tLm5ldCUyMCVEMCVCRiVEMCVCRSVEMCVCQyVEMSU5NiVEMSU4NyVEMCVCRCVEMCVCOCVEMCVCQSUyMiU3RCwlMEElMjAlMjJhYm91dFZlcnNpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDAlQjUlRDElODAlRDElODElRDElOTYlRDElOEYlMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5NCVEMCVCRSVEMCVCNyVEMCVCMiVEMCVCRSVEMCVCQiVEMSU4RiVEMSU5NCUyMCVEMCVCRSVEMSU4MiVEMSU4MCVEMCVCOCVEMCVCQyVEMSU4MyVEMCVCMiVEMCVCMCVEMSU4MiVEMCVCOCUyMCVEMCVCRiVEMSU4MCVEMSU4RiVEMCVCQyVEMSU5NiUyMCVEMCVCRiVEMCVCRSVEMSU4MSVEMCVCOCVEMCVCQiVEMCVCMCVEMCVCRCVEMCVCRCVEMSU4RiUyMCVEMCVCNCVEMCVCQiVEMSU4RiUyMCVEMCVCNyVEMCVCMCVEMCVCMiVEMCVCMCVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCNiVEMCVCNSVEMCVCRCVEMCVCRCVEMSU4RiUyMCVEMCVCNyUyMCVEMCVCRiVEMCVCRSVEMCVCRCVEMCVCMCVEMCVCNCUyMDQwJTIwJUQxJTgxJUQwJUIwJUQwJUI5JUQxJTgyJUQxJTk2JUQwJUIyLCUyMCVEMSU4MSVEMCVCNSVEMSU4MCVEMCVCNSVEMCVCNCUyMCVEMSU4RiVEMCVCQSVEMCVCOCVEMSU4NSUyMFZLLmNvbSwlMjBZb3VUdWJlLmNvbSUyMCVEMSU4MiVEMCVCMCUyMCVEMSU5NiVEMCVCRCVEMSU4OCVEMSU5Ni4lMjIlN0QsJTBBJTIwJTIyYWJvdXREZXNjcmlwdGlvbkxpdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTQlRDAlQkUlRDAlQjclRDAlQjIlRDAlQkUlRDAlQkIlRDElOEYlRDElOTQlMjAlRDAlQkUlRDElODIlRDElODAlRDAlQjglRDAlQkMlRDElODMlRDAlQjIlRDAlQjAlRDElODIlRDAlQjglMjAlRDAlQkYlRDElODAlRDElOEYlRDAlQkMlRDElOTYlMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYlMjAlRDAlQjQlRDAlQkIlRDElOEYlMjAlRDAlQjclRDAlQjAlRDAlQjIlRDAlQjAlRDAlQkQlRDElODIlRDAlQjAlRDAlQjYlRDAlQjUlRDAlQkQlRDAlQkQlRDElOEYlMjAlRDAlQjclMjAlRDAlQkYlRDAlQkUlRDAlQkQlRDAlQjAlRDAlQjQlMjA0MCUyMCVEMSU4MSVEMCVCMCVEMCVCOSVEMSU4MiVEMSU5NiVEMCVCMiwlMjAlRDElODElRDAlQjUlRDElODAlRDAlQjUlRDAlQjQlMjAlRDElOEYlRDAlQkElRDAlQjglRDElODUlMjBWSy5jb20lMjAlRDElODIlRDAlQjAlMjAlRDElOTYlRDAlQkQlRDElODglRDElOTYuJTIyJTdELCUwQSUyMCUyMmFib3V0U3VwcG9ydGVkJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUEwJUQwJUI1JUQxJTgxJUQxJTgzJUQxJTgwJUQxJTgxJUQwJUI4LCUyMCVEMSU4RiVEMCVCQSVEMSU5NiUyMCVEMCVCRiVEMSU5NiVEMCVCNCVEMSU4MiVEMSU4MCVEMCVCOCVEMCVCQyVEMSU4MyVEMSU4RSVEMSU4MiVEMSU4QyVEMSU4MSVEMSU4RiUyMiU3RCwlMEElMjAlMjJob21lUGFnZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5NCVEMCVCRSVEMCVCQyVEMCVCMCVEMSU4OCVEMCVCRCVEMSU4RiUyMCVEMSU4MSVEMSU4MiVEMCVCRSVEMSU4MCVEMSU5NiVEMCVCRCVEMCVCQSVEMCVCMCUyMiU3RCwlMEElMEElMjAlMjJvcHRpb25zVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTYXZlRnJvbS5uZXQlMjAlRDAlQkYlRDAlQkUlRDAlQkMlRDElOTYlRDElODclRDAlQkQlRDAlQjglRDAlQkElMjAtJTIwJUQwJTlEJUQwJUIwJUQwJUJCJUQwJUIwJUQxJTg4JUQxJTgyJUQxJTgzJUQwJUIyJUQwJUIwJUQwJUJEJUQwJUJEJUQxJThGJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNIYW5kbGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RSVEMCVCMSVEMSU4MCVEMCVCRSVEMCVCMSVEMCVCQiVEMSU4RiVEMSU4MiVEMCVCOCUyMCVEMCVCRiVEMCVCRSVEMSU4MSVEMCVCOCVEMCVCQiVEMCVCMCVEMCVCRCVEMCVCRCVEMSU4RiUyMiU3RCwlMEElMjAlMjJvcHRpb25zRmlsZUhvc3RpbmdzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUIwJTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUJFJUQwJUJFJUQwJUIxJUQwJUJDJUQxJTk2JUQwJUJEJUQwJUJEJUQwJUI4JUQwJUJBJUQwJUI4JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNNZWRpYUhvc3RpbmdzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUIwJTIwJUQwJUJDJUQwJUI1JUQwJUI0JUQxJTk2JUQwJUIwJUQxJTg1JUQwJUJFJUQxJTgxJUQxJTgyJUQwJUI4JUQwJUJEJUQwJUIzJUQwJUI4JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNNb2R1bGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlDJUQwJUJFJUQwJUI0JUQxJTgzJUQwJUJCJUQxJTk2JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNZb3V0dWJlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyWW91VHViZSUyMiU3RCwlMEElMjAlMjJvcHRpb25zWVRIaWRlTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDElODUlRDAlQkUlRDAlQjIlRDAlQjAlRDElODIlRDAlQjglMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0RhaWx5bW90aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRGFpbHltb3Rpb24lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1ZpbWVvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyVmltZW8lMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0ZhY2Vib29rJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyRmFjZWJvb2slMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1NvdW5kY2xvdWQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJTb3VuZENsb3VkJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNWa29udGFrdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDAlOUElRDAlQkUlRDAlQkQlRDElODIlRDAlQjAlRDAlQkElRDElODIlRDAlQjUlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc09kbm9rbGFzc25pa2klMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUUlRDAlQjQlRDAlQkQlRDAlQkUlRDAlQkElRDAlQkIlRDAlQjAlRDElODElRDElODElRDAlQkQlRDAlQjglRDAlQkElRDAlQjglMjIlN0QsJTBBJTIwJTIyb3B0aW9uc01haWxydSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5QyVEMCVCRSVEMCVCOSUyMCVEMCVCQyVEMCVCOCVEMSU4MCUyMiU3RCwlMEElMjAlMjJvcHRpb25zSW5zdGFncmFtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySW5zdGFncmFtJTIyJTdELCUwQSUyMCUyMm9wdGlvbnNSdXR1YmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjJSdXR1YmUlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc0JpdHJhdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQkUlRDAlQkElRDAlQjAlRDAlQjclRDElODMlRDAlQjIlRDAlQjAlRDElODIlRDAlQjglMjAlRDAlQjElRDElOTYlRDElODIlRDElODAlRDAlQjUlRDAlQjklRDElODIlMjAlRDAlQkUlRDAlQjQlRDElODAlRDAlQjAlRDAlQjclRDElODMlMjIlN0QsJTBBJTIwJTIyb3B0aW9uc1NvdmV0bmlrRW5hYmxlZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCRSVEMSU4MCVEMCVCMCVEMCVCNCVEMCVCRCVEMCVCOCVEMCVCQSUyMiU3RCwlMEElMjAlMjJvcHRpb25zU2hvd1VtbXlJbmZvJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJFJUQwJUJBJUQwJUIwJUQwJUI3JUQxJTgzJUQwJUIyJUQwJUIwJUQxJTgyJUQwJUI4JTIwJUQwJUJGJUQxJTk2JUQwJUI0JUQwJUJBJUQwJUIwJUQwJUI3JUQwJUJBJUQwJUI4JTIwJUQwJUI0JUQwJUJCJUQxJThGJTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMiU3RCwlMEElMjAlMjJvcHRpb25zR21OYXRpdmVEb3dubG9hZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMCVEMCVCRSVEMCVCNyVEMSU4OCVEMCVCOCVEMSU4MCVEMCVCNSVEMCVCRCVEMCVCOCVEMCVCOSUyMCVEMSU4MCVEMCVCNSVEMCVCNiVEMCVCOCVEMCVCQyUyMCVEMCVCNyVEMCVCMCVEMCVCQSVEMCVCMCVEMSU4NyVEMSU4MyVEMCVCMiVEMCVCMCVEMCVCRCVEMCVCRCVEMSU4RiUyMiU3RCwlMEElMjAlMjJvcHRpb25zU2hvd1VtbXlCdG4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDElOTYlRDAlQjQlRDAlQkUlRDAlQjElRDElODAlRDAlQjAlRDAlQjYlRDAlQjAlRDElODIlRDAlQjglMjAlRDAlQkElRDAlQkQlRDAlQkUlRDAlQkYlRDAlQkElRDElODMlMjBVbW15JTIyJTdELCUwQSUyMCUyMm9wdGlvbnNBdmlhQmFyRW5hYmxlZCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMkNoZWFwJTIwRmxpZ2h0cyUyMEFkdmlzb3IlMjIlN0QsJTBBJTBBJTIwJTIybWVudURvd25sb2FkRnJvbUN1cnJlbnRQYWdlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQwJUI4JUQxJTgyJUQwJUI4JTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUI4JTIwJUQwJUI3JTIwJUQwJUJGJUQwJUJFJUQxJTgyJUQwJUJFJUQxJTg3JUQwJUJEJUQwJUJFJUQxJTk3JTIwJUQxJTgxJUQxJTgyJUQwJUJFJUQxJTgwJUQxJTk2JUQwJUJEJUQwJUJBJUQwJUI4JTIwJUQwJUI3JUQwJUIwJTIwJUQwJUI0JUQwJUJFJUQwJUJGJUQwJUJFJUQwJUJDJUQwJUJFJUQwJUIzJUQwJUJFJUQxJThFJTIwJUQxJTgxJUQwJUI1JUQxJTgwJUQwJUIyJUQxJTk2JUQxJTgxJUQxJTgzJTIwU2F2ZUZyb20ubmV0JTIyJTdELCUwQSUyMCUyMm1lbnVVcGRhdGVMaW5rcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RCVEMCVCMCVEMSU4MiVEMCVCOCVEMSU4MSVEMCVCRCVEMSU5NiVEMSU4MiVEMSU4QywlMjAlRDElOEYlRDAlQkElRDElODklRDAlQkUlMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYlMjAlRDAlQjQlRDAlQkIlRDElOEYlMjAlRDElODElRDAlQkElRDAlQjAlRDElODclRDElODMlRDAlQjIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYlMjAlRDAlQkQlRDAlQjUlMjAlRDAlQjcnJUQxJThGJUQwJUIyJUQwJUJCJUQxJThGJUQxJTk0JUQxJTgyJUQxJThDJUQxJTgxJUQxJThGJTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZE1QM0ZpbGVzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQwJUI4JUQxJTgyJUQwJUI4JTIwJUQwJUIyJUQxJTgxJUQxJTk2JTIwJUQwJUI3JUQwJUJEJUQwJUIwJUQwJUI5JUQwJUI0JUQwJUI1JUQwJUJEJUQxJTk2JTIwJUQwJUJEJUQwJUIwJTIwJUQxJTgxJUQxJTgyJUQwJUJFJUQxJTgwJUQxJTk2JUQwJUJEJUQxJTg2JUQxJTk2JTIwJUQwJUIwJUQxJTgzJUQwJUI0JUQxJTk2JUQwJUJFJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUI4JTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBsYXlsaXN0JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUE0JUQwJUJFJUQxJTgwJUQwJUJDJUQxJTgzJUQxJTk0JTIwJUQxJTgyJUQwJUIwJTIwJUQwJUI3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQxJTgzJUQxJTk0JTIwJUQwJUJGJUQwJUJCJUQwJUI1JUQwJUI5JUQwJUJCJUQwJUI4JUQxJTgxJUQxJTgyJTIwJUQwJUI3JTIwJUQwJUJGJUQwJUJFJUQxJTgxJUQwJUI4JUQwJUJCJUQwJUIwJUQwJUJEJUQwJUJEJUQxJThGJUQwJUJDJUQwJUI4JTIwJUQwJUJEJUQwJUIwJTIwJUQwJUIwJUQxJTgzJUQwJUI0JUQxJTk2JUQwJUJFJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUI4JTIyJTdELCUwQSUyMCUyMm1lbnVEb3dubG9hZFBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5NyVEMCVCMCVEMCVCMiVEMCVCMCVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCNiVEMCVCOCVEMSU4MiVEMCVCOCUyMCVEMCVCMiVEMSU4MSVEMSU5NiUyMCVEMCVCNyVEMCVCRCVEMCVCMCVEMCVCOSVEMCVCNCVEMCVCNSVEMCVCRCVEMSU5NiUyMCVEMCVCRCVEMCVCMCUyMCVEMSU4MSVEMSU4MiVEMCVCRSVEMSU4MCVEMSU5NiVEMCVCRCVEMSU4NiVEMSU5NiUyMCVEMSU4NCVEMCVCRSVEMSU4MiVEMCVCRSVEMCVCMyVEMSU4MCVEMCVCMCVEMSU4NCVEMSU5NiVEMSU5NyUyMiU3RCwlMEElMjAlMjJtZW51UmVwb3J0QnVnJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk0JUQwJUIwJUQwJUI5JUQxJTgyJUQwJUI1JTIwJUQwJUJEJUQwJUIwJUQwJUJDJTIwJUQwJUI3JUQwJUJEJUQwJUIwJUQxJTgyJUQwJUI4LCUyMCVEMSU4RiVEMCVCQSVEMSU4OSVEMCVCRSUyMCVEMCVCMiVEMCVCOCVEMCVCRCVEMCVCOCVEMCVCQSVEMCVCQiVEMCVCOCUyMCVEMCVCRiVEMSU4MCVEMCVCRSVEMCVCMSVEMCVCQiVEMCVCNSVEMCVCQyVEMCVCOCUyMiU3RCwlMEElMjAlMjJtZW51U2hvd09wdGlvbnMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTIlRDAlQkElRDAlQkIuJTIwLyUyMCVEMCU5MiVEMCVCOCVEMCVCQyVEMCVCQS4lMjAlRDAlQkYlRDElOTYlRDAlQjQlRDElODIlRDElODAlRDAlQjglRDAlQkMlRDElODMlRDAlQjIlRDAlQjAlRDAlQkQlRDElOTYlMjAlRDElODAlRDAlQjUlRDElODElRDElODMlRDElODAlRDElODElRDAlQjglMjAlRDElOTYlMjAlRDAlQkMlRDAlQkUlRDAlQjYlRDAlQkIlRDAlQjglRDAlQjIlRDAlQkUlRDElODElRDElODIlRDElOTYlMjAlRDAlQkYlRDAlQkUlRDAlQkMlRDElOTYlRDElODclRDAlQkQlRDAlQjglRDAlQkElRDAlQjAlMjIlN0QsJTBBJTIwJTIybWVudUVuYWJsZUV4dGVuc2lvbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiUyMiU3RCwlMEElMjAlMjJtZW51T3BlblBvbGwlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTElRDElODMlRDAlQjQlRDElOEMlMjAlRDAlQkIlRDAlQjAlRDElODElRDAlQkElRDAlQjAsJTIwJUQwJUJFJUQxJTg2JUQxJTk2JUQwJUJEJUQxJTk2JUQxJTgyJUQxJThDJTIwJUQxJThGJUQwJUJBJUQxJTk2JUQxJTgxJUQxJTgyJUQxJThDJTIwJUQxJTgwJUQwJUJFJUQwJUI3JUQxJTg4JUQwJUI4JUQxJTgwJUQwJUI1JUQwJUJEJUQwJUJEJUQxJThGJTIwJTVDJTIyU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQxJTk2JUQxJTg3JUQwJUJEJUQwJUI4JUQwJUJBJTVDJTIyJTIyJTdELCUwQSUwQSUyMCUyMnF1YWxpdHklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQUYlRDAlQkElRDElOTYlRDElODElRDElODIlRDElOEMlMjIlN0QsJTBBJTIwJTIycXVhbGl0eU5vdGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQUYlRDAlQkElRDElODklRDAlQkUlMjAlRDAlQjIlRDElOTYlRDAlQjQlRDAlQjUlRDAlQkUlMjAlRDAlQjIlMjAlRDAlQkYlRDAlQkUlRDElODIlRDElODAlRDElOTYlRDAlQjElRDAlQkQlRDElOTYlRDAlQjklMjAlRDElOEYlRDAlQkElRDAlQkUlRDElODElRDElODIlRDElOTYlMjAlRDAlQkQlRDAlQjUlRDAlQkMlRDAlQjAlRDElOTQsJTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTk0JUQxJTgyJUQxJThDJUQxJTgxJUQxJThGJTIwJUQwJUJEJUQwJUIwJUQwJUI5JUQwJUJBJUQxJTgwJUQwJUIwJUQxJTg5JUQwJUI1JTIwJUQwJUI3JTIwJUQwJUJDJUQwJUJFJUQwJUI2JUQwJUJCJUQwJUI4JUQwJUIyJUQwJUJFJUQwJUIzJUQwJUJFLiUyMiU3RCwlMEElMjAlMjJmaWxlbGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUExJUQwJUJGJUQwJUI4JUQxJTgxJUQwJUJFJUQwJUJBJTIwJUQwJUI3JUQwJUJEJUQwJUIwJUQwJUI5JUQwJUI0JUQwJUI1JUQwJUJEJUQwJUI4JUQxJTg1JTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQxJTk2JUQwJUIyJTIyJTdELCUwQSUyMCUyMmZpbGVsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUE5JUQwJUJFJUQwJUIxJTIwJUQwJUI3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQwJUI4JUQxJTgyJUQwJUI4JTIwJUQxJTgzJUQxJTgxJUQxJTk2JTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUI4LCUyMCVEMSU4MSVEMCVCQSVEMCVCRSVEMCVCRiVEMSU5NiVEMSU4RSVEMCVCOSVEMSU4MiVEMCVCNSUyMCVEMSU4MSVEMCVCRiVEMCVCOCVEMSU4MSVEMCVCRSVEMCVCQSUyMCVEMCVCRiVEMCVCRSVEMSU4MSVEMCVCOCVEMCVCQiVEMCVCMCVEMCVCRCVEMSU4QyUyMCVEMSU5NiUyMCVEMCVCMiVEMSU4MSVEMSU4MiVEMCVCMCVEMCVCMiVEMSU4MiVEMCVCNSUyMCVEMCVCOSVEMCVCRSVEMCVCMyVEMCVCRSUyMCVEMSU4MyUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vcnUud2lraXBlZGlhLm9yZy93aWtpLyVEMCU5QyVEMCVCNSVEMCVCRCVEMCVCNSVEMCVCNCVEMCVCNiVEMCVCNSVEMSU4MF8lRDAlQjclRDAlQjAlRDAlQjMlRDElODAlRDElODMlRDAlQjclRDAlQkUlRDAlQkEnLHRleHQ6JyVEMCVCQyVEMCVCNSVEMCVCRCVEMCVCNSVEMCVCNCVEMCVCNiVEMCVCNSVEMSU4MCUyMCVEMCVCNyVEMCVCMCVEMCVCMiVEMCVCMCVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCNiVEMCVCNSVEMCVCRCVEMSU4QyclN0QlN0QsJy4lMjAlRDAlQUYlRDAlQkElRDElODklRDAlQkUlMjAlRDElODMlMjAlRDAlQjIlRDAlQjAlRDElODElMjAlRDAlQkQlRDAlQjUlMjAlRDAlQjIlRDElODElRDElODIlRDAlQjAlRDAlQkQlRDAlQkUlRDAlQjIlRDAlQkIlRDAlQjUlRDAlQkQlRDAlQjglRDAlQjklMjAlRDAlQkMlRDAlQjUlRDAlQkQlRDAlQjUlRDAlQjQlRDAlQjYlRDAlQjUlRDElODAlMjAlRDAlQjclRDAlQjAlRDAlQjIlRDAlQjAlRDAlQkQlRDElODIlRDAlQjAlRDAlQjYlRDAlQjUlRDAlQkQlRDElOEMsJTIwJUQxJTgwJUQwJUI1JUQwJUJBJUQwJUJFJUQwJUJDJUQwJUI1JUQwJUJEJUQwJUI0JUQxJTgzJUQxJTk0JUQwJUJDJUQwJUJFJTIwJUQwJUIyJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUI4JUQxJTgyJUQwJUI4JTIwJywlN0JhOiU3QmhyZWY6J2h0dHA6Ly93d3cud2VzdGJ5dGUuY29tL2RtLycsdGV4dDonRG93bmxvYWQlMjBNYXN0ZXInJTdEJTdELCcuJyU1RCUyMiU3RCwlMEElMjAlMjJwbGF5bGlzdFRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJCJUQwJUI1JUQwJUI5JUQwJUJCJUQxJTk2JUQxJTgxJUQxJTgyJTIyJTdELCUwQSUyMCUyMnBsYXlsaXN0SW5zdHJ1Y3Rpb24lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTclRDAlQjElRDAlQjUlRDElODAlRDAlQjUlRDAlQjYlRDAlQjUlRDAlQkQlRDAlQjglRDAlQjklMjAlRDAlQkYlRDAlQkIlRDAlQjUlRDAlQjklRDAlQkIlRDElOTYlRDElODElRDElODIlMjAlRDAlQkMlRDAlQkUlRDAlQjYlRDAlQkQlRDAlQjAlMjAlRDAlQjIlRDElOTYlRDAlQjQlRDAlQkElRDElODAlRDAlQjglRDElODIlRDAlQjglMjAlRDElODMlMjAlRDAlQkYlRDAlQkIlRDAlQjUlRDElOTQlRDElODAlRDElOTYlMjAlRDAlQjQlRDAlQkIlRDElOEYlMjAlRDAlQjIlRDElOTYlRDAlQjQlRDElODIlRDAlQjIlRDAlQkUlRDElODAlRDAlQjUlRDAlQkQlRDAlQkQlRDElOEYuJTIyJTdELCUwQSUwQSUyMCUyMnVtbXlTZlRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIySEQlMjAlRDAlQjAlRDAlQjElRDAlQkUlMjBNUDMlMjIlN0QsJTBBJTIwJTIydW1teU1lbnVJdGVtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjIlMjA6JTIwJTIyJTVCJTdCc3BhbjolN0IlN0QlN0QsJyUyMCVEMCVCNyUyMCVEMCVCNCVEMCVCRSVEMCVCQyVEMCVCRSVEMCVCQyVEMCVCRSVEMCVCMyVEMCVCRSVEMSU4RSUyMFVtbXknJTVEJTIyJTdELCUwQSUyMCUyMnVtbXlNZW51SW5mbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiU3QnA6JTdCdGV4dDonJUQwJTkyJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQxJTk2JUQxJTgyJUQxJThDJTIwJUQwJUIxJUQwJUI1JUQwJUI3JUQwJUJBJUQwJUJFJUQxJTg4JUQxJTgyJUQwJUJFJUQwJUIyJUQwJUJEJUQwJUI4JUQwJUI5JTIwVW1teSUyMFZpZGVvJTIwRG93bmxvYWRlciUyMCVEMSU5NiUyMCVEMCVCNyVEMCVCMCVEMCVCMiVEMCVCMCVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCNiVEMSU4MyVEMCVCOSVEMSU4MiVEMCVCNSUyMCVEMSU4MSVEMCVCMiVEMCVCRSVEMSU5NyUyMCVEMSU4MyVEMCVCQiVEMSU4RSVEMCVCMSVEMCVCQiVEMCVCNSVEMCVCRCVEMSU5NiUyMCVEMCVCMiVEMSU5NiVEMCVCNCVEMCVCNSVEMCVCRSUyMCVEMCVCMiUyMEhEJTIwJUQwJUIwJUQwJUIxJUQwJUJFJTIwJUQwJUIyJTIwTVAzLiclN0QlN0QsJTdCcDolN0JjbGFzczonY2VudGVyJyxhcHBlbmQ6JTVCJTdCYTolN0JjbGFzczonZ3JlZW4tYnRuLTIlMjBhcnJvdycsaHJlZjonJTdCdXJsJTdEJyx0YXJnZXQ6J19ibGFuaycsdGV4dDonJUQwJUExJUQwJTlBJUQwJTkwJUQwJUE3JUQwJTkwJUQwJUEyJUQwJTk4JyU3RCU3RCU1RCU3RCU3RCwlN0JwOiU3QmFwcGVuZDolNUInJUQwJTlGJUQxJTk2JUQxJTgxJUQwJUJCJUQxJThGJTIwJUQwJUIyJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUJCJUQwJUI1JUQwJUJEJUQwJUJEJUQxJThGJTIwJUQwJUJGJUQxJTgwJUQwJUI4JTIwJUQwJUJBJUQwJUJCJUQxJTk2JUQxJTg2JUQxJTk2JTIwJUQwJUJEJUQwJUIwJTIwJywlN0JpbWc6JTdCc3JjOicjJyU3RCU3RCwnJTIwJUQwJUI3JUQwJUIwJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUJBJUQwJUIwJTIwJUQwJUIxJUQxJTgzJUQwJUI0JUQwJUI1JTIwJUQwJUJGJUQwJUJFJUQxJTg3JUQwJUI4JUQwJUJEJUQwJUIwJUQxJTgyJUQwJUI4JUQxJTgxJUQxJThGJTIwJUQwJUIwJUQwJUIyJUQxJTgyJUQwJUJFJUQwJUJDJUQwJUIwJUQxJTgyJUQwJUI4JUQxJTg3JUQwJUJEJUQwJUJFLiclNUQlN0QlN0QlNUQlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwVGl0bGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQjUlRDElODAlRDAlQjUlRDAlQjIlRDElOTYlRDElODAlRDElODIlRDAlQjUlMjAlRDAlQkQlRDAlQjAlRDAlQkIlRDAlQjAlRDElODglRDElODIlRDElODMlRDAlQjIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEYlMjAlRDAlQjElRDElODAlRDAlQjAlRDElODMlRDAlQjclRDAlQjUlRDElODAlRDAlQjAlMjIlN0QsJTBBJTIwJTIyd2FybmluZ1BvcHVwRGVzYyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MiVEMCVCOCVEMCVCMSVEMSU5NiVEMSU4MCUyMCVEMCVCRiVEMCVCMCVEMCVCRiVEMCVCQSVEMCVCOCUyMCVEMCVCRiVEMSU4MCVEMCVCOCUyMCVEMSU4MSVEMCVCQSVEMCVCMCVEMSU4NyVEMSU4MyVEMCVCMiVEMCVCMCVEMCVCRCVEMCVCRCVEMSU5NiUyMCVEMCVCRiVEMCVCRSVEMCVCMiVEMCVCOCVEMCVCRCVEMCVCNSVEMCVCRCUyMCVEMCVCMSVEMSU4MyVEMSU4MiVEMCVCOCUyMCVEMCVCMiVEMSU5NiVEMCVCNCVEMCVCQSVEMCVCQiVEMSU4RSVEMSU4NyVEMCVCNSVEMCVCRCVEMCVCOCVEMCVCOS4lMjIlN0QsJTBBJTIwJTIycmVhZE1vcmUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTQlRDAlQjUlRDElODIlRDAlQjAlRDAlQkIlRDElOEMlRDAlQkQlRDElOTYlRDElODglRDAlQjUuLi4lMjIlN0QsJTBBJTIwJTIybm9XYXJuaW5nJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUI1JTIwJUQwJUJGJUQwJUJFJUQwJUJGJUQwJUI1JUQxJTgwJUQwJUI1JUQwJUI0JUQwJUI2JUQwJUIwJUQxJTgyJUQwJUI4JTIyJTdELCUwQSUyMCUyMmNhbmNlbCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCQSVEMCVCMCVEMSU4MSVEMSU4MyVEMCVCMiVEMCVCMCVEMCVCRCVEMCVCRCVEMSU4RiUyMiU3RCwlMEElMjAlMjJjb250aW51ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMSU4MCVEMCVCRSVEMCVCNCVEMCVCRSVEMCVCMiVEMCVCNiVEMCVCOCVEMSU4MiVEMCVCOCUyMiU3RCwlMEElMjAlMjJiZWZvcmVEb3dubG9hZFBvcHVwV2FybiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMyVEMCVCMiVEMCVCMCVEMCVCMyVEMCVCMDolMjAlRDElODElRDAlQkElRDAlQjAlRDElODElRDElODMlRDAlQjIlRDAlQjAlRDElODIlRDAlQjglMjAlRDAlQjAlRDAlQjElRDAlQkUlMjAlRDAlQkYlRDElODAlRDAlQjglRDAlQjclRDElODMlRDAlQkYlRDAlQjglRDAlQkQlRDAlQjglRDElODIlRDAlQjglMjAlRDAlQjclRDAlQjAlRDAlQjIlRDAlQjAlRDAlQkQlRDElODIlRDAlQjAlRDAlQjYlRDAlQjUlRDAlQkQlRDAlQkQlRDElOEYlMjAlRDAlQjElRDElODMlRDAlQjQlRDAlQjUlMjAlRDAlQkQlRDAlQjUlRDAlQkMlRDAlQkUlRDAlQjYlRDAlQkIlRDAlQjglRDAlQjIlRDAlQkUuJTIyJTdELCUwQSUwQSUyMCUyMnZrSW5mbyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5RiVEMCVCMCVEMSU4MCVEMCVCMCVEMCVCQyVEMCVCNSVEMSU4MiVEMSU4MCVEMCVCOCUyMiU3RCwlMEElMjAlMjJ2a0luZm9UaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMCVEMCVCRSVEMCVCNyVEMCVCQyVEMSU5NiVEMSU4MCUyMCVEMSU4NCVEMCVCMCVEMCVCOSVEMCVCQiVEMSU4MyUyMCVEMSU5NiUyMCVEMCVCMSVEMSU5NiVEMSU4MiVEMSU4MCVEMCVCNSVEMCVCOSVEMSU4MiUyMiU3RCwlMEElMjAlMjJ2a01wM0xpbmtzTm90Rm91bmQlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDAlQjUlMjAlRDAlQjclRDAlQkQlRDAlQjAlRDAlQjklRDAlQjQlRDAlQjUlRDAlQkQlRDAlQkUlMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDElOEMlMjAlRDAlQkQlRDAlQjAlMjBNUDMtJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUI4JTIyJTdELCUwQSUyMCUyMnZrUGhvdG9MaW5rc05vdEZvdW5kJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlEJUQwJUI1JTIwJUQwJUI3JUQwJUJEJUQwJUIwJUQwJUI5JUQwJUI0JUQwJUI1JUQwJUJEJUQwJUJFJTIwJUQwJUJGJUQwJUJFJUQxJTgxJUQwJUI4JUQwJUJCJUQwJUIwJUQwJUJEJUQxJThDJTIwJUQwJUJEJUQwJUIwJTIwJUQxJTg0JUQwJUJFJUQxJTgyJUQwJUJFJUQwJUIzJUQxJTgwJUQwJUIwJUQxJTg0JUQxJTk2JUQxJTk3JTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRQaG90b0FsYnVtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQwJUI4JUQxJTgyJUQwJUI4JTIwJUQwJUIwJUQwJUJCJUQxJThDJUQwJUIxJUQwJUJFJUQwJUJDJTIyJTdELCUwQSUyMCUyMnZrRG93bmxvYWRBbGxQaG90b0FsYnVtcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5NyVEMCVCMCVEMCVCMiVEMCVCMCVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCNiVEMCVCOCVEMSU4MiVEMCVCOCUyMCVEMSU4MyVEMSU4MSVEMSU5NiUyMCVEMCVCMCVEMCVCQiVEMSU4QyVEMCVCMSVEMCVCRSVEMCVCQyVEMCVCOCUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTk3JUQwJUJEJUQwJUIwJUQwJUI5JUQwJUI0JUQwJUI1JUQwJUJEJUQwJUJFJTIwJUQxJTg0JUQwJUJFJUQxJTgyJUQwJUJFJUQwJUIzJUQxJTgwJUQwJUIwJUQxJTg0JUQxJTk2JUQwJUI5JTIyJTdELCUwQSUyMCUyMnZrTm90QXZhaWxhYmxlUGhvdG9zJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTI1ZCUyMCVEMSU4NCVEMCVCRSVEMSU4MiVEMCVCRSUyMCVEMSU4MiVEMCVCOCVEMCVCQyVEMSU4NyVEMCVCMCVEMSU4MSVEMCVCRSVEMCVCMiVEMCVCRSUyMCVEMCVCRCVEMCVCNSVEMCVCNCVEMCVCRSVEMSU4MSVEMSU4MiVEMSU4MyVEMCVCRiVEMCVCRCVEMCVCRSUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTclRDAlQkQlRDAlQjAlRDAlQjklRDAlQjQlRDAlQjUlRDAlQkQlRDAlQkUlMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDElOEMlMjIlN0QsJTBBJTIwJTIydmtGb3VuZE9mJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUI3JTIyJTdELCUwQSUyMCUyMnZrU2hvd0FzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJFJUQwJUJBJUQwJUIwJUQwJUI3JUQwJUIwJUQxJTgyJUQwJUI4JTIwJUQxJThGJUQwJUJBJTIyJTdELCUwQSUyMCUyMnZrTGlzdE9mTGlua3MlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTElRDAlQkYlRDAlQjglRDElODElRDAlQkUlRDAlQkElMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDElOEMlMjIlN0QsJTBBJTIwJTIydmtMaXN0T2ZMaW5rc0luc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJyVEMCVBOSVEMCVCRSVEMCVCMSUyMCVEMCVCNyVEMCVCMCVEMCVCMiVEMCVCMCVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCNiVEMCVCOCVEMSU4MiVEMCVCOCUyMCVEMSU4MyVEMSU4MSVEMSU5NiUyMCVEMSU4NCVEMCVCRSVEMSU4MiVEMCVCRSVEMCVCMyVEMSU4MCVEMCVCMCVEMSU4NCVEMSU5NiVEMSU5NywlMjAlRDElODElRDAlQkElRDAlQkUlRDAlQkYlRDElOTYlRDElOEUlRDAlQjklRDElODIlRDAlQjUlMjAlRDElODElRDAlQkYlRDAlQjglRDElODElRDAlQkUlRDAlQkElMjAlRDAlQkYlRDAlQkUlRDElODElRDAlQjglRDAlQkIlRDAlQjAlRDAlQkQlRDElOEMlMjAlRDElOTYlMjAlRDAlQjIlRDElODElRDElODIlRDAlQjAlRDAlQjIlRDElODIlRDAlQjUlMjAlRDAlQjklRDAlQkUlRDAlQjMlRDAlQkUlMjAlRDElODMlMjAnLCU3QmE6JTdCaHJlZjonaHR0cDovL3J1Lndpa2lwZWRpYS5vcmcvd2lraS8lRDAlOUMlRDAlQjUlRDAlQkQlRDAlQjUlRDAlQjQlRDAlQjYlRDAlQjUlRDElODBfJUQwJUI3JUQwJUIwJUQwJUIzJUQxJTgwJUQxJTgzJUQwJUI3JUQwJUJFJUQwJUJBJyx0ZXh0OiclRDAlQkMlRDAlQjUlRDAlQkQlRDAlQjUlRDAlQjQlRDAlQjYlRDAlQjUlRDElODAlMjAlRDAlQjclRDAlQjAlRDAlQjIlRDAlQjAlRDAlQkQlRDElODIlRDAlQjAlRDAlQjYlRDAlQjUlRDAlQkQlRDElOEMnJTdEJTdELCcuJTIwJUQwJUFGJUQwJUJBJUQxJTg5JUQwJUJFJTIwJUQxJTgzJTIwJUQwJUIyJUQwJUIwJUQxJTgxJTIwJUQwJUJEJUQwJUI1JTIwJUQwJUIyJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUJCJUQwJUI1JUQwJUJEJUQwJUI4JUQwJUI5JTIwJUQwJUJDJUQwJUI1JUQwJUJEJUQwJUI1JUQwJUI0JUQwJUI2JUQwJUI1JUQxJTgwJTIwJUQwJUI3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQwJUI1JUQwJUJEJUQxJThDLCUyMCVEMSU4MCVEMCVCNSVEMCVCQSVEMCVCRSVEMCVCQyVEMCVCNSVEMCVCRCVEMCVCNCVEMSU4MyVEMSU5NCVEMCVCQyVEMCVCRSUyMCVEMCVCMiVEMSU4MSVEMSU4MiVEMCVCMCVEMCVCRCVEMCVCRSVEMCVCMiVEMCVCOCVEMSU4MiVEMCVCOCUyMCcsJTdCYTolN0JocmVmOidodHRwOi8vd3d3Lndlc3RieXRlLmNvbS9kbS8nLHRleHQ6J0Rvd25sb2FkJTIwTWFzdGVyJyU3RCU3RCwnLiclNUQlMjIlN0QsJTBBJTIwJTIydmtUYWJsZU9mVGh1bWJuYWlscyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMiVEMCVCMCVEMCVCMSVEMCVCQiVEMCVCOCVEMSU4NiVEMSU4RSUyMCVEMCVCNSVEMSU4MSVEMCVCQSVEMSU5NiVEMCVCNyVEMSU5NiVEMCVCMiUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZlBob3RvcyUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBMSVEMCVCRiVEMCVCOCVEMSU4MSVEMCVCRSVEMCVCQSUyMCVEMSU4NCVEMCVCRSVEMSU4MiVEMCVCRSVEMCVCMyVEMSU4MCVEMCVCMCVEMSU4NCVEMSU5NiVEMCVCOSUyMiU3RCwlMEElMjAlMjJ2a0xpc3RPZlBob3Rvc0luc3RydWN0aW9uJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUE5JUQwJUJFJUQwJUIxJTIwJUQwJUI3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQwJUI4JUQxJTgyJUQwJUI4JTIwJUQxJTg0JUQwJUJFJUQxJTgyJUQwJUJFJUQwJUIzJUQxJTgwJUQwJUIwJUQxJTg0JUQxJTk2JUQxJThFLCUyMCVEMCVCRCVEMCVCMCVEMSU4MiVEMCVCOCVEMSU4MSVEMCVCRCVEMSU5NiVEMSU4MiVEMSU4QyUyMCVEMCVCRCVEMCVCMCUyMCVEMCVCRCVEMCVCNSVEMSU5NyUyMCVEMCVCQiVEMSU5NiVEMCVCMiVEMCVCRSVEMSU4RSUyMCVEMCVCQSVEMCVCRCVEMCVCRSVEMCVCRiVEMCVCQSVEMCVCRSVEMSU4RSUyMCVEMCVCQyVEMCVCOCVEMSU4OCVEMSU5Ni4lMjIlN0QsJTBBJTIwJTIydmtLYnBzJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJUJBJUQwJUIxLyVEMSU4MSUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MSUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplS0J5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQkElRDAlOTElMjIlN0QsJTBBJTIwJTIydmtGaWxlU2l6ZU1CeXRlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlDJUQwJTkxJTIyJTdELCUwQSUyMCUyMnZrRmlsZVNpemVHQnl0ZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5MyVEMCU5MSUyMiU3RCwlMEElMjAlMjJ2a0ZpbGVTaXplVEJ5dGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTIlRDAlOTElMjIlN0QsJTBBJTIwJTIydmtEb3dubG9hZEZyb21Zb3V0dWJlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJyVEMCU5NyVEMCVCMCVEMCVCMiVEMCVCMCVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCNiVEMCVCOCVEMSU4MiVEMCVCODolMjAlRDAlQjIlRDElOTYlRDAlQjQlRDAlQkElRDElODAlRDAlQjglRDAlQjklRDElODIlRDAlQjUlMjAnLCU3QmE6JTdCaHJlZjonJTdCdXJsJTdEJyx0ZXh0OiclRDElODElRDElODIlRDAlQkUlRDElODAlRDElOTYlRDAlQkQlRDAlQkElRDElODMlMjAlRDAlQjIlRDElOTYlRDAlQjQlRDAlQjUlRDAlQkUtJUQxJTgwJUQwJUJFJUQwJUJCJUQwJUI4JUQwJUJBJUQwJUIwJyU3RCU3RCwnJTIwJUQxJTk2JTIwJUQwJUJEJUQwJUIwJUQxJTgyJUQwJUI4JUQxJTgxJUQwJUJEJUQxJTk2JUQxJTgyJUQxJThDJTIwJUQwJUJBJUQwJUJEJUQwJUJFJUQwJUJGJUQwJUJBJUQxJTgzJTIwJTVDJTIyJUQwJTk3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQwJUI4JUQxJTgyJUQwJUI4JTVDJTIyJTIwJUQwJUJEJUQwJUIwJUQwJUI0JTIwJUQwJUJGJUQwJUJCJUQwJUI1JUQxJTk0JUQxJTgwJUQwJUJFJUQwJUJDJyU1RCUyMiU3RCwlMEElMjAlMjJ2a0ZvdW5kRmlsZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTclRDAlQkQlRDAlQjAlRDAlQjklRDAlQjQlRDAlQjUlRDAlQkQlRDAlQkUlMjAlRDElODQlRDAlQjAlRDAlQjklRDAlQkIlRDElOTYlRDAlQjI6JTIwJTI1ZCUyMiU3RCwlMEElMEElMjAlMjJzaGFyZUluJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQwJUJFJUQwJUI0JUQxJTk2JUQwJUJCJUQwJUI4JUQxJTgyJUQwJUI4JUQxJTgxJUQxJThGJTIwJUQwJUIyJTIwJTI1dyUyMiU3RCwlMEElMjAlMjJzb2NpYWxEZXNjJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQxJTk2JUQxJTg3JUQwJUJEJUQwJUI4JUQwJUJBJTIwJUQwJUI0JUQwJUIwJUQxJTk0JTIwJUQwJUIyJUQwJUIwJUQwJUJDJTIwJUQwJUJDJUQwJUJFJUQwJUI2JUQwJUJCJUQwJUI4JUQwJUIyJUQxJTk2JUQxJTgxJUQxJTgyJUQxJThDJTIwJUQwJUIxJUQwJUI1JUQwJUI3JUQwJUJBJUQwJUJFJUQxJTg4JUQxJTgyJUQwJUJFJUQwJUIyJUQwJUJEJUQwJUJFJTIwJUQwJUI3JUQwJUIwJUQwJUIyJUQwJUIwJUQwJUJEJUQxJTgyJUQwJUIwJUQwJUI2JUQxJTgzJUQwJUIyJUQwJUIwJUQxJTgyJUQwJUI4JTIwJUQxJTg0JUQwJUIwJUQwJUI5JUQwJUJCJUQwJUI4JTIwJUQwJUI3JTIwWW91VHViZS5jb20sJTIwRmFjZWJvb2suY29tLCUyMFZLLmNvbSUyMCVEMSU4MiVEMCVCMCUyMCVEMCVCMSVEMSU5NiVEMCVCQiVEMSU4QyVEMSU4OCVEMCVCNSUyMDQwJTIwJUQxJTk2JUQwJUJEJUQxJTg4JUQwJUI4JUQxJTg1JTIwJUQxJTgxJUQwJUIwJUQwJUI5JUQxJTgyJUQxJTk2JUQwJUIyJTIwJUQwJUJCJUQwJUI4JUQxJTg4JUQwJUI1JTIwJUQwJUJFJUQwJUI0JUQwJUJEJUQwJUI4JUQwJUJDJTIwJUQwJUJBJUQwJUJCJUQxJTk2JUQwJUJBJUQwJUJFJUQwJUJDJTIyJTdELCUwQSUwQSUyMCUyMnR1dG9yaWFsUzFUaXRsZSUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCU5NCVEMCVCRSVEMCVCMSVEMSU4MCVEMSU5NiUyMCVEMCVCRCVEMCVCRSVEMCVCMiVEMCVCOCVEMCVCRCVEMCVCOCElMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTMU1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUEzJTIwJUQxJTgyJUQwJUI1JUQwJUIxJUQwJUI1JTIwJUQwJUIyJUQxJTgxJUQxJTgyJUQwJUIwJUQwJUJEJUQwJUJFJUQwJUIyJUQwJUJCJUQwJUI1JUQwJUJEJUQwJUI4JUQwJUI5JTIwU2F2ZUZyb20ubmV0JTIwJUQwJUJGJUQwJUJFJUQwJUJDJUQxJTk2JUQxJTg3JUQwJUJEJUQwJUI4JUQwJUJBJTIwJywlN0JpbWc6JTIwJTdCc3JjOiUyMCcjbG9nbyclN0QlN0QsJTIwJywlMjAlRDElOTYlMjAlRDElODIlRDAlQjUlRDAlQkYlRDAlQjUlRDElODAlMjAlRDElODIlRDAlQjglMjAlRDAlQkMlRDAlQkUlRDAlQjYlRDAlQjUlRDElODglMjAlRDAlQjclRDAlQjAlRDAlQjIlRDAlQjAlRDAlQkQlRDElODIlRDAlQjAlRDAlQjYlRDAlQjglRDElODIlRDAlQjglMjAlRDAlQjElRDElODMlRDAlQjQlRDElOEMtJUQxJThGJUQwJUJBJUQwJUI1JTIwJUQwJUIyJUQxJTk2JUQwJUI0JUQwJUI1JUQwJUJFJTIwJUQwJUI3JTIwWW91VHViZSUyMCVEMCVCMiUyMCVEMCVCRSVEMCVCNCVEMCVCOCVEMCVCRCUyMCVEMCVCQSVEMCVCQiVEMSU5NiVEMCVCQSclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTMUFycm93JTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJyVEMCU5RiVEMSU4MCVEMCVCMCVEMCVCMyVEMCVCRCVEMCVCNSVEMSU4OCUyMCVEMCVCNCVEMCVCRSVEMCVCMiVEMSU5NiVEMCVCNCVEMCVCMCVEMSU4MiVEMCVCOCVEMSU4MSVEMSU4RiUyMCVEMSU4RiVEMCVCQT8nLCUyMCU3QmJyOiU3QiU3RCU3RCwlMjAnJUQwJTlEJUQwJUIwJUQxJTgyJUQwJUI4JUQxJTgxJUQwJUJEJUQwJUI4JTIwJUQxJTgyJUQxJTgzJUQxJTgyJyU1RCUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFMyTWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiVEMCVBOSVEMCVCRSVEMCVCMSUyMCVEMCVCNyVEMCVCMCVEMCVCMiVEMCVCMCVEMCVCRCVEMSU4MiVEMCVCMCVEMCVCNiVEMCVCOCVEMSU4MiVEMCVCOCUyMCVEMCVCMiVEMSU5NiVEMCVCNCVEMCVCNSVEMCVCRSwlMjAlRDAlQkUlRDAlQjElRDAlQjUlRDElODAlRDElOTYlRDElODIlRDElOEMlMjAlRDElODQlRDAlQkUlRDElODAlRDAlQkMlRDAlQjAlRDElODIlMjAlRDElOTYlMjAlRDAlQkQlRDAlQjAlRDElODIlRDAlQjglRDElODElRDAlQkQlRDAlQjglMjAlRDAlQkElRDAlQkQlRDAlQkUlRDAlQkYlRDAlQkElRDElODMlMjAlNUMlMjIlRDAlOTclRDAlQjAlRDAlQjIlRDAlQjAlRDAlQkQlRDElODIlRDAlQjAlRDAlQjYlRDAlQjglRDElODIlRDAlQjglNUMlMjIlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTM0hpc3RvcnklMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUYlRDAlQjUlRDElODAlRDAlQjUlRDAlQjMlRDAlQkIlRDElOEYlRDAlQkQlRDElODMlRDElODIlRDElOTYlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTM01haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJUE1JUQwJUJFJUQxJTg3JUQwJUI1JUQxJTg4JTIwJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQwJUI4JTIwJUQwJUIyJUQwJUI2JUQwJUI1JTIwJUQwJUJGJUQwJUI1JUQxJTgwJUQwJUI1JUQwJUIzJUQwJUJCJUQxJThGJUQwJUJEJUQxJTgzJUQxJTgyJUQwJUI1JTIwJUQwJUIyJUQxJTk2JUQwJUI0JUQwJUI1JUQwJUJFPycsJTIwJTdCYnI6JTdCJTdEJTdELCUyMCclRDAlOUQlRDAlQjAlRDElODIlRDAlQjglRDElODElRDAlQkElRDAlQjAlRDAlQjklMjAlRDAlQkQlRDAlQjAlMjAnLCUyMCU3QmltZzolMjAlN0JzcmM6JTIwJyNhcnJvdyclN0QlN0QsJTIwJyUyMCVEMCVCRCVEMCVCMCUyMCVEMCVCRiVEMSU4MCVEMCVCNSVEMCVCMiVEMSU4QyVEMSU4RSUyMCVEMCVCMiUyMCVEMCVCRiVEMCVCNSVEMSU4MCVEMCVCNSVEMCVCMyVEMCVCQiVEMSU4RiVEMCVCRCVEMSU4MyVEMSU4MiVEMCVCOCVEMSU4NSUyMCVEMCVCMiVEMSU5NiVEMCVCNCVEMCVCNSVEMCVCRSclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNE1haW4lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlNUInJUQwJTkyJUQxJTk2JUQwJUI0JUQwJUI1JUQwJUJFJTIwJUQwJUJEJUQwJUI1JTIwJUQwJUJFJUQwJUIxJUQwJUJFJUQwJUIyJTVDJTVDJyVEMSU4RiVEMCVCNyVEMCVCQSVEMCVCRSVEMCVCMiVEMCVCRSUyMCVEMCVCRiVEMCVCNSVEMSU4MCVEMCVCNSVEMCVCMyVEMCVCQiVEMSU4RiVEMCVCNCVEMCVCMCVEMSU4MiVEMCVCOCUyMCVFMiU4MCU5NCcsJTIwJTdCYnI6JTdCJTdEJTdELCUyMCclRDAlQkQlRDAlQjAlRDElODIlRDAlQjglRDElODElRDAlQkElRDAlQjAlRDAlQjklMjAlRDAlQkQlRDAlQjAlMjAnLCUyMCU3QmltZzolMjAlN0JzcmM6JTIwJyNhcnJvdyclN0QlN0QsJTIwJywlMjAlRDAlQkUlRDAlQjElRDAlQjglRDElODAlRDAlQjAlRDAlQjklMjAlRDElODQlRDAlQkUlRDElODAlRDAlQkMlRDAlQjAlRDElODIlMjAlRDElOTYlMjAlRDElODElRDAlQkElRDAlQjAlRDElODclRDElODMlRDAlQjkuJTIwJUQwJUE2JUQwJUI1JTIwJUQwJUI3JUQxJTgwJUQxJTgzJUQxJTg3JUQwJUJEJUQwJUJFISclNUQlMjIlN0QsJTBBJTIwJTIydHV0b3JpYWxTNVRpdGxlJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJUQwJTlGJUQxJTgwJUQwJUI4JUQxJTk0JUQwJUJDJUQwJUJEJUQwJUJFJUQxJTk3JTIwJUQxJTgwJUQwJUJFJUQwJUIxJUQwJUJFJUQxJTgyJUQwJUI4ISUyMiU3RCwlMEElMjAlMjJ0dXRvcmlhbFM1TWFpbiUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiclRDAlOTclRDAlQjAlRDAlQkIlRDAlQjglRDElODglRDAlQjglRDAlQkIlRDAlQjglRDElODElRDElOEYlMjAlRDAlQkYlRDAlQjglRDElODIlRDAlQjAlRDAlQkQlRDAlQkQlRDElOEY/JTIwJUQwJTg0JTIwJUQwJUJGJUQxJTgwJUQwJUJFJUQwJUJGJUQwJUJFJUQwJUI3JUQwJUI4JUQxJTg2JUQxJTk2JUQxJTk3PyUyMCVEMCU5NyVEMCVCMCVEMCVCMyVEMCVCQiVEMSU4RiVEMCVCRCVEMSU4QyVEMSU4MiVEMCVCNSUyMCVEMCVCRCVEMCVCMCUyMCcsJTdCYTolMjAlN0J0ZXh0OiUyMCclRDElODElRDElODIlRDAlQkUlRDElODAlRDElOTYlRDAlQkQlRDAlQkElRDElODMlMjAlRDAlQkYlRDElOTYlRDAlQjQlRDElODIlRDElODAlRDAlQjglRDAlQkMlRDAlQkElRDAlQjgnLCUyMGhyZWY6JTIwJyNzdXBwb3J0JyU3RCU3RCwnJTIwJUQwJUIwJUQwJUIxJUQwJUJFJTIwJUQwJUIyJUQxJTgxJUQxJTgyJUQxJTgzJUQwJUJGJUQwJUIwJUQwJUI5JUQxJTgyJUQwJUI1JTIwJUQwJUI0JUQwJUJFJTIwJUQwJUJEJUQwJUIwJUQxJTg4JUQwJUJFJUQxJTk3JTIwJywlMjAlN0JhOiUyMCU3QnRleHQ6JTIwJyVEMCU5MiVEMCU5QS0lRDElODElRDAlQkYlRDElOTYlRDAlQkIlRDElOEMlRDAlQkQlRDAlQkUlRDElODIlRDAlQjgnLCUyMGhyZWY6JTIwJyN2ayclN0QlN0QlNUQlMjIlN0QsJTBBJTBBJTIwJTIydHV0b3JpYWxUb29sdGlwVGV4dCUyMjolMjAlN0IlMjJtZXNzYWdlJTIyOiUyMCUyMiU1QiclRDAlQTklRDAlQkUlRDAlQjElMjAnLCU3QmI6JTIwJTdCdGV4dDolMjAnJUQxJTgxJUQwJUJBJUQwJUIwJUQxJTg3JUQwJUIwJUQxJTgyJUQwJUI4JyU3RCU3RCwnLCUyMCVEMCVCRiVEMSU4MCVEMCVCRSVEMSU4MSVEMSU4MiVEMCVCRSUyMCVEMCVCQSVEMCVCQiVEMSU5NiVEMCVCQSVEMCVCRCVEMSU5NiVEMSU4MiVEMSU4QyUyMCVEMCVCRiVEMCVCRSUyMCVEMCVCQSVEMCVCRCVEMCVCRSVEMCVCRiVEMSU4NiVEMSU5NiclNUQlMjIlN0QsJTBBJTBBJTIwJTIydW1teVRvb2x0aXBDb25maXJtJTIyOiUyMCU3QiUyMm1lc3NhZ2UlMjI6JTIwJTIyJTVCJyVEMCU5MiVEMCVCOCUyMCVEMCVCMiVEMCVCNiVEMCVCNSUyMCVEMCVCMiVEMSU4MSVEMSU4MiVEMCVCMCVEMCVCRCVEMCVCRSVEMCVCMiVEMCVCOCVEMCVCQiVEMCVCOCcsJTdCYnI6JTdCJTdEJTdELCU3QmltZzolN0IlN0QlN0QsJyUyMFVtbXklMjBWaWRlbyUyMERvd25sb2FkZXI/JyU1RCUyMiU3RCwlMEElMjAlMjJ5ZXMlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlQTIlRDAlQjAlRDAlQkElMjIlN0QsJTBBJTIwJTIybm8lMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOUQlRDElOTYlMjIlN0QsJTBBJTIwJTIydG9vbHRpcEhpZGUlMjI6JTIwJTdCJTIybWVzc2FnZSUyMjolMjAlMjIlRDAlOTElRDElOTYlRDAlQkIlRDElOEMlRDElODglRDAlQjUlMjAlRDAlQkQlRDAlQjUlMjAlRDAlQkYlRDAlQkUlRDAlQkElRDAlQjAlRDAlQjclRDElODMlRDAlQjIlRDAlQjAlRDElODIlRDAlQjglMjAlRDElODYlRDAlQjUlMjAlRDAlQkYlRDAlQkUlRDAlQjIlRDElOTYlRDAlQjQlRDAlQkUlRDAlQkMlRDAlQkIlRDAlQjUlRDAlQkQlRDAlQkQlRDElOEYlMjIlN0QlMEElN0QiOwogIHZhciBtb25vID0gKHR5cGVvZiBtb25vICE9PSAndW5kZWZpbmVkJykgPyBtb25vIDogdW5kZWZpbmVkOwoKICAoZnVuY3Rpb24oYmFzZSwgZmFjdG9yeSkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8gJiYgbW9uby5pc0xvYWRlZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIF9tb25vID0gbW9ubzsKICAgIHZhciBmbiA9IGZ1bmN0aW9uKGFkZG9uKSB7CiAgICAgIHJldHVybiBmYWN0b3J5KF9tb25vLCBhZGRvbik7CiAgICB9OwoKICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIikgewogICAgICBtb25vID0gYmFzZShmbik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgfSgKICAgIGZ1bmN0aW9uIGJhc2UoZmFjdG9yeSkgewogICAgICBpZiAoWydpbnRlcmFjdGl2ZScsICdjb21wbGV0ZSddLmluZGV4T2YoZG9jdW1lbnQucmVhZHlTdGF0ZSkgIT09IC0xKSB7CiAgICAgICAgcmV0dXJuIGZhY3RvcnkoKTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBHTV9nZXRWYWx1ZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICByZXR1cm4gZmFjdG9yeSgpOwogICAgICB9CgogICAgICB2YXIgYmFzZSA9IHsKICAgICAgICBpc0xvYWRlZDogdHJ1ZSwKICAgICAgICBvblJlYWR5U3RhY2s6IFtdLAogICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgYmFzZS5vblJlYWR5U3RhY2sucHVzaChbdGhpcywgYXJndW1lbnRzXSk7CiAgICAgICAgfSwKICAgICAgICBsb2FkTW9kdWxlU3RhY2s6IFtdLAogICAgICAgIGxvYWRNb2R1bGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgYmFzZS5sb2FkTW9kdWxlU3RhY2sucHVzaChbdGhpcywgYXJndW1lbnRzXSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIG9uTG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBvbkxvYWQsIGZhbHNlKTsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9hZCcsIG9uTG9hZCwgZmFsc2UpOwoKICAgICAgICBtb25vID0gZmFjdG9yeSgpOwoKICAgICAgICB2YXIgaXRlbTsKICAgICAgICB3aGlsZSAoaXRlbSA9IGJhc2Uub25SZWFkeVN0YWNrLnNoaWZ0KCkpIHsKICAgICAgICAgIG1vbm8ub25SZWFkeS5hcHBseShpdGVtWzBdLCBpdGVtWzFdKTsKICAgICAgICB9CgogICAgICAgIHdoaWxlIChpdGVtID0gYmFzZS5sb2FkTW9kdWxlU3RhY2suc2hpZnQoKSkgewogICAgICAgICAgbW9uby5sb2FkTW9kdWxlLmFwcGx5KGl0ZW1bMF0sIGl0ZW1bMV0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBvbkxvYWQsIGZhbHNlKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBvbkxvYWQsIGZhbHNlKTsKCiAgICAgIHJldHVybiBiYXNlOwogICAgfSwKICAgIGZ1bmN0aW9uIGluaXRNb25vKF9tb25vLCBfYWRkb24pIHsKCiAgICAgIHZhciBicm93c2VyQXBpID0gZnVuY3Rpb24oKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBlbXB0eUZuID0gZnVuY3Rpb24oKSB7fTsKCiAgICAgICAgdmFyIGNsb25lT2JqID0gZnVuY3Rpb24obXNnKSB7CiAgICAgICAgICB2YXIgb2JqID0gbnVsbDsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG9iaiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgIHc6IG1zZwogICAgICAgICAgICB9KSkudzsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ2xvbmVPYmogZXJyb3IhJywgZSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAgICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0KICAgICAgICAgKi8KICAgICAgICB2YXIgb25jZUZuID0gZnVuY3Rpb24oZm4pIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihtc2cpIHsKICAgICAgICAgICAgaWYgKGZuKSB7CiAgICAgICAgICAgICAgZm4obXNnKTsKICAgICAgICAgICAgICBmbiA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICAgICAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259CiAgICAgICAgICovCiAgICAgICAgdmFyIGNsb25lUmVzcG9uc2UgPSBmdW5jdGlvbihmbikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGZuKGNsb25lT2JqKHJlc3BvbnNlKSk7CiAgICAgICAgICB9OwogICAgICAgIH07CgogICAgICAgIHZhciBtc2dUb29scyA9IHsKICAgICAgICAgIGxpc3RlbmVyQmdMaXN0OiBbXSwKICAgICAgICAgIGxpc3RlbmVyTGlzdDogW10KICAgICAgICB9OwoKICAgICAgICB2YXIgYXBpID0gewogICAgICAgICAgaXNHTTogdHJ1ZSwKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHBhcmFtIHsqfSBtc2cKICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtyZXNwb25zZUNhbGxiYWNrXQogICAgICAgICAgICovCiAgICAgICAgICBzZW5kTWVzc2FnZVRvQWN0aXZlVGFiOiBmdW5jdGlvbihtc2csIHJlc3BvbnNlQ2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIHJlc3BvbnNlRm4gPSAhcmVzcG9uc2VDYWxsYmFjayA/IGVtcHR5Rm4gOiBvbmNlRm4oY2xvbmVSZXNwb25zZShyZXNwb25zZUNhbGxiYWNrKSk7CgogICAgICAgICAgICBtc2dUb29scy5saXN0ZW5lckxpc3QuZm9yRWFjaChmdW5jdGlvbihmbikgewogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmbihjbG9uZU9iaihtc2cpLCByZXNwb25zZUZuKTsKICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcGFyYW0geyp9IG1zZwogICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3Jlc3BvbnNlQ2FsbGJhY2tdCiAgICAgICAgICAgKi8KICAgICAgICAgIHNlbmRNZXNzYWdlOiBmdW5jdGlvbihtc2csIHJlc3BvbnNlQ2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIHJlc3BvbnNlRm4gPSAhcmVzcG9uc2VDYWxsYmFjayA/IGVtcHR5Rm4gOiBvbmNlRm4oY2xvbmVSZXNwb25zZShyZXNwb25zZUNhbGxiYWNrKSk7CgogICAgICAgICAgICB2YXIgY2xvbmVNc2cgPSBjbG9uZU9iaihtc2cpOwogICAgICAgICAgICBtc2dUb29scy5saXN0ZW5lckJnTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGZuKSB7CiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGZuKGNsb25lTXNnLCByZXNwb25zZUZuKTsKICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgb25NZXNzYWdlOiB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW2RldGFpbHNdCiAgICAgICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2RldGFpbHMuaXNCZ10KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGFkZExpc3RlbmVyOiBmdW5jdGlvbihjYWxsYmFjaywgZGV0YWlscykgewogICAgICAgICAgICAgIGRldGFpbHMgPSBkZXRhaWxzIHx8IHt9OwogICAgICAgICAgICAgIHZhciBsaXN0ZW5lckxpc3QgPSBudWxsOwogICAgICAgICAgICAgIGlmIChkZXRhaWxzLmlzQmcpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyTGlzdCA9IG1zZ1Rvb2xzLmxpc3RlbmVyQmdMaXN0OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lckxpc3QgPSBtc2dUb29scy5saXN0ZW5lckxpc3Q7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAobGlzdGVuZXJMaXN0LmluZGV4T2YoY2FsbGJhY2spID09PSAtMSkgewogICAgICAgICAgICAgICAgbGlzdGVuZXJMaXN0LnB1c2goY2FsbGJhY2spOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbZGV0YWlsc10KICAgICAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbZGV0YWlscy5pc0JnXQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgcmVtb3ZlTGlzdGVuZXI6IGZ1bmN0aW9uKGNhbGxiYWNrLCBkZXRhaWxzKSB7CiAgICAgICAgICAgICAgZGV0YWlscyA9IGRldGFpbHMgfHwge307CiAgICAgICAgICAgICAgdmFyIGxpc3RlbmVyTGlzdCA9IG51bGw7CiAgICAgICAgICAgICAgaWYgKGRldGFpbHMuaXNCZykgewogICAgICAgICAgICAgICAgbGlzdGVuZXJMaXN0ID0gbXNnVG9vbHMubGlzdGVuZXJCZ0xpc3Q7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyTGlzdCA9IG1zZ1Rvb2xzLmxpc3RlbmVyTGlzdDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwb3MgPSBsaXN0ZW5lckxpc3QuaW5kZXhPZihjYWxsYmFjayk7CiAgICAgICAgICAgICAgaWYgKHBvcyAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyTGlzdC5zcGxpY2UocG9zLCAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpZiAod2luZG93LmNocm9tZSkgewogICAgICAgICAgYXBpLmlzVE0gPSB0cnVlOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICgvTWF4dGhvblwvLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7CiAgICAgICAgICBhcGkuaXNWTSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFwaS5pc0dtT25seSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICB2YXIgaW5pdEdtU3RvcmFnZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHJlYWRPbGRJdGVtID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9PSAnaXNNb25vRW1wdHlWYWx1ZScpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodmFsdWUpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignR00gb2xkIHN0b3JhZ2UgaXRlbSByZWFkIGVycm9yIScsIGUsIHZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIGpzb25SZSA9IC9eeyg/OiJ3IjouK3wpfSQvOwogICAgICAgICAgdmFyIHJlYWRJdGVtID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnTW9ub0VtcHR5VmFsdWUnICYmICFqc29uUmUudGVzdCh2YWx1ZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gcmVhZE9sZEl0ZW0odmFsdWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzdWx0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZSAhPT0gJ01vbm9FbXB0eVZhbHVlJykgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKHZhbHVlKS53OwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dNIFN0b3JhZ2UgaXRlbSByZWFkIGVycm9yIScsIGUsIHZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIHdyaXRlSXRlbSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgdzogdmFsdWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ3xbU3RyaW5nXXxPYmplY3R8bnVsbHx1bmRlZmluZWR9IFtrZXlzXQogICAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAgICAgICAgICAgKi8KICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbihrZXlzLCBjYWxsYmFjaykgewogICAgICAgICAgICAgIHZhciBpdGVtcyA9IHt9OwogICAgICAgICAgICAgIHZhciBkZWZhdWx0SXRlbXMgPSB7fTsKCiAgICAgICAgICAgICAgdmFyIF9rZXlzID0gW107CiAgICAgICAgICAgICAgaWYgKGtleXMgPT09IHVuZGVmaW5lZCB8fCBrZXlzID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBfa2V5cyA9IEdNX2xpc3RWYWx1ZXMoKTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShrZXlzKSkgewogICAgICAgICAgICAgICAgX2tleXMgPSBrZXlzOwogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIGlmICh0eXBlb2Yga2V5cyA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICAgIF9rZXlzID0gT2JqZWN0LmtleXMoa2V5cyk7CiAgICAgICAgICAgICAgICBkZWZhdWx0SXRlbXMgPSBrZXlzOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfa2V5cyA9IFtrZXlzXTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9rZXlzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSByZWFkSXRlbShHTV9nZXRWYWx1ZShrZXksICdNb25vRW1wdHlWYWx1ZScpKTsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gZGVmYXVsdEl0ZW1zW2tleV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBpdGVtc1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayhpdGVtcyk7CiAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbXMKICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihpdGVtcywgY2FsbGJhY2spIHsKICAgICAgICAgICAgICBPYmplY3Qua2V5cyhpdGVtcykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgICAgIGlmIChpdGVtc1trZXldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgR01fc2V0VmFsdWUoa2V5LCB3cml0ZUl0ZW0oaXRlbXNba2V5XSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYWxsYmFjayAmJiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfFtTdHJpbmddfSBba2V5c10KICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbihrZXlzLCBjYWxsYmFjaykgewogICAgICAgICAgICAgIHZhciBfa2V5cyA9IFtdOwogICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGtleXMpKSB7CiAgICAgICAgICAgICAgICBfa2V5cyA9IGtleXM7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9rZXlzID0gW2tleXNdOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2tleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgICAgIEdNX2RlbGV0ZVZhbHVlKGtleSk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhbGxiYWNrICYmIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgY2xlYXI6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoR01fbGlzdFZhbHVlcygpLCBjYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgYXBpLnN0b3JhZ2UgPSBpbml0R21TdG9yYWdlKCk7CgogICAgICAgIHZhciBfbmF2aWdhdG9yID0gbnVsbDsKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJucyB7e2xhbmd1YWdlOiBTdHJpbmcsIHBsYXRmb3JtOiBTdHJpbmcsIHVzZXJBZ2VudDogU3RyaW5nfX0KICAgICAgICAgKi8KICAgICAgICBhcGkuZ2V0TmF2aWdhdG9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoX25hdmlnYXRvcikgewogICAgICAgICAgICByZXR1cm4gX25hdmlnYXRvcjsKICAgICAgICAgIH0KCiAgICAgICAgICBfbmF2aWdhdG9yID0ge307CiAgICAgICAgICBbJ2xhbmd1YWdlJywgJ3BsYXRmb3JtJywgJ3VzZXJBZ2VudCddLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgIF9uYXZpZ2F0b3Jba2V5XSA9IG5hdmlnYXRvcltrZXldIHx8ICcnOwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIF9uYXZpZ2F0b3I7CiAgICAgICAgfTsKCiAgICAgICAgKGZ1bmN0aW9uIGNoZWNrQ29tcGF0aWJpbGl0eSgpIHsKICAgICAgICAgIHZhciB1YSA9IGFwaS5nZXROYXZpZ2F0b3IoKS51c2VyQWdlbnQ7CiAgICAgICAgICB2YXIgbSA9IC9DaHJvbWVcLyhcZCspLy5leGVjKHVhKTsKICAgICAgICAgIGlmIChtKSB7CiAgICAgICAgICAgIHZhciB2ZXJzaW9uID0gcGFyc2VJbnQobVsxXSk7CiAgICAgICAgICAgIGFwaS5pc0Nocm9tZVZlcnNpb24gPSB2ZXJzaW9uOwogICAgICAgICAgICBpZiAodmVyc2lvbiA8IDMxKSB7CiAgICAgICAgICAgICAgYXBpLm5vTW91c2VFbnRlciA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KSgpOwoKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsCiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBbYWN0aXZlXQogICAgICAgICAqLwogICAgICAgIGFwaS5vcGVuVGFiID0gZnVuY3Rpb24odXJsLCBhY3RpdmUpIHsKICAgICAgICAgIGFjdGl2ZSA9IChhY3RpdmUgPT09IHVuZGVmaW5lZCkgPyB0cnVlIDogISFhY3RpdmU7CiAgICAgICAgICBpZiAodHlwZW9mIEdNX29wZW5JblRhYiAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcmV0dXJuIEdNX29wZW5JblRhYih1cmwsIHsKICAgICAgICAgICAgICBhY3RpdmU6IGFjdGl2ZSwKICAgICAgICAgICAgICBpbnNlcnQ6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IKICAgICAgICAgKi8KICAgICAgICBhcGkuZ2V0QWN0aXZlVGFiVXJsID0gZnVuY3Rpb24oY2IpIHsKICAgICAgICAgIGNiKGxvY2F0aW9uLmhyZWYpOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNiCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtkZWxheV0KICAgICAgICAgKiBAcmV0dXJucyB7bnVtYmVyfQogICAgICAgICAqLwogICAgICAgIGFwaS5zZXRUaW1lb3V0ID0gZnVuY3Rpb24oY2IsIGRlbGF5KSB7CiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChjYiwgZGVsYXkpOwogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0CiAgICAgICAgICovCiAgICAgICAgYXBpLmNsZWFyVGltZW91dCA9IGZ1bmN0aW9uKHRpbWVvdXQpIHsKICAgICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAgICAgKi8KICAgICAgICBhcGkuZ2V0VmVyc2lvbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHZlcnNpb24gPSAnR01fdW5rbm93bic7CiAgICAgICAgICBpZiAodHlwZW9mIEdNX2luZm8gIT09ICd1bmRlZmluZWQnICYmIEdNX2luZm8uc2NyaXB0ICYmIEdNX2luZm8uc2NyaXB0LnZlcnNpb24pIHsKICAgICAgICAgICAgdmVyc2lvbiA9IEdNX2luZm8uc2NyaXB0LnZlcnNpb247CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdmVyc2lvbjsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbG9jYWxlCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IKICAgICAgICAgKi8KICAgICAgICBhcGkuZ2V0TGFuZ3VhZ2UgPSBmdW5jdGlvbihsb2NhbGUsIGNiKSB7CiAgICAgICAgICB2YXIgY29udmVydCA9IGZ1bmN0aW9uKG1lc3NhZ2VzKSB7CiAgICAgICAgICAgIHZhciBsYW5ndWFnZSA9IHt9OwogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbWVzc2FnZXMpIHsKICAgICAgICAgICAgICBpZiAobWVzc2FnZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgbGFuZ3VhZ2Vba2V5XSA9IG1lc3NhZ2VzW2tleV0ubWVzc2FnZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGxhbmd1YWdlOwogICAgICAgICAgfTsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjYihudWxsLCBjb252ZXJ0KEpTT04ucGFyc2UoZGVjb2RlVVJJKF9sYW5ndWFnZUxpc3RbbG9jYWxlXSkpKSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNiKGUpOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGFwaS5nZXRMb2FkZWRMb2NhbGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgYXBpOiBhcGkKICAgICAgICB9OwogICAgICB9OwoKICAgICAgdmFyIG1vbm8gPSBicm93c2VyQXBpKF9hZGRvbikuYXBpOwogICAgICBtb25vLmlzTG9hZGVkID0gdHJ1ZTsKICAgICAgbW9uby5vblJlYWR5ID0gZnVuY3Rpb24oY2IpIHsKICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgfTsKCiAgICAgIC8vPiB1dGlscwoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBoZWFkCiAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9CiAgICAgICAqLwogICAgICBtb25vLnBhcnNlWGhySGVhZGVyID0gZnVuY3Rpb24oaGVhZCkgewogICAgICAgIGhlYWQgPSBoZWFkLnNwbGl0KC9ccj9cbi8pOwogICAgICAgIHZhciBoZWFkZXJzID0ge307CiAgICAgICAgaGVhZC5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIHZhciBzZXAgPSBsaW5lLmluZGV4T2YoJzonKTsKICAgICAgICAgIGlmIChzZXAgPT09IC0xKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBrZXkgPSBsaW5lLnN1YnN0cigwLCBzZXApLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgdmFyIHZhbHVlID0gbGluZS5zdWJzdHIoc2VwICsgMSkudHJpbSgpOwogICAgICAgICAgaGVhZGVyc1trZXldID0gdmFsdWU7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGhlYWRlcnM7CiAgICAgIH07CgogICAgICAvKioKICAgICAgICogQHR5cGVkZWYge09iamVjdHxzdHJpbmd9IHJlcXVlc3REZXRhaWxzCiAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB1cmwKICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFttZXRob2RdIEdFVHxQT1NUCiAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbdHlwZV0gR0VUfFBPU1QKICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtkYXRhXQogICAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjYWNoZV0KICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IFtoZWFkZXJzXQogICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gW2NvbnRlbnRUeXBlXQogICAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtqc29uXQogICAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFt4bWxdCiAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbdGltZW91dF0KICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFttaW1lVHlwZV0KICAgICAgICogQHByb3BlcnR5IHtib29sZWFufSBbd2l0aENyZWRlbnRpYWxzXQogICAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtsb2NhbFhIUl0KICAgICAgICovCiAgICAgIC8qKgogICAgICAgKiBAY2FsbGJhY2sgcmVxdWVzdFJlc3BvbnNlCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfG51bGx9IGVycgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfE9iamVjdHxBcnJheX0gZGF0YQogICAgICAgKi8KICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7cmVxdWVzdERldGFpbHN9IG9iagogICAgICAgKiBAcGFyYW0ge3JlcXVlc3RSZXNwb25zZX0gW29yaWdDYl0KICAgICAgICogQHJldHVybnMge3thYm9ydDogZnVuY3Rpb259fQogICAgICAgKi8KICAgICAgbW9uby5yZXF1ZXN0ID0gZnVuY3Rpb24ob2JqLCBvcmlnQ2IpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICAgIHZhciBjYiA9IGZ1bmN0aW9uKGUsIGJvZHkpIHsKICAgICAgICAgIGNiID0gbnVsbDsKICAgICAgICAgIGlmIChyZXF1ZXN0LnRpbWVvdXRUaW1lcikgewogICAgICAgICAgICBtb25vLmNsZWFyVGltZW91dChyZXF1ZXN0LnRpbWVvdXRUaW1lcik7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGVyciA9IG51bGw7CiAgICAgICAgICBpZiAoZSkgewogICAgICAgICAgICBlcnIgPSBTdHJpbmcoZS5tZXNzYWdlIHx8IGUpIHx8ICdFUlJPUic7CiAgICAgICAgICB9CiAgICAgICAgICBvcmlnQ2IgJiYgb3JpZ0NiKGVyciwgZ2V0UmVzcG9uc2UoYm9keSksIGJvZHkpOwogICAgICAgIH07CgogICAgICAgIHZhciBnZXRSZXNwb25zZSA9IGZ1bmN0aW9uKGJvZHkpIHsKICAgICAgICAgIHZhciByZXNwb25zZSA9IHt9OwoKICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c0NvZGUgPSB4aHIuc3RhdHVzOwogICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzVGV4dCA9IHhoci5zdGF0dXNUZXh0OwoKICAgICAgICAgIHZhciBoZWFkZXJzID0gbnVsbDsKICAgICAgICAgIHZhciBhbGxIZWFkZXJzID0geGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpOwogICAgICAgICAgaWYgKHR5cGVvZiBhbGxIZWFkZXJzID09PSAnc3RyaW5nJykgewogICAgICAgICAgICBoZWFkZXJzID0gbW9uby5wYXJzZVhockhlYWRlcihhbGxIZWFkZXJzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc3BvbnNlLmhlYWRlcnMgPSBoZWFkZXJzIHx8IHt9OwoKICAgICAgICAgIHJlc3BvbnNlLmJvZHkgPSBib2R5OwoKICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICB9OwoKICAgICAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgIG9iaiA9IHsKICAgICAgICAgICAgdXJsOiBvYmoKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2YXIgdXJsID0gb2JqLnVybDsKCiAgICAgICAgdmFyIG1ldGhvZCA9IG9iai5tZXRob2QgfHwgb2JqLnR5cGUgfHwgJ0dFVCc7CiAgICAgICAgbWV0aG9kID0gbWV0aG9kLnRvVXBwZXJDYXNlKCk7CgogICAgICAgIHZhciBkYXRhID0gb2JqLmRhdGE7CiAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9PSAic3RyaW5nIikgewogICAgICAgICAgZGF0YSA9IG1vbm8ucGFyYW0oZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGF0YSAmJiBtZXRob2QgPT09ICdHRVQnKSB7CiAgICAgICAgICB1cmwgKz0gKC9cPy8udGVzdCh1cmwpID8gJyYnIDogJz8nKSArIGRhdGE7CiAgICAgICAgICBkYXRhID0gdW5kZWZpbmVkOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9iai5jYWNoZSA9PT0gZmFsc2UgJiYgWydHRVQnLCAnSEVBRCddLmluZGV4T2YobWV0aG9kKSAhPT0gLTEpIHsKICAgICAgICAgIHVybCArPSAoL1w/Ly50ZXN0KHVybCkgPyAnJicgOiAnPycpICsgJ189JyArIERhdGUubm93KCk7CiAgICAgICAgfQoKICAgICAgICBvYmouaGVhZGVycyA9IG9iai5oZWFkZXJzIHx8IHt9OwoKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgb2JqLmhlYWRlcnNbIkNvbnRlbnQtVHlwZSJdID0gb2JqLmNvbnRlbnRUeXBlIHx8IG9iai5oZWFkZXJzWyJDb250ZW50LVR5cGUiXSB8fCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04JzsKICAgICAgICB9CgogICAgICAgIHZhciByZXF1ZXN0ID0ge307CiAgICAgICAgcmVxdWVzdC51cmwgPSB1cmw7CiAgICAgICAgcmVxdWVzdC5tZXRob2QgPSBtZXRob2Q7CgogICAgICAgIGRhdGEgJiYgKHJlcXVlc3QuZGF0YSA9IGRhdGEpOwogICAgICAgIG9iai5qc29uICYmIChyZXF1ZXN0Lmpzb24gPSB0cnVlKTsKICAgICAgICBvYmoueG1sICYmIChyZXF1ZXN0LnhtbCA9IHRydWUpOwogICAgICAgIG9iai50aW1lb3V0ICYmIChyZXF1ZXN0LnRpbWVvdXQgPSBvYmoudGltZW91dCk7CiAgICAgICAgb2JqLm1pbWVUeXBlICYmIChyZXF1ZXN0Lm1pbWVUeXBlID0gb2JqLm1pbWVUeXBlKTsKICAgICAgICBvYmoud2l0aENyZWRlbnRpYWxzICYmIChyZXF1ZXN0LndpdGhDcmVkZW50aWFscyA9IHRydWUpOwogICAgICAgIE9iamVjdC5rZXlzKG9iai5oZWFkZXJzKS5sZW5ndGggJiYgKHJlcXVlc3QuaGVhZGVycyA9IG9iai5oZWFkZXJzKTsKCiAgICAgICAgaWYgKHJlcXVlc3QudGltZW91dCA+IDApIHsKICAgICAgICAgIHJlcXVlc3QudGltZW91dFRpbWVyID0gbW9uby5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjYiAmJiBjYihuZXcgRXJyb3IoJ0VUSU1FRE9VVCcpKTsKICAgICAgICAgICAgeGhyLmFib3J0KCk7CiAgICAgICAgICB9LCByZXF1ZXN0LnRpbWVvdXQpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHhoclN1Y2Nlc3NTdGF0dXMgPSB7CiAgICAgICAgICAwOiAyMDAsCiAgICAgICAgICAxMjIzOiAyMDQKICAgICAgICB9OwoKICAgICAgICB2YXIgeGhyID0gbW9uby5yZXF1ZXN0LmdldFRyYW5zcG9ydChvYmoubG9jYWxYSFIpOwogICAgICAgIHhoci5vcGVuKHJlcXVlc3QubWV0aG9kLCByZXF1ZXN0LnVybCwgdHJ1ZSk7CgogICAgICAgIGlmIChtb25vLmlzTW9kdWxlICYmIHJlcXVlc3QueG1sKSB7CiAgICAgICAgICByZXF1ZXN0Lm1pbWVUeXBlID0gJ3RleHQveG1sJzsKICAgICAgICB9CiAgICAgICAgaWYgKHJlcXVlc3QubWltZVR5cGUpIHsKICAgICAgICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKHJlcXVlc3QubWltZVR5cGUpOwogICAgICAgIH0KICAgICAgICBpZiAocmVxdWVzdC53aXRoQ3JlZGVudGlhbHMpIHsKICAgICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBrZXkgaW4gcmVxdWVzdC5oZWFkZXJzKSB7CiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihrZXksIHJlcXVlc3QuaGVhZGVyc1trZXldKTsKICAgICAgICB9CgogICAgICAgIHZhciByZWFkeUNhbGxiYWNrID0geGhyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHN0YXR1cyA9IHhoclN1Y2Nlc3NTdGF0dXNbeGhyLnN0YXR1c10gfHwgeGhyLnN0YXR1czsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChzdGF0dXMgPj0gMjAwICYmIHN0YXR1cyA8IDMwMCB8fCBzdGF0dXMgPT09IDMwNCkgewogICAgICAgICAgICAgIHZhciBib2R5ID0geGhyLnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICBpZiAocmVxdWVzdC5qc29uKSB7CiAgICAgICAgICAgICAgICBib2R5ID0gSlNPTi5wYXJzZShib2R5KTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBpZiAocmVxdWVzdC54bWwpIHsKICAgICAgICAgICAgICAgIGlmIChtb25vLmlzTW9kdWxlKSB7CiAgICAgICAgICAgICAgICAgIGJvZHkgPSB4aHIucmVzcG9uc2VYTUw7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBib2R5ID0gKG5ldyBET01QYXJzZXIoKSkucGFyc2VGcm9tU3RyaW5nKGJvZHksICJ0ZXh0L3htbCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgYm9keSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Jlc3BvbnNlIGlzIG5vdCBzdHJpbmchJywgYm9keSk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3BvbnNlIGlzIG5vdCBzdHJpbmchJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBjYiAmJiBjYihudWxsLCBib2R5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoeGhyLnN0YXR1cyArICcgJyArIHhoci5zdGF0dXNUZXh0KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNiICYmIGNiKGUpOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBlcnJvckNhbGxiYWNrID0geGhyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGNiICYmIGNiKG5ldyBFcnJvcih4aHIuc3RhdHVzICsgJyAnICsgeGhyLnN0YXR1c1RleHQpKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgc3RhdGVDaGFuZ2UgPSBudWxsOwogICAgICAgIGlmICh4aHIub25hYm9ydCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB4aHIub25hYm9ydCA9IGVycm9yQ2FsbGJhY2s7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXRlQ2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkgewogICAgICAgICAgICAgIGNiICYmIG1vbm8uc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlcnJvckNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBpZiAobW9uby5pc1NhZmFyaSAmJiBtb25vLmJhZFhockhlYWRSZWRpcmVjdCAmJiByZXF1ZXN0Lm1ldGhvZCA9PT0gJ0hFQUQnKSB7CiAgICAgICAgICBzdGF0ZUNoYW5nZSA9IChmdW5jdGlvbihjYikgewogICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPiAxKSB7CiAgICAgICAgICAgICAgLy8gU2FmYXJpIDUgb24gSEVBRCAzMDIgcmVkaXJlY3QgZml4CiAgICAgICAgICAgICAgbW9uby5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgeGhyLmFib3J0KCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlYWR5Q2FsbGJhY2soKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNiICYmIGNiKCk7CiAgICAgICAgICB9KS5iaW5kKG51bGwsIHN0YXRlQ2hhbmdlKTsKICAgICAgICB9CgogICAgICAgIGlmIChtb25vLmlzT3BlcmEgJiYgbW9uby5iYWRYaHJSZWRpcmVjdCkgewogICAgICAgICAgc3RhdGVDaGFuZ2UgPSAoZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID4gMSAmJiAoeGhyLnN0YXR1cyA9PT0gMzAyIHx8IHhoci5zdGF0dXMgPT09IDApKSB7CiAgICAgICAgICAgICAgLy8gT3BlcmEgMTIgWEhSIHJlZGlyZWN0CiAgICAgICAgICAgICAgaWYgKCFvYmouX3JlZGlyZWN0Q291bnQpIHsKICAgICAgICAgICAgICAgIG9iai5fcmVkaXJlY3RDb3VudCA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHhoci5nZXRSZXNwb25zZUhlYWRlcignTG9jYXRpb24nKTsKICAgICAgICAgICAgICBpZiAobG9jYXRpb24gJiYgb2JqLl9yZWRpcmVjdENvdW50IDwgNSkgewogICAgICAgICAgICAgICAgb2JqLl9yZWRpcmVjdENvdW50Kys7CiAgICAgICAgICAgICAgICB2YXIgcmVkaXJlY3RPYmogPSBtb25vLmV4dGVuZCh7fSwgb2JqKTsKICAgICAgICAgICAgICAgIHJlZGlyZWN0T2JqLnVybCA9IGxvY2F0aW9uOwoKICAgICAgICAgICAgICAgIGNiID0gbnVsbDsKICAgICAgICAgICAgICAgIHhoci5hYm9ydCgpOwogICAgICAgICAgICAgICAgdmFyIHJlZGlyZWN0UmVxdWVzdCA9IG1vbm8ucmVxdWVzdChyZWRpcmVjdE9iaiwgb3JpZ0NiKTsKICAgICAgICAgICAgICAgIG1vbm8uZXh0ZW5kKHJlc3VsdCwgcmVkaXJlY3RSZXF1ZXN0KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjYiAmJiBjYigpOwogICAgICAgICAgfSkuYmluZChudWxsLCBzdGF0ZUNoYW5nZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RhdGVDaGFuZ2UpIHsKICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBzdGF0ZUNoYW5nZTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICB4aHIuc2VuZChyZXF1ZXN0LmRhdGEgfHwgbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgbW9uby5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjYiAmJiBjYihlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0LmFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBjYiA9IG51bGw7CiAgICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwoKICAgICAgbW9uby5yZXF1ZXN0LmdldFRyYW5zcG9ydCA9IGZ1bmN0aW9uKGxvY2FsWEhSKSB7CiAgICAgICAgaWYgKG1vbm8uaXNNb2R1bGUpIHsKICAgICAgICAgIHJldHVybiBuZXcocmVxdWlyZSgnc2RrL25ldC94aHInKS5YTUxIdHRwUmVxdWVzdCkoKTsKICAgICAgICB9CgogICAgICAgIGlmIChtb25vLmlzR00gJiYgIWxvY2FsWEhSKSB7CiAgICAgICAgICByZXR1cm4gbmV3IG1vbm8ucmVxdWVzdC5nbVRyYW5zcG9ydCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICB9OwoKICAgICAgbW9uby5yZXF1ZXN0LmdtVHJhbnNwb3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIGdtWGhyID0gbnVsbDsKCiAgICAgICAgdmFyIHN5bmMgPSBmdW5jdGlvbih0eXBlLCBnbVJlc3BvbnNlKSB7CiAgICAgICAgICBfdGhpcy5yZWFkeVN0YXRlID0gZ21SZXNwb25zZS5yZWFkeVN0YXRlOwogICAgICAgICAgX3RoaXMuc3RhdHVzID0gZ21SZXNwb25zZS5zdGF0dXM7CiAgICAgICAgICBfdGhpcy5zdGF0dXNUZXh0ID0gZ21SZXNwb25zZS5zdGF0dXNUZXh0OwogICAgICAgICAgaWYgKHR5cGVvZiBnbVJlc3BvbnNlLnJlc3BvbnNlID09PSAnc3RyaW5nJykgewogICAgICAgICAgICBfdGhpcy5yZXNwb25zZVRleHQgPSBnbVJlc3BvbnNlLnJlc3BvbnNlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGdtUmVzcG9uc2UucmVzcG9uc2VUZXh0KSB7CiAgICAgICAgICAgIF90aGlzLnJlc3BvbnNlVGV4dCA9IGdtUmVzcG9uc2UucmVzcG9uc2VUZXh0OwogICAgICAgICAgfQogICAgICAgICAgX3RoaXMuX3Jlc3BvbnNlSGVhZGVycyA9IGdtUmVzcG9uc2UucmVzcG9uc2VIZWFkZXJzOwoKICAgICAgICAgIF90aGlzLm9ucmVhZHlzdGF0ZWNoYW5nZSAmJiBfdGhpcy5vbnJlYWR5c3RhdGVjaGFuZ2UoKTsKCiAgICAgICAgICBfdGhpc1t0eXBlXSAmJiBfdGhpc1t0eXBlXSgpOwogICAgICAgIH07CgogICAgICAgIHZhciBnbURldGFpbHMgPSB7CiAgICAgICAgICBoZWFkZXJzOiB7fSwKICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnLAogICAgICAgICAgb25sb2FkOiBzeW5jLmJpbmQobnVsbCwgJ29ubG9hZCcpLAogICAgICAgICAgb25lcnJvcjogc3luYy5iaW5kKG51bGwsICdvbmVycm9yJyksCiAgICAgICAgICBvbmFib3J0OiBzeW5jLmJpbmQobnVsbCwgJ29uYWJvcnQnKSwKICAgICAgICAgIG9udGltZW91dDogc3luYy5iaW5kKG51bGwsICdvbnRpbWVvdXQnKQogICAgICAgIH07CgogICAgICAgIHRoaXMuX3Jlc3BvbnNlSGVhZGVycyA9ICcnOwogICAgICAgIHRoaXMucmVhZHlTdGF0ZSA9IDA7CiAgICAgICAgdGhpcy5zdGF0dXMgPSAwOwogICAgICAgIHRoaXMuc3RhdHVzVGV4dCA9ICcnOwogICAgICAgIHRoaXMucmVzcG9uc2VUZXh0ID0gJyc7CiAgICAgICAgdGhpcy5yZXNwb25zZSA9ICcnOwogICAgICAgIHRoaXMucmVzcG9uc2VUeXBlID0gJyc7CiAgICAgICAgdGhpcy5yZXNwb25zZVVSTCA9ICcnOwogICAgICAgIHRoaXMub3BlbiA9IGZ1bmN0aW9uKG1ldGhvZCwgdXJsKSB7CiAgICAgICAgICBnbURldGFpbHMubWV0aG9kID0gbWV0aG9kOwogICAgICAgICAgZ21EZXRhaWxzLnVybCA9IHVybDsKICAgICAgICB9OwogICAgICAgIHRoaXMub3ZlcnJpZGVNaW1lVHlwZSA9IGZ1bmN0aW9uKG1pbWVUeXBlKSB7CiAgICAgICAgICBnbURldGFpbHMub3ZlcnJpZGVNaW1lVHlwZSA9IG1pbWVUeXBlOwogICAgICAgIH07CiAgICAgICAgdGhpcy5zZXRSZXF1ZXN0SGVhZGVyID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgZ21EZXRhaWxzLmhlYWRlcnNba2V5XSA9IHZhbHVlOwogICAgICAgIH07CiAgICAgICAgdGhpcy5nZXRSZXNwb25zZUhlYWRlciA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgIGlmICghdGhpcy5fcmVzcG9uc2VIZWFkZXJzKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBpZiAoIXRoaXMuaGVhZGVycykgewogICAgICAgICAgICB0aGlzLmhlYWRlcnMgPSBtb25vLnBhcnNlWGhySGVhZGVyKHRoaXMuX3Jlc3BvbnNlSGVhZGVycyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRoaXMuaGVhZGVycy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzLmhlYWRlcnNbbmFtZV07CiAgICAgICAgfTsKICAgICAgICB0aGlzLmdldEFsbFJlc3BvbnNlSGVhZGVycyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3BvbnNlSGVhZGVyczsKICAgICAgICB9OwogICAgICAgIHRoaXMuYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGdtWGhyICYmIGdtWGhyLmFib3J0KCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLnNlbmQgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICBnbURldGFpbHMuZGF0YSA9IGRhdGE7CiAgICAgICAgICBnbVhociA9IEdNX3htbGh0dHBSZXF1ZXN0KGdtRGV0YWlscyk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLm9uYWJvcnQgPSBudWxsOwogICAgICAgIHRoaXMub25lcnJvciA9IG51bGw7CiAgICAgICAgdGhpcy5vbmxvYWQgPSBudWxsOwogICAgICAgIHRoaXMub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKICAgICAgICB0aGlzLm9udGltZW91dCA9IG51bGw7CiAgICAgIH07CgogICAgICBtb25vLmV4dGVuZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBvYmogPSBhcmd1bWVudHNbMF07CiAgICAgICAgZm9yICh2YXIgaSA9IDEsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIGl0ZW0gPSBhcmd1bWVudHNbaV07CiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gaXRlbSkgewogICAgICAgICAgICBpZiAoaXRlbVtrZXldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBvYmpba2V5XSA9IGl0ZW1ba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gb2JqOwogICAgICB9OwoKICAgICAgbW9uby5leHRlbmRQb3MgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgb2JqID0gYXJndW1lbnRzWzBdOwogICAgICAgIGZvciAodmFyIGkgPSAxLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHZhciBpdGVtID0gYXJndW1lbnRzW2ldOwogICAgICAgICAgZm9yICh2YXIga2V5IGluIGl0ZW0pIHsKICAgICAgICAgICAgaWYgKGl0ZW1ba2V5XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgZGVsZXRlIG9ialtrZXldOwogICAgICAgICAgICAgIG9ialtrZXldID0gaXRlbVtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBvYmo7CiAgICAgIH07CgogICAgICBtb25vLnBhcmFtID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgaWYgKHR5cGVvZiBvYmogPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KICAgICAgICB2YXIgaXRlbXNMaXN0ID0gW107CiAgICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgICAgaWYgKCFvYmouaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvYmpba2V5XSA9PT0gdW5kZWZpbmVkIHx8IG9ialtrZXldID09PSBudWxsKSB7CiAgICAgICAgICAgIG9ialtrZXldID0gJyc7CiAgICAgICAgICB9CiAgICAgICAgICBpdGVtc0xpc3QucHVzaChlbmNvZGVVUklDb21wb25lbnQoa2V5KSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChvYmpba2V5XSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaXRlbXNMaXN0LmpvaW4oJyYnKTsKICAgICAgfTsKCiAgICAgIG1vbm8uY2FwaXRhbGl6ZSA9IGZ1bmN0aW9uKHdvcmQpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgcmV0dXJuIHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnN1YnN0cigxKTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge3N0cmluZ3xFbGVtZW50fERvY3VtZW50RnJhZ21lbnR9IHRhZ05hbWUKICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9iagogICAgICAgKiBAcmV0dXJucyB7RWxlbWVudHxEb2N1bWVudEZyYWdtZW50fQogICAgICAgKi8KICAgICAgbW9uby5jcmVhdGUgPSBmdW5jdGlvbih0YWdOYW1lLCBvYmopIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIGVsOwogICAgICAgIHZhciBmdW5jOwogICAgICAgIGlmICh0eXBlb2YgdGFnTmFtZSAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWwgPSB0YWdOYW1lOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBhdHRyIGluIG9iaikgewogICAgICAgICAgdmFyIHZhbHVlID0gb2JqW2F0dHJdOwogICAgICAgICAgaWYgKGZ1bmMgPSBtb25vLmNyZWF0ZS5ob29rW2F0dHJdKSB7CiAgICAgICAgICAgIGZ1bmMoZWwsIHZhbHVlKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBlbFthdHRyXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZWw7CiAgICAgIH07CiAgICAgIG1vbm8uY3JlYXRlLmhvb2sgPSB7CiAgICAgICAgdGV4dDogZnVuY3Rpb24oZWwsIHZhbHVlKSB7CiAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IHZhbHVlOwogICAgICAgIH0sCiAgICAgICAgZGF0YTogZnVuY3Rpb24oZWwsIHZhbHVlKSB7CiAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICBmb3IgKHZhciBpdGVtIGluIHZhbHVlKSB7CiAgICAgICAgICAgIGVsLmRhdGFzZXRbaXRlbV0gPSB2YWx1ZVtpdGVtXTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNsYXNzOiBmdW5jdGlvbihlbCwgdmFsdWUpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdmFsdWUubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKHZhbHVlW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdjbGFzcycsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0eWxlOiBmdW5jdGlvbihlbCwgdmFsdWUpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIGZvciAodmFyIGl0ZW0gaW4gdmFsdWUpIHsKICAgICAgICAgICAgICB2YXIga2V5ID0gaXRlbTsKICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnZmxvYXQnKSB7CiAgICAgICAgICAgICAgICBrZXkgPSAnY3NzRmxvYXQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgX3ZhbHVlID0gdmFsdWVbaXRlbV07CiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoX3ZhbHVlKSkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IF92YWx1ZS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgICBlbC5zdHlsZVtrZXldID0gX3ZhbHVlW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlbC5zdHlsZVtrZXldID0gX3ZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdzdHlsZScsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFwcGVuZDogZnVuY3Rpb24oZWwsIHZhbHVlKSB7CiAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICB2YXIgbm9kZSA9IHZhbHVlW2ldOwogICAgICAgICAgICBpZiAoIW5vZGUgJiYgbm9kZSAhPT0gMCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZSAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICBub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobm9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQobm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBvbjogZnVuY3Rpb24oZWwsIGV2ZW50TGlzdCkgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgaWYgKHR5cGVvZiBldmVudExpc3RbMF0gIT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIGV2ZW50TGlzdCA9IFtldmVudExpc3RdOwogICAgICAgICAgfQogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGV2ZW50TGlzdC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICB2YXIgYXJncyA9IGV2ZW50TGlzdFtpXTsKICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGFyZ3MpKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbW9uby5vbi5hcHBseShtb25vLCBbZWxdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBvbmU6IGZ1bmN0aW9uKGVsLCBldmVudExpc3QpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIGlmICh0eXBlb2YgZXZlbnRMaXN0WzBdICE9PSAnb2JqZWN0JykgewogICAgICAgICAgICBldmVudExpc3QgPSBbZXZlbnRMaXN0XTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBldmVudExpc3QubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSBldmVudExpc3RbaV07CiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShhcmdzKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1vbm8ub25lLmFwcGx5KG1vbm8sIFtlbF0uY29uY2F0KGFyZ3MpKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uQ3JlYXRlOiBmdW5jdGlvbihlbCwgdmFsdWUpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIHZhbHVlLmNhbGwoZWwsIGVsKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBtb25vLnBhcnNlVGVtcGxhdGUgPSBmdW5jdGlvbihsaXN0LCBkZXRhaWxzKSB7CiAgICAgICAgZGV0YWlscyA9IGRldGFpbHMgfHwge307CgogICAgICAgIGlmICh0eXBlb2YgbGlzdCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIGlmIChsaXN0WzBdICE9PSAnWycpIHsKICAgICAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpc3QpOwogICAgICAgICAgfQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGlzdCA9IGxpc3QucmVwbGFjZSgvIi9nLCAnXFx1MDAyMicpLnJlcGxhY2UoL1xcJy9nLCAnXFx1MDAyNycpLnJlcGxhY2UoLycvZywgJyInKS5yZXBsYWNlKC8oW3ssXSlccyooW2EtekEtWjAtOV0rKTovZywgJyQxIiQyIjonKTsKICAgICAgICAgICAgbGlzdCA9IEpTT04ucGFyc2UobGlzdCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsaXN0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGxpc3QpKSB7CiAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGlzdCk7CiAgICAgICAgfQogICAgICAgIHZhciBmcmFnbWVudCA9IGRldGFpbHMuZnJhZ21lbnQgfHwgZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICB2YXIgaXRlbSA9IGxpc3RbaV07CiAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIGZvciAodmFyIHRhZ05hbWUgaW4gaXRlbSkgewogICAgICAgICAgICAgIHZhciBlbCA9IGl0ZW1bdGFnTmFtZV07CiAgICAgICAgICAgICAgdmFyIGFwcGVuZCA9IGVsLmFwcGVuZDsKICAgICAgICAgICAgICBkZWxldGUgZWwuYXBwZW5kOwogICAgICAgICAgICAgIHZhciBkRWw7CiAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZEVsID0gbW9uby5jcmVhdGUodGFnTmFtZSwgZWwpKTsKICAgICAgICAgICAgICBpZiAoYXBwZW5kICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIG1vbm8ucGFyc2VUZW1wbGF0ZShhcHBlbmQsIHsKICAgICAgICAgICAgICAgICAgZnJhZ21lbnQ6IGRFbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShpdGVtKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmcmFnbWVudDsKICAgICAgfTsKCiAgICAgIG1vbm8udHJpZ2dlciA9IGZ1bmN0aW9uKGVsLCB0eXBlLCBkYXRhKSB7CiAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZGF0YSA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS5idWJibGVzID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGRhdGEuYnViYmxlcyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS5jYW5jZWxhYmxlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGRhdGEuY2FuY2VsYWJsZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQodHlwZSwgZGF0YSk7CiAgICAgICAgZWwuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgIH07CgogICAgICBtb25vLnVybFBhdHRlcm5Ub1N0clJlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgaWYgKHZhbHVlID09PSAnPGFsbF91cmxzPicpIHsKICAgICAgICAgIHJldHVybiAnXmh0dHBzPzpcXC9cXC8uKyQnOwogICAgICAgIH0KCiAgICAgICAgdmFyIG0gPSB2YWx1ZS5tYXRjaCgvKFwqfGh0dHB8aHR0cHN8ZmlsZXxmdHApOlwvXC8oW15cL10rKSg/OlwvKC4qKSk/Lyk7CiAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdXJsLXBhdHRlcm4iKTsKICAgICAgICB9CgogICAgICAgIHZhciBzY2hlbWUgPSBtWzFdOwogICAgICAgIGlmIChzY2hlbWUgPT09ICcqJykgewogICAgICAgICAgc2NoZW1lID0gJ2h0dHBzPyc7CiAgICAgICAgfQoKICAgICAgICB2YXIgaG9zdCA9IG1bMl07CiAgICAgICAgaWYgKGhvc3QgPT09ICcqJykgewogICAgICAgICAgaG9zdCA9ICcuKyc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhvc3QgPSBtb25vLmVzY2FwZVJlZ2V4KGhvc3QpOwogICAgICAgICAgaG9zdCA9IGhvc3QucmVwbGFjZSgvXlxcXCpcXFwuLywgJyg/OlteXC9dK1xcLik/Jyk7CiAgICAgICAgICBob3N0ID0gaG9zdC5yZXBsYWNlKC9cXFwuXFxcKiQvZywgJ1xcLlthLXpcXC5dezIsfScpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBhdHRlcm4gPSBbJ14nLCBzY2hlbWUsICc6XFwvXFwvJywgaG9zdF07CgogICAgICAgIHZhciBwYXRoID0gbVszXTsKICAgICAgICBpZiAoIXBhdGgpIHsKICAgICAgICAgIHBhdHRlcm4ucHVzaCgnJCcpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChwYXRoID09PSAnKicpIHsKICAgICAgICAgIHBhdGggPSAnKD86fFwvLiopJzsKICAgICAgICAgIHBhdHRlcm4ucHVzaChwYXRoKTsKICAgICAgICAgIHBhdHRlcm4ucHVzaCgnJCcpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgICBwYXRoID0gJ1wvJyArIHBhdGg7CiAgICAgICAgICBwYXRoID0gbW9uby5lc2NhcGVSZWdleChwYXRoKTsKICAgICAgICAgIHBhdGggPSBwYXRoLnJlcGxhY2UoL1xcXCovZywgJy4qJyk7CiAgICAgICAgICBwYXR0ZXJuLnB1c2gocGF0aCk7CiAgICAgICAgICBwYXR0ZXJuLnB1c2goJyQnKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBwYXR0ZXJuLmpvaW4oJycpOwogICAgICB9OwoKICAgICAgbW9uby5pc0lmcmFtZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChtb25vLmlzRkYpIHsKICAgICAgICAgIHJldHVybiB3aW5kb3cucGFyZW50ICE9PSB3aW5kb3c7CiAgICAgICAgfQogICAgICAgIHJldHVybiB3aW5kb3cudG9wICE9PSB3aW5kb3cuc2VsZjsKICAgICAgfTsKCiAgICAgIG1vbm8udXNlckpzQ2hlY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgaWYgKG1vbm8uaXNHTSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFtb25vLmhhc1BhZ2VTY3JpcHQoKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICh3aW5kb3cuc2Vzc2lvblN0b3JhZ2VbJ3NhdmVmcm9tLWhlbHBlci11c2VyanMnXSA9PT0gJzEnKSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ3VzZXJqc0RldGVjdGVkJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICB9OwoKICAgICAgbW9uby5oYXNQYWdlU2NyaXB0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBtb2R1bGVMb2FkZWRMaXN0ID0gbW9uby5sb2FkTW9kdWxlLm1vZHVsZUxvYWRlZExpc3Q7CiAgICAgICAgcmV0dXJuIG1vZHVsZUxvYWRlZExpc3Quc29tZShmdW5jdGlvbihtb2R1bGVOYW1lKSB7CiAgICAgICAgICBpZiAoWydzb3ZldG5paycsICdkZWFscGx5JywgJ2F2aWFCYXInLCAnZnNTdGF0J10uaW5kZXhPZihtb2R1bGVOYW1lKSA9PT0gLTEpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBtb25vLnNldEV4dGVuc2lvblNlc3Npb24gPSBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICghbW9uby5oYXNQYWdlU2NyaXB0KCkpIHsKICAgICAgICAgICAgZGVsZXRlIHdpbmRvdy5zZXNzaW9uU3RvcmFnZVsnc2F2ZWZyb20taGVscGVyLWV4dGVuc2lvbiddOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlWydzYXZlZnJvbS1oZWxwZXItZXh0ZW5zaW9uJ10gPSAnMSc7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgfTsKCiAgICAgIG1vbm8ubG9hZE1vZHVsZSA9IChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbW9kdWxlTmFtZUxpc3QgPSBbXTsKICAgICAgICB2YXIgbW9kdWxlTGlzdCA9IFtdOwogICAgICAgIHZhciBsb2FkZWRNb2R1bGVMaXN0ID0gW107CgogICAgICAgIHZhciBtb2R1bGVMb2FkID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgdmFyIGhhc0FjdGl2ZU1vZHVsZSA9IGZhbHNlOwoKICAgICAgICAgIHZhciBpdGVtLCBhdmFpbEZuLCBpc0F2YWlsYWJsZSwgbW9kdWxlTmFtZSwgZm47CiAgICAgICAgICB3aGlsZSAoaXRlbSA9IG1vZHVsZUxpc3Quc2hpZnQoKSkgewogICAgICAgICAgICBtb2R1bGVOYW1lID0gaXRlbVswXTsKICAgICAgICAgICAgZm4gPSBpdGVtWzFdOwogICAgICAgICAgICBhdmFpbEZuID0gaXRlbVsyXTsKCiAgICAgICAgICAgIGlzQXZhaWxhYmxlID0gIWF2YWlsRm47CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgIWlzQXZhaWxhYmxlICYmIChpc0F2YWlsYWJsZSA9IGF2YWlsRm4oZGF0YSkpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgbW9uby5lcnJvcignTW9kdWxlIGF2YWlsYWJsZSBlcnJvciEnLCBlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzQXZhaWxhYmxlKSB7CiAgICAgICAgICAgICAgbG9hZGVkTW9kdWxlTGlzdC5wdXNoKG1vZHVsZU5hbWUpOwogICAgICAgICAgICAgIGhhc0FjdGl2ZU1vZHVsZSA9IHRydWU7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIG1vbm8uZGVidWcoJ3J1biBtb2R1bGUnLCBtb2R1bGVOYW1lLCBkYXRhKTsKICAgICAgICAgICAgICAgIGZuKG1vZHVsZU5hbWUsIGRhdGEpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIG1vbm8uZXJyb3IoJ01vZHVsZSBlcnJvciEnLCBlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbW9uby5kZWJ1ZygndW5hdmFpbGFibGUnLCBtb2R1bGVOYW1lLCBkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChoYXNBY3RpdmVNb2R1bGUgJiYgIW1vbm8uaXNHTSkgewogICAgICAgICAgICBtb25vLnNldEV4dGVuc2lvblNlc3Npb24oKTsKICAgICAgICAgICAgbW9uby51c2VySnNDaGVjaygpOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciByZXF1ZXN0RGF0YSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgdmFyIGxpbWl0ID0gMjA7CgogICAgICAgICAgdmFyIG9uY2VSZXNwb25zZSA9IG1vbm8ub25jZUZuKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgZ2V0RGF0YSA9IG51bGw7CgogICAgICAgICAgICBtb25vLmdsb2JhbC5sYW5ndWFnZSA9IGRhdGEuZ2V0TGFuZ3VhZ2U7CiAgICAgICAgICAgIG1vbm8uZ2xvYmFsLnByZWZlcmVuY2UgPSBkYXRhLmdldFByZWZlcmVuY2U7CgogICAgICAgICAgICByZXR1cm4gbW9kdWxlTG9hZChkYXRhKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBnZXREYXRhID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgbGltaXQtLTsKICAgICAgICAgICAgICBpZiAobGltaXQgPCAwIHx8IG1vbm8uaXNHTSkgewogICAgICAgICAgICAgICAgZ2V0RGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGdldERhdGEgJiYgZ2V0RGF0YSgpOwogICAgICAgICAgICB9LCAyNTApOwoKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZShbJ2dldFByZWZlcmVuY2UnLCAnZ2V0TGFuZ3VhZ2UnXSwgb25jZVJlc3BvbnNlKTsKICAgICAgICAgIH07CiAgICAgICAgICBnZXREYXRhKCk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGxvYWRlciA9IGZ1bmN0aW9uKG1vZHVsZU5hbWUsIGNiLCBpc0FzeW5jQXZhaWxhYmxlLCBzeW5jSXNBdmFpbGFibGUpIHsKICAgICAgICAgIGlmIChtb2R1bGVOYW1lTGlzdC5pbmRleE9mKG1vZHVsZU5hbWUpID09PSAtMSkgewogICAgICAgICAgICBtb2R1bGVOYW1lTGlzdC5wdXNoKG1vZHVsZU5hbWUpOwoKICAgICAgICAgICAgdmFyIGlzQXZhaWxhYmxlID0gIXN5bmNJc0F2YWlsYWJsZTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAhaXNBdmFpbGFibGUgJiYgKGlzQXZhaWxhYmxlID0gc3luY0lzQXZhaWxhYmxlKCkpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgbW9uby5lcnJvcignTW9kdWxlIGF2YWlsYWJsZSBlcnJvciEnLCBlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzQXZhaWxhYmxlKSB7CiAgICAgICAgICAgICAgbW9kdWxlTGlzdC5wdXNoKGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgaWYgKG1vZHVsZUxpc3QubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtb25vLmRlYnVnKCdzeW5jIHVuYXZhaWxhYmxlJywgbW9kdWxlTmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vbm8uZGVidWcoJ01vZHVsZSBleGlzdHMnLCBtb2R1bGVOYW1lKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBsb2FkZXIubW9kdWxlTG9hZGVkTGlzdCA9IGxvYWRlZE1vZHVsZUxpc3Q7CiAgICAgICAgbG9hZGVyLm1vZHVsZUxpc3QgPSBtb2R1bGVMaXN0OwoKICAgICAgICByZXR1cm4gbG9hZGVyOwogICAgICB9KSgpOwoKICAgICAgbW9uby5jb250YWlucyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBybmF0aXZlID0gL15bXntdK1x7XHMqXFtuYXRpdmUgXHcvOwogICAgICAgIGlmIChybmF0aXZlLnRlc3QoZG9jdW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24pIHx8IHJuYXRpdmUudGVzdChkb2N1bWVudC5jb250YWlucykpIHsKICAgICAgICAgIG1vbm8uY29udGFpbnMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIC8vIGZyb20gU2l6emxlCiAgICAgICAgICAgIHZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCiAgICAgICAgICAgICAgYnVwID0gYiAmJiBiLnBhcmVudE5vZGU7CiAgICAgICAgICAgIHJldHVybiBhID09PSBidXAgfHwgISEoYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCiAgICAgICAgICAgICAgYWRvd24uY29udGFpbnMgPwogICAgICAgICAgICAgIGFkb3duLmNvbnRhaW5zKGJ1cCkgOgogICAgICAgICAgICAgIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gJiYgYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihidXApICYgMTYKICAgICAgICAgICAgKSk7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtb25vLmNvbnRhaW5zID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBpZiAoYikgewogICAgICAgICAgICAgIHdoaWxlIChiID0gYi5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgICBpZiAoYiA9PT0gYSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1vbm8uY29udGFpbnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgZ2V0VHdvRWxQYXJlbnQgPSBmdW5jdGlvbihhLCBiLCBwYXJlbnRMaXN0KSB7CiAgICAgICAgICBwYXJlbnRMaXN0LnVuc2hpZnQoYik7CiAgICAgICAgICB3aGlsZSAoYiA9IGIucGFyZW50Tm9kZSkgewogICAgICAgICAgICBpZiAobW9uby5jb250YWlucyhiLCBhKSkgewogICAgICAgICAgICAgIHJldHVybiBiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhcmVudExpc3QudW5zaGlmdChiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH07CiAgICAgICAgdmFyIHdyYXBFdmVudCA9IGZ1bmN0aW9uKG9yaWdUeXBlLCBmaXhUeXBlLCBvcmlnRXZlbnQsIGNhcHR1cmUpIHsKICAgICAgICAgIHJldHVybiAhY2FwdHVyZSA/IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciByZWxhdGVkID0gZXZlbnQucmVsYXRlZFRhcmdldDsKICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXM7CiAgICAgICAgICAgIGlmICghcmVsYXRlZCB8fCAocmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFtb25vLmNvbnRhaW5zKHRhcmdldCwgcmVsYXRlZCkpKSB7CiAgICAgICAgICAgICAgb3JpZ0V2ZW50LmNhbGwodGhpcywgewogICAgICAgICAgICAgICAgdHlwZTogb3JpZ1R5cGUsCiAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldCwKICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0OiBldmVudC5wcmV2ZW50RGVmYXVsdCwKICAgICAgICAgICAgICAgIHN0b3BQcm9wYWdhdGlvbjogZXZlbnQuc3RvcFByb3BhZ2F0aW9uCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICB2YXIgcmVsYXRlZCA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQ7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7CiAgICAgICAgICAgIHZhciBwYXJlbnRMaXN0ID0gW107CiAgICAgICAgICAgIGlmICghcmVsYXRlZCB8fCBtb25vLmNvbnRhaW5zKHJlbGF0ZWQsIHRhcmdldCkgfHwgKHJlbGF0ZWQgPSBnZXRUd29FbFBhcmVudChyZWxhdGVkLCB0YXJnZXQsIHBhcmVudExpc3QpKSkgewogICAgICAgICAgICAgIGlmIChwYXJlbnRMaXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgd2hpbGUgKHRhcmdldCAhPT0gcmVsYXRlZCkgewogICAgICAgICAgICAgICAgICBwYXJlbnRMaXN0LnVuc2hpZnQodGFyZ2V0KTsKICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHdoaWxlICh0YXJnZXQgPSBwYXJlbnRMaXN0LnNoaWZ0KCkpIHsKICAgICAgICAgICAgICAgIG9yaWdFdmVudC5jYWxsKHRoaXMsIHsKICAgICAgICAgICAgICAgICAgdHlwZTogb3JpZ1R5cGUsCiAgICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LAogICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdDogZXZlbnQucHJldmVudERlZmF1bHQsCiAgICAgICAgICAgICAgICAgIHN0b3BQcm9wYWdhdGlvbjogZXZlbnQuc3RvcFByb3BhZ2F0aW9uCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGZ1bmN0aW9uTWFwID0gewogICAgICAgICAga2V5OiAnZml4RXZlbnQtJywKICAgICAgICAgIGV2ZW50SWQ6IDAsCiAgICAgICAgICByZXBsYWNlTGlzdDoge30sCiAgICAgICAgICBiaW5kQ291bnQ6IHt9CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHtOb2RlfSBlbAogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25FdmVudAogICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2NhcHR1cmVdCiAgICAgICAgICovCiAgICAgICAgbW9uby5vbiA9IGZ1bmN0aW9uKGVsLCB0eXBlLCBvbkV2ZW50LCBjYXB0dXJlKSB7CiAgICAgICAgICBpZiAobW9uby5ub01vdXNlRW50ZXIgJiYgWydtb3VzZWVudGVyJywgJ21vdXNlbGVhdmUnXS5pbmRleE9mKHR5cGUpICE9PSAtMSkgewogICAgICAgICAgICB2YXIgY2FjaGVFdmVudEtleSA9IGZ1bmN0aW9uTWFwLmtleTsKICAgICAgICAgICAgdmFyIG9yaWdFdmVudCA9IG9uRXZlbnQ7CiAgICAgICAgICAgIHZhciBvcmlnVHlwZSA9IHR5cGU7CiAgICAgICAgICAgIHZhciBvcmlnQ2FwdHVyZSA9IGNhcHR1cmU7CgogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ21vdXNlZW50ZXInKSB7CiAgICAgICAgICAgICAgdHlwZSA9ICdtb3VzZW92ZXInOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdtb3VzZWxlYXZlJykgewogICAgICAgICAgICAgIHR5cGUgPSAnbW91c2VvdXQnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhY2hlRXZlbnRLZXkgKz0gdHlwZTsKICAgICAgICAgICAgaWYgKGNhcHR1cmUpIHsKICAgICAgICAgICAgICBjYWNoZUV2ZW50S2V5ICs9ICctMSc7CiAgICAgICAgICAgICAgY2FwdHVyZSA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZXZlbnRJZCA9IG9yaWdFdmVudFtjYWNoZUV2ZW50S2V5XTsKICAgICAgICAgICAgaWYgKGV2ZW50SWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGV2ZW50SWQgPSBmdW5jdGlvbk1hcC5ldmVudElkKys7CiAgICAgICAgICAgICAgb3JpZ0V2ZW50W2NhY2hlRXZlbnRLZXldID0gZXZlbnRJZDsKCiAgICAgICAgICAgICAgb25FdmVudCA9IHdyYXBFdmVudChvcmlnVHlwZSwgdHlwZSwgb3JpZ0V2ZW50LCBvcmlnQ2FwdHVyZSk7CgogICAgICAgICAgICAgIGZ1bmN0aW9uTWFwLnJlcGxhY2VMaXN0W2V2ZW50SWRdID0gb25FdmVudDsKCiAgICAgICAgICAgICAgaWYgKGZ1bmN0aW9uTWFwLmJpbmRDb3VudFtldmVudElkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbk1hcC5iaW5kQ291bnRbZXZlbnRJZF0gPSAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBvbkV2ZW50ID0gZnVuY3Rpb25NYXAucmVwbGFjZUxpc3RbZXZlbnRJZF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uTWFwLmJpbmRDb3VudFtldmVudElkXSsrOwogICAgICAgICAgfQoKICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgb25FdmVudCwgY2FwdHVyZSk7CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHtOb2RlfSBlbAogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25FdmVudAogICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2NhcHR1cmVdCiAgICAgICAgICovCiAgICAgICAgbW9uby5vZmYgPSBmdW5jdGlvbihlbCwgdHlwZSwgb25FdmVudCwgY2FwdHVyZSkgewogICAgICAgICAgaWYgKG1vbm8ubm9Nb3VzZUVudGVyICYmIFsnbW91c2VlbnRlcicsICdtb3VzZWxlYXZlJ10uaW5kZXhPZih0eXBlKSAhPT0gLTEpIHsKICAgICAgICAgICAgdmFyIGNhY2hlRXZlbnRLZXkgPSBmdW5jdGlvbk1hcC5rZXk7CiAgICAgICAgICAgIGlmICh0eXBlID09PSAnbW91c2VlbnRlcicpIHsKICAgICAgICAgICAgICB0eXBlID0gJ21vdXNlb3Zlcic7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ21vdXNlbGVhdmUnKSB7CiAgICAgICAgICAgICAgdHlwZSA9ICdtb3VzZW91dCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FjaGVFdmVudEtleSArPSB0eXBlOwogICAgICAgICAgICBpZiAoY2FwdHVyZSkgewogICAgICAgICAgICAgIGNhY2hlRXZlbnRLZXkgKz0gJy0xJzsKICAgICAgICAgICAgICBjYXB0dXJlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBldmVudElkID0gb25FdmVudFtjYWNoZUV2ZW50S2V5XTsKICAgICAgICAgICAgaWYgKGV2ZW50SWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHZhciBvcmlnRXZlbnQgPSBvbkV2ZW50OwogICAgICAgICAgICAgIG9uRXZlbnQgPSBmdW5jdGlvbk1hcC5yZXBsYWNlTGlzdFtldmVudElkXTsKICAgICAgICAgICAgICBmdW5jdGlvbk1hcC5iaW5kQ291bnRbZXZlbnRJZF0tLTsKCiAgICAgICAgICAgICAgaWYgKGZ1bmN0aW9uTWFwLmJpbmRDb3VudFtldmVudElkXSA9PT0gMCkgewogICAgICAgICAgICAgICAgZGVsZXRlIG9yaWdFdmVudFtjYWNoZUV2ZW50S2V5XTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBmdW5jdGlvbk1hcC5yZXBsYWNlTGlzdFtldmVudElkXTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBmdW5jdGlvbk1hcC5iaW5kQ291bnRbZXZlbnRJZF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBvbkV2ZW50LCBjYXB0dXJlKTsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0ge05vZGV9IGVsCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkV2ZW50CiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbY2FwdHVyZV0KICAgICAgICAgKi8KICAgICAgICBtb25vLm9uZSA9IGZ1bmN0aW9uKGVsLCB0eXBlLCBvbkV2ZW50LCBjYXB0dXJlKSB7CiAgICAgICAgICB2YXIgZm5OYW1lID0gWydvbmVGbicsIHR5cGUsICEhY2FwdHVyZV0uam9pbignXycpOwogICAgICAgICAgdmFyIGZuID0gb25FdmVudFtmbk5hbWVdOwogICAgICAgICAgaWYgKCFmbikgewogICAgICAgICAgICBvbkV2ZW50W2ZuTmFtZV0gPSBmbiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBtb25vLm9mZih0aGlzLCB0eXBlLCBmbiwgY2FwdHVyZSk7CiAgICAgICAgICAgICAgb25FdmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtb25vLm9uKGVsLCB0eXBlLCBmbiwgY2FwdHVyZSk7CiAgICAgICAgICBmbk5hbWUgPSBudWxsOwogICAgICAgICAgZWwgPSBudWxsOwogICAgICAgIH07CiAgICAgIH0oKSk7CgogICAgICBtb25vLmdsb2JhbCA9IHt9OwoKICAgICAgbW9uby5pbml0R2xvYmFsID0gZnVuY3Rpb24oY2IpIHsKICAgICAgICBpZiAoIW1vbm8uaXNHTSAmJiBtb25vLmdsb2JhbC5sYW5ndWFnZSAmJiBtb25vLmdsb2JhbC5wcmVmZXJlbmNlKSB7CiAgICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgICBnZXRMYW5ndWFnZTogbW9uby5nbG9iYWwubGFuZ3VhZ2UsCiAgICAgICAgICAgIGdldFByZWZlcmVuY2U6IG1vbm8uZ2xvYmFsLnByZWZlcmVuY2UKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBtb25vLnNlbmRNZXNzYWdlKFsnZ2V0TGFuZ3VhZ2UnLCAnZ2V0UHJlZmVyZW5jZSddLCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgbW9uby5nbG9iYWwubGFuZ3VhZ2UgPSByZXNwb25zZS5nZXRMYW5ndWFnZTsKICAgICAgICAgIG1vbm8uZ2xvYmFsLnByZWZlcmVuY2UgPSByZXNwb25zZS5nZXRQcmVmZXJlbmNlOwogICAgICAgICAgY2IocmVzcG9uc2UpOwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgbW9uby5nZXRQYXJlbnRCeUNsYXNzID0gZnVuY3Rpb24oZWwsIGNsYXNzTGlzdCkgewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShjbGFzc0xpc3QpKSB7CiAgICAgICAgICBjbGFzc0xpc3QgPSBbY2xhc3NMaXN0XTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIHBhcmVudCA9IGVsOyBwYXJlbnQ7IHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlKSB7CiAgICAgICAgICBpZiAocGFyZW50Lm5vZGVUeXBlICE9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGNsYXNzTmFtZTsgY2xhc3NOYW1lID0gY2xhc3NMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBhcmVudC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKSkgewogICAgICAgICAgICAgIHJldHVybiBwYXJlbnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9OwoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwKICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtkZXRhaWxzXQogICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtkZXRhaWxzLnBhcmFtc10gSW5wdXQgcGFyYW1zIG9ubHkgW2ZhbHNlXQogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2RldGFpbHMuc2VwXSBTZXBhcmF0b3IgWyZdCiAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2RldGFpbHMubm9EZWNvZGVdIERpc2FibGUgZGVjb2RlIGtleXMgW2ZhbHNlXQogICAgICAgKiBAcmV0dXJucyB7e319CiAgICAgICAqLwogICAgICBtb25vLnBhcnNlVXJsID0gZnVuY3Rpb24odXJsLCBkZXRhaWxzKSB7CiAgICAgICAgZGV0YWlscyA9IGRldGFpbHMgfHwge307CiAgICAgICAgdmFyIHF1ZXJ5ID0gbnVsbDsKICAgICAgICBpZiAoIWRldGFpbHMucGFyYW1zICYmIC9cPy8udGVzdCh1cmwpKSB7CiAgICAgICAgICBxdWVyeSA9IHVybC5tYXRjaCgvW15cP10rXD8oLispLylbMV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHF1ZXJ5ID0gdXJsOwogICAgICAgIH0KICAgICAgICB2YXIgc2VwYXJhdG9yID0gZGV0YWlscy5zZXAgfHwgJyYnOwogICAgICAgIHZhciBkYmxQYXJhbUxpc3QgPSBxdWVyeS5zcGxpdChzZXBhcmF0b3IpOwogICAgICAgIHZhciBwYXJhbXMgPSB7fTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZGJsUGFyYW1MaXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICB2YXIgaXRlbSA9IGRibFBhcmFtTGlzdFtpXTsKICAgICAgICAgIHZhciBrZXlWYWx1ZSA9IGl0ZW0uc3BsaXQoJz0nKTsKICAgICAgICAgIHZhciBrZXkgPSBrZXlWYWx1ZVswXTsKICAgICAgICAgIHZhciB2YWx1ZSA9IGtleVZhbHVlWzFdIHx8ICcnOwogICAgICAgICAgaWYgKCFkZXRhaWxzLm5vRGVjb2RlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAga2V5ID0gZGVjb2RlVVJJQ29tcG9uZW50KGtleSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIGtleSA9IHVuZXNjYXBlKGtleSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBwYXJhbXNba2V5XSA9IGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIHBhcmFtc1trZXldID0gdW5lc2NhcGUodmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwYXJhbXNba2V5XSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcGFyYW1zOwogICAgICB9OwoKICAgICAgbW9uby50aHJvdHRsZSA9IGZ1bmN0aW9uKGZuLCB0aHJlc2hob2xkLCBzY29wZSkgewogICAgICAgIHRocmVzaGhvbGQgPSB0aHJlc2hob2xkIHx8IDI1MDsKICAgICAgICB2YXIgbGFzdDsKICAgICAgICB2YXIgZGVmZXJUaW1lcjsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgY29udGV4dCA9IHNjb3BlIHx8IHRoaXM7CgogICAgICAgICAgdmFyIG5vdyA9IERhdGUubm93KCk7CiAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgIGlmIChsYXN0ICYmIG5vdyA8IGxhc3QgKyB0aHJlc2hob2xkKSB7CiAgICAgICAgICAgIC8vIGhvbGQgb24gdG8gaXQKICAgICAgICAgICAgbW9uby5jbGVhclRpbWVvdXQoZGVmZXJUaW1lcik7CiAgICAgICAgICAgIGRlZmVyVGltZXIgPSBtb25vLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgbGFzdCA9IG5vdzsKICAgICAgICAgICAgICBmbi5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgfSwgdGhyZXNoaG9sZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsYXN0ID0gbm93OwogICAgICAgICAgICBmbi5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9OwoKICAgICAgbW9uby5kZWJvdW5jZSA9IGZ1bmN0aW9uKGZuLCBkZWxheSkgewogICAgICAgIHZhciB0aW1lciA9IG51bGw7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLAogICAgICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgbW9uby5jbGVhclRpbWVvdXQodGltZXIpOwogICAgICAgICAgdGltZXIgPSBtb25vLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZuLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgfSwgZGVsYXkpOwogICAgICAgIH07CiAgICAgIH07CgogICAgICBtb25vLmdldERvbWFpbiA9IGZ1bmN0aW9uKHVybCwgc3RyaXApIHsKICAgICAgICBpZiAodHlwZW9mIHVybCAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIG0gPSB1cmwubWF0Y2goLzpcL1wvKD86W15cLz8jXSpAKT8oW146XC8/I10rKS8pOwogICAgICAgIG0gPSBtICYmIG1bMV07CiAgICAgICAgaWYgKG0pIHsKICAgICAgICAgIGlmIChzdHJpcCkgewogICAgICAgICAgICBtID0gbS5yZXBsYWNlKC9ed3d3XC4vLCAnJyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbTsKICAgICAgICB9CiAgICAgIH07CgogICAgICAvLyBsZWdhY3kKCiAgICAgIG1vbm8uZ2V0UXVlcnlTdHJpbmcgPSBmdW5jdGlvbihxdWVyeSwga2V5X3ByZWZpeCwga2V5X3N1ZmZpeCkgewogICAgICAgIGlmICghcXVlcnkgfHwgdHlwZW9mKHF1ZXJ5KSAhPSAnb2JqZWN0JykKICAgICAgICAgIHJldHVybiAnJzsKCiAgICAgICAgaWYgKGtleV9wcmVmaXggPT09IHVuZGVmaW5lZCkKICAgICAgICAgIGtleV9wcmVmaXggPSAnJzsKCiAgICAgICAgaWYgKGtleV9zdWZmaXggPT09IHVuZGVmaW5lZCkKICAgICAgICAgIGtleV9zdWZmaXggPSAnJzsKCiAgICAgICAgdmFyIHN0ciA9ICcnOwogICAgICAgIGZvciAodmFyIGtleSBpbiBxdWVyeSkgewogICAgICAgICAgaWYgKHN0ci5sZW5ndGgpCiAgICAgICAgICAgIHN0ciArPSAnJic7CgogICAgICAgICAgaWYgKHF1ZXJ5W2tleV0gaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgICAgaWYgKCFrZXlfcHJlZml4KQogICAgICAgICAgICAgIGtleV9wcmVmaXggPSAnJzsKCiAgICAgICAgICAgIGlmICgha2V5X3N1ZmZpeCkKICAgICAgICAgICAgICBrZXlfc3VmZml4ID0gJyc7CgogICAgICAgICAgICBzdHIgKz0gbW9uby5nZXRRdWVyeVN0cmluZyhxdWVyeVtrZXldLCBrZXlfcHJlZml4ICsga2V5ICsgIlsiLCAiXSIgKyBrZXlfc3VmZml4KTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBzdHIgKz0ga2V5X3ByZWZpeCArIGVzY2FwZShrZXkpICsga2V5X3N1ZmZpeCArICc9JyArIGVzY2FwZShxdWVyeVtrZXldKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdHI7CiAgICAgIH07CgogICAgICAvKioKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQKICAgICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAgICovCiAgICAgIG1vbm8uZGVjb2RlVW5pY29kZUVzY2FwZVNlcXVlbmNlID0gZnVuY3Rpb24odGV4dCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0ZXh0KQogICAgICAgICAgICAucmVwbGFjZShtb25vLmRlY29kZVVuaWNvZGVFc2NhcGVTZXF1ZW5jZS5yZSwgJyQxJykpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJldHVybiB0ZXh0OwogICAgICAgIH0KICAgICAgfTsKICAgICAgbW9uby5kZWNvZGVVbmljb2RlRXNjYXBlU2VxdWVuY2UucmUgPSAvXFwoXFx1WzAtOWEtZl17NH0pL2c7CgogICAgICBtb25vLmZpbGVOYW1lID0gewogICAgICAgIG1heExlbmd0aDogODAsCgogICAgICAgIHJ0cmltOiAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2csCgogICAgICAgIGlsbGVnYWxSZTogL1tcL1w/PD5cXDpcKlx8Il0vZywKCiAgICAgICAgY29udHJvbFJlOiAvW1x4MDAtXHgxZlx4ODAtXHg5Zl0vZywKCiAgICAgICAgcmVzZXJ2ZWRSZTogL15cLisvLAoKICAgICAgICB0cmltOiBmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKHRoaXMucnRyaW0sICcnKTsKICAgICAgICB9LAoKICAgICAgICBwYXJ0c1JlOiAvXiguKylcLihbYS16MC05XXsxLDR9KSQvaSwKCiAgICAgICAgZ2V0UGFydHM6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgIHJldHVybiBuYW1lLm1hdGNoKHRoaXMucGFydHNSZSk7CiAgICAgICAgfSwKCiAgICAgICAgc3BlY2lhbENoYXJzOiAoJ25ic3AsaWV4Y2wsY2VudCxwb3VuZCxjdXJyZW4seWVuLGJydmJhcixzZWN0LHVtbCxjb3B5LG9yZGYsbGFxdW8sbm90LHNoeSxyZWcsbWFjcixkZWcscGx1c21uLHN1cDInICsKICAgICAgICAgICcsc3VwMyxhY3V0ZSxtaWNybyxwYXJhLG1pZGRvdCxjZWRpbCxzdXAxLG9yZG0scmFxdW8sZnJhYzE0LGZyYWMxMixmcmFjMzQsaXF1ZXN0LEFncmF2ZSxBYWN1dGUsQWNpcmMsQXRpbGRlLEF1bWwnICsKICAgICAgICAgICcsQXJpbmcsQUVsaWcsQ2NlZGlsLEVncmF2ZSxFYWN1dGUsRWNpcmMsRXVtbCxJZ3JhdmUsSWFjdXRlLEljaXJjLEl1bWwsRVRILE50aWxkZSxPZ3JhdmUsT2FjdXRlLE9jaXJjLE90aWxkZSxPdW1sJyArCiAgICAgICAgICAnLHRpbWVzLE9zbGFzaCxVZ3JhdmUsVWFjdXRlLFVjaXJjLFV1bWwsWWFjdXRlLFRIT1JOLHN6bGlnLGFncmF2ZSxhYWN1dGUsYWNpcmMsYXRpbGRlLGF1bWwsYXJpbmcsYWVsaWcsY2NlZGlsJyArCiAgICAgICAgICAnLGVncmF2ZSxlYWN1dGUsZWNpcmMsZXVtbCxpZ3JhdmUsaWFjdXRlLGljaXJjLGl1bWwsZXRoLG50aWxkZSxvZ3JhdmUsb2FjdXRlLG9jaXJjLG90aWxkZSxvdW1sLGRpdmlkZSxvc2xhc2gnICsKICAgICAgICAgICcsdWdyYXZlLHVhY3V0ZSx1Y2lyYyx1dW1sLHlhY3V0ZSx0aG9ybix5dW1sJykuc3BsaXQoJywnKSwKICAgICAgICBzcGVjaWFsQ2hhcnNMaXN0OiBbCiAgICAgICAgICBbJ2FtcCcsICdxdW90JywgJ2x0JywgJ2d0J10sCiAgICAgICAgICBbMzgsIDM0LCA2MCwgNjJdCiAgICAgICAgXSwKCiAgICAgICAgc3BlY2lhbENoYXJzUmU6IC8mKFteO117Miw2fSk7L2csCgogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0CiAgICAgICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAgICAgKi8KICAgICAgICBkZWNvZGVTcGVjaWFsQ2hhcnM6IGZ1bmN0aW9uKHRleHQpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKHRoaXMuc3BlY2lhbENoYXJzUmUsIGZ1bmN0aW9uKHRleHQsIHdvcmQpIHsKICAgICAgICAgICAgdmFyIGNvZGUgPSBudWxsOwogICAgICAgICAgICBpZiAod29yZFswXSA9PT0gJyMnKSB7CiAgICAgICAgICAgICAgY29kZSA9IHBhcnNlSW50KHdvcmQuc3Vic3RyKDEpKTsKICAgICAgICAgICAgICBpZiAoaXNOYU4oY29kZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwb3MgPSBfdGhpcy5zcGVjaWFsQ2hhcnNMaXN0WzBdLmluZGV4T2Yod29yZCk7CiAgICAgICAgICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgICAgICAgICAgY29kZSA9IF90aGlzLnNwZWNpYWxDaGFyc0xpc3RbMV1bcG9zXTsKICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcG9zID0gX3RoaXMuc3BlY2lhbENoYXJzLmluZGV4T2Yod29yZCk7CiAgICAgICAgICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgICAgICAgICAgY29kZSA9IHBvcyArIDE2MDsKICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgcm5SZTogL1xyP1xuL2csCgogICAgICAgIHJlMTogL1tcKlw/Il0vZywKCiAgICAgICAgcmUyOiAvPC9nLAoKICAgICAgICByZTM6IC8+L2csCgogICAgICAgIHNwYWNlUmU6IC9bXHNcdFx1RkVGRlx4QTBdKy9nLAoKICAgICAgICBkYmxSZTogLyhcLnwhfFw/fF98LHxcLXw6fFwrKXsyLH0vZywKCiAgICAgICAgcmU0OiAvW1wuLDo7XC9cLV9cKz0nXSQvZywKCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUKICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAgICAgICAqLwogICAgICAgIG1vZGlmeTogZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgaWYgKCFuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgIH0KCiAgICAgICAgICBuYW1lID0gbW9uby5kZWNvZGVVbmljb2RlRXNjYXBlU2VxdWVuY2UobmFtZSk7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbmFtZSA9IGRlY29kZVVSSUNvbXBvbmVudChuYW1lKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBuYW1lID0gdW5lc2NhcGUobmFtZSk7CiAgICAgICAgICB9CgogICAgICAgICAgbmFtZSA9IHRoaXMuZGVjb2RlU3BlY2lhbENoYXJzKG5hbWUpOwoKICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UodGhpcy5yblJlLCAnICcpOwoKICAgICAgICAgIG5hbWUgPSB0aGlzLnRyaW0obmFtZSk7CgogICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZSh0aGlzLnJlMSwgJycpCiAgICAgICAgICAgIC5yZXBsYWNlKHRoaXMucmUyLCAnKCcpCiAgICAgICAgICAgIC5yZXBsYWNlKHRoaXMucmUzLCAnKScpCiAgICAgICAgICAgIC5yZXBsYWNlKHRoaXMuc3BhY2VSZSwgJyAnKQogICAgICAgICAgICAucmVwbGFjZSh0aGlzLmRibFJlLCAnJDEnKQogICAgICAgICAgICAucmVwbGFjZSh0aGlzLmlsbGVnYWxSZSwgJ18nKQogICAgICAgICAgICAucmVwbGFjZSh0aGlzLmNvbnRyb2xSZSwgJycpCiAgICAgICAgICAgIC5yZXBsYWNlKHRoaXMucmVzZXJ2ZWRSZSwgJycpCiAgICAgICAgICAgIC5yZXBsYWNlKHRoaXMucmU0LCAnJyk7CgogICAgICAgICAgaWYgKG5hbWUubGVuZ3RoIDw9IHRoaXMubWF4TGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiBuYW1lOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwYXJ0cyA9IHRoaXMuZ2V0UGFydHMobmFtZSk7CiAgICAgICAgICBpZiAocGFydHMgJiYgcGFydHMubGVuZ3RoID09IDMpIHsKICAgICAgICAgICAgcGFydHNbMV0gPSBwYXJ0c1sxXS5zdWJzdHIoMCwgdGhpcy5tYXhMZW5ndGgpOwogICAgICAgICAgICByZXR1cm4gcGFydHNbMV0gKyAnLicgKyBwYXJ0c1syXTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge251bWJlcn0gbWluCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtYXgKICAgICAgICogQHJldHVybnMge251bWJlcn0KICAgICAgICovCiAgICAgIG1vbm8uZ2V0UmFuZG9tSW50ID0gZnVuY3Rpb24obWluLCBtYXgpIHsKICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikpICsgbWluOwogICAgICB9OwogICAgICAvKioKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGFOYW1lCiAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgICAqLwogICAgICBtb25vLmRhdGFBdHRyMlNlbGVjdG9yID0gZnVuY3Rpb24oZGF0YU5hbWUpIHsKICAgICAgICByZXR1cm4gJ2RhdGEtJyArIGRhdGFOYW1lLnJlcGxhY2UoL1tBLVpdL2csIGZ1bmN0aW9uKGxpdCkgewogICAgICAgICAgcmV0dXJuICctJyArIGxpdC50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0pOwogICAgICB9OwogICAgICAvKioKICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9iagogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAgICovCiAgICAgIG1vbm8uaXNFbXB0eU9iamVjdCA9IGZ1bmN0aW9uKG9iaikgewogICAgICAgIGZvciAodmFyIGl0ZW0gaW4gb2JqKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9OwoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNiCiAgICAgICAqLwogICAgICBtb25vLmFzeW5jQ2FsbCA9IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIG1vbm8uc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIGNiKCk7CiAgICAgICAgfSwgMCk7CiAgICAgIH07CgogICAgICAvKioKICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IKICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtzY29wZV0KICAgICAgICogQHJldHVybnMge0Z1bmN0aW9ufQogICAgICAgKi8KICAgICAgbW9uby5hc3luY0ZuID0gZnVuY3Rpb24oY2IsIHNjb3BlKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGNvbnRleHQgPSBzY29wZSB8fCB0aGlzOwogICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICBtb25vLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNiLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgfSwgMCk7CiAgICAgICAgfTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gW3Njb3BlXQogICAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259CiAgICAgICAqLwogICAgICBtb25vLm9uY2VGbiA9IGZ1bmN0aW9uKGNiLCBzY29wZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChjYikgewogICAgICAgICAgICB2YXIgY29udGV4dCA9IHNjb3BlIHx8IHRoaXM7CiAgICAgICAgICAgIGNiLmFwcGx5KGNvbnRleHQsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIGNiID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9OwoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbdGltZW91dF0KICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gYWx3YXlzQ2IKICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtzY29wZV0KICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uVGltZW91dF0KICAgICAgICovCiAgICAgIG1vbm8uc2FmZUZuID0gZnVuY3Rpb24oZm4sIHRpbWVvdXQsIGFsd2F5c0NiLCBzY29wZSwgb25UaW1lb3V0KSB7CiAgICAgICAgaWYgKHR5cGVvZiB0aW1lb3V0ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBvblRpbWVvdXQgPSBzY29wZTsKICAgICAgICAgIHNjb3BlID0gYWx3YXlzQ2I7CiAgICAgICAgICBhbHdheXNDYiA9IHRpbWVvdXQ7CiAgICAgICAgICB0aW1lb3V0ID0gMzAwMDsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBzY29wZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgb25UaW1lb3V0ID0gc2NvcGU7CiAgICAgICAgICBzY29wZSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciB0aW1lb3V0SWQgPSBudWxsOwogICAgICAgIHZhciBvbmNlQ2IgPSBtb25vLm9uY2VGbihmdW5jdGlvbigpIHsKICAgICAgICAgIG1vbm8uY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7CiAgICAgICAgICBhbHdheXNDYi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgY29udGV4dCA9IHNjb3BlIHx8IHRoaXM7CiAgICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKCiAgICAgICAgICB2YXIgcG9zID0gYXJncy5pbmRleE9mKGFsd2F5c0NiKTsKICAgICAgICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgICAgICAgIGFyZ3Muc3BsaWNlKHBvcywgMSwgb25jZUNiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBtb25vLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRpbWVvdXRJZCA9IG1vbm8uc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBvbmNlQ2IoKTsKICAgICAgICAgICAgICBvblRpbWVvdXQgJiYgb25UaW1lb3V0KCk7CiAgICAgICAgICAgIH0sIHRpbWVvdXQpOwogICAgICAgICAgICBmbi5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgIH0sIDApOwogICAgICAgIH07CiAgICAgIH07CgogICAgICAvKioKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGh0bWwKICAgICAgICogQHBhcmFtIHtSZWdFeHB8UmVnRXhwW119IG1hdGNoCiAgICAgICAqIEByZXR1cm5zIHtzdHJpbmdbXX0KICAgICAgICovCiAgICAgIG1vbm8uZ2V0UGFnZVNjcmlwdCA9IGZ1bmN0aW9uKGh0bWwsIG1hdGNoKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIGlmIChtYXRjaCAmJiAhQXJyYXkuaXNBcnJheShtYXRjaCkpIHsKICAgICAgICAgIG1hdGNoID0gW21hdGNoXTsKICAgICAgICB9CiAgICAgICAgdmFyIHNjcmlwdExpc3QgPSBbXTsKICAgICAgICBodG1sLnJlcGxhY2UoLzxzY3JpcHQoPzp8XHNbXj5dK1teXC9dKT4vZywgZnVuY3Rpb24odGV4dCwgb2Zmc2V0KSB7CiAgICAgICAgICBvZmZzZXQgKz0gdGV4dC5sZW5ndGg7CiAgICAgICAgICB2YXIgZW5kUG9zID0gaHRtbC5pbmRleE9mKCc8XC9zY3JpcHQ+Jywgb2Zmc2V0KTsKICAgICAgICAgIGlmIChlbmRQb3MgIT09IC0xKSB7CiAgICAgICAgICAgIHZhciBjb250ZW50ID0gaHRtbC5zdWJzdHIob2Zmc2V0LCBlbmRQb3MgLSBvZmZzZXQpOwogICAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgICBtYXRjaC5ldmVyeShmdW5jdGlvbihyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gci50ZXN0KGNvbnRlbnQpOwogICAgICAgICAgICAgIH0pICYmIHNjcmlwdExpc3QucHVzaChjb250ZW50KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzY3JpcHRMaXN0LnB1c2goY29udGVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gc2NyaXB0TGlzdDsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gaHRtbAogICAgICAgKiBAcGFyYW0ge1JlZ0V4cHxSZWdFeHBbXX0gbWF0Y2gKICAgICAgICogQHJldHVybnMge09iamVjdFtdfQogICAgICAgKi8KICAgICAgbW9uby5maW5kSnNvbiA9IGZ1bmN0aW9uKGh0bWwsIG1hdGNoKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIGlmIChtYXRjaCAmJiAhQXJyYXkuaXNBcnJheShtYXRjaCkpIHsKICAgICAgICAgIG1hdGNoID0gW21hdGNoXTsKICAgICAgICB9CiAgICAgICAgdmFyIHJhd0pzb24gPSBbXTsKICAgICAgICB2YXIgb2JqID0gewogICAgICAgICAgJ3snOiAwLAogICAgICAgICAgJ1snOiAwCiAgICAgICAgfTsKICAgICAgICB2YXIgbWFwID0gewogICAgICAgICAgJ30nOiAneycsCiAgICAgICAgICAnXSc6ICdbJwogICAgICAgIH07CiAgICAgICAgdmFyIGpzb25TeW1ib2xzID0gL1t7fVxdXFsiOjAtOS4sLV0vOwogICAgICAgIHZhciB3aGl0ZVNwYWNlID0gL1tcclxuXHNcdF0vOwogICAgICAgIHZhciBqc29uVGV4dCA9ICcnOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBzeW1ib2w7IHN5bWJvbCA9IGh0bWxbaV07IGkrKykgewogICAgICAgICAgaWYgKHN5bWJvbCA9PT0gJyInKSB7CiAgICAgICAgICAgIHZhciBlbmQgPSBpOwogICAgICAgICAgICB3aGlsZSAoZW5kICE9PSAtMSAmJiAoZW5kID09PSBpIHx8IGh0bWxbZW5kIC0gMV0gPT09ICdcXCcpKSB7CiAgICAgICAgICAgICAgZW5kID0gaHRtbC5pbmRleE9mKCciJywgZW5kICsgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGVuZCA9PT0gLTEpIHsKICAgICAgICAgICAgICBlbmQgPSBodG1sLmxlbmd0aCAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAganNvblRleHQgKz0gaHRtbC5zdWJzdHIoaSwgZW5kIC0gaSArIDEpOwogICAgICAgICAgICBpID0gZW5kOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWpzb25TeW1ib2xzLnRlc3Qoc3ltYm9sKSkgewogICAgICAgICAgICBpZiAoc3ltYm9sID09PSAndCcgJiYgaHRtbC5zdWJzdHIoaSwgNCkgPT09ICd0cnVlJykgewogICAgICAgICAgICAgIGpzb25UZXh0ICs9ICd0cnVlJzsKICAgICAgICAgICAgICBpICs9IDM7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBpZiAoc3ltYm9sID09PSAnZicgJiYgaHRtbC5zdWJzdHIoaSwgNSkgPT09ICdmYWxzZScpIHsKICAgICAgICAgICAgICBqc29uVGV4dCArPSAnZmFsc2UnOwogICAgICAgICAgICAgIGkgKz0gNDsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGlmIChzeW1ib2wgPT09ICduJyAmJiBodG1sLnN1YnN0cihpLCA0KSA9PT0gJ251bGwnKSB7CiAgICAgICAgICAgICAganNvblRleHQgKz0gJ251bGwnOwogICAgICAgICAgICAgIGkgKz0gMzsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGlmICghd2hpdGVTcGFjZS50ZXN0KHN5bWJvbCkpIHsKICAgICAgICAgICAgICBvYmpbJ3snXSA9IDA7CiAgICAgICAgICAgICAgb2JqWydbJ10gPSAwOwogICAgICAgICAgICAgIGpzb25UZXh0ID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAganNvblRleHQgKz0gc3ltYm9sOwoKICAgICAgICAgIGlmIChzeW1ib2wgPT09ICd7JyB8fCBzeW1ib2wgPT09ICdbJykgewogICAgICAgICAgICBpZiAoIW9ialsneyddICYmICFvYmpbJ1snXSkgewogICAgICAgICAgICAgIGpzb25UZXh0ID0gc3ltYm9sOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9ialtzeW1ib2xdKys7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmIChzeW1ib2wgPT09ICd9JyB8fCBzeW1ib2wgPT09ICddJykgewogICAgICAgICAgICBvYmpbbWFwW3N5bWJvbF1dLS07CiAgICAgICAgICAgIGlmICghb2JqWyd7J10gJiYgIW9ialsnWyddKSB7CiAgICAgICAgICAgICAgcmF3SnNvbi5wdXNoKGpzb25UZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIganNvbkxpc3QgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IHJhd0pzb25baV07IGkrKykgewogICAgICAgICAgaWYgKGl0ZW0gPT09ICd7fScgfHwgaXRlbSA9PT0gJ1tdJykgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgIG1hdGNoLmV2ZXJ5KGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgICAgIHJldHVybiByLnRlc3QoaXRlbSk7CiAgICAgICAgICAgICAgfSkgJiYganNvbkxpc3QucHVzaChKU09OLnBhcnNlKGl0ZW0pKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBqc29uTGlzdC5wdXNoKEpTT04ucGFyc2UoaXRlbSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdiYWQganNvbicsIGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4ganNvbkxpc3Q7CiAgICAgIH07CgogICAgICBtb25vLmZpbmRKc29uU3RyaW5nID0gZnVuY3Rpb24oaHRtbCwgbWF0Y2gpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgaWYgKG1hdGNoICYmICFBcnJheS5pc0FycmF5KG1hdGNoKSkgewogICAgICAgICAgbWF0Y2ggPSBbbWF0Y2hdOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJhd1N0cmluZyA9IFtdOwogICAgICAgIHZhciBsYXN0UG9zID0gLTE7CiAgICAgICAgdmFyIHBvcyA9IC0xOwogICAgICAgIGRvIHsKICAgICAgICAgIHBvcyA9IGh0bWwuaW5kZXhPZignIicsIHBvcyArIDEpOwogICAgICAgICAgaWYgKHBvcyAhPT0gLTEpIHsKICAgICAgICAgICAgaWYgKGh0bWxbcG9zIC0gMV0gPT09ICdcXCcpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGFzdFBvcyAhPT0gLTEpIHsKICAgICAgICAgICAgICByYXdTdHJpbmcucHVzaChodG1sLnN1YnN0cihsYXN0UG9zLCBwb3MgKyAxIC0gbGFzdFBvcykpOwogICAgICAgICAgICAgIGxhc3RQb3MgPSAtMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBsYXN0UG9zID0gcG9zOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsYXN0UG9zID0gcG9zOwogICAgICAgICAgfQogICAgICAgIH0gd2hpbGUgKHBvcyAhPT0gLTEpOwoKICAgICAgICB2YXIgc3RyaW5nTGlzdCA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gcmF3U3RyaW5nW2ldOyBpKyspIHsKICAgICAgICAgIGlmIChpdGVtID09PSAnIiInKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgbWF0Y2guZXZlcnkoZnVuY3Rpb24ocikgewogICAgICAgICAgICAgICAgcmV0dXJuIHIudGVzdChpdGVtKTsKICAgICAgICAgICAgICB9KSAmJiBzdHJpbmdMaXN0LnB1c2goSlNPTi5wYXJzZShpdGVtKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RyaW5nTGlzdC5wdXNoKEpTT04ucGFyc2UoaXRlbSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdiYWQganNvbicsIGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nTGlzdDsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge09iamVjdHxBcnJheX0gY3NzU3R5bGVPYmoKICAgICAgICogQHBhcmFtIHtzdHJpbmd8QXJyYXl9IFtwYXJlbnRTZWxlY3Rvcl0KICAgICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAgICovCiAgICAgIG1vbm8uc3R5bGUyVGV4dCA9IGZ1bmN0aW9uKGNzc1N0eWxlT2JqLCBwYXJlbnRTZWxlY3RvcikgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgbGlzdCA9IFtdOwoKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY3NzU3R5bGVPYmopKSB7CiAgICAgICAgICBjc3NTdHlsZU9iaiA9IFtjc3NTdHlsZU9ial07CiAgICAgICAgfQoKICAgICAgICBpZiAocGFyZW50U2VsZWN0b3IgJiYgIUFycmF5LmlzQXJyYXkocGFyZW50U2VsZWN0b3IpKSB7CiAgICAgICAgICBwYXJlbnRTZWxlY3RvciA9IFtwYXJlbnRTZWxlY3Rvcl07CiAgICAgICAgfQoKICAgICAgICB2YXIgc3R5bGVUb1RleHQgPSBmdW5jdGlvbihzZWxlY3RvckFyciwgc3R5bGVPYmopIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIHZhciBjb250ZW50ID0gW107CgogICAgICAgICAgZm9yICh2YXIgaXRlbSBpbiBzdHlsZU9iaikgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBzdHlsZU9ialtpdGVtXTsKCiAgICAgICAgICAgIGlmIChpdGVtID09PSAnY3NzRmxvYXQnKSB7CiAgICAgICAgICAgICAgaXRlbSA9ICdmbG9hdCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBrZXkgPSBpdGVtLnJlcGxhY2UoLyhbQS1aXSkvZywgZnVuY3Rpb24odGV4dCwgbGV0dGVyKSB7CiAgICAgICAgICAgICAgcmV0dXJuICctJyArIGxldHRlci50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnRlbnQucHVzaChrZXkgKyAnOicgKyB2YWx1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFjb250ZW50Lmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gW3NlbGVjdG9yQXJyLmpvaW4oJywnKSwgJ3snLCBjb250ZW50LmpvaW4oJzsnKSwgJ30nXS5qb2luKCcnKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB2YXIgaW5oZXJpdFNlbGVjdG9yID0gZnVuY3Rpb24oc2VjdGlvbiwgc2VsZWN0b3IpIHsKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzZWxlY3RvcikpIHsKICAgICAgICAgICAgc2VsZWN0b3IgPSBbc2VsZWN0b3JdOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwYXJlbnRTZWxlY3RvcikgewogICAgICAgICAgICB2YXIgX3NlbGVjdG9yID0gW107CiAgICAgICAgICAgIHZhciBqb2luID0gKHNlY3Rpb24uam9pbiB8fCBzZWN0aW9uLmpvaW4gPT09ICcnKSA/IHNlY3Rpb24uam9pbiA6ICcgJzsKICAgICAgICAgICAgcGFyZW50U2VsZWN0b3IuZm9yRWFjaChmdW5jdGlvbihwYXJlbnRTZWxlY3RvcikgewogICAgICAgICAgICAgIHNlbGVjdG9yLmZvckVhY2goZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgICAgICAgICAgICAgIF9zZWxlY3Rvci5wdXNoKHBhcmVudFNlbGVjdG9yICsgam9pbiArIHNlbGVjdG9yKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGVjdG9yID0gX3NlbGVjdG9yOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBzZWxlY3RvcjsKICAgICAgICB9OwoKICAgICAgICBjc3NTdHlsZU9iai5mb3JFYWNoKGZ1bmN0aW9uKHNlY3Rpb24pIHsKICAgICAgICAgIHZhciBpbmhTZWxlY3RvciA9IG51bGw7CiAgICAgICAgICB2YXIgbWVkaWEgPSBzZWN0aW9uLm1lZGlhOwogICAgICAgICAgdmFyIHNlbGVjdG9yID0gc2VjdGlvbi5zZWxlY3RvcjsKICAgICAgICAgIHZhciBzdHlsZSA9IHNlY3Rpb24uc3R5bGU7CiAgICAgICAgICB2YXIgYXBwZW5kID0gc2VjdGlvbi5hcHBlbmQ7CgogICAgICAgICAgaWYgKG1lZGlhICYmIGFwcGVuZCkgewogICAgICAgICAgICBsaXN0LnB1c2goW21lZGlhLCAneycsIG1vbm8uc3R5bGUyVGV4dChhcHBlbmQsIHBhcmVudFNlbGVjdG9yKSwgJ30nXS5qb2luKCcnKSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmICghc2VsZWN0b3IgJiYgIXN0eWxlKSB7CiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBzZWN0aW9uKSB7CiAgICAgICAgICAgICAgaWYgKFsnYXBwZW5kJywgJ2pvaW4nXS5pbmRleE9mKGtleSkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2VsZWN0b3IgPSBrZXk7CiAgICAgICAgICAgICAgc3R5bGUgPSBzZWN0aW9uW2tleV07CgogICAgICAgICAgICAgIGFwcGVuZCA9IHN0eWxlLmFwcGVuZDsKICAgICAgICAgICAgICBpZiAoYXBwZW5kKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgc3R5bGUuYXBwZW5kOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaW5oU2VsZWN0b3IgPSBpbmhlcml0U2VsZWN0b3Ioc2VjdGlvbiwgc2VsZWN0b3IpOwogICAgICAgICAgICAgIGxpc3QucHVzaChzdHlsZVRvVGV4dChpbmhTZWxlY3Rvciwgc3R5bGUpKTsKCiAgICAgICAgICAgICAgaWYgKGFwcGVuZCkgewogICAgICAgICAgICAgICAgbGlzdC5wdXNoKG1vbm8uc3R5bGUyVGV4dChhcHBlbmQsIGluaFNlbGVjdG9yKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpbmhTZWxlY3RvciA9IGluaGVyaXRTZWxlY3RvcihzZWN0aW9uLCBzZWxlY3Rvcik7CiAgICAgICAgICAgIGxpc3QucHVzaChzdHlsZVRvVGV4dChpbmhTZWxlY3Rvciwgc3R5bGUpKTsKCiAgICAgICAgICAgIGlmIChhcHBlbmQpIHsKICAgICAgICAgICAgICBsaXN0LnB1c2gobW9uby5zdHlsZTJUZXh0KGFwcGVuZCwgaW5oU2VsZWN0b3IpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gbGlzdC5qb2luKCcnKTsKICAgICAgfTsKCiAgICAgIG1vbm8uc3R5bGVSZXNldCA9IHsKICAgICAgICBhbmltYXRpb246ICJub25lIDBzIGVhc2UgMHMgMSBub3JtYWwgbm9uZSBydW5uaW5nIiwKICAgICAgICBiYWNrZmFjZVZpc2liaWxpdHk6ICJ2aXNpYmxlIiwKICAgICAgICBiYWNrZ3JvdW5kOiAidHJhbnNwYXJlbnQgbm9uZSByZXBlYXQgMCAwIC8gYXV0byBhdXRvIHBhZGRpbmctYm94IGJvcmRlci1ib3ggc2Nyb2xsIiwKICAgICAgICBib3JkZXI6ICJtZWRpdW0gbm9uZSBjdXJyZW50Q29sb3IiLAogICAgICAgIGJvcmRlckNvbGxhcHNlOiAic2VwYXJhdGUiLAogICAgICAgIGJvcmRlckltYWdlOiAibm9uZSIsCiAgICAgICAgYm9yZGVyUmFkaXVzOiAiMCIsCiAgICAgICAgYm9yZGVyU3BhY2luZzogIjAiLAogICAgICAgIGJvdHRvbTogImF1dG8iLAogICAgICAgIGJveFNoYWRvdzogIm5vbmUiLAogICAgICAgIGJveFNpemluZzogImNvbnRlbnQtYm94IiwKICAgICAgICBjYXB0aW9uU2lkZTogInRvcCIsCiAgICAgICAgY2xlYXI6ICJub25lIiwKICAgICAgICBjbGlwOiAiYXV0byIsCiAgICAgICAgY29sb3I6ICJpbmhlcml0IiwKICAgICAgICBjb2x1bW5zOiAiYXV0byIsCiAgICAgICAgY29sdW1uQ291bnQ6ICJhdXRvIiwKICAgICAgICBjb2x1bW5GaWxsOiAiYmFsYW5jZSIsCiAgICAgICAgY29sdW1uR2FwOiAibm9ybWFsIiwKICAgICAgICBjb2x1bW5SdWxlOiAibWVkaXVtIG5vbmUgY3VycmVudENvbG9yIiwKICAgICAgICBjb2x1bW5TcGFuOiAiMSIsCiAgICAgICAgY29sdW1uV2lkdGg6ICJhdXRvIiwKICAgICAgICBjb250ZW50OiAibm9ybWFsIiwKICAgICAgICBjb3VudGVySW5jcmVtZW50OiAibm9uZSIsCiAgICAgICAgY291bnRlclJlc2V0OiAibm9uZSIsCiAgICAgICAgY3Vyc29yOiAiYXV0byIsCiAgICAgICAgZGlyZWN0aW9uOiAibHRyIiwKICAgICAgICBkaXNwbGF5OiAiaW5saW5lIiwKICAgICAgICBlbXB0eUNlbGxzOiAic2hvdyIsCiAgICAgICAgZmxvYXQ6ICJub25lIiwKICAgICAgICBmb250OiAibm9ybWFsIG5vcm1hbCBub3JtYWwgbm9ybWFsIG1lZGl1bS9ub3JtYWwgaW5oZXJpdCIsCiAgICAgICAgaGVpZ2h0OiAiYXV0byIsCiAgICAgICAgaHlwaGVuczogIm5vbmUiLAogICAgICAgIGxlZnQ6ICJhdXRvIiwKICAgICAgICBsZXR0ZXJTcGFjaW5nOiAibm9ybWFsIiwKICAgICAgICBsaXN0U3R5bGU6ICJkaXNjIG91dHNpZGUgbm9uZSIsCiAgICAgICAgbWFyZ2luOiAiMCIsCiAgICAgICAgbWF4SGVpZ2h0OiAibm9uZSIsCiAgICAgICAgbWF4V2lkdGg6ICJub25lIiwKICAgICAgICBtaW5IZWlnaHQ6ICIwIiwKICAgICAgICBtaW5XaWR0aDogIjAiLAogICAgICAgIG9wYWNpdHk6ICIxIiwKICAgICAgICBvcnBoYW5zOiAiMCIsCiAgICAgICAgb3V0bGluZTogIm1lZGl1bSBub25lIGludmVydCIsCiAgICAgICAgb3ZlcmZsb3c6ICJ2aXNpYmxlIiwKICAgICAgICBvdmVyZmxvd1g6ICJ2aXNpYmxlIiwKICAgICAgICBvdmVyZmxvd1k6ICJ2aXNpYmxlIiwKICAgICAgICBwYWRkaW5nOiAiMCIsCiAgICAgICAgcGFnZUJyZWFrQWZ0ZXI6ICJhdXRvIiwKICAgICAgICBwYWdlQnJlYWtCZWZvcmU6ICJhdXRvIiwKICAgICAgICBwYWdlQnJlYWtJbnNpZGU6ICJhdXRvIiwKICAgICAgICBwZXJzcGVjdGl2ZTogIm5vbmUiLAogICAgICAgIHBlcnNwZWN0aXZlT3JpZ2luOiAiNTAlIDUwJSIsCiAgICAgICAgcG9zaXRpb246ICJzdGF0aWMiLAogICAgICAgIHJpZ2h0OiAiYXV0byIsCiAgICAgICAgdGFiU2l6ZTogIjgiLAogICAgICAgIHRhYmxlTGF5b3V0OiAiYXV0byIsCiAgICAgICAgdGV4dEFsaWduOiAiaW5oZXJpdCIsCiAgICAgICAgdGV4dEFsaWduTGFzdDogImF1dG8iLAogICAgICAgIHRleHREZWNvcmF0aW9uOiAibm9uZSBzb2xpZCBjdXJyZW50Q29sb3IiLAogICAgICAgIHRleHRJbmRlbnQ6ICIwIiwKICAgICAgICB0ZXh0U2hhZG93OiAibm9uZSIsCiAgICAgICAgdGV4dFRyYW5zZm9ybTogIm5vbmUiLAogICAgICAgIHRvcDogImF1dG8iLAogICAgICAgIHRyYW5zZm9ybTogIm5vbmUiLAogICAgICAgIHRyYW5zZm9ybU9yaWdpbjogIjUwJSA1MCUgMCIsCiAgICAgICAgdHJhbnNmb3JtU3R5bGU6ICJmbGF0IiwKICAgICAgICB0cmFuc2l0aW9uOiAibm9uZSAwcyBlYXNlIDBzIiwKICAgICAgICB1bmljb2RlQmlkaTogIm5vcm1hbCIsCiAgICAgICAgdmVydGljYWxBbGlnbjogImJhc2VsaW5lIiwKICAgICAgICB2aXNpYmlsaXR5OiAidmlzaWJsZSIsCiAgICAgICAgd2hpdGVTcGFjZTogIm5vcm1hbCIsCiAgICAgICAgd2lkb3dzOiAiMCIsCiAgICAgICAgd2lkdGg6ICJhdXRvIiwKICAgICAgICB3b3JkU3BhY2luZzogIm5vcm1hbCIsCiAgICAgICAgekluZGV4OiAiYXV0byIsCiAgICAgICAgYWxsOiAiaW5pdGlhbCIKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gaG9zdAogICAgICAgKiBAcGFyYW0ge0FycmF5fSBob3N0TGlzdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAgICovCiAgICAgIG1vbm8ubWF0Y2hIb3N0ID0gZnVuY3Rpb24oaG9zdCwgaG9zdExpc3QpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIGRvdFBvczsKICAgICAgICB3aGlsZSAoKGRvdFBvcyA9IGhvc3QuaW5kZXhPZignLicpKSAhPT0gLTEpIHsKICAgICAgICAgIGlmIChob3N0TGlzdC5pbmRleE9mKGhvc3QpICE9PSAtMSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGhvc3QgPSBob3N0LnN1YnN0cihkb3RQb3MgKyAxKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5CiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgICAqLwogICAgICBtb25vLnN0b3JhZ2UuZ2V0RXhwaXJlID0gZnVuY3Rpb24oa2V5LCBjYWxsYmFjaykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgcHJlZml4ID0gbW9uby5zdG9yYWdlLmdldEV4cGlyZS5wcmVmaXg7CiAgICAgICAgdmFyIG5vdyA9IHBhcnNlSW50KERhdGUubm93KCkgLyAxMDAwKTsKICAgICAgICB2YXIgZXhwaXJlS2V5ID0ga2V5ICsgcHJlZml4OwogICAgICAgIHJldHVybiBtb25vLnN0b3JhZ2UuZ2V0KFtrZXksIGV4cGlyZUtleV0sIGZ1bmN0aW9uKHN0b3JhZ2UpIHsKICAgICAgICAgIHZhciBpc0V4cGlyZSA9IHN0b3JhZ2VbZXhwaXJlS2V5XSA9PT0gdW5kZWZpbmVkIHx8IHN0b3JhZ2VbZXhwaXJlS2V5XSA8IG5vdzsKICAgICAgICAgIHZhciBfc3RvcmFnZSA9IHt9OwogICAgICAgICAgX3N0b3JhZ2Vba2V5XSA9IHN0b3JhZ2Vba2V5XTsKICAgICAgICAgIHJldHVybiBjYWxsYmFjayhfc3RvcmFnZSwgaXNFeHBpcmUpOwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgbW9uby5zdG9yYWdlLmdldEV4cGlyZS5wcmVmaXggPSAnX2V4cGlyZV8nOwoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdG9yYWdlCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lCiAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtjYWxsYmFja10KICAgICAgICovCiAgICAgIG1vbm8uc3RvcmFnZS5zZXRFeHBpcmUgPSBmdW5jdGlvbihzdG9yYWdlLCB0aW1lLCBjYWxsYmFjaykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgcHJlZml4ID0gbW9uby5zdG9yYWdlLmdldEV4cGlyZS5wcmVmaXg7CiAgICAgICAgdmFyIG5vdyA9IHBhcnNlSW50KERhdGUubm93KCkgLyAxMDAwKTsKICAgICAgICB2YXIgc2V0T2JqID0ge307CiAgICAgICAgZm9yICh2YXIga2V5IGluIHN0b3JhZ2UpIHsKICAgICAgICAgIHNldE9ialtrZXldID0gc3RvcmFnZVtrZXldOwogICAgICAgICAgc2V0T2JqW2tleSArIHByZWZpeF0gPSBub3cgKyB0aW1lOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9uby5zdG9yYWdlLnNldChzZXRPYmosIGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBtb25vLm9uUmVtb3ZlQ2xhc3NOYW1lID0gJ3NmLW5vdGlmeS1vbi1yZW1vdmUnOwogICAgICAvKioKICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBub2RlCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGV2ZW50CiAgICAgICAqLwogICAgICBtb25vLm9uUmVtb3ZlRXZlbnQgPSBmdW5jdGlvbihub2RlLCBldmVudCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBub2RlLmNsYXNzTGlzdC5hZGQobW9uby5vblJlbW92ZUNsYXNzTmFtZSk7CiAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdzZi1yZW1vdmVkJywgZXZlbnQpOwogICAgICB9OwogICAgICAvKioKICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBub2RlCiAgICAgICAqLwogICAgICBtb25vLm9uUmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIG1vbm8udHJpZ2dlcihub2RlLCAnc2YtcmVtb3ZlZCcpOwogICAgICB9OwogICAgICAvKioKICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBub2RlCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGV2ZW50CiAgICAgICAqLwogICAgICBtb25vLm9mZlJlbW92ZUV2ZW50ID0gZnVuY3Rpb24obm9kZSwgZXZlbnQpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKCdzZi1yZW1vdmVkJywgZXZlbnQpOwogICAgICB9OwoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7Tm9kZXxFbGVtZW50fSBub2RlCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RvcgogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAgICovCiAgICAgIG1vbm8ubWF0Y2hlcyA9IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGlmICh0eXBlb2YgZWwubWF0Y2hlcyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgbW9uby5tYXRjaGVzID0gZnVuY3Rpb24obm9kZSwgc2VsZWN0b3IpIHsKICAgICAgICAgICAgcmV0dXJuIG5vZGUubWF0Y2hlcyhzZWxlY3Rvcik7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh0eXBlb2YgZWwubWF0Y2hlc1NlbGVjdG9yID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBtb25vLm1hdGNoZXMgPSBmdW5jdGlvbihub2RlLCBzZWxlY3RvcikgewogICAgICAgICAgICByZXR1cm4gbm9kZS5tYXRjaGVzU2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAodHlwZW9mIGVsLndlYmtpdE1hdGNoZXNTZWxlY3RvciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgbW9uby5tYXRjaGVzID0gZnVuY3Rpb24obm9kZSwgc2VsZWN0b3IpIHsKICAgICAgICAgICAgcmV0dXJuIG5vZGUud2Via2l0TWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHR5cGVvZiBlbC5tb3pNYXRjaGVzU2VsZWN0b3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIG1vbm8ubWF0Y2hlcyA9IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yKSB7CiAgICAgICAgICAgIHJldHVybiBub2RlLm1vek1hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh0eXBlb2YgZWwub01hdGNoZXNTZWxlY3RvciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgbW9uby5tYXRjaGVzID0gZnVuY3Rpb24obm9kZSwgc2VsZWN0b3IpIHsKICAgICAgICAgICAgcmV0dXJuIG5vZGUub01hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh0eXBlb2YgZWwubXNNYXRjaGVzU2VsZWN0b3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIG1vbm8ubWF0Y2hlcyA9IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yKSB7CiAgICAgICAgICAgIHJldHVybiBub2RlLm1zTWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vbm8ubWF0Y2hlcyA9IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGVsID0gbnVsbDsKCiAgICAgICAgcmV0dXJuIG1vbm8ubWF0Y2hlcy5jYWxsKHRoaXMsIG5vZGUsIHNlbGVjdG9yKTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IG5vZGUKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yCiAgICAgICAqIEByZXR1cm5zIHtOb2RlfG51bGx9CiAgICAgICAqLwogICAgICBtb25vLmdldFBhcmVudCA9IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yKSB7CiAgICAgICAgaWYgKCFub2RlIHx8IG5vZGUubm9kZVR5cGUgIT09IDEpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1vbm8ubWF0Y2hlcyhub2RlLCBzZWxlY3RvcikpIHsKICAgICAgICAgIHJldHVybiBub2RlOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFtb25vLm1hdGNoZXMobm9kZSwgc2VsZWN0b3IgKyAnICcgKyBub2RlLnRhZ05hbWUpKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7CiAgICAgICAgZm9yICh2YXIgcGFyZW50ID0gbm9kZTsgcGFyZW50OyBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZSkgewogICAgICAgICAgaWYgKHBhcmVudC5ub2RlVHlwZSAhPT0gMSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobW9uby5tYXRjaGVzKHBhcmVudCwgc2VsZWN0b3IpKSB7CiAgICAgICAgICAgIHJldHVybiBwYXJlbnQ7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUKICAgICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAgICovCiAgICAgIG1vbm8uZXNjYXBlUmVnZXggPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgvW1wtXFtcXXt9KCkqKz8uLFxcXF4kfCNcc10vZywgIlxcJCYiKTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjawogICAgICAgKiBAY29uc3RydWN0b3IKICAgICAgICovCiAgICAgIG1vbm8uQXN5bmNMaXN0ID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgICAgICB2YXIgd2FpdCA9IDA7CiAgICAgICAgdmFyIHJlYWR5ID0gMDsKICAgICAgICB2YXIgZmlyZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLnJlYWR5ID0gZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICBpZiAoZmlyZWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgZmlyZWQgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZWFkeSsrOwogICAgICAgICAgaWYgKHdhaXQgPT09IHJlYWR5KSB7CiAgICAgICAgICAgIGZpcmVkID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB0aGlzLndhaXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHdhaXQrKzsKICAgICAgICB9OwogICAgICB9OwoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7Kn0gbXNnCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbaG9va10KICAgICAgICogQHJldHVybnMge1Byb21pc2V9CiAgICAgICAqLwogICAgICBtb25vLnNlbmRNZXNzYWdlUHJvbWlzZSA9IGZ1bmN0aW9uKG1zZywgaG9vaykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICByZXR1cm4gbmV3IG1vbm8uUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UobXNnLCByZXNvbHZlLCBob29rKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfFtTdHJpbmddfE9iamVjdHxudWxsfHVuZGVmaW5lZH0ga2V5cwogICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0KICAgICAgICovCiAgICAgIG1vbm8uc3RvcmFnZS5nZXRQcm9taXNlID0gZnVuY3Rpb24oa2V5cykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICByZXR1cm4gbmV3IG1vbm8uUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1vbm8uc3RvcmFnZS5nZXQoa2V5cywgcmVzb2x2ZSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbXMKICAgICAgICogQHJldHVybnMge1Byb21pc2V9CiAgICAgICAqLwogICAgICBtb25vLnN0b3JhZ2Uuc2V0UHJvbWlzZSA9IGZ1bmN0aW9uKGl0ZW1zKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHJldHVybiBuZXcgbW9uby5Qcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbW9uby5zdG9yYWdlLnNldChpdGVtcywgcmVzb2x2ZSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge1N0cmluZ3xbU3RyaW5nXX0ga2V5cwogICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0KICAgICAgICovCiAgICAgIG1vbm8uc3RvcmFnZS5yZW1vdmVQcm9taXNlID0gZnVuY3Rpb24oa2V5cykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICByZXR1cm4gbmV3IG1vbm8uUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1vbm8uc3RvcmFnZS5yZW1vdmUoa2V5cywgcmVzb2x2ZSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0KICAgICAgICovCiAgICAgIG1vbm8uc3RvcmFnZS5jbGVhclByb21pc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgcmV0dXJuIG5ldyBtb25vLlByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBtb25vLnN0b3JhZ2UuY2xlYXIocmVzb2x2ZSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge3JlcXVlc3REZXRhaWxzfSBvYmoKICAgICAgICogQHJldHVybnMge1Byb21pc2V9CiAgICAgICAqLwogICAgICBtb25vLnJlcXVlc3RQcm9taXNlID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHJldHVybiBuZXcgbW9uby5Qcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIGFsd2F5cyA9IGZ1bmN0aW9uKGVyciwgcmVzcCwgZGF0YSkgewogICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgcmVqZWN0KGVycik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwLCBkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBtb25vLnJlcXVlc3Qob2JqLCBhbHdheXMpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICAvKioKICAgICAgICogQHJldHVybnMge051bWJlcn0KICAgICAgICovCiAgICAgIG1vbm8uZ2V0VGltZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBwYXJzZUludChEYXRlLm5vdygpIC8gMTAwMCk7CiAgICAgIH07CgogICAgICBtb25vLmRlYnVnID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKG1vbm8uZGVidWdNb2RlKSB7CiAgICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgICAgICAgIGFyZ3MudW5zaGlmdCgnc2YnKTsKICAgICAgICAgIGlmIChtb25vLmlzRWRnZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmdzKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKG1vbm8uaXNGRikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS50cmFjZS5hcHBseShjb25zb2xlLCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICBtb25vLmVycm9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgYXJncy51bnNoaWZ0KCdzZicpOwogICAgICAgIGNvbnNvbGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTsKICAgICAgfTsKCiAgICAgIF9tb25vICYmIChmdW5jdGlvbih0bXBNb25vKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIF9tb25vID0gbnVsbDsKICAgICAgICB2YXIgYXJncywgbGlzdCA9IHRtcE1vbm8ubG9hZE1vZHVsZVN0YWNrOwogICAgICAgIGlmIChsaXN0KSB7CiAgICAgICAgICB3aGlsZSAoYXJncyA9IGxpc3Quc2hpZnQoKSkgewogICAgICAgICAgICAvLyBhc3luYwogICAgICAgICAgICBtb25vLmFzeW5jRm4obW9uby5sb2FkTW9kdWxlKS5hcHBseShtb25vLCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pKF9tb25vKTsKICAgICAgLy88dXRpbHMKCiAgICAgIGlmICh0eXBlb2YgUHJvbWlzZSA9PT0gJ2Z1bmN0aW9uJyAmJgogICAgICAgIHR5cGVvZiBQcm9taXNlLnJlc29sdmUgPT09ICdmdW5jdGlvbicgJiYKICAgICAgICB0eXBlb2YgUHJvbWlzZS5yZWplY3QgPT09ICdmdW5jdGlvbicKICAgICAgKSB7CiAgICAgICAgbW9uby5Qcm9taXNlID0gUHJvbWlzZTsKICAgICAgfSBlbHNlCiAgICAgIGlmIChtb25vLmlzTW9kdWxlKSB7CiAgICAgICAgbW9uby5Qcm9taXNlID0gcmVxdWlyZSgnc2RrL2NvcmUvcHJvbWlzZScpLlByb21pc2U7CiAgICAgIH0KCiAgICAgICFtb25vLlByb21pc2UgJiYgKGZ1bmN0aW9uKCkgewogICAgICAgIC8vIFVzZSBwb2x5ZmlsbCBmb3Igc2V0SW1tZWRpYXRlIGZvciBwZXJmb3JtYW5jZSBnYWlucwogICAgICAgIHZhciBhc2FwID0gKHR5cGVvZiBzZXRJbW1lZGlhdGUgPT09ICdmdW5jdGlvbicgJiYgc2V0SW1tZWRpYXRlKSB8fAogICAgICAgICAgZnVuY3Rpb24oZm4pIHsKICAgICAgICAgICAgbW9uby5zZXRUaW1lb3V0KGZuLCAwKTsKICAgICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICBAbGljZW5zZQogICAgICAgICBDb3B5cmlnaHQgKGMpIDIwMTYgVGhlIFBvbHltZXIgUHJvamVjdCBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgICAgICBUaGlzIGNvZGUgbWF5IG9ubHkgYmUgdXNlZCB1bmRlciB0aGUgQlNEIHN0eWxlIGxpY2Vuc2UgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0xJQ0VOU0UudHh0CiAgICAgICAgIFRoZSBjb21wbGV0ZSBzZXQgb2YgYXV0aG9ycyBtYXkgYmUgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0FVVEhPUlMudHh0CiAgICAgICAgIFRoZSBjb21wbGV0ZSBzZXQgb2YgY29udHJpYnV0b3JzIG1heSBiZSBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vQ09OVFJJQlVUT1JTLnR4dAogICAgICAgICBDb2RlIGRpc3RyaWJ1dGVkIGJ5IEdvb2dsZSBhcyBwYXJ0IG9mIHRoZSBwb2x5bWVyIHByb2plY3QgaXMgYWxzbwogICAgICAgICBzdWJqZWN0IHRvIGFuIGFkZGl0aW9uYWwgSVAgcmlnaHRzIGdyYW50IGZvdW5kIGF0IGh0dHA6Ly9wb2x5bWVyLmdpdGh1Yi5pby9QQVRFTlRTLnR4dAogICAgICAgICAqLwogICAgICAgIC8vIEB1cmwgaHR0cHM6Ly9naXRodWIuY29tL1BvbHltZXJMYWJzL3Byb21pc2UtcG9seWZpbGwKICAgICAgICAvLyBAdmVyc2lvbiAxLjAuMAogICAgICAgIGZ1bmN0aW9uIE1ha2VQcm9taXNlKGFzYXApIHsKICAgICAgICAgIGZ1bmN0aW9uIFByb21pc2UoZm4pIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzICE9PSAnb2JqZWN0JyB8fCB0eXBlb2YgZm4gIT09ICdmdW5jdGlvbicpIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2RlZmVycmVkcyA9IFtdCgogICAgICAgICAgICBkb1Jlc29sdmUoZm4sIHJlc29sdmUuYmluZCh0aGlzKSwgcmVqZWN0LmJpbmQodGhpcykpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZShkZWZlcnJlZCkgewogICAgICAgICAgICB2YXIgbWUgPSB0aGlzOwogICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUgPT09IG51bGwpIHsKICAgICAgICAgICAgICB0aGlzLl9kZWZlcnJlZHMucHVzaChkZWZlcnJlZCk7CiAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNhcChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgY2IgPSBtZS5fc3RhdGUgPyBkZWZlcnJlZC5vbkZ1bGZpbGxlZCA6IGRlZmVycmVkLm9uUmVqZWN0ZWQKICAgICAgICAgICAgICBpZiAodHlwZW9mIGNiICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAobWUuX3N0YXRlID8gZGVmZXJyZWQucmVzb2x2ZSA6IGRlZmVycmVkLnJlamVjdCkobWUuX3ZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIHJldDsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0ID0gY2IobWUuX3ZhbHVlKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmV0KTsKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlKG5ld1ZhbHVlKSB7CiAgICAgICAgICAgIHRyeSB7IC8vUHJvbWlzZSBSZXNvbHV0aW9uIFByb2NlZHVyZTogaHR0cHM6Ly9naXRodWIuY29tL3Byb21pc2VzLWFwbHVzL3Byb21pc2VzLXNwZWMjdGhlLXByb21pc2UtcmVzb2x1dGlvbi1wcm9jZWR1cmUKICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgPT09IHRoaXMpIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgJiYgKHR5cGVvZiBuZXdWYWx1ZSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIG5ld1ZhbHVlID09PSAnZnVuY3Rpb24nKSkgewogICAgICAgICAgICAgICAgdmFyIHRoZW4gPSBuZXdWYWx1ZS50aGVuOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGVuID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgIGRvUmVzb2x2ZSh0aGVuLmJpbmQobmV3VmFsdWUpLCByZXNvbHZlLmJpbmQodGhpcyksIHJlamVjdC5iaW5kKHRoaXMpKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9zdGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSBuZXdWYWx1ZTsKICAgICAgICAgICAgICBmaW5hbGUuY2FsbCh0aGlzKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIHJlamVjdC5jYWxsKHRoaXMsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVqZWN0KG5ld1ZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMuX3N0YXRlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gbmV3VmFsdWU7CiAgICAgICAgICAgIGZpbmFsZS5jYWxsKHRoaXMpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGZpbmFsZSgpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX2RlZmVycmVkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgIGhhbmRsZS5jYWxsKHRoaXMsIHRoaXMuX2RlZmVycmVkc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fZGVmZXJyZWRzID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRha2UgYSBwb3RlbnRpYWxseSBtaXNiZWhhdmluZyByZXNvbHZlciBmdW5jdGlvbiBhbmQgbWFrZSBzdXJlCiAgICAgICAgICAgKiBvbkZ1bGZpbGxlZCBhbmQgb25SZWplY3RlZCBhcmUgb25seSBjYWxsZWQgb25jZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBNYWtlcyBubyBndWFyYW50ZWVzIGFib3V0IGFzeW5jaHJvbnkuCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGRvUmVzb2x2ZShmbiwgb25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHsKICAgICAgICAgICAgdmFyIGRvbmUgPSBmYWxzZTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmbihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKGRvbmUpIHJldHVybjsKICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgICAgICAgb25GdWxmaWxsZWQodmFsdWUpOwogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlYXNvbikgewogICAgICAgICAgICAgICAgaWYgKGRvbmUpIHJldHVybjsKICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgICAgICAgb25SZWplY3RlZChyZWFzb24pOwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgaWYgKGRvbmUpIHJldHVybjsKICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgICAgICBvblJlamVjdGVkKGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIFByb21pc2UucHJvdG90eXBlWydjYXRjaCddID0gZnVuY3Rpb24ob25SZWplY3RlZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50aGVuKG51bGwsIG9uUmVqZWN0ZWQpOwogICAgICAgICAgfTsKCiAgICAgICAgICBQcm9taXNlLnByb3RvdHlwZS50aGVuID0gZnVuY3Rpb24ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHsKICAgICAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgIGhhbmRsZS5jYWxsKG1lLCB7CiAgICAgICAgICAgICAgICBvbkZ1bGZpbGxlZDogb25GdWxmaWxsZWQsCiAgICAgICAgICAgICAgICBvblJlamVjdGVkOiBvblJlamVjdGVkLAogICAgICAgICAgICAgICAgcmVzb2x2ZTogcmVzb2x2ZSwKICAgICAgICAgICAgICAgIHJlamVjdDogcmVqZWN0CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9OwoKICAgICAgICAgIFByb21pc2UucmVzb2x2ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlLmNvbnN0cnVjdG9yID09PSBQcm9taXNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgICAgICAgIHJlc29sdmUodmFsdWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgUHJvbWlzZS5yZWplY3QgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgcmVqZWN0KHZhbHVlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKCiAgICAgICAgICByZXR1cm4gUHJvbWlzZTsKICAgICAgICB9CgogICAgICAgIG1vbm8uUHJvbWlzZSA9IE1ha2VQcm9taXNlKGFzYXApOwogICAgICB9KShtb25vKTsKCiAgICAgIChmdW5jdGlvbihQcm9taXNlKSB7CiAgICAgICAgUHJvbWlzZS5hbGwgPSBQcm9taXNlLmFsbCB8fCBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiBBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkgPyBhcmd1bWVudHNbMF0gOiBhcmd1bWVudHMpOwoKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09PSAwKSByZXR1cm4gcmVzb2x2ZShbXSk7CiAgICAgICAgICAgIHZhciByZW1haW5pbmcgPSBhcmdzLmxlbmd0aDsKCiAgICAgICAgICAgIGZ1bmN0aW9uIHJlcyhpLCB2YWwpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHZhbCAmJiAodHlwZW9mIHZhbCA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJykpIHsKICAgICAgICAgICAgICAgICAgdmFyIHRoZW4gPSB2YWwudGhlbjsKICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGVuID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhlbi5jYWxsKHZhbCwgZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXMoaSwgdmFsKQogICAgICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhcmdzW2ldID0gdmFsOwogICAgICAgICAgICAgICAgaWYgKC0tcmVtYWluaW5nID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHJlc29sdmUoYXJncyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICAgIHJlamVjdChleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHJlcyhpLCBhcmdzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgUHJvbWlzZS5yYWNlID0gUHJvbWlzZS5yYWNlIHx8IGZ1bmN0aW9uKHZhbHVlcykgewogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdmFsdWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgdmFsdWVzW2ldLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfSkobW9uby5Qcm9taXNlKTsKICAgICAgLy9AaW5zZXJ0CgogICAgICByZXR1cm4gbW9ubzsKICAgIH0KICApKTsKCiAgdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgJiYgKGZ1bmN0aW9uKCkgewogICAgbW9ubyA9IHJlcXVpcmUoJy4vLi4vZGF0YS9qcy9tb25vLmpzJyk7CiAgfSkoKTsKCiAgdmFyIGVuZ2luZSA9IHt9OwoKICBlbmdpbmUudmFyQ2FjaGUgPSB7CiAgICAvLyBoZWxwZXIgbmFtZQogICAgaGVscGVyTmFtZTogJycsCiAgICAvLyBleHRlbnNpb24gdmVyc2lvbgogICAgY3VycmVudFZlcnNpb246ICcnLAogICAgbGFuZ0xpc3Q6IFsnZW4nLCAnZGUnLCAncnUnLCAndHInLCAndWsnLCAnZXMnLCAnZnInLCAnaWQnXSwKICAgIG1ldGE6IHt9LAogICAgaXNGaXJzdHJ1bjogZmFsc2UsCiAgICBpc1VwZ3JhZGU6IGZhbHNlLAogICAgdXVpZDogJycKICB9OwoKICBlbmdpbmUuZXh0cmEgPSB7fTsKCiAgZW5naW5lLmRlZmF1bHRQcmVmZXJlbmNlcyA9IHsKICAgIHZlcnNpb246ICcwJywKICAgIGJ1dHRvbjogMSwKICAgIGxtRmlsZUhvc3Rpbmc6IDEsCiAgICBsbU1lZGlhSG9zdGluZzogMSwKICAgIG1vZHVsZVlvdXR1YmU6IDEsCiAgICBtb2R1bGVEYWlseW1vdGlvbjogMSwKICAgIG1vZHVsZVZpbWVvOiAxLAogICAgbW9kdWxlRmFjZWJvb2s6IDEsCiAgICBtb2R1bGVTb3VuZGNsb3VkOiAxLAogICAgbW9kdWxlVmtvbnRha3RlOiAxLAogICAgbW9kdWxlT2Rub2tsYXNzbmlraTogMSwKICAgIG1vZHVsZU1haWxydTogMSwKICAgIG1vZHVsZUluc3RhZ3JhbTogMSwKICAgIG1vZHVsZVJ1dHViZTogMSwKICAgIG1vZHVsZVNob3dEb3dubG9hZEluZm86IDEsCiAgICB5dEhpZGVGTFY6IDAsCiAgICB5dEhpZGVNUDQ6IDAsCiAgICB5dEhpZGVXZWJNOiAxLAogICAgeXRIaWRlM0dQOiAxLAogICAgeXRIaWRlM0Q6IDEsCiAgICB5dEhpZGVNUDROb0F1ZGlvOiAxLAogICAgeXRIaWRlQXVkaW9fTVA0OiAxLAogICAgdmtTaG93Qml0cmF0ZTogMCwKICAgIHNvdmV0bmlrRW5hYmxlZDogMSwKICAgIHNob3dVbW15SW5mbzogMSwKICAgIHNob3dVbW15QnRuOiAxLAogICAgZ21OYXRpdmVEb3dubG9hZDogMCwKICAgIGV4cEluZGV4OiAwLAogICAgYWR2UHJlU2hvdzogMCwKICAgIHNob3dUdXRvcmlhbDogMCwKICAgIHNob3dVbW15TGFuZGluZzogMCwKICAgIGF2aWFCYXJFbmFibGVkOiAxLAogICAgc3RhdEVuYWJsZWQ6IDEKICB9OwoKICBlbmdpbmUucHJlZmVyZW5jZXMgPSB7CiAgICBzZkhlbHBlck5hbWU6ICcnLAogICAgY291bnRyeTogJycsCiAgICBoYXNTb3ZldG5pazogdW5kZWZpbmVkLAogICAgaGFzRFA6IHVuZGVmaW5lZCwKICAgIGhhc0F2aWFCYXI6IHVuZGVmaW5lZCwKICAgIGNvaG9ydEluZGV4OiB1bmRlZmluZWQsCiAgICBkb3dubG9hZHM6IHVuZGVmaW5lZCwKICAgIHVtbXlEZXRlY3RlZDogdW5kZWZpbmVkLAogICAgc2hvd1VtbXlJdGVtOiB1bmRlZmluZWQKICB9OwoKICBlbmdpbmUucHJlZmVyZW5jZU1hcCA9IHsKICAgIHlvdXR1YmU6ICdtb2R1bGVZb3V0dWJlJywKICAgIGRhaWx5bW90aW9uOiAnbW9kdWxlRGFpbHltb3Rpb24nLAogICAgdmltZW86ICdtb2R1bGVWaW1lbycsCiAgICBmYWNlYm9vazogJ21vZHVsZUZhY2Vib29rJywKICAgIHNvdW5kY2xvdWQ6ICdtb2R1bGVTb3VuZGNsb3VkJywKICAgIHZrOiAnbW9kdWxlVmtvbnRha3RlJywKICAgIG9kbm9rbGFzc25pa2k6ICdtb2R1bGVPZG5va2xhc3NuaWtpJywKICAgIG1haWxydTogJ21vZHVsZU1haWxydScsCiAgICBpbnN0YWdyYW06ICdtb2R1bGVJbnN0YWdyYW0nLAogICAgcnV0dWJlOiAnbW9kdWxlUnV0dWJlJwogIH07CgogIGVuZ2luZS5tb2R1bGVzID0ge307CiAgZW5naW5lLnV0aWxzID0ge307CgogIGVuZ2luZS5sb2FkZXIgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgREVCVUcgPSBmYWxzZTsKICAgIHZhciB3YWl0TGlzdCA9IFtdOwogICAgdmFyIHJlYWR5TGlzdCA9IFtdOwogICAgdmFyIHJ1biA9IGZ1bmN0aW9uKCkgewogICAgICB3YWl0TGlzdC5zbGljZSgwKS5mb3JFYWNoKGZ1bmN0aW9uKG9iaikgewogICAgICAgIHZhciBpc1JlYWR5ID0gb2JqLm5hbWVMaXN0LmV2ZXJ5KGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgIHJldHVybiByZWFkeUxpc3QuaW5kZXhPZihuYW1lKSAhPT0gLTE7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGlzUmVhZHkpIHsKICAgICAgICAgIHZhciBwb3MgPSB3YWl0TGlzdC5pbmRleE9mKG9iaik7CiAgICAgICAgICBpZiAocG9zICE9PSAtMSkgewogICAgICAgICAgICB3YWl0TGlzdC5zcGxpY2UocG9zLCAxKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBERUJVRyAmJiBjb25zb2xlLmRlYnVnKCdMb2FkZXIgcnVuJywgb2JqLm5hbWVMaXN0KTsKICAgICAgICAgICAgICBvYmouZm4oKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIG1vbm8uZXJyb3IoJ1J1biBlcnJvciEnLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogICAgLyoqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAgICovCiAgICB2YXIgcmVhZHkgPSBmdW5jdGlvbihuYW1lKSB7CiAgICAgIERFQlVHICYmIGNvbnNvbGUudHJhY2UoJ0xvYWRlciByZWFkeScsIG5hbWUpOwogICAgICByZWFkeUxpc3QucHVzaChuYW1lKTsKICAgICAgcnVuKCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBAcGFyYW0ge1N0cmluZ3xTdHJpbmdbXX0gbmFtZUxpc3QKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAgICAgKi8KICAgIHZhciB3aGVuID0gZnVuY3Rpb24obmFtZUxpc3QsIGZuKSB7CiAgICAgIERFQlVHICYmIGNvbnNvbGUudHJhY2UoJ0xvYWRlciB3aGVuJywgbmFtZUxpc3QpOwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkobmFtZUxpc3QpKSB7CiAgICAgICAgbmFtZUxpc3QgPSBbbmFtZUxpc3RdOwogICAgICB9CiAgICAgIHdhaXRMaXN0LnB1c2goewogICAgICAgIG5hbWVMaXN0OiBuYW1lTGlzdCwKICAgICAgICBmbjogZm4KICAgICAgfSk7CiAgICAgIHJ1bigpOwogICAgfTsKCiAgICByZXR1cm4gewogICAgICB3YWl0TGlzdDogd2FpdExpc3QsCiAgICAgIHJlYWR5TGlzdDogcmVhZHlMaXN0LAogICAgICByZWFkeTogcmVhZHksCiAgICAgIHdoZW46IHdoZW4KICAgIH0KICB9KSgpOwoKICBlbmdpbmUuZXZlbnRzID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIERFQlVHID0gZmFsc2U7CiAgICB2YXIgbGlzdGVuZXJzID0ge307CiAgICB2YXIgc2xpY2UgPSBbXS5zbGljZTsKICAgIC8qKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50CiAgICAgKiBAcGFyYW0gey4uLip9IHBhcmFtcwogICAgICovCiAgICB2YXIgZW1pdCA9IGZ1bmN0aW9uKGV2ZW50LCBwYXJhbXMpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cykuc2xpY2UoMSk7CiAgICAgIHZhciBhcnIgPSBsaXN0ZW5lcnNbZXZlbnRdIHx8IFtdOwogICAgICBhcnIuc2xpY2UoMCkuZm9yRWFjaChmdW5jdGlvbihjYWxsYmFjaykgewogICAgICAgIHRyeSB7CiAgICAgICAgICBERUJVRyAmJiBjb25zb2xlLmRlYnVnKCdFdmVudHMgZW1pdCcsIGV2ZW50KTsKICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIG1vbm8uZXJyb3IoJ0VtaXQgZXJyb3IhJywgZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICAvKioKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqLwogICAgdmFyIG9uID0gZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBhcnIgPSBsaXN0ZW5lcnNbZXZlbnRdOwogICAgICBpZiAoIWxpc3RlbmVyc1tldmVudF0pIHsKICAgICAgICBhcnIgPSBsaXN0ZW5lcnNbZXZlbnRdID0gW107CiAgICAgIH0KICAgICAgdmFyIHBvcyA9IGFyci5pbmRleE9mKGNhbGxiYWNrKTsKICAgICAgaWYgKHBvcyA9PT0gLTEpIHsKICAgICAgICBERUJVRyAmJiBjb25zb2xlLnRyYWNlKCdFdmVudHMgb24nLCBldmVudCk7CiAgICAgICAgYXJyLnB1c2goY2FsbGJhY2spOwogICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKi8KICAgIHZhciBvZmYgPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHsKICAgICAgdmFyIGFyciA9IGxpc3RlbmVyc1tldmVudF0gfHwgW107CiAgICAgIHZhciBwb3MgPSBhcnIuaW5kZXhPZihjYWxsYmFjayk7CiAgICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgICAgREVCVUcgJiYgY29uc29sZS50cmFjZSgnRXZlbnRzIG9mZicsIGV2ZW50KTsKICAgICAgICBhcnIuc3BsaWNlKHBvcywgMSk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqLwogICAgdmFyIG9uY2UgPSBmdW5jdGlvbihldmVudCwgY2FsbGJhY2spIHsKICAgICAgREVCVUcgJiYgY29uc29sZS50cmFjZSgnRXZlbnRzIG9uY2UnLCBldmVudCk7CiAgICAgIHZhciBfY2FsbGJhY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICBvZmYoZXZlbnQsIGNhbGxiYWNrKTsKICAgICAgICBjYWxsYmFjay5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgICBvbihldmVudCwgX2NhbGxiYWNrKTsKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgbGlzdGVuZXJzOiBsaXN0ZW5lcnMsCiAgICAgIGVtaXQ6IGVtaXQsCiAgICAgIG9uOiBvbiwKICAgICAgb2ZmOiBvZmYsCiAgICAgIG9uY2U6IG9uY2UKICAgIH0KICB9KSgpOwoKICBlbmdpbmUuZ2V0SGVscGVyTmFtZSA9IGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIGdldEJyb3dzZXJOYW1lID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBicm93c2VyID0gJyc7CiAgICAgIHZhciB1c2VyQWdlbnQgPSBtb25vLmdldE5hdmlnYXRvcigpLnVzZXJBZ2VudDsKICAgICAgaWYgKHVzZXJBZ2VudC5pbmRleE9mKCdZYUJyb3dzZXJcLycpICE9PSAtMSkgewogICAgICAgIGJyb3dzZXIgPSAneWFicm93c2VyJzsKICAgICAgfSBlbHNlCiAgICAgIGlmICh1c2VyQWdlbnQuaW5kZXhPZignTWF4dGhvblwvJykgIT09IC0xKSB7CiAgICAgICAgYnJvd3NlciA9ICdtYXh0aG9uJzsKICAgICAgfSBlbHNlCiAgICAgIGlmICh1c2VyQWdlbnQuaW5kZXhPZignT1BSXC8nKSAhPT0gLTEpIHsKICAgICAgICBicm93c2VyID0gJ29wZXJhLWNocm9taXVtJzsKICAgICAgfSBlbHNlCiAgICAgIGlmICh1c2VyQWdlbnQuaW5kZXhPZignT3BlcmFcLycpICE9PSAtMSkgewogICAgICAgIGJyb3dzZXIgPSAnb3BlcmEnOwogICAgICB9IGVsc2UKICAgICAgaWYgKHVzZXJBZ2VudC5pbmRleE9mKCdGaXJlZm94XC8nKSAhPT0gLTEpIHsKICAgICAgICBicm93c2VyID0gJ2ZpcmVmb3gnOwogICAgICB9IGVsc2UKICAgICAgaWYgKHVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWVcLycpICE9PSAtMSkgewogICAgICAgIGJyb3dzZXIgPSAnY2hyb21lJzsKICAgICAgfSBlbHNlCiAgICAgIGlmICh1c2VyQWdlbnQuaW5kZXhPZignU2FmYXJpXC8nKSAhPT0gLTEpIHsKICAgICAgICBicm93c2VyID0gJ3NhZmFyaSc7CiAgICAgIH0KICAgICAgcmV0dXJuIGJyb3dzZXI7CiAgICB9OwoKICAgIHZhciBicm93c2VyID0gJ3Vua25vd24nOwogICAgaWYgKG1vbm8uaXNDaHJvbWUpIHsKICAgICAgYnJvd3NlciA9IGdldEJyb3dzZXJOYW1lKCkgfHwgJ2Nocm9tZSc7CiAgICAgIGlmICgvc2FuZGJveC5odG1sI2JnLy50ZXN0KGxvY2F0aW9uLmhyZWYpKSB7CiAgICAgICAgYnJvd3NlciA9ICdjaGFtZWxlb24nOwogICAgICB9CiAgICAgIGlmIChlbmdpbmUuY2hyb21lTm9TdG9yZSkgewogICAgICAgIGJyb3dzZXIgKz0gJy1zZic7CiAgICAgIH0KICAgIH0gZWxzZQogICAgaWYgKG1vbm8uaXNGRikgewogICAgICBicm93c2VyID0gJ2ZpcmVmb3gnOwogICAgICBpZiAoIWVuZ2luZS52YXJDYWNoZS5mZkJ1dHRvbikgewogICAgICAgIGJyb3dzZXIgKz0gJy1tb2JpbGUnOwogICAgICB9CiAgICAgIGlmIChlbmdpbmUuZmZOb1N0b3JlKSB7CiAgICAgICAgYnJvd3NlciArPSAnLXNmJzsKICAgICAgfQogICAgfSBlbHNlCiAgICBpZiAobW9uby5pc1NhZmFyaSkgewogICAgICBicm93c2VyID0gJ3NhZmFyaSc7CiAgICB9IGVsc2UKICAgIGlmIChtb25vLmlzT3BlcmEpIHsKICAgICAgYnJvd3NlciA9ICdvcGVyYSc7CiAgICB9IGVsc2UKICAgIGlmIChtb25vLmlzR00pIHsKICAgICAgYnJvd3NlciA9IGdldEJyb3dzZXJOYW1lKCkgfHwgYnJvd3NlcjsKICAgICAgYnJvd3NlciA9ICd1c2VyanMtJyArIGJyb3dzZXI7CiAgICB9IGVsc2UKICAgIGlmIChtb25vLmlzRWRnZSkgewogICAgICBicm93c2VyID0gJ2VkZ2UnOwogICAgfQoKICAgIHJldHVybiBicm93c2VyOwogIH07CgogIGVuZ2luZS5nZXRTZkhlbHBlck5hbWUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBuYW1lID0gZW5naW5lLnZhckNhY2hlLmhlbHBlck5hbWU7CiAgICBpZiAoL15maXJlZm94Ly50ZXN0KG5hbWUpKSB7CiAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoJ2ZpcmVmb3gnLCAnZmYnKTsKICAgIH0KICAgIHJldHVybiBuYW1lOwogIH07CgogIGVuZ2luZS5kYmxUcmFja0NoZWNrID0gZnVuY3Rpb24oY2IpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBERUJVRyA9IGZhbHNlOwogICAgaWYgKCFtb25vLmlzR00pIHsKICAgICAgcmV0dXJuIGNiKCk7CiAgICB9CgogICAgaWYgKG1vbm8uaXNJZnJhbWUoKSkgewogICAgICBERUJVRyAmJiBtb25vLmRlYnVnKCdkYmxUcmFjayBpbnNpZGUgZnJhbWUgZGlzYWJsZWQhJyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBtb25vLnN0b3JhZ2UuZ2V0KCdkYmxUcmFjaycsIGZ1bmN0aW9uKHN0b3JhZ2UpIHsKICAgICAgdmFyIG5vdyA9IERhdGUubm93KCk7CiAgICAgIGlmICh0eXBlb2Ygc3RvcmFnZS5kYmxUcmFjayAhPT0gJ3N0cmluZycpIHsKICAgICAgICBzdG9yYWdlLmRibFRyYWNrID0gJyc7CiAgICAgIH0KCiAgICAgIHZhciBkYXRhTGlzdCA9IHN0b3JhZ2UuZGJsVHJhY2suc3BsaXQoJywnKTsKICAgICAgaWYgKGRhdGFMaXN0WzFdID4gbm93KSB7CiAgICAgICAgREVCVUcgJiYgbW9uby5kZWJ1ZygnZGJsVHJhY2sgaXMgbm90IGV4cGlyZWQhJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdXVpZCA9IGVuZ2luZS5nZW5lcmF0ZVV1aWQoKTsKICAgICAgdmFyIGV4cGlyZSA9IG5vdyArIDYwMDAwOwogICAgICBtb25vLnN0b3JhZ2Uuc2V0KHsKICAgICAgICBkYmxUcmFjazogdXVpZCArICcsJyArIGV4cGlyZQogICAgICB9KTsKCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgbW9uby5zdG9yYWdlLmdldCgnZGJsVHJhY2snLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHN0b3JhZ2UuZGJsVHJhY2sgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHZhciBkYXRhTGlzdCA9IHN0b3JhZ2UuZGJsVHJhY2suc3BsaXQoJywnKTsKICAgICAgICAgICAgaWYgKGRhdGFMaXN0WzBdID09PSB1dWlkKSB7CiAgICAgICAgICAgICAgREVCVUcgJiYgbW9uby5kZWJ1ZygnZGJsVHJhY2sgY2FsbGJhY2snKTsKICAgICAgICAgICAgICBjYigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIERFQlVHICYmIG1vbm8uZGVidWcoJ2RibFRyYWNrIHV1aWQgaXMgY2hhbmdlJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwgNTAwMCk7CiAgICB9KTsKICB9OwoKICBlbmdpbmUuZ2V0VXVpZCA9IGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHZhckNhY2hlID0gZW5naW5lLnZhckNhY2hlOwogICAgaWYgKHZhckNhY2hlLnV1aWQpIHsKICAgICAgcmV0dXJuIHZhckNhY2hlLnV1aWQ7CiAgICB9CgogICAgdmFyIHV1aWQgPSBlbmdpbmUuZ2VuZXJhdGVVdWlkKCk7CiAgICB2YXJDYWNoZS51dWlkID0gdXVpZDsKICAgIG1vbm8uc3RvcmFnZS5zZXQoewogICAgICB1dWlkOiB1dWlkCiAgICB9KTsKICAgIHJldHVybiB1dWlkOwogIH07CgogIGVuZ2luZS5nZW5lcmF0ZVV1aWQgPSBmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uKGMpIHsKICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpICogMTYgfCAwLAogICAgICAgIHYgPSBjID09ICd4JyA/IHIgOiAociAmIDB4MyB8IDB4OCk7CiAgICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTsKICAgIH0pOwogIH07CgogIGVuZ2luZS5zb3ZldG5pa0lzQXZhaWxhYmxlID0gZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAoIW1vbm8uaXNGRiAmJiAhbW9uby5pc0Nocm9tZSAmJiAhbW9uby5pc0dNICYmICFtb25vLmlzT3BlcmEpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKG1vbm8uaXNGRiAmJiAhZW5naW5lLnZhckNhY2hlLmZmQnV0dG9uKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChtb25vLmlzQ2hyb21lICYmIG1vbm8uaXNDaHJvbWVNb2JpbGUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLyoqCiAgICogQHJldHVybnMge3N0cmluZ30KICAgKi8KICBlbmdpbmUuZ2V0TmF2TGFuZ3VhZ2UgPSBmdW5jdGlvbigpIHsKICAgIHZhciBsYW5ndWFnZSA9ICcnOwogICAgdmFyIG5hdkxhbmd1YWdlID0gbW9uby5nZXROYXZpZ2F0b3IoKS5sYW5ndWFnZTsKICAgIGlmICgvXlx3ezJ9LXxeXHd7Mn0kLy50ZXN0KG5hdkxhbmd1YWdlKSkgewogICAgICBsYW5ndWFnZSA9IG5hdkxhbmd1YWdlOwogICAgfQogICAgcmV0dXJuIGxhbmd1YWdlOwogIH07CgogIGVuZ2luZS5sb2FkTGFuZ3VhZ2UgPSBmdW5jdGlvbihjYikgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIGxhbmd1YWdlID0gZW5naW5lLmxhbmd1YWdlOwogICAgdmFyIHZhckNhY2hlID0gZW5naW5lLnZhckNhY2hlOwogICAgdmFyIGxhbmdMaXN0ID0gdmFyQ2FjaGUubGFuZ0xpc3Q7CiAgICB2YXIgZGVmYXVsdExvY2FsZSA9IGxhbmdMaXN0WzBdOwogICAgdmFyIGxvY2FsZSA9IG1vbm8uZ2V0TG9hZGVkTG9jYWxlKCk7CiAgICBpZiAoIWxvY2FsZSkgewogICAgICB2YXIgbmF2TGFuZ3VhZ2UgPSBlbmdpbmUuZ2V0TmF2TGFuZ3VhZ2UoKS5zdWJzdHIoMCwgMikudG9Mb3dlckNhc2UoKTsKICAgICAgaWYgKGxhbmdMaXN0LmluZGV4T2YobmF2TGFuZ3VhZ2UpICE9PSAtMSkgewogICAgICAgIGxvY2FsZSA9IG5hdkxhbmd1YWdlOwogICAgICB9IGVsc2UgewogICAgICAgIGxvY2FsZSA9IGRlZmF1bHRMb2NhbGU7CiAgICAgIH0KICAgIH0KCiAgICAoZnVuY3Rpb24gZ2V0TGFuZ3VhZ2UobG9jYWxlLCBjYikgewogICAgICBtb25vLmdldExhbmd1YWdlKGxvY2FsZSwgZnVuY3Rpb24oZXJyLCBfbGFuZ3VhZ2UpIHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICBpZiAobG9jYWxlICE9PSBkZWZhdWx0TG9jYWxlKSB7CiAgICAgICAgICAgIGdldExhbmd1YWdlKGRlZmF1bHRMb2NhbGUsIGNiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNiKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vbm8uZXh0ZW5kKGxhbmd1YWdlLCBfbGFuZ3VhZ2UpOwogICAgICAgICAgY2IoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSkobG9jYWxlLCBjYik7CiAgfTsKCiAgZW5naW5lLmxhbmd1YWdlID0ge307CiAgZW5naW5lLm9wZXJhU2hvd0J1dHRvbiA9IChmdW5jdGlvbigpIHsKICAgIHZhciBidXR0b24gPSBudWxsOwogICAgcmV0dXJuIGZ1bmN0aW9uKGVuYWJsZWQpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBpZiAoYnV0dG9uICE9PSBudWxsKSB7CiAgICAgICAgb3BlcmEuY29udGV4dHMudG9vbGJhci5yZW1vdmVJdGVtKGJ1dHRvbik7CiAgICAgICAgYnV0dG9uID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgIGJ1dHRvbiA9IG9wZXJhLmNvbnRleHRzLnRvb2xiYXIuY3JlYXRlSXRlbSh7CiAgICAgICAgICB0aXRsZTogJ1NhdmVGcm9tLm5ldCBoZWxwZXInLAogICAgICAgICAgaWNvbjogImltZy9pY29uXzE4LnBuZyIsCiAgICAgICAgICBwb3B1cDogewogICAgICAgICAgICBocmVmOiAicG9wdXAuaHRtbCIsCiAgICAgICAgICAgIHdpZHRoOiA0ODIsCiAgICAgICAgICAgIGhlaWdodDogNDA0CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgb3BlcmEuY29udGV4dHMudG9vbGJhci5hZGRJdGVtKGJ1dHRvbik7CiAgICAgIH0KICAgIH07CiAgfSkoKTsKCiAgZW5naW5lLmdtU2hvd0J1dHRvbiA9IGZ1bmN0aW9uKGVuYWJsZWQpIHsKICAgIGlmIChlbmFibGVkKSB7CiAgICAgIF9tZW51LnNldFRpdGxlKGVuZ2luZS5sYW5ndWFnZS5leHROYW1lLCBlbmdpbmUudmFyQ2FjaGUuY3VycmVudFZlcnNpb24pOwogICAgICBtb25vLnN0b3JhZ2UuZ2V0KCdnbUljb25Ub3AnLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgaWYgKHN0b3JhZ2UuZ21JY29uVG9wID09PSAwIHx8IHN0b3JhZ2UuZ21JY29uVG9wKSB7CiAgICAgICAgICBfbWVudS5zdHlsZS5tZW51LmluaXRpYWwudG9wID0gc3RvcmFnZS5nbUljb25Ub3AgKyAncHgnOwogICAgICAgIH0KICAgICAgICBfbWVudS5jcmVhdGUoMSk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgX21lbnUuaGlkZSgpOwogICAgfQogIH07CgogIGVuZ2luZS50YWJMaXN0ZW5lciA9IChmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBpc0xpc3RlbiA9IGZhbHNlOwogICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwogICAgdmFyIGV4dGVuZEpzTGlzdCA9IHt9OwogICAgdmFyIGV4Y2x1ZGVMaXN0ID0gWwogICAgICAiKjovLyouZ29vZ2xlLiovKiIsCiAgICAgICIqOi8vKi5hY2lkdGVzdHMub3JnLyoiLAoKICAgICAgIio6Ly8qLnNhdmVmcm9tLm5ldC8qIiwKICAgICAgIio6Ly8qLnlvdXR1YmUuY29tLyoiLAogICAgICAiKjovLyoudmltZW8uY29tLyoiLAogICAgICAiKjovLyouZGFpbHltb3Rpb24uKi8qIiwKICAgICAgIio6Ly8qLnZrLmNvbS8qIiwKICAgICAgIio6Ly8qLnZrb250YWt0ZS5ydS8qIiwKICAgICAgIio6Ly8qLm9kbm9rbGFzc25pa2kucnUvKiIsCiAgICAgICIqOi8vbXkubWFpbC5ydS8qIiwKICAgICAgIio6Ly8qLm9rLnJ1LyoiLAogICAgICAiKjovLyouc291bmRjbG91ZC5jb20vKiIsCiAgICAgICIqOi8vKi5mYWNlYm9vay5jb20vKiIsCiAgICAgICIqOi8vKi5pbnN0YWdyYW0uY29tLyoiLAogICAgICAiKjovLyoucnV0dWJlLnJ1LyoiCiAgICBdOwogICAgdmFyIG1hdGNoQ2FjaGUgPSBudWxsOwogICAgdmFyIGNoZWNrQmxhY2tMaXN0ID0gZnVuY3Rpb24odXJsKSB7CiAgICAgIHJldHVybiBtYXRjaENhY2hlLnRlc3QodXJsKTsKICAgIH07CiAgICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbih0YWIpIHsKICAgICAgdmFyIHVybCA9IHRhYi51cmw7CiAgICAgIHZhciBpbkJsYWNrTGlzdCA9IGNoZWNrQmxhY2tMaXN0KHVybCk7CiAgICAgIHZhciBzY3JpcHRzID0gW107CgogICAgICB2YXIgYWRkTG0gPSBwcmVmZXJlbmNlcy5sbUZpbGVIb3N0aW5nIHx8IHByZWZlcmVuY2VzLmxtTWVkaWFIb3N0aW5nOwogICAgICB2YXIgYWRkU292ZXRuaWsgPSBwcmVmZXJlbmNlcy5oYXNTb3ZldG5payAmJiBwcmVmZXJlbmNlcy5zb3ZldG5pa0VuYWJsZWQ7CgogICAgICBpZiAobW9uby5pc0Nocm9tZSB8fCBtb25vLmlzRWRnZSkgewogICAgICAgIGFkZFNvdmV0bmlrID0gYWRkU292ZXRuaWsgJiYgd2luZG93LnNvdmV0bmlrOwogICAgICB9IGVsc2UKICAgICAgaWYgKG1vbm8uaXNGRikgewogICAgICAgIGFkZFNvdmV0bmlrID0gYWRkU292ZXRuaWsgJiYgZW5naW5lLmZmU292ZXRuaWsgJiYgZW5naW5lLmZmU292ZXRuaWsuYXBpLmlzUmVhZHk7CiAgICAgIH0KCiAgICAgIGlmICghaW5CbGFja0xpc3QpIHsKICAgICAgICBpZiAoYWRkTG0pIHsKICAgICAgICAgIHNjcmlwdHMucHVzaCgnaW5jbHVkZXMvY29tcG9uZW50cy5qcycpOwogICAgICAgICAgc2NyaXB0cy5wdXNoKCdpbmNsdWRlcy9saW5rX21vZGlmaWVyLmpzJyk7CiAgICAgICAgfQogICAgICAgIGlmIChhZGRTb3ZldG5paykgewogICAgICAgICAgaWYgKG1vbm8uaXNDaHJvbWUgfHwgbW9uby5pc0VkZ2UpIHsKICAgICAgICAgICAgc2NyaXB0cy5wdXNoKCdpbmNsdWRlcy9zb3ZldG5pay1zZi5qcycpOwogICAgICAgICAgfSBlbHNlCiAgICAgICAgICBpZiAobW9uby5pc0ZGKSB7CiAgICAgICAgICAgIGlmICghZW5naW5lLmZmU292ZXRuaWsuaXNEZW55VVJMKHRhYi51cmwpKSB7CiAgICAgICAgICAgICAgZW5naW5lLmZmU292ZXRuaWsuYXBpLm9uVGFiUmVhZHkodGFiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGVtcHR5ID0gdHJ1ZTsKICAgICAgZm9yICh2YXIga2V5IGluIGV4dGVuZEpzTGlzdCkgewogICAgICAgIGVtcHR5ID0gZmFsc2U7CiAgICAgICAgdmFyIGl0ZW0gPSBleHRlbmRKc0xpc3Rba2V5XTsKICAgICAgICBpZiAoIWluQmxhY2tMaXN0IHx8IGl0ZW0ubm9CbGFja0xpc3QpIHsKICAgICAgICAgIHZhciBzY3JpcHRMaXN0ID0gaXRlbS5nZXRTY3JpcHRMaXN0KHVybCk7CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgcGF0aDsgcGF0aCA9IHNjcmlwdExpc3RbaV07IGkrKykgewogICAgICAgICAgICBpZiAoc2NyaXB0cy5pbmRleE9mKHBhdGgpID09PSAtMSkgewogICAgICAgICAgICAgIHNjcmlwdHMucHVzaChwYXRoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFhZGRMbSAmJiAhYWRkU292ZXRuaWsgJiYgZW1wdHkpIHsKICAgICAgICByZW1vdmVMaXN0ZW5lcigpOwogICAgICB9IGVsc2UKICAgICAgaWYgKHNjcmlwdHMubGVuZ3RoKSB7CiAgICAgICAgc2NyaXB0cy51bnNoaWZ0KCdqcy9tb25vLmpzJyk7CgogICAgICAgIG1vbm8uZGVidWcoJ0luamVjdCcsIHVybCwgc2NyaXB0cyk7CgogICAgICAgIHZhciB3b3JrZXIgPSBtb25vLmV4ZWN1dGVTY3JpcHRzKHRhYiwgewogICAgICAgICAgZmlsZXM6IHNjcmlwdHMKICAgICAgICB9KTsKCiAgICAgICAgaWYgKG1vbm8uaXNGRikgewogICAgICAgICAgZW5naW5lLnZhckNhY2hlLm1vbm9MaWIuYWRkUGFnZSh3b3JrZXIpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHZhciByZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uKCkgewogICAgICBtb25vLnRhYnNSZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcik7CiAgICAgIGlzTGlzdGVuID0gZmFsc2U7CiAgICAgIG1vbm8uZGVidWcoJ3RhYkxpc3RlbmVyJywgaXNMaXN0ZW4pOwogICAgfTsKICAgIHZhciBhZGRMaXN0ZW5lciA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIWlzTGlzdGVuKSB7CiAgICAgICAgbW9uby50YWJzQWRkTGlzdGVuZXIobGlzdGVuZXIpOwogICAgICAgIGlzTGlzdGVuID0gdHJ1ZTsKICAgICAgICBtb25vLmRlYnVnKCd0YWJMaXN0ZW5lcicsIGlzTGlzdGVuKTsKICAgICAgfQogICAgfTsKICAgIHZhciBidWlsZE1hdGNoQ2FjaGUgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCFtYXRjaENhY2hlKSB7CiAgICAgICAgbWF0Y2hDYWNoZSA9IGV4Y2x1ZGVMaXN0Lm1hcChmdW5jdGlvbihwYXR0ZXJuKSB7CiAgICAgICAgICByZXR1cm4gbW9uby51cmxQYXR0ZXJuVG9TdHJSZShwYXR0ZXJuKTsKICAgICAgICB9KS5qb2luKCd8Jyk7CiAgICAgICAgbWF0Y2hDYWNoZSA9IG5ldyBSZWdFeHAobWF0Y2hDYWNoZSk7CiAgICAgIH0KICAgIH07CiAgICB2YXIgZW5hYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChtb25vLmlzQ2hyb21lIHx8IG1vbm8uaXNGRiB8fCBtb25vLmlzRWRnZSkgewogICAgICAgIGJ1aWxkTWF0Y2hDYWNoZSgpOwogICAgICAgIGFkZExpc3RlbmVyKCk7CiAgICAgIH0KICAgIH07CiAgICB2YXIgZGlzYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAobW9uby5pc0Nocm9tZSB8fCBtb25vLmlzRkYgfHwgbW9uby5pc0VkZ2UpIHsKICAgICAgICByZW1vdmVMaXN0ZW5lcigpOwogICAgICB9CiAgICB9OwogICAgdmFyIGluamVjdExtSW5BY3RpdmVUYWIgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNjcmlwdHMgPSBbCiAgICAgICAgJ2pzL21vbm8uanMnLAogICAgICAgICdpbmNsdWRlcy9jb21wb25lbnRzLmpzJywKICAgICAgICAnaW5jbHVkZXMvbGlua19tb2RpZmllci5qcycKICAgICAgXTsKCiAgICAgIG1vbm8uZ2V0QWN0aXZlVGFiKGZ1bmN0aW9uKHRhYikgewogICAgICAgIGlmICh0YWIgJiYgL15odHRwLy50ZXN0KHRhYi51cmwpICYmICFjaGVja0JsYWNrTGlzdCh0YWIudXJsKSkgewogICAgICAgICAgdmFyIHdvcmtlciA9IG1vbm8uZXhlY3V0ZVNjcmlwdHModGFiLCB7CiAgICAgICAgICAgIGZpbGVzOiBzY3JpcHRzCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAobW9uby5pc0ZGKSB7CiAgICAgICAgICAgIGVuZ2luZS52YXJDYWNoZS5tb25vTGliLmFkZFBhZ2Uod29ya2VyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICAgIHJldHVybiB7CiAgICAgIGV4dGVuZEpzTGlzdDogZXh0ZW5kSnNMaXN0LAogICAgICBleGNsdWRlTGlzdDogZXhjbHVkZUxpc3QsCiAgICAgIGVuYWJsZTogZW5hYmxlLAogICAgICBkaXNhYmxlOiBkaXNhYmxlLAogICAgICBpbmplY3RMbUluQWN0aXZlVGFiOiBpbmplY3RMbUluQWN0aXZlVGFiCiAgICB9CiAgfSkoKTsKCiAgZW5naW5lLmNvaG9ydCA9IChmdW5jdGlvbigpIHsKICAgIHZhciBzdG9yZSA9IHt9OwogICAgdmFyIHNhdmUgPSBmdW5jdGlvbigpIHsKICAgICAgbW9uby5zdG9yYWdlLnNldCh7CiAgICAgICAgY29ob3J0OiBzdG9yZQogICAgICB9KTsKICAgIH07CiAgICB2YXIgc2V0U3RvcmUgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICB2YWx1ZSAmJiBtb25vLmV4dGVuZChzdG9yZSwgdmFsdWUpOwogICAgfTsKICAgIHZhciBpc0FsbG93ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlOwogICAgICBpZiAoaW5kZXggPT09IDEpIHsKICAgICAgICByZXN1bHQgPSBtb25vLmlzR00gfHwgZW5naW5lLnByZWZlcmVuY2VzLnNmSGVscGVyTmFtZSA9PT0gJ2ZmLXNmJyB8fCBtb25vLmlzU2FmYXJpIHx8IG1vbm8uaXNPcGVyYSB8fCBtb25vLmlzQ2hyb21lOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogICAgdmFyIHNldEluZGV4ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgZW5naW5lLnByZWZlcmVuY2VzLmNvaG9ydEluZGV4ID0gaW5kZXg7CiAgICAgIG1vbm8uZGVidWcoJ0NvaG9ydCcsIGluZGV4KTsKICAgIH07CiAgICB2YXIgcnVuID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChzdG9yZS5pbmRleCAmJiBpc0FsbG93KHN0b3JlLmluZGV4KSkgewogICAgICAgIHNldEluZGV4KHN0b3JlLmluZGV4KTsKICAgICAgfQogICAgfTsKICAgIHZhciBmaXJzdFJ1biA9IGZ1bmN0aW9uKCkgewogICAgICAvKnN0b3JlLmluZGV4ID0gcGFyc2VJbnQoJ2NvaG9ydCBpbmRleCcpOwoKICAgICAgaWYgKHRoaXMuaXNBbGxvdyhzdG9yZS5pbmRleCkpIHsKICAgICAgICBzYXZlKCk7CiAgICAgICAgc2V0SW5kZXgoc3RvcmUuaW5kZXgpOwogICAgICB9Ki8KICAgIH07CiAgICB2YXIgc2VuZERhdGEgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgdmFyIHV1aWQgPSBlbmdpbmUuZ2V0VXVpZCgpOwogICAgICB2YXIgdGlkTGlzdCA9IHsKICAgICAgICAxOiAnVUEtNzA1NTA1NS04JywKICAgICAgICAyOiBudWxsLAogICAgICAgIDM6IG51bGwsCiAgICAgICAgNDogbnVsbAogICAgICB9OwoKICAgICAgdmFyIGRlZmF1bHRQYXJhbXMgPSB7CiAgICAgICAgdjogMSwKICAgICAgICB1bDogbW9uby5nZXROYXZpZ2F0b3IoKS5sYW5ndWFnZSwKICAgICAgICB0aWQ6IHRpZExpc3Rbc3RvcmUuaW5kZXhdLAogICAgICAgIGNpZDogdXVpZAogICAgICB9OwoKICAgICAgZm9yICh2YXIga2V5IGluIGRlZmF1bHRQYXJhbXMpIHsKICAgICAgICBpZiAoIXBhcmFtcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICBwYXJhbXNba2V5XSA9IGRlZmF1bHRQYXJhbXNba2V5XTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghcGFyYW1zLnRpZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgbW9uby5kZWJ1ZygnQ29ob3J0IHRyYWNrJywgcGFyYW1zKTsKCiAgICAgIHJldHVybiBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogJ2h0dHBzOi8vd3d3Lmdvb2dsZS1hbmFseXRpY3MuY29tL2NvbGxlY3QnLAogICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICBkYXRhOiBtb25vLnBhcmFtKHBhcmFtcykKICAgICAgfSk7CiAgICB9OwogICAgdmFyIHRyYWNrID0gZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgIGlmIChlbmdpbmUudHJhY2tWYWxpZGF0ZShwYXJhbXMpKSB7CiAgICAgICAgc2VuZERhdGEocGFyYW1zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtb25vLmVycm9yKCdJbnZhbGlkIHRyYWNrIHBhcmFtcyEnLCBwYXJhbXMpOwogICAgICB9CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgc2V0U3RvcmU6IHNldFN0b3JlLAogICAgICBmaXJzdFJ1bjogZmlyc3RSdW4sCiAgICAgIHJ1bjogcnVuLAogICAgICB0cmFjazogdHJhY2sKICAgIH0KICB9KSgpOwoKICBlbmdpbmUuZ2V0Q291bnRyeSA9IGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwogICAgdmFyIHZhckNhY2hlID0gZW5naW5lLnZhckNhY2hlOwoKICAgIHZhciBnZXRDb3VudHJ5RnJvbUxhbmd1YWdlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgICAgdmFyIGxhbmcyY291bnRyeSA9IHsKICAgICAgICBiZTogJ2J5JywKICAgICAgICBrazogJ2t6JywKICAgICAgICBydTogJ3J1JywKICAgICAgICB1azogJ3VhJywKICAgICAgICBoeTogJ2FtJywKICAgICAgICBybzogJ21kJywKICAgICAgICBhejogJ2F6JywKICAgICAgICBrYTogJ2dlJywKICAgICAgICBreTogJ2tnJywKICAgICAgICB1ejogJ3V6JywKICAgICAgICBsdjogJ2x2JywKICAgICAgICBsdDogJ2x0JywKICAgICAgICBldDogJ2VlJywKICAgICAgICB0ZzogJ3RqJywKICAgICAgICBmaTogJ2ZpJywKICAgICAgICB0azogJ3RtJwogICAgICB9OwoKICAgICAgdmFyIG5hdkxhbmd1YWdlID0gZW5naW5lLmdldE5hdkxhbmd1YWdlKCkuc3Vic3RyKDAsIDIpLnRvTG93ZXJDYXNlKCk7CiAgICAgIHZhciBjb3VudHJ5ID0gbGFuZzJjb3VudHJ5W25hdkxhbmd1YWdlXTsKCiAgICAgIG1vbm8uYXN5bmNGbihjYWxsYmFjaykoY291bnRyeSk7CiAgICB9OwoKICAgIHZhciByZXF1ZXN0Q291bnRyeSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgIHZhciB4aCA9IHByZWZlcmVuY2VzLnNmSGVscGVyTmFtZSArICcgJyArIHZhckNhY2hlLmN1cnJlbnRWZXJzaW9uOwogICAgICBtb25vLnJlcXVlc3QoewogICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICB1cmw6ICdodHRwOi8vc2YtaGVscGVyLmNvbS9nZW9pcC9jb3VudHJ5LnBocCcsCiAgICAgICAgZGF0YTogewogICAgICAgICAgc2lnOiB4aC5sZW5ndGgKICAgICAgICB9LAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICdYLUhlbHBlcic6IHhoCiAgICAgICAgfQogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICB2YXIgY291bnRyeSA9ICcnOwogICAgICAgIGlmICghZXJyICYmIGRhdGEpIHsKICAgICAgICAgIGNvdW50cnkgPSBkYXRhLnRvTG93ZXJDYXNlKCkuc3Vic3RyKDAsIDIpOwogICAgICAgIH0KICAgICAgICBjYWxsYmFjayhjb3VudHJ5KTsKICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvbkdldExhbmd1YWdlID0gZnVuY3Rpb24oY291bnRyeSkgewogICAgICBtb25vLmRlYnVnKCdTZXQgY291bnRyeScsIGNvdW50cnkpOwogICAgICBwcmVmZXJlbmNlcy5jb3VudHJ5ID0gY291bnRyeTsKICAgICAgbW9uby5zdG9yYWdlLnNldCh7CiAgICAgICAgY291bnRyeTogY291bnRyeQogICAgICB9KTsKICAgICAgZW5naW5lLmxpdGVTdG9yYWdlLnNldEV4cGlyZSgnY291bnRyeUV4cGlyZScsIDI1OTIwMCk7CgogICAgICBlbmdpbmUubG9hZGVyLnJlYWR5KCdnZXRDb3VudHJ5Jyk7CiAgICB9OwoKICAgIHZhciBpc0V4cGlyZSA9IGVuZ2luZS5saXRlU3RvcmFnZS5pc0V4cGlyZSgnY291bnRyeUV4cGlyZScpOwogICAgdmFyIGlzVGltZW91dCA9IGVuZ2luZS5saXRlU3RvcmFnZS5pc1RpbWVvdXQoJ2NvdW50cnlUaW1lb3V0Jyk7CiAgICBpZiAoaXNFeHBpcmUgJiYgIWlzVGltZW91dCkgewogICAgICBlbmdpbmUubGl0ZVN0b3JhZ2Uuc2V0VGltZW91dCgnY291bnRyeVRpbWVvdXQnLCA4NjQwMCk7CgogICAgICBnZXRDb3VudHJ5RnJvbUxhbmd1YWdlKGZ1bmN0aW9uKGNvdW50cnkpIHsKICAgICAgICBpZiAoY291bnRyeSkgewogICAgICAgICAgbW9uby5kZWJ1ZygnR2V0IGNvdW50cnkgdmlhIGxhbmd1YWdlJywgY291bnRyeSk7CiAgICAgICAgICBvbkdldExhbmd1YWdlKGNvdW50cnkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXF1ZXN0Q291bnRyeShmdW5jdGlvbihjb3VudHJ5KSB7CiAgICAgICAgICAgIG1vbm8uZGVidWcoJ0dldCBjb3VudHJ5IHZpYSBhcGknLCBjb3VudHJ5KTsKICAgICAgICAgICAgaWYgKGNvdW50cnkpIHsKICAgICAgICAgICAgICBvbkdldExhbmd1YWdlKGNvdW50cnkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1vbm8uZGVidWcoJ0FwaSBjb3VudHJ5IGlzIGVtcHR5IScpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH07CgogIGVuZ2luZS5mb3JjZU1ldGFSZXF1ZXN0ID0gZmFsc2U7CgogIGVuZ2luZS5nZXRNZXRhID0gKGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHZhckNhY2hlID0gZW5naW5lLnZhckNhY2hlOwogICAgdmFyIGRlZmF1bHRNZXRhID0gewogICAgICAiZXhwIjogewogICAgICAgICI0OCI6IHsKICAgICAgICAgICJlbmFibGUiOiB0cnVlLAogICAgICAgICAgInBlcmNlbnQiOiAzMwogICAgICAgIH0sCiAgICAgICAgIjQ5IjogewogICAgICAgICAgImVuYWJsZSI6IHRydWUsCiAgICAgICAgICAicGVyY2VudCI6IDMzCiAgICAgICAgfSwKICAgICAgICAiNTAiOiB7CiAgICAgICAgICAiZW5hYmxlIjogdHJ1ZSwKICAgICAgICAgICJwZXJjZW50IjogMzMKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIGN1cnJlbnREYXRlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgIHZhciBkYXRlID0gX2RhdGUuZ2V0RGF0ZSgpOwogICAgICB2YXIgbW9udGggPSBfZGF0ZS5nZXRNb250aCgpICsgMTsKICAgICAgdmFyIGNEYXRlID0gJyc7CgogICAgICBjRGF0ZSArPSBkYXRlIDwgMTAgPyAnMCcgKyBkYXRlIDogZGF0ZTsKICAgICAgY0RhdGUgKz0gbW9udGggPCAxMCA/ICcwJyArIG1vbnRoIDogbW9udGg7CiAgICAgIGNEYXRlICs9IF9kYXRlLmdldEZ1bGxZZWFyKCk7CgogICAgICByZXR1cm4gY0RhdGU7CiAgICB9OwoKICAgIHZhciByZXF1ZXN0TWV0YSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgIGVuZ2luZS5saXRlU3RvcmFnZS5zZXRUaW1lb3V0KCdtZXRhVGltZW91dCcsIDIxNjAwKTsKCiAgICAgIHZhciBhbHdheXMgPSBtb25vLm9uY2VGbihmdW5jdGlvbihlcnIsIG1ldGEpIHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICBtb25vLmRlYnVnKCdNZXRhIHJlcXVlc3QgZXJyb3IhJywgZXJyKTsKICAgICAgICB9CgogICAgICAgIHZhciB0cmFja0xhYmVsID0gJyc7CiAgICAgICAgaWYgKG1vbm8uaXNHTSAmJiB2YXJDYWNoZS5pc0ZpcnN0cnVuKSB7CiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHRyYWNrTGFiZWwgPSAnbWV0YSBsb2FkIGVycm9yICcgKyBlcnI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cmFja0xhYmVsID0gJ21ldGEgbG9hZGVkJzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh2YXJDYWNoZS5pc0ZpcnN0cnVuICYmICFtZXRhKSB7CiAgICAgICAgICBtZXRhID0gZGVmYXVsdE1ldGE7CiAgICAgICAgfQoKICAgICAgICBpZiAobWV0YSkgewogICAgICAgICAgdmFyIF9tZXRhID0gdmFyQ2FjaGUubWV0YTsKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBfbWV0YSkgewogICAgICAgICAgICBkZWxldGUgX21ldGFba2V5XTsKICAgICAgICAgIH0KCiAgICAgICAgICBtb25vLmV4dGVuZChfbWV0YSwgbWV0YSk7CgogICAgICAgICAgZW5naW5lLmxvYWRlci5yZWFkeSgnZ2V0TWV0YScpOwogICAgICAgIH0KCiAgICAgICAgY2FsbGJhY2soKTsKCiAgICAgICAgdHJhY2tMYWJlbCAmJiBlbmdpbmUudHJhY2soewogICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgIGVjOiAnbWV0YScsCiAgICAgICAgICBlYTogJ3VzZScsCiAgICAgICAgICBlbDogdHJhY2tMYWJlbC5zdWJzdHIoMCwgMTUwKSwKICAgICAgICAgIHRpZDogJ1VBLTY3NzM4MTMwLTYnCiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgbW9uby5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGFsd2F5cygnVElNRU9VVCcpOwogICAgICB9LCA2MDAwKTsKCiAgICAgIHJldHVybiBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogJ2h0dHA6Ly9zZi1oZWxwZXIuY29tL21ldGEvbWV0YS5qc29uJyArICc/Xz0nICsgY3VycmVudERhdGUoKSwKICAgICAgICBqc29uOiB0cnVlCiAgICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcCwganNvbikgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIGFsd2F5cyhlcnIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtb25vLnN0b3JhZ2Uuc2V0KHsKICAgICAgICAgICAgbWV0YToganNvbgogICAgICAgICAgfSk7CiAgICAgICAgICBlbmdpbmUubGl0ZVN0b3JhZ2Uuc2V0RXhwaXJlKCdtZXRhRXhwaXJlJywgODY0MDApOwogICAgICAgICAgYWx3YXlzKG51bGwsIGpzb24pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBnZXRNZXRhID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgICAgdmFyIG9uY2VDYiA9IG1vbm8ub25jZUZuKGNhbGxiYWNrKTsKICAgICAgdmFyIGlzRXhwaXJlID0gZW5naW5lLmxpdGVTdG9yYWdlLmlzRXhwaXJlKCdtZXRhRXhwaXJlJyk7CiAgICAgIHZhciBpc1RpbWVvdXQgPSBlbmdpbmUubGl0ZVN0b3JhZ2UuaXNUaW1lb3V0KCdtZXRhVGltZW91dCcpOwogICAgICBpZiAobW9uby5pc0VtcHR5T2JqZWN0KGVuZ2luZS5leHBMaXN0KSAmJiAhZW5naW5lLmZvcmNlTWV0YVJlcXVlc3QpIHsKICAgICAgICBtb25vLmRlYnVnKCdNZXRhIG5vdCByZXF1aXJlJyk7CiAgICAgICAgb25jZUNiKCk7CiAgICAgIH0gZWxzZQogICAgICBpZiAodmFyQ2FjaGUuaXNGaXJzdHJ1biB8fCB2YXJDYWNoZS5pc1VwZ3JhZGUpIHsKICAgICAgICBtb25vLmRlYnVnKCdNZXRhIGZvcmNlIHJlcXVlc3QnKTsKICAgICAgICByZXF1ZXN0TWV0YShmdW5jdGlvbigpIHsKICAgICAgICAgIG9uY2VDYigpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UKICAgICAgaWYgKGlzVGltZW91dCkgewogICAgICAgIG1vbm8uZGVidWcoJ01ldGEgdGltZW91dCcpOwogICAgICAgIG9uY2VDYigpOwogICAgICB9IGVsc2UKICAgICAgaWYgKGlzRXhwaXJlKSB7CiAgICAgICAgbW9uby5kZWJ1ZygnTWV0YSBpcyBleHBpcmUnKTsKICAgICAgICByZXF1ZXN0TWV0YShmdW5jdGlvbigpIHsKICAgICAgICAgIG9uY2VDYigpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIG1vbm8uZGVidWcoJ01ldGEgaXMgZnJlc2gnKTsKICAgICAgICBvbmNlQ2IoKTsKICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gZ2V0TWV0YTsKICB9KSgpOwoKICBlbmdpbmUubG9hZGVyLndoZW4oJ3ByZXBhcmUnLCBmdW5jdGlvbigpIHsKICAgIHZhciBwcm9taXNlID0gbW9uby5Qcm9taXNlLnJlc29sdmUoKTsKCiAgICBpZiAoZW5naW5lLmxpdGVTdG9yYWdlLmdldCgnZnJvbUlkJywgMCkpIHsKICAgICAgcmV0dXJuIHByb21pc2U7CiAgICB9CgogICAgaWYgKG1vbm8uaXNHTSAmJiBtb25vLmlzSWZyYW1lKCkpIHsKICAgICAgcmV0dXJuIHByb21pc2U7CiAgICB9CgogICAgdmFyIHJlcXVlc3RGcm9tSWQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG1vbm8ucmVxdWVzdFByb21pc2UoewogICAgICAgIHVybDogJ2h0dHA6Ly9zYXZlZnJvbS5uZXQvdG9vbHMvZ2V0X3ZpZC5waHAnCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcCwgZGF0YSkgewogICAgICAgIHZhciBpZCA9IC0xOwogICAgICAgIGlmICgvXlxkKyQvLnRlc3QoZGF0YSkpIHsKICAgICAgICAgIGlkID0gcGFyc2VJbnQoZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBtb25vLmRlYnVnKCdmcm9tSWQnLCBpZCk7CgogICAgICAgIGVuZ2luZS5saXRlU3RvcmFnZS5zZXQoJ2Zyb21JZCcsIGlkKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgcmV0dXJuIG1vbm8uZXJyb3IoIlJlcXVlc3QgZnJvbUlkIGVycm9yISIsIGVycik7CiAgICAgIH0pCiAgICB9OwoKICAgIHByb21pc2UgPSBwcm9taXNlLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpc1RpbWVvdXQgPSBlbmdpbmUubGl0ZVN0b3JhZ2UuaXNUaW1lb3V0KCdmcm9tSWRUaW1lb3V0Jyk7CiAgICAgIGlmIChpc1RpbWVvdXQpIHsKICAgICAgICByZXR1cm4gbW9uby5kZWJ1ZygnUmVxdWVzdCBmcm9tSWQgdGltZW91dCcpOwogICAgICB9IGVsc2UgewogICAgICAgIGVuZ2luZS5saXRlU3RvcmFnZS5zZXRUaW1lb3V0KCdmcm9tSWRUaW1lb3V0JywgMjE2MDApOwogICAgICAgIHJldHVybiByZXF1ZXN0RnJvbUlkKCk7CiAgICAgIH0KICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikgewogICAgICBtb25vLmVycm9yKCdSZXF1ZXN0IGZyb21JZCBlcnJvcicsIGVycik7CiAgICB9KTsKCiAgICByZXR1cm4gcHJvbWlzZTsKICB9KTsKCiAgZW5naW5lLmxvYWRlci53aGVuKCdpbml0JywgZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAoIW1vbm8uaXNTYWZhcmkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNhZmFyaS5leHRlbnNpb24uc2V0dGluZ3MuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LmtleSAhPT0gJ3Nob3dfb3B0aW9ucycpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbW9uby5vcGVuVGFiKHNhZmFyaS5leHRlbnNpb24uYmFzZVVSSSArICdvcHRpb25zLmh0bWwnLCB0cnVlKTsKICAgIH0pOwoKICAgIHZhciBjaGVja0ludGVydmFsID0gbnVsbDsKCiAgICB2YXIgcmVtb3ZlUG9wb3ZlciA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoY2hlY2tJbnRlcnZhbCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwoY2hlY2tJbnRlcnZhbCk7CiAgICAgICAgY2hlY2tJbnRlcnZhbCA9IG51bGw7CiAgICAgIH0KCiAgICAgIHNhZmFyaS5leHRlbnNpb24udG9vbGJhckl0ZW1zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7CiAgICAgICAgaWYgKGJ0bi5wb3BvdmVyKSB7CiAgICAgICAgICBpZiAoYnRuLnBvcG92ZXIudmlzaWJsZSkgewogICAgICAgICAgICBidG4ucG9wb3Zlci5oaWRlKCk7CiAgICAgICAgICB9CiAgICAgICAgICBidG4ucG9wb3ZlciA9IG51bGw7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHNhZmFyaS5leHRlbnNpb24ucmVtb3ZlUG9wb3ZlcigncG9wdXAnKTsKICAgIH07CgogICAgc2FmYXJpLmFwcGxpY2F0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbW1hbmQnLCBmdW5jdGlvbihlKSB7CiAgICAgIGlmIChlLmNvbW1hbmQgPT09ICdvcGVuUG9wdXAnKSB7CiAgICAgICAgdmFyIGN1cnJlbnRCdG4gPSBudWxsOwogICAgICAgIHZhciBhY3RpdmVXaW5kb3cgPSBzYWZhcmkuYXBwbGljYXRpb24uYWN0aXZlQnJvd3NlcldpbmRvdzsKICAgICAgICBzYWZhcmkuZXh0ZW5zaW9uLnRvb2xiYXJJdGVtcy5zb21lKGZ1bmN0aW9uKGJ0bikgewogICAgICAgICAgaWYgKGJ0bi5icm93c2VyV2luZG93ID09PSBhY3RpdmVXaW5kb3cpIHsKICAgICAgICAgICAgY3VycmVudEJ0biA9IGJ0bjsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKCFjdXJyZW50QnRuKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VycmVudEJ0bi5wb3BvdmVyICYmIGN1cnJlbnRCdG4ucG9wb3Zlci52aXNpYmxlKSB7CiAgICAgICAgICBjdXJyZW50QnRuLnBvcG92ZXIuaGlkZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmVtb3ZlUG9wb3ZlcigpOwoKICAgICAgICBjdXJyZW50QnRuLnBvcG92ZXIgPSBzYWZhcmkuZXh0ZW5zaW9uLmNyZWF0ZVBvcG92ZXIoJ3BvcHVwJywgc2FmYXJpLmV4dGVuc2lvbi5iYXNlVVJJICsgJ3BvcHVwLmh0bWwnLCA0ODIsIDQwNCk7CiAgICAgICAgY3VycmVudEJ0bi5zaG93UG9wb3ZlcigpOwoKICAgICAgICBjaGVja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgaXNTaG93TWVudSA9IHNhZmFyaS5leHRlbnNpb24udG9vbGJhckl0ZW1zLnNvbWUoZnVuY3Rpb24oYnRuKSB7CiAgICAgICAgICAgIGlmIChidG4ucG9wb3ZlciAmJiBidG4ucG9wb3Zlci52aXNpYmxlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKCFpc1Nob3dNZW51KSB7CiAgICAgICAgICAgIHJlbW92ZVBvcG92ZXIoKTsKICAgICAgICAgIH0KICAgICAgICB9LCAxMDAwICogMzApOwogICAgICB9CiAgICB9LCBmYWxzZSk7CiAgfSk7CgogIGVuZ2luZS5vbk9wdGlvbkNoYW5nZSA9IHsKICAgIGJ1dHRvbjogZnVuY3Rpb24oZW5hYmxlZCkgewogICAgICBpZiAobW9uby5pc09wZXJhKSB7CiAgICAgICAgZW5naW5lLm9wZXJhU2hvd0J1dHRvbihlbmFibGVkKTsKICAgICAgfSBlbHNlCiAgICAgIGlmIChtb25vLmlzR00pIHsKICAgICAgICBlbmdpbmUuZ21TaG93QnV0dG9uKGVuYWJsZWQpOwogICAgICB9CiAgICB9LAogICAgc292ZXRuaWtFbmFibGVkOiBmdW5jdGlvbih2YWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgdmFyIG9uQ2hhbmdlRnVuYyA9IGVuZ2luZS5vbk9wdGlvbkNoYW5nZS5zb3ZldG5pa0VuYWJsZWQ7CiAgICAgIGlmICh2YWx1ZSA9PT0gb2xkVmFsdWUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChlbmdpbmUucHJlZmVyZW5jZXMuaGFzU292ZXRuaWspIHsKICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgIGVuZ2luZS50YWJMaXN0ZW5lci5lbmFibGUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChtb25vLmlzT3BlcmEgfHwgbW9uby5pc0Nocm9tZSkgewogICAgICAgICAgaWYgKHdpbmRvdy5zb3ZldG5payAmJiB3aW5kb3cuc292ZXRuaWsuc2V0UmVtb3ZlZFN0YXRlKSB7CiAgICAgICAgICAgIHdpbmRvdy5zb3ZldG5pay5zZXRSZW1vdmVkU3RhdGUoIXZhbHVlKQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG1vbm8uaXNGRikgewogICAgICAgICAgaWYgKGVuZ2luZS5mZlNvdmV0bmlrICYmIGVuZ2luZS5mZlNvdmV0bmlrLmFwaS5pc1JlYWR5KSB7CiAgICAgICAgICAgIGVuZ2luZS5mZlNvdmV0bmlrLmFwaS5zZXRSZW1vdmVkU3RhdGUoIXZhbHVlKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlCiAgICAgIGlmIChlbmdpbmUucHJlZmVyZW5jZXMuaGFzRFApIHsKICAgICAgICBvbkNoYW5nZUZ1bmMuZHBPbkNoYW5nZSAmJiBvbkNoYW5nZUZ1bmMuZHBPbkNoYW5nZSgpOwogICAgICB9CiAgICB9LAogICAgc3RhdEVuYWJsZWQ6IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAgIGVuZ2luZS5ldmVudHMuZW1pdCgnc3RhdEVuYWJsZWRDaGFuZ2UnLCBzdGF0ZSk7CiAgICB9LAogICAgbG1GaWxlSG9zdGluZzogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgZW5naW5lLnRhYkxpc3RlbmVyLmVuYWJsZSgpOwogICAgICB9CiAgICB9LAogICAgbG1NZWRpYUhvc3Rpbmc6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSkgewogICAgICAgIGVuZ2luZS50YWJMaXN0ZW5lci5lbmFibGUoKTsKICAgICAgfQogICAgfSwKICAgIGdtTmF0aXZlRG93bmxvYWQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIGlmICghbW9uby5pc0dNKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGVuZ2luZS5wcmVmZXJlbmNlcy5kb3dubG9hZHMgPSAhIXZhbHVlOwogICAgICBpZiAobW9uby5nbG9iYWwucHJlZmVyZW5jZSkgewogICAgICAgIC8vIEdNIG9ubHkhCiAgICAgICAgbW9uby5nbG9iYWwucHJlZmVyZW5jZS5kb3dubG9hZHMgPSBlbmdpbmUucHJlZmVyZW5jZXMuZG93bmxvYWRzOwogICAgICB9CiAgICB9CiAgfTsKCiAgZW5naW5lLnNlbmRJbkdhID0gKGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHN0YWNrID0gW107CiAgICB2YXIgbG9jayA9IGZhbHNlOwogICAgdmFyIHNlbmQgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKGxvY2sgfHwgIXN0YWNrLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgbG9jayA9IHRydWU7CgogICAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTsKICAgICAgdmFyIGl0ZW0gPSBzdGFja1swXTsKICAgICAgdmFyIHRpbWUgPSBpdGVtLnRpbWU7CiAgICAgIHZhciBwYXJhbXMgPSBpdGVtLnBhcmFtczsKICAgICAgdmFyIGRldGFpbHMgPSBpdGVtLmRldGFpbHM7CgogICAgICB2YXIgcXQgPSBub3cgLSB0aW1lOwogICAgICBpZiAocXQgPj0gMTQ0MDAwMDApIHsKICAgICAgICBxdCA9IDE0NDAwMDAwIC0gKChzdGFjay5sZW5ndGggKyAxKSAqIDEwMDApOwogICAgICB9CiAgICAgIHBhcmFtcy5xdCA9IHF0OwoKICAgICAgcmV0dXJuIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiAnaHR0cHM6Ly93d3cuZ29vZ2xlLWFuYWx5dGljcy5jb20vY29sbGVjdD96PScgKyBub3csCiAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgIGRhdGE6IG1vbm8ucGFyYW0ocGFyYW1zKSwKICAgICAgICB0aW1lb3V0OiA2MCAqIDEwMDAKICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgbG9jayA9IGZhbHNlOwogICAgICAgIGlmICghZXJyKSB7CiAgICAgICAgICB2YXIgcG9zID0gc3RhY2suaW5kZXhPZihpdGVtKTsKICAgICAgICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgICAgICAgIHN0YWNrLnNwbGljZShwb3MsIDEpOwogICAgICAgICAgfQoKICAgICAgICAgIGRldGFpbHMub25TdWNjZXNzICYmIGRldGFpbHMub25TdWNjZXNzKCk7CgogICAgICAgICAgc2VuZCgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBwdWxsID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghc3RhY2subGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgaXNUaW1lb3V0ID0gZW5naW5lLmxpdGVTdG9yYWdlLmlzVGltZW91dCgnc2VuZEluR2FUaW1lb3V0Jyk7CiAgICAgIGlmICghaXNUaW1lb3V0KSB7CiAgICAgICAgZW5naW5lLmxpdGVTdG9yYWdlLnNldFRpbWVvdXQoJ3NlbmRJbkdhVGltZW91dCcsIDEgKiA2MCAqIDYwKTsKICAgICAgICBzZW5kKCk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqQHBhcmFtIHtPYmplY3R9IHBhcmFtcwogICAgICpAcGFyYW0ge09iamVjdH0gW2RldGFpbHNdCiAgICAgKkBwYXJhbSB7U3RyaW5nfSBkZXRhaWxzLmlkCiAgICAgKkBwYXJhbSB7RnVuY3Rpb259IGRldGFpbHMub25TdWNjZXNzCiAgICAgKiovCiAgICB2YXIgcHVzaCA9IGZ1bmN0aW9uKHBhcmFtcywgZGV0YWlscykgewogICAgICB2YXIgZXhpc3RzID0gZmFsc2U7CiAgICAgIGRldGFpbHMgPSBkZXRhaWxzIHx8IHt9OwoKICAgICAgaWYgKGRldGFpbHMuaWQpIHsKICAgICAgICBleGlzdHMgPSBzdGFjay5zb21lKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLmRldGFpbHMuaWQgPT09IGRldGFpbHMuaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmICghZXhpc3RzKSB7CiAgICAgICAgc3RhY2sudW5zaGlmdCh7CiAgICAgICAgICB0aW1lOiBEYXRlLm5vdygpLAogICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICBkZXRhaWxzOiBkZXRhaWxzCiAgICAgICAgfSk7CgogICAgICAgIHN0YWNrLnNwbGljZSgxMDApOwoKICAgICAgICBzZW5kKCk7CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgc3RhY2s6IHN0YWNrLAogICAgICBwdXNoOiBwdXNoLAogICAgICBwdWxsOiBwdWxsCiAgICB9OwogIH0pKCk7CgogIGVuZ2luZS5hY3Rpb25MaXN0ID0gewogICAgZ2V0TWVudURldGFpbHM6IGZ1bmN0aW9uKG1zZywgcmVzcG9uc2UpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgZ2V0TGFzdFZlcnNpb24gPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgY3VycmVudFZlcnNpb24gPSBlbmdpbmUudmFyQ2FjaGUuY3VycmVudFZlcnNpb247CiAgICAgICAgdmFyIGxhc3RWZXJzaW9uID0gZW5naW5lLmxpdGVTdG9yYWdlLmdldCgnbGFzdFZlcnNpb24nLCAnJyk7CiAgICAgICAgaWYgKCFjdXJyZW50VmVyc2lvbiB8fCAhbGFzdFZlcnNpb24pIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKGN1cnJlbnRWZXJzaW9uLmluZGV4T2YobGFzdFZlcnNpb24pID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gY3VycmVudFZlcnNpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBsYXN0VmVyc2lvbjsKICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICBsYW5ndWFnZTogZW5naW5lLmxhbmd1YWdlLAogICAgICAgIHByZWZlcmVuY2VzOiBlbmdpbmUucHJlZmVyZW5jZXMsCiAgICAgICAgdmVyc2lvbjogZW5naW5lLnZhckNhY2hlLmN1cnJlbnRWZXJzaW9uLAogICAgICAgIGxhc3RWZXJzaW9uOiBnZXRMYXN0VmVyc2lvbigpLAogICAgICAgIGhlbHBlck5hbWU6IGVuZ2luZS52YXJDYWNoZS5oZWxwZXJOYW1lCiAgICAgIH07CgogICAgICByZXR1cm4gcmVzcG9uc2UoZGV0YWlscyk7CiAgICB9LAogICAgZ2V0TGFuZ3VhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgIGNiKGVuZ2luZS5sYW5ndWFnZSk7CiAgICB9LAogICAgZ2V0UHJlZmVyZW5jZTogZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwogICAgICBpZiAobW9uby5pc1NhZmFyaSB8fCBtb25vLmlzR00pIHsKICAgICAgICBwcmVmZXJlbmNlcyA9IG1vbm8uZXh0ZW5kKHt9LCBlbmdpbmUucHJlZmVyZW5jZXMpOwogICAgICB9CgogICAgICBjYihwcmVmZXJlbmNlcyk7CgogICAgICBlbmdpbmUudXNlclRyYWNrKCk7CgogICAgICBlbmdpbmUuc2VuZEluR2EucHVsbCgpOwogICAgfSwKICAgIHVwZGF0ZU9wdGlvbjogZnVuY3Rpb24obWVzc2FnZSkgewogICAgICB2YXIga2V5ID0gbWVzc2FnZS5rZXk7CiAgICAgIHZhciB2YWx1ZSA9IG1lc3NhZ2UudmFsdWU7CiAgICAgIHZhciBvbGRWYWx1ZSA9IGVuZ2luZS5wcmVmZXJlbmNlc1trZXldOwogICAgICBlbmdpbmUucHJlZmVyZW5jZXNba2V5XSA9IHZhbHVlOwoKICAgICAgdmFyIG9iaiA9IHt9OwogICAgICBvYmpba2V5XSA9IHZhbHVlOwogICAgICBtb25vLnN0b3JhZ2Uuc2V0KG9iaik7CgogICAgICBpZiAoZW5naW5lLm9uT3B0aW9uQ2hhbmdlW2tleV0pIHsKICAgICAgICBlbmdpbmUub25PcHRpb25DaGFuZ2Vba2V5XSh2YWx1ZSwgb2xkVmFsdWUpOwogICAgICB9CiAgICB9LAogICAgZG93bmxvYWRGcm9tQ3VycmVudFBhZ2U6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9zYXZlZnJvbS5uZXQvJzsKICAgICAgbW9uby5nZXRBY3RpdmVUYWJVcmwoZnVuY3Rpb24oY1VybCkgewogICAgICAgIHZhciBhcmdzID0gbW9uby5wYXJhbSh7CiAgICAgICAgICB1cmw6IGNVcmwsCiAgICAgICAgICB1dG1fc291cmNlOiBlbmdpbmUucHJlZmVyZW5jZXMuc2ZIZWxwZXJOYW1lLAogICAgICAgICAgdXRtX21lZGl1bTogJ2V4dGVuc2lvbnMnLAogICAgICAgICAgdXRtX2NhbXBhaWduOiAnYm9va21hcmtsZXQnCiAgICAgICAgfSk7CiAgICAgICAgbW9uby5vcGVuVGFiKHVybCArICc/JyArIGFyZ3MsIHRydWUpOwoKICAgICAgICB2YXIgZG9tYWluID0gbW9uby5nZXREb21haW4oY1VybCwgMSk7CiAgICAgICAgZW5naW5lLnRyYWNrKHsKICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICBlYzogJ2V4dGVuc2lvbk1lbnUnLAogICAgICAgICAgZWE6ICdvcGVuU2ZQYWdlJywKICAgICAgICAgIGVsOiBkb21haW4KICAgICAgICB9KTsKICAgICAgICBpZiAoWzFdLmluZGV4T2YoZW5naW5lLnByZWZlcmVuY2VzLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgIGVuZ2luZS5jb2hvcnQudHJhY2soewogICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICBlYzogJ2V4dGVuc2lvbk1lbnUnLAogICAgICAgICAgICBlYTogJ29wZW5TZlBhZ2UnLAogICAgICAgICAgICBlbDogZG9tYWluCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIG9wZW5Qb2xsOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKFsnZW4nLCAndWsnLCAncnUnXS5pbmRleE9mKGVuZ2luZS5sYW5ndWFnZS5sYW5nKSA9PT0gLTEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIHVybCA9ICdodHRwOi8vJyArIGVuZ2luZS5sYW5ndWFnZS5sYW5nICsgJy5zYXZlZnJvbS5uZXQvaGVscGVyLWZvcm0ucGhwJzsKICAgICAgbW9uby5nZXRBY3RpdmVUYWJVcmwoZnVuY3Rpb24oY1VybCkgewogICAgICAgIHZhciBkb21haW4gPSBtb25vLmdldERvbWFpbihjVXJsKSB8fCAnJzsKCiAgICAgICAgdmFyIGFyZ3MgPSAnPycgKyBtb25vLnBhcmFtKHsKICAgICAgICAgIHZlcnNpb246IGVuZ2luZS52YXJDYWNoZS5jdXJyZW50VmVyc2lvbiwKICAgICAgICAgIGhlbHBlcjogZW5naW5lLnByZWZlcmVuY2VzLnNmSGVscGVyTmFtZSwKICAgICAgICAgIHVybDogZG9tYWluCiAgICAgICAgfSk7CiAgICAgICAgbW9uby5vcGVuVGFiKHVybCArIGFyZ3MsIHRydWUpOwogICAgICB9KTsKICAgIH0sCiAgICByZXBvcnRCdWc6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9zYXZlZnJvbS51c2VyZWNoby5jb20vZm9ydW0vMjA4NjktLyc7CiAgICAgIGlmIChlbmdpbmUubGFuZ3VhZ2UubGFuZyA9PT0gJ3J1JykgewogICAgICAgIHVybCA9ICdodHRwOi8vc2F2ZWZyb20udXNlcmVjaG8uY29tL2ZvcnVtLzE5NTIzLS8nOwogICAgICB9CiAgICAgIG1vbm8ub3BlblRhYih1cmwpOwogICAgfSwKICAgIHZpYU1lbnVfdXBkYXRlTGlua3M6IGZ1bmN0aW9uKCkgewogICAgICBtb25vLnNlbmRNZXNzYWdlVG9BY3RpdmVUYWIoewogICAgICAgIGFjdGlvbjogJ3VwZGF0ZUxpbmtzJwogICAgICB9KTsKICAgIH0sCiAgICB2aWFNZW51X2Rvd25sb2FkTVAzRmlsZXM6IGZ1bmN0aW9uKCkgewogICAgICBtb25vLnNlbmRNZXNzYWdlVG9BY3RpdmVUYWIoewogICAgICAgIGFjdGlvbjogJ2Rvd25sb2FkTVAzRmlsZXMnCiAgICAgIH0pOwogICAgfSwKICAgIHZpYU1lbnVfZG93bmxvYWRQbGF5bGlzdDogZnVuY3Rpb24oKSB7CiAgICAgIG1vbm8uc2VuZE1lc3NhZ2VUb0FjdGl2ZVRhYih7CiAgICAgICAgYWN0aW9uOiAnZG93bmxvYWRQbGF5bGlzdCcKICAgICAgfSk7CiAgICB9LAogICAgdmlhTWVudV9kb3dubG9hZFBob3RvczogZnVuY3Rpb24oKSB7CiAgICAgIG1vbm8uc2VuZE1lc3NhZ2VUb0FjdGl2ZVRhYih7CiAgICAgICAgYWN0aW9uOiAnZG93bmxvYWRQaG90b3MnCiAgICAgIH0pOwogICAgfSwKICAgIHZpYU1lbnVfY2hhbmdlU3RhdGU6IGZ1bmN0aW9uKG1zZykgewogICAgICBpZiAoIUFycmF5LmlzQXJyYXkobXNnLnByZWZLZXkpKSB7CiAgICAgICAgbXNnLnByZWZLZXkgPSBbbXNnLnByZWZLZXldOwogICAgICB9CgogICAgICBmb3IgKHZhciBpID0gMCwga2V5OyBrZXkgPSBtc2cucHJlZktleVtpXTsgaSsrKSB7CiAgICAgICAgZW5naW5lLmFjdGlvbkxpc3QudXBkYXRlT3B0aW9uKHsKICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgdmFsdWU6IG1zZy5zdGF0ZQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAobXNnLnN0YXRlICYmIG1zZy5tb2R1bGVOYW1lID09PSAnbG0nICYmIG1zZy5uZWVkSW5jbHVkZSkgewogICAgICAgIGlmIChtb25vLmlzQ2hyb21lIHx8IG1vbm8uaXNGRikgewogICAgICAgICAgcmV0dXJuIGVuZ2luZS50YWJMaXN0ZW5lci5pbmplY3RMbUluQWN0aXZlVGFiKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBtb25vLnNlbmRNZXNzYWdlVG9BY3RpdmVUYWIoewogICAgICAgIGFjdGlvbjogJ2NoYW5nZVN0YXRlJywKICAgICAgICBtb2R1bGVOYW1lOiBtc2cubW9kdWxlTmFtZSwKICAgICAgICBzdGF0ZTogbXNnLnN0YXRlCiAgICAgIH0pOwogICAgfSwKICAgIHNob3dPcHRpb25zOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKG1vbm8uaXNHTSkgewogICAgICAgIHJldHVybiBfb3B0aW9ucy5zaG93KCk7CiAgICAgIH0KICAgICAgdmFyIHVybCA9ICdvcHRpb25zLmh0bWwnOwogICAgICBpZiAobW9uby5pc0ZGKSB7CiAgICAgICAgdXJsID0gcmVxdWlyZSgnc2RrL3NlbGYnKS5kYXRhLnVybCh1cmwpOwogICAgICB9IGVsc2UKICAgICAgaWYgKG1vbm8uaXNTYWZhcmkpIHsKICAgICAgICB1cmwgPSBzYWZhcmkuZXh0ZW5zaW9uLmJhc2VVUkkgKyB1cmw7CiAgICAgIH0KICAgICAgbW9uby5vcGVuVGFiKHVybCwgdHJ1ZSk7CiAgICB9LAogICAgZ2V0QWN0aXZlVGFiTW9kdWxlSW5mbzogZnVuY3Rpb24obXNnLCBjYikgewogICAgICBtb25vLnNlbmRNZXNzYWdlVG9BY3RpdmVUYWIoewogICAgICAgIGFjdGlvbjogJ2dldE1vZHVsZUluZm8nLAogICAgICAgIHVybDogbXNnLnVybAogICAgICB9LCBmdW5jdGlvbihtb2R1bGVJbmZvKSB7CiAgICAgICAgY2IobW9kdWxlSW5mbyk7CiAgICAgIH0pOwogICAgfSwKICAgIGdldEFjdGl2ZVRhYlVybDogZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgbW9uby5nZXRBY3RpdmVUYWJVcmwoY2IpOwogICAgfSwKICAgIGdldEFjdGl2ZVRhYkluZm86IGZ1bmN0aW9uKG1zZywgY2IpIHsKICAgICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwogICAgICBtb25vLmdldEFjdGl2ZVRhYlVybChmdW5jdGlvbih1cmwpIHsKICAgICAgICBpZiAodXJsLmluZGV4T2YoJ2h0dHAnKSAhPT0gMCkgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgaG9zdExpc3QgPSB7CiAgICAgICAgICBkYWlseW1vdGlvbjogWycqOi8vKi5kYWlseW1vdGlvbi4qLyonXSwKICAgICAgICAgIGZhY2Vib29rOiBbJyo6Ly8qLmZhY2Vib29rLmNvbS8qJ10sCiAgICAgICAgICBtYWlscnU6IFsnKjovL215Lm1haWwucnUvKiddLAogICAgICAgICAgb2Rub2tsYXNzbmlraTogWycqOi8vKi5vay5ydS8qJywgJyo6Ly8qLm9kbm9rbGFzc25pa2kucnUvKiddLAogICAgICAgICAgc2F2ZWZyb206IFsnKjovLyouc2F2ZWZyb20ubmV0LyonXSwKICAgICAgICAgIHNvdW5kY2xvdWQ6IFsnKjovLyouc291bmRjbG91ZC5jb20vKiddLAogICAgICAgICAgdmltZW86IFsnKjovLyoudmltZW8uY29tLyonXSwKICAgICAgICAgIHZrOiBbJyo6Ly8qLnZrLmNvbS8qJywgJyo6Ly8qLnZrb250YWt0ZS5ydS8qJ10sCiAgICAgICAgICB5b3V0dWJlOiBbJyo6Ly8qLnlvdXR1YmUuY29tLyonXSwKICAgICAgICAgIGluc3RhZ3JhbTogWycqOi8vKi5pbnN0YWdyYW0uY29tLyonXSwKICAgICAgICAgIHJ1dHViZTogWycqOi8vKi5ydXR1YmUucnUvKiddCiAgICAgICAgfTsKCiAgICAgICAgdmFyIG1vZHVsZU5hbWUgPSAnbG0nOwogICAgICAgIHZhciBwcmVmS2V5ID0gWydsbUZpbGVIb3N0aW5nJywgJ2xtTWVkaWFIb3N0aW5nJ107CiAgICAgICAgdmFyIHN0YXRlID0gcHJlZmVyZW5jZXMubG1GaWxlSG9zdGluZyB8fCBwcmVmZXJlbmNlcy5sbU1lZGlhSG9zdGluZzsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIGhvc3RMaXN0KSB7CiAgICAgICAgICB2YXIgcmVnTGlzdCA9IGhvc3RMaXN0W2tleV07CiAgICAgICAgICB2YXIgcmUgPSByZWdMaXN0Lm1hcChmdW5jdGlvbihwYXR0ZXJuKSB7CiAgICAgICAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgICAgICAgfSkuam9pbignfCcpOwogICAgICAgICAgcmUgPSBuZXcgUmVnRXhwKHJlKTsKCiAgICAgICAgICBpZiAocmUudGVzdCh1cmwpKSB7CiAgICAgICAgICAgIG1vZHVsZU5hbWUgPSBrZXk7CiAgICAgICAgICAgIHByZWZLZXkgPSBlbmdpbmUucHJlZmVyZW5jZU1hcFttb2R1bGVOYW1lXTsKICAgICAgICAgICAgc3RhdGUgPSBwcmVmZXJlbmNlc1twcmVmS2V5XTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgbW9kdWxlTmFtZTogbW9kdWxlTmFtZSwKICAgICAgICAgIHByZWZLZXk6IHByZWZLZXksCiAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgIHN0YXRlOiBzdGF0ZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICB1c2VyanNEZXRlY3RlZDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICghZW5naW5lLmxpdGVTdG9yYWdlLmdldCgndXNlcmpzRGV0ZWN0ZWQnLCBmYWxzZSkpIHsKICAgICAgICBlbmdpbmUubGl0ZVN0b3JhZ2Uuc2V0KCd1c2VyanNEZXRlY3RlZCcsIHRydWUpOwoKICAgICAgICB2YXIgdXVpZCA9IGVuZ2luZS5nZXRVdWlkKCk7CiAgICAgICAgcmV0dXJuIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgICB1cmw6ICdodHRwczovL3d3dy5nb29nbGUtYW5hbHl0aWNzLmNvbS9jb2xsZWN0JywKICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAgIGRhdGE6ICd2PTEmdGlkPVVBLTcwNTUwNTUtMSZjaWQ9JyArIHV1aWQgKyAnJnQ9cGFnZXZpZXcmZGg9c2F2ZWZyb20ubmV0JmRwPSUyRmV4dGVuc2lvbiUyRnVzZXJqc19pbnN0YWxsZWQuZXh0JwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgaGlkZURvd25sb2FkV2FybmluZzogZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgaWYgKG1lc3NhZ2Uuc2V0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gbW9uby5zdG9yYWdlLnNldCh7CiAgICAgICAgICBoaWRlRG93bmxvYWRXYXJuaW5nOiBtZXNzYWdlLnNldAogICAgICAgIH0pOwogICAgICB9CiAgICAgIG1vbm8uc3RvcmFnZS5nZXQoJ2hpZGVEb3dubG9hZFdhcm5pbmcnLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgY2Ioc3RvcmFnZS5oaWRlRG93bmxvYWRXYXJuaW5nKTsKICAgICAgfSk7CiAgICB9LAogICAgdHJhY2s6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgZGVsZXRlIG1lc3NhZ2UuYWN0aW9uOwogICAgICBlbmdpbmUudHJhY2sobWVzc2FnZSk7CiAgICB9LAogICAgdHJhY2tDb2hvcnQ6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgZGVsZXRlIG1lc3NhZ2UuYWN0aW9uOwogICAgICBlbmdpbmUuY29ob3J0LnRyYWNrKG1lc3NhZ2UpOwogICAgfSwKICAgIGFkZFRvQ2xpcGJvYXJkOiBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgIGlmIChtb25vLmlzRkYpIHsKICAgICAgICB2YXIgY2xpcGJvYXJkID0gcmVxdWlyZSgic2RrL2NsaXBib2FyZCIpOwogICAgICAgIGNsaXBib2FyZC5zZXQobWVzc2FnZS50ZXh0KTsKICAgICAgfSBlbHNlCiAgICAgIGlmIChtb25vLmlzQ2hyb21lKSB7CiAgICAgICAgdmFyIHRleHQgPSBtZXNzYWdlLnRleHQ7CiAgICAgICAgdmFyIHRleHRBcmVhOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGV4dEFyZWEgPSBtb25vLmNyZWF0ZSgndGV4dGFyZWEnLCB7CiAgICAgICAgICB0ZXh0OiB0ZXh0CiAgICAgICAgfSkpOwogICAgICAgIHRleHRBcmVhLnNlbGVjdCgpOwogICAgICAgIG1vbm8uYXN5bmNDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoImNvcHkiLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICB0ZXh0QXJlYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRleHRBcmVhKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNldEljb25CYWRnZTogZnVuY3Rpb24obXNnKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIHRleHQgPSBTdHJpbmcobXNnLnRleHQpOwoKICAgICAgaWYgKG1vbm8uaXNDaHJvbWUpIHsKICAgICAgICBjaHJvbWUuYnJvd3NlckFjdGlvbiAmJiBjaHJvbWUuYnJvd3NlckFjdGlvbi5zZXRCYWRnZVRleHQoewogICAgICAgICAgdGV4dDogdGV4dAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChtb25vLmlzTW9kdWxlICYmIGVuZ2luZS52YXJDYWNoZS5mZkJ1dHRvbikgewogICAgICAgIHZhciBidXR0b24gPSBlbmdpbmUudmFyQ2FjaGUuZmZCdXR0b247CiAgICAgICAgYnV0dG9uLmJhZGdlID0gdGV4dDsKICAgICAgfQogICAgfSwKICAgIHRyYWNrRXJyb3I6IGZ1bmN0aW9uKG1zZykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIHRyYWNrRXJyb3IgPSBlbmdpbmUuYWN0aW9uTGlzdC50cmFja0Vycm9yOwogICAgICAgIGlmICghdHJhY2tFcnJvci5kRGJsKSB7CiAgICAgICAgICB0cmFja0Vycm9yLmREYmwgPSB7fTsKICAgICAgICB9CgogICAgICAgIHZhciBkZXNjID0gbXNnLmRlc2M7CgogICAgICAgIGlmIChtc2cuZXJyb3IpIHsKICAgICAgICAgIHZhciBlcnJvciA9IG1zZy5lcnJvcjsKICAgICAgICAgIGRlc2MgPSBkZXNjID8gZGVzYyArICcgJyA6ICcnOwogICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICAgICAgZGVzYyArPSBTdHJpbmcoZXJyb3IubWVzc2FnZSB8fCBlcnJvcikgfHwgJ0VSUk9SJzsKICAgICAgICAgICAgaWYgKGVycm9yLnN0YWNrKSB7CiAgICAgICAgICAgICAgZGVzYyArPSAnICcgKyBtc2cuZXJyb3Iuc3RhY2s7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlc2MgKz0gZXJyb3I7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgZXhkID0gZGVzYy5zdWJzdHIoMCwgMTUwKTsKCiAgICAgICAgaWYgKHRyYWNrRXJyb3IuZERibFtleGRdKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyYWNrRXJyb3IuZERibFtleGRdID0gdHJ1ZTsKCiAgICAgICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICAgIHQ6ICdleGNlcHRpb24nLAogICAgICAgICAgZXhkOiBleGQsCiAgICAgICAgICB0aWQ6ICdVQS03MDU1MDU1LTknCiAgICAgICAgfTsKCiAgICAgICAgZW5naW5lLnNlbmRTdGF0c0luZm8ocGFyYW1zKTsKICAgICAgfSBjYXRjaCAoZSkge30KICAgIH0sCiAgICBjb252ZXJ0OiBmdW5jdGlvbihtc2cpIHsKICAgICAgaWYgKG1vbm8uaXNGRikgewogICAgICAgIHJldHVybiBtb25vLnNlbmRNZXNzYWdlKG1zZywgZnVuY3Rpb24oZGV0YWlscykgewogICAgICAgICAgaWYgKGRldGFpbHMuc3VjY2VzcykgewogICAgICAgICAgICBlbmdpbmUudHJhY2soewogICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgZWM6ICdtcDMnLAogICAgICAgICAgICAgIGVhOiAnY29udmVydCcsCiAgICAgICAgICAgICAgZWw6ICd0cnVlJwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIG1vbm8uc3RvcmFnZS5nZXQoJ29uY2VTaG93Q29udlJhdGUnLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgICAgICAgaWYgKHN0b3JhZ2Uub25jZVNob3dDb252UmF0ZSAhPT0gMCkgewogICAgICAgICAgICAgICAgbW9uby5zdG9yYWdlLnNldCh7CiAgICAgICAgICAgICAgICAgIG9uY2VTaG93Q29udlJhdGU6IDEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbmdpbmUudHJhY2soewogICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgZWM6ICdtcDMnLAogICAgICAgICAgICAgIGVhOiAnY29udmVydCcsCiAgICAgICAgICAgICAgZWw6ICdmYWxzZScKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZGV0YWlscy5lcnJvciA9PT0gJ1NhdmUgZGlhbG9nIGlzIGNhbmNlbGVkJykgewogICAgICAgICAgICAgIGRldGFpbHMuZXJyb3IgPSBudWxsOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgaWYgKGRldGFpbHMuZXJyb3IgPT09ICdEb3dubG9hZCBjYW5jZWxlZC4nKSB7CiAgICAgICAgICAgICAgZGV0YWlscy5lcnJvciA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRldGFpbHMuZXJyb3IgJiYgZW5naW5lLmFjdGlvbkxpc3QudHJhY2tFcnJvcih7CiAgICAgICAgICAgICAgZGVzYzogZGV0YWlscy5lcnJvcgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LCAnc2VydmljZScpOwogICAgICB9CiAgICB9CiAgfTsKCiAgZW5naW5lLm9uTWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICBpZiAoIWVuZ2luZS5vbk1lc3NhZ2UucmVhZHkpIHsKICAgICAgZW5naW5lLm9uTWVzc2FnZS5zdGFjay5wdXNoKGFyZ3VtZW50cyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgZnVuYzsKICAgIHZhciBhY3Rpb24gPSBtZXNzYWdlLmFjdGlvbiB8fCBtZXNzYWdlOwogICAgaWYgKChmdW5jID0gZW5naW5lLmFjdGlvbkxpc3RbYWN0aW9uXSkgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gZnVuYy5jYWxsKGVuZ2luZS5hY3Rpb25MaXN0LCBtZXNzYWdlLCBjYik7CiAgICB9CgogICAgZm9yICh2YXIgbW9kdWxlTmFtZSBpbiBlbmdpbmUubW9kdWxlcykgewogICAgICB2YXIgbW9kdWxlID0gZW5naW5lLm1vZHVsZXNbbW9kdWxlTmFtZV07CiAgICAgIGlmICgoZnVuYyA9IG1vZHVsZVthY3Rpb25dKSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbChtb2R1bGUsIG1lc3NhZ2UsIGNiKTsKICAgICAgfQogICAgfQoKICAgIGlmICgoZnVuYyA9IGVuZ2luZS51dGlsc1thY3Rpb25dKSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiBmdW5jLmNhbGwoZW5naW5lLnV0aWxzLCBtZXNzYWdlLCBjYik7CiAgICB9CiAgfTsKICBlbmdpbmUub25NZXNzYWdlLnN0YWNrID0gW107CiAgZW5naW5lLm9uTWVzc2FnZS5yZWFkeSA9IGZhbHNlOwoKICBlbmdpbmUubG9hZFNldHRpbmdzID0gZnVuY3Rpb24oY2IpIHsKICAgIHZhciB2YXJDYWNoZSA9IGVuZ2luZS52YXJDYWNoZTsKICAgIHZhciBwcmVmZXJlbmNlcyA9IGVuZ2luZS5wcmVmZXJlbmNlczsKICAgIHZhciBkZWZhdWx0UHJlZmVyZW5jZXMgPSBlbmdpbmUuZGVmYXVsdFByZWZlcmVuY2VzOwoKICAgIGlmIChtb25vLmlzR00pIHsKICAgICAgZGVmYXVsdFByZWZlcmVuY2VzLmJ1dHRvbiA9IDA7CiAgICAgIGRlZmF1bHRQcmVmZXJlbmNlcy5zaG93VW1teUJ0biA9IDA7CiAgICB9CgogICAgdmFyIHByZWxvYWQgPSB7CiAgICAgIGNvaG9ydDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBlbmdpbmUuY29ob3J0LnNldFN0b3JlKHZhbHVlKTsKICAgICAgfSwKICAgICAgdW1teURldGVjdGVkOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGlmICghdmFsdWUgJiYgdmFsdWUgIT09IDApIHsKICAgICAgICAgIHZhbHVlID0gcHJlZmVyZW5jZXMuc2hvd1VtbXlJbmZvID8gMCA6IDE7CiAgICAgICAgICBtb25vLnN0b3JhZ2Uuc2V0KHsKICAgICAgICAgICAgdW1teURldGVjdGVkOiB2YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHByZWZlcmVuY2VzLnVtbXlEZXRlY3RlZCA9IHZhbHVlOwogICAgICB9LAogICAgICAvLyB0b2RvOiB0bXAKICAgICAgc3dTdGF0RW5hYmxlZDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT09IDAgJiYgcHJlZmVyZW5jZXMuc3RhdEVuYWJsZWQpIHsKICAgICAgICAgIG1vbm8uc3RvcmFnZS5zZXQoewogICAgICAgICAgICBzd1N0YXRFbmFibGVkOiAxLAogICAgICAgICAgICBzdGF0RW5hYmxlZDogcHJlZmVyZW5jZXMuc3RhdEVuYWJsZWQgPSAwCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIGRlZlByZWZlcmVuY2VzS2V5cyA9IE9iamVjdC5rZXlzKGRlZmF1bHRQcmVmZXJlbmNlcyk7CiAgICB2YXIgcHJlbG9hZEtleXMgPSBPYmplY3Qua2V5cyhwcmVsb2FkKTsKICAgIHJldHVybiBtb25vLnN0b3JhZ2UuZ2V0KGRlZlByZWZlcmVuY2VzS2V5cy5jb25jYXQocHJlbG9hZEtleXMpLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgIGRlZlByZWZlcmVuY2VzS2V5cy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSBkZWZhdWx0UHJlZmVyZW5jZXNba2V5XTsKICAgICAgICB2YXIgdmFsdWUgPSBzdG9yYWdlW2tleV07CiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhbHVlID0gZGVmYXVsdFZhbHVlOwogICAgICAgIH0KICAgICAgICBwcmVmZXJlbmNlc1trZXldID0gdmFsdWU7CiAgICAgIH0pOwoKICAgICAgcHJlbG9hZEtleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICBwcmVsb2FkW2tleV0oc3RvcmFnZVtrZXldKTsKICAgICAgfSk7CgogICAgICBpZiAodmFyQ2FjaGUuaXNGaXJzdHJ1bikgewogICAgICAgIG1vbm8uc3RvcmFnZS5zZXQoewogICAgICAgICAgc2hvd1R1dG9yaWFsOiBwcmVmZXJlbmNlcy5zaG93VHV0b3JpYWwgPSAxLAogICAgICAgICAgc2hvd1VtbXlMYW5kaW5nOiBwcmVmZXJlbmNlcy5zaG93VW1teUxhbmRpbmcgPSAxCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmIChtb25vLmlzQ2hyb21lKSB7CiAgICAgICAgaWYgKG1vbm8uaXNDaHJvbWVWZXJzaW9uIDwgMzEpIHsKICAgICAgICAgIHByZWZlcmVuY2VzLmRvd25sb2FkcyA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIChjaHJvbWUuZG93bmxvYWRzICYmIGNocm9tZS5kb3dubG9hZHMuZG93bmxvYWQpIHx8CiAgICAgICAgICAgIChjaHJvbWUucGVybWlzc2lvbnMgJiYgY2hyb21lLnBlcm1pc3Npb25zLnJlcXVlc3QpCiAgICAgICAgICApIHsKICAgICAgICAgICAgcHJlZmVyZW5jZXMuZG93bmxvYWRzID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChtb25vLmlzR00pIHsKICAgICAgICBwcmVmZXJlbmNlcy5kb3dubG9hZHMgPSBmYWxzZTsKICAgICAgICB2YXIgaGFzRG93bmxvYWRBcGkgPSB0eXBlb2YgR01fZG93bmxvYWQgIT09ICd1bmRlZmluZWQnOwogICAgICAgIHZhciBicm93c2VyQXBpRG93bmxvYWRNb2RlID0gZmFsc2U7CiAgICAgICAgaWYgKGhhc0Rvd25sb2FkQXBpKSB7CiAgICAgICAgICBicm93c2VyQXBpRG93bmxvYWRNb2RlID0gdHlwZW9mIEdNX2luZm8gIT09ICd1bmRlZmluZWQnICYmIEdNX2luZm8uZG93bmxvYWRNb2RlID09PSAnYnJvd3Nlcic7CiAgICAgICAgfQogICAgICAgIGlmIChoYXNEb3dubG9hZEFwaSAmJiAocHJlZmVyZW5jZXMuZ21OYXRpdmVEb3dubG9hZCB8fCBicm93c2VyQXBpRG93bmxvYWRNb2RlKSkgewogICAgICAgICAgcHJlZmVyZW5jZXMuZ21OYXRpdmVEb3dubG9hZCA9IDE7CiAgICAgICAgICBwcmVmZXJlbmNlcy5kb3dubG9hZHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKG1vbm8uaXNGRiAmJiB2YXJDYWNoZS5mZkJ1dHRvbikgewogICAgICAgIHByZWZlcmVuY2VzLmRvd25sb2FkcyA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmIChwcmVmZXJlbmNlcy5kb3dubG9hZHMpIHsKICAgICAgICBwcmVmZXJlbmNlcy5tb2R1bGVTaG93RG93bmxvYWRJbmZvID0gMDsKICAgICAgfQoKICAgICAgcmV0dXJuIGNiKCk7CiAgICB9KTsKICB9OwoKICBlbmdpbmUuZXhwID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIHZhckNhY2hlID0gZW5naW5lLnZhckNhY2hlOwogICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwogICAgdmFyIG1ldGEgPSB2YXJDYWNoZS5tZXRhOwogICAgdmFyIGxpc3QgPSBlbmdpbmUuZXhwTGlzdCA9IHt9OwogICAgLyoqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZQogICAgICogQHJldHVybnMge251bWJlcn0KICAgICAqLwogICAgdmFyIGdldEV4cEluZGV4ID0gZnVuY3Rpb24odHlwZSkgewogICAgICB2YXIgcmVzdWx0ID0gMDsKICAgICAgdmFyIHZhbHVlID0gMDsKCiAgICAgIGlmICh0eXBlID09PSAnZmlyc3RydW4nKSB7CiAgICAgICAgdmFsdWUgPSBtb25vLmdldFJhbmRvbUludCgwLCAxMDApOwoKICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBsaXN0KSB7CiAgICAgICAgICB2YXIgcGVyY2VudCA9IGxpc3RbaW5kZXhdLnBlcmNlbnQ7CiAgICAgICAgICBpZiAodmFsdWUgPCBwZXJjZW50KSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHBhcnNlSW50KGluZGV4KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YWx1ZSAtPSBwZXJjZW50OwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgIH0gZWxzZQogICAgICBpZiAodHlwZSA9PT0gJ3VwZ3JhZGUnKSB7CgogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIHZhciBzZWxlY3RFeHAgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIG1ldGFFeHAgPSBtZXRhLmV4cCB8fCB7fTsKICAgICAgT2JqZWN0LmtleXMobGlzdCkuZm9yRWFjaChmdW5jdGlvbihpbmRleCkgewogICAgICAgIHZhciBleHBJdGVtID0gbWV0YUV4cFtpbmRleF07CiAgICAgICAgaWYgKCFleHBJdGVtIHx8ICFleHBJdGVtLmVuYWJsZSkgewogICAgICAgICAgZGVsZXRlIGxpc3RbaW5kZXhdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgaXRlbSA9IGxpc3RbaW5kZXhdOwogICAgICAgICAgaWYgKGl0ZW0uaXNBdmFpbGFibGUgJiYgIWl0ZW0uaXNBdmFpbGFibGUocHJlZmVyZW5jZXMsIHZhckNhY2hlKSkgewogICAgICAgICAgICBkZWxldGUgbGlzdFtpbmRleF07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaXN0W2luZGV4XS5wZXJjZW50ID0gZXhwSXRlbS5wZXJjZW50IHx8IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHZhciBleHBJbmRleCA9IHByZWZlcmVuY2VzLmV4cEluZGV4OwogICAgICBpZiAoZXhwSW5kZXggPiAwICYmICFsaXN0W2V4cEluZGV4XSkgewogICAgICAgIGV4cEluZGV4ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHZhckNhY2hlLmlzRmlyc3RydW4pIHsKICAgICAgICBleHBJbmRleCA9IGdldEV4cEluZGV4KCdmaXJzdHJ1bicpOwogICAgICB9IGVsc2UKICAgICAgaWYgKHZhckNhY2hlLmlzVXBncmFkZSAmJiBleHBJbmRleCA9PT0gMCkgewogICAgICAgIGV4cEluZGV4ID0gZ2V0RXhwSW5kZXgoJ3VwZ3JhZGUnKTsKICAgICAgfQoKICAgICAgc2V0RXhwSW5kZXgoZXhwSW5kZXgpOwogICAgfTsKICAgIC8qKgogICAgICogQHBhcmFtIHtudW1iZXJ9IGluZGV4CiAgICAgKi8KICAgIHZhciBzZXRFeHBJbmRleCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIGlmIChwcmVmZXJlbmNlcy5leHBJbmRleCAhPT0gaW5kZXgpIHsKICAgICAgICBtb25vLmRlYnVnKCdTZXQgZXhwIGluZGV4JywgaW5kZXgpOwogICAgICAgIGVuZ2luZS5hY3Rpb25MaXN0LnVwZGF0ZU9wdGlvbih7CiAgICAgICAgICBrZXk6ICdleHBJbmRleCcsCiAgICAgICAgICB2YWx1ZTogaW5kZXgKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKICAgIHZhciBkaXNhYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgIHNldEV4cEluZGV4KDApOwogICAgfTsKICAgIHZhciBjYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICAgbW9uby5kZWJ1ZygnQ2FuY2VsIGV4cCcsIHByZWZlcmVuY2VzLmV4cEluZGV4KTsKICAgICAgcHJlZmVyZW5jZXMuZXhwSW5kZXggPSAwOwogICAgfTsKICAgIC8qKgogICAgICogQHBhcmFtIHtudW1iZXJ9IGV4cEluZGV4CiAgICAgKi8KICAgIHZhciBsb2FkID0gZnVuY3Rpb24oZXhwSW5kZXgpIHsKICAgICAgbW9uby5kZWJ1ZygnTG9hZCBleHAnLCBleHBJbmRleCk7CiAgICAgIHRyeSB7CiAgICAgICAgbGlzdFtleHBJbmRleF0ocHJlZmVyZW5jZXMsIHZhckNhY2hlKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIG1vbm8uZXJyb3IoJ0xvYWQgZXhwIGVycm9yIScsIGV4cEluZGV4LCBlKTsKICAgICAgfQogICAgfTsKICAgIHZhciBydW4gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGV4cEluZGV4ID0gcHJlZmVyZW5jZXMuZXhwSW5kZXg7CiAgICAgIGlmIChleHBJbmRleCA+IDApIHsKICAgICAgICBpZiAoIWxpc3RbZXhwSW5kZXhdKSB7CiAgICAgICAgICBzZXRFeHBJbmRleCgwKTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAobWV0YS5leHAgJiYgbWV0YS5leHBbZXhwSW5kZXhdICYmIG1ldGEuZXhwW2V4cEluZGV4XS5jYW5jZWwpIHsKICAgICAgICAgIGNhbmNlbCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsb2FkKGV4cEluZGV4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAodHlwZW9mIEVYUF9JTkRFWCA9PT0gJ251bWJlcicpIHsKICAgICAgICBtb25vLmRlYnVnKCdGb3JjZSBleHAgaW5kZXgnLCBFWFBfSU5ERVgpOwogICAgICAgIHByZWZlcmVuY2VzLmV4cEluZGV4ID0gRVhQX0lOREVYOwogICAgICAgIHJ1bigpOwogICAgICB9IGVsc2UKICAgICAgaWYgKCF2YXJDYWNoZS5pc0ZpcnN0cnVuICYmICF2YXJDYWNoZS5pc1VwZ3JhZGUpIHsKICAgICAgICBydW4oKTsKICAgICAgfSBlbHNlCiAgICAgIGlmICghbWV0YS5leHAgfHwgbW9uby5pc0VtcHR5T2JqZWN0KGxpc3QpKSB7CiAgICAgICAgc2V0RXhwSW5kZXgoMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZWN0RXhwKCk7CiAgICAgICAgcnVuKCk7CiAgICAgIH0KICAgIH07CiAgICByZXR1cm4gewogICAgICBpbml0OiBpbml0LAogICAgICBkaXNhYmxlOiBkaXNhYmxlCiAgICB9CiAgfSkoKTsKCiAgZW5naW5lLmNoZWNrU292ZXRuaWsgPSBmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBwcmVmZXJlbmNlcyA9IGVuZ2luZS5wcmVmZXJlbmNlczsKCiAgICB2YXIgbGFuZ0xpc3QgPSBbCiAgICAgICdiZScsICdraycsICdydScsICd1aycsCiAgICAgICdoeScsICdybycsICdheicsICdrYScsCiAgICAgICdreScsICd1eicsICdsdicsICdsdCcsCiAgICAgICdldCcsICd0ZycsICdmaScsICd0aycKICAgIF07CgogICAgdmFyIGNvdW50cnlMaXN0ID0gWwogICAgICAnYnknLCAna3onLCAncnUnLCAndWEnLAogICAgICAnYW0nLCAnbWQnLCAnYXonLCAnZ2UnLAogICAgICAna2cnLCAndXonLCAnbHYnLCAnbHQnLAogICAgICAnZWUnLCAndGonLCAnZmknLCAndG0nCiAgICBdOwoKICAgIHByZWZlcmVuY2VzLmhhc1NvdmV0bmlrID0gY291bnRyeUxpc3QuaW5kZXhPZihwcmVmZXJlbmNlcy5jb3VudHJ5KSAhPT0gLTE7CiAgICBpZiAoIXByZWZlcmVuY2VzLmhhc1NvdmV0bmlrKSB7CiAgICAgIHZhciBuYXZMYW5ndWFnZSA9IGVuZ2luZS5nZXROYXZMYW5ndWFnZSgpLnN1YnN0cigwLCAyKS50b0xvd2VyQ2FzZSgpOwogICAgICBwcmVmZXJlbmNlcy5oYXNTb3ZldG5payA9IGxhbmdMaXN0LmluZGV4T2YobmF2TGFuZ3VhZ2UpICE9PSAtMTsKICAgIH0KCiAgICBpZiAocHJlZmVyZW5jZXMuaGFzU292ZXRuaWspIHsKICAgICAgaWYgKG1vbm8uaXNPcGVyYSB8fCBtb25vLmlzQ2hyb21lKSB7CiAgICAgICAgaWYgKGVuZ2luZS5zb3ZldG5pa0luaXQpIHsKICAgICAgICAgIG1vbm8uYXN5bmNDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBlbmdpbmUuc292ZXRuaWtJbml0KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChtb25vLmlzRkYpIHsKICAgICAgICBpZiAoZW5naW5lLmZmU292ZXRuaWsgJiYgIWVuZ2luZS5mZlNvdmV0bmlrLmFwaS5pc1JlYWR5KSB7CiAgICAgICAgICBlbmdpbmUuZmZTb3ZldG5pay5sb2FkU292ZXRuaWsoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBlbmdpbmUudGFiTGlzdGVuZXIuZW5hYmxlKCk7CgogICAgZW5naW5lLmV2ZW50cy5lbWl0KCdoYXNTb3ZldG5pa1VwZGF0ZScpOwogIH07CgogIGVuZ2luZS5wcmVwYXJlID0gZnVuY3Rpb24oY2IpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciB2YXJDYWNoZSA9IGVuZ2luZS52YXJDYWNoZTsKCiAgICBlbmdpbmUubG9hZGVyLndoZW4oJ2dldEhlbHBlclZlcnNpb24nLCBmdW5jdGlvbigpIHsKICAgICAgZW5naW5lLmdldENvdW50cnkoKTsKICAgIH0pOwoKICAgIGVuZ2luZS5sb2FkZXIud2hlbignbG9hZFNldHRpbmdzJywgZnVuY3Rpb24oKSB7CiAgICAgIGlmIChlbmdpbmUuc292ZXRuaWtJc0F2YWlsYWJsZSgpKSB7CiAgICAgICAgZW5naW5lLmNoZWNrU292ZXRuaWsoKTsKICAgICAgICBlbmdpbmUubG9hZGVyLndoZW4oJ2dldENvdW50cnknLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGVuZ2luZS5jaGVja1NvdmV0bmlrKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIGVuZ2luZS5sb2FkZXIud2hlbihbJ2xvYWRMYW5ndWFnZScsICdsb2FkU2V0dGluZ3MnLCAnZ2V0SGVscGVyVmVyc2lvbiddLCBmdW5jdGlvbigpIHsKICAgICAgdmFyQ2FjaGUuaXNVcGdyYWRlID0gIXZhckNhY2hlLmlzRmlyc3RydW4gJiYgZW5naW5lLnByZWZlcmVuY2VzLnZlcnNpb24gIT09IHZhckNhY2hlLmN1cnJlbnRWZXJzaW9uOwoKICAgICAgZW5naW5lLmdldE1ldGEoZnVuY3Rpb24oKSB7CiAgICAgICAgZW5naW5lLmV4cC5pbml0KCk7CgogICAgICAgIGNiKCk7CiAgICAgIH0pOwogICAgfSk7CgogICAgZW5naW5lLmxvYWRMYW5ndWFnZShmdW5jdGlvbigpIHsKICAgICAgZW5naW5lLmxvYWRlci5yZWFkeSgnbG9hZExhbmd1YWdlJyk7CiAgICB9KTsKCiAgICBlbmdpbmUubG9hZFNldHRpbmdzKGZ1bmN0aW9uKCkgewogICAgICBlbmdpbmUubG9hZGVyLnJlYWR5KCdsb2FkU2V0dGluZ3MnKTsKICAgIH0pOwoKICAgIHZhciBvbkdldFZlcnNpb24gPSBmdW5jdGlvbih2ZXJzaW9uKSB7CiAgICAgIHZhckNhY2hlLmN1cnJlbnRWZXJzaW9uID0gdmVyc2lvbiB8fCAndW5rbm93bic7CiAgICAgIGVuZ2luZS5sb2FkZXIucmVhZHkoJ2dldEhlbHBlclZlcnNpb24nKTsKICAgIH07CgogICAgbW9uby5zYWZlRm4oZnVuY3Rpb24oY2IpIHsKICAgICAgY2IobW9uby5nZXRWZXJzaW9uKCkpOwogICAgfSwgb25HZXRWZXJzaW9uLCBlbmdpbmUpKG9uR2V0VmVyc2lvbik7CiAgfTsKCiAgZW5naW5lLm1zZ0xpc3RlbmVyID0gZnVuY3Rpb24obWVzc2FnZSwgcmVzcG9uc2UpIHsKICAgIGlmICghQXJyYXkuaXNBcnJheShtZXNzYWdlKSkgewogICAgICByZXR1cm4gZW5naW5lLm9uTWVzc2FnZShtZXNzYWdlLCByZXNwb25zZSk7CiAgICB9CgogICAgdmFyIGNvdW50V2FpdCA9IG1lc3NhZ2UubGVuZ3RoOwogICAgdmFyIGNvdW50UmVhZHkgPSAwOwogICAgdmFyIHJlc3VsdExpc3QgPSB7fTsKICAgIHZhciByZWFkeSA9IGZ1bmN0aW9uKGtleSwgZGF0YSkgewogICAgICBjb3VudFJlYWR5ICs9IDE7CiAgICAgIHJlc3VsdExpc3Rba2V5XSA9IGRhdGE7CiAgICAgIGlmIChjb3VudFdhaXQgPT09IGNvdW50UmVhZHkpIHsKICAgICAgICByZXNwb25zZShyZXN1bHRMaXN0KTsKICAgICAgfQogICAgfTsKICAgIG1lc3NhZ2UuZm9yRWFjaChmdW5jdGlvbihtc2cpIHsKICAgICAgZW5naW5lLm9uTWVzc2FnZShtc2csIGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICByZWFkeShtc2cuYWN0aW9uIHx8IG1zZywgZGF0YSk7CiAgICAgIH0pOwogICAgfSk7CiAgfTsKCiAgZW5naW5lLmluaXRNZXNzYWdlTGlzdGVuZXIgPSBmdW5jdGlvbigpIHsKICAgIGlmICghZW5naW5lLmluaXRNZXNzYWdlTGlzdGVuZXIuZmlyZWQpIHsKICAgICAgZW5naW5lLmluaXRNZXNzYWdlTGlzdGVuZXIuZmlyZWQgPSB0cnVlOwogICAgICBtb25vLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihlbmdpbmUubXNnTGlzdGVuZXIsIHsKICAgICAgICBpc0JnOiB0cnVlCiAgICAgIH0pOwogICAgfQogIH07CgogIGVuZ2luZS5pbml0ID0gZnVuY3Rpb24oKSB7CiAgICBlbmdpbmUuaW5pdE1lc3NhZ2VMaXN0ZW5lcigpOwoKICAgIHZhciB2YXJDYWNoZSA9IGVuZ2luZS52YXJDYWNoZTsKICAgIHZhciBwcmVmZXJlbmNlcyA9IGVuZ2luZS5wcmVmZXJlbmNlczsKCiAgICB2YXIgbG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgX25hdmlnYXRvciA9IG1vbm8uZ2V0TmF2aWdhdG9yKCk7CgogICAgICB2YXJDYWNoZS5oZWxwZXJOYW1lID0gZW5naW5lLmdldEhlbHBlck5hbWUoKTsKCiAgICAgIHByZWZlcmVuY2VzLnNob3dVbW15SXRlbSA9IC9eV2lufF5NYWMvLnRlc3QoX25hdmlnYXRvci5wbGF0Zm9ybSkgPyAxIDogMDsKICAgICAgcHJlZmVyZW5jZXMuZW5hYmxlQ29udmVydGVyID0gL15XaW4vLnRlc3QoX25hdmlnYXRvci5wbGF0Zm9ybSkgPyAxIDogMDsKICAgICAgaWYgKCFtb25vLmlzRkYpIHsKICAgICAgICBwcmVmZXJlbmNlcy5lbmFibGVDb252ZXJ0ZXIgPSAwOwogICAgICB9CgogICAgICBwcmVmZXJlbmNlcy5zZkhlbHBlck5hbWUgPSBlbmdpbmUuZ2V0U2ZIZWxwZXJOYW1lKCk7CgogICAgICBlbmdpbmUubG9hZGVyLnJlYWR5KCdpbml0Jyk7CgogICAgICBlbmdpbmUubG9hZGVyLndoZW4oJ2JlZm9yZVByZXBhcmUnLCBmdW5jdGlvbigpIHsKICAgICAgICBlbmdpbmUuY2hlY2tWZXJzaW9uKCk7CiAgICAgICAgZW5naW5lLmNvaG9ydC5ydW4oKTsKICAgICAgfSk7CgogICAgICBlbmdpbmUucHJlcGFyZShmdW5jdGlvbigpIHsKICAgICAgICBlbmdpbmUubG9hZGVyLnJlYWR5KCdiZWZvcmVQcmVwYXJlJyk7CgogICAgICAgIGVuZ2luZS5vbk1lc3NhZ2UucmVhZHkgPSB0cnVlOwogICAgICAgIHdoaWxlIChlbmdpbmUub25NZXNzYWdlLnN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgIG1vbm8uYXN5bmNGbihlbmdpbmUub25NZXNzYWdlKS5hcHBseShudWxsLCBlbmdpbmUub25NZXNzYWdlLnN0YWNrLnNoaWZ0KCkpOwogICAgICAgIH0KCiAgICAgICAgZW5naW5lLmxvYWRlci5yZWFkeSgncHJlcGFyZScpOwogICAgICB9KTsKICAgIH07CgogICAgdmFyIGtleXMgPSBbJ3V1aWQnLCAndmVyc2lvbicsICdtZXRhJywgJ2NvdW50cnknXTsKICAgIGtleXMucHVzaChlbmdpbmUubGl0ZVN0b3JhZ2UuZ2V0U3RvcmFnZUtleSgpKTsKCiAgICByZXR1cm4gbW9uby5zdG9yYWdlLmdldChrZXlzLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgIGVuZ2luZS5saXRlU3RvcmFnZS5zZXRTdG9yYWdlKHN0b3JhZ2UpOwoKICAgICAgaWYgKHR5cGVvZiBzdG9yYWdlLnV1aWQgPT09ICdzdHJpbmcnICYmIHN0b3JhZ2UudXVpZC5sZW5ndGggPT09IDM2KSB7CiAgICAgICAgdmFyQ2FjaGUudXVpZCA9IHN0b3JhZ2UudXVpZDsKICAgICAgfQogICAgICBpZiAoIXN0b3JhZ2UudmVyc2lvbikgewogICAgICAgIHZhckNhY2hlLmlzRmlyc3RydW4gPSB0cnVlOwogICAgICB9CiAgICAgIGlmIChzdG9yYWdlLm1ldGEpIHsKICAgICAgICBtb25vLmV4dGVuZCh2YXJDYWNoZS5tZXRhLCBzdG9yYWdlLm1ldGEpOwogICAgICB9CiAgICAgIGlmIChzdG9yYWdlLmNvdW50cnkpIHsKICAgICAgICBwcmVmZXJlbmNlcy5jb3VudHJ5ID0gc3RvcmFnZS5jb3VudHJ5OwogICAgICB9CgogICAgICByZXR1cm4gbG9hZCgpOwogICAgfSk7CiAgfTsKCiAgZW5naW5lLm1vZHVsZUluaXQgPSBmdW5jdGlvbihhZGRvbiwgYnV0dG9uLCBtb25vTGliLCBleHRyYSkgewogICAgZW5naW5lLnZhckNhY2hlLm1vbm9MaWIgPSBtb25vTGliOwogICAgbW9ubyA9IG1vbm8uaW5pdChhZGRvbik7CiAgICB2YXIgbW9kdWxlcyA9IGVuZ2luZS5tb2R1bGVzOwogICAgbW9kdWxlcy52aW1lbyA9IHJlcXVpcmUoJy4vdmltZW9fY29tX2VtYmVkLmpzJykuaW5pdChtb25vLCBlbmdpbmUpOwogICAgbW9kdWxlcy5kYWlseW1vdGlvbiA9IHJlcXVpcmUoJy4vZGFpbHltb3Rpb25fY29tX2VtYmVkLmpzJykuaW5pdChtb25vLCBlbmdpbmUpOwogICAgbW9kdWxlcy55b3V0dWJlID0gcmVxdWlyZSgnLi95b3V0dWJlX2NvbV9lbWJlZC5qcycpLmluaXQobW9ubywgZW5naW5lKTsKICAgIG1vZHVsZXMuc291bmRjbG91ZCA9IHJlcXVpcmUoJy4vc291bmRjbG91ZF9jb21fZW1iZWQuanMnKS5pbml0KG1vbm8sIGVuZ2luZSk7CiAgICBtb2R1bGVzLnZrb250YWt0ZSA9IHJlcXVpcmUoJy4vdmtvbnRha3RlX3J1X2VtYmVkLmpzJykuaW5pdChtb25vLCBlbmdpbmUpOwogICAgbW9kdWxlcy5vZG5va2xhc3NuaWtpID0gcmVxdWlyZSgnLi9vZG5va2xhc3NuaWtpX3J1X2VtYmVkLmpzJykuaW5pdChtb25vLCBlbmdpbmUpOwogICAgbW9kdWxlcy5mYWNlYm9vayA9IHJlcXVpcmUoJy4vZmFjZWJvb2tfY29tX2VtYmVkLmpzJykuaW5pdChtb25vLCBlbmdpbmUpOwogICAgbW9kdWxlcy5tYWlsX3J1ID0gcmVxdWlyZSgnLi9tYWlsX3J1X2VtYmVkLmpzJykuaW5pdChtb25vLCBlbmdpbmUpOwogICAgZW5naW5lLnV0aWxzID0gcmVxdWlyZSgnLi91dGlscy5qcycpLmluaXQobW9ubywgZW5naW5lKTsKICAgIGVuZ2luZS52YXJDYWNoZS5mZkJ1dHRvbiA9IGJ1dHRvbjsKCiAgICBtb25vLmV4dGVuZChlbmdpbmUuZXh0cmEsIGV4dHJhKTsKCiAgICBlbmdpbmUuZmZTb3ZldG5payA9IHJlcXVpcmUoJy4vc292ZXRuaWsubGliLmluaXQuanMnKTsKICAgIGVuZ2luZS5mZlNvdmV0bmlrLmluaXQobW9ubywgZW5naW5lKTsKCiAgICBlbmdpbmUubG9hZGVyLndoZW4oJ3ByZXBhcmUnLCBmdW5jdGlvbigpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBtb25vLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgbW9ub0xpYi5zZXJ2aWNlTGlzdC5iYWNrdXBTdG9yYWdlKCk7CiAgICAgIH0sIDUwMCk7CiAgICB9KTsKCiAgICBtb25vTGliLnNlcnZpY2VMaXN0LnJlc3RvcmVTdG9yYWdlKG51bGwsIGZ1bmN0aW9uKCkgewogICAgICBlbmdpbmUuaW5pdCgpOwogICAgfSk7CiAgfTsKCiAgZW5naW5lLnVzZXJUcmFjayA9IGZ1bmN0aW9uKCkgewogICAgaWYgKGVuZ2luZS5saXRlU3RvcmFnZS5pc1RpbWVvdXQoJ3RyYWNrVGltZW91dCcpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGVuZ2luZS5saXRlU3RvcmFnZS5zZXRUaW1lb3V0KCd0cmFja1RpbWVvdXQnLCA1ICogNjApOwoKICAgIHZhciBuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgIGVuZ2luZS50cmFjayh7CiAgICAgICAgdDogJ3NjcmVlbnZpZXcnLAogICAgICAgIGNkOiAnaW5pdCcsCiAgICAgICAgdGlkOiAnVUEtNzA1NTA1NS01JwogICAgICB9LCB7CiAgICAgICAgaWQ6ICdpbml0JywKICAgICAgICBvblN1Y2Nlc3M6IGZ1bmN0aW9uKCkgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgZW5naW5lLmxpdGVTdG9yYWdlLnNldFRpbWVvdXQoJ3RyYWNrVGltZW91dCcsIDEyICogNjAgKiA2MCk7CgogICAgICAgICAgaWYgKGVuZ2luZS5wcmVmZXJlbmNlcy5jb2hvcnRJbmRleCkgewogICAgICAgICAgICBlbmdpbmUuY29ob3J0LnRyYWNrKHsKICAgICAgICAgICAgICB0OiAnc2NyZWVudmlldycsCiAgICAgICAgICAgICAgY2Q6ICdpbml0JywKICAgICAgICAgICAgICBhbjogJ2hlbHBlcicsCiAgICAgICAgICAgICAgYWlkOiBlbmdpbmUudmFyQ2FjaGUuaGVscGVyTmFtZSwKICAgICAgICAgICAgICBhdjogZW5naW5lLnZhckNhY2hlLmN1cnJlbnRWZXJzaW9uCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChlbmdpbmUucHJlZmVyZW5jZXMuZXhwSW5kZXgpIHsKICAgICAgICAgICAgZW5naW5lLnRyYWNrKHsKICAgICAgICAgICAgICB0OiAnc2NyZWVudmlldycsCiAgICAgICAgICAgICAgY2Q6ICdpbml0JywKICAgICAgICAgICAgICB0aWQ6ICdVQS03MDU1MDU1LTExJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBlbmdpbmUuZXZlbnRzLmVtaXQoJ3NlbmRTY3JlZW5WaWV3Jyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgcmV0dXJuIGVuZ2luZS5kYmxUcmFja0NoZWNrKG5leHQpOwogIH07CgogIGVuZ2luZS50cmFja1ZhbGlkYXRlID0gZnVuY3Rpb24ocGFyYW1zKSB7CiAgICB2YXIgaXNWYWxpZFZhbHVlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKCF2YWx1ZSAmJiB2YWx1ZSAhPT0gMCAmJiB2YWx1ZSAhPT0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKFsnb2JqZWN0JywgJ2Z1bmN0aW9uJ10uaW5kZXhPZih0eXBlb2YgdmFsdWUpICE9PSAtMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CgogICAgaWYgKCFwYXJhbXMudCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKHBhcmFtcy50ID09PSAnZXZlbnQnKSB7CiAgICAgIGlmICghaXNWYWxpZFZhbHVlKHBhcmFtcy5lYykgfHwgIWlzVmFsaWRWYWx1ZShwYXJhbXMuZWEpIHx8ICFpc1ZhbGlkVmFsdWUocGFyYW1zLmVsKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSBlbHNlCiAgICBpZiAocGFyYW1zLnQgPT09ICdzY3JlZW52aWV3JykgewogICAgICBpZiAoIWlzVmFsaWRWYWx1ZShwYXJhbXMuY2QpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9IGVsc2UKICAgIGlmIChwYXJhbXMudCA9PT0gJ3NvY2lhbCcpIHsKICAgICAgaWYgKCFpc1ZhbGlkVmFsdWUocGFyYW1zLnN0KSB8fCAhaXNWYWxpZFZhbHVlKHBhcmFtcy5zYSkgfHwgIWlzVmFsaWRWYWx1ZShwYXJhbXMuc24pKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgZW5naW5lLnRyYWNrID0gZnVuY3Rpb24ocGFyYW1zLCBkZXRhaWxzKSB7CiAgICBpZiAoIWVuZ2luZS50cmFja1ZhbGlkYXRlKHBhcmFtcykpIHsKICAgICAgcmV0dXJuIG1vbm8uZXJyb3IoJ0ludmFsaWQgdHJhY2sgcGFyYW1zIScsIHBhcmFtcyk7CiAgICB9CiAgICByZXR1cm4gZW5naW5lLnNlbmRTdGF0c0luZm8ocGFyYW1zLCBkZXRhaWxzKTsKICB9OwoKICBlbmdpbmUuc2VuZFN0YXRzSW5mbyA9IGZ1bmN0aW9uKHBhcmFtcywgZGV0YWlscykgewogICAgaWYgKCFwYXJhbXMudCkgewogICAgICByZXR1cm4gbW9uby5lcnJvcignc2VuZFN0YXRzSW5mbyAidCIgaXMgZW1wdHkhJywgcGFyYW1zKTsKICAgIH0KCiAgICB2YXIgdmFyQ2FjaGUgPSBlbmdpbmUudmFyQ2FjaGU7CiAgICB2YXIgcHJlZmVyZW5jZXMgPSBlbmdpbmUucHJlZmVyZW5jZXM7CgogICAgdmFyIGRlZmF1bHRQYXJhbXMgPSB7CiAgICAgIHY6IDEsCiAgICAgIHVsOiBtb25vLmdldE5hdmlnYXRvcigpLmxhbmd1YWdlLAogICAgICB0aWQ6ICdVQS02NzczODEzMC0yJywKICAgICAgY2lkOiBlbmdpbmUuZ2V0VXVpZCgpLAogICAgICBjZDM6IGVuZ2luZS5sYW5ndWFnZS5sYW5nLAoKICAgICAgYW46ICdoZWxwZXInLAogICAgICBhaWQ6IHZhckNhY2hlLmhlbHBlck5hbWUsCiAgICAgIGF2OiB2YXJDYWNoZS5jdXJyZW50VmVyc2lvbgogICAgfTsKCiAgICBmb3IgKHZhciBrZXkgaW4gZGVmYXVsdFBhcmFtcykgewogICAgICBpZiAoIXBhcmFtcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgcGFyYW1zW2tleV0gPSBkZWZhdWx0UGFyYW1zW2tleV07CiAgICAgIH0KICAgIH0KCiAgICBpZiAocHJlZmVyZW5jZXMuZXhwSW5kZXgpIHsKICAgICAgcGFyYW1zLmNkMSA9ICd0ZXN0XycgKyBwcmVmZXJlbmNlcy5leHBJbmRleDsKICAgIH0KCiAgICB2YXIgZnJvbUlkID0gZW5naW5lLmxpdGVTdG9yYWdlLmdldCgnZnJvbUlkJywgMCk7CiAgICBpZiAoZnJvbUlkID4gMCkgewogICAgICBwYXJhbXMuY2QyID0gZnJvbUlkOwogICAgfQoKICAgIGlmIChwcmVmZXJlbmNlcy5oYXNTb3ZldG5paykgewogICAgICBwYXJhbXMuY2Q0ID0gcHJlZmVyZW5jZXMuc292ZXRuaWtFbmFibGVkID8gJ3RydWUnIDogJ2ZhbHNlJzsKICAgIH0KCiAgICBpZiAocHJlZmVyZW5jZXMuaGFzRFApIHsKICAgICAgcGFyYW1zLmNkNSA9IHByZWZlcmVuY2VzLnNvdmV0bmlrRW5hYmxlZCA/ICd0cnVlJyA6ICdmYWxzZSc7CiAgICB9CgogICAgcGFyYW1zLmNkNiA9IHByZWZlcmVuY2VzLnVtbXlEZXRlY3RlZCA/ICd0cnVlJyA6IHByZWZlcmVuY2VzLnNob3dVbW15SXRlbSA/ICdmYWxzZScgOiAnbm9uZSc7CgogICAgaWYgKHByZWZlcmVuY2VzLmhhc0F2aWFCYXIpIHsKICAgICAgcGFyYW1zLmNkNyA9IHByZWZlcmVuY2VzLmF2aWFCYXJFbmFibGVkID8gJ3RydWUnIDogJ2ZhbHNlJzsKICAgIH0KCiAgICBtb25vLmRlYnVnKCdUcmFjaycsIHBhcmFtcyk7CgogICAgZW5naW5lLnNlbmRJbkdhLnB1c2gocGFyYW1zLCBkZXRhaWxzKTsKICB9OwoKICBlbmdpbmUuY2hlY2tWZXJzaW9uID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgdmFyQ2FjaGUgPSBlbmdpbmUudmFyQ2FjaGU7CiAgICB2YXIgbmVlZFNhdmVWZXJzaW9uID0gZmFsc2U7CiAgICBpZiAodmFyQ2FjaGUuaXNGaXJzdHJ1bikgewogICAgICBlbmdpbmUubG9hZGVyLnJlYWR5KCdmaXJzdHJ1bicpOwoKICAgICAgbmVlZFNhdmVWZXJzaW9uID0gdHJ1ZTsKICAgIH0gZWxzZQogICAgaWYgKHZhckNhY2hlLmlzVXBncmFkZSkgewogICAgICBlbmdpbmUubG9hZGVyLnJlYWR5KCd1cGdyYWRlJyk7CgogICAgICBuZWVkU2F2ZVZlcnNpb24gPSB0cnVlOwogICAgfQoKICAgIGlmIChuZWVkU2F2ZVZlcnNpb24pIHsKICAgICAgZW5naW5lLmFjdGlvbkxpc3QudXBkYXRlT3B0aW9uKHsKICAgICAgICBrZXk6ICd2ZXJzaW9uJywKICAgICAgICB2YWx1ZTogdmFyQ2FjaGUuY3VycmVudFZlcnNpb24KICAgICAgfSk7CiAgICB9CiAgfTsKCiAgZW5naW5lLmxvYWRlci53aGVuKCdmaXJzdHJ1bicsIGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNHTSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKG1vbm8uaXNGRiAmJiAhZW5naW5lLnZhckNhY2hlLmZmQnV0dG9uKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgdXJsID0gJ2h0dHA6Ly9zYXZlZnJvbS5uZXQvdXNlci5waHA/aGVscGVyPScgKyBlbmdpbmUucHJlZmVyZW5jZXMuc2ZIZWxwZXJOYW1lICsgJztmaXJzdHJ1bic7CgogICAgZW5naW5lLnV0aWxzLmNoZWNrVXJsc09mT3BlblRhYnMoWwogICAgICAvaHR0cHM/OlwvXC8oW1x3XC1dK1wuKT9zYXZlZnJvbVwubmV0XC8odXBkYXRlLWhlbHBlcnx1c2VyanMtc2V0dXApXC5waHAvaQogICAgXSwgZnVuY3Rpb24oZm91bmRVcmxzKSB7CiAgICAgIGlmIChmb3VuZFVybHMubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZW5naW5lLnV0aWxzLmNoZWNrVXJsc09mT3BlblRhYnMoWwogICAgICAgIC9odHRwcz86XC9cL2xlZ2FsXC55YW5kZXhcLihydXxjb21cLnRyKVwvL2kKICAgICAgXSwgZnVuY3Rpb24oZm91bmRVcmxzKSB7CiAgICAgICAgdmFyIGFjdGl2ZSA9IGZvdW5kVXJscy5sZW5ndGggPT09IDA7CiAgICAgICAgcmV0dXJuIG1vbm8ub3BlblRhYih1cmwsIGFjdGl2ZSk7CiAgICAgIH0pOwogICAgfSk7CiAgfSk7CgogIGVuZ2luZS5sb2FkZXIud2hlbigncHJlcGFyZScsIGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwoKICAgIGlmIChwcmVmZXJlbmNlcy5zaG93VHV0b3JpYWwpIHsKICAgICAgbW9uby5zdG9yYWdlLmdldChbJ29uY2VZdFR1dG9yaWFsJywgJ29uY2VZdFR1dG9yaWFsVG9vbHRpcCddLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgaWYgKHN0b3JhZ2Uub25jZVl0VHV0b3JpYWwgJiYgc3RvcmFnZS5vbmNlWXRUdXRvcmlhbFRvb2x0aXApIHsKICAgICAgICAgIG1vbm8uc3RvcmFnZS5zZXQoewogICAgICAgICAgICBzaG93VHV0b3JpYWw6IHByZWZlcmVuY2VzLnNob3dUdXRvcmlhbCA9IDAKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzdG9yYWdlLm9uY2VZdFR1dG9yaWFsKSB7CiAgICAgICAgICBlbmdpbmUuYWN0aW9uTGlzdC5zZXRJY29uQmFkZ2UoewogICAgICAgICAgICB0ZXh0OiAnPycKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgaWYgKHByZWZlcmVuY2VzLnNob3dVbW15TGFuZGluZykgewogICAgICBtb25vLnN0b3JhZ2UuZ2V0KFsnb25jZVVtbXlMYW5kaW5nSGlkZSddLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgaWYgKHN0b3JhZ2Uub25jZVVtbXlMYW5kaW5nSGlkZSA+IDIpIHsKICAgICAgICAgIG1vbm8uc3RvcmFnZS5zZXQoewogICAgICAgICAgICBzaG93VW1teUxhbmRpbmc6IHByZWZlcmVuY2VzLnNob3dVbW15TGFuZGluZyA9IDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgogIGVuZ2luZS5sb2FkZXIud2hlbigncHJlcGFyZScsIGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKCFtb25vLmlzQ2hyb21lICYmICFtb25vLmlzRkYpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGVuZ2luZS50YWJMaXN0ZW5lci5lbmFibGUoKTsKICB9KTsKCiAgZW5naW5lLmxvYWRlci53aGVuKCdpbml0JywgZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAoIW1vbm8uaXNDaHJvbWUgfHwgIWNocm9tZS5ydW50aW1lLnNldFVuaW5zdGFsbFVSTCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHZhckNhY2hlID0gZW5naW5lLnZhckNhY2hlOwogICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwoKICAgIHZhciB1cGRhdGVVcmwgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHVuaW5zdGFsbFVybCA9ICdodHRwOi8vc2F2ZWZyb20ubmV0L2dvb2RieWUucGhwJzsKCiAgICAgIHZhciBwYXJhbXMgPSBtb25vLnBhcmFtKHsKICAgICAgICB2ZXJzaW9uOiB2YXJDYWNoZS5jdXJyZW50VmVyc2lvbiwKICAgICAgICBsYW5ndWFnZTogZW5naW5lLmxhbmd1YWdlLmxhbmcsCiAgICAgICAgYXBwaWQ6IHZhckNhY2hlLmhlbHBlck5hbWUsCiAgICAgICAgY291bnRyeTogcHJlZmVyZW5jZXMuY291bnRyeQogICAgICB9KTsKCiAgICAgIHZhciB1cmwgPSAodW5pbnN0YWxsVXJsICsgJz8nICsgcGFyYW1zKS5zdWJzdHIoMCwgMjU1KTsKICAgICAgY2hyb21lLnJ1bnRpbWUuc2V0VW5pbnN0YWxsVVJMKHVybCk7CiAgICB9OwoKICAgIHVwZGF0ZVVybCgpOwoKICAgIGVuZ2luZS5sb2FkZXIud2hlbigncHJlcGFyZScsIGZ1bmN0aW9uKCkgewogICAgICB1cGRhdGVVcmwoKTsKICAgIH0pOwoKICAgIGVuZ2luZS5sb2FkZXIud2hlbignZ2V0Q291bnRyeScsIGZ1bmN0aW9uKCkgewogICAgICB1cGRhdGVVcmwoKTsKICAgIH0pOwogIH0pOwoKICBlbmdpbmUubG9hZGVyLndoZW4oJ3ByZXBhcmUnLCBmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIGlmICghbW9uby5pc09wZXJhKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBlbmdpbmUub3BlcmFTaG93QnV0dG9uKGVuZ2luZS5wcmVmZXJlbmNlcy5idXR0b24pOwogIH0pOwoKICBlbmdpbmUubGl0ZVN0b3JhZ2UgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgc3RvcmFnZUtleSA9ICdsaXRlU3RvcmFnZSc7CiAgICB2YXIgc3RvcmUgPSB7fTsKICAgIC8qKgogICAgICogQHBhcmFtIHsqfSB2YWx1ZQogICAgICovCiAgICB2YXIgY2xvbmVPYmogPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgdzogdmFsdWUKICAgICAgfSkpLnc7CiAgICB9OwogICAgLyoqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYgogICAgICovCiAgICB2YXIgc2F2ZSA9IGZ1bmN0aW9uKGNiKSB7CiAgICAgIHZhciBvYmogPSB7fTsKICAgICAgb2JqW3N0b3JhZ2VLZXldID0gc3RvcmU7CiAgICAgIHJldHVybiBtb25vLnN0b3JhZ2Uuc2V0KG9iaiwgY2IpOwogICAgfTsKICAgIHZhciBkZWJvdW5jZVNhdmUgPSBmdW5jdGlvbigpIHsKICAgICAgbW9uby5lcnJvcignbGl0ZVN0b3JhZ2UgaXMgbm90IHNldCEnKTsKICAgIH07CiAgICAvKioKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBrZXkKICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgICAqLwogICAgdmFyIHNldFZhbHVlID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICBpZiAoc3RvcmVba2V5XSAhPT0gdmFsdWUpIHsKICAgICAgICBzdG9yZVtrZXldID0gdmFsdWU7CiAgICAgICAgZGVib3VuY2VTYXZlKCk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkKICAgICAqIEBwYXJhbSB7Kn0gZGVmYXVsdFZhbHVlCiAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAqLwogICAgdmFyIGdldFZhbHVlID0gZnVuY3Rpb24oa2V5LCBkZWZhdWx0VmFsdWUpIHsKICAgICAgdmFyIHZhbHVlID0gc3RvcmVba2V5XTsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICB2YWx1ZSA9IGRlZmF1bHRWYWx1ZTsKICAgICAgfQogICAgICByZXR1cm4gY2xvbmVPYmoodmFsdWUpOwogICAgfTsKICAgIC8qKgogICAgICogQHJldHVybnMge3N0cmluZ30KICAgICAqLwogICAgdmFyIGdldFN0b3JhZ2VLZXkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHN0b3JhZ2VLZXk7CiAgICB9OwogICAgLyoqCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RvcmFnZQogICAgICovCiAgICB2YXIgc2V0U3RvcmFnZSA9IGZ1bmN0aW9uKHN0b3JhZ2UpIHsKICAgICAgc3RvcmUgPSBzdG9yYWdlW3N0b3JhZ2VLZXldIHx8IHt9OwogICAgICBkZWJvdW5jZVNhdmUgPSBtb25vLmRlYm91bmNlKHNhdmUsIDEwMCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5CiAgICAgKiBAcGFyYW0ge251bWJlcn0gdGltZQogICAgICovCiAgICB2YXIgc2V0RXhwaXJlID0gZnVuY3Rpb24oa2V5LCB0aW1lKSB7CiAgICAgIHJldHVybiBzZXRWYWx1ZShrZXksIG1vbm8uZ2V0VGltZSgpICsgdGltZSk7CiAgICB9OwogICAgLyoqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5CiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAqLwogICAgdmFyIGlzVGltZW91dCA9IGZ1bmN0aW9uKGtleSkgewogICAgICByZXR1cm4gZ2V0VmFsdWUoa2V5LCAwKSA+IG1vbm8uZ2V0VGltZSgpOwogICAgfTsKICAgIC8qKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGtleQogICAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICAgKi8KICAgIHZhciBpc0V4cGlyZSA9IGZ1bmN0aW9uKGtleSkgewogICAgICByZXR1cm4gZ2V0VmFsdWUoa2V5LCAwKSA8IG1vbm8uZ2V0VGltZSgpOwogICAgfTsKICAgIHJldHVybiB7CiAgICAgIGdldFN0b3JhZ2VLZXk6IGdldFN0b3JhZ2VLZXksCiAgICAgIHNldFN0b3JhZ2U6IHNldFN0b3JhZ2UsCiAgICAgIHNldDogc2V0VmFsdWUsCiAgICAgIGdldDogZ2V0VmFsdWUsCiAgICAgIGlzVGltZW91dDogaXNUaW1lb3V0LAogICAgICBzZXRUaW1lb3V0OiBzZXRFeHBpcmUsCiAgICAgIGlzRXhwaXJlOiBpc0V4cGlyZSwKICAgICAgc2V0RXhwaXJlOiBzZXRFeHBpcmUKICAgIH07CiAgfSkoKTsKCiAgZW5naW5lLm1lbnVDb21tYW5kcyA9IHsKICAgIGNvbW1hbmRzOiBbewogICAgICBpZDogJ2Rvd25sb2FkRnJvbUN1cnJlbnRQYWdlJywKICAgICAgY29tbWFuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgZW5naW5lLmFjdGlvbkxpc3QuZG93bmxvYWRGcm9tQ3VycmVudFBhZ2UoKTsKICAgICAgfQogICAgfSwgewogICAgICBpZDogJ3VwZGF0ZUxpbmtzJywKICAgICAgbm90aWZ5OiAndXBkYXRlTGlua3NOb3RpZmljYXRpb24nLAogICAgICBtb2R1bGVzOiBbJ3ZrJywgJ29kbm9rbGFzc25pa2knLCAnZmFjZWJvb2snLCAnbG0nLAogICAgICAgICd5b3V0dWJlJywKICAgICAgICAnZGFpbHltb3Rpb24nLCAnaW5zdGFncmFtJywgJ3J1dHViZScKICAgICAgXQogICAgfSwgewogICAgICBpZDogJ2Rvd25sb2FkTVAzRmlsZXMnLAogICAgICBtb2R1bGVzOiBbJ3ZrJywgJ29kbm9rbGFzc25pa2knLCAnbWFpbHJ1J10KICAgIH0sIHsKICAgICAgaWQ6ICdkb3dubG9hZFBsYXlsaXN0JywKICAgICAgbW9kdWxlczogWyd2aycsICdvZG5va2xhc3NuaWtpJywgJ21haWxydSddCiAgICB9LCB7CiAgICAgIGlkOiAnZG93bmxvYWRQaG90b3MnLAogICAgICBtb2R1bGVzOiBbJ3ZrJ10KICAgIH0sIHsKICAgICAgaWQ6ICdzaG93T3B0aW9ucycsCiAgICAgIGNvbW1hbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIF9vcHRpb25zLnNob3coKTsKICAgICAgfQogICAgfSwgewogICAgICBpZDogJ3JlcG9ydEJ1ZycsCiAgICAgIGNvbW1hbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGVuZ2luZS5hY3Rpb25MaXN0LnJlcG9ydEJ1ZygpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGlkOiAnZW5hYmxlRGlzYWJsZU1vZHVsZScsCiAgICAgIGNvbW1hbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGVuZ2luZS5hY3Rpb25MaXN0LmdldEFjdGl2ZVRhYkluZm8obnVsbCwgZnVuY3Rpb24odGFiSW5mbykgewogICAgICAgICAgdGFiSW5mbyA9IHRhYkluZm8gfHwge307CiAgICAgICAgICB2YXIgc3RhdGUgPSB0YWJJbmZvLnN0YXRlID8gMCA6IDE7CiAgICAgICAgICBlbmdpbmUuYWN0aW9uTGlzdC52aWFNZW51X2NoYW5nZVN0YXRlKHsKICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICBwcmVmS2V5OiB0YWJJbmZvLnByZWZLZXksCiAgICAgICAgICAgIG1vZHVsZU5hbWU6IHRhYkluZm8ubW9kdWxlTmFtZQogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAoc3RhdGUpIHsKICAgICAgICAgICAgaWYgKGVuZ2luZS5wcmVmZXJlbmNlcy5idXR0b24gPT09IDEpIHsKICAgICAgICAgICAgICBlbmdpbmUuZ21TaG93QnV0dG9uKDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGVuZ2luZS5nbVNob3dCdXR0b24oMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVuZ2luZS5nbVNob3dCdXR0b24oMCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAgaWQ6ICdzaG93SGlkZUJ1dHRvbicsCiAgICAgIGNvbW1hbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBoaWRkZW5CdG4gPSBfbWVudS5tZW51ID09PSBudWxsOwogICAgICAgIGVuZ2luZS5hY3Rpb25MaXN0LnVwZGF0ZU9wdGlvbih7CiAgICAgICAgICBhY3Rpb246ICd1cGRhdGVPcHRpb24nLAogICAgICAgICAga2V5OiAnYnV0dG9uJywKICAgICAgICAgIHZhbHVlOiBoaWRkZW5CdG4gPyAxIDogMAogICAgICAgIH0pOwogICAgICB9CiAgICB9XSwKICAgIHJlZ2lzdGVyTW9kdWxlOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgaWYgKHR5cGVvZiBHTV9yZWdpc3Rlck1lbnVDb21tYW5kID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHN0cklkID0gcGFyYW1zLmlkOwoKICAgICAgdmFyIG5hbWUgPSBlbmdpbmUubGFuZ3VhZ2Vbc3RySWRdOwoKICAgICAgaWYgKHBhcmFtcy5jb21tYW5kKSB7CiAgICAgICAgcmV0dXJuIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQobmFtZSwgcGFyYW1zLmNvbW1hbmQpOwogICAgICB9CgogICAgICB2YXIgZm4gPSBmdW5jdGlvbigpIHsKICAgICAgICBlbmdpbmUub25NZXNzYWdlKHsKICAgICAgICAgIGFjdGlvbjogKHBhcmFtcy5tb2R1bGVzICE9PSB1bmRlZmluZWQgPyAndmlhTWVudV8nIDogJycpICsgcGFyYW1zLmlkCiAgICAgICAgfSk7CgogICAgICAgIGlmIChwYXJhbXMubm90aWZ5ICYmIHR5cGVvZiBHTV9ub3RpZmljYXRpb24gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICBHTV9ub3RpZmljYXRpb24oZW5naW5lLmxhbmd1YWdlW3BhcmFtcy5ub3RpZnldLCBudWxsLCBudWxsLCBudWxsLCAzMDAwKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICByZXR1cm4gR01fcmVnaXN0ZXJNZW51Q29tbWFuZChuYW1lLCBmbik7CiAgICB9LAogICAgcmVnaXN0ZXI6IGZ1bmN0aW9uKG1vZHVsZU5hbWUpIHsKICAgICAgdmFyIGhhc1JtRnVuYyA9IHR5cGVvZiBHTV91bnJlZ2lzdGVyTWVudUNvbW1hbmQgIT09ICJ1bmRlZmluZWQiOwogICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IHRoaXMuY29tbWFuZHNbaV07IGkrKykgewogICAgICAgIGlmIChoYXNSbUZ1bmMpIHsKICAgICAgICAgIGlmIChpdGVtLmdtSWQpIHsKICAgICAgICAgICAgR01fdW5yZWdpc3Rlck1lbnVDb21tYW5kKGl0ZW0uZ21JZCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoImdtSWQiKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWl0ZW0ubW9kdWxlcyB8fCBpdGVtLm1vZHVsZXMuaW5kZXhPZihtb2R1bGVOYW1lKSA+IC0xKSB7CiAgICAgICAgICBpdGVtLmdtSWQgPSB0aGlzLnJlZ2lzdGVyTW9kdWxlKGl0ZW0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIGVuZ2luZS5sb2FkZXIud2hlbigncHJlcGFyZScsIGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKCFtb25vLmlzSWZyYW1lKCkpIHsKICAgICAgZW5naW5lLm1lbnVDb21tYW5kcy5yZWdpc3RlcihfbW9kdWxlTmFtZSk7CgogICAgICBpZiAoZW5naW5lLnByZWZlcmVuY2VzLmJ1dHRvbiAmJiBlbmdpbmUucHJlZmVyZW5jZXNbZW5naW5lLnByZWZlcmVuY2VNYXBbX21vZHVsZU5hbWVdXSB8fCBfbW9kdWxlTmFtZSA9PT0gJ3NhdmVmcm9tJykgewogICAgICAgIGVuZ2luZS5nbVNob3dCdXR0b24oMSk7CiAgICAgIH0KICAgIH0KICB9KTsKICBlbmdpbmUuY2hlY2tVcGRhdGUgPSBmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciB2YXJDYWNoZSA9IGVuZ2luZS52YXJDYWNoZTsKICAgIHZhciB0eXBlTGlzdCA9IGVuZ2luZS5jaGVja1VwZGF0ZS50eXBlTGlzdDsKICAgIHZhciB0eXBlID0gKG1vbm8uaXNDaHJvbWUgJiYgIWVuZ2luZS5pc09wZXJhTmV4dCkgPyAnY2hyb21lJyA6IChtb25vLmlzRkYgJiYgZW5naW5lLmZmTm9TdG9yZSkgPyAnZmYnIDogbW9uby5pc0dNID8gJ2dtJyA6IG1vbm8uaXNTYWZhcmkgPyAnc2FmYXJpJyA6IHVuZGVmaW5lZDsKICAgIGlmICghdHlwZUxpc3RbdHlwZV0pIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciByZXF1ZXN0VmVyc2lvbiA9IGZ1bmN0aW9uKCkgewogICAgICBtb25vLnJlcXVlc3QoewogICAgICAgIHR5cGU6ICdHRVQnLAogICAgICAgIHVybDogdHlwZUxpc3RbdHlwZV0udXJsLAogICAgICAgIGNhY2hlOiBmYWxzZQogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICBpZiAoZXJyIHx8ICFkYXRhKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgdmVyc2lvbiA9IHR5cGVMaXN0W3R5cGVdLmdldFZlcnNpb24oZGF0YSk7CiAgICAgICAgaWYgKHZlcnNpb24pIHsKICAgICAgICAgIGVuZ2luZS5saXRlU3RvcmFnZS5zZXQoJ2xhc3RWZXJzaW9uJywgdmVyc2lvbik7CiAgICAgICAgICBlbmdpbmUubGl0ZVN0b3JhZ2Uuc2V0RXhwaXJlKCdsYXN0VmVyc2lvbkV4cGlyZScsIDYwNDgwMCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgdmFyIGlzRXhwaXJlID0gZW5naW5lLmxpdGVTdG9yYWdlLmlzRXhwaXJlKCdsYXN0VmVyc2lvbkV4cGlyZScpOwogICAgaWYgKHZhckNhY2hlLmlzVXBncmFkZSkgewogICAgICBpc0V4cGlyZSA9IHRydWU7CiAgICB9CgogICAgaWYgKGlzRXhwaXJlKSB7CiAgICAgIGVuZ2luZS5saXRlU3RvcmFnZS5zZXQoJ2xhc3RWZXJzaW9uJywgJycpOwogICAgICBlbmdpbmUubGl0ZVN0b3JhZ2Uuc2V0RXhwaXJlKCdsYXN0VmVyc2lvbkV4cGlyZScsIDg2NDAwKTsKCiAgICAgIHJlcXVlc3RWZXJzaW9uKCk7CiAgICB9CiAgfTsKCiAgZW5naW5lLmNoZWNrVXBkYXRlLnR5cGVMaXN0ID0gewogICAgY2hyb21lOiB7CiAgICAgIHVybDogJ2h0dHA6Ly9kb3dubG9hZC5zZi1oZWxwZXIuY29tL2Nocm9tZS91cGRhdGVzLTMueG1sJywKICAgICAgZ2V0VmVyc2lvbjogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHZhciB2ZXJzaW9uID0gZGF0YS5tYXRjaCgvdXBkYXRlY2hlY2suK3ZlcnNpb249WyciXSguKylbJyJdLyk7CiAgICAgICAgdmVyc2lvbiA9IHZlcnNpb24gJiYgdmVyc2lvblsxXTsKICAgICAgICBpZiAoIXZlcnNpb24pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZlcnNpb247CiAgICAgIH0KICAgIH0sCiAgICBmZjogewogICAgICB1cmw6ICdodHRwczovL2Rvd25sb2FkLnNmLWhlbHBlci5jb20vbW96aWxsYS91cGRhdGUucmRmJywKICAgICAgZ2V0VmVyc2lvbjogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHZhciB2ZXJzaW9uID0gZGF0YS5tYXRjaCgvPGVtOnZlcnNpb24+KC4rKTxcL2VtOnZlcnNpb24+Lyk7CiAgICAgICAgdmVyc2lvbiA9IHZlcnNpb24gJiYgdmVyc2lvblsxXTsKICAgICAgICBpZiAoIXZlcnNpb24pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZlcnNpb247CiAgICAgIH0KICAgIH0sCiAgICBzYWZhcmk6IHsKICAgICAgdXJsOiAnaHR0cHM6Ly9kb3dubG9hZC5zZi1oZWxwZXIuY29tL3NhZmFyaS91cGRhdGUucGxpc3QnLAogICAgICBnZXRWZXJzaW9uOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIHBvcyA9IGRhdGEuaW5kZXhPZignPGtleT5DRkJ1bmRsZVZlcnNpb248L2tleT4nKTsKICAgICAgICBpZiAocG9zID09PSAtMSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBkYXRhID0gZGF0YS5zdWJzdHIocG9zKTsKICAgICAgICB2YXIgdmVyc2lvbiA9IGRhdGEubWF0Y2goLzxzdHJpbmc+KC4rKTxcL3N0cmluZz4vKTsKICAgICAgICB2ZXJzaW9uID0gdmVyc2lvbiAmJiB2ZXJzaW9uWzFdOwogICAgICAgIGlmICghdmVyc2lvbikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdmVyc2lvbjsKICAgICAgfQogICAgfSwKICAgIGdtOiB7CiAgICAgIHVybDogJ2h0dHBzOi8vZG93bmxvYWQuc2YtaGVscGVyLmNvbS9jaHJvbWUvaGVscGVyLm1ldGEuanMnLAogICAgICBnZXRWZXJzaW9uOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIHZlcnNpb24gPSBkYXRhLm1hdGNoKC9AdmVyc2lvblxzKyguKylccypccj9cbi8pOwogICAgICAgIHZlcnNpb24gPSB2ZXJzaW9uICYmIHZlcnNpb25bMV07CiAgICAgICAgaWYgKCF2ZXJzaW9uKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJldHVybiB2ZXJzaW9uOwogICAgICB9CiAgICB9CiAgfTsKCiAgZW5naW5lLmxvYWRlci53aGVuKCdwcmVwYXJlJywgZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBlbmdpbmUuY2hlY2tVcGRhdGUoKTsKICB9KTsKICBlbmdpbmUuZm9yY2VNZXRhUmVxdWVzdCA9IHRydWU7CiAgZW5naW5lLmxvYWRlci53aGVuKCdpbml0JywgZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAobW9uby5pc0ZGICYmICFlbmdpbmUudmFyQ2FjaGUuZmZCdXR0b24pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKG1vbm8uaXNDaHJvbWUgJiYgbW9uby5pc0Nocm9tZU1vYmlsZSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGxhbmd1YWdlID0gZW5naW5lLmxhbmd1YWdlOwogICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwogICAgdmFyIG1ldGEgPSBlbmdpbmUudmFyQ2FjaGUubWV0YTsKCiAgICB2YXIgaXNEZW55ID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghcHJlZmVyZW5jZXMuaGFzRFAgfHwgIXByZWZlcmVuY2VzLnNvdmV0bmlrRW5hYmxlZCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwoKICAgIHZhciB1cGRhdGVTdGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICBkZWxldGUgZW5naW5lLnRhYkxpc3RlbmVyLmV4dGVuZEpzTGlzdC5kcDsKCiAgICAgIGVuZ2luZS5sb2FkZXIud2hlbignbG9hZExhbmd1YWdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKCFsYW5ndWFnZS5vcmlnT3B0aW9uc1NvdmV0bmlrRW5hYmxlZCkgewogICAgICAgICAgbGFuZ3VhZ2Uub3JpZ09wdGlvbnNTb3ZldG5pa0VuYWJsZWQgPSBsYW5ndWFnZS5vcHRpb25zU292ZXRuaWtFbmFibGVkOwogICAgICAgIH0KCiAgICAgICAgaWYgKHByZWZlcmVuY2VzLmhhc0RQKSB7CiAgICAgICAgICBsYW5ndWFnZS5vcHRpb25zU292ZXRuaWtFbmFibGVkID0gJ09mZmVyczRVJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGFuZ3VhZ2Uub3B0aW9uc1NvdmV0bmlrRW5hYmxlZCA9IGxhbmd1YWdlLm9yaWdPcHRpb25zU292ZXRuaWtFbmFibGVkOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAoaXNEZW55KCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGVuZ2luZS50YWJMaXN0ZW5lci5leHRlbmRKc0xpc3QuZHAgPSBkcDsKCiAgICAgIGlmIChtb25vLmlzR00gJiYgbWV0YS5kcCAmJiBtZXRhLmRwLmxpc3RFeHApIHsKICAgICAgICBwcmVmZXJlbmNlcy5kcExpc3RFeHAgPSAxOwogICAgICB9CgogICAgICBlbmdpbmUudGFiTGlzdGVuZXIuZW5hYmxlKCk7CiAgICB9OwoKICAgIHZhciBkcCA9IHsKICAgICAgZ2V0U2NyaXB0TGlzdDogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGxpc3QgPSBbXTsKCiAgICAgICAgaWYgKGlzRGVueSgpKSB7CiAgICAgICAgICB1cGRhdGVTdGF0ZSgpOwogICAgICAgICAgcmV0dXJuIGxpc3Q7CiAgICAgICAgfQoKICAgICAgICBsaXN0LnB1c2goJ2luY2x1ZGVzL2Fkdmlzb3Itc2YuanMnKTsKCiAgICAgICAgcmV0dXJuIGxpc3Q7CiAgICAgIH0KICAgIH07CgogICAgdmFyIGNoZWNrQ291bnRyeSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgY291bnRyeUxpc3QgPSBbCiAgICAgICAgJ2FyJywgJ2F1JywgJ2F0JywgJ2JlJywKICAgICAgICAnYnInLCAnY2EnLCAnY28nLCAnY3onLAogICAgICAgICdkaycsICdmcicsICdkZScsICdoaycsCiAgICAgICAgJ2h1JywgJ2luJywgJ2lkJywgJ2l0JywKICAgICAgICAnanAnLCAna2UnLCAnbXknLCAnbXgnLAogICAgICAgICdubCcsICdueicsICduZycsICdubycsCiAgICAgICAgJ3BoJywgJ3BsJywgJ3B0JywgJ3JvJywKICAgICAgICAncnMnLCAnc2cnLCAnc2snLCAnemEnLAogICAgICAgICdlcycsICdzZScsICd0aCcsICdnYicsCiAgICAgICAgJ3VzJwogICAgICBdOwoKICAgICAgaWYgKGNvdW50cnlMaXN0LmluZGV4T2YocHJlZmVyZW5jZXMuY291bnRyeSkgIT09IC0xKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgogICAgZW5naW5lLm9uT3B0aW9uQ2hhbmdlLnNvdmV0bmlrRW5hYmxlZC5kcE9uQ2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICB9OwoKICAgIHZhciBkcElzQXZhaWxhYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChwcmVmZXJlbmNlcy5oYXNTb3ZldG5paykgewogICAgICAgIHByZWZlcmVuY2VzLmhhc0RQID0gMDsKICAgICAgfSBlbHNlCiAgICAgIGlmIChtZXRhLmRwICYmICghbWV0YS5kcC5lbmFibGUgfHwgbWV0YS5kcC5jYW5jZWwpKSB7CiAgICAgICAgcHJlZmVyZW5jZXMuaGFzRFAgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHByZWZlcmVuY2VzLmhhc0RQID0gY2hlY2tDb3VudHJ5KCkgPyAxIDogMDsKICAgICAgfQogICAgfTsKCiAgICBlbmdpbmUubG9hZGVyLndoZW4oJ2xvYWRTZXR0aW5ncycsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgb25HZXRDb3VudHJ5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZHBJc0F2YWlsYWJsZSgpOwoKICAgICAgICB1cGRhdGVTdGF0ZSgpOwogICAgICB9OwoKICAgICAgb25HZXRDb3VudHJ5KCk7CgogICAgICBlbmdpbmUubG9hZGVyLndoZW4oJ2dldENvdW50cnknLCBmdW5jdGlvbigpIHsKICAgICAgICBvbkdldENvdW50cnkoKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBlbmdpbmUubG9hZGVyLndoZW4oJ2dldE1ldGEnLCBmdW5jdGlvbigpIHsKICAgICAgZHBJc0F2YWlsYWJsZSgpOwoKICAgICAgdXBkYXRlU3RhdGUoKTsKICAgIH0pOwoKICAgIGVuZ2luZS5ldmVudHMub24oJ2hhc1NvdmV0bmlrVXBkYXRlJywgZnVuY3Rpb24oKSB7CiAgICAgIGRwSXNBdmFpbGFibGUoKTsKCiAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICB9KTsKICB9KTsKICBlbmdpbmUubG9hZGVyLndoZW4oJ2luaXQnLCBmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIGlmIChtb25vLmlzRkYgJiYgIWVuZ2luZS52YXJDYWNoZS5mZkJ1dHRvbikgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAobW9uby5pc0Nocm9tZSAmJiBtb25vLmlzQ2hyb21lTW9iaWxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgcHJlZmVyZW5jZXMgPSBlbmdpbmUucHJlZmVyZW5jZXM7CgogICAgdmFyIGlzRGVueSA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXByZWZlcmVuY2VzLmhhc0F2aWFCYXIgfHwgIXByZWZlcmVuY2VzLmF2aWFCYXJFbmFibGVkKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgogICAgdmFyIHVwZGF0ZVN0YXRlID0gZnVuY3Rpb24oKSB7CiAgICAgIGRlbGV0ZSBlbmdpbmUudGFiTGlzdGVuZXIuZXh0ZW5kSnNMaXN0LmF2aWFCYXI7CgogICAgICBpZiAoaXNEZW55KCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGVuZ2luZS50YWJMaXN0ZW5lci5leHRlbmRKc0xpc3QuYXZpYUJhciA9IGF2aWFCYXI7CgogICAgICBlbmdpbmUudGFiTGlzdGVuZXIuZW5hYmxlKCk7CgogICAgICB0cmF2ZWxCYXJJbml0ICYmIHRyYXZlbEJhckluaXQoKTsKICAgIH07CgogICAgdmFyIGF2aWFCYXIgPSB7CiAgICAgIG1hdGNoQ2FjaGU6IC9udWxsLywKICAgICAgaW5jbHVkZUxpc3Q6IFsKICAgICAgICAnKjovLyoub3pvbi50cmF2ZWwvKicsCiAgICAgICAgJyo6Ly8qLm9uZXR3b3RyaXAuY29tLyonLAogICAgICAgICcqOi8vKi5za3lzY2FubmVyLiovKicsCiAgICAgICAgJyo6Ly8qLmFlcm9mbG90LnJ1LyonLAogICAgICAgICcqOi8vKi5tb21vbmRvLiovKicsCiAgICAgICAgJyo6Ly8qLmFueXdheWFueWRheS5jb20vKicsCiAgICAgICAgJyo6Ly8qLnN2eWF6bm95LnRyYXZlbC8qJywKICAgICAgICAnKjovL2F2aWEudGlja2V0cy5ydS8qJywKICAgICAgICAnKjovLyouczcucnUvKicsCiAgICAgICAgJyo6Ly8qLmt1cGliaWxldC5ydS8qJywKICAgICAgICAnKjovLyoudHJpcC5ydS8qJywKICAgICAgICAnKjovLyouc2luZGJhZC5ydS8qJywKICAgICAgICAnKjovLyouYXZpYWthc3NhLnJ1LyonLAogICAgICAgICcqOi8vKi5iaWxldGl4LnJ1LyonLAogICAgICAgICcqOi8vKi51dGFpci5ydS8qJywKCiAgICAgICAgJyo6Ly8qLmtheWFrLiovKicsCiAgICAgICAgJyo6Ly8qLm9yYml0ei5jb20vKicsCiAgICAgICAgJyo6Ly8qLnRyYXZlbG9jaXR5LmNvbS8qJywKICAgICAgICAnKjovLyouZXhwZWRpYS5jb20vKicsCiAgICAgICAgJyo6Ly8qLnByaWNlbGluZS5jb20vKicsCgogICAgICAgICcqOi8vKi5ib29raW5nLiovKicsCiAgICAgICAgJyo6Ly8qLmFnb2RhLiovKicsCiAgICAgICAgJyo6Ly8qLmhvdGVscy5jb20vKicsCiAgICAgICAgJyo6Ly8qLm9zdHJvdm9rLnJ1LyonLAogICAgICAgICcqOi8vKi50cmF2ZWwucnUvKicsCiAgICAgICAgJyo6Ly8qLm9rdG9nby5ydS8qJywKICAgICAgICAnKjovLyoucm9vbWd1cnUucnUvKicsCiAgICAgICAgJyo6Ly8qLnRyaXBhZHZpc29yLnJ1LyonLAogICAgICAgICcqOi8vKi5oaWx0b24ucnUvKicsCiAgICAgICAgJyo6Ly8qLmhpbHRvbi5jb20vKicsCiAgICAgICAgJyo6Ly8qLm1hcnJpb3R0LmNvbS8qJywKCiAgICAgICAgJyo6Ly8qLmhvc3RlbHdvcmxkLmNvbS8qJywKICAgICAgICAnKjovLyoudGlrZXQuY29tLyonLAogICAgICAgICcqOi8vKi5ob3RlbHNjbGljay5jb20vKicsCiAgICAgICAgJyo6Ly8qLmhvdGVsc2NvbWJpbmVkLmNvbS8qJwogICAgICBdLAogICAgICBnZXRTY3JpcHRMaXN0OiBmdW5jdGlvbih1cmwpIHsKICAgICAgICB2YXIgbGlzdCA9IFtdOwoKICAgICAgICBpZiAoaXNEZW55KCkpIHsKICAgICAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICAgICAgICByZXR1cm4gbGlzdDsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm1hdGNoQ2FjaGUudGVzdCh1cmwpKSB7CiAgICAgICAgICBsaXN0LnB1c2goJ2luY2x1ZGVzL2NvbXBvbmVudHMuanMnKTsKICAgICAgICAgIGxpc3QucHVzaCgnaW5jbHVkZXMvYXZpYUJhci5qcycpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbGlzdDsKICAgICAgfQogICAgfTsKCiAgICBhdmlhQmFyLm1hdGNoQ2FjaGUgPSBhdmlhQmFyLmluY2x1ZGVMaXN0Lm1hcChmdW5jdGlvbihwYXR0ZXJuKSB7CiAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgfSkuam9pbignfCcpOwogICAgYXZpYUJhci5tYXRjaENhY2hlID0gbmV3IFJlZ0V4cChhdmlhQmFyLm1hdGNoQ2FjaGUpOwoKICAgIHZhciBjaGVja0NvdW50cnkgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNvdW50cnlMaXN0ID0gWwogICAgICAgICdydScsICdieScsICdreicsICd1YScsICd1cycsICdpZCcsICdpbicsICd0aCcKICAgICAgXTsKCiAgICAgIGlmIChjb3VudHJ5TGlzdC5pbmRleE9mKHByZWZlcmVuY2VzLmNvdW50cnkpICE9PSAtMSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICB2YXIgbGFuZzJjb3VudHJ5ID0gewogICAgICAgIGJlOiAnYnknLAogICAgICAgIGtrOiAna3onLAogICAgICAgIHJ1OiAncnUnLAogICAgICAgIHVrOiAndWEnLAogICAgICAgICdlbic6IDEKICAgICAgfTsKCiAgICAgIHZhciBuYXZMYW5ndWFnZSA9IGVuZ2luZS5nZXROYXZMYW5ndWFnZSgpLnN1YnN0cigwLCAyKS50b0xvd2VyQ2FzZSgpOwogICAgICBpZiAobGFuZzJjb3VudHJ5W25hdkxhbmd1YWdlXSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9OwoKICAgIGVuZ2luZS5vbk9wdGlvbkNoYW5nZS5hdmlhQmFyRW5hYmxlZCA9IGZ1bmN0aW9uKCkgewogICAgICB1cGRhdGVTdGF0ZSgpOwogICAgfTsKCiAgICB2YXIgb25Mb2FkU2V0dGluZ3MgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIG9uR2V0Q291bnRyeSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHByZWZlcmVuY2VzLmhhc0F2aWFCYXIgPSBjaGVja0NvdW50cnkoKSA/IDEgOiAwOwoKICAgICAgICBpZiAocHJlZmVyZW5jZXMuaGFzQXZpYUJhciAmJiBlbmdpbmUudmFyQ2FjaGUub25jZVRyYWNrQXZpYUJhciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBtb25vLnN0b3JhZ2UuZ2V0KCdvbmNlVHJhY2tBdmlhQmFyJywgZnVuY3Rpb24oc3RvcmFnZSkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBzdG9yYWdlLm9uY2VUcmFja0F2aWFCYXI7CiAgICAgICAgICAgIGlmICghdmFsdWUgJiYgdmFsdWUgIT09IDApIHsKICAgICAgICAgICAgICBpZiAobW9uby5nZXRSYW5kb21JbnQoMCwgMTAwKSA8IDEwKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IDE7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbW9uby5zdG9yYWdlLnNldCh7CiAgICAgICAgICAgICAgICBvbmNlVHJhY2tBdmlhQmFyOiB2YWx1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVuZ2luZS52YXJDYWNoZS5vbmNlVHJhY2tBdmlhQmFyID0gdmFsdWU7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICAgIH07CgogICAgICBvbkdldENvdW50cnkoKTsKCiAgICAgIGVuZ2luZS5sb2FkZXIud2hlbihbJ2dldENvdW50cnknXSwgZnVuY3Rpb24oKSB7CiAgICAgICAgb25HZXRDb3VudHJ5KCk7CiAgICAgIH0pOwoKICAgICAgZW5naW5lLmV2ZW50cy5vbignc2VuZFNjcmVlblZpZXcnLCBmdW5jdGlvbigpIHsKICAgICAgICBpZiAocHJlZmVyZW5jZXMuaGFzQXZpYUJhciAmJiBlbmdpbmUudmFyQ2FjaGUub25jZVRyYWNrQXZpYUJhcikgewogICAgICAgICAgZW5naW5lLnRyYWNrKHsKICAgICAgICAgICAgdDogJ3NjcmVlbnZpZXcnLAogICAgICAgICAgICBjZDogJ2luaXQnLAogICAgICAgICAgICB0aWQ6ICdVQS03MDQzMjQzNS0xJwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgZW5naW5lLmxvYWRlci53aGVuKCdsb2FkU2V0dGluZ3MnLCBvbkxvYWRTZXR0aW5ncyk7CgogICAgdmFyIHRyYXZlbEJhckluaXQgPSBmdW5jdGlvbigpIHsKICAgICAgdHJhdmVsQmFySW5pdCA9IG51bGw7CgogICAgICB2YXIgYnJvd3NlciA9IHsKICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgICByZXR1cm4gbW9uby5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoY2IsIHsKICAgICAgICAgICAgaXNCZzogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBzdG9yYWdlOiB7CiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGRhdGEsIGNiKSB7CiAgICAgICAgICAgIHJldHVybiBtb25vLnN0b3JhZ2UuZ2V0KGRhdGEsIGNiKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKGRhdGEsIGNiKSB7CiAgICAgICAgICAgIHJldHVybiBtb25vLnN0b3JhZ2Uuc2V0KGRhdGEsIGNiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgdHJhdmVsQmFyID0ge307CgogICAgICB0cmF2ZWxCYXIuYXBwSW5mbyA9IHsKICAgICAgICBpZDogJzg5NzU2LnNmSGVscGVyJywKICAgICAgICBza3lTY2FubmVyS2V5OiAnbWE4ODY4OTg0NjQ4NzQxMDQ3NDEwNzk1MDQwNzI3NTYnLAogICAgICAgIHRyYWNrOiB0cnVlCiAgICAgIH07CgogICAgICB0cmF2ZWxCYXIuQVBJID0gewogICAgICAgIHNldFJlbW92ZWRTdGF0ZTogZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICAgIGJyb3dzZXIuc3RvcmFnZS5nZXQoJ2F2aWFCYXInLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgICAgIHN0b3JhZ2UuYXZpYUJhciA9IHN0b3JhZ2UuYXZpYUJhciB8fCB7fTsKICAgICAgICAgICAgc3RvcmFnZS5hdmlhQmFyLnJlbW92ZWQgPSAhIXN0YXRlOwogICAgICAgICAgICByZXR1cm4gYnJvd3Nlci5zdG9yYWdlLnNldChzdG9yYWdlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHZhciB0cmFjayA9IGZ1bmN0aW9uKGRldGFpbHMpIHsKICAgICAgICB2YXIgdGlkID0gJ1VBLTcwNDMyNDM1LTEnOwogICAgICAgIGlmIChbJ2NoZWFwZmxpZ2h0RXJyb3InLCAnaG90ZWxFcnJvciddLmluZGV4T2YoZGV0YWlscy5lYykgIT09IC0xKSB7CiAgICAgICAgICB0aWQgPSAnVUEtNzA1NTA1NS0xMCc7CiAgICAgICAgICBpZiAoIW1vbm8uaXNHTSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBkZXRhaWxzLnRpZCA9IHRpZDsKCiAgICAgICAgZW5naW5lLnRyYWNrKGRldGFpbHMpOwogICAgICB9OwoKICAgICAgYnJvd3Nlci5vbk1lc3NhZ2UoZnVuY3Rpb24obXNnLCByZXNwb25zZSkgewogICAgICAgIGlmIChtc2cgJiYgbXNnLmFjdGlvbikgewogICAgICAgICAgc3dpdGNoIChtc2cuYWN0aW9uKSB7CiAgICAgICAgICAgIGNhc2UgInRickdldEluZm8iOgogICAgICAgICAgICAgIHJlc3BvbnNlKHRyYXZlbEJhci5hcHBJbmZvKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAidGJyR2V0RGF0YSI6CiAgICAgICAgICAgICAgbW9uby5yZXF1ZXN0KG1zZywgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoZXJyID8gbnVsbCA6IGRhdGEpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJ0YnJTdG9yYWdlIjoKICAgICAgICAgICAgICBpZiAobXNnLmdldCkgewogICAgICAgICAgICAgICAgYnJvd3Nlci5zdG9yYWdlLmdldChtc2cuZ2V0LCByZXNwb25zZSk7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgaWYgKG1zZy5zZXQpIHsKICAgICAgICAgICAgICAgIGJyb3dzZXIuc3RvcmFnZS5zZXQobXNnLnNldCwgcmVzcG9uc2UpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAidGJyRXZlbnQiOgogICAgICAgICAgICAgIGlmIChtc2cudHlwZSA9PT0gJ3RyYWNrJykgewogICAgICAgICAgICAgICAgdHJhY2sobXNnLmRhdGFbMF0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICB9KTsKICBlbmdpbmUubG9hZGVyLndoZW4oJ2luaXQnLCBmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIGlmIChtb25vLmlzRkYgJiYgIWVuZ2luZS52YXJDYWNoZS5mZkJ1dHRvbikgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKG1vbm8uaXNDaHJvbWUgJiYgbW9uby5pc0Nocm9tZU1vYmlsZSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwogICAgdmFyIG1ldGEgPSBlbmdpbmUudmFyQ2FjaGUubWV0YTsKCiAgICB2YXIgaXNEZW55ID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghcHJlZmVyZW5jZXMuaGFzRnNTdGF0IHx8ICFwcmVmZXJlbmNlcy5zdGF0RW5hYmxlZCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgdXBkYXRlU3RhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKGlzRGVueSgpKSB7CiAgICAgICAgZGVsZXRlIGVuZ2luZS50YWJMaXN0ZW5lci5leHRlbmRKc0xpc3Quc3RhdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbmdpbmUudGFiTGlzdGVuZXIuZXh0ZW5kSnNMaXN0LnN0YXQgPSBzdGF0OwogICAgICAgIGVuZ2luZS50YWJMaXN0ZW5lci5lbmFibGUoKTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgc3RhdCA9IHsKICAgICAgbm9CbGFja0xpc3Q6IHRydWUsCiAgICAgIGdldFNjcmlwdExpc3Q6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsaXN0ID0gW107CgogICAgICAgIGlmIChpc0RlbnkoKSkgewogICAgICAgICAgdXBkYXRlU3RhdGUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGlzdC5wdXNoKCdpbmNsdWRlcy9mc1N0YXQuanMnKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBsaXN0OwogICAgICB9CiAgICB9OwoKICAgIGVuZ2luZS5ldmVudHMub24oJ3N0YXRFbmFibGVkQ2hhbmdlJywgZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgdXBkYXRlU3RhdGUoKTsKICAgIH0pOwoKICAgIHZhciBpc0F2YWlsYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAobWV0YS5mc1N0YXQgJiYgKCFtZXRhLmZzU3RhdC5lbmFibGUgfHwgbWV0YS5mc1N0YXQuY2FuY2VsKSkgewogICAgICAgIHByZWZlcmVuY2VzLmhhc0ZzU3RhdCA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJlZmVyZW5jZXMuaGFzRnNTdGF0ID0gMTsKICAgICAgfQogICAgfTsKCiAgICBlbmdpbmUuZXZlbnRzLm9uKCdzdGF0RW5hYmxlZENoYW5nZScsIGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICB9KTsKCiAgICBlbmdpbmUubG9hZGVyLndoZW4oJ2dldE1ldGEnLCBmdW5jdGlvbigpIHsKICAgICAgaXNBdmFpbGFibGUoKTsKCiAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICB9KTsKCiAgICBlbmdpbmUubG9hZGVyLndoZW4oJ3ByZXBhcmUnLCBmdW5jdGlvbigpIHsKICAgICAgaXNBdmFpbGFibGUoKTsKCiAgICAgIHVwZGF0ZVN0YXRlKCk7CiAgICB9KTsKICB9KTsKICBlbmdpbmUuZXZlbnRzLm9uKCdzZW5kU2NyZWVuVmlldycsIGZ1bmN0aW9uKCkgewogICAgdmFyIHByZWZlcmVuY2VzID0gZW5naW5lLnByZWZlcmVuY2VzOwogICAgdmFyIHZhckNhY2hlID0gZW5naW5lLnZhckNhY2hlOwoKICAgIGlmIChwcmVmZXJlbmNlcy5oYXNGc1N0YXQgfHwgcHJlZmVyZW5jZXMuaGFzU3dTdGF0KSB7CiAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgdjogMSwKICAgICAgICB1bDogbW9uby5nZXROYXZpZ2F0b3IoKS5sYW5ndWFnZSwKICAgICAgICB0aWQ6ICdVQS02NzczODEzMC03JywKICAgICAgICBjaWQ6IGVuZ2luZS5nZXRVdWlkKCksCiAgICAgICAgYW46ICdoZWxwZXInLAogICAgICAgIGFpZDogdmFyQ2FjaGUuaGVscGVyTmFtZSwKICAgICAgICBhdjogdmFyQ2FjaGUuY3VycmVudFZlcnNpb24sCiAgICAgICAgdDogJ3NjcmVlbnZpZXcnLAogICAgICAgIGNkOiAnaW5pdCcsCiAgICAgICAgY2QxOiBwcmVmZXJlbmNlcy5oYXNGc1N0YXQgPyBwcmVmZXJlbmNlcy5zdGF0RW5hYmxlZCA/ICd0cnVlJyA6ICdmYWxzZScgOiAnbm9uZScsCiAgICAgICAgY2QyOiBwcmVmZXJlbmNlcy5oYXNTd1N0YXQgPyBwcmVmZXJlbmNlcy5zdGF0RW5hYmxlZCA/ICd0cnVlJyA6ICdmYWxzZScgOiAnbm9uZScKICAgICAgfTsKCiAgICAgIGVuZ2luZS5zZW5kSW5HYS5wdXNoKHBhcmFtcyk7CiAgICB9CiAgfSk7CiAgZW5naW5lLmxvYWRlci53aGVuKCdwcmVwYXJlJywgZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAodHlwZW9mIGVuZ2luZS5tb2R1bGVzLnlvdXR1YmUgIT09ICdvYmplY3QnKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgdGl0bGVSZSA9IC8mdGl0bGU9W14mXSokLzsKICAgIHZhciBjb2xsZWN0TGlua3MgPSBmdW5jdGlvbihyZXNwb25zZSwgdmlkKSB7CiAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLmxpbmtzIHx8ICFyZXNwb25zZS50aXRsZSB8fCAhdmlkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgb2JqID0gewogICAgICAgIHZpZDogdmlkLAogICAgICAgIGxpbmtzOiB7fSwKICAgICAgICB0aXRsZTogcmVzcG9uc2UudGl0bGUKICAgICAgfTsKCiAgICAgIHZhciBpdGFnTGlzdCA9IFs1LCAxNywgMTgsIDIyLCAzNiwgNDMsIDEzNSwgMTM3LCAxMzgsIDE0MCwgMjY0XTsKICAgICAgaXRhZ0xpc3QuZm9yRWFjaChmdW5jdGlvbihpdGFnKSB7CiAgICAgICAgdmFyIGxpbmsgPSByZXNwb25zZS5saW5rc1tpdGFnXTsKICAgICAgICBpZiAobGluaykgewogICAgICAgICAgb2JqLmxpbmtzW2l0YWddID0gbGluay5yZXBsYWNlKHRpdGxlUmUsICcnKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKCFPYmplY3Qua2V5cyhvYmoubGlua3MpLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgIHVybDogJ2h0dHA6Ly9zYXZlZnJvbS5uZXQvdG9vbHMveXRfaGVscGVyLnBocCcsCiAgICAgICAgZGF0YTogbW9uby5wYXJhbSh7CiAgICAgICAgICB2aWRlb19pZDogb2JqLnZpZCwKICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KG9iaikKICAgICAgICB9KQogICAgICB9KTsKICAgIH07CgogICAgdmFyIF90aGlzID0gZW5naW5lLm1vZHVsZXMueW91dHViZTsKICAgIHZhciBfb3JpZ0dldFlvdXR1YmVMaW5rcyA9IF90aGlzLmdldFlvdXR1YmVMaW5rczsKICAgIF90aGlzLmdldFlvdXR1YmVMaW5rcyA9IGZ1bmN0aW9uKG1zZywgY2IpIHsKICAgICAgcmV0dXJuIF9vcmlnR2V0WW91dHViZUxpbmtzLmNhbGwoX3RoaXMsIG1zZywgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICBjb2xsZWN0TGlua3MocmVzcG9uc2UsIG1zZy5leHRWaWRlb0lkKTsKICAgICAgICByZXR1cm4gY2IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfSk7CiAgICB9OwogIH0pOwogIC8vQGluc2VydAoKICBpZiAobW9uby5pc01vZHVsZSkgewogICAgZXhwb3J0cy5pbml0ID0gZW5naW5lLm1vZHVsZUluaXQ7CiAgfSBlbHNlCiAgICBtb25vLm9uUmVhZHkoZnVuY3Rpb24oKSB7CiAgICAgIGlmIChtb25vLmlzR00pIHsKICAgICAgICBlbmdpbmUuaW5pdE1lc3NhZ2VMaXN0ZW5lcigpOwogICAgICB9IGVsc2UgewogICAgICAgIGVuZ2luZS5pbml0KCk7CiAgICAgIH0KICAgIH0pOwogIHZhciBiZ191dGlscyA9IHsKICAgIGdldEZpbGVTaXplOiBmdW5jdGlvbihtZXNzYWdlLCBjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciB1cmwgPSBtZXNzYWdlLnVybDsKICAgICAgdmFyIHJlc3BvbnNlID0gewogICAgICAgIGZpbGVTaXplOiAwLAogICAgICAgIGZpbGVUeXBlOiAnJywKICAgICAgICBzdGF0dXM6IDAKICAgICAgfTsKICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICB1cmw6IHVybCwKICAgICAgICB0eXBlOiAnSEVBRCcKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgcmV0dXJuIGNiKHJlc3BvbnNlKTsKICAgICAgICB9CgogICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IHJlc3Auc3RhdHVzQ29kZTsKCiAgICAgICAgcmVzcG9uc2UuZmlsZVNpemUgPSBwYXJzZUludChyZXNwLmhlYWRlcnNbJ2NvbnRlbnQtbGVuZ3RoJ10pIHx8IDA7CgogICAgICAgIHZhciBjb250ZW50VHlwZSA9IHJlc3AuaGVhZGVyc1snY29udGVudC10eXBlJ107CiAgICAgICAgaWYgKGNvbnRlbnRUeXBlKSB7CiAgICAgICAgICByZXNwb25zZS5maWxlVHlwZSA9IGNvbnRlbnRUeXBlOwogICAgICAgIH0KCiAgICAgICAgY2IocmVzcG9uc2UpOwogICAgICB9KTsKICAgIH0sCiAgICBkb3dubG9hZEZpbGU6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgdXJsID0gbWVzc2FnZS5vcHRpb25zLnVybDsKICAgICAgdmFyIGZpbGVuYW1lID0gbWVzc2FnZS5vcHRpb25zLmZpbGVuYW1lOwogICAgICBpZiAobW9uby5pc0ZGKSB7CiAgICAgICAgcmV0dXJuIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAnZG93bmxvYWQnLAogICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICBmaWxlbmFtZTogZmlsZW5hbWUKICAgICAgICB9LCBudWxsLCAnc2VydmljZScpOwogICAgICB9IGVsc2UKICAgICAgaWYgKG1vbm8uaXNDaHJvbWUpIHsKICAgICAgICB2YXIgb25IYXNQZXJtaXNzaW9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gY2hyb21lLmRvd25sb2Fkcy5kb3dubG9hZCh7CiAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICBmaWxlbmFtZTogZmlsZW5hbWUKICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgaWYgKGNocm9tZS5kb3dubG9hZHMgJiYgY2hyb21lLmRvd25sb2Fkcy5kb3dubG9hZCkgewogICAgICAgICAgcmV0dXJuIG9uSGFzUGVybWlzc2lvbigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gY2hyb21lLnBlcm1pc3Npb25zLnJlcXVlc3QoewogICAgICAgICAgICBwZXJtaXNzaW9uczogWydkb3dubG9hZHMnXQogICAgICAgICAgfSwgZnVuY3Rpb24oZ3JhbnRlZCkgewogICAgICAgICAgICBpZiAoZ3JhbnRlZCkgewogICAgICAgICAgICAgIHJldHVybiBvbkhhc1Blcm1pc3Npb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UKICAgICAgaWYgKG1vbm8uaXNHTSkgewogICAgICAgIHJldHVybiBHTV9kb3dubG9hZCh1cmwsIGZpbGVuYW1lKTsKICAgICAgfQogICAgfSwKICAgIGNocm9tZUxpc3REb3dubG9hZDogZnVuY3Rpb24obGlzdCwgZm9sZGVyKSB7CiAgICAgIHZhciB3YWl0RG93bmxvYWRJZCA9IG51bGw7CgogICAgICBsaXN0ID0gbGlzdC5tYXAoZnVuY3Rpb24oaXRlbSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB1cmw6IGl0ZW0udXJsLAogICAgICAgICAgZmlsZW5hbWU6IGZvbGRlciArIGl0ZW0uZmlsZW5hbWUKICAgICAgICB9OwogICAgICB9KTsKCiAgICAgIHZhciBhZGRMaXN0ZW5lciA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNocm9tZS5kb3dubG9hZHMub25DaGFuZ2VkLmFkZExpc3RlbmVyKG9uQ2hhbmdlKTsKICAgICAgfTsKCiAgICAgIHZhciByZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNocm9tZS5kb3dubG9hZHMub25DaGFuZ2VkLnJlbW92ZUxpc3RlbmVyKG9uQ2hhbmdlKTsKICAgICAgfTsKCiAgICAgIHZhciBvbkNoYW5nZSA9IGZ1bmN0aW9uKGRvd25sb2FkRGVsdGEpIHsKICAgICAgICBpZiAoZG93bmxvYWREZWx0YS5pZCAhPT0gd2FpdERvd25sb2FkSWQgfHwgIWRvd25sb2FkRGVsdGEuc3RhdGUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKFsnaW50ZXJydXB0ZWQnLCAnY29tcGxldGUnXS5pbmRleE9mKGRvd25sb2FkRGVsdGEuc3RhdGUuY3VycmVudCkgIT09IC0xKSB7CiAgICAgICAgICB3YWl0RG93bmxvYWRJZCA9IG51bGw7CiAgICAgICAgICByZXR1cm4gb25TdWNjZXNzKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgYWRkTGlzdGVuZXIoKTsKCiAgICAgIHZhciBpbmRleCA9IC0xOwogICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgICB2YXIgaXRlbSA9IGxpc3RbaW5kZXhdOwogICAgICAgIGlmICghaXRlbSkgewogICAgICAgICAgcmVtb3ZlTGlzdGVuZXIoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjaHJvbWUuZG93bmxvYWRzLmRvd25sb2FkKHsKICAgICAgICAgIHVybDogaXRlbS51cmwsCiAgICAgICAgICBmaWxlbmFtZTogaXRlbS5maWxlbmFtZQogICAgICAgIH0sIGZ1bmN0aW9uKGRvd25sb2FkSWQpIHsKICAgICAgICAgIHdhaXREb3dubG9hZElkID0gZG93bmxvYWRJZDsKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIHJldHVybiBvblN1Y2Nlc3MoKTsKICAgIH0sCiAgICBkb3dubG9hZExpc3Q6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgbGlzdCA9IG1lc3NhZ2UuZmlsZUxpc3Q7CiAgICAgIHZhciBmb2xkZXIgPSBtZXNzYWdlLmZvbGRlcjsKCiAgICAgIGlmIChtb25vLmlzQ2hyb21lICYmIGNocm9tZS5kb3dubG9hZHMgJiYgY2hyb21lLmRvd25sb2Fkcy5kb3dubG9hZCkgewogICAgICAgIF90aGlzLmNocm9tZUxpc3REb3dubG9hZChsaXN0LCBmb2xkZXIpOwogICAgICB9IGVsc2UgewogICAgICAgIGxpc3QuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICBfdGhpcy5kb3dubG9hZEZpbGUoewogICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgdXJsOiBpdGVtLnVybCwKICAgICAgICAgICAgICBmaWxlbmFtZTogZm9sZGVyICsgaXRlbS5maWxlbmFtZQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGdldFVtbXlJY29uOiBmdW5jdGlvbihtZXNzYWdlLCBjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBpY29uID0gJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBWUFBQUFmOC85aEFBQUI5MGxFUVZRNEVjVlN5Mm9VVVJDdHFtN0hjWWdtWURUaVl4RUVFUmRaR1AwQjBVVndFY1N2OExISWI0Z2JRY2pHbFZ0QjQwWWhma0FXdWhzMHVGT0lnakpvbWlFenp0enVlNCtuN3JUZ0g2U2FvcXBQbmFvNmZXK0xITGFwQzloZFBITWJLVDFVVGNzUVd4REJuQUFkRmt1dlE2UVIxY0QwUUFVVm9GKzBrS2RYQm9PMzJqOTU5bWFLOFYxTFZEYUJEWGt3bTlxMzJhdHovaG1ScElaYjVTVHFQYURJalAvb0ZBUzVYdTFsL01QQ0JaaHh0MDl1U1J5a0NuMVFobVFyMU1pU1EzVFBHWWRJTXR3ZlpQaDNNamtobHZPV09jdVRySlFCNVZKZVIwZzVIbHpqTVNTVnBwN210UUdGQkpqWHdKcDY5QWxxdGxUVzBicFE2bk5MYlRkalNDSXhOaGtPcVVCd0Jjb25aWVdacjFHNlJnWGNSb0k3ODJrMHJPNjgxdlZxMTVvNlNHeUNyRmVmYkhWblM2ZU5rbWNTeU1sT3ZyNDhlcm5pbWpsZjVXY1V1UDF6cjdDN1cwOTAvdHdpTWNqdyt5OTVkV2NqWFJyN1NuNkJhOG1tQjFSUS9Nd3FPSzJtZzM1NkZQRmk0eEdtNHo4STQwbk9UNDM0T2FuRWxEZFdNMmFIL2VBdEhPbHo5OFhaUkJjaDB1UG5IUHU0Sjl1UG4rZE56TkdUTGhvL0tqK0QxZ3phMTJmbDFSdUV0bG1hYVdQaUdrT0s4azBtZWNCNU5uZXM4RFp2ZGl3UGdSVnJtYkFwMTlhSThGZTJaU0ROODZhT2s5T3BrZmlIcWZLb2FwOUpmTVRXZmNhdnZOWE4rL0g5RzU5NnVQWVg4M0FXVVZDNi9Gc0FBQUFBU1VWT1JLNUNZSUk9JzsKICAgICAgY2IoaWNvbik7CiAgICB9LAogICAgZ2V0V2FybmluZ0ljb246IGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGljb247CiAgICAgIHZhciBjb2xvciA9IG1lc3NhZ2UuY29sb3IgfHwgJyNjMmMyYzInOwogICAgICBpZiAobWVzc2FnZS50eXBlID09PSAnYXVkaW8nKSB7CiAgICAgICAgaWNvbiA9ICc8c3ZnIHdpZHRoPSIyMXB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyMSAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48cGF0aCBkPSJNMjEsMi43NjkyMzA3NyBMMjEsMTcuNjQ4NzI4OCBDMjEsMTcuNjQ4NzI4OCAyMSwxNy42NDg3Mjg4IDIxLDE3LjY0ODcyODggTDIxLDE4LjQ2MTUzODUgTDIwLjkwNjg3MjksMTguNDYxNTM4NSBDMjAuNzIzNTk1LDE5LjI3MTIyNDkgMjAuMjcxNjAxMywyMC4wODY1NzkxIDE5LjU2NjkyOTYsMjAuNzY4MDE5OCBDMTcuOTIwMzUzNywyMi4zNjAzMTMgMTUuNTE3Njg5NiwyMi42MTg0NzQ3IDE0LjIwMDQyODksMjEuMzQ0NjQwMiBDMTIuODgzMTY4MiwyMC4wNzA4MDU2IDEzLjE1MDEzMDksMTcuNzQ3MzUwMyAxNC43OTY3MDY4LDE2LjE1NTA1NzEgQzE2LjA2MDI1MTYsMTQuOTMzMTY3NiAxNy43NjkwMzI0LDE0LjQ5NjkwNTEgMTkuMDkwOTA5MSwxNC45MzU2ODE2IEwxOS4wOTA5MDkxLDE0LjkzNTY4MTYgTDE5LjA5MDkwOTEsNC4xNTM4NDYxNSBMNy42MzYzNjM2NCw2LjkyMzA3NjkyIEw3LjYzNjM2MzY0LDE5LjQ5NDg4MjYgQzcuNjM2MzYzNjQsMTkuNDk0ODgyNiA3LjYzNjM2MzY0LDE5LjQ5NDg4MjYgNy42MzYzNjM2NCwxOS40OTQ4ODI2IEw3LjYzNjM2MzY0LDIwLjMwNzY5MjMgTDcuNTQzMjM2NSwyMC4zMDc2OTIzIEM3LjM1OTk1ODU5LDIxLjExNzM3ODggNi45MDc5NjQ5MywyMS45MzI3MzI5IDYuMjAzMjkzMjMsMjIuNjE0MTczNyBDNC41NTY3MTczMiwyNC4yMDY0NjY5IDIuMTU0MDUzMjgsMjQuNDY0NjI4NiAwLjgzNjc5MjU1MiwyMy4xOTA3OTQgQy0wLjQ4MDQ2ODE3MywyMS45MTY5NTk1IC0wLjIxMzUwNTUwMSwxOS41OTM1MDQxIDEuNDMzMDcwNDEsMTguMDAxMjEwOSBDMi42OTY2MTUyMywxNi43NzkzMjE0IDQuNDA1Mzk2MDEsMTYuMzQzMDU5IDUuNzI3MjcyNzMsMTYuNzgxODM1NCBMNS43MjcyNzI3MywxNi43ODE4MzU0IEw1LjcyNzI3MjczLDYuNDYxNTM4NDYgTDUuNzI3MjcyNzMsMy42OTIzMDc2OSBMMjEsMCBMMjEsMi43NjkyMzA3NyBaIiBmaWxsPSInICsgY29sb3IgKyAnIj48L3BhdGg+PC9zdmc+JzsKICAgICAgfSBlbHNlCiAgICAgIGlmIChtZXNzYWdlLnR5cGUgPT09ICdwbGF5bGlzdCcpIHsKICAgICAgICBpY29uID0gJzxzdmcgd2lkdGg9IjI0cHgiIGhlaWdodD0iMThweCIgdmlld0JveD0iMCAwIDI0IDE4IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGQ9Ik0wLDAgTDAsMy42IEwzLjQyODU3MTQzLDMuNiBMMy40Mjg1NzE0MywwIEwwLDAgWiBNMCw3LjIgTDAsMTAuOCBMMy40Mjg1NzE0MywxMC44IEwzLjQyODU3MTQzLDcuMiBMMCw3LjIgWiBNNS4xNDI4NTcxNCwwIEw1LjE0Mjg1NzE0LDMuNiBMMjQsMy42IEwyNCwwIEw1LjE0Mjg1NzE0LDAgWiBNNS4xNDI4NTcxNCw3LjIgTDUuMTQyODU3MTQsMTAuOCBMMjAuNTcxNDI4NiwxMC44IEwyMC41NzE0Mjg2LDcuMiBMNS4xNDI4NTcxNCw3LjIgWiBNMCwxNC40IEwwLDE4IEwzLjQyODU3MTQzLDE4IEwzLjQyODU3MTQzLDE0LjQgTDAsMTQuNCBaIE01LjE0Mjg1NzE0LDE0LjQgTDUuMTQyODU3MTQsMTggTDIyLjI4NTcxNDMsMTggTDIyLjI4NTcxNDMsMTQuNCBMNS4xNDI4NTcxNCwxNC40IFoiIGZpbGw9IicgKyBjb2xvciArICciPjwvcGF0aD48L3N2Zz4nOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHBob3RvCiAgICAgICAgaWNvbiA9ICc8c3ZnIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjE4cHgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48cGF0aCBkPSJNMTkuNSwzIEwyMS4wMDg5MDk2LDMgQzIyLjY1ODIyOTQsMyAyNCw0LjM0Mjg4NzE4IDI0LDUuOTk5NDIyNDggTDI0LDE1LjAwMDU3NzUgQzI0LDE2LjY1NTY0OTMgMjIuNjYwODQzMiwxOCAyMS4wMDg5MDk2LDE4IEwyLjk5MTA5MDQyLDE4IEMxLjM0MTc3MDYzLDE4IDAsMTYuNjU3MTEyOCAwLDE1LjAwMDU3NzUgTDAsNS45OTk0MjI0OCBDMCw0LjM0NDM1MDczIDEuMzM5MTU2NzksMyAyLjk5MTA5MDQyLDMgTDcuNSwzIEM3LjUsMS4zNDY1MTcxMiA4Ljg0MTg3MDY3LDAgMTAuNDk3MTUyLDAgTDE2LjUwMjg0OCwwIEMxOC4xNTgzNzcyLDAgMTkuNSwxLjM0MzE0NTc1IDE5LjUsMyBMMTkuNSwzIFogTTEzLjUsMTYuNSBDMTYuODEzNzA4NywxNi41IDE5LjUsMTMuODEzNzA4NyAxOS41LDEwLjUgQzE5LjUsNy4xODYyOTEzNCAxNi44MTM3MDg3LDQuNSAxMy41LDQuNSBDMTAuMTg2MjkxMyw0LjUgNy41LDcuMTg2MjkxMzQgNy41LDEwLjUgQzcuNSwxMy44MTM3MDg3IDEwLjE4NjI5MTMsMTYuNSAxMy41LDE2LjUgWiBNMTMuNSwxNSBDMTUuOTg1MjgxNSwxNSAxOCwxMi45ODUyODE1IDE4LDEwLjUgQzE4LDguMDE0NzE4NSAxNS45ODUyODE1LDYgMTMuNSw2IEMxMS4wMTQ3MTg1LDYgOSw4LjAxNDcxODUgOSwxMC41IEM5LDEyLjk4NTI4MTUgMTEuMDE0NzE4NSwxNSAxMy41LDE1IFoiIGZpbGw9IicgKyBjb2xvciArICciPjwvcGF0aD48L3N2Zz4nOwogICAgICB9CiAgICAgIGNiKCdkYXRhOmltYWdlL3N2Zyt4bWw7dXRmOCwnICsgZW5jb2RlVVJJQ29tcG9uZW50KGljb24pKTsKICAgIH0sCiAgICBjaGVja1VybHNPZk9wZW5UYWJzOiBmdW5jdGlvbihyZWdFeHBMaXN0LCBjYWxsYmFjaykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBnZXRVcmxMaXN0ID0gbW9uby5pc0dNID8gZnVuY3Rpb24oY2IpIHsKICAgICAgICBjYihbbG9jYXRpb24uaHJlZl0pOwogICAgICB9IDogbW9uby5pc0Nocm9tZSA/IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgdmFyIHVybExpc3QgPSBbXTsKICAgICAgICBjaHJvbWUudGFicy5xdWVyeSh7fSwgZnVuY3Rpb24odGFicykgewogICAgICAgICAgdGFicy5mb3JFYWNoKGZ1bmN0aW9uKHRhYikgewogICAgICAgICAgICB1cmxMaXN0LnB1c2godGFiLnVybCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGNiKHVybExpc3QpOwogICAgICAgIH0pOwogICAgICB9IDogbW9uby5pc0ZGID8gZnVuY3Rpb24oY2IpIHsKICAgICAgICB2YXIgdXJsTGlzdCA9IFtdOwogICAgICAgIHZhciBmZlRhYnMgPSByZXF1aXJlKCJzZGsvdGFicyIpOwogICAgICAgIGZvciAodmFyIHRhYiBpbiBmZlRhYnMpIHsKICAgICAgICAgIHVybExpc3QucHVzaChmZlRhYnNbdGFiXS51cmwpOwogICAgICAgIH0KICAgICAgICBjYih1cmxMaXN0KTsKICAgICAgfSA6IG1vbm8uaXNPcGVyYSA/IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgdmFyIHVybExpc3QgPSBbXTsKICAgICAgICB2YXIgb1RhYnMgPSBvcGVyYS5leHRlbnNpb24udGFicy5nZXRBbGwoKTsKICAgICAgICBvVGFicy5mb3JFYWNoKGZ1bmN0aW9uKHRhYikgewogICAgICAgICAgdXJsTGlzdC5wdXNoKHRhYi51cmwpOwogICAgICAgIH0pOwogICAgICAgIGNiKHVybExpc3QpOwogICAgICB9IDogbW9uby5pc1NhZmFyaSA/IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgdmFyIHVybExpc3QgPSBbXTsKCiAgICAgICAgc2FmYXJpLmFwcGxpY2F0aW9uICYmCiAgICAgICAgICBzYWZhcmkuYXBwbGljYXRpb24uYWN0aXZlQnJvd3NlcldpbmRvdyAmJgogICAgICAgICAgc2FmYXJpLmFwcGxpY2F0aW9uLmFjdGl2ZUJyb3dzZXJXaW5kb3cudGFicyAmJgogICAgICAgICAgc2FmYXJpLmFwcGxpY2F0aW9uLmFjdGl2ZUJyb3dzZXJXaW5kb3cudGFicy5mb3JFYWNoKGZ1bmN0aW9uKHRhYikgewogICAgICAgICAgICBpZiAoIXRhYi51cmwpIHsKICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cmxMaXN0LnB1c2godGFiLnVybCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgY2IodXJsTGlzdCk7CiAgICAgIH0gOiBmdW5jdGlvbihjYikgewogICAgICAgIGNiKFtdKTsKICAgICAgfTsKCiAgICAgIGdldFVybExpc3QoZnVuY3Rpb24odXJsTGlzdCkgewogICAgICAgIHZhciBmb3VuZFVybExpc3QgPSBbXTsKICAgICAgICB1cmxMaXN0LmZvckVhY2goZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICByZWdFeHBMaXN0LmZvckVhY2goZnVuY3Rpb24ocmVnZXhwKSB7CiAgICAgICAgICAgIGlmICh1cmwuc2VhcmNoKHJlZ2V4cCkgIT09IC0xKSB7CiAgICAgICAgICAgICAgZm91bmRVcmxMaXN0LnB1c2godXJsKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgY2FsbGJhY2soZm91bmRVcmxMaXN0KTsKICAgICAgfSk7CiAgICB9LAogICAgZ2V0RGF0YTogZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgdXJsID0gbWVzc2FnZS51cmw7CiAgICAgIGlmICghdXJsKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KCiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiB1cmwKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgaWYgKGVycikgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQogICAgICAgIGNiKGRhdGEpOwogICAgICB9KTsKICAgIH0KICB9OwogIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgewogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24oX21vbm8sIF9lbmdpbmUpIHsKICAgICAgbW9ubyA9IF9tb25vOwogICAgICBlbmdpbmUgPSBfZW5naW5lOwogICAgICByZXR1cm4gYmdfdXRpbHM7CiAgICB9OwogIH0gZWxzZSB7CiAgICBlbmdpbmUudXRpbHMgPSBiZ191dGlsczsKICB9CiAgKGZ1bmN0aW9uKCkgewogICAgdmFyIGxhbmd1YWdlID0ge307CiAgICB2YXIgcHJlZmVyZW5jZSA9IHt9OwogICAgdmFyIHZhckNhY2hlID0gewogICAgICBpY29uczoge30sCiAgICAgIGFjdGl2ZVRhYkluZm86IHt9LAogICAgICBoZWxwZXJOYW1lOiAnJwogICAgfTsKICAgIHZhciBtZW51Q29udGFpbmVyID0gdW5kZWZpbmVkOwoKICAgIHZhciB0cmFuc2xhdGVQYWdlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBlbExpc3QgPSBtZW51Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJypbZGF0YS1pMThuXScpOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZWxMaXN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGVsID0gZWxMaXN0W2ldOwogICAgICAgIHZhciBrZXkgPSBlbC5kYXRhc2V0LmkxOG47CiAgICAgICAgZWwudGV4dENvbnRlbnQgPSBsYW5ndWFnZVtrZXldOwogICAgICAgIGlmIChlbC5jbGFzc0xpc3QuY29udGFpbnMoJ2xhYmVsJykpIHsKICAgICAgICAgIGVsLnRpdGxlID0gbGFuZ3VhZ2Vba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIG9uTW9kdWxlVG9nZ2xlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciB0YWJJbmZvID0gdmFyQ2FjaGUuYWN0aXZlVGFiSW5mbzsKCiAgICAgIHZhciBzdGF0ZSA9IHZhckNhY2hlLm1vZHVsZVRyaWdnZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNhYmxlZCcpID8gMSA6IDA7CiAgICAgIHRhYkluZm8uc3RhdGUgPSBzdGF0ZTsKCiAgICAgIHNldENoZWNrYm94U3RhdGUoc3RhdGUsIDEpOwoKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHRhYkluZm8ucHJlZktleSkpIHsKICAgICAgICB0YWJJbmZvLnByZWZLZXkgPSBbdGFiSW5mby5wcmVmS2V5XTsKICAgICAgfQoKICAgICAgZm9yICh2YXIgaSA9IDAsIGtleTsga2V5ID0gdGFiSW5mby5wcmVmS2V5W2ldOyBpKyspIHsKICAgICAgICBwcmVmZXJlbmNlW2tleV0gPSBzdGF0ZTsKICAgICAgfQoKICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgYWN0aW9uOiAndmlhTWVudV8nICsgJ2NoYW5nZVN0YXRlJywKICAgICAgICBzdGF0ZTogc3RhdGUgPyAxIDogMCwKICAgICAgICBwcmVmS2V5OiB0YWJJbmZvLnByZWZLZXksCiAgICAgICAgbW9kdWxlTmFtZTogdGFiSW5mby5tb2R1bGVOYW1lLAogICAgICAgIG5lZWRJbmNsdWRlOiB0YWJJbmZvLmlzTm90UmVzcG9uc2UKICAgICAgfSk7CgogICAgICB0YWJJbmZvLmlzTm90UmVzcG9uc2UgPSBmYWxzZTsKCiAgICAgIHVwZGF0ZU1lbnVJdGVtKHRhYkluZm8pOwogICAgfTsKCiAgICB2YXIgbWVudUl0ZW1BY3Rpb24gPSBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgdmFyIG5vZGUgPSB0aGlzOwoKICAgICAgaWYgKG5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdpbmFjdGl2ZScpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYWN0aW9uID0gbm9kZS5kYXRhc2V0LmFjdGlvbjsKCiAgICAgIHZhciBpc01vZHVsZSA9IG5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2R1bGUnKTsKCiAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICBpZiAoWyd1cGRhdGVMaW5rcycsICdkb3dubG9hZFBsYXlsaXN0JywgJ2Rvd25sb2FkUGhvdG9zJywgJ2Rvd25sb2FkTVAzRmlsZXMnXS5pbmRleE9mKGFjdGlvbikgIT09IC0xKSB7CiAgICAgICAgICBpZiAoWydkYWlseW1vdGlvbicsICdmYWNlYm9vaycsICdtYWlscnUnLCAnb2Rub2tsYXNzbmlraScsICdzYXZlZnJvbScsICdzb3VuZGNsb3VkJywgJ3ZpbWVvJywgJ3ZrJywKICAgICAgICAgICAgICAneW91dHViZScsCiAgICAgICAgICAgICAgJ2luc3RhZ3JhbScsICdydXR1YmUnCiAgICAgICAgICAgIF0uaW5kZXhPZih2YXJDYWNoZS5hY3RpdmVUYWJJbmZvLm1vZHVsZU5hbWUpICE9PSAtMSkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ2V4dGVuc2lvbk1lbnUnLAogICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgIGVsOiBhY3Rpb24KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ3NpdGVzTm90U3VwcG9yZGVkJywKICAgICAgICAgICAgICBlYTogYWN0aW9uLAogICAgICAgICAgICAgIGVsOiBtb25vLmdldERvbWFpbih2YXJDYWNoZS5hY3RpdmVUYWJJbmZvLnVybCwgMSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICBhY3Rpb246ICd0cmFjaycsCiAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICBlYzogJ2V4dGVuc2lvbk1lbnUnLAogICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgIGVsOiBhY3Rpb24KICAgICAgfSk7CgogICAgICBpZiAoYWN0aW9uID09PSAnZW5hYmxlTW9kdWxlJykgewogICAgICAgIHJldHVybiBvbk1vZHVsZVRvZ2dsZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAoaXNNb2R1bGUgPyAndmlhTWVudV8nIDogJycpICsgYWN0aW9uCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmIChtb25vLmlzR00pIHsKICAgICAgICBfbWVudS5oaWRlTWVudUl0ZW1zKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChtb25vLmlzRkYpIHsKICAgICAgICBtb25vLmFkZG9uLnBvc3RNZXNzYWdlKCdoaWRlUG9wdXAnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKG1vbm8uaXNTYWZhcmkpIHsKICAgICAgICBzYWZhcmkuZXh0ZW5zaW9uLnBvcG92ZXJzWzBdLmhpZGUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgd2luZG93LmNsb3NlKCk7CiAgICB9OwoKICAgIHZhciBzZXRJdGVtU3RhdGUgPSBmdW5jdGlvbihjbGFzc05hbWUsIHNob3cpIHsKICAgICAgdmFyIGxpID0gbWVudUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuJyArIGNsYXNzTmFtZSk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoc2hvdykgewogICAgICAgICAgbGlbaV0uY2xhc3NMaXN0LnJlbW92ZSgnaW5hY3RpdmUnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGlbaV0uY2xhc3NMaXN0LmFkZCgnaW5hY3RpdmUnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIHNldE1vZHVsZUl0ZW1TdGF0ZSA9IGZ1bmN0aW9uKG1vZHVsZU5hbWUsIHNob3cpIHsKICAgICAgaWYgKCFzaG93KSB7CiAgICAgICAgcmV0dXJuIHNldEl0ZW1TdGF0ZSgnbW9kdWxlJywgZmFsc2UpOwogICAgICB9CgogICAgICB2YXIgbGkgPSBtZW51Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi5tb2R1bGUnKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaS5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChsaVtpXS5jbGFzc0xpc3QuY29udGFpbnMobW9kdWxlTmFtZSkpIHsKICAgICAgICAgIGxpW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2luYWN0aXZlJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxpW2ldLmNsYXNzTGlzdC5hZGQoJ2luYWN0aXZlJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHZhciBzYWZhcmlCbGFua0xpbmsgPSBmdW5jdGlvbihlKSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgIG1vbm8ub3BlblRhYih0aGlzLmhyZWYsIHRydWUpOwogICAgfTsKCiAgICB2YXIgdXBkYXRlU2FmYXJpTGlua3MgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGxpbmtzID0gbWVudUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdhW2hyZWZdW3RhcmdldD0iX2JsYW5rIl0nKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxpbmtzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgbGlua3NbaV0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzYWZhcmlCbGFua0xpbmspOwogICAgICAgIGxpbmtzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2FmYXJpQmxhbmtMaW5rKTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgYmluZFNvY2lhbEJ0biA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0VXJsID0gJ2h0dHA6Ly9zYXZlZnJvbS5uZXQvdXNlci5waHAnOwogICAgICB2YXIgdXJsID0gZW5jb2RlVVJJQ29tcG9uZW50KHRhcmdldFVybCk7CiAgICAgIHZhciBpbWFnZSA9IGVuY29kZVVSSUNvbXBvbmVudCgnaHR0cDovL3NhdmVmcm9tLm5ldC9pbWcvaWNvbl8xMDAucG5nJyk7CiAgICAgIHZhciB0aXRsZSA9IGVuY29kZVVSSUNvbXBvbmVudChsYW5ndWFnZS5leHROYW1lKTsKICAgICAgdmFyIGRlc2MgPSBlbmNvZGVVUklDb21wb25lbnQobGFuZ3VhZ2Uuc29jaWFsRGVzYyk7CiAgICAgIHZhciBidG5MaXN0ID0gewogICAgICAgIHZrOiB7CiAgICAgICAgICBuZXR3b3JrOiAndmtvbnRha3RlJywKICAgICAgICAgIHRpdGxlOiBsYW5ndWFnZS5zaGFyZUluLnJlcGxhY2UoJyV3JywgJ1ZLJyksCiAgICAgICAgICBocmVmOiAnaHR0cDovL3ZrLmNvbS9zaGFyZS5waHA/dXJsPScgKyB1cmwgKyAnJmltYWdlPScgKyBpbWFnZSArICcmdGl0bGU9JyArIHRpdGxlICsgJyZkZXNjcmlwdGlvbj0nICsgZGVzYwogICAgICAgIH0sCiAgICAgICAgb2s6IHsKICAgICAgICAgIG5ldHdvcms6ICdvZG5va2xhc3NuaWtpJywKICAgICAgICAgIHRpdGxlOiBsYW5ndWFnZS5zaGFyZUluLnJlcGxhY2UoJyV3JywgJ09LLnJ1JyksCiAgICAgICAgICBocmVmOiAnaHR0cDovL3d3dy5vZG5va2xhc3NuaWtpLnJ1L2RrP3N0LmNtZD1hZGRTaGFyZSZzdC5zPTEmc3QuX3N1cmw9JyArIHVybCArICcmc3QuY29tbWVudHM9JyArIGRlc2MKICAgICAgICB9LAogICAgICAgIG1haWxydTogewogICAgICAgICAgbmV0d29yazogJ21haWwucnUnLAogICAgICAgICAgdGl0bGU6IGxhbmd1YWdlLnNoYXJlSW4ucmVwbGFjZSgnJXcnLCAnTWFpbC5ydScpLAogICAgICAgICAgaHJlZjogJ2h0dHA6Ly9jb25uZWN0Lm1haWwucnUvc2hhcmU/dXJsPScgKyB1cmwgKyAnJnRpdGxlPScgKyB0aXRsZSArICcmZGVzY3JpcHRpb249JyArIGRlc2MgKyAnJmltYWdldXJsPScgKyBpbWFnZQogICAgICAgIH0sCiAgICAgICAgdHc6IHsKICAgICAgICAgIG5ldHdvcms6ICd0d2l0dGVyJywKICAgICAgICAgIHRpdGxlOiBsYW5ndWFnZS5zaGFyZUluLnJlcGxhY2UoJyV3JywgJ1R3aXR0ZXInKSwKICAgICAgICAgIGhyZWY6ICdodHRwczovL3R3aXR0ZXIuY29tL2ludGVudC90d2VldD90ZXh0PScgKyB0aXRsZSArICcmdXJsPScgKyB1cmwKICAgICAgICB9LAogICAgICAgIGZiOiB7CiAgICAgICAgICBuZXR3b3JrOiAnZmFjZWJvb2snLAogICAgICAgICAgdGl0bGU6IGxhbmd1YWdlLnNoYXJlSW4ucmVwbGFjZSgnJXcnLCAnRmFjZWJvb2snKSwKICAgICAgICAgIGhyZWY6ICdodHRwOi8vd3d3LmZhY2Vib29rLmNvbS9zaGFyZXIucGhwP3M9MTAwJnBbdXJsXT0nICsgdXJsICsgJyZwW3RpdGxlXT0nICsgdGl0bGUgKyAnJnBbc3VtbWFyeV09JyArIGRlc2MgKyAnJnBbaW1hZ2VzXVswXT0nICsgaW1hZ2UKICAgICAgICB9LAogICAgICAgIGdwOiB7CiAgICAgICAgICBuZXR3b3JrOiAnZ29vZ2xlKycsCiAgICAgICAgICB0aXRsZTogbGFuZ3VhZ2Uuc2hhcmVJbi5yZXBsYWNlKCcldycsICdHb29nbGUrJyksCiAgICAgICAgICBocmVmOiAnaHR0cHM6Ly9wbHVzLmdvb2dsZS5jb20vc2hhcmU/dXJsPScgKyB1cmwKICAgICAgICB9LAogICAgICAgIGxqOiB7CiAgICAgICAgICBuZXR3b3JrOiAnbGl2ZWpvdXJuYWwnLAogICAgICAgICAgdGl0bGU6IGxhbmd1YWdlLnNoYXJlSW4ucmVwbGFjZSgnJXcnLCAnTGl2ZWpvdXJuYWwnKSwKICAgICAgICAgIGhyZWY6ICdodHRwOi8vd3d3LmxpdmVqb3VybmFsLmNvbS91cGRhdGUuYm1sP3N1YmplY3Q9JyArIHRpdGxlICsgJyZldmVudD0nICsgZGVzYyArICcgJyArIHVybAogICAgICAgIH0KICAgICAgfTsKICAgICAgZm9yICh2YXIgaXRlbSBpbiBidG5MaXN0KSB7CiAgICAgICAgdmFyIGxpbmsgPSBtZW51Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5zb2NpYWwtYnRuLicgKyBpdGVtKTsKICAgICAgICBpZiAoIWxpbmspIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsaW5rLnRpdGxlID0gYnRuTGlzdFtpdGVtXS50aXRsZTsKICAgICAgICBsaW5rLmhyZWYgPSBidG5MaXN0W2l0ZW1dLmhyZWY7CiAgICAgICAgbGluay5kYXRhc2V0Lm5ldHdvcmsgPSBidG5MaXN0W2l0ZW1dLm5ldHdvcms7CiAgICAgIH0KICAgICAgbGluay5wYXJlbnROb2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBidG4gPSBlLnRhcmdldDsKICAgICAgICBpZiAoIWJ0bi5jbGFzc0xpc3QuY29udGFpbnMoJ3NvY2lhbC1idG4nKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgbmV0d29yayA9IGJ0bi5kYXRhc2V0Lm5ldHdvcms7CiAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICBhY3Rpb246ICd0cmFjaycsCiAgICAgICAgICB0OiAnc29jaWFsJywKICAgICAgICAgIHN0OiB0YXJnZXRVcmwsCiAgICAgICAgICBzYTogJ3NoYXJlJywKICAgICAgICAgIHNuOiBuZXR3b3JrCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgc2V0TW9kdWxlQnRuU3RhdGUgPSBmdW5jdGlvbih0YWJJbmZvKSB7CiAgICAgIGlmIChbJ29kbm9rbGFzc25pa2knXS5pbmRleE9mKHRhYkluZm8ubW9kdWxlTmFtZSkgIT09IC0xKSB7CiAgICAgICAgc2V0SXRlbVN0YXRlKCdib29rbWFya2xldCcsIGZhbHNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXRJdGVtU3RhdGUoJ2Jvb2ttYXJrbGV0JywgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIHNldE1vZHVsZUl0ZW1TdGF0ZSh0YWJJbmZvLm1vZHVsZU5hbWUsIHRhYkluZm8uc3RhdGUpOwoKICAgICAgaWYgKHRhYkluZm8uc3RhdGUgJiYgdGFiSW5mby5tb2R1bGVOYW1lID09PSAneW91dHViZScpIHsKICAgICAgICB2YXIgdXJsID0gdGFiSW5mby51cmw7CgogICAgICAgIHZhciBpc1BsYXlsaXN0ID0gL1wvcGxheWxpc3RcP3xbPyZdbGlzdD0vLnRlc3QodXJsKTsKICAgICAgICBpZiAoIWlzUGxheWxpc3QpIHsKICAgICAgICAgIGlzUGxheWxpc3QgPSAvKHVzZXJ8Y2hhbm5lbHxzaG93KVwvW15cL10rKFwvZmVlZHxcL2ZlYXR1cmVkfFwvdmlkZW9zfCQpL2kudGVzdCh1cmwpOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzUGxheWxpc3QpIHsKICAgICAgICAgIGlzUGxheWxpc3QgPSAvXC8oZmVlZClcLyh0cmVuZGluZ3xzdWJzY3JpcHRpb25zfGhpc3RvcnkpL2kudGVzdCh1cmwpOwogICAgICAgIH0KCiAgICAgICAgc2V0SXRlbVN0YXRlKCdwbFlvdXR1YmUnLCAhIWlzUGxheWxpc3QpOwogICAgICB9CiAgICB9OwoKICAgIHZhciBzZXRDaGVja0JveE1vZHVsZVN0YXRlID0gZnVuY3Rpb24odGFiSW5mbykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBjaGVja0JveElzRW5hYmxlID0gZmFsc2U7CiAgICAgIHZhciBjaGVja0JveFN0YXRlID0gZmFsc2U7CiAgICAgIGlmIChbJ3NhdmVmcm9tJ10uaW5kZXhPZih0YWJJbmZvLm1vZHVsZU5hbWUpICE9PSAtMSkgewogICAgICAgIGNoZWNrQm94U3RhdGUgPSAnZm9yY2UnOwogICAgICB9IGVsc2UKICAgICAgaWYgKHRhYkluZm8ubW9kdWxlTmFtZSkgewogICAgICAgIGNoZWNrQm94U3RhdGUgPSAhIXRhYkluZm8uc3RhdGU7CiAgICAgICAgY2hlY2tCb3hJc0VuYWJsZSA9IHRydWU7CiAgICAgIH0KICAgICAgc2V0SXRlbVN0YXRlKCdlbmFibGVNb2R1bGUnLCBjaGVja0JveElzRW5hYmxlKTsKICAgICAgc2V0Q2hlY2tib3hTdGF0ZShjaGVja0JveFN0YXRlKTsKICAgIH07CgogICAgdmFyIG9uR2V0VGFiSW5mbyA9IGZ1bmN0aW9uKHRhYkluZm8sIGZvcmNlKSB7CiAgICAgIHZhckNhY2hlLmFjdGl2ZVRhYkluZm8gPSB0YWJJbmZvID0gdGFiSW5mbyB8fCB7fTsKCiAgICAgIHNldENoZWNrQm94TW9kdWxlU3RhdGUodGFiSW5mbyk7CiAgICAgIHNldE1vZHVsZUJ0blN0YXRlKHRhYkluZm8pOwoKICAgICAgaWYgKCFmb3JjZSkgewogICAgICAgIHZhciBvblJlc3BvbnNlID0gZnVuY3Rpb24obW9kdWxlSW5mbykgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgdGFiSW5mby5pc05vdFJlc3BvbnNlID0gIW1vZHVsZUluZm87CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIG1vZHVsZUluZm8pIHsKICAgICAgICAgICAgdGFiSW5mb1trZXldID0gbW9kdWxlSW5mb1trZXldOwogICAgICAgICAgfQoKICAgICAgICAgIHNldENoZWNrQm94TW9kdWxlU3RhdGUodGFiSW5mbyk7CiAgICAgICAgICBzZXRNb2R1bGVCdG5TdGF0ZSh0YWJJbmZvKTsKICAgICAgICB9OwogICAgICAgIHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChvblJlc3BvbnNlLCAyNTApOwogICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAnZ2V0QWN0aXZlVGFiTW9kdWxlSW5mbycsCiAgICAgICAgICB1cmw6IHRhYkluZm8udXJsCiAgICAgICAgfSwgb25SZXNwb25zZSk7CiAgICAgIH0KICAgIH07CgogICAgdmFyIHVwZGF0ZU1lbnVJdGVtID0gZnVuY3Rpb24odGFiSW5mbykgewogICAgICB2YXJDYWNoZS5hY3RpdmVUYWJJbmZvID0ge307CgogICAgICBpZiAodGFiSW5mbykgewogICAgICAgIG9uR2V0VGFiSW5mbyh0YWJJbmZvLCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtb25vLnNlbmRNZXNzYWdlKCdnZXRBY3RpdmVUYWJJbmZvJywgb25HZXRUYWJJbmZvKTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgc2V0SWNvblN0YXRlID0gZnVuY3Rpb24oZWwsIHN0YXRlKSB7CiAgICAgIHZhciBwYXRoID0gZWwucXVlcnlTZWxlY3RvcigncGF0aCcpOwogICAgICBpZiAoc3RhdGUgPT09ICdob3ZlcicpIHsKICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZmlsbCcsICcjZmZmZmZmJyk7CiAgICAgIH0gZWxzZQogICAgICBpZiAoc3RhdGUgPT09ICdhY3RpdmUnKSB7CiAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnI0FBQUFBQScpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciB0eXBlID0gZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXR5cGUnKTsKICAgICAgICBpZiAodHlwZSA9PT0gJ2Rvd25sb2FkTVAzRmlsZXMnKSB7CiAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZmlsbCcsICcjMDBDQ0ZGJyk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHR5cGUgPT09ICdkb3dubG9hZFBsYXlsaXN0JykgewogICAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnIzc3RDFGQScpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh0eXBlID09PSAnZG93bmxvYWRQaG90b3MnKSB7CiAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZmlsbCcsICcjODhjYjY2Jyk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHR5cGUgPT09ICdzaG93QWJvdXRQYWdlJykgewogICAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnI0FERTYxQicpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh0eXBlID09PSAndXBkYXRlTGlua3MnKSB7CiAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZmlsbCcsICcjQ0I3RkJEJyk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHR5cGUgPT09ICdkb3dubG9hZEZyb21DdXJyZW50UGFnZScpIHsKICAgICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdmaWxsJywgJyNDQjdGQkQnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIGdldEFib3V0UGFnZSA9IGZ1bmN0aW9uKCkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHJldHVybiBtb25vLmNyZWF0ZShkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksIHsKICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICB0ZXh0OiBsYW5ndWFnZS5hYm91dERlc2NyaXB0aW9uCiAgICAgICAgICB9KSwKICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICBocmVmOiAnaHR0cDovL3NhdmVmcm9tLm5ldC9mYXEucGhwI3N1cHBvcnRlZF9yZXNvdXJzZXMnLAogICAgICAgICAgICB0YXJnZXQ6ICdfYmxhbmsnLAogICAgICAgICAgICB0ZXh0OiBsYW5ndWFnZS5hYm91dFN1cHBvcnRlZCwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICAgIGhyZWY6ICdodHRwOi8vc2F2ZWZyb20ubmV0L3VzZXIucGhwP2hlbHBlcj0nICsgdmFyQ2FjaGUuaGVscGVyTmFtZSwKICAgICAgICAgICAgdGFyZ2V0OiAnX2JsYW5rJywKICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UuaG9tZVBhZ2UsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIF0KICAgICAgfSk7CiAgICB9OwoKICAgIHZhciB1cGRhdGVEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uKGFjdGlvbiwgbGFiZWwpIHsKICAgICAgdmFyIGRlc2MgPSB2YXJDYWNoZS5kZXNjOwogICAgICB2YXIgdGV4dCA9IHZhckNhY2hlLmRlc2tUZXh0OwogICAgICB2YXIgdGl0bGUgPSB2YXJDYWNoZS5kZXNjVGl0ZWw7CiAgICAgIHZhciBtb3JlID0gdmFyQ2FjaGUuZGVzY01vcmU7CiAgICAgIGRlc2MuZGF0YXNldC5wYWdlID0gYWN0aW9uOwoKICAgICAgdmFyIGljb24gPSB2YXJDYWNoZS5pY29uc1thY3Rpb25dOwogICAgICB2YXIgc3ViSWNvbiA9IGRlc2MucXVlcnlTZWxlY3RvcignLmljb24nKTsKICAgICAgaWYgKGljb24pIHsKICAgICAgICB2YXIgX2ljb24gPSBpY29uLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICBzZXRJY29uU3RhdGUoX2ljb24sICdhY3RpdmUnKTsKICAgICAgICBpZiAoc3ViSWNvbikgewogICAgICAgICAgc3ViSWNvbi5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChfaWNvbiwgc3ViSWNvbik7CiAgICAgICAgfQogICAgICAgIHN1Ykljb24uc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdWJJY29uLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKICAgICAgfQoKICAgICAgaWYgKGFjdGlvbiA9PT0gJ3Nob3dBYm91dFBhZ2UnKSB7CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSBsYW5ndWFnZS5hYm91dFRpdGxlOwogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSAnJzsKICAgICAgICB0ZXh0LmFwcGVuZENoaWxkKGdldEFib3V0UGFnZSgpKTsKICAgICAgICBtb3JlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSBsYWJlbDsKICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gbGFuZ3VhZ2VbJ21lbnUnICsgbW9uby5jYXBpdGFsaXplKGFjdGlvbildIHx8ICcnOwogICAgICAgIG1vcmUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgIH0KCiAgICAgIGlmIChtb25vLmlzU2FmYXJpKSB7CiAgICAgICAgdXBkYXRlU2FmYXJpTGlua3MoKTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgb25SZWFkeSA9IGZ1bmN0aW9uKCkgewogICAgICB0cmFuc2xhdGVQYWdlKCk7CgogICAgICB2YXJDYWNoZS5kZXNjTW9yZS5ocmVmID0gJ2h0dHA6Ly9zYXZlZnJvbS5uZXQvdXNlci5waHA/aGVscGVyPScgKyB2YXJDYWNoZS5oZWxwZXJOYW1lOwoKICAgICAgdmFyIGJ0bkxpc3QgPSBtZW51Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2RpdltkYXRhLWFjdGlvbl0nKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBidG5MaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGljb24gPSBidG5MaXN0W2ldLnF1ZXJ5U2VsZWN0b3IoJ3N2ZycpOwogICAgICAgIGlmIChpY29uKSB7CiAgICAgICAgICB2YXJDYWNoZS5pY29uc1tidG5MaXN0W2ldLmRhdGFzZXQuYWN0aW9uXSA9IGljb247CiAgICAgICAgICBzZXRJY29uU3RhdGUoaWNvbik7CiAgICAgICAgfQoKICAgICAgICBpZiAoYnRuTGlzdFtpXS5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgbW9uby5jcmVhdGUoYnRuTGlzdFtpXSwgewogICAgICAgICAgb246IFsKICAgICAgICAgICAgWydjbGljaycsIG1lbnVJdGVtQWN0aW9uXSwKICAgICAgICAgICAgWydtb3VzZWVudGVyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB0aGlzLmRhdGFzZXQuYWN0aW9uOwoKICAgICAgICAgICAgICB2YXIgaWNvbiA9IHZhckNhY2hlLmljb25zW2FjdGlvbl07CiAgICAgICAgICAgICAgaWNvbiAmJiBzZXRJY29uU3RhdGUoaWNvbiwgJ2hvdmVyJyk7CgogICAgICAgICAgICAgIHZhciBzcGFuID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdzcGFuJyk7CiAgICAgICAgICAgICAgdmFyIHRpdGxlID0gc3BhbiAmJiBzcGFuLnRleHRDb250ZW50IHx8ICcnOwoKICAgICAgICAgICAgICB1cGRhdGVEZXNjcmlwdGlvbihhY3Rpb24sIHRpdGxlKTsKICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIFsnbW91c2VsZWF2ZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gdGhpcy5kYXRhc2V0LmFjdGlvbjsKCiAgICAgICAgICAgICAgdmFyIGljb24gPSB2YXJDYWNoZS5pY29uc1thY3Rpb25dOwogICAgICAgICAgICAgIGljb24gJiYgc2V0SWNvblN0YXRlKGljb24pOwogICAgICAgICAgICB9XQogICAgICAgICAgXQogICAgICAgIH0pOwogICAgICB9CgogICAgICBiaW5kU29jaWFsQnRuKCk7CgogICAgICBpZiAobW9uby5pc1NhZmFyaSkgewogICAgICAgIHVwZGF0ZVNhZmFyaUxpbmtzKCk7CiAgICAgIH0KCiAgICAgIHVwZGF0ZURlc2NyaXB0aW9uKCdzaG93QWJvdXRQYWdlJyk7CgogICAgICB1cGRhdGVNZW51SXRlbSgpOwoKICAgICAgbWVudUNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkaW5nJyk7CiAgICB9OwoKICAgIHZhciBzZXRDaGVja2JveFN0YXRlID0gZnVuY3Rpb24oc3RhdGUsIGJ5VXNlcikgewogICAgICBpZiAoYnlVc2VyKSB7CiAgICAgICAgdmFyQ2FjaGUubW9kdWxlVHJpZ2dlci5jbGFzc0xpc3QuYWRkKCdzZi10cmFuc2l0aW9uJyk7CiAgICAgIH0KICAgICAgaWYgKHN0YXRlID09PSAnZm9yY2UnKSB7CiAgICAgICAgdmFyQ2FjaGUubW9kdWxlVHJpZ2dlci5jbGFzc0xpc3QuYWRkKCdlbmFibGVGb3JjZScpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhckNhY2hlLm1vZHVsZVRyaWdnZXIuY2xhc3NMaXN0LnJlbW92ZSgnZW5hYmxlRm9yY2UnKTsKICAgICAgfQogICAgICBpZiAoc3RhdGUpIHsKICAgICAgICB2YXJDYWNoZS5tb2R1bGVUcmlnZ2VyLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGVkJyk7CiAgICAgICAgdmFyQ2FjaGUubW9kdWxlVHJpZ2dlci5uZXh0RWxlbWVudFNpYmxpbmcudGV4dENvbnRlbnQgPSBsYW5ndWFnZS5kaXNhYmxlTW9kdWxlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhckNhY2hlLm1vZHVsZVRyaWdnZXIuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZWQnKTsKICAgICAgICB2YXJDYWNoZS5tb2R1bGVUcmlnZ2VyLm5leHRFbGVtZW50U2libGluZy50ZXh0Q29udGVudCA9IGxhbmd1YWdlLmVuYWJsZU1vZHVsZTsKICAgICAgfQogICAgICBpZiAodmFyQ2FjaGUuZGVzYy5kYXRhc2V0LnBhZ2UgIT09ICdzaG93QWJvdXRQYWdlJykgewogICAgICAgIHVwZGF0ZURlc2NyaXB0aW9uKCdlbmFibGVNb2R1bGUnLCBzdGF0ZSA/IGxhbmd1YWdlLmRpc2FibGVNb2R1bGUgOiBsYW5ndWFnZS5lbmFibGVNb2R1bGUpOwogICAgICB9CiAgICB9OwoKICAgIHZhciB0dXRvcmlhbCA9IHsKICAgICAgdHV0b3JpYWxTbGlkZXM6IG51bGwsCiAgICAgIHNob3c6IGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBpZiAoIXByZWZlcmVuY2Uuc2hvd1R1dG9yaWFsKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIXR1dG9yaWFsLnR1dG9yaWFsU2xpZGVzKSB7CiAgICAgICAgICByZXR1cm4gbW9uby5zdG9yYWdlLnNldCh7CiAgICAgICAgICAgIG9uY2VZdFR1dG9yaWFsOiAxCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIG1vbm8uc3RvcmFnZS5nZXQoJ29uY2VZdFR1dG9yaWFsJywgZnVuY3Rpb24oc3RvcmFnZSkgewogICAgICAgICAgaWYgKHN0b3JhZ2Uub25jZVl0VHV0b3JpYWwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgc3RvcmFnZS5vbmNlWXRUdXRvcmlhbCA9IDE7CgogICAgICAgICAgdHV0b3JpYWwudHV0b3JpYWxTbGlkZXMuc2hvdyh7CiAgICAgICAgICAgIGNvbnRhaW5lcjogbWVudUNvbnRhaW5lciwKICAgICAgICAgICAgd2lkdGg6IDQ4MiwKICAgICAgICAgICAgaGVpZ2h0OiA0MDQgKyAobW9uby5pc0dNID8gMiA6IDApLAogICAgICAgICAgICBwYWRkaW5nOiA0LAogICAgICAgICAgICBzbGlkZUxpc3Q6IHR1dG9yaWFsLnR1dG9yaWFsU2xpZGVzLmdldFl0U2xpZGVMaXN0KCdibGFjaycpLAogICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBtb25vLnN0b3JhZ2Uuc2V0KHN0b3JhZ2UpOwoKICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ3NldEljb25CYWRnZScsCiAgICAgICAgICAgICAgICB0ZXh0OiAnJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjaGVja0V4aXN0czogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgICBtb25vLnN0b3JhZ2UuZ2V0KCdvbmNlWXRUdXRvcmlhbCcsIGZ1bmN0aW9uKHN0b3JhZ2UpIHsKICAgICAgICAgICAgICAgIGlmIChzdG9yYWdlLm9uY2VZdFR1dG9yaWFsKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBjYigxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNiKCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRyYWNrSWQ6ICdNZW51JywKICAgICAgICAgICAgYm94U3R5bGU6IHsKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29udGFpbmVyU3R5bGU6IHsKICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICczcHgnLAogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMCwgMTA0LCAyNTUsIDAuOSknLAogICAgICAgICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgICAgICAgbWFyZ2luOiAnNHB4JywKICAgICAgICAgICAgICBib3hTaGFkb3c6ICdub25lJwogICAgICAgICAgICB9LAogICAgICAgICAgICBzbGlkZVN0eWxlOiB7CiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLAogICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBsZWZ0QnRuU3R5bGU6IHsKICAgICAgICAgICAgICB0b3A6ICc0cHgnLAogICAgICAgICAgICAgIGxlZnQ6ICc0cHgnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJpZ2h0QnRuU3R5bGU6IHsKICAgICAgICAgICAgICB0b3A6ICc0cHgnLAogICAgICAgICAgICAgIHJpZ2h0OiAnNHB4JwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZUJ0blN0eWxlOiB7CiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZicsCiAgICAgICAgICAgICAgY29sb3I6ICdyZ2JhKDAsIDEwNCwgMjU1LCAwLjkpJwogICAgICAgICAgICB9LAogICAgICAgICAgICBjc3NTdHlsZTogewogICAgICAgICAgICAgICcgLnNmLWRvdHMnOiB7CiAgICAgICAgICAgICAgICBwYWRkaW5nVG9wOiAnMnB4JwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgJyAuc2YtZG90IGknOiB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgJyAuc2YtZG90LmFjdGl2ZSBpJzogewogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLAogICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnNnB4JywKICAgICAgICAgICAgICAgIG1hcmdpbjogJy0xcHgnLAogICAgICAgICAgICAgICAgd2lkdGg6ICc2cHgnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAnNnB4JywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzJweCBzb2xpZCAjZmZmJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgJyAuc2Ytc2xpZGVyLWNvbnRlaW5lciBzcGFuJzogewogICAgICAgICAgICAgICAgY29sb3I6ICcjZmZmICFpbXBvcnRhbnQnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAnIC5zZi1zbGlkZXItY29udGVpbmVyIGEnOiB7CiAgICAgICAgICAgICAgICBjb2xvcjogJyNmZmYgIWltcG9ydGFudCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFycm93Q29sb3I6ICcjZmZmJywKICAgICAgICAgICAgYXJyb3dDb2xvckFjdGl2ZTogJyNmZmYnLAogICAgICAgICAgICBvblJlc2l6ZTogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAgICAgICAgIGRldGFpbHMuYm94LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgd2l0aE9wYWNpdHk6IHRydWUsCiAgICAgICAgICAgIHdpdGhEZWxheTogMjUwLAogICAgICAgICAgICBvblNob3c6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIG1vbm8uaXNTYWZhcmkgJiYgdXBkYXRlU2FmYXJpTGlua3MoKTsKCiAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246ICdzZXRJY29uQmFkZ2UnLAogICAgICAgICAgICAgICAgdGV4dDogJz8nCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIHZhciBzZXRWZXJzaW9uID0gZnVuY3Rpb24odmVyc2lvbiwgbGFzdFZlcnNpb24pIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgdmVyc2lvbk5vZGUgPSB2YXJDYWNoZS5kZXNjLnF1ZXJ5U2VsZWN0b3IoJy52ZXJzaW9uJyk7CgogICAgICB2ZXJzaW9uTm9kZS50ZXh0Q29udGVudCA9ICcnOwoKICAgICAgdmVyc2lvbk5vZGUuYXBwZW5kQ2hpbGQobW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgdGV4dDogbGFuZ3VhZ2UuYWJvdXRWZXJzaW9uICsgJyAnICsgdmVyc2lvbgogICAgICB9KSk7CgogICAgICBpZiAobGFzdFZlcnNpb24gJiYgbGFzdFZlcnNpb24gIT09IHZlcnNpb24pIHsKICAgICAgICB2ZXJzaW9uTm9kZS5hcHBlbmRDaGlsZChtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgIHRleHQ6IGxhbmd1YWdlLnVwZGF0ZVRvLnJlcGxhY2UoJyVkJywgbGFzdFZlcnNpb24pLAogICAgICAgICAgaHJlZjogJ2h0dHA6Ly9zYXZlZnJvbS5uZXQvdXNlci5waHA/aGVscGVyPScgKyB2YXJDYWNoZS5oZWxwZXJOYW1lICsgJyZ1cGRhdGU9JyArIHZlcnNpb24sCiAgICAgICAgICB0YXJnZXQ6ICdfYmxhbmsnCiAgICAgICAgfSkpOwogICAgICB9CiAgICB9OwoKICAgIHZhciBydW4gPSBmdW5jdGlvbihwYXJlbnQpIHsKICAgICAgbWVudUNvbnRhaW5lciA9IChwYXJlbnQgfHwgZG9jdW1lbnQpLnF1ZXJ5U2VsZWN0b3IoJy5zZi1tZW51LWNvbnRhaW5lcicpOwogICAgICBpZiAoIW1lbnVDb250YWluZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgbWVudUNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkaW5nJyk7CiAgICAgIH0sIDEwMDApOwoKICAgICAgdmFyQ2FjaGUubGlzdCA9IG1lbnVDb250YWluZXIucXVlcnlTZWxlY3RvcignLnNmLW1lbnUtbGlzdCcpOwogICAgICB2YXJDYWNoZS5kZXNjID0gbWVudUNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuc2YtbWVudS1kZXNjJyk7CiAgICAgIHZhckNhY2hlLm1vZHVsZVRyaWdnZXIgPSBtZW51Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5zZi1jaGVja2JveCcpOwogICAgICB2YXJDYWNoZS5kZXNjVGl0ZWwgPSB2YXJDYWNoZS5kZXNjLnF1ZXJ5U2VsZWN0b3IoJy50aXRsZScpOwogICAgICB2YXJDYWNoZS5kZXNrVGV4dCA9IHZhckNhY2hlLmRlc2MucXVlcnlTZWxlY3RvcignLmRlc2MnKTsKICAgICAgdmFyQ2FjaGUuZGVzY01vcmUgPSB2YXJDYWNoZS5kZXNjLnF1ZXJ5U2VsZWN0b3IoJy5tb3JlJyk7CgogICAgICB2YXJDYWNoZS5saXN0LnN0eWxlLmhlaWdodCA9IHZhckNhY2hlLmxpc3Qub2Zmc2V0SGVpZ2h0ICsgJ3B4JzsKCiAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgIGFjdGlvbjogJ2dldE1lbnVEZXRhaWxzJwogICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgIGxhbmd1YWdlID0gcmVzcG9uc2UubGFuZ3VhZ2U7CiAgICAgICAgcHJlZmVyZW5jZSA9IHJlc3BvbnNlLnByZWZlcmVuY2VzOwoKICAgICAgICBtb25vLmdsb2JhbC5sYW5ndWFnZSA9IGxhbmd1YWdlOwogICAgICAgIG1vbm8uZ2xvYmFsLnByZWZlcmVuY2UgPSBwcmVmZXJlbmNlOwoKICAgICAgICB2YXJDYWNoZS5oZWxwZXJOYW1lID0gcmVzcG9uc2UuaGVscGVyTmFtZTsKCiAgICAgICAgc2V0VmVyc2lvbihyZXNwb25zZS52ZXJzaW9uLCByZXNwb25zZS5sYXN0VmVyc2lvbik7CgogICAgICAgIGlmIChbJ2VuJywgJ3VrJywgJ3J1J10uaW5kZXhPZihsYW5ndWFnZS5sYW5nKSA9PT0gLTEpIHsKICAgICAgICAgIG1lbnVDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnbm8tcG9sbCcpOwogICAgICAgIH0KCiAgICAgICAgdHV0b3JpYWwuc2hvdygpOwoKICAgICAgICBvblJlYWR5KCk7CiAgICAgIH0pOwogICAgfTsKCiAgICBtb25vLm9uUmVhZHkoZnVuY3Rpb24oKSB7CiAgICAgIGlmIChtb25vLmlzR00pIHsKICAgICAgICBfbWVudS5pbml0TWVudSA9IHJ1bjsKICAgICAgfSBlbHNlIHsKICAgICAgICBydW4oKTsKICAgICAgfQogICAgfSk7CgogICAgLy9AaW5zZXJ0CiAgfSkoKTsKICB2YXIgZGFpbHltb3Rpb25fY29tX2VtYmVkID0gewogICAgZ2V0RGFpbHltb3Rpb25MaW5rczogZnVuY3Rpb24ocmVxdWVzdCwgY2FsbGJhY2spIHsKICAgICAgdmFyIF90aGlzID0gZGFpbHltb3Rpb25fY29tX2VtYmVkOwoKICAgICAgZnVuY3Rpb24gY2FsbGJhY2tfbGlua3MoZGF0YSkgewogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgZGF0YSA9IHt9OwogICAgICAgIH0KCiAgICAgICAgX3RoaXMuYWRkVW1teUxpbmtzKGRhdGEubGlua3MsIHJlcXVlc3QuZXh0VmlkZW9JZCk7CgogICAgICAgIHZhciByZXNwb25zZSA9IHsKICAgICAgICAgIGFjdGlvbjogcmVxdWVzdC5hY3Rpb24sCiAgICAgICAgICBleHRWaWRlb0lkOiByZXF1ZXN0LmV4dFZpZGVvSWQsCiAgICAgICAgICBsaW5rczogZGF0YS5saW5rcywKICAgICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLAogICAgICAgICAgZHVyYXRpb246IGRhdGEuZHVyYXRpb24sCiAgICAgICAgICB0aHVtYjogZGF0YS50aHVtYgogICAgICAgIH07CgogICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTsKICAgICAgfQoKICAgICAgZGFpbHltb3Rpb25fY29tX2VtYmVkLmdldEVtYmVkVmlkZW9JbmZvKHJlcXVlc3QuZXh0VmlkZW9JZCwgcmVxdWVzdC5tZXRhZGF0YSwgY2FsbGJhY2tfbGlua3MpCiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgYWRkVW1teUxpbmtzOiBmdW5jdGlvbihsaW5rcywgdmlkZW9JZCkgewogICAgICBpZiAoZW5naW5lLnByZWZlcmVuY2VzLnNob3dVbW15SXRlbSAmJiBsaW5rcyAmJiBsaW5rcy5sZW5ndGgpIHsKICAgICAgICBsaW5rcy5wdXNoKHsKICAgICAgICAgIHVybDogJ3VtbXk6Ly93d3cuZGFpbHltb3Rpb24uY29tL3ZpZGVvLycgKyB2aWRlb0lkICsgJz9zZl90eXBlPWF1ZGlvJywKICAgICAgICAgIHR5cGU6ICd1bW15QXVkaW8nLAogICAgICAgICAgZXh0cmE6ICd1bW15JywKICAgICAgICAgIHZpZGVvSWQ6ICdkbS0nICsgdmlkZW9JZAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIHJlYWREbU1ldGFkYXRhOiBmdW5jdGlvbihtZXRhZGF0YSwgbm9SZWFkKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgaWYgKCFtZXRhZGF0YS5xdWFsaXRpZXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGRlbGV0ZSBtZXRhZGF0YS5xdWFsaXRpZXMuYXV0bzsKCiAgICAgIHZhciBxdWFsaXRpZXMgPSBtZXRhZGF0YS5xdWFsaXRpZXM7CgogICAgICB2YXIgbGlua3MgPSBbXTsKICAgICAgdmFyIGluZm8gPSB7CiAgICAgICAgdGl0bGU6IG1ldGFkYXRhLnRpdGxlLAogICAgICAgIGR1cmF0aW9uOiBtZXRhZGF0YS5kdXJhdGlvbiwKICAgICAgICB0aHVtYjogbWV0YWRhdGEucG9zdGVyX3VybCwKICAgICAgICBsaW5rczogdW5kZWZpbmVkCiAgICAgIH07CgogICAgICBmb3IgKHZhciBzaXplIGluIHF1YWxpdGllcykgewogICAgICAgIHZhciBsaW5rTGlzdCA9IHF1YWxpdGllc1tzaXplXTsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobGlua0xpc3QpKSBjb250aW51ZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBsaW5rTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICBpZiAoIS9tcDR8Zmx2Ly50ZXN0KGl0ZW0udHlwZSkgfHwgIWl0ZW0udXJsKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFub1JlYWQpIHsKICAgICAgICAgICAgdmFyIGxpbmtPYmogPSBkYWlseW1vdGlvbl9jb21fZW1iZWQucmVhZExpbmsoaXRlbS51cmwpOwogICAgICAgICAgICBsaW5rT2JqICYmIGxpbmtzLnB1c2gobGlua09iaik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5rcy5wdXNoKGl0ZW0udXJsKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChsaW5rcy5sZW5ndGgpIHsKICAgICAgICBpZiAoIW5vUmVhZCkgewogICAgICAgICAgbGlua3Muc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhLmhlaWdodCA8IGIuaGVpZ2h0OwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGluZm8ubGlua3MgPSBsaW5rczsKICAgICAgfQoKICAgICAgcmV0dXJuIGluZm87CiAgICB9LAoKICAgIGdldFBsYXllclY1TGlua3M6IGZ1bmN0aW9uKHRleHQsIGNiLCBub1JlYWQpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbWV0YWRhdGEgPSBudWxsOwogICAgICB0cnkgewogICAgICAgIHZhciBzY3JpcHRMaXN0ID0gbW9uby5nZXRQYWdlU2NyaXB0KHRleHQsIC9wbGF5ZXJWNS8pOwogICAgICAgIHNjcmlwdExpc3Quc29tZShmdW5jdGlvbihzY3JpcHQpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIHZhciBqc29uTGlzdCA9IG1vbm8uZmluZEpzb24oc2NyaXB0KTsKICAgICAgICAgIHJldHVybiBqc29uTGlzdC5zb21lKGZ1bmN0aW9uKGpzb24pIHsKICAgICAgICAgICAgaWYgKGpzb24gJiYganNvbi5tZXRhZGF0YSkgewogICAgICAgICAgICAgIG1ldGFkYXRhID0ganNvbi5tZXRhZGF0YTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmICghbWV0YWRhdGEpIHsKICAgICAgICAgIHRocm93ICdNZXRhZGF0YSBpcyBub3QgZm91bmQhJzsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgfQoKICAgICAgdmFyIGluZm8gPSB0aGlzLnJlYWREbU1ldGFkYXRhKG1ldGFkYXRhLCBub1JlYWQpOwogICAgICBjYihpbmZvKTsKICAgIH0sCgogICAgcmVhZExpbms6IGZ1bmN0aW9uKHVybCkgewogICAgICB1cmwgPSB1cmwucmVwbGFjZSgvXFxcLy9nLCAnLycpOwogICAgICB1cmwgPSB1cmwucmVwbGFjZSgvXEBcQFtcd1wtXSskLywgJycpOwogICAgICB2YXIgc2l6ZSA9ICcnOwogICAgICB2YXIgdCA9IHVybC5tYXRjaCgvXC9jZG5cL1x3K1wtKFxkK3hcZCspXC8vaSk7CiAgICAgIGlmICh0ICYmIHQubGVuZ3RoID4gMSkgewogICAgICAgIHNpemUgPSB0WzFdOwogICAgICB9IGVsc2UgewogICAgICAgIHQgPSB1cmwubWF0Y2goL1xEKFxkK3hcZCspXEQvaSk7CiAgICAgICAgaWYgKHQgJiYgdC5sZW5ndGggPiAxKSB7CiAgICAgICAgICBzaXplID0gdFsxXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBleHQgPSAnRkxWJzsKICAgICAgdCA9IHVybC5tYXRjaCgvXC4oXHd7MSw2fSkoPzokfFw/KS8pOwogICAgICBpZiAodCAmJiB0Lmxlbmd0aCA+IDEpIHsKICAgICAgICBleHQgPSB0WzFdLnRvVXBwZXJDYXNlKCk7CiAgICAgIH0KCiAgICAgIGlmIChzaXplICE9PSAnODB4NjAnKSB7CiAgICAgICAgdmFyIGhlaWdodCA9IHBhcnNlSW50KHNpemUuc3BsaXQoJ3gnKS5zbGljZSgtMSlbMF0pOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgIG5hbWU6IGV4dCArICcgJyArIGhlaWdodCwKICAgICAgICAgIGV4dDogZXh0LAogICAgICAgICAgaW5mb191cmw6ICcnLAogICAgICAgICAgaGVpZ2h0OiBoZWlnaHQKICAgICAgICB9OwogICAgICB9CiAgICB9LAoKICAgIGdldExpbmtzOiBmdW5jdGlvbih0ZXh0LCBjYiwgbm9SZWFkKSB7CiAgICAgIHZhciBhYm91dCA9IHt9OwogICAgICB2YXIgbGlua3MgPSBbXTsKICAgICAgdmFyIGluZm8gPSB0ZXh0Lm1hdGNoKC8oPzp2YXJ8LClccyppbmZvXHMqPVxzKlx7KC4qPylcfVxzKig/Ojt8LFxzKlx3K1xzKj0pL2kpOwoKICAgICAgaWYgKCFpbmZvIHx8IGluZm8ubGVuZ3RoIDwgMikgewogICAgICAgIHJldHVybiBkYWlseW1vdGlvbl9jb21fZW1iZWQuZ2V0UGxheWVyVjVMaW5rcyh0ZXh0LCBjYiwgbm9SZWFkKTsKICAgICAgfQogICAgICBpbmZvID0gaW5mb1sxXTsKICAgICAgdHJ5IHsKICAgICAgICBpbmZvID0gSlNPTi5wYXJzZSgneycgKyBpbmZvICsgJ30nKTsKICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgIH0KICAgICAgICBhYm91dC50aXRsZSA9IGluZm8udGl0bGU7CiAgICAgICAgYWJvdXQuZHVyYXRpb24gPSBpbmZvLmR1cmF0aW9uOwogICAgICAgIGFib3V0LnRodW1iID0gaW5mby50aHVtYm5haWxfbWVkaXVtX3VybDsKICAgICAgICBmb3IgKHZhciBpIGluIGluZm8pIHsKICAgICAgICAgIGlmICghaW5mby5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgaW5mb1tpXSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaW5mb1tpXS5zZWFyY2goL15odHRwcz86XC9cL1teXHNcIl0rXC4obXA0fGZsdikoXD98JCkvKSA+IC0xKSB7CiAgICAgICAgICAgIGlmIChub1JlYWQpIHsKICAgICAgICAgICAgICBsaW5rcy5wdXNoKGluZm9baV0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBsaW5rID0gZGFpbHltb3Rpb25fY29tX2VtYmVkLnJlYWRMaW5rKGluZm9baV0pOwogICAgICAgICAgICAgIGlmIChsaW5rICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGxpbmtzLnB1c2gobGluayk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7fQogICAgICBpZiAobGlua3MubGVuZ3RoID4gMCkgewogICAgICAgIGlmICghbm9SZWFkKSB7CiAgICAgICAgICBsaW5rcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGEuaGVpZ2h0IDwgYi5oZWlnaHQ7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgYWJvdXQubGlua3MgPSBsaW5rczsKICAgICAgfQogICAgICBjYihhYm91dCk7CiAgICB9LAoKICAgIGdldERhaWx5bW90aW9uRW1iZWRWaWRlb0luZm9Nc2c6IGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiBtZXNzYWdlLnVybAogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICBpZiAoZXJyIHx8ICFkYXRhKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIGRhaWx5bW90aW9uX2NvbV9lbWJlZC5nZXRMaW5rcyhkYXRhLCBjYiwgdHJ1ZSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRFbWJlZDogZnVuY3Rpb24odXJsLCBjYikgewogICAgICBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogdXJsCiAgICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcCwgZGF0YSkgewogICAgICAgIGlmIChlcnIgfHwgIWRhdGEpIHsKICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgIH0KCiAgICAgICAgZGFpbHltb3Rpb25fY29tX2VtYmVkLmdldExpbmtzKGRhdGEsIGNiKTsKICAgICAgfSk7CiAgICB9LAoKICAgIGdldEVtYmVkVmlkZW9JbmZvOiBmdW5jdGlvbihpZCwgbWV0YWRhdGEsIGNhbGxiYWNrKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgaWYgKG1ldGFkYXRhKSB7CiAgICAgICAgdmFyIGluZm8gPSB0aGlzLnJlYWREbU1ldGFkYXRhKG1ldGFkYXRhKTsKICAgICAgICBpZiAoaW5mbyAmJiBpbmZvLmxpbmtzICYmIGluZm8ubGlua3MubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soaW5mbyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgdXJsID0gImh0dHA6Ly93d3cuZGFpbHltb3Rpb24uY29tL2VtYmVkL3ZpZGVvLyIgKyBpZDsKICAgICAgZGFpbHltb3Rpb25fY29tX2VtYmVkLmdldEVtYmVkKHVybCwgY2FsbGJhY2spOwogICAgfQogIH07CgogIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgewogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24oX21vbm8sIF9lbmdpbmUpIHsKICAgICAgbW9ubyA9IF9tb25vOwogICAgICBlbmdpbmUgPSBfZW5naW5lOwogICAgICByZXR1cm4gZGFpbHltb3Rpb25fY29tX2VtYmVkOwogICAgfTsKICB9IGVsc2UgewogICAgZW5naW5lLm1vZHVsZXMuZGFpbHltb3Rpb24gPSBkYWlseW1vdGlvbl9jb21fZW1iZWQ7CiAgfQogIHZhciBvZG5va2xhc3NuaWtpX3J1X2VtYmVkID0gewogICAgZ2V0T2Rub2tsYXNzbmlraUxpbmtzOiBmdW5jdGlvbihyZXF1ZXN0LCBjYWxsYmFjaykgewogICAgICBmdW5jdGlvbiBjYWxsYmFja19saW5rcyhsaW5rcykgewogICAgICAgIHZhciByZXNwb25zZSA9IHsKICAgICAgICAgIGFjdGlvbjogcmVxdWVzdC5hY3Rpb24sCiAgICAgICAgICBleHRWaWRlb0lkOiByZXF1ZXN0LmV4dFZpZGVvSWQsCiAgICAgICAgICBsaW5rczogbGlua3MsCiAgICAgICAgICB0aXRsZTogcmVxdWVzdC50aXRsZQogICAgICAgIH07CgogICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTsKICAgICAgfQoKICAgICAgb2Rub2tsYXNzbmlraV9ydV9lbWJlZC5fZ2V0T2Rub2tsYXNzbmlraUxpbmtzKHJlcXVlc3QuZXh0VmlkZW9JZCwgY2FsbGJhY2tfbGlua3MpOwogICAgfSwKCiAgICBnZXRPZG5va2xhc3NuaWtpQXVkaW9MaW5rczogZnVuY3Rpb24ocmVxdWVzdCwgY2FsbGJhY2spIHsKICAgICAgZnVuY3Rpb24gY2FsbGJhY2tfbGlua3MoZGF0YSkgewogICAgICAgIHZhciByZXNwb25zZSA9IHsKICAgICAgICAgIGFjdGlvbjogcmVxdWVzdC5hY3Rpb24sCiAgICAgICAgICB0cmFja0lkOiByZXF1ZXN0LnRyYWNrSWQsCiAgICAgICAgICBqc2Vzc2lvbklkOiByZXF1ZXN0LmpzZXNzaW9uSWQsCiAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgfTsKCiAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpOwogICAgICB9CgogICAgICBvZG5va2xhc3NuaWtpX3J1X2VtYmVkLl9nZXRPZG5va2xhc3NuaWtpQXVkaW9MaW5rcyhyZXF1ZXN0LnVybCwgcmVxdWVzdC50cmFja0lkLCByZXF1ZXN0LmpzZXNzaW9uSWQsIGNhbGxiYWNrX2xpbmtzKTsKICAgIH0sCgogICAgX2dldE9kbm9rbGFzc25pa2lMaW5rczogZnVuY3Rpb24oZXh0VmlkZW9JZCwgY2FsbGJhY2spIHsKICAgICAgaWYgKCFleHRWaWRlb0lkKSB7CiAgICAgICAgY2FsbGJhY2sobnVsbCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9pbi52aWRlby5tYWlsLnJ1L2NnaS1iaW4vdmlkZW8vb2tsaXRlP2VpZD0nICsgZXh0VmlkZW9JZDsKCiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiB1cmwKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgaWYgKGVyciB8fCAhZGF0YSkgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHUgPSAnaHR0cDovL3d3dy5va2NvbnRlbnQudmlkZW8ubWFpbC5ydS9tZWRpYS8nOwoKICAgICAgICB2YXIgaG9zdCA9IGRhdGEubWF0Y2goL1wkdmNvbnRlbnRIb3N0PShbXlxzIic8Pl0rKS9pKTsKICAgICAgICBpZiAoaG9zdCAmJiBob3N0Lmxlbmd0aCA+IDEpIHsKICAgICAgICAgIHUgPSAnaHR0cDovLycgKyBob3N0WzFdICsgJy9tZWRpYS8nOwogICAgICAgIH0KCiAgICAgICAgdSArPSBleHRWaWRlb0lkOwoKICAgICAgICB2YXIgbGlua3MgPSBbXTsKCiAgICAgICAgdmFyIHF1YWxpdHkgPSAnJzsKICAgICAgICB2YXIgcXVsaXR5TWF0Y2ggPSBkYXRhLm1hdGNoKC9cJGhlaWdodD0oWzAtOV0rKS8pOwogICAgICAgIGlmIChxdWxpdHlNYXRjaCAmJiBxdWxpdHlNYXRjaC5sZW5ndGggPiAxKSB7CiAgICAgICAgICBxdWFsaXR5ID0gcXVsaXR5TWF0Y2hbMV07CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5wdXNoKHsKICAgICAgICAgIHVybDogdSArICctdi5tcDQnLAogICAgICAgICAgbmFtZTogJ1NEJywKICAgICAgICAgIGV4dDogJ0ZMVicsCiAgICAgICAgICBzdWJuYW1lOiBxdWFsaXR5CiAgICAgICAgfSk7CgogICAgICAgIGlmIChkYXRhLnNlYXJjaCgvXCRIRGV4aXN0PTEvaSkgPiAtMSkgewogICAgICAgICAgcXVhbGl0eSA9ICcnOwogICAgICAgICAgcXVsaXR5TWF0Y2ggPSBkYXRhLm1hdGNoKC9cJEhEaGVpZ2h0PShbMC05XSspLyk7CiAgICAgICAgICBpZiAocXVsaXR5TWF0Y2ggJiYgcXVsaXR5TWF0Y2gubGVuZ3RoID4gMSkgewogICAgICAgICAgICBxdWFsaXR5ID0gcXVsaXR5TWF0Y2hbMV07CiAgICAgICAgICB9CgogICAgICAgICAgbGlua3MucHVzaCh7CiAgICAgICAgICAgIHVybDogdSArICctaHYubXA0JywKICAgICAgICAgICAgbmFtZTogJ0hEJywKICAgICAgICAgICAgZXh0OiAnTVA0JywKICAgICAgICAgICAgc3VibmFtZTogcXVhbGl0eQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAobGlua3MpIHsKICAgICAgICAgIGNhbGxiYWNrKGxpbmtzKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBfZ2V0T2Rub2tsYXNzbmlraUF1ZGlvTGlua3M6IGZ1bmN0aW9uKHBhZ2VVcmwsIHRyYWNrSWQsIGpTZXNzaW9uSWQsIGNiKSB7CiAgICAgIGlmICghdHJhY2tJZCB8fCAhalNlc3Npb25JZCkgewogICAgICAgIHJldHVybiBjYihudWxsKTsKICAgICAgfQoKICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICB1cmw6ICdodHRwOi8vd21mMS5vZG5va2xhc3NuaWtpLnJ1L3BsYXk7anNlc3Npb25pZD0nICsgalNlc3Npb25JZCArICc/dGlkPScgKyB0cmFja0lkICsgJyYnLAogICAgICAgIGpzb246IHRydWUKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBqc29uKSB7CiAgICAgICAgaWYgKGVyciB8fCAhanNvbikgewogICAgICAgICAgcmV0dXJuIGNiKG51bGwpOwogICAgICAgIH0KCiAgICAgICAgY2IoanNvbik7CiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRPa0F1ZGlvTGlzdExpbmtzOiBmdW5jdGlvbihtc2csIGNiKSB7CiAgICAgIHZhciByZXNwb25zZUxpc3QgPSBbXTsKICAgICAgdmFyIHRyYWNrSWRMaXN0ID0gbXNnLnRyYWNrSWRBcnI7CiAgICAgIHZhciBqU2Vzc2lvbklkID0gbXNnLmpzZXNzaW9uSWQ7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0cmFja0lkTGlzdCkgfHwgdHlwZW9mIGpTZXNzaW9uSWQgIT09ICdzdHJpbmcnIHx8ICF0cmFja0lkTGlzdC5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gY2IocmVzcG9uc2VMaXN0KTsKICAgICAgfQoKICAgICAgdmFyIHdhaXRDb3VudCA9IHRyYWNrSWRMaXN0Lmxlbmd0aDsKICAgICAgdmFyIHJlYWR5Q291bnQgPSAwOwogICAgICB2YXIgb25SZWFkeSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJlYWR5Q291bnQrKzsKICAgICAgICBpZiAocmVhZHlDb3VudCAhPT0gd2FpdENvdW50KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJldHVybiBjYihyZXNwb25zZUxpc3QpOwogICAgICB9OwogICAgICB2YXIgb25HZXREYXRhID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICByZXNwb25zZUxpc3QucHVzaChkYXRhKTsKICAgICAgICB9CiAgICAgICAgb25SZWFkeSgpOwogICAgICB9OwogICAgICBmb3IgKHZhciBpID0gMCwgdHJhY2tJZDsgdHJhY2tJZCA9IHRyYWNrSWRMaXN0W2ldOyBpKyspIHsKICAgICAgICB0aGlzLl9nZXRPZG5va2xhc3NuaWtpQXVkaW9MaW5rcyh1bmRlZmluZWQsIHRyYWNrSWQsIGpTZXNzaW9uSWQsIG9uR2V0RGF0YSk7CiAgICAgIH0KICAgIH0sCgogICAgZ2V0Q2xpcHlvdUxpbmtzOiBmdW5jdGlvbihpZCwgaGFzaCwgcXVhbGl0eSwgdGl0bGUsIGNiKSB7CiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiAnaHR0cDovL21lZGlhLmNsaXB5b3UucnUvYXBpL3BsYXllci9zZWN1cmVfbGluaz9yZWNvcmRfaWQ9JyArIGlkICsgJyZ0eXBlPW1wNCZyZXNvdXJjZV9oYXNoPScgKyBoYXNoLAogICAgICAgIGpzb246IHRydWUKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBqc29uKSB7CiAgICAgICAgaWYgKGVyciB8fCAhanNvbiB8fCAhQXJyYXkuaXNBcnJheShqc29uLmRhdGEpIHx8ICFqc29uLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIHZhciBsaW5rcyA9IFtdOwogICAgICAgIGpzb24uZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgIGxpbmtzLnB1c2goewogICAgICAgICAgICBxdWFsaXR5OiBxdWFsaXR5LAogICAgICAgICAgICB1cmw6IGl0ZW0sCiAgICAgICAgICAgIHRpdGxlOiB0aXRsZQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgY2IobGlua3MpOwogICAgICB9KTsKICAgIH0sCgogICAgZ2V0Q2xpcHlvdUhhc2g6IGZ1bmN0aW9uKGlkLCBjYikgewogICAgICBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogJ2h0dHA6Ly9tZWRpYS5jbGlweW91LnJ1L2FwaS9wbGF5ZXJfZGF0YS5qc29uP2lkPScgKyBpZAogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICBpZiAoZXJyIHx8ICFkYXRhKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIGRhdGEgPSBkYXRhLm1hdGNoKCdyZXNvdXJjZV9oYXNoIi4/Oi4/IihbXiJdKikiJyk7CiAgICAgICAgaWYgKCFkYXRhIHx8IGRhdGEubGVuZ3RoIDwgMikgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQogICAgICAgIHZhciBoYXNoID0gZGF0YVsxXTsKICAgICAgICBjYihoYXNoKTsKICAgICAgfSk7CiAgICB9LAoKICAgIGdldFBsYWRmb3JtVmlkZW86IGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIHJlc3BvbnNlID0gewogICAgICAgIGFjdGlvbjogbWVzc2FnZS5hY3Rpb24sCiAgICAgICAgZXh0VmlkZW9JZDogbWVzc2FnZS5leHRWaWRlb0lkLAogICAgICAgIGxpbmtzOiBbXSwKICAgICAgICB0aXRsZTogbWVzc2FnZS50aXRsZQogICAgICB9OwoKICAgICAgdmFyIGRvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICBjYihyZXNwb25zZSk7CiAgICAgIH07CgogICAgICB2YXIgcGxheWVySWQgPSBtZXNzYWdlLmV4dFZpZGVvSWQucGxheWVySWQ7CiAgICAgIHZhciB2aWRlb0lkID0gbWVzc2FnZS5leHRWaWRlb0lkLnZpZGVvSWQ7CgogICAgICBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogJ2h0dHA6Ly9vdXQucGxhZGZvcm0ucnUvZ2V0VmlkZW8/cGw9JyArIHBsYXllcklkICsgJyZ2aWRlb2lkPScgKyB2aWRlb0lkLAogICAgICAgIHhtbDogdHJ1ZQogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIHhtbCkgewogICAgICAgIGlmIChlcnIgfHwgIXhtbCkgewogICAgICAgICAgcmV0dXJuIGRvbmUoKTsKICAgICAgICB9CgogICAgICAgIHZhciBzcmNMaXN0ID0geG1sLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NyYycpOwogICAgICAgIGlmIChzcmNMaXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIGRvbmUoKTsKICAgICAgICB9CgogICAgICAgIHZhciBjb3ZlciA9IHhtbC5xdWVyeVNlbGVjdG9yKCdjb3ZlcicpIHx8IHVuZGVmaW5lZDsKICAgICAgICBpZiAoY292ZXIgJiYgKGNvdmVyID0gY292ZXIudGV4dENvbnRlbnQpICYmIGNvdmVyLnN1YnN0cigwLCAyKSA9PT0gJy8vJykgewogICAgICAgICAgY292ZXIgPSAnaHR0cDonICsgY292ZXI7CiAgICAgICAgfQoKICAgICAgICB2YXIgdGltZSA9IHhtbC5xdWVyeVNlbGVjdG9yKCd0aW1lJykgfHwgdW5kZWZpbmVkOwogICAgICAgIHRpbWUgPSB0aW1lICYmIHRpbWUudGV4dENvbnRlbnQ7CgogICAgICAgIHZhciB0aXRsZSA9IHhtbC5xdWVyeVNlbGVjdG9yKCd0aXRsZScpOwogICAgICAgIHRpdGxlID0gdGl0bGUgJiYgdGl0bGUudGV4dENvbnRlbnQ7CiAgICAgICAgaWYgKHRpdGxlKSB7CiAgICAgICAgICByZXNwb25zZS50aXRsZSA9IHRpdGxlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGZpcnN0TGluayA9IHNyY0xpc3RbMF07CiAgICAgICAgdmFyIHR5cGUgPSBmaXJzdExpbmsuZ2V0QXR0cmlidXRlKCd0eXBlJyk7CiAgICAgICAgdmFyIGlkID0gZmlyc3RMaW5rLnRleHRDb250ZW50IHx8ICcnOwogICAgICAgIHZhciBxdWFsaXR5ID0gZmlyc3RMaW5rLmdldEF0dHJpYnV0ZSgncXVhbGl0eScpOwogICAgICAgIGlmIChmaXJzdExpbmspIHsKICAgICAgICAgIGlmICh0eXBlID09PSAnY2xpcHlvdScpIHsKICAgICAgICAgICAgb2Rub2tsYXNzbmlraV9ydV9lbWJlZC5nZXRDbGlweW91SGFzaChpZCwgZnVuY3Rpb24oaGFzaCkgewogICAgICAgICAgICAgIGlmICghaGFzaCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRvbmUoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG9kbm9rbGFzc25pa2lfcnVfZW1iZWQuZ2V0Q2xpcHlvdUxpbmtzKGlkLCBoYXNoLCBxdWFsaXR5LCB0aXRsZSwgZnVuY3Rpb24obGlua3MpIHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmxpbmtzID0gbGlua3M7CgogICAgICAgICAgICAgICAgZG9uZSgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSBlbHNlCiAgICAgICAgICBpZiAodHlwZSA9PT0gJ3J1dHViZScpIHsKICAgICAgICAgICAgdmFyIGV4dGVybmFsRW1iZWQgPSB4bWwucXVlcnlTZWxlY3RvcignZXh0ZXJuYWxfZW1iZWQnKTsKICAgICAgICAgICAgZXh0ZXJuYWxFbWJlZCA9IGV4dGVybmFsRW1iZWQgJiYgZXh0ZXJuYWxFbWJlZC50ZXh0Q29udGVudDsKICAgICAgICAgICAgaWYgKGV4dGVybmFsRW1iZWQpIHsKICAgICAgICAgICAgICByZXNwb25zZS5hY3Rpb24gPSAnZ2V0UnV0dWJlTGlua3MnOwogICAgICAgICAgICAgIHJlc3BvbnNlLmxpbmtzID0gW2V4dGVybmFsRW1iZWRdOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZG9uZSgpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHF1YWxpdHlMaXN0ID0gWydsZCcsICdzZCddOwogICAgICAgIHZhciBzaXplTGlzdCA9IFsnMzYwJywgJzcyMCddOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgc3JjOyBzcmMgPSBzcmNMaXN0W2ldOyBpKyspIHsKICAgICAgICAgIGlkID0gc3JjLnRleHRDb250ZW50IHx8ICcnOwogICAgICAgICAgcXVhbGl0eSA9IHNyYy5nZXRBdHRyaWJ1dGUoJ3F1YWxpdHknKTsKCiAgICAgICAgICBpZiAoL15cZCtwJC8udGVzdChxdWFsaXR5KSkgewogICAgICAgICAgICBxdWFsaXR5ID0gcXVhbGl0eS5tYXRjaCgvXihcZCspcCQvKVsxXTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcUluZGV4ID0gcXVhbGl0eUxpc3QuaW5kZXhPZihxdWFsaXR5KTsKICAgICAgICAgIGlmIChxSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgIHF1YWxpdHkgPSBzaXplTGlzdFtxSW5kZXhdOwogICAgICAgICAgfQoKICAgICAgICAgIHR5cGUgPSBzcmMuZ2V0QXR0cmlidXRlKCd0eXBlJyk7CgogICAgICAgICAgaWYgKHR5cGUgPT09ICd2aWRlbycpIHsKICAgICAgICAgICAgcmVzcG9uc2UubGlua3MucHVzaCh7CiAgICAgICAgICAgICAgdXJsOiBpZCwKICAgICAgICAgICAgICBxdWFsaXR5OiBxdWFsaXR5LAogICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgICBjb3ZlcjogY292ZXIsCiAgICAgICAgICAgICAgZHVyYXRpb246IHRpbWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZG9uZSgpOwogICAgICB9KTsKICAgIH0sCgogICAgZ2V0T2tNZXRhZGF0YTogZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgdmFyIHVybCA9IG1lc3NhZ2UudXJsOwogICAgICBpZiAoIXVybCkgewogICAgICAgIHJldHVybiBjYigpOwogICAgICB9CiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiB1cmwsCiAgICAgICAganNvbjogdHJ1ZQogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGpzb24pIHsKICAgICAgICBpZiAoZXJyIHx8ICFqc29uKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIGNiKGpzb24pOwogICAgICB9KTsKICAgIH0sCgogICAgZ2V0T2tWaWFNb2JpbGU6IGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG1ldGFkYXRhID0gbWVzc2FnZS5tZXRhZGF0YTsKICAgICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICAnc3QuY21kJzogJ21vdmllTGF5ZXInLAogICAgICAgICdzdC5tdklkJzogbWVzc2FnZS5tdklkCiAgICAgIH07CiAgICAgIHZhciB1cmwgPSAnaHR0cDovL20ub2sucnUvZGs/JyArIG1vbm8ucGFyYW0ocGFyYW1zKTsKCiAgICAgIHZhciByZXNwb25zZSA9IHsKICAgICAgICBhY3Rpb246IG1lc3NhZ2UuYWN0aW9uLAogICAgICAgIGxpbmtzOiBudWxsLAogICAgICAgIHRpdGxlOiBtZXRhZGF0YS5tb3ZpZS50aXRsZQogICAgICB9OwoKICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICB1cmw6IHVybAogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICBpZiAoZXJyIHx8ICFkYXRhKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIHZhciByID0gbmV3IFJlZ0V4cCgnaHJlZj0iKFteIl0rc3RcXC5jbWQ9bW92aWVQbGF5YmFja1JlZGlyZWN0W14iXStzdFxcLm12aWQ9JyArIG1lc3NhZ2UubXZJZCArICdbXiJdKykiJyk7CiAgICAgICAgdmFyIG1vdmllUGxheWJhY2tSZWRpcmVjdCA9IGRhdGEubWF0Y2gocik7CiAgICAgICAgbW92aWVQbGF5YmFja1JlZGlyZWN0ID0gbW92aWVQbGF5YmFja1JlZGlyZWN0ICYmIG1vdmllUGxheWJhY2tSZWRpcmVjdFsxXTsKICAgICAgICBpZiAoIW1vdmllUGxheWJhY2tSZWRpcmVjdCkgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQoKICAgICAgICBtb3ZpZVBsYXliYWNrUmVkaXJlY3QgPSBtb25vLmZpbGVOYW1lLmRlY29kZVNwZWNpYWxDaGFycyhtb3ZpZVBsYXliYWNrUmVkaXJlY3QpOwoKICAgICAgICByZXNwb25zZS5saW5rcyA9IFt7CiAgICAgICAgICB1cmw6IG1vdmllUGxheWJhY2tSZWRpcmVjdAogICAgICAgIH1dOwoKICAgICAgICBpZiAoIS9zdC5tcT1cZCsvLnRlc3QobW92aWVQbGF5YmFja1JlZGlyZWN0KSkgewogICAgICAgICAgcmV0dXJuIGNiKHJlc3BvbnNlKTsKICAgICAgICB9CgogICAgICAgIHZhciB2aWRlb3MgPSBtZXRhZGF0YS52aWRlb3M7CiAgICAgICAgaWYgKCF2aWRlb3MgfHwgIXZpZGVvcy5sZW5ndGgpIHsKICAgICAgICAgIHJldHVybiBjYihyZXNwb25zZSk7CiAgICAgICAgfQoKICAgICAgICB2aWRlb3MuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICBpZiAoIWl0ZW0udXJsKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcGFyYW1zID0gbW9uby5wYXJzZVVybChpdGVtLnVybCk7CiAgICAgICAgICBpZiAoIXBhcmFtcy50eXBlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpdGVtLnVybCA9IG1vdmllUGxheWJhY2tSZWRpcmVjdC5yZXBsYWNlKC8oc3QubXE9KVxkKy8sICckMScgKyBwYXJhbXMudHlwZSk7CiAgICAgICAgfSk7CgogICAgICAgIHJlc3BvbnNlLmxpbmtzID0gdmlkZW9zOwoKICAgICAgICBjYihyZXNwb25zZSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBva0RpcmVjdE9yTW9iaWxlOiBmdW5jdGlvbihtZXNzYWdlLCBjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBtZXRhZGF0YSA9IG1lc3NhZ2UubWV0YWRhdGE7CiAgICAgIHZhciB1cmwgPSBudWxsOwogICAgICBtZXRhZGF0YS52aWRlb3MgJiYgbWV0YWRhdGEudmlkZW9zLnNvbWUoZnVuY3Rpb24oaXRlbSkgewogICAgICAgIGlmIChpdGVtLnVybCkgewogICAgICAgICAgdXJsID0gaXRlbS51cmw7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIG9uQWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICBtZXNzYWdlLmFjdGlvbiA9ICdnZXRPa1ZpYU1vYmlsZSc7CiAgICAgICAgb2Rub2tsYXNzbmlraV9ydV9lbWJlZC5nZXRPa1ZpYU1vYmlsZShtZXNzYWdlLCBjYik7CiAgICAgIH07CgogICAgICBpZiAoIXVybCkgewogICAgICAgIHJldHVybiBvbkFib3J0KCk7CiAgICAgIH0KCiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgdHlwZTogJ0hFQUQnCiAgICAgIH0sIGZ1bmN0aW9uKGVycikgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHJldHVybiBvbkFib3J0KCk7CiAgICAgICAgfQoKICAgICAgICBtZXNzYWdlLmFjdGlvbiA9ICdnZXRPa1ZpYU1vYmlsZU5vV3JhcCc7CiAgICAgICAgbWVzc2FnZS5saW5rcyA9IG1ldGFkYXRhLnZpZGVvczsKICAgICAgICByZXR1cm4gY2IobWVzc2FnZSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgewogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24oX21vbm8sIF9lbmdpbmUpIHsKICAgICAgbW9ubyA9IF9tb25vOwogICAgICBlbmdpbmUgPSBfZW5naW5lOwogICAgICByZXR1cm4gb2Rub2tsYXNzbmlraV9ydV9lbWJlZDsKICAgIH07CiAgfSBlbHNlIHsKICAgIGVuZ2luZS5tb2R1bGVzLm9kbm9rbGFzc25pa2kgPSBvZG5va2xhc3NuaWtpX3J1X2VtYmVkOwogIH0KICB2YXIgc291bmRjbG91ZF9jb21fZW1iZWQgPSB7CiAgICBnZXRTb3VuZGNsb3VkVHJhY2tJbmZvOiBmdW5jdGlvbihyZXF1ZXN0LCBjYWxsYmFjaykgewogICAgICBmdW5jdGlvbiBjYWxsYmFja19saW5rcyhkYXRhLCBpc1ZhbGlkKSB7CiAgICAgICAgdmFyIHJlc3BvbnNlID0gewogICAgICAgICAgYWN0aW9uOiByZXF1ZXN0LmFjdGlvbiwKICAgICAgICAgIHRyYWNrVXJsOiByZXF1ZXN0LnRyYWNrVXJsLAogICAgICAgICAgY2xpZW50X2lkOiByZXF1ZXN0LmNsaWVudF9pZCwKICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICBjaGVja0xpbmtzOiBpc1ZhbGlkCiAgICAgICAgfTsKCiAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpOwogICAgICB9CgogICAgICBzb3VuZGNsb3VkX2NvbV9lbWJlZC5fZ2V0U291bmRjbG91ZFRyYWNrSW5mbyhyZXF1ZXN0LnRyYWNrVXJsLCByZXF1ZXN0LmNsaWVudF9pZCwgY2FsbGJhY2tfbGlua3MpOwogICAgfSwKCiAgICBfZ2V0U291bmRjbG91ZFRyYWNrSW5mbzogZnVuY3Rpb24odHJhY2tVcmwsIGNsaWVudF9pZCwgY2FsbGJhY2spIHsKICAgICAgaWYgKCF0cmFja1VybCB8fCAhY2xpZW50X2lkKSB7CiAgICAgICAgY2FsbGJhY2sobnVsbCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9hcGkuc291bmRjbG91ZC5jb20vcmVzb2x2ZS5qc29uP3VybD0nICsgdHJhY2tVcmwgKwogICAgICAgICcmY2xpZW50X2lkPScgKyBjbGllbnRfaWQ7CgogICAgICBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogdXJsLAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgIFJlZmVyZXI6IHVybAogICAgICAgIH0sCiAgICAgICAganNvbjogdHJ1ZQogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGpzb24pIHsKICAgICAgICBpZiAoZXJyIHx8ICFqc29uKSB7CiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTsKICAgICAgICB9CgogICAgICAgIHNvdW5kY2xvdWRfY29tX2VtYmVkLmNoZWNrU291bmRjbG91ZExpbmtzKGpzb24sIGNsaWVudF9pZCwgY2FsbGJhY2spOwogICAgICB9KTsKICAgIH0sCgogICAgY2hlY2tTb3VuZGNsb3VkTGlua3M6IGZ1bmN0aW9uKGRhdGEsIGNsaWVudF9pZCwgY2IpIHsKICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KICAgICAgdmFyIGluZm8gPSBkYXRhOwoKICAgICAgaWYgKGluZm8ua2luZCAhPT0gJ3RyYWNrJyAmJiBpbmZvLnRyYWNrcyAmJiBpbmZvLnRyYWNrcy5sZW5ndGggPT09IDEpIHsKICAgICAgICBpbmZvID0gaW5mby50cmFja3NbMF07CiAgICAgIH0KCiAgICAgIGlmIChpbmZvLmtpbmQgPT09ICd0cmFjaycgJiYgaW5mby5zdHJlYW1fdXJsKSB7CiAgICAgICAgc291bmRjbG91ZF9jb21fZW1iZWQudmFsaWRhdGVTb3VuZGNsb3VkVHJhY2tVcmwoaW5mby5zdHJlYW1fdXJsLCBjbGllbnRfaWQsIGZ1bmN0aW9uKGlzVmFsaWQpIHsKICAgICAgICAgIGNiKGRhdGEsIGlzVmFsaWQpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGluZm8udHJhY2tzICYmIGluZm8udHJhY2tzWzBdKSB7CiAgICAgICAgc291bmRjbG91ZF9jb21fZW1iZWQudmFsaWRhdGVTb3VuZGNsb3VkVHJhY2tVcmwoaW5mby50cmFja3NbMF0uc3RyZWFtX3VybCwgY2xpZW50X2lkLCBmdW5jdGlvbihpc1ZhbGlkKSB7CiAgICAgICAgICBjYihkYXRhLCBpc1ZhbGlkKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJldHVybiBjYihkYXRhKTsKICAgIH0sCgogICAgdmFsaWRhdGVTb3VuZGNsb3VkVHJhY2tVcmw6IGZ1bmN0aW9uKHVybCwgY2xpZW50X2lkLCBjYikgewogICAgICB1cmwgKz0gKHVybC5pbmRleE9mKCc/JykgPT09IC0xKSA/ICc/JyA6ICcmJzsKICAgICAgdXJsICs9ICdjbGllbnRfaWQ9JyArIGNsaWVudF9pZDsKICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICB1cmw6IHVybCwKICAgICAgICB0eXBlOiAnSEVBRCcKICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgY2IoIWVycik7CiAgICAgIH0pOwogICAgfQogIH07CgogIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgewogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24oX21vbm8sIF9lbmdpbmUpIHsKICAgICAgbW9ubyA9IF9tb25vOwogICAgICBlbmdpbmUgPSBfZW5naW5lOwogICAgICByZXR1cm4gc291bmRjbG91ZF9jb21fZW1iZWQ7CiAgICB9OwogIH0gZWxzZSB7CiAgICBlbmdpbmUubW9kdWxlcy5zb3VuZGNsb3VkID0gc291bmRjbG91ZF9jb21fZW1iZWQ7CiAgfQogIHZhciB2aW1lb19jb21fZW1iZWQgPSB7CiAgICBnZXRWaW1lb0xpbmtzOiBmdW5jdGlvbihyZXF1ZXN0LCBjYWxsYmFjaykgewogICAgICAidXNlIHN0cmljdCI7CgogICAgICBmdW5jdGlvbiBjYWxsYmFja19saW5rcyhsaW5rcywgdGl0bGUsIHRodW1iKSB7CiAgICAgICAgdmFyIHJlc3BvbnNlID0gewogICAgICAgICAgYWN0aW9uOiByZXF1ZXN0LmFjdGlvbiwKICAgICAgICAgIGV4dFZpZGVvSWQ6IHJlcXVlc3QuZXh0VmlkZW9JZCwKICAgICAgICAgIGxpbmtzOiBsaW5rcywKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIHRodW1iOiB0aHVtYgogICAgICAgIH07CgogICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTsKICAgICAgfQoKICAgICAgdmltZW9fY29tX2VtYmVkLl9nZXRWaW1lb0xpbmtzKHJlcXVlc3QuZXh0VmlkZW9JZCwgcmVxdWVzdC51cmwsIGNhbGxiYWNrX2xpbmtzKTsKICAgIH0sCiAgICBfZ2V0VmltZW9MaW5rczogZnVuY3Rpb24odmlkZW9JZCwgdXJsLCBjYWxsYmFjaykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZpbWVvX2NvbV9lbWJlZC5nZXRWaW1lb05vRW1iZWRMaW5rcyh2aWRlb0lkLCB1cmwsIGZ1bmN0aW9uKGxpbmtzLCB0aXRsZSwgdGh1bWIpIHsKICAgICAgICBpZiAobGlua3MpIHsKICAgICAgICAgIHJldHVybiBjYWxsYmFjayhsaW5rcywgdGl0bGUsIHRodW1iKTsKICAgICAgICB9CgogICAgICAgIHZpbWVvX2NvbV9lbWJlZC5nZXRWaW1lb0VtYmVkTGlua3ModmlkZW9JZCwgY2FsbGJhY2spOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRWaW1lb0VtYmVkTGlua3M6IGZ1bmN0aW9uKHZpZGVvSWQsIGNhbGxiYWNrKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsICcnLCAnJyk7CiAgICAgIH07CgogICAgICBpZiAoIXZpZGVvSWQpIHsKICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgfQoKICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICB1cmw6ICdodHRwczovL3BsYXllci52aW1lby5jb20vdmlkZW8vJyArIHZpZGVvSWQKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgaWYgKGVyciB8fCAhZGF0YSkgewogICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgfQoKICAgICAgICB2YXIganNvbkxpc3QgPSBtb25vLmZpbmRKc29uKGRhdGEsIFsvImZpbGVzIjovXSk7CiAgICAgICAgdmFyIGNvbmZpZyA9IG51bGw7CiAgICAgICAganNvbkxpc3Quc29tZShmdW5jdGlvbihvYmopIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIGlmICghb2JqLnZpZGVvIHx8ICFvYmoucmVxdWVzdCB8fCAhb2JqLnJlcXVlc3QuZmlsZXMpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbmZpZyA9IG9iajsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pOwoKICAgICAgICBkYXRhID0gdmltZW9fY29tX2VtYmVkLmdldExpbmtzRnJvbUNvbmZpZyhjb25maWcpOwogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZGF0YS5saW5rcywgZGF0YS50aXRsZSwgZGF0YS50aHVtYik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgfSk7CiAgICB9LAogICAgZ2V0VmltZW9Db25maWc6IGZ1bmN0aW9uKHVybCwgY2IpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY2IobnVsbCwgJycsICcnKTsKICAgICAgfTsKCiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiB1cmwKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgaWYgKGVyciB8fCAhZGF0YSkgewogICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgfQoKICAgICAgICBkYXRhID0gdmltZW9fY29tX2VtYmVkLmdldFZpbWVvRGF0YUZyb21Db25maWcoZGF0YSk7CiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgIHJldHVybiBjYihkYXRhLmxpbmtzLCBkYXRhLnRpdGxlLCBkYXRhLnRodW1iKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhYm9ydCgpOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRDbGlwUGFnZUNvbmZpZzogZnVuY3Rpb24oZGF0YSwgY2IpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY2IobnVsbCwgJycsICcnKTsKICAgICAgfTsKCiAgICAgIHZhciBjb25maWdVcmwgPSBudWxsOwogICAgICB2YXIgc2NyaXB0TGlzdCA9IG1vbm8uZ2V0UGFnZVNjcmlwdChkYXRhLCAvWyciXWNvbmZpZ191cmxbJyJdXHMqOlxzKi8pOwogICAgICBzY3JpcHRMaXN0LnNvbWUoZnVuY3Rpb24oc2NyaXB0KSB7CiAgICAgICAgdmFyIGNvbmZpZ0xpc3QgPSBtb25vLmZpbmRKc29uKHNjcmlwdCwgL1snIl1jb25maWdfdXJsWyciXVxzKjpccyovKTsKICAgICAgICByZXR1cm4gY29uZmlnTGlzdC5zb21lKGZ1bmN0aW9uKGNvbmZpZykgewogICAgICAgICAgaWYgKGNvbmZpZy5wbGF5ZXIpIHsKICAgICAgICAgICAgY29uZmlnVXJsID0gY29uZmlnLnBsYXllci5jb25maWdfdXJsOwogICAgICAgICAgICBpZiAoY29uZmlnVXJsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBpZiAoY29uZmlnVXJsKSB7CiAgICAgICAgcmV0dXJuIHZpbWVvX2NvbV9lbWJlZC5nZXRWaW1lb0NvbmZpZyhjb25maWdVcmwsIGNiKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICB9LAogICAgZ2V0VmltZW9Ob0VtYmVkTGlua3M6IGZ1bmN0aW9uKHZpZGVvSWQsIHVybCwgY2IpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY2IobnVsbCwgJycsICcnKTsKICAgICAgfTsKCiAgICAgIGlmICh2aWRlb0lkICYmIHVybCAmJiAhL3ZpbWVvXC5jb21cL1teXC9dK1wvcmV2aWV3XC9cZCsvaS50ZXN0KHVybCkpIHsKICAgICAgICB1cmwgPSBudWxsOwogICAgICB9CgogICAgICBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogdXJsIHx8ICdodHRwczovL3ZpbWVvLmNvbS8nICsgdmlkZW9JZAogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICBpZiAoZXJyIHx8ICFkYXRhKSB7CiAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICB9CgogICAgICAgIHZhciBjb25maWdVcmwgPSBkYXRhLm1hdGNoKC9kYXRhLWNvbmZpZy11cmw9WyInXShbXlxzIic8Pl0rKS9pKTsKICAgICAgICBjb25maWdVcmwgPSBjb25maWdVcmwgJiYgY29uZmlnVXJsWzFdLnJlcGxhY2UoLyZhbXA7L2lnLCAnJicpOwoKICAgICAgICBpZiAoY29uZmlnVXJsKSB7CiAgICAgICAgICByZXR1cm4gdmltZW9fY29tX2VtYmVkLmdldFZpbWVvQ29uZmlnKGNvbmZpZ1VybCwgY2IpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdmltZW9fY29tX2VtYmVkLmdldENsaXBQYWdlQ29uZmlnKGRhdGEsIGNiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldFZpbWVvTGlua3NGcm9tQ29uZmlnOiBmdW5jdGlvbihtc2csIHJlc3BvbnNlKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGRhdGEgPSB2aW1lb19jb21fZW1iZWQuZ2V0TGlua3NGcm9tQ29uZmlnKG1zZy5jb25maWcpOwogICAgICBpZiAoZGF0YSkgewogICAgICAgIHJldHVybiByZXNwb25zZShkYXRhKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3BvbnNlKG51bGwpOwogICAgfSwKICAgIGdldExpbmtzRnJvbUNvbmZpZzogZnVuY3Rpb24oY29uZmlnKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgaWYgKCFjb25maWcgfHwgIWNvbmZpZy52aWRlbyB8fCAhY29uZmlnLnJlcXVlc3QgfHwgIWNvbmZpZy5yZXF1ZXN0LmZpbGVzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciB2aWRlbyA9IGNvbmZpZy52aWRlbzsKICAgICAgdmFyIGZpbGVzID0gY29uZmlnLnJlcXVlc3QuZmlsZXM7CgogICAgICB2YXIgZGF0YSA9IHt9OwoKICAgICAgZGF0YS50aXRsZSA9IHZpZGVvLnRpdGxlIHx8ICcnOwoKICAgICAgdmFyIG1heFNpemUgPSBudWxsOwogICAgICBmb3IgKHZhciBzaXplIGluIHZpZGVvLnRodW1icykgewogICAgICAgIGlmIChtYXhTaXplID09PSBudWxsIHx8IG1heFNpemUgPCBzaXplKSB7CiAgICAgICAgICBtYXhTaXplID0gc2l6ZTsKICAgICAgICAgIGRhdGEudGh1bWIgPSB2aWRlby50aHVtYnNbc2l6ZV07CiAgICAgICAgfQogICAgICB9CgogICAgICBkYXRhLmxpbmtzID0gW107CgogICAgICBmb3IgKHZhciB0eXBlIGluIGZpbGVzKSB7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGZpbGVzW3R5cGVdKSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZpbGVzW3R5cGVdLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgaWYgKCFpdGVtIHx8ICFpdGVtLnVybCB8fCAhaXRlbS5taW1lKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZXh0ID0gaXRlbS5taW1lLnNwbGl0KCcvJylbMV07CiAgICAgICAgICBpZiAoIWV4dCkgewogICAgICAgICAgICBleHQgPSBpdGVtLnVybC5tYXRjaCgvXC4oXHd7Miw0fSkoPzpcP3wjfCQpL2kpOwogICAgICAgICAgICBleHQgPSBleHQgJiYgZXh0WzFdIHx8ICdtcDQnOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBleHRVcCA9IGV4dC50b1VwcGVyQ2FzZSgpOwoKICAgICAgICAgIHZhciBoZWlnaHQgPSBpdGVtLnF1YWxpdHk7CiAgICAgICAgICBpZiAoL15cZCtwJC8udGVzdChoZWlnaHQpKSB7CiAgICAgICAgICAgIGhlaWdodCA9IGhlaWdodC5yZXBsYWNlKC9wJC8sICcnKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZXh0UXVhbGl0eSA9IGV4dFVwICsgJyAnICsgaGVpZ2h0OwoKICAgICAgICAgIGRhdGEubGlua3MucHVzaCh7CiAgICAgICAgICAgIHVybDogaXRlbS51cmwsCiAgICAgICAgICAgIG5hbWU6IGV4dFF1YWxpdHksCiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LAogICAgICAgICAgICB0eXBlOiBleHRVcCwKICAgICAgICAgICAgZm9ybWF0OiBleHRVcCwKICAgICAgICAgICAgZXh0OiBleHQKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAoIWRhdGEubGlua3MubGVuZ3RoKSB7CiAgICAgICAgZGF0YSA9IG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBkYXRhOwogICAgfSwKICAgIGdldFZpbWVvRGF0YUZyb21Db25maWc6IGZ1bmN0aW9uKGNvbmZpZykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGNvbmZpZyA9IGNvbmZpZy5yZXBsYWNlKC8oXHt8LClccyooXHcrKVxzKjovaWcsICckMSIkMiI6JykuCiAgICAgIHJlcGxhY2UoLyg6XHMrKVwnL2csICckMSInKS5yZXBsYWNlKC9cJyhbLFxdXH1dKS9nLCAnIiQxJyk7CgogICAgICB0cnkgewogICAgICAgIGNvbmZpZyA9IEpTT04ucGFyc2UoY29uZmlnKTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmdldExpbmtzRnJvbUNvbmZpZyhjb25maWcpOwogICAgfQogIH07CgogIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgewogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24oX21vbm8sIF9lbmdpbmUpIHsKICAgICAgbW9ubyA9IF9tb25vOwogICAgICBlbmdpbmUgPSBfZW5naW5lOwogICAgICByZXR1cm4gdmltZW9fY29tX2VtYmVkOwogICAgfTsKICB9IGVsc2UgewogICAgZW5naW5lLm1vZHVsZXMudmltZW8gPSB2aW1lb19jb21fZW1iZWQ7CiAgfQogIHZhciB2a29udGFrdGVfcnVfZW1iZWQgPSB7CiAgICBnZXRWS0xpbmtzOiBmdW5jdGlvbihyZXF1ZXN0LCBjYWxsYmFjaykgewogICAgICBmdW5jdGlvbiBjYWxsYmFja19saW5rcyh2aWQsIGxpbmtzLCB0aXRsZSwgZHVyYXRpb24sIHRodW1iLCBkYXRhLCBlbWJlZCkgewogICAgICAgIGlmIChlbWJlZCkgewogICAgICAgICAgZW1iZWQub3JpZ1JlcXVlc3QgPSByZXF1ZXN0OwogICAgICAgICAgZW5naW5lLm9uTWVzc2FnZShlbWJlZCwgY2FsbGJhY2spOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJlc3BvbnNlID0gewogICAgICAgICAgYWN0aW9uOiByZXF1ZXN0LmFjdGlvbiwKICAgICAgICAgIGV4dFZpZGVvSWQ6IHZpZCA/IHZpZCA6IHJlcXVlc3QuZXh0VmlkZW9JZCwKICAgICAgICAgIGxpbmtzOiBsaW5rcywKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbiwKICAgICAgICAgIHRodW1iOiB0aHVtYiwKICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICBjaGVja0xpbmtzOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHJlcXVlc3QuY2hlY2tMaW5rcyAmJiBsaW5rcyAmJiBsaW5rcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICB2a29udGFrdGVfcnVfZW1iZWQuY2hlY2tWa0xpbmtzKGxpbmtzLCBmdW5jdGlvbihjaGVja1VybCwgaXNWYWxpZCkgewogICAgICAgICAgICByZXNwb25zZS5jaGVja0xpbmtzID0gaXNWYWxpZDsKICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7CiAgICAgIH0KCiAgICAgIHZrb250YWt0ZV9ydV9lbWJlZC5fZ2V0VktMaW5rcyhyZXF1ZXN0LmV4dFZpZGVvSWQsIGNhbGxiYWNrX2xpbmtzKTsKICAgIH0sCgogICAgcHJlcGFyZVBsYWRmb3JtTGlua3M6IGZ1bmN0aW9uKHBsYWRmb3JtTGlua3MpIHsKICAgICAgdmFyIGxpbmtzOwogICAgICB2YXIgb2JqID0gewogICAgICAgIGxpbmtzOiBsaW5rcyA9IFtdCiAgICAgIH07CiAgICAgIHBsYWRmb3JtTGlua3MuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgb2JqLnRpdGxlID0gaXRlbS50aXRsZTsKICAgICAgICBvYmouZHVyYXRpb24gPSBpdGVtLmR1cmF0aW9uOwogICAgICAgIG9iai50aHVtYiA9IGl0ZW0uY292ZXI7CgogICAgICAgIHZhciBleHQgPSBpdGVtLnVybC5tYXRjaCgvW1x3XStcLihtcDR8Zmx2KSg/Olw/fCQpL2kpOwogICAgICAgIGlmICghZXh0KSB7CiAgICAgICAgICBleHQgPSAnZmx2JzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZXh0ID0gZXh0WzFdOwogICAgICAgIH0KICAgICAgICBsaW5rcy5wdXNoKHsKICAgICAgICAgIHVybDogaXRlbS51cmwsCiAgICAgICAgICBuYW1lOiBleHQudG9VcHBlckNhc2UoKSwKICAgICAgICAgIHN1Ym5hbWU6IGl0ZW0ucXVhbGl0eS50b1VwcGVyQ2FzZSgpLAogICAgICAgICAgdHlwZTogZXh0LnRvTG93ZXJDYXNlKCkKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBvYmo7CiAgICB9LAoKICAgIF9nZXRWS0xpbmtzOiBmdW5jdGlvbih2aWRlb0lkLCBjYWxsYmFjaykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgbGlua3MgPSBbXSwKICAgICAgICB0aXRsZSA9IHZpZGVvSWQsCiAgICAgICAgZGF0YSA9IG51bGwsCiAgICAgICAgZW1iZWQgPSBudWxsLAogICAgICAgIHRodW1iID0gJycsCiAgICAgICAgZHVyYXRpb24gPSAnJzsKCiAgICAgIHZhciB2aWQgPSB2aWRlb0lkOwoKICAgICAgdmFyIG0gPSBudWxsOwogICAgICB2YXIgb2lkID0gbnVsbDsKICAgICAgdmFyIGlkID0gbnVsbDsKCiAgICAgIHZhciByZSA9IC9edmlkZW8oLT9cZCspXyhcZCspL2k7CgogICAgICBpZiAoIXJlLnRlc3QodmlkKSkgewogICAgICAgIHZhciBvaWRSZSA9IC8oPzpefCYpb2lkPSgtP1xkKykvaTsKICAgICAgICB2YXIgaWRSZSA9IC8oPzpefCYpaWQ9KC0/XGQrKS9pOwoKICAgICAgICBtID0gdmlkLm1hdGNoKG9pZFJlKTsKICAgICAgICBvaWQgPSBtICYmIHBhcnNlSW50KG1bMV0pOwoKICAgICAgICBtID0gdmlkLm1hdGNoKGlkUmUpOwogICAgICAgIGlkID0gbSAmJiBwYXJzZUludChtWzFdKTsKCiAgICAgICAgdmlkID0gJyc7CiAgICAgICAgaWYgKG9pZCAmJiBpZCkgewogICAgICAgICAgdmlkID0gJ3ZpZGVvJyArIG9pZCArICdfJyArIGlkOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBtID0gdmlkLm1hdGNoKHJlKTsKICAgICAgICBvaWQgPSBwYXJzZUludChtWzFdKTsKICAgICAgICBpZCA9IHBhcnNlSW50KG1bMl0pOwogICAgICB9CgogICAgICBpZiAoIXZpZCkgewogICAgICAgIHJldHVybiBjYWxsYmFjayh2aWQsIGxpbmtzLCB0aXRsZSk7CiAgICAgIH0KCiAgICAgIHRpdGxlID0gdmlkOwoKICAgICAgcmV0dXJuIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiAnaHR0cHM6Ly92ay5jb20vJyArIHZpZAogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKGVyciB8fCAhcmVzcG9uc2UpIHsKICAgICAgICAgIHJldHVybiBjYWxsYmFjayh2aWQsIGxpbmtzLCB0aXRsZSwgZHVyYXRpb24sIHRodW1iLCBkYXRhLCBlbWJlZCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmFyc0pzb24gPSBudWxsOwogICAgICAgIG1vbm8uZmluZEpzb25TdHJpbmcocmVzcG9uc2UsIC92YXJzXHMqPVxzKi8pLnNvbWUoZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICByZXR1cm4gbW9uby5maW5kSnNvbihzdHIsIFsvInZpZCI6LywgLyJvaWQiOi8sIC8ibWRfdGl0bGUiOi9dKS5zb21lKGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICBpZiAob2JqLnZpZCA9PT0gaWQgJiYgb2JqLm9pZCA9PT0gb2lkKSB7CiAgICAgICAgICAgICAgdmFyc0pzb24gPSBvYmo7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICBpZiAodmFyc0pzb24pIHsKICAgICAgICAgIHZhciB2aWRlb0luZm8gPSB2a29udGFrdGVfcnVfZW1iZWQuZ2V0VmtMaW5rc0Zyb21Kc29uKHZhcnNKc29uKTsKCiAgICAgICAgICBsaW5rcyA9IHZpZGVvSW5mby5saW5rczsKICAgICAgICAgIHRpdGxlID0gdmlkZW9JbmZvLnRpdGxlOwogICAgICAgICAgdGh1bWIgPSB2aWRlb0luZm8udGh1bWI7CiAgICAgICAgICBkdXJhdGlvbiA9IHZpZGVvSW5mby5kdXJhdGlvbjsKCiAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodmlkLCBsaW5rcywgdGl0bGUsIGR1cmF0aW9uLCB0aHVtYiwgdmFyc0pzb24sIGVtYmVkKTsKICAgICAgICB9CgogICAgICAgIHZhciBhc3luYyA9IGZhbHNlOwogICAgICAgIG1vbm8uZmluZEpzb25TdHJpbmcocmVzcG9uc2UsIC92aWRlb19ib3hfd3JhcC8pLnNvbWUoZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICB2YXIgbTsKICAgICAgICAgIGlmICgvPGlmcmFtZVtePl0rPi9pLnRlc3Qoc3RyKSkgewogICAgICAgICAgICBtID0gc3RyLm1hdGNoKC95b3V0dWJlLmNvbVxcP1wvZW1iZWRcXD9cLyhbXHdcLV0rKS9pKTsKICAgICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgICBlbWJlZCA9IHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldFlvdXR1YmVMaW5rcycsCiAgICAgICAgICAgICAgICBleHRWaWRlb0lkOiBtWzFdCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtID0gc3RyLm1hdGNoKC92aW1lby5jb21cXD9cL3ZpZGVvXFw/XC8oXGQrKS9pKTsKICAgICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgICBlbWJlZCA9IHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldFZpbWVvTGlua3MnLAogICAgICAgICAgICAgICAgZXh0VmlkZW9JZDogbVsxXQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbSA9IHN0ci5tYXRjaCgvc3JjPSIoW14iXSpwbGFkZm9ybVwucnVbXiJdKykiL2kpOwogICAgICAgICAgICBpZiAobSkgewogICAgICAgICAgICAgIGFzeW5jID0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gbW9uby5wYXJzZVVybChtWzFdKTsKICAgICAgICAgICAgICBlbmdpbmUubW9kdWxlcy5vZG5va2xhc3NuaWtpLmdldFBsYWRmb3JtVmlkZW8oewogICAgICAgICAgICAgICAgZXh0VmlkZW9JZDogewogICAgICAgICAgICAgICAgICBwbGF5ZXJJZDogcGFyYW1zLnBsLAogICAgICAgICAgICAgICAgICB2aWRlb0lkOiBwYXJhbXMudmlkZW9pZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuYWN0aW9uID09PSAnZ2V0UnV0dWJlTGlua3MnKSB7CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmxpbmtzID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgcGxhZGZvcm1MaW5rcyA9IHJlc3BvbnNlICYmIHJlc3BvbnNlLmxpbmtzOwogICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBsYWRmb3JtTGlua3MpKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh2aWQsIGxpbmtzLCB0aXRsZSwgZHVyYXRpb24sIHRodW1iLCBkYXRhLCBlbWJlZCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIHZpZGVvSW5mbyA9IHZrb250YWt0ZV9ydV9lbWJlZC5wcmVwYXJlUGxhZGZvcm1MaW5rcyhwbGFkZm9ybUxpbmtzKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodmlkLCB2aWRlb0luZm8ubGlua3MsIHZpZGVvSW5mby50aXRsZSwgdmlkZW9JbmZvLmR1cmF0aW9uLCB2aWRlb0luZm8udGh1bWIsIGRhdGEsIGVtYmVkKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKC92YXJcc29wdHNccyo9XHMqLy50ZXN0KHN0cikpIHsKICAgICAgICAgICAgbSA9IHN0ci5tYXRjaCgvdXJsOlxzKicoPzpbXiddKylkYWlseW1vdGlvbi5jb21cLyg/OnN3ZlwvKT92aWRlb1wvKFtcd1xkXSspLyk7CiAgICAgICAgICAgIGlmIChtKSB7CiAgICAgICAgICAgICAgZW1iZWQgPSB7CiAgICAgICAgICAgICAgICBhY3Rpb246ICdnZXREYWlseW1vdGlvbkxpbmtzJywKICAgICAgICAgICAgICAgIGV4dFZpZGVvSWQ6IG1bMV0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiAhYXN5bmMgJiYgY2FsbGJhY2sodmlkLCBsaW5rcywgdGl0bGUsIGR1cmF0aW9uLCB0aHVtYiwgZGF0YSwgZW1iZWQpOwogICAgICB9KTsKICAgIH0sCgogICAgY2hlY2tWa0xpbmtzOiBmdW5jdGlvbihsaW5rcywgY2FsbGJhY2spIHsKICAgICAgdmFyIGNoZWNrVXJsID0gJyc7CgogICAgICBpZiAobGlua3MgJiYgbGlua3MubGVuZ3RoID4gMCkgewogICAgICAgIGlmIChsaW5rc1swXS50eXBlID09ICdtcDQnKQogICAgICAgICAgY2hlY2tVcmwgPSBsaW5rc1swXS51cmw7CiAgICAgICAgZWxzZSBpZiAobGlua3MubGVuZ3RoID4gMSkKICAgICAgICAgIGNoZWNrVXJsID0gbGlua3NbMV0udXJsOwogICAgICAgIGVsc2UKICAgICAgICAgIGNoZWNrVXJsID0gbGlua3NbMF0udXJsOwogICAgICB9CgogICAgICBpZiAoY2hlY2tVcmwpIHsKICAgICAgICBtb25vLnJlcXVlc3QoewogICAgICAgICAgdXJsOiBjaGVja1VybCwKICAgICAgICAgIHR5cGU6ICdIRUFEJwogICAgICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcCkgewogICAgICAgICAgY2FsbGJhY2soY2hlY2tVcmwsICFlcnIpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY2FsbGJhY2soKTsKICAgIH0sCgogICAgZ2V0VmtMaW5rc0Zyb21Kc29uTXNnOiBmdW5jdGlvbihtc2csIHJlc3BvbnNlKSB7CiAgICAgIHZhciBpbmZvID0gdGhpcy5nZXRWa0xpbmtzRnJvbUpzb24obXNnLmpzb24pOwogICAgICByZXR1cm4gcmVzcG9uc2UoaW5mbyk7CiAgICB9LAoKICAgIGdldFZrTGlua3NGcm9tSnNvbjogZnVuY3Rpb24oanNvbikgewogICAgICB2YXIgbGlua3MgPSBbXTsKICAgICAgdmFyIHZpZCA9IGpzb24udmlkOwogICAgICB2YXIgdGl0bGUgPSBqc29uLm1kX3RpdGxlIHx8IGpzb24udmlkOwogICAgICB2YXIgdGh1bWIgPSAnJzsKCiAgICAgIGlmIChqc29uLnRodW1iKSB7CiAgICAgICAgdGh1bWIgPSBqc29uLnRodW1iOwogICAgICB9IGVsc2UKICAgICAgaWYgKGpzb24uanBnKSB7CiAgICAgICAgdGh1bWIgPSBqc29uLmpwZzsKICAgICAgfQoKICAgICAgdmFyIHZpZGVvVXJsUmVnRXhwID0gL3VybChbMC05XSspLzsKICAgICAgT2JqZWN0LmtleXMoanNvbikuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICB2YXIgcXVhbGl0eSA9IGtleS5tYXRjaCh2aWRlb1VybFJlZ0V4cCk7CiAgICAgICAgcXVhbGl0eSA9IHF1YWxpdHkgJiYgcXVhbGl0eVsxXTsKICAgICAgICBpZiAocXVhbGl0eSA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgdXJsID0ganNvbltrZXldOwogICAgICAgIHZhciB0eXBlID0gJ2Zsdic7CiAgICAgICAgaWYgKGpzb24ubm9fZmx2ID09PSAxKSB7CiAgICAgICAgICB0eXBlID0gJ21wNCc7CiAgICAgICAgfQoKICAgICAgICBsaW5rcy5wdXNoKHsKICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgc3VibmFtZTogcXVhbGl0eSwKICAgICAgICAgIG5hbWU6IHR5cGUudG9VcHBlckNhc2UoKSwKICAgICAgICAgIHR5cGU6IHR5cGUKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICB2YXIgZHVyYXRpb24gPSBqc29uLmR1cmF0aW9uOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBhY3Rpb246ICdnZXRWS0xpbmtzJywKICAgICAgICBleHRWaWRlb0lkOiB2aWQsCiAgICAgICAgbGlua3M6IGxpbmtzLAogICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sCiAgICAgICAgdGh1bWI6IHRodW1iLAogICAgICAgIGRhdGE6IGpzb24sCiAgICAgICAgY2hlY2tMaW5rczogbnVsbAogICAgICB9OwogICAgfSwKCiAgICBnZXRWa0xpbmtzRnJvbURhdGE6IGZ1bmN0aW9uKHJlcXVlc3QsIGNiKSB7CiAgICAgIHZhciByZXNwb25zZSA9IHJlcXVlc3QuZGF0YTsKCiAgICAgIHZhciB2YXJzSnNvbiA9IG51bGw7CiAgICAgIG1vbm8uZmluZEpzb24ocmVzcG9uc2UsIFsvInZpZCI6LywgLyJvaWQiOi8sIC8ibWRfdGl0bGUiOi9dKS5zb21lKGZ1bmN0aW9uKG9iaikgewogICAgICAgIHZhcnNKc29uID0gb2JqOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KTsKCiAgICAgIGlmICghdmFyc0pzb24pIHsKICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgfQoKICAgICAgdmFyIGluZm8gPSB2a29udGFrdGVfcnVfZW1iZWQuZ2V0VmtMaW5rc0Zyb21Kc29uKHZhcnNKc29uKTsKCiAgICAgIHJldHVybiBjYihpbmZvKTsKICAgIH0KICB9OwogIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgewogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24oX21vbm8sIF9lbmdpbmUpIHsKICAgICAgbW9ubyA9IF9tb25vOwogICAgICBlbmdpbmUgPSBfZW5naW5lOwogICAgICByZXR1cm4gdmtvbnRha3RlX3J1X2VtYmVkOwogICAgfTsKICB9IGVsc2UgewogICAgZW5naW5lLm1vZHVsZXMudmtvbnRha3RlID0gdmtvbnRha3RlX3J1X2VtYmVkOwogIH0KICB2YXIgeW91dHViZV9jb21fZW1iZWQgPSB7CiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGxhc3RTdHM6IFsiMTcwMzAiLCBbCiAgICAgIFsicmV2ZXJzZSIsIG51bGxdLAogICAgICBbInNwbGljZSIsIDJdLAogICAgICBbInN3YXAiLCAxN10sCiAgICAgIFsicmV2ZXJzZSIsIG51bGxdLAogICAgICBbInN3YXAiLCAxXSwKICAgICAgWyJzcGxpY2UiLCAxXQogICAgXV0sCiAgICAvKioKICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgKiBAcHJvcGVydHkge051bWJlcn0gc3RzCiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gdXJsCiAgICAgKiBAcHJvcGVydHkge0FycmF5fSBhY3RMaXN0CiAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IHRydXN0CiAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IGludmFsaWQKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGN1cnJlbnRTdHM6IHVuZGVmaW5lZCwKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgaXNUcmFja0Vycm9yOiB7fSwKICAgIGdldFlvdXR1YmVMaW5rczogZnVuY3Rpb24ocmVxdWVzdCwgY2FsbGJhY2spIHsKICAgICAgZnVuY3Rpb24gY2FsbGJhY2tfbGlua3MobGlua3MsIHRpdGxlLCBzdWJ0aXRsZXMsIGR1cmF0aW9uKSB7CiAgICAgICAgeW91dHViZV9jb21fZW1iZWQuYWRkVW1teUxpbmtzKGxpbmtzLCByZXF1ZXN0LmV4dFZpZGVvSWQpOwogICAgICAgIHlvdXR1YmVfY29tX2VtYmVkLmFkZENvbnZlcnRlckxpbmtzKGxpbmtzLCB0aXRsZSk7CgogICAgICAgIHZhciByZXNwb25zZSA9IHsKICAgICAgICAgIGFjdGlvbjogcmVxdWVzdC5hY3Rpb24sCiAgICAgICAgICBleHRWaWRlb0lkOiByZXF1ZXN0LmV4dFZpZGVvSWQsCiAgICAgICAgICBsaW5rczogbGlua3MsCiAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICBzdWJ0aXRsZXM6IHN1YnRpdGxlcywKICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbiwKICAgICAgICAgIGNoZWNrTGlua3M6IG51bGwKICAgICAgICB9OwoKICAgICAgICBpZiAocmVxdWVzdC5jaGVja0xpbmtzICYmIGxpbmtzKSB7CiAgICAgICAgICByZXR1cm4geW91dHViZV9jb21fZW1iZWQuY2hlY2tZb3V0dWJlTGlua3MobGlua3MsIGZ1bmN0aW9uKGNoZWNrVXJsLCBpc1ZhbGlkKSB7CiAgICAgICAgICAgIHJlc3BvbnNlLmNoZWNrTGlua3MgPSBpc1ZhbGlkOwogICAgICAgICAgICByZXR1cm4gY2FsbGJhY2socmVzcG9uc2UpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2FsbGJhY2socmVzcG9uc2UpOwogICAgICB9CgogICAgICByZXR1cm4geW91dHViZV9jb21fZW1iZWQucHJlcGFyZUxhc3RTdHMoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHlvdXR1YmVfY29tX2VtYmVkLl9fZ2V0WW91dHViZUxpbmtzKHJlcXVlc3QudXJsLCByZXF1ZXN0LmV4dFZpZGVvSWQsIHJlcXVlc3QuY2hlY2tTdWJ0aXRsZXMsIGNhbGxiYWNrX2xpbmtzLCByZXF1ZXN0Lm5vRGFzaCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIHByZXBhcmVEZWNoaXBlcjogZnVuY3Rpb24odGVzdEl0ZW0sIGN1cnJlbnRTdHMsIGNiKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIHNpZ1VybCA9IGN1cnJlbnRTdHMudXJsLm1hdGNoKC9cLyg/OlteXC9dKyk/cGxheWVyLShbXlwvXSspXC8vKTsKICAgICAgc2lnVXJsID0gc2lnVXJsICYmIHNpZ1VybFsxXTsKICAgICAgaWYgKCFzaWdVcmwpIHsKICAgICAgICBzaWdVcmwgPSAndW5rbm93blBsYXllck5hbWUnOwogICAgICB9CiAgICAgIHRoaXMueXRIdG1sNVNpZ0RlY2lwaGVyLmRlY2hpcCh7CiAgICAgICAgc3RzOiBjdXJyZW50U3RzLnN0cywKICAgICAgICB1cmw6IGN1cnJlbnRTdHMudXJsCiAgICAgIH0sIGZ1bmN0aW9uKGFjdExpc3QsIHN0cywgdHJ1c3QpIHsKICAgICAgICBpZiAoIWFjdExpc3QpIHsKICAgICAgICAgIGlmICghX3RoaXMuaXNUcmFja0Vycm9yW3NpZ1VybF0pIHsKICAgICAgICAgICAgX3RoaXMuaXNUcmFja0Vycm9yW3NpZ1VybF0gPSAxOwogICAgICAgICAgICBzaWdVcmwgJiYgY3VycmVudFN0cy5zdHMgJiYgZW5naW5lLnRyYWNrKHsKICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgIGVjOiAneW91dHViZScsCiAgICAgICAgICAgICAgZWE6ICdwRXJyb3InLAogICAgICAgICAgICAgIGVsOiBjdXJyZW50U3RzLnN0cyArICcgJyArIHNpZ1VybAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRTdHMuaW52YWxpZCA9IHRydWU7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIGN1cnJlbnRTdHMuYWN0TGlzdCA9IGFjdExpc3Q7CiAgICAgICAgY3VycmVudFN0cy50cnVzdCA9ICEhdHJ1c3Q7CgogICAgICAgIGlmICghY3VycmVudFN0cy5zdHMgJiYgc3RzKSB7CiAgICAgICAgICBjdXJyZW50U3RzLnN0cyA9IHN0czsKICAgICAgICB9CgogICAgICAgIGlmICghdHJ1c3QpIHsKICAgICAgICAgIHZhciB1cmwgPSB0ZXN0SXRlbS51cmw7CiAgICAgICAgICB2YXIgc2lnbmF0dXJlID0geW91dHViZV9jb21fZW1iZWQueXRSdW5BY3RMaXN0KGN1cnJlbnRTdHMuYWN0TGlzdCwgdGVzdEl0ZW0ucyk7CiAgICAgICAgICBpZiAodGVzdEl0ZW0uZ2V0VXJsKSB7CiAgICAgICAgICAgIHVybCA9IHRlc3RJdGVtLmdldFVybChzaWduYXR1cmUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdXJsICs9ICcmc2lnbmF0dXJlPScgKyBzaWduYXR1cmU7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMueXRIdG1sNVNpZ0RlY2lwaGVyLmNoZWNrQWN0TGlzdChjdXJyZW50U3RzLnN0cywgY3VycmVudFN0cy5hY3RMaXN0LCB1cmwsIGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICBjdXJyZW50U3RzLnRydXN0ID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjdXJyZW50U3RzLmludmFsaWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNiKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2IoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIG5lZWREZWNoaXBlcjogZnVuY3Rpb24oY29uZmlnKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIG5lZWREZWNoaXBlciA9IGZhbHNlOwogICAgICBbJ3VybF9lbmNvZGVkX2ZtdF9zdHJlYW1fbWFwJywgJ2FkYXB0aXZlX2ZtdHMnLCAnZm10X3VybF9tYXAnXS5zb21lKGZ1bmN0aW9uKGtleSkgewogICAgICAgIHZhciBpdGVtID0gY29uZmlnW2tleV07CiAgICAgICAgaWYgKCFpdGVtKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGl0ZW0uc29tZShmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICBpZiAoaXRlbS5zICYmIGl0ZW0udXJsKSB7CiAgICAgICAgICAgIG5lZWREZWNoaXBlciA9IGl0ZW07CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAobmVlZERlY2hpcGVyKSB7CiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKCFuZWVkRGVjaGlwZXIgJiYgY29uZmlnLmRhc2htcGQpIHsKICAgICAgICB2YXIgcyA9IGNvbmZpZy5kYXNobXBkLm1hdGNoKHlvdXR1YmVfY29tX2VtYmVkLmRhc2hNcGRTaWdSKTsKICAgICAgICBpZiAocykgewogICAgICAgICAgbmVlZERlY2hpcGVyID0gewogICAgICAgICAgICBzOiBzWzJdLAogICAgICAgICAgICB1cmw6IGNvbmZpZy5kYXNobXBkLnJlcGxhY2Uoc1sxXSwgJycpLAogICAgICAgICAgICBnZXRVcmw6IGZ1bmN0aW9uKHVybCwgcywgc2lnbmF0dXJlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHVybC5yZXBsYWNlKHNbMV0sICcvc2lnbmF0dXJlLycgKyBzaWduYXR1cmUpOwogICAgICAgICAgICB9LmJpbmQobnVsbCwgY29uZmlnLmRhc2htcGQsIHMpCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5lZWREZWNoaXBlcjsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICB2aWRlb0luZm9Ub09iajogZnVuY3Rpb24oZGF0YSwgaXNPYmopIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgZGVjb2RlUGFyYW1zID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIFsndXJsX2VuY29kZWRfZm10X3N0cmVhbV9tYXAnLCAnYWRhcHRpdmVfZm10cycsICdmbXRfdXJsX21hcCddLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICBpZiAoZGF0YVtrZXldKSB7CiAgICAgICAgICAgIGRhdGFba2V5XSA9IGRhdGFba2V5XS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRhdGFTdHJUb09iaihpdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIHZhciBkYXRhU3RyVG9PYmogPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgZGF0YSA9IG1vbm8ucGFyc2VVcmwoZGF0YSwgewogICAgICAgICAgcGFyYW1zOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgZGVjb2RlUGFyYW1zKGRhdGEpOwogICAgICAgIHJldHVybiBkYXRhOwogICAgICB9OwoKICAgICAgdmFyIGNvbmZpZyA9IGRhdGE7CiAgICAgIGlmIChpc09iaikgewogICAgICAgIGRlY29kZVBhcmFtcyhjb25maWcpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbmZpZyA9IGRhdGFTdHJUb09iaihkYXRhKTsKICAgICAgfQogICAgICByZXR1cm4gY29uZmlnOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGV4cEN1cnJlbnRTdHM6IGZ1bmN0aW9uKCkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBub3cgPSBwYXJzZUludChEYXRlLm5vdygpIC8gMTAwMCk7CgogICAgICBpZiAodGhpcy5jdXJyZW50U3RzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5jdXJyZW50U3RzLmV4cGlyZSkgewogICAgICAgIHRoaXMuY3VycmVudFN0cy5leHBpcmUgPSBub3cgKyAyMTYwMDsKICAgICAgfSBlbHNlCiAgICAgIGlmICh0aGlzLmN1cnJlbnRTdHMuZXhwaXJlIDwgbm93KSB7CiAgICAgICAgdGhpcy5jdXJyZW50U3RzID0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgZ2V0WXRDb25maWc6IGZ1bmN0aW9uKHZpZGVvSWQsIGV1cmwsIGNiLCBpbmRleCwgdXNlRGVmYXVsdFN0cykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICghaW5kZXgpIHsKICAgICAgICBpbmRleCA9IDA7CiAgICAgIH0KCiAgICAgIHZhciBzdGF0ZU1hcCA9IHsKICAgICAgICAwOiAnbmNJbmZvJywKICAgICAgICAxOiAnbmNJbmZvJywKICAgICAgICAyOiAnaW5mbycsCiAgICAgICAgMzogJ2luZm8nLAogICAgICAgIDQ6ICdqc29uUGFnZScsCiAgICAgICAgNTogJ3BhZ2UnCiAgICAgIH07CiAgICAgIHZhciBzdGF0ZSA9IHN0YXRlTWFwW2luZGV4XTsKCiAgICAgIHRoaXMuZXhwQ3VycmVudFN0cygpOwoKICAgICAgaWYgKHVzZURlZmF1bHRTdHMpIHsKICAgICAgICB0aGlzLmN1cnJlbnRTdHMgPSB7CiAgICAgICAgICBzdHM6IHBhcnNlSW50KHRoaXMubGFzdFN0c1swXSksCiAgICAgICAgICBhY3RMaXN0OiB0aGlzLmxhc3RTdHNbMV0KICAgICAgICB9OwogICAgICAgIHRoaXMuZXhwQ3VycmVudFN0cygpOwogICAgICB9IGVsc2UKICAgICAgaWYgKHRoaXMuY3VycmVudFN0cyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudFN0cyhmdW5jdGlvbihvYmopIHsKICAgICAgICAgIF90aGlzLmN1cnJlbnRTdHMgPSBvYmogfHwgewogICAgICAgICAgICBzdHM6IHBhcnNlSW50KF90aGlzLmxhc3RTdHNbMF0pLAogICAgICAgICAgICBhY3RMaXN0OiBfdGhpcy5sYXN0U3RzWzFdLAogICAgICAgICAgICB0cnVzdDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICAgIF90aGlzLmV4cEN1cnJlbnRTdHMoKTsKICAgICAgICAgIF90aGlzLmdldFl0Q29uZmlnKHZpZGVvSWQsIGV1cmwsIGNiLCBpbmRleCwgdXNlRGVmYXVsdFN0cyk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBjdXJyZW50U3RzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmN1cnJlbnRTdHMpKTsKCiAgICAgIHZhciB1cmwsIHBhcmFtczsKICAgICAgaWYgKFsnbmNJbmZvJywgJ2luZm8nXS5pbmRleE9mKHN0YXRlKSAhPT0gLTEpIHsKICAgICAgICB2YXIgZG9tYWluID0gbnVsbDsKICAgICAgICBpZiAoc3RhdGUgPT09ICduY0luZm8nKSB7CiAgICAgICAgICBkb21haW4gPSAnd3d3LnlvdXR1YmUtbm9jb29raWUuY29tJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZG9tYWluID0gJ3d3dy55b3V0dWJlLmNvbSc7CiAgICAgICAgfQoKICAgICAgICB2YXIgZWwgPSBudWxsOwogICAgICAgIGlmIChbMCwgMl0uaW5kZXhPZihpbmRleCkgIT09IC0xKSB7CiAgICAgICAgICBlbCA9ICdkZXRhaWxwYWdlJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWwgPSAnaW5mbyc7CiAgICAgICAgfQoKICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICB2aWRlb19pZDogdmlkZW9JZCwKICAgICAgICAgIGV1cmw6IGV1cmwsCiAgICAgICAgICBlbDogZWwsCiAgICAgICAgICBzdHM6IGN1cnJlbnRTdHMuc3RzCiAgICAgICAgfTsKICAgICAgICB1cmwgPSAnaHR0cHM6Ly8nICsgZG9tYWluICsgJy9nZXRfdmlkZW9faW5mbz8nICsgbW9uby5wYXJhbShwYXJhbXMpOwogICAgICB9IGVsc2UKICAgICAgaWYgKHN0YXRlID09PSAnanNvblBhZ2UnKSB7CiAgICAgICAgdXJsID0gJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoPycgKyBtb25vLnBhcmFtKHsKICAgICAgICAgIHY6IHZpZGVvSWQsCiAgICAgICAgICBzcGY6ICduYXZpZ2F0ZScKICAgICAgICB9KTsKICAgICAgfSBlbHNlCiAgICAgIGlmIChzdGF0ZSA9PT0gJ3BhZ2UnKSB7CiAgICAgICAgdXJsID0gJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoPycgKyBtb25vLnBhcmFtKHsKICAgICAgICAgIHY6IHZpZGVvSWQKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgfQoKICAgICAgdmFyIGFib3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMuZ2V0WXRDb25maWcodmlkZW9JZCwgZXVybCwgY2IsICsraW5kZXgsIHVzZURlZmF1bHRTdHMpOwogICAgICB9OwoKICAgICAgcmV0dXJuIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiB1cmwKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgaWYgKGVyciB8fCAhZGF0YSkgewogICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgfQoKICAgICAgICB2YXIganNvbkxpc3QgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIGNvbmZpZzsKICAgICAgICBpZiAoWyduY0luZm8nLCAnaW5mbyddLmluZGV4T2Yoc3RhdGUpICE9PSAtMSkgewogICAgICAgICAgY29uZmlnID0gX3RoaXMudmlkZW9JbmZvVG9PYmooZGF0YSk7CgogICAgICAgICAgaWYgKHN0YXRlID09PSAnbmNJbmZvJykgewogICAgICAgICAgICBpZiAoY29uZmlnLnJlcXVpcmVzX3B1cmNoYXNlID09PSAnMScgfHwKICAgICAgICAgICAgICBjb25maWcudXJsX2VuY29kZWRfZm10X3N0cmVhbV9tYXAgPT09ICcnIHx8CiAgICAgICAgICAgICAgY29uZmlnLmZtdF91cmxfbWFwID09PSAnJyB8fAogICAgICAgICAgICAgIGNvbmZpZy5hZGFwdGl2ZV9mbXRzID09PSAnJyB8fAogICAgICAgICAgICAgIGNvbmZpZy5lcnJvcmNvZGUgPiAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UKICAgICAgICBpZiAoc3RhdGUgPT09ICdqc29uUGFnZScpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpOwogICAgICAgICAgICBkYXRhLnNvbWUoZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgIGlmIChpdGVtLmRhdGEgJiYgKGpzb25MaXN0ID0gaXRlbS5kYXRhLnN3ZmNmZykpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmICghanNvbkxpc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHNjcmlwdCA9IG1vbm8uZ2V0UGFnZVNjcmlwdChkYXRhLCAveXRwbGF5ZXJcLmNvbmZpZ1xzKz1ccysvKTsKICAgICAgICAgIGlmICghc2NyaXB0Lmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHNjcmlwdCA9IHNjcmlwdFswXTsKCiAgICAgICAgICBqc29uTGlzdCA9IG1vbm8uZmluZEpzb24oc2NyaXB0LCBbLyJ2aWRlb19pZCI6L10pOwogICAgICAgICAgaWYgKCFqc29uTGlzdC5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBqc29uTGlzdCA9IGpzb25MaXN0WzBdOwogICAgICAgIH0KICAgICAgICBpZiAoWydqc29uUGFnZScsICdwYWdlJ10uaW5kZXhPZihzdGF0ZSkgIT09IC0xKSB7CiAgICAgICAgICBpZiAoIWpzb25MaXN0LmFyZ3MgfHwgdHlwZW9mIGpzb25MaXN0LmFyZ3MgIT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIHJldHVybiBhYm9ydCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqc29uTGlzdC5hc3NldHMgJiYganNvbkxpc3QuYXNzZXRzLmpzKSB7CiAgICAgICAgICAgIGN1cnJlbnRTdHMgPSB7CiAgICAgICAgICAgICAgc3RzOiBqc29uTGlzdC5zdHMsCiAgICAgICAgICAgICAgdXJsOiBqc29uTGlzdC5hc3NldHMuanMKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25maWcgPSBfdGhpcy52aWRlb0luZm9Ub09iaihqc29uTGlzdC5hcmdzLCAxKTsKICAgICAgICB9CgogICAgICAgIHZhciB0ZXN0SXRlbTsKICAgICAgICBpZiAoIWN1cnJlbnRTdHMuYWN0TGlzdCAmJiAodGVzdEl0ZW0gPSBfdGhpcy5uZWVkRGVjaGlwZXIoY29uZmlnKSkpIHsKICAgICAgICAgIF90aGlzLnByZXBhcmVEZWNoaXBlcih0ZXN0SXRlbSwgY3VycmVudFN0cywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50U3RzLmludmFsaWQpIHsKICAgICAgICAgICAgICBpZiAoc3RhdGUgIT09ICdwYWdlJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09ICdwYWdlJyAmJiAhdXNlRGVmYXVsdFN0cykgewogICAgICAgICAgICAgICAgdXNlRGVmYXVsdFN0cyA9IDE7CiAgICAgICAgICAgICAgICBpbmRleCA9IC0xOwogICAgICAgICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjYihjb25maWcsIGN1cnJlbnRTdHMpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNiKGNvbmZpZywgY3VycmVudFN0cyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICByZWFkRm10OiBmdW5jdGlvbihsaW5rcywgbWV0YSwgZm10LCBjdXJyZW50U3RzLCB0aXRsZVBhcmFtKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZm10LmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgIGlmIChpdGVtLnN0cmVhbSkgewogICAgICAgICAgbWV0YS5oYXNTdHJlYW0gPSAxOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpdGVtLnVybCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHVybCA9IGl0ZW0udXJsOwogICAgICAgIGlmICghLyhcP3wmKXMoaWcobmF0dXJlKT8pPz0vaS50ZXN0KHVybCkpIHsKICAgICAgICAgIGlmIChpdGVtLnNpZykgewogICAgICAgICAgICB1cmwgKz0gJyZzaWduYXR1cmU9JyArIGl0ZW0uc2lnOwogICAgICAgICAgfSBlbHNlCiAgICAgICAgICBpZiAoaXRlbS5zaWduYXR1cmUpIHsKICAgICAgICAgICAgdXJsICs9ICcmc2lnbmF0dXJlPScgKyBpdGVtLnNpZ25hdHVyZTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKGl0ZW0ucykgewogICAgICAgICAgICBpZiAoY3VycmVudFN0cy5pbnZhbGlkKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignU3RzIGlzIGludmFsaWQhJywgY3VycmVudFN0cyk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghY3VycmVudFN0cy5hY3RMaXN0KSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignU3RzIGFjdExpc3QgaXMgbm90IGZvdW5kIScsIGN1cnJlbnRTdHMpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cmwgKz0gJyZzaWduYXR1cmU9JyArIHlvdXR1YmVfY29tX2VtYmVkLnl0UnVuQWN0TGlzdChjdXJyZW50U3RzLmFjdExpc3QsIGl0ZW0ucyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaXRlbS5pdGFnICYmICEvKFw/fCYpaXRhZz0vaS50ZXN0KHVybCkpIHsKICAgICAgICAgIHVybCArPSAnJml0YWc9JyArIGl0ZW0uaXRhZzsKICAgICAgICB9CgogICAgICAgIHVybCA9IHVybC5yZXBsYWNlKC8oXD98JilzaWc9L2ksICckMXNpZ25hdHVyZT0nKS5yZXBsYWNlKC9cXHUwMDI2L2lnLCAnJicpOwoKICAgICAgICB2YXIgaXRhZyA9IHVybC5tYXRjaCgvKD86XD98JilpdGFnPShcZCspL2kpOwogICAgICAgIGl0YWcgPSBpdGFnICYmIGl0YWdbMV07CiAgICAgICAgaWYgKCFpdGFnKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIW1ldGFbaXRhZ10pIHsKICAgICAgICAgIG1ldGFbaXRhZ10gPSB7fTsKICAgICAgICB9CgogICAgICAgIGlmIChpdGVtLmZwcykgewogICAgICAgICAgbWV0YVtpdGFnXS5mcHMgPSBpdGVtLmZwczsKICAgICAgICB9CgogICAgICAgIGlmIChpdGVtLnNpemUgJiYgL15cZCt4XGQrJC8udGVzdChpdGVtLnNpemUpKSB7CiAgICAgICAgICB2YXIgd2ggPSBpdGVtLnNpemUuc3BsaXQoJ3gnKTsKICAgICAgICAgIG1ldGFbaXRhZ10ucXVhbGl0eSA9IHlvdXR1YmVfY29tX2VtYmVkLmdldERhc2hRdWFsaXR5KHdoWzBdLCB3aFsxXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXRlbS5iaXRyYXRlKSB7CiAgICAgICAgICBtZXRhW2l0YWddLmJpdHJhdGUgPSBwYXJzZUludChpdGVtLmJpdHJhdGUpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGl0ZW0udHlwZSkgewogICAgICAgICAgbWV0YVtpdGFnXS50eXBlID0gaXRlbS50eXBlOwogICAgICAgICAgdmFyIGNvZGVjcyA9IGl0ZW0udHlwZS5tYXRjaCgvY29kZWNzPSIoW14iXSspIi8pOwogICAgICAgICAgaWYgKGNvZGVjcykgewogICAgICAgICAgICBtZXRhW2l0YWddLmNvZGVjcyA9IGNvZGVjc1sxXTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChpdGVtLnByb2plY3Rpb25fdHlwZSkgewogICAgICAgICAgbWV0YVtpdGFnXS5wcm9qZWN0aW9uVHlwZSA9IHBhcnNlSW50KGl0ZW0ucHJvamVjdGlvbl90eXBlKTsKICAgICAgICB9CgogICAgICAgIGlmICghbGlua3NbaXRhZ10pIHsKICAgICAgICAgIGxpbmtzW2l0YWddID0gdXJsICsgdGl0bGVQYXJhbTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIG9uR2V0Q29uZmlnOiBmdW5jdGlvbih2aWRlb0lkLCBjaGVja1N1YnRpdGxlcywgY2IsIG5vRGFzaCwgY29uZmlnLCBjdXJyZW50U3RzKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGxpbmtzID0gbnVsbCwKICAgICAgICB0aXRsZSA9ICcnLAogICAgICAgIHN1YnRpdGxlcyA9IG51bGwsCiAgICAgICAgZHVyYXRpb24gPSAnJywKICAgICAgICBkYXNoVXJsID0gbnVsbDsKCiAgICAgIGlmICghY29uZmlnKSB7CiAgICAgICAgcmV0dXJuIGNiKGxpbmtzLCB0aXRsZSwgc3VidGl0bGVzLCBkdXJhdGlvbik7CiAgICAgIH0KCiAgICAgIGNiID0gZnVuY3Rpb24oY2IpIHsKICAgICAgICB2YXIgd2FpdCA9IDE7CiAgICAgICAgdmFyIHJlYWR5ID0gMDsKCiAgICAgICAgdmFyIG9uUmVhZHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJlYWR5Kys7CiAgICAgICAgICBpZiAocmVhZHkgIT09IHdhaXQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgY2IobGlua3MsIHRpdGxlLCBzdWJ0aXRsZXMsIGR1cmF0aW9uKTsKICAgICAgICB9OwoKICAgICAgICBpZiAoY2hlY2tTdWJ0aXRsZXMpIHsKICAgICAgICAgIHdhaXQrKzsKICAgICAgICAgIF90aGlzLmdldFlvdXR1YmVTdWJ0aXRsZXMoewogICAgICAgICAgICBleHRWaWRlb0lkOiB2aWRlb0lkCiAgICAgICAgICB9LCBmdW5jdGlvbihzdWJzKSB7CiAgICAgICAgICAgIHN1YnRpdGxlcyA9IHN1YnMgfHwgbnVsbDsKICAgICAgICAgICAgb25SZWFkeSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIW5vRGFzaCAmJiBkYXNoVXJsKSB7CiAgICAgICAgICB3YWl0Kys7CiAgICAgICAgICBpZiAoIWxpbmtzKSB7CiAgICAgICAgICAgIGxpbmtzID0ge307CiAgICAgICAgICB9CiAgICAgICAgICBfdGhpcy5nZXRZb3VUdWJlRGFzaExpbmtzKGxpbmtzLCBkYXNoVXJsLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGxlbiA9IE9iamVjdC5rZXlzKGxpbmtzKS5sZW5ndGg7CiAgICAgICAgICAgIGlmIChsaW5rcy5tZXRhICYmICFsaW5rcy5tZXRhLmhhc1N0cmVhbSkgewogICAgICAgICAgICAgIGxlbi0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghbGVuKSB7CiAgICAgICAgICAgICAgbGlua3MgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9uUmVhZHkoKTsKICAgICAgICAgIH0sICFjdXJyZW50U3RzLmludmFsaWQgJiYgY3VycmVudFN0cy5hY3RMaXN0ICYmIGZ1bmN0aW9uKGFjdExpc3QsIHMpIHsKICAgICAgICAgICAgcmV0dXJuIHlvdXR1YmVfY29tX2VtYmVkLnl0UnVuQWN0TGlzdChhY3RMaXN0LCBzKTsKICAgICAgICAgIH0uYmluZCh0aGlzLCBjdXJyZW50U3RzLmFjdExpc3QpKTsKICAgICAgICB9CgogICAgICAgIG9uUmVhZHkoKTsKICAgICAgfS5iaW5kKHRoaXMsIGNiKTsKCiAgICAgIHZhciB0aXRsZVBhcmFtID0gJyc7CiAgICAgIHRpdGxlID0gY29uZmlnLnRpdGxlIHx8ICcnOwogICAgICBkdXJhdGlvbiA9IGNvbmZpZy5sZW5ndGhfc2Vjb25kcyB8fCAnJzsKICAgICAgZGFzaFVybCA9IGNvbmZpZy5kYXNobXBkIHx8ICcnOwoKICAgICAgaWYgKHRpdGxlKSB7CiAgICAgICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKC9cKy9nLCAnICcpOwogICAgICAgIHRpdGxlUGFyYW0gPSAnJnRpdGxlPScgKyBlbmNvZGVVUklDb21wb25lbnQobW9uby5maWxlTmFtZS5tb2RpZnkodGl0bGUpKTsKICAgICAgfQoKICAgICAgdmFyIGZtdE1hcCA9IGNvbmZpZy5mbXRfdXJsX21hcCB8fCBjb25maWcudXJsX2VuY29kZWRfZm10X3N0cmVhbV9tYXAgfHwgW107CiAgICAgIHZhciBhZGFwdGl2ZUZtdHMgPSBjb25maWcuYWRhcHRpdmVfZm10cyB8fCBbXTsKCiAgICAgIHZhciBtZXRhID0ge307CgogICAgICBpZiAoY29uZmlnLmxpdmVzdHJlYW0gfHwgY29uZmlnLmxpdmVfcGxheWJhY2spIHsKICAgICAgICBtZXRhLmhhc1N0cmVhbSA9IDE7CiAgICAgIH0KCiAgICAgIGxpbmtzID0ge307CiAgICAgIGZtdE1hcCAmJiB0aGlzLnJlYWRGbXQobGlua3MsIG1ldGEsIGZtdE1hcCwgY3VycmVudFN0cywgdGl0bGVQYXJhbSk7CiAgICAgIGFkYXB0aXZlRm10cyAmJiB0aGlzLnJlYWRGbXQobGlua3MsIG1ldGEsIGFkYXB0aXZlRm10cywgY3VycmVudFN0cywgdGl0bGVQYXJhbSk7CgogICAgICBpZiAoT2JqZWN0LmtleXMobGlua3MpLmxlbmd0aCA9PT0gMCAmJiAhbWV0YS5oYXNTdHJlYW0pIHsKICAgICAgICBsaW5rcyA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGlua3MubWV0YSA9IG1ldGE7CiAgICAgIH0KCiAgICAgIGNiKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgX19nZXRZb3V0dWJlTGlua3M6IGZ1bmN0aW9uKGV1cmwsIHZpZGVvSWQsIGNoZWNrU3VidGl0bGVzLCBjYiwgbm9EYXNoKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgaWYgKCFldXJsKSB7CiAgICAgICAgZXVybCA9ICdodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PScgKyB2aWRlb0lkOwogICAgICB9CgogICAgICB0aGlzLmdldFl0Q29uZmlnKHZpZGVvSWQsIGV1cmwsIGZ1bmN0aW9uKGNvbmZpZywgY3VycmVudFN0cykgewogICAgICAgIF90aGlzLm9uR2V0Q29uZmlnKHZpZGVvSWQsIGNoZWNrU3VidGl0bGVzLCBjYiwgbm9EYXNoLCBjb25maWcsIGN1cnJlbnRTdHMpOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBhZGRVbW15TGlua3M6IGZ1bmN0aW9uKGxpbmtzLCB2aWRlb0lkKSB7CiAgICAgIGlmICghbGlua3MgfHwgKGxpbmtzLm1ldGEgJiYgbGlua3MubWV0YS5oYXNTdHJlYW0pKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoZW5naW5lLnByZWZlcmVuY2VzLnNob3dVbW15SXRlbSkgewogICAgICAgIHZhciBtZXRhID0gbGlua3MubWV0YTsKICAgICAgICBpZiAoIW1ldGEpIHsKICAgICAgICAgIG1ldGEgPSBsaW5rcy5tZXRhID0ge307CiAgICAgICAgfQogICAgICAgIG1ldGEudmlkZW9JZCA9IHZpZGVvSWQ7CgogICAgICAgIGxpbmtzWyd1bW15J10gPSAndW1teTovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PScgKyB2aWRlb0lkOwogICAgICAgIGxpbmtzWyd1bW15QXVkaW8nXSA9ICd1bW15Oi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9JyArIHZpZGVvSWQgKyAnJnNmX3R5cGU9YXVkaW8nOwogICAgICB9CiAgICB9LAoKICAgIGFkZENvbnZlcnRlckxpbmtzOiBmdW5jdGlvbihsaW5rcywgdGl0bGUpIHsKICAgICAgaWYgKCFsaW5rcykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFlbmdpbmUucHJlZmVyZW5jZXMuZW5hYmxlQ29udmVydGVyKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYXVkaW9SZSA9IC9hdWRpb1wvKFteO10rKS87CiAgICAgIHZhciB2aWRlb1JlID0gL3ZpZGVvXC8oW147XSspLzsKICAgICAgdmFyIHF1YWxpdHlSZSA9IC8oXGQrKUsvOwogICAgICB2YXIgYXVkaW9MaW5rcyA9IFtdOwogICAgICB2YXIgdmlkZW9MaW5rcyA9IFtdOwoKICAgICAgdmFyIG1ldGEgPSBsaW5rcy5tZXRhOwogICAgICBpZiAoIW1ldGEpIHsKICAgICAgICBtZXRhID0gbGlua3MubWV0YSA9IHt9OwogICAgICB9CgogICAgICB2YXIgbWF4VmlkZW9RdWFsaXR5ID0gMDsKICAgICAgT2JqZWN0LmtleXMobGlua3MpLmZvckVhY2goZnVuY3Rpb24oaXRhZykgewogICAgICAgIGlmIChpdGFnID09PSAnbWV0YScpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGluZm8gPSBtZXRhW2l0YWddOwogICAgICAgIGlmICghaW5mbyB8fCAhaW5mby5iaXRyYXRlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZXh0ID0gbnVsbDsKICAgICAgICBpZiAoYXVkaW9SZS50ZXN0KGluZm8udHlwZSkpIHsKICAgICAgICAgIGV4dCA9IGluZm8udHlwZS5tYXRjaChhdWRpb1JlKVsxXTsKICAgICAgICAgIGF1ZGlvTGlua3MucHVzaCh7CiAgICAgICAgICAgIGl0YWc6IGl0YWcsCiAgICAgICAgICAgIHVybDogbGlua3NbaXRhZ10sCiAgICAgICAgICAgIGJpdHJhdGU6IHBhcnNlSW50KGluZm8uYml0cmF0ZSksCiAgICAgICAgICAgIGV4dDogZXh0LAogICAgICAgICAgICBjb2RlY3M6IGluZm8uY29kZWNzCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAodmlkZW9SZS50ZXN0KGluZm8udHlwZSkgJiYgaW5mby5xdWFsaXR5ICYmIGluZm8ucHJvamVjdGlvblR5cGUpIHsKICAgICAgICAgIC8vIGF2YyBvbmx5CiAgICAgICAgICBpZiAoIS9hdmMvLnRlc3QoaW5mby5jb2RlY3MpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBleHQgPSBpbmZvLnR5cGUubWF0Y2godmlkZW9SZSlbMV07CgogICAgICAgICAgdmFyIHF1YWxpdHkgPSBpbmZvLnF1YWxpdHk7CiAgICAgICAgICBpZiAocXVhbGl0eVJlLnRlc3QocXVhbGl0eSkpIHsKICAgICAgICAgICAgcXVhbGl0eSA9IHF1YWxpdHkubWF0Y2gocXVhbGl0eVJlKVsxXSAqIDEwMDA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBxdWFsaXR5ID0gcGFyc2VJbnQocXVhbGl0eSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG1heFZpZGVvUXVhbGl0eSA8IHF1YWxpdHkpIHsKICAgICAgICAgICAgbWF4VmlkZW9RdWFsaXR5ID0gcXVhbGl0eTsKICAgICAgICAgIH0KCiAgICAgICAgICB2aWRlb0xpbmtzLnB1c2goewogICAgICAgICAgICBpdGFnOiBpdGFnLAogICAgICAgICAgICB1cmw6IGxpbmtzW2l0YWddLAogICAgICAgICAgICBiaXRyYXRlOiBwYXJzZUludChpbmZvLmJpdHJhdGUpLAogICAgICAgICAgICBleHQ6IGV4dCwKICAgICAgICAgICAgY29kZWNzOiBpbmZvLmNvZGVjcywKICAgICAgICAgICAgcXVhbGl0eTogcXVhbGl0eQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGlmICghYXVkaW9MaW5rcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGF1ZGlvTGlua3Muc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEuYml0cmF0ZSA+IGIuYml0cmF0ZSA/IC0xIDogMTsKICAgICAgfSk7CgogICAgICB2YXIgZXh0cmEgPSBtZXRhLmV4dHJhOwogICAgICBpZiAoIWV4dHJhKSB7CiAgICAgICAgZXh0cmEgPSBtZXRhLmV4dHJhID0gW107CiAgICAgIH0KCiAgICAgIGV4dHJhLnB1c2goewogICAgICAgIGZvcm1hdDogJ01QMycsCiAgICAgICAgaXRhZzogYXVkaW9MaW5rc1swXS5pdGFnLAogICAgICAgIGV4dHJhOiAnY29udmVydGVyJywKICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICBhY3Rpb246ICdjb252ZXJ0JywKICAgICAgICAgIGF1ZGlvVXJsOiBhdWRpb0xpbmtzWzBdLnVybCwKICAgICAgICAgIGF1ZGlvQ29kZWNzOiBhdWRpb0xpbmtzWzBdLmNvZGVjcywKICAgICAgICAgIGZpbGVuYW1lOiBtb25vLmZpbGVOYW1lLm1vZGlmeSh0aXRsZSkgKyAnLm1wMycsCiAgICAgICAgICBtZXRhZGF0YTogewogICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmlkZW9MaW5rcyA9IHZpZGVvTGlua3MuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5xdWFsaXR5ID49IG1heFZpZGVvUXVhbGl0eTsKICAgICAgfSk7CgogICAgICBpZiAodmlkZW9MaW5rcy5sZW5ndGgpIHsKICAgICAgICB2aWRlb0xpbmtzLnNvbWUoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgcmV0dXJuIGEuYml0cmF0ZSA+IGIuYml0cmF0ZSA/IC0xIDogMTsKICAgICAgICB9KTsKCiAgICAgICAgZXh0cmEucHVzaCh7CiAgICAgICAgICBmb3JtYXQ6ICdNUDQnLAogICAgICAgICAgaXRhZzogdmlkZW9MaW5rc1swXS5pdGFnLAogICAgICAgICAgZXh0cmE6ICdjb252ZXJ0ZXInLAogICAgICAgICAgZnBzOiB2aWRlb0xpbmtzWzBdLmZwcywKICAgICAgICAgIHJlcXVlc3Q6IHsKICAgICAgICAgICAgYWN0aW9uOiAnY29udmVydCcsCiAgICAgICAgICAgIHByZWxvYWQ6IHRydWUsCiAgICAgICAgICAgIGF1ZGlvVXJsOiBhdWRpb0xpbmtzWzBdLnVybCwKICAgICAgICAgICAgYXVkaW9Db2RlY3M6IGF1ZGlvTGlua3NbMF0uY29kZWNzLAogICAgICAgICAgICB2aWRlb1VybDogdmlkZW9MaW5rc1swXS51cmwsCiAgICAgICAgICAgIHZpZGVvQ29kZWNzOiB2aWRlb0xpbmtzWzBdLmNvZGVjcywKICAgICAgICAgICAgZmlsZW5hbWU6IG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRpdGxlKSArICcubXA0JywKICAgICAgICAgICAgbWV0YWRhdGE6IHsKICAgICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgY2hlY2tZb3V0dWJlTGlua3M6IGZ1bmN0aW9uKGxpbmtzLCBjYWxsYmFjaykgewogICAgICB2YXIgY2hlY2tJdGFncyA9IFsnMTgnLCAnMzQnLCAnMzUnXSwKICAgICAgICBjaGVja1VybCA9ICcnOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoZWNrSXRhZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobGlua3NbY2hlY2tJdGFnc1tpXV0pIHsKICAgICAgICAgIGNoZWNrVXJsID0gbGlua3NbY2hlY2tJdGFnc1tpXV07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChjaGVja1VybCkgewogICAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgICB0eXBlOiAnSEVBRCcsCiAgICAgICAgICB1cmw6IGNoZWNrVXJsCiAgICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwKSB7CiAgICAgICAgICBjYWxsYmFjayhjaGVja1VybCwgIWVycik7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjYWxsYmFjaygpOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGNvbnZlcnRWdHQyU3J0OiBmdW5jdGlvbihpdGVtLCBjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiBpdGVtLnVybAogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGJvZHkpIHsKICAgICAgICBpZiAoZXJyIHx8ICFib2R5KSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZXF1ZXN0IGVycm9yIScsIGVycik7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIHZhciByZSA9IC8oXGR7Mn06XGR7Mn06XGR7Mn0pXC4oXGR7M30pL2c7CiAgICAgICAgdmFyIHZhbGlkYXRlUmUgPSAvXlxkezJ9OlxkezJ9OlxkezJ9XC5cZHszfS87CiAgICAgICAgdmFyIGFyciA9IGJvZHkuc3BsaXQoJ1xuXG4nKTsKCiAgICAgICAgaWYgKCF2YWxpZGF0ZVJlLnRlc3QoYXJyWzBdKSkgewogICAgICAgICAgYXJyLnNoaWZ0KCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXZhbGlkYXRlUmUudGVzdChhcnJbYXJyLmxlbmd0aCAtIDFdKSkgewogICAgICAgICAgYXJyLnBvcCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGhhc1NraXAgPSBmYWxzZTsKICAgICAgICB2YXIgc3J0ID0gYXJyLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICB2YXIgciA9IHZhbGlkYXRlUmUudGVzdChpdGVtKTsKICAgICAgICAgIGlmICghcikgewogICAgICAgICAgICBoYXNTa2lwID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByOwogICAgICAgIH0pLm1hcChmdW5jdGlvbihpdGVtLCBpbmRleCkgewogICAgICAgICAgaXRlbSA9IGl0ZW0ucmVwbGFjZShyZSwgIiQxLCQyIik7CiAgICAgICAgICByZXR1cm4gKGluZGV4ICsgMSkgKyAnXG4nICsgaXRlbTsKICAgICAgICB9KTsKICAgICAgICBzcnQgPSBzcnQuam9pbignXG5cbicpOwoKICAgICAgICBpZiAoaGFzU2tpcCkgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQoKICAgICAgICBpdGVtLnNydCA9IHNydDsKICAgICAgICBpdGVtLnByZXByb2Nlc3MgPSAnc3J0MnVybCc7CiAgICAgICAgY2IoKTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgZ2V0WW91dHViZVN1YnRpdGxlczogZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIHZpZGVvSWQgPSBtZXNzYWdlLmV4dFZpZGVvSWQ7CiAgICAgIHZhciBiYXNlVXJsID0gJ2h0dHA6Ly92aWRlby5nb29nbGUuY29tL3RpbWVkdGV4dCc7CiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiBiYXNlVXJsICsgJz9obD0nICsgZW5naW5lLmxhbmd1YWdlLmxhbmcgKyAnJnY9JyArIHZpZGVvSWQgKyAnJnR5cGU9bGlzdCZ0bGFuZ3M9MScsCiAgICAgICAgeG1sOiB0cnVlCiAgICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcCwgeG1sKSB7CiAgICAgICAgaWYgKGVyciB8fCAheG1sKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIHZhciB0cmFjayA9IHhtbC5xdWVyeVNlbGVjdG9yQWxsKCd0cmFjaycpOwogICAgICAgIHZhciB0YXJnZXQgPSB4bWwucXVlcnlTZWxlY3RvckFsbCgndGFyZ2V0Jyk7CiAgICAgICAgdmFyIGxpc3QgPSBbXTsKICAgICAgICB2YXIgdHJhY2tMaXN0ID0ge307CiAgICAgICAgdmFyIHRhcmdldExpc3QgPSB7fTsKICAgICAgICB2YXIgb3JpZ1RyYWNrID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBsYW5nQ29kZSwgcGFyYW07CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSB0cmFja1tpXTsgaSsrKSB7CiAgICAgICAgICBsYW5nQ29kZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdsYW5nX2NvZGUnKTsKICAgICAgICAgIHBhcmFtID0gewogICAgICAgICAgICBsYW5nOiBsYW5nQ29kZSwKICAgICAgICAgICAgdjogdmlkZW9JZCwKICAgICAgICAgICAgZm10OiAndnR0JywKICAgICAgICAgICAgbmFtZTogaXRlbS5nZXRBdHRyaWJ1dGUoJ25hbWUnKSB8fCB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB0cmFja0xpc3RbbGFuZ0NvZGVdID0gewogICAgICAgICAgICBsYW5nOiBpdGVtLmdldEF0dHJpYnV0ZSgnbGFuZ190cmFuc2xhdGVkJyksCiAgICAgICAgICAgIGxhbmdDb2RlOiBsYW5nQ29kZSwKICAgICAgICAgICAgdXJsOiBiYXNlVXJsICsgJz8nICsgbW9uby5wYXJhbShwYXJhbSksCiAgICAgICAgICAgIG5hbWU6IHBhcmFtLm5hbWUKICAgICAgICAgIH07CiAgICAgICAgICBsaXN0LnB1c2godHJhY2tMaXN0W2xhbmdDb2RlXSk7CiAgICAgICAgICBpZiAoIW9yaWdUcmFjayAmJiBpdGVtLmdldEF0dHJpYnV0ZSgnY2FudHJhbicpKSB7CiAgICAgICAgICAgIG9yaWdUcmFjayA9IHBhcmFtOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG9yaWdUcmFjaykgewogICAgICAgICAgZm9yIChpID0gMCwgaXRlbTsgaXRlbSA9IHRhcmdldFtpXTsgaSsrKSB7CiAgICAgICAgICAgIGxhbmdDb2RlID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2xhbmdfY29kZScpOwogICAgICAgICAgICBwYXJhbSA9IHsKICAgICAgICAgICAgICBsYW5nOiBvcmlnVHJhY2subGFuZywKICAgICAgICAgICAgICB2OiB2aWRlb0lkLAogICAgICAgICAgICAgIHRsYW5nOiBsYW5nQ29kZSwKICAgICAgICAgICAgICBmbXQ6ICd2dHQnLAogICAgICAgICAgICAgIG5hbWU6IG9yaWdUcmFjay5uYW1lCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRhcmdldExpc3RbbGFuZ0NvZGVdID0gewogICAgICAgICAgICAgIGxhbmc6IGl0ZW0uZ2V0QXR0cmlidXRlKCdsYW5nX3RyYW5zbGF0ZWQnKSwKICAgICAgICAgICAgICBsYW5nQ29kZTogbGFuZ0NvZGUsCiAgICAgICAgICAgICAgdXJsOiBiYXNlVXJsICsgJz8nICsgbW9uby5wYXJhbShwYXJhbSksCiAgICAgICAgICAgICAgaXNBdXRvOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBsYW5nQ29kZSA9IG1vbm8uZ2V0TmF2aWdhdG9yKCkubGFuZ3VhZ2UudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAobGFuZ0NvZGUuaW5kZXhPZignemgtaGFudCcpID09PSAwKSB7CiAgICAgICAgICBsYW5nQ29kZSA9ICd6aC1IYW50JzsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAobGFuZ0NvZGUuaW5kZXhPZignemgtaGFucycpID09PSAwKSB7CiAgICAgICAgICBsYW5nQ29kZSA9ICd6aC1IYW5zJzsKICAgICAgICB9CiAgICAgICAgdmFyIGxvY2FsZUxpc3QgPSBbbGFuZ0NvZGVdOwogICAgICAgIGlmIChsb2NhbGVMaXN0WzBdID09PSAndWsnKSB7CiAgICAgICAgICBsb2NhbGVMaXN0LnB1c2goJ3J1Jyk7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gbG9jYWxlTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICBpZiAoIXRyYWNrTGlzdFtpdGVtXSAmJiB0YXJnZXRMaXN0W2l0ZW1dKSB7CiAgICAgICAgICAgIGxpc3QucHVzaCh0YXJnZXRMaXN0W2l0ZW1dKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciB3YWl0Q291bnQgPSAwOwogICAgICAgIHZhciByZWFkeUNvdW50ID0gMDsKICAgICAgICB2YXIgb25SZWFkeSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgcmVhZHlDb3VudCsrOwogICAgICAgICAgaWYgKHdhaXRDb3VudCAhPT0gcmVhZHlDb3VudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gY2IobGlzdCk7CiAgICAgICAgfTsKICAgICAgICB3YWl0Q291bnQrKzsKICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgd2FpdENvdW50Kys7CiAgICAgICAgICBfdGhpcy5jb252ZXJ0VnR0MlNydChpdGVtLCBvblJlYWR5KTsKICAgICAgICB9KTsKICAgICAgICBvblJlYWR5KCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGRhc2hNcGRTaWdSOiAvKFwvc1wvKFteXC9dKykpLywKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGdldFlvdVR1YmVEYXNoTGlua3M6IGZ1bmN0aW9uKGxpbmtzLCBkYXNobXBkLCBjYiwgZGVjaGlwZXIpIHsKICAgICAgaWYgKCFkYXNobXBkIHx8IGRhc2htcGQuaW5kZXhPZigneXRfbGl2ZV9icm9hZGNhc3QnKSAhPT0gLTEpIHsKICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgfQoKICAgICAgdmFyIHMgPSBkYXNobXBkLm1hdGNoKHlvdXR1YmVfY29tX2VtYmVkLmRhc2hNcGRTaWdSKTsKICAgICAgaWYgKHMpIHsKICAgICAgICBpZiAoIWRlY2hpcGVyKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIHZhciBzaWduYXR1cmUgPSBkZWNoaXBlcihzWzJdKTsKICAgICAgICBkYXNobXBkID0gZGFzaG1wZC5yZXBsYWNlKHNbMV0sICcvc2lnbmF0dXJlLycgKyBzaWduYXR1cmUpOwogICAgICB9CgogICAgICBkYXNobXBkID0gZGFzaG1wZC5yZXBsYWNlKCcvc2lnLycsICcvc2lnbmF0dXJlLycpOwoKICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICB1cmw6IGRhc2htcGQsCiAgICAgICAgeG1sOiB0cnVlCiAgICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcCwgeG1sKSB7CiAgICAgICAgaWYgKGVyciB8fCAheG1sKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIHlvdXR1YmVfY29tX2VtYmVkLnBhcnNlRGFzaCh4bWwsIGxpbmtzLCBjYik7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGdldERhc2hRdWFsaXR5OiBmdW5jdGlvbihhLCBiKSB7CiAgICAgIHZhciBxdWFsaXR5TGlzdCA9IHsKICAgICAgICAxNDQ6IDE0NCwKICAgICAgICAyNDA6IDI0MCwKICAgICAgICAzNjA6IDM2MCwKICAgICAgICA0ODA6IDQ4MCwKICAgICAgICA3MjA6IDcyMCwKICAgICAgICAxMDgwOiAxMDgwLAogICAgICAgIDE0NDA6IDE0NDAsCiAgICAgICAgJzRLJzogMjE2MCwKICAgICAgICAnNUsnOiAyODgwLAogICAgICAgICc4Syc6IDQzMjAKICAgICAgfTsKCiAgICAgIHZhciBxdWFsaXR5OwogICAgICB2YXIgZyA9IE1hdGgubWF4KGEsIGIpOwogICAgICBhID0gTWF0aC5taW4oYSwgYik7CiAgICAgIGZvciAodmFyIHF1YWxpdHlOYW1lIGluIHF1YWxpdHlMaXN0KSB7CiAgICAgICAgdmFyIHZhbHVlID0gcXVhbGl0eUxpc3RbcXVhbGl0eU5hbWVdOwogICAgICAgIGlmIChnID49IE1hdGguZmxvb3IoMTYgKiB2YWx1ZSAvIDkpIHx8IGEgPj0gdmFsdWUpIHsKICAgICAgICAgIHF1YWxpdHkgPSBxdWFsaXR5TmFtZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHF1YWxpdHk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBxdWFsaXR5OwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIHBhcnNlRGFzaDogZnVuY3Rpb24oeG1sLCBsaW5rcywgY2IpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgZWxMaXN0ID0geG1sLnF1ZXJ5U2VsZWN0b3JBbGwoJ1JlcHJlc2VudGF0aW9uJyk7CiAgICAgIGlmICghbGlua3MpIHsKICAgICAgICBsaW5rcyA9IHt9OwogICAgICB9CgogICAgICB2YXIgbWV0YSA9IGxpbmtzLm1ldGEgPSBsaW5rcy5tZXRhIHx8IHt9OwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGVsOyBlbCA9IGVsTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgdmFyIGl0YWcgPSBlbC5nZXRBdHRyaWJ1dGUoJ2lkJyk7CgogICAgICAgIGlmICghbWV0YVtpdGFnXSkgewogICAgICAgICAgbWV0YVtpdGFnXSA9IHt9OwogICAgICAgIH0KCiAgICAgICAgdmFyIGZyYW1lUmF0ZSA9IGVsLmdldEF0dHJpYnV0ZSgnZnJhbWVSYXRlJyk7CiAgICAgICAgaWYgKGZyYW1lUmF0ZSkgewogICAgICAgICAgbWV0YVtpdGFnXS5mcHMgPSBmcmFtZVJhdGU7CiAgICAgICAgfQoKICAgICAgICB2YXIgd2lkdGggPSBlbC5nZXRBdHRyaWJ1dGUoJ3dpZHRoJyk7CiAgICAgICAgdmFyIGhlaWdodCA9IGVsLmdldEF0dHJpYnV0ZSgnaGVpZ2h0Jyk7CgogICAgICAgIGlmICh3aWR0aCAmJiBoZWlnaHQpIHsKICAgICAgICAgIG1ldGFbaXRhZ10ucXVhbGl0eSA9IHlvdXR1YmVfY29tX2VtYmVkLmdldERhc2hRdWFsaXR5KHdpZHRoLCBoZWlnaHQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGxpbmtzW2l0YWddICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGJhc2VVcmxOb2RlID0gZWwucXVlcnlTZWxlY3RvcignQmFzZVVSTCcpOwogICAgICAgIGlmICghYmFzZVVybE5vZGUpIHsKICAgICAgICAgIGRlbGV0ZSBtZXRhW2l0YWddOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZhciB1cmwgPSBiYXNlVXJsTm9kZS50ZXh0Q29udGVudDsKCiAgICAgICAgdmFyIGNvZGVjcyA9IGVsLmdldEF0dHJpYnV0ZSgnY29kZWNzJyk7CiAgICAgICAgaWYgKGNvZGVjcykgewogICAgICAgICAgbWV0YVtpdGFnXS5jb2RlY3MgPSBjb2RlY3M7CiAgICAgICAgICB2YXIgdHlwZSA9IHVybC5tYXRjaCgvbWltZT0oW14mXSspLyk7CiAgICAgICAgICB0eXBlID0gdHlwZSAmJiB0eXBlWzFdOwogICAgICAgICAgaWYgKHR5cGUpIHsKICAgICAgICAgICAgbWV0YVtpdGFnXS50eXBlID0gdHlwZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBzZWdtZW50VXJsTm9kZSA9IGJhc2VVcmxOb2RlLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignU2VnbWVudFVSTCcpOwogICAgICAgIHZhciBzZWdtZW50VXJsID0gc2VnbWVudFVybE5vZGUgJiYgc2VnbWVudFVybE5vZGUuZ2V0QXR0cmlidXRlKCdtZWRpYScpOwogICAgICAgIGlmIChzZWdtZW50VXJsICYmIHNlZ21lbnRVcmwuaW5kZXhPZignc3EvJykgPT09IDApIHsKICAgICAgICAgIGRlbGV0ZSBtZXRhW2l0YWddOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBsaW5rc1tpdGFnXSA9IHVybDsKICAgICAgfQogICAgICBjYihsaW5rcyk7CiAgICB9LAoKICAgIGdldFlvdXR1YmVJZExpc3RGcm9tUGxheWxpc3Q6IGZ1bmN0aW9uKHJlcXVlc3QsIGNiKSB7CiAgICAgIHlvdXR1YmVfY29tX2VtYmVkLmdldElkTGlzdEZyb21MaXN0KHJlcXVlc3QuYmFzZVVybCB8fCAnaHR0cHM6Ly93d3cueW91dHViZS5jb20nLCByZXF1ZXN0Lmxpc3RJZCwgY2IpOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGdldElkTGlzdEZyb21MaXN0OiAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBnZXROZXh0UGFnZSA9IGZ1bmN0aW9uKGJhc2VVcmwsIHVybCwgcGFnZUxpc3QsIGNiKSB7CiAgICAgICAgaWYgKCFwYWdlTGlzdCkgewogICAgICAgICAgcGFnZUxpc3QgPSBbXTsKICAgICAgICB9CiAgICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICAgIHVybDogYmFzZVVybCArIHVybCwKICAgICAgICAgIGpzb246IHRydWUKICAgICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICAgIGlmIChlcnIgfHwgIWRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIGNiKHBhZ2VMaXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBwYWdlTGlzdC5wdXNoKGRhdGEuY29udGVudF9odG1sKTsKICAgICAgICAgIHZhciBuZXh0UGFnZVVybCA9IGdldE5leHRQYWdlVXJsKGRhdGEubG9hZF9tb3JlX3dpZGdldF9odG1sKTsKICAgICAgICAgIGlmIChuZXh0UGFnZVVybCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiBjYihwYWdlTGlzdCk7CiAgICAgICAgICB9CiAgICAgICAgICBnZXROZXh0UGFnZShiYXNlVXJsLCBuZXh0UGFnZVVybCwgcGFnZUxpc3QsIGNiKTsKICAgICAgICB9KTsKICAgICAgfTsKICAgICAgdmFyIGdldFRpdGxlRnJvbVBhZ2UgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIHRpdGxlID0gZGF0YS5tYXRjaCgvPGgxW14+XSs+KFtePF0rKTxcL2gxPi8pOwogICAgICAgIGlmICghdGl0bGUpIHsKICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aXRsZVsxXS5yZXBsYWNlKC9ccj9cbi9nLCAiICIpLnRyaW0oKTsKICAgICAgfTsKICAgICAgdmFyIGdldE5leHRQYWdlVXJsID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgdmFyIG5leHRVcmwgPSBkYXRhLm1hdGNoKC9kYXRhLXVpeC1sb2FkLW1vcmUtaHJlZj0iKFteIl0rKSIvKTsKICAgICAgICBpZiAobmV4dFVybCkgewogICAgICAgICAgbmV4dFVybCA9IG5leHRVcmxbMV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXh0VXJsIHx8IHVuZGVmaW5lZDsKICAgICAgfTsKICAgICAgdmFyIHJlYWRMaW5rc0Zyb21QYWdlcyA9IGZ1bmN0aW9uKGxpc3RJZCwgcGFnZUxpc3QsIGNiKSB7CiAgICAgICAgdmFyIHRpdGxlID0gZ2V0VGl0bGVGcm9tUGFnZShwYWdlTGlzdFswXSk7CiAgICAgICAgdmFyIGlkT2JqID0ge307CiAgICAgICAgdmFyIGlkTGlzdCA9IFtdOwogICAgICAgIHZhciBwYXR0ZXJuID0gL2hyZWY9Ilwvd2F0Y2hcPyhbXiJdKykiL2c7CiAgICAgICAgdmFyIG1heEluZGV4ID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGFnZUxpc3QubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHZhciBjb250ZW50ID0gcGFnZUxpc3RbaV07CiAgICAgICAgICBjb250ZW50LnJlcGxhY2UocGF0dGVybiwgZnVuY3Rpb24oc3RyaW5nLCBhcmdzKSB7CiAgICAgICAgICAgIHZhciB1cmwgPSBtb25vLnBhcnNlVXJsKGFyZ3MsIHsKICAgICAgICAgICAgICBwYXJhbXM6IHRydWUsCiAgICAgICAgICAgICAgc2VwOiAnJmFtcDsnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAodXJsLmxpc3QgIT09IGxpc3RJZCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cmwuaW5kZXggPSBwYXJzZUludCh1cmwuaW5kZXgpOwogICAgICAgICAgICBpZE9ialt1cmwuaW5kZXhdID0gdXJsLnY7CiAgICAgICAgICAgIGlmICh1cmwuaW5kZXggPiBtYXhJbmRleCkgewogICAgICAgICAgICAgIG1heEluZGV4ID0gdXJsLmluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8PSBtYXhJbmRleDsgaSsrKSB7CiAgICAgICAgICBpZiAoaWRPYmpbaV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpZExpc3QuaW5kZXhPZihpZE9ialtpXSkgPT09IC0xKSB7CiAgICAgICAgICAgIGlkTGlzdC5wdXNoKGlkT2JqW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2IoewogICAgICAgICAgaWRMaXN0OiBpZExpc3QsCiAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICB9KTsKICAgICAgfTsKICAgICAgdmFyIGdldE5ld0NsaWVudERhdGEgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIHBhcmFtcyA9IHt9OwogICAgICAgIHZhciBtID0gZGF0YS5tYXRjaCgvInBhcmFtcyI6KFxbW15cXV0rImNsaWVudFwudmVyc2lvbiJbXlxdXStcXSkvKTsKICAgICAgICBpZiAobSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIGpzb24gPSBKU09OLnBhcnNlKG1bMV0pOwogICAgICAgICAgICBqc29uLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgIGlmIChpdGVtLmtleSAmJiBpdGVtLnZhbHVlKSB7CiAgICAgICAgICAgICAgICBwYXJhbXNbaXRlbS5rZXldID0gaXRlbS52YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhcmFtczsKICAgICAgfTsKICAgICAgdmFyIGdldE5ld1RpdGxlID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHZhciB0aXRsZSA9ICd1bmtub3duJzsKICAgICAgICB2YXIgcGxheWxpc3RNZXRhZGF0YVJlbmRlcmVyID0gZGF0YS5tYXRjaCgvInBsYXlsaXN0TWV0YWRhdGFSZW5kZXJlciI6KHtbXn1dK30pLyk7CiAgICAgICAgaWYgKHBsYXlsaXN0TWV0YWRhdGFSZW5kZXJlcikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcGxheWxpc3RNZXRhZGF0YVJlbmRlcmVyID0gSlNPTi5wYXJzZShwbGF5bGlzdE1ldGFkYXRhUmVuZGVyZXIpOwogICAgICAgICAgICBpZiAocGxheWxpc3RNZXRhZGF0YVJlbmRlcmVyLnRpdGxlKSB7CiAgICAgICAgICAgICAgdGl0bGUgPSBwbGF5bGlzdE1ldGFkYXRhUmVuZGVyZXIudGl0bGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aXRsZTsKICAgICAgfTsKICAgICAgdmFyIGdldE5ld05leHRQYWdlVXJsID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHZhciBwYXRoID0gbnVsbDsKICAgICAgICB2YXIgbSA9IGRhdGEubWF0Y2goLyJuZXh0Q29udGludWF0aW9uRGF0YSI6KHtbXn1dK30pLyk7CiAgICAgICAgaWYgKG0pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBuZXh0Q29udGludWF0aW9uRGF0YSA9IEpTT04ucGFyc2UobVsxXSk7CiAgICAgICAgICAgIHBhdGggPSAnL2Jyb3dzZV9hamF4PycgKyBtb25vLnBhcmFtKHsKICAgICAgICAgICAgICBjdG9rZW46IG5leHRDb250aW51YXRpb25EYXRhLmNvbnRpbnVhdGlvbiwKICAgICAgICAgICAgICBpdGN0OiBuZXh0Q29udGludWF0aW9uRGF0YS5jbGlja1RyYWNraW5nUGFyYW1zCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAgIH07CiAgICAgIHZhciBnZXROZXdWaWRlb0xpc3QgPSBmdW5jdGlvbihkYXRhLCBpZExpc3QpIHsKICAgICAgICB2YXIgcG9zID0gZGF0YS5pbmRleE9mKCd7InBsYXlsaXN0VmlkZW9MaXN0UmVuZGVyZXIiOnsnKTsKICAgICAgICBpZiAocG9zICE9PSAtMSkgewogICAgICAgICAgZGF0YSA9IGRhdGEuc3Vic3RyKHBvcyk7CiAgICAgICAgICBtb25vLmZpbmRKc29uKGRhdGEpLmZvckVhY2goZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgIHZhciBwbGF5bGlzdFZpZGVvTGlzdFJlbmRlcmVyID0gb2JqLnBsYXlsaXN0VmlkZW9MaXN0UmVuZGVyZXI7CiAgICAgICAgICAgIHZhciBjb250ZW50cyA9IHBsYXlsaXN0VmlkZW9MaXN0UmVuZGVyZXIgJiYgcGxheWxpc3RWaWRlb0xpc3RSZW5kZXJlci5jb250ZW50czsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudHMpKSB7CiAgICAgICAgICAgICAgY29udGVudHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICB2YXIgcGxheWxpc3RWaWRlb1JlbmRlcmVyID0gaXRlbS5wbGF5bGlzdFZpZGVvUmVuZGVyZXI7CiAgICAgICAgICAgICAgICB2YXIgdmlkZW9JZCA9IHBsYXlsaXN0VmlkZW9SZW5kZXJlciAmJiBwbGF5bGlzdFZpZGVvUmVuZGVyZXIudmlkZW9JZDsKICAgICAgICAgICAgICAgIGlmICh2aWRlb0lkKSB7CiAgICAgICAgICAgICAgICAgIGlkTGlzdC5wdXNoKHZpZGVvSWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciBnZXROZXdOZXh0UGFnZSA9IGZ1bmN0aW9uKGJhc2VVcmwsIHBhdGgsIGNsaWVudERhdGEsIGRhdGFMaXN0LCBjYikgewogICAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgICB1cmw6IGJhc2VVcmwgKyBwYXRoLAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAnWC1Zb3VUdWJlLUNsaWVudC1OYW1lJzogJzEnLAogICAgICAgICAgICAnWC1Zb3VUdWJlLUNsaWVudC1WZXJzaW9uJzogY2xpZW50RGF0YVsnY2xpZW50LnZlcnNpb24nXQogICAgICAgICAgfSwKICAgICAgICAgIGpzb246IHRydWUKICAgICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgbW9uby5lcnJvcignWVQgbmV4dCBwYWdlIHJlcXVlc3QgZXJyb3IhJywgZXJyKTsKICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRhdGFTdHIgPSBKU09OLnN0cmluZ2lmeShkYXRhKTsKICAgICAgICAgIHZhciBuZXh0UGFnZVVybCA9IGdldE5ld05leHRQYWdlVXJsKGRhdGFTdHIpOwogICAgICAgICAgZ2V0TmV3VmlkZW9MaXN0KGRhdGFTdHIsIGRhdGFMaXN0KTsKCiAgICAgICAgICBpZiAobmV4dFBhZ2VVcmwpIHsKICAgICAgICAgICAgZ2V0TmV3TmV4dFBhZ2UoYmFzZVVybCwgbmV4dFBhZ2VVcmwsIGNsaWVudERhdGEsIGRhdGFMaXN0LCBjYik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYigpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9OwogICAgICByZXR1cm4gZnVuY3Rpb24gZ2V0TGlua3NGcm9tTGlzdChiYXNlVXJsLCBsaXN0SWQsIGNiKSB7CiAgICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICAgIHVybDogYmFzZVVybCArICcvcGxheWxpc3Q/bGlzdD0nICsgbGlzdElkCiAgICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBuZXh0UGFnZVVybCA9IG51bGw7CiAgICAgICAgICBpZiAoZGF0YS5tYXRjaCgvInBsYXlsaXN0VmlkZW9MaXN0UmVuZGVyZXIiLykpIHsKICAgICAgICAgICAgdmFyIGNsaWVudERhdGEgPSBnZXROZXdDbGllbnREYXRhKGRhdGEpOwogICAgICAgICAgICB2YXIgdGl0bGUgPSBnZXROZXdUaXRsZShkYXRhKTsKICAgICAgICAgICAgdmFyIGlkTGlzdCA9IFtdOwoKICAgICAgICAgICAgZ2V0TmV3VmlkZW9MaXN0KGRhdGEsIGlkTGlzdCk7CgogICAgICAgICAgICBuZXh0UGFnZVVybCA9IGdldE5ld05leHRQYWdlVXJsKGRhdGEpOwogICAgICAgICAgICBpZiAoIW5leHRQYWdlVXJsKSB7CiAgICAgICAgICAgICAgY2IoewogICAgICAgICAgICAgICAgaWRMaXN0OiBpZExpc3QsCiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBnZXROZXdOZXh0UGFnZShiYXNlVXJsLCBuZXh0UGFnZVVybCwgY2xpZW50RGF0YSwgaWRMaXN0LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNiKHsKICAgICAgICAgICAgICAgICAgaWRMaXN0OiBpZExpc3QsCiAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5leHRQYWdlVXJsID0gZ2V0TmV4dFBhZ2VVcmwoZGF0YSk7CiAgICAgICAgICAgIGlmICghbmV4dFBhZ2VVcmwpIHsKICAgICAgICAgICAgICByZWFkTGlua3NGcm9tUGFnZXMobGlzdElkLCBbZGF0YV0sIGNiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBnZXROZXh0UGFnZShiYXNlVXJsLCBuZXh0UGFnZVVybCwgW2RhdGFdLCBmdW5jdGlvbihwYWdlTGlzdCkgewogICAgICAgICAgICAgICAgcmVhZExpbmtzRnJvbVBhZ2VzKGxpc3RJZCwgcGFnZUxpc3QsIGNiKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9OwogICAgfSkoKSwKCiAgICBnZXRZb3V0dWJlTGlua3NGcm9tQ29uZmlnOiBmdW5jdGlvbihtZXNzYWdlLCBjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBhYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHlvdXR1YmVfY29tX2VtYmVkLmdldFlvdXR1YmVMaW5rcyhtZXNzYWdlLCBjYik7CiAgICAgIH07CgogICAgICBjYiA9IGZ1bmN0aW9uKGNiLCBvYmopIHsKICAgICAgICBpZiAob2JqICYmIG9iai5saW5rcykgewogICAgICAgICAgeW91dHViZV9jb21fZW1iZWQuYWRkVW1teUxpbmtzKG9iai5saW5rcywgbWVzc2FnZS5leHRWaWRlb0lkKTsKICAgICAgICAgIHlvdXR1YmVfY29tX2VtYmVkLmFkZENvbnZlcnRlckxpbmtzKG9iai5saW5rcywgb2JqLnRpdGxlKTsKICAgICAgICB9CiAgICAgICAgY2Iob2JqKTsKICAgICAgfS5iaW5kKHRoaXMsIGNiKTsKCiAgICAgIHJldHVybiB0aGlzLnByZXBhcmVMYXN0U3RzKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBqc29uTGlzdCA9IG1lc3NhZ2UuY29uZmlnOwogICAgICAgIGlmICghanNvbkxpc3QgfHwKICAgICAgICAgICFqc29uTGlzdC5hcmdzIHx8CiAgICAgICAgICBqc29uTGlzdC5hcmdzLnZpZGVvX2lkICE9PSBtZXNzYWdlLmV4dFZpZGVvSWQgfHwKICAgICAgICAgICFqc29uTGlzdC5hc3NldHMgfHwKICAgICAgICAgICFqc29uTGlzdC5hc3NldHMuanMgfHwKICAgICAgICAgICEoanNvbkxpc3QuYXJncy51cmxfZW5jb2RlZF9mbXRfc3RyZWFtX21hcCB8fCBqc29uTGlzdC5hcmdzLmFkYXB0aXZlX2ZtdHMgfHwganNvbkxpc3QuYXJncy5mbXRfdXJsX21hcCkKICAgICAgICApIHsKICAgICAgICAgIHJldHVybiBhYm9ydCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNvbmZpZyA9IF90aGlzLnZpZGVvSW5mb1RvT2JqKGpzb25MaXN0LmFyZ3MsIDEpOwogICAgICAgIHZhciBjdXJyZW50U3RzID0gewogICAgICAgICAgc3RzOiBqc29uTGlzdC5zdHMsCiAgICAgICAgICB1cmw6IGpzb25MaXN0LmFzc2V0cy5qcwogICAgICAgIH07CgogICAgICAgIF90aGlzLmV4cEN1cnJlbnRTdHMoKTsKCiAgICAgICAgaWYgKF90aGlzLmN1cnJlbnRTdHMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKGN1cnJlbnRTdHMuc3RzKSB7CiAgICAgICAgICAgIF90aGlzLmN1cnJlbnRTdHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGN1cnJlbnRTdHMpKTsKICAgICAgICAgICAgX3RoaXMuZXhwQ3VycmVudFN0cygpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChfdGhpcy5jdXJyZW50U3RzLnVybCA9PT0gY3VycmVudFN0cy51cmwgfHwgX3RoaXMuY3VycmVudFN0cy5zdHMgPT09IGN1cnJlbnRTdHMuc3RzKSB7CiAgICAgICAgICBjdXJyZW50U3RzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfdGhpcy5jdXJyZW50U3RzKSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgb25DdXJyZW50U3RzUmVhZHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBvbkdldExpbmtzID0gZnVuY3Rpb24obGlua3MsIHRpdGxlLCBzdWJ0aXRsZXMsIGR1cmF0aW9uKSB7CiAgICAgICAgICAgIGNiKHsKICAgICAgICAgICAgICBsaW5rczogbGlua3MsCiAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAgIGlzUXVpY2s6IDEKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgX3RoaXMub25HZXRDb25maWcoCiAgICAgICAgICAgIG1lc3NhZ2UuZXh0VmlkZW9JZCwKICAgICAgICAgICAgbWVzc2FnZS5jaGVja1N1YnRpdGxlcywKICAgICAgICAgICAgb25HZXRMaW5rcywKICAgICAgICAgICAgbWVzc2FnZS5ub0Rhc2gsCiAgICAgICAgICAgIGNvbmZpZywKICAgICAgICAgICAgY3VycmVudFN0cwogICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgdGVzdEl0ZW07CiAgICAgICAgaWYgKCFjdXJyZW50U3RzLmFjdExpc3QgJiYgKHRlc3RJdGVtID0gX3RoaXMubmVlZERlY2hpcGVyKGNvbmZpZykpKSB7CiAgICAgICAgICBfdGhpcy5wcmVwYXJlRGVjaGlwZXIodGVzdEl0ZW0sIGN1cnJlbnRTdHMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoY3VycmVudFN0cy5pbnZhbGlkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG9uQ3VycmVudFN0c1JlYWR5KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb25DdXJyZW50U3RzUmVhZHkoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIHl0UnVuQWN0TGlzdDogZnVuY3Rpb24obGlzdCwgYSkgewogICAgICB2YXIgYWN0aW9uTGlzdCA9IHsKICAgICAgICBzbGljZTogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgYS5zbGljZShiKQogICAgICAgIH0sCiAgICAgICAgc3BsaWNlOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICBhLnNwbGljZSgwLCBiKQogICAgICAgIH0sCiAgICAgICAgcmV2ZXJzZTogZnVuY3Rpb24oYSkgewogICAgICAgICAgYS5yZXZlcnNlKCkKICAgICAgICB9LAogICAgICAgIHN3YXA6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHZhciBjID0gYVswXTsKICAgICAgICAgIGFbMF0gPSBhW2IgJSBhLmxlbmd0aF07CiAgICAgICAgICBhW2JdID0gYwogICAgICAgIH0KICAgICAgfTsKICAgICAgYSA9IGEuc3BsaXQoIiIpOwogICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGxpc3RbaV07IGkrKykgewogICAgICAgIGFjdGlvbkxpc3RbaXRlbVswXV0oYSwgaXRlbVsxXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGEuam9pbigiIik7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgeXRIdG1sNVNpZ0RlY2lwaGVyOiB7CiAgICAgIHJlYWRPYmZGdW5jOiBmdW5jdGlvbihmdW5jLCBkYXRhKSB7CiAgICAgICAgdmFyIHZMaXN0ID0gZnVuYy5tYXRjaCgvXFsoXHcrKVxdL2cpOwogICAgICAgIGlmICghdkxpc3QpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHY7IHYgPSB2TGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICB2YXIgdnYgPSBkYXRhLm1hdGNoKG5ldyBSZWdFeHAoJ1ssIF17MX0nICsgdi5zbGljZSgxLCAtMSkgKyAnPSIoXFx3KykiJykpOwogICAgICAgICAgaWYgKHZ2KSB7CiAgICAgICAgICAgIGZ1bmMgPSBmdW5jLnJlcGxhY2UodiwgJy4nICsgdnZbMV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgYXJyID0gZnVuYy5zcGxpdCgnOycpOwogICAgICAgIHZhciBhY3RMaXN0ID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBhcnJbaV07IGkrKykgewogICAgICAgICAgaWYgKGl0ZW0uaW5kZXhPZignLnNwbGl0KCcpICE9PSAtMSB8fCBpdGVtLmluZGV4T2YoJy5qb2luKCcpICE9PSAtMSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpdGVtLmluZGV4T2YoJ3JldmVyc2UnKSAhPT0gLTEpIHsKICAgICAgICAgICAgYWN0TGlzdC5wdXNoKFsncmV2ZXJzZScsIG51bGxdKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbSA9IGl0ZW0ubWF0Y2goL3NwbGljZVwoKFxkKylcKS8pOwogICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgbSA9IHBhcnNlSW50KG1bMV0pOwogICAgICAgICAgICBpZiAoaXNOYU4obSkpIHJldHVybjsKICAgICAgICAgICAgYWN0TGlzdC5wdXNoKFsnc3BsaWNlJywgbV0pOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBtID0gaXRlbS5tYXRjaCgvc2xpY2VcKChcZCspXCkvKTsKICAgICAgICAgIGlmIChtKSB7CiAgICAgICAgICAgIG0gPSBwYXJzZUludChtWzFdKTsKICAgICAgICAgICAgaWYgKGlzTmFOKG0pKSByZXR1cm47CiAgICAgICAgICAgIGFjdExpc3QucHVzaChbJ3NsaWNlJywgbV0pOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBtID0gaXRlbS5tYXRjaCgvXFsoXGQrKSVcdytcLmxlbmd0aC8pOwogICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgbSA9IHBhcnNlSW50KG1bMV0pOwogICAgICAgICAgICBpZiAoaXNOYU4obSkpIHJldHVybjsKICAgICAgICAgICAgYWN0TGlzdC5wdXNoKFsnc3dhcCcsIG1dKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFjdExpc3Q7CiAgICAgIH0sCiAgICAgIGdldENoaXA6IGZ1bmN0aW9uKGRhdGEsIGNiKSB7CiAgICAgICAgdmFyIHN0cyA9IGRhdGEubWF0Y2goLyxzdHM6KFxkKykvKTsKICAgICAgICBzdHMgPSBzdHMgJiYgc3RzWzFdOwoKICAgICAgICB2YXIgYWN0TGlzdCA9IFtdOwogICAgICAgIHZhciBmdW5jTmFtZSA9IGRhdGEubWF0Y2goL1wuc2lnXHxcfChbJF9hLXpBLVowLTldKylcKC8pOwogICAgICAgIGlmICghZnVuY05hbWUpIHsKICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgIH0KICAgICAgICBmdW5jTmFtZSA9IGZ1bmNOYW1lWzFdOwogICAgICAgIGZ1bmNOYW1lID0gZnVuY05hbWUucmVwbGFjZSgvXCQvZywgJ1xcJCcpOwogICAgICAgIHZhciBmdW5jID0gZGF0YS5tYXRjaChuZXcgUmVnRXhwKCIoKD86ZnVuY3Rpb24gIiArIGZ1bmNOYW1lICsgInwoPzp2YXIgfCx8O1xuKSIgKyBmdW5jTmFtZSArICI9ZnVuY3Rpb24pXFwoKFtcXHckXSspXFwpe1tefV0qfSlbOyxdIikpOwogICAgICAgIGlmICghZnVuYykgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQogICAgICAgIHZhciB2TmFtZSA9IGZ1bmNbMl07CiAgICAgICAgZnVuYyA9IGZ1bmNbMV07CiAgICAgICAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAoIltcXHckXStcXC5bXFx3JF0rXFwoIiArIHZOYW1lICsgIlteKV0qXFwpIiwgJ2cnKTsKICAgICAgICB2YXIgc0Z1bmNMaXN0ID0gZnVuYy5tYXRjaChyZWdleHApOwogICAgICAgIGlmICghc0Z1bmNMaXN0KSB7CiAgICAgICAgICBhY3RMaXN0ID0gdGhpcy5yZWFkT2JmRnVuYyhmdW5jLCBkYXRhKTsKICAgICAgICAgIGlmIChhY3RMaXN0ICYmIGFjdExpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXR1cm4gY2IoYWN0TGlzdCwgc3RzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgIH0KICAgICAgICB2YXIgb2JqTmFtZSA9ICcnOwogICAgICAgIHZhciBvYmpFbExpc3QgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IHNGdW5jTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICB2YXIgbSA9IGl0ZW0ubWF0Y2goLyhbXHckXSspXC4oW1x3JF0rKVwoW1x3JF0rLD8oW1x3JF0rKT9cKS8pOwogICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgb2JqTmFtZSA9IG1bMV07CiAgICAgICAgICAgIG9iakVsTGlzdC5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiBtWzJdLAogICAgICAgICAgICAgIGFyZzogcGFyc2VJbnQobVszXSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBzUG9zID0gZGF0YS5pbmRleE9mKCd2YXIgJyArIG9iak5hbWUgKyAnPXsnKTsKICAgICAgICBpZiAoc1BvcyA9PT0gLTEpIHsKICAgICAgICAgIHNQb3MgPSBkYXRhLmluZGV4T2YoJywnICsgb2JqTmFtZSArICc9eycpOwogICAgICAgIH0KICAgICAgICBpZiAoc1BvcyA9PT0gLTEpIHsKICAgICAgICAgIHNQb3MgPSBkYXRhLmluZGV4T2Yob2JqTmFtZSArICc9eycpOwogICAgICAgIH0KICAgICAgICB2YXIgcGxhY2UgPSBkYXRhLnN1YnN0cihzUG9zLCAzMDApOwogICAgICAgIGZvciAoaSA9IDAsIGl0ZW07IGl0ZW0gPSBvYmpFbExpc3RbaV07IGkrKykgewogICAgICAgICAgdmFyIHZOYW1lID0gaXRlbS5uYW1lOwogICAgICAgICAgcmVnZXhwID0gbmV3IFJlZ0V4cCh2TmFtZSArICI6KGZ1bmN0aW9uXFwoWyRcXHcsXStcXCl7W159XSt9KSIpOwogICAgICAgICAgdmFyIHNGID0gcGxhY2UubWF0Y2gocmVnZXhwKTsKICAgICAgICAgIGlmICghc0YpIHsKICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICB9CiAgICAgICAgICBzRiA9IHNGWzFdOwogICAgICAgICAgaWYgKHNGLmluZGV4T2YoJ3NwbGljZScpICE9PSAtMSkgewogICAgICAgICAgICBpZiAoaXNOYU4oaXRlbS5hcmcpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWN0TGlzdC5wdXNoKFsnc3BsaWNlJywgaXRlbS5hcmddKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKHNGLmluZGV4T2YoJ3NsaWNlJykgIT09IC0xKSB7CiAgICAgICAgICAgIGlmIChpc05hTihpdGVtLmFyZykpIHsKICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhY3RMaXN0LnB1c2goWydzbGljZScsIGl0ZW0uYXJnXSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmIChzRi5pbmRleE9mKCdyZXZlcnNlJykgIT09IC0xKSB7CiAgICAgICAgICAgIGl0ZW0uYXJnID0gbnVsbDsKICAgICAgICAgICAgYWN0TGlzdC5wdXNoKFsncmV2ZXJzZScsIGl0ZW0uYXJnXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaXNOYU4oaXRlbS5hcmcpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWN0TGlzdC5wdXNoKFsnc3dhcCcsIGl0ZW0uYXJnXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNiKGFjdExpc3QsIHN0cyk7CiAgICAgIH0sCiAgICAgIGdldFBsYXllcjogZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIGlmIChtZXNzYWdlLnVybC5zdWJzdHIoMCwgMikgPT09ICcvLycpIHsKICAgICAgICAgIG1lc3NhZ2UudXJsID0gJ2h0dHBzOicgKyBtZXNzYWdlLnVybDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtb25vLnJlcXVlc3QoewogICAgICAgICAgdXJsOiBtZXNzYWdlLnVybAogICAgICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcCwgZGF0YSkgewogICAgICAgICAgaWYgKGVyciB8fCAhZGF0YSkgewogICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gX3RoaXMuZ2V0Q2hpcChkYXRhLCBjYik7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGNoZWNrQWN0TGlzdDogZnVuY3Rpb24oc3RzLCBhY3RMaXN0LCB1cmwsIGNiKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICByZXR1cm4gbW9uby5yZXF1ZXN0KHsKICAgICAgICAgIHR5cGU6ICdIRUFEJywKICAgICAgICAgIHVybDogdXJsCiAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7CiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiBjYigwKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpcy5hZGREZWNoaXBMaXN0KHN0cywgYWN0TGlzdCk7CiAgICAgICAgICByZXR1cm4gY2IoMSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIHN0b3JhZ2U6IG51bGwsCiAgICAgIGdldERlY2hpcExpc3Q6IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICBpZiAoX3RoaXMuc3RvcmFnZSkgewogICAgICAgICAgcmV0dXJuIGNiKF90aGlzLnN0b3JhZ2UpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1vbm8uc3RvcmFnZS5nZXQoJ3l0RGVjaGlwTGlzdCcsIGZ1bmN0aW9uKHN0b3JhZ2UpIHsKICAgICAgICAgIHZhciBzdHNPYmogPSBfdGhpcy5zdG9yYWdlID0gc3RvcmFnZS55dERlY2hpcExpc3QgfHwge307CiAgICAgICAgICByZXR1cm4gY2Ioc3RzT2JqKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgYWRkRGVjaGlwTGlzdDogZnVuY3Rpb24oc3RzLCBhY3RMaXN0KSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICBpZiAoIXN0cykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxhc3RTdHMgPSB5b3V0dWJlX2NvbV9lbWJlZC5sYXN0U3RzOwogICAgICAgIGxhc3RTdHNbMF0gPSBzdHM7CiAgICAgICAgbGFzdFN0c1sxXSA9IGFjdExpc3Q7CgogICAgICAgIF90aGlzLnN0b3JhZ2Vbc3RzXSA9IGFjdExpc3Q7CgogICAgICAgIE9iamVjdC5rZXlzKF90aGlzLnN0b3JhZ2UpLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgcmV0dXJuIGEgPCBiID8gMSA6IC0xCiAgICAgICAgfSkuc2xpY2UoMykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIGRlbGV0ZSBfdGhpcy5zdG9yYWdlW2tleV07CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBtb25vLnN0b3JhZ2Uuc2V0KHsKICAgICAgICAgIHl0RGVjaGlwTGlzdDogX3RoaXMuc3RvcmFnZQogICAgICAgIH0pOwogICAgICB9LAogICAgICAvKioKICAgICAgICogQHBhcmFtIHt7c3RzOiBOdW1iZXIsIHVybDogU3RyaW5nfX0gbWVzc2FnZQogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYgogICAgICAgKi8KICAgICAgZGVjaGlwOiBmdW5jdGlvbihtZXNzYWdlLCBjYikgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgcmV0dXJuIF90aGlzLmdldERlY2hpcExpc3QoZnVuY3Rpb24oc3RzT2JqKSB7CiAgICAgICAgICBpZiAobWVzc2FnZS5zdHMpIHsKICAgICAgICAgICAgdmFyIGFjdExpc3QgPSBzdHNPYmpbbWVzc2FnZS5zdHNdOwogICAgICAgICAgICBpZiAoYWN0TGlzdCkgewogICAgICAgICAgICAgIHJldHVybiBjYihhY3RMaXN0LCBwYXJzZUludChtZXNzYWdlLnN0cyksIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF90aGlzLmdldFBsYXllcihtZXNzYWdlLCBmdW5jdGlvbihhY3RMaXN0LCBzdHMpIHsKICAgICAgICAgICAgaWYgKGFjdExpc3QgJiYgYWN0TGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKGFjdExpc3QsIHBhcnNlSW50KHN0cykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIHByZXBhcmVMYXN0U3RzOiBmdW5jdGlvbihjYikgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBpZiAoX3RoaXMucHJlcGFyZUxhc3RTdHMucmVhZHkpIHsKICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgfQogICAgICBfdGhpcy5wcmVwYXJlTGFzdFN0cy5yZWFkeSA9IHRydWU7CgogICAgICByZXR1cm4gbW9uby5zdG9yYWdlLmdldCgneXREZWNoaXBMaXN0JywgZnVuY3Rpb24oc3RvcmFnZSkgewogICAgICAgIHZhciBzdHNPYmogPSBzdG9yYWdlLnl0RGVjaGlwTGlzdCA9IHN0b3JhZ2UueXREZWNoaXBMaXN0IHx8IHt9OwogICAgICAgIF90aGlzLnl0SHRtbDVTaWdEZWNpcGhlci5zdG9yYWdlID0gc3RzT2JqOwoKICAgICAgICB2YXIgbGFzdFN0cyA9IF90aGlzLmxhc3RTdHM7CiAgICAgICAgc3RzT2JqW2xhc3RTdHNbMF1dID0gbGFzdFN0c1sxXTsKCiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhzdHNPYmopLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgcmV0dXJuIGEgPCBiID8gMSA6IC0xCiAgICAgICAgfSk7CgogICAgICAgIGlmIChsYXN0U3RzWzBdIDwga2V5c1swXSkgewogICAgICAgICAgbGFzdFN0c1swXSA9IGtleXNbMF07CiAgICAgICAgICBsYXN0U3RzWzFdID0gc3RzT2JqW2tleXNbMF1dOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIGdldFNpZ25hdHVyZUZyb21IdG1sOiBmdW5jdGlvbihkYXRhLCBjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBzY3JpcHQgPSBtb25vLmdldFBhZ2VTY3JpcHQoZGF0YSwgL3l0cGxheWVyXC5jb25maWdccys9XHMrLyk7CiAgICAgIGlmICghc2NyaXB0Lmxlbmd0aCkgewogICAgICAgIHJldHVybiBjYigpOwogICAgICB9CiAgICAgIHNjcmlwdCA9IHNjcmlwdFswXTsKCiAgICAgIHZhciBqc29uTGlzdCA9IG1vbm8uZmluZEpzb24oc2NyaXB0LCBbLyJhc3NldHMiOi8sIC8ic3RzIjpcZCsvXSk7CiAgICAgIGlmICghanNvbkxpc3QubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KICAgICAganNvbkxpc3QgPSBqc29uTGlzdFswXTsKCiAgICAgIGlmICghanNvbkxpc3Quc3RzIHx8ICFqc29uTGlzdC5hc3NldHMgfHwgIWpzb25MaXN0LmFzc2V0cy5qcykgewogICAgICAgIHJldHVybiBjYigpOwogICAgICB9CgogICAgICByZXR1cm4gY2IoewogICAgICAgIHN0czogcGFyc2VJbnQoanNvbkxpc3Quc3RzKSwKICAgICAgICB1cmw6IGpzb25MaXN0LmFzc2V0cy5qcwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBnZXRDdXJyZW50U3RzOiBmdW5jdGlvbihjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tLycKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgaWYgKGVyciB8fCAhZGF0YSkgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQoKICAgICAgICBfdGhpcy5nZXRTaWduYXR1cmVGcm9tSHRtbChkYXRhLCBjYik7CiAgICAgIH0pOwogICAgfQogIH07CgogIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgewogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24oX21vbm8sIF9lbmdpbmUpIHsKICAgICAgbW9ubyA9IF9tb25vOwogICAgICBlbmdpbmUgPSBfZW5naW5lOwogICAgICByZXR1cm4geW91dHViZV9jb21fZW1iZWQ7CiAgICB9OwogIH0gZWxzZSB7CiAgICBlbmdpbmUubW9kdWxlcy55b3V0dWJlID0geW91dHViZV9jb21fZW1iZWQ7CiAgfQogIHZhciBmYWNlYm9va19jb21fZW1iZWQgPSB7CiAgICBnZXRGYWNlYm9va0xpbmtzOiBmdW5jdGlvbihyZXF1ZXN0LCBjYWxsYmFjaykgewogICAgICB2YXIgY2FsbGJhY2tfbGlua3MgPSBmdW5jdGlvbihsaW5rcywgdGl0bGUsIHRodW1iLCBkdXJhdGlvbikgewogICAgICAgIHZhciByZXNwb25zZSA9IHsKICAgICAgICAgIGFjdGlvbjogcmVxdWVzdC5hY3Rpb24sCiAgICAgICAgICBleHRWaWRlb0lkOiByZXF1ZXN0LmV4dFZpZGVvSWQsCiAgICAgICAgICBsaW5rczogbGlua3MgfHwgbnVsbCwKICAgICAgICAgIHRpdGxlOiB0aXRsZSB8fCAnJywKICAgICAgICAgIHRodW1iOiB0aHVtYiB8fCAnJywKICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbiB8fCAnJwogICAgICAgIH07CgogICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTsKICAgICAgfTsKCiAgICAgIGZhY2Vib29rX2NvbV9lbWJlZC5fZ2V0RmFjZWJvb2tMaW5rcyhyZXF1ZXN0LmV4dFZpZGVvSWQsIGNhbGxiYWNrX2xpbmtzKTsKICAgIH0sCgogICAgX2dldEZhY2Vib29rTGlua3M6IGZ1bmN0aW9uKHZpZGVvSWQsIGNiKSB7CiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdHlwZTogJ0dFVCcsCiAgICAgICAgdXJsOiAnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3ZpZGVvLnBocD92PScgKyB2aWRlb0lkCiAgICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcCwgZGF0YSkgewogICAgICAgIGlmIChlcnIgfHwgIWRhdGEpIHsKICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgIH0KCiAgICAgICAgZmFjZWJvb2tfY29tX2VtYmVkLmdldExpbmtzRnJvbURhdGEoZGF0YSwgdmlkZW9JZCwgY2IpOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRMaW5rc0Zyb21EYXRhOiBmdW5jdGlvbihkYXRhLCB2aWRlb0lkLCBjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBtYXRjaCA9IGRhdGEubWF0Y2goL1xbInBhcmFtcyIsIihbXiJdKikiXF0vaW0pOwogICAgICB2YXIgbVRpdGxlID0gZGF0YS5tYXRjaCgvPGgyW14+XSo+KFtePF0qKTxcL2gyPi9pbSk7CiAgICAgIGlmICghbVRpdGxlKSB7CiAgICAgICAgbVRpdGxlID0gWycnLCAnJ107CiAgICAgIH0KICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgIHJldHVybiB0aGlzLmdldExpbmtzRnJvbURhdGEyKGRhdGEsIHZpZGVvSWQsIGNiKTsKICAgICAgfQogICAgICB2YXIgdmlkZW9EYXRhID0gbnVsbDsKICAgICAgdHJ5IHsKICAgICAgICB2aWRlb0RhdGEgPSBKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudChKU09OLnBhcnNlKCciJyArIG1hdGNoWzFdICsgJyInKSkpLnZpZGVvX2RhdGE7CiAgICAgICAgaWYgKHZpZGVvRGF0YS5wcm9ncmVzc2l2ZSkgewogICAgICAgICAgdmlkZW9EYXRhID0gdmlkZW9EYXRhLnByb2dyZXNzaXZlOwogICAgICAgIH0KICAgICAgICBpZiAoIXZpZGVvRGF0YSkgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KCiAgICAgIHZhciB0aHVtYiA9IG51bGw7CiAgICAgIHZhciBkdXJhdGlvbiA9IG51bGw7CgogICAgICB2YXIgbGlua3MgPSBbXTsKICAgICAgdmFyIHR5cGVNYXAgPSB7CiAgICAgICAgc2Rfc3JjOiAnU0QnLAogICAgICAgIGhkX3NyYzogJ0hEJwogICAgICB9OwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmlkZW9EYXRhKSkgewogICAgICAgIHZpZGVvRGF0YSA9IFt2aWRlb0RhdGFdOwogICAgICB9CiAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gdmlkZW9EYXRhW2ldOyBpKyspIHsKICAgICAgICBbJ3NkX3NyYycsICdoZF9zcmMnXS5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgICAgIGlmIChpdGVtLnRodW1ibmFpbF9zcmMpIHsKICAgICAgICAgICAgdGh1bWIgPSBpdGVtLnRodW1ibmFpbF9zcmM7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGl0ZW0udmlkZW9fZHVyYXRpb24pIHsKICAgICAgICAgICAgZHVyYXRpb24gPSBpdGVtLnZpZGVvX2R1cmF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghaXRlbVt0eXBlXSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGV4dCA9IGZhY2Vib29rX2NvbV9lbWJlZC5nZXRGaWxlRXh0ZW5zaW9uKGl0ZW1bdHlwZV0sICdtcDQnKTsKICAgICAgICAgIGxpbmtzLnB1c2goewogICAgICAgICAgICB1cmw6IGl0ZW1bdHlwZV0sCiAgICAgICAgICAgIG5hbWU6IHR5cGVNYXBbdHlwZV0sCiAgICAgICAgICAgIHR5cGU6IGV4dCwKICAgICAgICAgICAgZXh0OiBleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGNiKGxpbmtzLCBtVGl0bGVbMV0sIHRodW1iLCBkdXJhdGlvbik7CiAgICB9LAoKICAgIGdldExpbmtzRnJvbURhdGEyOiBmdW5jdGlvbihkYXRhLCB2aWRlb0lkLCBjYikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciB0aXRsZSA9IGRhdGEubWF0Y2goLzxoMltePl0qPihbXjxdKik8XC9oMj4vaW0pOwogICAgICB0aXRsZSA9IHRpdGxlICYmIHRpdGxlWzFdOwoKICAgICAgZGF0YSA9IGRhdGEubWF0Y2goLyJ2aWRlb0RhdGEiOlxbKFteXF1dKylcXS8pOwogICAgICBkYXRhID0gZGF0YSAmJiBkYXRhWzFdOwoKICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KCiAgICAgIHZhciBqc29uTGlzdCA9IG1vbm8uZmluZEpzb24oZGF0YSwgWy8iKHNkfGhkKV9zcmMiOi8sIG5ldyBSZWdFeHAodmlkZW9JZCldKTsKICAgICAgaWYgKCFqc29uTGlzdCB8fCAhanNvbkxpc3QubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KCiAgICAgIHZhciBwYXJhbXMgPSBqc29uTGlzdFswXTsKCiAgICAgIGlmIChTdHJpbmcocGFyYW1zLnZpZGVvX2lkKSAhPT0gU3RyaW5nKHZpZGVvSWQpKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KCiAgICAgIHZhciBsaW5rcyA9IFtdOwoKICAgICAgdmFyIGV4dDsKICAgICAgaWYgKHBhcmFtcy5zZF9zcmMpIHsKICAgICAgICBleHQgPSBmYWNlYm9va19jb21fZW1iZWQuZ2V0RmlsZUV4dGVuc2lvbihwYXJhbXMuc2Rfc3JjLCAnbXA0Jyk7CiAgICAgICAgbGlua3MucHVzaCh7CiAgICAgICAgICB1cmw6IHBhcmFtcy5zZF9zcmMsCiAgICAgICAgICBuYW1lOiAnU0QnLAogICAgICAgICAgdHlwZTogZXh0LAogICAgICAgICAgZXh0OiBleHQudG9VcHBlckNhc2UoKQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChwYXJhbXMuaGRfc3JjKSB7CiAgICAgICAgZXh0ID0gZmFjZWJvb2tfY29tX2VtYmVkLmdldEZpbGVFeHRlbnNpb24ocGFyYW1zLmhkX3NyYywgJ21wNCcpOwogICAgICAgIGxpbmtzLnB1c2goewogICAgICAgICAgdXJsOiBwYXJhbXMuaGRfc3JjLAogICAgICAgICAgbmFtZTogJ0hEJywKICAgICAgICAgIHR5cGU6IGV4dCwKICAgICAgICAgIGV4dDogZXh0LnRvVXBwZXJDYXNlKCkKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNiKGxpbmtzLCB0aXRsZSwgcGFyYW1zLnRodW1ibmFpbF9zcmMsIHBhcmFtcy52aWRlb19kdXJhdGlvbik7CiAgICB9LAoKICAgIGdldEZpbGVFeHRlbnNpb246IGZ1bmN0aW9uKHN0ciwgZGVmKSB7CiAgICAgIHZhciBleHQgPSBzdHIubWF0Y2goL1wuKFthLXowLTldezMsNH0pKFw/fCQpL2kpOwogICAgICBpZiAoZXh0KSB7CiAgICAgICAgZXh0ID0gZXh0WzFdOwogICAgICAgIHJldHVybiBleHQudG9Mb3dlckNhc2UoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIChkZWYgPyBkZWYgOiAnJyk7CiAgICB9LAoKICAgIGdldEZhY2Vib29rUGhvdG9Vcmw6IGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgIGlmICghbWVzc2FnZS5mYmlkKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICB1cmw6ICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vcGhvdG8ucGhwP2ZiaWQ9JyArIG1lc3NhZ2UuZmJpZAogICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICBpZiAoZXJyIHx8ICFkYXRhKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIHZhciBtID0gZGF0YS5tYXRjaCgvPGFbXj5dK2ZiUGhvdG9zUGhvdG9BY3Rpb25zSXRlbVtePl0raHJlZj0iKFteIj5dK2RsPTEpIltePl0rPi9pKTsKICAgICAgICBpZiAobSkgewogICAgICAgICAgdmFyIHVybCA9IG1bMV07CiAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgvJmFtcDsvZywgJyYnKTsKICAgICAgICAgIHJldHVybiBjYih1cmwpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgewogICAgZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24oX21vbm8sIF9lbmdpbmUpIHsKICAgICAgbW9ubyA9IF9tb25vOwogICAgICBlbmdpbmUgPSBfZW5naW5lOwogICAgICByZXR1cm4gZmFjZWJvb2tfY29tX2VtYmVkOwogICAgfTsKICB9IGVsc2UgewogICAgZW5naW5lLm1vZHVsZXMuZmFjZWJvb2sgPSBmYWNlYm9va19jb21fZW1iZWQ7CiAgfQogIHZhciBtYWlsX3J1X2VtYmVkID0gewogICAgZ2V0TWFpbHJ1TGlua3M6IGZ1bmN0aW9uKHJlcXVlc3QsIGNhbGxiYWNrKSB7CiAgICAgIGZ1bmN0aW9uIGNhbGxiYWNrX2xpbmtzKGxpbmtzLCB0aXRsZSwgdGh1bWIsIHZpZCwgZHVyYXRpb24pIHsKICAgICAgICB2YXIgcmVzcG9uc2UgPSB7CiAgICAgICAgICBhY3Rpb246IHJlcXVlc3QuYWN0aW9uLAogICAgICAgICAgZXh0VmlkZW9JZDogdmlkIHx8IHJlcXVlc3QuZXh0VmlkZW9JZCwKICAgICAgICAgIGxpbmtzOiBsaW5rcywKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIHRodW1iOiB0aHVtYiwKICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbgogICAgICAgIH07CgogICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTsKICAgICAgfQoKICAgICAgbWFpbF9ydV9lbWJlZC5fZ2V0TWFpbHJ1TGlua3MocmVxdWVzdC5leHRWaWRlb0lkLCBjYWxsYmFja19saW5rcyk7CiAgICB9LAogICAgX2dldE1haWxydUxpbmtzOiBmdW5jdGlvbihwYXRobmFtZSwgY2FsbGJhY2spIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgbWV0YWRhdGFVcmwsIHZQYXRoID0gcGF0aG5hbWU7CiAgICAgIHZhciB2aWRlb0lkID0gcGF0aG5hbWUubWF0Y2goL1wvKFteXC9dKylcLyhbXlwvXSspXC92aWRlb1wvKC4rKS5odG1sLyk7CiAgICAgIGlmICghdmlkZW9JZCkgewogICAgICAgIHZpZGVvSWQgPSBwYXRobmFtZS5tYXRjaCgvZW1iZWRcLyhbXlwvXSspXC8oW15cL10rKVwvKC4rKS5odG1sLyk7CiAgICAgIH0KICAgICAgaWYgKHZpZGVvSWQpIHsKICAgICAgICBtZXRhZGF0YVVybCA9ICdodHRwOi8vYXBpLnZpZGVvLm1haWwucnUvdmlkZW9zLycgKyB2aWRlb0lkWzFdICsgJy8nICsgdmlkZW9JZFsyXSArICcvJyArIHZpZGVvSWRbM10gKyAnLmpzb24nOwogICAgICAgIHZQYXRoID0gdmlkZW9JZFsxXSArICcvJyArIHZpZGVvSWRbMl0gKyAnL3ZpZGVvLycgKyB2aWRlb0lkWzNdICsgJy5odG1sJzsKICAgICAgfQogICAgICBpZiAobWV0YWRhdGFVcmwpIHsKICAgICAgICByZXR1cm4gbWFpbF9ydV9lbWJlZC5vbkdldE1haWxydU1ldGFkYXRhVXJsKG1ldGFkYXRhVXJsLCB2UGF0aCwgY2FsbGJhY2spOwogICAgICB9CiAgICAgIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgdXJsOiAnaHR0cDovL215Lm1haWwucnUvJyArIHBhdGhuYW1lCiAgICAgIH0sIGZ1bmN0aW9uKGVyciwgcmVzcCwgZGF0YSkgewogICAgICAgIGlmIChlcnIgfHwgIWRhdGEpIHsKICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGpzb25SZSA9IC8ibWV0YVVybCI6LzsKICAgICAgICB2YXIgcGFnZUNvbmZpZyA9IG51bGw7CiAgICAgICAgbW9uby5nZXRQYWdlU2NyaXB0KGRhdGEsIGpzb25SZSkuc29tZShmdW5jdGlvbihzY3JpcHQpIHsKICAgICAgICAgIHJldHVybiBtb25vLmZpbmRKc29uKHNjcmlwdCwganNvblJlKS5zb21lKGZ1bmN0aW9uKGpzb24pIHsKICAgICAgICAgICAgaWYgKGpzb24ubWV0YVVybCkgewogICAgICAgICAgICAgIHBhZ2VDb25maWcgPSBqc29uOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHBhZ2VDb25maWcpIHsKICAgICAgICAgIG1ldGFkYXRhVXJsID0gcGFnZUNvbmZpZy5tZXRhVXJsOwogICAgICAgICAgbWFpbF9ydV9lbWJlZC5vbkdldE1haWxydU1ldGFkYXRhVXJsKG1ldGFkYXRhVXJsLCB2UGF0aCwgY2FsbGJhY2spOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZGF0YSA9IGRhdGEubWF0Y2goLzxtZXRhXHMrY29udGVudD0iW14iXSsodmlkZW9hcGlcLm15XC5tYWlsW14mXSspJlteIl0rIltePl0rXC8+Lyk7CiAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTsKICAgICAgICB9CiAgICAgICAgZGF0YSA9IGRlY29kZVVSSUNvbXBvbmVudChkYXRhWzFdKTsKICAgICAgICB2YXIgdmlkID0gZGF0YS5zdWJzdHIoZGF0YS5sYXN0SW5kZXhPZignLycpICsgMSk7CiAgICAgICAgbWV0YWRhdGFVcmwgPSAnaHR0cDovL3ZpZGVvYXBpLm15Lm1haWwucnUvdmlkZW9zLycgKyB2aWQgKyAnLmpzb24nOwogICAgICAgIG1haWxfcnVfZW1iZWQub25HZXRNYWlscnVNZXRhZGF0YVVybChtZXRhZGF0YVVybCwgdlBhdGgsIGNhbGxiYWNrKTsKICAgICAgfSk7CiAgICB9LAogICAgb25HZXRNYWlscnVNZXRhZGF0YVVybDogZnVuY3Rpb24obWV0YWRhdGFVcmwsIHZQYXRoLCBjYWxsYmFjaykgewogICAgICBtYWlsX3J1X2VtYmVkLmdldE1haWxydU1ldGFkYXRhKG1ldGFkYXRhVXJsLCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgaWYgKCFkYXRhIHx8IHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7CiAgICAgICAgfQogICAgICAgIG1haWxfcnVfZW1iZWQucmVhZE1haWxydU1ldGFkYXRhKGRhdGEsIGZ1bmN0aW9uKF9saW5rcywgdGl0bGUsIHRodW1iLCBkdXJhdGlvbikgewogICAgICAgICAgY2FsbGJhY2sobWFpbF9ydV9lbWJlZC5wcmVwTWFpbHJ1TGlua3MoX2xpbmtzKSwgdGl0bGUsIHRodW1iLCB2UGF0aCwgZHVyYXRpb24pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBwcmVwTWFpbHJ1TGlua3M6IGZ1bmN0aW9uKF9saW5rcykgewogICAgICBpZiAoIV9saW5rcykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgbGlua3MgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxpbms7IGxpbmsgPSBfbGlua3NbaV07IGkrKykgewogICAgICAgIHZhciB1cmwgPSBsaW5rLnVybDsKICAgICAgICB2YXIgZm9ybWF0ID0gJ0ZMVic7CiAgICAgICAgaWYgKHVybC5pbmRleE9mKCcubXA0JykgIT09IC0xKSB7CiAgICAgICAgICBmb3JtYXQgPSAnTVA0JzsKICAgICAgICB9CiAgICAgICAgaWYgKHVybC5pbmRleE9mKCcubW92JykgIT09IC0xKSB7CiAgICAgICAgICBmb3JtYXQgPSAnTU9WJzsKICAgICAgICB9CiAgICAgICAgaWYgKHVybC5pbmRleE9mKCcubXBnJykgIT09IC0xKSB7CiAgICAgICAgICBmb3JtYXQgPSAnTVBHJzsKICAgICAgICB9CiAgICAgICAgaWYgKCFsaW5rLnF1YWxpdHkpIHsKICAgICAgICAgIGxpbmsucXVhbGl0eSA9ICctPy0nOwogICAgICAgIH0KICAgICAgICB2YXIgcXVhbGl0eSA9IGxpbmsucXVhbGl0eS50b1VwcGVyQ2FzZSgpOwoKICAgICAgICB2YXIgcUxpc3QgPSBbJzEwODBQJywgJzcyMFAnLCAnNDgwUCcsICczNjBQJywgJzI3MlAnXTsKICAgICAgICB2YXIgdExpc3QgPSBbJzEwODAnLCAnNzIwJywgJzQ4MCcsICczNjAnLCAnMjcyJ107CgogICAgICAgIHZhciBxUG9zID0gcUxpc3QuaW5kZXhPZihxdWFsaXR5KTsKICAgICAgICBpZiAocVBvcyAhPT0gLTEpIHsKICAgICAgICAgIHF1YWxpdHkgPSB0TGlzdFtxUG9zXTsKICAgICAgICB9CgogICAgICAgIHZhciBleHQgPSBmb3JtYXQudG9Mb3dlckNhc2UoKTsKICAgICAgICBsaW5rcy5wdXNoKHsKICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgc3VibmFtZTogcXVhbGl0eSwKICAgICAgICAgIG5hbWU6IGZvcm1hdCwKICAgICAgICAgIGV4dDogZXh0CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgbGlua3Muc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKGEuc3VibmFtZSA9PT0gJ0hEJykgewogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhLnN1Ym5hbWUgPiBiLnN1Ym5hbWU7CiAgICAgIH0pOwogICAgICByZXR1cm4gbGlua3M7CiAgICB9LAogICAgZ2V0TWFpbHJ1TWV0YWRhdGE6IGZ1bmN0aW9uKHVybCwgY2IpIHsKICAgICAgaWYgKCF1cmwpIHsKICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgfQogICAgICBtb25vLnJlcXVlc3QoewogICAgICAgIHVybDogdXJsLAogICAgICAgIGpzb246IHRydWUKICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBqc29uKSB7CiAgICAgICAgaWYgKGVyciB8fCAhanNvbikgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQoKICAgICAgICBjYihqc29uKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVhZE1haWxydU1ldGFkYXRhOiBmdW5jdGlvbihtZXRhZGF0YSwgY2IpIHsKICAgICAgdmFyIGxpbmtzID0gW10sCiAgICAgICAgdGl0bGU7CiAgICAgIC8qKgogICAgICAgKiBAbmFtZXNwYWNlIG1ldGFkYXRhLnByb3ZpZGVyIE9iamVjdAogICAgICAgKiBAbmFtZXNwYWNlIG1ldGFkYXRhLm1vdmllIE9iamVjdAogICAgICAgKiBAbmFtZXNwYWNlIG1ldGFkYXRhLnZpZGVvcyBPYmplY3QKICAgICAgICogQG5hbWVzcGFjZSBtZXRhZGF0YS5tZXRhIE9iamVjdAogICAgICAgKiBAbmFtZXNwYWNlIG1ldGFkYXRhLm1ldGEucG9zdGVyIE9iamVjdAogICAgICAgKi8KICAgICAgdmFyIGR1cmF0aW9uID0gdW5kZWZpbmVkOwogICAgICB2YXIgdGh1bWIgPSB1bmRlZmluZWQ7CiAgICAgIGlmIChtZXRhZGF0YS5tZXRhKSB7CiAgICAgICAgdGh1bWIgPSBtZXRhZGF0YS5tZXRhLnBvc3RlcjsKICAgICAgICBkdXJhdGlvbiA9IG1ldGFkYXRhLm1ldGEuZHVyYXRpb247CiAgICAgIH0KICAgICAgaWYgKG1ldGFkYXRhLnByb3ZpZGVyID09PSAnVVBMT0FERUQnKSB7CiAgICAgICAgdGl0bGUgPSBtZXRhZGF0YS5tb3ZpZSA/IG1ldGFkYXRhLm1vdmllLnRpdGxlIDogdW5kZWZpbmVkOwogICAgICAgIGlmICghbWV0YWRhdGEudmlkZW9zKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CiAgICAgICAgbWV0YWRhdGEudmlkZW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgbGlua3MucHVzaCh7CiAgICAgICAgICAgIHF1YWxpdHk6IGl0ZW0ubmFtZSwKICAgICAgICAgICAgdXJsOiBpdGVtLnVybCwKICAgICAgICAgICAgdGl0bGU6IHRpdGxlCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlCiAgICAgIGlmIChtZXRhZGF0YS5wcm92aWRlciA9PT0gJ3VnYycpIHsKICAgICAgICB0aXRsZSA9IG1ldGFkYXRhLm1ldGEgPyBtZXRhZGF0YS5tZXRhLnRpdGxlIDogdW5kZWZpbmVkOwogICAgICAgIGlmICghbWV0YWRhdGEudmlkZW9zKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CiAgICAgICAgbWV0YWRhdGEudmlkZW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgbGlua3MucHVzaCh7CiAgICAgICAgICAgIHF1YWxpdHk6IGl0ZW0ua2V5LAogICAgICAgICAgICB1cmw6IGl0ZW0udXJsLAogICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UKICAgICAgaWYgKG1ldGFkYXRhLnByb3ZpZGVyID09PSAncGxhZGZvcm0nKSB7CiAgICAgICAgdGl0bGUgPSBtZXRhZGF0YS5tZXRhID8gbWV0YWRhdGEubWV0YS50aXRsZSA6IHVuZGVmaW5lZDsKICAgICAgICB2YXIgb2tFbWJlZCA9IGVuZ2luZS5tb2R1bGVzLm9kbm9rbGFzc25pa2k7CiAgICAgICAgb2tFbWJlZC5nZXRQbGFkZm9ybVZpZGVvKHsKICAgICAgICAgIGV4dFZpZGVvSWQ6IHsKICAgICAgICAgICAgcGxheWVySWQ6IG1ldGFkYXRhLm1ldGEucGxheWVySWQsCiAgICAgICAgICAgIHZpZGVvSWQ6IG1ldGFkYXRhLm1ldGEudmlkZW9JZAogICAgICAgICAgfQogICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChyZXNwb25zZS5hY3Rpb24gPT09ICdnZXRSdXR1YmVMaW5rcycpIHsKICAgICAgICAgICAgcmVzcG9uc2UubGlua3MgPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBsaW5rcyA9IHJlc3BvbnNlLmxpbmtzOwogICAgICAgICAgaWYgKCFsaW5rcykgewogICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgIH0KICAgICAgICAgIGxpbmtzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICBpZiAoaXRlbS50aXRsZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgaXRlbS50aXRsZSA9IHRpdGxlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgY2IobGlua3MsIHRpdGxlLCB0aHVtYiwgZHVyYXRpb24pOwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAobGlua3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNiKGxpbmtzLCB0aXRsZSwgdGh1bWIsIGR1cmF0aW9uKTsKICAgIH0KICB9OwoKICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIGV4cG9ydHMuaW5pdCA9IGZ1bmN0aW9uKF9tb25vLCBfZW5naW5lKSB7CiAgICAgIG1vbm8gPSBfbW9ubzsKICAgICAgZW5naW5lID0gX2VuZ2luZTsKICAgICAgcmV0dXJuIG1haWxfcnVfZW1iZWQ7CiAgICB9OwogIH0gZWxzZSB7CiAgICBlbmdpbmUubW9kdWxlcy5tYWlsX3J1ID0gbWFpbF9ydV9lbWJlZDsKICB9CiAgdmFyIFNhdmVGcm9tX1V0aWxzID0gewogICAgZG93bmxvYWRQYXJhbTogJ3NmaC0tZG93bmxvYWQnLAoKICAgIHNldFN0eWxlOiBmdW5jdGlvbihub2RlLCBzdHlsZSkgewogICAgICBpZiAoIW5vZGUgfHwgIXN0eWxlKQogICAgICAgIHJldHVybjsKCiAgICAgIGZvciAodmFyIGkgaW4gc3R5bGUpCiAgICAgICAgbm9kZS5zdHlsZVtpXSA9IHN0eWxlW2ldOwogICAgfSwKCgogICAgZ2V0U3R5bGU6IGZ1bmN0aW9uKG5vZGUsIHByb3BlcnR5KSB7CiAgICAgIHJldHVybiBub2RlICYmIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICYmIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKG5vZGUsIG51bGwpLmdldFByb3BlcnR5VmFsdWUocHJvcGVydHkpOwogICAgfSwKCiAgICBhZGRTdHlsZVJ1bGVzOiBmdW5jdGlvbihzZWxlY3RvciwgcnVsZXMsIGNsYXNzTmFtZSkgewogICAgICB2YXIgc3R5bGUgPSBjbGFzc05hbWUgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2F2ZWZyb20tc3R5bGVzLicgKyBjbGFzc05hbWUpIDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmVmcm9tLXN0eWxlcycpOwogICAgICBpZiAoIXN0eWxlKSB7CiAgICAgICAgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgICAgIHN0eWxlLmlkID0gJ3NhdmVmcm9tLXN0eWxlcyc7CiAgICAgICAgaWYgKGNsYXNzTmFtZSkgewogICAgICAgICAgc3R5bGUuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpOwogICAgICAgIH0KICAgICAgICAvLyBtYXliZSBuZWVkIGZvciBzYWZhcmkKICAgICAgICAvL3N0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKSk7CiAgICAgICAgdmFyIHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkIHN0eWxlJyk7CiAgICAgICAgaWYgKHMpCiAgICAgICAgLy8gYWxsb3cgdG8gb3ZlcnJpZGUgb3VyIHN0eWxlcwogICAgICAgICAgcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzdHlsZSwgcyk7CiAgICAgICAgZWxzZQogICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZCcpLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZihydWxlcykgPT0gJ29iamVjdCcpIHsKICAgICAgICB2YXIgciA9IFtdOwogICAgICAgIGZvciAodmFyIGkgaW4gcnVsZXMpCiAgICAgICAgICByLnB1c2goaSArICc6JyArIHJ1bGVzW2ldKTsKCiAgICAgICAgcnVsZXMgPSByLmpvaW4oJzsnKTsKICAgICAgfQoKICAgICAgc3R5bGUudGV4dENvbnRlbnQgKz0gc2VsZWN0b3IgKyAneycgKyBydWxlcyArICd9JzsKICAgIH0sCgogICAgZ2V0UG9zaXRpb246IGZ1bmN0aW9uKG5vZGUsIHBhcmVudCkgewogICAgICB2YXIgYm94ID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICB2YXIgcGFyZW50X3BvcyA9IHBhcmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdG9wOiBNYXRoLnJvdW5kKGJveC50b3AgLSBwYXJlbnRfcG9zLnRvcCksCiAgICAgICAgICBsZWZ0OiBNYXRoLnJvdW5kKGJveC5sZWZ0IC0gcGFyZW50X3Bvcy5sZWZ0KSwKICAgICAgICAgIHdpZHRoOiBib3gud2lkdGgsCiAgICAgICAgICBoZWlnaHQ6IGJveC5oZWlnaHQKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICB0b3A6IE1hdGgucm91bmQoYm94LnRvcCArIHdpbmRvdy5wYWdlWU9mZnNldCksCiAgICAgICAgbGVmdDogTWF0aC5yb3VuZChib3gubGVmdCArIHdpbmRvdy5wYWdlWE9mZnNldCksCiAgICAgICAgd2lkdGg6IGJveC53aWR0aCwKICAgICAgICBoZWlnaHQ6IGJveC5oZWlnaHQKICAgICAgfQogICAgfSwKCiAgICBnZXRTaXplOiBmdW5jdGlvbihub2RlKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgd2lkdGg6IG5vZGUub2Zmc2V0V2lkdGgsCiAgICAgICAgaGVpZ2h0OiBub2RlLm9mZnNldEhlaWdodAogICAgICB9OwogICAgfSwKCiAgICBnZXRNYXRjaEZpcnN0OiBmdW5jdGlvbihzdHIsIHJlKSB7CiAgICAgIHZhciBtID0gc3RyLm1hdGNoKHJlKTsKICAgICAgaWYgKG0gJiYgbS5sZW5ndGggPiAxKQogICAgICAgIHJldHVybiBtWzFdOwoKICAgICAgcmV0dXJuICcnOwogICAgfSwKCiAgICBnZXRFbGVtZW50QnlJZHM6IGZ1bmN0aW9uKGlkcykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRzW2ldKTsKICAgICAgICBpZiAobm9kZSkKICAgICAgICAgIHJldHVybiBub2RlOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgZ2V0UGFyZW50QnlDbGFzczogZnVuY3Rpb24obm9kZSwgbmFtZSkgewogICAgICBpZiAoIW5vZGUgfHwgbmFtZSA9PSAnJykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHBhcmVudDsKICAgICAgaWYgKHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JyAmJiBuYW1lLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKHBhcmVudCA9IG5vZGU7IHBhcmVudDsgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGUpIHsKICAgICAgICAgIGlmIChwYXJlbnQubm9kZVR5cGUgIT09IDEpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5hbWUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBhcmVudC5jbGFzc0xpc3QuY29udGFpbnMobmFtZVtpXSkpIHsKICAgICAgICAgICAgICByZXR1cm4gcGFyZW50OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAocGFyZW50ID0gbm9kZTsgcGFyZW50OyBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZSkgewogICAgICAgICAgaWYgKHBhcmVudC5ub2RlVHlwZSAhPT0gMSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChwYXJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKG5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiBwYXJlbnQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgZ2V0UGFyZW50QnlUYWdOYW1lOiBmdW5jdGlvbihub2RlLCB0YWdOYW1lKSB7CiAgICAgIGlmICghbm9kZSB8fCAhdGFnTmFtZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yICh2YXIgcGFyZW50ID0gbm9kZTsgcGFyZW50OyBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZSkgewogICAgICAgIGlmIChwYXJlbnQubm9kZVR5cGUgIT09IDEpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBhcmVudC50YWdOYW1lID09PSB0YWdOYW1lKSB7CiAgICAgICAgICByZXR1cm4gcGFyZW50OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIGdldFBhcmVudEJ5SWQ6IGZ1bmN0aW9uKG5vZGUsIGlkKSB7CiAgICAgIGZvciAodmFyIHBhcmVudCA9IG5vZGU7IHBhcmVudDsgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGUpIHsKICAgICAgICBpZiAocGFyZW50Lm5vZGVUeXBlICE9PSAxKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlmIChwYXJlbnQuaWQgPT09IGlkKSB7CiAgICAgICAgICByZXR1cm4gcGFyZW50OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIGhhc0NoaWxkcmVuVGFnTmFtZTogZnVuY3Rpb24obm9kZSwgdGFnTmFtZSkgewogICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IG5vZGUuY2hpbGROb2Rlc1tpXTsgaSsrKSB7CiAgICAgICAgaWYgKGl0ZW0ubm9kZVR5cGUgIT09IDEpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXRlbS50YWdOYW1lID09PSB0YWdOYW1lKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICBpc1BhcmVudDogZnVuY3Rpb24obm9kZSwgdGVzdFBhcmVudCkgewogICAgICBpZiAoIXRlc3RQYXJlbnQgfHwgWzEsIDksIDExXS5pbmRleE9mKHRlc3RQYXJlbnQubm9kZVR5cGUpID09PSAtMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRlc3RQYXJlbnQuY29udGFpbnMobm9kZSk7CiAgICB9LAoKCiAgICBlbXB0eU5vZGU6IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgd2hpbGUgKG5vZGUuZmlyc3RDaGlsZCkKICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuZmlyc3RDaGlsZCk7CiAgICB9LAoKICAgIGRvd25sb2FkOiBmdW5jdGlvbihmaWxlbmFtZSwgdXJsLCByZXF1ZXN0T3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgaWYgKCF1cmwpCiAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgZmlsZW5hbWUgPSBmaWxlbmFtZSB8fCB0aGlzLmdldEZpbGVOYW1lKHVybCk7CiAgICAgIGlmICghZmlsZW5hbWUpCiAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgaWYgKCFtb25vLmdsb2JhbC5wcmVmZXJlbmNlLmRvd25sb2FkcykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHBhcmFtcyA9IHJlcXVlc3RPcHRpb25zIHx8IHt9OwogICAgICBwYXJhbXMudXJsID0gdXJsOwogICAgICBwYXJhbXMuZmlsZW5hbWUgPSBmaWxlbmFtZTsKCiAgICAgIHZhciByZXF1ZXN0ID0gewogICAgICAgIGFjdGlvbjogJ2Rvd25sb2FkRmlsZScsCiAgICAgICAgb3B0aW9uczogcGFyYW1zCiAgICAgIH07CgogICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IHVuZGVmaW5lZDsKCiAgICAgIG1vbm8uc2VuZE1lc3NhZ2UocmVxdWVzdCwgY2FsbGJhY2spOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgZG93bmxvYWRMaXN0OiB7CiAgICAgIHNob3dEb3dubG9hZFdhcm5pbmdQb3B1cDogZnVuY3Rpb24ob25Db250aW51ZSwgdHlwZSkgewogICAgICAgIHZhciB0ZW1wbGF0ZSA9IFNhdmVGcm9tX1V0aWxzLnBsYXlsaXN0LmdldEluZm9Qb3B1cFRlbXBsYXRlKCk7CgogICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAnZ2V0V2FybmluZ0ljb24nLAogICAgICAgICAgdHlwZTogdHlwZQogICAgICAgIH0sIGZ1bmN0aW9uKGljb24pIHsKICAgICAgICAgIHRlbXBsYXRlLmljb24uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgaWNvbiArICcpJzsKICAgICAgICB9KTsKCiAgICAgICAgbW9uby5jcmVhdGUodGVtcGxhdGUudGV4dENvbnRhaW5lciwgewogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgIHRleHQ6IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLndhcm5pbmdQb3B1cFRpdGxlLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBjb2xvcjogJyMwRDBEMEQnLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICcyMHB4JywKICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzExcHgnLAogICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAnMTNweCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICB0ZXh0OiBtb25vLmdsb2JhbC5sYW5ndWFnZS53YXJuaW5nUG9wdXBEZXNjICsgJyAnLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBjb2xvcjogJyM4Njg2ODYnLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzEzcHgnLAogICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzI0cHgnLAogICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAnMHB4JwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYXBwZW5kOiBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgICAgIGhyZWY6IChtb25vLmdsb2JhbC5sYW5ndWFnZS5sYW5nID09PSAncnUnIHx8IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLmxhbmcgPT09ICd1aycpID8gJ2h0dHA6Ly92ay5jb20vcGFnZS01NTY4OTkyOV80OTAwMzU0OScgOiAnaHR0cDovL3ZrLmNvbS9wYWdlLTU1Njg5OTI5XzQ5MDA0MjU5JywKICAgICAgICAgICAgICAgIHRleHQ6IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnJlYWRNb3JlLAogICAgICAgICAgICAgICAgdGFyZ2V0OiAnX2JsYW5rJywKICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzRBOTBFMicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3AnLCB7CiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzEzcHgnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdsYWJlbCcsIHsKICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyM4Njg2ODYnLAogICAgICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLAogICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzE5cHgnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdpbnB1dCcsIHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgICBjc3NGbG9hdDogJ2xlZnQnLAogICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAnMHB4JwogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2hpZGVEb3dubG9hZFdhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIHNldDogdGhpcy5jaGVja2VkID8gMSA6IDAKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIG1vbm8uZ2xvYmFsLmxhbmd1YWdlLm5vV2FybmluZwogICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSkKICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGNhbmNlbEJ0biA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgY29udGludWVCdG4gPSB1bmRlZmluZWQ7CiAgICAgICAgbW9uby5jcmVhdGUodGVtcGxhdGUuYnV0dG9uQ29udGFpbmVyLCB7CiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgY2FuY2VsQnRuID0gbW9uby5jcmVhdGUoJ2J1dHRvbicsIHsKICAgICAgICAgICAgICB0ZXh0OiBtb25vLmdsb2JhbC5sYW5ndWFnZS5jYW5jZWwsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGhlaWdodDogJzI3cHgnLAogICAgICAgICAgICAgICAgd2lkdGg6ICcxMThweCcsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjOWU5ZTllJywKICAgICAgICAgICAgICAgIG1hcmdpbjogJzEycHgnLAogICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnMTFweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5SaWdodDogJzRweCcsCiAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc1cHgnLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgY29udGludWVCdG4gPSBtb25vLmNyZWF0ZSgnYnV0dG9uJywgewogICAgICAgICAgICAgIHRleHQ6IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLmNvbnRpbnVlLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyN3B4JywKICAgICAgICAgICAgICAgIHdpZHRoOiAnMTE4cHgnLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZmZmZicsCiAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgIzllOWU5ZScsCiAgICAgICAgICAgICAgICBtYXJnaW46ICcxMnB4JywKICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzExcHgnLAogICAgICAgICAgICAgICAgbWFyZ2luUmlnaHQ6ICc4cHgnLAogICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnNXB4JywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgdmFyIHBvcHVwID0gdGVtcGxhdGUuYm9keS5wYXJlbnROb2RlOwogICAgICAgICAgbW9uby50cmlnZ2VyKHBvcHVwLmxhc3RDaGlsZCwgJ2NsaWNrJyk7CiAgICAgICAgfSk7CgogICAgICAgIGNvbnRpbnVlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICBvbkNvbnRpbnVlKCk7CiAgICAgICAgICBtb25vLnRyaWdnZXIoY2FuY2VsQnRuLCAnY2xpY2snKTsKICAgICAgICB9KTsKCiAgICAgICAgU2F2ZUZyb21fVXRpbHMucG9wdXBEaXYodGVtcGxhdGUuYm9keSwgJ2RsX3dhcm5pbmdfYm94X3BvcHVwJyk7CiAgICAgIH0sCiAgICAgIHN0YXJ0Q2hyb21lRG93bmxvYWRMaXN0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgdmFyIGZvbGRlck5hbWUgPSBvcHRpb25zLmZvbGRlck5hbWU7CiAgICAgICAgdmFyIGxpbmtMaXN0ID0gb3B0aW9ucy5saXN0OwoKCiAgICAgICAgaWYgKGZvbGRlck5hbWUpIHsKICAgICAgICAgIGZvbGRlck5hbWUgKz0gJy8nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAnZG93bmxvYWRMaXN0JywKICAgICAgICAgIGZpbGVMaXN0OiBsaW5rTGlzdCwKICAgICAgICAgIGZvbGRlcjogZm9sZGVyTmFtZQogICAgICAgIH0pOwogICAgICB9LAogICAgICBzdGFydE9sZENocm9tZURvd25sb2FkTGlzdDogZnVuY3Rpb24ob3B0aW9ucywgaGlkZURpYWxvZykgewogICAgICAgIHZhciBmb2xkZXJOYW1lID0gb3B0aW9ucy5mb2xkZXJOYW1lOwogICAgICAgIHZhciBsaW5rTGlzdCA9IG9wdGlvbnMubGlzdDsKICAgICAgICB2YXIgZGF0YVR5cGUgPSBvcHRpb25zLnR5cGU7CgogICAgICAgIGlmIChmb2xkZXJOYW1lKSB7CiAgICAgICAgICBmb2xkZXJOYW1lICs9ICcvJzsKICAgICAgICB9CgogICAgICAgIHZhciBpdGVtSW5kZXggPSAwOwogICAgICAgIHZhciBwYXVzZSA9IGZhbHNlOwogICAgICAgIHZhciB0aW1lb3V0ID0gNTAwOwoKICAgICAgICB2YXIgZm9jdXNFbCA9IGRvY3VtZW50LmJvZHk7CgogICAgICAgIGZvY3VzRWwuZm9jdXMoKTsKCiAgICAgICAgaWYgKCFoaWRlRGlhbG9nKSB7CiAgICAgICAgICBmb2N1c0VsLm9uYmx1ciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBwYXVzZSA9IHRydWU7CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgdmFyIG5leHRPbmVGaWxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgaXRlbSA9IGxpbmtMaXN0W2l0ZW1JbmRleF07CiAgICAgICAgICBpdGVtSW5kZXgrKzsKCiAgICAgICAgICBpZiAoaXRlbSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobW9uby5nbG9iYWwucHJlZmVyZW5jZS5kb3dubG9hZHMpIHsKICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMuZG93bmxvYWQoZm9sZGVyTmFtZSArIGl0ZW0uZmlsZW5hbWUsIGl0ZW0udXJsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vbm8udHJpZ2dlcihtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgICBkb3dubG9hZDogaXRlbS5maWxlbmFtZSwKICAgICAgICAgICAgICBocmVmOiBpdGVtLnVybCwKICAgICAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkT25DbGljayhlKTsKICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KSwgJ2NsaWNrJywgewogICAgICAgICAgICAgIGNhbmNlbGFibGU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBhdXNlKSB7CiAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkTGlzdC5zaG93RG93bmxvYWRXYXJuaW5nUG9wdXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcGF1c2UgPSBmYWxzZTsKICAgICAgICAgICAgICBmb2N1c0VsLmZvY3VzKCk7CiAgICAgICAgICAgICAgbmV4dE9uZUZpbGUoKTsKICAgICAgICAgICAgfSwgZGF0YVR5cGUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGl0ZW1JbmRleCA+IDUgJiYgdGltZW91dCkgewogICAgICAgICAgICAgIHRpbWVvdXQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgZm9jdXNFbC5vbmJsdXIgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgcGF1c2UgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAobW9uby5nbG9iYWwucHJlZmVyZW5jZS5kb3dubG9hZHMpIHsKICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBhY3Rpb246ICdkb3dubG9hZExpc3QnLAogICAgICAgICAgICAgICAgICBmaWxlTGlzdDogbGlua0xpc3Quc2xpY2UoaXRlbUluZGV4KSwKICAgICAgICAgICAgICAgICAgZm9sZGVyOiBmb2xkZXJOYW1lCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgbmV4dE9uZUZpbGUoKTsKICAgICAgICAgICAgfSwgdGltZW91dCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgbmV4dE9uZUZpbGUoKTsKICAgICAgfSwKICAgICAgc3RhcnRGZkRvd25sb2FkTGlzdDogZnVuY3Rpb24obGlua0xpc3QsIGZvbGRlck5hbWUpIHsKICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgIGFjdGlvbjogJ2Rvd25sb2FkTGlzdCcsCiAgICAgICAgICBmaWxlTGlzdDogbGlua0xpc3QsCiAgICAgICAgICBmb2xkZXI6IGZvbGRlck5hbWUKICAgICAgICB9LCBudWxsLCAnc2VydmljZScpOwogICAgICB9LAogICAgICBzdGFydERvd25sb2FkOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgb3B0aW9ucy5saXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgaXRlbS5maWxlbmFtZSA9IG1vbm8uZmlsZU5hbWUubW9kaWZ5KGl0ZW0uZmlsZW5hbWUpOwogICAgICAgIH0pOwoKICAgICAgICBvcHRpb25zLmZvbGRlck5hbWUgPSBtb25vLmZpbGVOYW1lLm1vZGlmeShvcHRpb25zLmZvbGRlck5hbWUpOwoKICAgICAgICBpZiAobW9uby5pc0ZGKSB7CiAgICAgICAgICByZXR1cm4gU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRMaXN0LnN0YXJ0RmZEb3dubG9hZExpc3Qob3B0aW9ucy5saXN0LCBvcHRpb25zLmZvbGRlck5hbWUpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChtb25vLmlzQ2hyb21lICYmIG1vbm8uZ2xvYmFsLnByZWZlcmVuY2UuZG93bmxvYWRzKSB7CiAgICAgICAgICByZXR1cm4gU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRMaXN0LnN0YXJ0Q2hyb21lRG93bmxvYWRMaXN0KG9wdGlvbnMpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChtb25vLmlzR00gfHwgbW9uby5pc1NhZmFyaSkgewogICAgICAgICAgcmV0dXJuIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICBhY3Rpb246ICdoaWRlRG93bmxvYWRXYXJuaW5nJwogICAgICAgICAgfSwgZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRMaXN0LnN0YXJ0T2xkQ2hyb21lRG93bmxvYWRMaXN0KG9wdGlvbnMsIHN0YXRlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2hvd0JlZm9yZURvd25sb2FkUG9wdXA6IGZ1bmN0aW9uKGxpc3QsIG9wdGlvbnMpIHsKICAgICAgICBvcHRpb25zLmxpc3QgPSBsaXN0OwogICAgICAgIHZhciB0eXBlID0gb3B0aW9ucy50eXBlOwogICAgICAgIHZhciBmb2xkZXJOYW1lID0gb3B0aW9ucy5mb2xkZXJOYW1lOwogICAgICAgIHZhciBvbkNvbnRpbnVlID0gb3B0aW9ucy5vbkNvbnRpbnVlIHx8IFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkTGlzdC5zdGFydERvd25sb2FkOwogICAgICAgIHZhciBvblNob3dMaXN0ID0gb3B0aW9ucy5vblNob3dMaXN0IHx8IFNhdmVGcm9tX1V0aWxzLnBsYXlsaXN0LnBvcHVwRmlsZWxpc3Q7CiAgICAgICAgdmFyIGNvdW50ID0gb3B0aW9ucy5jb3VudCB8fCBsaXN0Lmxlbmd0aDsKICAgICAgICB2YXIgdGVtcGxhdGUgPSBTYXZlRnJvbV9VdGlscy5wbGF5bGlzdC5nZXRJbmZvUG9wdXBUZW1wbGF0ZSgpOwoKICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgIGFjdGlvbjogJ2dldFdhcm5pbmdJY29uJywKICAgICAgICAgIGNvbG9yOiAnIzAwQ0NGRicsCiAgICAgICAgICB0eXBlOiB0eXBlCiAgICAgICAgfSwgZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgdGVtcGxhdGUuaWNvbi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSAndXJsKCcgKyBpY29uICsgJyknOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgc2hvd0xpc3RMaW5rID0gW107CiAgICAgICAgaWYgKG9uU2hvd0xpc3QpIHsKICAgICAgICAgIHNob3dMaXN0TGluayA9IFsnICgnLCBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgICB0ZXh0OiBtb25vLmdsb2JhbC5sYW5ndWFnZS52a0xpc3RPZkxpbmtzLnRvTG93ZXJDYXNlKCkKICAgICAgICAgIH0pLCAnKSddOwogICAgICAgICAgc2hvd0xpc3RMaW5rWzFdLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIG9uU2hvd0xpc3Qob3B0aW9ucy5saXN0KTsKICAgICAgICAgICAgbW9uby50cmlnZ2VyKGNhbmNlbEJ0biwgJ2NsaWNrJyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIG1vbm8uY3JlYXRlKHRlbXBsYXRlLnRleHRDb250YWluZXIsIHsKICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICB0ZXh0OiBmb2xkZXJOYW1lIHx8IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnBsYXlsaXN0VGl0bGUsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGNvbG9yOiAnIzBEMEQwRCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzIwcHgnLAogICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnMTFweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6ICcxM3B4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgIHRleHQ6IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnZrRm91bmRGaWxlcy5yZXBsYWNlKCclZCcsIGNvdW50KSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgY29sb3I6ICcjODY4Njg2JywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICcxM3B4JywKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcyNHB4JywKICAgICAgICAgICAgICAgIG1hcmdpblRvcDogJzBweCcKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGFwcGVuZDogc2hvd0xpc3RMaW5rCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICB0ZXh0OiBtb25vLmdsb2JhbC5sYW5ndWFnZS5iZWZvcmVEb3dubG9hZFBvcHVwV2FybiwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgY29sb3I6ICcjODY4Njg2JywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICcxM3B4JywKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcyNHB4JywKICAgICAgICAgICAgICAgIG1hcmdpblRvcDogJzBweCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIHZhciBjYW5jZWxCdG4gPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIGRsQnRuID0gdW5kZWZpbmVkOwogICAgICAgIG1vbm8uY3JlYXRlKHRlbXBsYXRlLmJ1dHRvbkNvbnRhaW5lciwgewogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIGNhbmNlbEJ0biA9IG1vbm8uY3JlYXRlKCdidXR0b24nLCB7CiAgICAgICAgICAgICAgdGV4dDogbW9uby5nbG9iYWwubGFuZ3VhZ2UuY2FuY2VsLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyN3B4JywKICAgICAgICAgICAgICAgIHdpZHRoOiAnMTE4cHgnLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZmZmZicsCiAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgIzllOWU5ZScsCiAgICAgICAgICAgICAgICBtYXJnaW46ICcxMnB4JywKICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzExcHgnLAogICAgICAgICAgICAgICAgbWFyZ2luUmlnaHQ6ICc0cHgnLAogICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnNXB4JywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIGRsQnRuID0gbW9uby5jcmVhdGUoJ2J1dHRvbicsIHsKICAgICAgICAgICAgICB0ZXh0OiBtb25vLmdsb2JhbC5sYW5ndWFnZS5jb250aW51ZSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgaGVpZ2h0OiAnMjdweCcsCiAgICAgICAgICAgICAgICB3aWR0aDogJzExOHB4JywKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLAogICAgICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkICM5ZTllOWUnLAogICAgICAgICAgICAgICAgbWFyZ2luOiAnMTJweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICcxMXB4JywKICAgICAgICAgICAgICAgIG1hcmdpblJpZ2h0OiAnOHB4JywKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzVweCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzE0cHgnLAogICAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIGNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIHZhciBwb3B1cCA9IHRlbXBsYXRlLmJvZHkucGFyZW50Tm9kZTsKICAgICAgICAgIG1vbm8udHJpZ2dlcihwb3B1cC5sYXN0Q2hpbGQsICdjbGljaycpOwogICAgICAgIH0pOwoKICAgICAgICBkbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgb25Db250aW51ZShvcHRpb25zKTsKICAgICAgICAgIG1vbm8udHJpZ2dlcihjYW5jZWxCdG4sICdjbGljaycpOwogICAgICAgIH0pOwoKICAgICAgICBTYXZlRnJvbV9VdGlscy5wb3B1cERpdih0ZW1wbGF0ZS5ib2R5LCAnZGxfY29uZmlybV9ib3hfcG9wdXAnKTsKICAgICAgfQogICAgfSwKCiAgICBkb3dubG9hZExpbms6IGZ1bmN0aW9uKGEsIGNhbGxiYWNrKSB7CiAgICAgIGlmICghYS5ocmVmKQogICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgIHZhciBmaWxlbmFtZSA9IGEuZ2V0QXR0cmlidXRlKCdkb3dubG9hZCcpOwoKICAgICAgcmV0dXJuIHRoaXMuZG93bmxvYWQoZmlsZW5hbWUsIGEuaHJlZiwgbnVsbCwgY2FsbGJhY2spOwogICAgfSwKCiAgICBzYWZhcmlEbExpbms6IGZ1bmN0aW9uKGUpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBpZiAoZS5idXR0b24gfHwgZS5jdHJsS2V5IHx8IGUuYWx0S2V5IHx8IGUuc2hpdGZLZXkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBtZSA9IG51bGw7CgogICAgICB2YXIgbGVnYWN5ID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBtZSA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpOwogICAgICAgIG1lLmluaXRNb3VzZUV2ZW50KCdjbGljaycsIHRydWUsIGUuY2FuY2VsYWJsZSwgd2luZG93LCAwLAogICAgICAgICAgZS5zY3JlZW5YLCBlLnNjcmVlblksIGUuY2xpZW50WCwgZS5jbGllbnRZLAogICAgICAgICAgZmFsc2UsIHRydWUsIGZhbHNlLCBlLm1ldGFLZXksIGUuYnV0dG9uLCBlLnJlbGF0ZWRUYXJnZXQpOwogICAgICAgIHJldHVybiBtZTsKICAgICAgfTsKCiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHR5cGVvZiBNb3VzZUV2ZW50ICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICB0aHJvdyAnbGVnYWN5JzsKICAgICAgICB9CiAgICAgICAgbWUgPSBuZXcgTW91c2VFdmVudCgnY2xpY2snLCB7CiAgICAgICAgICBidWJibGVzOiB0cnVlLAogICAgICAgICAgY2FuY2VsYWJsZTogZS5jYW5jZWxhYmxlLAogICAgICAgICAgc2NyZWVuWDogZS5zY3JlZW5YLAogICAgICAgICAgc2NyZWVuWTogZS5zY3JlZW5ZLAogICAgICAgICAgY2xpZW50WDogZS5jbGllbnRYLAogICAgICAgICAgY2xpZW50WTogZS5jbGllbnRZLAogICAgICAgICAgY3RybEtleTogZmFsc2UsCiAgICAgICAgICBhbHRLZXk6IHRydWUsCiAgICAgICAgICBzaGlmdEtleTogZmFsc2UsCiAgICAgICAgICBtZXRhS2V5OiBlLm1ldGFLZXksCiAgICAgICAgICBidXR0b246IGUuYnV0dG9uLAogICAgICAgICAgcmVsYXRlZFRhcmdldDogZS5yZWxhdGVkVGFyZ2V0CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIG1lID0gbGVnYWN5KGUpOwogICAgICB9CgogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQobWUpOwogICAgfSwKCiAgICBkb3dubG9hZE9uQ2xpY2s6IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaywgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgdmFyIF90aGlzID0gU2F2ZUZyb21fVXRpbHM7CgogICAgICB2YXIgbm9kZSA9IG9wdGlvbnMuZWwgfHwgZXZlbnQudGFyZ2V0OwogICAgICBpZiAobm9kZS50YWdOYW1lICE9PSAnQScpIHsKICAgICAgICBub2RlID0gbW9uby5nZXRQYXJlbnQobm9kZSwgJ0EnKTsKICAgICAgfQoKICAgICAgaWYgKCFub2RlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAobW9uby5pc1NhZmFyaSkgewogICAgICAgIHJldHVybiBfdGhpcy5zYWZhcmlEbExpbmsuY2FsbChub2RlLCBldmVudCk7CiAgICAgIH0KCiAgICAgIGlmICghbW9uby5nbG9iYWwucHJlZmVyZW5jZS5kb3dubG9hZHMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChtb25vLmlzR00gJiYgL15ibG9iOnxeZGF0YTovLnRlc3Qobm9kZS5ocmVmKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGV2ZW50LmJ1dHRvbiA9PT0gMikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICBfdGhpcy5kb3dubG9hZExpbmsobm9kZSwgY2FsbGJhY2spOwogICAgfSwKCiAgICBnZXRRdWVyeVN0cmluZzogZnVuY3Rpb24ocXVlcnksIGtleV9wcmVmaXgsIGtleV9zdWZmaXgpIHsKICAgICAgaWYgKCFxdWVyeSB8fCB0eXBlb2YocXVlcnkpICE9ICdvYmplY3QnKQogICAgICAgIHJldHVybiAnJzsKCiAgICAgIGlmIChrZXlfcHJlZml4ID09PSB1bmRlZmluZWQpCiAgICAgICAga2V5X3ByZWZpeCA9ICcnOwoKICAgICAgaWYgKGtleV9zdWZmaXggPT09IHVuZGVmaW5lZCkKICAgICAgICBrZXlfc3VmZml4ID0gJyc7CgogICAgICB2YXIgc3RyID0gJyc7CiAgICAgIGZvciAodmFyIGtleSBpbiBxdWVyeSkgewogICAgICAgIGlmIChzdHIubGVuZ3RoKQogICAgICAgICAgc3RyICs9ICcmJzsKCiAgICAgICAgaWYgKHF1ZXJ5W2tleV0gaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgIGlmICgha2V5X3ByZWZpeCkKICAgICAgICAgICAga2V5X3ByZWZpeCA9ICcnOwoKICAgICAgICAgIGlmICgha2V5X3N1ZmZpeCkKICAgICAgICAgICAga2V5X3N1ZmZpeCA9ICcnOwoKICAgICAgICAgIHN0ciArPSBTYXZlRnJvbV9VdGlscy5nZXRRdWVyeVN0cmluZyhxdWVyeVtrZXldLCBrZXlfcHJlZml4ICsga2V5ICsgIlsiLCAiXSIgKyBrZXlfc3VmZml4KTsKICAgICAgICB9IGVsc2UKICAgICAgICAgIHN0ciArPSBrZXlfcHJlZml4ICsgZXNjYXBlKGtleSkgKyBrZXlfc3VmZml4ICsgJz0nICsgZXNjYXBlKHF1ZXJ5W2tleV0pOwogICAgICB9CgogICAgICByZXR1cm4gc3RyOwogICAgfSwKCiAgICBtZDU6IGZ1bmN0aW9uKHN0cikgewogICAgICAvLyBodHRwOi8va2V2aW4udmFuem9ubmV2ZWxkLm5ldAogICAgICAvLyArICAgb3JpZ2luYWwgYnk6IFdlYnRvb2xraXQuaW5mbyAoaHR0cDovL3d3dy53ZWJ0b29sa2l0LmluZm8vKQogICAgICAvLyArIG5hbWVzcGFjZWQgYnk6IE1pY2hhZWwgV2hpdGUgKGh0dHA6Ly9nZXRzcHJpbmsuY29tKQogICAgICAvLyArICAgIHR3ZWFrZWQgYnk6IEphY2sKICAgICAgLy8gKyAgIGltcHJvdmVkIGJ5OiBLZXZpbiB2YW4gWm9ubmV2ZWxkIChodHRwOi8va2V2aW4udmFuem9ubmV2ZWxkLm5ldCkKICAgICAgLy8gKyAgICAgIGlucHV0IGJ5OiBCcmV0dCBaYW1pciAoaHR0cDovL2JyZXR0LXphbWlyLm1lKQogICAgICAvLyArICAgYnVnZml4ZWQgYnk6IEtldmluIHZhbiBab25uZXZlbGQgKGh0dHA6Ly9rZXZpbi52YW56b25uZXZlbGQubmV0KQogICAgICAvLyAtICAgIGRlcGVuZHMgb246IHV0ZjhfZW5jb2RlCiAgICAgIC8vICogICAgIGV4YW1wbGUgMTogbWQ1KCdLZXZpbiB2YW4gWm9ubmV2ZWxkJyk7CiAgICAgIC8vICogICAgIHJldHVybnMgMTogJzZlNjU4ZDRiZmNiNTljYzEzZjk2YzE0NDUwYWM0MGI5JwogICAgICB2YXIgeGw7CgogICAgICB2YXIgcm90YXRlTGVmdCA9IGZ1bmN0aW9uKGxWYWx1ZSwgaVNoaWZ0Qml0cykgewogICAgICAgIHJldHVybiAobFZhbHVlIDw8IGlTaGlmdEJpdHMpIHwgKGxWYWx1ZSA+Pj4gKDMyIC0gaVNoaWZ0Qml0cykpOwogICAgICB9OwoKICAgICAgdmFyIGFkZFVuc2lnbmVkID0gZnVuY3Rpb24obFgsIGxZKSB7CiAgICAgICAgdmFyIGxYNCwgbFk0LCBsWDgsIGxZOCwgbFJlc3VsdDsKICAgICAgICBsWDggPSAobFggJiAweDgwMDAwMDAwKTsKICAgICAgICBsWTggPSAobFkgJiAweDgwMDAwMDAwKTsKICAgICAgICBsWDQgPSAobFggJiAweDQwMDAwMDAwKTsKICAgICAgICBsWTQgPSAobFkgJiAweDQwMDAwMDAwKTsKICAgICAgICBsUmVzdWx0ID0gKGxYICYgMHgzRkZGRkZGRikgKyAobFkgJiAweDNGRkZGRkZGKTsKICAgICAgICBpZiAobFg0ICYgbFk0KSB7CiAgICAgICAgICByZXR1cm4gKGxSZXN1bHQgXiAweDgwMDAwMDAwIF4gbFg4IF4gbFk4KTsKICAgICAgICB9CiAgICAgICAgaWYgKGxYNCB8IGxZNCkgewogICAgICAgICAgaWYgKGxSZXN1bHQgJiAweDQwMDAwMDAwKSB7CiAgICAgICAgICAgIHJldHVybiAobFJlc3VsdCBeIDB4QzAwMDAwMDAgXiBsWDggXiBsWTgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIChsUmVzdWx0IF4gMHg0MDAwMDAwMCBeIGxYOCBeIGxZOCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAobFJlc3VsdCBeIGxYOCBeIGxZOCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIF9GID0gZnVuY3Rpb24oeCwgeSwgeikgewogICAgICAgIHJldHVybiAoeCAmIHkpIHwgKCh+eCkgJiB6KTsKICAgICAgfTsKICAgICAgdmFyIF9HID0gZnVuY3Rpb24oeCwgeSwgeikgewogICAgICAgIHJldHVybiAoeCAmIHopIHwgKHkgJiAofnopKTsKICAgICAgfTsKICAgICAgdmFyIF9IID0gZnVuY3Rpb24oeCwgeSwgeikgewogICAgICAgIHJldHVybiAoeCBeIHkgXiB6KTsKICAgICAgfTsKICAgICAgdmFyIF9JID0gZnVuY3Rpb24oeCwgeSwgeikgewogICAgICAgIHJldHVybiAoeSBeICh4IHwgKH56KSkpOwogICAgICB9OwoKICAgICAgdmFyIF9GRiA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIHgsIHMsIGFjKSB7CiAgICAgICAgYSA9IGFkZFVuc2lnbmVkKGEsIGFkZFVuc2lnbmVkKGFkZFVuc2lnbmVkKF9GKGIsIGMsIGQpLCB4KSwgYWMpKTsKICAgICAgICByZXR1cm4gYWRkVW5zaWduZWQocm90YXRlTGVmdChhLCBzKSwgYik7CiAgICAgIH07CgogICAgICB2YXIgX0dHID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgeCwgcywgYWMpIHsKICAgICAgICBhID0gYWRkVW5zaWduZWQoYSwgYWRkVW5zaWduZWQoYWRkVW5zaWduZWQoX0coYiwgYywgZCksIHgpLCBhYykpOwogICAgICAgIHJldHVybiBhZGRVbnNpZ25lZChyb3RhdGVMZWZ0KGEsIHMpLCBiKTsKICAgICAgfTsKCiAgICAgIHZhciBfSEggPSBmdW5jdGlvbihhLCBiLCBjLCBkLCB4LCBzLCBhYykgewogICAgICAgIGEgPSBhZGRVbnNpZ25lZChhLCBhZGRVbnNpZ25lZChhZGRVbnNpZ25lZChfSChiLCBjLCBkKSwgeCksIGFjKSk7CiAgICAgICAgcmV0dXJuIGFkZFVuc2lnbmVkKHJvdGF0ZUxlZnQoYSwgcyksIGIpOwogICAgICB9OwoKICAgICAgdmFyIF9JSSA9IGZ1bmN0aW9uKGEsIGIsIGMsIGQsIHgsIHMsIGFjKSB7CiAgICAgICAgYSA9IGFkZFVuc2lnbmVkKGEsIGFkZFVuc2lnbmVkKGFkZFVuc2lnbmVkKF9JKGIsIGMsIGQpLCB4KSwgYWMpKTsKICAgICAgICByZXR1cm4gYWRkVW5zaWduZWQocm90YXRlTGVmdChhLCBzKSwgYik7CiAgICAgIH07CgogICAgICB2YXIgY29udmVydFRvV29yZEFycmF5ID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgdmFyIGxXb3JkQ291bnQ7CiAgICAgICAgdmFyIGxNZXNzYWdlTGVuZ3RoID0gc3RyLmxlbmd0aDsKICAgICAgICB2YXIgbE51bWJlck9mV29yZHNfdGVtcDEgPSBsTWVzc2FnZUxlbmd0aCArIDg7CiAgICAgICAgdmFyIGxOdW1iZXJPZldvcmRzX3RlbXAyID0gKGxOdW1iZXJPZldvcmRzX3RlbXAxIC0gKGxOdW1iZXJPZldvcmRzX3RlbXAxICUgNjQpKSAvIDY0OwogICAgICAgIHZhciBsTnVtYmVyT2ZXb3JkcyA9IChsTnVtYmVyT2ZXb3Jkc190ZW1wMiArIDEpICogMTY7CiAgICAgICAgdmFyIGxXb3JkQXJyYXkgPSBuZXcgQXJyYXkobE51bWJlck9mV29yZHMgLSAxKTsKICAgICAgICB2YXIgbEJ5dGVQb3NpdGlvbiA9IDA7CiAgICAgICAgdmFyIGxCeXRlQ291bnQgPSAwOwogICAgICAgIHdoaWxlIChsQnl0ZUNvdW50IDwgbE1lc3NhZ2VMZW5ndGgpIHsKICAgICAgICAgIGxXb3JkQ291bnQgPSAobEJ5dGVDb3VudCAtIChsQnl0ZUNvdW50ICUgNCkpIC8gNDsKICAgICAgICAgIGxCeXRlUG9zaXRpb24gPSAobEJ5dGVDb3VudCAlIDQpICogODsKICAgICAgICAgIGxXb3JkQXJyYXlbbFdvcmRDb3VudF0gPSAobFdvcmRBcnJheVtsV29yZENvdW50XSB8IChzdHIuY2hhckNvZGVBdChsQnl0ZUNvdW50KSA8PCBsQnl0ZVBvc2l0aW9uKSk7CiAgICAgICAgICBsQnl0ZUNvdW50Kys7CiAgICAgICAgfQogICAgICAgIGxXb3JkQ291bnQgPSAobEJ5dGVDb3VudCAtIChsQnl0ZUNvdW50ICUgNCkpIC8gNDsKICAgICAgICBsQnl0ZVBvc2l0aW9uID0gKGxCeXRlQ291bnQgJSA0KSAqIDg7CiAgICAgICAgbFdvcmRBcnJheVtsV29yZENvdW50XSA9IGxXb3JkQXJyYXlbbFdvcmRDb3VudF0gfCAoMHg4MCA8PCBsQnl0ZVBvc2l0aW9uKTsKICAgICAgICBsV29yZEFycmF5W2xOdW1iZXJPZldvcmRzIC0gMl0gPSBsTWVzc2FnZUxlbmd0aCA8PCAzOwogICAgICAgIGxXb3JkQXJyYXlbbE51bWJlck9mV29yZHMgLSAxXSA9IGxNZXNzYWdlTGVuZ3RoID4+PiAyOTsKICAgICAgICByZXR1cm4gbFdvcmRBcnJheTsKICAgICAgfTsKCiAgICAgIHZhciB3b3JkVG9IZXggPSBmdW5jdGlvbihsVmFsdWUpIHsKICAgICAgICB2YXIgd29yZFRvSGV4VmFsdWUgPSAiIiwKICAgICAgICAgIHdvcmRUb0hleFZhbHVlX3RlbXAgPSAiIiwKICAgICAgICAgIGxCeXRlLCBsQ291bnQ7CiAgICAgICAgZm9yIChsQ291bnQgPSAwOyBsQ291bnQgPD0gMzsgbENvdW50KyspIHsKICAgICAgICAgIGxCeXRlID0gKGxWYWx1ZSA+Pj4gKGxDb3VudCAqIDgpKSAmIDI1NTsKICAgICAgICAgIHdvcmRUb0hleFZhbHVlX3RlbXAgPSAiMCIgKyBsQnl0ZS50b1N0cmluZygxNik7CiAgICAgICAgICB3b3JkVG9IZXhWYWx1ZSA9IHdvcmRUb0hleFZhbHVlICsgd29yZFRvSGV4VmFsdWVfdGVtcC5zdWJzdHIod29yZFRvSGV4VmFsdWVfdGVtcC5sZW5ndGggLSAyLCAyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHdvcmRUb0hleFZhbHVlOwogICAgICB9OwoKICAgICAgdmFyIHggPSBbXSwKICAgICAgICBrLCBBQSwgQkIsIENDLCBERCwgYSwgYiwgYywgZCwgUzExID0gNywKICAgICAgICBTMTIgPSAxMiwKICAgICAgICBTMTMgPSAxNywKICAgICAgICBTMTQgPSAyMiwKICAgICAgICBTMjEgPSA1LAogICAgICAgIFMyMiA9IDksCiAgICAgICAgUzIzID0gMTQsCiAgICAgICAgUzI0ID0gMjAsCiAgICAgICAgUzMxID0gNCwKICAgICAgICBTMzIgPSAxMSwKICAgICAgICBTMzMgPSAxNiwKICAgICAgICBTMzQgPSAyMywKICAgICAgICBTNDEgPSA2LAogICAgICAgIFM0MiA9IDEwLAogICAgICAgIFM0MyA9IDE1LAogICAgICAgIFM0NCA9IDIxOwoKICAgICAgLy9zdHIgPSB0aGlzLnV0ZjhfZW5jb2RlKHN0cik7CiAgICAgIHggPSBjb252ZXJ0VG9Xb3JkQXJyYXkoc3RyKTsKICAgICAgYSA9IDB4Njc0NTIzMDE7CiAgICAgIGIgPSAweEVGQ0RBQjg5OwogICAgICBjID0gMHg5OEJBRENGRTsKICAgICAgZCA9IDB4MTAzMjU0NzY7CgogICAgICB4bCA9IHgubGVuZ3RoOwogICAgICBmb3IgKGsgPSAwOyBrIDwgeGw7IGsgKz0gMTYpIHsKICAgICAgICBBQSA9IGE7CiAgICAgICAgQkIgPSBiOwogICAgICAgIENDID0gYzsKICAgICAgICBERCA9IGQ7CiAgICAgICAgYSA9IF9GRihhLCBiLCBjLCBkLCB4W2sgKyAwXSwgUzExLCAweEQ3NkFBNDc4KTsKICAgICAgICBkID0gX0ZGKGQsIGEsIGIsIGMsIHhbayArIDFdLCBTMTIsIDB4RThDN0I3NTYpOwogICAgICAgIGMgPSBfRkYoYywgZCwgYSwgYiwgeFtrICsgMl0sIFMxMywgMHgyNDIwNzBEQik7CiAgICAgICAgYiA9IF9GRihiLCBjLCBkLCBhLCB4W2sgKyAzXSwgUzE0LCAweEMxQkRDRUVFKTsKICAgICAgICBhID0gX0ZGKGEsIGIsIGMsIGQsIHhbayArIDRdLCBTMTEsIDB4RjU3QzBGQUYpOwogICAgICAgIGQgPSBfRkYoZCwgYSwgYiwgYywgeFtrICsgNV0sIFMxMiwgMHg0Nzg3QzYyQSk7CiAgICAgICAgYyA9IF9GRihjLCBkLCBhLCBiLCB4W2sgKyA2XSwgUzEzLCAweEE4MzA0NjEzKTsKICAgICAgICBiID0gX0ZGKGIsIGMsIGQsIGEsIHhbayArIDddLCBTMTQsIDB4RkQ0Njk1MDEpOwogICAgICAgIGEgPSBfRkYoYSwgYiwgYywgZCwgeFtrICsgOF0sIFMxMSwgMHg2OTgwOThEOCk7CiAgICAgICAgZCA9IF9GRihkLCBhLCBiLCBjLCB4W2sgKyA5XSwgUzEyLCAweDhCNDRGN0FGKTsKICAgICAgICBjID0gX0ZGKGMsIGQsIGEsIGIsIHhbayArIDEwXSwgUzEzLCAweEZGRkY1QkIxKTsKICAgICAgICBiID0gX0ZGKGIsIGMsIGQsIGEsIHhbayArIDExXSwgUzE0LCAweDg5NUNEN0JFKTsKICAgICAgICBhID0gX0ZGKGEsIGIsIGMsIGQsIHhbayArIDEyXSwgUzExLCAweDZCOTAxMTIyKTsKICAgICAgICBkID0gX0ZGKGQsIGEsIGIsIGMsIHhbayArIDEzXSwgUzEyLCAweEZEOTg3MTkzKTsKICAgICAgICBjID0gX0ZGKGMsIGQsIGEsIGIsIHhbayArIDE0XSwgUzEzLCAweEE2Nzk0MzhFKTsKICAgICAgICBiID0gX0ZGKGIsIGMsIGQsIGEsIHhbayArIDE1XSwgUzE0LCAweDQ5QjQwODIxKTsKICAgICAgICBhID0gX0dHKGEsIGIsIGMsIGQsIHhbayArIDFdLCBTMjEsIDB4RjYxRTI1NjIpOwogICAgICAgIGQgPSBfR0coZCwgYSwgYiwgYywgeFtrICsgNl0sIFMyMiwgMHhDMDQwQjM0MCk7CiAgICAgICAgYyA9IF9HRyhjLCBkLCBhLCBiLCB4W2sgKyAxMV0sIFMyMywgMHgyNjVFNUE1MSk7CiAgICAgICAgYiA9IF9HRyhiLCBjLCBkLCBhLCB4W2sgKyAwXSwgUzI0LCAweEU5QjZDN0FBKTsKICAgICAgICBhID0gX0dHKGEsIGIsIGMsIGQsIHhbayArIDVdLCBTMjEsIDB4RDYyRjEwNUQpOwogICAgICAgIGQgPSBfR0coZCwgYSwgYiwgYywgeFtrICsgMTBdLCBTMjIsIDB4MjQ0MTQ1Myk7CiAgICAgICAgYyA9IF9HRyhjLCBkLCBhLCBiLCB4W2sgKyAxNV0sIFMyMywgMHhEOEExRTY4MSk7CiAgICAgICAgYiA9IF9HRyhiLCBjLCBkLCBhLCB4W2sgKyA0XSwgUzI0LCAweEU3RDNGQkM4KTsKICAgICAgICBhID0gX0dHKGEsIGIsIGMsIGQsIHhbayArIDldLCBTMjEsIDB4MjFFMUNERTYpOwogICAgICAgIGQgPSBfR0coZCwgYSwgYiwgYywgeFtrICsgMTRdLCBTMjIsIDB4QzMzNzA3RDYpOwogICAgICAgIGMgPSBfR0coYywgZCwgYSwgYiwgeFtrICsgM10sIFMyMywgMHhGNEQ1MEQ4Nyk7CiAgICAgICAgYiA9IF9HRyhiLCBjLCBkLCBhLCB4W2sgKyA4XSwgUzI0LCAweDQ1NUExNEVEKTsKICAgICAgICBhID0gX0dHKGEsIGIsIGMsIGQsIHhbayArIDEzXSwgUzIxLCAweEE5RTNFOTA1KTsKICAgICAgICBkID0gX0dHKGQsIGEsIGIsIGMsIHhbayArIDJdLCBTMjIsIDB4RkNFRkEzRjgpOwogICAgICAgIGMgPSBfR0coYywgZCwgYSwgYiwgeFtrICsgN10sIFMyMywgMHg2NzZGMDJEOSk7CiAgICAgICAgYiA9IF9HRyhiLCBjLCBkLCBhLCB4W2sgKyAxMl0sIFMyNCwgMHg4RDJBNEM4QSk7CiAgICAgICAgYSA9IF9ISChhLCBiLCBjLCBkLCB4W2sgKyA1XSwgUzMxLCAweEZGRkEzOTQyKTsKICAgICAgICBkID0gX0hIKGQsIGEsIGIsIGMsIHhbayArIDhdLCBTMzIsIDB4ODc3MUY2ODEpOwogICAgICAgIGMgPSBfSEgoYywgZCwgYSwgYiwgeFtrICsgMTFdLCBTMzMsIDB4NkQ5RDYxMjIpOwogICAgICAgIGIgPSBfSEgoYiwgYywgZCwgYSwgeFtrICsgMTRdLCBTMzQsIDB4RkRFNTM4MEMpOwogICAgICAgIGEgPSBfSEgoYSwgYiwgYywgZCwgeFtrICsgMV0sIFMzMSwgMHhBNEJFRUE0NCk7CiAgICAgICAgZCA9IF9ISChkLCBhLCBiLCBjLCB4W2sgKyA0XSwgUzMyLCAweDRCREVDRkE5KTsKICAgICAgICBjID0gX0hIKGMsIGQsIGEsIGIsIHhbayArIDddLCBTMzMsIDB4RjZCQjRCNjApOwogICAgICAgIGIgPSBfSEgoYiwgYywgZCwgYSwgeFtrICsgMTBdLCBTMzQsIDB4QkVCRkJDNzApOwogICAgICAgIGEgPSBfSEgoYSwgYiwgYywgZCwgeFtrICsgMTNdLCBTMzEsIDB4Mjg5QjdFQzYpOwogICAgICAgIGQgPSBfSEgoZCwgYSwgYiwgYywgeFtrICsgMF0sIFMzMiwgMHhFQUExMjdGQSk7CiAgICAgICAgYyA9IF9ISChjLCBkLCBhLCBiLCB4W2sgKyAzXSwgUzMzLCAweEQ0RUYzMDg1KTsKICAgICAgICBiID0gX0hIKGIsIGMsIGQsIGEsIHhbayArIDZdLCBTMzQsIDB4NDg4MUQwNSk7CiAgICAgICAgYSA9IF9ISChhLCBiLCBjLCBkLCB4W2sgKyA5XSwgUzMxLCAweEQ5RDREMDM5KTsKICAgICAgICBkID0gX0hIKGQsIGEsIGIsIGMsIHhbayArIDEyXSwgUzMyLCAweEU2REI5OUU1KTsKICAgICAgICBjID0gX0hIKGMsIGQsIGEsIGIsIHhbayArIDE1XSwgUzMzLCAweDFGQTI3Q0Y4KTsKICAgICAgICBiID0gX0hIKGIsIGMsIGQsIGEsIHhbayArIDJdLCBTMzQsIDB4QzRBQzU2NjUpOwogICAgICAgIGEgPSBfSUkoYSwgYiwgYywgZCwgeFtrICsgMF0sIFM0MSwgMHhGNDI5MjI0NCk7CiAgICAgICAgZCA9IF9JSShkLCBhLCBiLCBjLCB4W2sgKyA3XSwgUzQyLCAweDQzMkFGRjk3KTsKICAgICAgICBjID0gX0lJKGMsIGQsIGEsIGIsIHhbayArIDE0XSwgUzQzLCAweEFCOTQyM0E3KTsKICAgICAgICBiID0gX0lJKGIsIGMsIGQsIGEsIHhbayArIDVdLCBTNDQsIDB4RkM5M0EwMzkpOwogICAgICAgIGEgPSBfSUkoYSwgYiwgYywgZCwgeFtrICsgMTJdLCBTNDEsIDB4NjU1QjU5QzMpOwogICAgICAgIGQgPSBfSUkoZCwgYSwgYiwgYywgeFtrICsgM10sIFM0MiwgMHg4RjBDQ0M5Mik7CiAgICAgICAgYyA9IF9JSShjLCBkLCBhLCBiLCB4W2sgKyAxMF0sIFM0MywgMHhGRkVGRjQ3RCk7CiAgICAgICAgYiA9IF9JSShiLCBjLCBkLCBhLCB4W2sgKyAxXSwgUzQ0LCAweDg1ODQ1REQxKTsKICAgICAgICBhID0gX0lJKGEsIGIsIGMsIGQsIHhbayArIDhdLCBTNDEsIDB4NkZBODdFNEYpOwogICAgICAgIGQgPSBfSUkoZCwgYSwgYiwgYywgeFtrICsgMTVdLCBTNDIsIDB4RkUyQ0U2RTApOwogICAgICAgIGMgPSBfSUkoYywgZCwgYSwgYiwgeFtrICsgNl0sIFM0MywgMHhBMzAxNDMxNCk7CiAgICAgICAgYiA9IF9JSShiLCBjLCBkLCBhLCB4W2sgKyAxM10sIFM0NCwgMHg0RTA4MTFBMSk7CiAgICAgICAgYSA9IF9JSShhLCBiLCBjLCBkLCB4W2sgKyA0XSwgUzQxLCAweEY3NTM3RTgyKTsKICAgICAgICBkID0gX0lJKGQsIGEsIGIsIGMsIHhbayArIDExXSwgUzQyLCAweEJEM0FGMjM1KTsKICAgICAgICBjID0gX0lJKGMsIGQsIGEsIGIsIHhbayArIDJdLCBTNDMsIDB4MkFEN0QyQkIpOwogICAgICAgIGIgPSBfSUkoYiwgYywgZCwgYSwgeFtrICsgOV0sIFM0NCwgMHhFQjg2RDM5MSk7CiAgICAgICAgYSA9IGFkZFVuc2lnbmVkKGEsIEFBKTsKICAgICAgICBiID0gYWRkVW5zaWduZWQoYiwgQkIpOwogICAgICAgIGMgPSBhZGRVbnNpZ25lZChjLCBDQyk7CiAgICAgICAgZCA9IGFkZFVuc2lnbmVkKGQsIEREKTsKICAgICAgfQoKICAgICAgdmFyIHRlbXAgPSB3b3JkVG9IZXgoYSkgKyB3b3JkVG9IZXgoYikgKyB3b3JkVG9IZXgoYykgKyB3b3JkVG9IZXgoZCk7CgogICAgICByZXR1cm4gdGVtcC50b0xvd2VyQ2FzZSgpOwogICAgfSwKCgogICAgZGVjb2RlVW5pY29kZUVzY2FwZVNlcXVlbmNlOiBmdW5jdGlvbih0ZXh0KSB7CiAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1xcdShbMC05YS1mXXs0fSkvZywgZnVuY3Rpb24ocywgbSkgewogICAgICAgIG0gPSBwYXJzZUludChtLCAxNik7CiAgICAgICAgaWYgKCFpc05hTihtKSkgewogICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUobSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgoKICAgIGdldEZpbGVFeHRlbnNpb246IGZ1bmN0aW9uKHN0ciwgZGVmKSB7CiAgICAgIHZhciBleHQgPSB0aGlzLmdldE1hdGNoRmlyc3Qoc3RyLCAvXC4oW2EtejAtOV17Myw0fSkoXD98JCkvaSk7CiAgICAgIGlmIChleHQpCiAgICAgICAgcmV0dXJuIGV4dC50b0xvd2VyQ2FzZSgpOwoKICAgICAgcmV0dXJuIChkZWYgPyBkZWYgOiAnJyk7CiAgICB9LAoKCiAgICBnZXRGaWxlTmFtZTogZnVuY3Rpb24odXJsKSB7CiAgICAgIHZhciBmaWxlbmFtZSA9IHRoaXMuZ2V0TWF0Y2hGaXJzdCh1cmwsIC9cLyhbXlw/I1wvXStcLlthLXpcZF17Miw2fSkoPzpcP3wjfCQpL2kpOwogICAgICBpZiAoIWZpbGVuYW1lKQogICAgICAgIHJldHVybiBmaWxlbmFtZTsKCiAgICAgIHJldHVybiBtb25vLmZpbGVOYW1lLm1vZGlmeShmaWxlbmFtZSk7CiAgICB9LAoKCiAgICBnZXRUb3BMZXZlbERvbWFpbjogZnVuY3Rpb24oZG9tYWluKSB7CiAgICAgIGlmICghZG9tYWluKQogICAgICAgIHJldHVybiAnJzsKCiAgICAgIGlmICghZG9tYWluLm1hdGNoKC9eKFthLXpBLVowLTldKFthLXpBLVowLTlcLV17MCw2MX1bYS16QS1aMC05XSk/XC4pK1thLXpBLVpdezIsNn0vKSkKICAgICAgICByZXR1cm4gZG9tYWluOwoKICAgICAgdmFyIGEgPSBkb21haW4uc3BsaXQoJy4nKTsKICAgICAgdmFyIGwgPSBhLmxlbmd0aDsKCiAgICAgIGlmIChsID09IDIpCiAgICAgICAgcmV0dXJuIGRvbWFpbjsKCiAgICAgIHJldHVybiAoYVtsIC0gMl0gKyAnLicgKyBhW2wgLSAxXSk7CiAgICB9LAoKCiAgICBkYXRlVG9PYmo6IGZ1bmN0aW9uKHRzLCBsZWFkaW5nWmVybykgewogICAgICB2YXIgZCA9ICh0cyA9PT0gbnVsbCB8fCB0cyA9PT0gdW5kZWZpbmVkKSA/IG5ldyBEYXRlKCkgOiBuZXcgRGF0ZSh0cyk7CgogICAgICBpZiAobGVhZGluZ1plcm8gPT09IHVuZGVmaW5lZCkKICAgICAgICBsZWFkaW5nWmVybyA9IHRydWU7CgogICAgICB2YXIgcmVzID0gewogICAgICAgIHllYXI6IGQuZ2V0RnVsbFllYXIoKSwKICAgICAgICBtb250aDogKGQuZ2V0TW9udGgoKSArIDEpLAogICAgICAgIGRheTogZC5nZXREYXRlKCksCiAgICAgICAgaG91cjogZC5nZXRIb3VycygpLAogICAgICAgIG1pbjogZC5nZXRNaW51dGVzKCksCiAgICAgICAgc2VjOiBkLmdldFNlY29uZHMoKQogICAgICB9OwoKICAgICAgaWYgKGxlYWRpbmdaZXJvKSB7CiAgICAgICAgZm9yICh2YXIgaSBpbiByZXMpIHsKICAgICAgICAgIGlmIChyZXNbaV0udG9TdHJpbmcoKS5sZW5ndGggPT0gMSkKICAgICAgICAgICAgcmVzW2ldID0gJzAnICsgcmVzW2ldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlczsKICAgIH0sCgoKICAgIHV0ZjhFbmNvZGU6IGZ1bmN0aW9uKHN0cikgewogICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXHJcbi9nLCAiXG4iKTsKICAgICAgdmFyIHJlcyA9ICIiOwoKICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCBzdHIubGVuZ3RoOyBuKyspIHsKICAgICAgICB2YXIgYyA9IHN0ci5jaGFyQ29kZUF0KG4pOwoKICAgICAgICBpZiAoYyA8IDEyOCkKICAgICAgICAgIHJlcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpOwogICAgICAgIGVsc2UgaWYgKChjID4gMTI3KSAmJiAoYyA8IDIwNDgpKSB7CiAgICAgICAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiA2KSB8IDE5Mik7CiAgICAgICAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjID4+IDEyKSB8IDIyNCk7CiAgICAgICAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgPj4gNikgJiA2MykgfCAxMjgpOwogICAgICAgICAgcmVzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgJiA2MykgfCAxMjgpOwogICAgICAgIH0KCiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9LAoKICAgIHNpemVIdW1hbjogZnVuY3Rpb24oc2l6ZSwgcm91bmQpIHsKICAgICAgaWYgKHJvdW5kID09IHVuZGVmaW5lZCB8fCByb3VuZCA9PSBudWxsKQogICAgICAgIHJvdW5kID0gMjsKCiAgICAgIHZhciBzID0gc2l6ZSwKICAgICAgICBjb3VudCA9IDAsCiAgICAgICAgc2lnbiA9ICcnLAogICAgICAgIHVuaXRlX3NwZWMgPSBbCiAgICAgICAgICBtb25vLmdsb2JhbC5sYW5ndWFnZS52a0ZpbGVTaXplQnl0ZSwKICAgICAgICAgIG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnZrRmlsZVNpemVLQnl0ZSwKICAgICAgICAgIG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnZrRmlsZVNpemVNQnl0ZSwKICAgICAgICAgIG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnZrRmlsZVNpemVHQnl0ZSwKICAgICAgICAgIG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnZrRmlsZVNpemVUQnl0ZQogICAgICAgIF07CgogICAgICBpZiAocyA8IDApIHsKICAgICAgICBzaWduID0gJy0nOwogICAgICAgIHMgPSBNYXRoLmFicyhzKTsKICAgICAgfQoKICAgICAgd2hpbGUgKHMgPj0gMTAwMCkgewogICAgICAgIGNvdW50Kys7CiAgICAgICAgcyAvPSAxMDI0OwogICAgICB9CgogICAgICBpZiAocm91bmQgPj0gMCkgewogICAgICAgIHZhciBtID0gcm91bmQgKiAxMDsKICAgICAgICBzID0gTWF0aC5yb3VuZChzICogbSkgLyBtOwogICAgICB9CgogICAgICBpZiAoY291bnQgPCB1bml0ZV9zcGVjLmxlbmd0aCkKICAgICAgICByZXR1cm4gc2lnbiArIHMgKyAnICcgKyB1bml0ZV9zcGVjW2NvdW50XTsKCiAgICAgIHJldHVybiBzaXplOwogICAgfSwKCiAgICBzZWNvbmRzVG9EdXJhdGlvbjogZnVuY3Rpb24oc2Vjb25kcykgewogICAgICBpZiAoIXNlY29uZHMgfHwgaXNOYU4oc2Vjb25kcykpCiAgICAgICAgcmV0dXJuICcnOwoKICAgICAgZnVuY3Rpb24gemZpbGwodGltZSkgewogICAgICAgIGlmICh0aW1lIDwgMTApCiAgICAgICAgICByZXR1cm4gJzAnICsgdGltZTsKCiAgICAgICAgcmV0dXJuIHRpbWUudG9TdHJpbmcoKTsKICAgICAgfQoKICAgICAgdmFyIGhvdXJzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7CiAgICAgIHNlY29uZHMgJT0gMzYwMDsKCiAgICAgIHZhciBtaW51dGVzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApOwogICAgICBzZWNvbmRzICU9IDYwOwoKICAgICAgaWYgKGhvdXJzID4gMCkKICAgICAgICByZXR1cm4gaG91cnMgKyAiOiIgKyB6ZmlsbChtaW51dGVzKSArICI6IiArIHpmaWxsKHNlY29uZHMpOwoKICAgICAgcmV0dXJuIG1pbnV0ZXMgKyAiOiIgKyB6ZmlsbChzZWNvbmRzKTsKICAgIH0sCgogICAgc3ZnOiB7CiAgICAgIGljb246IHsKICAgICAgICBkb3dubG9hZDogJ00gNCwwIDQsOCAwLDggOCwxNiAxNiw4IDEyLDggMTIsMCA0LDAgeicsCiAgICAgICAgaW5mbzogJ00gOCwxLjU1IEMgMTEuNiwxLjU1IDE0LjQsNC40NCAxNC40LDggMTQuNCwxMS42IDExLjYsMTQuNCA4LDE0LjQgNC40NCwxNC40IDEuNTUsMTEuNiAxLjU1LDggMS41NSw0LjQ0IDQuNDQsMS41NSA4LDEuNTUgTSA4LDAgQyAzLjU4LDAgMCwzLjU4IDAsOCAwLDEyLjQgMy41OCwxNiA4LDE2IDEyLjQsMTYgMTYsMTIuNCAxNiw4IDE2LDMuNTggMTIuNCwwIDgsMCBMIDgsMCB6IE0gOS4xNiwxMi4zIEggNi45MiBWIDcuMDEgSCA5LjE2IFYgMTIuMyB6IE0gOC4wNCw1LjkxIEMgNy4zNiw1LjkxIDYuODEsNS4zNiA2LjgxLDQuNjggNi44MSw0IDcuMzYsMy40NSA4LjA0LDMuNDUgOC43MiwzLjQ1IDkuMjcsNCA5LjI3LDQuNjggOS4yNyw1LjM2IDguNzIsNS45MSA4LjA0LDUuOTEgeicsCiAgICAgICAgbm9Tb3VuZDogJ00gMTEuNCw1LjA1IDEzLDYuNjUgMTQuNiw1LjA1IDE2LDYuMzUgMTQuNCw3Ljk1IDE2LDkuNTUgMTQuNiwxMSAxMyw5LjM1IDExLjQsMTEgMTAsOS41NSAxMS42LDcuOTUgMTAsNi4zNSB6IE0gOCwxLjc1IDgsMTQuMyA0LDEwLjUgbCAtNCwwIDAsLTQuNzUgNCwwIHonCiAgICAgIH0sCgogICAgICBjYWNoZToge30sCgogICAgICBnZXRTcmM6IGZ1bmN0aW9uKGljb24sIGNvbG9yKSB7CiAgICAgICAgaWYgKCF0aGlzLmljb25baWNvbl0pCiAgICAgICAgICByZXR1cm4gJyc7CgogICAgICAgIGlmICghdGhpcy5jYWNoZVtpY29uXSkKICAgICAgICAgIHRoaXMuY2FjaGVbaWNvbl0gPSB7fTsKCiAgICAgICAgaWYgKCF0aGlzLmNhY2hlW2ljb25dW2NvbG9yXSkgewogICAgICAgICAgdGhpcy5jYWNoZVtpY29uXVtjb2xvcl0gPSBidG9hKAogICAgICAgICAgICAnPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4nICsKICAgICAgICAgICAgJzxzdmcgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgaWQ9InN2ZzIiIHhtbDpzcGFjZT0icHJlc2VydmUiPicgKwogICAgICAgICAgICAnPHBhdGggZD0iJyArIHRoaXMuaWNvbltpY29uXSArICciIGZpbGw9IicgKyBjb2xvciArICciIC8+PC9zdmc+JwogICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmNhY2hlW2ljb25dW2NvbG9yXSkKICAgICAgICAgIHJldHVybiAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgdGhpcy5jYWNoZVtpY29uXVtjb2xvcl07CgogICAgICAgIHJldHVybiAnJzsKICAgICAgfSwKCiAgICAgIGdldFN2ZzogZnVuY3Rpb24oaWNvbiwgY29sb3IsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICB2YXIgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsICJzdmciKTsKICAgICAgICB2YXIgc3ZnTlMgPSBzdmcubmFtZXNwYWNlVVJJOwogICAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgd2lkdGggfHwgJzE2Jyk7CiAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0IHx8ICcxNicpOwogICAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLCAnMCAwIDE2IDE2Jyk7CgogICAgICAgIHZhciBwYXRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCAncGF0aCcpOwogICAgICAgIHN2Zy5hcHBlbmRDaGlsZChwYXRoKTsKICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZCcsIHRoaXMuaWNvbltpY29uXSk7CgogICAgICAgIGlmIChjb2xvcikgewogICAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCBjb2xvcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3ZnOwogICAgICB9CiAgICB9LAoKICAgIGFwcGVuZERvd25sb2FkSW5mbzogZnVuY3Rpb24ocGFyZW50LCBjb2xvciwgYm94U3R5bGUsIGJ0blN0eWxlKSB7CiAgICAgIGlmICghY29sb3IpCiAgICAgICAgY29sb3IgPSAnI2EwYTBhMCc7CgogICAgICB2YXIgaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgaW5mby5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShtb25vLmdsb2JhbC5sYW5ndWFnZS5kb3dubG9hZFRpdGxlKSk7CiAgICAgIHRoaXMuc2V0U3R5bGUoaW5mbywgewogICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLAogICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAnICsgY29sb3IsCiAgICAgICAgYm9yZGVyUmFkaXVzOiAnNXB4JywKICAgICAgICBmb250U2l6ZTogJzEzcHgnLAogICAgICAgIGxpbmVIZWlnaHQ6ICcxN3B4JywKICAgICAgICBwYWRkaW5nOiAnMnB4IDE5cHggMnB4IDVweCcsCiAgICAgICAgbWFyZ2luVG9wOiAnNXB4JywKICAgICAgICBvcGFjaXR5OiAwLjkKICAgICAgfSk7CgogICAgICBpZiAoYm94U3R5bGUpCiAgICAgICAgdGhpcy5zZXRTdHlsZShpbmZvLCBib3hTdHlsZSk7CgogICAgICB2YXIgY2xvc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgIGNsb3NlLnRleHRDb250ZW50ID0gU3RyaW5nLmZyb21DaGFyQ29kZSgyMTUpOwogICAgICB0aGlzLnNldFN0eWxlKGNsb3NlLCB7CiAgICAgICAgY29sb3I6IGNvbG9yLAogICAgICAgIHdpZHRoOiAnMTRweCcsCiAgICAgICAgaGVpZ2h0OiAnMTRweCcsCiAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICBmb250V2VpZ2h0OiAnYm9sZCcsCiAgICAgICAgbGluZUhlaWdodDogJzE0cHgnLAogICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgIHRvcDogMCwKICAgICAgICByaWdodDogMCwKICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicsCiAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgfSk7CgogICAgICBpZiAoYnRuU3R5bGUpCiAgICAgICAgdGhpcy5zZXRTdHlsZShjbG9zZSwgYnRuU3R5bGUpOwoKICAgICAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHsKICAgICAgICBpbmZvLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaW5mbyk7CiAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICBhY3Rpb246ICd1cGRhdGVPcHRpb24nLAogICAgICAgICAga2V5OiAnbW9kdWxlU2hvd0Rvd25sb2FkSW5mbycsCiAgICAgICAgICB2YWx1ZTogMAogICAgICAgIH0pOwogICAgICB9LCBmYWxzZSk7CgogICAgICBpbmZvLmFwcGVuZENoaWxkKGNsb3NlKTsKICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGluZm8pOwogICAgfSwKCiAgICBhcHBlbmRGaWxlU2l6ZUljb246IGZ1bmN0aW9uKGxpbmssIGljb25TdHlsZSwgdGV4dFN0eWxlLCBlcnJvciwgbm9CcmFja2V0cywgY29udGFpbmVyKSB7CiAgICAgIHZhciBsYW5ndWFnZSA9IG1vbm8uZ2xvYmFsLmxhbmd1YWdlOwogICAgICBpY29uU3R5bGUgPSBpY29uU3R5bGUgfHwge307CiAgICAgIHRleHRTdHlsZSA9IHRleHRTdHlsZSB8fCB7fTsKCiAgICAgIHZhciBpY29uQ29sb3IgPSAnIzMzMzMzMyc7CiAgICAgIGlmIChlcnJvcikgewogICAgICAgIGljb25Db2xvciA9ICcjZmYwMDAwJzsKICAgICAgfSBlbHNlCiAgICAgIGlmIChpY29uU3R5bGUuY29sb3IpIHsKICAgICAgICBpY29uQ29sb3IgPSBpY29uU3R5bGUuY29sb3I7CiAgICAgIH0KCiAgICAgIHZhciBkZWZJY29uU3R5bGUgPSB7CiAgICAgICAgd2lkdGg6ICcxNHB4JywKICAgICAgICBoZWlnaHQ6ICcxNHB4JywKICAgICAgICBtYXJnaW5MZWZ0OiAnM3B4JywKICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICB0b3A6ICctMXB4JywKICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICB9OwogICAgICBtb25vLmV4dGVuZChkZWZJY29uU3R5bGUsIGljb25TdHlsZSk7CgogICAgICB2YXIgZGVmVGV4dFN0eWxlID0gewogICAgICAgIGZvbnRTaXplOiAnNzUlJywKICAgICAgICBmb250V2VpZ2h0OiAnbm9ybWFsJywKICAgICAgICBtYXJnaW5MZWZ0OiAnM3B4JywKICAgICAgICB3aGl0ZVNwYWNlOiAnbm93cmFwJwogICAgICB9OwogICAgICBtb25vLmV4dGVuZChkZWZUZXh0U3R5bGUsIHRleHRTdHlsZSk7CgogICAgICB2YXIgZnNCdG4gPSBtb25vLmNyZWF0ZSgnaW1nJywgewogICAgICAgIHNyYzogU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnaW5mbycsIGljb25Db2xvciksCiAgICAgICAgdGl0bGU6IGVycm9yID8gbGFuZ3VhZ2UuZ2V0RmlsZVNpemVGYWlsVGl0bGUgOiBsYW5ndWFnZS5nZXRGaWxlU2l6ZVRpdGxlLAogICAgICAgIHN0eWxlOiBkZWZJY29uU3R5bGUKICAgICAgfSk7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChmc0J0bik7CiAgICAgIH0gZWxzZQogICAgICBpZiAobGluay5uZXh0U2libGluZykgewogICAgICAgIGxpbmsucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZnNCdG4sIGxpbmsubmV4dFNpYmxpbmcpOwogICAgICB9IGVsc2UgewogICAgICAgIGxpbmsucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChmc0J0bik7CiAgICAgIH0KCiAgICAgIGZzQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICB2YXIgbm9kZSA9IG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgdGV4dDogJy4uLicsCiAgICAgICAgICBzdHlsZTogZGVmVGV4dFN0eWxlCiAgICAgICAgfSk7CgogICAgICAgIGZzQnRuLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5vZGUsIGZzQnRuKTsKCiAgICAgICAgcmV0dXJuIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAnZ2V0RmlsZVNpemUnLAogICAgICAgICAgdXJsOiBsaW5rLmhyZWYKICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmZpbGVTaXplID4gMCkgewogICAgICAgICAgICB2YXIgZmlsZVR5cGUgPSByZXNwb25zZS5maWxlVHlwZSB8fCAnJzsKICAgICAgICAgICAgdmFyIHNpemUgPSBfdGhpcy5zaXplSHVtYW4ocmVzcG9uc2UuZmlsZVNpemUsIDIpOwogICAgICAgICAgICB2YXIgYml0cmF0ZSA9ICcnOwogICAgICAgICAgICBpZiAoL15hdWRpb1wvL2kudGVzdChmaWxlVHlwZSkpIHsKICAgICAgICAgICAgICB2YXIgc2Vjb25kcyA9IGxpbmsuZ2V0QXR0cmlidXRlKCdkYXRhLXNhdmVmcm9tLWhlbHBlci1kdXJhdGlvbicpOwogICAgICAgICAgICAgIHNlY29uZHMgPSBzZWNvbmRzICYmIHBhcnNlSW50KHNlY29uZHMpOwogICAgICAgICAgICAgIGlmIChzZWNvbmRzID4gMCkgewogICAgICAgICAgICAgICAgYml0cmF0ZSA9IE1hdGguZmxvb3IoKHJlc3BvbnNlLmZpbGVTaXplIC8gc2Vjb25kcykgLyAxMjUpOwogICAgICAgICAgICAgICAgYml0cmF0ZSArPSAnICcgKyBtb25vLmdsb2JhbC5sYW5ndWFnZS5rYnBzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgdGV4dCA9ICcnOwoKICAgICAgICAgICAgaWYgKGJpdHJhdGUpIHsKICAgICAgICAgICAgICB0ZXh0ID0gc2l6ZSArICcgfiAnICsgYml0cmF0ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0ZXh0ID0gc2l6ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFub0JyYWNrZXRzKSB7CiAgICAgICAgICAgICAgdGV4dCA9ICcoJyArIHRleHQgKyAnKSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSB0ZXh0OwogICAgICAgICAgICBub2RlLnRpdGxlID0gZmlsZVR5cGU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgZXJyQnRuID0gX3RoaXMuYXBwZW5kRmlsZVNpemVJY29uKGxpbmssIGljb25TdHlsZSwgdGV4dFN0eWxlLCB0cnVlLCBub0JyYWNrZXRzLCBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkpOwogICAgICAgICAgICBub2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGVyckJ0biwgbm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sIGZhbHNlKTsKCiAgICAgIHJldHVybiBmc0J0bjsKICAgIH0sCgogICAgYXBwZW5kTm9Tb3VuZEljb246IGZ1bmN0aW9uKGxpbmssIGljb25TdHlsZSkgewogICAgICBpY29uU3R5bGUgPSBpY29uU3R5bGUgfHwge307CgogICAgICB2YXIgbm9Tb3VuZEljb25Db2xvciA9ICcjZmYwMDAwJzsKICAgICAgaWYgKGljb25TdHlsZS5jb2xvcikgewogICAgICAgIG5vU291bmRJY29uQ29sb3IgPSBpY29uU3R5bGUuY29sb3I7CiAgICAgIH0KCiAgICAgIHZhciBkZWZJY29uU3R5bGUgPSB7CiAgICAgICAgd2lkdGg6ICcxNHB4JywKICAgICAgICBoZWlnaHQ6ICcxNHB4JywKICAgICAgICBtYXJnaW5MZWZ0OiAnM3B4JywKICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICB0b3A6ICctMXB4JywKICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICB9OwogICAgICBtb25vLmV4dGVuZChkZWZJY29uU3R5bGUsIGljb25TdHlsZSk7CgogICAgICB2YXIgaWNvbiA9IG1vbm8uY3JlYXRlKCdpbWcnLCB7CiAgICAgICAgc3JjOiBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdub1NvdW5kJywgbm9Tb3VuZEljb25Db2xvciksCiAgICAgICAgdGl0bGU6IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLndpdGhvdXRBdWRpbywKICAgICAgICBzdHlsZTogZGVmSWNvblN0eWxlCiAgICAgIH0pOwoKICAgICAgaWYgKGxpbmsubmV4dFNpYmxpbmcpIHsKICAgICAgICBsaW5rLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGljb24sIGxpbmsubmV4dFNpYmxpbmcpOwogICAgICB9IGVsc2UKICAgICAgaWYgKGxpbmsucGFyZW50Tm9kZSkgewogICAgICAgIGxpbmsucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChpY29uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaW5rLmFwcGVuZENoaWxkKGljb24pOwogICAgICB9CiAgICB9LAoKICAgIHZpZGVvOiB7CiAgICAgIGRhdGFBdHRyOiAnZGF0YS1zYXZlZnJvbS12aWRlby12aXNpYmxlJywKICAgICAgeXQ6IHsKICAgICAgICBpbml0ZWQ6IGZhbHNlLAoKICAgICAgICBzaG93M0Q6IGZhbHNlLAogICAgICAgIHNob3dNUDROb0F1ZGlvOiBmYWxzZSwKCiAgICAgICAgc2hvd0Zvcm1hdDogewogICAgICAgICAgJ0ZMVic6IHRydWUsCiAgICAgICAgICAnTVA0JzogdHJ1ZSwKICAgICAgICAgICdXZWJNJzogZmFsc2UsCiAgICAgICAgICAnM0dQJzogZmFsc2UsCiAgICAgICAgICAnQXVkaW8gQUFDJzogZmFsc2UsCiAgICAgICAgICAnQXVkaW8gVm9yYmlzJzogZmFsc2UsCiAgICAgICAgICAnQXVkaW8gT3B1cyc6IGZhbHNlCiAgICAgICAgfSwKCiAgICAgICAgZm9ybWF0OiB7CiAgICAgICAgICAnRkxWJzogewogICAgICAgICAgICAnNSc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMjQwJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnNic6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMjcwJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnMzQnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzM2MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzM1JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc0ODAnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCgogICAgICAgICAgJ01QNCc6IHsKICAgICAgICAgICAgJzE4JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICczNjAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyMic6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNzIwJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnMzcnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzEwODAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICczOCc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnOEsnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICc1OSc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNDgwJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnNzgnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzQ4MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzgyJzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICczNjAnLAogICAgICAgICAgICAgICczZCc6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzgzJzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICcyNDAnLAogICAgICAgICAgICAgICczZCc6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzg0JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc3MjAnLAogICAgICAgICAgICAgICczZCc6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzg1JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICcxMDgwJywKICAgICAgICAgICAgICAnM2QnOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxNjAnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzE0NCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMTMzJzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICcyNDAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzEzNCc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMzYwJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxMzUnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzQ4MCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMTM2JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc3MjAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzEzNyc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMTA4MCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMjY0JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICcxNDQwJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxMzgnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzhLJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyOTgnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzcyMCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZSwKICAgICAgICAgICAgICBzRnBzOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyOTknOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzEwODAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUsCiAgICAgICAgICAgICAgc0ZwczogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMjY2JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc0SycsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICB9LAoKICAgICAgICAgICdXZWJNJzogewogICAgICAgICAgICAnNDMnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzM2MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzQ0JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc0ODAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICc0NSc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNzIwJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnNDYnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzEwODAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxNjcnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzM2MCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMTY4JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc0ODAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzE2OSc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNzIwJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxNzAnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzEwODAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzIxOCc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNDgwJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyMTknOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzQ4MCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMjQyJzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICcyNDAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzI0Myc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMzYwJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyNDQnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzQ4MCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMjQ1JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc0ODAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzI0Nic6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNDgwJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyNDcnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzcyMCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMjQ4JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICcxMDgwJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyNzEnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzE0NDAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzI3Mic6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnOEsnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzI3OCc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMTQ0JywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxMDAnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzM2MCcsCiAgICAgICAgICAgICAgJzNkJzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMTAxJzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc0ODAnLAogICAgICAgICAgICAgICczZCc6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzEwMic6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNzIwJywKICAgICAgICAgICAgICAnM2QnOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICczMDInOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzcyMCcsCiAgICAgICAgICAgICAgbm9BdWRpbzogdHJ1ZSwKICAgICAgICAgICAgICBzRnBzOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICczMDMnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzEwODAnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUsCiAgICAgICAgICAgICAgc0ZwczogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMzA4JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICcxNDQwJywKICAgICAgICAgICAgICBub0F1ZGlvOiB0cnVlLAogICAgICAgICAgICAgIHNGcHM6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzMxMyc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNEsnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzMxNSc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnNEsnLAogICAgICAgICAgICAgIG5vQXVkaW86IHRydWUsCiAgICAgICAgICAgICAgc0ZwczogdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICB9LAoKICAgICAgICAgICczR1AnOiB7CiAgICAgICAgICAgICcxNyc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMTQ0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnMzYnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzI0MCcKICAgICAgICAgICAgfQogICAgICAgICAgfSwKCiAgICAgICAgICAnQXVkaW8gQUFDJzogewogICAgICAgICAgICAnMTM5JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc0OCcsCiAgICAgICAgICAgICAgZXh0OiAnYWFjJywKICAgICAgICAgICAgICBub1ZpZGVvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxNDAnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzEyOCcsCiAgICAgICAgICAgICAgZXh0OiAnYWFjJywKICAgICAgICAgICAgICBub1ZpZGVvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxNDEnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzI1NicsCiAgICAgICAgICAgICAgZXh0OiAnYWFjJywKICAgICAgICAgICAgICBub1ZpZGVvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyNTYnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzE5MicsCiAgICAgICAgICAgICAgZXh0OiAnYWFjJywKICAgICAgICAgICAgICBub1ZpZGVvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcyNTgnOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzM4NCcsCiAgICAgICAgICAgICAgZXh0OiAnYWFjJywKICAgICAgICAgICAgICBub1ZpZGVvOiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCgogICAgICAgICAgJ0F1ZGlvIFZvcmJpcyc6IHsKICAgICAgICAgICAgJzE3MSc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMTI4JywKICAgICAgICAgICAgICBleHQ6ICd3ZWJtJywKICAgICAgICAgICAgICBub1ZpZGVvOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICcxNzInOiB7CiAgICAgICAgICAgICAgcXVhbGl0eTogJzE5MicsCiAgICAgICAgICAgICAgZXh0OiAnd2VibScsCiAgICAgICAgICAgICAgbm9WaWRlbzogdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICB9LAoKICAgICAgICAgICdBdWRpbyBPcHVzJzogewogICAgICAgICAgICAnMjQ5JzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICc0OCcsCiAgICAgICAgICAgICAgZXh0OiAnb3B1cycsCiAgICAgICAgICAgICAgbm9WaWRlbzogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICAnMjUwJzogewogICAgICAgICAgICAgIHF1YWxpdHk6ICcxMjgnLAogICAgICAgICAgICAgIGV4dDogJ29wdXMnLAogICAgICAgICAgICAgIG5vVmlkZW86IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJzI1MSc6IHsKICAgICAgICAgICAgICBxdWFsaXR5OiAnMjU2JywKICAgICAgICAgICAgICBleHQ6ICdvcHVzJywKICAgICAgICAgICAgICBub1ZpZGVvOiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAoKCiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoU2F2ZUZyb21fVXRpbHMudmlkZW8ueXQuaW5pdGVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBbJ0F1ZGlvIEFBQycsICdBdWRpbyBWb3JiaXMnLCAnQXVkaW8gT3B1cyddLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICB2YXIgZm9ybWF0VHlwZSA9IFNhdmVGcm9tX1V0aWxzLnZpZGVvLnl0LmZvcm1hdFtpdGVtXTsKICAgICAgICAgICAgZm9yICh2YXIgcXVhbGl0eVZhbHVlIGluIGZvcm1hdFR5cGUpIHsKICAgICAgICAgICAgICBmb3JtYXRUeXBlW3F1YWxpdHlWYWx1ZV0ucXVhbGl0eSArPSAnICcgKyBtb25vLmdsb2JhbC5sYW5ndWFnZS5rYnBzOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBTYXZlRnJvbV9VdGlscy52aWRlby55dC5zaG93M0QgPSBtb25vLmdsb2JhbC5wcmVmZXJlbmNlLnl0SGlkZTNEID09ICcwJzsKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnZpZGVvLnl0LnNob3dNUDROb0F1ZGlvID0gbW9uby5nbG9iYWwucHJlZmVyZW5jZS55dEhpZGVNUDROb0F1ZGlvID09ICcwJzsKCiAgICAgICAgICB2YXIgc2hvdyA9IGZhbHNlOwogICAgICAgICAgdmFyIHNob3dBdWRpbyA9IGZhbHNlOwogICAgICAgICAgZm9yICh2YXIgaSBpbiBTYXZlRnJvbV9VdGlscy52aWRlby55dC5zaG93Rm9ybWF0KSB7CiAgICAgICAgICAgIHZhciBwcmVmTmFtZSA9ICd5dEhpZGUnICsgaS5yZXBsYWNlKCcgJywgJ18nKTsKICAgICAgICAgICAgaWYgKHByZWZOYW1lID09PSAneXRIaWRlQXVkaW9fQUFDJykgewogICAgICAgICAgICAgIHByZWZOYW1lID0gJ3l0SGlkZUF1ZGlvX01QNCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHZhbHVlID0gbW9uby5nbG9iYWwucHJlZmVyZW5jZVtwcmVmTmFtZV0gPT0gJzAnOwogICAgICAgICAgICBpZiAoaSA9PT0gJ0F1ZGlvIEFBQycpIHsKICAgICAgICAgICAgICBzaG93QXVkaW8gPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBTYXZlRnJvbV9VdGlscy52aWRlby55dC5zaG93Rm9ybWF0W2ldID0gdmFsdWU7CiAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgIHNob3cgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgU2F2ZUZyb21fVXRpbHMudmlkZW8ueXQuc2hvd0Zvcm1hdFsnQXVkaW8gVm9yYmlzJ10gPSBzaG93QXVkaW87CiAgICAgICAgICBTYXZlRnJvbV9VdGlscy52aWRlby55dC5zaG93Rm9ybWF0WydBdWRpbyBPcHVzJ10gPSBzaG93QXVkaW87CgogICAgICAgICAgaWYgKCFzaG93KSB7CiAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnZpZGVvLnl0LnNob3dGb3JtYXQuRkxWID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBTYXZlRnJvbV9VdGlscy52aWRlby55dC5pbml0ZWQgPSB0cnVlOwogICAgICAgIH0sCgoKICAgICAgICBzaG93OiBmdW5jdGlvbihsaW5rcywgcGFyZW50LCBzaG93RG93bmxvYWRJbmZvLCBzdHlsZSwgdmlkZW9UaXRsZSkgewogICAgICAgICAgc3R5bGUgPSBzdHlsZSB8fCB7fTsKCiAgICAgICAgICB2YXIgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgU2F2ZUZyb21fVXRpbHMuc2V0U3R5bGUoY29udGVudCwgewogICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgbWFyZ2luOiAnMCBhdXRvJwogICAgICAgICAgfSk7CiAgICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoY29udGVudCk7CgogICAgICAgICAgdmFyIGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgU2F2ZUZyb21fVXRpbHMuc2V0U3R5bGUoYm94LCB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICBwYWRkaW5nOiAnMCA5MHB4IDAgMCcsCiAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnCiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoYm94KTsKCiAgICAgICAgICB2YXIgdGJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGFibGUnKTsKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKHRibCwgewogICAgICAgICAgICBlbXB0eUNlbGxzOiAnc2hvdycsCiAgICAgICAgICAgIGJvcmRlckNvbGxhcHNlOiAnY29sbGFwc2UnLAogICAgICAgICAgICBtYXJnaW46ICcwIGF1dG8nLAogICAgICAgICAgICBwYWRkaW5nOiAnMCcsCiAgICAgICAgICAgIHdpZHRoOiAnYXV0bycKICAgICAgICAgIH0pOwogICAgICAgICAgYm94LmFwcGVuZENoaWxkKHRibCk7CgogICAgICAgICAgdmFyIGhpZGRlbiA9IGZhbHNlOwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gU2F2ZUZyb21fVXRpbHMudmlkZW8ueXQuZm9ybWF0KSB7CiAgICAgICAgICAgIGlmIChTYXZlRnJvbV9VdGlscy52aWRlby55dC5hcHBlbmQobGlua3MsIGksCiAgICAgICAgICAgICAgICBTYXZlRnJvbV9VdGlscy52aWRlby55dC5mb3JtYXRbaV0sIHRibCwgc3R5bGUsIHZpZGVvVGl0bGUpKSB7CiAgICAgICAgICAgICAgaGlkZGVuID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIGkgaW4gbGlua3MpIHsKICAgICAgICAgICAgaWYgKGkgPT09ICd1bW15JyB8fCBpID09PSAndW1teUF1ZGlvJyB8fCBpID09PSAnbWV0YScpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoU2F2ZUZyb21fVXRpbHMudmlkZW8ueXQuYXBwZW5kKGxpbmtzLCAnJywgbnVsbCwgdGJsLCBzdHlsZSwgdmlkZW9UaXRsZSkpIHsKICAgICAgICAgICAgICBoaWRkZW4gPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXRibC5maXJzdENoaWxkKSB7CiAgICAgICAgICAgIHBhcmVudC50ZXh0Q29udGVudCA9IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLm5vTGlua3NGb3VuZDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghaGlkZGVuKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgdmFyIG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICBtb3JlLnRleHRDb250ZW50ID0gbW9uby5nbG9iYWwubGFuZ3VhZ2UubW9yZSArICcgJyArIFN0cmluZy5mcm9tQ2hhckNvZGUoMTg3KTsKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKG1vcmUsIHsKICAgICAgICAgICAgY29sb3I6ICcjNTU1JywKICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkICNhMGEwYTAnLAogICAgICAgICAgICBib3JkZXJSYWRpdXM6ICczcHgnLAogICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLAogICAgICAgICAgICBmb250RmFtaWx5OiAnQXJpYWwnLAogICAgICAgICAgICBmb250U2l6ZTogJzE1cHgnLAogICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMTdweCcsCiAgICAgICAgICAgIHBhZGRpbmc6ICcxcHggNXB4JywKICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgIGJvdHRvbTogJzNweCcsCiAgICAgICAgICAgIHJpZ2h0OiAnMCcsCiAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoc3R5bGUuYnRuICYmIHR5cGVvZihzdHlsZS5idG4pID09ICdvYmplY3QnKQogICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZShtb3JlLCBzdHlsZS5idG4pOwoKICAgICAgICAgIGJveC5hcHBlbmRDaGlsZChtb3JlKTsKCiAgICAgICAgICBtb3JlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgICB2YXIgZSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCcqWycgKyBTYXZlRnJvbV9VdGlscy52aWRlby5kYXRhQXR0ciArICddJyk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHZhciB2aXNpYmxlID0gZVtpXS5nZXRBdHRyaWJ1dGUoU2F2ZUZyb21fVXRpbHMudmlkZW8uZGF0YUF0dHIpOwogICAgICAgICAgICAgIHZhciBkaXNwbGF5ID0gJ25vbmUnLAogICAgICAgICAgICAgICAgc3ltYm9sID0gU3RyaW5nLmZyb21DaGFyQ29kZSgxODcpOwogICAgICAgICAgICAgIGlmICh2aXNpYmxlID09ICcwJykgewogICAgICAgICAgICAgICAgdmlzaWJsZSA9ICcxJzsKICAgICAgICAgICAgICAgIGRpc3BsYXkgPSAnJzsKICAgICAgICAgICAgICAgIHN5bWJvbCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMTcxKTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHZpc2libGUgPSAnMCc7CgogICAgICAgICAgICAgIGVbaV0uc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7CiAgICAgICAgICAgICAgZVtpXS5zZXRBdHRyaWJ1dGUoU2F2ZUZyb21fVXRpbHMudmlkZW8uZGF0YUF0dHIsIHZpc2libGUpOwogICAgICAgICAgICAgIHRoaXMudGV4dENvbnRlbnQgPSBtb25vLmdsb2JhbC5sYW5ndWFnZS5tb3JlICsgJyAnICsgc3ltYm9sOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9LCBmYWxzZSk7CgoKICAgICAgICAgIGlmIChzaG93RG93bmxvYWRJbmZvID09PSAxKSB7CiAgICAgICAgICAgIHZhciBjb2xvciA9ICcjYTBhMGEwJywKICAgICAgICAgICAgICBhID0gdGJsLnF1ZXJ5U2VsZWN0b3IoJ3RkIGEnKTsKCiAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnInKSk7CiAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmFwcGVuZERvd25sb2FkSW5mbyhjb250ZW50LCBjb2xvciwgbnVsbCwgewogICAgICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICAgICAgaGVpZ2h0OiAnMTZweCcsCiAgICAgICAgICAgICAgZm9udFNpemU6ICcxNnB4JywKICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMTZweCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKCgogICAgICAgIGFwcGVuZDogZnVuY3Rpb24obGlua3MsIHRpdGxlLCBmb3JtYXQsIHBhcmVudCwgc3R5bGUsIHZpZGVvVGl0bGUpIHsKICAgICAgICAgIHZhciBoaWRkZW4gPSBmYWxzZTsKCiAgICAgICAgICB2YXIgYVN0eWxlID0gewogICAgICAgICAgICB3aGl0ZVNwYWNlOiAnbm93cmFwJwogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgc1N0eWxlID0gewogICAgICAgICAgICBmb250U2l6ZTogJzc1JScsCiAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICdub3JtYWwnLAogICAgICAgICAgICBtYXJnaW5MZWZ0OiAnM3B4JywKICAgICAgICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKCiAgICAgICAgICB2YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwogICAgICAgICAgdGQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGl0bGUgPyB0aXRsZSA6ICc/Pz8nKSk7CgogICAgICAgICAgaWYgKCF0aXRsZSB8fCAhU2F2ZUZyb21fVXRpbHMudmlkZW8ueXQuc2hvd0Zvcm1hdFt0aXRsZV0pIHsKICAgICAgICAgICAgdHIuc2V0QXR0cmlidXRlKFNhdmVGcm9tX1V0aWxzLnZpZGVvLmRhdGFBdHRyLCAnMCcpOwogICAgICAgICAgICB0ci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBoaWRkZW4gPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKHRkLCB7CiAgICAgICAgICAgIGJvcmRlcjogJ25vbmUnLAogICAgICAgICAgICBwYWRkaW5nOiAnM3B4IDE1cHggM3B4IDAnLAogICAgICAgICAgICB0ZXh0QWxpZ246ICdsZWZ0JywKICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRyLmFwcGVuZENoaWxkKHRkKTsKCiAgICAgICAgICB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZSh0ZCwgewogICAgICAgICAgICBib3JkZXI6ICdub25lJywKICAgICAgICAgICAgcGFkZGluZzogJzNweCAwJywKICAgICAgICAgICAgdGV4dEFsaWduOiAnbGVmdCcsCiAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICdtaWRkbGUnLAogICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMTdweCcKICAgICAgICAgIH0pOwogICAgICAgICAgdHIuYXBwZW5kQ2hpbGQodGQpOwoKICAgICAgICAgIHZhciBtZXRhID0gbGlua3MubWV0YSB8fCB7fTsKCiAgICAgICAgICB2YXIgc2VwID0gZmFsc2U7CiAgICAgICAgICBpZiAoZm9ybWF0KSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZm9ybWF0KSB7CiAgICAgICAgICAgICAgaWYgKGxpbmtzW2ldKSB7CiAgICAgICAgICAgICAgICB2YXIgcXVhbGl0eSA9IGZvcm1hdFtpXS5xdWFsaXR5OwogICAgICAgICAgICAgICAgaWYgKHNlcCkgewogICAgICAgICAgICAgICAgICB0ZC5sYXN0Q2hpbGQuc3R5bGUubWFyZ2luUmlnaHQgPSAnMTVweCc7CiAgICAgICAgICAgICAgICAgIHRkLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcgJykpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgc3Bhbi5zdHlsZS53aGl0ZVNwYWNlID0gJ25vd3JhcCc7CgogICAgICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICBhLmhyZWYgPSBsaW5rc1tpXTsKICAgICAgICAgICAgICAgIGEudGl0bGUgPSBtb25vLmdsb2JhbC5sYW5ndWFnZS5kb3dubG9hZFRpdGxlOwoKICAgICAgICAgICAgICAgIGlmIChtZXRhW2ldKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtZXRhW2ldLnF1YWxpdHkpIHsKICAgICAgICAgICAgICAgICAgICBxdWFsaXR5ID0gbWV0YVtpXS5xdWFsaXR5OwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoZm9ybWF0W2ldLnNGcHMpIHsKICAgICAgICAgICAgICAgICAgICBxdWFsaXR5ICs9ICcgJyArIChtZXRhW2ldLmZwcyB8fCA2MCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0W2ldWyczZCddKSB7CiAgICAgICAgICAgICAgICAgIGEudGV4dENvbnRlbnQgPSAnM0QnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgYS50ZXh0Q29udGVudCA9IHF1YWxpdHk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodmlkZW9UaXRsZSkgewogICAgICAgICAgICAgICAgICB2YXIgZXh0ID0gZm9ybWF0W2ldWydleHQnXTsKICAgICAgICAgICAgICAgICAgaWYgKCFleHQpCiAgICAgICAgICAgICAgICAgICAgZXh0ID0gdGl0bGUudG9Mb3dlckNhc2UoKTsKCiAgICAgICAgICAgICAgICAgIGEuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIG1vbm8uZmlsZU5hbWUubW9kaWZ5KHZpZGVvVGl0bGUgKyAnLicgKyBleHQpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXRbaV0ubm9WaWRlbyB8fCBmb3JtYXRbaV0ubm9BdWRpbykgewogICAgICAgICAgICAgICAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRPbkNsaWNrKGV2ZW50KTsKICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKGEsIGFTdHlsZSk7CiAgICAgICAgICAgICAgICBpZiAoc3R5bGUubGluayAmJiB0eXBlb2Yoc3R5bGUubGluaykgPT0gJ29iamVjdCcpCiAgICAgICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKGEsIHN0eWxlLmxpbmspOwoKICAgICAgICAgICAgICAgIHNwYW4uYXBwZW5kQ2hpbGQoYSk7CiAgICAgICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5hcHBlbmRGaWxlU2l6ZUljb24oYSwgc3R5bGUuZnNJY29uLCBzdHlsZS5mc1RleHQpOwoKICAgICAgICAgICAgICAgIGlmIChmb3JtYXRbaV1bJzNkJ10pIHsKICAgICAgICAgICAgICAgICAgaWYgKCFTYXZlRnJvbV9VdGlscy52aWRlby55dC5zaG93M0QpIHsKICAgICAgICAgICAgICAgICAgICBoaWRkZW4gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlKFNhdmVGcm9tX1V0aWxzLnZpZGVvLmRhdGFBdHRyLCAnMCcpOwogICAgICAgICAgICAgICAgICAgIHNwYW4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICAgIHMudGV4dENvbnRlbnQgPSBxdWFsaXR5OwogICAgICAgICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZShzLCBzU3R5bGUpOwogICAgICAgICAgICAgICAgICBpZiAoc3R5bGUudGV4dCAmJiB0eXBlb2Yoc3R5bGUudGV4dCkgPT0gJ29iamVjdCcpCiAgICAgICAgICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMuc2V0U3R5bGUocywgc3R5bGUudGV4dCk7CgogICAgICAgICAgICAgICAgICBhLmFwcGVuZENoaWxkKHMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChmb3JtYXRbaV1bJ25vQXVkaW8nXSkgewogICAgICAgICAgICAgICAgICBpZiAoIVNhdmVGcm9tX1V0aWxzLnZpZGVvLnl0LnNob3dNUDROb0F1ZGlvKSB7CiAgICAgICAgICAgICAgICAgICAgaGlkZGVuID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZShTYXZlRnJvbV9VdGlscy52aWRlby5kYXRhQXR0ciwgJzAnKTsKICAgICAgICAgICAgICAgICAgICBzcGFuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmFwcGVuZE5vU291bmRJY29uKGEsIHN0eWxlID8gc3R5bGUubm9Tb3VuZEljb24gOiBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGQuYXBwZW5kQ2hpbGQoc3Bhbik7CgogICAgICAgICAgICAgICAgc2VwID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBkZWxldGUgbGlua3NbaV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKHZhciBpIGluIGxpbmtzKSB7CiAgICAgICAgICAgICAgaWYgKHNlcCkgewogICAgICAgICAgICAgICAgdGQubGFzdENoaWxkLnN0eWxlLm1hcmdpblJpZ2h0ID0gJzE1cHgnOwogICAgICAgICAgICAgICAgdGQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyAnKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgICBzcGFuLnN0eWxlLndoaXRlU3BhY2UgPSAnbm93cmFwJzsKCiAgICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgYS5ocmVmID0gbGlua3NbaV07CiAgICAgICAgICAgICAgYS50aXRsZSA9IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLmRvd25sb2FkVGl0bGU7CiAgICAgICAgICAgICAgYS50ZXh0Q29udGVudCA9IGk7CiAgICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMuc2V0U3R5bGUoYSwgYVN0eWxlKTsKICAgICAgICAgICAgICBpZiAoc3R5bGUubGluayAmJiB0eXBlb2Yoc3R5bGUubGluaykgPT0gJ29iamVjdCcpCiAgICAgICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZShhLCBzdHlsZS5saW5rKTsKCiAgICAgICAgICAgICAgc3Bhbi5hcHBlbmRDaGlsZChhKTsKICAgICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5hcHBlbmRGaWxlU2l6ZUljb24oYSwgc3R5bGUuZnNJY29uLCBzdHlsZS5mc1RleHQpOwogICAgICAgICAgICAgIHRkLmFwcGVuZENoaWxkKHNwYW4pOwoKICAgICAgICAgICAgICBzZXAgPSB0cnVlOwoKICAgICAgICAgICAgICBkZWxldGUgbGlua3NbaV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2VwID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodHIpOwoKICAgICAgICAgIHJldHVybiBoaWRkZW47CiAgICAgICAgfQogICAgICB9CiAgICB9LCAvLyB2aWRlbwoKCiAgICBwbGF5bGlzdDogewogICAgICBidG5TdHlsZTogewogICAgICAgIGRpc3BsYXk6ICdibG9jaycsCiAgICAgICAgZm9udFdlaWdodDogJ2JvbGQnLAogICAgICAgIGJvcmRlcjogJ25vbmUnLAogICAgICAgIHRleHREZWNvcmF0aW9uOiAndW5kZXJsaW5lJwogICAgICB9LAoKCiAgICAgIGdldEZpbGVsaXN0SHRtbDogZnVuY3Rpb24obGlua3MpIHsKICAgICAgICBpZiAoIWxpbmtzIHx8IGxpbmtzLmxlbmd0aCA9PSAwKQogICAgICAgICAgcmV0dXJuOwoKICAgICAgICB2YXIgcm93cyA9IDA7CiAgICAgICAgdmFyIGxpc3QgPSAnJzsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5rcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGxpbmtzW2ldLnVybCkgewogICAgICAgICAgICBsaXN0ICs9IGxpbmtzW2ldLnVybCArICdcclxuJzsKICAgICAgICAgICAgcm93cysrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGxpc3QpIHsKICAgICAgICAgIGlmIChyb3dzIDwgNSkgewogICAgICAgICAgICByb3dzID0gNTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKHJvd3MgPiAxNCkgewogICAgICAgICAgICByb3dzID0gMTQ7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1vbm8uY3JlYXRlKGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwgewogICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICAgIHRleHQ6IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLmZpbGVsaXN0VGl0bGUsCiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBjb2xvcjogJyMwRDBEMEQnLAogICAgICAgICAgICAgICAgICBmb250U2l6ZTogJzIwcHgnLAogICAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICcxMXB4JywKICAgICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAnNXB4JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnMTFweCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IG1vbm8ucGFyc2VUZW1wbGF0ZShtb25vLmdsb2JhbC5sYW5ndWFnZS5maWxlbGlzdEluc3RydWN0aW9uKQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgICAgdGV4dDogbW9uby5nbG9iYWwubGFuZ3VhZ2UudmtGb3VuZEZpbGVzLnJlcGxhY2UoJyVkJywgbGlua3MubGVuZ3RoKSwKICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzAwMCcsCiAgICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzExcHgnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYXBwZW5kOiBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogbW9uby5nbG9iYWwubGFuZ3VhZ2UucGxheWxpc3QsCiAgICAgICAgICAgICAgICAgIGhyZWY6ICcjJywKICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZl9fcGxheWxpc3QnLAogICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICAgICAgICAgICAgICBjc3NGbG9hdDogJ3JpZ2h0JwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCd0ZXh0YXJlYScsIHsKICAgICAgICAgICAgICAgIHRleHQ6IGxpc3QsCiAgICAgICAgICAgICAgICByb3dzOiByb3dzLAogICAgICAgICAgICAgICAgY29sczogNjAsCiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICB3aWR0aDogJzEwMCUnLAogICAgICAgICAgICAgICAgICB3aGl0ZVNwYWNlOiAobW9uby5pc0ZGIHx8IG1vbm8uaXNHbU9ubHkpID8gJ25vcm1hbCcgOiAnbm93cmFwJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICghbW9uby5pc0Nocm9tZSAmJiAhbW9uby5pc0ZGKSA/IHVuZGVmaW5lZCA6IG1vbm8uY3JlYXRlKCdidXR0b24nLCB7CiAgICAgICAgICAgICAgICB0ZXh0OiBtb25vLmdsb2JhbC5sYW5ndWFnZS5jb3B5LAogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMjdweCcsCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLAogICAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgIzllOWU5ZScsCiAgICAgICAgICAgICAgICAgIG1hcmdpblRvcDogJzZweCcsCiAgICAgICAgICAgICAgICAgIHBhZGRpbmdMZWZ0OiAnMTBweCcsCiAgICAgICAgICAgICAgICAgIHBhZGRpbmdSaWdodDogJzEwcHgnLAogICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc1cHgnLAogICAgICAgICAgICAgICAgICBmb250U2l6ZTogJzE0cHgnLAogICAgICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJywKICAgICAgICAgICAgICAgICAgY3NzRmxvYXQ6ICdyaWdodCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgICAgICAgX3RoaXMuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdhZGRUb0NsaXBib2FyZCcsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogbGlzdAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgYXBwZW5kOiBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dCh7CiAgICAgICAgICAgICAgICAgICAgJyNzYXZlZnJvbV9wb3B1cF9ib3gnOiB7CiAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2J1dHRvbjpob3Zlcjpub3QoOmRpc2FibGVkKSc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjNTk3QTlFICFpbXBvcnRhbnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnIzU5N0E5RSAhaW1wb3J0YW50JywKICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyNmZmYnCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICdidXR0b246YWN0aXZlJzogewogICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuOQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KQogICAgICAgICAgICBdCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCgoKICAgICAgcG9wdXBGaWxlbGlzdDogZnVuY3Rpb24obGlua3MsIHRpdGxlLCBwbGF5bGlzdCwgaWQpIHsKICAgICAgICB2YXIgY29udGVudCA9IFNhdmVGcm9tX1V0aWxzLnBsYXlsaXN0LmdldEZpbGVsaXN0SHRtbChsaW5rcyk7CiAgICAgICAgaWYgKCFjb250ZW50KQogICAgICAgICAgcmV0dXJuOwoKICAgICAgICB2YXIgcG9wdXAgPSBTYXZlRnJvbV9VdGlscy5wb3B1cERpdihjb250ZW50LCBpZCk7CiAgICAgICAgaWYgKHBsYXlsaXN0KSB7CiAgICAgICAgICB2YXIgYSA9IHBvcHVwLnF1ZXJ5U2VsZWN0b3IoJ2Euc2ZfX3BsYXlsaXN0Jyk7CiAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMucGxheWxpc3QucG9wdXBQbGF5bGlzdChsaW5rcywgdGl0bGUsIHRydWUsIGlkKTsKICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9LCBmYWxzZSk7CgogICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZShhLCBTYXZlRnJvbV9VdGlscy5wbGF5bGlzdC5idG5TdHlsZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZ2V0SW5mb1BvcHVwVGVtcGxhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwb3B1cENvbnRhaW5lciA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICBjbGFzczogJ3NmLWluZm9Qb3B1cFRlbXBsYXRlJywKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIHdpZHRoOiAnNDAwcHgnLAogICAgICAgICAgICBtaW5IZWlnaHQ6ICc0MHB4JwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgbWVkaWFJY29uID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnNDhweCcsCiAgICAgICAgICAgIGJhY2tncm91bmRSZXBlYXQ6ICduby1yZXBlYXQnLAogICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246ICdjZW50ZXIgdG9wJywKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIHdpZHRoOiAnNjBweCcsCiAgICAgICAgICAgIGhlaWdodDogJzYwcHgnLAogICAgICAgICAgICBjc3NGbG9hdDogJ2xlZnQnLAogICAgICAgICAgICBtYXJnaW5Ub3A6ICcxNnB4JywKICAgICAgICAgICAgbWFyZ2luUmlnaHQ6ICcxMHB4JwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgdGV4dENvbnRlbnQgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIHdpZHRoOiAnMzMwcHgnCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciBidXR0b25XcmFwID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIHRleHRBbGlnbjogJ3JpZ2h0JwogICAgICAgICAgfSwKICAgICAgICAgIGFwcGVuZDogbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoewogICAgICAgICAgICAgICcuc2YtaW5mb1BvcHVwVGVtcGxhdGUnOiB7CiAgICAgICAgICAgICAgICBhcHBlbmQ6IFt7CiAgICAgICAgICAgICAgICAgICdhLnNmLWJ1dHRvbic6IHsKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAnMXB4IDZweCcsCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgICAgICAgdGV4dEFsaWduOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyM3B4JywKICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMjNweCcsCiAgICAgICAgICAgICAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBbJ2J1dHRvbjpob3ZlcicsICdhLnNmLWJ1dHRvbjpob3ZlciddLAogICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyM1OTdBOUUgIWltcG9ydGFudCcsCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICcjNTk3QTlFICFpbXBvcnRhbnQnLAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnI2ZmZicKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICAgIH0pOwoKICAgICAgICBwb3B1cENvbnRhaW5lci5hcHBlbmRDaGlsZChtZWRpYUljb24pOwogICAgICAgIHBvcHVwQ29udGFpbmVyLmFwcGVuZENoaWxkKHRleHRDb250ZW50KTsKICAgICAgICBwb3B1cENvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b25XcmFwKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaWNvbjogbWVkaWFJY29uLAogICAgICAgICAgYnV0dG9uQ29udGFpbmVyOiBidXR0b25XcmFwLAogICAgICAgICAgdGV4dENvbnRhaW5lcjogdGV4dENvbnRlbnQsCiAgICAgICAgICBib2R5OiBwb3B1cENvbnRhaW5lcgogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGdldE0zVTogZnVuY3Rpb24obGlua3MpIHsKICAgICAgICB2YXIgdGV4dCA9ICcjRVhUTTNVXHJcbic7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlua3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmICghbGlua3NbaV0uZHVyYXRpb24pCiAgICAgICAgICAgIGxpbmtzW2ldLmR1cmF0aW9uID0gJy0xJzsKCiAgICAgICAgICBpZiAobGlua3NbaV0udGl0bGUgfHwgbGlua3NbaV0uZHVyYXRpb24pIHsKICAgICAgICAgICAgdGV4dCArPSAnI0VYVElORjonICsgbGlua3NbaV0uZHVyYXRpb24gKyAnLCcgKwogICAgICAgICAgICAgIGxpbmtzW2ldLnRpdGxlICsgJ1xyXG4nOwogICAgICAgICAgfQoKICAgICAgICAgIHRleHQgKz0gbGlua3NbaV0udXJsICsgJ1xyXG4nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICAgIH0sCgoKICAgICAgZ2V0UGxheWxpc3RIdG1sOiBmdW5jdGlvbihsaW5rcywgZmlsZVRpdGxlKSB7CiAgICAgICAgaWYgKCFsaW5rcyB8fCBsaW5rcy5sZW5ndGggPT0gMCkKICAgICAgICAgIHJldHVybjsKCiAgICAgICAgdmFyIGxpbmtzX2xlbiA9IGxpbmtzLmxlbmd0aDsKCiAgICAgICAgdmFyIGQgPSBTYXZlRnJvbV9VdGlscy5kYXRlVG9PYmooKTsKICAgICAgICB2YXIgZGF0ZVN0ciA9IGQueWVhciArICctJyArIGQubW9udGggKyAnLScgKyBkLmRheSArICcgJyArCiAgICAgICAgICBkLmhvdXIgKyAnLScgKyBkLm1pbjsKCiAgICAgICAgLy8gTTNVCiAgICAgICAgdmFyIG0zdUxpc3QgPSBTYXZlRnJvbV9VdGlscy5wbGF5bGlzdC5nZXRNM1UobGlua3MpOwogICAgICAgIG0zdUxpc3QgPSBtM3VMaXN0LnJlcGxhY2UoL1xyXG4vZywgJ1xuJyk7CgogICAgICAgIHZhciBtM3VVcmw7CiAgICAgICAgaWYgKHR5cGVvZiBVUkwgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBCbG9iICE9PSAidW5kZWZpbmVkIiAmJiAhbW9uby5pc1NhZmFyaSkgewogICAgICAgICAgdmFyIG0zdUJsb2IgPSBuZXcgQmxvYihbbTN1TGlzdF0sIHsKICAgICAgICAgICAgZW5jb2Rpbmc6ICJVVEYtOCIsCiAgICAgICAgICAgIHR5cGU6ICdhdWRpby94LW1wZWd1cmwnCiAgICAgICAgICB9KTsKICAgICAgICAgIG0zdVVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwobTN1QmxvYik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBtM3VVVEY4ID0gU2F2ZUZyb21fVXRpbHMudXRmOEVuY29kZShtM3VMaXN0KTsKICAgICAgICAgIG0zdVVybCA9ICdkYXRhOmF1ZGlvL3gtbXBlZ3VybDtjaGFyc2V0PXV0Zi04O2Jhc2U2NCwnICsgZW5jb2RlVVJJQ29tcG9uZW50KGJ0b2EobTN1VVRGOCkpCiAgICAgICAgfQoKICAgICAgICB2YXIgdGVtcGxhdGUgPSBTYXZlRnJvbV9VdGlscy5wbGF5bGlzdC5nZXRJbmZvUG9wdXBUZW1wbGF0ZSgpOwoKICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgIGFjdGlvbjogJ2dldFdhcm5pbmdJY29uJywKICAgICAgICAgIGNvbG9yOiAnIzAwQ0NGRicsCiAgICAgICAgICB0eXBlOiAncGxheWxpc3QnCiAgICAgICAgfSwgZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgdGVtcGxhdGUuaWNvbi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSAndXJsKCcgKyBpY29uICsgJyknOwogICAgICAgIH0pOwoKICAgICAgICBtb25vLmNyZWF0ZSh0ZW1wbGF0ZS50ZXh0Q29udGFpbmVyLCB7CiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3AnLCB7CiAgICAgICAgICAgICAgdGV4dDogZmlsZVRpdGxlIHx8IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnBsYXlsaXN0VGl0bGUsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGNvbG9yOiAnIzBEMEQwRCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzIwcHgnLAogICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnMTFweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6ICcxM3B4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgIHRleHQ6IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnBsYXlsaXN0SW5zdHJ1Y3Rpb24sCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGNvbG9yOiAnIzg2ODY4NicsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzE0cHgnLAogICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnMTNweCcsCiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMjRweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6ICcwcHgnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICAgICAgdGV4dDogbW9uby5nbG9iYWwubGFuZ3VhZ2UuZmlsZWxpc3QgKyAnICgnICsgbGlua3NfbGVuICsgJyknLAogICAgICAgICAgICAgIGhyZWY6ICcjJywKICAgICAgICAgICAgICBjbGFzczogJ3NmX19wbGF5bGlzdCcsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICcxM3B4JywKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcyNHB4JywKICAgICAgICAgICAgICAgIG1hcmdpblRvcDogJzBweCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIGlmICghZmlsZVRpdGxlKSB7CiAgICAgICAgICBmaWxlVGl0bGUgPSAncGxheWxpc3QnOwogICAgICAgIH0KICAgICAgICBmaWxlVGl0bGUgKz0gJyAnICsgZGF0ZVN0cjsKCiAgICAgICAgbW9uby5jcmVhdGUodGVtcGxhdGUuYnV0dG9uQ29udGFpbmVyLCB7CiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICAgICAgdGV4dDogbW9uby5nbG9iYWwubGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICAgICAgaHJlZjogbTN1VXJsLAogICAgICAgICAgICAgIGRvd25sb2FkOiBtb25vLmZpbGVOYW1lLm1vZGlmeShmaWxlVGl0bGUgKyAnLm0zdScpLAogICAgICAgICAgICAgIGNsYXNzOiAnc2YtYnV0dG9uJywKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgd2lkdGg6ICcxMThweCcsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjOWU5ZTllJywKICAgICAgICAgICAgICAgIG1hcmdpbjogJzEycHgnLAogICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnMTFweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5SaWdodDogJzhweCcsCiAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc1cHgnLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgXQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdGVtcGxhdGUuYm9keTsKICAgICAgfSwKCgogICAgICBwb3B1cFBsYXlsaXN0OiBmdW5jdGlvbihsaW5rcywgdGl0bGUsIGZpbGVsaXN0LCBpZCkgewogICAgICAgIHZhciBjb250ZW50ID0gU2F2ZUZyb21fVXRpbHMucGxheWxpc3QuZ2V0UGxheWxpc3RIdG1sKGxpbmtzLCB0aXRsZSk7CiAgICAgICAgaWYgKCFjb250ZW50KQogICAgICAgICAgcmV0dXJuOwoKICAgICAgICB2YXIgcG9wdXAgPSBTYXZlRnJvbV9VdGlscy5wb3B1cERpdihjb250ZW50LCBpZCk7CiAgICAgICAgaWYgKGZpbGVsaXN0KSB7CiAgICAgICAgICB2YXIgYSA9IHBvcHVwLnF1ZXJ5U2VsZWN0b3IoJ2Euc2ZfX3BsYXlsaXN0Jyk7CiAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMucGxheWxpc3QucG9wdXBGaWxlbGlzdChsaW5rcywgdGl0bGUsIHRydWUsIGlkKTsKICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9LCBmYWxzZSk7CgogICAgICAgICAgICBhLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lJzsKICAgICAgICAgICAgYSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBkbF9saW5rcyA9IHBvcHVwLnF1ZXJ5U2VsZWN0b3JBbGwoJ2FbZG93bmxvYWRdJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGVsOyBlbCA9IGRsX2xpbmtzW2ldOyBpKyspIHsKICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRPbkNsaWNrLCBmYWxzZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIHBvcHVwQ2xvc2VCdG46ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJJQUFBQVNDQVlBQUFCV3pvNVhBQUFBV1VsRVFWUTR5Mk5nR0hIQUg0ajFzWWpyUStXSUF2RkEvQitJMzZNWnBnOFYrdzlWUTlBbC81RXd6REJrUTJBWXI4dXdhWGlQUTB5ZmtLdXdHVWF5SVlRTUk4a1FxaGxFRmE5UkxiQ3BGdjFVUzVCVXpTTERCQUFBUk45T2xXR0dGOGtBQUFBQVNVVk9SSzVDWUlJPScsCgogICAgcG9wdXBEaXY6IGZ1bmN0aW9uKGNvbnRlbnQsIGlkLCBtYXhXaWR0aCwgbWF4SGVpZ2h0LCBvbkNsb3NlKSB7CiAgICAgIGlmICghaWQpIHsKICAgICAgICBpZCA9ICdzYXZlZnJvbV9wb3B1cF9ib3gnOwogICAgICB9CgogICAgICBpZiAoIW1heFdpZHRoKQogICAgICAgIG1heFdpZHRoID0gNTgwOwoKICAgICAgaWYgKCFtYXhIZWlnaHQpCiAgICAgICAgbWF4SGVpZ2h0ID0gNTIwOwoKICAgICAgdmFyIHBvcHVwQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgaWYgKHBvcHVwQm9keSkgewogICAgICAgIHBvcHVwQm9keS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHBvcHVwQm9keSk7CiAgICAgIH0KCiAgICAgIHBvcHVwQm9keSA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgaWQ6IGlkLAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICB6SW5kZXg6ICc5OTk5JywKICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsCiAgICAgICAgICBjc3NGbG9hdDogJ25vbmUnLAogICAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsCiAgICAgICAgICBtYXJnaW46ICcwJywKICAgICAgICAgIHBhZGRpbmc6ICcwJywKICAgICAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLAogICAgICAgICAgY29sb3I6ICcjMDAwJywKICAgICAgICAgIGJhY2tncm91bmQ6ICcjZmZmJywKICAgICAgICAgIGJvcmRlcjogJzNweCBzb2xpZCAjYzBjYWQ1JywKICAgICAgICAgIGJvcmRlclJhZGl1czogJzdweCcsCiAgICAgICAgICBvdmVyZmxvdzogJ2F1dG8nCiAgICAgICAgfQogICAgICB9KTsKCgogICAgICB2YXIgY250ID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICBzdHlsZTogewogICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgIGNzc0Zsb2F0OiAnbm9uZScsCiAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgIG92ZXJmbG93OiAnYXV0bycsCiAgICAgICAgICBtYXJnaW46ICcwJywKICAgICAgICAgIHBhZGRpbmc6ICcxMHB4IDE1cHgnCiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGNvbnRlbnQoY250KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjbnQuYXBwZW5kQ2hpbGQoY29udGVudCk7CiAgICAgIH0KCiAgICAgIHZhciBidG4gPSBtb25vLmNyZWF0ZSgnaW1nJywgewogICAgICAgIHNyYzogU2F2ZUZyb21fVXRpbHMucG9wdXBDbG9zZUJ0biwKICAgICAgICBhbHQ6ICd4JywKICAgICAgICB3aWR0aDogMTgsCiAgICAgICAgaGVpZ2h0OiAxOCwKICAgICAgICBzdHlsZTogewogICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICB0b3A6ICcxMHB4JywKICAgICAgICAgIHJpZ2h0OiAnMTVweCcsCiAgICAgICAgICBvcGFjaXR5OiAnMC41JywKICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgfSwKICAgICAgICBvbjogWwogICAgICAgICAgWydtb3VzZWVudGVyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgdGhpcy5zdHlsZS5vcGFjaXR5ID0gJzAuOSc7CiAgICAgICAgICB9XSwKICAgICAgICAgIFsnbW91c2VsZWF2ZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICAgIHRoaXMuc3R5bGUub3BhY2l0eSA9ICcwLjUnOwogICAgICAgICAgfV0sCiAgICAgICAgICBbJ2NsaWNrJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgaWYgKHBvcHVwQm9keS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgcG9wdXBCb2R5LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocG9wdXBCb2R5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob25DbG9zZSkgewogICAgICAgICAgICAgIG9uQ2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9XQogICAgICAgIF0KICAgICAgfSk7CgogICAgICBjbnQuYXBwZW5kQ2hpbGQoYnRuKTsKICAgICAgcG9wdXBCb2R5LmFwcGVuZENoaWxkKGNudCk7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocG9wdXBCb2R5KTsKCiAgICAgIGlmIChwb3B1cEJvZHkub2Zmc2V0V2lkdGggPiBtYXhXaWR0aCkgewogICAgICAgIHBvcHVwQm9keS5zdHlsZS53aWR0aCA9IG1heFdpZHRoICsgJ3B4JzsKICAgICAgfQoKICAgICAgaWYgKHBvcHVwQm9keS5vZmZzZXRIZWlnaHQgPiBtYXhIZWlnaHQpIHsKICAgICAgICBwb3B1cEJvZHkuc3R5bGUuaGVpZ2h0ID0gbWF4SGVpZ2h0ICsgJ3B4JzsKICAgICAgICBwb3B1cEJvZHkuc3R5bGUud2lkdGggPSAobWF4V2lkdGggKyAyMCkgKyAncHgnOwogICAgICB9CgogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsID0gTWF0aC5mbG9vcigod2luZG93LmlubmVyV2lkdGggLSBwb3B1cEJvZHkub2Zmc2V0V2lkdGgpIC8gMi4wKTsKICAgICAgICB2YXIgdCA9IE1hdGguZmxvb3IoKHdpbmRvdy5pbm5lckhlaWdodCAtIHBvcHVwQm9keS5vZmZzZXRIZWlnaHQpIC8gMi4wKTsKICAgICAgICBpZiAodCA8IDApIHsKICAgICAgICAgIHQgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAobG9jYXRpb24uaG9zdC5pbmRleE9mKCd5b3V0dScpICE9PSAtMSAmJiB0IDwgNTApIHsKICAgICAgICAgIHQgPSA1MDsKICAgICAgICAgIHBvcHVwQm9keS5zdHlsZS5oZWlnaHQgPSAocG9wdXBCb2R5Lm9mZnNldEhlaWdodCAtIHQgLSAxMCkgKyAncHgnOwogICAgICAgIH0KICAgICAgICBpZiAobCA8IDApIHsKICAgICAgICAgIGwgPSAwOwogICAgICAgIH0KICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZShwb3B1cEJvZHksIHsKICAgICAgICAgIHRvcDogdCArICdweCcsCiAgICAgICAgICBsZWZ0OiBsICsgJ3B4JywKICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIHZhciBvbkRvY0Nsb3NlID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICB2YXIgbm9kZSA9IGV2ZW50LnRhcmdldDsKICAgICAgICBpZiAobm9kZSAhPT0gcG9wdXBCb2R5ICYmICFTYXZlRnJvbV9VdGlscy5pc1BhcmVudChub2RlLCBwb3B1cEJvZHkpKSB7CiAgICAgICAgICBpZiAocG9wdXBCb2R5LnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgcG9wdXBCb2R5LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocG9wdXBCb2R5KTsKICAgICAgICAgIH0KICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25Eb2NDbG9zZSwgZmFsc2UpOwogICAgICAgICAgaWYgKG9uQ2xvc2UpIHsKICAgICAgICAgICAgb25DbG9zZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkRvY0Nsb3NlLCBmYWxzZSk7CiAgICAgIH0sIDEwMCk7CgogICAgICBwb3B1cEJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBmdW5jdGlvbigpIHsKICAgICAgICBpZiAocG9wdXBCb2R5LnBhcmVudE5vZGUpIHsKICAgICAgICAgIHBvcHVwQm9keS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHBvcHVwQm9keSk7CiAgICAgICAgfQogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25Eb2NDbG9zZSwgZmFsc2UpOwogICAgICAgIGlmIChvbkNsb3NlKSB7CiAgICAgICAgICBvbkNsb3NlKCk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHBvcHVwQm9keS5hZGRFdmVudExpc3RlbmVyKCdraWxsJywgZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHBvcHVwQm9keS5wYXJlbnROb2RlKSB7CiAgICAgICAgICBwb3B1cEJvZHkucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChwb3B1cEJvZHkpOwogICAgICAgIH0KICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIG9uRG9jQ2xvc2UsIGZhbHNlKTsKICAgICAgfSk7CgogICAgICByZXR1cm4gcG9wdXBCb2R5OwogICAgfSwKCiAgICBwb3B1cERpdjI6IGZ1bmN0aW9uKF9kZXRhaWxzKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgaWQ6ICdzYXZlZnJvbV9wb3B1cF9ib3gnLAogICAgICAgIGNvbnRhaW5lclN0eWxlOiBudWxsLAogICAgICAgIGJvZHlTdHlsZTogbnVsbCwKICAgICAgICBjb250ZW50OiBudWxsLAogICAgICAgIGNvbnRhaW5lcjogbnVsbCwKICAgICAgICBib2R5OiBudWxsCiAgICAgIH07CgogICAgICBkZXRhaWxzLl9vbkNsb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBkZXRhaWxzLl9vbkNsb3NlKTsKCiAgICAgICAgaWYgKGNvbnRhaW5lci5wYXJlbnROb2RlKSB7CiAgICAgICAgICBjb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjb250YWluZXIpOwogICAgICAgIH0KCiAgICAgICAgZGV0YWlscy5vbkNsb3NlICYmIGRldGFpbHMub25DbG9zZSgpOwogICAgICB9OwoKICAgICAgbW9uby5leHRlbmQoZGV0YWlscywgX2RldGFpbHMpOwoKICAgICAgdmFyIGNvbnRhaW5lciA9IGRldGFpbHMuY29udGFpbmVyID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICBpZDogZGV0YWlscy5pZCwKICAgICAgICBzdHlsZTogewogICAgICAgICAgekluZGV4OiA5OTk5LAogICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLAogICAgICAgICAgYmFja2dyb3VuZDogJyNmZmYnLAogICAgICAgICAgYm9yZGVyOiAnM3B4IHNvbGlkICNjMGNhZDUnLAogICAgICAgICAgYm9yZGVyUmFkaXVzOiAnN3B4JwogICAgICAgIH0sCiAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dCh7CiAgICAgICAgICAgICAgc2VsZWN0b3I6ICcjJyArIGRldGFpbHMuaWQsCiAgICAgICAgICAgICAgc3R5bGU6IG1vbm8uc3R5bGVSZXNldAogICAgICAgICAgICB9KQogICAgICAgICAgfSkKICAgICAgICBdLAogICAgICAgIG9uOiBbCiAgICAgICAgICBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgfV0KICAgICAgICBdCiAgICAgIH0pOwoKICAgICAgdmFyIGNsb3NlQnRuID0gbW9uby5jcmVhdGUoJ2ltZycsIHsKICAgICAgICBzcmM6IFNhdmVGcm9tX1V0aWxzLnBvcHVwQ2xvc2VCdG4sCiAgICAgICAgYWx0OiAneCcsCiAgICAgICAgd2lkdGg6IDE4LAogICAgICAgIGhlaWdodDogMTgsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgdG9wOiAnMTBweCcsCiAgICAgICAgICByaWdodDogJzE1cHgnLAogICAgICAgICAgb3BhY2l0eTogJzAuNScsCiAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgIH0sCiAgICAgICAgb246IFsKICAgICAgICAgIFsnbW91c2VlbnRlcicsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICAgIHRoaXMuc3R5bGUub3BhY2l0eSA9ICcwLjknOwogICAgICAgICAgfV0sCiAgICAgICAgICBbJ21vdXNlbGVhdmUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgICB0aGlzLnN0eWxlLm9wYWNpdHkgPSAnMC41JzsKICAgICAgICAgIH1dLAogICAgICAgICAgWydjbGljaycsIGRldGFpbHMuX29uQ2xvc2VdCiAgICAgICAgXQogICAgICB9KTsKCiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjbG9zZUJ0bik7CgogICAgICB2YXIgYm9keSA9IGRldGFpbHMuYm9keSA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgc3R5bGU6IG1vbm8uZXh0ZW5kUG9zKHsKICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsCiAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgIHBhZGRpbmc6ICcxMHB4IDE1cHgnLAogICAgICAgICAgb3ZlcmZsb3c6ICdhdXRvJwogICAgICAgIH0sIGRldGFpbHMuYm9keVN0eWxlKQogICAgICB9KTsKCiAgICAgIGlmICh0eXBlb2YgZGV0YWlscy5jb250ZW50ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgZGV0YWlscy5jb250ZW50KGJvZHkpOwogICAgICB9IGVsc2UgewogICAgICAgIGJvZHkuYXBwZW5kQ2hpbGQoZGV0YWlscy5jb250ZW50KTsKICAgICAgfQoKICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGJvZHkpOwoKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpOwogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRldGFpbHMuX29uQ2xvc2UpOwoKICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICB9LAoKICAgIC8vIHJvdyAtIHVzZWQgZm9yIGhpZGUgdG9vbHRpcCBvbiBtb3VzZW91dAogICAgLy8gYmVjYXVzZSBub2RlIGNhbiBkaXNzYXBlciBmcm9tIERPTSBiZWZvcmUgbW91c2VvdXQgcmFpc2VkCiAgICBzaG93VG9vbHRpcDogZnVuY3Rpb24obm9kZSwgdGV4dCwgcm93LCBzdHlsZSkgewogICAgICBpZiAoIW5vZGUpCiAgICAgICAgcmV0dXJuOwoKICAgICAgdmFyIHRvb2x0aXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2F2ZWZyb20tdG9vbHRpcCcpOwogICAgICBpZiAoIXRvb2x0aXApIHsKICAgICAgICB0b29sdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdG9vbHRpcC5jbGFzc05hbWUgPSAnc2F2ZWZyb20tdG9vbHRpcCc7CiAgICAgICAgU2F2ZUZyb21fVXRpbHMuc2V0U3R5bGUodG9vbHRpcCwgewogICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywKICAgICAgICAgICdvcGFjaXR5JzogMCwKICAgICAgICAgICd6SW5kZXgnOiAtMQogICAgICAgIH0pOwogICAgICAgIGlmIChzdHlsZSkgewogICAgICAgICAgU2F2ZUZyb21fVXRpbHMuc2V0U3R5bGUodG9vbHRpcCwgc3R5bGUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdG9vbHRpcC50ZXh0Q29udGVudCA9IHRleHQ7CgogICAgICBpZiAodG9vbHRpcC5sYXN0Tm9kZSAmJiB0b29sdGlwLmxhc3ROb2RlID09PSBub2RlKSB7CiAgICAgICAgZml4UG9zaXRpb24oKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0b29sdGlwLmxhc3ROb2RlKSB7CiAgICAgICAgbW9uby5vZmYodG9vbHRpcC5sYXN0Tm9kZSwgJ21vdXNlbGVhdmUnLCBoaWRlKTsKICAgICAgICBtb25vLm9mZih0b29sdGlwLmxhc3ROb2RlLCAnbW91c2Vtb3ZlJywgZml4UG9zaXRpb24pOwogICAgICAgIHRvb2x0aXAubGFzdFJvdyAmJiBtb25vLm9mZih0b29sdGlwLmxhc3RSb3csICdtb3VzZWxlYXZlJywgaGlkZSk7CiAgICAgIH0KCiAgICAgIHRvb2x0aXAubGFzdE5vZGUgPSBub2RlOwogICAgICByb3cgJiYgKHRvb2x0aXAubGFzdFJvdyA9IHJvdyk7CgogICAgICBtb25vLm9uKG5vZGUsICdtb3VzZWxlYXZlJywgaGlkZSk7CiAgICAgIG1vbm8ub24obm9kZSwgJ21vdXNlbW92ZScsIGZpeFBvc2l0aW9uLCBmYWxzZSk7CiAgICAgIHJvdyAmJiBtb25vLm9uKHJvdywgJ21vdXNlbGVhdmUnLCBoaWRlKTsKCiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9vbHRpcCk7CiAgICAgIGZpeFBvc2l0aW9uKCk7CgogICAgICBmdW5jdGlvbiBmaXhQb3NpdGlvbihlKSB7CiAgICAgICAgaWYgKGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICB9CiAgICAgICAgdmFyIHAgPSBTYXZlRnJvbV9VdGlscy5nZXRQb3NpdGlvbihub2RlKSwKICAgICAgICAgIHMgPSBTYXZlRnJvbV9VdGlscy5nZXRTaXplKHRvb2x0aXApOwoKICAgICAgICBpZiAocC50b3AgPT0gMCAmJiBwLmxlZnQgPT0gMCkKICAgICAgICAgIHJldHVybjsKCiAgICAgICAgcC50b3AgPSBwLnRvcCAtIHMuaGVpZ2h0IC0gMTA7CiAgICAgICAgcC5sZWZ0ID0gcC5sZWZ0IC0gcy53aWR0aCAvIDIgKyBTYXZlRnJvbV9VdGlscy5nZXRTaXplKG5vZGUpLndpZHRoIC8gMjsKCiAgICAgICAgcC5sZWZ0ID0gTWF0aC5taW4ocC5sZWZ0LCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoICsgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0IC0gcy53aWR0aCk7CiAgICAgICAgaWYgKHAudG9wIDwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApCiAgICAgICAgICBwLnRvcCA9IHAudG9wICsgcy5oZWlnaHQgKyBTYXZlRnJvbV9VdGlscy5nZXRTaXplKG5vZGUpLmhlaWdodCArIDIwOwoKICAgICAgICBwLnRvcCArPSAncHgnOwogICAgICAgIHAubGVmdCArPSAncHgnOwoKICAgICAgICAvLyBzaG93CiAgICAgICAgcC56SW5kZXggPSA5OTk5OwogICAgICAgIHAub3BhY2l0eSA9IDE7CgogICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKHRvb2x0aXAsIHApOwogICAgICB9CgogICAgICBmdW5jdGlvbiBoaWRlKCkgewogICAgICAgIGlmICh0b29sdGlwLnBhcmVudE5vZGUpCiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRvb2x0aXApOwoKICAgICAgICB0b29sdGlwLmxhc3ROb2RlID0gbnVsbDsKICAgICAgICB0b29sdGlwLmxhc3RSb3cgPSBudWxsOwogICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKHRvb2x0aXAsIHsKICAgICAgICAgIHpJbmRleDogLTEsCiAgICAgICAgICBvcGFjaXR5OiAwCiAgICAgICAgfSk7CiAgICAgICAgbW9uby5vZmYobm9kZSwgJ21vdXNlbGVhdmUnLCBoaWRlKTsKICAgICAgICBtb25vLm9mZihub2RlLCAnbW91c2Vtb3ZlJywgZml4UG9zaXRpb24pOwogICAgICAgIHJvdyAmJiBtb25vLm9mZihyb3csICdtb3VzZWxlYXZlJywgaGlkZSk7CiAgICAgIH0KICAgIH0sCgogICAgZW1iZWREb3dubG9hZGVyOiB7CiAgICAgIGRhdGFBdHRyOiAnZGF0YS1zYXZlZnJvbS1nZXQtbGlua3MnLAogICAgICBkYXRhSWRBdHRyOiAnZGF0YS1zYXZlZnJvbS1jb250YWluZXItaWQnLAogICAgICBjb250YWluZXJDbGFzczogJ3NhdmVmcm9tLWxpbmtzLWNvbnRhaW5lcicsCiAgICAgIGxpbmtDbGFzczogJ3NhdmVmcm9tLWxpbmsnLAogICAgICBwYW5lbDogbnVsbCwKICAgICAgbGFzdExpbms6IG51bGwsCiAgICAgIHN0eWxlOiBudWxsLAoKICAgICAgaG9zdGluZ3M6IHsKICAgICAgICAneW91dHViZSc6IHsKICAgICAgICAgIHJlOiBbCiAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbYS16XStcLik/eW91dHViZVwuY29tXC8oPzojIT9cLyk/d2F0Y2hcPy4qdj0oW1x3XC1dKykvaSwKICAgICAgICAgICAgL15odHRwcz86XC9cLyg/OlthLXowLTldK1wuKT95b3V0dWJlXC5jb21cLyg/OmVtYmVkfHYpXC8oW1x3XC1dKykvaSwKICAgICAgICAgICAgL15odHRwcz86XC9cLyg/OlthLXpdK1wuKT95b3V0dVwuYmVcLyhbXHdcLV0rKS9pCiAgICAgICAgICBdLAogICAgICAgICAgYWN0aW9uOiAnZ2V0WW91dHViZUxpbmtzJywKICAgICAgICAgIHByZXBhcmVMaW5rczogZnVuY3Rpb24obGlua3MpIHsKICAgICAgICAgICAgdmFyIHJldCA9IFtdOwogICAgICAgICAgICB2YXIgc2ZVdGlsc1l0ID0gU2F2ZUZyb21fVXRpbHMudmlkZW8ueXQ7CiAgICAgICAgICAgIHZhciBmb3JtYXQgPSBzZlV0aWxzWXQuZm9ybWF0OwoKICAgICAgICAgICAgdmFyIG1ldGEgPSBsaW5rcy5tZXRhIHx8IHt9OwoKICAgICAgICAgICAgZm9yICh2YXIgZm9ybWF0TmFtZSBpbiBmb3JtYXQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpVGFnIGluIGZvcm1hdFtmb3JtYXROYW1lXSkgewogICAgICAgICAgICAgICAgdmFyIG1ldGFUYWcgPSBtZXRhW2lUYWddIHx8IHt9OwogICAgICAgICAgICAgICAgaWYgKGxpbmtzW2lUYWddKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gZm9ybWF0TmFtZTsKICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdFtmb3JtYXROYW1lXVtpVGFnXS5leHQpIHsKICAgICAgICAgICAgICAgICAgICB0eXBlID0gZm9ybWF0W2Zvcm1hdE5hbWVdW2lUYWddLmV4dDsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIHF1YWxpdHkgPSBmb3JtYXRbZm9ybWF0TmFtZV1baVRhZ10ucXVhbGl0eTsKICAgICAgICAgICAgICAgICAgaWYgKG1ldGFUYWcucXVhbGl0eSkgewogICAgICAgICAgICAgICAgICAgIHF1YWxpdHkgPSBtZXRhVGFnLnF1YWxpdHk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXRbZm9ybWF0TmFtZV1baVRhZ10uc0ZwcykgewogICAgICAgICAgICAgICAgICAgIHF1YWxpdHkgKz0gJyAnICsgKG1ldGFUYWcuZnBzIHx8IDYwKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdFtmb3JtYXROYW1lXVtpVGFnXVsnM2QnXSkgewogICAgICAgICAgICAgICAgICAgIHF1YWxpdHkgKz0gJyAoM2QpJzsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0LnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6IGZvcm1hdE5hbWUgKyAnICcgKyBxdWFsaXR5LAogICAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgICAgICAgICAgdXJsOiBsaW5rc1tpVGFnXSwKICAgICAgICAgICAgICAgICAgICBub1NvdW5kOiBmb3JtYXRbZm9ybWF0TmFtZV1baVRhZ10ubm9BdWRpbwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAndmltZW8nOiB7CiAgICAgICAgICByZTogWwogICAgICAgICAgICAvXmh0dHBzPzpcL1wvKD86W1x3XC1dK1wuKT92aW1lb1wuY29tXC8oPzpcdytcIyk/KFxkKykvaSwKICAgICAgICAgICAgL15odHRwcz86XC9cL3BsYXllclwudmltZW9cLmNvbVwvdmlkZW9cLyhcZCspL2ksCiAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbXHdcLV0rXC4pP3ZpbWVvXC5jb21cL2NoYW5uZWxzXC8oPzpbXlwvXSspXC8oXGQrKSQvaSwKICAgICAgICAgICAgL15odHRwcz86XC9cL3ZpbWVvXC5jb21cLyg/Oi4rKWNsaXBfaWQ9KFxkKykvaQogICAgICAgICAgXSwKICAgICAgICAgIGFjdGlvbjogJ2dldFZpbWVvTGlua3MnLAogICAgICAgICAgcHJlcGFyZUxpbmtzOiBmdW5jdGlvbihsaW5rcykgewogICAgICAgICAgICByZXR1cm4gbGlua3MubWFwKGZ1bmN0aW9uKGxpbmspIHsKICAgICAgICAgICAgICB2YXIgZXh0ID0gbGluay5leHQ7CiAgICAgICAgICAgICAgaWYgKCFleHQpIHsKICAgICAgICAgICAgICAgIGV4dCA9ICdNUDQnOwogICAgICAgICAgICAgICAgaWYgKGxpbmsudXJsLnNlYXJjaCgvXC5mbHYoJHxcPykvaSkgIT0gLTEpCiAgICAgICAgICAgICAgICAgIGV4dCA9ICdGTFYnOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbGluay5uYW1lID0gbGluay5uYW1lID8gbGluay5uYW1lIDogZXh0OwogICAgICAgICAgICAgIGxpbmsudHlwZSA9IGxpbmsudHlwZSA/IGxpbmsudHlwZSA6IGV4dDsKICAgICAgICAgICAgICBsaW5rLmV4dCA9IGV4dDsKCiAgICAgICAgICAgICAgcmV0dXJuIGxpbms7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgICd2ayc6IHsKICAgICAgICAgIHJlOiBbCiAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbXHdcLV0rXC4pPyg/OnZrXC5jb218dmtvbnRha3RlXC5ydSlcLyg/OlteXC9dK1wvKSooPzpbXHdcLVwuXStcPy4qej0pPyh2aWRlby0/XGQrXy0/XGQrXD9saXN0PVswLTlhLXpdK3x2aWRlby0/XGQrXy0/XGQrKS9pLAogICAgICAgICAgICAvXmh0dHBzPzpcL1wvKD86W1x3XC1dK1wuKT8oPzp2a1wuY29tfHZrb250YWt0ZVwucnUpXC92aWRlb19leHRcLnBocFw/KC4rKS9pCiAgICAgICAgICBdLAogICAgICAgICAgYWN0aW9uOiAnZ2V0VktMaW5rcycKICAgICAgICB9LAoKICAgICAgICAnZGFpbHltb3Rpb24nOiB7CiAgICAgICAgICByZTogWwogICAgICAgICAgICAvXmh0dHA6XC9cLyg/Ond3d1wuKT9kYWlcLmx5XC8oW2EtejAtOV0rKV8/L2ksCiAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbXHddK1wuKT9kYWlseW1vdGlvblwuY29tKD86XC9lbWJlZHxcL3N3Zik/XC92aWRlb1wvKFthLXowLTldKylfPy9pCiAgICAgICAgICBdLAogICAgICAgICAgYWN0aW9uOiAnZ2V0RGFpbHltb3Rpb25MaW5rcycKICAgICAgICB9LAoKICAgICAgICAnZmFjZWJvb2snOiB7CiAgICAgICAgICByZTogWwogICAgICAgICAgICAvXmh0dHBzPzpcL1wvKD86W1x3XStcLik/ZmFjZWJvb2tcLmNvbSg/OlwvdmlkZW8pP1wvdmlkZW8ucGhwLipbPyZdezF9dj0oWzAtOV0rKS4qL2ksCiAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbXHddK1wuKT9mYWNlYm9va1wuY29tXC8uK1wvdmlkZW9zKD86XC9cd1teXC9dKyk/XC8oXGQrKS9pCiAgICAgICAgICBdLAogICAgICAgICAgYWN0aW9uOiAnZ2V0RmFjZWJvb2tMaW5rcycKICAgICAgICB9CiAgICAgIH0sCgoKICAgICAgaW5pdDogZnVuY3Rpb24oc3R5bGUpIHsKICAgICAgICB0aGlzLnN0eWxlID0gc3R5bGU7CgogICAgICAgIGlmICh0aGlzLnBhbmVsKSB7CiAgICAgICAgICBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucmVtb3ZlUGFuZWwoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucGFuZWwgPSBudWxsOwogICAgICAgIHRoaXMubGFzdExpbmsgPSBudWxsOwoKICAgICAgICB2YXIgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhWycgKyB0aGlzLmRhdGFBdHRyICsgJ10nKSwKICAgICAgICAgIGksIGwgPSBsaW5rcy5sZW5ndGg7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGlmIChbJ3NhdmVmcm9tLm5ldCcsICdzZi1hZGRvbi5jb20nXS5pbmRleE9mKAogICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmdldFRvcExldmVsRG9tYWluKGxpbmtzW2ldLmhvc3RuYW1lKSkgPiAtMSkgewogICAgICAgICAgICBsaW5rc1tpXS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbGljaywgZmFsc2UpOwogICAgICAgICAgICBsaW5rc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbGljaywgZmFsc2UpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaGlkZSBtZW51IG9uIGNsaWNrIG91dHNpZGUgdGhlbQogICAgICAgIC8vIHByb2Nlc3MgZGluYW1pY2FsbHkgYWRkZWQgbGlua3MKICAgICAgICBpZiAoZG9jdW1lbnQuYm9keSkgewogICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25Cb2R5Q2xpY2ssIHRydWUpOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25Cb2R5Q2xpY2ssIHRydWUpOwogICAgICAgIH0KICAgICAgfSwKCgogICAgICBjaGVja1VybDogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgZm9yICh2YXIgaG9zdGluZyBpbiB0aGlzLmhvc3RpbmdzKSB7CiAgICAgICAgICB2YXIgcGFyYW1zID0gdGhpcy5ob3N0aW5nc1tob3N0aW5nXTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGFyYW1zLnJlLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciBtYXRjaCA9IHVybC5tYXRjaChwYXJhbXMucmVbaV0pOwogICAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaG9zdGluZzogaG9zdGluZywKICAgICAgICAgICAgICAgIGFjdGlvbjogcGFyYW1zLmFjdGlvbiwKICAgICAgICAgICAgICAgIGV4dFZpZGVvSWQ6IG1hdGNoWzFdCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0sCgogICAgICByZU1hcEhvc3Rpbmc6IGZ1bmN0aW9uKGFjdGlvbikgewogICAgICAgIHZhciBtYXAgPSB7CiAgICAgICAgICAnZ2V0WW91dHViZUxpbmtzJzogJ3lvdXR1YmUnLAogICAgICAgICAgJ2dldFZpbWVvTGlua3MnOiAndmltZW8nLAogICAgICAgICAgJ2dldERhaWx5bW90aW9uTGlua3MnOiAnZGFpbHltb3Rpb24nLAogICAgICAgICAgJ2dldEZhY2Vib29rTGlua3MnOiAnZmFjZWJvb2snCiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG1hcFthY3Rpb25dOwogICAgICB9LAoKCiAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uKGV2ZW50LCBhKSB7CiAgICAgICAgdmFyIF90aGlzID0gU2F2ZUZyb21fVXRpbHMuZW1iZWREb3dubG9hZGVyOwoKICAgICAgICBpZiAoIWEpIHsKICAgICAgICAgIGEgPSBldmVudC50YXJnZXQ7CiAgICAgICAgICB3aGlsZSAoYS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGlmIChhLm5vZGVOYW1lID09PSAnQScpCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGEgPSBhLnBhcmVudE5vZGU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFhKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgaHJlZiA9IGEuZ2V0QXR0cmlidXRlKCdkYXRhLXNhdmVmcm9tLWdldC1saW5rcycpOwogICAgICAgIGlmICghaHJlZikKICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbiAhPT0gMCB8fCBldmVudC5jdHJsS2V5IHx8IGV2ZW50LnNoaWZ0S2V5KQogICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoX3RoaXMubGFzdExpbmsgPT09IGEgJiYgX3RoaXMucGFuZWwgJiYgX3RoaXMucGFuZWwuc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHsKICAgICAgICAgIF90aGlzLmxhc3RMaW5rID0gbnVsbDsKICAgICAgICAgIF90aGlzLnBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMubGFzdExpbmsgPSBhOwogICAgICAgIHZhciBkYXRhID0gX3RoaXMuY2hlY2tVcmwoaHJlZik7CiAgICAgICAgaWYgKCFkYXRhKQogICAgICAgICAgcmV0dXJuOwoKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICB2YXIgcmVxdWVzdCA9IHsKICAgICAgICAgIGFjdGlvbjogZGF0YS5hY3Rpb24sCiAgICAgICAgICBleHRWaWRlb0lkOiBkYXRhLmV4dFZpZGVvSWQKICAgICAgICB9OwoKICAgICAgICBfdGhpcy5zaG93TGlua3MobW9uby5nbG9iYWwubGFuZ3VhZ2UuZG93bmxvYWQgKyAnIC4uLicsIG51bGwsIGEpOwoKICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHJlcXVlc3QsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgaG9zdGluZyA9IGRhdGEuaG9zdGluZzsKCiAgICAgICAgICBpZiAocmVzcG9uc2UuYWN0aW9uICE9IHJlcXVlc3QuYWN0aW9uKSB7CiAgICAgICAgICAgIGhvc3RpbmcgPSBfdGhpcy5yZU1hcEhvc3RpbmcocmVzcG9uc2UuYWN0aW9uKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocmVzcG9uc2UubGlua3MpCiAgICAgICAgICAgIF90aGlzLnNob3dMaW5rcyhyZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUsIGEsIGhvc3RpbmcsIHRydWUpOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBfdGhpcy5zaG93TGlua3MobW9uby5nbG9iYWwubGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kLCBudWxsLCBhLCB1bmRlZmluZWQsIHRydWUpOwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCgoKICAgICAgb25Cb2R5Q2xpY2s6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgdmFyIF90aGlzID0gU2F2ZUZyb21fVXRpbHMuZW1iZWREb3dubG9hZGVyOwoKICAgICAgICB2YXIgbm9kZSA9IGV2ZW50LnRhcmdldDsKCiAgICAgICAgaWYgKCFfdGhpcy5wYW5lbCB8fCBfdGhpcy5wYW5lbC5zdHlsZS5kaXNwbGF5ID09ICdub25lJykgewogICAgICAgICAgaWYgKG5vZGUudGFnTmFtZSAhPT0gJ0EnICYmIG1vbm8ubWF0Y2hlcyhub2RlLCAnQSAnICsgbm9kZS50YWdOYW1lKSkgewogICAgICAgICAgICB3aGlsZSAobm9kZS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgaWYgKG5vZGUudGFnTmFtZSA9PT0gJ0EnKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChub2RlLm5vZGVOYW1lICE9PSAnQScpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGRpbmFtaWMgbGlua3MKICAgICAgICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZShfdGhpcy5kYXRhQXR0cikgJiYgWydzYXZlZnJvbS5uZXQnLCAnc2YtYWRkb24uY29tJ10uaW5kZXhPZihTYXZlRnJvbV9VdGlscy5nZXRUb3BMZXZlbERvbWFpbihub2RlLmhvc3RuYW1lKSkgPiAtMSkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMub25DbGljayhldmVudCwgbm9kZSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF90aGlzLnBhbmVsID09PSBub2RlIHx8IF90aGlzLnBhbmVsLmNvbnRhaW5zKG5vZGUpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBfdGhpcy5sYXN0TGluayA9IG51bGw7CiAgICAgICAgX3RoaXMucGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgfSwKCiAgICAgIGhpZGVQYW5lbDogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMucGFuZWwpIHsKICAgICAgICAgIHRoaXMucGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBjcmVhdGVNZW51OiBmdW5jdGlvbihsaW5rcywgdGl0bGUsIGEsIGhuYW1lLCB1cGRhdGUpIHsKICAgICAgICB2YXIgbWVudUxpbmtzID0gbW9uby5nbG9iYWwubGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kOwogICAgICAgIGlmICh0eXBlb2YgbGlua3MgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBtZW51TGlua3MgPSBsaW5rczsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAoU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rc1tobmFtZV0gIT09IHVuZGVmaW5lZCAmJiBsaW5rcykgewogICAgICAgICAgbWVudUxpbmtzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rc1tobmFtZV0obGlua3MsIHRpdGxlKTsKICAgICAgICB9CiAgICAgICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgICAgICBsaW5rczogbWVudUxpbmtzLAogICAgICAgICAgYnV0dG9uOiBhLAogICAgICAgICAgcG9wdXBJZDogdW5kZWZpbmVkLAogICAgICAgICAgc2hvd0ZpbGVTaXplOiB0cnVlLAogICAgICAgICAgY29udGFpbmVyQ2xhc3M6IHRoaXMuY29udGFpbmVyQ2xhc3MsCiAgICAgICAgICBsaW5rQ2xhc3M6IHRoaXMubGlua0NsYXNzLAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgcG9wdXA6ICh0aGlzLnN0eWxlKSA/IHRoaXMuc3R5bGUuY29udGFpbmVyIDogdW5kZWZpbmVkLAogICAgICAgICAgICBpdGVtOiAodGhpcy5zdHlsZSkgPyB0aGlzLnN0eWxlLmxpbmsgOiB1bmRlZmluZWQKICAgICAgICAgIH0sCiAgICAgICAgICBpc1VwZGF0ZTogdXBkYXRlCiAgICAgICAgfTsKICAgICAgICBpZiAodXBkYXRlICYmIHRoaXMucGFuZWwpIHsKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS51cGRhdGUodGhpcy5wYW5lbCwgb3B0aW9ucykKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5wYW5lbCA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5jcmVhdGUob3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgc2hvd0xpbmtzOiBmdW5jdGlvbihsaW5rcywgdGl0bGUsIGEsIGhuYW1lLCB1cGRhdGUpIHsKICAgICAgICB2YXIgcGFuZWwsIGlkID0gYS5nZXRBdHRyaWJ1dGUodGhpcy5kYXRhSWRBdHRyKTsKICAgICAgICBpZiAoaWQpCiAgICAgICAgICBwYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCiAgICAgICAgaWYgKCFwYW5lbCkgewogICAgICAgICAgdGhpcy5jcmVhdGVNZW51KGxpbmtzLCB0aXRsZSwgYSwgaG5hbWUsIHVwZGF0ZSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5wYW5lbCkgewogICAgICAgICAgdGhpcy5wYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZihsaW5rcykgPT0gJ3N0cmluZycpIHsKICAgICAgICAgIHBhbmVsLnRleHRDb250ZW50ID0gbGlua3M7CiAgICAgICAgfSBlbHNlIGlmICghbGlua3MgfHwgbGlua3MubGVuZ3RoID09IDApIHsKICAgICAgICAgIHBhbmVsLnRleHRDb250ZW50ID0gbW9uby5nbG9iYWwubGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBhcHBlbmQgbGlua3MKICAgICAgICAgIGlmIChobmFtZSAmJiB0aGlzLmhvc3RpbmdzW2huYW1lXSAmJiB0aGlzLmhvc3RpbmdzW2huYW1lXS5wcmVwYXJlTGlua3MpCiAgICAgICAgICAgIGxpbmtzID0gdGhpcy5ob3N0aW5nc1tobmFtZV0ucHJlcGFyZUxpbmtzKGxpbmtzKTsKCiAgICAgICAgICBwYW5lbC50ZXh0Q29udGVudCA9ICcnOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlua3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGxpbmtzW2ldLnVybCAmJiBsaW5rc1tpXS5uYW1lKSB7CiAgICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgYS5ocmVmID0gbGlua3NbaV0udXJsOwogICAgICAgICAgICAgIGEudGl0bGUgPSBtb25vLmdsb2JhbC5sYW5ndWFnZS5kb3dubG9hZFRpdGxlOwogICAgICAgICAgICAgIGEuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGlua3NbaV0ubmFtZSkpOwogICAgICAgICAgICAgIHZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgIHNwYW4uY2xhc3NOYW1lID0gdGhpcy5saW5rQ2xhc3M7CgogICAgICAgICAgICAgIHNwYW4uYXBwZW5kQ2hpbGQoYSk7CiAgICAgICAgICAgICAgcGFuZWwuYXBwZW5kQ2hpbGQoc3Bhbik7CgogICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmFwcGVuZEZpbGVTaXplSWNvbihhKTsKICAgICAgICAgICAgICBpZiAobGlua3NbaV0ubm9Tb3VuZCkKICAgICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmFwcGVuZE5vU291bmRJY29uKGEpOwoKICAgICAgICAgICAgICBpZiAodGl0bGUgJiYgIWxpbmtzW2ldLm5vVGl0bGUgJiYgbGlua3NbaV0udHlwZSkgewogICAgICAgICAgICAgICAgYS5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgbW9uby5maWxlTmFtZS5tb2RpZnkoCiAgICAgICAgICAgICAgICAgIHRpdGxlICsgJy4nICsgbGlua3NbaV0udHlwZS50b0xvd2VyQ2FzZSgpKSk7CgogICAgICAgICAgICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkT25DbGljaywgZmFsc2UpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNyZWF0ZVVtbXlJbmZvOiBmdW5jdGlvbihkZXRhaWxzLCB0YXJnZXROb2RlKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZGV0YWlscyA9IGRldGFpbHMgfHwge307CiAgICAgIHZhciBwYXJhbXMgPSBtb25vLmV4dGVuZCh7CiAgICAgICAgdmlkOiAxMTEsCiAgICAgICAgdXRtX3NvdXJjZTogJ3NhdmVmcm9tLWhlbHBlcicsCiAgICAgICAgdXRtX21lZGl1bTogJ3lvdXR1YmUtaGVscGVyJwogICAgICB9LCBkZXRhaWxzLnBhcmFtcyk7CgogICAgICBpZiAoIXBhcmFtcy51dG1fY2FtcGFpZ24pIHsKICAgICAgICBpZiAoZGV0YWlscy5pdGVtVHlwZSA9PT0gJ2hkJykgewogICAgICAgICAgcGFyYW1zLnV0bV9jYW1wYWlnbiA9ICd5b3V0dWJlLWhlbHBlci1oZCc7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKGRldGFpbHMuaXRlbVR5cGUgPT09ICdtcDMnKSB7CiAgICAgICAgICBwYXJhbXMudXRtX2NhbXBhaWduID0gJ3lvdXR1YmUtaGVscGVyLW1wMyc7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgdW1teVVybCA9ICdodHRwOi8vdmlkZW9kb3dubG9hZGVyLnVtbXkubmV0Lz8nICsgbW9uby5wYXJhbShwYXJhbXMpOwogICAgICBpZiAoL15NYWMvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSAmJiAvXnl0LS8udGVzdChwYXJhbXMudmlkZW8pKSB7CiAgICAgICAgdW1teVVybCA9ICdodHRwOi8vdmlkZW9kb3dubG9hZGVyLnVtbXkubmV0L3NhdmUtZnJvbS15b3V0dWJlLmh0bWw/JyArIG1vbm8ucGFyYW0oewogICAgICAgICAgdmlkOiBwYXJhbXMudmlkLAogICAgICAgICAgdmlkZW86IHBhcmFtcy52aWRlbywKICAgICAgICAgIHV0bV9zb3VyY2U6ICdzYXZlZnJvbS1oZWxwZXInLAogICAgICAgICAgdXRtX21lZGl1bTogJ3lvdXR1YmUtaGVscGVyJywKICAgICAgICAgIHV0bV9jYW1wYWlnbjogJ3VtbXknLAogICAgICAgICAgdXRtX2NvbnRlbnQ6ICd1bW15X2ludGVncmF0aW9uX2gnCiAgICAgICAgfSk7CiAgICAgIH0KCgogICAgICB2YXIgdGhlbWVTaGFkb3dBcnJvd0RpclN0eWxlLCB0aGVtZUFycm93RGlyU3R5bGUsIHRoZW1lSW5mb1BvcHVwLCB0aGVtZUxpbmtDb2xvcjsKCiAgICAgIHZhciBzaGFkb3dBcnJvd0RpclN0eWxlLCBhcnJvd0RpclN0eWxlLCBjb250YWluZXJEaXJBcnJvdzsKICAgICAgaWYgKGRldGFpbHMucG9zTGVmdCkgewogICAgICAgIHNoYWRvd0Fycm93RGlyU3R5bGUgPSB7CiAgICAgICAgICBib3JkZXI6ICc4cHggc29saWQgdHJhbnNwYXJlbnQnLAogICAgICAgICAgYm9yZGVyTGVmdDogJzEwcHggc29saWQgcmdiKDE5MiwgMTg3LCAxODcpJywKICAgICAgICAgIGJvcmRlclJpZ2h0OiAwLAogICAgICAgICAgdG9wOiAnOHB4JywKICAgICAgICAgIHJpZ2h0OiAnMTFweCcKICAgICAgICB9OwoKICAgICAgICBhcnJvd0RpclN0eWxlID0gbW9uby5leHRlbmQoe30sIHNoYWRvd0Fycm93RGlyU3R5bGUsIHsKICAgICAgICAgIHJpZ2h0OiAnMTJweCcsCiAgICAgICAgICBib3JkZXJMZWZ0OiAnMTBweCBzb2xpZCAjZmZmJwogICAgICAgIH0pOwoKICAgICAgICBjb250YWluZXJEaXJBcnJvdyA9IHsKICAgICAgICAgIHJpZ2h0OiAnMjFweCcKICAgICAgICB9OwoKICAgICAgICBpZiAoZGV0YWlscy5kYXJrVGhlbWUpIHsKICAgICAgICAgIHRoZW1lU2hhZG93QXJyb3dEaXJTdHlsZSA9IHsKICAgICAgICAgICAgYm9yZGVyTGVmdENvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjQpJwogICAgICAgICAgfTsKCiAgICAgICAgICB0aGVtZUFycm93RGlyU3R5bGUgPSB7CiAgICAgICAgICAgIGJvcmRlckxlZnRDb2xvcjogJ3JnYmEoMjgsMjgsMjgsIDAuNiknCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzaGFkb3dBcnJvd0RpclN0eWxlID0gewogICAgICAgICAgYm9yZGVyOiAnOHB4IHNvbGlkIHRyYW5zcGFyZW50JywKICAgICAgICAgIGJvcmRlclJpZ2h0OiAnMTBweCBzb2xpZCByZ2IoMTkyLCAxODcsIDE4NyknLAogICAgICAgICAgYm9yZGVyTGVmdDogMCwKICAgICAgICAgIHRvcDogJzhweCcsCiAgICAgICAgICBsZWZ0OiAnMTFweCcKICAgICAgICB9OwoKICAgICAgICBhcnJvd0RpclN0eWxlID0gbW9uby5leHRlbmQoe30sIHNoYWRvd0Fycm93RGlyU3R5bGUsIHsKICAgICAgICAgIGxlZnQ6ICcxMnB4JywKICAgICAgICAgIGJvcmRlclJpZ2h0OiAnMTBweCBzb2xpZCAjZmZmJwogICAgICAgIH0pOwoKICAgICAgICBjb250YWluZXJEaXJBcnJvdyA9IHsKICAgICAgICAgIGxlZnQ6ICcyMXB4JwogICAgICAgIH07CgogICAgICAgIGlmIChkZXRhaWxzLmRhcmtUaGVtZSkgewogICAgICAgICAgdGhlbWVTaGFkb3dBcnJvd0RpclN0eWxlID0gewogICAgICAgICAgICBib3JkZXJSaWdodENvbG9yOiAnI2ZmZicKICAgICAgICAgIH07CgogICAgICAgICAgdGhlbWVBcnJvd0RpclN0eWxlID0gewogICAgICAgICAgICBib3JkZXJSaWdodENvbG9yOiAnIzAwMCcKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoZGV0YWlscy5kYXJrVGhlbWUpIHsKICAgICAgICB0aGVtZUxpbmtDb2xvciA9IHsKICAgICAgICAgICdhJzogewogICAgICAgICAgICBjb2xvcjogJyNlZWUnCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGVtZUxpbmtDb2xvciA9IHt9OwogICAgICB9CgogICAgICBpZiAoZGV0YWlscy5kYXJrVGhlbWUpIHsKICAgICAgICB0aGVtZUluZm9Qb3B1cCA9IHsKICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjgsMjgsMjgsMC44KScsCiAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjQpJywKICAgICAgICAgIGNvbG9yOiAnI2ZmZicKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIHRoZW1lSW5mb1BvcHVwID0gewogICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZicsCiAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI2NjYycKICAgICAgICB9OwogICAgICB9CgoKICAgICAgdmFyIGFycm93ID0gbW9uby5jcmVhdGUoZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLCB7CiAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgc3R5bGU6IG1vbm8uZXh0ZW5kKHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJwogICAgICAgICAgICB9LCBzaGFkb3dBcnJvd0RpclN0eWxlLCB0aGVtZVNoYWRvd0Fycm93RGlyU3R5bGUpCiAgICAgICAgICB9KSwKICAgICAgICAgIG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICBzdHlsZTogbW9uby5leHRlbmQoewogICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgIHpJbmRleDogMQogICAgICAgICAgICB9LCBhcnJvd0RpclN0eWxlLCB0aGVtZUFycm93RGlyU3R5bGUpCiAgICAgICAgICB9KQogICAgICAgIF0KICAgICAgfSk7CgogICAgICB2YXIgc2hvd1VtbXlJbmZvTm9kZSA9IG51bGw7CiAgICAgIHZhciBpbmZvID0gbnVsbDsKICAgICAgdmFyIGluZm9Db250YWluZXIgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgIGNsYXNzOiAnc2YtdW1teS1pbmZvLXBvcHVwLWNvbnRhaW5lcicsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgekluZGV4OiA5OTk5CiAgICAgICAgfSwKICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgIGFycm93LAogICAgICAgICAgaW5mbyA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgIGNsYXNzOiAnc2YtdW1teS1pbmZvLXBvcHVwJywKICAgICAgICAgICAgc3R5bGU6IG1vbm8uZXh0ZW5kKHsKICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmJywKICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI2NjYycsCiAgICAgICAgICAgICAgcGFkZGluZzogJzZweCA1cHgnLAogICAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicsCiAgICAgICAgICAgICAgbWF4V2lkdGg6ICcyNDBweCcsCiAgICAgICAgICAgICAgbGluZUhlaWdodDogJzE2cHgnLAogICAgICAgICAgICAgIGZvbnRTaXplOiAnMTJweCcsCiAgICAgICAgICAgICAgZm9udEZhbWlseTogJ2FyaWFsLCBzYW5zLXNlcmlmJywKICAgICAgICAgICAgICBjdXJzb3I6ICdkZWZhdWx0JwogICAgICAgICAgICB9LCBjb250YWluZXJEaXJBcnJvdywgdGhlbWVJbmZvUG9wdXApLAogICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICBtb25vLnBhcnNlVGVtcGxhdGUobW9uby5nbG9iYWwubGFuZ3VhZ2UudW1teU1lbnVJbmZvLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAne3VybH0nLCB1bW15VXJsCiAgICAgICAgICAgICAgKSksCiAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2xhYmVsJywgewogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgc2hvd1VtbXlJbmZvTm9kZSA9IG1vbm8uY3JlYXRlKCdpbnB1dCcsIHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2hlY2tib3gnLAogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdzaG93VW1teUluZm8nLAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgIG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnRvb2x0aXBIaWRlCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KHsKICAgICAgICAgICAgICAgICAgJy5zZi11bW15LWluZm8tcG9wdXAnOiB7CiAgICAgICAgICAgICAgICAgICAgYXBwZW5kOiBtb25vLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAnPiBwJzogewogICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46ICcwIDAgLjhlbSAwJwogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICc+IHAuY2VudGVyJzogewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0QWxpZ246ICdjZW50ZXInCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgJz4gcCA+IC5ncmVlbi1idG4tMi5hcnJvdyc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJyM4NGJkMDcnLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc1cHgnLAogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6ICc4cHggMzRweCA4cHggMTBweCcsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHREZWNvcmF0aW9uOiAnbm9uZScsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTJweCcKICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAnPiBwID4gLmdyZWVuLWJ0bi0yLmFycm93OmhvdmVyJzogewogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyNmZmYnLAogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjgKICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAnPiBwID4gLmdyZWVuLWJ0bi0yLmFycm93OmFmdGVyJzogewogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBT0NBWUFBQUFtTDV5S0FBQUFqa2xFUVZRb2tlM1JzUkdDUUJDRjRZdUpzUURvUU1waktNSW10QWp0aDl4TUVqNERGNGM1UURIM243bGs3NzNiM1hzSk56VHBSOURnbHJ3WWNVRzl3MWlIZG9UcGdZa0JKNVFyeGtQY0RYTkRRbS9KSFIyS09GM1Vjdm9VZ25aTDhLRkJpMkkrWXJrMllzWmpzYUlzQlZRNGkwOEt4cWhWdTFPWUJMamkrRS9oelRLRmxWMTNwZkFWR3lua1BBRnRybE5UTVJjek1nQUFBQUJKUlU1RXJrSmdnZz09KSAwIDAgbm8tcmVwZWF0JywKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJyIiJywKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogJzE0cHgnLAogICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICc1MCUnLAogICAgICAgICAgICAgICAgICAgICAgICByaWdodDogJzEwcHgnLAogICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6ICctN3B4JwogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICdpbnB1dCc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB0aGVtZUxpbmtDb2xvcikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KQogICAgICAgICAgICBdCiAgICAgICAgICB9KQogICAgICAgIF0sCiAgICAgICAgb246IFsKICAgICAgICAgIFsnbW91c2VjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIH1dLAogICAgICAgICAgWydtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICB9XQogICAgICAgIF0KICAgICAgfSk7CgogICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICBhY3Rpb246ICdnZXRVbW15SWNvbicKICAgICAgfSwgZnVuY3Rpb24oZGF0YUltZykgewogICAgICAgIHZhciBpY29uID0gaW5mby5xdWVyeVNlbGVjdG9yKCdpbWcnKTsKICAgICAgICBpZiAoIWljb24pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWNvbi5zcmMgPSBkYXRhSW1nOwogICAgICAgIGljb24uc3R5bGUudmVydGljYWxBbGlnbiA9ICd0ZXh0LWJvdHRvbSc7CiAgICAgIH0pOwoKICAgICAgc2hvd1VtbXlJbmZvTm9kZS5jaGVja2VkID0gIW1vbm8uZ2xvYmFsLnByZWZlcmVuY2Uuc2hvd1VtbXlJbmZvOwogICAgICBzaG93VW1teUluZm9Ob2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgaWYgKHRoaXMuY2hlY2tlZCkgewogICAgICAgICAgbW9uby50cmlnZ2VyKHRhcmdldE5vZGUsICdzZlJtSW5mb1BvcHVwJyk7CiAgICAgICAgICBtb25vLmdsb2JhbC5wcmVmZXJlbmNlLnNob3dVbW15SW5mbyA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vbm8udHJpZ2dlcih0YXJnZXROb2RlLCAnc2ZBZGRJbmZvUG9wdXAnKTsKICAgICAgICAgIG1vbm8uZ2xvYmFsLnByZWZlcmVuY2Uuc2hvd1VtbXlJbmZvID0gMTsKICAgICAgICB9CgogICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAndXBkYXRlT3B0aW9uJywKICAgICAgICAgIGtleTogJ3Nob3dVbW15SW5mbycsCiAgICAgICAgICB2YWx1ZTogbW9uby5nbG9iYWwucHJlZmVyZW5jZS5zaG93VW1teUluZm8KICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBkZXRhaWxzLm9uQ3JlYXRlVW1teUluZm8gJiYgZGV0YWlscy5vbkNyZWF0ZVVtbXlJbmZvKGluZm9Db250YWluZXIpOwoKICAgICAgcmV0dXJuIGluZm9Db250YWluZXI7CiAgICB9LAogICAgYmluZFVtbXlJbmZvOiBmdW5jdGlvbihjb250YWluZXIsIGRldGFpbHMpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBkZXRhaWxzID0gZGV0YWlscyB8fCB7fTsKICAgICAgLy8gbWVudQogICAgICBpZiAoIWRldGFpbHMubm9VbW15ICYmICFtb25vLmdsb2JhbC5wcmVmZXJlbmNlLnNob3dVbW15SW5mbykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoZGV0YWlscy53aWR0aExpbWl0ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRXaWR0aCA8IGRldGFpbHMud2lkdGhMaW1pdCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZGV0YWlscy5sZWZ0T2Zmc2V0ID0gZGV0YWlscy5sZWZ0T2Zmc2V0IHx8IDIxOwoKICAgICAgdmFyIGluZm9Qb3B1cCA9IG51bGw7CiAgICAgIHZhciBpbmZvUG9wdXBTaG93VGltZXIgPSBudWxsOwogICAgICB2YXIgcG9zaXRpb25Ub3AgPSBudWxsOwoKICAgICAgdmFyIHBvcHVwQXJyb3dUb3AgPSA4OwogICAgICB2YXIgcG9wdXBBcnJvdyA9IG51bGw7CiAgICAgIHZhciBwb3B1cEFycm93U2hhZG93ID0gbnVsbDsKCiAgICAgIHZhciBraWxsVGltZXIgPSBudWxsOwogICAgICB2YXIga2lsbFRpbWVyVXBkYXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KGtpbGxUaW1lcik7CiAgICAgICAga2lsbFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChpbmZvUG9wdXAgJiYgaW5mb1BvcHVwLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgaWYgKGluZm9Qb3B1cC5zdHlsZS5kaXNwbGF5ICE9PSAnbm9uZScpIHsKICAgICAgICAgICAgICByZXR1cm4ga2lsbFRpbWVyVXBkYXRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5mb1BvcHVwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaW5mb1BvcHVwKTsKICAgICAgICAgIH0KICAgICAgICB9LCAzMCAqIDEwMDApOwogICAgICB9OwoKICAgICAgdmFyIGZpeFBvc2l0aW9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CiAgICAgICAgICB2YXIgaW5mb0hlaWdodCA9IGluZm9Qb3B1cC5jbGllbnRIZWlnaHQ7CiAgICAgICAgICB2YXIgc2Nyb2xsWSA9IHdpbmRvdy5zY3JvbGxZOwogICAgICAgICAgaWYgKGluZm9IZWlnaHQgKyBwb3NpdGlvblRvcCA+IHdpbmRvd0hlaWdodCArIHNjcm9sbFkpIHsKICAgICAgICAgICAgdmFyIG5ld1Bvc2l0aW9uVG9wID0gd2luZG93SGVpZ2h0IC0gaW5mb0hlaWdodCArIHNjcm9sbFk7CiAgICAgICAgICAgIGlmIChuZXdQb3NpdGlvblRvcCA8IDApIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwb3NpdGlvblRvcCA9PT0gbmV3UG9zaXRpb25Ub3ApIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGluZm9Qb3B1cC5zdHlsZS50b3AgPSBuZXdQb3NpdGlvblRvcCArICdweCc7CgogICAgICAgICAgICB2YXIgcmF6ID0gOCAtICh3aW5kb3dIZWlnaHQgLSAoaW5mb0hlaWdodCArIHBvc2l0aW9uVG9wKSArIHNjcm9sbFkpOwogICAgICAgICAgICBpZiAocG9wdXBBcnJvd1RvcCAhPT0gcmF6KSB7CiAgICAgICAgICAgICAgcG9wdXBBcnJvd1RvcCA9IHJhejsKICAgICAgICAgICAgICBwb3B1cEFycm93LnN0eWxlLnRvcCA9IHBvcHVwQXJyb3dUb3AgKyAncHgnOwogICAgICAgICAgICAgIHBvcHVwQXJyb3dTaGFkb3cuc3R5bGUudG9wID0gcG9wdXBBcnJvd1RvcCArICdweCc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChwb3B1cEFycm93VG9wICE9PSA4KSB7CiAgICAgICAgICAgICAgcG9wdXBBcnJvd1RvcCA9IDg7CiAgICAgICAgICAgICAgcG9wdXBBcnJvdy5zdHlsZS50b3AgPSBwb3B1cEFycm93VG9wICsgJ3B4JzsKICAgICAgICAgICAgICBwb3B1cEFycm93U2hhZG93LnN0eWxlLnRvcCA9IHBvcHVwQXJyb3dUb3AgKyAncHgnOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICB2YXIgb25Nb3VzZUxlYXZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KGluZm9Qb3B1cFNob3dUaW1lcik7CiAgICAgICAgaW5mb1BvcHVwU2hvd1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIGluZm9Qb3B1cCAmJiAoaW5mb1BvcHVwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpOwogICAgICAgIH0sIDUwKTsKICAgICAgfTsKCiAgICAgIHZhciB1cGRhdGVMZWZ0UG9zID0gZnVuY3Rpb24oZWwpIHsKICAgICAgICB2YXIgcG9zaXRpb24gPSBTYXZlRnJvbV9VdGlscy5nZXRQb3NpdGlvbihlbCk7CiAgICAgICAgaWYgKGRldGFpbHMucG9zTGVmdCkgewogICAgICAgICAgaW5mb1BvcHVwLnN0eWxlLnJpZ2h0ID0gKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIHBvc2l0aW9uLmxlZnQgLSBkZXRhaWxzLmxlZnRPZmZzZXQpICsgJ3B4JzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHNpemUgPSBTYXZlRnJvbV9VdGlscy5nZXRTaXplKGVsKTsKICAgICAgICAgIGluZm9Qb3B1cC5zdHlsZS5sZWZ0ID0gKHNpemUud2lkdGggKyBwb3NpdGlvbi5sZWZ0IC0gZGV0YWlscy5sZWZ0T2Zmc2V0KSArICdweCc7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIG9uTW91c2VFbnRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghZGV0YWlscy5ub1VtbXkgJiYgIW1vbm8uZ2xvYmFsLnByZWZlcmVuY2Uuc2hvd1VtbXlJbmZvKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjbGVhclRpbWVvdXQoaW5mb1BvcHVwU2hvd1RpbWVyKTsKCiAgICAgICAgdmFyIHBvc2l0aW9uID0gU2F2ZUZyb21fVXRpbHMuZ2V0UG9zaXRpb24oY29udGFpbmVyKTsKCiAgICAgICAgaWYgKCFpbmZvUG9wdXApIHsKICAgICAgICAgIGlmIChkZXRhaWxzLmV4cFVtbXlJbmZvKSB7CiAgICAgICAgICAgIGluZm9Qb3B1cCA9IGRldGFpbHMuZXhwVW1teUluZm8oZGV0YWlscy5jcmVhdGVVbW15SW5mb0RldGFpbHMsIGNvbnRhaW5lcik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpbmZvUG9wdXAgPSBTYXZlRnJvbV9VdGlscy5jcmVhdGVVbW15SW5mbyhkZXRhaWxzLmNyZWF0ZVVtbXlJbmZvRGV0YWlscywgY29udGFpbmVyKTsKICAgICAgICAgIH0KCiAgICAgICAgICBwb3B1cEFycm93ID0gaW5mb1BvcHVwLmZpcnN0Q2hpbGQ7CiAgICAgICAgICBwb3B1cEFycm93U2hhZG93ID0gcG9wdXBBcnJvdy5uZXh0RWxlbWVudFNpYmxpbmc7CgogICAgICAgICAgcG9zaXRpb25Ub3AgPSBwb3NpdGlvbi50b3AgLSA0OwoKICAgICAgICAgIG1vbm8ub24oaW5mb1BvcHVwLCAnbW91c2VlbnRlcicsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQoaW5mb1BvcHVwU2hvd1RpbWVyKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIG1vbm8ub24oaW5mb1BvcHVwLCAnbW91c2VsZWF2ZScsIG9uTW91c2VMZWF2ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBvc2l0aW9uVG9wID0gcG9zaXRpb24udG9wIC0gNDsKICAgICAgICB9CgogICAgICAgIGluZm9Qb3B1cC5zdHlsZS50b3AgPSBwb3NpdGlvblRvcCArICdweCc7CgogICAgICAgIGlmIChpbmZvUG9wdXAuZGF0YXNldC5oaWRlID09PSAnMScpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHVwZGF0ZUxlZnRQb3MoY29udGFpbmVyKTsKCiAgICAgICAgaWYgKCFpbmZvUG9wdXAucGFyZW50Tm9kZSkgewogICAgICAgICAgaW5mb1BvcHVwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAoZGV0YWlscy5jb250YWluZXIgfHwgZG9jdW1lbnQuYm9keSkuYXBwZW5kQ2hpbGQoaW5mb1BvcHVwKTsKICAgICAgICB9CgogICAgICAgIGlmIChpbmZvUG9wdXAuc3R5bGUuZGlzcGxheSAhPT0gJ2Jsb2NrJykgewogICAgICAgICAgaW5mb1BvcHVwLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgbW9uby50cmlnZ2VyKGluZm9Qb3B1cCwgJ3NmU2hvd0luZm9Qb3B1cCcpOwogICAgICAgIH0KCiAgICAgICAgZml4UG9zaXRpb24oKTsKCiAgICAgICAga2lsbFRpbWVyVXBkYXRlKCk7CiAgICAgIH07CgogICAgICBtb25vLm9uKGNvbnRhaW5lciwgJ21vdXNlZW50ZXInLCBvbk1vdXNlRW50ZXIpOwogICAgICBtb25vLm9uKGNvbnRhaW5lciwgJ21vdXNlbGVhdmUnLCBvbk1vdXNlTGVhdmUpOwoKICAgICAgbW9uby5vbihjb250YWluZXIsICdzZlJtSW5mb1BvcHVwJywgZnVuY3Rpb24oKSB7CiAgICAgICAgbW9uby5vZmYoY29udGFpbmVyLCAnbW91c2VlbnRlcicsIG9uTW91c2VFbnRlcik7CiAgICAgIH0pOwoKICAgICAgbW9uby5vbihjb250YWluZXIsICdzZkFkZEluZm9Qb3B1cCcsIGZ1bmN0aW9uKCkgewogICAgICAgIG1vbm8ub24oY29udGFpbmVyLCAnbW91c2VlbnRlcicsIG9uTW91c2VFbnRlcik7CiAgICAgIH0pOwogICAgfSwKCiAgICBwb3B1cE1lbnU6IHsKICAgICAgcG9wdXBJZDogJ3NmX3BvcHVwTWVudScsCiAgICAgIHBvcHVwOiB1bmRlZmluZWQsCiAgICAgIHBvcHVwU3R5bGU6IHVuZGVmaW5lZCwKICAgICAgZGF0YUFycnRWaXNpYmxlOiAnZGF0YS1pc1Zpc2libGUnLAogICAgICBleHRTdHlsZUNhY2hlOiB1bmRlZmluZWQsCiAgICAgIHVtbXlJY29uOiBudWxsLAoKICAgICAgYmFkZ2VRdWFsaXR5TGlzdDogWyc4SycsICc0SycsICcyMTYwJywgJzE0NDAnLCAnMTA4MCcsICc3MjAnLCAndW1teSddLAogICAgICBjcmVhdGVCYWRnZTogZnVuY3Rpb24ocXVsaXR5LCBvcHRpb25zKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICB2YXIgc3R5bGUgPSB7CiAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgIGxpbmVIZWlnaHQ6ICcxOHB4JywKICAgICAgICAgIHdpZHRoOiAnMTlweCcsCiAgICAgICAgICBoZWlnaHQ6ICcxN3B4JywKICAgICAgICAgIGNvbG9yOiAnI2ZmZicsCiAgICAgICAgICBmb250U2l6ZTogJzEycHgnLAogICAgICAgICAgYm9yZGVyUmFkaXVzOiAnMnB4JywKICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICdtaWRkbGUnLAogICAgICAgICAgdGV4dEFsaWduOiAnY2VudGVyJywKICAgICAgICAgIHBhZGRpbmdSaWdodDogJzJweCcsCiAgICAgICAgICBmb250V2VpZ2h0OiAnYm9sZCcsCiAgICAgICAgICBtYXJnaW5MZWZ0OiAnM3B4JwogICAgICAgIH07CiAgICAgICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMuY29udGFpbmVyU3R5bGUpIHsKICAgICAgICAgIHN0eWxlW2tleV0gPSBvcHRpb25zLmNvbnRhaW5lclN0eWxlW2tleV07CiAgICAgICAgfQoKICAgICAgICB2YXIgY29udGFpbmVyID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgIHN0eWxlOiBzdHlsZQogICAgICAgIH0pOwoKICAgICAgICBpZiAocXVsaXR5ID09PSAnMTA4MCcgfHwgcXVsaXR5ID09PSAnMjE2MCcgfHwgcXVsaXR5ID09PSAnMTQ0MCcgfHwgcXVsaXR5ID09PSAnNzIwJykgewogICAgICAgICAgY29udGFpbmVyLnRleHRDb250ZW50ID0gJ0hEJzsKICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnIzUwNTA1MCc7CiAgICAgICAgICBjb250YWluZXIuc3R5bGUucGFkZGluZ1JpZ2h0ID0gJzFweCc7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHF1bGl0eSA9PT0gJzhLJyB8fCBxdWxpdHkgPT09ICc0SycpIHsKICAgICAgICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9ICdIRCc7CiAgICAgICAgICBjb250YWluZXIuc3R5bGUucGFkZGluZ1JpZ2h0ID0gJzFweCc7CiAgICAgICAgICBjb250YWluZXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JnYigyNDcsIDE4MCwgNiknOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChxdWxpdHkgPT09ICdtcDMnIHx8IHF1bGl0eSA9PT0gJ01QMycpIHsKICAgICAgICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9ICdNUDMnOwogICAgICAgICAgY29udGFpbmVyLnN0eWxlLndpZHRoID0gJzI2cHgnOwogICAgICAgICAgY29udGFpbmVyLnN0eWxlLnBhZGRpbmdSaWdodCA9ICcxcHgnOwogICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjNTA1MDUwJzsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAocXVsaXR5ID09PSAndW1teScpIHsKICAgICAgICAgIGlmICh0aGlzLnVtbXlJY29uKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5iYWNrZ3JvdW5kID0gJ3VybCgnICsgdGhpcy51bW15SWNvbiArICcpIGNlbnRlciBjZW50ZXIgbm8tcmVwZWF0JzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ2dldFVtbXlJY29uJwogICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhSW1nKSB7CiAgICAgICAgICAgICAgY29udGFpbmVyLnN0eWxlLmJhY2tncm91bmQgPSAndXJsKCcgKyAoX3RoaXMudW1teUljb24gPSBkYXRhSW1nKSArICcpIGNlbnRlciBjZW50ZXIgbm8tcmVwZWF0JzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb250YWluZXI7CiAgICAgIH0sCgogICAgICBnZXRUaXRsZU5vZGU6IGZ1bmN0aW9uKGxpbmspIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIF90aGlzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51OwoKICAgICAgICB2YXIgdGl0bGVDb250YWluZXIgPSBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGNzc0Zsb2F0OiAnbGVmdCcKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKGxpbmsuZXh0cmEgPT09ICdjb252ZXJ0ZXInKSB7CiAgICAgICAgICB2YXIgYmFkZ2UgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgICAgICBpZiAoWydNUDMnLCAnOEsnLCAnNEsnLCAnMTQ0MCcsICcxMDgwJywgJzcyMCddLmluZGV4T2YobGluay5mb3JtYXQpICE9PSAtMSkgewogICAgICAgICAgICBiYWRnZS5hcHBlbmRDaGlsZChfdGhpcy5jcmVhdGVCYWRnZShsaW5rLmZvcm1hdCwgewogICAgICAgICAgICAgIGNvbnRhaW5lclN0eWxlOiB7CiAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiYWRnZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsaW5rLmZvcm1hdCkpOwogICAgICAgICAgfQogICAgICAgICAgbW9uby5jcmVhdGUodGl0bGVDb250YWluZXIsIHsKICAgICAgICAgICAgYXBwZW5kOiBbYmFkZ2UsICcgJywgbGluay5xdWFsaXR5XQogICAgICAgICAgfSk7CiAgICAgICAgICBiYWRnZSA9IG51bGw7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKGxpbmsucXVhbGl0eSA9PT0gJ3VtbXknKSB7CiAgICAgICAgICAvLyB1bW15IGhvb2sKICAgICAgICAgIHZhciBiYWRnZSA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICAgIGlmIChsaW5rLnVRdWFsaXR5ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChbJzhLJywgJzRLJywgJzE0NDAnLCAnMTA4MCcsICc3MjAnXS5pbmRleE9mKGxpbmsudVF1YWxpdHkpICE9PSAtMSkgewogICAgICAgICAgICAgIGJhZGdlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmsudVF1YWxpdHkpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBiYWRnZS5hcHBlbmRDaGlsZChfdGhpcy5jcmVhdGVCYWRnZShsaW5rLnVRdWFsaXR5LCB7CiAgICAgICAgICAgICAgICBjb250YWluZXJTdHlsZTogewogICAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtb25vLmNyZWF0ZSh0aXRsZUNvbnRhaW5lciwgewogICAgICAgICAgICBhcHBlbmQ6IFtiYWRnZSwgJyAnLCAnVW1teSddCiAgICAgICAgICB9KTsKICAgICAgICAgIGJhZGdlID0gbnVsbDsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAobGluay5pdGVtVGV4dCkgewogICAgICAgICAgdGl0bGVDb250YWluZXIudGV4dENvbnRlbnQgPSBsaW5rLml0ZW1UZXh0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgdGl0bGVRdWFsaXR5ID0gbGluay5xdWFsaXR5ID8gJyAnICsgbGluay5xdWFsaXR5IDogJyc7CiAgICAgICAgICB2YXIgdGl0bGVGb3JtYXQgPSBsaW5rLmZvcm1hdCA/IGxpbmsuZm9ybWF0IDogJz8/Pyc7CiAgICAgICAgICB2YXIgdGl0bGUzRCA9IGxpbmtbJzNkJ10gPyAnM0QgJyA6ICcnOwogICAgICAgICAgdmFyIHRpdGxlRnBzID0gJyc7CiAgICAgICAgICBpZiAobGluay5zRnBzKSB7CiAgICAgICAgICAgIHRpdGxlRnBzICs9ICcgJyArIChsaW5rLmZwcyB8fCA2MCk7CiAgICAgICAgICB9CiAgICAgICAgICB0aXRsZUNvbnRhaW5lci50ZXh0Q29udGVudCA9IHRpdGxlM0QgKyB0aXRsZUZvcm1hdCArIHRpdGxlUXVhbGl0eSArIHRpdGxlRnBzOwogICAgICAgIH0KCiAgICAgICAgaWYgKF90aGlzLmJhZGdlUXVhbGl0eUxpc3QuaW5kZXhPZihTdHJpbmcobGluay5xdWFsaXR5KSkgIT09IC0xKSB7CiAgICAgICAgICB0aXRsZUNvbnRhaW5lci5hcHBlbmRDaGlsZChfdGhpcy5jcmVhdGVCYWRnZShTdHJpbmcobGluay5xdWFsaXR5KSkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRpdGxlQ29udGFpbmVyOwogICAgICB9LAoKICAgICAgY3JlYXRlUG9wdXBJdGVtOiBmdW5jdGlvbihsaXN0SXRlbSwgb3B0aW9ucykgewogICAgICAgIHZhciBfdGhpcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudTsKCiAgICAgICAgdmFyIGhyZWY7CiAgICAgICAgaWYgKHR5cGVvZiBsaXN0SXRlbSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGhyZWYgPSBsaXN0SXRlbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaHJlZiA9IGxpc3RJdGVtLmhyZWY7CiAgICAgICAgfQoKICAgICAgICBpZiAoaHJlZiA9PT0gJy0nKSB7CiAgICAgICAgICB2YXIgbGluZSA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgICAgICBtYXJnaW46ICcxcHggMCcsCiAgICAgICAgICAgICAgYm9yZGVyVG9wOiAnMXB4IHNvbGlkIHJnYigyMTQsIDIxNCwgMjE0KScKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBlbDogbGluZQogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHZhciBpdGVtQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgoaHJlZiA9PT0gJy10ZXh0LScpID8gJ2RpdicgOiAnYScpOwogICAgICAgIGlmIChvcHRpb25zLmxpbmtDbGFzcykgewogICAgICAgICAgaXRlbUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKG9wdGlvbnMubGlua0NsYXNzKTsKICAgICAgICB9CiAgICAgICAgdmFyIGl0ZW1Db250YWluZXJTdHlsZSA9IHsKICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsCiAgICAgICAgICBwYWRkaW5nOiAnMCA1cHgnLAogICAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJywKICAgICAgICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnLAogICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nCiAgICAgICAgfTsKICAgICAgICBpZiAobGlzdEl0ZW0uaXNIaWRkZW4pIHsKICAgICAgICAgIGl0ZW1Db250YWluZXIuc2V0QXR0cmlidXRlKF90aGlzLmRhdGFBcnJ0VmlzaWJsZSwgJzAnKTsKICAgICAgICAgIGl0ZW1Db250YWluZXJTdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZShpdGVtQ29udGFpbmVyLCBpdGVtQ29udGFpbmVyU3R5bGUpOwoKICAgICAgICBpZiAoaHJlZiA9PT0gJy10ZXh0LScpIHsKICAgICAgICAgIGl0ZW1Db250YWluZXIuc3R5bGUubGluZUhlaWdodCA9ICcyMnB4JzsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVsOiBpdGVtQ29udGFpbmVyCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgaXRlbUNvbnRhaW5lci5ocmVmID0gaHJlZjsKCiAgICAgICAgaWYgKGhyZWYgPT09ICcjJykgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZWw6IGl0ZW1Db250YWluZXIKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBpZiAobW9uby5pc0dNIHx8IG1vbm8uaXNPcGVyYSB8fCBtb25vLmlzU2FmYXJpKSB7CiAgICAgICAgICBpZiAobGlzdEl0ZW0ucXVhbGl0eSAhPT0gJ3VtbXknICYmICFsaXN0SXRlbS5leHRyYSkgewogICAgICAgICAgICBpdGVtQ29udGFpbmVyLnRpdGxlID0gbW9uby5nbG9iYWwubGFuZ3VhZ2UuZG93bmxvYWRUaXRsZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChsaXN0SXRlbS5mb3JjZURvd25sb2FkKSB7CiAgICAgICAgICB2YXIgZmlsZW5hbWUgPSAnJzsKICAgICAgICAgIGlmIChsaXN0SXRlbS50aXRsZSkgewogICAgICAgICAgICB2YXIgZXh0ID0gbGlzdEl0ZW0uZXh0OwogICAgICAgICAgICBpZiAoIWV4dCkgewogICAgICAgICAgICAgIGV4dCA9IGxpc3RJdGVtLmZvcm1hdC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpbGVuYW1lID0gbGlzdEl0ZW0udGl0bGUgKyAnLicgKyBleHQ7CiAgICAgICAgICB9CiAgICAgICAgICBpdGVtQ29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBtb25vLmZpbGVOYW1lLm1vZGlmeShmaWxlbmFtZSkpOwogICAgICAgICAgaXRlbUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkT25DbGljayhldmVudCwgbnVsbCwgewogICAgICAgICAgICAgIGVsOiB0aGlzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwgZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9uSXRlbUNsaWNrTGlzdCA9IFtdOwogICAgICAgIGlmIChsaXN0SXRlbS5mdW5jKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShsaXN0SXRlbS5mdW5jKSkgewogICAgICAgICAgICBvbkl0ZW1DbGlja0xpc3QucHVzaC5hcHBseShvbkl0ZW1DbGlja0xpc3QsIGxpc3RJdGVtLmZ1bmMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb25JdGVtQ2xpY2tMaXN0LnB1c2gobGlzdEl0ZW0uZnVuYyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLm9uSXRlbUNsaWNrICYmIG9uSXRlbUNsaWNrTGlzdC5pbmRleE9mKG9wdGlvbnMub25JdGVtQ2xpY2spID09PSAtMSkgewogICAgICAgICAgb25JdGVtQ2xpY2tMaXN0LnB1c2gob3B0aW9ucy5vbkl0ZW1DbGljayk7CiAgICAgICAgfQoKICAgICAgICBpZiAob25JdGVtQ2xpY2tMaXN0Lmxlbmd0aCkgewogICAgICAgICAgaXRlbUNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgb25JdGVtQ2xpY2tMaXN0LmZvckVhY2goZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICAgICAgcmV0dXJuIGNiLmNhbGwoX3RoaXMsIGUsIGxpc3RJdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAobGlzdEl0ZW0uaXNCbGFuaykgewogICAgICAgICAgaXRlbUNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ3RhcmdldCcsICdfYmxhbmsnKTsKICAgICAgICB9CgogICAgICAgIGl0ZW1Db250YWluZXIuYXBwZW5kQ2hpbGQoX3RoaXMuZ2V0VGl0bGVOb2RlKGxpc3RJdGVtKSk7CgogICAgICAgIHZhciBpbmZvQ29udGVpbmVyID0gbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBjc3NGbG9hdDogJ3JpZ2h0JywKICAgICAgICAgICAgbGluZUhlaWdodDogJzIycHgnLAogICAgICAgICAgICBoZWlnaHQ6ICcyMnB4JwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHZhciBzaXplSWNvblN0eWxlID0gewogICAgICAgICAgdG9wOiAnNXB4JywKICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICd0b3AnCiAgICAgICAgfTsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gb3B0aW9ucy5zaXplSWNvblN0eWxlKSB7CiAgICAgICAgICBzaXplSWNvblN0eWxlW2tleV0gPSBvcHRpb25zLnNpemVJY29uU3R5bGVba2V5XTsKICAgICAgICB9CiAgICAgICAgdmFyIHNpemVJY29uVGV4dFN0eWxlID0gewogICAgICAgICAgbWFyZ2luTGVmdDogMAogICAgICAgIH07CgogICAgICAgIGlmIChsaXN0SXRlbS5ub0F1ZGlvKSB7CiAgICAgICAgICBTYXZlRnJvbV9VdGlscy5hcHBlbmROb1NvdW5kSWNvbihpbmZvQ29udGVpbmVyLCBzaXplSWNvblN0eWxlKTsKICAgICAgICB9CgogICAgICAgIHZhciBzaXplSWNvbk5vZGUgPSBudWxsOwogICAgICAgIGlmICghbGlzdEl0ZW0ubm9TaXplKSB7CiAgICAgICAgICBpbmZvQ29udGVpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljayhlKSB7CiAgICAgICAgICAgIGlmIChpbmZvQ29udGVpbmVyLmZpcnN0Q2hpbGQudGFnTmFtZSA9PT0gJ0lNRycpIHsKICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICBtb25vLnRyaWdnZXIoaW5mb0NvbnRlaW5lci5maXJzdENoaWxkLCAnY2xpY2snLCB7CiAgICAgICAgICAgICAgICBjYW5jZWxhYmxlOiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xpY2spOwogICAgICAgICAgfSk7CiAgICAgICAgICBzaXplSWNvbk5vZGUgPSBTYXZlRnJvbV9VdGlscy5hcHBlbmRGaWxlU2l6ZUljb24oaXRlbUNvbnRhaW5lciwgc2l6ZUljb25TdHlsZSwgc2l6ZUljb25UZXh0U3R5bGUsIHVuZGVmaW5lZCwgdHJ1ZSwgaW5mb0NvbnRlaW5lciwgbGlzdEl0ZW0pOwogICAgICAgIH0KCiAgICAgICAgaXRlbUNvbnRhaW5lci5hcHBlbmRDaGlsZChpbmZvQ29udGVpbmVyKTsKCiAgICAgICAgaWYgKGxpc3RJdGVtLnF1YWxpdHkgPT09ICd1bW15JykgewogICAgICAgICAgdmFyIGJJbmZvRGV0YWlscyA9IG1vbm8uZXh0ZW5kKHt9LCBvcHRpb25zLmJpbmRVbW15SW5mb0RldGFpbHMpOwogICAgICAgICAgdmFyIGNJbmZvRGV0YWlscyA9IGJJbmZvRGV0YWlscy5jcmVhdGVVbW15SW5mb0RldGFpbHMgPSBtb25vLmV4dGVuZCh7CiAgICAgICAgICAgIGl0ZW1UeXBlOiBsaXN0SXRlbS51SXNBdWRpbyA/ICdtcDMnIDogJ2hkJwogICAgICAgICAgfSwgYkluZm9EZXRhaWxzLmNyZWF0ZVVtbXlJbmZvRGV0YWlscyk7CiAgICAgICAgICBjSW5mb0RldGFpbHMucGFyYW1zID0gbW9uby5leHRlbmQoewogICAgICAgICAgICB2aWRlbzogbGlzdEl0ZW0udmlkZW9JZCwKICAgICAgICAgICAgdmlkOiBsaXN0SXRlbS52aWQKICAgICAgICAgIH0sIGNJbmZvRGV0YWlscy5wYXJhbXMpOwogICAgICAgICAgU2F2ZUZyb21fVXRpbHMuYmluZFVtbXlJbmZvKGl0ZW1Db250YWluZXIsIGJJbmZvRGV0YWlscyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgZWw6IGl0ZW1Db250YWluZXIsCiAgICAgICAgICBzaXplSWNvbjogc2l6ZUljb25Ob2RlLAogICAgICAgICAgcHJvcDogbGlzdEl0ZW0KICAgICAgICB9OwogICAgICB9LAoKICAgICAgc29ydE1lbnVJdGVtczogZnVuY3Rpb24obGlzdCwgb3B0aW9ucykgewogICAgICAgIGlmIChvcHRpb25zID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICB9CiAgICAgICAgdmFyIGZvcm1hdFByaW9yaXR5ID0gWyd1bW15JywgJ0F1ZGlvIE9wdXMnLCAnQXVkaW8gVm9yYmlzJywgJ0F1ZGlvIEFBQycsICczR1AnLCAnV2ViTScsICdGTFYnLCAnTVA0J107CiAgICAgICAgdmFyIHN0clF1YWxpdHkgPSB7CiAgICAgICAgICBNb2JpbGU6IDI4MCwKICAgICAgICAgIExEOiAyODAsCiAgICAgICAgICBTRDogMzYwLAogICAgICAgICAgSEQ6IDcyMCwKICAgICAgICAgIHVtbXk6IDEKICAgICAgICB9OwogICAgICAgIGlmIChvcHRpb25zLnN0clF1YWxpdHlFeHRlbmQpIHsKICAgICAgICAgIG1vbm8uZXh0ZW5kKHN0clF1YWxpdHksIG9wdGlvbnMuc3RyUXVhbGl0eUV4dGVuZCk7CiAgICAgICAgfQogICAgICAgIHZhciBzaXplUHJpb3JpdHkgPSB7fTsKICAgICAgICB2YXIgYml0cmF0ZVByaW9yaXR5ID0gW107CiAgICAgICAgdmFyIGRlZkxpc3QgPSBbXTsKICAgICAgICB2YXIgYXVkaW9MaXN0ID0gW107CiAgICAgICAgdmFyIHN1YnRpdGxlTGlzdCA9IFtdOwogICAgICAgIHZhciBtdXRlNjBMaXN0ID0gW107CiAgICAgICAgdmFyIG11dGVMaXN0ID0gW107CiAgICAgICAgdmFyIF8zZExpc3QgPSBbXTsKICAgICAgICB2YXIgdW5rTGlzdCA9IFtdOwoKICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgdmFyIHByb3AgPSBpdGVtLnByb3A7CiAgICAgICAgICBpZiAob3B0aW9ucy5ub1Byb3ApIHsKICAgICAgICAgICAgcHJvcCA9IGl0ZW07CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc29ydE9wdGlvbnMgPSBwcm9wLnNvcnQgfHwge307CiAgICAgICAgICBpZiAoIXByb3AuZm9ybWF0KSB7CiAgICAgICAgICAgIHVua0xpc3QucHVzaChpdGVtKTsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocHJvcC5pc090aGVyKSB7CiAgICAgICAgICAgIHVua0xpc3QucHVzaChpdGVtKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKHByb3AuaXNTdWJ0aXRsZSkgewogICAgICAgICAgICBzdWJ0aXRsZUxpc3QucHVzaChpdGVtKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKHByb3Aubm9WaWRlbykgewogICAgICAgICAgICBiaXRyYXRlUHJpb3JpdHlbcHJvcC5xdWFsaXR5XSA9IHBhcnNlSW50KHByb3AucXVhbGl0eSk7CiAgICAgICAgICAgIGF1ZGlvTGlzdC5wdXNoKGl0ZW0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHNpemUgPSBzb3J0T3B0aW9ucy5zaXplIHx8IHN0clF1YWxpdHlbcHJvcC5xdWFsaXR5XSB8fCAtMTsKICAgICAgICAgICAgaWYgKHNpemUgPT09IC0xKSB7CiAgICAgICAgICAgICAgaWYgKFN0cmluZyhwcm9wLnF1YWxpdHkpLnN1YnN0cigtMSkgPT09ICdLJykgewogICAgICAgICAgICAgICAgc2l6ZSA9IHBhcnNlSW50KHByb3AucXVhbGl0eSkgKiAxMDAwOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzaXplID0gcGFyc2VJbnQocHJvcC5xdWFsaXR5KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMubWF4U2l6ZSAmJiBzaXplID4gb3B0aW9ucy5tYXhTaXplKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMubWluU2l6ZSAmJiBzaXplIDwgb3B0aW9ucy5taW5TaXplKSB7CiAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2l6ZVByaW9yaXR5W3Byb3AucXVhbGl0eV0gPSBzaXplOwogICAgICAgICAgICBpZiAocHJvcC5ub0F1ZGlvKSB7CiAgICAgICAgICAgICAgaWYgKHByb3Auc0ZwcykgewogICAgICAgICAgICAgICAgbXV0ZTYwTGlzdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtdXRlTGlzdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGlmIChwcm9wWyczZCddKSB7CiAgICAgICAgICAgICAgXzNkTGlzdC5wdXNoKGl0ZW0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRlZkxpc3QucHVzaChpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHZhciBzaXplQ29tcGFyZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBzaXplUHJpb3JpdHlbYS5xdWFsaXR5XSA+IHNpemVQcmlvcml0eVtiLnF1YWxpdHldID8gLTEgOiBzaXplUHJpb3JpdHlbYS5xdWFsaXR5XSA9PT0gc2l6ZVByaW9yaXR5W2IucXVhbGl0eV0gPyAwIDogMTsKICAgICAgICB9OwogICAgICAgIHZhciBiaXRyYXRlQ29tcGFyZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBiaXRyYXRlUHJpb3JpdHlbYS5xdWFsaXR5XSA+IGJpdHJhdGVQcmlvcml0eVtiLnF1YWxpdHldID8gLTEgOiAoYml0cmF0ZVByaW9yaXR5W2EucXVhbGl0eV0gPT09IGJpdHJhdGVQcmlvcml0eVtiLnF1YWxpdHldKSA/IDAgOiAxOwogICAgICAgIH07CiAgICAgICAgdmFyIGZvcm1hdENvbXBhcmUgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICBpZiAoYS5ub1ZpZGVvICYmIGIubm9WaWRlbykgewogICAgICAgICAgICByZXR1cm4gYml0cmF0ZUNvbXBhcmUoYSwgYik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYS5ub1ZpZGVvKSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGIubm9WaWRlbykgewogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZm9ybWF0UHJpb3JpdHkuaW5kZXhPZihhLmZvcm1hdCkgPiBmb3JtYXRQcmlvcml0eS5pbmRleE9mKGIuZm9ybWF0KSA/IC0xIDogZm9ybWF0UHJpb3JpdHkuaW5kZXhPZihhLmZvcm1hdCkgPT09IGZvcm1hdFByaW9yaXR5LmluZGV4T2YoYi5mb3JtYXQpID8gMCA6IDE7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGNvbXBhcmUgPSBmdW5jdGlvbihhYSwgYmIpIHsKICAgICAgICAgIHZhciBhID0gYWEucHJvcDsKICAgICAgICAgIHZhciBiID0gYmIucHJvcDsKICAgICAgICAgIGlmIChvcHRpb25zLm5vUHJvcCkgewogICAgICAgICAgICBhID0gYWE7CiAgICAgICAgICAgIGIgPSBiYjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc2l6ZSA9IHNpemVDb21wYXJlKGEsIGIpOwogICAgICAgICAgaWYgKHNpemUgIT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZm9ybWF0Q29tcGFyZShhLCBiKTsKICAgICAgICB9OwogICAgICAgIGRlZkxpc3Quc29ydChjb21wYXJlKTsKICAgICAgICBfM2RMaXN0LnNvcnQoY29tcGFyZSk7CiAgICAgICAgYXVkaW9MaXN0LnNvcnQoY29tcGFyZSk7CiAgICAgICAgbXV0ZTYwTGlzdC5zb3J0KGNvbXBhcmUpOwogICAgICAgIG11dGVMaXN0LnNvcnQoY29tcGFyZSk7CgogICAgICAgIHZhciByZXNMaXN0ID0gbnVsbDsKICAgICAgICBpZiAob3B0aW9ucy50eXBlTGlzdCkgewogICAgICAgICAgcmVzTGlzdCA9IFtdOwogICAgICAgICAgaWYgKG9wdGlvbnMudHlwZUxpc3QuaW5kZXhPZigndmlkZW8nKSAhPT0gLTEpIHsKICAgICAgICAgICAgcmVzTGlzdCA9IHJlc0xpc3QuY29uY2F0KGRlZkxpc3QpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9wdGlvbnMudHlwZUxpc3QuaW5kZXhPZignM2QnKSAhPT0gLTEpIHsKICAgICAgICAgICAgcmVzTGlzdCA9IHJlc0xpc3QuY29uY2F0KF8zZExpc3QpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9wdGlvbnMudHlwZUxpc3QuaW5kZXhPZignYXVkaW8nKSAhPT0gLTEpIHsKICAgICAgICAgICAgcmVzTGlzdCA9IHJlc0xpc3QuY29uY2F0KGF1ZGlvTGlzdCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0aW9ucy50eXBlTGlzdC5pbmRleE9mKCdtdXRlJykgIT09IC0xKSB7CiAgICAgICAgICAgIHJlc0xpc3QgPSByZXNMaXN0LmNvbmNhdChtdXRlTGlzdCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0aW9ucy50eXBlTGlzdC5pbmRleE9mKCdtdXRlNjAnKSAhPT0gLTEpIHsKICAgICAgICAgICAgcmVzTGlzdCA9IHJlc0xpc3QuY29uY2F0KG11dGU2MExpc3QpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9wdGlvbnMudHlwZUxpc3QuaW5kZXhPZignc3VidGl0bGVzJykgIT09IC0xKSB7CiAgICAgICAgICAgIHJlc0xpc3QgPSByZXNMaXN0LmNvbmNhdChzdWJ0aXRsZUxpc3QpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9wdGlvbnMudHlwZUxpc3QuaW5kZXhPZignb3RoZXInKSAhPT0gLTEpIHsKICAgICAgICAgICAgcmVzTGlzdCA9IHJlc0xpc3QuY29uY2F0KHVua0xpc3QpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNMaXN0ID0gZGVmTGlzdC5jb25jYXQoXzNkTGlzdCwgYXVkaW9MaXN0LCBzdWJ0aXRsZUxpc3QsIG11dGU2MExpc3QsIG11dGVMaXN0LCB1bmtMaXN0KTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuZ3JvdXBDb21wYXJlKSB7CiAgICAgICAgICByZXNMaXN0LnNvcnQoY29tcGFyZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXNMaXN0OwogICAgICB9LAoKICAgICAgcmVtb3ZlUGFuZWw6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLnBvcHVwLnBhcmVudE5vZGUgIT09IG51bGwpIHsKICAgICAgICAgIHRoaXMucG9wdXAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBvcHVwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMucG9wdXBTdHlsZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucG9wdXBTdHlsZS5wYXJlbnROb2RlICE9PSBudWxsKSB7CiAgICAgICAgICB0aGlzLnBvcHVwU3R5bGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBvcHVwU3R5bGUpOwogICAgICAgIH0KICAgICAgICB0aGlzLnBvcHVwID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMucG9wdXBTdHlsZSA9IHVuZGVmaW5lZDsKICAgICAgfSwKCiAgICAgIGdldEhpZGRlbkxpc3Q6IGZ1bmN0aW9uKGhpZGRlbkxpc3QsIG9wdGlvbnMpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICB2YXIgc2Nyb2xsTGlzdEl0ZW1Db3VudCA9IDg7CiAgICAgICAgaWYgKGhpZGRlbkxpc3QubGVuZ3RoIDwgc2Nyb2xsTGlzdEl0ZW1Db3VudCkgewogICAgICAgICAgbW9uby5jcmVhdGUoY29udGVudCwgewogICAgICAgICAgICBhcHBlbmQ6IGhpZGRlbkxpc3QKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgc2Nyb2xsQ29udGFpbmVyID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBtYXhIZWlnaHQ6IChzY3JvbGxMaXN0SXRlbUNvdW50ICogMjQpICsgJ3B4JywKICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdzY3JvbGwnLAogICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJwogICAgICAgICAgICB9LAogICAgICAgICAgICBvbjogWwogICAgICAgICAgICAgIFsnd2hlZWwnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICBpZiAoZS53aGVlbERlbHRhWSA+IDAgJiYgdGhpcy5zY3JvbGxUb3AgPT09IDApIHsKICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBpZiAoZS53aGVlbERlbHRhWSA8IDAgJiYgdGhpcy5zY3JvbGxIZWlnaHQgLSAodGhpcy5vZmZzZXRIZWlnaHQgKyB0aGlzLnNjcm9sbFRvcCkgPD0gMCkgewogICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGhhc1RvcFNoYWRvdyA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIFsnc2Nyb2xsJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjcm9sbFRvcCAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChoYXNUb3BTaGFkb3cpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaGFzVG9wU2hhZG93ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLmJveFNoYWRvdyA9ICdyZ2JhKDAsIDAsIDAsIDAuNDApIC0ycHggMXB4IDJweCAwcHggaW5zZXQnOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICghaGFzVG9wU2hhZG93KSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhc1RvcFNoYWRvdyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuYm94U2hhZG93ID0gJyc7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1dOwogICAgICAgICAgICAgIH0pKCkKICAgICAgICAgICAgXSwKICAgICAgICAgICAgYXBwZW5kOiBoaWRkZW5MaXN0CiAgICAgICAgICB9KTsKICAgICAgICAgIHNjcm9sbENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoX3RoaXMuZGF0YUFycnRWaXNpYmxlLCAnMCcpOwoKICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoc2Nyb2xsQ29udGFpbmVyKTsKICAgICAgICB9CgogICAgICAgIHZhciBzZXBhcmF0b3IgPSBfdGhpcy5jcmVhdGVQb3B1cEl0ZW0oJy0nLCBvcHRpb25zKS5lbDsKICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKHNlcGFyYXRvcik7CgogICAgICAgIHZhciBtb3JlSXRlbSA9IF90aGlzLmNyZWF0ZVBvcHVwSXRlbSgnIycsIG9wdGlvbnMpLmVsOwogICAgICAgIG1vbm8uY3JlYXRlKG1vcmVJdGVtLCB7CiAgICAgICAgICB0ZXh0OiBtb25vLmdsb2JhbC5sYW5ndWFnZS5tb3JlICsgJyAnICsgU3RyaW5nLmZyb21DaGFyQ29kZSgxODcpLCAvLzE3MSAvLzE2MCAtIHNwYWNlCiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgIHZpc2libGU6ICcwJwogICAgICAgICAgfSwKICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHRoaXMuZGF0YXNldC52aXNpYmxlOwogICAgICAgICAgICB2YXIgc3ltYm9sOwogICAgICAgICAgICBpZiAoc3RhdGUgPiAwKSB7CiAgICAgICAgICAgICAgc3RhdGUtLTsKICAgICAgICAgICAgICBzeW1ib2wgPSAxODc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RhdGUrKzsKICAgICAgICAgICAgICBzeW1ib2wgPSAxNzE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy50ZXh0Q29udGVudCA9IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLm1vcmUgKyAnICcgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKHN5bWJvbCk7CiAgICAgICAgICAgIHRoaXMuZGF0YXNldC52aXNpYmxlID0gc3RhdGU7CiAgICAgICAgICAgIHZhciBpdGVtTGlzdCA9IHRoaXMucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKCcqWycgKyBfdGhpcy5kYXRhQXJydFZpc2libGUgKyAnXScpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGl0ZW1MaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaXRlbS5zZXRBdHRyaWJ1dGUoX3RoaXMuZGF0YUFycnRWaXNpYmxlLCBzdGF0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChtb3JlSXRlbSk7CgogICAgICAgIGlmIChvcHRpb25zLnZpc2libGVDb3VudCA9PT0gMCkgewogICAgICAgICAgbW9uby50cmlnZ2VyKG1vcmVJdGVtLCAnY2xpY2snLCB7CiAgICAgICAgICAgIGNhbmNlbGFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7CiAgICAgIH0sCgogICAgICBnZXRDb250ZW50OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIGxpbmtzID0gb3B0aW9ucy5saW5rczsKCiAgICAgICAgdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CgogICAgICAgIHZhciBzaXplSWNvbkxpc3QgPSBbXTsKCiAgICAgICAgaWYgKHR5cGVvZihsaW5rcykgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICB2YXIgbG9hZGluZ0l0ZW0gPSBfdGhpcy5jcmVhdGVQb3B1cEl0ZW0oJy10ZXh0LScsIG9wdGlvbnMpLmVsOwogICAgICAgICAgbG9hZGluZ0l0ZW0udGV4dENvbnRlbnQgPSBsaW5rczsKICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQobG9hZGluZ0l0ZW0pOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChsaW5rcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHZhciBlbXB0eUl0ZW0gPSBfdGhpcy5jcmVhdGVQb3B1cEl0ZW0oJy10ZXh0LScsIG9wdGlvbnMpLmVsOwogICAgICAgICAgZW1wdHlJdGVtLnRleHRDb250ZW50ID0gbW9uby5nbG9iYWwubGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kOwogICAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChlbXB0eUl0ZW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgaXRlbXMgPSBbXTsKICAgICAgICAgIGxpbmtzLmZvckVhY2goZnVuY3Rpb24obGluaykgewogICAgICAgICAgICBpdGVtcy5wdXNoKF90aGlzLmNyZWF0ZVBvcHVwSXRlbShsaW5rLCBvcHRpb25zKSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpdGVtcyA9IF90aGlzLnNvcnRNZW51SXRlbXMoaXRlbXMsIG9wdGlvbnMuc29ydERldGFpbHMpOwoKICAgICAgICAgIHZhciBoaWRkZW5MaXN0ID0gW107CgogICAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgIGlmIChpdGVtLnByb3AuaXNIaWRkZW4pIHsKICAgICAgICAgICAgICBoaWRkZW5MaXN0LnB1c2goaXRlbS5lbCk7CiAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoaXRlbS5lbCk7CgogICAgICAgICAgICBpZiAob3B0aW9ucy5zaG93RmlsZVNpemUgJiYgaXRlbS5zaXplSWNvbikgewogICAgICAgICAgICAgIHNpemVJY29uTGlzdC5wdXNoKGl0ZW0uc2l6ZUljb24pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBvcHRpb25zLnZpc2libGVDb3VudCA9IGl0ZW1zLmxlbmd0aCAtIGhpZGRlbkxpc3QubGVuZ3RoOwoKICAgICAgICAgIGlmIChoaWRkZW5MaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0SGlkZGVuTGlzdEZ1bmMpIHsKICAgICAgICAgICAgICBjb250ZW50LmFwcGVuZENoaWxkKG9wdGlvbnMuZ2V0SGlkZGVuTGlzdEZ1bmMoaGlkZGVuTGlzdCwgb3B0aW9ucykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQoX3RoaXMuZ2V0SGlkZGVuTGlzdChoaWRkZW5MaXN0LCBvcHRpb25zKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBzaXplSWNvbkxpc3Q6IHNpemVJY29uTGlzdCwKICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQKICAgICAgICB9OwogICAgICB9LAoKICAgICAgY3JlYXRlOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgdmFyIGJ1dHRvbiA9IG9wdGlvbnMuYnV0dG9uOwogICAgICAgIHZhciBfdGhpcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudTsKCiAgICAgICAgb3B0aW9ucy5saW5rQ2xhc3MgPSBvcHRpb25zLmxpbmtDbGFzcyB8fCAnc2YtbWVudS1pdGVtJzsKCiAgICAgICAgb3B0aW9ucy5vZmZzZXRSaWdodCA9IG9wdGlvbnMub2Zmc2V0UmlnaHQgfHwgMDsKICAgICAgICBvcHRpb25zLm9mZnNldFRvcCA9IG9wdGlvbnMub2Zmc2V0VG9wIHx8IDA7CgogICAgICAgIG9wdGlvbnMucGFyZW50ID0gb3B0aW9ucy5wYXJlbnQgfHwgZG9jdW1lbnQuYm9keTsKCiAgICAgICAgaWYgKG9wdGlvbnMuaXNVcGRhdGUgJiYgKF90aGlzLnBvcHVwID09PSB1bmRlZmluZWQgfHwgX3RoaXMucG9wdXAuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF90aGlzLnBvcHVwKSB7CiAgICAgICAgICBfdGhpcy5yZW1vdmVQYW5lbCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBvcHVwQ29udGFpbmVyID0gX3RoaXMucG9wdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB2YXIgY29udGFpbmVyU2VsZWN0b3IgPSAnIycgKyBfdGhpcy5wb3B1cElkOwogICAgICAgIGlmIChvcHRpb25zLnBvcHVwSWQpIHsKICAgICAgICAgIGNvbnRhaW5lclNlbGVjdG9yID0gJyMnICsgb3B0aW9ucy5wb3B1cElkOwogICAgICAgICAgcG9wdXBDb250YWluZXIuaWQgPSBvcHRpb25zLnBvcHVwSWQ7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKG9wdGlvbnMuY29udGFpbmVyQ2xhc3MpIHsKICAgICAgICAgIGNvbnRhaW5lclNlbGVjdG9yID0gJy4nICsgb3B0aW9ucy5jb250YWluZXJDbGFzczsKICAgICAgICAgIHBvcHVwQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQob3B0aW9ucy5jb250YWluZXJDbGFzcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBvcHVwQ29udGFpbmVyLmlkID0gX3RoaXMucG9wdXBJZDsKICAgICAgICB9CgogICAgICAgIHZhciBwb3B1cENvbnRhaW5lclN0eWxlID0gewogICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgbWluSGVpZ2h0OiAnMjRweCcsCiAgICAgICAgICBjdXJzb3I6ICdkZWZhdWx0JywKICAgICAgICAgIHRleHRBbGlnbjogJ2xlZnQnLAogICAgICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcsCiAgICAgICAgICBmb250RmFtaWx5OiAnYXJpYWwsIHNhbnMtc2VyaWYnCiAgICAgICAgfTsKICAgICAgICBpZiAob3B0aW9ucy5leHRTdHlsZSkgewogICAgICAgICAgZGVsZXRlIHBvcHVwQ29udGFpbmVyU3R5bGUuZGlzcGxheTsKICAgICAgICB9CgogICAgICAgIHZhciBwb3MgPSBTYXZlRnJvbV9VdGlscy5nZXRQb3NpdGlvbihidXR0b24sIG9wdGlvbnMucGFyZW50KSwKICAgICAgICAgIHNpemUgPSBTYXZlRnJvbV9VdGlscy5nZXRTaXplKGJ1dHRvbik7CgogICAgICAgIHBvcHVwQ29udGFpbmVyU3R5bGUudG9wID0gKHBvcy50b3AgKyBvcHRpb25zLm9mZnNldFRvcCArIHNpemUuaGVpZ2h0KSArICdweCc7CiAgICAgICAgcG9wdXBDb250YWluZXJTdHlsZS5sZWZ0ID0gKHBvcy5sZWZ0ICsgb3B0aW9ucy5vZmZzZXRSaWdodCkgKyAncHgnOwogICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKHBvcHVwQ29udGFpbmVyLCBwb3B1cENvbnRhaW5lclN0eWxlKTsKCiAgICAgICAgdmFyIHBvcHVwQ3VzdG9tQ29udGFpbmVyU3R5bGUgPSB7CiAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6ICcjZmZmJywKICAgICAgICAgICd6LWluZGV4JzogJzk5OTknLAogICAgICAgICAgJ2JveC1zaGFkb3cnOiAnMCAycHggMTBweCAwIHJnYmEoMCwwLDAsMC4yKScsCiAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI2NjYycsCiAgICAgICAgICAnYm9yZGVyLXJhZGl1cyc6ICczcHgnLAogICAgICAgICAgJ2ZvbnQtc2l6ZSc6ICcxMnB4JywKICAgICAgICAgICdmb250LXdlaWdodCc6ICdib2xkJywKICAgICAgICAgICdtaW4td2lkdGgnOiAnMTkwcHgnCiAgICAgICAgfTsKCiAgICAgICAgaWYgKG9wdGlvbnMuc3R5bGUgJiYgb3B0aW9ucy5zdHlsZS5wb3B1cCkgewogICAgICAgICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMuc3R5bGUucG9wdXApIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gb3B0aW9ucy5zdHlsZS5wb3B1cFtrZXldOwogICAgICAgICAgICBwb3B1cEN1c3RvbUNvbnRhaW5lclN0eWxlW2tleV0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFNhdmVGcm9tX1V0aWxzLmFkZFN0eWxlUnVsZXMoY29udGFpbmVyU2VsZWN0b3IsIHBvcHVwQ3VzdG9tQ29udGFpbmVyU3R5bGUpOwoKICAgICAgICB2YXIgaXRlbUN1c3RvbVN0eWxlID0gewogICAgICAgICAgJ2xpbmUtaGVpZ2h0JzogJzI0cHgnLAogICAgICAgICAgY29sb3I6ICcjM0QzRDNEJwogICAgICAgIH07CgogICAgICAgIGlmIChvcHRpb25zLnN0eWxlICYmIG9wdGlvbnMuc3R5bGUuaXRlbSkgewogICAgICAgICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMuc3R5bGUuaXRlbSkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBvcHRpb25zLnN0eWxlLml0ZW1ba2V5XTsKICAgICAgICAgICAgaXRlbUN1c3RvbVN0eWxlW2tleV0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFNhdmVGcm9tX1V0aWxzLmFkZFN0eWxlUnVsZXMoY29udGFpbmVyU2VsZWN0b3IgKyAnIC4nICsgb3B0aW9ucy5saW5rQ2xhc3MsIGl0ZW1DdXN0b21TdHlsZSk7CgogICAgICAgIHZhciBzdG9wUHJvcGFnYXRpb25GdW5jID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKQogICAgICAgIH07CiAgICAgICAgbW9uby5jcmVhdGUocG9wdXBDb250YWluZXIsIHsKICAgICAgICAgIG9uOiBbCiAgICAgICAgICAgIFsnY2xpY2snLCBzdG9wUHJvcGFnYXRpb25GdW5jXSwKICAgICAgICAgICAgWydtb3VzZW92ZXInLCBzdG9wUHJvcGFnYXRpb25GdW5jXSwKICAgICAgICAgICAgWydtb3VzZXVwJywgc3RvcFByb3BhZ2F0aW9uRnVuY10sCiAgICAgICAgICAgIFsnbW91c2Vkb3duJywgc3RvcFByb3BhZ2F0aW9uRnVuY10sCiAgICAgICAgICAgIFsnbW91c2VvdXQnLCBzdG9wUHJvcGFnYXRpb25GdW5jXQogICAgICAgICAgXQogICAgICAgIH0pOwoKICAgICAgICB3aGlsZSAocG9wdXBDb250YWluZXIuZmlyc3RDaGlsZCAhPT0gbnVsbCkgewogICAgICAgICAgcG9wdXBDb250YWluZXIucmVtb3ZlQ2hpbGQocG9wdXBDb250YWluZXIuZmlyc3RDaGlsZCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbWVudUNvbnRlbnQgPSBfdGhpcy5nZXRDb250ZW50LmNhbGwoX3RoaXMsIG9wdGlvbnMpOwogICAgICAgIHZhciBzaXplSWNvbkxpc3QgPSBtZW51Q29udGVudC5zaXplSWNvbkxpc3Q7CiAgICAgICAgbWVudUNvbnRlbnQgPSBtZW51Q29udGVudC5jb250ZW50OwogICAgICAgIHBvcHVwQ29udGFpbmVyLmFwcGVuZENoaWxkKG1lbnVDb250ZW50KTsKCgogICAgICAgIHZhciBob3ZlckJnQ29sb3IgPSAnIzJGOEFGRic7CiAgICAgICAgdmFyIGhvdmVyVGV4dENvbG9yID0gJyNmZmYnOwogICAgICAgIGlmIChvcHRpb25zLnN0eWxlICYmIG9wdGlvbnMuc3R5bGUuaG92ZXIpIHsKICAgICAgICAgIGhvdmVyQmdDb2xvciA9IG9wdGlvbnMuc3R5bGUuaG92ZXIuYmFja2dyb3VuZENvbG9yIHx8IGhvdmVyQmdDb2xvcjsKICAgICAgICAgIGhvdmVyVGV4dENvbG9yID0gb3B0aW9ucy5zdHlsZS5ob3Zlci5jb2xvciB8fCBob3ZlclRleHRDb2xvcjsKICAgICAgICB9CiAgICAgICAgdmFyIHN0eWxlRWwgPSBfdGhpcy5wb3B1cFN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICBzdHlsZUVsLnRleHRDb250ZW50ID0gbW9uby5zdHlsZTJUZXh0KHsKICAgICAgICAgIHNlbGVjdG9yOiBjb250YWluZXJTZWxlY3RvciwKICAgICAgICAgIGFwcGVuZDogewogICAgICAgICAgICAnYTpob3Zlcic6IHsKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGhvdmVyQmdDb2xvciwKICAgICAgICAgICAgICBjb2xvcjogaG92ZXJUZXh0Q29sb3IKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJz4gYTpmaXJzdC1jaGlsZCc6IHsKICAgICAgICAgICAgICBib3JkZXJUb3BMZWZ0UmFkaXVzOiAnM3B4JywKICAgICAgICAgICAgICBib3JkZXJUb3BSaWdodFJhZGl1czogJzNweCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJz4gYTpsYXN0LWNoaWxkJzogewogICAgICAgICAgICAgIGJvcmRlckJvdHRvbUxlZnRSYWRpdXM6ICczcHgnLAogICAgICAgICAgICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzOiAnM3B4JwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG9wdGlvbnMucGFyZW50LmFwcGVuZENoaWxkKHN0eWxlRWwpOwogICAgICAgIG9wdGlvbnMucGFyZW50LmFwcGVuZENoaWxkKHBvcHVwQ29udGFpbmVyKTsKICAgICAgICBpZiAob3B0aW9ucy5leHRTdHlsZSkgewogICAgICAgICAgaWYgKFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5leHRTdHlsZUNhY2hlICE9PSB1bmRlZmluZWQgJiYgU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LmV4dFN0eWxlQ2FjaGUucGFyZW50Tm9kZSAhPT0gbnVsbCkgewogICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUuZXh0U3R5bGVDYWNoZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5leHRTdHlsZUNhY2hlKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZXh0RWxDbGFzc05hbWUgPSAnc2YtZXh0RWxTdHlsZV8nICsgY29udGFpbmVyU2VsZWN0b3Iuc3Vic3RyKDEpOwogICAgICAgICAgdmFyIGV4dEJvZHlDbGFzc05hbWUgPSAnc2YtZXh0Qm9keVN0eWxlXycgKyBjb250YWluZXJTZWxlY3Rvci5zdWJzdHIoMSk7CiAgICAgICAgICB2YXIgZXh0Qm9keVN0eWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc3R5bGUuJyArIGV4dEJvZHlDbGFzc05hbWUpOwogICAgICAgICAgaWYgKGV4dEJvZHlTdHlsZSA9PT0gbnVsbCkgewogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgICAgICBjbGFzczogZXh0Qm9keUNsYXNzTmFtZSwKICAgICAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoewogICAgICAgICAgICAgICAgc2VsZWN0b3I6IGNvbnRhaW5lclNlbGVjdG9yLAogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQogICAgICAgICAgU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LmV4dFN0eWxlQ2FjaGUgPSBvcHRpb25zLmV4dFN0eWxlLmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgICAgY2xhc3M6IGV4dEVsQ2xhc3NOYW1lLAogICAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoewogICAgICAgICAgICAgIHNlbGVjdG9yOiAnYm9keSAnICsgY29udGFpbmVyU2VsZWN0b3IsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgc2l6ZUljb25MaXN0LmZvckVhY2goZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgICBtb25vLnRyaWdnZXIoaWNvbiwgJ2NsaWNrJywgewogICAgICAgICAgICAgIGJ1YmJsZXM6IGZhbHNlLAogICAgICAgICAgICAgIGNhbmNlbGFibGU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHBvcHVwQ29udGFpbmVyOwogICAgICB9LAoKICAgICAgdXBkYXRlOiBmdW5jdGlvbihwb3B1cENvbnRhaW5lciwgb3B0aW9ucykgewogICAgICAgIHZhciBfdGhpcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudTsKCiAgICAgICAgd2hpbGUgKHBvcHVwQ29udGFpbmVyLmZpcnN0Q2hpbGQgIT09IG51bGwpIHsKICAgICAgICAgIHBvcHVwQ29udGFpbmVyLnJlbW92ZUNoaWxkKHBvcHVwQ29udGFpbmVyLmZpcnN0Q2hpbGQpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1lbnVDb250ZW50ID0gX3RoaXMuZ2V0Q29udGVudC5jYWxsKF90aGlzLCBvcHRpb25zKTsKICAgICAgICB2YXIgc2l6ZUljb25MaXN0ID0gbWVudUNvbnRlbnQuc2l6ZUljb25MaXN0OwogICAgICAgIG1lbnVDb250ZW50ID0gbWVudUNvbnRlbnQuY29udGVudDsKICAgICAgICBwb3B1cENvbnRhaW5lci5hcHBlbmRDaGlsZChtZW51Q29udGVudCk7CgogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICBzaXplSWNvbkxpc3QuZm9yRWFjaChmdW5jdGlvbihpY29uKSB7CiAgICAgICAgICAgIG1vbm8udHJpZ2dlcihpY29uLCAnY2xpY2snLCB7CiAgICAgICAgICAgICAgYnViYmxlczogZmFsc2UsCiAgICAgICAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgcHJlcHJvY2Vzc0l0ZW06IHsKICAgICAgICBzcnQydXJsOiBmdW5jdGlvbihpdGVtLCBwb3B1cExpbmspIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIHZhciBzcnQgPSBpdGVtLnNydDsKICAgICAgICAgIHZhciBibG9iVXJsID0gbnVsbDsKCiAgICAgICAgICBpZiAodHlwZW9mIFVSTCAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIEJsb2IgIT09ICJ1bmRlZmluZWQiICYmICFtb25vLmlzU2FmYXJpKSB7CiAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW3NydF0sIHsKICAgICAgICAgICAgICBlbmNvZGluZzogIlVURi04IiwKICAgICAgICAgICAgICB0eXBlOiAndGV4dC9wbGFpbicKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHNydFVURjggPSBTYXZlRnJvbV9VdGlscy51dGY4RW5jb2RlKHNydCk7CiAgICAgICAgICAgIGJsb2JVcmwgPSAnZGF0YTp0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LCcgKyBlbmNvZGVVUklDb21wb25lbnQoYnRvYShzcnRVVEY4KSkKICAgICAgICAgIH0KCiAgICAgICAgICBwb3B1cExpbmsuZXh0ID0gJ3NydCc7CiAgICAgICAgICBwb3B1cExpbmsuZm9ybWF0ID0gJ1NSVCc7CiAgICAgICAgICBwb3B1cExpbmsuaHJlZiA9IGJsb2JVcmw7CiAgICAgICAgICBwb3B1cExpbmsubm9TaXplID0gdHJ1ZTsKICAgICAgICAgIGlmIChtb25vLmlzT3BlcmEgfHwgbW9uby5pc0ZGKSB7CiAgICAgICAgICAgIHBvcHVwTGluay5mb3JjZURvd25sb2FkID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKICAgICAgcHJlcGFyZUxpbmtzOiB7CiAgICAgICAgeW91dHViZTogZnVuY3Rpb24obGlua3MsIHRpdGxlLCBzdWJ0aXRsZXMsIGRldGFpbHMpIHsKICAgICAgICAgIGRldGFpbHMgPSBkZXRhaWxzIHx8IHt9OwogICAgICAgICAgc3VidGl0bGVzID0gc3VidGl0bGVzIHx8IFtdOwogICAgICAgICAgbGlua3MgPSBtb25vLmV4dGVuZCh7fSwgbGlua3MpOwogICAgICAgICAgdmFyIHNmVXRpbHNZdCA9IFNhdmVGcm9tX1V0aWxzLnZpZGVvLnl0OwogICAgICAgICAgc2ZVdGlsc1l0LmluaXQoKTsKCiAgICAgICAgICB2YXIgbWVudUxpbmtzID0gW107CiAgICAgICAgICB2YXIgcG9wdXBMaW5rID0gbnVsbDsKICAgICAgICAgIHZhciBtZXRhID0gbGlua3MubWV0YSB8fCB7fTsKCiAgICAgICAgICBPYmplY3Qua2V5cyhzZlV0aWxzWXQuZm9ybWF0KS5mb3JFYWNoKGZ1bmN0aW9uKGZvcm1hdCkgewogICAgICAgICAgICB2YXIgZm9ybWF0T2JqID0gc2ZVdGlsc1l0LmZvcm1hdFtmb3JtYXRdOwogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMoZm9ybWF0T2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGl0YWcpIHsKICAgICAgICAgICAgICB2YXIgdXJsID0gbGlua3NbaXRhZ107CiAgICAgICAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBpc0hpZGRlbiA9IGZhbHNlOwoKICAgICAgICAgICAgICBpZiAoIXNmVXRpbHNZdC5zaG93Rm9ybWF0W2Zvcm1hdF0pIHsKICAgICAgICAgICAgICAgIGlzSGlkZGVuID0gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwcm9wID0gZm9ybWF0T2JqW2l0YWddOwoKICAgICAgICAgICAgICBpZiAocHJvcFsnM2QnXSAmJiAhc2ZVdGlsc1l0LnNob3czRCkgewogICAgICAgICAgICAgICAgaXNIaWRkZW4gPSB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHByb3Aubm9BdWRpbyAmJiAhc2ZVdGlsc1l0LnNob3dNUDROb0F1ZGlvKSB7CiAgICAgICAgICAgICAgICBpc0hpZGRlbiA9IHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwb3B1cExpbmsgPSB7CiAgICAgICAgICAgICAgICBocmVmOiB1cmwsCiAgICAgICAgICAgICAgICBpc0hpZGRlbjogaXNIaWRkZW4sCiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdCwKICAgICAgICAgICAgICAgIGl0YWc6IGl0YWcKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBtb25vLmV4dGVuZChwb3B1cExpbmssIHByb3ApOwoKICAgICAgICAgICAgICB2YXIgbWV0YVRhZyA9IG1ldGFbaXRhZ107CiAgICAgICAgICAgICAgaWYgKG1ldGFUYWcpIHsKICAgICAgICAgICAgICAgIGlmIChtZXRhVGFnLnF1YWxpdHkpIHsKICAgICAgICAgICAgICAgICAgcG9wdXBMaW5rLnF1YWxpdHkgPSBtZXRhVGFnLnF1YWxpdHk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKG1ldGFUYWcuZnBzKSB7CiAgICAgICAgICAgICAgICAgIHBvcHVwTGluay5mcHMgPSBtZXRhVGFnLmZwczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChwcm9wLm5vVmlkZW8gfHwgcHJvcC5ub0F1ZGlvKSB7CiAgICAgICAgICAgICAgICBwb3B1cExpbmsuZm9yY2VEb3dubG9hZCA9IHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZW51TGlua3MucHVzaChwb3B1cExpbmspOwogICAgICAgICAgICAgIGRlbGV0ZSBsaW5rc1tpdGFnXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKCgogICAgICAgICAgKGxpbmtzLnVtbXkgfHwgbGlua3MudW1teUF1ZGlvKSAmJiAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBxdWFsaXR5QmFkZ2UgPSBudWxsOwogICAgICAgICAgICB2YXIgcXVhbGl0eUluZGV4ID0gLTE7CiAgICAgICAgICAgIHZhciBiYWRnZVF1YWxpdHlMaXN0ID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LmJhZGdlUXVhbGl0eUxpc3Q7CiAgICAgICAgICAgIG1lbnVMaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKHBvcHVwTGluaykgewogICAgICAgICAgICAgIHZhciBxSW5kZXggPSBiYWRnZVF1YWxpdHlMaXN0LmluZGV4T2YocG9wdXBMaW5rLnF1YWxpdHkpOwogICAgICAgICAgICAgIGlmIChxSW5kZXggIT09IC0xICYmIChxdWFsaXR5SW5kZXggPT09IC0xIHx8IHFJbmRleCA8IHF1YWxpdHlJbmRleCkpIHsKICAgICAgICAgICAgICAgIHF1YWxpdHlJbmRleCA9IHFJbmRleDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAocXVhbGl0eUluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgIHF1YWxpdHlCYWRnZSA9IGJhZGdlUXVhbGl0eUxpc3RbcXVhbGl0eUluZGV4XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHZpZGVvSWQgPSBtZXRhLnZpZGVvSWQ7CiAgICAgICAgICAgIHZpZGVvSWQgJiYgWyd1bW15JywgJ3VtbXlBdWRpbyddLmZvckVhY2goZnVuY3Rpb24oaXRhZykgewogICAgICAgICAgICAgIHZhciB1cmwgPSBsaW5rc1tpdGFnXTsKICAgICAgICAgICAgICBpZiAoIXVybCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcG9wdXBMaW5rID0gewogICAgICAgICAgICAgICAgaHJlZjogdXJsLAogICAgICAgICAgICAgICAgcXVhbGl0eTogJ3VtbXknLAogICAgICAgICAgICAgICAgbm9TaXplOiB0cnVlLAogICAgICAgICAgICAgICAgZm9ybWF0OiAndW1teScsCiAgICAgICAgICAgICAgICB2aWRlb0lkOiAneXQtJyArIHZpZGVvSWQKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoaXRhZyA9PT0gJ3VtbXknKSB7CiAgICAgICAgICAgICAgICBwb3B1cExpbmsuaXRhZyA9ICd1bW15JzsKICAgICAgICAgICAgICAgIHBvcHVwTGluay51UXVhbGl0eSA9IHF1YWxpdHlCYWRnZTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBpZiAoaXRhZyA9PT0gJ3VtbXlBdWRpbycpIHsKICAgICAgICAgICAgICAgIHBvcHVwTGluay5pdGFnID0gJ3VtbXlBdWRpbyc7CiAgICAgICAgICAgICAgICBwb3B1cExpbmsudVF1YWxpdHkgPSAnbXAzJzsKICAgICAgICAgICAgICAgIHBvcHVwTGluay51SXNBdWRpbyA9IHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZGV0YWlscy51bW15VmlkKSB7CiAgICAgICAgICAgICAgICBwb3B1cExpbmsudmlkID0gZGV0YWlscy51bW15VmlkOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbWVudUxpbmtzLnB1c2gocG9wdXBMaW5rKTsKICAgICAgICAgICAgICBkZWxldGUgbGlua3NbaXRhZ107CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkoKTsKCiAgICAgICAgICBPYmplY3Qua2V5cyhsaW5rcykuZm9yRWFjaChmdW5jdGlvbihpdGFnKSB7CiAgICAgICAgICAgIGlmIChpdGFnID09PSAnbWV0YScpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBvcHVwTGluayA9IHsKICAgICAgICAgICAgICBocmVmOiBsaW5rc1tpdGFnXSwKICAgICAgICAgICAgICBpc0hpZGRlbjogdHJ1ZSwKICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgcXVhbGl0eTogaXRhZywKICAgICAgICAgICAgICBpdGFnOiBpdGFnLAogICAgICAgICAgICAgIGZvcmNlRG93bmxvYWQ6IHRydWUKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIG1lbnVMaW5rcy5wdXNoKHBvcHVwTGluayk7CiAgICAgICAgICAgIGRlbGV0ZSBsaW5rc1tpdGFnXTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHN1YnRpdGxlcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgICBwb3B1cExpbmsgPSB7CiAgICAgICAgICAgICAgaHJlZjogaXRlbS51cmwsCiAgICAgICAgICAgICAgaXNIaWRkZW46IHRydWUsCiAgICAgICAgICAgICAgcXVhbGl0eTogJ1NSVCcgKyAoaXRlbS5pc0F1dG8gPyAnQScgOiAnJyksCiAgICAgICAgICAgICAgaXRlbVRleHQ6IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLnN1YnRpdGxlcyArICcgKCcgKyBpdGVtLmxhbmcgKyAnKScsCiAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlICsgJy0nICsgaXRlbS5sYW5nQ29kZSwKICAgICAgICAgICAgICBleHQ6ICd2dHQnLAogICAgICAgICAgICAgIGZvcm1hdDogJ1ZUVCcsCiAgICAgICAgICAgICAgaXNTdWJ0aXRsZTogdHJ1ZSwKICAgICAgICAgICAgICBsYW5nQ29kZTogaXRlbS5sYW5nQ29kZSwKICAgICAgICAgICAgICBmb3JjZURvd25sb2FkOiB0cnVlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoaXRlbS5wcmVwcm9jZXNzID09PSAnc3J0MnVybCcpIHsKICAgICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcHJvY2Vzc0l0ZW0uc3J0MnVybChpdGVtLCBwb3B1cExpbmspOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtZW51TGlua3MucHVzaChwb3B1cExpbmspOwogICAgICAgICAgfSk7CgogICAgICAgICAgbWV0YS5leHRyYSAmJiBtZXRhLmV4dHJhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICBwb3B1cExpbmsgPSB7CiAgICAgICAgICAgICAgaHJlZjogJyMnICsgaXRlbS5leHRyYSwKICAgICAgICAgICAgICBub1NpemU6IHRydWUsCiAgICAgICAgICAgICAgaXNIaWRkZW46IGZhbHNlCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBtb25vLmV4dGVuZChwb3B1cExpbmssIGl0ZW0pOwoKICAgICAgICAgICAgaWYgKGl0ZW0uaXRhZykgewogICAgICAgICAgICAgIE9iamVjdC5rZXlzKHNmVXRpbHNZdC5mb3JtYXQpLnNvbWUoZnVuY3Rpb24oZm9ybWF0KSB7CiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0T2JqID0gc2ZVdGlsc1l0LmZvcm1hdFtmb3JtYXRdOwogICAgICAgICAgICAgICAgdmFyIHByb3AgPSBmb3JtYXRPYmpbaXRlbS5pdGFnXTsKICAgICAgICAgICAgICAgIGlmIChwcm9wKSB7CiAgICAgICAgICAgICAgICAgIG1vbm8uZXh0ZW5kKHBvcHVwTGluaywgcHJvcCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXRlbS5yZXF1ZXN0KSB7CiAgICAgICAgICAgICAgcG9wdXBMaW5rLmZ1bmMgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbW9uby5zZW5kTWVzc2FnZShpdGVtLnJlcXVlc3QpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBvcHVwTGluay5ub0F1ZGlvID0gZmFsc2U7CgogICAgICAgICAgICBtZW51TGlua3MucHVzaChwb3B1cExpbmspOwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIG1lbnVMaW5rczsKICAgICAgICB9LAogICAgICAgIHZpbWVvOiBmdW5jdGlvbihsaW5rcywgdGl0bGUpIHsKICAgICAgICAgIHZhciBtZW51TGlua3MgPSBbXTsKICAgICAgICAgIHZhciBwb3B1cExpbms7CiAgICAgICAgICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHsKICAgICAgICAgICAgdmFyIGV4dCA9IGxpbmsuZXh0OwogICAgICAgICAgICBpZiAoIWV4dCkgewogICAgICAgICAgICAgIGV4dCA9ICdtcDQnOwogICAgICAgICAgICAgIGlmIChsaW5rLnVybC5zZWFyY2goL1wuZmx2KCR8XD8pL2kpICE9IC0xKSB7CiAgICAgICAgICAgICAgICBleHQgPSAnZmx2JzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHF1YWxpdHkgPSBsaW5rLmhlaWdodCB8fCAnJzsKICAgICAgICAgICAgdmFyIGZvcm1hdCA9IGxpbmsudHlwZTsKICAgICAgICAgICAgcG9wdXBMaW5rID0gewogICAgICAgICAgICAgIGhyZWY6IGxpbmsudXJsLAogICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgICBleHQ6IGV4dCwKICAgICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdCwKICAgICAgICAgICAgICBxdWFsaXR5OiBxdWFsaXR5LAogICAgICAgICAgICAgIGZvcmNlRG93bmxvYWQ6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbWVudUxpbmtzLnB1c2gocG9wdXBMaW5rKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIG1lbnVMaW5rczsKICAgICAgICB9LAogICAgICAgIHZrOiBmdW5jdGlvbihsaW5rcywgdGl0bGUpIHsKICAgICAgICAgIHZhciBtZW51TGlua3MgPSBbXTsKICAgICAgICAgIHZhciBwb3B1cExpbms7CiAgICAgICAgICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHsKICAgICAgICAgICAgdmFyIGV4dCA9IGxpbmsubmFtZSB8fCBsaW5rLmV4dDsKICAgICAgICAgICAgdmFyIGZvcm1hdCA9IGV4dCAmJiBleHQudG9VcHBlckNhc2UoKSB8fCAnJzsKICAgICAgICAgICAgdmFyIHF1YWxpdHkgPSBsaW5rLnN1Ym5hbWUgfHwgJyc7CiAgICAgICAgICAgIHBvcHVwTGluayA9IHsKICAgICAgICAgICAgICBocmVmOiBsaW5rLnVybCwKICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgZXh0OiBleHQsCiAgICAgICAgICAgICAgZm9ybWF0OiBmb3JtYXQsCiAgICAgICAgICAgICAgcXVhbGl0eTogcXVhbGl0eSwKICAgICAgICAgICAgICBmb3JjZURvd25sb2FkOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG1lbnVMaW5rcy5wdXNoKHBvcHVwTGluayk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBtZW51TGlua3M7CiAgICAgICAgfSwKICAgICAgICBkYWlseW1vdGlvbjogZnVuY3Rpb24obGlua3MsIHRpdGxlKSB7CiAgICAgICAgICB2YXIgbWVudUxpbmtzID0gW107CgogICAgICAgICAgbGlua3MuZm9yRWFjaChmdW5jdGlvbihsaW5rKSB7CiAgICAgICAgICAgIHZhciBwb3B1cExpbmsgPSBudWxsOwogICAgICAgICAgICBpZiAobGluay5leHRyYSA9PT0gJ3VtbXknKSB7CiAgICAgICAgICAgICAgcG9wdXBMaW5rID0gewogICAgICAgICAgICAgICAgaHJlZjogbGluay51cmwsCiAgICAgICAgICAgICAgICBxdWFsaXR5OiAndW1teScsCiAgICAgICAgICAgICAgICBub1NpemU6IHRydWUsCiAgICAgICAgICAgICAgICBmb3JtYXQ6ICd1bW15JywKICAgICAgICAgICAgICAgIHZpZGVvSWQ6IGxpbmsudmlkZW9JZCwKICAgICAgICAgICAgICAgIHNvcnQ6IHsKICAgICAgICAgICAgICAgICAgc2l6ZTogNDgwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKGxpbmsudHlwZSA9PT0gJ3VtbXlBdWRpbycpIHsKICAgICAgICAgICAgICAgIHBvcHVwTGluay51UXVhbGl0eSA9ICdtcDMnOwogICAgICAgICAgICAgICAgcG9wdXBMaW5rLnVJc0F1ZGlvID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcG9wdXBMaW5rID0gewogICAgICAgICAgICAgICAgaHJlZjogbGluay51cmwsCiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgICBleHQ6IGxpbmsuZXh0LAogICAgICAgICAgICAgICAgZm9ybWF0OiBsaW5rLmV4dCwKICAgICAgICAgICAgICAgIHF1YWxpdHk6IGxpbmsuaGVpZ2h0IHx8ICcnLAogICAgICAgICAgICAgICAgZm9yY2VEb3dubG9hZDogdHJ1ZQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmIChtb25vLmlzT3BlcmEpIHsKICAgICAgICAgICAgICAgIHBvcHVwTGluay5ub1NpemUgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWVudUxpbmtzLnB1c2gocG9wdXBMaW5rKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiBtZW51TGlua3M7CiAgICAgICAgfSwKICAgICAgICBmYWNlYm9vazogZnVuY3Rpb24obGlua3MsIHRpdGxlKSB7CiAgICAgICAgICB2YXIgbWVudUxpbmtzID0gW107CiAgICAgICAgICB2YXIgcG9wdXBMaW5rOwogICAgICAgICAgbGlua3MuZm9yRWFjaChmdW5jdGlvbihsaW5rKSB7CiAgICAgICAgICAgIHZhciBleHQgPSBsaW5rLmV4dDsKICAgICAgICAgICAgdmFyIGZvcm1hdCA9IChleHQpID8gZXh0LnRvVXBwZXJDYXNlKCkgOiAnJzsKICAgICAgICAgICAgdmFyIHF1YWxpdHkgPSBsaW5rLm5hbWU7CiAgICAgICAgICAgIHBvcHVwTGluayA9IHsKICAgICAgICAgICAgICBocmVmOiBsaW5rLnVybCwKICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgZXh0OiBleHQsCiAgICAgICAgICAgICAgZm9ybWF0OiBmb3JtYXQsCiAgICAgICAgICAgICAgcXVhbGl0eTogcXVhbGl0eSwKICAgICAgICAgICAgICBmb3JjZURvd25sb2FkOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIG1lbnVMaW5rcy5wdXNoKHBvcHVwTGluayk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBtZW51TGlua3M7CiAgICAgICAgfSwKICAgICAgICBydXR1YmU6IGZ1bmN0aW9uKGhyZWYpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGhyZWYpKSB7CiAgICAgICAgICAgIGhyZWYgPSBocmVmWzBdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBocmVmICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbGlua3MgPSBbXTsKCiAgICAgICAgICB2YXIgdmlkZW9JZCA9IGhyZWYubWF0Y2goL1wvZW1iZWRcLyhcZCspLyk7CiAgICAgICAgICB2aWRlb0lkID0gdmlkZW9JZCAmJiB2aWRlb0lkWzFdIHx8IHVuZGVmaW5lZDsKCiAgICAgICAgICBpZiAoIXZpZGVvSWQpIHsKICAgICAgICAgICAgdmlkZW9JZCA9IGhyZWYubWF0Y2goL1wvdmlkZW9cLyhbMC05YS16XSspLyk7CiAgICAgICAgICAgIHZpZGVvSWQgPSB2aWRlb0lkICYmIHZpZGVvSWRbMV0gfHwgdW5kZWZpbmVkOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgvXC9cL3ZpZGVvXC4vLnRlc3QoaHJlZikpIHsKICAgICAgICAgICAgaHJlZiA9IGhyZWYucmVwbGFjZSgvXC9cL3ZpZGVvXC4vLCAnLy8nKTsKICAgICAgICAgICAgaWYgKCF2aWRlb0lkKSB7CiAgICAgICAgICAgICAgdmlkZW9JZCA9IGhyZWYubWF0Y2goL1wvKFxkKykkLyk7CiAgICAgICAgICAgICAgdmlkZW9JZCA9IHZpZGVvSWQgJiYgdmlkZW9JZFsxXSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodmlkZW9JZCkgewogICAgICAgICAgICB2aWRlb0lkID0gJ3J0LScgKyB2aWRlb0lkOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB1bW15VXJsID0gaHJlZi5yZXBsYWNlKC9eLiooXC9cLy4qKSQvLCAndW1teTokMScpOwoKICAgICAgICAgIHZhciB2aWRlb0xpbmsgPSB7CiAgICAgICAgICAgIGhyZWY6IHVtbXlVcmwsCiAgICAgICAgICAgIHF1YWxpdHk6ICd1bW15JywKICAgICAgICAgICAgbm9TaXplOiB0cnVlLAogICAgICAgICAgICBmb3JtYXQ6ICd1bW15JywKICAgICAgICAgICAgaXRhZzogJ3VtbXknLAogICAgICAgICAgICB1UXVhbGl0eTogJzcyMCcsCiAgICAgICAgICAgIHZpZDogMTE0LAogICAgICAgICAgICB2aWRlb0lkOiB2aWRlb0lkCiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBzZXAgPSAnPyc7CiAgICAgICAgICBpZiAodW1teVVybC5pbmRleE9mKHNlcCkgIT09IC0xKSB7CiAgICAgICAgICAgIHNlcCA9ICcmJzsKICAgICAgICAgIH0KICAgICAgICAgIHVtbXlVcmwgKz0gc2VwICsgJ3NmX3R5cGU9YXVkaW8nOwoKICAgICAgICAgIHZhciBhdWRpb0xpbmsgPSB7CiAgICAgICAgICAgIGhyZWY6IHVtbXlVcmwsCiAgICAgICAgICAgIHF1YWxpdHk6ICd1bW15JywKICAgICAgICAgICAgbm9TaXplOiB0cnVlLAogICAgICAgICAgICBmb3JtYXQ6ICd1bW15JywKICAgICAgICAgICAgaXRhZzogJ3VtbXlBdWRpbycsCiAgICAgICAgICAgIHVRdWFsaXR5OiAnbXAzJywKICAgICAgICAgICAgdUlzQXVkaW86IHRydWUsCiAgICAgICAgICAgIHZpZDogMTE0LAogICAgICAgICAgICB2aWRlb0lkOiB2aWRlb0lkCiAgICAgICAgICB9OwoKICAgICAgICAgIGxpbmtzLnB1c2godmlkZW9MaW5rKTsKICAgICAgICAgIGxpbmtzLnB1c2goYXVkaW9MaW5rKTsKCiAgICAgICAgICByZXR1cm4gbGlua3M7CiAgICAgICAgfSwKICAgICAgICBtYWlscnU6IGZ1bmN0aW9uKGxpbmtzLCB0aXRsZSkgewogICAgICAgICAgdmFyIG1lbnVMaW5rcyA9IFtdOwogICAgICAgICAgdmFyIHBvcHVwTGluazsKICAgICAgICAgIGxpbmtzLmZvckVhY2goZnVuY3Rpb24obGluaykgewogICAgICAgICAgICB2YXIgZXh0ID0gbGluay5leHQ7CiAgICAgICAgICAgIHZhciBmb3JtYXQgPSBsaW5rLm5hbWU7CiAgICAgICAgICAgIHZhciBxdWFsaXR5ID0gbGluay5zdWJuYW1lOwogICAgICAgICAgICBwb3B1cExpbmsgPSB7CiAgICAgICAgICAgICAgaHJlZjogbGluay51cmwsCiAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAgIGV4dDogZXh0LAogICAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0LAogICAgICAgICAgICAgIHF1YWxpdHk6IHF1YWxpdHksCiAgICAgICAgICAgICAgZm9yY2VEb3dubG9hZDogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBtZW51TGlua3MucHVzaChwb3B1cExpbmspOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gbWVudUxpbmtzOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge05vZGV8RWxlbWVudH0gdGFyZ2V0CiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5fSBsaW5rcwogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWQKICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtfZGV0YWlsc10KICAgICAgICogQHJldHVybnMge3tpc1Nob3c6IGJvb2xlYW4sIGVsOiBOb2RlfEVsZW1lbnQsIGhpZGU6IEZ1bmN0aW9uLCB1cGRhdGU6IEZ1bmN0aW9ufX0KICAgICAgICovCiAgICAgIHF1aWNrSW5zZXJ0OiBmdW5jdGlvbih0YXJnZXQsIGxpbmtzLCBpZCwgX2RldGFpbHMpIHsKICAgICAgICBfZGV0YWlscyA9IF9kZXRhaWxzIHx8IHt9OwogICAgICAgIHZhciByZXN1bHQgPSB7fTsKCiAgICAgICAgdmFyIGhpZGVNZW51ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgaWYgKGUgJiYgKGUudGFyZ2V0ID09PSB0YXJnZXQgfHwgdGFyZ2V0LmNvbnRhaW5zKGUudGFyZ2V0KSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghcmVzdWx0LmlzU2hvdykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgbWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgbW9uby5vZmYoZG9jdW1lbnQsICdtb3VzZWRvd24nLCBoaWRlTWVudSk7CiAgICAgICAgICByZXN1bHQuaXNTaG93ID0gZmFsc2U7CiAgICAgICAgICBfZGV0YWlscy5vbkhpZGUgJiYgX2RldGFpbHMub25IaWRlKG1lbnUpOwogICAgICAgIH07CgogICAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgICAgbGlua3M6IGxpbmtzLAogICAgICAgICAgYnV0dG9uOiB0YXJnZXQsCiAgICAgICAgICBwb3B1cElkOiBpZCwKICAgICAgICAgIHNob3dGaWxlU2l6ZTogdHJ1ZQogICAgICAgICAgICAvKgogICAgICAgICAgICAgcGFyZW50OiBhcmdzLnBhcmVudCwKICAgICAgICAgICAgIGV4dFN0eWxlOiBhcmdzLmV4dFN0eWxlLAogICAgICAgICAgICAgb2Zmc2V0UmlnaHQ6IGFyZ3Mub2Zmc2V0UmlnaHQsCiAgICAgICAgICAgICBvZmZzZXRUb3A6IGFyZ3Mub2Zmc2V0VG9wLAogICAgICAgICAgICAgb25JdGVtQ2xpY2s6IGFyZ3Mub25JdGVtQ2xpY2sKICAgICAgICAgICAgICovCiAgICAgICAgfTsKCiAgICAgICAgbW9uby5leHRlbmQob3B0aW9ucywgX2RldGFpbHMpOwoKICAgICAgICB2YXIgbWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5jcmVhdGUob3B0aW9ucyk7CgogICAgICAgIF9kZXRhaWxzLm9uU2hvdyAmJiBfZGV0YWlscy5vblNob3cobWVudSk7CgogICAgICAgIG1vbm8ub2ZmKGRvY3VtZW50LCAnbW91c2Vkb3duJywgaGlkZU1lbnUpOwogICAgICAgIG1vbm8ub24oZG9jdW1lbnQsICdtb3VzZWRvd24nLCBoaWRlTWVudSk7CgogICAgICAgIHJldHVybiBtb25vLmV4dGVuZChyZXN1bHQsIHsKICAgICAgICAgIGJ1dHRvbjogdGFyZ2V0LAogICAgICAgICAgaXNTaG93OiB0cnVlLAogICAgICAgICAgZWw6IG1lbnUsCiAgICAgICAgICBoaWRlOiBoaWRlTWVudSwKICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24obGlua3MpIHsKICAgICAgICAgICAgb3B0aW9ucy5saW5rcyA9IGxpbmtzOwogICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUudXBkYXRlKG1lbnUsIG9wdGlvbnMpCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgZnJhbWVNZW51OiB7CiAgICAgIGdldEJ0bjogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgY29udGFpbmVyU3R5bGUgPSB7CiAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgekluZGV4OiA5OTksCiAgICAgICAgICBmb250RmFtaWx5OiAnYXJpYWwsIHNhbnMtc2VyaWYnCiAgICAgICAgfTsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIGRldGFpbHMuY29udGFpbmVyU3R5bGUpIHsKICAgICAgICAgIGNvbnRhaW5lclN0eWxlW2tleV0gPSBkZXRhaWxzLmNvbnRhaW5lclN0eWxlW2tleV07CiAgICAgICAgfQoKICAgICAgICB2YXIgcXVpY2tCdG5TdHlsZSA9IGRldGFpbHMucXVpY2tCdG5TdHlsZU9iaiB8fCB7CiAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgIGZvbnRTaXplOiAnaW5oZXJpdCcsCiAgICAgICAgICBoZWlnaHQ6ICcyMnB4JywKICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNCknLAogICAgICAgICAgYm9yZGVyUmFkaXVzOiAnM3B4JywKICAgICAgICAgIGJvcmRlclRvcFJpZ2h0UmFkaXVzOiAwLAogICAgICAgICAgYm9yZGVyQm90dG9tUmlnaHRSYWRpdXM6IDAsCiAgICAgICAgICBwYWRkaW5nUmlnaHQ6IDAsCiAgICAgICAgICBwYWRkaW5nTGVmdDogJzI4cHgnLAogICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLAogICAgICAgICAgbGluZUhlaWdodDogJzIycHgnLAogICAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJywKICAgICAgICAgIHpJbmRleDogMSwKICAgICAgICAgIGNvbG9yOiAnI2ZmZicKICAgICAgICB9OwoKICAgICAgICBpZiAoZGV0YWlscy5zaW5nbGVCdG4gJiYgIWRldGFpbHMucXVpY2tCdG5TdHlsZU9iaikgewogICAgICAgICAgZGVsZXRlIHF1aWNrQnRuU3R5bGUuYm9yZGVyVG9wUmlnaHRSYWRpdXM7CiAgICAgICAgICBkZWxldGUgcXVpY2tCdG5TdHlsZS5ib3JkZXJCb3R0b21SaWdodFJhZGl1czsKICAgICAgICB9CgogICAgICAgIHZhciBzZWxlY3RCdG5TdHlsZSA9IHsKICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLAogICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICBmb250U2l6ZTogJ2luaGVyaXQnLAogICAgICAgICAgaGVpZ2h0OiAnMjRweCcsCiAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgcGFkZGluZ1JpZ2h0OiAnMjFweCcsCiAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjQpJywKICAgICAgICAgIGJvcmRlckxlZnQ6IDAsCiAgICAgICAgICBib3JkZXJSYWRpdXM6ICczcHgnLAogICAgICAgICAgYm9yZGVyVG9wTGVmdFJhZGl1czogJzAnLAogICAgICAgICAgYm9yZGVyQm90dG9tTGVmdFJhZGl1czogJzAnLAogICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICBjb2xvcjogJyNmZmYnLAogICAgICAgICAgekluZGV4OiAwLAogICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICBtYXJnaW5MZWZ0OiAwCiAgICAgICAgfTsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIGRldGFpbHMuc2VsZWN0QnRuU3R5bGUpIHsKICAgICAgICAgIHNlbGVjdEJ0blN0eWxlW2tleV0gPSBkZXRhaWxzLnNlbGVjdEJ0blN0eWxlW2tleV07CiAgICAgICAgfQoKICAgICAgICB2YXIgcXVpY2tCdG5JY29uID0gZGV0YWlscy5xdWlja0J0bkljb24gfHwgbW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIGxlZnQ6ICc2cHgnLAogICAgICAgICAgICB0b3A6ICczcHgnLAogICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyNmZmZmZmYnKSArICcpJywKICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JywKICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJ25vLXJlcGVhdCcsCiAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogJ2NlbnRlcicsCiAgICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICAgIGhlaWdodDogJzE2cHgnCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciBzZWxlY3RCdG5JY29uID0gZGV0YWlscy5zZWxlY3RCdG5JY29uIHx8IG1vbm8uY3JlYXRlKCdpJywgewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICB0b3A6ICc5cHgnLAogICAgICAgICAgICByaWdodDogJzZweCcsCiAgICAgICAgICAgIGJvcmRlcjogJzVweCBzb2xpZCAjRkZGJywKICAgICAgICAgICAgYm9yZGVyQm90dG9tQ29sb3I6ICd0cmFuc3BhcmVudCcsCiAgICAgICAgICAgIGJvcmRlckxlZnRDb2xvcjogJ3RyYW5zcGFyZW50JywKICAgICAgICAgICAgYm9yZGVyUmlnaHRDb2xvcjogJ3RyYW5zcGFyZW50JwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgcXVpY2tCdG47CgogICAgICAgIHZhciBidG5Db250YWluZXIgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgaWQ6IGRldGFpbHMuYnRuSWQsCiAgICAgICAgICBzdHlsZTogY29udGFpbmVyU3R5bGUsCiAgICAgICAgICBvbjogZGV0YWlscy5vbiwKICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICBxdWlja0J0biA9IG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICAgIGNsYXNzOiAnc2YtcXVpY2stYnRuJywKICAgICAgICAgICAgICBzdHlsZTogcXVpY2tCdG5TdHlsZSwKICAgICAgICAgICAgICBocmVmOiAnIycsCiAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICBxdWlja0J0bkljb24KICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KHsKICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAnIycgKyBkZXRhaWxzLmJ0bklkLAogICAgICAgICAgICAgICAgc3R5bGU6IGRldGFpbHMubm9kZUNzc1N0eWxlIHx8IHsKICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC44LAogICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IFt7CiAgICAgICAgICAgICAgICAgICdidXR0b246Oi1tb3otZm9jdXMtaW5uZXInOiB7CiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMCwKICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgJy5zZi1xdWljay1idG4nOiBkZXRhaWxzLnF1aWNrQnRuQ3NzU3R5bGUgfHwgewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjgsMjgsMjgsMC4xKScKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgJy5zZi1zZWxlY3QtYnRuJzogewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjgsMjgsMjgsMC4xKScKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBzZWxlY3RvcjogWyc6aG92ZXInLCAnLnNmLW92ZXInXSwKICAgICAgICAgICAgICAgICAgam9pbjogJycsCiAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBhcHBlbmQ6IHsKICAgICAgICAgICAgICAgICAgICAnLnNmLXF1aWNrLWJ0bic6IGRldGFpbHMucXVpY2tCdG5PdmVyQ3NzU3R5bGUgfHwgewogICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgwLCAxNjMsIDgwLCAwLjUpJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJy5zZi1zZWxlY3QtYnRuJzogewogICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSg2MCwgNjAsIDYwLCAwLjUpJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBqb2luOiAnJywKICAgICAgICAgICAgICAgICAgJy5zZi1vdmVyJzogewogICAgICAgICAgICAgICAgICAgIGFwcGVuZDogewogICAgICAgICAgICAgICAgICAgICAgJy5zZi1zZWxlY3QtYnRuJzogewogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDI4LDI4LDI4LDAuOCknCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLXNob3cnOiB7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIHZhciBzZWxlY3RCdG4gPSBudWxsOwogICAgICAgIHZhciBzZXRRdWFsaXR5ID0gbnVsbDsKICAgICAgICBpZiAoIWRldGFpbHMuc2luZ2xlQnRuKSB7CiAgICAgICAgICBzZXRRdWFsaXR5ID0gZnVuY3Rpb24odGV4dCkgewogICAgICAgICAgICB2YXIgbm9kZSA9IHR5cGVvZiB0ZXh0ID09PSAnb2JqZWN0JyA/IHRleHQgOiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTsKICAgICAgICAgICAgdmFyIGZpcnN0ID0gc2VsZWN0QnRuLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgIGlmIChmaXJzdCA9PT0gc2VsZWN0QnRuSWNvbikgewogICAgICAgICAgICAgIHNlbGVjdEJ0bi5pbnNlcnRCZWZvcmUobm9kZSwgZmlyc3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHNlbGVjdEJ0bi5yZXBsYWNlQ2hpbGQobm9kZSwgZmlyc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgc2VsZWN0QnRuID0gbW9uby5jcmVhdGUoJ2J1dHRvbicsIHsKICAgICAgICAgICAgY2xhc3M6ICdzZi1zZWxlY3QtYnRuJywKICAgICAgICAgICAgc3R5bGU6IHNlbGVjdEJ0blN0eWxlLAogICAgICAgICAgICBvbjogZGV0YWlscy5vblNlbGVjdEJ0biwKICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgc2VsZWN0QnRuSWNvbgogICAgICAgICAgICBdCiAgICAgICAgICB9KTsKICAgICAgICAgIGJ0bkNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWxlY3RCdG4pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG5vZGU6IGJ0bkNvbnRhaW5lciwKICAgICAgICAgIHNldFF1YWxpdHk6IHNldFF1YWxpdHksCiAgICAgICAgICBzZXRMb2FkaW5nU3RhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBzZXRRdWFsaXR5KG1vbm8uY3JlYXRlKCdpbWcnLCB7CiAgICAgICAgICAgICAgc3JjOiBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdpbmZvJywgJyNmZmZmZmYnKSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgd2lkdGg6ICcxNHB4JywKICAgICAgICAgICAgICAgIGhlaWdodDogJzE0cHgnLAogICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJzZweCcsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICAgICAgICAgIHRvcDogJy0xcHgnLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0sCiAgICAgICAgICBzZWxlY3RCdG46IHNlbGVjdEJ0biwKICAgICAgICAgIHF1aWNrQnRuOiBxdWlja0J0bgogICAgICAgIH07CiAgICAgIH0sCgogICAgICBnZXRIaWRkZW5MaXN0OiBmdW5jdGlvbihoaWRkZW5MaXN0LCBvcHRpb25zKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBwb3B1cE1lbnUgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnU7CiAgICAgICAgdmFyIG1vcmVCdG4gPSBwb3B1cE1lbnUuY3JlYXRlUG9wdXBJdGVtKCctdGV4dC0nLCBvcHRpb25zKS5lbDsKICAgICAgICBtb25vLmNyZWF0ZShtb3JlQnRuLCB7CiAgICAgICAgICB0ZXh0OiBtb25vLmdsb2JhbC5sYW5ndWFnZS5tb3JlICsgJyAnICsgU3RyaW5nLmZyb21DaGFyQ29kZSgxODcpLAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgIH0sCiAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgY29udGVudCA9IHRoaXMucGFyZW50Tm9kZTsKICAgICAgICAgICAgdmFyIGl0ZW1MaXN0ID0gY29udGVudC5xdWVyeVNlbGVjdG9yQWxsKCcqWycgKyBwb3B1cE1lbnUuZGF0YUFycnRWaXNpYmxlICsgJ10nKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBpdGVtTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICAgICAgaXRlbS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICBpdGVtLnNldEF0dHJpYnV0ZShwb3B1cE1lbnUuZGF0YUFycnRWaXNpYmxlLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgICAgIC8qY29udGVudC5yZXBsYWNlQ2hpbGQobW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgICAgICAgY2xhc3M6ICdzZi1zZXBhcmF0b3InCiAgICAgICAgICAgIH0pLCB0aGlzKTsqLwogICAgICAgICAgfV0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgICAgY29udGVudC5hcHBlbmRDaGlsZChtb3JlQnRuKTsKCiAgICAgICAgbW9uby5jcmVhdGUoY29udGVudCwgewogICAgICAgICAgYXBwZW5kOiBoaWRkZW5MaXN0CiAgICAgICAgfSk7CgogICAgICAgIGlmIChvcHRpb25zLnZpc2libGVDb3VudCA9PT0gMCkgewogICAgICAgICAgbW9uby50cmlnZ2VyKG1vcmVCdG4sICdjbGljaycsIHsKICAgICAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY29udGVudDsKICAgICAgfSwKCiAgICAgIGdldE1lbnVDb250YWluZXI6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIHBvcHVwTWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudTsKICAgICAgICB2YXIgYnV0dG9uID0gb3B0aW9ucy5idXR0b247CiAgICAgICAgdmFyIHBvcHVwSWQgPSBvcHRpb25zLnBvcHVwSWQ7CgogICAgICAgIHZhciBjb250YWluZXIgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgIG1pbkhlaWdodDogJzI0cHgnLAogICAgICAgICAgICBjdXJzb3I6ICdkZWZhdWx0JywKICAgICAgICAgICAgdGV4dEFsaWduOiAnbGVmdCcsCiAgICAgICAgICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnLAogICAgICAgICAgICBvdmVyZmxvdzogJ2F1dG8nCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChwb3B1cElkWzBdID09PSAnIycpIHsKICAgICAgICAgIGNvbnRhaW5lci5pZCA9IHBvcHVwSWQuc3Vic3RyKDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChwb3B1cElkKTsKICAgICAgICB9CgogICAgICAgIHZhciBtZW51Q29udGVudCA9IHBvcHVwTWVudS5nZXRDb250ZW50KG9wdGlvbnMpOwogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChtZW51Q29udGVudC5jb250ZW50KTsKCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIG1lbnVDb250ZW50LnNpemVJY29uTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGljb24pIHsKICAgICAgICAgICAgbW9uby50cmlnZ2VyKGljb24sICdjbGljaycsIHsKICAgICAgICAgICAgICBidWJibGVzOiBmYWxzZSwKICAgICAgICAgICAgICBjYW5jZWxhYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIHZhciBwb3MgPSBTYXZlRnJvbV9VdGlscy5nZXRQb3NpdGlvbihidXR0b24sIG9wdGlvbnMucGFyZW50KTsKICAgICAgICB2YXIgc2l6ZSA9IFNhdmVGcm9tX1V0aWxzLmdldFNpemUoYnV0dG9uKTsKCiAgICAgICAgdmFyIHN0b3BQcm9wYWdhdGlvbkZ1bmMgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpCiAgICAgICAgfTsKCiAgICAgICAgdmFyIHRvcE9mZnNldCA9IHBvcy50b3AgKyBzaXplLmhlaWdodDsKICAgICAgICB2YXIgbWVudVN0eWxlID0gewogICAgICAgICAgdG9wOiB0b3BPZmZzZXQgKyAncHgnLAogICAgICAgICAgbWF4SGVpZ2h0OiAoZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQgLSB0b3BPZmZzZXQgLSA0MCkgKyAncHgnCiAgICAgICAgfTsKCiAgICAgICAgaWYgKG9wdGlvbnMubGVmdE1lbnVQb3MpIHsKICAgICAgICAgIG1lbnVTdHlsZS5sZWZ0ID0gcG9zLmxlZnQgKyAncHgnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZW51U3R5bGUucmlnaHQgPSAoZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aCAtIHBvcy5sZWZ0IC0gc2l6ZS53aWR0aCkgKyAncHgnOwogICAgICAgIH0KCiAgICAgICAgbW9uby5jcmVhdGUoY29udGFpbmVyLCB7CiAgICAgICAgICBzdHlsZTogbWVudVN0eWxlLAogICAgICAgICAgb246IFsKICAgICAgICAgICAgWydjbGljaycsIHN0b3BQcm9wYWdhdGlvbkZ1bmNdLAogICAgICAgICAgICBbJ21vdXNlb3ZlcicsIHN0b3BQcm9wYWdhdGlvbkZ1bmNdLAogICAgICAgICAgICBbJ21vdXNldXAnLCBzdG9wUHJvcGFnYXRpb25GdW5jXSwKICAgICAgICAgICAgWydtb3VzZWRvd24nLCBzdG9wUHJvcGFnYXRpb25GdW5jXSwKICAgICAgICAgICAgWydtb3VzZW91dCcsIHN0b3BQcm9wYWdhdGlvbkZ1bmNdLAogICAgICAgICAgICBbJ3doZWVsJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmIChlLndoZWVsRGVsdGFZID4gMCAmJiB0aGlzLnNjcm9sbFRvcCA9PT0gMCkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIGlmIChlLndoZWVsRGVsdGFZIDwgMCAmJiB0aGlzLnNjcm9sbEhlaWdodCAtICh0aGlzLm9mZnNldEhlaWdodCArIHRoaXMuc2Nyb2xsVG9wKSA8PSAwKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XQogICAgICAgICAgXSwKICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KHsKICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAocG9wdXBJZFswXSA9PT0gJyMnID8gJycgOiAnLicpICsgcG9wdXBJZCwKICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICAgICAgICAgICAgZm9udEZhbWlseTogJ2FyaWFsLCBzYW5zLXNlcmlmJywKCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjgsMjgsMjgsMC44KScsCiAgICAgICAgICAgICAgICAgIHpJbmRleDogOTk5OSwKICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnNHB4JywKICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICcxMnB4JywKICAgICAgICAgICAgICAgICAgZm9udFdlaWdodDogJ2JvbGQnLAogICAgICAgICAgICAgICAgICBtaW5XaWR0aDogJzE5MHB4JywKICAgICAgICAgICAgICAgICAgY29sb3I6ICcjZmZmJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFwcGVuZDogW3sKICAgICAgICAgICAgICAgICAgam9pbjogJycsCiAgICAgICAgICAgICAgICAgICcuc2Ytc2hvdyc6IHsKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICc6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrJzogewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyM0MjQyNDInCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICc6Oi13ZWJraXQtc2Nyb2xsYmFyJzogewogICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMTBweCcsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzQyNDI0MicKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgJzo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWInOiB7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzhlOGU4ZScKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAnLnNmLW1lbnUtaXRlbSc6IHsKICAgICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMjRweCcsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjZmZmJwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLW1lbnUtaXRlbTpob3Zlcic6IHsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMWMxYzFjJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBjb250YWluZXI7CiAgICAgIH0sCiAgICAgIGdldE1lbnU6IGZ1bmN0aW9uKHRhcmdldCwgbGlua3MsIGlkLCBfb3B0aW9ucykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICAgIGxpbmtzOiBsaW5rcywKICAgICAgICAgIGJ1dHRvbjogdGFyZ2V0LAogICAgICAgICAgcG9wdXBJZDogaWQgfHwgJyNzZi1mcmFtZS1tZW51JywKICAgICAgICAgIHNob3dGaWxlU2l6ZTogdHJ1ZSwKICAgICAgICAgIHNpemVJY29uU3R5bGU6IHsKICAgICAgICAgICAgY29sb3I6ICcjZmZmJwogICAgICAgICAgfSwKICAgICAgICAgIGxpbmtDbGFzczogJ3NmLW1lbnUtaXRlbScsCiAgICAgICAgICBiaW5kVW1teUluZm9EZXRhaWxzOiB7CiAgICAgICAgICAgIHBvc0xlZnQ6IHRydWUsCiAgICAgICAgICAgIHdpZHRoTGltaXQ6IDQ4MCwKICAgICAgICAgICAgY29udGFpbmVyOiBfb3B0aW9ucy5jb250YWluZXIsCiAgICAgICAgICAgIGNyZWF0ZVVtbXlJbmZvRGV0YWlsczogewogICAgICAgICAgICAgIHBvc0xlZnQ6IHRydWUsCiAgICAgICAgICAgICAgZGFya1RoZW1lOiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBnZXRIaWRkZW5MaXN0RnVuYzogdGhpcy5nZXRIaWRkZW5MaXN0LmJpbmQodGhpcykKICAgICAgICB9OwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gX29wdGlvbnMpIHsKICAgICAgICAgIG9wdGlvbnNba2V5XSA9IF9vcHRpb25zW2tleV07CiAgICAgICAgfQoKICAgICAgICB2YXIgbWVudSA9IHRoaXMuZ2V0TWVudUNvbnRhaW5lcihvcHRpb25zKTsKCiAgICAgICAgKG9wdGlvbnMuY29udGFpbmVyIHx8IGRvY3VtZW50LmJvZHkpLmFwcGVuZENoaWxkKG1lbnUpOwoKICAgICAgICB2YXIgaGlkZU1lbnUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChtZW51LnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgbWVudS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG1lbnUpOwogICAgICAgICAgfQogICAgICAgICAgb3V0LmlzU2hvdyA9IGZhbHNlOwogICAgICAgICAgb3B0aW9ucy5vbkhpZGUgJiYgb3B0aW9ucy5vbkhpZGUoKTsKICAgICAgICB9OwoKICAgICAgICBvcHRpb25zLm9uU2hvdyAmJiBvcHRpb25zLm9uU2hvdyhtZW51KTsKCiAgICAgICAgbW9uby5vZmYoZG9jdW1lbnQsICdtb3VzZWRvd24nLCBoaWRlTWVudSk7CiAgICAgICAgbW9uby5vbihkb2N1bWVudCwgJ21vdXNlZG93bicsIGhpZGVNZW51KTsKCiAgICAgICAgdmFyIG91dCA9IHsKICAgICAgICAgIGlzU2hvdzogdHJ1ZSwKICAgICAgICAgIGVsOiBtZW51LAogICAgICAgICAgaGlkZTogaGlkZU1lbnUsCiAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKGxpbmtzKSB7CiAgICAgICAgICAgIHZhciBwb3B1cE1lbnUgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnU7CiAgICAgICAgICAgIHZhciBzdHlsZSA9IG1lbnUubGFzdENoaWxkOwogICAgICAgICAgICBtZW51LnRleHRDb250ZW50ID0gJyc7CgogICAgICAgICAgICBvcHRpb25zLmxpbmtzID0gbGlua3M7CiAgICAgICAgICAgIHZhciBtZW51Q29udGVudCA9IHBvcHVwTWVudS5nZXRDb250ZW50KG9wdGlvbnMpOwoKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBtZW51Q29udGVudC5zaXplSWNvbkxpc3QuZm9yRWFjaChmdW5jdGlvbihpY29uKSB7CiAgICAgICAgICAgICAgICBtb25vLnRyaWdnZXIoaWNvbiwgJ2NsaWNrJywgewogICAgICAgICAgICAgICAgICBidWJibGVzOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbWVudS5hcHBlbmRDaGlsZChtZW51Q29udGVudC5jb250ZW50KTsKICAgICAgICAgICAgbWVudS5hcHBlbmRDaGlsZChzdHlsZSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG91dDsKICAgICAgfQogICAgfSwKCiAgICBtb2JpbGVMaWdodEJveDogewogICAgICBpZDogJ3NmLWxpZ2h0Ym94JywKICAgICAgY2xlYXI6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFNhdmVGcm9tX1V0aWxzLm1vYmlsZUxpZ2h0Qm94LmlkKTsKICAgICAgICBpZiAoZWwgPT09IG51bGwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7CiAgICAgIH0sCiAgICAgIGdldFRpdGxlOiBmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgdmFyIHRpdGxlID0gW107CgogICAgICAgIHRpdGxlLnB1c2goaXRlbS5mb3JtYXQgfHwgJz8/PycpOwogICAgICAgIGlmIChpdGVtLnF1YWxpdHkpIHsKICAgICAgICAgIHZhciBxdWFsaXR5ID0gaXRlbS5xdWFsaXR5OwoKICAgICAgICAgIGlmIChpdGVtLnNGcHMpIHsKICAgICAgICAgICAgcXVhbGl0eSArPSAnICcgKyAoaXRlbS5mcHMgfHwgNjApOwogICAgICAgICAgfQoKICAgICAgICAgIHRpdGxlLnB1c2gocXVhbGl0eSk7CiAgICAgICAgfQogICAgICAgIGlmIChpdGVtWyczZCddKSB7CiAgICAgICAgICB0aXRsZS5wdXNoKCczRCcpOwogICAgICAgIH0KICAgICAgICBpZiAoaXRlbS5ub0F1ZGlvKSB7CiAgICAgICAgICB0aXRsZS5wdXNoKG1vbm8uZ2xvYmFsLmxhbmd1YWdlLndpdGhvdXRBdWRpbyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGl0bGUuam9pbignICcpOwogICAgICB9LAogICAgICBjcmVhdGVJdGVtOiBmdW5jdGlvbihsaXN0SXRlbSkgewogICAgICAgIHZhciBtb2JpbGVMaWdodEJveCA9IFNhdmVGcm9tX1V0aWxzLm1vYmlsZUxpZ2h0Qm94OwoKICAgICAgICB2YXIgYnV0dG9uID0gbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLAogICAgICAgICAgICBtYXJnaW5Cb3R0b206ICc2cHgnLAogICAgICAgICAgICBib3JkZXI6ICdzb2xpZCAxcHggI2QzZDNkMycsCiAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICczNnB4JywKICAgICAgICAgICAgbWluSGVpZ2h0OiAnMzZweCcsCiAgICAgICAgICAgIGJhY2tncm91bmQ6ICcjZjhmOGY4JywKICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAgIGZvbnRTaXplOiAnMTVweCcsCiAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicsCiAgICAgICAgICAgIGNvbG9yOiAnIzMzMycsCiAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzJweCcsCiAgICAgICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAodHlwZW9mIGxpc3RJdGVtID09PSAnc3RyaW5nJykgewogICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gbGlzdEl0ZW07CiAgICAgICAgICByZXR1cm4gYnV0dG9uOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBidXR0b24uaHJlZiA9IGxpc3RJdGVtLmhyZWY7CiAgICAgICAgICBidXR0b24uZG93bmxvYWQgPSBsaXN0SXRlbS50aXRsZTsKICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IG1vYmlsZUxpZ2h0Qm94LmdldFRpdGxlKGxpc3RJdGVtKTsKICAgICAgICB9CgogICAgICAgIGlmIChsaXN0SXRlbS5pc0hpZGRlbikgewogICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2lzT3B0aW9uYWwnKTsKICAgICAgICAgIGJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNpemVJY29uU3R5bGUgPSB7CiAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICAgIGNzc0Zsb2F0OiAncmlnaHQnLAogICAgICAgICAgbGluZUhlaWdodDogJzM2cHgnLAogICAgICAgICAgbWluSGVpZ2h0OiAnMzZweCcsCiAgICAgICAgICBwYWRkaW5nUmlnaHQ6ICcxNXB4JywKICAgICAgICAgIHdpZHRoOiAnMThweCcKICAgICAgICB9OwogICAgICAgIHZhciBzaXplSWNvblRleHRTdHlsZSA9IHsKICAgICAgICAgIGNzc0Zsb2F0OiAncmlnaHQnLAogICAgICAgICAgcGFkZGluZ1JpZ2h0OiAnNXB4JwogICAgICAgIH07CiAgICAgICAgU2F2ZUZyb21fVXRpbHMuYXBwZW5kRmlsZVNpemVJY29uKGJ1dHRvbiwgc2l6ZUljb25TdHlsZSwgc2l6ZUljb25UZXh0U3R5bGUsIHVuZGVmaW5lZCwgdHJ1ZSwgYnV0dG9uKTsKCiAgICAgICAgcmV0dXJuIGJ1dHRvbjsKICAgICAgfSwKICAgICAgZ2V0SXRlbXM6IGZ1bmN0aW9uKGl0ZW1MaXN0KSB7CiAgICAgICAgdmFyIG1vYmlsZUxpZ2h0Qm94ID0gU2F2ZUZyb21fVXRpbHMubW9iaWxlTGlnaHRCb3g7CgogICAgICAgIGlmICh0eXBlb2YgaXRlbUxpc3QgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsaXN0OiBbbW9iaWxlTGlnaHRCb3guY3JlYXRlSXRlbShpdGVtTGlzdCldLAogICAgICAgICAgICBoaWRkZW5Db3VudDogMAogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHZhciBsaXN0ID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBpdGVtTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICBpZiAoaXRlbS5xdWFsaXR5ID09PSAndW1teScpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXRlbS5leHRyYSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGxpc3QucHVzaCh7CiAgICAgICAgICAgIGVsOiBtb2JpbGVMaWdodEJveC5jcmVhdGVJdGVtKGl0ZW0pLAogICAgICAgICAgICBwcm9wOiBpdGVtCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgbGlzdCA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5zb3J0TWVudUl0ZW1zKGxpc3QpOwogICAgICAgIHZhciBlbExpc3QgPSBbXTsKICAgICAgICB2YXIgaGlkZGVuRWxMaXN0ID0gW107CiAgICAgICAgZm9yIChpID0gMCwgaXRlbTsgaXRlbSA9IGxpc3RbaV07IGkrKykgewogICAgICAgICAgaWYgKGl0ZW0ucHJvcC5pc0hpZGRlbikgewogICAgICAgICAgICBoaWRkZW5FbExpc3QucHVzaChpdGVtLmVsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsTGlzdC5wdXNoKGl0ZW0uZWwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgbGlzdDogZWxMaXN0LmNvbmNhdChoaWRkZW5FbExpc3QpLAogICAgICAgICAgaGlkZGVuQ291bnQ6IGhpZGRlbkVsTGlzdC5sZW5ndGgKICAgICAgICB9OwogICAgICB9LAogICAgICBzaG93OiBmdW5jdGlvbihpdGVtTGlzdCkgewogICAgICAgIHZhciBtb2JpbGVMaWdodEJveCA9IFNhdmVGcm9tX1V0aWxzLm1vYmlsZUxpZ2h0Qm94OwoKICAgICAgICB2YXIgdG9wT2Zmc2V0ID0gd2luZG93LnBhZ2VZT2Zmc2V0OwogICAgICAgIHZhciB3aW5IZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CiAgICAgICAgdmFyIG1Ub3AgPSBwYXJzZUludCh3aW5IZWlnaHQgLyAxMDAgKiAxNSk7CiAgICAgICAgdmFyIGJ0bkJveCA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgbW9yZUJ0bjsKCiAgICAgICAgdmFyIGdldEJ0bkJveFNpemUgPSBmdW5jdGlvbihoYXNNb3JlKSB7CiAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICB2YXIgaSA9IGhhc01vcmUgPyAyIDogMTsKICAgICAgICAgIHJldHVybiB3aW5IZWlnaHQgLSA0NiAqIGkgLSBtVG9wICogMjsKICAgICAgICB9OwoKICAgICAgICB2YXIgc2V0TW9yZUJ0blN0YXRlID0gZnVuY3Rpb24oaXRlbU9iaikgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgaWYgKGl0ZW1PYmouaGlkZGVuQ291bnQgPiAwKSB7CiAgICAgICAgICAgIGJ0bkJveC5zdHlsZS5oZWlnaHQgPSBnZXRCdG5Cb3hTaXplKDEpICsgJ3B4JzsKICAgICAgICAgICAgbW9yZUJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vcmVCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgYnRuQm94LnN0eWxlLmhlaWdodCA9IGdldEJ0bkJveFNpemUoMCkgKyAncHgnOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBleExiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobW9iaWxlTGlnaHRCb3guaWQpOwogICAgICAgIGlmIChleExiICE9PSBudWxsKSB7CiAgICAgICAgICBleExiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZXhMYik7CiAgICAgICAgfQoKCiAgICAgICAgdmFyIGxiV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDsKICAgICAgICBpZiAobGJXaWR0aCA8PSAyNTApIHsKICAgICAgICAgIGxiV2lkdGggPSAnOTAlJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGJXaWR0aCA9ICc3MCUnOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpdGVtTGlzdCB8fCBpdGVtTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGl0ZW1MaXN0ID0gbW9uby5nbG9iYWwubGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kOwogICAgICAgIH0KCiAgICAgICAgdmFyIGl0ZW1PYmogPSBtb2JpbGVMaWdodEJveC5nZXRJdGVtcyhpdGVtTGlzdCk7CgogICAgICAgIHZhciBsaWdodGJveCA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICBpZDogbW9iaWxlTGlnaHRCb3guaWQsCiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICBsZWZ0OiAwLAogICAgICAgICAgICB3aWR0aDogJzEwMCUnLAogICAgICAgICAgICB6SW5kZXg6IDkwMDAsCiAgICAgICAgICAgIGhlaWdodDogZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQgKyAncHgnLAogICAgICAgICAgICBiYWNrZ3JvdW5kOiAncmdiYSgwLDAsMCwwLjg1KScsCiAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicKICAgICAgICAgIH0sCiAgICAgICAgICBvbjogWwogICAgICAgICAgICBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICBjbG9zZSgpOwogICAgICAgICAgICB9XQogICAgICAgICAgXSwKICAgICAgICAgIGFwcGVuZDogbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICB3aWR0aDogbGJXaWR0aCwKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZWVlJywKICAgICAgICAgICAgICBoZWlnaHQ6ICh3aW5IZWlnaHQgLSBtVG9wICogMikgKyAncHgnLAogICAgICAgICAgICAgIG1hcmdpblRvcDogKG1Ub3AgKyB0b3BPZmZzZXQpICsgJ3B4JywKICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc0cHgnLAogICAgICAgICAgICAgIHBhZGRpbmc6ICc4cHgnLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgIGJ0bkJveCA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdhdXRvJywKICAgICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnNnB4JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFwcGVuZDogaXRlbU9iai5saXN0LAogICAgICAgICAgICAgICAgb246IFsndG91Y2htb3ZlJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBtb3JlQnRuID0gbW9uby5jcmVhdGUobW9iaWxlTGlnaHRCb3guY3JlYXRlSXRlbShtb25vLmdsb2JhbC5sYW5ndWFnZS5tb3JlICsgJyAnICsgU3RyaW5nLmZyb21DaGFyQ29kZSgxODcpKSwgewogICAgICAgICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgICAgICAgb246IFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICB2YXIgZWxMaXN0ID0gdGhpcy5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJy5pc09wdGlvbmFsJyk7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGFzZXQuc3RhdGUgIT09ICdvcGVuJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YXNldC5zdGF0ZSA9ICdvcGVuJzsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRDb250ZW50ID0gbW9uby5nbG9iYWwubGFuZ3VhZ2UubW9yZSArICcgJyArIFN0cmluZy5mcm9tQ2hhckNvZGUoMTcxKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhc2V0LnN0YXRlID0gJ2Nsb3NlJzsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRleHRDb250ZW50ID0gbW9uby5nbG9iYWwubGFuZ3VhZ2UubW9yZSArICcgJyArIFN0cmluZy5mcm9tQ2hhckNvZGUoMTg3KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgZWw7IGVsID0gZWxMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gc3RhdGU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgbW9uby5jcmVhdGUobW9iaWxlTGlnaHRCb3guY3JlYXRlSXRlbShtb25vLmdsb2JhbC5sYW5ndWFnZS5jbG9zZSksIHsKICAgICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgIGNsb3NlKCk7CiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH1dCiAgICAgICAgICB9KQogICAgICAgIH0pOwoKICAgICAgICBzZXRNb3JlQnRuU3RhdGUoaXRlbU9iaik7CgogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGlnaHRib3gpOwoKICAgICAgICB2YXIgdG9wUG9zID0gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7CgogICAgICAgIHZhciByZXN1bHQgPSB7fTsKCiAgICAgICAgdmFyIGNsb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoIXJlc3VsdC5pc1Nob3cpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gdG9wUG9zOwogICAgICAgICAgcmVzdWx0LmhpZGUoKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gbW9uby5leHRlbmQocmVzdWx0LCB7CiAgICAgICAgICBpc1Nob3c6IHRydWUsCiAgICAgICAgICBlbDogbGlnaHRib3gsCiAgICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbGlnaHRib3gucGFyZW50Tm9kZSAmJiBsaWdodGJveC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGxpZ2h0Ym94KTsKICAgICAgICAgICAgcmVzdWx0LmlzU2hvdyA9IGZhbHNlOwogICAgICAgICAgfSwKICAgICAgICAgIGNsb3NlOiBjbG9zZSwKICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oaXRlbUxpc3QpIHsKICAgICAgICAgICAgaWYgKGxpZ2h0Ym94LnBhcmVudE5vZGUgPT09IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghaXRlbUxpc3QgfHwgaXRlbUxpc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgaXRlbUxpc3QgPSBtb25vLmdsb2JhbC5sYW5ndWFnZS5ub0xpbmtzRm91bmQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJ0bkJveC50ZXh0Q29udGVudCA9ICcnOwogICAgICAgICAgICB2YXIgaXRlbU9iaiA9IG1vYmlsZUxpZ2h0Qm94LmdldEl0ZW1zKGl0ZW1MaXN0KTsKCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKGJ0bkJveCwgewogICAgICAgICAgICAgIGFwcGVuZDogaXRlbU9iai5saXN0CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc2V0TW9yZUJ0blN0YXRlKGl0ZW1PYmopOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQHBhcmFtIHtPYmplY3R9IGRldGFpbHMKICAgICAqIEBwYXJhbSB7QXJyYXl9IFtkZXRhaWxzLmFyZ3NdCiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2RldGFpbHMudGltZW91dF0KICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGRldGFpbHMuZnVuYwogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZGV0YWlscy5jYgogICAgICovCiAgICBicmlkZ2U6IGZ1bmN0aW9uKGRldGFpbHMpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBkZXRhaWxzLmFyZ3MgPSBkZXRhaWxzLmFyZ3MgfHwgW107CiAgICAgIGlmIChkZXRhaWxzLnRpbWVvdXQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGRldGFpbHMudGltZW91dCA9IDMwMDsKICAgICAgfQogICAgICB2YXIgc2NyaXB0SWQgPSAnc2YtYnJpZGdlLScgKyBwYXJzZUludChNYXRoLnJhbmRvbSgpICogMTAwMCkgKyAnLScgKyBEYXRlLm5vdygpOwoKICAgICAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24oZSkgewogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzZi1icmlkZ2UtJyArIHNjcmlwdElkLCBsaXN0ZW5lcik7CiAgICAgICAgdmFyIGRhdGE7CiAgICAgICAgaWYgKCFlLmRldGFpbCkgewogICAgICAgICAgZGF0YSA9IHVuZGVmaW5lZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZS5kZXRhaWwpOwogICAgICAgIH0KICAgICAgICBkZXRhaWxzLmNiKGRhdGEpOwogICAgICB9OwoKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3NmLWJyaWRnZS0nICsgc2NyaXB0SWQsIGxpc3RlbmVyKTsKCiAgICAgIHZhciB3cmFwRnVuYyA9ICcoJyArIChmdW5jdGlvbihmdW5jLCBhcmdzLCBzY3JpcHRJZCwgdGltZW91dCkgewogICAgICAgIC8qIGZpeCAqLwogICAgICAgIHZhciBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2NyaXB0SWQpOwogICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZmlyZWQgPSBmYWxzZTsKICAgICAgICB2YXIgZG9uZSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIGlmIChmaXJlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBmaXJlZCA9IHRydWU7CgogICAgICAgICAgdmFyIGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdzZi1icmlkZ2UtJyArIHNjcmlwdElkLCB7CiAgICAgICAgICAgIGRldGFpbDogSlNPTi5zdHJpbmdpZnkoZGF0YSkKICAgICAgICAgIH0pOwogICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICAgIH07CgogICAgICAgIHRpbWVvdXQgJiYgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIGRvbmUoKTsKICAgICAgICB9LCB0aW1lb3V0KTsKCiAgICAgICAgYXJncy5wdXNoKGRvbmUpOwoKICAgICAgICBmdW5jLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICB9KS50b1N0cmluZygpICsgJykoJyArIFsKICAgICAgICBkZXRhaWxzLmZ1bmMudG9TdHJpbmcoKSwKICAgICAgICBKU09OLnN0cmluZ2lmeShkZXRhaWxzLmFyZ3MpLAogICAgICAgIEpTT04uc3RyaW5naWZ5KHNjcmlwdElkKSwKICAgICAgICBwYXJzZUludChkZXRhaWxzLnRpbWVvdXQpCiAgICAgIF0uam9pbignLCcpICsgJyk7JzsKCiAgICAgIGlmIChtb25vLmlzU2FmYXJpKSB7CiAgICAgICAgdmFyIHNhZmFyaUZpeCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHR5cGVvZiBDdXN0b21FdmVudCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgQ3VzdG9tRXZlbnQgPSBmdW5jdGlvbihldmVudCwgcGFyYW1zKSB7CiAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IHsKICAgICAgICAgICAgICAgIGJ1YmJsZXM6IGZhbHNlLAogICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogZmFsc2UKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHZhciBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnQ3VzdG9tRXZlbnQnKTsKICAgICAgICAgICAgICBldnQuaW5pdEN1c3RvbUV2ZW50KGV2ZW50LCBwYXJhbXMuYnViYmxlcywgcGFyYW1zLmNhbmNlbGFibGUsIHBhcmFtcy5kZXRhaWwpOwogICAgICAgICAgICAgIHJldHVybiBldnQ7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIEN1c3RvbUV2ZW50LnByb3RvdHlwZSA9IHdpbmRvdy5FdmVudC5wcm90b3R5cGU7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB3cmFwRnVuYyA9IHdyYXBGdW5jLnJlcGxhY2UoJy8qIGZpeCAqLycsICcoJyArIHNhZmFyaUZpeC50b1N0cmluZygpICsgJykoKTsnKTsKICAgICAgfSBlbHNlCiAgICAgIGlmIChtb25vLmlzT3BlcmEpIHsKICAgICAgICB3cmFwRnVuYyA9IHdyYXBGdW5jLnJlcGxhY2UoJy8qIGZpeCAqLycsICd2YXIgQ3VzdG9tRXZlbnQgPSB3aW5kb3cuQ3VzdG9tRXZlbnQ7Jyk7CiAgICAgIH0KCiAgICAgIHZhciBzY3JpcHQgPSBtb25vLmNyZWF0ZSgnc2NyaXB0JywgewogICAgICAgIGlkOiBzY3JpcHRJZCwKICAgICAgICB0ZXh0OiB3cmFwRnVuYwogICAgICB9KTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgfQogIH07CgogIFNhdmVGcm9tX1V0aWxzLlR1dG9yaWFsVG9vbHRpcCA9IGZ1bmN0aW9uKGRldGFpbHMpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICB0aGlzLmRldGFpbHMgPSB7CiAgICAgIGJ0blRvcE9mZnNldDogLTMsCiAgICAgIGJ0bkxlZnRPZmZzZXQ6IDAKICAgIH07CgogICAgbW9uby5leHRlbmQodGhpcy5kZXRhaWxzLCBkZXRhaWxzKTsKCiAgICB0aGlzLm9uUmVzaXplID0gdGhpcy5vblJlc2l6ZS5iaW5kKHRoaXMpOwogICAgdGhpcy5vblJlc2l6ZURlYm91Y2UgPSBtb25vLmRlYm91bmNlKHRoaXMub25SZXNpemUsIDI1MCk7CiAgICB0aGlzLm9uQ2xvc2UgPSB0aGlzLm9uQ2xvc2UuYmluZCh0aGlzKTsKCiAgICB0aGlzLnRhcmdldCA9IGRldGFpbHMudGFyZ2V0OwoKICAgIGlmICh0aGlzLnRhcmdldC5kYXRhc2V0LnNmSGFzVG9vbHRpcCA9PT0gJzEnKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMudGFyZ2V0LmRhdGFzZXQuc2ZIYXNUb29sdGlwID0gJzEnOwoKCiAgICB0aGlzLnRvb2x0aXBOb2RlID0gdGhpcy5nZXROb2RlKCk7CgoKICAgIHRoaXMudGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLm9uQ2xvc2UpOwoKICAgIHRoaXMudGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ3NmLXJlbW92ZWQnLCBmdW5jdGlvbigpIHsKICAgICAgX3RoaXMub25DbG9zZSAmJiBfdGhpcy5vbkNsb3NlKDEpOwogICAgfSk7CgogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25SZXNpemVEZWJvdWNlKTsKCiAgICB0aGlzLm9uUmVzaXplKCk7CgogICAgKGRldGFpbHMucGFyZW50IHx8IGRvY3VtZW50LmJvZHkpLmFwcGVuZENoaWxkKHRoaXMudG9vbHRpcE5vZGUpOwogIH07CgogIFNhdmVGcm9tX1V0aWxzLlR1dG9yaWFsVG9vbHRpcC5wcm90b3R5cGUuZ2V0Tm9kZSA9IGZ1bmN0aW9uKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIF90aGlzID0gdGhpczsKICAgIHZhciBsYW5ndWFnZSA9IG1vbm8uZ2xvYmFsLmxhbmd1YWdlOwoKICAgIHZhciB6SW5kZXggPSAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciB6SW5kZXggPSAxMDAwOwogICAgICB2YXIgdG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hc3RoZWFkLXBvc2l0aW9uZXInKTsKICAgICAgdmFyIHN0eWxlTGlzdCA9IHRvcCAmJiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0b3AsIG51bGwpOwogICAgICBpZiAoc3R5bGVMaXN0KSB7CiAgICAgICAgekluZGV4ID0gcGFyc2VJbnQoc3R5bGVMaXN0LmdldFByb3BlcnR5VmFsdWUoJ3otaW5kZXgnKSkgKyAxOwogICAgICB9CiAgICAgIHJldHVybiB6SW5kZXg7CiAgICB9KSgpOwoKICAgIHZhciBib3ggPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICBjbGFzczogJ3NmLXRvb2x0aXAnLAogICAgICBvbjogWydtb3VzZXVwJywgZnVuY3Rpb24oZSkgewogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIH1dLAogICAgICBhcHBlbmQ6IFsKICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICBib3JkZXI6ICc4cHggc29saWQgdHJhbnNwYXJlbnQnLAogICAgICAgICAgICBib3JkZXJSaWdodDogJzEwcHggc29saWQgIzRENEQ0RCcsCiAgICAgICAgICAgIGJvcmRlckxlZnQ6IDAsCiAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICB0b3A6ICc4cHgnLAogICAgICAgICAgICBsZWZ0OiAnMHB4JywKICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjNEQ0RDREJywKICAgICAgICAgICAgbWFyZ2luTGVmdDogJzEwcHgnLAogICAgICAgICAgICBwYWRkaW5nOiAnMTBweCAxMHB4JywKICAgICAgICAgICAgbWF4V2lkdGg6ICcyMjBweCcsCiAgICAgICAgICAgIG1pbldpZHRoOiAnMjIwcHgnLAogICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMTZweCcsCiAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgIGZvbnRGYW1pbHk6ICdmb250LWZhbWlseTogYXJpYWwsIHNhbnMtc2VyaWYnLAogICAgICAgICAgICBjb2xvcjogJyNmZmYnCiAgICAgICAgICB9LAogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBtYXJnaW46IDAKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGFwcGVuZDogbW9uby5wYXJzZVRlbXBsYXRlKGxhbmd1YWdlLnR1dG9yaWFsVG9vbHRpcFRleHQpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgICBjbGFzczogJ3NmLWJ1dHRvbicsCiAgICAgICAgICAgICAgdGV4dDogJ09LJywKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgICB0ZXh0QWxpZ246ICdjZW50ZXInLAogICAgICAgICAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJywKICAgICAgICAgICAgICAgIHBhZGRpbmc6ICcwIDEwcHgnLAogICAgICAgICAgICAgICAgY3NzRmxvYXQ6ICdyaWdodCcsCgogICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAnNXB4JywKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcyMHB4JywKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzNweCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzEycHgnLAogICAgICAgICAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICdib2xkZXInLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzE2N0FDNicsCiAgICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb246IFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBfdGhpcy5vbkNsb3NlICYmIF90aGlzLm9uQ2xvc2UoKTsKICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dCh7CiAgICAgICAgICAgICAgICAnLnNmLXRvb2x0aXAnOiB7CiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgICAgICB6SW5kZXg6IHpJbmRleCArIDIsCiAgICAgICAgICAgICAgICAgIGFwcGVuZDogewogICAgICAgICAgICAgICAgICAgICcuc2YtYnV0dG9uOmhvdmVyJzogewogICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzEyNmRiMyAhaW1wb3J0YW50JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJy5zZi1idXR0b246YWN0aXZlJzogewogICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC45CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICAgIF0KICAgICAgICB9KQogICAgICBdCiAgICB9KTsKCiAgICByZXR1cm4gYm94OwogIH07CgogIFNhdmVGcm9tX1V0aWxzLlR1dG9yaWFsVG9vbHRpcC5wcm90b3R5cGUub25DbG9zZSA9IGZ1bmN0aW9uKGZvcmNlKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAoZm9yY2UgJiYgZm9yY2UudHlwZSA9PT0gJ21vdXNldXAnKSB7CiAgICAgIGZvcmNlID0gbnVsbDsKICAgIH0KCiAgICBpZiAodGhpcy50b29sdGlwTm9kZSkgewogICAgICB0aGlzLnRvb2x0aXBOb2RlLnBhcmVudE5vZGUgJiYgdGhpcy50b29sdGlwTm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMudG9vbHRpcE5vZGUpOwogICAgICB0aGlzLnRvb2x0aXBOb2RlID0gbnVsbDsKICAgIH0KCiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vblJlc2l6ZURlYm91Y2UpOwogICAgdGhpcy50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25DbG9zZSk7CgogICAgdGhpcy5vbkNsb3NlID0gbnVsbDsKICAgIGlmICghZm9yY2UpIHsKICAgICAgdGhpcy5kZXRhaWxzLm9uQ2xvc2UgJiYgdGhpcy5kZXRhaWxzLm9uQ2xvc2UoKTsKICAgIH0KICB9OwoKICBTYXZlRnJvbV9VdGlscy5UdXRvcmlhbFRvb2x0aXAucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgYnRuID0gdGhpcy50YXJnZXQ7CiAgICBpZiAoIWJ0bi5vZmZzZXRQYXJlbnQgfHwgIWJ0bi5wYXJlbnROb2RlKSB7CiAgICAgIHJldHVybiB0aGlzLm9uQ2xvc2UgJiYgdGhpcy5vbkNsb3NlKDEpOwogICAgfQoKICAgIHZhciBidG5Qb3MgPSBTYXZlRnJvbV9VdGlscy5nZXRQb3NpdGlvbihidG4sIHRoaXMuZGV0YWlscy5wYXJlbnQpOwogICAgdmFyIHRvcCA9IGJ0blBvcy50b3AgKyB0aGlzLmRldGFpbHMuYnRuVG9wT2Zmc2V0OwogICAgdmFyIGxlZnQgPSBidG5Qb3MubGVmdCArIGJ0blBvcy53aWR0aCArIHRoaXMuZGV0YWlscy5idG5MZWZ0T2Zmc2V0OwogICAgdGhpcy50b29sdGlwTm9kZS5zdHlsZS50b3AgPSB0b3AgKyAncHgnOwogICAgdGhpcy50b29sdGlwTm9kZS5zdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7CiAgfTsKCiAgU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyID0gewogICAgZ2V0TXV0YXRpb25PYnNlcnZlcjogZnVuY3Rpb24oKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIE11dGF0aW9uT2JzZXJ2ZXJDdG9yID0gbnVsbDsKICAgICAgaWYgKHR5cGVvZiBNdXRhdGlvbk9ic2VydmVyICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIE11dGF0aW9uT2JzZXJ2ZXJDdG9yID0gTXV0YXRpb25PYnNlcnZlcjsKICAgICAgfSBlbHNlCiAgICAgIGlmICh0eXBlb2YgV2ViS2l0TXV0YXRpb25PYnNlcnZlciAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBNdXRhdGlvbk9ic2VydmVyQ3RvciA9IFdlYktpdE11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgIH0gZWxzZQogICAgICBpZiAodHlwZW9mIE1vek11dGF0aW9uT2JzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgTXV0YXRpb25PYnNlcnZlckN0b3IgPSBNb3pNdXRhdGlvbk9ic2VydmVyOwogICAgICB9IGVsc2UKICAgICAgaWYgKHR5cGVvZiBKc011dGF0aW9uT2JzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgTXV0YXRpb25PYnNlcnZlckN0b3IgPSBKc011dGF0aW9uT2JzZXJ2ZXI7CiAgICAgIH0KICAgICAgcmV0dXJuIE11dGF0aW9uT2JzZXJ2ZXJDdG9yOwogICAgfSwKICAgIGlzQXZhaWxhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICByZXR1cm4gISF0aGlzLmdldE11dGF0aW9uT2JzZXJ2ZXIoKTsKICAgIH0sCiAgICBkaXNjb25uZWN0OiBmdW5jdGlvbihkZXRhaWxzKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgZGV0YWlscy5vYnNlcnZlci5kaXNjb25uZWN0KCk7CiAgICB9LAogICAgY29ubmVjdDogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGRldGFpbHMub2JzZXJ2ZXIub2JzZXJ2ZShkZXRhaWxzLnRhcmdldCwgZGV0YWlscy5jb25maWcpOwogICAgfSwKICAgIGpvaW5NdXRhdGlvbnM6IGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBqTXV0YXRpb25zID0gW107CiAgICAgIHZhciB0YXJnZXRMaXN0ID0gW107CgogICAgICB2YXIgak9iaiA9IHt9LAogICAgICAgIG9iaiwgaGFzTm9kZXM7CiAgICAgIHZhciBtdXRhdGlvbiwgaSwgbm9kZSwgdEluZGV4OwogICAgICB3aGlsZSAobXV0YXRpb24gPSBtdXRhdGlvbnMuc2hpZnQoKSkgewogICAgICAgIHRJbmRleCA9IHRhcmdldExpc3QuaW5kZXhPZihtdXRhdGlvbi50YXJnZXQpOwoKICAgICAgICBpZiAodEluZGV4ID09PSAtMSkgewogICAgICAgICAgdEluZGV4ID0gdGFyZ2V0TGlzdC5wdXNoKG11dGF0aW9uLnRhcmdldCkgLSAxOwogICAgICAgICAgak9ialt0SW5kZXhdID0gewogICAgICAgICAgICB0YXJnZXQ6IG11dGF0aW9uLnRhcmdldCwKICAgICAgICAgICAgYWRkZWQ6IFtdLAogICAgICAgICAgICByZW1vdmVkOiBbXQogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIG9iaiA9IGpPYmpbdEluZGV4XTsKICAgICAgICBoYXNOb2RlcyA9IHVuZGVmaW5lZDsKCiAgICAgICAgZm9yIChpID0gMDsgbm9kZSA9IG11dGF0aW9uLmFkZGVkTm9kZXNbaV07IGkrKykgewogICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgIT09IDEpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgb2JqLmFkZGVkLnB1c2gobm9kZSk7CiAgICAgICAgICBoYXNOb2RlcyA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGkgPSAwOyBub2RlID0gbXV0YXRpb24ucmVtb3ZlZE5vZGVzW2ldOyBpKyspIHsKICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlICE9PSAxKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIG9iai5yZW1vdmVkLnB1c2gobm9kZSk7CiAgICAgICAgICBoYXNOb2RlcyA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoaGFzTm9kZXMgIT09IHVuZGVmaW5lZCAmJiBvYmouaW5MaXN0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIG9iai5pbkxpc3QgPSB0cnVlOwogICAgICAgICAgak11dGF0aW9ucy5wdXNoKG9iaik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gak11dGF0aW9uczsKICAgIH0sCiAgICBpc01hdGNoZWQ6IG51bGwsCiAgICBwcmVwYXJlTWF0Y2hlZDogZnVuY3Rpb24oKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgaWYgKHRoaXMuaXNNYXRjaGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCiAgICAgIGlmICh0eXBlb2YgZWwubWF0Y2hlcyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHRoaXMuaXNNYXRjaGVkID0gZnVuY3Rpb24obm9kZSwgc2VsZWN0b3IpIHsKICAgICAgICAgIHJldHVybiBub2RlLm1hdGNoZXMoc2VsZWN0b3IpOwogICAgICAgIH07CiAgICAgIH0gZWxzZQogICAgICBpZiAodHlwZW9mIGVsLm1hdGNoZXNTZWxlY3RvciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHRoaXMuaXNNYXRjaGVkID0gZnVuY3Rpb24obm9kZSwgc2VsZWN0b3IpIHsKICAgICAgICAgIHJldHVybiBub2RlLm1hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7CiAgICAgICAgfTsKICAgICAgfSBlbHNlCiAgICAgIGlmICh0eXBlb2YgZWwud2Via2l0TWF0Y2hlc1NlbGVjdG9yID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhpcy5pc01hdGNoZWQgPSBmdW5jdGlvbihub2RlLCBzZWxlY3RvcikgewogICAgICAgICAgcmV0dXJuIG5vZGUud2Via2l0TWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgICB9OwogICAgICB9IGVsc2UKICAgICAgaWYgKHR5cGVvZiBlbC5tb3pNYXRjaGVzU2VsZWN0b3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB0aGlzLmlzTWF0Y2hlZCA9IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yKSB7CiAgICAgICAgICByZXR1cm4gbm9kZS5tb3pNYXRjaGVzU2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgICAgIH07CiAgICAgIH0gZWxzZQogICAgICBpZiAodHlwZW9mIGVsLm9NYXRjaGVzU2VsZWN0b3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICB0aGlzLmlzTWF0Y2hlZCA9IGZ1bmN0aW9uKG5vZGUsIHNlbGVjdG9yKSB7CiAgICAgICAgICByZXR1cm4gbm9kZS5vTWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgICB9OwogICAgICB9IGVsc2UKICAgICAgaWYgKHR5cGVvZiBlbC5tc01hdGNoZXNTZWxlY3RvciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHRoaXMuaXNNYXRjaGVkID0gZnVuY3Rpb24obm9kZSwgc2VsZWN0b3IpIHsKICAgICAgICAgIHJldHVybiBub2RlLm1zTWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgICB9OwogICAgICB9CgogICAgICBlbCA9IG51bGw7CiAgICB9LAogICAgbWF0Y2g6IGZ1bmN0aW9uKGRldGFpbHMsIHN1bW1hcnlMaXN0LCBtdXRhdGlvbikgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBub2RlLCBpLCBxdWVyeSwgbjsKICAgICAgdmFyIHF1ZXJpZXMgPSBkZXRhaWxzLnF1ZXJpZXM7CiAgICAgIHZhciBoYXNDaGFuZ2VzID0gZmFsc2U7CiAgICAgIFsnYWRkZWQnLCAncmVtb3ZlZCddLmZvckVhY2goZnVuY3Rpb24odHlwZSkgewogICAgICAgIHZhciBub2RlTGlzdCA9IG11dGF0aW9uW3R5cGVdOwogICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBub2RlTGlzdFtuXTsgbisrKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBxdWVyeSA9IHF1ZXJpZXNbaV07IGkrKykgewogICAgICAgICAgICBpZiAocXVlcnkuaXMgIT09IHVuZGVmaW5lZCAmJiBxdWVyeS5pcyAhPT0gdHlwZSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBub2RlQXJyID0gc3VtbWFyeUxpc3RbaV1bdHlwZV07CiAgICAgICAgICAgIGlmIChfdGhpcy5pc01hdGNoZWQobm9kZSwgcXVlcnkuY3NzKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIG5vZGVBcnIucHVzaChub2RlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBub2RlQXJyLnB1c2guYXBwbHkobm9kZUFyciwgbm9kZS5xdWVyeVNlbGVjdG9yQWxsKHF1ZXJ5LmNzcykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaGFzQ2hhbmdlcyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICBoYXNDaGFuZ2VzID0gbm9kZUFyclswXSAhPT0gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHJldHVybiBoYXNDaGFuZ2VzOwogICAgfSwKICAgIGZpbHRlclRhcmdldDogZnVuY3Rpb24ocXVlcmllcywgbm9kZSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBpLCBxdWVyeTsKICAgICAgZm9yIChpID0gMDsgcXVlcnkgPSBxdWVyaWVzW2ldOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5pc01hdGNoZWQobm9kZSwgcXVlcnkuY3NzKSA9PT0gdHJ1ZSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBydW46IGZ1bmN0aW9uKF9kZXRhaWxzKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgY29uZmlnOiB7CiAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICBzdWJ0cmVlOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB0YXJnZXQ6IGRvY3VtZW50LmJvZHksCiAgICAgICAgZmlsdGVyVGFyZ2V0OiBbXQogICAgICB9OwogICAgICBtb25vLmV4dGVuZChkZXRhaWxzLCBfZGV0YWlscyk7CgogICAgICBkZXRhaWxzLl9kaXNjb25uZWN0ID0gdGhpcy5kaXNjb25uZWN0LmJpbmQodGhpcywgZGV0YWlscyk7CiAgICAgIGRldGFpbHMuX2Nvbm5lY3QgPSB0aGlzLmNvbm5lY3QuYmluZCh0aGlzLCBkZXRhaWxzKTsKICAgICAgZGV0YWlscy5fbWF0Y2ggPSB0aGlzLm1hdGNoLmJpbmQodGhpcywgZGV0YWlscyk7CgogICAgICB2YXIgX3N1bW1hcnlMaXN0ID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGV0YWlscy5xdWVyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgX3N1bW1hcnlMaXN0LnB1c2goewogICAgICAgICAgYWRkZWQ6IFtdLAogICAgICAgICAgcmVtb3ZlZDogW10KICAgICAgICB9KTsKICAgICAgfQogICAgICBfc3VtbWFyeUxpc3QgPSBKU09OLnN0cmluZ2lmeShfc3VtbWFyeUxpc3QpOwoKICAgICAgdGhpcy5wcmVwYXJlTWF0Y2hlZCgpOwoKICAgICAgdmFyIG1PYnNlcnZlciA9IHRoaXMuZ2V0TXV0YXRpb25PYnNlcnZlcigpOwogICAgICBkZXRhaWxzLm9ic2VydmVyID0gbmV3IG1PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHsKICAgICAgICAvLyBjb25zb2xlLnRpbWUoJ28nKTsKICAgICAgICB2YXIgak11dGF0aW9ucyA9IF90aGlzLmpvaW5NdXRhdGlvbnMobXV0YXRpb25zKTsKICAgICAgICBpZiAoak11dGF0aW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIC8vIGNvbnNvbGUudGltZUVuZCgnbycpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGhhc0NoYW5nZXMgPSBmYWxzZTsKICAgICAgICB2YXIgbXV0YXRpb247CiAgICAgICAgdmFyIHN1bW1hcnlMaXN0ID0gSlNPTi5wYXJzZShfc3VtbWFyeUxpc3QpOwogICAgICAgIHdoaWxlIChtdXRhdGlvbiA9IGpNdXRhdGlvbnMuc2hpZnQoKSkgewogICAgICAgICAgLy8gY29uc29sZS5sb2coJ211dGF0aW9uJywgbXV0YXRpb24pOwogICAgICAgICAgaWYgKF90aGlzLmZpbHRlclRhcmdldChkZXRhaWxzLmZpbHRlclRhcmdldCwgbXV0YXRpb24udGFyZ2V0KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKGRldGFpbHMuX21hdGNoKHN1bW1hcnlMaXN0LCBtdXRhdGlvbikgPT09IHRydWUpIHsKICAgICAgICAgICAgICBoYXNDaGFuZ2VzID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaGFzQ2hhbmdlcyA9PT0gdHJ1ZSAmJiBkZXRhaWxzLmNhbGxiYWNrKHN1bW1hcnlMaXN0KTsKICAgICAgICAvLyBjb25zb2xlLnRpbWVFbmQoJ28nKTsKICAgICAgfSk7CgogICAgICBkZXRhaWxzLnN0YXJ0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZGV0YWlscy5fZGlzY29ubmVjdCgpOwogICAgICAgIGRldGFpbHMuX2Nvbm5lY3QoKTsKCiAgICAgICAgdmFyIGhhc0NoYW5nZXMgPSBmYWxzZTsKICAgICAgICB2YXIgc3VtbWFyeUxpc3QgPSBKU09OLnBhcnNlKF9zdW1tYXJ5TGlzdCk7CgogICAgICAgIHZhciBtdXRhdGlvbiA9IHsKICAgICAgICAgIGFkZGVkOiBbZGV0YWlscy50YXJnZXRdLAogICAgICAgICAgcmVtb3ZlZDogW10KICAgICAgICB9OwogICAgICAgIGlmIChkZXRhaWxzLl9tYXRjaChzdW1tYXJ5TGlzdCwgbXV0YXRpb24pKSB7CiAgICAgICAgICBoYXNDaGFuZ2VzID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGhhc0NoYW5nZXMgPT09IHRydWUgJiYgZGV0YWlscy5jYWxsYmFjayhzdW1tYXJ5TGlzdCk7CiAgICAgIH07CgogICAgICBkZXRhaWxzLnN0b3AgPSBmdW5jdGlvbigpIHsKICAgICAgICBkZXRhaWxzLl9kaXNjb25uZWN0KCk7CiAgICAgIH07CgogICAgICBkZXRhaWxzLnN0YXJ0KCk7CgogICAgICByZXR1cm4gZGV0YWlsczsKICAgIH0KICB9OwoKICBTYXZlRnJvbV9VdGlscy5tdXRhdGlvbkF0dHJXYXRjaGVyID0gewogICAgaXNBdmFpbGFibGU6IGZ1bmN0aW9uKCkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHJldHVybiAhIVNhdmVGcm9tX1V0aWxzLm11dGF0aW9uV2F0Y2hlci5nZXRNdXRhdGlvbk9ic2VydmVyKCk7CiAgICB9LAogICAgZGlzY29ubmVjdDogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGRldGFpbHMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgfSwKICAgIGNvbm5lY3Q6IGZ1bmN0aW9uKGRldGFpbHMpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBkZXRhaWxzLm9ic2VydmVyLm9ic2VydmUoZGV0YWlscy50YXJnZXQsIGRldGFpbHMuY29uZmlnKTsKICAgIH0sCiAgICBydW46IGZ1bmN0aW9uKF9kZXRhaWxzKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgIGNvbmZpZzogewogICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgIGNoaWxkTGlzdDogZmFsc2UsCiAgICAgICAgICBhdHRyaWJ1dGVPbGRWYWx1ZTogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgdGFyZ2V0OiBkb2N1bWVudC5ib2R5CiAgICAgIH07CgogICAgICBtb25vLmV4dGVuZChkZXRhaWxzLCBfZGV0YWlscyk7CgogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGV0YWlscy5hdHRyKSkgewogICAgICAgIGRldGFpbHMuYXR0ciA9IFtkZXRhaWxzLmF0dHJdOwogICAgICB9CgogICAgICBkZXRhaWxzLmNvbmZpZy5hdHRyaWJ1dGVGaWx0ZXIgPSBkZXRhaWxzLmF0dHI7CgogICAgICBkZXRhaWxzLl9kaXNjb25uZWN0ID0gdGhpcy5kaXNjb25uZWN0LmJpbmQodGhpcywgZGV0YWlscyk7CiAgICAgIGRldGFpbHMuX2Nvbm5lY3QgPSB0aGlzLmNvbm5lY3QuYmluZCh0aGlzLCBkZXRhaWxzKTsKCiAgICAgIHZhciBfc3VtbWFyeUxpc3QgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZXRhaWxzLmF0dHIubGVuZ3RoOyBpKyspIHsKICAgICAgICBfc3VtbWFyeUxpc3QucHVzaCh7fSk7CiAgICAgIH0KICAgICAgX3N1bW1hcnlMaXN0ID0gSlNPTi5zdHJpbmdpZnkoX3N1bW1hcnlMaXN0KTsKCiAgICAgIHZhciBtT2JzZXJ2ZXIgPSBTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIuZ2V0TXV0YXRpb25PYnNlcnZlcigpOwogICAgICBkZXRhaWxzLm9ic2VydmVyID0gbmV3IG1PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHsKICAgICAgICB2YXIgaGFzQ2hhbmdlcyA9IGZhbHNlOwogICAgICAgIHZhciBtdXRhdGlvbjsKICAgICAgICB2YXIgc3VtbWFyeUxpc3QgPSBKU09OLnBhcnNlKF9zdW1tYXJ5TGlzdCk7CiAgICAgICAgd2hpbGUgKG11dGF0aW9uID0gbXV0YXRpb25zLnNoaWZ0KCkpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdtdXRhdGlvbicsIG11dGF0aW9uKTsKICAgICAgICAgIHZhciBpbmRleCA9IGRldGFpbHMuYXR0ci5pbmRleE9mKG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUpOwogICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdmFsdWUgPSBtdXRhdGlvbi50YXJnZXQuZ2V0QXR0cmlidXRlKG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUpOwogICAgICAgICAgaWYgKHZhbHVlID09PSBtdXRhdGlvbi5vbGRWYWx1ZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBzdW1tYXJ5TGlzdFtpbmRleF0gPSB7CiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgb2xkVmFsdWU6IG11dGF0aW9uLm9sZFZhbHVlCiAgICAgICAgICB9OwoKICAgICAgICAgIGhhc0NoYW5nZXMgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaGFzQ2hhbmdlcyA9PT0gdHJ1ZSAmJiBkZXRhaWxzLmNhbGxiYWNrKHN1bW1hcnlMaXN0KTsKICAgICAgfSk7CgogICAgICBkZXRhaWxzLnN0YXJ0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZGV0YWlscy5fZGlzY29ubmVjdCgpOwogICAgICAgIGRldGFpbHMuX2Nvbm5lY3QoKTsKCiAgICAgICAgdmFyIGhhc0NoYW5nZXMgPSBmYWxzZTsKICAgICAgICB2YXIgc3VtbWFyeUxpc3QgPSBKU09OLnBhcnNlKF9zdW1tYXJ5TGlzdCk7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBhdHRyaWJ1dGVOYW1lOyBhdHRyaWJ1dGVOYW1lID0gZGV0YWlscy5hdHRyW2ldOyBpKyspIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IGRldGFpbHMudGFyZ2V0LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lKTsKICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHN1bW1hcnlMaXN0W2ldID0gewogICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgIG9sZFZhbHVlOiBudWxsCiAgICAgICAgICB9OwoKICAgICAgICAgIGhhc0NoYW5nZXMgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaGFzQ2hhbmdlcyA9PT0gdHJ1ZSAmJiBkZXRhaWxzLmNhbGxiYWNrKHN1bW1hcnlMaXN0KTsKICAgICAgfTsKCiAgICAgIGRldGFpbHMuc3RvcCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGRldGFpbHMuX2Rpc2Nvbm5lY3QoKTsKICAgICAgfTsKCiAgICAgIGRldGFpbHMuc3RhcnQoKTsKCiAgICAgIHJldHVybiBkZXRhaWxzOwogICAgfQogIH07CgogIC8qKgogICAqIEBsaWNlbnNlCiAgICogQ29weXJpZ2h0IChjKSAyMDE0IFRoZSBQb2x5bWVyIFByb2plY3QgQXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAgKiBUaGlzIGNvZGUgbWF5IG9ubHkgYmUgdXNlZCB1bmRlciB0aGUgQlNEIHN0eWxlIGxpY2Vuc2UgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0xJQ0VOU0UudHh0CiAgICogVGhlIGNvbXBsZXRlIHNldCBvZiBhdXRob3JzIG1heSBiZSBmb3VuZCBhdCBodHRwOi8vcG9seW1lci5naXRodWIuaW8vQVVUSE9SUy50eHQKICAgKiBUaGUgY29tcGxldGUgc2V0IG9mIGNvbnRyaWJ1dG9ycyBtYXkgYmUgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL0NPTlRSSUJVVE9SUy50eHQKICAgKiBDb2RlIGRpc3RyaWJ1dGVkIGJ5IEdvb2dsZSBhcyBwYXJ0IG9mIHRoZSBwb2x5bWVyIHByb2plY3QgaXMgYWxzbwogICAqIHN1YmplY3QgdG8gYW4gYWRkaXRpb25hbCBJUCByaWdodHMgZ3JhbnQgZm91bmQgYXQgaHR0cDovL3BvbHltZXIuZ2l0aHViLmlvL1BBVEVOVFMudHh0CiAgICovCiAgLy8gQHVybCBodHRwczovL2dpdGh1Yi5jb20vd2ViY29tcG9uZW50cy93ZWJjb21wb25lbnRzanMKICAvLyBAdmVyc2lvbiAwLjcuMTUKICB2YXIgV2Vha01hcCA9ICh0eXBlb2YgV2Vha01hcCAhPT0gJ3VuZGVmaW5lZCcpID8gV2Vha01hcCA6IHVuZGVmaW5lZDsKICBpZiAodHlwZW9mIFdlYWtNYXAgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKICAgICAgdmFyIGNvdW50ZXIgPSBEYXRlLm5vdygpICUgMWU5OwogICAgICBXZWFrTWFwID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5uYW1lID0gIl9fc3QiICsgKE1hdGgucmFuZG9tKCkgKiAxZTkgPj4+IDApICsgKGNvdW50ZXIrKyArICJfXyIpOwogICAgICB9OwogICAgICBXZWFrTWFwLnByb3RvdHlwZSA9IHsKICAgICAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICAgIHZhciBlbnRyeSA9IGtleVt0aGlzLm5hbWVdOwogICAgICAgICAgaWYgKGVudHJ5ICYmIGVudHJ5WzBdID09PSBrZXkpIGVudHJ5WzFdID0gdmFsdWU7CiAgICAgICAgICBlbHNlIGRlZmluZVByb3BlcnR5KGtleSwgdGhpcy5uYW1lLCB7CiAgICAgICAgICAgIHZhbHVlOiBba2V5LCB2YWx1ZV0sCiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCiAgICAgICAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIHZhciBlbnRyeTsKICAgICAgICAgIHJldHVybiAoZW50cnkgPSBrZXlbdGhpcy5uYW1lXSkgJiYgZW50cnlbMF0gPT09IGtleSA/IGVudHJ5WzFdIDogdW5kZWZpbmVkOwogICAgICAgIH0sCiAgICAgICAgImRlbGV0ZSI6IGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgdmFyIGVudHJ5ID0ga2V5W3RoaXMubmFtZV07CiAgICAgICAgICBpZiAoIWVudHJ5IHx8IGVudHJ5WzBdICE9PSBrZXkpIHJldHVybiBmYWxzZTsKICAgICAgICAgIGVudHJ5WzBdID0gZW50cnlbMV0gPSB1bmRlZmluZWQ7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9LAogICAgICAgIGhhczogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICB2YXIgZW50cnkgPSBrZXlbdGhpcy5uYW1lXTsKICAgICAgICAgIGlmICghZW50cnkpIHJldHVybiBmYWxzZTsKICAgICAgICAgIHJldHVybiBlbnRyeVswXSA9PT0ga2V5OwogICAgICAgIH0KICAgICAgfTsKICAgIH0pKCk7CiAgfQoKICB2YXIgSnNNdXRhdGlvbk9ic2VydmVyID0gKHR5cGVvZiBKc011dGF0aW9uT2JzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSA/IEpzTXV0YXRpb25PYnNlcnZlciA6IHVuZGVmaW5lZDsKICAoZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mIEpzTXV0YXRpb25PYnNlcnZlciAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdmFyIHJlZ2lzdHJhdGlvbnNUYWJsZSA9IG5ldyBXZWFrTWFwKCk7CiAgICB2YXIgc2V0SW1tZWRpYXRlOwogICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIC9UcmlkZW50fEVkZ2UvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKICAgICAgc2V0SW1tZWRpYXRlID0gc2V0VGltZW91dDsKICAgIH0gZWxzZSBpZiAod2luZG93LnNldEltbWVkaWF0ZSkgewogICAgICBzZXRJbW1lZGlhdGUgPSB3aW5kb3cuc2V0SW1tZWRpYXRlOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHNldEltbWVkaWF0ZVF1ZXVlID0gW107CiAgICAgIHZhciBzZW50aW5lbCA9IFN0cmluZyhNYXRoLnJhbmRvbSgpKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKGUuZGF0YSA9PT0gc2VudGluZWwpIHsKICAgICAgICAgIHZhciBxdWV1ZSA9IHNldEltbWVkaWF0ZVF1ZXVlOwogICAgICAgICAgc2V0SW1tZWRpYXRlUXVldWUgPSBbXTsKICAgICAgICAgIHF1ZXVlLmZvckVhY2goZnVuY3Rpb24oZnVuYykgewogICAgICAgICAgICBmdW5jKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBzZXRJbW1lZGlhdGUgPSBmdW5jdGlvbihmdW5jKSB7CiAgICAgICAgc2V0SW1tZWRpYXRlUXVldWUucHVzaChmdW5jKTsKICAgICAgICB3aW5kb3cucG9zdE1lc3NhZ2Uoc2VudGluZWwsICIqIik7CiAgICAgIH07CiAgICB9CiAgICB2YXIgaXNTY2hlZHVsZWQgPSBmYWxzZTsKICAgIHZhciBzY2hlZHVsZWRPYnNlcnZlcnMgPSBbXTsKCiAgICBmdW5jdGlvbiBzY2hlZHVsZUNhbGxiYWNrKG9ic2VydmVyKSB7CiAgICAgIHNjaGVkdWxlZE9ic2VydmVycy5wdXNoKG9ic2VydmVyKTsKICAgICAgaWYgKCFpc1NjaGVkdWxlZCkgewogICAgICAgIGlzU2NoZWR1bGVkID0gdHJ1ZTsKICAgICAgICBzZXRJbW1lZGlhdGUoZGlzcGF0Y2hDYWxsYmFja3MpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gd3JhcElmTmVlZGVkKG5vZGUpIHsKICAgICAgcmV0dXJuIHdpbmRvdy5TaGFkb3dET01Qb2x5ZmlsbCAmJiB3aW5kb3cuU2hhZG93RE9NUG9seWZpbGwud3JhcElmTmVlZGVkKG5vZGUpIHx8IG5vZGU7CiAgICB9CgogICAgZnVuY3Rpb24gZGlzcGF0Y2hDYWxsYmFja3MoKSB7CiAgICAgIGlzU2NoZWR1bGVkID0gZmFsc2U7CiAgICAgIHZhciBvYnNlcnZlcnMgPSBzY2hlZHVsZWRPYnNlcnZlcnM7CiAgICAgIHNjaGVkdWxlZE9ic2VydmVycyA9IFtdOwogICAgICBvYnNlcnZlcnMuc29ydChmdW5jdGlvbihvMSwgbzIpIHsKICAgICAgICByZXR1cm4gbzEudWlkXyAtIG8yLnVpZF87CiAgICAgIH0pOwogICAgICB2YXIgYW55Tm9uRW1wdHkgPSBmYWxzZTsKICAgICAgb2JzZXJ2ZXJzLmZvckVhY2goZnVuY3Rpb24ob2JzZXJ2ZXIpIHsKICAgICAgICB2YXIgcXVldWUgPSBvYnNlcnZlci50YWtlUmVjb3JkcygpOwogICAgICAgIHJlbW92ZVRyYW5zaWVudE9ic2VydmVyc0ZvcihvYnNlcnZlcik7CiAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgICAgb2JzZXJ2ZXIuY2FsbGJhY2tfKHF1ZXVlLCBvYnNlcnZlcik7CiAgICAgICAgICBhbnlOb25FbXB0eSA9IHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgaWYgKGFueU5vbkVtcHR5KSBkaXNwYXRjaENhbGxiYWNrcygpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZVRyYW5zaWVudE9ic2VydmVyc0ZvcihvYnNlcnZlcikgewogICAgICBvYnNlcnZlci5ub2Rlc18uZm9yRWFjaChmdW5jdGlvbihub2RlKSB7CiAgICAgICAgdmFyIHJlZ2lzdHJhdGlvbnMgPSByZWdpc3RyYXRpb25zVGFibGUuZ2V0KG5vZGUpOwogICAgICAgIGlmICghcmVnaXN0cmF0aW9ucykgcmV0dXJuOwogICAgICAgIHJlZ2lzdHJhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihyZWdpc3RyYXRpb24pIHsKICAgICAgICAgIGlmIChyZWdpc3RyYXRpb24ub2JzZXJ2ZXIgPT09IG9ic2VydmVyKSByZWdpc3RyYXRpb24ucmVtb3ZlVHJhbnNpZW50T2JzZXJ2ZXJzKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGZvckVhY2hBbmNlc3RvckFuZE9ic2VydmVyRW5xdWV1ZVJlY29yZCh0YXJnZXQsIGNhbGxiYWNrKSB7CiAgICAgIGZvciAodmFyIG5vZGUgPSB0YXJnZXQ7IG5vZGU7IG5vZGUgPSBub2RlLnBhcmVudE5vZGUpIHsKICAgICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQobm9kZSk7CiAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbnMpIHsKICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcmVnaXN0cmF0aW9ucy5sZW5ndGg7IGorKykgewogICAgICAgICAgICB2YXIgcmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uc1tqXTsKICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSByZWdpc3RyYXRpb24ub3B0aW9uczsKICAgICAgICAgICAgaWYgKG5vZGUgIT09IHRhcmdldCAmJiAhb3B0aW9ucy5zdWJ0cmVlKSBjb250aW51ZTsKICAgICAgICAgICAgdmFyIHJlY29yZCA9IGNhbGxiYWNrKG9wdGlvbnMpOwogICAgICAgICAgICBpZiAocmVjb3JkKSByZWdpc3RyYXRpb24uZW5xdWV1ZShyZWNvcmQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdmFyIHVpZENvdW50ZXIgPSAwOwogICAgSnNNdXRhdGlvbk9ic2VydmVyID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgICAgdGhpcy5jYWxsYmFja18gPSBjYWxsYmFjazsKICAgICAgdGhpcy5ub2Rlc18gPSBbXTsKICAgICAgdGhpcy5yZWNvcmRzXyA9IFtdOwogICAgICB0aGlzLnVpZF8gPSArK3VpZENvdW50ZXI7CiAgICB9OwogICAgSnNNdXRhdGlvbk9ic2VydmVyLnByb3RvdHlwZSA9IHsKICAgICAgb2JzZXJ2ZTogZnVuY3Rpb24odGFyZ2V0LCBvcHRpb25zKSB7CiAgICAgICAgdGFyZ2V0ID0gd3JhcElmTmVlZGVkKHRhcmdldCk7CiAgICAgICAgaWYgKCFvcHRpb25zLmNoaWxkTGlzdCAmJiAhb3B0aW9ucy5hdHRyaWJ1dGVzICYmICFvcHRpb25zLmNoYXJhY3RlckRhdGEgfHwgb3B0aW9ucy5hdHRyaWJ1dGVPbGRWYWx1ZSAmJiAhb3B0aW9ucy5hdHRyaWJ1dGVzIHx8IG9wdGlvbnMuYXR0cmlidXRlRmlsdGVyICYmIG9wdGlvbnMuYXR0cmlidXRlRmlsdGVyLmxlbmd0aCAmJiAhb3B0aW9ucy5hdHRyaWJ1dGVzIHx8IG9wdGlvbnMuY2hhcmFjdGVyRGF0YU9sZFZhbHVlICYmICFvcHRpb25zLmNoYXJhY3RlckRhdGEpIHsKICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigpOwogICAgICAgIH0KICAgICAgICB2YXIgcmVnaXN0cmF0aW9ucyA9IHJlZ2lzdHJhdGlvbnNUYWJsZS5nZXQodGFyZ2V0KTsKICAgICAgICBpZiAoIXJlZ2lzdHJhdGlvbnMpIHJlZ2lzdHJhdGlvbnNUYWJsZS5zZXQodGFyZ2V0LCByZWdpc3RyYXRpb25zID0gW10pOwogICAgICAgIHZhciByZWdpc3RyYXRpb247CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWdpc3RyYXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAocmVnaXN0cmF0aW9uc1tpXS5vYnNlcnZlciA9PT0gdGhpcykgewogICAgICAgICAgICByZWdpc3RyYXRpb24gPSByZWdpc3RyYXRpb25zW2ldOwogICAgICAgICAgICByZWdpc3RyYXRpb24ucmVtb3ZlTGlzdGVuZXJzKCk7CiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbi5vcHRpb25zID0gb3B0aW9uczsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghcmVnaXN0cmF0aW9uKSB7CiAgICAgICAgICByZWdpc3RyYXRpb24gPSBuZXcgUmVnaXN0cmF0aW9uKHRoaXMsIHRhcmdldCwgb3B0aW9ucyk7CiAgICAgICAgICByZWdpc3RyYXRpb25zLnB1c2gocmVnaXN0cmF0aW9uKTsKICAgICAgICAgIHRoaXMubm9kZXNfLnB1c2godGFyZ2V0KTsKICAgICAgICB9CiAgICAgICAgcmVnaXN0cmF0aW9uLmFkZExpc3RlbmVycygpOwogICAgICB9LAogICAgICBkaXNjb25uZWN0OiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLm5vZGVzXy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAgIHZhciByZWdpc3RyYXRpb25zID0gcmVnaXN0cmF0aW9uc1RhYmxlLmdldChub2RlKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVnaXN0cmF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgcmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uc1tpXTsKICAgICAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbi5vYnNlcnZlciA9PT0gdGhpcykgewogICAgICAgICAgICAgIHJlZ2lzdHJhdGlvbi5yZW1vdmVMaXN0ZW5lcnMoKTsKICAgICAgICAgICAgICByZWdpc3RyYXRpb25zLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIHRoaXMpOwogICAgICAgIHRoaXMucmVjb3Jkc18gPSBbXTsKICAgICAgfSwKICAgICAgdGFrZVJlY29yZHM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBjb3B5T2ZSZWNvcmRzID0gdGhpcy5yZWNvcmRzXzsKICAgICAgICB0aGlzLnJlY29yZHNfID0gW107CiAgICAgICAgcmV0dXJuIGNvcHlPZlJlY29yZHM7CiAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gTXV0YXRpb25SZWNvcmQodHlwZSwgdGFyZ2V0KSB7CiAgICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0OwogICAgICB0aGlzLmFkZGVkTm9kZXMgPSBbXTsKICAgICAgdGhpcy5yZW1vdmVkTm9kZXMgPSBbXTsKICAgICAgdGhpcy5wcmV2aW91c1NpYmxpbmcgPSBudWxsOwogICAgICB0aGlzLm5leHRTaWJsaW5nID0gbnVsbDsKICAgICAgdGhpcy5hdHRyaWJ1dGVOYW1lID0gbnVsbDsKICAgICAgdGhpcy5hdHRyaWJ1dGVOYW1lc3BhY2UgPSBudWxsOwogICAgICB0aGlzLm9sZFZhbHVlID0gbnVsbDsKICAgIH0KCiAgICBmdW5jdGlvbiBjb3B5TXV0YXRpb25SZWNvcmQob3JpZ2luYWwpIHsKICAgICAgdmFyIHJlY29yZCA9IG5ldyBNdXRhdGlvblJlY29yZChvcmlnaW5hbC50eXBlLCBvcmlnaW5hbC50YXJnZXQpOwogICAgICByZWNvcmQuYWRkZWROb2RlcyA9IG9yaWdpbmFsLmFkZGVkTm9kZXMuc2xpY2UoKTsKICAgICAgcmVjb3JkLnJlbW92ZWROb2RlcyA9IG9yaWdpbmFsLnJlbW92ZWROb2Rlcy5zbGljZSgpOwogICAgICByZWNvcmQucHJldmlvdXNTaWJsaW5nID0gb3JpZ2luYWwucHJldmlvdXNTaWJsaW5nOwogICAgICByZWNvcmQubmV4dFNpYmxpbmcgPSBvcmlnaW5hbC5uZXh0U2libGluZzsKICAgICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWUgPSBvcmlnaW5hbC5hdHRyaWJ1dGVOYW1lOwogICAgICByZWNvcmQuYXR0cmlidXRlTmFtZXNwYWNlID0gb3JpZ2luYWwuYXR0cmlidXRlTmFtZXNwYWNlOwogICAgICByZWNvcmQub2xkVmFsdWUgPSBvcmlnaW5hbC5vbGRWYWx1ZTsKICAgICAgcmV0dXJuIHJlY29yZDsKICAgIH0KICAgIHZhciBjdXJyZW50UmVjb3JkLCByZWNvcmRXaXRoT2xkVmFsdWU7CgogICAgZnVuY3Rpb24gZ2V0UmVjb3JkKHR5cGUsIHRhcmdldCkgewogICAgICByZXR1cm4gY3VycmVudFJlY29yZCA9IG5ldyBNdXRhdGlvblJlY29yZCh0eXBlLCB0YXJnZXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJlY29yZFdpdGhPbGRWYWx1ZShvbGRWYWx1ZSkgewogICAgICBpZiAocmVjb3JkV2l0aE9sZFZhbHVlKSByZXR1cm4gcmVjb3JkV2l0aE9sZFZhbHVlOwogICAgICByZWNvcmRXaXRoT2xkVmFsdWUgPSBjb3B5TXV0YXRpb25SZWNvcmQoY3VycmVudFJlY29yZCk7CiAgICAgIHJlY29yZFdpdGhPbGRWYWx1ZS5vbGRWYWx1ZSA9IG9sZFZhbHVlOwogICAgICByZXR1cm4gcmVjb3JkV2l0aE9sZFZhbHVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNsZWFyUmVjb3JkcygpIHsKICAgICAgY3VycmVudFJlY29yZCA9IHJlY29yZFdpdGhPbGRWYWx1ZSA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBmdW5jdGlvbiByZWNvcmRSZXByZXNlbnRzQ3VycmVudE11dGF0aW9uKHJlY29yZCkgewogICAgICByZXR1cm4gcmVjb3JkID09PSByZWNvcmRXaXRoT2xkVmFsdWUgfHwgcmVjb3JkID09PSBjdXJyZW50UmVjb3JkOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGVjdFJlY29yZChsYXN0UmVjb3JkLCBuZXdSZWNvcmQpIHsKICAgICAgaWYgKGxhc3RSZWNvcmQgPT09IG5ld1JlY29yZCkgcmV0dXJuIGxhc3RSZWNvcmQ7CiAgICAgIGlmIChyZWNvcmRXaXRoT2xkVmFsdWUgJiYgcmVjb3JkUmVwcmVzZW50c0N1cnJlbnRNdXRhdGlvbihsYXN0UmVjb3JkKSkgcmV0dXJuIHJlY29yZFdpdGhPbGRWYWx1ZTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgZnVuY3Rpb24gUmVnaXN0cmF0aW9uKG9ic2VydmVyLCB0YXJnZXQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyOwogICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDsKICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgdGhpcy50cmFuc2llbnRPYnNlcnZlZE5vZGVzID0gW107CiAgICB9CiAgICBSZWdpc3RyYXRpb24ucHJvdG90eXBlID0gewogICAgICBlbnF1ZXVlOiBmdW5jdGlvbihyZWNvcmQpIHsKICAgICAgICB2YXIgcmVjb3JkcyA9IHRoaXMub2JzZXJ2ZXIucmVjb3Jkc187CiAgICAgICAgdmFyIGxlbmd0aCA9IHJlY29yZHMubGVuZ3RoOwogICAgICAgIGlmIChyZWNvcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciBsYXN0UmVjb3JkID0gcmVjb3Jkc1tsZW5ndGggLSAxXTsKICAgICAgICAgIHZhciByZWNvcmRUb1JlcGxhY2VMYXN0ID0gc2VsZWN0UmVjb3JkKGxhc3RSZWNvcmQsIHJlY29yZCk7CiAgICAgICAgICBpZiAocmVjb3JkVG9SZXBsYWNlTGFzdCkgewogICAgICAgICAgICByZWNvcmRzW2xlbmd0aCAtIDFdID0gcmVjb3JkVG9SZXBsYWNlTGFzdDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzY2hlZHVsZUNhbGxiYWNrKHRoaXMub2JzZXJ2ZXIpOwogICAgICAgIH0KICAgICAgICByZWNvcmRzW2xlbmd0aF0gPSByZWNvcmQ7CiAgICAgIH0sCiAgICAgIGFkZExpc3RlbmVyczogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcnNfKHRoaXMudGFyZ2V0KTsKICAgICAgfSwKICAgICAgYWRkTGlzdGVuZXJzXzogZnVuY3Rpb24obm9kZSkgewogICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zOwogICAgICAgIGlmIChvcHRpb25zLmF0dHJpYnV0ZXMpIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQXR0ck1vZGlmaWVkIiwgdGhpcywgdHJ1ZSk7CiAgICAgICAgaWYgKG9wdGlvbnMuY2hhcmFjdGVyRGF0YSkgbm9kZS5hZGRFdmVudExpc3RlbmVyKCJET01DaGFyYWN0ZXJEYXRhTW9kaWZpZWQiLCB0aGlzLCB0cnVlKTsKICAgICAgICBpZiAob3B0aW9ucy5jaGlsZExpc3QpIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcigiRE9NTm9kZUluc2VydGVkIiwgdGhpcywgdHJ1ZSk7CiAgICAgICAgaWYgKG9wdGlvbnMuY2hpbGRMaXN0IHx8IG9wdGlvbnMuc3VidHJlZSkgbm9kZS5hZGRFdmVudExpc3RlbmVyKCJET01Ob2RlUmVtb3ZlZCIsIHRoaXMsIHRydWUpOwogICAgICB9LAogICAgICByZW1vdmVMaXN0ZW5lcnM6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXJzXyh0aGlzLnRhcmdldCk7CiAgICAgIH0sCiAgICAgIHJlbW92ZUxpc3RlbmVyc186IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKICAgICAgICBpZiAob3B0aW9ucy5hdHRyaWJ1dGVzKSBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTUF0dHJNb2RpZmllZCIsIHRoaXMsIHRydWUpOwogICAgICAgIGlmIChvcHRpb25zLmNoYXJhY3RlckRhdGEpIG5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ2hhcmFjdGVyRGF0YU1vZGlmaWVkIiwgdGhpcywgdHJ1ZSk7CiAgICAgICAgaWYgKG9wdGlvbnMuY2hpbGRMaXN0KSBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoIkRPTU5vZGVJbnNlcnRlZCIsIHRoaXMsIHRydWUpOwogICAgICAgIGlmIChvcHRpb25zLmNoaWxkTGlzdCB8fCBvcHRpb25zLnN1YnRyZWUpIG5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NTm9kZVJlbW92ZWQiLCB0aGlzLCB0cnVlKTsKICAgICAgfSwKICAgICAgYWRkVHJhbnNpZW50T2JzZXJ2ZXI6IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICBpZiAobm9kZSA9PT0gdGhpcy50YXJnZXQpIHJldHVybjsKICAgICAgICB0aGlzLmFkZExpc3RlbmVyc18obm9kZSk7CiAgICAgICAgdGhpcy50cmFuc2llbnRPYnNlcnZlZE5vZGVzLnB1c2gobm9kZSk7CiAgICAgICAgdmFyIHJlZ2lzdHJhdGlvbnMgPSByZWdpc3RyYXRpb25zVGFibGUuZ2V0KG5vZGUpOwogICAgICAgIGlmICghcmVnaXN0cmF0aW9ucykgcmVnaXN0cmF0aW9uc1RhYmxlLnNldChub2RlLCByZWdpc3RyYXRpb25zID0gW10pOwogICAgICAgIHJlZ2lzdHJhdGlvbnMucHVzaCh0aGlzKTsKICAgICAgfSwKICAgICAgcmVtb3ZlVHJhbnNpZW50T2JzZXJ2ZXJzOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdHJhbnNpZW50T2JzZXJ2ZWROb2RlcyA9IHRoaXMudHJhbnNpZW50T2JzZXJ2ZWROb2RlczsKICAgICAgICB0aGlzLnRyYW5zaWVudE9ic2VydmVkTm9kZXMgPSBbXTsKICAgICAgICB0cmFuc2llbnRPYnNlcnZlZE5vZGVzLmZvckVhY2goZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5lcnNfKG5vZGUpOwogICAgICAgICAgdmFyIHJlZ2lzdHJhdGlvbnMgPSByZWdpc3RyYXRpb25zVGFibGUuZ2V0KG5vZGUpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWdpc3RyYXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChyZWdpc3RyYXRpb25zW2ldID09PSB0aGlzKSB7CiAgICAgICAgICAgICAgcmVnaXN0cmF0aW9ucy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCB0aGlzKTsKICAgICAgfSwKICAgICAgaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgIHN3aXRjaCAoZS50eXBlKSB7CiAgICAgICAgICBjYXNlICJET01BdHRyTW9kaWZpZWQiOgogICAgICAgICAgICB2YXIgbmFtZSA9IGUuYXR0ck5hbWU7CiAgICAgICAgICAgIHZhciBuYW1lc3BhY2UgPSBlLnJlbGF0ZWROb2RlLm5hbWVzcGFjZVVSSTsKICAgICAgICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0OwogICAgICAgICAgICB2YXIgcmVjb3JkID0gbmV3IGdldFJlY29yZCgiYXR0cmlidXRlcyIsIHRhcmdldCk7CiAgICAgICAgICAgIHJlY29yZC5hdHRyaWJ1dGVOYW1lID0gbmFtZTsKICAgICAgICAgICAgcmVjb3JkLmF0dHJpYnV0ZU5hbWVzcGFjZSA9IG5hbWVzcGFjZTsKICAgICAgICAgICAgdmFyIG9sZFZhbHVlID0gZS5hdHRyQ2hhbmdlID09PSBNdXRhdGlvbkV2ZW50LkFERElUSU9OID8gbnVsbCA6IGUucHJldlZhbHVlOwogICAgICAgICAgICBmb3JFYWNoQW5jZXN0b3JBbmRPYnNlcnZlckVucXVldWVSZWNvcmQodGFyZ2V0LCBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmF0dHJpYnV0ZXMpIHJldHVybjsKICAgICAgICAgICAgICBpZiAob3B0aW9ucy5hdHRyaWJ1dGVGaWx0ZXIgJiYgb3B0aW9ucy5hdHRyaWJ1dGVGaWx0ZXIubGVuZ3RoICYmIG9wdGlvbnMuYXR0cmlidXRlRmlsdGVyLmluZGV4T2YobmFtZSkgPT09IC0xICYmIG9wdGlvbnMuYXR0cmlidXRlRmlsdGVyLmluZGV4T2YobmFtZXNwYWNlKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYXR0cmlidXRlT2xkVmFsdWUpIHJldHVybiBnZXRSZWNvcmRXaXRoT2xkVmFsdWUob2xkVmFsdWUpOwogICAgICAgICAgICAgIHJldHVybiByZWNvcmQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICJET01DaGFyYWN0ZXJEYXRhTW9kaWZpZWQiOgogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7CiAgICAgICAgICAgIHZhciByZWNvcmQgPSBnZXRSZWNvcmQoImNoYXJhY3RlckRhdGEiLCB0YXJnZXQpOwogICAgICAgICAgICB2YXIgb2xkVmFsdWUgPSBlLnByZXZWYWx1ZTsKICAgICAgICAgICAgZm9yRWFjaEFuY2VzdG9yQW5kT2JzZXJ2ZXJFbnF1ZXVlUmVjb3JkKHRhcmdldCwgZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICAgIGlmICghb3B0aW9ucy5jaGFyYWN0ZXJEYXRhKSByZXR1cm47CiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY2hhcmFjdGVyRGF0YU9sZFZhbHVlKSByZXR1cm4gZ2V0UmVjb3JkV2l0aE9sZFZhbHVlKG9sZFZhbHVlKTsKICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAiRE9NTm9kZVJlbW92ZWQiOgogICAgICAgICAgICB0aGlzLmFkZFRyYW5zaWVudE9ic2VydmVyKGUudGFyZ2V0KTsKCiAgICAgICAgICBjYXNlICJET01Ob2RlSW5zZXJ0ZWQiOgogICAgICAgICAgICB2YXIgY2hhbmdlZE5vZGUgPSBlLnRhcmdldDsKICAgICAgICAgICAgdmFyIGFkZGVkTm9kZXMsIHJlbW92ZWROb2RlczsKICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gIkRPTU5vZGVJbnNlcnRlZCIpIHsKICAgICAgICAgICAgICBhZGRlZE5vZGVzID0gW2NoYW5nZWROb2RlXTsKICAgICAgICAgICAgICByZW1vdmVkTm9kZXMgPSBbXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBhZGRlZE5vZGVzID0gW107CiAgICAgICAgICAgICAgcmVtb3ZlZE5vZGVzID0gW2NoYW5nZWROb2RlXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcHJldmlvdXNTaWJsaW5nID0gY2hhbmdlZE5vZGUucHJldmlvdXNTaWJsaW5nOwogICAgICAgICAgICB2YXIgbmV4dFNpYmxpbmcgPSBjaGFuZ2VkTm9kZS5uZXh0U2libGluZzsKICAgICAgICAgICAgdmFyIHJlY29yZCA9IGdldFJlY29yZCgiY2hpbGRMaXN0IiwgZS50YXJnZXQucGFyZW50Tm9kZSk7CiAgICAgICAgICAgIHJlY29yZC5hZGRlZE5vZGVzID0gYWRkZWROb2RlczsKICAgICAgICAgICAgcmVjb3JkLnJlbW92ZWROb2RlcyA9IHJlbW92ZWROb2RlczsKICAgICAgICAgICAgcmVjb3JkLnByZXZpb3VzU2libGluZyA9IHByZXZpb3VzU2libGluZzsKICAgICAgICAgICAgcmVjb3JkLm5leHRTaWJsaW5nID0gbmV4dFNpYmxpbmc7CiAgICAgICAgICAgIGZvckVhY2hBbmNlc3RvckFuZE9ic2VydmVyRW5xdWV1ZVJlY29yZChlLnJlbGF0ZWROb2RlLCBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLmNoaWxkTGlzdCkgcmV0dXJuOwogICAgICAgICAgICAgIHJldHVybiByZWNvcmQ7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBjbGVhclJlY29yZHMoKTsKICAgICAgfQogICAgfTsKICB9KSgpOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgnZGFpbHltb3Rpb24nLCBmdW5jdGlvbihtb2R1bGVOYW1lLCBpbml0RGF0YSkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsYW5ndWFnZSA9IGluaXREYXRhLmdldExhbmd1YWdlOwogICAgdmFyIHByZWZlcmVuY2UgPSBpbml0RGF0YS5nZXRQcmVmZXJlbmNlOwogICAgdmFyIG1vZHVsZVN0YXRlID0gcHJlZmVyZW5jZS5tb2R1bGVEYWlseW1vdGlvbiA/IDEgOiAwOwoKICAgIHZhciBpZnJhbWUgPSBtb25vLmlzSWZyYW1lKCkgJiYgL1wvZW1iZWRcLyhbXHdcLV0rKS9pLnRlc3QoZG9jdW1lbnQubG9jYXRpb24uaHJlZik7CgogICAgbW9uby5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnZ2V0TW9kdWxlSW5mbycpIHsKICAgICAgICBpZiAobWVzc2FnZS51cmwgIT09IGxvY2F0aW9uLmhyZWYpIHJldHVybjsKICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgc3RhdGU6IG1vZHVsZVN0YXRlLAogICAgICAgICAgbW9kdWxlTmFtZTogbW9kdWxlTmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2NoYW5nZVN0YXRlJykgewogICAgICAgIGlmIChtb2R1bGVOYW1lICE9PSBtZXNzYWdlLm1vZHVsZU5hbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhaWx5bW90aW9uLmNoYW5nZVN0YXRlKG1lc3NhZ2Uuc3RhdGUpOwogICAgICB9CiAgICAgIGlmICghbW9kdWxlU3RhdGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAndXBkYXRlTGlua3MnKSB7CiAgICAgICAgZGFpbHltb3Rpb24udXBkYXRlTGlua3MoKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKG1vZHVsZVN0YXRlKSB7CiAgICAgIG1vbm8uYXN5bmNDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgIGRhaWx5bW90aW9uLnJ1bigpOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgZGFpbHltb3Rpb24gPSB7CiAgICAgIGNvbnRleHRNZW51OiBudWxsLAogICAgICBsaW5rQ2FjaGU6IHt9LAogICAgICBlbWJlZDogbnVsbCwKICAgICAgdGl0bGU6ICcnLAogICAgICBzdHlsZUluZGV4OiAwLAogICAgICBidG5JZDogJ3NmX19kb3dubG9hZF9idG4nLAogICAgICByZXN1bHQ6IG51bGwsCiAgICAgIHBvcHVwSXNTaG93OiBmYWxzZSwKCiAgICAgIHJ1bjogZnVuY3Rpb24oKSB7CiAgICAgICAgbW9kdWxlU3RhdGUgPSAxOwogICAgICAgIGlmIChpZnJhbWUpIHsKICAgICAgICAgIGRhaWx5bW90aW9uLmFwcGVuZElmcmFtZUJ1dHRvbnMoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIuaXNBdmFpbGFibGUoKSkgewogICAgICAgICAgcmV0dXJuIGRhaWx5bW90aW9uLm11dGF0aW9uTW9kZS5lbmFibGUoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNoYW5nZVN0YXRlOiBmdW5jdGlvbihzdGF0ZSkgewogICAgICAgIGlmIChpZnJhbWUpIHJldHVybjsKICAgICAgICBtb2R1bGVTdGF0ZSA9IHN0YXRlOwogICAgICAgIGRhaWx5bW90aW9uLnJtQnRuKCk7CiAgICAgICAgZGFpbHltb3Rpb24ubXV0YXRpb25Nb2RlLnN0b3AoKTsKICAgICAgICBpZiAoc3RhdGUpIHsKICAgICAgICAgIGRhaWx5bW90aW9uLnJ1bigpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGhpZGVNZW51OiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoZGFpbHltb3Rpb24uY29udGV4dE1lbnUgJiYgZGFpbHltb3Rpb24uY29udGV4dE1lbnUuaXNTaG93KSB7CiAgICAgICAgICBkYWlseW1vdGlvbi5jb250ZXh0TWVudS5oaWRlKCk7CiAgICAgICAgICBkYWlseW1vdGlvbi5jb250ZXh0TWVudSA9IG51bGw7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgdXBkYXRlTGlua3M6IGZ1bmN0aW9uKCkgewogICAgICAgIGRhaWx5bW90aW9uLmNoYW5nZVN0YXRlKDApOwogICAgICAgIGRhaWx5bW90aW9uLmNoYW5nZVN0YXRlKDEpOwogICAgICB9LAoKICAgICAgYXBwZW5kSWZyYW1lQnV0dG9uczogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgYnRuT2JqID0gU2F2ZUZyb21fVXRpbHMuZnJhbWVNZW51LmdldEJ0bih7CiAgICAgICAgICBxdWlja0J0blN0eWxlT2JqOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJywKICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsCiAgICAgICAgICAgIHBhZGRpbmc6ICc5cHggMTBweCcKICAgICAgICAgIH0sCiAgICAgICAgICBxdWlja0J0bkNzc1N0eWxlOiB7CiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMCwwLDAsLjc1KScKICAgICAgICAgIH0sCiAgICAgICAgICBzaW5nbGVCdG46IHRydWUsCiAgICAgICAgICBidG5JZDogX3RoaXMuYnRuSWQsCiAgICAgICAgICBjb250YWluZXJTdHlsZTogewogICAgICAgICAgICByaWdodDogJzUwcHgnLAogICAgICAgICAgICB0b3A6ICcxMHB4JwogICAgICAgICAgfSwKICAgICAgICAgIHF1aWNrQnRuSWNvbjogbW9uby5jcmVhdGUoU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFN2ZygnZG93bmxvYWQnLCAnI2ZmZmZmZicpLCB7CiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgd2lkdGg6ICcxNnB4JywKICAgICAgICAgICAgICBoZWlnaHQ6ICcxNnB4JywKICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIG9uOiBbCiAgICAgICAgICAgIFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgICAgIGlmIChfdGhpcy5jb250ZXh0TWVudSAmJiBfdGhpcy5jb250ZXh0TWVudS5pc1Nob3cpIHsKICAgICAgICAgICAgICAgIF90aGlzLmhpZGVNZW51KCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgaWQgPSBfdGhpcy5nZXRJZEZyb21VcmwoKTsKICAgICAgICAgICAgICB2YXIgbGlua3MgPSBsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJzsKICAgICAgICAgICAgICB2YXIgZnJvbUNhY2hlID0gX3RoaXMubGlua0NhY2hlW2lkXTsKICAgICAgICAgICAgICBpZiAoZnJvbUNhY2hlKSB7CiAgICAgICAgICAgICAgICBsaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MuZGFpbHltb3Rpb24oZnJvbUNhY2hlLmxpbmtzLCBmcm9tQ2FjaGUudGl0bGUpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIG1lbnUgPSBfdGhpcy5jb250ZXh0TWVudSA9IFNhdmVGcm9tX1V0aWxzLmZyYW1lTWVudS5nZXRNZW51KHRoaXMsIGxpbmtzLCAnc2YtZnJhbWUtbWVudScsIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogYnRuT2JqLmNvbnRhaW5lciwKICAgICAgICAgICAgICAgIG9uU2hvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGJ0bk9iai5ub2RlLmNsYXNzTGlzdC5hZGQoJ3NmLW92ZXInKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbkhpZGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZXh0TWVudSA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGJ0bk9iai5ub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3NmLW92ZXInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKCFmcm9tQ2FjaGUpIHsKICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBhY3Rpb246ICdnZXREYWlseW1vdGlvbkxpbmtzJywKICAgICAgICAgICAgICAgICAgZXh0VmlkZW9JZDogaWQsCiAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBfdGhpcy5nZXRNZXRhZGF0YShpZCkKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBtZW51TGlua3MgPSBsYW5ndWFnZS5ub0xpbmtzRm91bmQ7CiAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5saW5rcykgewogICAgICAgICAgICAgICAgICAgIF90aGlzLmxpbmtDYWNoZVtpZF0gPSByZXNwb25zZTsKICAgICAgICAgICAgICAgICAgICBtZW51TGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzLmRhaWx5bW90aW9uKHJlc3BvbnNlLmxpbmtzLCByZXNwb25zZS50aXRsZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbWVudS51cGRhdGUobWVudUxpbmtzKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIFsnbW91c2Vkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgaWYgKGUuYnV0dG9uID09PSAyKSB7CiAgICAgICAgICAgICAgICBtb25vLm9mZihkb2N1bWVudC5ib2R5LCAnbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpOwoKICAgICAgICAgICAgICAgIF90aGlzLmhpZGVNZW51KCk7CgogICAgICAgICAgICAgICAgaWYgKGJ0bk9iai5jb250YWluZXIucGFyZW50Tm9kZSkgewogICAgICAgICAgICAgICAgICBidG5PYmouY29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYnRuT2JqLmNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XQogICAgICAgICAgXQogICAgICAgIH0pOwoKICAgICAgICBidG5PYmoucXVpY2tCdG4udGl0bGUgPSBsYW5ndWFnZS5kb3dubG9hZDsKCiAgICAgICAgYnRuT2JqLmNvbnRhaW5lciA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICBjbGFzczogJ3NmLWJ0bi1jdHInLAogICAgICAgICAgYXBwZW5kOiBidG5PYmoubm9kZQogICAgICAgIH0pOwoKICAgICAgICBtb25vLm9uKGJ0bk9iai5jb250YWluZXIsICdtb3VzZWVudGVyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBidG5PYmoubG9ja0hpZGUgPSB0cnVlOwogICAgICAgIH0pOwoKICAgICAgICBtb25vLm9uKGJ0bk9iai5jb250YWluZXIsICdtb3VzZWxlYXZlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBidG5PYmoubG9ja0hpZGUgPSBmYWxzZTsKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGhpZGVUaW1lb3V0ID0gbnVsbDsKICAgICAgICB2YXIgaGFzQ2xhc3NOYW1lID0gZmFsc2U7CiAgICAgICAgdmFyIHRpbWVvdXRGbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFidG5PYmoubG9ja0hpZGUpIHsKICAgICAgICAgICAgYnRuT2JqLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdzZi1oaWRlLXVpJyk7CiAgICAgICAgICAgIGhhc0NsYXNzTmFtZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB2YXIgb25Nb3VzZU1vdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChoYXNDbGFzc05hbWUpIHsKICAgICAgICAgICAgYnRuT2JqLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzZi1oaWRlLXVpJyk7CiAgICAgICAgICAgIGhhc0NsYXNzTmFtZSA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGNsZWFyVGltZW91dChoaWRlVGltZW91dCk7CiAgICAgICAgICBoaWRlVGltZW91dCA9IHNldFRpbWVvdXQodGltZW91dEZuLCAzICogMTAwMCk7CiAgICAgICAgfTsKICAgICAgICBtb25vLm9uKGRvY3VtZW50LmJvZHksICdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSk7CgogICAgICAgIGJ0bk9iai5ub2RlLmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dChbewogICAgICAgICAgICBzZWxlY3RvcjogWwogICAgICAgICAgICAgICdib2R5OmhvdmVyIC5zZi1idG4tY3RyOm5vdCguc2YtaGlkZS11aSkgIycgKyBfdGhpcy5idG5JZCwKICAgICAgICAgICAgICAnYm9keTpob3ZlciAuc2YtYnRuLWN0cjpub3QoLnNmLWhpZGUtdWkpIC5zZi1mcmFtZS1tZW51JwogICAgICAgICAgICBdLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycKICAgICAgICAgICAgfQogICAgICAgICAgfV0pCiAgICAgICAgfSkpOwoKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGJ0bk9iai5jb250YWluZXIpOwogICAgICB9LAoKICAgICAgZ2V0SWRGcm9tVXJsOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICB1cmwgPSB1cmwgfHwgbG9jYXRpb24uaHJlZjsKICAgICAgICB2YXIgdmlkZW9JZCA9IHVybC5tYXRjaCgvXC9lbWJlZFwvdmlkZW9cLyhbYS16MC05XSspLyk7CiAgICAgICAgdmlkZW9JZCA9IHZpZGVvSWQgJiYgdmlkZW9JZFsxXTsKICAgICAgICByZXR1cm4gdmlkZW9JZDsKICAgICAgfSwKCiAgICAgIGdldFZpZGVvSWQ6IGZ1bmN0aW9uKGRldGFpbHMpIHsKICAgICAgICBpZiAoZGV0YWlscy5zdHlsZUluZGV4ID09PSA0IHx8IGRldGFpbHMuc3R5bGVJbmRleCA9PT0gMykgewogICAgICAgICAgLy8gcGxheWxpc3QKICAgICAgICAgIHZhciBwbGF5ZXJWNUZyYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsX3ZpZGVvc19saXN0d2l0aHBsYXllciAjcGxheWVyX2NvbnRhaW5lciAjcGxheWVydjUtaWZyYW1lJyk7CiAgICAgICAgICBpZiAoIXBsYXllclY1RnJhbWUpIHsKICAgICAgICAgICAgLy8gY2hhbm5lbAogICAgICAgICAgICBwbGF5ZXJWNUZyYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZlYXR1cmVkLXZpZGVvIC5wbGF5ZXIgaWZyYW1lJyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocGxheWVyVjVGcmFtZSkgewogICAgICAgICAgICB2YXIgc3JjID0gcGxheWVyVjVGcmFtZS5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICcnOwogICAgICAgICAgICB2YXIgdmlkZW9JZCA9IHRoaXMuZ2V0SWRGcm9tVXJsKHNyYyk7CiAgICAgICAgICAgIGlmICh2aWRlb0lkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZpZGVvSWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBwbGF5ZXJOb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BsYXllciBlbWJlZCcpOwogICAgICAgIGlmIChwbGF5ZXJOb2RlKSB7CiAgICAgICAgICB2YXIgZmFsc2h2YXJzID0gcGxheWVyTm9kZS5nZXRBdHRyaWJ1dGUoJ2ZsYXNodmFycycpOwogICAgICAgICAgaWYgKGZhbHNodmFycykgewogICAgICAgICAgICB2YXIgcGFyYW1zID0gbW9uby5wYXJzZVVybChmYWxzaHZhcnMsIHsKICAgICAgICAgICAgICBwYXJhbXM6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChwYXJhbXMuY29uZmlnKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHBhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zLmNvbmZpZyk7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1zLm1ldGFkYXRhLmlkOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHZpZGVvIHBhZ2UKICAgICAgICB2YXIgcGxheWVyVGl0bGVMaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BsYXllciBhLmRtcF9TdGFydFZpZXctbG9nbycpOwogICAgICAgIGlmIChwbGF5ZXJUaXRsZUxpbmspIHsKICAgICAgICAgIHZhciByZXF1ZXN0ID0gU2F2ZUZyb21fVXRpbHMuZW1iZWREb3dubG9hZGVyLmNoZWNrVXJsKHBsYXllclRpdGxlTGluay5ocmVmKTsKICAgICAgICAgIGlmIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0LmV4dFZpZGVvSWQ7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSwKCiAgICAgIGdldE1ldGFkYXRhOiBmdW5jdGlvbihpZCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgbWV0YWRhdGEgPSBudWxsOwogICAgICAgIHZhciBzY3JpcHRMaXN0ID0gbW9uby5nZXRQYWdlU2NyaXB0KGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MLCAvcGxheWVyVjUvKTsKICAgICAgICBzY3JpcHRMaXN0LnNvbWUoZnVuY3Rpb24oc2NyaXB0KSB7CiAgICAgICAgICB2YXIganNvbkxpc3QgPSBtb25vLmZpbmRKc29uKHNjcmlwdCk7CiAgICAgICAgICByZXR1cm4ganNvbkxpc3Quc29tZShmdW5jdGlvbihqc29uKSB7CiAgICAgICAgICAgIGlmIChqc29uICYmIGpzb24ubWV0YWRhdGEgJiYganNvbi5tZXRhZGF0YS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgICBtZXRhZGF0YSA9IGpzb24ubWV0YWRhdGE7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBtZXRhZGF0YTsKICAgICAgfSwKCiAgICAgIGFwcGVuZEJ0bjogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIGJ0bkNvbnRhaW5lciA9IGRldGFpbHMuYnRuQ29udGFpbmVyOwoKICAgICAgICBpZiAoIWJ0bkNvbnRhaW5lcikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0eWxlSW5kZXggPSBkZXRhaWxzLnN0eWxlSW5kZXg7CgogICAgICAgIHZhciBvbGRCdG4gPSBidG5Db250YWluZXIucXVlcnlTZWxlY3RvcignIycgKyBkYWlseW1vdGlvbi5idG5JZCk7CgogICAgICAgIHZhciBjdXN0b21TdHlsZSA9IHt9OwoKICAgICAgICBpZiAoc3R5bGVJbmRleCA9PT0gNCkgewogICAgICAgICAgbW9uby5leHRlbmQoY3VzdG9tU3R5bGUsIHsKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIGhlaWdodDogJzI1cHgnLAogICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246ICdjZW50ZXInLAogICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAnbm8tcmVwZWF0JywKICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JywKICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjODA4MDgwJykgKyAnKScKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChzdHlsZUluZGV4ID09PSA0KSB7CiAgICAgICAgICAgIG1vbm8uZXh0ZW5kKGN1c3RvbVN0eWxlLCB7CiAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJzZweCcsCiAgICAgICAgICAgICAgaGVpZ2h0OiAnMjJweCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3R5bGVJbmRleCA9PT0gNSkgewogICAgICAgICAgbW9uby5leHRlbmQoY3VzdG9tU3R5bGUsIHsKICAgICAgICAgICAgcGFkZGluZzogJzAgNXB4JywKICAgICAgICAgICAgY3NzRmxvYXQ6ICdsZWZ0JywKICAgICAgICAgICAgbWFyZ2luTGVmdDogJzEwcHgnCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciB0YWdOYW1lID0gJ2EnOwoKICAgICAgICBpZiAoc3R5bGVJbmRleCA9PT0gNSkgewogICAgICAgICAgdGFnTmFtZSA9ICdidXR0b24nOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNsYXNzTGlzdCA9IFtdOwoKICAgICAgICBpZiAoc3R5bGVJbmRleCA9PT0gNCkgewogICAgICAgICAgY2xhc3NMaXN0LnB1c2goJ2J0bicpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0eWxlSW5kZXggPT09IDUpIHsKICAgICAgICAgIGNsYXNzTGlzdC5wdXNoKCdidXR0b24nKTsKICAgICAgICB9CgogICAgICAgIHZhciBidXR0b25Ob2RlID0gbW9uby5jcmVhdGUodGFnTmFtZSwgewogICAgICAgICAgaWQ6IGRhaWx5bW90aW9uLmJ0bklkLAogICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgY2xhc3M6IGNsYXNzTGlzdCwKICAgICAgICAgIHRpdGxlOiBsYW5ndWFnZS5kb3dubG9hZCwKICAgICAgICAgIHN0eWxlOiBjdXN0b21TdHlsZSwKICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgICBpZiAoZGFpbHltb3Rpb24uY29udGV4dE1lbnUgJiYgZGFpbHltb3Rpb24uY29udGV4dE1lbnUuaXNTaG93KSB7CiAgICAgICAgICAgICAgZGFpbHltb3Rpb24uaGlkZU1lbnUoKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpZCA9IGRhaWx5bW90aW9uLmdldFZpZGVvSWQoZGV0YWlscyk7CgogICAgICAgICAgICB2YXIgbGlua3MgPSBsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJzsKICAgICAgICAgICAgdmFyIGZyb21DYWNoZSA9IGRhaWx5bW90aW9uLmxpbmtDYWNoZVtpZF07CiAgICAgICAgICAgIGlmIChmcm9tQ2FjaGUpIHsKICAgICAgICAgICAgICBsaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MuZGFpbHltb3Rpb24oZnJvbUNhY2hlLmxpbmtzLCBmcm9tQ2FjaGUudGl0bGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbWVudSA9IGRhaWx5bW90aW9uLmNvbnRleHRNZW51ID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnF1aWNrSW5zZXJ0KHRoaXMsIGxpbmtzLCAnc2YtcG9wdXBNZW51Jyk7CgogICAgICAgICAgICBpZiAoZnJvbUNhY2hlKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbWV0YWRhdGEgPSBfdGhpcy5nZXRNZXRhZGF0YShpZCk7CgogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICdnZXREYWlseW1vdGlvbkxpbmtzJywKICAgICAgICAgICAgICBleHRWaWRlb0lkOiBpZCwKICAgICAgICAgICAgICBtZXRhZGF0YTogbWV0YWRhdGEKICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubGlua3MpIHsKICAgICAgICAgICAgICAgIGRhaWx5bW90aW9uLmxpbmtDYWNoZVtpZF0gPSByZXNwb25zZTsKICAgICAgICAgICAgICAgIHZhciBtZW51TGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzLmRhaWx5bW90aW9uKHJlc3BvbnNlLmxpbmtzLCByZXNwb25zZS50aXRsZSk7CiAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtZW51TGlua3MpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBtZW51LnVwZGF0ZShsYW5ndWFnZS5ub0xpbmtzRm91bmQpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgICBpZiAoc3R5bGVJbmRleCA9PT0gNCkgewogICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICAgICAgZWM6ICdkYWlseW1vdGlvbicsCiAgICAgICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgICAgICBlbDogJ3ZpZGVvLXBsYXlsaXN0JwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgaWYgKHN0eWxlSW5kZXggPT09IDUpIHsKICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICAgIGVjOiAnZGFpbHltb3Rpb24nLAogICAgICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICAgICAgZWw6ICd2aWRlby1zaW5nbGUnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBpZiAoc3R5bGVJbmRleCA9PT0gMykgewogICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICAgICAgZWM6ICdkYWlseW1vdGlvbicsCiAgICAgICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgICAgICBlbDogJ3ZpZGVvLWNoZW5uYWwnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH1dCiAgICAgICAgfSk7CgogICAgICAgIGlmIChzdHlsZUluZGV4ID09PSAzKSB7CiAgICAgICAgICBidXR0b25Ob2RlLnRleHRDb250ZW50ID0gbGFuZ3VhZ2UuZG93bmxvYWQ7CiAgICAgICAgICBidXR0b25Ob2RlID0gbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICAgIGNsYXNzOiAnc2Ytd3JhcHBlcicsCiAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICcg4oCiICcsCiAgICAgICAgICAgICAgYnV0dG9uTm9kZQogICAgICAgICAgICBdCiAgICAgICAgICB9KQogICAgICAgIH0KCiAgICAgICAgaWYgKHN0eWxlSW5kZXggPT09IDUpIHsKICAgICAgICAgIG1vbm8uY3JlYXRlKGJ1dHRvbk5vZGUsIHsKICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2ltZycsIHsKICAgICAgICAgICAgICAgIHRpdGxlOiBsYW5ndWFnZS5kb3dubG9hZCwKICAgICAgICAgICAgICAgIHNyYzogU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnIzgwODA4MCcpLAogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxMnB4JywKICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTJweCcsCiAgICAgICAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICdtaWRkbGUnLAogICAgICAgICAgICAgICAgICBvcGFjaXR5OiAnMC45JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICcgJywKICAgICAgICAgICAgICBsYW5ndWFnZS5kb3dubG9hZAogICAgICAgICAgICBdCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChtb25vLmlzT3BlcmEgJiYgc3R5bGVJbmRleCA9PT0gNCkgewogICAgICAgICAgYnV0dG9uTm9kZS5hcHBlbmRDaGlsZChtb25vLmNyZWF0ZSgnaW1nJywgewogICAgICAgICAgICBzcmM6IFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyM4MDgwODAnKSwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICB3aWR0aDogJzEycHgnLAogICAgICAgICAgICAgIGhlaWdodDogJzEycHgnLAogICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzRweCcKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9sZEJ0biAmJiBvbGRCdG4ucGFyZW50Tm9kZSkgewogICAgICAgICAgb2xkQnRuLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGJ1dHRvbk5vZGUsIG9sZEJ0bik7CiAgICAgICAgICBvbGRCdG4gPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBidG5Db250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uTm9kZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYnV0dG9uTm9kZTsKICAgICAgfSwKCiAgICAgIHJtQnRuOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYnRuTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoWycjJyArIGRhaWx5bW90aW9uLmJ0bklkLCAnLnNmLXdyYXBwZXInXSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBidG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgIGl0ZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpdGVtKTsKICAgICAgICB9CiAgICAgICAgZGFpbHltb3Rpb24ucmVzdWx0ID0gbnVsbDsKICAgICAgICBkYWlseW1vdGlvbi5wb3B1cElzU2hvdyA9IGZhbHNlOwogICAgICB9LAoKICAgICAgZ2V0RW1iZWRWaWRlb0luZm86IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCFsb2NhdGlvbi5wYXRobmFtZSkgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgdXJsID0gbG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgaWYgKCFpZnJhbWUpIHsKICAgICAgICAgIHVybCA9ICIvZW1iZWQiICsgdXJsOwogICAgICAgIH0KICAgICAgICB1cmwgPSBsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0ICsgdXJsOwogICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAnZ2V0RGFpbHltb3Rpb25FbWJlZFZpZGVvSW5mb01zZycsCiAgICAgICAgICB1cmw6IHVybAogICAgICAgIH0sIGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7CiAgICAgICAgICB9CiAgICAgICAgICBkYWlseW1vdGlvbi50aXRsZSA9IGRhdGEudGl0bGU7CiAgICAgICAgICBkYXRhID0gZGF0YS5saW5rczsKICAgICAgICAgIGNhbGxiYWNrKGRhdGEpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBtdXRhdGlvbk1vZGU6IHsKICAgICAgICBvYnNlcnZlcjogbnVsbCwKICAgICAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICh0aGlzLm9ic2VydmVyKSB7CiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgfQoKICAgICAgICAgIFsnc2ZTa2lwJ10uZm9yRWFjaChmdW5jdGlvbihhdHRyKSB7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoYXR0cik7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbJyArIGRhdGFBdHRyICsgJ10nKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlQXR0cmlidXRlKGRhdGFBdHRyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm9ic2VydmVyID0gU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLnJ1bih7CiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdW1tYXJ5TGlzdCkgewogICAgICAgICAgICAgIHZhciBzdW1tYXJ5LCBuLCBpLCBub2RlOwoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMF07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBkYWlseW1vdGlvbi5hcHBlbmRCdG4oewogICAgICAgICAgICAgICAgICBidG5Db250YWluZXI6IG5vZGUucGFyZW50Tm9kZSwKICAgICAgICAgICAgICAgICAgc3R5bGVJbmRleDogNQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMV07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBkYWlseW1vdGlvbi5hcHBlbmRCdG4oewogICAgICAgICAgICAgICAgICBidG5Db250YWluZXI6IG5vZGUsCiAgICAgICAgICAgICAgICAgIHN0eWxlSW5kZXg6IDQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzJdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBhcmVudC5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBkYWlseW1vdGlvbi5hcHBlbmRCdG4oewogICAgICAgICAgICAgICAgICBidG5Db250YWluZXI6IG5vZGUsCiAgICAgICAgICAgICAgICAgIHN0eWxlSW5kZXg6IDMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcXVlcmllczogW3sKICAgICAgICAgICAgICBjc3M6ICcuZmx1aWQtY29udGFpbmVyIC5wbF92aWRlb19pbmZvcyAucm93IC5zZF91c2VyX3N1YnNjcmliZScsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5wbF92aWRlb3NfbGlzdHdpdGhwbGF5ZXIgLnBsX3ZpZGVvc19saXN0c3dpdGNoZXInCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuY2hhbm5lbC1mZWF0dXJlZC12aWRlb3MgLm1ldGEtaW5mbyBoMitkaXYnCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSwgbnVsbCwgZnVuY3Rpb24gc3luY0lzQWN0aXZlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vKi5kYWlseW1vdGlvbi4qLyonCiAgICAgIF07CgogICAgICB2YXIgcmVTdHIgPSBsaXN0Lm1hcChmdW5jdGlvbihwYXR0ZXJuKSB7CiAgICAgICAgcmV0dXJuIG1vbm8udXJsUGF0dGVyblRvU3RyUmUocGF0dGVybik7CiAgICAgIH0pLmpvaW4oJ3wnKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChyZVN0cik7CgogICAgICBpZiAoIXJlLnRlc3QobG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdG5hbWUpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgaWYgKG1vbm8uaXNJZnJhbWUoKSkgewogICAgICBpZiAoIS9cL2VtYmVkXC8oW1x3XC1dKykvaS50ZXN0KGRvY3VtZW50LmxvY2F0aW9uLmhyZWYpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIGlmIChsb2NhdGlvbi5ob3N0bmFtZSA9PT0gd2luZG93LnBhcmVudC5sb2NhdGlvbi5ob3N0bmFtZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkge30KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9KTsKICAodHlwZW9mIG1vbm8gPT09ICd1bmRlZmluZWQnKSAmJiAobW9ubyA9IHsKICAgIGxvYWRNb2R1bGU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxvYWRNb2R1bGVTdGFjay5wdXNoKGFyZ3VtZW50cyk7CiAgICB9LAogICAgbG9hZE1vZHVsZVN0YWNrOiBbXQogIH0pOwoKICBtb25vLmxvYWRNb2R1bGUoJ2ZhY2Vib29rJywgZnVuY3Rpb24obW9kdWxlTmFtZSwgaW5pdERhdGEpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbGFuZ3VhZ2UgPSBpbml0RGF0YS5nZXRMYW5ndWFnZTsKICAgIHZhciBwcmVmZXJlbmNlID0gaW5pdERhdGEuZ2V0UHJlZmVyZW5jZTsKICAgIHZhciBtb2R1bGVTdGF0ZSA9IHByZWZlcmVuY2UubW9kdWxlRmFjZWJvb2sgPyAxIDogMDsKCiAgICBtb25vLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbihtZXNzYWdlLCBjYikgewogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICdnZXRNb2R1bGVJbmZvJykgewogICAgICAgIGlmIChtZXNzYWdlLnVybCAhPT0gbG9jYXRpb24uaHJlZikgcmV0dXJuOwogICAgICAgIHJldHVybiBjYih7CiAgICAgICAgICBzdGF0ZTogbW9kdWxlU3RhdGUsCiAgICAgICAgICBtb2R1bGVOYW1lOiBtb2R1bGVOYW1lCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnY2hhbmdlU3RhdGUnKSB7CiAgICAgICAgaWYgKG1vZHVsZU5hbWUgIT09IG1lc3NhZ2UubW9kdWxlTmFtZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmIuY2hhbmdlU3RhdGUobWVzc2FnZS5zdGF0ZSk7CiAgICAgIH0KICAgICAgaWYgKCFtb2R1bGVTdGF0ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICd1cGRhdGVMaW5rcycpIHsKICAgICAgICBmYi5jaGFuZ2VTdGF0ZSgwKTsKICAgICAgICBmYi5jaGFuZ2VTdGF0ZSgxKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKG1vZHVsZVN0YXRlKSB7CiAgICAgIG1vbm8uYXN5bmNDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgIGZiLnJ1bigpOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgZmIgPSB7CiAgICAgIGNvbnRleHRNZW51OiBudWxsLAogICAgICBjbGFzc05hbWU6ICdzYXZlZnJvbV9mYl9kb3dubG9hZCcsCiAgICAgIGlzTXV0YXRpb246IGZhbHNlLAogICAgICBydW46IGZ1bmN0aW9uKCkgewogICAgICAgIG1vZHVsZVN0YXRlID0gMTsKCiAgICAgICAgdmlkZW9GZWVkLmFkZFN0eWxlKCk7CiAgICAgICAgcGhvdG8uaW5qZWN0U3R5bGUoKTsKCiAgICAgICAgaWYgKFNhdmVGcm9tX1V0aWxzLm11dGF0aW9uV2F0Y2hlci5pc0F2YWlsYWJsZSgpKSB7CiAgICAgICAgICB0aGlzLmlzTXV0YXRpb24gPSB0cnVlOwogICAgICAgICAgdGhpcy5pbml0RW1iZWREb3dubG9hZGVyKCk7CiAgICAgICAgICB0aGlzLm11dGF0aW9uTW9kZS5lbmFibGUoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBjaGFuZ2VTdGF0ZTogZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICBmYi5oaWRlTWVudSgpOwogICAgICAgIG1vZHVsZVN0YXRlID0gc3RhdGU7CiAgICAgICAgZXh0ZXJuYWxNZWRpYS5kaXNhYmxlKCk7CiAgICAgICAgcGhvdG8ucm1DdXJyZW50UGhvdG9CdG4oKTsKICAgICAgICBwaG90by5ybURhdGFBdHRycygpOwogICAgICAgIHZpZGVvRmVlZC5ybUJ0bigpOwogICAgICAgIHZpZGVvLnJtQnRuKCk7CiAgICAgICAgZmIubXV0YXRpb25Nb2RlLnN0b3AoKTsKICAgICAgICBpZiAoc3RhdGUpIHsKICAgICAgICAgIGZiLnJ1bigpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGluaXRFbWJlZERvd25sb2FkZXI6IGZ1bmN0aW9uKCkgewogICAgICAgIFNhdmVGcm9tX1V0aWxzLmFkZFN0eWxlUnVsZXMoJy4nICsgU2F2ZUZyb21fVXRpbHMuZW1iZWREb3dubG9hZGVyLmxpbmtDbGFzcyArICcgaW1nJywgewogICAgICAgICAgb3BhY2l0eTogJy41JwogICAgICAgIH0pOwoKICAgICAgICBTYXZlRnJvbV9VdGlscy5lbWJlZERvd25sb2FkZXIuaW5pdCgpOwogICAgICB9LAoKICAgICAgbXV0YXRpb25Nb2RlOiB7CiAgICAgICAgb2JzZXJ2ZXI6IG51bGwsCiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5vYnNlcnZlcikgewogICAgICAgICAgICB0aGlzLm9ic2VydmVyLnN0b3AoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBbJ3NmU2tpcCddLmZvckVhY2goZnVuY3Rpb24oYXR0cikgewogICAgICAgICAgICB2YXIgZGF0YUF0dHIgPSBtb25vLmRhdGFBdHRyMlNlbGVjdG9yKGF0dHIpOwogICAgICAgICAgICB2YXIgZGF0YUF0dHJMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnWycgKyBkYXRhQXR0ciArICddJyk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gZGF0YUF0dHJMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgICBpdGVtLnJlbW92ZUF0dHJpYnV0ZShkYXRhQXR0cik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgd3JhcFZpZGVvR2V0TGlua3M6IGZ1bmN0aW9uKHBsYXllcikgewogICAgICAgICAgc3dpdGNoIChwbGF5ZXIudGFnTmFtZSkgewogICAgICAgICAgICBjYXNlICdFTUJFRCc6CiAgICAgICAgICAgICAgdmlkZW8uZ2V0TGlua3NGcm9tRW1iZWQocGxheWVyLCBmdW5jdGlvbihsaW5rcykgewogICAgICAgICAgICAgICAgdmlkZW8uYXBwZW5kTGlua3MobGlua3MpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdWSURFTyc6CiAgICAgICAgICAgICAgdmlkZW8uZ2V0TGlua3NGcm9tVmlkZW8ocGxheWVyLCBmdW5jdGlvbihsaW5rcykgewogICAgICAgICAgICAgICAgdmlkZW8uYXBwZW5kTGlua3MobGlua3MpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgd3JhcFZpZGVvRmVlZE9uTGlua0hvdmVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICghbW9kdWxlU3RhdGUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdmlkZW9GZWVkLm9uTGlua0hvdmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICB3cmFwUGhvdG9PbkhvdmVyOiBmdW5jdGlvbihjb250ZXh0KSB7CiAgICAgICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBub2RlID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdpbWcuc3BvdGxpZ2h0Jyk7CiAgICAgICAgICBpZiAobm9kZSkgewogICAgICAgICAgICBwaG90by5hZGRDdXJyZW50RGxCdG4obm9kZSwgdGhpcyk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB3cmFwRXh0ZXJuYWxNZWRpYU1vdXNlRW50ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFtb2R1bGVTdGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbGluayA9IHRoaXM7CiAgICAgICAgICB2YXIgYXR0ciA9IGxpbmsuZGF0YXNldFtleHRlcm5hbE1lZGlhLmxpbmtEYXRhQXR0cl07CgogICAgICAgICAgaWYgKGF0dHIpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGV4dGVybmFsTWVkaWEudGltZXIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGV4dGVybmFsTWVkaWEuaGFuZGxlKGxpbmspKSB7CiAgICAgICAgICAgIGlmIChleHRlcm5hbE1lZGlhLmxhc3RMaW5rICYmIGV4dGVybmFsTWVkaWEubGFzdExpbmsgIT09IGxpbmspIHsKICAgICAgICAgICAgICBleHRlcm5hbE1lZGlhLnJlbW92ZUJ0bihleHRlcm5hbE1lZGlhLmxhc3RMaW5rKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMuZW1iZWREb3dubG9hZGVyLmhpZGVQYW5lbCgpOwogICAgICAgICAgICBleHRlcm5hbE1lZGlhLmxhc3RMaW5rID0gbGluazsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vbm8ub2ZmKHRoaXMsICdtb3VzZWVudGVyJywgZmIubXV0YXRpb25Nb2RlLndyYXBFeHRlcm5hbE1lZGlhTW91c2VFbnRlcik7CiAgICAgICAgICAgIG1vbm8ub2ZmKHRoaXMsICdtb3VzZWxlYXZlJywgZmIubXV0YXRpb25Nb2RlLndyYXBFeHRlcm5hbE1lZGlhTW91c2VMZWF2ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB3cmFwRXh0ZXJuYWxNZWRpYU1vdXNlTGVhdmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFtb2R1bGVTdGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbGluayA9IHRoaXM7CiAgICAgICAgICB2YXIgYXR0ciA9IGxpbmsuZGF0YXNldFtleHRlcm5hbE1lZGlhLmxpbmtEYXRhQXR0cl07CgogICAgICAgICAgaWYgKGF0dHIpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGV4dGVybmFsTWVkaWEudGltZXIpOwogICAgICAgICAgICBleHRlcm5hbE1lZGlhLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBleHRlcm5hbE1lZGlhLnJlbW92ZUJ0bihsaW5rKTsKICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICB3cmFwRXh0ZXJuYWxNZWRpYTogZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgbW9uby5vbihub2RlLCAnbW91c2VlbnRlcicsIGZiLm11dGF0aW9uTW9kZS53cmFwRXh0ZXJuYWxNZWRpYU1vdXNlRW50ZXIpOwogICAgICAgICAgbW9uby5vbihub2RlLCAnbW91c2VsZWF2ZScsIGZiLm11dGF0aW9uTW9kZS53cmFwRXh0ZXJuYWxNZWRpYU1vdXNlTGVhdmUpOwogICAgICAgIH0sCiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICh0aGlzLm9ic2VydmVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm9ic2VydmVyLnN0YXJ0KCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgICB0aGlzLm9ic2VydmVyID0gU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLnJ1bih7CiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdW1tYXJ5TGlzdCkgewogICAgICAgICAgICAgIHZhciBzdW1tYXJ5LCBuLCBpLCBub2RlOwoKICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMjsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbaV07CiAgICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpc0luc2VydCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgaWYgKG1vbm8ubWF0Y2hlcyhub2RlLCAnI2ZieFBob3RvQ29udGVudENvbnRhaW5lciAudmlkZW9TdGFnZSAnICsgbm9kZS50YWdOYW1lKSkgewogICAgICAgICAgICAgICAgICAgIGlzSW5zZXJ0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGlzSW5zZXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMud3JhcFZpZGVvR2V0TGlua3Mobm9kZSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbW9uby5vbmUobm9kZSwgJ21vdXNlb3ZlcicsIF90aGlzLndyYXBWaWRlb0ZlZWRPbkxpbmtIb3Zlcik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFsyXTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5nZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknKSAhPT0gJ2ZiUGhvdG9zU25vd2xpZnRDYXB0aW9uJykgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZiLmhpZGVNZW51KCk7CgogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gU2F2ZUZyb21fVXRpbHMuZ2V0UGFyZW50QnlDbGFzcyhub2RlLCAnc3RhZ2UnKTsKICAgICAgICAgICAgICAgIG1vbm8ub25lKGNvbnRhaW5lciwgJ21vdXNlb3ZlcicsIF90aGlzLndyYXBQaG90b09uSG92ZXIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzNdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlLnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBfdGhpcy53cmFwRXh0ZXJuYWxNZWRpYShub2RlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFs0XTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5yZW1vdmVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIG1vbm8ub25SZW1vdmVMaXN0ZW5lcihub2RlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9LAogICAgICAgICAgICBxdWVyaWVzOiBbewogICAgICAgICAgICAgIGNzczogJ2VtYmVkJywKICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAndmlkZW8nLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuc3RhZ2UgaW1nLnNwb3RsaWdodCcsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ2EnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuJyArIG1vbm8ub25SZW1vdmVDbGFzc05hbWUsCiAgICAgICAgICAgICAgaXM6ICdyZW1vdmVkJwogICAgICAgICAgICB9XQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBoaWRlTWVudTogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKGZiLmNvbnRleHRNZW51KSB7CiAgICAgICAgICBmYi5jb250ZXh0TWVudS5oaWRlKCk7CiAgICAgICAgICBmYi5jb250ZXh0TWVudSA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHZhciBleHRlcm5hbE1lZGlhID0gewogICAgICBsaW5rRGF0YUF0dHI6ICdzYXZlZnJvbUVkJywKICAgICAgdGltZXI6IDAsCiAgICAgIGxhc3RMaW5rOiBudWxsLAoKICAgICAgcmU6IFsKICAgICAgICAvaHR0cHM/OlwvXC8oPzpbYS16XStcLik/eW91dHViZVwuY29tXC8oPzojIT9cLyk/d2F0Y2hcP1teXHNcIlwnXDxcPl0qdj0oW1x3XC1dKykvaSwKICAgICAgICAvaHR0cHM/OlwvXC8oPzpbYS16MC05XStcLik/eW91dHViZVwuY29tXC8oPzplbWJlZHx2KVwvKFtcd1wtXSspL2ksCiAgICAgICAgL2h0dHBzPzpcL1wvKD86W2Etel0rXC4pP3lvdXR1XC5iZVwvKFtcd1wtXSspL2ksCiAgICAgICAgL2h0dHBzPzpcL1wvKD86W1x3XC1dK1wuKT92aW1lb1wuY29tXC8oXGQrKSg/Olw/fCQpL2kKICAgICAgXSwKCiAgICAgIHRodW1ibmFpbDogewogICAgICAgIHlvdXR1YmU6IHsKICAgICAgICAgIHJlOiBbL3l0aW1nXC5jb20oPzpcL3wlMkYpdmkoPzpcL3wlMkYpKFtcd1wtXSspKD86XC98JTJGKS9pXSwKICAgICAgICAgIHVybDogJ2h0dHA6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj17dmlkfScKICAgICAgICB9CiAgICAgIH0sCgogICAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgcGFuZWwgPSBTYXZlRnJvbV9VdGlscy5lbWJlZERvd25sb2FkZXIucGFuZWw7CiAgICAgICAgaWYgKHBhbmVsKSB7CiAgICAgICAgICBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIHJlbW92ZUJ0bjogZnVuY3Rpb24obGluaykgewogICAgICAgIGlmICghbGluayB8fCB0eXBlb2YobGluaykgIT0gJ29iamVjdCcpCiAgICAgICAgICByZXR1cm47CgogICAgICAgIHZhciBidG4gPSBsaW5rLnF1ZXJ5U2VsZWN0b3IoJy4nICsgZmIuY2xhc3NOYW1lKTsKICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICBidG4ucGFyZW50Tm9kZS5yZW1vdmVBdHRyaWJ1dGUobW9uby5kYXRhQXR0cjJTZWxlY3RvcihleHRlcm5hbE1lZGlhLmxpbmtEYXRhQXR0cikpOwogICAgICAgICAgYnRuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYnRuKTsKICAgICAgICB9CgogICAgICAgIGxpbmsucmVtb3ZlQXR0cmlidXRlKG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoZXh0ZXJuYWxNZWRpYS5saW5rRGF0YUF0dHIpKTsKCiAgICAgICAgaWYgKGxpbmsgPT0gdGhpcy5sYXN0TGluaykKICAgICAgICAgIHRoaXMubGFzdExpbmsgPSBudWxsOwogICAgICB9LAoKCiAgICAgIGNoZWNrVXJsOiBmdW5jdGlvbih1cmwsIHJldHJ5KSB7CiAgICAgICAgaWYgKCFyZXRyeSAmJiB1cmwuc2VhcmNoKC9odHRwcz86XC9cLyhbXHdcLV0rXC4pP2ZhY2Vib29rXC5jb21cL2xcLnBocC9pKSA+IC0xKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jaGVja1VybChkZWNvZGVVUklDb21wb25lbnQodXJsKSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMucmUubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB2YXIgbSA9IHVybC5tYXRjaCh0aGlzLnJlW2ldKTsKICAgICAgICAgIGlmIChtICYmIG0ubGVuZ3RoID4gMCkKICAgICAgICAgICAgcmV0dXJuIG1bMF07CiAgICAgICAgfQogICAgICB9LAoKCiAgICAgIGhhbmRsZTogZnVuY3Rpb24obGluaykgewogICAgICAgIHZhciBpbWcgPSBsaW5rLnF1ZXJ5U2VsZWN0b3IoJ2ltZycpOwogICAgICAgIGlmIChpbWcpIHsKICAgICAgICAgIHZhciBwYXJlbnQgPSBpbWcucGFyZW50Tm9kZTsKICAgICAgICAgIGlmIChpbWcuc3JjICYmIFNhdmVGcm9tX1V0aWxzLmdldFN0eWxlKHBhcmVudCwgJ3Bvc2l0aW9uJykgPT0gJ3JlbGF0aXZlJykgewogICAgICAgICAgICB2YXIgYWpheGlmeSA9IGxpbmsuZ2V0QXR0cmlidXRlKCdhamF4aWZ5Jyk7CgogICAgICAgICAgICBpZiAoYWpheGlmeSAmJiBhamF4aWZ5LnNlYXJjaCgvXC9mbGFzaFwvZXhwYW5kX2lubGluZS9pKSA+IC0xKSB7CiAgICAgICAgICAgICAgdmFyIHVybCA9IHRoaXMuZ2V0VGh1bWJuYWlsVXJsKGltZy5zcmMpOwogICAgICAgICAgICAgIGlmICh1cmwpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUJ1dHRvbih1cmwsIHBhcmVudCwgbGluaywgewogICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICAgICAgYm90dG9tOiAnM3B4JywKICAgICAgICAgICAgICAgICAgcmlnaHQ6ICczcHgnLAogICAgICAgICAgICAgICAgICB6SW5kZXg6IDk5OTksCiAgICAgICAgICAgICAgICAgIG1hcmdpbjogMCwKICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxNnB4JywKICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTZweCcKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY2hlY2tVcmwobGluay5ocmVmKSkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUJ1dHRvbihsaW5rLmhyZWYsIHBhcmVudCwgbGluaywgewogICAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgICAgYm90dG9tOiAnM3B4JywKICAgICAgICAgICAgICAgIHJpZ2h0OiAnM3B4JywKICAgICAgICAgICAgICAgIHpJbmRleDogOTk5OSwKICAgICAgICAgICAgICAgIG1hcmdpbjogMCwKICAgICAgICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxNnB4JwogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUJ1dHRvbihsaW5rLmhyZWYsIGxpbmssIGxpbmspOwogICAgICB9LAoKCiAgICAgIGdldFRodW1ibmFpbFVybDogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLnRodW1ibmFpbCkgewogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnRodW1ibmFpbFtpXS5yZS5sZW5ndGg7IGorKykgewogICAgICAgICAgICB2YXIgdmlkID0gU2F2ZUZyb21fVXRpbHMuZ2V0TWF0Y2hGaXJzdCh1cmwsIHRoaXMudGh1bWJuYWlsW2ldLnJlW2pdKTsKICAgICAgICAgICAgaWYgKHZpZCkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy50aHVtYm5haWxbaV0udXJsLnJlcGxhY2UoL1x7dmlkXH0vaWcsIHZpZCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0sCgoKICAgICAgY3JlYXRlQnV0dG9uOiBmdW5jdGlvbih1cmwsIHBhcmVudCwgbGluaywgc3R5bGVQYXJlbnQsIHN0eWxlSWNvbikgewogICAgICAgIHVybCA9IHRoaXMuY2hlY2tVcmwodXJsKTsKICAgICAgICBpZiAoIXVybCkKICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgdmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICBidG4uY2xhc3NOYW1lID0gZmIuY2xhc3NOYW1lOwogICAgICAgIGJ0bi5ocmVmID0gJ2h0dHA6Ly9zYXZlZnJvbS5uZXQvP3VybD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCk7CiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZShTYXZlRnJvbV9VdGlscy5lbWJlZERvd25sb2FkZXIuZGF0YUF0dHIsIHVybCk7CiAgICAgICAgYnRuLnRpdGxlID0gbGFuZ3VhZ2UuZG93bmxvYWQ7CgogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgZWM6ICdmYWNlYm9vaycsCiAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgZWw6ICd2aWRlby1mZWVkJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgU2F2ZUZyb21fVXRpbHMuc2V0U3R5bGUoYnRuLCB7CiAgICAgICAgICBtYXJnaW5MZWZ0OiAnN3B4JywKICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICdtaWRkbGUnCiAgICAgICAgfSk7CgogICAgICAgIGlmIChzdHlsZVBhcmVudCkKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKGJ0biwgc3R5bGVQYXJlbnQpOwoKICAgICAgICB2YXIgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgICAgIGljb24uY2xhc3NOYW1lID0gJ2ljb24nOwogICAgICAgIGljb24uc3JjID0gU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnI2EyZGIxNicpOwogICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKGljb24sIHsKICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgd2lkdGg6ICcxNnB4JywKICAgICAgICAgIGhlaWdodDogJzE2cHgnLAogICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAvL29wYWNpdHk6ICcwLjknLAogICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHN0eWxlSWNvbikKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKGljb24sIHN0eWxlSWNvbik7CgogICAgICAgIGJ0bi5hcHBlbmRDaGlsZChpY29uKTsKCiAgICAgICAgbGluay5kYXRhc2V0W3RoaXMubGlua0RhdGFBdHRyXSA9IDE7CiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGJ0bik7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9OwoKCiAgICB2YXIgdmlkZW8gPSB7CiAgICAgIGdldExpbmtzRnJvbUVtYmVkOiBmdW5jdGlvbihlbWJlZCwgY2IpIHsKICAgICAgICBpZiAoIWVtYmVkKSB7CiAgICAgICAgICByZXR1cm4gY2IobnVsbCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZnYgPSBlbWJlZC5nZXRBdHRyaWJ1dGUoJ2ZsYXNodmFycycpOwogICAgICAgIGlmIChmdiA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGNiKG51bGwpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBhcmFtcyA9IG1vbm8ucGFyc2VVcmwoZnYpLnBhcmFtczsKICAgICAgICBpZiAoIXBhcmFtcykgewogICAgICAgICAgcmV0dXJuIGNiKG51bGwpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHZpZGVvRGF0YSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZpZGVvRGF0YSA9IEpTT04ucGFyc2UocGFyYW1zKS52aWRlb19kYXRhOwogICAgICAgIH0gY2F0Y2ggKGUpIHt9CgogICAgICAgIGlmICghdmlkZW9EYXRhKSB7CiAgICAgICAgICByZXR1cm4gY2IobnVsbCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodmlkZW9EYXRhLnByb2dyZXNzaXZlKSB7CiAgICAgICAgICB2aWRlb0RhdGEgPSB2aWRlb0RhdGEucHJvZ3Jlc3NpdmU7CiAgICAgICAgfQoKICAgICAgICB2YXIgbGlua3MgPSB7fTsKICAgICAgICB2YXIgdHlwZU1hcCA9IHsKICAgICAgICAgIHNkX3NyYzogJ1NEJywKICAgICAgICAgIGhkX3NyYzogJ0hEJwogICAgICAgIH07CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZpZGVvRGF0YSkpIHsKICAgICAgICAgIHZpZGVvRGF0YSA9IFt2aWRlb0RhdGFdOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IHZpZGVvRGF0YVtpXTsgaSsrKSB7CiAgICAgICAgICBbJ3NkX3NyYycsICdoZF9zcmMnXS5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgICAgICAgaWYgKCFpdGVtW3R5cGVdKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsaW5rc1tpdGVtW3R5cGVdXSA9IHR5cGVNYXBbdHlwZV07CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjYihsaW5rcyk7CiAgICAgIH0sCgogICAgICByZXF1ZXN0VmlkZW9MaW5rczogZnVuY3Rpb24odmlkZW9pZCwgY2IpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICBhY3Rpb246ICdnZXRGYWNlYm9va0xpbmtzJywKICAgICAgICAgIGV4dFZpZGVvSWQ6IHZpZGVvaWQKICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgaWYgKCFyZXNwb25zZSkgewogICAgICAgICAgICBjYigpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2IocmVzcG9uc2UubGlua3MsIHJlc3BvbnNlLnRpdGxlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIGdldExpbmtzRnJvbVZpZGVvOiBmdW5jdGlvbih2aWRlbywgY2IpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgaWYgKCF2aWRlbykgewogICAgICAgICAgcmV0dXJuIGNiKG51bGwpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxpbmtzID0ge307CgogICAgICAgIHZhciB1cmwgPSBkb2N1bWVudC5VUkw7CiAgICAgICAgdmFyIGlkOwogICAgICAgIFNhdmVGcm9tX1V0aWxzLmVtYmVkRG93bmxvYWRlci5ob3N0aW5ncy5mYWNlYm9vay5yZS5zb21lKGZ1bmN0aW9uKHJlZykgewogICAgICAgICAgdmFyIF9pZDsKICAgICAgICAgIGlmIChfaWQgPSB1cmwubWF0Y2gocmVnKSkgewogICAgICAgICAgICBpZCA9IF9pZCAmJiBfaWRbMV07CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmICghaWQpIHsKICAgICAgICAgIHZhciBwYXJlbnQgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3ModmlkZW8sICd1c2VyQ29udGVudFdyYXBwZXInKTsKICAgICAgICAgIHBhcmVudCA9IHBhcmVudCAmJiBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgnYS5wcm9maWxlTGluaywgYVtyZWw9InRoZWF0ZXIiXScpOwogICAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQubGVuZ3RoID4gMCkgewogICAgICAgICAgICBwYXJlbnQgPSBbXS5zbGljZS5jYWxsKHBhcmVudCk7CiAgICAgICAgICAgIHBhcmVudC5zb21lKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICBpdGVtID0gKGl0ZW0uaHJlZiB8fCAnJykubWF0Y2goL1wvdmlkZW9zXC8oXGQrKS8pOwogICAgICAgICAgICAgIGl0ZW0gPSBpdGVtICYmIGl0ZW1bMV07CiAgICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlkID0gaXRlbTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlkICYmIChsaW5rcy5pZCA9IGlkKTsKCiAgICAgICAgaWYgKHZpZGVvLnNyYyAmJiAvXmh0dHBzPzovLnRlc3QodmlkZW8uc3JjKSkgewogICAgICAgICAgdmFyIGV4dCA9IFNhdmVGcm9tX1V0aWxzLmdldEZpbGVFeHRlbnNpb24odmlkZW8uc3JjLCAnbXA0Jyk7CiAgICAgICAgICBsaW5rc1t2aWRlby5zcmNdID0gZXh0LnRvVXBwZXJDYXNlKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgc3JjID0gdmlkZW8ucXVlcnlTZWxlY3RvckFsbCgnc291cmNlJyk7CiAgICAgICAgaWYgKHNyYyAmJiBzcmMubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcmMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGV4dCA9IFNhdmVGcm9tX1V0aWxzLmdldEZpbGVFeHRlbnNpb24oc3JjW2ldLnNyYywgJ21wNCcpOwogICAgICAgICAgICBsaW5rc1tzcmNbaV0uc3JjXSA9IGV4dC50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNiKGxpbmtzKTsKICAgICAgfSwKCgogICAgICBnZXRGaWxlTmFtZTogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgdmFyIG5hbWUgPSBTYXZlRnJvbV9VdGlscy5nZXRGaWxlTmFtZSh1cmwpOwogICAgICAgIGlmIChuYW1lKQogICAgICAgICAgcmV0dXJuIG5hbWU7CgogICAgICAgIHZhciBkID0gU2F2ZUZyb21fVXRpbHMuZGF0ZVRvT2JqKCk7CiAgICAgICAgdmFyIGRhdGVTdHIgPSBkLnllYXIgKyAnLScgKyBkLm1vbnRoICsgJy0nICsgZC5kYXkgKyAnXycgKwogICAgICAgICAgZC5ob3VyICsgJy0nICsgZC5taW47CgogICAgICAgIHJldHVybiAnZmFjZWJvb2tfJyArIGRhdGVTdHIgKyAnLicgKwogICAgICAgICAgU2F2ZUZyb21fVXRpbHMuZ2V0RmlsZUV4dGVuc2lvbih1cmwsICdtcDQnKTsKICAgICAgfSwKCiAgICAgIHByZXBhcmVMaW5rczogZnVuY3Rpb24obGlua3MsIF90aXRsZSkgewogICAgICAgIHZhciBtZW51TGlua3MgPSBbXTsKICAgICAgICBmb3IgKHZhciB1cmwgaW4gbGlua3MpIHsKICAgICAgICAgIHZhciB0aXRsZSA9IHRoaXMuZ2V0RmlsZU5hbWUodXJsKTsKICAgICAgICAgIHZhciBleHRQb3MgPSB0aXRsZS5sYXN0SW5kZXhPZignLicpOwogICAgICAgICAgdmFyIGV4dCA9IHRpdGxlLnN1YnN0cihleHRQb3MgKyAxKTsKICAgICAgICAgIHRpdGxlID0gX3RpdGxlIHx8IHRpdGxlLnN1YnN0cigwLCBleHRQb3MpOwogICAgICAgICAgdmFyIGZvcm1hdCA9IGV4dC50b1VwcGVyQ2FzZSgpOwoKICAgICAgICAgIHZhciBxdWFsaXR5ID0gbGlua3NbdXJsXTsKICAgICAgICAgIHZhciBwb3B1cExpbmsgPSB7CiAgICAgICAgICAgIGhyZWY6IHVybCwKICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdCwKICAgICAgICAgICAgcXVhbGl0eTogcXVhbGl0eSwKICAgICAgICAgICAgZm9yY2VEb3dubG9hZDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICAgIG1lbnVMaW5rcy5wdXNoKHBvcHVwTGluayk7CiAgICAgICAgfQogICAgICAgIGlmIChtZW51TGlua3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBtZW51TGlua3MgPSBsYW5ndWFnZS5ub0xpbmtzRm91bmQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtZW51TGlua3M7CiAgICAgIH0sCgogICAgICBhcHBlbmRMaW5rczogZnVuY3Rpb24obGlua3MpIHsKICAgICAgICBpZiAoIWxpbmtzKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZiUGhvdG9QYWdlTWVkaWFJbmZvJyk7CgogICAgICAgIGlmIChib3ggPT09IG51bGwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB0aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyLnVpSGVhZGVyVGl0bGUnKTsKICAgICAgICBpZiAodGl0bGUpIHsKICAgICAgICAgIHRpdGxlID0gdGl0bGUudGV4dENvbnRlbnQ7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWJveCB8fCBib3gucXVlcnlTZWxlY3RvcignLicgKyBmYi5jbGFzc05hbWUpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgcGFuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBwYW5lbC5jbGFzc05hbWUgPSBmYi5jbGFzc05hbWU7CgogICAgICAgIHZhciBidXR0b24gPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgdGl0bGU6IGxhbmd1YWdlLmRvd25sb2FkLAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICAgIGhlaWdodDogJzE2cHgnLAogICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyNhMmRiMTYnKSArICcpJywKICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJ25vLXJlcGVhdCcsCiAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogJ2NlbnRlciBjZW50ZXInLAogICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcGFuZWwuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKCgogICAgICAgIHZhciBwb3B1cE1lbnVMaW5rcyA9IG51bGw7CgogICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKGZiLmNvbnRleHRNZW51ICYmIGZiLmNvbnRleHRNZW51LmlzU2hvdykgewogICAgICAgICAgICBmYi5oaWRlTWVudSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG1lbnUgPSBmYi5jb250ZXh0TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydCh0aGlzLCBsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJywgZmIuY2xhc3NOYW1lICsgJ19wb3B1cCcpOwoKICAgICAgICAgIGlmIChwb3B1cE1lbnVMaW5rcykgewogICAgICAgICAgICBtZW51LnVwZGF0ZShwb3B1cE1lbnVMaW5rcyk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmIChsaW5rcy5pZCkgewogICAgICAgICAgICB2YXIgaWQgPSBsaW5rcy5pZDsKICAgICAgICAgICAgZGVsZXRlIGxpbmtzLmlkOwogICAgICAgICAgICB2aWRlby5yZXF1ZXN0VmlkZW9MaW5rcyhpZCwgZnVuY3Rpb24oX2xpbmtzLCB0aXRsZSkgewogICAgICAgICAgICAgIGlmIChfbGlua3MpIHsKICAgICAgICAgICAgICAgIHBvcHVwTWVudUxpbmtzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rcy5mYWNlYm9vayhfbGlua3MsIHRpdGxlKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG9wdXBNZW51TGlua3MgPSB2aWRlby5wcmVwYXJlTGlua3MobGlua3MpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBtZW51LnVwZGF0ZShwb3B1cE1lbnVMaW5rcyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcG9wdXBNZW51TGlua3MgPSB2aWRlby5wcmVwYXJlTGlua3MobGlua3MsIHRpdGxlKTsKICAgICAgICAgICAgbWVudS51cGRhdGUocG9wdXBNZW51TGlua3MpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgZWM6ICdmYWNlYm9vaycsCiAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgZWw6ICd2aWRlby1zaW5nbGUnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBib3guYXBwZW5kQ2hpbGQocGFuZWwpOwoKICAgICAgICBib3ggPSBudWxsOwogICAgICAgIHBhbmVsID0gbnVsbDsKICAgICAgICBidXR0b24gPSBudWxsOwogICAgICB9LAogICAgICBybUJ0bjogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGJ0bkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGZiLmNsYXNzTmFtZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBidG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgIGl0ZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpdGVtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIHBob3RvID0gewogICAgICBzdHlsZTogbnVsbCwKICAgICAgZ2V0RmlsZW5hbWVGcm9tVXJsOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICByZXR1cm4gU2F2ZUZyb21fVXRpbHMuZ2V0TWF0Y2hGaXJzdCh1cmwsIC9cLyhbXlwvXStcLlthLXowLTldezMsNH0pKD86XD98JCkvaSk7CiAgICAgIH0sCiAgICAgIGdldFBob3RvSWQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwYXJhbXMgPSBtb25vLnBhcnNlVXJsKGxvY2F0aW9uLmhyZWYpOwogICAgICAgIHJldHVybiBwYXJhbXMuZmJpZDsKICAgICAgfSwKICAgICAgb25HZXRQaG90b1VybDogZnVuY3Rpb24odXJsLCBjb250YWluZXIsIG9uR2V0VXJsKSB7CiAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgIHZhciBpbWcgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignaW1nLnNwb3RsaWdodCcpIHx8IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdpbWcuZmJQaG90b0ltYWdlJyk7CiAgICAgICAgICBpZiAoIWltZykgewogICAgICAgICAgICByZXR1cm4gb25HZXRVcmwoKTsKICAgICAgICAgIH0KICAgICAgICAgIHVybCA9IGltZy5zcmM7CiAgICAgICAgfQogICAgICAgIGlmICghdXJsKSB7CiAgICAgICAgICByZXR1cm4gb25HZXRVcmwoKTsKICAgICAgICB9CgogICAgICAgIGlmICh1cmwuaW5kZXhPZignZGw9MScpID09PSAtMSkgewogICAgICAgICAgaWYgKHVybC5pbmRleE9mKCc/JykgPT09IC0xKSB7CiAgICAgICAgICAgIHVybCArPSAnP2RsPTEnCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1cmwgKz0gJyZkbD0xJwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvbkdldFVybCh1cmwpOwogICAgICB9LAogICAgICBybUN1cnJlbnRQaG90b0J0bjogZnVuY3Rpb24oaW5zZXJ0Q29udGFpbmVyKSB7CiAgICAgICAgdmFyIGV4QnRuID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBpbWdMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGltZ0l0ZW07IGltZ0l0ZW0gPSBpbWdMaXN0W2ldOyBpKyspIHsKICAgICAgICAgIGlmICghaW5zZXJ0Q29udGFpbmVyIHx8ICFpbnNlcnRDb250YWluZXIuY29udGFpbnMoaW1nSXRlbSkpIHsKICAgICAgICAgICAgaW1nSXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGltZ0l0ZW0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXhCdG4gPSBpbWdJdGVtOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhCdG47CiAgICAgIH0sCiAgICAgIGluamVjdFN0eWxlOiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAodGhpcy5zdHlsZSkgewogICAgICAgICAgaWYgKCF0aGlzLnN0eWxlLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCh0aGlzLnN0eWxlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuc3R5bGUgPSBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoewogICAgICAgICAgICAnZGl2ID4gLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuJzogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI0Y4RjhGOCcsCiAgICAgICAgICAgICAgd2lkdGg6ICcyMHB4JywKICAgICAgICAgICAgICBoZWlnaHQ6ICcyMHB4JywKICAgICAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyM3Nzc3NzcnKSArICcpIGNlbnRlciBuby1yZXBlYXQgI0Y4RjhGOCcsCiAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JywKICAgICAgICAgICAgICB0b3A6ICcyMHB4JywKICAgICAgICAgICAgICBsZWZ0OiAnMjBweCcsCiAgICAgICAgICAgICAgekluZGV4OiAxMDAsCiAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2RpdiA+IC5zZi1kbC1jdXJyZW50LXBob3RvLWJ0bjpob3Zlcic6IHsKICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjMDBCNzVBJykgKyAnKSBjZW50ZXIgbm8tcmVwZWF0ICNGOEY4RjgnLAogICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnMTJweCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2RpdiA+IC5zZi1kbC1jdXJyZW50LXBob3RvLWJ0bjphY3RpdmUnOiB7CiAgICAgICAgICAgICAgb3V0bGluZTogMCwKICAgICAgICAgICAgICBib3hTaGFkb3c6ICdpbnNldCAwIDNweCA1cHggcmdiYSgwLCAwLCAwLCAwLjEyNSknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdib2R5Om5vdCguZnVsbFNjcmVlbikgZGl2OmhvdmVyID4gLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuJzogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCh0aGlzLnN0eWxlKTsKICAgICAgfSwKICAgICAgYWRkRGxDdXJyZW50UGhvdG9CdG46IGZ1bmN0aW9uKGNvbnRhaW5lcikgewogICAgICAgIHZhciBleEJ0biA9IHRoaXMucm1DdXJyZW50UGhvdG9CdG4oY29udGFpbmVyKTsKICAgICAgICBpZiAoZXhCdG4pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgY2xhc3M6ICdzZi1kbC1jdXJyZW50LXBob3RvLWJ0bicsCiAgICAgICAgICBocmVmOiAnIycsCiAgICAgICAgICB0aXRsZTogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKGZiLmNvbnRleHRNZW51ICYmIGZiLmNvbnRleHRNZW51LmlzU2hvdykgewogICAgICAgICAgICAgIGZiLmhpZGVNZW51KCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgb25LZXlEb3duID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDE4IHx8IGUua2V5Q29kZSA9PT0gMTcpIHJldHVybjsKICAgICAgICAgICAgICBtZW51LmhpZGUoKTsKICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25LZXlEb3duKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBtZW51ID0gZmIuY29udGV4dE1lbnUgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucXVpY2tJbnNlcnQodGhpcywgbGFuZ3VhZ2UuZG93bmxvYWQgKyAnIC4uLicsICJwaG90b0RsTWVudSIsIHsKICAgICAgICAgICAgICBwYXJlbnQ6IGNvbnRhaW5lciwKICAgICAgICAgICAgICBvblNob3c6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGZiLmlzTXV0YXRpb24pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5RG93bik7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBvbkhpZGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGZiLmlzTXV0YXRpb24pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5RG93bik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBvbkdldFVybCA9IGZ1bmN0aW9uKGxpbmspIHsKICAgICAgICAgICAgICBpZiAoIWxpbmspIHsKICAgICAgICAgICAgICAgIHJldHVybiBtZW51LnVwZGF0ZShsYW5ndWFnZS5ub0xpbmtzRm91bmQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgcGhvdG9GaWxlTmFtZSA9IG1vbm8uZmlsZU5hbWUubW9kaWZ5KHBob3RvLmdldEZpbGVuYW1lRnJvbVVybChsaW5rKSk7CiAgICAgICAgICAgICAgdmFyIGRvdFBvcyA9IHBob3RvRmlsZU5hbWUubGFzdEluZGV4T2YoJy4nKTsKICAgICAgICAgICAgICB2YXIgcGhvdG9FeHQgPSBwaG90b0ZpbGVOYW1lLnN1YnN0cihkb3RQb3MgKyAxKTsKICAgICAgICAgICAgICB2YXIgcGhvdG9UaXRsZSA9IHBob3RvRmlsZU5hbWUuc3Vic3RyKDAsIGRvdFBvcyk7CiAgICAgICAgICAgICAgbWVudS51cGRhdGUoW3sKICAgICAgICAgICAgICAgIGhyZWY6IGxpbmssCiAgICAgICAgICAgICAgICB0aXRsZTogcGhvdG9UaXRsZSwKICAgICAgICAgICAgICAgIHF1YWxpdHk6IGxhbmd1YWdlLmRvd25sb2FkLAogICAgICAgICAgICAgICAgZm9ybWF0OiAnICcsCiAgICAgICAgICAgICAgICBleHQ6IHBob3RvRXh0LAogICAgICAgICAgICAgICAgaXNCbGFuazogdHJ1ZSwKICAgICAgICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBtZW51LmhpZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9XSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgZmJpZCA9IHBob3RvLmdldFBob3RvSWQoKTsKICAgICAgICAgICAgaWYgKCFmYmlkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHBob3RvLm9uR2V0UGhvdG9VcmwodW5kZWZpbmVkLCBjb250YWluZXIsIG9uR2V0VXJsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICdnZXRGYWNlYm9va1Bob3RvVXJsJywKICAgICAgICAgICAgICBmYmlkOiBmYmlkCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHBob3RvLm9uR2V0UGhvdG9VcmwodXJsLCBjb250YWluZXIsIG9uR2V0VXJsKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9XQogICAgICAgIH0pKTsKICAgICAgfSwKICAgICAgYWRkQ3VycmVudERsQnRuOiBmdW5jdGlvbihpbWcsIGNvbnRhaW5lcikgewogICAgICAgIGlmIChjb250YWluZXIuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnRhaW5lci5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgdmFyIHVybCA9IGltZy5zcmM7CiAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuYWRkRGxDdXJyZW50UGhvdG9CdG4oY29udGFpbmVyKTsKICAgICAgfSwKICAgICAgcm1EYXRhQXR0cnM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoJ3NmU2tpcCcpOwogICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcqWycgKyBkYXRhQXR0ciArICddJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgaXRlbS5yZW1vdmVBdHRyaWJ1dGUoZGF0YUF0dHIpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICB2YXIgdmlkZW9GZWVkID0gewogICAgICBzdHlsZTogbnVsbCwKICAgICAgYWRkU3R5bGU6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLnN0eWxlKSB7CiAgICAgICAgICBpZiAoIXRoaXMuc3R5bGUucGFyZW50Tm9kZSkgewogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHRoaXMuc3R5bGUpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zdHlsZSA9IG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgIGNsYXNzOiAnc2ZGZWVkU3R5bGUnLAogICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KFt7CiAgICAgICAgICAgIHNlbGVjdG9yOiAnLicgKyBmYi5jbGFzc05hbWUgKyAnLWZlZWQnICsgJy5zZi1mZWVkJywKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsCiAgICAgICAgICAgICAgd2lkdGg6ICcyMHB4JywKICAgICAgICAgICAgICBoZWlnaHQ6ICcyMHB4JywKICAgICAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyNhMmRiMTYnKSArICcpIGNlbnRlciBuby1yZXBlYXQgdHJhbnNwYXJlbnQnLAogICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnMTZweCcsCiAgICAgICAgICAgICAgdG9wOiAnNXB4JywKICAgICAgICAgICAgICBsZWZ0OiAnNXB4JywKICAgICAgICAgICAgICB6SW5kZXg6IDEsCiAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgICAgfQogICAgICAgICAgfSwgewogICAgICAgICAgICBzZWxlY3RvcjogJ2JvZHk6bm90KC5mdWxsU2NyZWVuKSBkaXY6aG92ZXIgPiAuJyArIGZiLmNsYXNzTmFtZSArICctZmVlZCcgKyAnLnNmLWZlZWQnLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycKICAgICAgICAgICAgfQogICAgICAgICAgfSwgewogICAgICAgICAgICBzZWxlY3RvcjogJy4nICsgZmIuY2xhc3NOYW1lICsgJy1mZWVkJyArICcuc2YtZmVlZDphY3RpdmUnLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIG91dGxpbmU6IDAKICAgICAgICAgICAgfQogICAgICAgICAgfV0pCiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgIH0sCiAgICAgIG9uRGxCdG5DbGljazogZnVuY3Rpb24oZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICBpZiAoZmIuY29udGV4dE1lbnUgJiYgZmIuY29udGV4dE1lbnUuaXNTaG93KSB7CiAgICAgICAgICBmYi5oaWRlTWVudSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBsaW5rcyA9IEpTT04ucGFyc2UodGhpcy5kYXRhc2V0LnNmRGxMaW5rcyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1lbnUgPSBmYi5jb250ZXh0TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydCh0aGlzLCBsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJywgZmIuY2xhc3NOYW1lICsgJ19wb3B1cCcpOwoKICAgICAgICBpZiAobGlua3MuaWQpIHsKICAgICAgICAgIHZhciBpZCA9IGxpbmtzLmlkOwogICAgICAgICAgZGVsZXRlIGxpbmtzLmlkOwogICAgICAgICAgdmlkZW8ucmVxdWVzdFZpZGVvTGlua3MoaWQsIGZ1bmN0aW9uKF9saW5rcywgdGl0bGUpIHsKICAgICAgICAgICAgdmFyIHBvcHVwTWVudUxpbmtzOwogICAgICAgICAgICBpZiAoX2xpbmtzKSB7CiAgICAgICAgICAgICAgcG9wdXBNZW51TGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzLmZhY2Vib29rKF9saW5rcywgdGl0bGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHBvcHVwTWVudUxpbmtzID0gdmlkZW8ucHJlcGFyZUxpbmtzKGxpbmtzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtZW51LnVwZGF0ZShwb3B1cE1lbnVMaW5rcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIHBvcHVwTWVudUxpbmtzID0gdmlkZW8ucHJlcGFyZUxpbmtzKGxpbmtzKTsKICAgICAgICAgIG1lbnUudXBkYXRlKHBvcHVwTWVudUxpbmtzKTsKICAgICAgICB9CgogICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgIGVjOiAnZmFjZWJvb2snLAogICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgZWw6ICd2aWRlby1mZWVkJwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBhZGREb3dubG9hZEJ0bjogZnVuY3Rpb24oY29udGFpbmVyLCBsaW5rcykgewogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgc2ZEbExpbmtzOiBKU09OLnN0cmluZ2lmeShsaW5rcykKICAgICAgICAgIH0sCiAgICAgICAgICB0aXRsZTogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICBjbGFzczogW2ZiLmNsYXNzTmFtZSArICctZmVlZCcsICdzZi1mZWVkJ10sCiAgICAgICAgICBocmVmOiAnIycsCiAgICAgICAgICBvbjogWydjbGljaycsIHZpZGVvRmVlZC5vbkRsQnRuQ2xpY2tdCiAgICAgICAgfSkpOwogICAgICB9LAogICAgICBvbkxpbmtIb3ZlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICBpZiAodGhpcy5kYXRhc2V0Lmhhc1NmRmVlZEJ0biA+IDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5kYXRhc2V0Lmhhc1NmRmVlZEJ0biA9ICcxJzsKCiAgICAgICAgdmFyIG9uUmVhZHkgPSBmdW5jdGlvbihsaW5rcykgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgaWYgKCFsaW5rcykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG1vbm8ubWF0Y2hlcyhfdGhpcywgJy51aVN0cmVhbVN0b3J5ICcgKyBfdGhpcy50YWdOYW1lKSB8fAogICAgICAgICAgICBtb25vLm1hdGNoZXMoX3RoaXMsICcuZmJQaG90b1Nub3dsaWZ0Q29udGFpbmVyICcgKyBfdGhpcy50YWdOYW1lKQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHZpZGVvRmVlZC5hZGREb3dubG9hZEJ0bihfdGhpcy5wYXJlbnROb2RlLCBsaW5rcyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdGltZUxpbmVNYWluQ29sdW1uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2VsZXRfdGltZWxpbmVfbWFpbl9jb2x1bW4nKSB8fAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWFtX3BhZ2VsZXQnKSB8fAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRhaW5lcicpOwoKICAgICAgICAgIGlmICh0aW1lTGluZU1haW5Db2x1bW4gJiYgdGltZUxpbmVNYWluQ29sdW1uLmNvbnRhaW5zKF90aGlzKSkgewogICAgICAgICAgICB2aWRlb0ZlZWQuYWRkRG93bmxvYWRCdG4oX3RoaXMucGFyZW50Tm9kZSwgbGlua3MpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHZpZGVvRWwgPSB0aGlzOwogICAgICAgIGlmICh2aWRlb0VsLnRhZ05hbWUgPT09ICdWSURFTycpIHsKICAgICAgICAgIHZpZGVvRWwgPSB2aWRlb0VsLnF1ZXJ5U2VsZWN0b3IoJ2VtYmVkJykgfHwgdGhpczsKICAgICAgICB9CgogICAgICAgIGlmICh2aWRlb0VsLnRhZ05hbWUgPT09ICdFTUJFRCcpIHsKICAgICAgICAgIHZpZGVvLmdldExpbmtzRnJvbUVtYmVkKHZpZGVvRWwsIG9uUmVhZHkpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh2aWRlb0VsLnRhZ05hbWUgPT09ICdWSURFTycpIHsKICAgICAgICAgIHZpZGVvLmdldExpbmtzRnJvbVZpZGVvKHZpZGVvRWwsIG9uUmVhZHkpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcm1CdG46IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoJ2hhc1NmRmVlZEJ0bicpOwogICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcqWycgKyBkYXRhQXR0ciArICddJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgaXRlbS5yZW1vdmVBdHRyaWJ1dGUoZGF0YUF0dHIpOwogICAgICAgIH0KICAgICAgICB2YXIgYnRuTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgZmIuY2xhc3NOYW1lICsgJy1mZWVkJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBidG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgIGl0ZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpdGVtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSwgbnVsbCwgZnVuY3Rpb24gc3luY0lzQWN0aXZlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vKi5mYWNlYm9vay5jb20vKicKICAgICAgXTsKCiAgICAgIHZhciByZVN0ciA9IGxpc3QubWFwKGZ1bmN0aW9uKHBhdHRlcm4pIHsKICAgICAgICByZXR1cm4gbW9uby51cmxQYXR0ZXJuVG9TdHJSZShwYXR0ZXJuKTsKICAgICAgfSkuam9pbignfCcpOwogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHJlU3RyKTsKCiAgICAgIGlmICghcmUudGVzdChsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0bmFtZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICBpZiAobW9uby5pc0lmcmFtZSgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9KTsKICAodHlwZW9mIG1vbm8gPT09ICd1bmRlZmluZWQnKSAmJiAobW9ubyA9IHsKICAgIGxvYWRNb2R1bGU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxvYWRNb2R1bGVTdGFjay5wdXNoKGFyZ3VtZW50cyk7CiAgICB9LAogICAgbG9hZE1vZHVsZVN0YWNrOiBbXQogIH0pOwoKICBtb25vLmxvYWRNb2R1bGUoJ2xtJywgZnVuY3Rpb24obW9kdWxlTmFtZSwgaW5pdERhdGEpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBsYW5ndWFnZSA9IGluaXREYXRhLmdldExhbmd1YWdlOwogICAgdmFyIHByZWZlcmVuY2UgPSBpbml0RGF0YS5nZXRQcmVmZXJlbmNlOwogICAgdmFyIG1vZHVsZVN0YXRlID0gKHByZWZlcmVuY2UubG1GaWxlSG9zdGluZyB8fCBwcmVmZXJlbmNlLmxtTWVkaWFIb3N0aW5nKSA/IDEgOiAwOwoKICAgIGlmIChwcmVmZXJlbmNlLnNob3dVbW15SW5mbykgewogICAgICBtb25vLmFzeW5jQ2FsbChmdW5jdGlvbigpIHsKICAgICAgICBjaGVja1VtbXlQYWdlKCk7CiAgICAgIH0pOwogICAgfQoKICAgIG1vbm8ub25NZXNzYWdlLmFkZExpc3RlbmVyKGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2dldE1vZHVsZUluZm8nKSB7CiAgICAgICAgaWYgKG1lc3NhZ2UudXJsICE9PSBsb2NhdGlvbi5ocmVmKSByZXR1cm47CiAgICAgICAgcmV0dXJuIGNiKHsKICAgICAgICAgIHN0YXRlOiBtb2R1bGVTdGF0ZSwKICAgICAgICAgIG1vZHVsZU5hbWU6IG1vZHVsZU5hbWUKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICdjaGFuZ2VTdGF0ZScpIHsKICAgICAgICBpZiAobW9kdWxlTmFtZSAhPT0gbWVzc2FnZS5tb2R1bGVOYW1lKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJldHVybiBsbS5jaGFuZ2VTdGF0ZShtZXNzYWdlLnN0YXRlKTsKICAgICAgfQogICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ3VwZGF0ZUxpbmtzJykgewogICAgICAgIGxtLnNhdmVmcm9tTGlua0NvdW50ID0gLTE7CiAgICAgICAgbG0ucnVuKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIGlmIChtb2R1bGVTdGF0ZSkgewogICAgICBtb25vLmFzeW5jQ2FsbChmdW5jdGlvbigpIHsKICAgICAgICBsbS5ydW4oKTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGNoZWNrVW1teVBhZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKHR5cGVvZiBsb2NhdGlvbiA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKCiAgICAgIHZhciB1cmwgPSBsb2NhdGlvbi5ocmVmOwogICAgICBpZiAodXJsLmluZGV4T2YoInZpZGVvZG93bmxvYWRlci51bW15Lm5ldCIpID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodXJsLm1hdGNoKC9wb3pkcmF2bHlhZW18Y29uZ3JhdHVsYXRpb25zfHRlYnJpa2xlci8pICE9PSBudWxsKSB7CiAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICBhY3Rpb246ICd1cGRhdGVPcHRpb24nLAogICAgICAgICAga2V5OiAnc2hvd1VtbXlJbmZvJywKICAgICAgICAgIHZhbHVlOiAwCiAgICAgICAgfSk7CiAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICBhY3Rpb246ICd1cGRhdGVPcHRpb24nLAogICAgICAgICAga2V5OiAndW1teURldGVjdGVkJywKICAgICAgICAgIHZhbHVlOiAxCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgdmFyIGxtID0gewogICAgICBodG1sQWZ0ZXI6ICcnLAoKICAgICAgbGlua1RleHQ6ICcnLAoKICAgICAgbGlua1N0eWxlOiB7CiAgICAgICAgJ2JvcmRlcic6ICdub25lJywKICAgICAgICAndGV4dERlY29yYXRpb24nOiAnbm9uZScsCiAgICAgICAgJ3BhZGRpbmcnOiAnMCcsCiAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJwogICAgICB9LAoKICAgICAgaW1nU3R5bGU6IHsKICAgICAgICAnYm9yZGVyJzogJ25vbmUnLAogICAgICAgICd3aWR0aCc6ICdhdXRvJywKICAgICAgICAnaGVpZ2h0JzogJ2F1dG8nCiAgICAgIH0sCgogICAgICBidXR0b25TcmM6ICdkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhFQUFRQU9aM0FQZjM5K1hsNWZUMDlPUGo0L0h4OGV2cjYvMysvdTd1N3VEaDRPUGk0OTdlM3Q3ZTMvejgvUDc5L1gzR2J1WGw1dWJsNWVIZzRXekZVZmIzOStQajRsekdPVjdMT1B6NysvbjYrdm41K1pUTGo5L2UzODdPenQ3ZjMvNysvdnY3L0lTYmVQbjUrbS9KVjFuUktYbVZia0NuS1ZyU0xEcXNDdURoNGQvZTN1RG4zL3o3L0g2VGRWZWFWMXVTVytibjV2MzkvZVhtNWVYbTVreUhQL2YzOXB6R21WeTdKM3lSZDkvZjNtTEVLa1hDSEpia2EyVFZNNXZhWm42V2RmbjYrWUcvYy9yNStaTy9qZUxpNDFhSFRJZWFnZUxuNGYzOS92cjYra3pORzJQVk01aStsb21kZjJDWFlLSFZtdHpvMllYTmVEcXNCZWJsNXVIaDRIREtXTjNnM2tLcUVINldlWkhUWElQS2RuU1Bidjc5L3BmbWJFN1BIcGUxbDRPOGRUTzVET0RnNFZETElsS1VVdHpvMko3U21FV3NMbEc0TkpiRmprckpIUDcrL1ZLNU5mejgrem1uQzNLS2ErSGc0T0hoNFk2M2ovMysvZURnNE9qbzZQLy8vOERBd1AvLy93QUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUNINUJBRUFBSGNBTEFBQUFBQVFBQkFBQUFmV2dIZDJnNFNGaFlKemRZcUxqSXB6Z3g1YkJnWXdIZzFIazJvTkRYS0RGd3dmREY1TkxtTXRjU3RzbjRNaEdUOFlTMDRhR21VMVFSaElHWU1UQURRQVFsQU9EbGxvQU1ZVGd3SUNSbVJmVkJJU0lrQlBLc3FEQkFSRVptY1ZGaFlWYXlVejJJTUhCMWRXT21JbUkybGdVVnJtZ3dVRkx6ZHRYVHhLU1NkdU1mU0Q2QWlrNDhNR2x4MDVTQXlrTTBnS2hBQVBBaFRCMG9ORkFCa1BIZzVLTUlCQ3h6bE1RRlFaTUdCSWdnU0Rwc0NKZ0dET216a0lVQ0FJTTJkT2hFRWNOaWpRdVFESGdnNEtPcVJZd01HT0lFTklCOTBKQkFBNycsCgogICAgICBzZnJlZjogJyZ1dG1fc291cmNlPXtzZkhlbHBlck5hbWV9JnV0bV9tZWRpdW09ZXh0ZW5zaW9ucyZ1dG1fY2FtcGFpZ249bGlua19tb2RpZmllcicsCgogICAgICBwYWdlVXJsOiAnaHR0cDovL3NhdmVmcm9tLm5ldC8nLAogICAgICBhbmNob3JBdHRyaWJ1dGU6ICdzYXZlZnJvbV9sbScsCiAgICAgIGFuY2hvckF0dHJpYnV0ZUxpbms6ICdzYXZlZnJvbV9sbV9pc19saW5rJywKICAgICAgYW5jaG9ySW5kZXhBdHRyaWJ1dGU6ICdzYXZlZnJvbV9sbV9pbmRleCcsCgogICAgICBsaW5rUmVnRXhwOiBudWxsLAoKICAgICAgc2F2ZWZyb21MaW5rQ291bnQ6IDAsCgogICAgICByZTogewogICAgICAgIGZpbGVob3N0aW5nOiB7CiAgICAgICAgICAncmFwaWRzaGFyZS5jb20nOiBbL15odHRwcz86XC9cLyhbXHdcLV0rXC4pP3JhcGlkc2hhcmVcLmNvbVwvXCNcIWRvd25sb2FkXHxcZCtcfFxkK1x8W15cc1wiXHxdK1x8XGQrL2ksIC9eaHR0cHM/OlwvXC8ocnNcZCtcLnx3d3dcLik/cmFwaWRzaGFyZVwuY29tXC9maWxlc1wvXGQrXC8uKy9pXSwKICAgICAgICAgICdmaWxlZmFjdG9yeS5jb20nOiBbL15odHRwOlwvXC8od3d3XC4pP2ZpbGVmYWN0b3J5XC5jb21cL2ZpbGVcL1thLXowLTldK1wvPy9pXSwKICAgICAgICAgICdzZW5kc3BhY2UuY29tJzogWy9eaHR0cDpcL1wvKHd3d1wuKT9zZW5kc3BhY2VcLmNvbVwvZmlsZVwvXHcrL2ldCiAgICAgICAgfSwKCiAgICAgICAgbWVkaWFob3N0aW5nOiB7CiAgICAgICAgICAneW91dHViZS5jb20nOiBbCiAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oW2Etel0rXC4pP3lvdXR1YmVcLmNvbVwvKCMhP1wvKT93YXRjaFw/Lip2PS9pLAogICAgICAgICAgICAvXmh0dHBzPzpcL1wvKFthLXowLTldK1wuKT95b3V0dWJlXC5jb21cLyhlbWJlZHx2KVwvW1x3XC1dKy9pCiAgICAgICAgICBdLAogICAgICAgICAgJ3lvdXR1LmJlJzogWy9eaHR0cHM/OlwvXC8oW2Etel0rXC4pP3lvdXR1XC5iZVwvW1x3XC1dKy9pXSwKICAgICAgICAgICdnb29nbGUuY29tJzogWy9eaHR0cDpcL1wvdmlkZW9cLmdvb2dsZVwuY29tXC92aWRlb3BsYXlcPy4qZG9jaWQ9L2ldLAogICAgICAgICAgJ21ldGFjYWZlLmNvbSc6IFsvXmh0dHA6XC9cLyh3d3dcLik/bWV0YWNhZmVcLmNvbVwvd2F0Y2hcL1xkK1wvW15cL10rXC8/L2ldLAogICAgICAgICAgJ2JyZWFrLmNvbSc6IFsvXmh0dHA6XC9cLyh3d3dcLik/YnJlYWtcLmNvbVwvKGluZGV4fG1vdmllc1x3KnwoXHcrXC0pK1x3KylcLy4rXC5odG1sJC9pLCAvXmh0dHA6XC9cL3ZpZXdcLmJyZWFrXC5jb21cL1xkKy9pXSwKICAgICAgICAgICd2aW1lby5jb20nOiBbL15odHRwOlwvXC8oW1x3XC1dK1wuKT92aW1lb1wuY29tXC9cZCskL2ldLAogICAgICAgICAgJ3NldmVubG9hZC5jb20nOiBbL15odHRwOlwvXC8oW1x3XC1dK1wuKT9zZXZlbmxvYWRcLmNvbVwvdmlkZW9zXC9bLVx3XCtcLz1dKy9pLCAvXmh0dHA6XC9cLyhbXHdcLV0rXC4pP3NldmVubG9hZFwuY29tXC9zaG93c1wvLisvaV0sCiAgICAgICAgICAnZmFjZWJvb2suY29tJzogWy9eaHR0cHM/OlwvXC8oPzp3d3dcLilmYWNlYm9va1wuY29tXC8oW15cL10rXC8pKnZpZGVvXC5waHBcPyhbXiZdKyYpKnY9XGQrL2ldLAogICAgICAgICAgLy8ncnV0dWJlLnJ1JzogWy9eaHR0cDpcL1wvcnV0dWJlXC5ydVwvdHJhY2tzXC9cZCtcLmh0bWxcPy4qdj1bYS1mMC05XSsvaV0sCiAgICAgICAgICAnbWFpbC5ydSc6IFsvXmh0dHA6XC9cLyhbYS16MC05Xy1dK1wuKT92aWRlb1wubWFpbFwucnVcLyguK1wvKStcZCtcLmh0bWwvaSwgL15odHRwOlwvXC9yXC5tYWlsXC5ydVwvXHcrXC92aWRlb1wubWFpbFwucnVcLyguK1wvKStcZCtcLmh0bWwvaV0sCiAgICAgICAgICAneWFuZGV4LnJ1JzogWy9eaHR0cDpcL1wvdmlkZW9cLnlhbmRleFwucnVcL3VzZXJzXC9bLVx3LCFcK10rXC92aWV3XC9bLVx3LCFcK10rXC8/L2ldLAogICAgICAgICAgJ3JhbWJsZXIucnUnOiBbL15odHRwOlwvXC92aXNpb25cLnJhbWJsZXJcLnJ1XC91c2Vyc1wvW15cL1xzXStcL1xkK1wvWy1cd19cKyFdK1wvPy9pXSwKICAgICAgICAgICdzbW90cmkuY29tJzogWy9eaHR0cDpcL1wvKFthLXowLTlfLV0rXC4pP3Ntb3RyaVwuY29tXC92aWRlb1wvdmlld1wvXD8uKmlkPXZbMC05YS1mXS9pXSwKICAgICAgICAgICd0dmlnbGUucnUnOiBbL15odHRwOlwvXC8od3d3XC4pP3R2aWdsZVwucnVcL2NoYW5uZWxcL1xkK1w/Lip2aWRfaWQ9XGQrL2ksIC9eaHR0cDpcL1wvKHd3d1wuKXR2aWdsZVwucnVcL3ByZ1wvXGQrXC9cZCsvaV0sCiAgICAgICAgICAnaW50di5ydSc6IFsvXmh0dHA6XC9cLyh3d3dcLik/aW50dlwucnVcLyh2aWV3fHF1aWNrZGwpXC9cPy4qZmlsbV9pZD1cdysvaSwgL15odHRwOlwvXC8od3d3XC4pP2ludHZcLnJ1XC92XC9cdysvaV0sCiAgICAgICAgICAneWFzZWUucnUnOiBbL15odHRwOlwvXC8oW2EtejAtOV8tXStcLik/eWFzZWVcLnJ1XC92aWRlb1wvdmlld1wvXD8uKmlkPXZbMC05YS1mXS9pXSwKICAgICAgICAgICduYXJvZC50dic6IFsvXmh0dHA6XC9cLyg/Ond3d1wuKT9uYXJvZFwudHZcL1w/Lip2aWQ9L2ldLAogICAgICAgICAgJ3ZrYWRyZS5ydSc6IFsvXmh0dHA6XC9cLyh3d3dcLik/dmthZHJlXC5ydVwvdmlkZW9zXC9cZCsvaV0sCiAgICAgICAgICAnbXl2aS5ydSc6IFsKICAgICAgICAgICAgL15odHRwOlwvXC8od3d3XC4pP215dmlcLnJ1XC8oW2Etel1bYS16XVwvKT92aWRlb2RldGFpbFwuYXNweFw/Lip2aWRlbz0vaSwKICAgICAgICAgICAgL15odHRwOlwvXC8od3d3fGtpbm98YW5pbWUpXC5teXZpXC5ydVwvd2F0Y2hcL1tcd1wtXSsvaQogICAgICAgICAgXSwKICAgICAgICAgICcxdHYucnUnOiBbL15odHRwOlwvXC8od3d3XC4pPzF0dlwucnUoXDpcZCspP1wvbmV3c3ZpZGVvXC9cZCsvaSwgL15odHRwOlwvXC8od3d3XC4pPzF0dlwucnUoXDpcZCspP1wvbmV3c1wvXHcrXGQrL2ldLAogICAgICAgICAgJ250di5ydSc6IFsvXmh0dHA6XC9cL25ld3NcLm50dlwucnVcLyhcdytcLyk/XGQrXC92aWRlb1wvPy9pXSwKICAgICAgICAgICd2ZXN0aS5ydSc6IFsvXmh0dHA6XC9cLyh3d3dcLik/dmVzdGlcLnJ1XC92aWRlb3NcPy4qdmlkPVxkKy9pXSwKICAgICAgICAgICdiaWJpZ29uLnJ1JzogWy9eaHR0cDpcL1wvKHd3d1wuKT9iaWJpZ29uXC5ydVwvdmlkZW93XC5odG1sXD9pZD1cZCsvaSwgL15odHRwOlwvXC8od3d3XC4pP2JpYmlnb25cLnJ1XC92aWRlb1wuaHRtbFw/dmlkPVxkKy9pXSwKICAgICAgICAgICdtcmVwb3J0ZXIucnUnOiBbL15odHRwOlwvXC8od3d3XC4pP21yZXBvcnRlclwucnVcL3JlcG9ydGVybWVzc2FnZXNcIXZpZXdyZXBvcnRcLmRvW15cP10qXD8uKnJlcG9ydGlkPVxkKy9pXSwKICAgICAgICAgICdhdXRvcGx1c3R2LnJ1JzogWy9eaHR0cDpcL1wvKHd3d1wuKT9hdXRvcGx1c3R2XC5ydVwvNDk0XC9cP2lkPVxkKy9pXSwKICAgICAgICAgICdydXNzaWEucnUnOiBbL15odHRwOlwvXC8oW1x3XC1dK1wuKT9ydXNzaWFcLnJ1XC92aWRlb1wvPy9pXSwKICAgICAgICAgICdhbWlrLnJ1JzogWy9eaHR0cDpcL1wvKHd3d1wuKT9hbWlrXC5ydVwvdmlkZW9cL3ZpZFxkK1wuaHRtbC9pLCAvXmh0dHA6XC9cLyh3d3dcLik/YW1pa1wucnVcL3ZpZGVvXC92Y2lkXGQrXC5odG1sL2ldLAogICAgICAgICAgJ2xpZmUucnUnOiBbL15odHRwOlwvXC8oW1x3K1wtXStcLik/bGlmZVwucnVcL3ZpZGVvXC9cZCsvaV0KICAgICAgICB9CiAgICAgIH0sCgoKICAgICAgcGFyc2VIcmVmOiBmdW5jdGlvbihocmVmLCBzZWFyY2gpIHsKICAgICAgICB2YXIgcmVzID0gW107CiAgICAgICAgcmVzLnB1c2goaHJlZik7CgogICAgICAgIHZhciBpID0gaHJlZi50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2h0dHA6Ly8nLCA3KTsKICAgICAgICBpZiAoaSA+IDcpIHsKICAgICAgICAgIHJlcy5wdXNoKGhyZWYuc3Vic3RyaW5nKGkpKTsKICAgICAgICB9IGVsc2UgaWYgKHNlYXJjaCkgewogICAgICAgICAgdmFyIGggPSBzZWFyY2gubWF0Y2goL2h0dHAlM2EoJTJmJTJmfFwvXC8pW15cc1wmXCJcPFw+XSsvaSk7CiAgICAgICAgICBpZiAoaCAmJiBoLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmVzLnB1c2goZGVjb2RlVVJJQ29tcG9uZW50KGhbMF0pKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBzID0gJyc7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcyA9IGRlY29kZVVSSUNvbXBvbmVudChzZWFyY2gpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CgogICAgICAgICAgICBpZiAocykgewogICAgICAgICAgICAgIC8vIGZhY2Vib29rCiAgICAgICAgICAgICAgaCA9IHMubWF0Y2goLygoPzphSFIwY0Rvdkx8YUhSMGNITTZMeSlbYS16MC05K1wvPV0rKS9pKTsKICAgICAgICAgICAgICBpZiAoaCAmJiBoLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGggPSBhdG9iKGhbMV0pOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICBoID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaC5zZWFyY2goL15odHRwcz86XC9cLy9pKSAhPSAtMSkKICAgICAgICAgICAgICAgICAgcmVzLnB1c2goZGVjb2RlVVJJQ29tcG9uZW50KGgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXM7CiAgICAgIH0sCgoKICAgICAgaHJlZjogZnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiBhLmdldEF0dHJpYnV0ZSgnaHJlZicpIHx8ICcnOwogICAgICB9LAoKCiAgICAgIGdldEVsZW1lbnRJbmRleDogZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBodG1sID0gZS5pbm5lckhUTUw7CiAgICAgICAgaWYgKCFodG1sIHx8IGh0bWwgPT0gJyAnKQogICAgICAgICAgcmV0dXJuIDE7CgogICAgICAgIHZhciBiZyA9IGUuc3R5bGUuYmFja2dyb3VuZEltYWdlOwogICAgICAgIGlmIChiZyAmJiBiZyAhPSAnbm9uZScpCiAgICAgICAgICByZXR1cm4gMTsKCiAgICAgICAgdmFyIGMgPSBlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoY1tpXS50YWdOYW1lID09ICdJTUcnKQogICAgICAgICAgICByZXR1cm4gMjsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBiZyA9IGNbaV0uc3R5bGUuYmFja2dyb3VuZEltYWdlOwogICAgICAgICAgICBpZiAoYmcgJiYgYmcgIT0gJ25vbmUnKQogICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0sCgoKICAgICAgcnVuOiBmdW5jdGlvbigpIHsKICAgICAgICBTYXZlRnJvbV9VdGlscy5lbWJlZERvd25sb2FkZXIuaW5pdCgpOwoKICAgICAgICBsbS5zZnJlZiA9IGxtLnNmcmVmLnJlcGxhY2UoJ3tzZkhlbHBlck5hbWV9JywgcHJlZmVyZW5jZS5zZkhlbHBlck5hbWUpOwoKICAgICAgICB2YXIgcHJlZkZpbGVIb3N0aW5nID0gISFwcmVmZXJlbmNlLmxtRmlsZUhvc3Rpbmc7CiAgICAgICAgdmFyIHByZWZNZWRpYUhvc3RpbmcgPSAhIXByZWZlcmVuY2UubG1NZWRpYUhvc3Rpbmc7CgogICAgICAgIG1vZHVsZVN0YXRlID0gMTsKCiAgICAgICAgbG0ubGlua1JlZ0V4cCA9IHt9OwogICAgICAgIGlmIChwcmVmRmlsZUhvc3RpbmcpIHsKICAgICAgICAgIGZvciAodmFyIGkgaW4gbG0ucmUuZmlsZWhvc3RpbmcpCiAgICAgICAgICAgIGxtLmxpbmtSZWdFeHBbaV0gPSBsbS5yZS5maWxlaG9zdGluZ1tpXTsKICAgICAgICB9CgogICAgICAgIGlmIChwcmVmTWVkaWFIb3N0aW5nKSB7CiAgICAgICAgICBmb3IgKHZhciBpIGluIGxtLnJlLm1lZGlhaG9zdGluZykKICAgICAgICAgICAgbG0ubGlua1JlZ0V4cFtpXSA9IGxtLnJlLm1lZGlhaG9zdGluZ1tpXTsKICAgICAgICB9CgoKICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7CiAgICAgICAgaWYgKGxtLnNhdmVmcm9tTGlua0NvdW50ICE9IGEubGVuZ3RoKSB7CiAgICAgICAgICBsbS5zYXZlZnJvbUxpbmtDb3VudCA9IGEubGVuZ3RoOwoKICAgICAgICAgIHZhciBmb3VuZCA9IHt9LAogICAgICAgICAgICBsYXN0SHJlZiA9ICcnOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHZhciBocmVmID0gaGFuZGxlQW5jaG9yKGFbaV0pOwogICAgICAgICAgICBpZiAoaHJlZikgewogICAgICAgICAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgICAgICAgICAgdmFyIGF0dHIgPSBhW2ldLmdldEF0dHJpYnV0ZShsbS5hbmNob3JJbmRleEF0dHJpYnV0ZSk7CiAgICAgICAgICAgICAgaWYgKGF0dHIgPT09IDAgfHwgYXR0cikKICAgICAgICAgICAgICAgIGluZGV4ID0gcGFyc2VJbnQoYXR0cik7CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IGxtLmdldEVsZW1lbnRJbmRleChhW2ldKTsKICAgICAgICAgICAgICAgIGFbaV0uc2V0QXR0cmlidXRlKGxtLmFuY2hvckluZGV4QXR0cmlidXRlLCBpbmRleCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZm91bmRbaHJlZl0pIHsKICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IGZvdW5kW2hyZWZdLmluZGV4KSB7CiAgICAgICAgICAgICAgICAgIGZvdW5kW2hyZWZdLmVsZW1lbnRzID0gW2FbaV1dOwogICAgICAgICAgICAgICAgICBmb3VuZFtocmVmXS5pbmRleCA9IGluZGV4OwogICAgICAgICAgICAgICAgICBsYXN0SHJlZiA9IGhyZWY7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09IGZvdW5kW2hyZWZdLmluZGV4ICYmIGhyZWYgIT0gbGFzdEhyZWYpIHsKICAgICAgICAgICAgICAgICAgZm91bmRbaHJlZl0uZWxlbWVudHMucHVzaChhW2ldKTsKICAgICAgICAgICAgICAgICAgbGFzdEhyZWYgPSBocmVmOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3VuZFtocmVmXSA9IHsKICAgICAgICAgICAgICAgICAgaW5kZXg6IGluZGV4LAogICAgICAgICAgICAgICAgICBlbGVtZW50czogW2FbaV1dCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGxhc3RIcmVmID0gaHJlZjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgY291bnQgPSAwOwogICAgICAgICAgZm9yICh2YXIgaSBpbiBmb3VuZCkgewogICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgbGVuID0gZm91bmRbaV0uZWxlbWVudHMubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICAgICAgICB2YXIgZSA9IGZvdW5kW2ldLmVsZW1lbnRzW2pdOwogICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgICAgaWYgKCFlLmdldEF0dHJpYnV0ZShsbS5hbmNob3JBdHRyaWJ1dGUpKQogICAgICAgICAgICAgICAgbW9kaWZ5TGluayhlLCBpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCgoKICAgICAgICBmdW5jdGlvbiBjaGVja0xpbmsobGluaywgZG9tYWluKSB7CiAgICAgICAgICBpZiAoIWxpbmspCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICBpZiAobGluayA9PSB3aW5kb3cubG9jYXRpb24uaHJlZikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgIGRvbWFpbiA9IFNhdmVGcm9tX1V0aWxzLmdldFRvcExldmVsRG9tYWluKGRvbWFpbik7CiAgICAgICAgICBpZiAoIWRvbWFpbiB8fCAhbG0ubGlua1JlZ0V4cFtkb21haW5dKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsbS5saW5rUmVnRXhwW2RvbWFpbl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGxpbmsuc2VhcmNoKGxtLmxpbmtSZWdFeHBbZG9tYWluXVtpXSkgIT0gLTEpCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCgogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUFuY2hvcihvYmopIHsKICAgICAgICAgIHZhciBocmVmID0gb2JqLmhyZWY7CiAgICAgICAgICBpZiAodHlwZW9mIGhyZWYgPT09ICdzdHJpbmcnICYmIGhyZWYuc2VhcmNoKC9eaHR0cHM/OlwvXC8oW1x3XC1dK1wuKT9zYXZlZnJvbVwubmV0XC8vaSkgPT0gLTEpIHsKICAgICAgICAgICAgdmFyIGhyZWZBcnJheSA9IGxtLnBhcnNlSHJlZihocmVmLCBvYmouc2VhcmNoKTsKCiAgICAgICAgICAgIGlmIChocmVmQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGlmIChsbS5ocmVmKG9iaikuaW5kZXhPZignIycpICE9IDAgJiYgY2hlY2tMaW5rKGhyZWZBcnJheVswXSwgb2JqLmhvc3RuYW1lKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGhyZWZBcnJheVswXTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhyZWZBcnJheS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMTsgaiA8IGhyZWZBcnJheS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICB2YXIgYVRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgICAgICAgIGFUZW1wLmhyZWYgPSBocmVmQXJyYXlbal07CiAgICAgICAgICAgICAgICAgIGlmIChsbS5ocmVmKGFUZW1wKS5pbmRleE9mKCcjJykgIT0gMCAmJiBjaGVja0xpbmsoaHJlZkFycmF5W2pdLCBhVGVtcC5ob3N0bmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaHJlZkFycmF5W2pdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbW9kaWZ5TGluayhvYmosIGxpbmspIHsKICAgICAgICAgIGlmICghb2JqKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgb2JqLnNldEF0dHJpYnV0ZShsbS5hbmNob3JBdHRyaWJ1dGUsICcxJyk7CgogICAgICAgICAgdmFyIGJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgIGJveC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ3BhZGRpbmc6IDA7IG1hcmdpbjogMDsgbWFyZ2luLWxlZnQ6IDVweDsnKTsKICAgICAgICAgIGJveC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBwYXJlbnQgPSBvYmoucGFyZW50Tm9kZTsKICAgICAgICAgIGlmICghcGFyZW50KQogICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGluayA9IGVuY29kZVVSSUNvbXBvbmVudChsaW5rKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGhyZWYgPSBsbS5wYWdlVXJsICsgJz91cmw9JyArIGxpbms7CiAgICAgICAgICBpZiAobG0uc2ZyZWYpCiAgICAgICAgICAgIGhyZWYgKz0gbG0uc2ZyZWY7CgogICAgICAgICAgLy8gYWRkIGJ1dHRvbgogICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICBhLmhyZWYgPSBocmVmOwogICAgICAgICAgYS50YXJnZXQgPSAnX2JsYW5rJzsKICAgICAgICAgIGEudGl0bGUgPSBsYW5ndWFnZS5sbUJ1dHRvblRpdGxlOwoKICAgICAgICAgIGEuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgbG0uYnV0dG9uU3JjICsgJyknOwogICAgICAgICAgYS5zdHlsZS5iYWNrZ3JvdW5kUmVwZWF0ID0gJ25vLXJlcGVhdCc7CiAgICAgICAgICBhLnN0eWxlLndpZHRoID0gJzE2cHgnOwogICAgICAgICAgYS5zdHlsZS5oZWlnaHQgPSAnMTZweCc7CiAgICAgICAgICBhLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsKCiAgICAgICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICBlYzogJ21lZGlhaG9zdCcsCiAgICAgICAgICAgICAgICBlYTogJ2Zyb20nLAogICAgICAgICAgICAgICAgZWw6IG1vbm8uZ2V0RG9tYWluKGxvY2F0aW9uLmhyZWYsIDEpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gbG0ubGlua1N0eWxlKQogICAgICAgICAgICBhLnN0eWxlW2ldID0gbG0ubGlua1N0eWxlW2ldOwoKICAgICAgICAgIGlmIChvYmouc3R5bGUuekluZGV4KSB7CiAgICAgICAgICAgIGEuc3R5bGUuekluZGV4ID0gb2JqLnN0eWxlLnpJbmRleDsKICAgICAgICAgIH0KCiAgICAgICAgICBhLnNldEF0dHJpYnV0ZShsbS5hbmNob3JBdHRyaWJ1dGUsICcxJyk7CiAgICAgICAgICBhLnNldEF0dHJpYnV0ZShsbS5hbmNob3JBdHRyaWJ1dGVMaW5rLCAnMScpOwogICAgICAgICAgaWYgKGxtLmxpbmtUZXh0KSB7CiAgICAgICAgICAgIGEudGV4dENvbnRlbnQgPSBsbS5saW5rVGV4dDsKICAgICAgICAgIH0KCiAgICAgICAgICBib3guYXBwZW5kQ2hpbGQoYSk7CgogICAgICAgICAgaWYgKGxtLmh0bWxBZnRlcikKICAgICAgICAgICAgYm94LnRleHRDb250ZW50ICs9IGxtLmh0bWxBZnRlcjsKCgogICAgICAgICAgaWYgKG9iai5uZXh0U2libGluZykKICAgICAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShib3gsIG9iai5uZXh0U2libGluZyk7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChib3gpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgY2hhbmdlU3RhdGU6IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAgICAgcHJlZmVyZW5jZS5sbUZpbGVIb3N0aW5nID0gc3RhdGU7CiAgICAgICAgcHJlZmVyZW5jZS5sbU1lZGlhSG9zdGluZyA9IHN0YXRlOwogICAgICAgIG1vZHVsZVN0YXRlID0gc3RhdGU7CiAgICAgICAgdmFyIGJ0bkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhWycgKyBsbS5hbmNob3JBdHRyaWJ1dGVMaW5rICsgJ10nKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGJ0bkxpc3RbaV07IGkrKykgewogICAgICAgICAgaXRlbSA9IGl0ZW0ucGFyZW50Tm9kZTsKICAgICAgICAgIGl0ZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpdGVtKTsKICAgICAgICB9CiAgICAgICAgdmFyIGRhdGFBdHRyTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoWycqWycgKyBsbS5hbmNob3JBdHRyaWJ1dGUgKyAnXScsICcqWycgKyBsbS5hbmNob3JJbmRleEF0dHJpYnV0ZSArICddJ10pOwogICAgICAgIGZvciAoaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgaXRlbS5yZW1vdmVBdHRyaWJ1dGUobG0uYW5jaG9yQXR0cmlidXRlKTsKICAgICAgICAgIGl0ZW0ucmVtb3ZlQXR0cmlidXRlKGxtLmFuY2hvckluZGV4QXR0cmlidXRlKTsKICAgICAgICB9CiAgICAgICAgbG0uc2F2ZWZyb21MaW5rQ291bnQgPSAtMTsKCiAgICAgICAgaWYgKHN0YXRlKSB7CiAgICAgICAgICBsbS5ydW4oKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSwgbnVsbCwgZnVuY3Rpb24gc3luY0lzQWN0aXZlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKGRvY3VtZW50LmNvbnRlbnRUeXBlICYmIGRvY3VtZW50LmNvbnRlbnRUeXBlICE9PSAndGV4dC9odG1sJykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG1vbm8uaXNJZnJhbWUoKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0ZGIHx8IG1vbm8uaXNHTSkgewogICAgICB2YXIgZXhjbHVkZUxpc3QgPSBbCiAgICAgICAgJ2Z0cDovLyonLAogICAgICAgICdmaWxlOi8vKicsCiAgICAgICAgJyo6Ly8qLmdvb2dsZS4qLyonLAogICAgICAgICcqOi8vKi5hY2lkdGVzdHMub3JnLyonLAoKICAgICAgICAnKjovLyouc2F2ZWZyb20ubmV0LyonLAogICAgICAgICcqOi8vKi55b3V0dWJlLmNvbS8qJywKICAgICAgICAnKjovLyoudmltZW8uY29tLyonLAogICAgICAgICcqOi8vKi5kYWlseW1vdGlvbi4qLyonLAogICAgICAgICcqOi8vKi52ay5jb20vKicsCiAgICAgICAgJyo6Ly8qLnZrb250YWt0ZS5ydS8qJywKICAgICAgICAnKjovLyoub2Rub2tsYXNzbmlraS5ydS8qJywKICAgICAgICAnKjovLyoub2sucnUvKicsCiAgICAgICAgJyo6Ly9teS5tYWlsLnJ1LyonLAogICAgICAgICcqOi8vKi5zb3VuZGNsb3VkLmNvbS8qJywKICAgICAgICAnKjovLyouZmFjZWJvb2suY29tLyonLAogICAgICAgICcqOi8vKi5pbnN0YWdyYW0uY29tLyonLAogICAgICAgICcqOi8vKi5ydXR1YmUucnUvKicKICAgICAgXTsKCiAgICAgIHZhciByZVN0ciA9IGV4Y2x1ZGVMaXN0Lm1hcChmdW5jdGlvbihwYXR0ZXJuKSB7CiAgICAgICAgcmV0dXJuIG1vbm8udXJsUGF0dGVyblRvU3RyUmUocGF0dGVybik7CiAgICAgIH0pLmpvaW4oJ3wnKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChyZVN0cik7CgogICAgICBpZiAocmUudGVzdChsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0bmFtZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9KTsKCiAgKHR5cGVvZiBtb25vID09PSAndW5kZWZpbmVkJykgJiYgKG1vbm8gPSB7CiAgICBsb2FkTW9kdWxlOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5sb2FkTW9kdWxlU3RhY2sucHVzaChhcmd1bWVudHMpOwogICAgfSwKICAgIGxvYWRNb2R1bGVTdGFjazogW10KICB9KTsKCiAgbW9uby5sb2FkTW9kdWxlKCdvZG5va2xhc3NuaWtpJywgZnVuY3Rpb24obW9kdWxlTmFtZSwgaW5pdERhdGEpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbGFuZ3VhZ2UgPSBpbml0RGF0YS5nZXRMYW5ndWFnZTsKICAgIHZhciBwcmVmZXJlbmNlID0gaW5pdERhdGEuZ2V0UHJlZmVyZW5jZTsKICAgIHZhciBtb2R1bGVTdGF0ZSA9IHByZWZlcmVuY2UubW9kdWxlT2Rub2tsYXNzbmlraSA/IDEgOiAwOwogICAgdmFyIGFsbG93RG93bmxvYWRNb2RlID0gbW9uby5pc1NhZmFyaSB8fCBtb25vLmlzQ2hyb21lIHx8IG1vbm8uaXNGRiB8fCAobW9uby5pc0dNICYmIG1vbm8uaXNUTSk7CgogICAgbW9uby5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnZ2V0TW9kdWxlSW5mbycpIHsKICAgICAgICBpZiAobWVzc2FnZS51cmwgIT09IGxvY2F0aW9uLmhyZWYpIHJldHVybjsKICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgc3RhdGU6IG1vZHVsZVN0YXRlLAogICAgICAgICAgbW9kdWxlTmFtZTogbW9kdWxlTmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2NoYW5nZVN0YXRlJykgewogICAgICAgIGlmIChtb2R1bGVOYW1lICE9PSBtZXNzYWdlLm1vZHVsZU5hbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9kbm9rbGFzc25pa2kuY2hhbmdlU3RhdGUobWVzc2FnZS5zdGF0ZSk7CiAgICAgIH0KICAgICAgaWYgKCFtb2R1bGVTdGF0ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICd1cGRhdGVMaW5rcycpIHsKICAgICAgICB1cGRhdGVMaW5rcygpOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2Rvd25sb2FkTVAzRmlsZXMnKSB7CiAgICAgICAgaWYgKGFsbG93RG93bmxvYWRNb2RlKSB7CiAgICAgICAgICBhdWRpby5kb3dubG9hZE1QM0ZpbGVzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF1ZGlvLnNob3dMaXN0T2ZBdWRpb0ZpbGVzKGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnZG93bmxvYWRQbGF5bGlzdCcpIHsKICAgICAgICBhdWRpby5zaG93TGlzdE9mQXVkaW9GaWxlcyh0cnVlKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKG1vZHVsZVN0YXRlKSB7CiAgICAgIG1vbm8uYXN5bmNDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgIG9kbm9rbGFzc25pa2kucnVuKCk7CiAgICAgIH0pOwogICAgfQoKICAgIHZhciBvZG5va2xhc3NuaWtpID0gewogICAgICBsaW5rQ2FjaGU6IHt9LAogICAgICBjb250ZXh0TWVudTogbnVsbCwKICAgICAgdmlkZW9Ub2tlbjogbnVsbCwKICAgICAgcnVuOiBmdW5jdGlvbigpIHsKICAgICAgICBtb2R1bGVTdGF0ZSA9IDE7CgogICAgICAgIGF1ZGlvLmdldEpzU2Vzc2lvbklkKCk7CiAgICAgICAgdmlkZW9GZWVkLmluamVjdFN0eWxlKCk7CiAgICAgICAgcGhvdG8uaW5qZWN0U3R5bGUoKTsKCiAgICAgICAgaWYgKFNhdmVGcm9tX1V0aWxzLm11dGF0aW9uV2F0Y2hlci5pc0F2YWlsYWJsZSgpKSB7CiAgICAgICAgICByZXR1cm4gb2Rub2tsYXNzbmlraS5tdXRhdGlvbk1vZGUuZW5hYmxlKCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBjaGFuZ2VTdGF0ZTogZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICBtb2R1bGVTdGF0ZSA9IHN0YXRlOwogICAgICAgIHZpZGVvLnJtQnRuKCk7CiAgICAgICAgYXVkaW8uZGlzYWJsZSgpOwogICAgICAgIHBob3RvLnJtQ3VycmVudFBob3RvQnRuKCk7CiAgICAgICAgdmlkZW9GZWVkLmRpc2FibGUoKTsKICAgICAgICB2aWRlb0ZlZWQucm1CdG4oKTsKICAgICAgICBvZG5va2xhc3NuaWtpLmhpZGVNZW51KCk7CiAgICAgICAgb2Rub2tsYXNzbmlraS5tdXRhdGlvbk1vZGUuc3RvcCgpOwogICAgICAgIG9kbm9rbGFzc25pa2kuY2xlYXJDYWNoZSgpOwogICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgb2Rub2tsYXNzbmlraS5ydW4oKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGhpZGVNZW51OiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAob2Rub2tsYXNzbmlraS5jb250ZXh0TWVudSkgewogICAgICAgICAgb2Rub2tsYXNzbmlraS5jb250ZXh0TWVudS5oaWRlKCk7CiAgICAgICAgICBvZG5va2xhc3NuaWtpLmNvbnRleHRNZW51ID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNsZWFyQ2FjaGU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsaW5rQ2FjaGUgPSBvZG5va2xhc3NuaWtpLmxpbmtDYWNoZTsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gbGlua0NhY2hlKSB7CiAgICAgICAgICBkZWxldGUgbGlua0NhY2hlW2tleV07CiAgICAgICAgfQogICAgICB9LAogICAgICBtdXRhdGlvbk1vZGU6IHsKICAgICAgICBvYnNlcnZlcjogbnVsbCwKICAgICAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICh0aGlzLm9ic2VydmVyKSB7CiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgfQoKICAgICAgICAgIFsnc2ZTa2lwJ10uZm9yRWFjaChmdW5jdGlvbihhdHRyKSB7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoYXR0cik7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbJyArIGRhdGFBdHRyICsgJ10nKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlQXR0cmlidXRlKGRhdGFBdHRyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICB3cmFwT25QaG90b092ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFtb2R1bGVTdGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgcGhvdG8uYWRkQ3VycmVudERsQnRuKHRoaXMpOwogICAgICAgIH0sCiAgICAgICAgd3JhcFZpZGVvRmVlZE9uSW1nT3ZlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2aWRlb0ZlZWQub25JbWdPdmVyLmNhbGwodGhpcyk7CiAgICAgICAgfSwKICAgICAgICB3cmFwQXVkaW9Pbk1vdXNlT3ZlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBhdWRpby5vbk1vdXNlT3Zlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0sCiAgICAgICAgd3JhcEF1ZGlvT25Nb3VzZU91dDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBhdWRpby5vbk1vdXNlT3V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgIHRoaXMub2JzZXJ2ZXIgPSBTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIucnVuKHsKICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHN1bW1hcnlMaXN0KSB7CiAgICAgICAgICAgICAgdmFyIHN1bW1hcnksIG4sIGksIG5vZGU7CgogICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFtpXTsKICAgICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG5vZGUuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgICAgbW9uby5vbihub2RlLCAnbW91c2VlbnRlcicsIF90aGlzLndyYXBBdWRpb09uTW91c2VPdmVyKTsKICAgICAgICAgICAgICAgICAgbW9uby5vbihub2RlLCAnbW91c2VsZWF2ZScsIF90aGlzLndyYXBBdWRpb09uTW91c2VPdXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCFtb25vLmlzU2FmYXJpICYmICFtb25vLmlzT3BlcmEpIHsKICAgICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFsyXTsKICAgICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICAgIG1vbm8ub25lKG5vZGUsICdtb3VzZW92ZXInLCBfdGhpcy53cmFwT25QaG90b092ZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzNdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IG1vbm8uZ2V0UGFyZW50KG5vZGUsICcudnBfdmlkZW8nKTsKICAgICAgICAgICAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IHZpZGVvLmdldFBsYXllck9wdGlvbnMobm9kZSk7CiAgICAgICAgICAgICAgICBpZiAoaW5mbykgewogICAgICAgICAgICAgICAgICB2aWRlby5hcHBlbmRMaW5rVW5kZXJWaWRlbyhwYXJlbnQucGFyZW50Tm9kZSwgaW5mbyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbNF07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBub2RlID0gbW9uby5nZXRQYXJlbnRCeUNsYXNzKG5vZGUsICd2aWQtY2FyZF9jbnQnKTsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtb25vLm9uZShub2RlLCAnbW91c2VvdmVyJywgX3RoaXMud3JhcFZpZGVvRmVlZE9uSW1nT3Zlcik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3IgKGkgPSA1OyBpIDwgODsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbaV07CiAgICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgICBtb25vLm9uZShub2RlLCAnbW91c2VvdmVyJywgX3RoaXMud3JhcFZpZGVvRmVlZE9uSW1nT3Zlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbOF07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkucmVtb3ZlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBtb25vLm9uUmVtb3ZlTGlzdGVuZXIobm9kZSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbOV07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHZpZGVvRmVlZC5vbkJ0bkNsaWNrKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHF1ZXJpZXM6IFt7CiAgICAgICAgICAgICAgY3NzOiAnLnRyYWNrLmpzLXRyYWNrJywKICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAnLm11cy10cl9pJywKICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAnI3Bob3RvLWxheWVyX3Bob3RvJywKICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAnLnZwX3ZpZGVvIC52aWQtY2FyZF9jbnQnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcudmlkLWNhcmRfY250IC52aWQtY2FyZF9jbnRfdyBpbWcnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuZF9jb21tZW50X3RleHRfdyBpbWcnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcudmlkZW8tY2FyZCAudmlkZW8tY2FyZF9pbWctdyBpbWcnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcudmlkLWNhcmRfY250IGltZycsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy4nICsgbW9uby5vblJlbW92ZUNsYXNzTmFtZSwKICAgICAgICAgICAgICBpczogJ3JlbW92ZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuc2YtdmlkZW8tZmVlZC1iaW5kLW9uLWluc2VydCcsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfV0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICB2YXIgZG93bmxvYWRMaW5rQ2xhc3NOYW1lID0gJ3NhdmVmcm9tX29rX2Rvd25sb2FkJzsKCiAgICB2YXIgdXBkYXRlTGlua3MgPSBmdW5jdGlvbigpIHsKICAgICAgb2Rub2tsYXNzbmlraS5jbGVhckNhY2hlKCk7CiAgICAgIHJlbW92ZURvd25sb2FkTGlua3MoKTsKICAgICAgYXVkaW8uZ2V0SnNTZXNzaW9uSWQoKTsKICAgICAgdmlkZW8uY2F0Y2hQb3B1cCgpOwogICAgfTsKCiAgICB2YXIgY3JlYXRlVGV4dExpbmsgPSBmdW5jdGlvbihocmVmLCB0ZXh0LCBibGFuaykgewogICAgICBpZiAoYmxhbmsgPT0gdW5kZWZpbmVkKQogICAgICAgIGJsYW5rID0gdHJ1ZTsKCiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBhLmhyZWYgPSBocmVmOwogICAgICBhLmNsYXNzTmFtZSA9IGRvd25sb2FkTGlua0NsYXNzTmFtZTsKICAgICAgYS50ZXh0Q29udGVudCA9IHRleHQ7CgogICAgICBpZiAoYmxhbmspCiAgICAgICAgYS5zZXRBdHRyaWJ1dGUoJ3RhcmdldCcsICdfYmxhbmsnKTsKCiAgICAgIHJldHVybiBhOwogICAgfTsKCiAgICB2YXIgcmVtb3ZlRG93bmxvYWRMaW5rcyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZWN0b3IgPSAnLicgKyBkb3dubG9hZExpbmtDbGFzc05hbWU7CgogICAgICB2YXIgZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgICBmb3IgKHZhciBpID0gZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkKICAgICAgICBlW2ldLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZVtpXSk7CiAgICB9OwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vICBBVURJTwoKICAgIHZhciBhdWRpbyA9IHsKICAgICAgZG93bmxvYWRJZFByZWZpeDogJ3NhdmVmcm9tX29rX2F1ZGlvX2Rvd25sb2FkXycsCiAgICAgIGluZm9JZFByZWZpeDogJ3NhdmVmcm9tX29rX2F1ZGlvX2luZm9fJywKICAgICAgbGFzdFJvdzogbnVsbCwKICAgICAgbGFzdFJvd0NhbmRpZGF0ZTogbnVsbCwKICAgICAgdGltZXI6IDAsCiAgICAgIGpzZXNzaW9uSWQ6ICcnLAogICAgICBzY3JpcHROb2RlOiBudWxsLAogICAgICBjYWNoZToge30sCiAgICAgIGFqYXhUaW1lcjoge30sCgoKICAgICAgc2hvd1Jvd0VsZW1lbnRzOiBmdW5jdGlvbihyb3csIHNob3csIGZvcmNlKSB7CiAgICAgICAgaWYgKCFyb3cpCiAgICAgICAgICByZXR1cm47CgogICAgICAgIHZhciBub2RlID0gcm93LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdi4nICsgZG93bmxvYWRMaW5rQ2xhc3NOYW1lKTsKCiAgICAgICAgaWYgKHNob3cgJiYgKCFub2RlIHx8IG5vZGUubGVuZ3RoID09IDApKSB7CiAgICAgICAgICBpZiAoIWF1ZGlvLnNob3dSb3dMaW5rcyhyb3cpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgbm9kZSA9IHJvdy5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuJyArIGRvd25sb2FkTGlua0NsYXNzTmFtZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAobm9kZSAmJiBub2RlLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciBkID0gc2hvdyA/ICcnIDogJ25vbmUnOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG5vZGVbaV0uc3R5bGUuZGlzcGxheSA9IGQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKCiAgICAgIGdldE5vZGVUcmFja0lkOiBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgdmFyIHF1ZXJ5ID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcXVlcnknKTsKICAgICAgICBpZiAocXVlcnkpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHF1ZXJ5ID0gSlNPTi5wYXJzZShxdWVyeSk7CiAgICAgICAgICAgIGlmIChxdWVyeSAmJiBxdWVyeS50cmFja0lkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5LnRyYWNrSWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgc3BhbiA9IG5vZGUucXVlcnlTZWxlY3Rvcignc3Bhbi50cmFja19wbGF5W29uY2xpY2tdJyk7CiAgICAgICAgaWYgKHNwYW4pIHsKICAgICAgICAgIHZhciBvbkNsaWNrID0gc3Bhbi5nZXRBdHRyaWJ1dGUoJ29uY2xpY2snKSB8fCAnJzsKICAgICAgICAgIHZhciB0cmFja0lkID0gb25DbGljay5tYXRjaCgvcGxheU1lZGlhdG9waWNcKFsnIl0/KFxkKylbJyJdPy8pOwogICAgICAgICAgcmV0dXJuIHRyYWNrSWQgJiYgdHJhY2tJZFsxXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9LAoKCiAgICAgIGdldFRyYWNrSWQ6IGZ1bmN0aW9uKHBhcmVudCkgewogICAgICAgIGlmICghcGFyZW50KQogICAgICAgICAgcmV0dXJuIG51bGw7CgogICAgICAgIHZhciB0cmFja0lkID0gYXVkaW8uZ2V0Tm9kZVRyYWNrSWQocGFyZW50KTsKICAgICAgICBpZiAodHJhY2tJZCkgewogICAgICAgICAgdmFyIGxpbmtzID0ge307CiAgICAgICAgICBsaW5rc1t0cmFja0lkXSA9IHBhcmVudDsKICAgICAgICAgIHJldHVybiBsaW5rczsKICAgICAgICB9CgogICAgICAgIHZhciBpZCA9IHBhcmVudC5pZDsKICAgICAgICBpZiAoaWQpIHsKICAgICAgICAgIHZhciBoYXNoUG9zID0gaWQuaW5kZXhPZignIycpOwogICAgICAgICAgaWYgKGhhc2hQb3MgIT09IC0xKSB7CiAgICAgICAgICAgIGlkID0gaWQuc3Vic3RyKGhhc2hQb3MgKyAxKTsKICAgICAgICAgIH0KICAgICAgICAgIHRyYWNrSWQgPSBTYXZlRnJvbV9VdGlscy5nZXRNYXRjaEZpcnN0KGlkLCAvXlx3K18oXGQrKSQvaSk7CiAgICAgICAgICBpZiAoIXRyYWNrSWQpIHsKICAgICAgICAgICAgaWYgKGlkLmluZGV4T2YoJ0dST1VQX0ZFRUQnKSAhPT0gLTEpIHsKICAgICAgICAgICAgICB0cmFja0lkID0gaWQuc3Vic3RyKGlkLmxhc3RJbmRleE9mKCdfJykgKyAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHRyYWNrSWQpIHsKICAgICAgICAgICAgdmFyIGxpbmtzID0ge307CiAgICAgICAgICAgIGxpbmtzW3RyYWNrSWRdID0gcGFyZW50OwogICAgICAgICAgICByZXR1cm4gbGlua3M7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSwKCgogICAgICBzaG93Um93TGlua3M6IGZ1bmN0aW9uKHJvdykgewogICAgICAgIHZhciBsaW5rcyA9IGF1ZGlvLmdldFRyYWNrSWQocm93KTsKICAgICAgICBmb3IgKHZhciBpIGluIGxpbmtzKSB7CiAgICAgICAgICBpZiAoYXVkaW8uaGFuZGxlUm93KGksIGxpbmtzW2ldKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCgogICAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICBhdWRpby5sYXN0Um93Q2FuZGlkYXRlID0gbnVsbDsKICAgICAgICBhdWRpby5sYXN0Um93ID0gbnVsbDsKICAgICAgICB2YXIgZGxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGRvd25sb2FkTGlua0NsYXNzTmFtZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkbEJ0bltpXTsgaSsrKSB7CiAgICAgICAgICBpdGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaXRlbSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZ2V0SnNTZXNzaW9uSWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgdXJsID0gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdCArICcvd2ViLWFwaS9tdXNpYy9jb25mJzsKICAgICAgICBtb25vLnJlcXVlc3QoewogICAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICBkYXRhOiAnXycsCiAgICAgICAgICBqc29uOiB0cnVlLAogICAgICAgICAgbG9jYWxYSFI6IHRydWUKICAgICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICAgIGlmIChlcnIgfHwgIWRhdGEgfHwgIWRhdGEuc2lkKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dldCBqc1Nlc3Npb25JZCBlcnJvciEnLCBlcnIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgYXVkaW8uanNlc3Npb25JZCA9IGRhdGEuc2lkOwogICAgICAgIH0pOwogICAgICB9LAoKCiAgICAgIGdldExpbms6IGZ1bmN0aW9uKHRyYWNrSWQpIHsKICAgICAgICBpZiAoIXRyYWNrSWQgfHwgIWF1ZGlvLmpzZXNzaW9uSWQpCiAgICAgICAgICByZXR1cm47CgogICAgICAgIGF1ZGlvLmFqYXhUaW1lclt0cmFja0lkXSA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgZGVsZXRlIGF1ZGlvLmFqYXhUaW1lclt0cmFja0lkXTsKICAgICAgICAgIGF1ZGlvLmRlbGV0ZUxpbmsodHJhY2tJZCk7CiAgICAgICAgfSwgMzAwMDApOwoKICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgIGFjdGlvbjogJ2dldE9kbm9rbGFzc25pa2lBdWRpb0xpbmtzJywKICAgICAgICAgIHVybDogbG9jYXRpb24uaHJlZiwKICAgICAgICAgIHRyYWNrSWQ6IHRyYWNrSWQsCiAgICAgICAgICBqc2Vzc2lvbklkOiBhdWRpby5qc2Vzc2lvbklkCiAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgIGF1ZGlvLnNldExpbmsocmVzcG9uc2UudHJhY2tJZCwgcmVzcG9uc2UuZGF0YSk7CiAgICAgICAgfSk7CiAgICAgIH0sCgoKICAgICAgb25Nb3VzZU92ZXI6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgaWYgKCFhdWRpby5qc2Vzc2lvbklkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgbm9kZSA9IGV2ZW50LnRhcmdldDsKCiAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgIT09IDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghbm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ3RyYWNrJykgJiYKICAgICAgICAgICFub2RlLmNsYXNzTGlzdC5jb250YWlucygnbXVzLXRyX2knKQogICAgICAgICkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJvdyA9IG5vZGU7CiAgICAgICAgaWYgKHJvdykgewogICAgICAgICAgYXVkaW8ubGFzdFJvd0NhbmRpZGF0ZSA9IHJvdzsKICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoYXVkaW8udGltZXIpOwoKICAgICAgICAgIGlmIChhdWRpby5sYXN0Um93ID09IHJvdykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgIGF1ZGlvLnRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGF1ZGlvLnNob3dSb3dFbGVtZW50cyhhdWRpby5sYXN0Um93LCBmYWxzZSk7CiAgICAgICAgICAgIGF1ZGlvLmxhc3RSb3cgPSByb3c7CiAgICAgICAgICAgIGF1ZGlvLmxhc3RSb3dDYW5kaWRhdGUgPSBudWxsOwogICAgICAgICAgICBhdWRpby5zaG93Um93RWxlbWVudHMoYXVkaW8ubGFzdFJvdywgdHJ1ZSk7CiAgICAgICAgICB9LCAyNTApOwogICAgICAgIH0KICAgICAgfSwKCgogICAgICBvbk1vdXNlT3V0OiBmdW5jdGlvbihldmVudCkgewogICAgICAgIGlmICghYXVkaW8ubGFzdFJvdyAmJiAhYXVkaW8ubGFzdFJvd0NhbmRpZGF0ZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIG5vZGUgPSBldmVudC50YXJnZXQ7CiAgICAgICAgaWYgKFNhdmVGcm9tX1V0aWxzLmlzUGFyZW50KG5vZGUsIGF1ZGlvLmxhc3RSb3cpIHx8CiAgICAgICAgICBTYXZlRnJvbV9VdGlscy5pc1BhcmVudChub2RlLCBhdWRpby5sYXN0Um93Q2FuZGlkYXRlKSkgewogICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChhdWRpby50aW1lcik7CiAgICAgICAgICBhdWRpby50aW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBhdWRpby5zaG93Um93RWxlbWVudHMoYXVkaW8ubGFzdFJvdywgZmFsc2UpOwogICAgICAgICAgICBhdWRpby5sYXN0Um93ID0gbnVsbDsKICAgICAgICAgICAgYXVkaW8ubGFzdFJvd0NhbmRpZGF0ZSA9IG51bGw7CiAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9CiAgICAgICAgbm9kZSA9IG51bGw7CiAgICAgIH0sCgoKICAgICAgaGFuZGxlUm93OiBmdW5jdGlvbih0cmFja0lkLCByb3cpIHsKICAgICAgICBpZiAoIXRyYWNrSWQgfHwgIXJvdykKICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgdmFyIHBhcmVudCA9IHJvdzsKICAgICAgICBwYXJlbnQuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnOwoKICAgICAgICB2YXIgZHVyYXRpb24gPSByb3cucXVlcnlTZWxlY3RvcignLm1fY19kdXJhdGlvbiwgLm1fcG9ydGFsX2R1cmF0aW9uJyk7CgogICAgICAgIHZhciBib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBib3guY2xhc3NOYW1lID0gZG93bmxvYWRMaW5rQ2xhc3NOYW1lOwoKICAgICAgICB2YXIgcmlnaHQgPSA0MDsKICAgICAgICB2YXIgbW1wY3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW1wY3cnKTsKICAgICAgICBpZiAobW1wY3cgJiYgbW1wY3cuY29udGFpbnMocm93KSkgewogICAgICAgICAgcmlnaHQgPSA2NTsKICAgICAgICB9CgogICAgICAgIFNhdmVGcm9tX1V0aWxzLnNldFN0eWxlKGJveCwgewogICAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICAgIGJhY2tncm91bmQ6ICcjNDZhYTE5JywKICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjMzM3ZDEyJywKICAgICAgICAgIGJvcmRlclJhZGl1czogJzNweCcsCiAgICAgICAgICBwYWRkaW5nOiAnMXB4IDVweCcsCiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgIHJpZ2h0OiByaWdodCArICdweCcsCiAgICAgICAgICB0b3A6ICc1MCUnLAogICAgICAgICAgbGluZUhlaWdodDogJzE1cHgnLAogICAgICAgICAgZm9udFNpemU6ICcxMnB4JywKICAgICAgICAgIG9wYWNpdHk6IDAsCiAgICAgICAgICB6SW5kZXg6IDk5OTksCiAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgIH0pOwoKICAgICAgICBib3guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhdWRpby5vbkJveENsaWNrLCBmYWxzZSk7CgogICAgICAgIHZhciB0aXRsZSA9IGF1ZGlvLmdldFRpdGxlKHRyYWNrSWQsIHJvdyk7CgogICAgICAgIHZhciBsaW5rMSA9IGNyZWF0ZVRleHRMaW5rKCcjJywgJy4uLicpOwogICAgICAgIGxpbmsxLmlkID0gYXVkaW8uZG93bmxvYWRJZFByZWZpeCArIHRyYWNrSWQ7CiAgICAgICAgbGluazEudGl0bGUgPSBsYW5ndWFnZS5kb3dubG9hZFRpdGxlOwogICAgICAgIGlmIChkdXJhdGlvbikgewogICAgICAgICAgbGluazEuc2V0QXR0cmlidXRlKCdkYXRhLXNhdmVmcm9tLWhlbHBlci1kdXJhdGlvbicsCiAgICAgICAgICAgIGF1ZGlvLnNlY29uZHNGcm9tRHVyYXRpb25Ob2RlKGR1cmF0aW9uKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGl0bGUpIHsKICAgICAgICAgIHRpdGxlICs9ICcubXAzJzsKICAgICAgICAgIGxpbmsxLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBtb25vLmZpbGVOYW1lLm1vZGlmeSh0aXRsZSkpOwogICAgICAgIH0KCiAgICAgICAgU2F2ZUZyb21fVXRpbHMuc2V0U3R5bGUobGluazEsIHsKICAgICAgICAgIGNvbG9yOiAnI2ZmZicsCiAgICAgICAgICBmb250V2VpZ2h0OiAnbm9ybWFsJwogICAgICAgIH0pOwoKICAgICAgICBsaW5rMS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGF1ZGlvLm9uRG93bmxvYWRMaW5rQ2xpY2ssIGZhbHNlKTsKCiAgICAgICAgYm94LmFwcGVuZENoaWxkKGxpbmsxKTsKICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoYm94KTsKCiAgICAgICAgaWYgKGF1ZGlvLmNhY2hlW3RyYWNrSWRdKQogICAgICAgICAgYXVkaW8uc2V0TGlua0Zyb21DYWNoZSh0cmFja0lkLCBsaW5rMSk7CiAgICAgICAgZWxzZQogICAgICAgICAgYXVkaW8uZ2V0TGluayh0cmFja0lkKTsKCiAgICAgICAgYm94LnN0eWxlLm1hcmdpblRvcCA9ICctJyArIChib3gub2Zmc2V0SGVpZ2h0IC8gMikgKyAncHgnOwogICAgICAgIGJveC5zdHlsZS5vcGFjaXR5ID0gJzEnOwoKICAgICAgICB2YXIgY2xvc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgY2xvc2UudGV4dENvbnRlbnQgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDIxNSk7CiAgICAgICAgY2xvc2UudGl0bGUgPSBsYW5ndWFnZS5jbG9zZTsKICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZShjbG9zZSwgewogICAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICAgIGZvbnRGYW1pbHk6ICdUYWhvbWEsSGVsdmV0aWNhLHNhbnMtc2VyaWYnLAogICAgICAgICAgZm9udFNpemU6ICcxNXB4JywKICAgICAgICAgIG1hcmdpbkxlZnQ6ICc3cHgnLAogICAgICAgICAgb3BhY2l0eTogJy43JywKICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgfSk7CiAgICAgICAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhdWRpby5vbkNsb3NlQnRuQ2xpY2ssIGZhbHNlKTsKICAgICAgICBib3guYXBwZW5kQ2hpbGQoY2xvc2UpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSwKCgogICAgICBvbkJveENsaWNrOiBmdW5jdGlvbihldmVudCkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgIHZhciBhID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdhLicgKyBkb3dubG9hZExpbmtDbGFzc05hbWUpOwogICAgICAgIGlmIChhKSB7CiAgICAgICAgICBtb25vLnRyaWdnZXIoYSwgJ2NsaWNrJywgewogICAgICAgICAgICBjYW5jZWxhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCgoKICAgICAgb25Eb3dubG9hZExpbmtDbGljazogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09IDIpCiAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICBpZiAodGhpcy5ocmVmID09ICcjJykgewogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkT25DbGljayhldmVudCk7CgogICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgIHZhciBtbXBjdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtbXBjdycpOwogICAgICAgICAgaWYgKCFtbXBjdyB8fCAhbW1wY3cuY29udGFpbnModGhpcykpIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgZWM6ICdvaycsCiAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgZWw6ICdtdXNpYy1mZWVkJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgIGVjOiAnb2snLAogICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgIGVsOiAnbXVzaWMtbGlzdCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKCgogICAgICBvbkNsb3NlQnRuQ2xpY2s6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbiA9PSAyKQogICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgIHZhciBwYXJlbnQgPSBtb25vLmdldFBhcmVudCh0aGlzLCAnLicgKyBkb3dubG9hZExpbmtDbGFzc05hbWUpOwogICAgICAgIGlmIChwYXJlbnQpCiAgICAgICAgICBwYXJlbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9LAoKCiAgICAgIGRlbGV0ZUxpbms6IGZ1bmN0aW9uKHRyYWNrSWQsIG5vZGUpIHsKICAgICAgICBpZiAoIW5vZGUgJiYgdHJhY2tJZCkKICAgICAgICAgIG5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhdWRpby5kb3dubG9hZElkUHJlZml4ICsgdHJhY2tJZCk7CgogICAgICAgIGlmICghbm9kZSkKICAgICAgICAgIHJldHVybjsKCiAgICAgICAgdmFyIGJveCA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICBpZiAoIWJveCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBib3gucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChib3gpOwogICAgICB9LAoKCiAgICAgIGdldEhhc2g6IGZ1bmN0aW9uKHNyYywgbWFnaWMpIHsKICAgICAgICBpZiAoIW1hZ2ljKQogICAgICAgICAgbWFnaWMgPSBbNCwgMywgNSwgNiwgMSwgMiwgOCwgNywgMiwgOSwgMywgNSwgNywgMSwgNCwgOCwgOCwgMywgNCwgMywgMSwgNywgMywgNSwgOSwgOCwgMSwgNCwgMywgNywgMiwgOF07CgogICAgICAgIHZhciBhID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcmMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGEucHVzaChwYXJzZUludCgnMHgwJyArIHNyYy5jaGFyQXQoaSkpKTsKICAgICAgICB9CgogICAgICAgIHNyYyA9IGE7CgogICAgICAgIHZhciByZXMgPSBbXTsKICAgICAgICBzcmMgPSBzcmMuc2xpY2UoMCk7CiAgICAgICAgc3JjWzMyXSA9IHNyY1szMV07CiAgICAgICAgdmFyIHN1bSA9IDA7CiAgICAgICAgdmFyIGkgPSAzMjsKICAgICAgICB3aGlsZSAoaS0tID4gMCkKICAgICAgICAgIHN1bSArPSBzcmNbaV07CgogICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgMzI7IHgrKykKICAgICAgICAgIHJlc1t4XSA9IE1hdGguYWJzKHN1bSAtIHNyY1t4ICsgMV0gKiBzcmNbeF0gKiBtYWdpY1t4XSk7CgogICAgICAgIHJldHVybiByZXMuam9pbignJyk7CiAgICAgIH0sCgoKICAgICAgc2V0TGlua0Zyb21DYWNoZTogZnVuY3Rpb24odHJhY2tJZCwgbm9kZSkgewogICAgICAgIGlmICghYXVkaW8uY2FjaGVbdHJhY2tJZF0pCiAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmICghbm9kZSkKICAgICAgICAgIG5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhdWRpby5kb3dubG9hZElkUHJlZml4ICsgdHJhY2tJZCk7CgogICAgICAgIGlmICghbm9kZSkKICAgICAgICAgIHJldHVybjsKCiAgICAgICAgbm9kZS5ocmVmID0gYXVkaW8uY2FjaGVbdHJhY2tJZF0udXJsOwogICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSAnJzsKICAgICAgICBpZiAoYXVkaW8uY2FjaGVbdHJhY2tJZF0uZG93bmxvYWRBdHRyKQogICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgYXVkaW8uY2FjaGVbdHJhY2tJZF0uZG93bmxvYWRBdHRyKTsKCiAgICAgICAgdmFyIGljb24gPSBtb25vLmNyZWF0ZShTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3ZnKCdkb3dubG9hZCcsICcjZmZmZmZmJyksIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICB3aWR0aDogJzE2cHgnLAogICAgICAgICAgICBoZWlnaHQ6ICcxNnB4JywKICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAgIG9wYWNpdHk6ICcwLjknCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChpY29uKTsKCiAgICAgICAgdmFyIGluZm8gPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShhdWRpby5jYWNoZVt0cmFja0lkXS5pbmZvKTsKCiAgICAgICAgaWYgKG5vZGUubmV4dFNpYmxpbmcpCiAgICAgICAgICBub2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGluZm8sIG5vZGUubmV4dFNpYmxpbmcpOwogICAgICAgIGVsc2UKICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChpbmZvKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0sCgoKICAgICAgc2V0TGluazogZnVuY3Rpb24odHJhY2tJZCwgZGF0YSwgY2xpZW50SGFzaCkgewogICAgICAgIGlmICghdHJhY2tJZCkKICAgICAgICAgIHJldHVybjsKCiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChhdWRpby5hamF4VGltZXJbdHJhY2tJZF0pOwoKICAgICAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGF1ZGlvLmRvd25sb2FkSWRQcmVmaXggKyB0cmFja0lkKTsKICAgICAgICBpZiAoIW5vZGUpCiAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChhdWRpby5zZXRMaW5rRnJvbUNhY2hlKHRyYWNrSWQsIG5vZGUpKQogICAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEucGxheSkgewogICAgICAgICAgYXVkaW8uZGVsZXRlTGluayh0cmFja0lkLCBub2RlKTsKICAgICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSAnPyc7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoY2xpZW50SGFzaCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgbWQ1ID0gZGF0YS5wbGF5Lm1hdGNoKC8oPzpcP3wmKW1kNT0oW1xkYS1mXXszMn0pL2kpOwogICAgICAgICAgaWYgKG1kNSAmJiBtZDUubGVuZ3RoID4gMSkgewogICAgICAgICAgICBtZDUgPSBtZDVbMV07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgbWQ1ID0gU2F2ZUZyb21fVXRpbHMubWQ1KG1kNSArICdzZWNyZXQnKTsKICAgICAgICAgICAgICBhdWRpby5zZXRMaW5rKHRyYWNrSWQsIGRhdGEsIGF1ZGlvLmdldEhhc2gobWQ1KSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgICAgICB9CgogICAgICAgICAgYXVkaW8uZGVsZXRlTGluayh0cmFja0lkLCBub2RlKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBzaXplID0gU2F2ZUZyb21fVXRpbHMuZ2V0TWF0Y2hGaXJzdChkYXRhLnBsYXksIC8oPzpcP3wmKXNpemU9KFxkKykvaSk7CiAgICAgICAgaWYgKCFzaXplKQogICAgICAgICAgcmV0dXJuOwoKICAgICAgICBhdWRpby5jYWNoZVt0cmFja0lkXSA9IHt9OwogICAgICAgIGF1ZGlvLmNhY2hlW3RyYWNrSWRdLnVybCA9IGRhdGEucGxheSArIChjbGllbnRIYXNoID8gJyZjbGllbnRIYXNoPScgKyBjbGllbnRIYXNoIDogJycpOwoKICAgICAgICB2YXIgaW5mbyA9ICcgKCcgKyBTYXZlRnJvbV9VdGlscy5zaXplSHVtYW4oc2l6ZSwgMik7CgogICAgICAgIHZhciBkdXJhdGlvbiA9IG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLXNhdmVmcm9tLWhlbHBlci1kdXJhdGlvbicpOwogICAgICAgIGlmIChkYXRhLnRyYWNrKSB7CiAgICAgICAgICBpZiAoZGF0YS50cmFjay5kdXJhdGlvbikKICAgICAgICAgICAgZHVyYXRpb24gPSBkYXRhLnRyYWNrLmR1cmF0aW9uOwoKICAgICAgICAgIGlmIChkYXRhLnRyYWNrLmVuc2VtYmxlICYmIGRhdGEudHJhY2submFtZSkgewogICAgICAgICAgICB2YXIgdGl0bGUgPSBkYXRhLnRyYWNrLmVuc2VtYmxlICsgJyAtICcgKyBkYXRhLnRyYWNrLm5hbWU7CiAgICAgICAgICAgIGF1ZGlvLmNhY2hlW3RyYWNrSWRdLnRpdGxlID0gdGl0bGU7CiAgICAgICAgICAgIGF1ZGlvLmNhY2hlW3RyYWNrSWRdLmRvd25sb2FkQXR0ciA9IG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRpdGxlICsgJy5tcDMnKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzaXplICYmIGR1cmF0aW9uKSB7CiAgICAgICAgICBkdXJhdGlvbiA9IHBhcnNlSW50KGR1cmF0aW9uKTsKICAgICAgICAgIGlmIChpc05hTihkdXJhdGlvbikpIHsKICAgICAgICAgICAgZGVsZXRlIGF1ZGlvLmNhY2hlW3RyYWNrSWRdOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGJpdHJhdGUgPSBNYXRoLmZsb29yKChzaXplIC8gZHVyYXRpb24pIC8gMTI1KSArICcgJyArIGxhbmd1YWdlLmticHM7CiAgICAgICAgICBpbmZvICs9ICcgfiAnICsgYml0cmF0ZTsKICAgICAgICB9CgogICAgICAgIGluZm8gKz0gJyknOwogICAgICAgIGF1ZGlvLmNhY2hlW3RyYWNrSWRdLmluZm8gPSBpbmZvOwoKICAgICAgICBhdWRpby5zZXRMaW5rRnJvbUNhY2hlKHRyYWNrSWQsIG5vZGUpOwogICAgICB9LAoKCiAgICAgIGdldFRpdGxlOiBmdW5jdGlvbihpZCwgcm93KSB7CiAgICAgICAgaWYgKCFpZCB8fCAhcm93KQogICAgICAgICAgcmV0dXJuICcnOwoKICAgICAgICB2YXIgbmFtZSA9ICcnOwoKICAgICAgICB2YXIgcGVyZm9ybWVyID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5tX2NfYXJ0aXN0LCAubXVzLXRyX2FydGlzdCwgLm1fcG9ydGFsX2NfYXJ0aXN0Jyk7CiAgICAgICAgdmFyIHRpdGxlID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5tX3RyYWNrX3NvdXJjZSwgLm11cy10cl9zb25nLCAubV9wb3J0bGFfdHJhY2tfbmFtZScpOwoKICAgICAgICBpZiAocGVyZm9ybWVyKSB7CiAgICAgICAgICBwZXJmb3JtZXIgPSBwZXJmb3JtZXIudGV4dENvbnRlbnQ7CiAgICAgICAgICBpZiAocGVyZm9ybWVyKQogICAgICAgICAgICBuYW1lICs9IHBlcmZvcm1lci50cmltKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGl0bGUpIHsKICAgICAgICAgIHRpdGxlID0gdGl0bGUudGV4dENvbnRlbnQ7CiAgICAgICAgICBpZiAodGl0bGUpIHsKICAgICAgICAgICAgaWYgKG5hbWUpCiAgICAgICAgICAgICAgbmFtZSArPSAnIC0gJzsKCiAgICAgICAgICAgIG5hbWUgKz0gdGl0bGUudHJpbSgpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG5hbWUpCiAgICAgICAgICByZXR1cm4gbmFtZS5yZXBsYWNlKC9cPGFccytbXlw+XStcPi9pZywgJycpLnJlcGxhY2UoL1w8XC9hXD4vaWcsICcnKTsKCiAgICAgICAgcmV0dXJuICcnOwogICAgICB9LAoKCiAgICAgIHNlY29uZHNGcm9tRHVyYXRpb25Ob2RlOiBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgaWYgKCFub2RlKQogICAgICAgICAgcmV0dXJuIDA7CgogICAgICAgIHZhciB0ZXh0ID0gbm9kZS50ZXh0Q29udGVudDsKICAgICAgICBpZiAoIXRleHQpCiAgICAgICAgICByZXR1cm4gMDsKCiAgICAgICAgdmFyIG0gPSB0ZXh0Lm1hdGNoKC9eKD86XHMqKFxkKylccypcOik/XHMqKFxkKylccypcOlxzKihcZCspLyk7CiAgICAgICAgaWYgKG0gJiYgbS5sZW5ndGggPiAzKSB7CiAgICAgICAgICBpZiAoIW1bMV0pCiAgICAgICAgICAgIG1bMV0gPSAwOwoKICAgICAgICAgIHJldHVybiBwYXJzZUludChtWzFdKSAqIDM2MDAgKyBwYXJzZUludChtWzJdKSAqIDYwICsgcGFyc2VJbnQobVszXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgICAgfSwKCiAgICAgIGdldFBsYXlsaXN0TmFtZTogZnVuY3Rpb24oY29udGFpbmVyKSB7CiAgICAgICAgaWYgKGNvbnRhaW5lciA9PT0gZG9jdW1lbnQpIHJldHVybjsKCiAgICAgICAgdmFyIHRpdGxlID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5tdXNfaDJfdHgnKTsKICAgICAgICBpZiAoIXRpdGxlKSByZXR1cm47CiAgICAgICAgcmV0dXJuIG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRpdGxlLnRleHRDb250ZW50KSB8fCB1bmRlZmluZWQ7CiAgICAgIH0sCgogICAgICBlbElzSGlkZGVuOiBmdW5jdGlvbiBpc0hpZGRlbihlbCkgewogICAgICAgIHJldHVybiAoZWwub2Zmc2V0UGFyZW50ID09PSBudWxsKQogICAgICB9LAoKICAgICAgZ2V0TGF5ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtbXBjdycpOwogICAgICAgIGlmICghbGF5ZXIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGxheWVyLmNsYXNzTGlzdC5jb250YWlucygnX19oaWRkZW4nKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsYXllciA9IGxheWVyLnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5tX2Nfc1thcmlhLWhpZGRlbj0iZmFsc2UiXScpOwogICAgICAgIGlmICghbGF5ZXIgfHwgYXVkaW8uZWxJc0hpZGRlbihsYXllcikpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxheWVyOwogICAgICB9LAoKICAgICAgZ2V0UG9wdXA6IGZ1bmN0aW9uKHRpdGxlLCB0eXBlLCBvbkNsb3NlKSB7CiAgICAgICAgdmFyIHRlbXBsYXRlID0gU2F2ZUZyb21fVXRpbHMucGxheWxpc3QuZ2V0SW5mb1BvcHVwVGVtcGxhdGUoKTsKCiAgICAgICAgdmFyIHByb2dyZXNzRWw7CiAgICAgICAgbW9uby5jcmVhdGUodGVtcGxhdGUudGV4dENvbnRhaW5lciwgewogICAgICAgICAgYXBwZW5kOiBbIXRpdGxlID8gdW5kZWZpbmVkIDogbW9uby5jcmVhdGUoJ3AnLCB7CiAgICAgICAgICAgICAgdGV4dDogdGl0bGUsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGNvbG9yOiAnIzBEMEQwRCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzIwcHgnLAogICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnMTFweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6ICcxM3B4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHByb2dyZXNzRWwgPSBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICB0ZXh0OiAnJywKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgY29sb3I6ICcjODY4Njg2JywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMjRweCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIHZhciBwb3B1cEVsID0gU2F2ZUZyb21fVXRpbHMucG9wdXBEaXYodGVtcGxhdGUuYm9keSwgJ3NmX3Byb2dyZXNzX3BvcHVwJywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIG9uQ2xvc2UpOwoKICAgICAgICB2YXIgc2V0U3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkgewogICAgICAgICAgaWYgKHNldFN0YXRlLnN0YXRlID09PSBzdGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBzZXRTdGF0ZS5zdGF0ZSA9IHN0YXRlOwoKICAgICAgICAgIHRlbXBsYXRlLmJ1dHRvbkNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgcHJvZ3Jlc3NFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFdhcm5pbmdJY29uJywKICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgY29sb3I6ICcjNzdEMUZBJwogICAgICAgICAgfSwgZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgICB0ZW1wbGF0ZS5pY29uLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoJyArIGljb24gKyAnKSc7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChzdGF0ZSA9PT0gJ3Byb2dyZXNzJykgewogICAgICAgICAgICBwcm9ncmVzc0VsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlID09PSAnZXJyb3InKSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ2dldFdhcm5pbmdJY29uJywKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIGNvbG9yOiAnI0FBQUFBQScKICAgICAgICAgICAgfSwgZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgICAgIHRlbXBsYXRlLmljb24uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgaWNvbiArICcpJzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHByb2dyZXNzRWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG9uUHJlcGFyZTogZnVuY3Rpb24odGV4dCkgewogICAgICAgICAgICBzZXRTdGF0ZSgncHJvZ3Jlc3MnKTsKICAgICAgICAgICAgcHJvZ3Jlc3NFbC50ZXh0Q29udGVudCA9IHRleHQ7CiAgICAgICAgICB9LAogICAgICAgICAgb25Qcm9ncmVzczogZnVuY3Rpb24oY291bnQsIG1heCkgewogICAgICAgICAgICBwcm9ncmVzc0VsLnRleHRDb250ZW50ID0gbGFuZ3VhZ2UudmtGb3VuZEZpbGVzLnJlcGxhY2UoJyVkJywgY291bnQpICsgJyAnICsgbGFuZ3VhZ2UudmtGb3VuZE9mICsgJyAnICsgbWF4OwogICAgICAgICAgfSwKICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBtb25vLnRyaWdnZXIocG9wdXBFbCwgJ2tpbGwnKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICAgIHNldFN0YXRlKCdlcnJvcicpOwogICAgICAgICAgICBwcm9ncmVzc0VsLnRleHRDb250ZW50ID0gdGV4dDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCgogICAgICBnZXRBdWRpb0xpbmtzVmlhQVBJOiBmdW5jdGlvbih0cmFja0lkTGlzdCwgb25Qcm9ncmVzcywgY2IpIHsKICAgICAgICB2YXIgYWJvcnQgPSBmYWxzZTsKICAgICAgICB2YXIgdHJhY2tMaXN0ID0gW107CiAgICAgICAgdmFyIGxlbiA9IHRyYWNrSWRMaXN0Lmxlbmd0aDsKICAgICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKGFib3J0KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciB0cmFja0lkQXJyID0gdHJhY2tJZExpc3Quc3BsaWNlKDAsIDEwKTsKICAgICAgICAgIGlmICh0cmFja0lkQXJyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gY2IodHJhY2tMaXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAnZ2V0T2tBdWRpb0xpc3RMaW5rcycsCiAgICAgICAgICAgIHRyYWNrSWRBcnI6IHRyYWNrSWRBcnIsCiAgICAgICAgICAgIGpzZXNzaW9uSWQ6IGF1ZGlvLmpzZXNzaW9uSWQKICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlTGlzdCkgewogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXNwb25zZUxpc3QpKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSByZXNwb25zZUxpc3RbaV07IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtLnBsYXkgIT09ICdzdHJpbmcnIHx8IHR5cGVvZiBpdGVtLnRyYWNrICE9PSAnb2JqZWN0JykgY29udGludWU7CgogICAgICAgICAgICAgICAgdmFyIHVybCA9IGl0ZW0ucGxheTsKICAgICAgICAgICAgICAgIHZhciBtZDUgPSB1cmwubWF0Y2goLyg/Olw/fCYpbWQ1PShbXGRhLWZdezMyfSkvaSk7CiAgICAgICAgICAgICAgICBpZiAoIW1kNSkgY29udGludWU7CgogICAgICAgICAgICAgICAgdmFyIHRpdGxlOwogICAgICAgICAgICAgICAgaWYgKGl0ZW0udHJhY2submFtZSkgewogICAgICAgICAgICAgICAgICB0aXRsZSA9IGl0ZW0udHJhY2submFtZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpdGVtLnRyYWNrLmVuc2VtYmxlKSB7CiAgICAgICAgICAgICAgICAgIHRpdGxlID0gaXRlbS50cmFjay5lbnNlbWJsZSArICh0aXRsZSA/ICcgLSAnICsgdGl0bGUgOiAnJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXRpdGxlKSB7CiAgICAgICAgICAgICAgICAgIHRpdGxlID0gJ25vbmFtZSc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWQ1ID0gbWQ1WzFdOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgbWQ1ID0gU2F2ZUZyb21fVXRpbHMubWQ1KG1kNSArICdzZWNyZXQnKTsKICAgICAgICAgICAgICAgICAgdmFyIGhhc2ggPSBhdWRpby5nZXRIYXNoKG1kNSk7CgogICAgICAgICAgICAgICAgICB1cmwgKz0gJyZjbGllbnRIYXNoPScgKyBoYXNoOwoKICAgICAgICAgICAgICAgICAgdHJhY2tMaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBpdGVtLnRyYWNrLmR1cmF0aW9uIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBtb25vLmZpbGVOYW1lLm1vZGlmeSh0aXRsZSkgKyAnLm1wMycKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG9uUHJvZ3Jlc3MobGVuIC0gdHJhY2tJZExpc3QubGVuZ3RoLCBsZW4pOwogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIG5leHQoKTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGFib3J0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgYWJvcnQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGdldEF1ZGlvTGlzdExpbmtzUG9wdXA6IGZ1bmN0aW9uKHRyYWNrSWRMaXN0LCB0aXRsZSwgY2IpIHsKICAgICAgICB2YXIgcHJvY2VzczsKICAgICAgICB2YXIgcG9wdXAgPSB0aGlzLmdldFBvcHVwKHRpdGxlLCAnYXVkaW8nLCBmdW5jdGlvbiBvbkNsb3NlKCkgewogICAgICAgICAgaWYgKHByb2Nlc3MpIHsKICAgICAgICAgICAgcHJvY2Vzcy5hYm9ydCgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHZhciBfY2IgPSBmdW5jdGlvbihsaW5rcykgewogICAgICAgICAgaWYgKGxpbmtzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBwb3B1cC5vbkVycm9yKGxhbmd1YWdlLnZrTXAzTGlua3NOb3RGb3VuZCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHBvcHVwLm9uUmVhZHkoKTsKCiAgICAgICAgICBjYihsaW5rcyk7CiAgICAgICAgfTsKCiAgICAgICAgcG9wdXAub25QcmVwYXJlKGxhbmd1YWdlLmRvd25sb2FkICsgJyAuLi4nKTsKCiAgICAgICAgcHJvY2VzcyA9IHRoaXMuZ2V0QXVkaW9MaW5rc1ZpYUFQSSh0cmFja0lkTGlzdCwgcG9wdXAub25Qcm9ncmVzcywgX2NiKTsKICAgICAgfSwKCiAgICAgIGdldEF1ZGlvTGlua3M6IGZ1bmN0aW9uKGNvbnRhaW5lciwgdGl0bGUsIGNiKSB7CiAgICAgICAgdmFyIHJvd0xpc3QgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChbJy5tX3BvcnRhbF90cmFjaycsICcubV9jX3RyJywgJy5tdXMtdHJfaSddKTsKICAgICAgICB2YXIgdHJhY2tJZExpc3QgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgcm93OyByb3cgPSByb3dMaXN0W2ldOyBpKyspIHsKICAgICAgICAgIHZhciB0cmFja0lkT2JqID0gYXVkaW8uZ2V0VHJhY2tJZChyb3cpOwogICAgICAgICAgZm9yICh2YXIgdHJhY2tJZCBpbiB0cmFja0lkT2JqKSB7CiAgICAgICAgICAgIHRyYWNrSWRMaXN0LnB1c2godHJhY2tJZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuZ2V0QXVkaW9MaXN0TGlua3NQb3B1cCh0cmFja0lkTGlzdCwgdGl0bGUsIGNiKTsKICAgICAgfSwKCiAgICAgIGRvd25sb2FkTVAzRmlsZXM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBjb250YWluZXIgPSBhdWRpby5nZXRMYXllcigpIHx8IGRvY3VtZW50OwogICAgICAgIHZhciB0aXRsZSA9IGF1ZGlvLmdldFBsYXlsaXN0TmFtZShjb250YWluZXIpOwogICAgICAgIGF1ZGlvLmdldEF1ZGlvTGlua3MoY29udGFpbmVyLCB0aXRsZSwgZnVuY3Rpb24odHJhY2tMaXN0KSB7CiAgICAgICAgICBTYXZlRnJvbV9VdGlscy5kb3dubG9hZExpc3Quc2hvd0JlZm9yZURvd25sb2FkUG9wdXAodHJhY2tMaXN0LCB7CiAgICAgICAgICAgIHR5cGU6ICdhdWRpbycsCiAgICAgICAgICAgIGZvbGRlck5hbWU6IHRpdGxlCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIHNob3dMaXN0T2ZBdWRpb0ZpbGVzOiBmdW5jdGlvbihzaG93UGxheWxpc3QpIHsKICAgICAgICB2YXIgY29udGFpbmVyID0gYXVkaW8uZ2V0TGF5ZXIoKSB8fCBkb2N1bWVudDsKICAgICAgICB2YXIgdGl0bGUgPSBhdWRpby5nZXRQbGF5bGlzdE5hbWUoY29udGFpbmVyKTsKICAgICAgICBhdWRpby5nZXRBdWRpb0xpbmtzKGNvbnRhaW5lciwgdGl0bGUsIGZ1bmN0aW9uKHRyYWNrTGlzdCkgewogICAgICAgICAgaWYgKHRyYWNrTGlzdC5sZW5ndGgpIHsKICAgICAgICAgICAgaWYgKHNob3dQbGF5bGlzdCkgewogICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnBsYXlsaXN0LnBvcHVwUGxheWxpc3QodHJhY2tMaXN0LCB0aXRsZSwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMucGxheWxpc3QucG9wdXBGaWxlbGlzdCh0cmFja0xpc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBhbGVydChsYW5ndWFnZS52a01wM0xpbmtzTm90Rm91bmQpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIC8vICAvQVVESU8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vICBWSURFTwoKICAgIHZhciB2aWRlbyA9IHsKICAgICAgcmVxdWVzdE1vYmlsZVRva2VuOiBmdW5jdGlvbihyZXNwb25zZSwgY2IpIHsKICAgICAgICB2YXIgaG9zdCA9IG51bGw7CiAgICAgICAgcmVzcG9uc2UubGlua3Muc29tZShmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICB2YXIgaG9zdG5hbWUgPSBpdGVtLnVybC5tYXRjaCgvXC9cLyhbXi9dKykvKTsKICAgICAgICAgIGhvc3RuYW1lID0gaG9zdG5hbWUgJiYgaG9zdG5hbWVbMV07CiAgICAgICAgICBpZiAoaG9zdG5hbWUpIHsKICAgICAgICAgICAgaG9zdCA9IGhvc3RuYW1lOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBTYXZlRnJvbV9VdGlscy5icmlkZ2UoewogICAgICAgICAgdGltZW91dDogMzAwMCwKICAgICAgICAgIGFyZ3M6IFtob3N0XSwKICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKGhvc3QsIGNiKSB7CiAgICAgICAgICAgIHZhciBjb29raWUgPSBkb2N1bWVudC5jb29raWU7CiAgICAgICAgICAgIHZhciB2ZHNpZyA9IGNvb2tpZSAmJiBjb29raWUubWF0Y2goL3Zkc2lnPShbXjtdKyk7Lyk7CiAgICAgICAgICAgIHZkc2lnID0gdmRzaWcgJiYgdmRzaWdbMV07CiAgICAgICAgICAgIGlmICh2ZHNpZykgewogICAgICAgICAgICAgIHJldHVybiBjYih7CiAgICAgICAgICAgICAgICB2dGtuOiB2ZHNpZwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBob3N0ID0gaG9zdCB8fCAndmQ0Lm15Y2RuLm1lJzsKICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICB4aHIub3BlbignUE9TVCcsIGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGhvc3QgKyAnL3Vzcl9sb2dpbicsIHRydWUpOwogICAgICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTsKICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCAnWE1MSHR0cFJlcXVlc3QnKTsKICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiB4aHIuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KCiAgICAgICAgICAgICAgICByZXR1cm4gY2IoZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB4aHIuc2VuZCgpOwogICAgICAgICAgfSwKICAgICAgICAgIGNiOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS52dGtuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChkYXRhLnR0bCkgewogICAgICAgICAgICAgIGRhdGEuZXhwaXJlID0gRGF0ZS5ub3coKSArIGRhdGEudHRsICogMTAwMDsKICAgICAgICAgICAgICBvZG5va2xhc3NuaWtpLnZpZGVvVG9rZW4gPSBkYXRhOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXNwb25zZS52dGtuID0gZGF0YS52dGtuOwoKICAgICAgICAgICAgY2IocmVzcG9uc2UpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LAogICAgICBnZXRNb2JpbGVUb2tlbjogZnVuY3Rpb24ocmVzcG9uc2UsIGNiKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLnZ0a24pIHsKICAgICAgICAgIHJldHVybiBjYihyZXNwb25zZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmlkZW9Ub2tlbiA9IG9kbm9rbGFzc25pa2kudmlkZW9Ub2tlbjsKICAgICAgICBpZiAodmlkZW9Ub2tlbiAmJiB2aWRlb1Rva2VuLmV4cGlyZSA+IERhdGUubm93KCkpIHsKICAgICAgICAgIHJlc3BvbnNlLnZ0a24gPSB2aWRlb1Rva2VuLnZ0a247CiAgICAgICAgICByZXR1cm4gY2IocmVzcG9uc2UpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZpZGVvLnJlcXVlc3RNb2JpbGVUb2tlbihyZXNwb25zZSwgY2IpOwogICAgICB9LAogICAgICB3cmFwTW9iaWxlTGlua3M6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjYikgewogICAgICAgIHZpZGVvLmdldE1vYmlsZVRva2VuKHJlc3BvbnNlLCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgaWYgKCFyZXNwb25zZSB8fCAhcmVzcG9uc2UudnRrbikgewogICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXNwb25zZS5hY3Rpb24gPSAnZ2V0T2tWaWFNb2JpbGVXcmFwcGVkJzsKICAgICAgICAgIHJlc3BvbnNlLmxpbmtzLmZvckVhY2goZnVuY3Rpb24obGluaykgewogICAgICAgICAgICB2YXIgc2VwID0gIS9cPy8udGVzdChsaW5rLnVybCkgPyAnPycgOiAnJic7CiAgICAgICAgICAgIGxpbmsudXJsICs9IHNlcCArICd2ZHNpZz0nICsgcmVzcG9uc2UudnRrbjsKICAgICAgICAgIH0pOwogICAgICAgICAgY2IocmVzcG9uc2UpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBwcmVwYXJlUmVzcG9uc2U6IGZ1bmN0aW9uKHJlc3BvbnNlLCBjYikgewogICAgICAgIHZhciBhYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgY2IobGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kKTsKICAgICAgICB9OwogICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLmxpbmtzKSB7CiAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICB9CgogICAgICAgIGlmICghcHJlZmVyZW5jZS5zaG93VW1teUl0ZW0gJiYgcmVzcG9uc2UuYWN0aW9uID09PSAnZ2V0UnV0dWJlTGlua3MnKSB7CiAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICB9CgogICAgICAgIGlmIChyZXNwb25zZS5hY3Rpb24gPT09ICdnZXRPa1ZpYU1vYmlsZScpIHsKICAgICAgICAgIHJldHVybiB2aWRlby53cmFwTW9iaWxlTGlua3MocmVzcG9uc2UsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UpIHsKICAgICAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmlkZW8ucHJlcGFyZVJlc3BvbnNlKHJlc3BvbnNlLCBjYik7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBwcmVwYXJlTGlua1R5cGUgPSBudWxsOwogICAgICAgIGlmIChyZXNwb25zZS5hY3Rpb24gPT09ICdnZXRZb3V0dWJlTGlua3MnKSB7CiAgICAgICAgICBwcmVwYXJlTGlua1R5cGUgPSAneW91dHViZSc7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHJlc3BvbnNlLmFjdGlvbiA9PT0gJ2dldFZpbWVvTGlua3MnKSB7CiAgICAgICAgICBwcmVwYXJlTGlua1R5cGUgPSAndmltZW8nOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChyZXNwb25zZS5hY3Rpb24gPT09ICdnZXREYWlseW1vdGlvbkxpbmtzJykgewogICAgICAgICAgcHJlcGFyZUxpbmtUeXBlID0gJ2RhaWx5bW90aW9uJzsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAocmVzcG9uc2UuYWN0aW9uID09PSAnZ2V0UnV0dWJlTGlua3MnKSB7CiAgICAgICAgICBwcmVwYXJlTGlua1R5cGUgPSAncnV0dWJlJzsKICAgICAgICB9CgogICAgICAgIHZhciBtZW51TGlua3MgPSBudWxsOwoKICAgICAgICBpZiAocHJlcGFyZUxpbmtUeXBlKSB7CiAgICAgICAgICBtZW51TGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzW3ByZXBhcmVMaW5rVHlwZV0ocmVzcG9uc2UubGlua3MsIHJlc3BvbnNlLnRpdGxlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWVudUxpbmtzID0gdmlkZW9GZWVkLnByZXBhcmVMaW5rcyhyZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNiKG1lbnVMaW5rcyk7CiAgICAgIH0sCgogICAgICBtYXRjaE9wZW5HcmFwaDogZnVuY3Rpb24obWV0YWRhdGEpIHsKICAgICAgICBpZiAoIW1ldGFkYXRhIHx8ICFtZXRhZGF0YS5tb3ZpZSB8fCAhbWV0YWRhdGEubW92aWUuY29udGVudElkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgdXJsID0gbWV0YWRhdGEubW92aWUuY29udGVudElkOwoKICAgICAgICBpZiAodXJsLmluZGV4T2YoJ3J1dHViZS4nKSAhPT0gLTEgJiYgcHJlZmVyZW5jZS5zaG93VW1teUl0ZW0pIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFJ1dHViZUxpbmtzJywKICAgICAgICAgICAgbGlua3M6IFt1cmxdCiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodXJsLmluZGV4T2YoJ3BsYWRmb3JtJykgIT09IC0xKSB7CiAgICAgICAgICB2YXIgdXJsQXJncyA9IG1vbm8ucGFyc2VVcmwodXJsKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFBsYWRmb3JtVmlkZW8nLAogICAgICAgICAgICBleHRWaWRlb0lkOiB7CiAgICAgICAgICAgICAgcGxheWVySWQ6IHVybEFyZ3MucGwsCiAgICAgICAgICAgICAgdmlkZW9JZDogdXJsQXJncy52aWRlb2lkCiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVxdWVzdCA9IFNhdmVGcm9tX1V0aWxzLmVtYmVkRG93bmxvYWRlci5jaGVja1VybCh1cmwpOwogICAgICAgIGlmIChyZXF1ZXN0KSB7CiAgICAgICAgICByZXR1cm4gcmVxdWVzdDsKICAgICAgICB9CgogICAgICAgIHZhciBwb3N0ZXIgPSBtZXRhZGF0YS5tb3ZpZS5wb3N0ZXI7CiAgICAgICAgaWYgKHBvc3RlcikgewogICAgICAgICAgdmFyIHl0SWQgPSBwb3N0ZXIubWF0Y2goL3l0aW1nXC5jb21cL3ZpXC8oW15cL10rKVwvLyk7CiAgICAgICAgICB5dElkID0geXRJZCAmJiB5dElkWzFdOwogICAgICAgICAgaWYgKHl0SWQpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBhY3Rpb246ICdnZXRZb3V0dWJlTGlua3MnLAogICAgICAgICAgICAgIGV4dFZpZGVvSWQ6IHl0SWQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKCiAgICAgIHN3aXRjaE1ldGFkYXRhUHJvdmlkZXI6IGZ1bmN0aW9uKG1ldGFkYXRhKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIGlmICghbWV0YWRhdGEgfHwgIW1ldGFkYXRhLnByb3ZpZGVyIHx8ICFtZXRhZGF0YS5tb3ZpZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChtZXRhZGF0YS5wcm92aWRlcikgewogICAgICAgICAgY2FzZSAnVVNFUl9ZT1VUVUJFJzoKICAgICAgICAgICAgaWYgKG1ldGFkYXRhLm1vdmllLmNvbnRlbnRJZCkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldFlvdXR1YmVMaW5rcycsCiAgICAgICAgICAgICAgICAgIGV4dFZpZGVvSWQ6IG1ldGFkYXRhLm1vdmllLmNvbnRlbnRJZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdPUEVOX0dSQVBIJzoKICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB0aGlzLm1hdGNoT3BlbkdyYXBoKG1ldGFkYXRhKTsKICAgICAgICAgICAgaWYgKHJlcXVlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ0xJVkVfVFZfT0RLTCc6CiAgICAgICAgICBjYXNlICdVUExPQURFRF9PREtMJzoKICAgICAgICAgIGNhc2UgJ1VQTE9BREVEJzoKICAgICAgICAgIGNhc2UgJ1BBUlRORVInOgogICAgICAgICAgY2FzZSAnWUtMJzoKICAgICAgICAgICAgaWYgKG1ldGFkYXRhLnZpZGVvcyAmJiBtZXRhZGF0YS5tb3ZpZS50aXRsZSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3dyYXBNb2JpbGVMaW5rcycsCiAgICAgICAgICAgICAgICAgIHRpdGxlOiBtZXRhZGF0YS5tb3ZpZS50aXRsZSwKICAgICAgICAgICAgICAgICAgbGlua3M6IG1ldGFkYXRhLnZpZGVvcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIHZpYSBtb2JpbGUKICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICBhY3Rpb246ICdva0RpcmVjdE9yTW9iaWxlJywKICAgICAgICAgICAgIG12SWQ6IG1ldGFkYXRhLm1vdmllLmlkLAogICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhLAogICAgICAgICAgICAgdGl0bGU6IG1ldGFkYXRhLm1vdmllLnRpdGxlLAogICAgICAgICAgICAgbGlua3M6IG51bGwKICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgLyogb2RpcmVjdCBvbmx5CiAgICAgICAgICAgICBpZiAobWV0YWRhdGEudmlkZW9zICYmIG1ldGFkYXRhLm1vdmllLnRpdGxlKSB7CiAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgbGlua3M6IHZpZGVvRmVlZC5wcmVwYXJlTGlua3MobWV0YWRhdGEudmlkZW9zLCBtZXRhZGF0YS5tb3ZpZS50aXRsZSkKICAgICAgICAgICAgIH07CiAgICAgICAgICAgICB9Ki8KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZ2V0UGxheWVyTWV0YWRhdGE6IGZ1bmN0aW9uKG1vdmllSWQsIHNpZCwgY2IsIHdpdGhTaWQpIHsKICAgICAgICB2YXIgcGFyYW1zID0gewogICAgICAgICAgY21kOiAndmlkZW9QbGF5ZXJNZXRhZGF0YScsCiAgICAgICAgICBtaWQ6IG1vdmllSWQsCiAgICAgICAgICBybmQ6IERhdGUubm93KCkKICAgICAgICB9OwoKICAgICAgICBpZiAod2l0aFNpZCkgewogICAgICAgICAgcGFyYW1zLm10SWQgPSBzaWQ7CiAgICAgICAgfQoKICAgICAgICBtb25vLnJlcXVlc3QoewogICAgICAgICAgdXJsOiBsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0ICsgJy9kaz8nICsgbW9uby5wYXJhbShwYXJhbXMpLAogICAgICAgICAganNvbjogdHJ1ZSwKICAgICAgICAgIGxvY2FsWEhSOiB0cnVlCiAgICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBtZXRhZGF0YSkgewogICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICBpZiAoIXdpdGhTaWQgJiYgc2lkKSB7CiAgICAgICAgICAgICAgdmlkZW8uZ2V0UGxheWVyTWV0YWRhdGEobW92aWVJZCwgc2lkLCBjYiwgMSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gY2IobWV0YWRhdGEpOwogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgZ2V0RW1iZWQ6IGZ1bmN0aW9uKGNvbnRlbnRJZCwgY2IpIHsKICAgICAgICB2YXIgcGFyYW1zID0gbW9uby5wYXJzZVVybChjb250ZW50SWQpOwogICAgICAgIGlmICghcGFyYW1zLmlkIHx8ICFwYXJhbXMuc2lnKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CgogICAgICAgIHZhciB1cmwgPSAnaHR0cDovL2Nkbi1vay5jb20vdmlkZW8vZ2V0Lz8nICsgbW9uby5wYXJhbSh7CiAgICAgICAgICBpZDogcGFyYW1zLmlkLAogICAgICAgICAgZm9ybWF0OiAxLAogICAgICAgICAgc2lnOiBwYXJhbXMuc2lnLAogICAgICAgICAgc2lnMjogJ29sZFJvdGF0b3InCiAgICAgICAgfSk7CgogICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAnZ2V0RGF0YScsCiAgICAgICAgICB1cmw6IHVybAogICAgICAgIH0sIGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIganNvbkxpc3QgPSBtb25vLmZpbmRKc29uKGRhdGEsIFsvInNvdXJjZVR5cGUiOi8sIC8ic291cmNlSWQiOi9dKTsKCiAgICAgICAgICB2YXIgaXNGb3VuZCA9IGpzb25MaXN0LnNvbWUoZnVuY3Rpb24oanNvbikgewogICAgICAgICAgICBpZiAoanNvbi5zb3VyY2VUeXBlID09PSAneW91dHViZScgJiYganNvbi5zb3VyY2VJZCkgewogICAgICAgICAgICAgIGNiKHsKICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHsKICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0WW91dHViZUxpbmtzJywKICAgICAgICAgICAgICAgICAgZXh0VmlkZW9JZDoganNvbi5zb3VyY2VJZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoIWlzRm91bmQpIHsKICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICByZWFkTWV0YWRhdGE6IGZ1bmN0aW9uKG1ldGFkYXRhLCBjYiwgc2tpcFBsYXllck1ldGEpIHsKICAgICAgICBpZiAobWV0YWRhdGEubW92aWUpIHsKICAgICAgICAgIGlmICgvY2RuLW9rXC5jb21cL2VtYmVkLy50ZXN0KG1ldGFkYXRhLm1vdmllLmNvbnRlbnRJZCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RW1iZWQobWV0YWRhdGEubW92aWUuY29udGVudElkLCBmdW5jdGlvbihpbmZvKSB7CiAgICAgICAgICAgICAgaWYgKCFpbmZvIHx8ICFpbmZvLnJlcXVlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZShpbmZvLnJlcXVlc3QsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICB2aWRlby5wcmVwYXJlUmVzcG9uc2UocmVzcG9uc2UsIGNiKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNraXBQbGF5ZXJNZXRhICYmIG1ldGFkYXRhLm1vdmllICYmIG1ldGFkYXRhLm1vdmllLm1vdmllSWQpIHsKICAgICAgICAgIHZhciBzaWQgPSBtZXRhZGF0YS5tb3ZpZS5saW5rICYmIG1vbm8ucGFyc2VVcmwobWV0YWRhdGEubW92aWUubGluaywgewogICAgICAgICAgICBzZXA6ICcmYW1wOycKICAgICAgICAgIH0pWydzdC52cGwuc2lkJ107CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQbGF5ZXJNZXRhZGF0YShtZXRhZGF0YS5tb3ZpZS5tb3ZpZUlkLCBzaWQsIGZ1bmN0aW9uKF9tZXRhZGF0YSkgewogICAgICAgICAgICB2aWRlby5yZWFkTWV0YWRhdGEoX21ldGFkYXRhIHx8IG1ldGFkYXRhLCBjYiwgMSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBpbmZvID0gdGhpcy5zd2l0Y2hNZXRhZGF0YVByb3ZpZGVyKG1ldGFkYXRhKTsKICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGluZm8ubGlua3MpIHsKICAgICAgICAgIHJldHVybiBjYihpbmZvLmxpbmtzKTsKICAgICAgICB9CgogICAgICAgIGlmIChpbmZvLnJlcXVlc3QpIHsKICAgICAgICAgIGlmIChpbmZvLnJlcXVlc3QuYWN0aW9uID09PSAnZ2V0UnV0dWJlTGlua3MnKSB7CiAgICAgICAgICAgIHZpZGVvLnByZXBhcmVSZXNwb25zZShpbmZvLnJlcXVlc3QsIGNiKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKGluZm8ucmVxdWVzdC5hY3Rpb24gPT09ICd3cmFwTW9iaWxlTGlua3MnKSB7CiAgICAgICAgICAgIHZpZGVvLndyYXBNb2JpbGVMaW5rcyhpbmZvLnJlcXVlc3QsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgdmlkZW8ucHJlcGFyZVJlc3BvbnNlKHJlc3BvbnNlLCBmdW5jdGlvbihtZW51TGlua3MpIHsKICAgICAgICAgICAgICAgIGNiKG1lbnVMaW5rcywgMSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZShpbmZvLnJlcXVlc3QsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgdmlkZW8ucHJlcGFyZVJlc3BvbnNlKHJlc3BvbnNlLCBjYik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjYigpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGxvYWRMaW5rczogZnVuY3Rpb24oaW5mbywgbWVudSkgewogICAgICAgIHZhciBsaW5rQ2FjaGUgPSBvZG5va2xhc3NuaWtpLmxpbmtDYWNoZTsKICAgICAgICB2YXIgY2FjaGVLZXkgPSBKU09OLnN0cmluZ2lmeShpbmZvKTsKICAgICAgICB2YXIgY2FjaGUgPSBsaW5rQ2FjaGVbY2FjaGVLZXldOwogICAgICAgIGlmIChjYWNoZSkgewogICAgICAgICAgcmV0dXJuIG1lbnUudXBkYXRlKGNhY2hlKTsKICAgICAgICB9CgogICAgICAgIHZhciBvbkdldE1ldGEgPSBmdW5jdGlvbihtZXRhZGF0YSwgc2tpcFBsYXllck1ldGEpIHsKICAgICAgICAgIHZhciBvbkZhaWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbWVudS51cGRhdGUobGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kKTsKICAgICAgICAgIH07CgogICAgICAgICAgaWYgKCFtZXRhZGF0YSkgewogICAgICAgICAgICByZXR1cm4gb25GYWlsKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmlkZW8ucmVhZE1ldGFkYXRhKG1ldGFkYXRhLCBmdW5jdGlvbihtZW51TGlua3MsIG5vQ2FjaGUpIHsKICAgICAgICAgICAgaWYgKCFtZW51TGlua3MpIHsKICAgICAgICAgICAgICByZXR1cm4gb25GYWlsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1lbnVMaW5rcykgJiYgIW1lbnVMaW5rcy5sZW5ndGgpIHsKICAgICAgICAgICAgICBub0NhY2hlID0gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFub0NhY2hlKSB7CiAgICAgICAgICAgICAgbGlua0NhY2hlW2NhY2hlS2V5XSA9IG1lbnVMaW5rczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWVudS51cGRhdGUobWVudUxpbmtzKTsKICAgICAgICAgIH0sIHNraXBQbGF5ZXJNZXRhKTsKICAgICAgICB9OwoKICAgICAgICBpZiAoaW5mby5tZXRhZGF0YSkgewogICAgICAgICAgb25HZXRNZXRhKGluZm8ubWV0YWRhdGEpOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChpbmZvLnJlcXVlc3QpIHsKICAgICAgICAgIGlmIChpbmZvLnJlcXVlc3QuYWN0aW9uID09PSAnZ2V0T2tNZXRhZGF0YScpIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZShpbmZvLnJlcXVlc3QsIG9uR2V0TWV0YSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmIChpbmZvLnJlcXVlc3QuYWN0aW9uID09PSAnZ2V0UGxheWVyTWV0YWRhdGEnKSB7CiAgICAgICAgICAgIHRoaXMuZ2V0UGxheWVyTWV0YWRhdGEoaW5mby5yZXF1ZXN0LmV4dFZpZGVvSWQsIGluZm8ucmVxdWVzdC5zaWQsIGZ1bmN0aW9uKG1ldGFkYXRhKSB7CiAgICAgICAgICAgICAgb25HZXRNZXRhKG1ldGFkYXRhLCAxKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmIChpbmZvLnJlcXVlc3QuYWN0aW9uID09PSAnZ2V0UnV0dWJlTGlua3MnKSB7CiAgICAgICAgICAgIHZpZGVvLnByZXBhcmVSZXNwb25zZShpbmZvLnJlcXVlc3QsIGZ1bmN0aW9uKG1lbnVMaW5rcykgewogICAgICAgICAgICAgIG1lbnUudXBkYXRlKG1lbnVMaW5rcyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZShpbmZvLnJlcXVlc3QsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgdmlkZW8ucHJlcGFyZVJlc3BvbnNlKHJlc3BvbnNlLCBmdW5jdGlvbihtZW51TGlua3MpIHsKICAgICAgICAgICAgICAgIG1lbnUudXBkYXRlKG1lbnVMaW5rcyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZW51LnVwZGF0ZShsYW5ndWFnZS5ub0xpbmtzRm91bmQpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGFwcGVuZExpbmtVbmRlclZpZGVvOiBmdW5jdGlvbihjb250YWluZXIsIGluZm8pIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIGluc2VydENvbnRhaW5lciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcudnAtbGF5ZXItaW5mb19jbnQnKTsKICAgICAgICBpZiAoIWluc2VydENvbnRhaW5lcikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGV4QnV0dG9uID0gaW5zZXJ0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy4nICsgZG93bmxvYWRMaW5rQ2xhc3NOYW1lKTsKCiAgICAgICAgdmFyIGJ1dHRvbiA9IG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgY2xhc3NOYW1lOiBkb3dubG9hZExpbmtDbGFzc05hbWUsCiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBtYXJnaW5MZWZ0OiAnMTJweCcKICAgICAgICAgIH0sCiAgICAgICAgICBvbjogWwogICAgICAgICAgICBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBbJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgWydrZXlkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH1dCiAgICAgICAgICBdLAogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICAgIGhyZWY6ICcjJywKICAgICAgICAgICAgICB0ZXh0OiBsYW5ndWFnZS5kb3dubG9hZCwKICAgICAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICBtb25vLm9uUmVtb3ZlRXZlbnQoYnV0dG9uLCBvZG5va2xhc3NuaWtpLmhpZGVNZW51KTsKCiAgICAgICAgICAgICAgICBpZiAob2Rub2tsYXNzbmlraS5jb250ZXh0TWVudSAmJiBvZG5va2xhc3NuaWtpLmNvbnRleHRNZW51LmlzU2hvdykgewogICAgICAgICAgICAgICAgICBpZiAob2Rub2tsYXNzbmlraS5jb250ZXh0TWVudS5idXR0b24gIT09IHRoaXMpIHsKICAgICAgICAgICAgICAgICAgICBvZG5va2xhc3NuaWtpLmhpZGVNZW51KCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb2Rub2tsYXNzbmlraS5oaWRlTWVudSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBtZW51ID0gb2Rub2tsYXNzbmlraS5jb250ZXh0TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydCh0aGlzLCBsYW5ndWFnZS5kb3dubG9hZCArICcuLi4nLCAnc2Ytc2luZ2xlLXZpZGVvLW1lbnUnLCB7CiAgICAgICAgICAgICAgICAgIHBhcmVudDogY29udGFpbmVyCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoWzFdLmluZGV4T2YocHJlZmVyZW5jZS5jb2hvcnRJbmRleCkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgICAgICAgIGVjOiAnb2snLAogICAgICAgICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgICAgICAgIGVsOiAndmlkZW8tdW5kZXInCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZpZGVvLmxvYWRMaW5rcyhpbmZvLCBtZW51KTsKICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KQogICAgICAgICAgXQogICAgICAgIH0pOwoKICAgICAgICBpZiAoZXhCdXR0b24gJiYgZXhCdXR0b24ucGFyZW50Tm9kZSkgewogICAgICAgICAgZXhCdXR0b24ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoYnV0dG9uLCBleEJ1dHRvbik7CiAgICAgICAgICBleEJ1dHRvbiA9IG51bGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGluc2VydENvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGdldFBsYXllck9wdGlvbnM6IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICB2YXIgb3B0aW9uc05vZGUgPSBtb25vLmdldFBhcmVudChub2RlLCAnW2RhdGEtcGxheWVyLWVsZW1lbnQtaWRdW2RhdGEtb3B0aW9uc10nKTsKCiAgICAgICAgdmFyIG9wdGlvbnMgPSBvcHRpb25zTm9kZSAmJiBvcHRpb25zTm9kZS5kYXRhc2V0Lm9wdGlvbnM7CgogICAgICAgIGlmICghb3B0aW9ucykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgIG9wdGlvbnMgPSBKU09OLnBhcnNlKG9wdGlvbnMpOwogICAgICAgIH0gY2F0Y2ggKGUpIHt9CgogICAgICAgIHZhciBmbGFzaHZhcnMgPSBvcHRpb25zLmZsYXNodmFyczsKCiAgICAgICAgaWYgKCFmbGFzaHZhcnMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChmbGFzaHZhcnMubWV0YWRhdGEpIHsKICAgICAgICAgIHZhciBtZXRhZGF0YSA9IG51bGw7CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0YWRhdGEgPSBKU09OLnBhcnNlKGZsYXNodmFycy5tZXRhZGF0YSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7fQoKICAgICAgICAgIGlmIChtZXRhZGF0YSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZmxhc2h2YXJzLm1ldGFkYXRhVXJsKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0T2tNZXRhZGF0YScsCiAgICAgICAgICAgICAgdXJsOiBkZWNvZGVVUklDb21wb25lbnQoZmxhc2h2YXJzLm1ldGFkYXRhVXJsKQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgdXJsID0gb3B0aW9ucy51cmw7CiAgICAgICAgaWYgKHVybCkgewogICAgICAgICAgdmFyIHJlcXVlc3QgPSBTYXZlRnJvbV9VdGlscy5lbWJlZERvd25sb2FkZXIuY2hlY2tVcmwodXJsKTsKICAgICAgICAgIGlmIChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdAogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHVybC5pbmRleE9mKCdydXR1YmUuJykgIT09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcmVxdWVzdDogewogICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0UnV0dWJlTGlua3MnLAogICAgICAgICAgICAgICAgbGlua3M6IFt1cmxdCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKICAgICAgY2F0Y2hQb3B1cDogZnVuY3Rpb24oKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciB2aWRlb0NvbnRhaW5lciA9IG51bGw7CiAgICAgICAgdGhpcy5sYXN0V2FpdEVsICYmIHRoaXMubGFzdFdhaXRFbC5hYm9ydCgpOwoKICAgICAgICB0aGlzLmxhc3RXYWl0RWwgPSB0aGlzLndhaXRFbChmdW5jdGlvbigpIHsKICAgICAgICAgIHZpZGVvQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZwX3ZpZGVvIC52aWQtY2FyZF9jbnQnKTsKICAgICAgICAgIGlmICghdmlkZW9Db250YWluZXIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB2aWRlb0NvbnRhaW5lcjsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBwYXJlbnQgPSBtb25vLmdldFBhcmVudCh2aWRlb0NvbnRhaW5lciwgJy52cF92aWRlbycpOwogICAgICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpbmZvID0gdmlkZW8uZ2V0UGxheWVyT3B0aW9ucyh2aWRlb0NvbnRhaW5lcik7CiAgICAgICAgICBpZiAoaW5mbykgewogICAgICAgICAgICB2aWRlby5hcHBlbmRMaW5rVW5kZXJWaWRlbyhwYXJlbnQucGFyZW50Tm9kZSwgaW5mbyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICBybUJ0bjogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGRsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBkb3dubG9hZExpbmtDbGFzc05hbWUpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gZGxCdG5baV07IGkrKykgewogICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGxhc3RXYWl0RWw6IG51bGwsCiAgICAgIHdhaXRFbDogZnVuY3Rpb24oZnVuYywgY2IsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgb3V0OwogICAgICAgIHZhciBjYXBzdWxlID0gbW9uby5leHRlbmQoewogICAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjbGVhckludGVydmFsKGNhcHN1bGUudGltZW91dCk7CiAgICAgICAgICAgIGNhcHN1bGUuaXNBYm9ydGVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICBkZWxheTogNTAwLAogICAgICAgICAgcmVwZWF0OiAxMiwKICAgICAgICAgIGlzQWJvcnRlZDogZmFsc2UsCiAgICAgICAgICB0aW1lb3V0OiBudWxsCiAgICAgICAgfSwgb3B0aW9ucyk7CgogICAgICAgIGlmIChvdXQgPSBmdW5jKCkpIHsKICAgICAgICAgIGNiKG91dCk7CiAgICAgICAgICByZXR1cm4gY2Fwc3VsZTsKICAgICAgICB9CgogICAgICAgIChmdW5jdGlvbiB3YWl0KCkgewogICAgICAgICAgY2Fwc3VsZS5yZXBlYXQtLTsKICAgICAgICAgIGNhcHN1bGUudGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChjYXBzdWxlLmlzQWJvcnRlZCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG91dCA9IGZ1bmMoKSkgewogICAgICAgICAgICAgIHJldHVybiBjYihvdXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWNhcHN1bGUuaXNBYm9ydGVkICYmIGNhcHN1bGUucmVwZWF0KSB7CiAgICAgICAgICAgICAgd2FpdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBjYXBzdWxlLmRlbGF5KTsKICAgICAgICB9KSgpOwoKICAgICAgICByZXR1cm4gY2Fwc3VsZTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgdmlkZW9GZWVkID0gewogICAgICBidG5DbGFzc05hbWU6ICdzZi1mZWVkLWRsLWJ0bicsCiAgICAgIHN0eWxlOiB1bmRlZmluZWQsCiAgICAgIHRodW1iQ2xhc3NOYW1lOiAndmlkLWNhcmRfaW1nJywKICAgICAgcHJlcGFyZUxpbmtzOiBmdW5jdGlvbihsaW5rcywgdGl0bGUpIHsKICAgICAgICBpZiAoIWxpbmtzIHx8ICFsaW5rcy5sZW5ndGgpIHsKICAgICAgICAgIHJldHVybiBsYW5ndWFnZS5ub0xpbmtzRm91bmQ7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIGxpbmtzID09PSAnc3RyaW5nJykgewogICAgICAgICAgcmV0dXJuIGxpbmtzOwogICAgICAgIH0KCiAgICAgICAgdGl0bGUgPSB0aXRsZSB8fCAnJzsKCiAgICAgICAgdmFyIG1lbnVMaW5rcyA9IFtdOwogICAgICAgIHZhciBwb3B1cExpbms7CiAgICAgICAgdmFyIHF1YWxpdHk7CiAgICAgICAgdmFyIGZvcm1hdDsKICAgICAgICB2YXIgdXJsOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaW5rcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIGxpbmsgPSBsaW5rc1tpXTsKICAgICAgICAgIGlmICh0eXBlb2YobGluaykgPT09ICdvYmplY3QnICYmIGxpbmsudXJsKSB7CiAgICAgICAgICAgIHVybCA9IGxpbmsudXJsOwogICAgICAgICAgICB2YXIgZXh0ID0gbGluay5leHQ7CgogICAgICAgICAgICBpZiAoIWV4dCkgewogICAgICAgICAgICAgIGV4dCA9ICdNUDQnOwogICAgICAgICAgICAgIGlmIChsaW5rLnVybC5pbmRleE9mKCcubXA0JykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBleHQgPSAnTVA0JzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCcuZmx2JykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBleHQgPSAnRkxWJzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGxpbmsudXJsLmluZGV4T2YoJy5tb3YnKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGV4dCA9ICdNT1YnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAobGluay51cmwuaW5kZXhPZignLm1wZycpICE9PSAtMSkgewogICAgICAgICAgICAgICAgZXh0ID0gJ01QRyc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBleHQgPSBleHQudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgZm9ybWF0ID0gZXh0LnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgIHF1YWxpdHkgPSBsaW5rLnN1Ym5hbWUgfHwgbGluay5xdWFsaXR5IHx8IGxpbmsubmFtZSB8fCBleHQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1cmwgPSBsaW5rOwogICAgICAgICAgICBleHQgPSAnTVA0JzsKICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCcubXA0JykgIT09IC0xKSB7CiAgICAgICAgICAgICAgZXh0ID0gJ01QNCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCcuZmx2JykgIT09IC0xKSB7CiAgICAgICAgICAgICAgZXh0ID0gJ0ZMVic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCcubW92JykgIT09IC0xKSB7CiAgICAgICAgICAgICAgZXh0ID0gJ01PVic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCcubXBnJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgZXh0ID0gJ01QRyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGV4dCA9IGV4dC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBmb3JtYXQgPSBleHQudG9VcHBlckNhc2UoKTsKCiAgICAgICAgICAgIHF1YWxpdHkgPSBleHQ7CiAgICAgICAgICAgIHZhciBxdWFsaXR5TWF0aCA9IFNhdmVGcm9tX1V0aWxzLmdldE1hdGNoRmlyc3QobGlua3NbaV0sIC9cLihcZCspXC5tcDQvaSk7CiAgICAgICAgICAgIGlmIChxdWFsaXR5TWF0aCkgewogICAgICAgICAgICAgIHF1YWxpdHkgPSBxdWFsaXR5TWF0aDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0cnVlTmFtZSA9IFsxNDQsIDI0MCwgMzYwLCA0ODAsIDcyMCwgMTA4MCwgMTQ0MCwgJzRLJ107CiAgICAgICAgICB2YXIgb3JpZ05hbWUgPSBbJ21vYmlsZScsICdsb3dlc3QnLCAnbG93JywgJ3NkJywgJ2hkJywgJ2Z1bGwnLCAncXVhZCcsICd1bHRyYSddOwogICAgICAgICAgdmFyIHBvcyA9IG9yaWdOYW1lLmluZGV4T2YocXVhbGl0eSk7CiAgICAgICAgICBpZiAocG9zICE9PSAtMSkgewogICAgICAgICAgICBxdWFsaXR5ID0gdHJ1ZU5hbWVbcG9zXTsKICAgICAgICAgIH0KCiAgICAgICAgICBwb3B1cExpbmsgPSB7CiAgICAgICAgICAgIGhyZWY6IHVybCwKICAgICAgICAgICAgdGl0bGU6IGxpbmsudGl0bGUgPyBsaW5rLnRpdGxlIDogdGl0bGUsCiAgICAgICAgICAgIGV4dDogZXh0LAogICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdCwKICAgICAgICAgICAgcXVhbGl0eTogcXVhbGl0eSwKICAgICAgICAgICAgZm9yY2VEb3dubG9hZDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICAgIG1lbnVMaW5rcy5wdXNoKHBvcHVwTGluayk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBtZW51TGlua3M7CiAgICAgIH0sCiAgICAgIGdldFBvc3RlckRhdGE6IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICB2YXIgaW5mb05vZGUgPSBtb25vLmdldFBhcmVudChub2RlLCAnW2hyZWZhdHRyc10nKTsKCiAgICAgICAgdmFyIGluZm8gPSBpbmZvTm9kZSAmJiBpbmZvTm9kZS5nZXRBdHRyaWJ1dGUoJ2hyZWZhdHRycycpOwoKICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBwYXJhbXMgPSBtb25vLnBhcnNlVXJsKGluZm8sIHsKICAgICAgICAgIHBhcmFtczogdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICB2YXIgc2lkID0gcGFyYW1zWydzdC52cGwuc2lkJ107CiAgICAgICAgdmFyIHZpZCA9IHBhcmFtc1snc3QudnBsLmlkJ107CiAgICAgICAgaWYgKCF2aWQpIHsKICAgICAgICAgIHZhciB2aWROb2RlID0gbW9uby5nZXRQYXJlbnQobm9kZSwgJ1tkYXRhLWlkXScpOwogICAgICAgICAgdmlkID0gdmlkTm9kZSAmJiB2aWROb2RlLmRhdGFzZXQuaWQ7CgogICAgICAgICAgaWYgKHZpZCAmJiB2aWRbMF0gPT09ICdjJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodmlkICYmIHZpZC5zdWJzdHIoMCwgMykgPT09ICdPS18nKSB7CiAgICAgICAgICB2aWQgPSBTYXZlRnJvbV9VdGlscy5nZXRNYXRjaEZpcnN0KHZpZCwgL09LX1xkK18oXGQrKS8pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF2aWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgIHNpZDogc2lkLAogICAgICAgICAgICBhY3Rpb246ICdnZXRQbGF5ZXJNZXRhZGF0YScsCiAgICAgICAgICAgIGV4dFZpZGVvSWQ6IHZpZAogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIG9uQnRuQ2xpY2s6IGZ1bmN0aW9uKGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgdmFyIGluZm8gPSBKU09OLnBhcnNlKHRoaXMuZGF0YXNldC5zZkNvbnRleHQpOwogICAgICAgIG1vbm8ub25SZW1vdmVFdmVudCh0aGlzLCBvZG5va2xhc3NuaWtpLmhpZGVNZW51KTsKCiAgICAgICAgaWYgKG9kbm9rbGFzc25pa2kuY29udGV4dE1lbnUgJiYgb2Rub2tsYXNzbmlraS5jb250ZXh0TWVudS5pc1Nob3cpIHsKICAgICAgICAgIGlmIChvZG5va2xhc3NuaWtpLmNvbnRleHRNZW51LmJ1dHRvbiAhPT0gdGhpcykgewogICAgICAgICAgICBvZG5va2xhc3NuaWtpLmhpZGVNZW51KCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvZG5va2xhc3NuaWtpLmhpZGVNZW51KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgIGlmIChpbmZvLmlzQ2hhdCkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ29rJywKICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICBlbDogJ3ZpZGVvLW1lc3NhZ2UnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgZWM6ICdvaycsCiAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgZWw6ICd2aWRlby1mZWVkLW9uLXZpZGVvJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHBvc3QgaW4gcG9wdXAKICAgICAgICB2YXIgbWVudVBhcmVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtdExheWVyLl9fYWN0aXZlICNtdExheWVyTWFpbiA+IGRpdicpOwogICAgICAgIGlmICghbWVudVBhcmVudCkgewogICAgICAgICAgLy8gdmlkZW8gZ2FhbGxlcnkKICAgICAgICAgIG1lbnVQYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndnZfY29udGVudCcpOwogICAgICAgIH0KICAgICAgICBpZiAoIW1lbnVQYXJlbnQpIHsKICAgICAgICAgIC8vIHBtIG1zZ3MKICAgICAgICAgIG1lbnVQYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnX19tZXNzYWdlc0xpc3RfXycpOwogICAgICAgICAgaWYgKG1lbnVQYXJlbnQgJiYgIW1lbnVQYXJlbnQub2Zmc2V0UGFyZW50KSB7CiAgICAgICAgICAgIG1lbnVQYXJlbnQgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIW1lbnVQYXJlbnQgJiYgbW9uby5tYXRjaGVzKHRoaXMsICcjbWFpbkNvbnRlbnQgJyArIHRoaXMudGFnTmFtZSkpIHsKICAgICAgICAgIG1lbnVQYXJlbnQgPSBtb25vLmdldFBhcmVudCh0aGlzLCAnI21haW5Db250ZW50Jyk7CiAgICAgICAgfQogICAgICAgIHZhciBtZW51ID0gb2Rub2tsYXNzbmlraS5jb250ZXh0TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydCh0aGlzLCBsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJywgJ3NmLXBvcHVwTWVudScsIHsKICAgICAgICAgIHBhcmVudDogbWVudVBhcmVudCB8fCB1bmRlZmluZWQKICAgICAgICB9KTsKCiAgICAgICAgdmlkZW8ubG9hZExpbmtzKGluZm8sIG1lbnUpOwogICAgICB9LAogICAgICBvbkltZ092ZXI6IGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBpc0NoYXQgPSBtb25vLm1hdGNoZXModGhpcywgJy5tZGlhbG9nX2NoYXRfd2luZG93IC5kX2NvbW1lbnRfdGV4dF93ICcgKyB0aGlzLnRhZ05hbWUpOwoKICAgICAgICB2YXIgY29udGFpbmVyID0gbnVsbDsKICAgICAgICBpZiAoaXNDaGF0KSB7CiAgICAgICAgICBjb250YWluZXIgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3ModGhpcywgJ2RfY29tbWVudF90ZXh0X3cnKTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAobW9uby5tYXRjaGVzKHRoaXMsICcudmlkZW8tY2FyZCA+IC52aWRlby1jYXJkX2ltZy13ICcgKyB0aGlzLnRhZ05hbWUpKSB7CiAgICAgICAgICBjb250YWluZXIgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3ModGhpcywgJ3ZpZGVvLWNhcmRfaW1nLXcnKTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoJ3ZpZC1jYXJkX2NudCcpKSB7CiAgICAgICAgICBjb250YWluZXIgPSB0aGlzOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChtb25vLm1hdGNoZXModGhpcywgJy52aWQtY2FyZF9jbnQgJyArIHRoaXMudGFnTmFtZSkpIHsKICAgICAgICAgIGNvbnRhaW5lciA9IG1vbm8uZ2V0UGFyZW50QnlDbGFzcyh0aGlzLCAndmlkLWNhcmRfY250Jyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWNvbnRhaW5lcikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRhaW5lci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHZpZGVvRmVlZC5idG5DbGFzc05hbWUpLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGlzVmlkZW9WaXRyaW5hID0gbW9uby5tYXRjaGVzKHRoaXMsICcudmlkLWNhcmRfaW1nX19saW5rICcgKyB0aGlzLnRhZ05hbWUpOwoKICAgICAgICB2YXIgYnRuRGF0YSA9IHZpZGVvLmdldFBsYXllck9wdGlvbnModGhpcyk7CiAgICAgICAgaWYgKCFidG5EYXRhKSB7CiAgICAgICAgICBidG5EYXRhID0gdmlkZW9GZWVkLmdldFBvc3RlckRhdGEodGhpcyk7CiAgICAgICAgfQogICAgICAgIGlmICghYnRuRGF0YSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYnRuRGF0YS5pc0NoYXQgPSBpc0NoYXQ7CgogICAgICAgIHZhciBjdXN0b21TdHlsZSA9IHt9OwoKICAgICAgICBpZiAoaXNDaGF0KSB7CiAgICAgICAgICBtb25vLmV4dGVuZChjdXN0b21TdHlsZSwgewogICAgICAgICAgICBsZWZ0OiAnMTVweCcsCiAgICAgICAgICAgIHRvcDogJzE1cHgnCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChpc1ZpZGVvVml0cmluYSkgewogICAgICAgICAgbW9uby5leHRlbmQoY3VzdG9tU3R5bGUsIHsKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzQ1NDY0OCcsCiAgICAgICAgICAgIGJvcmRlckNvbG9yOiAncmdiKDUzLCA1MywgNTMpJwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgYnRuID0gbW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgICBjbGFzczogW3ZpZGVvRmVlZC5idG5DbGFzc05hbWUsICdzZi12aWRlby1mZWVkLWJpbmQtb24taW5zZXJ0J10sCiAgICAgICAgICBzdHlsZTogY3VzdG9tU3R5bGUsCiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgIHNmQ29udGV4dDogSlNPTi5zdHJpbmdpZnkoYnRuRGF0YSkKICAgICAgICAgIH0sCiAgICAgICAgICB0aXRsZTogbGFuZ3VhZ2UuZG93bmxvYWQKICAgICAgICB9KTsKCiAgICAgICAgYnRuLmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTdmcoJ2Rvd25sb2FkJyksIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIHdpZHRoOiAnMTJweCcsCiAgICAgICAgICAgIGhlaWdodDogJzEycHgnLAogICAgICAgICAgICBtYXJnaW46ICc0cHgnCiAgICAgICAgICB9CiAgICAgICAgfSkpOwoKICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYnRuKTsKICAgICAgfSwKICAgICAgaW5qZWN0U3R5bGU6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLnN0eWxlKSB7CiAgICAgICAgICBpZiAoIXRoaXMuc3R5bGUucGFyZW50Tm9kZSkgewogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHRoaXMuc3R5bGUpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zdHlsZSA9IG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dCh7CiAgICAgICAgICAgICdkaXYgPiAuc2YtZmVlZC1kbC1idG4nOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnLAogICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjRjhGOEY4JywKICAgICAgICAgICAgICB3aWR0aDogJzIwcHgnLAogICAgICAgICAgICAgIGhlaWdodDogJzIwcHgnLAogICAgICAgICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgdG9wOiAnNXB4JywKICAgICAgICAgICAgICBsZWZ0OiAnNXB4JywKICAgICAgICAgICAgICB6SW5kZXg6IDEsCiAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI0Y4RjhGOCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2RpdiA+IC5zZi1mZWVkLWRsLWJ0biBzdmcgcGF0aCc6IHsKICAgICAgICAgICAgICBmaWxsOiAnI2ViNzIyZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2RpdiA+IC5zZi1mZWVkLWRsLWJ0bjpob3ZlciBzdmcgcGF0aCc6IHsKICAgICAgICAgICAgICBmaWxsOiAnIzAwQjc1QScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2RpdiA+IC5zZi1mZWVkLWRsLWJ0bjphY3RpdmUnOiB7CiAgICAgICAgICAgICAgb3V0bGluZTogMCwKICAgICAgICAgICAgICBib3hTaGFkb3c6ICdpbnNldCAwIDNweCA1cHggcmdiYSgwLCAwLCAwLCAwLjEyNSknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdkaXY6aG92ZXIgPiAuc2YtZmVlZC1kbC1idG4nOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHRoaXMuc3R5bGUpOwogICAgICB9LAogICAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAodGhpcy5zdHlsZSkgewogICAgICAgICAgdGhpcy5zdHlsZS5wYXJlbnROb2RlICYmIHRoaXMuc3R5bGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnN0eWxlKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJtQnRuOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYnRuTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi1mZWVkLWRsLWJ0bicpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gYnRuTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICBpdGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaXRlbSk7CiAgICAgICAgfQogICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoJ3NmU2tpcDInKTsKICAgICAgICB2YXIgZGF0YUF0dHJMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnWycgKyBkYXRhQXR0ciArICddJyk7CiAgICAgICAgZm9yIChpID0gMCwgaXRlbTsgaXRlbSA9IGRhdGFBdHRyTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICBpdGVtLnJlbW92ZUF0dHJpYnV0ZShkYXRhQXR0cik7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vICAvVklERU8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgogICAgLy8gIFBIT1RPCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgdmFyIHBob3RvID0gewogICAgICBzdHlsZTogbnVsbCwKICAgICAgcm1DdXJyZW50UGhvdG9CdG46IGZ1bmN0aW9uKGluc2VydENvbnRhaW5lcikgewogICAgICAgIHZhciBleEJ0biA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgaW1nTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi1kbC1jdXJyZW50LXBob3RvLWJ0bicpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpbWdJdGVtOyBpbWdJdGVtID0gaW1nTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICBpZiAoIWluc2VydENvbnRhaW5lciB8fCAhaW5zZXJ0Q29udGFpbmVyLmNvbnRhaW5zKGltZ0l0ZW0pKSB7CiAgICAgICAgICAgIGltZ0l0ZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpbWdJdGVtKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4QnRuID0gaW1nSXRlbTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4QnRuOwogICAgICB9LAogICAgICBhZGREbEN1cnJlbnRQaG90b0J0bjogZnVuY3Rpb24oY29udGFpbmVyKSB7CiAgICAgICAgdmFyIGV4QnRuID0gdGhpcy5ybUN1cnJlbnRQaG90b0J0bihjb250YWluZXIpOwogICAgICAgIGlmIChleEJ0bikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIF90aGlzID0gb2Rub2tsYXNzbmlraTsKCiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgY2xhc3M6ICdzZi1kbC1jdXJyZW50LXBob3RvLWJ0bicsCiAgICAgICAgICBocmVmOiAnIycsCiAgICAgICAgICB0aXRsZTogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKF90aGlzLmNvbnRleHRNZW51ICYmIF90aGlzLmNvbnRleHRNZW51LmlzU2hvdyAmJiBfdGhpcy5jb250ZXh0TWVudS5idXR0b24gPT09IHRoaXMpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXMuY29udGV4dE1lbnUuYnV0dG9uICE9PSB0aGlzKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5oaWRlTWVudSgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpcy5oaWRlTWVudSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG9uS2V5RG93biA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAxOCB8fCBlLmtleUNvZGUgPT09IDE3KSByZXR1cm47CiAgICAgICAgICAgICAgbWVudS5oaWRlKCk7CiAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5RG93bik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgbWVudSA9IF90aGlzLmNvbnRleHRNZW51ID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnF1aWNrSW5zZXJ0KHRoaXMsIGxhbmd1YWdlLmRvd25sb2FkICsgJyAuLi4nLCAicGhvdG9EbE1lbnUiLCB7CiAgICAgICAgICAgICAgcGFyZW50OiBjb250YWluZXIsCiAgICAgICAgICAgICAgb25TaG93OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleURvd24pOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb25IaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleURvd24pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbGlua0xpc3QgPSBbXTsKCiAgICAgICAgICAgIHZhciBpbWcgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignaW1nLnBob3RvLWxheWVyX2ltZycpOwogICAgICAgICAgICBpZiAoaW1nKSB7CiAgICAgICAgICAgICAgdmFyIHVybCA9IGltZy5kYXRhc2V0LmZzU3JjIHx8IGltZy5kYXRhc2V0Lm5mc1NyYyB8fCBpbWcuc3JjOwogICAgICAgICAgICAgIGlmICh1cmwpIHsKICAgICAgICAgICAgICAgIGxpbmtMaXN0LnB1c2goewogICAgICAgICAgICAgICAgICBocmVmOiB1cmwsCiAgICAgICAgICAgICAgICAgIHRpdGxlOiAncGhvdG9fJyArIHBhcnNlSW50KERhdGUubm93KCkgLyAxMDAwKSwKICAgICAgICAgICAgICAgICAgcXVhbGl0eTogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICAgICAgICAgIGZvcm1hdDogJyAnLAogICAgICAgICAgICAgICAgICBleHQ6ICdqcGcnLAogICAgICAgICAgICAgICAgICBmb3JjZURvd25sb2FkOiB0cnVlLAogICAgICAgICAgICAgICAgICBpc0JsYW5rOiB0cnVlLAogICAgICAgICAgICAgICAgICBmdW5jOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBtZW51LmhpZGUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWltZykgewogICAgICAgICAgICAgIGltZyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdkaXYuZ2lmW2RhdGEtZ2lmc3JjXScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaW1nKSB7CiAgICAgICAgICAgICAgdmFyIG1hcCA9IHsKICAgICAgICAgICAgICAgIHdlYm1zcmM6ICd3ZWJtJywKICAgICAgICAgICAgICAgIG1wNHNyYzogJ21wNCcsCiAgICAgICAgICAgICAgICBnaWZzcmM6ICdnaWYnCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBPYmplY3Qua2V5cyhtYXApLmZvckVhY2goZnVuY3Rpb24odHlwZSkgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IGltZy5kYXRhc2V0W3R5cGVdOwogICAgICAgICAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBleHQgPSBtYXBbdHlwZV07CgogICAgICAgICAgICAgICAgbGlua0xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICAgIGhyZWY6IHVybCwKICAgICAgICAgICAgICAgICAgdGl0bGU6ICdnaWZfJyArIHBhcnNlSW50KERhdGUubm93KCkgLyAxMDAwKSwKICAgICAgICAgICAgICAgICAgcXVhbGl0eTogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICAgICAgICAgIGZvcm1hdDogZXh0LnRvVXBwZXJDYXNlKCksCiAgICAgICAgICAgICAgICAgIGV4dDogZXh0LAogICAgICAgICAgICAgICAgICBmb3JjZURvd25sb2FkOiB0cnVlLAogICAgICAgICAgICAgICAgICBpc0JsYW5rOiB0cnVlLAogICAgICAgICAgICAgICAgICBmdW5jOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBtZW51LmhpZGUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsaW5rTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBtZW51LnVwZGF0ZShsYW5ndWFnZS5ub0xpbmtzRm91bmQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWVudS51cGRhdGUobGlua0xpc3QpOwogICAgICAgICAgfV0sCiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgbW9uby5jcmVhdGUoU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFN2ZygnZG93bmxvYWQnKSwgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICB3aWR0aDogJzEycHgnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTJweCcsCiAgICAgICAgICAgICAgICBtYXJnaW46ICc0cHgnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgXQogICAgICAgIH0pKTsKICAgICAgfSwKICAgICAgaW5qZWN0U3R5bGU6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChwaG90by5zdHlsZSkgewogICAgICAgICAgaWYgKCFwaG90by5zdHlsZS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQocGhvdG8uc3R5bGUpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcGhvdG8uc3R5bGUgPSBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoewogICAgICAgICAgICAnZGl2ID4gLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuJzogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJywKICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI0Y4RjhGOCcsCiAgICAgICAgICAgICAgd2lkdGg6ICcyMHB4JywKICAgICAgICAgICAgICBoZWlnaHQ6ICcyMHB4JywKICAgICAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNGOEY4RjgnLAogICAgICAgICAgICAgIHRvcDogJzczcHgnLAogICAgICAgICAgICAgIGxlZnQ6ICc5MHB4JywKICAgICAgICAgICAgICB6SW5kZXg6IDEwMCwKICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnZGl2ID4gLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuIHN2ZyBwYXRoJzogewogICAgICAgICAgICAgIGZpbGw6ICcjZWI3MjJlJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnZGl2ID4gLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuOmhvdmVyIHN2ZyBwYXRoJzogewogICAgICAgICAgICAgIGZpbGw6ICcjMDBCNzVBJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnZGl2ID4gLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuOmFjdGl2ZSc6IHsKICAgICAgICAgICAgICBvdXRsaW5lOiAwLAogICAgICAgICAgICAgIGJveFNoYWRvdzogJ2luc2V0IDAgM3B4IDVweCByZ2JhKDAsIDAsIDAsIDAuMTI1KScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2Rpdjpob3ZlciA+IC5zZi1kbC1jdXJyZW50LXBob3RvLWJ0bic6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQocGhvdG8uc3R5bGUpOwogICAgICB9LAogICAgICBhZGRDdXJyZW50RGxCdG46IGZ1bmN0aW9uKGNvbnRhaW5lcikgewogICAgICAgIGlmIChjb250YWluZXIuZGF0YXNldC5zZlNraXAyID09PSAnMScpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29udGFpbmVyLmRhdGFzZXQuc2ZTa2lwMiA9ICcxJzsKCiAgICAgICAgdmFyIGltZyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdpbWcucGhvdG8tbGF5ZXJfaW1nJyk7CiAgICAgICAgaWYgKGltZykgewogICAgICAgICAgdmFyIHVybCA9IGltZy5kYXRhc2V0LmZzU3JjIHx8IGltZy5kYXRhc2V0Lm5mc1NyYyB8fCBpbWcuc3JjOwogICAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgICAgaW1nID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghaW1nKSB7CiAgICAgICAgICBpbWcgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignZGl2LmdpZltkYXRhLWdpZnNyY10nKTsKICAgICAgICB9CgogICAgICAgIGlmICghaW1nKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLmFkZERsQ3VycmVudFBob3RvQnRuKGNvbnRhaW5lcik7CiAgICAgIH0KICAgIH07CgogICAgLy8gIC9QSE9UTwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgfSwgbnVsbCwgZnVuY3Rpb24gc3luY0lzQWN0aXZlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vKi5vay5ydS8qJywKICAgICAgICAnKjovLyoub2Rub2tsYXNzbmlraS5ydS8qJwogICAgICBdOwoKICAgICAgdmFyIHJlU3RyID0gbGlzdC5tYXAoZnVuY3Rpb24ocGF0dGVybikgewogICAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgICB9KS5qb2luKCd8Jyk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAocmVTdHIpOwoKICAgICAgaWYgKCFyZS50ZXN0KGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGlmIChtb25vLmlzSWZyYW1lKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgnbWFpbHJ1JywgZnVuY3Rpb24obW9kdWxlTmFtZSwgaW5pdERhdGEpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbGFuZ3VhZ2UgPSBpbml0RGF0YS5nZXRMYW5ndWFnZTsKICAgIHZhciBwcmVmZXJlbmNlID0gaW5pdERhdGEuZ2V0UHJlZmVyZW5jZTsKICAgIHZhciBtb2R1bGVTdGF0ZSA9IHByZWZlcmVuY2UubW9kdWxlTWFpbHJ1ID8gMSA6IDA7CgogICAgdmFyIGFsbG93RG93bmxvYWRNb2RlID0gbW9uby5pc1NhZmFyaSB8fCBtb25vLmlzQ2hyb21lIHx8IG1vbm8uaXNGRiB8fCAobW9uby5pc0dNICYmIG1vbm8uaXNUTSk7CgogICAgbW9uby5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnZ2V0TW9kdWxlSW5mbycpIHsKICAgICAgICBpZiAobWVzc2FnZS51cmwgIT09IGxvY2F0aW9uLmhyZWYpIHJldHVybjsKICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgc3RhdGU6IG1vZHVsZVN0YXRlLAogICAgICAgICAgbW9kdWxlTmFtZTogbW9kdWxlTmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2NoYW5nZVN0YXRlJykgewogICAgICAgIGlmIChtb2R1bGVOYW1lICE9PSBtZXNzYWdlLm1vZHVsZU5hbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1haWxydS5jaGFuZ2VTdGF0ZShtZXNzYWdlLnN0YXRlKTsKICAgICAgfQogICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2Rvd25sb2FkTVAzRmlsZXMnKSB7CiAgICAgICAgaWYgKGFsbG93RG93bmxvYWRNb2RlKSB7CiAgICAgICAgICBhdWRpby5kb3dubG9hZE1QM0ZpbGVzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF1ZGlvLnNob3dMaXN0T2ZBdWRpb0ZpbGVzKGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnZG93bmxvYWRQbGF5bGlzdCcpIHsKICAgICAgICBhdWRpby5zaG93TGlzdE9mQXVkaW9GaWxlcyh0cnVlKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKG1vZHVsZVN0YXRlKSB7CiAgICAgIG1vbm8uYXN5bmNDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgIG1haWxydS5ydW4oKTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIG1haWxydSA9IHsKICAgICAgY29udGV4dE1lbnU6IG51bGwsCiAgICAgIHJ1bjogZnVuY3Rpb24oKSB7CiAgICAgICAgbW9kdWxlU3RhdGUgPSAxOwoKICAgICAgICBhdWRpby5pbmplY3RTdHlsZSgpOwogICAgICAgIGlmIChTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIuaXNBdmFpbGFibGUoKSkgewogICAgICAgICAgdGhpcy5tdXRhdGlvbk1vZGUuZW5hYmxlKCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBjaGFuZ2VTdGF0ZTogZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICBtb2R1bGVTdGF0ZSA9IHN0YXRlOwogICAgICAgIGF1ZGlvLnJtQnRuKCk7CiAgICAgICAgdmlkZW8ucm1CdG4oKTsKICAgICAgICB0aGlzLm11dGF0aW9uTW9kZS5zdG9wKCk7CiAgICAgICAgdGhpcy5oaWRlTWVudSgpOwogICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgdGhpcy5ydW4oKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGhpZGVNZW51OiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAobWFpbHJ1LmNvbnRleHRNZW51KSB7CiAgICAgICAgICBtYWlscnUuY29udGV4dE1lbnUuaGlkZSgpOwogICAgICAgICAgbWFpbHJ1LmNvbnRleHRNZW51ID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG11dGF0aW9uTW9kZTogewogICAgICAgIG9ic2VydmVyOiBudWxsLAogICAgICAgIHN0b3A6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgdGhpcy5vYnNlcnZlci5zdG9wKCk7CiAgICAgICAgICB9CgogICAgICAgICAgWydzZlNraXAnXS5mb3JFYWNoKGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgICAgICAgdmFyIGRhdGFBdHRyID0gbW9uby5kYXRhQXR0cjJTZWxlY3RvcihhdHRyKTsKICAgICAgICAgICAgdmFyIGRhdGFBdHRyTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1snICsgZGF0YUF0dHIgKyAnXScpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGRhdGFBdHRyTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICAgICAgaXRlbS5yZW1vdmVBdHRyaWJ1dGUoZGF0YUF0dHIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHdyYXBBdWRpb09uTW91c2VPdmVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICghbW9kdWxlU3RhdGUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgIHZhciBjb250ZXh0ID0gSlNPTi5wYXJzZSh0aGlzLmRhdGFzZXQuc2ZDb250ZXh0KTsKICAgICAgICAgIGF1ZGlvLm9uVHJhY2tPdmVyKHRoaXMsIGNvbnRleHQudHlwZSk7CiAgICAgICAgfSwKICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm9ic2VydmVyID0gU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLnJ1bih7CiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdW1tYXJ5TGlzdCkgewogICAgICAgICAgICAgIHZhciBzdW1tYXJ5LCBuLCBpLCBub2RlLCBjb250ZXh0OwoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMF07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgY29udGV4dCA9IHt9OwogICAgICAgICAgICAgICAgY29udGV4dC50eXBlID0gMDsKICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZkNvbnRleHQgPSBKU09OLnN0cmluZ2lmeShjb250ZXh0KTsKICAgICAgICAgICAgICAgIG1vbm8ub25lKG5vZGUsICdtb3VzZW92ZXInLCBtYWlscnUubXV0YXRpb25Nb2RlLndyYXBBdWRpb09uTW91c2VPdmVyKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFsxXTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0ID0ge307CiAgICAgICAgICAgICAgICBjb250ZXh0LnR5cGUgPSAxOwogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmQ29udGV4dCA9IEpTT04uc3RyaW5naWZ5KGNvbnRleHQpOwogICAgICAgICAgICAgICAgbW9uby5vbmUobm9kZSwgJ21vdXNlb3ZlcicsIG1haWxydS5tdXRhdGlvbk1vZGUud3JhcEF1ZGlvT25Nb3VzZU92ZXIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHZpZGVvSW5mbywgcGFyZW50LCBpbmZvOwoKICAgICAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbaV07CiAgICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgICB2aWRlb0luZm8gPSB2aWRlby5nZXRWaWRlb0lkKG5vZGUpOwogICAgICAgICAgICAgICAgICBpZiAoIXZpZGVvSW5mbykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBwYXJlbnQgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3Mobm9kZSwgJ2ItdmlkZW9fX2xlZnQnKTsKICAgICAgICAgICAgICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaW5mbyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcuYi12aWRlb19faW5mby10aW1lJyk7CiAgICAgICAgICAgICAgICAgIGlmICghaW5mbykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2aWRlby5pbnNlcnRCdG5JblBvcHVwKHZpZGVvSW5mbywgaW5mbyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3IgKGkgPSA0OyBpIDwgNjsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbaV07CiAgICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgICB2aWRlb0luZm8gPSB2aWRlby5nZXRWaWRlb0lkKG5vZGUpOwogICAgICAgICAgICAgICAgICBpZiAoIXZpZGVvSW5mbykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBwYXJlbnQgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3Mobm9kZSwgJ3NwLXZpZGVvX19pdGVtLXBhZ2UnKTsKICAgICAgICAgICAgICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaW5mbyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcuc3AtdmlkZW9fX2l0ZW0tcGFnZV9faW5mb19fYWRkaXRpb25hbCcpOwogICAgICAgICAgICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmlkZW8uaW5zZXJ0QnRuSW5QYWdlKHZpZGVvSW5mbywgaW5mbywgMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3IgKGkgPSA2OyBpIDwgODsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbaV07CiAgICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgICBwYXJlbnQgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3Mobm9kZSwgJ3NwLXZpZGVvX19pdGVtLXBhZ2UtbmV3X192aWRlby1jb250ZW50Jyk7CiAgICAgICAgICAgICAgICAgIGluZm8gPSBwYXJlbnQgJiYgcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5zcC12aWRlb19faXRlbS1wYWdlLW5ld19faW5mb19fYWRkaXRpb25hbCcpOwogICAgICAgICAgICAgICAgICB2aWRlb0luZm8gPSBwYXJlbnQgJiYgdmlkZW8uZ2V0VmlkZW9Db250ZW50VmlkZW9JZChwYXJlbnQpOwogICAgICAgICAgICAgICAgICBpZiAoIWluZm8gfHwgIXZpZGVvSW5mbykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2aWRlby5pbnNlcnRCdG5JblBhZ2UodmlkZW9JbmZvLCBpbmZvLCAyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFswXTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5yZW1vdmVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIG1vbm8ub25SZW1vdmVMaXN0ZW5lcihub2RlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHF1ZXJpZXM6IFt7CiAgICAgICAgICAgICAgY3NzOiAnLmpwX190cmFjaycsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5zb25nLWl0ZW0nLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuYi12aWRlb19fbGVmdCAuYi12aWRlb19fY29udGFpbmVyIG9iamVjdCcsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5iLXZpZGVvX19sZWZ0IC5iLXZpZGVvX19jb250YWluZXIgdmlkZW8nLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuc3AtdmlkZW9fX2l0ZW0tcGFnZSAuc3AtdmlkZW9fX2l0ZW0tcGFnZV9fdmlkZW8td3JhcHBlciBvYmplY3QnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuc3AtdmlkZW9fX2l0ZW0tcGFnZSAuc3AtdmlkZW9fX2l0ZW0tcGFnZV9fdmlkZW8td3JhcHBlciB2aWRlbycsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5zcC12aWRlb19faXRlbS1wYWdlLW5ldyAuc3AtdmlkZW9fX2l0ZW0tcGFnZS1uZXdfX3ZpZGVvLWNvbnRlbnQgdmlkZW8nLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuc3AtdmlkZW9fX2l0ZW0tcGFnZS1uZXcgLnNwLXZpZGVvX19pdGVtLXBhZ2UtbmV3X192aWRlby1jb250ZW50IG9iamVjdCcsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy4nICsgbW9uby5vblJlbW92ZUNsYXNzTmFtZSwKICAgICAgICAgICAgICBpczogJ3JlbW92ZWQnCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIHRvb2x0aXAgPSB7CiAgICAgIHRvb2x0aXA6IHVuZGVmaW5lZCwKICAgICAgdXBkYXRlUG9zOiBmdW5jdGlvbihidXR0b24sIG9wdGlvbnMpIHsKICAgICAgICB2YXIgYnRuUG9zaXRpb24gPSBTYXZlRnJvbV9VdGlscy5nZXRQb3NpdGlvbihidXR0b24pOwogICAgICAgIHZhciBzaXplID0gU2F2ZUZyb21fVXRpbHMuZ2V0U2l6ZSh0aGlzLnRvb2x0aXApOwoKICAgICAgICB0aGlzLnRvb2x0aXAuc3R5bGUudG9wID0gKGJ0blBvc2l0aW9uLnRvcCArIG9wdGlvbnMudG9wIC0gc2l6ZS5oZWlnaHQpICsgJ3B4JzsKCiAgICAgICAgdmFyIGxlZnQgPSBidG5Qb3NpdGlvbi5sZWZ0ICsgcGFyc2VJbnQob3B0aW9ucy53aWR0aCAvIDIpIC0gcGFyc2VJbnQoc2l6ZS53aWR0aCAvIDIpOwogICAgICAgIHZhciBwYWdlV2lkdGggPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoICsgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0OwogICAgICAgIGlmIChwYWdlV2lkdGggPCBsZWZ0ICsgc2l6ZS53aWR0aCkgewogICAgICAgICAgbGVmdCA9IHBhZ2VXaWR0aCAtIHNpemUud2lkdGg7CiAgICAgICAgfQogICAgICAgIHRoaXMudG9vbHRpcC5zdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7CiAgICAgIH0sCiAgICAgIHNob3c6IGZ1bmN0aW9uKGJ1dHRvbiwgb3B0aW9ucykgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgaWYgKHRoaXMudG9vbHRpcCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy50b29sdGlwID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgY2xhc3M6ICdzZi10b29sdGlwJywKICAgICAgICAgICAgc3R5bGU6IG1vbm8uZXh0ZW5kKHsKICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsCiAgICAgICAgICAgICAgekluZGV4OiA5OTk5LAogICAgICAgICAgICAgIG9wYWNpdHk6IDAsCiAgICAgICAgICAgICAgdHJhbnNpdGlvbjogJ29wYWNpdHkgMC4ycycsCiAgICAgICAgICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcsCiAgICAgICAgICAgICAgZm9udFNpemU6ICcxMnB4JywKICAgICAgICAgICAgICBjb2xvcjogJyMxMTEnLAogICAgICAgICAgICAgIGZvbnRGYW1pbHk6ICdhcmlhbCwgdmVyZGFuYSwgc2Fucy1zZXJpZiwgTHVjaWRhIFNhbnMnCiAgICAgICAgICAgIH0sIG9wdGlvbnMuc3R5bGUpLAogICAgICAgICAgICBvbjogWydtb3VzZWVudGVyJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIF90aGlzLmhpZGUoKTsKICAgICAgICAgICAgfV0KICAgICAgICAgIH0pOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnRvb2x0aXApOwogICAgICAgIH0KICAgICAgICB0aGlzLnRvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICBfdGhpcy51cGRhdGVQb3MoYnV0dG9uLCBvcHRpb25zKTsKICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUub3BhY2l0eSA9IDE7CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0aGlzLnRvb2x0aXA7CiAgICAgIH0sCiAgICAgIGhpZGU6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMudG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gMDsKICAgICAgICB0aGlzLnRvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgfQogICAgfTsKCiAgICB2YXIgZ2V0Rm9sZGVyTmFtZSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgZm9sZGVyTmFtZSA9IGRvY3VtZW50LnRpdGxlOwogICAgICB2YXIgc2VwID0gZm9sZGVyTmFtZS5pbmRleE9mKCctJyk7CiAgICAgIGlmIChzZXAgIT09IC0xKSB7CiAgICAgICAgZm9sZGVyTmFtZSA9IGZvbGRlck5hbWUuc3Vic3RyKDAsIHNlcCAtIDEpOwogICAgICB9CgogICAgICByZXR1cm4gbW9uby5maWxlTmFtZS5tb2RpZnkoZm9sZGVyTmFtZSk7CiAgICB9OwoKICAgIHZhciBhdWRpbyA9IHsKICAgICAgY2xhc3NOYW1lOiAnc2YtYXVkaW8tcGFuZWwnLAogICAgICBsYXN0Um93OiBudWxsLAogICAgICBzdHlsZTogdW5kZWZpbmVkLAogICAgICBzZWNvbmRzRnJvbUR1cmF0aW9uOiBmdW5jdGlvbih0aW1lKSB7CiAgICAgICAgdmFyIG1pblNlYyA9IHRpbWUuc3BsaXQoJzonKS5tYXAoZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGl0ZW0pOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBtaW5TZWNbMF0gKiA2MCArIG1pblNlY1sxXTsKICAgICAgfSwKICAgICAgZ2V0VGl0bGU6IGZ1bmN0aW9uKHJvdykgewogICAgICAgIHZhciB0aXRsZSA9IHJvdy5xdWVyeVNlbGVjdG9yKCcuanBfX3RyYWNrLWZ1bGxuYW1lJyk7CiAgICAgICAgdmFyIGFydGlzdCA9IHJvdy5xdWVyeVNlbGVjdG9yKCcuanBfX3RyYWNrLXBlcmZvcm1lcicpOwogICAgICAgIGlmIChhcnRpc3QgPT09IG51bGwpIHsKICAgICAgICAgIGFydGlzdCA9IHJvdy5xdWVyeVNlbGVjdG9yKCcuanBfX3RyYWNrLW5hbWUtdGV4dCcpOwogICAgICAgICAgaWYgKGFydGlzdCAhPT0gbnVsbCkgewogICAgICAgICAgICBhcnRpc3QgPSBhcnRpc3QucXVlcnlTZWxlY3RvcignYTpub3QoLmpwX190cmFjay1mdWxsbmFtZSknKTsKICAgICAgICAgICAgaWYgKGFydGlzdCAhPT0gbnVsbCkgewogICAgICAgICAgICAgIHZhciB0bXAgPSB0aXRsZTsKICAgICAgICAgICAgICB0aXRsZSA9IGFydGlzdDsKICAgICAgICAgICAgICBhcnRpc3QgPSB0bXA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGFydGlzdCAhPT0gbnVsbCkgewogICAgICAgICAgYXJ0aXN0ID0gYXJ0aXN0LnRleHRDb250ZW50LnRyaW0oKTsKICAgICAgICAgIGlmICghYXJ0aXN0KSB7CiAgICAgICAgICAgIGFydGlzdCA9ICdub25hbWUnOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhcnRpc3QgPSAnJzsKICAgICAgICB9CiAgICAgICAgaWYgKGFydGlzdCkgewogICAgICAgICAgYXJ0aXN0ID0gYXJ0aXN0ICsgJyAtICc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFydGlzdCA9ICcnOwogICAgICAgIH0KICAgICAgICBpZiAodGl0bGUgPT09IG51bGwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGl0bGUgPSB0aXRsZS50ZXh0Q29udGVudDsKICAgICAgICB2YXIgZnVsbE5hbWUgPSBhcnRpc3QgKyB0aXRsZTsKICAgICAgICBmdWxsTmFtZSA9IGZ1bGxOYW1lLnJlcGxhY2UoL1tcclxuXHRcc10rL2ltZywgJyAnKS5yZXBsYWNlKC9ccysvZywgJyAnKS50cmltKCk7CiAgICAgICAgcmV0dXJuIGZ1bGxOYW1lOwogICAgICB9LAogICAgICBnZXRUaXRsZTI6IGZ1bmN0aW9uKHJvdykgewogICAgICAgIHZhciB0aXRsZSA9IHJvdy5xdWVyeVNlbGVjdG9yKCcudGl0bGUnKTsKICAgICAgICB2YXIgbmFtZSA9IHJvdy5xdWVyeVNlbGVjdG9yKCcubmFtZScpOwogICAgICAgIHZhciBhdXRob3IgPSByb3cucXVlcnlTZWxlY3RvcignLmF1dGhvcicpOwogICAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgICBuYW1lID0gbmFtZS50ZXh0Q29udGVudDsKICAgICAgICAgIGlmICghbmFtZS5sZW5ndGgpIHsKICAgICAgICAgICAgbmFtZSA9ICdub25hbWUnOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoYXV0aG9yKSB7CiAgICAgICAgICBhdXRob3IgPSBhdXRob3IudGV4dENvbnRlbnQ7CiAgICAgICAgfQogICAgICAgIHZhciBmdWxsTmFtZSA9ICcnOwogICAgICAgIGlmIChuYW1lICYmIGF1dGhvcikgewogICAgICAgICAgZnVsbE5hbWUgPSBhdXRob3IgKyAnIC0gJyArIG5hbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZ1bGxOYW1lID0gdGl0bGUudGV4dENvbnRlbnQ7CiAgICAgICAgfQogICAgICAgIGZ1bGxOYW1lID0gZnVsbE5hbWUucmVwbGFjZSgvW1xyXG5cdFxzXSsvaW1nLCAnICcpLnJlcGxhY2UoL1xzKy9nLCAnICcpLnRyaW0oKTsKICAgICAgICByZXR1cm4gZnVsbE5hbWU7CiAgICAgIH0sCiAgICAgIGdldE1wM1VybExpc3Q6IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgdmFyIHR5cGUgPSAxOwogICAgICAgIHZhciByb3dMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNvbmctaXRlbScpOwogICAgICAgIGlmIChyb3dMaXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcm93TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5qcF9fdHJhY2snKTsKICAgICAgICAgIHR5cGUgPSAwOwogICAgICAgIH0KICAgICAgICB2YXIgd2FpdENvdW50ID0gcm93TGlzdC5sZW5ndGg7CiAgICAgICAgdmFyIHJlYWR5Q291bnQgPSAwOwogICAgICAgIHZhciB1cmxMaXN0ID0gW107CiAgICAgICAgdmFyIGRibExpc3QgPSB7fTsKICAgICAgICB2YXIgaXNSZWFkeSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHdhaXRDb3VudCA9PT0gcmVhZHlDb3VudCkgewogICAgICAgICAgICBjYih1cmxMaXN0KTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGlmICh3YWl0Q291bnQgPT09IHJlYWR5Q291bnQpIHsKICAgICAgICAgIHJldHVybiBpc1JlYWR5KCk7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwLCByb3c7IHJvdyA9IHJvd0xpc3RbaV07IGkrKykgewogICAgICAgICAgYXVkaW8uZ2V0VXJsKHJvdywgdHlwZSwgZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICAgIHJlYWR5Q291bnQrKzsKICAgICAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgICAgICByZXR1cm4gaXNSZWFkeSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkYmxMaXN0W3VybF0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXNSZWFkeSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRibExpc3RbdXJsXSA9IDE7CgogICAgICAgICAgICB2YXIgZHVyYXRpb25Ob2RlOwogICAgICAgICAgICB2YXIgZnVsbFRpdGxlOwogICAgICAgICAgICBpZiAodHlwZSA9PT0gMCkgewogICAgICAgICAgICAgIGR1cmF0aW9uTm9kZSA9IHJvdy5xdWVyeVNlbGVjdG9yKCcuanBfX3RyYWNrLWR1cmF0aW9uLXRvdGFsJyk7CiAgICAgICAgICAgICAgZnVsbFRpdGxlID0gYXVkaW8uZ2V0VGl0bGUocm93KTsKICAgICAgICAgICAgICBpZiAoIWZ1bGxUaXRsZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGlzUmVhZHkoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZHVyYXRpb25Ob2RlID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy50aW1lJyk7CiAgICAgICAgICAgICAgZnVsbFRpdGxlID0gYXVkaW8uZ2V0VGl0bGUyKHJvdyk7CiAgICAgICAgICAgICAgaWYgKCFmdWxsVGl0bGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpc1JlYWR5KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IG1vbm8uZmlsZU5hbWUubW9kaWZ5KGZ1bGxUaXRsZSkgKyAnLm1wMyc7CiAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IGR1cmF0aW9uTm9kZSAmJiBhdWRpby5zZWNvbmRzRnJvbUR1cmF0aW9uKGR1cmF0aW9uTm9kZS50ZXh0Q29udGVudCk7CiAgICAgICAgICAgIHVybExpc3QucHVzaCh7CiAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgZmlsZW5hbWU6IGZpbGVuYW1lLAogICAgICAgICAgICAgIHRpdGxlOiBmdWxsVGl0bGUsCiAgICAgICAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpc1JlYWR5KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNob3dMaXN0T2ZBdWRpb0ZpbGVzOiBmdW5jdGlvbihpc1BsYXlsaXN0KSB7CiAgICAgICAgYXVkaW8uZ2V0TXAzVXJsTGlzdChmdW5jdGlvbihsaXN0KSB7CiAgICAgICAgICBpZiAobGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzUGxheWxpc3QpIHsKICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMucGxheWxpc3QucG9wdXBQbGF5bGlzdChsaXN0LCBnZXRGb2xkZXJOYW1lKCksIHRydWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMucGxheWxpc3QucG9wdXBGaWxlbGlzdChsaXN0KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZG93bmxvYWRNUDNGaWxlczogZnVuY3Rpb24oKSB7CiAgICAgICAgYXVkaW8uZ2V0TXAzVXJsTGlzdChmdW5jdGlvbihsaXN0KSB7CiAgICAgICAgICBpZiAobGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRMaXN0LnNob3dCZWZvcmVEb3dubG9hZFBvcHVwKGxpc3QsIHsKICAgICAgICAgICAgdHlwZTogJ2F1ZGlvJywKICAgICAgICAgICAgZm9sZGVyTmFtZTogZ2V0Rm9sZGVyTmFtZSgpCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgb25EbEJ0bk92ZXI6IGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAobW9uby5pc09wZXJhIHx8IG1vbm8uaXNTYWZhcmkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGR1cmF0aW9uID0gdGhpcy5kYXRhc2V0LmR1cmF0aW9uOwogICAgICAgIGlmIChlLnR5cGUgPT09ICdtb3VzZWVudGVyJykgewogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgIHZhciBvcHRpb25zID0gdW5kZWZpbmVkOwogICAgICAgICAgdmFyIHR0cCA9IHRvb2x0aXAuc2hvdyhfdGhpcywgb3B0aW9ucyA9IHsKICAgICAgICAgICAgdG9wOiAtMTQsCiAgICAgICAgICAgIHdpZHRoOiAxNiwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmJywKICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI2NjYycsCiAgICAgICAgICAgICAgY29sb3I6ICdyZ2IoNDgsIDQ4LCA0OCknCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChfdGhpcy5kYXRhc2V0LmJpdHJhdGUpIHsKICAgICAgICAgICAgdHRwLnN0eWxlLnBhZGRpbmcgPSAnMnB4IDVweCAzcHgnOwogICAgICAgICAgICB0dHAudGV4dENvbnRlbnQgPSAnICgnICsgX3RoaXMuZGF0YXNldC5zaXplICsgJyB+ICcgKyBfdGhpcy5kYXRhc2V0LmJpdHJhdGUgKyAnKSc7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX3RoaXMuZGF0YXNldC5zaXplKSB7CiAgICAgICAgICAgIHR0cC5zdHlsZS5wYWRkaW5nID0gJzJweCA1cHggM3B4JzsKICAgICAgICAgICAgdHRwLnRleHRDb250ZW50ID0gJyAoJyArIF90aGlzLmRhdGFzZXQuc2l6ZSArICcpJzsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHR0cC5zdHlsZS5wYWRkaW5nID0gJzJweCAycHggMCAycHgnOwogICAgICAgICAgdHRwLnRleHRDb250ZW50ID0gJyc7CiAgICAgICAgICB0dHAuYXBwZW5kQ2hpbGQobW9uby5jcmVhdGUoJ2ltZycsIHsKICAgICAgICAgICAgc3JjOiAnLy9teTkuaW1nc21haWwucnUvci9teS9wcmVsb2FkZXJfY2lyY2xlXzE2LmdpZicsCiAgICAgICAgICAgIGhlaWdodDogMTYsCiAgICAgICAgICAgIHdpZHRoOiAxNgogICAgICAgICAgfSkpOwoKICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICBhY3Rpb246ICdnZXRGaWxlU2l6ZScsCiAgICAgICAgICAgIHVybDogX3RoaXMuaHJlZgogICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgdHRwLnN0eWxlLnBhZGRpbmcgPSAnMnB4IDVweCAzcHgnOwogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmZpbGVTaXplKSB7CiAgICAgICAgICAgICAgdHRwLnRleHRDb250ZW50ID0gbGFuZ3VhZ2UuZ2V0RmlsZVNpemVGYWlsVGl0bGU7CiAgICAgICAgICAgICAgdG9vbHRpcC51cGRhdGVQb3MoX3RoaXMsIG9wdGlvbnMpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgc2l6ZSA9IFNhdmVGcm9tX1V0aWxzLnNpemVIdW1hbihyZXNwb25zZS5maWxlU2l6ZSwgMik7CgogICAgICAgICAgICBpZiAoZHVyYXRpb24pIHsKICAgICAgICAgICAgICB2YXIgYml0cmF0ZSA9IE1hdGguZmxvb3IoKHJlc3BvbnNlLmZpbGVTaXplIC8gZHVyYXRpb24pIC8gMTI1KSArICcgJyArIGxhbmd1YWdlLmticHM7CgogICAgICAgICAgICAgIF90aGlzLmRhdGFzZXQuYml0cmF0ZSA9IGJpdHJhdGU7CiAgICAgICAgICAgICAgX3RoaXMuZGF0YXNldC5zaXplID0gc2l6ZTsKCiAgICAgICAgICAgICAgdHRwLnRleHRDb250ZW50ID0gJyAoJyArIHNpemUgKyAnIH4gJyArIGJpdHJhdGUgKyAnKSc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMuZGF0YXNldC5zaXplID0gc2l6ZTsKCiAgICAgICAgICAgICAgdHRwLnRleHRDb250ZW50ID0gJyAoJyArIHNpemUgKyAnKSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRvb2x0aXAudXBkYXRlUG9zKF90aGlzLCBvcHRpb25zKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyBtb3VzZWxlYXZlCiAgICAgICAgdG9vbHRpcC5oaWRlKCk7CiAgICAgIH0sCiAgICAgIGdldFVybFZpYUJyaWRnZTogZnVuY3Rpb24ocm93LCBjYikgewogICAgICAgIGlmIChhdWRpby5nZXRVcmxWaWFCcmlkZ2UuaW5kZXggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgYXVkaW8uZ2V0VXJsVmlhQnJpZGdlLmluZGV4ID0gMDsKICAgICAgICB9CgogICAgICAgIHZhciBjbGFzc05hbWUgPSAnc2YtYnJpZGdlLWl0ZW0tJyArIGF1ZGlvLmdldFVybFZpYUJyaWRnZS5pbmRleDsKICAgICAgICBhdWRpby5nZXRVcmxWaWFCcmlkZ2UuaW5kZXgrKzsKICAgICAgICByb3cuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpOwoKICAgICAgICBTYXZlRnJvbV9VdGlscy5icmlkZ2UoewogICAgICAgICAgYXJnczogW3sKICAgICAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWUKICAgICAgICAgIH1dLAogICAgICAgICAgZnVuYzogZnVuY3Rpb24oZGF0YSwgY2IpIHsKICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IGRhdGEuY2xhc3NOYW1lOwogICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSlbMF07CiAgICAgICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTsKCiAgICAgICAgICAgIHZhciAkZGF0YSA9IGpRdWVyeShlbCkuZGF0YSgpOwogICAgICAgICAgICBpZiAoJGRhdGEgJiYgJGRhdGEuaXRlbSkgewogICAgICAgICAgICAgIGNiKCRkYXRhLml0ZW0udXJsKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGNiOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgIGNiKGRhdGEpOwogICAgICAgICAgfSwKICAgICAgICAgIHRpbWVvdXQ6IDMwMAogICAgICAgIH0pOwogICAgICB9LAogICAgICBnZXRVcmw6IGZ1bmN0aW9uKHJvdywgcm93VHlwZSwgY2IpIHsKICAgICAgICB2YXIgdXJsID0gcm93LmRhdGFzZXQudXJsOwogICAgICAgIGlmICh1cmwpIHsKICAgICAgICAgIHJldHVybiBjYih1cmwpOwogICAgICAgIH0KICAgICAgICBpZiAocm93VHlwZSA9PT0gMCkgewogICAgICAgICAgdmFyIHVybExpbmsgPSByb3cucXVlcnlTZWxlY3RvcignYS5qcF9fdHJhY2stZnVsbG5hbWUtbGluaycpOwogICAgICAgICAgaWYgKHVybExpbmsgPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICB9CiAgICAgICAgICB1cmxMaW5rID0gdXJsTGluay5ocmVmOwogICAgICAgICAgdmFyIHBhcmFtcyA9IG1vbm8ucGFyc2VVcmwodXJsTGluayk7CiAgICAgICAgICBpZiAoIXBhcmFtcy5maWxlIHx8ICFwYXJhbXMudWlkKSB7CiAgICAgICAgICAgIHJldHVybiBhdWRpby5nZXRVcmxWaWFCcmlkZ2Uocm93LCBmdW5jdGlvbih1cmwpIHsKICAgICAgICAgICAgICBpZiAodXJsKSB7CiAgICAgICAgICAgICAgICByb3cuZGF0YXNldC51cmwgPSB1cmw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNiKHVybCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGNiKCdodHRwOi8vbXVzaWMubXkubWFpbC5ydS9maWxlLycgKyBwYXJhbXMuZmlsZSArICcubXAzP3U9JyArIGVuY29kZVVSSUNvbXBvbmVudChwYXJhbXMudWlkKSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHJvd1R5cGUgPT09IDEpIHsKICAgICAgICAgIGlmIChyb3cuZGF0YXNldC5maWxlKSB7CiAgICAgICAgICAgIHJldHVybiBjYignaHR0cDovL211c2ljLm15Lm1haWwucnUvZmlsZS8nICsgcm93LmRhdGFzZXQuZmlsZSArICcubXAzJyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9uRGxCdG5DbGljazogZnVuY3Rpb24oZSkgewogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRPbkNsaWNrKGUpOwoKICAgICAgICBpZiAoWzFdLmluZGV4T2YocHJlZmVyZW5jZS5jb2hvcnRJbmRleCkgIT09IC0xKSB7CiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICBlYzogJ215Lm1haWwucnUnLAogICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgZWw6ICdtdXNpYy1hdWRpbycKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZ2V0RGxMaW5rOiBmdW5jdGlvbih1cmwsIGR1cmF0aW9uLCBmdWxsVGl0bGUpIHsKICAgICAgICByZXR1cm4gbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbiB8fCAnJwogICAgICAgICAgfSwKICAgICAgICAgIGhyZWY6IHVybCwKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLAogICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgd2lkdGg6ICcxNnB4JywKICAgICAgICAgICAgaGVpZ2h0OiAnMTZweCcsCiAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICdtaWRkbGUnCiAgICAgICAgICB9LAogICAgICAgICAgZG93bmxvYWQ6IG1vbm8uZmlsZU5hbWUubW9kaWZ5KGZ1bGxUaXRsZSArICcubXAzJyksCiAgICAgICAgICBvbjogWwogICAgICAgICAgICBbJ21vdXNlZW50ZXInLCBhdWRpby5vbkRsQnRuT3Zlcl0sCiAgICAgICAgICAgIFsnbW91c2VsZWF2ZScsIGF1ZGlvLm9uRGxCdG5PdmVyXSwKICAgICAgICAgICAgWydjbGljaycsIHRoaXMub25EbEJ0bkNsaWNrXQogICAgICAgICAgXQogICAgICAgIH0pOwogICAgICB9LAogICAgICBhZGREb3dubG9hZFBhbmVsTmV3OiBmdW5jdGlvbihyb3csIHVybCkgewogICAgICAgIGlmICghdXJsKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBmdWxsVGl0bGUgPSBhdWRpby5nZXRUaXRsZTIocm93KTsKICAgICAgICBpZiAoIWZ1bGxUaXRsZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgdGltZUVsID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy50aW1lJyk7CiAgICAgICAgdmFyIGR1cmF0aW9uID0gdGltZUVsICYmIGF1ZGlvLnNlY29uZHNGcm9tRHVyYXRpb24odGltZUVsLnRleHRDb250ZW50KTsKCiAgICAgICAgdmFyIGRsUGFuZWwgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgY2xhc3M6IFthdWRpby5jbGFzc05hbWUsICd0eXBlLTInXSwKICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICB0aGlzLmdldERsTGluayh1cmwsIGR1cmF0aW9uLCBmdWxsVGl0bGUpCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIHZhciBpY29uc0VsID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5pY29ucycpOwogICAgICAgIGlmIChpY29uc0VsKSB7CiAgICAgICAgICBpY29uc0VsLmFwcGVuZENoaWxkKGRsUGFuZWwpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYWRkRG93bmxvYWRQYW5lbDogZnVuY3Rpb24ocm93LCB1cmwpIHsKICAgICAgICB2YXIgZHVyYXRpb24gPSByb3cucXVlcnlTZWxlY3RvcignLmpwX190cmFjay1kdXJhdGlvbi10b3RhbCcpOwogICAgICAgIGlmIChkdXJhdGlvbiA9PT0gbnVsbCB8fCB1cmwgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgZnVsbFRpdGxlID0gYXVkaW8uZ2V0VGl0bGUocm93KTsKICAgICAgICBpZiAoIWZ1bGxUaXRsZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBkdXJhdGlvbiA9IGF1ZGlvLnNlY29uZHNGcm9tRHVyYXRpb24oZHVyYXRpb24udGV4dENvbnRlbnQpOwoKICAgICAgICB2YXIgZGxQYW5lbCA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICBjbGFzczogW2F1ZGlvLmNsYXNzTmFtZSwgJ3R5cGUtMCddLAogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIHRoaXMuZ2V0RGxMaW5rKHVybCwgZHVyYXRpb24sIGZ1bGxUaXRsZSkKICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHJvdy5xdWVyeVNlbGVjdG9yKCcuanBfX3RyYWNrLW1hbmFnZW1lbnQnKTsKICAgICAgICBpZiAoIWNvbnRhaW5lcikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbnRhaW5lci5maXJzdENoaWxkKSB7CiAgICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGRsUGFuZWwsIGNvbnRhaW5lci5maXJzdENoaWxkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRsUGFuZWwpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgb25UcmFja092ZXI6IGZ1bmN0aW9uKHJvdywgcm93VHlwZSkgewogICAgICAgIGlmIChyb3cuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShhdWRpby5jbGFzc05hbWUpLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgYXVkaW8uZ2V0VXJsKHJvdywgcm93VHlwZSwgZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICBpZiAocm93VHlwZSA9PT0gMSkgewogICAgICAgICAgICBhdWRpby5hZGREb3dubG9hZFBhbmVsTmV3KHJvdywgdXJsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGF1ZGlvLmFkZERvd25sb2FkUGFuZWwocm93LCB1cmwpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LAogICAgICBpbmplY3RTdHlsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMuc3R5bGUpIHsKICAgICAgICAgIGlmICghdGhpcy5zdHlsZS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLnN0eWxlID0gbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KFt7CiAgICAgICAgICAgIHNlbGVjdG9yOiAnLicgKyB0aGlzLmNsYXNzTmFtZSwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsCiAgICAgICAgICAgICAgbGVmdDogJzIycHgnLAogICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJ3VybCgnICsgU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnIzE2OERFMicpICsgJyknLAogICAgICAgICAgICAgIGJhY2tncm91bmRSZXBlYXQ6ICduby1yZXBlYXQnLAogICAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogJ2NlbnRlcicsCiAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxNnB4JwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHNlbGVjdG9yOiAnLmpwX190cmFjazpob3ZlciAuJyArIHRoaXMuY2xhc3NOYW1lLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsCiAgICAgICAgICAgICAgb3BhY2l0eTogMC41CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgc2VsZWN0b3I6ICcuanBfX3RyYWNrOmhvdmVyIC4nICsgdGhpcy5jbGFzc05hbWUgKyAnLnR5cGUtMCcsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJy0xNnB4JywKICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgICAgICBsZWZ0OiAnLTJweCcKICAgICAgICAgICAgfQogICAgICAgICAgfSwgewogICAgICAgICAgICBzZWxlY3RvcjogJy5qcF9fdHJhY2suanBfX3RyYWNrLXBsYXlzIC4nICsgdGhpcy5jbGFzc05hbWUsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgbGVmdDogJy0xOHB4JwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHNlbGVjdG9yOiAnLicgKyB0aGlzLmNsYXNzTmFtZSArICc6aG92ZXInLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIG9wYWNpdHk6ICcxICFpbXBvcnRhbnQnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgc2VsZWN0b3I6ICcuJyArIHRoaXMuY2xhc3NOYW1lICsgJy50eXBlLTInLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIG1hcmdpblJpZ2h0OiAnNXB4JywKICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAnNXB4JwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHNlbGVjdG9yOiAnLnNvbmctaXRlbTpob3ZlciAuJyArIHRoaXMuY2xhc3NOYW1lICsgJy50eXBlLTInLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgIG9wYWNpdHk6IDAuNQogICAgICAgICAgICB9CiAgICAgICAgICB9XSkKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCh0aGlzLnN0eWxlKTsKICAgICAgfSwKICAgICAgcm1CdG46IGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChhdWRpby5zdHlsZSkgewogICAgICAgICAgYXVkaW8uc3R5bGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhdWRpby5zdHlsZSk7CiAgICAgICAgICBhdWRpby5zdHlsZSA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgdmFyIGJ0bkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGF1ZGlvLmNsYXNzTmFtZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBidG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgIGl0ZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpdGVtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIHZpZGVvID0gewogICAgICBidG5JbmRleDogMCwKICAgICAgZG9tQ2FjaGU6IHt9LAogICAgICBjbGFzc05hbWU6ICdzZi12aWRlby1idG4nLAoKICAgICAgcHJlcGFyZUxpbmtzOiBmdW5jdGlvbihsaW5rcykgewogICAgICAgIHZhciBtZW51TGlua3MgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGluazsgbGluayA9IGxpbmtzW2ldOyBpKyspIHsKICAgICAgICAgIHZhciB1cmwgPSBsaW5rLnVybDsKICAgICAgICAgIHZhciBmb3JtYXQgPSAnRkxWJzsKICAgICAgICAgIGlmICh1cmwuaW5kZXhPZignLm1wNCcpICE9PSAtMSkgewogICAgICAgICAgICBmb3JtYXQgPSAnTVA0JzsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh1cmwuaW5kZXhPZignLm1vdicpICE9PSAtMSkgewogICAgICAgICAgICBmb3JtYXQgPSAnTU9WJzsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh1cmwuaW5kZXhPZignLm1wZycpICE9PSAtMSkgewogICAgICAgICAgICBmb3JtYXQgPSAnTVBHJzsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghbGluay5xdWFsaXR5KSB7CiAgICAgICAgICAgIGxpbmsucXVhbGl0eSA9ICctPy0nOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHF1YWxpdHkgPSBsaW5rLnF1YWxpdHkudG9VcHBlckNhc2UoKTsKCiAgICAgICAgICB2YXIgcUxpc3QgPSBbJzEwODBQJywgJzcyMFAnLCAnNDgwUCcsICczNjBQJywgJzI3MlAnXTsKICAgICAgICAgIHZhciB0TGlzdCA9IFsnMTA4MCcsICc3MjAnLCAnNDgwJywgJzM2MCcsICcyNzInXTsKCiAgICAgICAgICB2YXIgcVBvcyA9IHFMaXN0LmluZGV4T2YocXVhbGl0eSk7CiAgICAgICAgICBpZiAocVBvcyAhPT0gLTEpIHsKICAgICAgICAgICAgcXVhbGl0eSA9IHRMaXN0W3FQb3NdOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBleHQgPSBmb3JtYXQudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIHZhciBwb3B1cExpbmsgPSB7CiAgICAgICAgICAgIGhyZWY6IHVybCwKICAgICAgICAgICAgdGl0bGU6IGxpbmsudGl0bGUsCiAgICAgICAgICAgIGV4dDogZXh0LAogICAgICAgICAgICBmb3JtYXQ6IGZvcm1hdCwKICAgICAgICAgICAgcXVhbGl0eTogcXVhbGl0eSwKICAgICAgICAgICAgZm9yY2VEb3dubG9hZDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICAgIG1lbnVMaW5rcy5wdXNoKHBvcHVwTGluayk7CiAgICAgICAgfQogICAgICAgIGlmIChtZW51TGlua3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJldHVybiBtZW51TGlua3M7CiAgICAgIH0sCgogICAgICBzaG93TGlua0xpc3Q6IGZ1bmN0aW9uKGxpbmtzLCBidXR0b24sIGlzVXBkYXRlKSB7CiAgICAgICAgaWYgKCFsaW5rcykgewogICAgICAgICAgbGlua3MgPSBsYW5ndWFnZS5ub0xpbmtzRm91bmQ7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNVcGRhdGUpIHsKICAgICAgICAgIGlmICghbWFpbHJ1LmNvbnRleHRNZW51KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIG1haWxydS5jb250ZXh0TWVudS51cGRhdGUobGlua3MpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1haWxydS5jb250ZXh0TWVudSAmJiBtYWlscnUuY29udGV4dE1lbnUuaXNTaG93KSB7CiAgICAgICAgICBtYWlscnUuaGlkZU1lbnUoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbWFpbHJ1LmNvbnRleHRNZW51ID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnF1aWNrSW5zZXJ0KGJ1dHRvbiwgbGlua3MsICd2aWRlby1saW5rcy1wb3B1cCcsIHsKICAgICAgICAgIHBhcmVudDogbW9uby5nZXRQYXJlbnRCeUNsYXNzKGJ1dHRvbiwgJ2ItdmlkZW9fX21haW4nKQogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgYXBwZW5kUGFnZUJ0bjogZnVuY3Rpb24oY29udGFpbmVyLCBidG5JbmRleCwgc3R5bGVJbmRleCkgewogICAgICAgIHZhciBleEJ0biA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuJyArIHZpZGVvLmNsYXNzTmFtZSk7CiAgICAgICAgaWYgKGV4QnRuICE9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgc3R5bGUgPSB7fTsKICAgICAgICBzdHlsZS5tYXJnaW5MZWZ0ID0gJzE1cHgnOwogICAgICAgIGlmIChzdHlsZUluZGV4ID09PSAyKSB7CiAgICAgICAgICBzdHlsZS5tYXJnaW5MZWZ0ID0gJzhweCc7CiAgICAgICAgfQoKICAgICAgICB2YXIgYnRuID0gbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICBjbGFzczogdmlkZW8uY2xhc3NOYW1lLAogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIGluZGV4OiBidG5JbmRleAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgIG1vbm8ub25SZW1vdmVFdmVudCh0aGlzLCBtYWlscnUuaGlkZU1lbnUpOwoKICAgICAgICAgICAgICAgIHZpZGVvLnJlYWREb21DYWNoZSh0aGlzLmRhdGFzZXQuaW5kZXgsIHRoaXMpOwoKICAgICAgICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICAgICAgZWM6ICdteS5tYWlsLnJ1JywKICAgICAgICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICAgICAgICBlbDogJ3ZpZGVvJwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICBzdHlsZTogc3R5bGUKICAgICAgICAgICAgfSkKICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKHN0eWxlSW5kZXggPT09IDEpIHsKICAgICAgICAgIHZhciBjaGlsZCA9IGNvbnRhaW5lci5sYXN0Q2hpbGQ7CiAgICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGJ0biwgY2hpbGQpOwogICAgICAgICAgY2hpbGQgPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgY2hpbGQgPSBjb250YWluZXIubGFzdENoaWxkOwogICAgICAgICAgaWYgKGNoaWxkLnByZXZpb3VzRWxlbWVudFNpYmxpbmcpIHsKICAgICAgICAgICAgY2hpbGQgPSBjaGlsZC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwogICAgICAgICAgfQogICAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShidG4sIGNoaWxkKTsKICAgICAgICAgIGNoaWxkID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBhcHBlbmRCdG46IGZ1bmN0aW9uKGNvbnRhaW5lciwgYnRuSW5kZXgpIHsKICAgICAgICB2YXIgZXhCdG4gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLicgKyB2aWRlby5jbGFzc05hbWUpOwogICAgICAgIGlmIChleEJ0biAhPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNoaWxkID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBzdHlsZSA9IHt9OwogICAgICAgIGlmIChjb250YWluZXIuY2hpbGROb2Rlcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBjaGlsZCA9IGNvbnRhaW5lci5jaGlsZE5vZGVzWzFdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjaGlsZCA9IGNvbnRhaW5lci5sYXN0Q2hpbGQ7CiAgICAgICAgICBzdHlsZS5tYXJnaW5SaWdodCA9ICc1cHgnOwogICAgICAgIH0KCiAgICAgICAgdmFyIGJ0biA9IG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgY2xhc3M6IGNvbnRhaW5lci5sYXN0Q2hpbGQuZ2V0QXR0cmlidXRlKCdjbGFzcycpICsgJyAnICsgdmlkZW8uY2xhc3NOYW1lLAogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIGluZGV4OiBidG5JbmRleAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgIG1vbm8ub25SZW1vdmVFdmVudCh0aGlzLCBtYWlscnUuaGlkZU1lbnUpOwoKICAgICAgICAgICAgICAgIHZpZGVvLnJlYWREb21DYWNoZSh0aGlzLmRhdGFzZXQuaW5kZXgsIHRoaXMpOwoKICAgICAgICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICAgICAgZWM6ICdteS5tYWlsLnJ1JywKICAgICAgICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICAgICAgICBlbDogJ3ZpZGVvJwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICBzdHlsZTogc3R5bGUKICAgICAgICAgICAgfSkKICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShidG4sIGNoaWxkKTsKICAgICAgICBjaGlsZCA9IG51bGw7CiAgICAgIH0sCgogICAgICByZWFkRG9tQ2FjaGU6IGZ1bmN0aW9uKGluZGV4LCBidXR0b24pIHsKICAgICAgICB2aWRlby5zaG93TGlua0xpc3QobGFuZ3VhZ2UuZG93bmxvYWQsIGJ1dHRvbik7CgogICAgICAgIHZhciBhYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmlkZW8uc2hvd0xpbmtMaXN0KHVuZGVmaW5lZCwgYnV0dG9uLCAxKQogICAgICAgIH07CgogICAgICAgIHZhciBzaG93TGlua3MgPSBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmFjdGlvbiA9PT0gJ2dldFJ1dHViZUxpbmtzJykgewogICAgICAgICAgICBpZiAoIXByZWZlcmVuY2Uuc2hvd1VtbXlJdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFib3J0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmlkZW8uc2hvd0xpbmtMaXN0KFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MucnV0dWJlKHJlc3BvbnNlLmxpbmtzKSwgYnV0dG9uLCAxKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKHJlc3BvbnNlLmFjdGlvbiA9PT0gJ2dldE1haWxydUxpbmtzJykgewogICAgICAgICAgICB2aWRlby5zaG93TGlua0xpc3QoU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rcy5tYWlscnUocmVzcG9uc2UubGlua3MsIHJlc3BvbnNlLnRpdGxlKSwgYnV0dG9uLCAxKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZpZGVvLnNob3dMaW5rTGlzdCh2aWRlby5wcmVwYXJlTGlua3MocmVzcG9uc2UubGlua3MpLCBidXR0b24sIDEpOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBjYWNoZUl0ZW0gPSB2aWRlby5kb21DYWNoZVtwYXJzZUludChpbmRleCldOwogICAgICAgIGlmIChjYWNoZUl0ZW0ubGlua3MpIHsKICAgICAgICAgIHNob3dMaW5rcyhjYWNoZUl0ZW0pOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChjYWNoZUl0ZW0ubWV0YWRhdGFVcmwpIHsKICAgICAgICAgIHZhciBtZXRhZGF0YVVybCA9IGNhY2hlSXRlbS5tZXRhZGF0YVVybDsKICAgICAgICAgIGlmICgvXlwvXC8vLnRlc3QobWV0YWRhdGFVcmwpKSB7CiAgICAgICAgICAgIG1ldGFkYXRhVXJsID0gJ2h0dHA6JyArIG1ldGFkYXRhVXJsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBhbHdheXMgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgIGlmICghZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICBhYm9ydCgpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICB2aWRlby5yZWFkTWV0YShkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5saW5rcykgewogICAgICAgICAgICAgICAgICBhYm9ydCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgY2FjaGVJdGVtLmxpbmtzID0gcmVzcG9uc2UubGlua3M7CiAgICAgICAgICAgICAgICAgIGNhY2hlSXRlbS5hY3Rpb24gPSByZXNwb25zZS5hY3Rpb247CgogICAgICAgICAgICAgICAgICBzaG93TGlua3MoY2FjaGVJdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgbW9uby5yZXF1ZXN0KHsKICAgICAgICAgICAgdXJsOiBtZXRhZGF0YVVybCwKICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlLAogICAgICAgICAgICBqc29uOiB0cnVlLAogICAgICAgICAgICBsb2NhbFhIUjogdHJ1ZQogICAgICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwKSB7CiAgICAgICAgICAgIGFsd2F5cyhlcnIgPyBudWxsIDogcmVzcC5ib2R5KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChjYWNoZUl0ZW0udXJsKSB7CiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAnZ2V0TWFpbHJ1TGlua3MnLAogICAgICAgICAgICBleHRWaWRlb0lkOiBjYWNoZUl0ZW0udXJsCiAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmxpbmtzKSB7CiAgICAgICAgICAgICAgYWJvcnQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjYWNoZUl0ZW0udGl0bGUgPSByZXNwb25zZS50aXRsZTsKICAgICAgICAgICAgICBjYWNoZUl0ZW0ubGlua3MgPSByZXNwb25zZS5saW5rczsKICAgICAgICAgICAgICBjYWNoZUl0ZW0uYWN0aW9uID0gcmVzcG9uc2UuYWN0aW9uOwoKICAgICAgICAgICAgICBzaG93TGlua3MoY2FjaGVJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFib3J0KCk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgcmVhZE1ldGE6IGZ1bmN0aW9uKG1ldGFkYXRhLCBjYikgewogICAgICAgIHZhciBsaW5rcyA9IFtdLAogICAgICAgICAgdGl0bGU7CiAgICAgICAgaWYgKG1ldGFkYXRhLnByb3ZpZGVyID09PSAnVVBMT0FERUQnKSB7CiAgICAgICAgICB0aXRsZSA9IG1ldGFkYXRhLm1vdmllID8gbWV0YWRhdGEubW92aWUudGl0bGUgOiB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAoIW1ldGFkYXRhLnZpZGVvcykgewogICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgIH0KICAgICAgICAgIG1ldGFkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgbGlua3MucHVzaCh7CiAgICAgICAgICAgICAgcXVhbGl0eTogaXRlbS5uYW1lLAogICAgICAgICAgICAgIHVybDogaXRlbS51cmwsCiAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChtZXRhZGF0YS5wcm92aWRlciA9PT0gJ3VnYycpIHsKICAgICAgICAgIHRpdGxlID0gbWV0YWRhdGEubWV0YSA/IG1ldGFkYXRhLm1ldGEudGl0bGUgOiB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAoIW1ldGFkYXRhLnZpZGVvcykgewogICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgIH0KICAgICAgICAgIG1ldGFkYXRhLnZpZGVvcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgbGlua3MucHVzaCh7CiAgICAgICAgICAgICAgcXVhbGl0eTogaXRlbS5rZXksCiAgICAgICAgICAgICAgdXJsOiBpdGVtLnVybCwKICAgICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKG1ldGFkYXRhLnByb3ZpZGVyID09PSAncGxhZGZvcm0nKSB7CiAgICAgICAgICB0aXRsZSA9IG1ldGFkYXRhLm1ldGEgPyBtZXRhZGF0YS5tZXRhLnRpdGxlIDogdW5kZWZpbmVkOwogICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFBsYWRmb3JtVmlkZW8nLAogICAgICAgICAgICBleHRWaWRlb0lkOiB7CiAgICAgICAgICAgICAgcGxheWVySWQ6IG1ldGFkYXRhLm1ldGEucGxheWVySWQsCiAgICAgICAgICAgICAgdmlkZW9JZDogbWV0YWRhdGEubWV0YS52aWRlb0lkCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UpIHsKICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGxpbmtzID0gcmVzcG9uc2UubGlua3M7CiAgICAgICAgICAgIGlmICghbGlua3MpIHsKICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGlua3MuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtICE9PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGl0ZW0udGl0bGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaXRlbS50aXRsZSA9IHRpdGxlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNiKHJlc3BvbnNlKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAobGlua3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNiKHsKICAgICAgICAgIGxpbmtzOiBsaW5rcwogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgZ2V0Rmxhc2hWYXJzOiBmdW5jdGlvbih2aWRlb09iaikgewogICAgICAgIGlmICghdmlkZW9PYmopIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBmbGFzaHZhcnMgPSB2aWRlb09iai5xdWVyeVNlbGVjdG9yKCdwYXJhbVtuYW1lPSJmbGFzaHZhcnMiXScpOwogICAgICAgIGlmICghZmxhc2h2YXJzKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgdmFsdWUgPSBmbGFzaHZhcnMudmFsdWU7CiAgICAgICAgdmFyIHVybCA9IG1vbm8ucGFyc2VVcmwodmFsdWUsIHsKICAgICAgICAgIHBhcmFtczogdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICBpZiAodXJsLm1ldGFkYXRhVXJsKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBtZXRhZGF0YVVybDogdXJsLm1ldGFkYXRhVXJsCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIG1hdGNoVXJsOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICB2YXIgbGlua1IgPSAvXC8oW15cL10rKVwvKFteXC9dKylcL3ZpZGVvXC8oLispLmh0bWwvOwogICAgICAgIHZhciBlbWJlZFIgPSAvZW1iZWRcLyhbXlwvXSspXC8oW15cL10rKVwvKC4rKS5odG1sLzsKCiAgICAgICAgdmFyIHIgPSB1cmwubWF0Y2gobGlua1IpOwogICAgICAgIGlmICghcikgewogICAgICAgICAgciA9IHVybC5tYXRjaChlbWJlZFIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHI7CiAgICAgIH0sCgogICAgICBnZXRWaWRlb0lkOiBmdW5jdGlvbihwbGF5ZXIpIHsKICAgICAgICBpZiAocGxheWVyLnRhZ05hbWUgIT09ICdPQkpFQ1QnKSB7CiAgICAgICAgICBwbGF5ZXIgPSBwbGF5ZXIucXVlcnlTZWxlY3Rvcignb2JqZWN0W25hbWU9ImItdmlkZW8tcGxheWVyIl0nKTsKICAgICAgICB9CgogICAgICAgIHZhciB2aWRlb09iaiA9IHRoaXMuZ2V0Rmxhc2hWYXJzKHBsYXllcik7CiAgICAgICAgaWYgKHZpZGVvT2JqKSB7CiAgICAgICAgICByZXR1cm4gdmlkZW9PYmo7CiAgICAgICAgfQoKICAgICAgICB2YXIgYWxidW1Kc29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtdHlwZT0iYWxidW0tanNvbiJdJyk7CiAgICAgICAgaWYgKGFsYnVtSnNvbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYWxidW1Kc29uID0gSlNPTi5wYXJzZShhbGJ1bUpzb24udGV4dENvbnRlbnQpOwogICAgICAgICAgICBpZiAoYWxidW1Kc29uLnNpZ25WaWRlb1VybCkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBtZXRhZGF0YVVybDogYWxidW1Kc29uLnNpZ25WaWRlb1VybAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgfQoKICAgICAgICB2YXIgdmlkZW9JZCA9IHRoaXMubWF0Y2hVcmwobG9jYXRpb24ucGF0aG5hbWUpOwoKICAgICAgICBpZiAodmlkZW9JZCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbWV0YWRhdGFVcmw6ICdodHRwOi8vYXBpLnZpZGVvLm1haWwucnUvdmlkZW9zLycgKyB2aWRlb0lkWzFdICsgJy8nICsgdmlkZW9JZFsyXSArICcvJyArIHZpZGVvSWRbM10gKyAnLmpzb24nCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGdldFZpZGVvQ29udGVudFZpZGVvSWQ6IGZ1bmN0aW9uKGNvbnRlaW5lcikgewogICAgICAgIHZhciB2aWRlb0lkID0gbnVsbDsKCiAgICAgICAgdmFyIHNoYXJlQnRuID0gY29udGVpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5zcC12aWRlb19faXRlbS1wYWdlLW5ld19fc2hhcmVfX2l0ZW1bZGF0YS1zaGFyZS10eXBlXVtkYXRhLWxvY2F0aW9uXScpOwogICAgICAgIGlmIChzaGFyZUJ0bikgewogICAgICAgICAgdmlkZW9JZCA9IHsKICAgICAgICAgICAgdXJsOiBzaGFyZUJ0bi5kYXRhc2V0LmxvY2F0aW9uCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZpZGVvSWQ7CiAgICAgIH0sCgogICAgICBpbnNlcnRCdG5JblBhZ2U6IGZ1bmN0aW9uKHZpZGVvSW5mbywgaW5mbywgc3R5bGVJbmRleCkgewogICAgICAgIGlmICh2aWRlb0luZm8ubWV0YWRhdGFVcmwpIHsKICAgICAgICAgIHZpZGVvSW5mby5tZXRhZGF0YVVybCA9IGRlY29kZVVSSUNvbXBvbmVudCh2aWRlb0luZm8ubWV0YWRhdGFVcmwpOwogICAgICAgICAgdmlkZW8uZG9tQ2FjaGVbdmlkZW8uYnRuSW5kZXhdID0gewogICAgICAgICAgICBtZXRhZGF0YVVybDogdmlkZW9JbmZvLm1ldGFkYXRhVXJsCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2aWRlby5kb21DYWNoZVt2aWRlby5idG5JbmRleF0gPSBtb25vLmV4dGVuZCh7fSwgdmlkZW9JbmZvKTsKICAgICAgICB9CgoKICAgICAgICB2aWRlby5hcHBlbmRQYWdlQnRuKGluZm8sIHZpZGVvLmJ0bkluZGV4LCBzdHlsZUluZGV4KTsKCiAgICAgICAgdmlkZW8uYnRuSW5kZXgrKzsKICAgICAgfSwKICAgICAgaW5zZXJ0QnRuSW5Qb3B1cDogZnVuY3Rpb24odmlkZW9JbmZvLCBpbmZvKSB7CiAgICAgICAgaWYgKHZpZGVvSW5mby5tZXRhZGF0YVVybCkgewogICAgICAgICAgdmlkZW9JbmZvLm1ldGFkYXRhVXJsID0gZGVjb2RlVVJJQ29tcG9uZW50KHZpZGVvSW5mby5tZXRhZGF0YVVybCk7CiAgICAgICAgICB2aWRlby5kb21DYWNoZVt2aWRlby5idG5JbmRleF0gPSB7CiAgICAgICAgICAgIG1ldGFkYXRhVXJsOiB2aWRlb0luZm8ubWV0YWRhdGFVcmwKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2aWRlby5hcHBlbmRCdG4oaW5mbywgdmlkZW8uYnRuSW5kZXgpOwoKICAgICAgICB2aWRlby5idG5JbmRleCsrOwogICAgICB9LAogICAgICBybUJ0bjogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGJ0bkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIHZpZGVvLmNsYXNzTmFtZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBidG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgIGl0ZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpdGVtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSwgbnVsbCwgZnVuY3Rpb24gc3luY0lzQWN0aXZlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vbXkubWFpbC5ydS8qJwogICAgICBdOwoKICAgICAgdmFyIHJlU3RyID0gbGlzdC5tYXAoZnVuY3Rpb24ocGF0dGVybikgewogICAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgICB9KS5qb2luKCd8Jyk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAocmVTdHIpOwoKICAgICAgaWYgKCFyZS50ZXN0KGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGlmIChtb25vLmlzSWZyYW1lKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgnc2F2ZWZyb20nLCBmdW5jdGlvbihtb2R1bGVOYW1lLCBpbml0RGF0YSkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIGxhbmd1YWdlID0gaW5pdERhdGEuZ2V0TGFuZ3VhZ2U7CiAgICB2YXIgcHJlZmVyZW5jZSA9IGluaXREYXRhLmdldFByZWZlcmVuY2U7CgogICAgbW9uby5hc3luY0NhbGwoZnVuY3Rpb24oKSB7CiAgICAgIHNhdmVmcm9tLnJ1bigpOwogICAgfSk7CgogICAgdmFyIGdldFJhbmRvbUludCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTsKICAgICAgdmFyIHJuZCA9IG5vdzsKICAgICAgd2hpbGUgKG5vdyA9PT0gcm5kKSB7CiAgICAgICAgcm5kID0gRGF0ZS5ub3coKTsKICAgICAgfQogICAgICByZXR1cm4gcm5kOwogICAgfTsKCiAgICB2YXIgc2F2ZWZyb20gPSB7CiAgICAgIG5hbWU6IG1vZHVsZU5hbWUsCiAgICAgIHNjcmlwdElkOiAnc2F2ZWZyb21fX2V4dF9zY3JpcHQnLAogICAgICBkYXRhQXR0cjogJ2RhdGEtZXh0ZW5zaW9uLWRpc2FibGVkJywKCgogICAgICBydW46IGZ1bmN0aW9uKCkgewogICAgICAgIHNhdmVmcm9tLnNldEV4dFBhcmFtcygpOwoKICAgICAgICBpZiAobG9jYXRpb24uaHJlZi5zZWFyY2goL1wvKHVwZGF0ZS1oZWxwZXJ8dXNlcmpzLXNldHVwKVwucGhwL2kpID4gLTEpIHsKICAgICAgICAgIHZhciBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanMtbm90LXJlbWluZCcpOwogICAgICAgICAgaWYgKGJ0bikgewogICAgICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgaWYgKGUuYnV0dG9uID09PSAwKSB7CiAgICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnaGlkZVVzZXJqc01pZ3JhdGlvbkluZm8nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ZfZm9ybScpOwogICAgICAgIGlmICghZm9ybSkKICAgICAgICAgIHJldHVybjsKCiAgICAgICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgdmFyIHVybCA9IGZvcm0uc2ZfdXJsLnZhbHVlOwogICAgICAgICAgaWYgKCF1cmwpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICBpZiAoZm9ybS5nZXRBdHRyaWJ1dGUoc2F2ZWZyb20uZGF0YUF0dHIpID09ICcxJykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgIHZhciByZSA9IHsKICAgICAgICAgICAgZ2V0VktMaW5rczogWwogICAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbYS16XStcLik/KD86dmtcLmNvbXx2a29udGFrdGVcLnJ1KVwvKHZpZGVvLT9cZCtfLT9cZCspL2ksCiAgICAgICAgICAgICAgL15odHRwcz86XC9cLyg/OlthLXpdK1wuKT8oPzp2a1wuY29tfHZrb250YWt0ZVwucnUpXC92aWRlb19leHQucGhwXD8oLipvaWQ9LT9cZCsuKikkL2ksCiAgICAgICAgICAgICAgL15odHRwcz86XC9cLyg/OlthLXpdK1wuKT8oPzp2a1wuY29tfHZrb250YWt0ZVwucnUpXC9bXHdcLVwuXStcPy4qej0odmlkZW8tP1xkK18tP1xkKykvaQogICAgICAgICAgICBdLAogICAgICAgICAgICBnZXRZb3V0dWJlTGlua3M6IFsKICAgICAgICAgICAgICAvXmh0dHBzPzpcL1wvKD86W2Etel0rXC4pP3lvdXR1YmVcLmNvbVwvKD86IyE/XC8pP3dhdGNoXD8uKnY9KFtcd1wtXSspL2ksCiAgICAgICAgICAgICAgL15odHRwcz86XC9cLyg/OlthLXowLTldK1wuKT95b3V0dWJlXC5jb21cLyg/OmVtYmVkfHYpXC8oW1x3XC1dKykvaSwKICAgICAgICAgICAgICAvXmh0dHBzPzpcL1wvKD86W2Etel0rXC4pP3lvdXR1XC5iZVwvKFtcd1wtXSspL2kKICAgICAgICAgICAgXSwKICAgICAgICAgICAgZ2V0VmltZW9MaW5rczogWwogICAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbXHdcLV0rXC4pP3ZpbWVvXC5jb21cLyg/Olx3K1wjKT8oXGQrKS9pLAogICAgICAgICAgICAgIC9eaHR0cHM/OlwvXC9wbGF5ZXJcLnZpbWVvXC5jb21cL3ZpZGVvXC8oXGQrKS9pLAogICAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbXHdcLV0rXC4pP3ZpbWVvXC5jb21cL2NoYW5uZWxzXC8oPzpbXlwvXSspXC8oXGQrKSQvaSwKICAgICAgICAgICAgICAvXmh0dHBzPzpcL1wvKD86W1x3XC1dK1wuKT92aW1lb1wuY29tXC9bXlwvXStcL3Jldmlld1wvKFxkKylcLyg/OlxkKykvaQogICAgICAgICAgICBdLAoKICAgICAgICAgICAgZ2V0RGFpbHltb3Rpb25MaW5rczogWwogICAgICAgICAgICAgIC9eaHR0cDpcL1wvKD86d3d3XC4pP2RhaVwubHlcLyhbYS16MC05XSspXz8vaSwKICAgICAgICAgICAgICAvXmh0dHBzPzpcL1wvKD86W1x3XStcLik/ZGFpbHltb3Rpb25cLmNvbSg/OlwvZW1iZWR8XC9zd2YpP1wvdmlkZW9cLyhbYS16MC05XSspXz8vaQogICAgICAgICAgICBdLAoKICAgICAgICAgICAgZ2V0RmFjZWJvb2tMaW5rczogWwogICAgICAgICAgICAgIC9eaHR0cHM/OlwvXC8oPzpbXHddK1wuKT9mYWNlYm9va1wuY29tKD86XC92aWRlbyk/XC92aWRlby5waHAuKls/Jl17MX12PShbMC05XSspLiovaSwKICAgICAgICAgICAgICAvXmh0dHBzPzpcL1wvKD86W1x3XStcLik/ZmFjZWJvb2tcLmNvbVwvLitcL3ZpZGVvcyg/OlwvXHdbXlwvXSspP1wvKFxkKykvaQogICAgICAgICAgICBdLAoKICAgICAgICAgICAgZ2V0TWFpbHJ1TGlua3M6IFsKICAgICAgICAgICAgICAvXmh0dHBzPzpcL1wvbXlcLm1haWxcLnJ1XC8oW15cL10rXC9bXlwvXStcL1teXC9dK1wvW15cL10rXC9bXlwvXStcLmh0bWwpLiovaSwKICAgICAgICAgICAgICAvXmh0dHBzPzpcL1wvdmlkZW9hcGlcLm15XC5tYWlsXC5ydVwvdmlkZW9zXC8oZW1iZWRcL1teXC9dK1wvW15cL10rXC9bXlwvXStcL1teXC9dK1wuaHRtbCkuKi9pCiAgICAgICAgICAgIF0KICAgICAgICAgIH07CgogICAgICAgICAgZm9yICh2YXIgaSBpbiByZSkgewogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJlW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgdmFyIHZpZCA9IHVybC5tYXRjaChyZVtpXVtqXSk7CiAgICAgICAgICAgICAgaWYgKHZpZCAmJiB2aWQubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgdmlkID0gdmlkWzFdOwogICAgICAgICAgICAgICAgdmFyIHBsYXlsaXN0ID0gU2F2ZUZyb21fVXRpbHMuZ2V0TWF0Y2hGaXJzdCh1cmwsIC9saXN0PShbXHdcLV0rKS9pKTsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHsKICAgICAgICAgICAgICAgICAgZXh0VmlkZW9JZDogdmlkLAogICAgICAgICAgICAgICAgICBhY3Rpb246IGksCiAgICAgICAgICAgICAgICAgIGNoZWNrU3VidGl0bGVzOiB0cnVlLAogICAgICAgICAgICAgICAgICBjaGVja0xpbmtzOiB0cnVlCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGlmIChpID09PSAnZ2V0VmltZW9MaW5rcycpIHsKICAgICAgICAgICAgICAgICAgcmVxdWVzdC51cmwgPSB1cmw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZShyZXF1ZXN0LCBmdW5jdGlvbihyKSB7CiAgICAgICAgICAgICAgICAgIHNhdmVmcm9tLnNldExpbmtzKHIuYWN0aW9uLCByLmV4dFZpZGVvSWQsIHIubGlua3MsIHIudGl0bGUsIG51bGwsCiAgICAgICAgICAgICAgICAgICAgci5zdWJ0aXRsZXMsIHBsYXlsaXN0LCByLmR1cmF0aW9uLCByLnRodW1iLCByLmNoZWNrTGlua3MpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIGZhbHNlKTsKCgogICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgdmFyIG5vZGUgPSBldmVudC50YXJnZXQ7CgogICAgICAgICAgaWYgKG5vZGUudGFnTmFtZSA9PT0gJ0knICYmIG5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdmaWxlLWluZm8tYnRuJykpIHsKICAgICAgICAgICAgc2F2ZWZyb20ub25JbmZvQnRuQ2xpY2suY2FsbChub2RlLCBldmVudCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobm9kZS50YWdOYW1lICE9ICdBJykgewogICAgICAgICAgICBpZiAobm9kZS5wYXJlbnROb2RlLnRhZ05hbWUgPT0gJ0EnKQogICAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKChtb25vLmlzQ2hyb21lIHx8IG1vbm8uaXNGRikgJiYgbm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2xpbmstZG93bmxvYWQnKSAmJiAhbm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ2Rpc2FibGVkJykgJiYgbm9kZS5nZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJykpIHsKICAgICAgICAgICAgaWYgKG5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdnYV90cmFja19ldmVudHMnKSAmJiBub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1nYS1ldmVudCcpKSB7CiAgICAgICAgICAgICAgbW9uby50cmlnZ2VyKG5vZGUsICdzZW5kc3RhdHMnLCB7CiAgICAgICAgICAgICAgICBidWJibGVzOiB0cnVlLAogICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogZmFsc2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRPbkNsaWNrKGV2ZW50LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdmlkID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmlkZW8taWQnKTsKICAgICAgICAgIGlmICghdmlkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobm9kZS5nZXRBdHRyaWJ1dGUoc2F2ZWZyb20uZGF0YUF0dHIpID09ICcxJykKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgIHZhciBhY3Rpb24gPSB7CiAgICAgICAgICAgIHZrOiAnZ2V0VktMaW5rcycsCiAgICAgICAgICAgIHl0OiAnZ2V0WW91dHViZUxpbmtzJwogICAgICAgICAgfTsKCiAgICAgICAgICB2aWQgPSB2aWQuc3BsaXQoJzonLCAyKTsKICAgICAgICAgIGlmICh2aWQubGVuZ3RoICE9IDIgfHwgIWFjdGlvblt2aWRbMF1dKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICAgIG5vZGUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgICBpZiAoIW5vZGUuaWQpIHsKICAgICAgICAgICAgbm9kZS5pZCA9IHZpZFswXSArICdfJyArIHZpZFsxXSArICdfJyArIChNYXRoLnJhbmRvbSgpICogMTAwMCkgKwogICAgICAgICAgICAgICdfJyArIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlcXVlc3QgPSB7CiAgICAgICAgICAgIGV4dFZpZGVvSWQ6IHZpZFsxXSwKICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb25bdmlkWzBdXSwKICAgICAgICAgICAgY2hlY2tTdWJ0aXRsZXM6IHRydWUsCiAgICAgICAgICAgIGNoZWNrTGlua3M6IHRydWUKICAgICAgICAgIH07CgogICAgICAgICAgbW9uby5zZW5kTWVzc2FnZShyZXF1ZXN0LCBmdW5jdGlvbihyKSB7CiAgICAgICAgICAgIHNhdmVmcm9tLnNldExpbmtzKHIuYWN0aW9uLCByLmV4dFZpZGVvSWQsIHIubGlua3MsIHIudGl0bGUsIG5vZGUsCiAgICAgICAgICAgICAgci5zdWJ0aXRsZXMsIG51bGwsIHIuZHVyYXRpb24sIHIudGh1bWIsIHIuY2hlY2tMaW5rcyk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSwgdHJ1ZSk7CiAgICAgIH0sCgogICAgICBvbkluZm9CdG5DbGljazogZnVuY3Rpb24oZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICBpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoJ3NmLWNsaWNrZWQnKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoJ3NmLWNsaWNrZWQnKTsKCiAgICAgICAgdmFyIGNsYXNzTmFtZSA9ICdzZi1idG4nICsgZ2V0UmFuZG9tSW50KCk7CiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7CgogICAgICAgIHZhciBybU9sZFNjcmlwdCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGV4U2NyaXB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc2Ytc2NyaXB0JylbMF07CiAgICAgICAgICBpZiAoZXhTY3JpcHQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBleFNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGV4U2NyaXB0KTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBybU9sZFNjcmlwdCgpOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobW9uby5jcmVhdGUoJ3NjcmlwdCcsIHsKICAgICAgICAgIGNsYXNzOiAnc2Ytc2NyaXB0JywKICAgICAgICAgIHRleHQ6ICcoJyArIGZ1bmN0aW9uKGJ0bkNsYXNzTmFtZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHZhciBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGJ0bkNsYXNzTmFtZSk7CiAgICAgICAgICAgICAgdmFyICRidG4gPSAkKGJ0bik7CgogICAgICAgICAgICAgICRidG4udW5iaW5kKCdjbGljaycpLnJlbW92ZUF0dHIoJ29uY2xpY2snKS5hZGRDbGFzcygnYWN0aXZlJyk7CgogICAgICAgICAgICAgIGlmIChidG4ub25jbGljaykgewogICAgICAgICAgICAgICAgYnRuLm9uY2xpY2sgPSBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHBhcmVudCA9ICRidG4uY2xvc2VzdCgnLnJlc3VsdC1ib3gnKS5maW5kKCcubWV0YScpWzBdOwoKICAgICAgICAgICAgICBpZiAoIXBhcmVudCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGJveElkID0gJ2ZpbGVfaW5mbycgKyBidG5DbGFzc05hbWU7CgogICAgICAgICAgICAgIHZhciBib3ggPSBzZi5hcHBlbmQocGFyZW50LCAnZGl2JywgewogICAgICAgICAgICAgICAgJ2lkJzogYm94SWQsCiAgICAgICAgICAgICAgICAnY2xhc3MnOiAnbWVkaWEtaW5mbycKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgc2YuYXBwZW5kKGJveCwgJ3NwYW4nLCB7CiAgICAgICAgICAgICAgICBpZDogYm94SWQgKyAnX2J1c3knCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHNmLmJ1c3koYm94SWQgKyAnX2J1c3knLCB0cnVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7fQogICAgICAgICAgfS50b1N0cmluZygpICsgJykoJyArIEpTT04uc3RyaW5naWZ5KGNsYXNzTmFtZSkgKyAnKScKICAgICAgICB9KSk7CgogICAgICAgIHZhciB1cmwgPSB0aGlzLm5leHRFbGVtZW50U2libGluZy5ocmVmOwogICAgICAgIHZhciB0aXRsZSA9IHRoaXMubmV4dEVsZW1lbnRTaWJsaW5nLnRleHRDb250ZW50OwogICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgYWN0aW9uOiAnZ2V0RmlsZVNpemUnLAogICAgICAgICAgdXJsOiB1cmwKICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgdmFyIHNpemUgPSByZXNwb25zZS5maWxlU2l6ZTsKICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICBzaXplOiB7CiAgICAgICAgICAgICAgbmFtZTogewogICAgICAgICAgICAgICAgdHJhbnM6IGxhbmd1YWdlLnNpemUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHZhbHVlOiBTYXZlRnJvbV9VdGlscy5zaXplSHVtYW4oc2l6ZSkKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIHJtT2xkU2NyaXB0KCk7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdzY3JpcHQnLCB7CiAgICAgICAgICAgIGNsYXNzOiAnc2Ytc2NyaXB0JywKICAgICAgICAgICAgdGV4dDogJygnICsgZnVuY3Rpb24oYnRuQ2xhc3NOYW1lLCB0aXRsZSwganNvbikgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgYnVzeSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlX2luZm8nICsgYnRuQ2xhc3NOYW1lICsgJ19idXN5Jyk7CgogICAgICAgICAgICAgICAgJChidXN5KS5zbGlkZVVwKCk7CgogICAgICAgICAgICAgICAgdmFyIGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYnRuQ2xhc3NOYW1lKTsKCiAgICAgICAgICAgICAgICBzZi5maWxlSW5mby5zaG93KGpzb24sIHRpdGxlLCBidG4sIGJ1c3kucGFyZW50Tm9kZSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7fQogICAgICAgICAgICB9LnRvU3RyaW5nKCkgKyAnKSgnICsgWwogICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGNsYXNzTmFtZSksCiAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodGl0bGUpLAogICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgICAgICAgIF0uam9pbignLCcpICsgJyknCiAgICAgICAgICB9KSk7CiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICBzZXRFeHRQYXJhbXM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzY3JpcHQgPSBtb25vLmNyZWF0ZSgnc2NyaXB0JywgewogICAgICAgICAgaWQ6ICdzYXZlZnJvbV9fZXh0X3BhcmFtcycsCiAgICAgICAgICB0eXBlOiAndGV4dC9qYXZhc2NyaXB0JwogICAgICAgIH0pOwoKICAgICAgICB2YXIgcGFyYW1zID0gewogICAgICAgICAgaWQ6IHByZWZlcmVuY2Uuc2ZIZWxwZXJOYW1lLAogICAgICAgICAgdmVyc2lvbjogcHJlZmVyZW5jZS52ZXJzaW9uLAogICAgICAgICAgZW5hYmxlOiAxCiAgICAgICAgfTsKCiAgICAgICAgc2NyaXB0LnRleHRDb250ZW50ID0gJygnICsgZnVuY3Rpb24oanNvbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHdpbmRvdy5zZXRCcm93c2VyRXh0ZW5zaW9uICYmIHR5cGVvZiBzZXRCcm93c2VyRXh0ZW5zaW9uID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICBzZXRCcm93c2VyRXh0ZW5zaW9uKGpzb24pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgICAgfS50b1N0cmluZygpICsgJykoJyArIEpTT04uc3RyaW5naWZ5KHBhcmFtcykgKyAnKSc7CgogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgICAgfSwKCgogICAgICBzZXRMaW5rczogZnVuY3Rpb24oYWN0aW9uLCB2aWQsIGxpbmtzLCB0aXRsZSwgYnRuLCBzdWJ0aXRsZXMsIHBsYXlsaXN0LAogICAgICAgIGR1cmF0aW9uLCB0aHVtYiwgdmFsaWQpIHsKICAgICAgICBpZiAodmFsaWQgPT09IGZhbHNlKSB7CiAgICAgICAgICBzYXZlZnJvbS5oYW5kbGVFcnJvcihidG4pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICAgIGNhc2UgJ2dldFlvdXR1YmVMaW5rcyc6CiAgICAgICAgICAgIHNhdmVmcm9tLnNldFlvdXR1YmVMaW5rcyh2aWQsIGxpbmtzLCB0aXRsZSwgYnRuLCBzdWJ0aXRsZXMsCiAgICAgICAgICAgICAgcGxheWxpc3QsIGR1cmF0aW9uLCB0aHVtYik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnZ2V0VktMaW5rcyc6CiAgICAgICAgICAgIHNhdmVmcm9tLnNldFZLTGlua3ModmlkLCBsaW5rcywgdGl0bGUsIGJ0biwgZHVyYXRpb24sIHRodW1iKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnZ2V0VmltZW9MaW5rcyc6CiAgICAgICAgICAgIHNhdmVmcm9tLnNldFZpbWVvTGlua3ModmlkLCBsaW5rcywgdGl0bGUsIGJ0biwgZHVyYXRpb24sIHRodW1iKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnZ2V0RGFpbHltb3Rpb25MaW5rcyc6CiAgICAgICAgICAgIHNhdmVmcm9tLnNldERhaWx5bW90aW9uTGlua3ModmlkLCBsaW5rcywgdGl0bGUsIGJ0biwgZHVyYXRpb24sIHRodW1iKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnZ2V0RmFjZWJvb2tMaW5rcyc6CiAgICAgICAgICAgIHNhdmVmcm9tLnNldEZhY2Vib29rTGlua3ModmlkLCBsaW5rcywgdGl0bGUsIGJ0biwgZHVyYXRpb24sIHRodW1iKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnZ2V0TWFpbHJ1TGlua3MnOgogICAgICAgICAgICBzYXZlZnJvbS5zZXRNYWlscnVMaW5rcyh2aWQsIGxpbmtzLCB0aXRsZSwgYnRuLCBkdXJhdGlvbiwgdGh1bWIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0sCgoKICAgICAgaGFuZGxlRXJyb3I6IGZ1bmN0aW9uKGJ0bikgewogICAgICAgIGlmIChidG4pIHsKICAgICAgICAgIGlmIChidG4pIHsKICAgICAgICAgICAgYnRuLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgICAgICAgICAgYnRuLnNldEF0dHJpYnV0ZShzYXZlZnJvbS5kYXRhQXR0ciwgJzEnKTsKICAgICAgICAgICAgYnRuLmNsaWNrKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZl9mb3JtJyk7CiAgICAgICAgaWYgKCFmb3JtKQogICAgICAgICAgcmV0dXJuOwoKICAgICAgICBmb3JtLnNldEF0dHJpYnV0ZShzYXZlZnJvbS5kYXRhQXR0ciwgJzEnKTsKICAgICAgICBmb3JtLnN1Ym1pdCgpOwogICAgICAgIGZvcm0ucmVtb3ZlQXR0cmlidXRlKHNhdmVmcm9tLmRhdGFBdHRyKTsKICAgICAgfSwKCiAgICAgIHNob3dWaWRlb1Jlc3VsdDogZnVuY3Rpb24ocmVzdWx0LCBidG4pIHsKICAgICAgICBpZiAoIXJlc3VsdCB8fCAhcmVzdWx0LnVybCB8fCAhcmVzdWx0LnVybC5sZW5ndGgpIHsKICAgICAgICAgIHNhdmVmcm9tLmhhbmRsZUVycm9yKGJ0bik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2F2ZWZyb20uc2NyaXB0SWQpOwogICAgICAgIGlmIChzY3JpcHQpIHsKICAgICAgICAgIHNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCk7CiAgICAgICAgfQoKICAgICAgICBzY3JpcHQgPSBtb25vLmNyZWF0ZSgnc2NyaXB0JywgewogICAgICAgICAgaWQ6IHNhdmVmcm9tLnNjcmlwdElkLAogICAgICAgICAgdHlwZTogJ3RleHQvamF2YXNjcmlwdCcKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGZuOwogICAgICAgIGlmIChidG4pIHsKICAgICAgICAgIHZhciBidG5JZCA9IGJ0bi5pZDsKICAgICAgICAgIGZuID0gJygnICsgZnVuY3Rpb24oYnRuSWQsIGpzb24pIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB2YXIgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYnRuSWQpOwogICAgICAgICAgICAgIHNmLnJlc3VsdC5yZXBsYWNlQWpheFJlc3VsdChqc29uLCB0cnVlLCB0cnVlLCBidG4pOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgICAgICB9LnRvU3RyaW5nKCkgKyAnKSgiJyArIGJ0bklkICsgJyIsJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkgKyAnKSc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZuID0gJygnICsgZnVuY3Rpb24oanNvbikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHNmLmZpbmlzaFJlcXVlc3QodHJ1ZSk7CiAgICAgICAgICAgICAgc2YudmlkZW9SZXN1bHQuc2hvdyhqc29uKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7fQogICAgICAgICAgfS50b1N0cmluZygpICsgJykoJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkgKyAnKSc7CiAgICAgICAgfQogICAgICAgIHNjcmlwdC50ZXh0Q29udGVudCA9IGZuOwoKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICAgIH0sCgoKICAgICAgc2V0VktMaW5rczogZnVuY3Rpb24odmlkLCBsaW5rcywgdGl0bGUsIGJ0biwgZHVyYXRpb24sIHRodW1iKSB7CiAgICAgICAgaWYgKCF2aWQgfHwgIWxpbmtzKSB7CiAgICAgICAgICBzYXZlZnJvbS5oYW5kbGVFcnJvcihidG4pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJlc3VsdCA9IHsKICAgICAgICAgIGlkOiB2aWQsCiAgICAgICAgICB1cmw6IGxpbmtzLAogICAgICAgICAgaG9zdGluZzogJ3ZrLmNvbSAoaCknLAogICAgICAgICAgbWV0YTogewogICAgICAgICAgICB0aXRsZTogKHRpdGxlID8gbW9uby5maWxlTmFtZS5tb2RpZnkodGl0bGUpIDogJycpLAogICAgICAgICAgICBzb3VyY2U6ICJodHRwOi8vdmsuY29tLyIgKyB2aWQsCiAgICAgICAgICAgIGR1cmF0aW9uOiBTYXZlRnJvbV9VdGlscy5zZWNvbmRzVG9EdXJhdGlvbihkdXJhdGlvbikKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpZiAodGh1bWIpCiAgICAgICAgICByZXN1bHQudGh1bWIgPSB0aHVtYjsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXN1bHQudXJsLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICByZXN1bHQudXJsW2ldLmluZm9fdXJsID0gJyMnOwoKICAgICAgICAgIGlmICghcmVzdWx0LnVybFtpXS5leHQgJiYgcmVzdWx0LnVybFtpXS50eXBlKQogICAgICAgICAgICByZXN1bHQudXJsW2ldLmV4dCA9IHJlc3VsdC51cmxbaV0udHlwZTsKCiAgICAgICAgICBpZiAoIXJlc3VsdC5zZCAmJiAhcmVzdWx0LnVybFtpXS5zdWJuYW1lKQogICAgICAgICAgICByZXN1bHQuc2QgPSB7CiAgICAgICAgICAgICAgdXJsOiByZXN1bHQudXJsW2ldLnVybAogICAgICAgICAgICB9OwogICAgICAgICAgZWxzZSBpZiAoIXJlc3VsdC5oZCAmJiByZXN1bHQudXJsW2ldLnN1Ym5hbWUgJiYgcGFyc2VJbnQocmVzdWx0LnVybFtpXS5zdWJuYW1lKSA+PSA3MjApCiAgICAgICAgICAgIHJlc3VsdC5oZCA9IHsKICAgICAgICAgICAgICB1cmw6IHJlc3VsdC51cmxbaV0udXJsCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBzYXZlZnJvbS5zaG93VmlkZW9SZXN1bHQocmVzdWx0LCBidG4pOwogICAgICB9LAoKICAgICAgc2V0WW91dHViZUxpbmtzOiBmdW5jdGlvbih2aWQsIGxpbmtzLCB0aXRsZSwgYnRuLCBzdWJ0aXRsZXMsIHBsYXlsaXN0LAogICAgICAgIGR1cmF0aW9uLCB0aHVtYikgewogICAgICAgIGlmICghdmlkIHx8ICFsaW5rcykgewogICAgICAgICAgc2F2ZWZyb20uaGFuZGxlRXJyb3IoYnRuKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciByZXN1bHQgPSB7CiAgICAgICAgICBpZDogdmlkLAogICAgICAgICAgdXJsOiBbXSwKICAgICAgICAgIGhvc3Rpbmc6ICcxMDEgKGgpJywKICAgICAgICAgIG1ldGE6IHsKICAgICAgICAgICAgdGl0bGU6ICh0aXRsZSA/IG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRpdGxlKSA6ICcnKSwKICAgICAgICAgICAgc291cmNlOiAodmlkID8gJ2h0dHA6Ly95b3V0dWJlLmNvbS93YXRjaD92PScgKyB2aWQgOiAnJyksCiAgICAgICAgICAgIGR1cmF0aW9uOiBTYXZlRnJvbV9VdGlscy5zZWNvbmRzVG9EdXJhdGlvbihkdXJhdGlvbikKICAgICAgICAgIH0sCiAgICAgICAgICB0aHVtYjogKHZpZCA/ICdodHRwOi8vaS55dGltZy5jb20vdmkvJyArIHZpZCArICcvaHFkZWZhdWx0LmpwZycgOiAnJykKICAgICAgICB9OwoKICAgICAgICB2YXIgc2lnID0gZmFsc2U7CgoKICAgICAgICBTYXZlRnJvbV9VdGlscy52aWRlby55dC5pbml0KCk7CgogICAgICAgIHZhciBtZXRhID0gbGlua3MubWV0YSB8fCB7fTsKCiAgICAgICAgZm9yICh2YXIgZm9ybWF0TmFtZSBpbiBTYXZlRnJvbV9VdGlscy52aWRlby55dC5mb3JtYXQpIHsKICAgICAgICAgIHZhciBmID0gU2F2ZUZyb21fVXRpbHMudmlkZW8ueXQuZm9ybWF0W2Zvcm1hdE5hbWVdOwogICAgICAgICAgZm9yICh2YXIgaVRhZyBpbiBmKSB7CiAgICAgICAgICAgIHZhciBtZXRhVGFnID0gbWV0YVtpVGFnXSB8fCB7fTsKICAgICAgICAgICAgaWYgKGxpbmtzW2lUYWddKSB7CiAgICAgICAgICAgICAgaWYgKCFzaWcgJiYgbGlua3NbaVRhZ10uc2VhcmNoKC8oXD98JilzaWcobmF0dXJlKT89L2kpID4gLTEpIHsKICAgICAgICAgICAgICAgIHNpZyA9IHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcXVhbGl0eSA9IGZbaVRhZ10ucXVhbGl0eTsKCiAgICAgICAgICAgICAgaWYgKG1ldGFUYWcucXVhbGl0eSkgewogICAgICAgICAgICAgICAgcXVhbGl0eSA9IG1ldGFUYWcucXVhbGl0eTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBsID0gewogICAgICAgICAgICAgICAgdXJsOiBsaW5rc1tpVGFnXSwKICAgICAgICAgICAgICAgIG5hbWU6IGZvcm1hdE5hbWUsCiAgICAgICAgICAgICAgICBzdWJuYW1lOiBxdWFsaXR5LAogICAgICAgICAgICAgICAgaW5mb191cmw6ICcjJywKICAgICAgICAgICAgICAgIHR5cGU6IGZvcm1hdE5hbWUsCiAgICAgICAgICAgICAgICBxdWFsaXR5OiBxdWFsaXR5LAogICAgICAgICAgICAgICAgYXR0cjoge30KICAgICAgICAgICAgICB9OwoKCiAgICAgICAgICAgICAgaWYgKGZbaVRhZ10uc0ZwcykgewogICAgICAgICAgICAgICAgbC5zdWJuYW1lICs9ICcgJyArIChtZXRhVGFnLmZwcyB8fCA2MCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZltpVGFnXVsnM2QnXSkgewogICAgICAgICAgICAgICAgbC5uYW1lID0gJzNEICcgKyBsLm5hbWU7CiAgICAgICAgICAgICAgICBsLmdyb3VwID0gJzNkJzsKICAgICAgICAgICAgICAgIGxbJzNkJ10gPSB0cnVlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZltpVGFnXVsnbm9BdWRpbyddKSB7CiAgICAgICAgICAgICAgICBsLmdyb3VwID0gJ01QNCAnOwogICAgICAgICAgICAgICAgbC5hdHRyWydjbGFzcyddID0gJ25vLWF1ZGlvJzsKICAgICAgICAgICAgICAgIC8vIGwuZXh0ID0gJ21wNCc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXROYW1lID09ICdBdWRpbyBBQUMnKSB7CiAgICAgICAgICAgICAgICBsLnR5cGUgPSAnQUFDJzsKICAgICAgICAgICAgICAgIGwuZXh0ID0gJ2FhYyc7CiAgICAgICAgICAgICAgICBsLmF0dHIuc3R5bGUgPSAnd2hpdGUtc3BhY2U6IG5vd3JhcDsnOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0TmFtZSA9PSAnQXVkaW8gVm9yYmlzJykgewogICAgICAgICAgICAgICAgbC50eXBlID0gJ1ZvcmJpcyc7CiAgICAgICAgICAgICAgICBsLmV4dCA9ICd3ZWJtJzsKICAgICAgICAgICAgICAgIGwuYXR0ci5zdHlsZSA9ICd3aGl0ZS1zcGFjZTogbm93cmFwOyc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXROYW1lID09ICdBdWRpbyBPcHVzJykgewogICAgICAgICAgICAgICAgbC50eXBlID0gJ09wdXMnOwogICAgICAgICAgICAgICAgbC5leHQgPSAnb3B1cyc7CiAgICAgICAgICAgICAgICBsLmF0dHIuc3R5bGUgPSAnd2hpdGUtc3BhY2U6IG5vd3JhcDsnOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0TmFtZS50b0xvd2VyQ2FzZSgpID09ICdmbHYnICYmICFyZXN1bHQuc2QpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0LnNkID0gewogICAgICAgICAgICAgICAgICAgIHVybDogbGlua3NbaVRhZ10KICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQocXVhbGl0eSkgPj0gNzIwICYmIHJlc3VsdC5zZCAmJiAhcmVzdWx0LmhkKSB7CiAgICAgICAgICAgICAgICAgIHJlc3VsdC5oZCA9IHsKICAgICAgICAgICAgICAgICAgICB1cmw6IGxpbmtzW2lUYWddCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAobC5leHQgPT09IHVuZGVmaW5lZCAmJiBsLnR5cGUpIHsKICAgICAgICAgICAgICAgIGwuZXh0ID0gbC50eXBlLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZltpVGFnXS5ub1ZpZGVvID09PSB1bmRlZmluZWQgJiYgZltpVGFnXS5ub0F1ZGlvID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGwubm9fZG93bmxvYWQgPSB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmVzdWx0LnVybC5wdXNoKGwpOwogICAgICAgICAgICAgIGRlbGV0ZSBsaW5rc1tpVGFnXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCFzaWcpIHsKICAgICAgICAgIHNhdmVmcm9tLmhhbmRsZUVycm9yKGJ0bik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoc3VidGl0bGVzICYmIHN1YnRpdGxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICB2YXIgc3Vic0lkID0gdmlkLnJlcGxhY2UoL1teXHddLywgJ18nKTsKICAgICAgICAgIHZhciBidG5JZCA9ICd5dF9zdWJzX2J0bl8nICsgc3Vic0lkOwogICAgICAgICAgc3Vic0lkID0gJ3l0X3N1YnNfJyArIHN1YnNJZDsKCiAgICAgICAgICB2YXIgc3VidFRva2VuID0gJ2V4dGVuc2lvbic7CiAgICAgICAgICB2YXIgc3Vic1RpdGxlID0gcmVzdWx0Lm1ldGEudGl0bGUgPyBidG9hKFNhdmVGcm9tX1V0aWxzLnV0ZjhFbmNvZGUocmVzdWx0Lm1ldGEudGl0bGUpKSA6ICcnOwoKICAgICAgICAgIHJlc3VsdC5hY3Rpb24gPSBbXTsKICAgICAgICAgIHJlc3VsdC5hY3Rpb24ucHVzaCh7CiAgICAgICAgICAgIG5hbWU6IGxhbmd1YWdlLnN1YnRpdGxlcywKICAgICAgICAgICAgYXR0cjogewogICAgICAgICAgICAgIGlkOiBidG5JZCwKICAgICAgICAgICAgICBocmVmOiAnIycKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGJpbmQ6IHsKICAgICAgICAgICAgICBjbGljazogewogICAgICAgICAgICAgICAgZm46ICdzZi55b3V0dWJlU3VidGl0bGVzKCJ7dmlkfSIsIntzdWJzSWR9Iiwie2J0bklkfSIsIntzdWJ0VG9rZW59Iiwie3N1YnNUaXRsZX0iKScKICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3t2aWR9JywgdmlkKQogICAgICAgICAgICAgICAgICAucmVwbGFjZSgne3N1YnNJZH0nLCBzdWJzSWQpCiAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7YnRuSWR9JywgJyMnICsgYnRuSWQpCiAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7c3VidFRva2VufScsIHN1YnRUb2tlbikKICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3tzdWJzVGl0bGV9Jywgc3Vic1RpdGxlKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocGxheWxpc3QgJiYgZmFsc2UpIHsKICAgICAgICAgIHBsYXlsaXN0ID0gJ2h0dHA6Ly93d3cueW91dHViZS5jb20vcGxheWxpc3Q/bGlzdD0nICsgcGxheWxpc3Q7CiAgICAgICAgICBpZiAoIXJlc3VsdC5hY3Rpb24pCiAgICAgICAgICAgIHJlc3VsdC5hY3Rpb24gPSBbXTsKICAgICAgICAgIHJlc3VsdC5hY3Rpb24ucHVzaCh7CiAgICAgICAgICAgIG5hbWU6IGxhbmd1YWdlLnBsYXlsaXN0LAogICAgICAgICAgICBhdHRyOiB7CiAgICAgICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgICAgIGNsYXNzOiAndG9vbHRpcCcsCiAgICAgICAgICAgICAgdGl0bGU6IGxhbmd1YWdlLmRvd25sb2FkV2hvbGVQbGF5bGlzdAogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYmluZDogewogICAgICAgICAgICAgIGNsaWNrOiB7CiAgICAgICAgICAgICAgICBmbjogJ3NmLnByb2Nlc3NMaW5rKCJ7cGxheWxpc3R9Iik7JwogICAgICAgICAgICAgICAgICAucmVwbGFjZSgne3BsYXlsaXN0fScsIHBsYXlsaXN0KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocHJlZmVyZW5jZS5zaG93VW1teUl0ZW0pIHsKICAgICAgICAgIHJlc3VsdC5hY3Rpb24gPSByZXN1bHQuYWN0aW9uIHx8IFtdOwoKICAgICAgICAgIHZhciBwYXJhbXMgPSBtb25vLnBhcmFtKHsKICAgICAgICAgICAgdmlkOiAxMTIsCiAgICAgICAgICAgIHZpZGVvOiAneXQtJyArIHZpZCwKICAgICAgICAgICAgdXRtX3NvdXJjZTogJ3NhdmVmcm9tJywKICAgICAgICAgICAgdXRtX21lZGl1bTogJ3ZpZGFjaGEtaGVscGVyJywKICAgICAgICAgICAgdXRtX2NhbXBhaWduOiAndW1teScsCiAgICAgICAgICAgIHV0bV9jb250ZW50OiAndW1teV9pbnRlZ3JhdGlvbicKICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciB0b29sdGlwID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgYXBwZW5kOiBtb25vLnBhcnNlVGVtcGxhdGUobGFuZ3VhZ2UudW1teU1lbnVJbmZvLnJlcGxhY2UoJ3t1cmx9JywgJ2h0dHA6Ly92aWRlb2Rvd25sb2FkZXIudW1teS5uZXQvPycgKyBwYXJhbXMpLnJlcGxhY2UoInNyYzonIyciLCAic3JjOicvaW1nL3VtbXlfaWNvbl8xNi5wbmcnIikpCiAgICAgICAgICB9KTsKCiAgICAgICAgICBtb25vLmNyZWF0ZSh0b29sdGlwLnF1ZXJ5U2VsZWN0b3IoJ2EuYXJyb3cnKSwgewogICAgICAgICAgICBjbGFzczogWydnYV90cmFja19ldmVudHMnXSwKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgIGdhRXZlbnQ6ICdzZW5kO2V2ZW50O3ZpZGFjaGEtaGVscGVyO3lvdXR1YmU7dW1teS10b29sdGlwLWNsaWNrJwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXN1bHQuYWN0aW9uLnB1c2goewogICAgICAgICAgICBuYW1lOiBsYW5ndWFnZS51bW15U2ZUaXRsZSwKICAgICAgICAgICAgZ3JvdXA6ICd1bW15JywKICAgICAgICAgICAgJ3NlY29uZC1idG4nOiB0cnVlLAoKICAgICAgICAgICAgYXR0cjogewogICAgICAgICAgICAgIGhyZWY6ICd1bW15Oi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9JyArIHZpZCwKICAgICAgICAgICAgICBjbGFzczogJ3VtbXktbGluayB0b29sdGlwIGdhX3RyYWNrX2V2ZW50cycsCiAgICAgICAgICAgICAgdGl0bGU6IHRvb2x0aXAuaW5uZXJIVE1MLAogICAgICAgICAgICAgIHRhcmdldDogJ19ibGFuaycsCiAgICAgICAgICAgICAgJ2RhdGEtZ2EtZXZlbnQnOiAnc2VuZDtldmVudDt2aWRhY2hhLWhlbHBlcjt5b3V0dWJlO3VtbXktaGVscGVyLWJ1dHRvbi1jbGljaycsCiAgICAgICAgICAgICAgJ2RhdGEtdG9vbHRpcC1nYS1ldmVudCc6ICd2aWRhY2hhLWhlbHBlcjt5b3V0dWJlO3VtbXktaGVscGVyLXRvb2x0aXAtc2hvdycKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgcmVzdWx0LmZuID0gcmVzdWx0LmZuIHx8IFtdOwogICAgICAgICAgcmVzdWx0LmZuLnB1c2goImlmKHdpbmRvdy5nYSl7Z2EoJ3NlbmQnLCdldmVudCcsJ3ZpZGFjaGEtaGVscGVyJywneW91dHViZScsJ3VtbXktaGVscGVyLWJ1dHRvbi1zaG93Jyk7fSIpOwogICAgICAgIH0KCiAgICAgICAgc2F2ZWZyb20uc2hvd1ZpZGVvUmVzdWx0KHJlc3VsdCwgYnRuKTsKICAgICAgfSwKCiAgICAgIHNldFZpbWVvTGlua3M6IGZ1bmN0aW9uKHZpZCwgbGlua3MsIHRpdGxlLCBidG4sIGR1cmF0aW9uLCB0aHVtYikgewogICAgICAgIGlmICghdmlkIHx8ICFsaW5rcykgewogICAgICAgICAgc2F2ZWZyb20uaGFuZGxlRXJyb3IoYnRuKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciByZXN1bHQgPSB7CiAgICAgICAgICBpZDogdmlkLAogICAgICAgICAgdXJsOiBsaW5rcywKICAgICAgICAgIGhvc3Rpbmc6ICd2aW1lby5jb20gKGgpJywKICAgICAgICAgIG1ldGE6IHsKICAgICAgICAgICAgdGl0bGU6ICh0aXRsZSA/IG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRpdGxlKSA6ICcnKSwKICAgICAgICAgICAgc291cmNlOiAiaHR0cDovL3ZpbWVvLmNvbS8iICsgdmlkLAogICAgICAgICAgICBkdXJhdGlvbjogU2F2ZUZyb21fVXRpbHMuc2Vjb25kc1RvRHVyYXRpb24oZHVyYXRpb24pCiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKHRodW1iKQogICAgICAgICAgcmVzdWx0LnRodW1iID0gdGh1bWI7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0LnVybC5sZW5ndGg7IGkrKykgewogICAgICAgICAgcmVzdWx0LnVybFtpXS5pbmZvX3VybCA9ICcjJzsKCiAgICAgICAgICBpZiAoIXJlc3VsdC51cmxbaV0uZXh0ICYmIHJlc3VsdC51cmxbaV0udHlwZSkKICAgICAgICAgICAgcmVzdWx0LnVybFtpXS5leHQgPSByZXN1bHQudXJsW2ldLnR5cGU7CgogICAgICAgICAgaWYgKCFyZXN1bHQuc2QgJiYgcmVzdWx0LnVybFtpXS5uYW1lID09ICdTRCcpCiAgICAgICAgICAgIHJlc3VsdC5zZCA9IHsKICAgICAgICAgICAgICB1cmw6IHJlc3VsdC51cmxbaV0udXJsCiAgICAgICAgICAgIH07CiAgICAgICAgICBlbHNlIGlmICghcmVzdWx0LmhkICYmIHJlc3VsdC51cmxbaV0ubmFtZSA9PSAnSEQnKQogICAgICAgICAgICByZXN1bHQuaGQgPSB7CiAgICAgICAgICAgICAgdXJsOiByZXN1bHQudXJsW2ldLnVybAogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgc2F2ZWZyb20uc2hvd1ZpZGVvUmVzdWx0KHJlc3VsdCwgYnRuKTsKICAgICAgfSwKCiAgICAgIHNldERhaWx5bW90aW9uTGlua3M6IGZ1bmN0aW9uKHZpZCwgbGlua3MsIHRpdGxlLCBidG4sIGR1cmF0aW9uLCB0aHVtYikgewogICAgICAgIGlmICghdmlkIHx8ICFsaW5rcykgewogICAgICAgICAgc2F2ZWZyb20uaGFuZGxlRXJyb3IoYnRuKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBsaW5rTGlzdCA9IGxpbmtzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICBpZiAoIWl0ZW0uZXh0cmEpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciByZXN1bHQgPSB7CiAgICAgICAgICBpZDogdmlkLAogICAgICAgICAgdXJsOiBsaW5rTGlzdCwKICAgICAgICAgIGhvc3Rpbmc6ICdkYWlseW1vdGlvbi5jb20gKGgpJywKICAgICAgICAgIG1ldGE6IHsKICAgICAgICAgICAgdGl0bGU6ICh0aXRsZSA/IG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRpdGxlKSA6ICcnKSwKICAgICAgICAgICAgc291cmNlOiAiaHR0cDovL2RhaS5seS8iICsgdmlkLAogICAgICAgICAgICBkdXJhdGlvbjogU2F2ZUZyb21fVXRpbHMuc2Vjb25kc1RvRHVyYXRpb24oZHVyYXRpb24pCiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKHRodW1iKQogICAgICAgICAgcmVzdWx0LnRodW1iID0gdGh1bWI7CgogICAgICAgIHZhciBoZF9zaXplID0gMCwKICAgICAgICAgIHNkX3NpemUgPSAwOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gbGlua0xpc3RbaV07IGkrKykgewogICAgICAgICAgaXRlbS5pbmZvX3VybCA9ICcjJzsKCiAgICAgICAgICBpZiAoaXRlbS5oZWlnaHQgPj0gNzIwKSB7CiAgICAgICAgICAgIGlmIChoZF9zaXplIDwgaXRlbS5oZWlnaHQpIHsKICAgICAgICAgICAgICByZXN1bHQuaGQgPSB7CiAgICAgICAgICAgICAgICB1cmw6IGl0ZW0udXJsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBoZF9zaXplID0gaXRlbS5oZWlnaHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKHNkX3NpemUgPCBpdGVtLmhlaWdodCkgewogICAgICAgICAgICByZXN1bHQuc2QgPSB7CiAgICAgICAgICAgICAgdXJsOiBpdGVtLnVybAogICAgICAgICAgICB9OwogICAgICAgICAgICBzZF9zaXplID0gaXRlbS5oZWlnaHQ7CiAgICAgICAgICB9CiAgICAgICAgICBkZWxldGUgaXRlbS5oZWlnaHQ7CiAgICAgICAgfQogICAgICAgIHNhdmVmcm9tLnNob3dWaWRlb1Jlc3VsdChyZXN1bHQsIGJ0bik7CiAgICAgIH0sCgogICAgICBzZXRGYWNlYm9va0xpbmtzOiBmdW5jdGlvbih2aWQsIGxpbmtzLCB0aXRsZSwgYnRuLCBkdXJhdGlvbiwgdGh1bWIpIHsKICAgICAgICBpZiAoIXZpZCB8fCAhbGlua3MpIHsKICAgICAgICAgIHNhdmVmcm9tLmhhbmRsZUVycm9yKGJ0bik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVzdWx0ID0gewogICAgICAgICAgaWQ6IHZpZCwKICAgICAgICAgIHVybDogbGlua3MsCiAgICAgICAgICBob3N0aW5nOiAnZmFjZWJvb2suY29tIChoKScsCiAgICAgICAgICBtZXRhOiB7CiAgICAgICAgICAgIHRpdGxlOiAodGl0bGUgPyBtb25vLmZpbGVOYW1lLm1vZGlmeSh0aXRsZSkgOiAnJyksCiAgICAgICAgICAgIHNvdXJjZTogImh0dHBzOi8vZmFjZWJvb2suY29tL3ZpZGVvLnBocD92PSIgKyB2aWQsCiAgICAgICAgICAgIGR1cmF0aW9uOiBTYXZlRnJvbV9VdGlscy5zZWNvbmRzVG9EdXJhdGlvbihkdXJhdGlvbikKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpZiAodGh1bWIpIHsKICAgICAgICAgIHJlc3VsdC50aHVtYiA9IHRodW1iOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBsaW5rc1tpXTsgaSsrKSB7CiAgICAgICAgICBpdGVtLmluZm9fdXJsID0gJyMnOwoKICAgICAgICAgIGlmIChpdGVtLm5hbWUgPT09ICJTRCIpIHsKICAgICAgICAgICAgcmVzdWx0LnNkID0gewogICAgICAgICAgICAgIHVybDogaXRlbS51cmwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKGl0ZW0ubmFtZSA9PT0gIkhEIikgewogICAgICAgICAgICByZXN1bHQuaGQgPSB7CiAgICAgICAgICAgICAgdXJsOiBpdGVtLnVybAogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGl0ZW0uc3VibmFtZSA9IGl0ZW0ubmFtZTsKICAgICAgICAgIGl0ZW0ubmFtZSA9IGl0ZW0uZXh0OwogICAgICAgIH0KICAgICAgICBzYXZlZnJvbS5zaG93VmlkZW9SZXN1bHQocmVzdWx0LCBidG4pOwogICAgICB9LAoKICAgICAgc2V0TWFpbHJ1TGlua3M6IGZ1bmN0aW9uKHZpZCwgbGlua3MsIHRpdGxlLCBidG4sIGR1cmF0aW9uLCB0aHVtYikgewogICAgICAgIGlmICghdmlkIHx8ICFsaW5rcykgewogICAgICAgICAgc2F2ZWZyb20uaGFuZGxlRXJyb3IoYnRuKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciByZXN1bHQgPSB7CiAgICAgICAgICBpZDogdmlkLAogICAgICAgICAgdXJsOiBsaW5rcywKICAgICAgICAgIGhvc3Rpbmc6ICdtYWlsLnJ1IChoKScsCiAgICAgICAgICBtZXRhOiB7CiAgICAgICAgICAgIHRpdGxlOiAodGl0bGUgPyBtb25vLmZpbGVOYW1lLm1vZGlmeSh0aXRsZSkgOiAnJyksCiAgICAgICAgICAgIHNvdXJjZTogImh0dHA6Ly9teS5tYWlsLnJ1LyIgKyB2aWQsCiAgICAgICAgICAgIGR1cmF0aW9uOiBTYXZlRnJvbV9VdGlscy5zZWNvbmRzVG9EdXJhdGlvbihkdXJhdGlvbikKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpZiAodGh1bWIpCiAgICAgICAgICByZXN1bHQudGh1bWIgPSB0aHVtYjsKCiAgICAgICAgdmFyIG1heFNkID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IHJlc3VsdC51cmxbaV07IGkrKykgewogICAgICAgICAgaXRlbS5pbmZvX3VybCA9ICcjJzsKICAgICAgICAgIGlmICghaXNOYU4ocGFyc2VJbnQoaXRlbS5zdWJuYW1lKSkpIHsKICAgICAgICAgICAgaWYgKG1heFNkIDwgaXRlbS5zdWJuYW1lICYmIGl0ZW0uc3VibmFtZSA8IDcyMCkgewogICAgICAgICAgICAgIHJlc3VsdC5zZCA9IHsKICAgICAgICAgICAgICAgIHVybDogaXRlbS51cmwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIG1heFNkID0gaXRlbS5zdWJuYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcmVzdWx0LmhkICYmIGl0ZW0uc3VibmFtZSA+PSAnNzIwJykgewogICAgICAgICAgICAgIHJlc3VsdC5oZCA9IHsKICAgICAgICAgICAgICAgIHVybDogaXRlbS51cmwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaXRlbS5zdWJuYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzZCcpIHsKICAgICAgICAgICAgICByZXN1bHQuc2QgPSB7CiAgICAgICAgICAgICAgICB1cmw6IGl0ZW0udXJsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnN1Ym5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2hkJykgewogICAgICAgICAgICAgIHJlc3VsdC5oZCA9IHsKICAgICAgICAgICAgICAgIHVybDogaXRlbS51cmwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzYXZlZnJvbS5zaG93VmlkZW9SZXN1bHQocmVzdWx0LCBidG4pOwogICAgICB9CiAgICB9OwogIH0sIG51bGwsIGZ1bmN0aW9uIHN5bmNJc0FjdGl2ZSgpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIGlmIChtb25vLmlzU2FmYXJpIHx8IG1vbm8uaXNHTSkgewogICAgICB2YXIgbGlzdCA9IFsKICAgICAgICAnKjovLyouc2F2ZWZyb20ubmV0LyonCiAgICAgIF07CgogICAgICB2YXIgcmVTdHIgPSBsaXN0Lm1hcChmdW5jdGlvbihwYXR0ZXJuKSB7CiAgICAgICAgcmV0dXJuIG1vbm8udXJsUGF0dGVyblRvU3RyUmUocGF0dGVybik7CiAgICAgIH0pLmpvaW4oJ3wnKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChyZVN0cik7CgogICAgICBpZiAoIXJlLnRlc3QobG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdG5hbWUpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgaWYgKCFtb25vLmlzSWZyYW1lKCkpIHsKICAgICAgaWYgKGxvY2F0aW9uLmhyZWYuc2VhcmNoKC9zYXZlZnJvbVwubmV0XC8oaW5kZXhcZD9cLnBocHx1c2VyXC5waHB8dXBkYXRlLWhlbHBlclwucGhwfHVzZXJqcy1zZXR1cFwucGhwfFxkKy1bXlwvXStcL3xhcnRpY2xlc1wvLispPyhcP3wjfCQpL2kpID09PSAtMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGFsbG93RnJhbWUgPSBmYWxzZTsKCiAgICAgIGlmIChtb25vLmlzR00pIHsKICAgICAgICBhbGxvd0ZyYW1lID0gbG9jYXRpb24uaHJlZi5pbmRleE9mKCcvdG9vbHMvaGVscGVyLWNoZWNrLmh0bWwnKSAhPT0gLTE7CiAgICAgIH0KCiAgICAgIGlmICghYWxsb3dGcmFtZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgnc291bmRjbG91ZCcsIGZ1bmN0aW9uKG1vZHVsZU5hbWUsIGluaXREYXRhKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGxhbmd1YWdlID0gaW5pdERhdGEuZ2V0TGFuZ3VhZ2U7CiAgICB2YXIgcHJlZmVyZW5jZSA9IGluaXREYXRhLmdldFByZWZlcmVuY2U7CiAgICB2YXIgbW9kdWxlU3RhdGUgPSBwcmVmZXJlbmNlLm1vZHVsZVNvdW5kY2xvdWQgPyAxIDogMDsKCiAgICBtb25vLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbihtZXNzYWdlLCBjYikgewogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICdnZXRNb2R1bGVJbmZvJykgewogICAgICAgIGlmIChtZXNzYWdlLnVybCAhPT0gbG9jYXRpb24uaHJlZikgcmV0dXJuOwogICAgICAgIHJldHVybiBjYih7CiAgICAgICAgICBzdGF0ZTogbW9kdWxlU3RhdGUsCiAgICAgICAgICBtb2R1bGVOYW1lOiBtb2R1bGVOYW1lCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnY2hhbmdlU3RhdGUnKSB7CiAgICAgICAgaWYgKG1vZHVsZU5hbWUgIT09IG1lc3NhZ2UubW9kdWxlTmFtZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2MuY2hhbmdlU3RhdGUobWVzc2FnZS5zdGF0ZSk7CiAgICAgIH0KICAgIH0pOwoKICAgIGlmIChtb2R1bGVTdGF0ZSkgewogICAgICBtb25vLmFzeW5jQ2FsbChmdW5jdGlvbigpIHsKICAgICAgICBzYy5ydW4oKTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIHNjID0gewogICAgICBjbGllbnRfaWQ6ICcwMmdVSkMwaEgyY3QxRUdPY1lYUUl6UkZVOTFjNzJFYScsCgogICAgICBsYXN0Um93OiBudWxsLAogICAgICB0aW1lcjogMCwKICAgICAgYnRuQ2xhc3M6ICdzYXZlZnJvbS1oZWxwZXItLWJ0bicsCgogICAgICBub2RlSWQ6IDAsCgogICAgICB0cmFja3M6IHt9LAogICAgICBhdWRpb0VsQ2xhc3NMaXN0OiBbJ3NvdW5kTGlzdF9faXRlbScsICdzZWFyY2hMaXN0X19pdGVtJywgJ3RyYWNrTGlzdF9faXRlbScsICdjb21wYWN0VHJhY2tMaXN0X19pdGVtJywgJ3NvdW5kQmFkZ2VMaXN0X19pdGVtJ10sCgogICAgICByZWZyZXNoQ2xpZW50SWQ6IGZ1bmN0aW9uKCkgewogICAgICAgIFNhdmVGcm9tX1V0aWxzLmJyaWRnZSh7CiAgICAgICAgICBmdW5jOiBmdW5jdGlvbihjYikgewogICAgICAgICAgICBpZiAodHlwZW9mIHdlYnBhY2tKc29ucCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2VicGFja0pzb25wKFtdLCB7CiAgICAgICAgICAgICAgMDogZnVuY3Rpb24oZSwgdCwgbikgewogICAgICAgICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgICAgICAgdmFyIGdldE9iakxpc3QgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgdmFyIGxpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIG4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW4uaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBuW2tleV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIGhhc0V4cG9ydHMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkyIGluIG9iaikgewogICAgICAgICAgICAgICAgICAgICAgaWYgKG9ialtrZXkyXS5leHBvcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhc0V4cG9ydHMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghaGFzRXhwb3J0cykgewogICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChvYmopOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICByZXR1cm4gbGlzdDsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdmFyIGNsaWVudElkOwogICAgICAgICAgICAgICAgZ2V0T2JqTGlzdCgpLnNvbWUoZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4IGluIG9iaikgewogICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gb2JqW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgZXhwb3J0cyA9IGl0ZW0uZXhwb3J0czsKICAgICAgICAgICAgICAgICAgICBpZiAoIWV4cG9ydHMpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgX3N0b3JlID0gZXhwb3J0cy5fc3RvcmU7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfc3RvcmUpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY2xpZW50SWQgPSBfc3RvcmUuY2xpZW50X2lkOwogICAgICAgICAgICAgICAgICAgIGlmIChjbGllbnRJZCkgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoY2xpZW50SWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgY2IoewogICAgICAgICAgICAgICAgICBjbGllbnRfaWQ6IGNsaWVudElkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGNiOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS5jbGllbnRfaWQpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1vbm8uc3RvcmFnZS5zZXRFeHBpcmUoewogICAgICAgICAgICAgIHNjQ2xpZW50SWQ6IGRhdGEuY2xpZW50X2lkCiAgICAgICAgICAgIH0sIDIxNjAwKTsKCiAgICAgICAgICAgIHNjLmNsaWVudF9pZCA9IGRhdGEuY2xpZW50X2lkOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgbG9hZENsaWVudElkOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIG1vbm8uc3RvcmFnZS5nZXRFeHBpcmUoJ3NjQ2xpZW50SWQnLCBmdW5jdGlvbihzdG9yYWdlLCBpc0V4cGlyZSkgewogICAgICAgICAgaWYgKHN0b3JhZ2Uuc2NDbGllbnRJZCkgewogICAgICAgICAgICBfdGhpcy5jbGllbnRfaWQgPSBzdG9yYWdlLnNjQ2xpZW50SWQ7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGlzRXhwaXJlKSB7CiAgICAgICAgICAgIF90aGlzLnJlZnJlc2hDbGllbnRJZCgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgcnVuOiBmdW5jdGlvbigpIHsKICAgICAgICBtb2R1bGVTdGF0ZSA9IDE7CiAgICAgICAgdGhpcy5sb2FkQ2xpZW50SWQoKTsKCiAgICAgICAgaWYgKFNhdmVGcm9tX1V0aWxzLm11dGF0aW9uV2F0Y2hlci5pc0F2YWlsYWJsZSgpKSB7CiAgICAgICAgICB0aGlzLm11dGF0aW9uTW9kZS5lbmFibGUoKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBjaGFuZ2VTdGF0ZTogZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICBtb2R1bGVTdGF0ZSA9IHN0YXRlOwogICAgICAgIHNjLm11dGF0aW9uTW9kZS5zdG9wKCk7CiAgICAgICAgc2Mucm1CdG4oKTsKICAgICAgICBpZiAoc3RhdGUpIHsKICAgICAgICAgIHNjLnJ1bigpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIHJtQnRuOiBmdW5jdGlvbigpIHsKICAgICAgICBbJ3NmU2tpcCcsICdzZklkJywgJ3NmU2luZ2xlJ10uZm9yRWFjaChmdW5jdGlvbihhdHRyKSB7CiAgICAgICAgICB2YXIgZGF0YUF0dHIgPSBtb25vLmRhdGFBdHRyMlNlbGVjdG9yKGF0dHIpOwogICAgICAgICAgdmFyIGRhdGFBdHRyTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1snICsgZGF0YUF0dHIgKyAnXScpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgICBpdGVtLnJlbW92ZUF0dHJpYnV0ZShkYXRhQXR0cik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGJ0bkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIHNjLmJ0bkNsYXNzKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGJ0bkxpc3RbaV07IGkrKykgewogICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIG9uR290VHJhY2tJbmZvOiBmdW5jdGlvbihwYXJlbnQsIHJvdywgaW5mbykgewogICAgICAgIGlmICghaW5mbykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBzYy5hcHBlbmRCdXR0b24ocGFyZW50LCByb3csIGluZm8pOwogICAgICB9LAoKICAgICAgaGFuZGxlUm93OiBmdW5jdGlvbihyb3csIHNpbmdsZSkgewogICAgICAgIGlmICghcm93KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgcGFyZW50ID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5zb3VuZEFjdGlvbnMgLnNjLWJ1dHRvbi1ncm91cCcpOwogICAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnbm8gcGFyZW50IScsIHJvdyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoc2luZ2xlKSB7CiAgICAgICAgICBpZiAocGFyZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoc2MuYnRuQ2xhc3MpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBzYy5nZXRUcmFja0luZm8od2luZG93LmxvY2F0aW9uLmhyZWYsIHJvdywgc2Mub25Hb3RUcmFja0luZm8uYmluZChzYywgcGFyZW50LCByb3cpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBhID0gcm93LnF1ZXJ5U2VsZWN0b3IoJ2Euc291bmRfX2NvdmVyQXJ0W2hyZWZdLCBhLnNvdW5kVGl0bGVfX3RpdGxlW2hyZWZdLCBhLnRyYWNrSXRlbVdpdGhFZGl0X190cmFja1RpdGxlW2hyZWZdLCBhLnRyYWNrSXRlbV9fdHJhY2tUaXRsZVtocmVmXSwgLmNoYXJ0VHJhY2tfX3RpdGxlPmFbaHJlZl0nKTsKICAgICAgICBpZiAoYSAhPT0gbnVsbCkgewogICAgICAgICAgc2MuZ2V0VHJhY2tJbmZvKGEuaHJlZiwgcm93LCBzYy5vbkdvdFRyYWNrSW5mby5iaW5kKHNjLCBwYXJlbnQsIHJvdykpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSwKCgogICAgICBnZXRUcmFja0luZm86IGZ1bmN0aW9uKHVybCwgcm93LCBjYikgewogICAgICAgIHVybCA9IHVybC5yZXBsYWNlKC8jLiokL2ksICcnKTsKCiAgICAgICAgaWYgKHVybC5zZWFyY2goL15cL1wvKD86W1x3LV0rXC4pP3NvdW5kY2xvdWRcLmNvbSg/OlxkKyk/XC8vaSkgPiAtMSkgewogICAgICAgICAgdXJsID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgdXJsOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh1cmwuc2VhcmNoKC9odHRwcz86XC9cLy9pKSA9PSAtMSkgewogICAgICAgICAgaWYgKHVybC5jaGFyQXQoMCkgIT0gJy8nKSB7CiAgICAgICAgICAgIHVybCA9ICcvJyArIHVybDsKICAgICAgICAgIH0KCiAgICAgICAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyB1cmw7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2MudHJhY2tzW3VybF0gJiYgc2MudHJhY2tzW3VybF0uY2JMaXN0KSB7CiAgICAgICAgICBzYy50cmFja3NbdXJsXS5jYkxpc3QucHVzaChjYik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoc2MudHJhY2tzW3VybF0gJiYgIXNjLnRyYWNrc1t1cmxdLmNiTGlzdCkgewogICAgICAgICAgY2Ioc2MudHJhY2tzW3VybF0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIG9iaiA9IHNjLnRyYWNrc1t1cmxdID0gewogICAgICAgICAgY2JMaXN0OiBbY2JdCiAgICAgICAgfTsKCiAgICAgICAgdmFyIHJlcXVlc3QgPSB7CiAgICAgICAgICBhY3Rpb246ICdnZXRTb3VuZGNsb3VkVHJhY2tJbmZvJywKICAgICAgICAgIHRyYWNrVXJsOiB1cmwsCiAgICAgICAgICBjbGllbnRfaWQ6IHNjLmNsaWVudF9pZAogICAgICAgIH07CgogICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UocmVxdWVzdCwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgIHNjLnRyYWNrc1t1cmxdID0gc2Muc2V0VHJhY2tJbmZvKHJlc3BvbnNlKTsKCiAgICAgICAgICB2YXIgY2I7CiAgICAgICAgICB3aGlsZSAoY2IgPSBvYmouY2JMaXN0LnNoaWZ0KCkpIHsKICAgICAgICAgICAgY2Ioc2MudHJhY2tzW3VybF0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgc2V0VHJhY2tJbmZvOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIHVybCA9IGRhdGEudHJhY2tVcmw7CiAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHRJbmZvID0ge307CgogICAgICAgIHZhciBpbmZvID0gZGF0YS5kYXRhOwogICAgICAgIGlmICghaW5mbykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGluZm8ua2luZCAhPSAndHJhY2snICYmIGluZm8udHJhY2tzICYmIGluZm8udHJhY2tzLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICBpbmZvID0gaW5mby50cmFja3NbMF07CiAgICAgICAgfQoKICAgICAgICBpZiAoaW5mby5raW5kID09ICd0cmFjaycgJiYgaW5mby5zdHJlYW1fdXJsKSB7CiAgICAgICAgICBzYy5zZXRTaW5nbGVUcmFja1BhcmFtcyh0SW5mbywgaW5mbyk7CiAgICAgICAgICB0SW5mby5jaGVja0xpbmtzID0gZGF0YS5jaGVja0xpbmtzOwogICAgICAgICAgcmV0dXJuIHRJbmZvOwogICAgICAgIH0KCiAgICAgICAgaWYgKGluZm8udHJhY2tzKSB7CiAgICAgICAgICB2YXIgcGxheWxpc3QgPSBbXTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBpbmZvLnRyYWNrcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICB2YXIgdCA9IHt9OwogICAgICAgICAgICBzYy5zZXRTaW5nbGVUcmFja1BhcmFtcyh0LCBpbmZvLnRyYWNrc1tpXSk7CiAgICAgICAgICAgIHBsYXlsaXN0LnB1c2godCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBsYXlsaXN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaWYgKGluZm8udGl0bGUpIHsKICAgICAgICAgICAgICB0SW5mby50aXRsZSA9IGluZm8udGl0bGU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRJbmZvLnBsYXlsaXN0ID0gcGxheWxpc3Q7CiAgICAgICAgICAgIHRJbmZvLmNoZWNrTGlua3MgPSBkYXRhLmNoZWNrTGlua3M7CiAgICAgICAgICAgIHJldHVybiB0SW5mbzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCgoKICAgICAgc2V0U2luZ2xlVHJhY2tQYXJhbXM6IGZ1bmN0aW9uKHRyYWNrLCBpbmZvKSB7CiAgICAgICAgdmFyIGRvd25sb2FkVXJsID0gaW5mby5zdHJlYW1fdXJsOwogICAgICAgIGRvd25sb2FkVXJsICs9IChkb3dubG9hZFVybC5pbmRleE9mKCc/JykgPT0gLTEpID8gJz8nIDogJyYnOwogICAgICAgIGRvd25sb2FkVXJsICs9ICdjbGllbnRfaWQ9JyArIHNjLmNsaWVudF9pZDsKICAgICAgICB0cmFjay51cmwgPSBkb3dubG9hZFVybDsKCiAgICAgICAgdmFyIHBhcmFtID0gWydpZCcsICd0aXRsZScsICdkdXJhdGlvbiddOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFyYW0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChpbmZvW3BhcmFtW2ldXSkgewogICAgICAgICAgICB0cmFja1twYXJhbVtpXV0gPSBpbmZvW3BhcmFtW2ldXTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0cmFjay50aXRsZSAmJiBpbmZvLnVzZXIgJiYgaW5mby51c2VyLnVzZXJuYW1lKSB7CiAgICAgICAgICB0cmFjay50aXRsZSA9IGluZm8udXNlci51c2VybmFtZSArICcgLSAnICsgdHJhY2sudGl0bGU7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgb25EbEJ0bkNsaWNrOiBmdW5jdGlvbihlKSB7CiAgICAgICAgU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRPbkNsaWNrKGUpOwoKICAgICAgICBpZiAoWzFdLmluZGV4T2YocHJlZmVyZW5jZS5jb2hvcnRJbmRleCkgIT09IC0xKSB7CiAgICAgICAgICB2YXIgaXNTaW5nbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubC1saXN0ZW4tZW5nYWdlbWVudCcpOwogICAgICAgICAgdmFyIGlzUmVjb21tZW5kZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2lkZWJhck1vZHVsZSAuc2lkZWJhckNvbnRlbnQgLnNvdW5kQmFkZ2VMaXN0Jyk7CiAgICAgICAgICB2YXIgaXNQbGF5bGlzdERldGFpbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0ZW5EZXRhaWxzIC5saXN0ZW5EZXRhaWxzX190cmFja0xpc3QnKTsKICAgICAgICAgIGlmIChpc1NpbmdsZSAmJiBpc1NpbmdsZS5jb250YWlucyh0aGlzKSkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ3NvdW5kY2xvdWQnLAogICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgIGVsOiAnbXVzaWMtc2luZ2xlJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKGlzUmVjb21tZW5kZWQgJiYgaXNSZWNvbW1lbmRlZC5jb250YWlucyh0aGlzKSkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ3NvdW5kY2xvdWQnLAogICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgIGVsOiAnbXVzaWMtcmVjb21tZW5kJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKGlzUGxheWxpc3REZXRhaWwgJiYgaXNQbGF5bGlzdERldGFpbC5jb250YWlucyh0aGlzKSkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ3NvdW5kY2xvdWQnLAogICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgIGVsOiAnbXVzaWMtcGxheWxpc3Qtc2luZ2xlJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgIGVjOiAnc291bmRjbG91ZCcsCiAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgZWw6ICdtdXNpYy1saXN0JwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCgogICAgICBhcHBlbmRCdXR0b246IGZ1bmN0aW9uKHBhcmVudCwgcm93LCBpbmZvKSB7CiAgICAgICAgdmFyIHRyYWNrID0gaW5mbzsKCiAgICAgICAgLy8gdXBkYXRlIHBhcmVudCBhZnRlciBsYXRlbmN5CiAgICAgICAgaWYgKCFkb2N1bWVudC5ib2R5LmNvbnRhaW5zKHJvdykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAoIWRvY3VtZW50LmJvZHkuY29udGFpbnMocGFyZW50KSkgewogICAgICAgICAgcGFyZW50ID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5zb3VuZEFjdGlvbnMgLnNjLWJ1dHRvbi1ncm91cCcpOwogICAgICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHJvdy5kYXRhc2V0LnNmU2tpcCA+IDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcm93LmRhdGFzZXQuc2ZTa2lwID0gJzInOwoKICAgICAgICB2YXIgYnRuQ2xhc3MgPSBbJ3NjLWJ1dHRvbi1zbWFsbCcsICdzYy1idXR0b24tbWVkaXVtJywgJ3NjLWJ1dHRvbi1sYXJnZSddOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnRuQ2xhc3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChwYXJlbnQucXVlcnlTZWxlY3RvcignLicgKyBidG5DbGFzc1tpXSkpIHsKICAgICAgICAgICAgYnRuQ2xhc3MgPSBbYnRuQ2xhc3NbaV1dOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CgogICAgICAgIHZhciBzZklkID0gcm93LmRhdGFzZXQuc2ZJZDsKICAgICAgICBpZiAoc2ZJZCkgewogICAgICAgICAgYS5kYXRhc2V0LnNmUGFyZW50SWQgPSByb3cuZGF0YXNldC5zZklkOwogICAgICAgIH0KCiAgICAgICAgYS5jbGFzc05hbWUgPSBzYy5idG5DbGFzcyArICcgc2MtYnV0dG9uIHNjLWJ1dHRvbi1yZXNwb25zaXZlICcgKyBidG5DbGFzc1swXTsKICAgICAgICBhLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKCiAgICAgICAgdmFyIGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKCiAgICAgICAgaWYgKHRyYWNrLnBsYXlsaXN0KSB7CiAgICAgICAgICBhLmhyZWYgPSAnIyc7CiAgICAgICAgICBhLnRpdGxlID0gbGFuZ3VhZ2UucGxheWxpc3Q7CgogICAgICAgICAgdmFyIHRpdGxlID0gdHJhY2sudGl0bGUgPyBtb25vLmZpbGVOYW1lLm1vZGlmeSh0cmFjay50aXRsZSkgOiAnc291bmRjbG91ZCc7CgogICAgICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMucGxheWxpc3QucG9wdXBQbGF5bGlzdCh0cmFjay5wbGF5bGlzdCwgdGl0bGUsIHRydWUpOwogICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgfSwgZmFsc2UpOwoKICAgICAgICAgIGlmICh0cmFjay5jaGVja0xpbmtzID09PSBmYWxzZSkgewogICAgICAgICAgICBpY29uLnNyYyA9ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUE4QUFBQVBDQVlBQUFBNzFwVktBQUFBSkVsRVFWUW96MlA0Ly84L0E3bVlnV3FhNit2ci94UEN0TkU4NnVkUlA5UFd6NlJpQU5VNGhVWUdORHBPQUFBQUFFbEZUa1N1UW1DQyc7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpY29uLnNyYyA9ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUE4QUFBQVBDQVlBQUFBNzFwVktBQUFBTVVsRVFWUjQybUw4Ly84L0E3bUFpWUVDd0lMQzgyVWs3SXpOL3htcFlqUGpxSjlIL1V4VFAxT2tHUUFBQVAvL0F3RGNhaFVWNlV2eUp3QUFBQUJKUlU1RXJrSmdnZz09JzsKICAgICAgICAgIH0KICAgICAgICAgIGljb24uYWx0ID0gbGFuZ3VhZ2UucGxheWxpc3Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0cmFjay5jaGVja0xpbmtzID09PSBmYWxzZSkgewogICAgICAgICAgICBhLmhyZWYgPSAnIyc7CiAgICAgICAgICAgIGEudGl0bGUgPSBsYW5ndWFnZS5ub0xpbmtzRm91bmQ7CgogICAgICAgICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICB2YXIgc3R5bGUgPSB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmJywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjNzc3JywKICAgICAgICAgICAgICAgIHBhZGRpbmc6ICcycHggNXB4IDNweCcKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLnNob3dUb29sdGlwKHRoaXMsIGxhbmd1YWdlLm5vTGlua3NGb3VuZCwgdW5kZWZpbmVkLCBzdHlsZSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWNvbi5zcmMgPSAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBOEFBQUFQQ0FZQUFBQTcxcFZLQUFBQVZrbEVRVlFvejJQNC8vOC9BN21ZZ1NxYTBVRjlmZjEvR0VhWEcwU2FnWXJtSTJ2QWcrZGp0WmtJQStiamRUWWVBK1lUNVdjc0Jzd25OY0RtWTlOSWxHYW9BUW5ZeEhFRkdNSFF4cWU1Z1JER3FwbnVHUU1BTG1ES2hramM5b1lBQUFBQVNVVk9SSzVDWUlJPSc7CiAgICAgICAgICAgIGljb24uYWx0ID0gJ25vTGlua3NGb3VuZCcKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGEuaHJlZiA9IHRyYWNrLnVybDsKICAgICAgICAgICAgYS50aXRsZSA9IGxhbmd1YWdlLmRvd25sb2FkOwoKICAgICAgICAgICAgaWYgKHRyYWNrLnRpdGxlKSB7CiAgICAgICAgICAgICAgYS5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywKICAgICAgICAgICAgICAgIG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRyYWNrLnRpdGxlLnRyaW0oKSArICcubXAzJykpOwoKICAgICAgICAgICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkRsQnRuQ2xpY2ssIGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWNvbi5zcmMgPSAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBOEFBQUFQQ0FZQUFBQTcxcFZLQUFBQVBrbEVRVlI0Mm1OZ0dIVGd2dy9EZnhnZXhKcUJpdVlqYThDRDU1TnJ3SHh5WFRDZldQL09KMHNqRmdQbWt4dlhDV1JGRHk2TVQzTURJVHc0MGo4QWs0NkhZUTRnRGZVQUFBQUFTVVZPUks1Q1lJST0nOwogICAgICAgICAgICBpY29uLmFsdCA9ICdkb3dubG9hZCc7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBTYXZlRnJvbV9VdGlscy5zZXRTdHlsZShpY29uLCB7CiAgICAgICAgICB3aWR0aDogJzE1cHgnLAogICAgICAgICAgaGVpZ2h0OiAnMTVweCcsCiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgIHRvcDogJzUwJScsCiAgICAgICAgICBsZWZ0OiAnNTAlJywKICAgICAgICAgIG1hcmdpbjogJy03cHggMCAwIC03cHgnCiAgICAgICAgfSk7CiAgICAgICAgYS5hcHBlbmRDaGlsZChpY29uKTsKCiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGEpOwoKICAgICAgICBpY29uID0gbnVsbDsKICAgICAgICBhID0gbnVsbDsKICAgICAgICBwYXJlbnQgPSBudWxsOwogICAgICB9LAogICAgICBtdXRhdGlvbk1vZGU6IHsKICAgICAgICBvYnNlcnZlcjogbnVsbCwKICAgICAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChzYy5tdXRhdGlvbk1vZGUub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgc2MubXV0YXRpb25Nb2RlLm9ic2VydmVyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoc2MubXV0YXRpb25Nb2RlLm9ic2VydmVyKSB7CiAgICAgICAgICAgIHJldHVybiBzYy5tdXRhdGlvbk1vZGUub2JzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb25UcmFja092ZXJUciA9IG1vbm8udGhyb3R0bGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIG1vbm8ub2ZmKHRoaXMsICdtb3VzZWVudGVyJywgb25UcmFja092ZXJUcik7CiAgICAgICAgICAgIGlmICghbW9kdWxlU3RhdGUpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNjLmhhbmRsZVJvdy5jYWxsKHNjLCB0aGlzKTsKICAgICAgICAgIH0sIDc1MCk7CgogICAgICAgICAgc2MubXV0YXRpb25Nb2RlLm9ic2VydmVyID0gU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLnJ1bih7CiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdW1tYXJ5TGlzdCkgewogICAgICAgICAgICAgIHZhciBzdW1tYXJ5LCBuLCBpLCBub2RlOwogICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFtpXTsKICAgICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmSWQgPSAnJyArIHNjLm5vZGVJZCsrOwoKICAgICAgICAgICAgICAgICAgbW9uby5vbihub2RlLCAnbW91c2VlbnRlcicsIG9uVHJhY2tPdmVyVHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKGkgPSA2OyBpIDwgODsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbaV07CiAgICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfbm9kZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGlmIChpID09PSA2KSB7CiAgICAgICAgICAgICAgICAgICAgX25vZGUgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3Mobm9kZSwgJ2xpc3RlbkVuZ2FnZW1lbnQnKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfbm9kZSA9IG1vbm8uZ2V0UGFyZW50QnlDbGFzcyhub2RlLCAndmlzdWFsU291bmQnKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKF9ub2RlLmRhdGFzZXQuc2ZTaW5nbGUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgX25vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgICBpZiAoX25vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdzdHJlYW1Db250ZXh0JykpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIF9ub2RlLmRhdGFzZXQuc2ZTaW5nbGUgPSAnMSc7CgogICAgICAgICAgICAgICAgICBzYy5oYW5kbGVSb3coX25vZGUsIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzhdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LnJlbW92ZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgbm9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1snICsgbW9uby5kYXRhQXR0cjJTZWxlY3Rvcignc2ZJZCcpICsgJz0iJyArIG5vZGUuZGF0YXNldC5zZlBhcmVudElkICsgJyJdJyk7CgogICAgICAgICAgICAgICAgaWYgKCFub2RlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2luZ2xlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5ib2R5LmNvbnRhaW5zKG5vZGUpKSB7CiAgICAgICAgICAgICAgICAgIHNjLmhhbmRsZVJvdyhub2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHF1ZXJpZXM6IFt7CiAgICAgICAgICAgICAgY3NzOiAnbGkudHJhY2tMaXN0X19pdGVtJywKICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAnbGkuY29tcGFjdFRyYWNrTGlzdF9faXRlbScsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ2xpLnNlYXJjaExpc3RfX2l0ZW0nLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICdsaS5zb3VuZExpc3RfX2l0ZW0nLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICdsaS5zb3VuZEJhZGdlTGlzdF9faXRlbScsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ2xpLmNoYXJ0VHJhY2tzX19pdGVtJywKICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAnZGl2Lmxpc3RlbkVuZ2FnZW1lbnQgLnNvdW5kQWN0aW9ucyAuc2MtYnV0dG9uLWdyb3VwJywKICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAnZGl2LnZpc3VhbFNvdW5kIC5zb3VuZEFjdGlvbnMgLnNjLWJ1dHRvbi1ncm91cCcsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5zYXZlZnJvbS1oZWxwZXItLWJ0bicsCiAgICAgICAgICAgICAgaXM6ICdyZW1vdmVkJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgZmlsdGVyVGFyZ2V0OiBbewogICAgICAgICAgICAgIGNzczogJ2Rpdi53YXZlZm9ybV9fbGF5ZXInCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICdhLmNvbW1lbnRQb3BvdmVyX191c2VybmFtZScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5jb21tZW50UG9wb3ZlcicKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ2Rpdi5wbGF5YmFja1RpbWVsaW5lX190aW1lUGFzc2VkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAnZGl2LmNvbW1lbnRzTGlzdCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ2Rpdi5jb21tZW50c0xpc3RfX2l0ZW0nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICdkaXYuY29tbWVudHNMaXN0X19ib2R5JwogICAgICAgICAgICB9XQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICB9LCBudWxsLCBmdW5jdGlvbiBzeW5jSXNBY3RpdmUoKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vKi5zb3VuZGNsb3VkLmNvbS8qJwogICAgICBdOwoKICAgICAgdmFyIHJlU3RyID0gbGlzdC5tYXAoZnVuY3Rpb24ocGF0dGVybikgewogICAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgICB9KS5qb2luKCd8Jyk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAocmVTdHIpOwoKICAgICAgaWYgKCFyZS50ZXN0KGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGlmIChtb25vLmlzSWZyYW1lKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgnc292ZXRuaWsnLCBmdW5jdGlvbihtb2R1bGVOYW1lLCBpbml0RGF0YSkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHByZWZlcmVuY2UgPSBpbml0RGF0YS5nZXRQcmVmZXJlbmNlOwoKICAgIHZhciBvblNjcmlwdFN0YXJ0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsaW1pdCA9IDMwOwogICAgICB2YXIgc2xpY2UgPSBbXS5zbGljZTsKICAgICAgdmFyIGludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGlkID0gbnVsbDsKCiAgICAgICAgdmFyIGZvdW5kID0gc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdib2R5IHN0eWxlK2RpdltpZF0+ZGl2W2NsYXNzXTpub3QoW2lkXSk+aW1nW3NyY10nKSkuc29tZShmdW5jdGlvbihub2RlKSB7CiAgICAgICAgICBpZiAoIS9eZGF0YTppbWFnZVwvcG5nOy8udGVzdChub2RlLnNyYykpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwYXJlbnQgPSBub2RlLnBhcmVudE5vZGUgJiYgbm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGU7CiAgICAgICAgICBpZiAoIXBhcmVudCB8fCAhL15tLy50ZXN0KHBhcmVudC5pZCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBsaW5rID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ2FbaHJlZl0nKTsKICAgICAgICAgIGlmICghbGluayB8fCAhL3lhbmRleC8udGVzdChsaW5rLmhyZWYpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZCA9ICcjJyArIHBhcmVudC5pZDsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pOwoKICAgICAgICBsaW1pdC0tOwogICAgICAgIGlmIChsaW1pdCA8IDAgfHwgZm91bmQpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpOwogICAgICAgIH0KCiAgICAgICAgZm91bmQgJiYgYWRkTGlzdGVuZXIoaWQpOwogICAgICB9LCAxMDAwKTsKCiAgICAgIHZhciBhZGRMaXN0ZW5lciA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpOwogICAgICAgIGlmICghY29udGFpbmVyKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgIGFjdGlvbjogJ3RyYWNrJywKICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICBlYzogJ3NvdmV0bmlrJywKICAgICAgICAgIGVhOiAnc2hvdycsCiAgICAgICAgICBlbDogJ2JhcicsCiAgICAgICAgICB0aWQ6ICdVQS02NzczODEzMC0zJwogICAgICAgIH0pOwoKICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgaWYgKGUuYnV0dG9uICE9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbGluayA9IGUudGFyZ2V0OwogICAgICAgICAgd2hpbGUgKGxpbmspIHsKICAgICAgICAgICAgaWYgKGxpbmsudGFnTmFtZSA9PT0gJ0EnKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpbmsudGFnTmFtZSA9PT0gJ1RSJyAmJiBsaW5rLmRhdGFzZXQudXJsKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxpbmsgPSBsaW5rLnBhcmVudE5vZGU7CiAgICAgICAgICAgIGlmIChsaW5rICYmIGxpbmsgPT09IGNvbnRhaW5lcikgewogICAgICAgICAgICAgIGxpbmsgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFsaW5rKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaHJlZiA9IG51bGw7CiAgICAgICAgICBpZiAobGluay50YWdOYW1lID09PSAnQScpIHsKICAgICAgICAgICAgaHJlZiA9IGxpbmsuZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobGluay50YWdOYW1lID09PSAnVFInKSB7CiAgICAgICAgICAgIGhyZWYgPSBsaW5rLmRhdGFzZXQudXJsOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHR5cGUgPSBudWxsOwogICAgICAgICAgaWYgKCFocmVmKSB7CiAgICAgICAgICAgIHZhciBwcmV2ID0gbGluay5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwogICAgICAgICAgICB2YXIgbmV4dCA9IGxpbmsubmV4dEVsZW1lbnRTaWJsaW5nOwogICAgICAgICAgICBpZiAoIW5leHQgfHwgbmV4dC50YWdOYW1lICE9PSAnQScgfHwgIW5leHQucXVlcnlTZWxlY3Rvcignc3BhbicpKSB7CiAgICAgICAgICAgICAgbmV4dCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5leHQgJiYgbmV4dC5uZXh0RWxlbWVudFNpYmxpbmcpIHsKICAgICAgICAgICAgICBuZXh0ID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcGFyZW50ID0gbGluay5wYXJlbnROb2RlOwogICAgICAgICAgICBpZiAocGFyZW50ICYmIHBhcmVudC5wYXJlbnROb2RlICE9PSBjb250YWluZXIpIHsKICAgICAgICAgICAgICBwYXJlbnQgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LmNoaWxkRWxlbWVudENvdW50ICE9PSAyKSB7CiAgICAgICAgICAgICAgcGFyZW50ID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFyZW50ICYmICFwcmV2ICYmIG5leHQpIHsKICAgICAgICAgICAgICB0eXBlID0gJ1Nob3cgYnV0dG9uJzsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlCiAgICAgICAgICBpZiAoL3NvdmV0bmlrXC5tYXJrZXRcLnlhbmRleC8udGVzdChocmVmKSkgewogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gaHJlZi5tYXRjaCgvWz8mXXRhcmdldD0oW14mXSspLyk7CiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldCAmJiB0YXJnZXRbMV07CgogICAgICAgICAgICB0eXBlID0gdGFyZ2V0IHx8ICd1bmtub3duIGJ0bic7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAndHJhY2snLAogICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICBlYzogJ3NvdmV0bmlrJywKICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgIGVsOiB0eXBlLAogICAgICAgICAgICB0aWQ6ICdVQS02NzczODEzMC0zJywKICAgICAgICAgICAgZXY6IDIKICAgICAgICAgIH0pOwogICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrJywKICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgZWM6ICdzb3ZldG5paycsCiAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICBlbDogdHlwZSwKICAgICAgICAgICAgdGlkOiAnVUEtNzA1NTA1NS01JywKICAgICAgICAgICAgZXY6IDIKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9OwogICAgfTsKCiAgICB2YXIgZG9tYWluID0gZG9jdW1lbnQuZG9tYWluOwoKICAgIGlmICgvXnd3dy4vLnRlc3QoZG9tYWluKSkgewogICAgICBkb21haW4gPSBkb21haW4uc2xpY2UoNCk7CiAgICB9CgogICAgdmFyIHNldHRpbmdzID0gewogICAgICBhZmZJZDogMTAyMCwKICAgICAgY2xpZDogMjIxMDQ5NiwKICAgICAgYXBwbGljYXRpb25OYW1lOiAnU2F2ZUZyb20nLAogICAgICBhdmlhRW5hYmxlZDogdHJ1ZSwKICAgICAgb2ZmZXJFbmFibGVkOiB0cnVlCiAgICB9OwoKICAgIHZhciBnZXRVcmwgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGZpbGVQYXRoID0gJy8vZGwubWV0YWJhci5ydS9zdGF0aWMvanMvc292ZXRuaWsubWluLmpzJzsKICAgICAgcmV0dXJuIGZpbGVQYXRoICsKICAgICAgICAnP21icj10cnVlJnNldHRpbmdzPScgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoc2V0dGluZ3MpKTsKICAgIH07CgogICAgdmFyIHVybCA9IGdldFVybCgpOwoKICAgIHZhciBleHRTdG9yYWdlID0gewogICAgICBnZXQ6IGZ1bmN0aW9uKG9iaiwgY2IpIHsKICAgICAgICByZXR1cm4gbW9uby5zdG9yYWdlLmdldChvYmosIGNiKTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbihvYmosIGNiKSB7CiAgICAgICAgaWYgKHByZWZlcmVuY2Uuc292ZXRuaWtFbmFibGVkID09PSAxKSB7CiAgICAgICAgICBpZiAob2JqLnNvdmV0bmlrUmVtb3ZlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd1cGRhdGVPcHRpb24nLAogICAgICAgICAgICAgIGtleTogJ3NvdmV0bmlrRW5hYmxlZCcsCiAgICAgICAgICAgICAgdmFsdWU6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmIChvYmouc292ZXRuaWtPZmZlckFjY2VwdGVkID09PSBmYWxzZSkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd1cGRhdGVPcHRpb24nLAogICAgICAgICAgICAgIGtleTogJ3NvdmV0bmlrRW5hYmxlZCcsCiAgICAgICAgICAgICAgdmFsdWU6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBtb25vLnN0b3JhZ2Uuc2V0KG9iaiwgY2IpOwogICAgICB9LAogICAgICByZW1vdmU6IGZ1bmN0aW9uKG9iaiwgY2IpIHsKICAgICAgICByZXR1cm4gbW9uby5zdG9yYWdlLnJlbW92ZShvYmosIGNiKTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgaW5qZWN0b3IgPSB7CiAgICAgIC8qKgogICAgICAgKiBpbmplY3Qgc2NyaXB0IHRvIHRoZSBwYWdlCiAgICAgICAqLwogICAgICBpbmplY3Q6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghbW9uby5pc0lmcmFtZSgpKSB7CiAgICAgICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgICBzY3JpcHQuYXN5bmMgPSAxOwogICAgICAgICAgc2NyaXB0LnNyYyA9IHVybDsKICAgICAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ2NoYXJzZXQnLCAnVVRGLTgnKTsKICAgICAgICAgIGlmIChkb2N1bWVudC5ib2R5KSB7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgICAgICAgICAgb25TY3JpcHRTdGFydCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBjaGVjayBhdmFpbGFiaWxpdHkgZm9yIGluamVjdGluZyAoaXMgZG9tYWluIGluIGJsYWNrbGlzdCwgaGFzIHNvdmV0bmlrIGJlZW4gcmVtb3ZlZCBvciBoYXMgc292ZXRuaWsgYmVlbiBkaXNhYmxlZCkKICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGRvbWFpbgogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sKICAgICAgICovCiAgICAgIGNhbkluamVjdDogZnVuY3Rpb24oZG9tYWluLCBzdWNjZXNzQ2FsbGJhY2spIHsKICAgICAgICB0aGlzLmxpc3RlblNjcmlwdE1lc3NhZ2VzKCk7CgogICAgICAgIGV4dFN0b3JhZ2UuZ2V0KFsnc292ZXRuaWtCbGFja2xpc3QnLCAnc292ZXRuaWtSZW1vdmVkJywgJ3NvdmV0bmlrVXBkYXRlVGltZScsICdzb3ZldG5pa0Rpc2FibGVkJ10sIGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIGlmICghKChkYXRhLnNvdmV0bmlrQmxhY2tsaXN0ICYmIGRhdGEuc292ZXRuaWtCbGFja2xpc3RbZG9tYWluXSkgfHwgZGF0YS5zb3ZldG5pa1JlbW92ZWQgfHwgZGF0YS5zb3ZldG5pa0Rpc2FibGVkKSkgewogICAgICAgICAgICBzdWNjZXNzQ2FsbGJhY2soKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEuc292ZXRuaWtVcGRhdGVUaW1lID0gZGF0YS5zb3ZldG5pa1VwZGF0ZVRpbWUgfHwgMDsKICAgICAgICAgIGlmIChEYXRlLm5vdygpIC0gZGF0YS5zb3ZldG5pa1VwZGF0ZVRpbWUgPiA2MDQ4MDAwMDApIHsgLy8gb25lIHdlZWsKICAgICAgICAgICAgZXh0U3RvcmFnZS5zZXQoewogICAgICAgICAgICAgIHNvdmV0bmlrVXBkYXRlVGltZTogRGF0ZS5ub3coKSwKICAgICAgICAgICAgICBzb3ZldG5pa1JlbW92ZWQ6IGZhbHNlLAogICAgICAgICAgICAgIHNvdmV0bmlrQmxhY2tsaXN0OiB7fQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBhZGQgZG9tYWluIHRvIHRoZSBibGFja2xpc3QKICAgICAgICogQHBhcmFtIGRvbWFpbgogICAgICAgKi8KICAgICAgYWRkVG9CbGFja2xpc3Q6IGZ1bmN0aW9uKGRvbWFpbikgewogICAgICAgIGV4dFN0b3JhZ2UuZ2V0KCdzb3ZldG5pa0JsYWNrbGlzdCcsIGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIGRhdGEuc292ZXRuaWtCbGFja2xpc3QgPSBkYXRhLnNvdmV0bmlrQmxhY2tsaXN0IHx8IHt9OwogICAgICAgICAgZGF0YS5zb3ZldG5pa0JsYWNrbGlzdFtkb21haW5dID0gdHJ1ZTsKICAgICAgICAgIGV4dFN0b3JhZ2Uuc2V0KGRhdGEpOwogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWUKICAgICAgICovCiAgICAgIHNldFNvdmV0bmlrUmVtb3ZlZFN0YXRlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICBleHRTdG9yYWdlLnJlbW92ZSgnc292ZXRuaWtSZW1vdmVkJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4dFN0b3JhZ2Uuc2V0KHsKICAgICAgICAgICAgc292ZXRuaWtSZW1vdmVkOiB2YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdmFsdWUKICAgICAgICovCiAgICAgIHNldE9mZmVyU3RhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIGV4dFN0b3JhZ2UucmVtb3ZlKCdzb3ZldG5pa09mZmVyQWNjZXB0ZWQnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZXh0U3RvcmFnZS5zZXQoewogICAgICAgICAgICBzb3ZldG5pa09mZmVyQWNjZXB0ZWQ6IHZhbHVlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogd2luZG93LnBvc3RNZXNzYWdlIGZyb20gc2NyaXB0IGhhbmRsZXIKICAgICAgICogQHBhcmFtIGRhdGEKICAgICAgICovCiAgICAgIG9uU2NyaXB0TWVzc2FnZTogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHN3aXRjaCAoZGF0YS5jb21tYW5kKSB7CiAgICAgICAgICBjYXNlICdibGFja2xpc3QnOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdGhpcy5hZGRUb0JsYWNrbGlzdChkYXRhLnZhbHVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSAncmVtb3ZlZCc6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB0aGlzLnNldFNvdmV0bmlrUmVtb3ZlZFN0YXRlKGRhdGEudmFsdWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlICdvZmZlckFjY2VwdGVkJzoKICAgICAgICAgICAgdGhpcy5zZXRPZmZlclN0YXRlKGRhdGEudmFsdWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogd2luZG93LnBvc3RNZXNzYWdlIGhhbmRsZXIKICAgICAgICovCiAgICAgIGxpc3RlblNjcmlwdE1lc3NhZ2VzOiBmdW5jdGlvbigpIHsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgICAgIGlmIChtZXNzYWdlICYmIG1lc3NhZ2UuZGF0YSAmJiBtZXNzYWdlLmRhdGEudHlwZSA9PT0gJ01CUl9FTlZJUk9OTUVOVCcpIHsKICAgICAgICAgICAgdGhpcy5vblNjcmlwdE1lc3NhZ2UobWVzc2FnZS5kYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9LmJpbmQodGhpcyksIGZhbHNlKTsKICAgICAgfQogICAgfTsKCiAgICBpbmplY3Rvci5jYW5JbmplY3QoZG9tYWluLCBpbmplY3Rvci5pbmplY3QuYmluZChpbmplY3RvcikpOwogIH0sIGZ1bmN0aW9uIGlzQWN0aXZlKGluaXREYXRhKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAobW9uby5nbG9iYWwuZXhBdmlhQmFyKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB2YXIgcHJlZmVyZW5jZSA9IGluaXREYXRhLmdldFByZWZlcmVuY2U7CgogICAgaWYgKCFwcmVmZXJlbmNlLmhhc1NvdmV0bmlrKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoIXByZWZlcmVuY2Uuc292ZXRuaWtFbmFibGVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAobW9uby5nbG9iYWwuZGRibEFkdikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBtb25vLmdsb2JhbC5kZGJsQWR2ID0gdHJ1ZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9LCBmdW5jdGlvbiBzeW5jSXNBdmFpbGFibGUoKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAoIWRvY3VtZW50LmRvbWFpbikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG1vbm8uaXNJZnJhbWUoKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0ZGIHx8IG1vbm8uaXNHTSkgewogICAgICB2YXIgZXhjbHVkZUxpc3QgPSBbCiAgICAgICAgJ2Z0cDovLyonLAogICAgICAgICdmaWxlOi8vKicsCiAgICAgICAgJyo6Ly8qLmdvb2dsZS4qLyonLAogICAgICAgICcqOi8vKi5hY2lkdGVzdHMub3JnLyonLAoKICAgICAgICAnKjovLyouc2F2ZWZyb20ubmV0LyonLAogICAgICAgICcqOi8vKi55b3V0dWJlLmNvbS8qJywKICAgICAgICAnKjovLyoudmltZW8uY29tLyonLAogICAgICAgICcqOi8vKi5kYWlseW1vdGlvbi4qLyonLAogICAgICAgICcqOi8vKi52ay5jb20vKicsCiAgICAgICAgJyo6Ly8qLnZrb250YWt0ZS5ydS8qJywKICAgICAgICAnKjovLyoub2Rub2tsYXNzbmlraS5ydS8qJywKICAgICAgICAnKjovLyoub2sucnUvKicsCiAgICAgICAgJyo6Ly9teS5tYWlsLnJ1LyonLAogICAgICAgICcqOi8vKi5zb3VuZGNsb3VkLmNvbS8qJywKICAgICAgICAnKjovLyouZmFjZWJvb2suY29tLyonLAogICAgICAgICcqOi8vKi5pbnN0YWdyYW0uY29tLyonLAogICAgICAgICcqOi8vKi5ydXR1YmUucnUvKicKICAgICAgXTsKCiAgICAgIHZhciByZVN0ciA9IGV4Y2x1ZGVMaXN0Lm1hcChmdW5jdGlvbihwYXR0ZXJuKSB7CiAgICAgICAgcmV0dXJuIG1vbm8udXJsUGF0dGVyblRvU3RyUmUocGF0dGVybik7CiAgICAgIH0pLmpvaW4oJ3wnKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChyZVN0cik7CgogICAgICBpZiAocmUudGVzdChsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0bmFtZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgaW5XaGl0ZUxpc3QgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGxpc3QgPSBbCiAgICAgICAgImFkaWRhcy5ydSIsCiAgICAgICAgImFnZW50LnJ1IiwKICAgICAgICAiYWlyYmVybGluLmNvbSIsCiAgICAgICAgImFpcmZyYW5jZS5ydSIsCiAgICAgICAgImFsaXRhbGlhLmNvbSIsCiAgICAgICAgImFsbDQucnUiLAogICAgICAgICJhbWF6b24uZGUiLAogICAgICAgICJhbnl3YXlhbnlkYXkuY29tIiwKICAgICAgICAiYXZpYS5ldXJvc2V0LnJ1IiwKICAgICAgICAiYXZpYS50cmF2ZWwucnUiLAogICAgICAgICJhdmlhLnR1dHUucnUiLAogICAgICAgICJhdmlhY2Fzc2EucnUiLAogICAgICAgICJhdml0by5ydSIsCiAgICAgICAgImF3cy5hbWF6b24uY29tIiwKICAgICAgICAiYmlsZXRpeC5ydSIsCiAgICAgICAgImJvb2subHVmdGhhbnNhLmNvbSIsCiAgICAgICAgImJvb2tpbmcudXRhaXIucnUiLAogICAgICAgICJicmF2b2F2aWEucnUiLAogICAgICAgICJicml0aXNoYWlyd2F5cy5jb20iLAogICAgICAgICJjYW5vbi5ydSIsCiAgICAgICAgImNocm9ubzI0LmNvbS5ydSIsCiAgICAgICAgImNpdGlsaW5rLnJ1IiwKICAgICAgICAiZG9tYWxpbmEucnUiLAogICAgICAgICJkcHJldmlldy5jb20iLAogICAgICAgICJlbmdhZGdldC5jb20iLAogICAgICAgICJmaW5uYWlyLmNvbSIsCiAgICAgICAgImhhcm9sZGx0ZC5ydSIsCiAgICAgICAgImhpbHRpLnJ1IiwKICAgICAgICAiaWJlcmlhLmNvbSIsCiAgICAgICAgImludGVyc2hvcC5vcmVuYWlyLnJ1IiwKICAgICAgICAiaXJtYWcucnUiLAogICAgICAgICJrYWxlZG9zLnJ1IiwKICAgICAgICAia2F5YWsucnUiLAogICAgICAgICJrbGluZ2VsLnJ1IiwKICAgICAgICAia2xtLmNvbSIsCiAgICAgICAgImt1dmFsZGEucnUiLAogICAgICAgICJsYXp1cml0LmNvbSIsCiAgICAgICAgImxldGFlbS5ydSIsCiAgICAgICAgImxpZ2h0LWZsaWdodC5ydSIsCiAgICAgICAgImxpdHJlcy5ydSIsCiAgICAgICAgImxvdmVtYWcucnUiLAogICAgICAgICJsdWZ0aGFuc2EuY29tIiwKICAgICAgICAibWFnYXppbmJ0LnJ1IiwKICAgICAgICAibWFsaW5hLnJ1IiwKICAgICAgICAibWFya2V0cGxhY2UuYXNvcy5jb20iLAogICAgICAgICJtZWRpYW1hcmt0LnJ1IiwKICAgICAgICAibWlyMjIwdi5ydSIsCiAgICAgICAgIm1vbW9uZG8ucnUiLAogICAgICAgICJtdmlkZW8ucnUiLAogICAgICAgICJteS50aXUucnUiLAogICAgICAgICJuYWJvcnR1LnJ1IiwKICAgICAgICAibmFtYS5ydSIsCiAgICAgICAgIm5lc3ByZXNzby5jb20iLAogICAgICAgICJuZXcucG9zb3Nob2sucnUiLAogICAgICAgICJub2tpYS5jb20iLAogICAgICAgICJvbmV0d290cmlwLmNvbSIsCiAgICAgICAgIm9yaWdpbi5jb20iLAogICAgICAgICJvdHRvLmRlIiwKICAgICAgICAib3pvbi5ydSIsCiAgICAgICAgIm96b24udHJhdmVsIiwKICAgICAgICAicGFzcy5yemQucnUiLAogICAgICAgICJwaXhlbDI0LnJ1IiwKICAgICAgICAicGxhbmV0YXJpdW0ucnUiLAogICAgICAgICJwbGFuZXRhc2hvcC5ydSIsCiAgICAgICAgInBvc29zaG9rLnJ1IiwKICAgICAgICAicmVzZXJ2YXRpb24uYWVyb2Zsb3QucnUiLAogICAgICAgICJyaW1la3MucnUiLAogICAgICAgICJydS5wdW1hLmNvbSIsCiAgICAgICAgInM3LnJ1IiwKICAgICAgICAic2Ftc3VuZy5jb20iLAogICAgICAgICJzYXBhdG8ucnUiLAogICAgICAgICJzaG9wLmlkai5ieSIsCiAgICAgICAgInNob3Aua3oiLAogICAgICAgICJzaG9wLm1lZ2Fmb24ucnUiLAogICAgICAgICJzaW5kYmFkLnJ1IiwKICAgICAgICAic2t5c2Nhbm5lci5ydSIsCiAgICAgICAgInNvZnRrZXkucnUiLAogICAgICAgICJzb255LnJ1IiwKICAgICAgICAic290bWFya2V0LnJ1IiwKICAgICAgICAic3NsLm1vbG90b2sucnUiLAogICAgICAgICJzdG9yZS5zb255LnJ1IiwKICAgICAgICAic3Z5YXpub3kudHJhdmVsIiwKICAgICAgICAidGlueWRlYWwuY29tIiwKICAgICAgICAidHJhbnNhZXJvLnJ1IiwKICAgICAgICAidHJhbnNwb3J0Lm1hcnNocnV0eS5ydSIsCiAgICAgICAgInRyYXZlbC51bG1hcnQucnUiLAogICAgICAgICJ0cmlwLnJ1IiwKICAgICAgICAidHJpcGFkdmlzb3IucnUiLAogICAgICAgICJ0dm95ZG9tLnJ1IiwKICAgICAgICAidXRpbmV0LnJ1IiwKICAgICAgICAidm9kb3BhZC5zcGIucnUiLAogICAgICAgICJ3ZWJkdXNoLnJ1IiwKICAgICAgICAieGNvbS1zaG9wLnJ1IgogICAgICBdOwoKICAgICAgcmV0dXJuIG1vbm8ubWF0Y2hIb3N0KGxvY2F0aW9uLmhvc3RuYW1lLCBsaXN0KTsKICAgIH07CgogICAgdmFyIGNoZWNrUHJvdG9jb2wgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKGxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JykgewogICAgICAgIHJldHVybiBpbldoaXRlTGlzdCgpOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKCiAgICBpZiAoIWNoZWNrUHJvdG9jb2woKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdmFyIGluQmxhY2tMaXN0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICJ2ay5jb20iLAogICAgICAgICJ5b3V0dWJlLmNvbSIsCiAgICAgICAgIm9kbm9rbGFzc25pa2kucnUiLAogICAgICAgICJvay5ydSIsCiAgICAgICAgInByaXZldC5ydSIsCiAgICAgICAgImZhY2Vib29rLmNvbSIsCiAgICAgICAgIm5ld3Muc3BvcnRib3gucnUiLAogICAgICAgICJwbGF5Lmdvb2dsZS5jb20iLAogICAgICAgICJyb2VtLnJ1IiwKICAgICAgICAibGlua2VkaW4uY29tIiwKICAgICAgICAiZXgudWEiLAogICAgICAgICJpbnN0YWdyYW0uY29tIiwKICAgICAgICAicnV0dWJlLnJ1IiwKICAgICAgICAiZS5tYWlsLnJ1IiwKICAgICAgICAiZm90a2kueWFuZGV4LnJ1IiwKICAgICAgICAic3VwcG9ydC5rYXNwZXJza3kucnUiLAogICAgICAgICJ2aW1lby5jb20iLAogICAgICAgICJjbHViLmZvdG8ucnUiLAogICAgICAgICJnYXJhbnQucnUiLAogICAgICAgICJ3ZWJtYXN0ZXIueWFuZGV4LnJ1IiwKICAgICAgICAic3VwcG9ydC5rYXNwZXJza3kucnUiLAogICAgICAgICJmb3RraS55YW5kZXgucnUiLAogICAgICAgICJtay5ydSIsCiAgICAgICAgIm1ldHJpa2EueWFuZGV4LnJ1IiwKICAgICAgICAiaW1hZ2VzLnlhbmRleC5ydSIsCiAgICAgICAgImRpc2sueWFuZGV4LnJ1IiwKICAgICAgICAibWFwcy55YW5kZXgucnUiLAogICAgICAgICJoZWxwLnlhbmRleC5ydSIsCiAgICAgICAgInd3dy55YXBsYWthbC5jb20iLAogICAgICAgICJ3d3cuZmFjZWJvb2suY29tIiwKICAgICAgICAibXkubWFpbC5ydSIKICAgICAgXTsKCiAgICAgIHJldHVybiBtb25vLm1hdGNoSG9zdChsb2NhdGlvbi5ob3N0bmFtZSwgbGlzdCk7CiAgICB9OwoKICAgIGlmIChpbkJsYWNrTGlzdCgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9KTsKICAodHlwZW9mIG1vbm8gPT09ICd1bmRlZmluZWQnKSAmJiAobW9ubyA9IHsKICAgIGxvYWRNb2R1bGU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxvYWRNb2R1bGVTdGFjay5wdXNoKGFyZ3VtZW50cyk7CiAgICB9LAogICAgbG9hZE1vZHVsZVN0YWNrOiBbXQogIH0pOwoKICBtb25vLmxvYWRNb2R1bGUoJ2RlYWxwbHknLCBmdW5jdGlvbihtb2R1bGVOYW1lLCBpbml0RGF0YSkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHByZWZlcmVuY2UgPSBpbml0RGF0YS5nZXRQcmVmZXJlbmNlOwoKICAgIHZhciBnZXRVcmxMaXN0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsaXN0ID0gW107CiAgICAgIGlmIChsb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHBzOicpIHsKICAgICAgICBsaXN0LnB1c2goJ2h0dHBzOi8vaV9tZ2ljaW5qc19pbmZvLnRsc2Nkbi5jb20vbWdpY2luL2phdmFzY3JpcHQuanMnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaXN0LnB1c2goJ2h0dHA6Ly9pLm1naWNpbmpzLmluZm8vbWdpY2luL2phdmFzY3JpcHQuanMnKTsKICAgICAgICBsaXN0LnB1c2goJ2h0dHA6Ly9pLm1naWNpbnNyYy5vcmcvbWdpY2luL2phdmFzY3JpcHQuanMnKTsKICAgICAgfQogICAgICByZXR1cm4gbGlzdDsKICAgIH07CgogICAgdmFyIGluamVjdFNjcmlwdCA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdXJsTGlzdCA9IGdldFVybExpc3QoKTsKICAgICAgdXJsTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKHVybCkgewogICAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsKICAgICAgICBzY3JpcHQuYXN5bmMgPSAxOwogICAgICAgIHNjcmlwdC5zcmMgPSB1cmw7CiAgICAgICAgc2NyaXB0LnNldEF0dHJpYnV0ZSgnY2hhcnNldCcsICdVVEYtOCcpOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBydW4gPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKG1vbm8uaXNHTSAmJiB0eXBlb2YgcHJlU2hvdyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBwcmVTaG93LmxvYWQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICBpbmplY3RTY3JpcHQoKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpbmplY3RTY3JpcHQoKTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgcHJlU2hvdyA9IHsKICAgICAgb25DbG9zZTogZnVuY3Rpb24oZGV0YWlscywgaXNBcHBseSwgaXNVbmluc3RhbGwpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgZGV0YWlscy5ib3guc3R5bGUub3BhY2l0eSA9IDA7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIGRldGFpbHMuYm94LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZGV0YWlscy5ib3gpOwogICAgICAgIH0sIDUwMCk7CgogICAgICAgIGRldGFpbHMub25DbG9zZSAmJiBkZXRhaWxzLm9uQ2xvc2UoaXNBcHBseSwgaXNVbmluc3RhbGwpOwogICAgICB9LAogICAgICBnZXRIb3N0TmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGhvc3RuYW1lID0gbG9jYXRpb24uaG9zdG5hbWU7CiAgICAgICAgdmFyIG0gPSBob3N0bmFtZS5tYXRjaCgvKFteXC5dK1wuKD86W15cLl17MSwzfVwuKT9bXlwuXSspJC8pOwogICAgICAgIG0gPSBtICYmIG1bMV07CiAgICAgICAgcmV0dXJuIG07CiAgICAgIH0sCiAgICAgIHByZXBhcmU6IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIG1vbm8uc3RvcmFnZS5nZXQoWydhZHZQcmVTaG93Q291bnQnLCAnYWR2UHJlU2hvd1RpbWUnXSwgZnVuY3Rpb24oc3RvcmFnZSkgewogICAgICAgICAgaWYgKCFzdG9yYWdlLmFkdlByZVNob3dDb3VudCkgewogICAgICAgICAgICBzdG9yYWdlLmFkdlByZVNob3dDb3VudCA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFzdG9yYWdlLmFkdlByZVNob3dUaW1lKSB7CiAgICAgICAgICAgIHN0b3JhZ2UuYWR2UHJlU2hvd1RpbWUgPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBub3cgPSBwYXJzZUludChEYXRlLm5vdygpIC8gMTAwMCk7CiAgICAgICAgICBpZiAoc3RvcmFnZS5hZHZQcmVTaG93VGltZSA+IG5vdykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgY2Ioc3RvcmFnZSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGxvYWQ6IGZ1bmN0aW9uKG9uQXBwbHkpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIHNpdGVMaXN0ID0gWwogICAgICAgICAgImFtYXpvbi5jb20iLAogICAgICAgICAgImFtYXpvbi5jby51ayIsCiAgICAgICAgICAiYW1hem9uLmRlIiwKICAgICAgICAgICJhbWF6b24uaW4iLAogICAgICAgICAgImFtYXpvbi5lcyIsCiAgICAgICAgICAiYW1hem9uLml0IiwKICAgICAgICAgICJhbWF6b24uZnIiLAogICAgICAgICAgImFtYXpvbi5jYSIsCiAgICAgICAgICAiYW1hem9uLmNvLmpwIiwKICAgICAgICAgICJhbWF6b24uY29tLmF1IiwKCiAgICAgICAgICAiZWJheS5jb20iLAogICAgICAgICAgImViYXkuY28udWsiLAogICAgICAgICAgImViYXkuZGUiLAogICAgICAgICAgImViYXkucGwiLAogICAgICAgICAgImViYXkuYXQiLAogICAgICAgICAgImViYXkubmwiLAogICAgICAgICAgImViYXkuYmUiLAogICAgICAgICAgImViYXkuZnIiLAogICAgICAgICAgImViYXkuY2EiLAogICAgICAgICAgImViYXkuaW4iLAogICAgICAgICAgImViYXkuZXMiLAogICAgICAgICAgImViYXkuaXQiLAogICAgICAgICAgImViYXkuY29tLmF1IiwKICAgICAgICAgICJlYmF5LmRlIiwKCiAgICAgICAgICAid2FsbWFydC5jb20iLAogICAgICAgICAgImFsaWJhYmEuY29tIiwKICAgICAgICAgICJhbGlleHByZXNzLmNvbSIsCiAgICAgICAgICAidGFyZ2V0LmNvbSIsCiAgICAgICAgICAiZmxpcGthcnQuY29tIiwKICAgICAgICAgICJiZXN0YnV5LmNvbSIsCiAgICAgICAgICAibmV3ZWdnLmNvbSIsCiAgICAgICAgICAib3ZlcnN0b2NrLmNvbSIsCiAgICAgICAgICAic2hvcC5jb20iLAogICAgICAgICAgInNwcmludC5jb20iLAoKICAgICAgICAgICJ5YWhvby5jb20iLAogICAgICAgICAgIm5ldGZsaXguY29tIiwKICAgICAgICAgICJtaWNyb3NvZnQuY29tIiwKICAgICAgICAgICJtdHNpbmRpYS5pbiIsCiAgICAgICAgICAidjkuY29tIiwKICAgICAgICAgICJibG9nc3BvdC5jb20iLAogICAgICAgICAgImF2Zy5jb20iLAogICAgICAgICAgImltZGIuY29tIiwKICAgICAgICAgICJiaW5nLmNvbSIsCiAgICAgICAgICAicmVsaWFuY2VuZXRjb25uZWN0LmNvLmluIiwKICAgICAgICAgICJnbG9iby5jb20iLAogICAgICAgICAgImVzcG4uZ28uY29tIiwKICAgICAgICAgICJiYWJ5bG9uLmNvbSIsCiAgICAgICAgICAibmF2ZXIuY29tIiwKICAgICAgICAgICJzb2Z0b25pYy5jb20iLAogICAgICAgICAgImFwcGxlLmNvbSIsCiAgICAgICAgICAiYWlydGVsLmluIiwKICAgICAgICAgICJkZWx0YS1zZWFyY2guY29tIiwKICAgICAgICAgICJkZXZpYW50YXJ0LmNvbSIsCiAgICAgICAgICAicmVkaWZmLmNvbSIsCiAgICAgICAgICAidW9sLmNvbS5iciIsCiAgICAgICAgICAibXVkYWgubXkiLAogICAgICAgICAgImlvYml0LmNvbSIsCiAgICAgICAgICAicmVsaWFuY2Vicm9hZGJhbmQuY28uaW4iLAoKICAgICAgICAgICJjbmV0LmNvbSIsCgogICAgICAgICAgImxhemFkYS5jby5pZCIsCiAgICAgICAgICAibGF6YWRhLmNvbS5waCIsCiAgICAgICAgICAibGF6YWRhLmNvbS5teSIsCiAgICAgICAgICAibGF6YWRhLmNvLnRoIiwKCiAgICAgICAgICAic25hcGRlYWwuY29tIiwKICAgICAgICAgICJqYWJvbmcuY29tIiwKICAgICAgICAgICJvbHguY28uaWQiLAogICAgICAgICAgImVsZXZlbmlhLmNvLmlkIiwKICAgICAgICAgICJteXNtYXJ0cHJpY2UuY29tIiwKICAgICAgICAgICJxdWlrci5jb20iLAogICAgICAgICAgIm1lcmNhZG9saXZyZS5jb20uYnIiLAogICAgICAgICAgInRvbXNoYXJkd2FyZS5jb20iLAogICAgICAgICAgInNob3BjbHVlcy5jb20iLAoKICAgICAgICAgICJtZXJjYWRvbGlicmUuY29tLm14IiwKICAgICAgICAgICJtZXJjYWRvbGlicmUuY29tLmFyIgogICAgICAgIF07CgogICAgICAgIGlmICghbW9uby5tYXRjaEhvc3QobG9jYXRpb24uaG9zdG5hbWUsIHNpdGVMaXN0KSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHByZWZlcmVuY2UuYWR2UHJlU2hvdykgewogICAgICAgICAgcmV0dXJuIG9uQXBwbHkoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucnVuKG9uQXBwbHkpOwogICAgICB9LAogICAgICBydW46IGZ1bmN0aW9uKG9uQXBwbHkpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgbGFuZyA9IHsKICAgICAgICAgIGVuOiB7CiAgICAgICAgICAgIGRwRGlhbG9nVG9wOiAnV2VsY29tZScsCiAgICAgICAgICAgIGRwRGlhbG9nVGV4dDogWydTYXZlRnJvbS5uZXQgSGVscGVyIG9mZmVycyB5b3UgdG8gdXNlIE9mZmVyczRVIGFuZCByZWNlaXZlIHVwZGF0ZXMgb24gdGhlIGhvdHRlc3QgZGVhbHMgJiBjb3Vwb25zLiBUbyBhZ3JlZSB0byB0aGUgJywgewogICAgICAgICAgICAgIGE6IHsKICAgICAgICAgICAgICAgIHRleHQ6ICd0ZXJtcyBhbmQgY29uZGl0aW9ucycsCiAgICAgICAgICAgICAgICBocmVmOiAnI3RjJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgJyBhbmQgZW5hYmxlIGl0LCBqdXN0IGNsaWNrIOKAnE9L4oCdLiddLAogICAgICAgICAgICBkcERpYWxvZ0J0bTogWydMZWdhbCBicm91Z2h0IGJ5ICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnU2F2ZUZyb20ubmV0IEhlbHBlcicsCiAgICAgICAgICAgICAgICBocmVmOiAnI3NmJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgJyBwb3dlcmVkIGJ5ICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnT2ZmZXJzNFUnLAogICAgICAgICAgICAgICAgaHJlZjogJyNvNHUnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSwKICAgICAgICAgICAgZHBEaWFsb2dVbmluc3RhbGw6IFsnVG8gdW5pbnN0YWxsIE9mZmVyczRVIGNsaWNrICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnaGVyZScsCiAgICAgICAgICAgICAgICBocmVmOiAnI3VuJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIGRwRGlhbG9nTW9yZTogJ0xlYXJuIE1vcmUnLAogICAgICAgICAgICBkcERpYWxvZ09rOiAnT0snCiAgICAgICAgICB9LAogICAgICAgICAgdHI6IHsKICAgICAgICAgICAgZHBEaWFsb2dUb3A6ICdIb8WfIGdlbGRpbml6JywKICAgICAgICAgICAgZHBEaWFsb2dUZXh0OiBbJ1NhdmVGcm9tLm5ldCBIZWxwZXIgxZ9pbWRpIGRlIE9mZmVyczRVIHV5Z3VsYW1hc8SxbsSxIGt1bGxhbm1hIHZlIGVuIHllbmkgaW5kaXJpbWxlciB2ZSBrdXBvbmxhcmxhIGlsZ2lsaSBiaWxkaXJpbWxlcmkgYWxtYSBmxLFyc2F0xLFuxLEgc3VudXlvci4gS3VsbGFuxLFtICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnxZ9hcnRsYXLEsW7EsSB2ZSBrb8WfdWxsYXLEsW7EsScsCiAgICAgICAgICAgICAgICBocmVmOiAnI3RjJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgJyBrYWJ1bCBldG1layBpw6dpbiB1eWd1bGFtYXnEsSBldGtpbmxlxZ90aXJpbiB2ZSDigJxUQU1BTeKAnSBzZcOnZW5lxJ9pbmkgdMSxa2xhecSxbi4nXSwKICAgICAgICAgICAgZHBEaWFsb2dCdG06IFt7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgdGV4dDogJ09mZmVyczRVJywKICAgICAgICAgICAgICAgIGhyZWY6ICcjbzR1JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgJyB5YXNhbCBvbGFyYWsgJywgewogICAgICAgICAgICAgIGE6IHsKICAgICAgICAgICAgICAgIHRleHQ6ICdTYXZlRnJvbS5uZXQgSGVscGVyJywKICAgICAgICAgICAgICAgIGhyZWY6ICcjc2YnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAnIHRhcmFmxLFuZGFuIGRlc3Rla2xlbm1la3RlZGlyLiddLAogICAgICAgICAgICBkcERpYWxvZ1VuaW5zdGFsbDogWydPZmZlcnM0VSB1eWd1bGFtYXPEsW7EsSBrYWxkxLFybWFrIGnDp2luICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnYnVyYXlhIHTEsWtsYXnEsW4nLAogICAgICAgICAgICAgICAgaHJlZjogJyN1bicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBkcERpYWxvZ01vcmU6ICdEYWhhIGZhemxhIGJpbGdpJywKICAgICAgICAgICAgZHBEaWFsb2dPazogJ1RBTUFNJwogICAgICAgICAgfSwKICAgICAgICAgIGZyOiB7CiAgICAgICAgICAgIGRwRGlhbG9nVG9wOiAnQmllbnZlbnVlJywKICAgICAgICAgICAgZHBEaWFsb2dUZXh0OiBbJ1NhdmVGcm9tLm5ldCBIZWxwZXIgdm91cyBwcm9wb3NlIGRcJ3V0aWxpc2VyIE9mZmVyczRVIGV0IGRlIHJlY2V2b2lyIGRlcyBtaXNlcyDDoCBqb3VyIHN1ciBsZXMgZGVybmnDqHJlcyBwcm9tb3MgZXQgZGVzIHLDqWR1Y3Rpb25zLiBQb3VyIGFjY2VwdGVyICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnbGVzIHRlcm1lcyBldCBsZXMgY29uZGl0aW9ucycsCiAgICAgICAgICAgICAgICBocmVmOiAnI3RjJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgJyBwb3VyIGxcJ2FjdGl2ZXIsIGNsaXF1ZXogc3VyIOKAnE9L4oCdLiddLAogICAgICAgICAgICBkcERpYWxvZ0J0bTogWydNZW50aW9ucyBsw6lnYWxlcyBkZSAnLCB7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgdGV4dDogJ1NhdmVGcm9tLm5ldCBIZWxwZXInLAogICAgICAgICAgICAgICAgaHJlZjogJyNzZicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sICcgYWxpbWVudMOpZXMgcGFyICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnT2ZmZXJzNFUnLAogICAgICAgICAgICAgICAgaHJlZjogJyNvNHUnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSwKICAgICAgICAgICAgZHBEaWFsb2dVbmluc3RhbGw6IFsnUG91ciBkw6lzaW5zdGFsbGVyIE9mZmVyczRVIGNsaXF1ZXogJywgewogICAgICAgICAgICAgIGE6IHsKICAgICAgICAgICAgICAgIHRleHQ6ICdpY2knLAogICAgICAgICAgICAgICAgaHJlZjogJyN1bicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBkcERpYWxvZ01vcmU6ICdFbiBzYXZvaXIgcGx1cycsCiAgICAgICAgICAgIGRwRGlhbG9nT2s6ICdPSycKICAgICAgICAgIH0sCiAgICAgICAgICBpZDogewogICAgICAgICAgICBkcERpYWxvZ1RvcDogJ1NlbGFtYXQgZGF0aW5nJywKICAgICAgICAgICAgZHBEaWFsb2dUZXh0OiBbJ1NhdmVGcm9tLm5ldCBIZWxwZXIgbWVuYXdhcmthbiBrZXBhZGEgQW5kYSB1bnR1ayBtZW5nZ3VuYWthbiBPZmZlcnM0VSBkYW4gbWVuZXJpbWEgYmVyaXRhIHRlcmJhcnUgdGVudGFuZyBwZW5hd2FyYW4gJiBrdXBvbiB0ZXJiYWd1cy4gVW50dWsgbWVueWV0dWp1aSAnLCB7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgdGV4dDogJ3N5YXJhdCBkYW4ga2V0ZW50dWFuJywKICAgICAgICAgICAgICAgIGhyZWY6ICcjdGMnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAnIGRhbiB1bnR1ayBtZW5nYWt0aWZrYW5ueWEsIGN1a3VwIGtsaWsg4oCcT0vigJ0uJ10sCiAgICAgICAgICAgIGRwRGlhbG9nQnRtOiBbJ0xlZ2FsIGRpcGVyc2VtYmFoa2FuIG9sZWggJywgewogICAgICAgICAgICAgIGE6IHsKICAgICAgICAgICAgICAgIHRleHQ6ICdTYXZlRnJvbS5uZXQgSGVscGVyJywKICAgICAgICAgICAgICAgIGhyZWY6ICcjc2YnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAnIHlhbmcgZGlkdWt1bmcgb2xlaCAnLCB7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgdGV4dDogJ09mZmVyczRVJywKICAgICAgICAgICAgICAgIGhyZWY6ICcjbzR1JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIGRwRGlhbG9nVW5pbnN0YWxsOiBbJ1VudHVrIG1lbWJhdGFsa2FuIHBlbmdpbnN0YWxhbiBPZmZlcnM0VSwga2xpayBkaSAnLCB7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgdGV4dDogJ3NpbmknLAogICAgICAgICAgICAgICAgaHJlZjogJyN1bicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBkcERpYWxvZ01vcmU6ICdLZXRhaHVpIFNlbGVuZ2thcG55YScsCiAgICAgICAgICAgIGRwRGlhbG9nT2s6ICdPSycKICAgICAgICAgIH0sCiAgICAgICAgICBlczogewogICAgICAgICAgICBkcERpYWxvZ1RvcDogJ0JpZW52ZW5pZG8nLAogICAgICAgICAgICBkcERpYWxvZ1RleHQ6IFsnU2F2ZUZvcm0ubmV0IEhlbHBlciBsZSBvZnJlY2UgdXNhciBPZmZlcnM0VSB5IHJlY2liaXIgYWN0dWFsaXphY2lvbmVzIHNvYnJlIGxhcyDDumx0aW1hcyBub3ZlZGFkZXMgZW4gb2ZlcnRhcyB5IGN1cG9uZXMuIFBhcmEgYWNlcHRhciBsb3MgJywgewogICAgICAgICAgICAgIGE6IHsKICAgICAgICAgICAgICAgIHRleHQ6ICd0w6lybWlub3MgeSBjb25kaWNpb25lcycsCiAgICAgICAgICAgICAgICBocmVmOiAnI3RjJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgJyB5IGhhYmlsaXRhcmxvLCBoYWdhIGNsaWMgZW4gIk9LIi4nXSwKICAgICAgICAgICAgZHBEaWFsb2dCdG06IFsnU2VjY2nDs24gbGVnYWwgcG9yIGNvcnRlc8OtYSBkZSAnLCB7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgdGV4dDogJ1NhdmVGb3JtLm5ldCBIZWxwZXInLAogICAgICAgICAgICAgICAgaHJlZjogJyNzZicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sICcsIGNvbiBsYSB0ZWNub2xvZ8OtYSBkZSAnLCB7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgdGV4dDogJ09mZmVyczRVJywKICAgICAgICAgICAgICAgIGhyZWY6ICcjbzR1JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIGRwRGlhbG9nVW5pbnN0YWxsOiBbJ1BhcmEgZGVzaW5zdGFsYXIgT2ZmZXJzNFUgaGFnYSBjbGljICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnYXF1w60nLAogICAgICAgICAgICAgICAgaHJlZjogJyN1bicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBkcERpYWxvZ01vcmU6ICdNw6FzIGluZm9ybWFjacOzbicsCiAgICAgICAgICAgIGRwRGlhbG9nT2s6ICdPSycKICAgICAgICAgIH0sCiAgICAgICAgICBkZTogewogICAgICAgICAgICBkcERpYWxvZ1RvcDogJ1dpbGxrb21tZW4nLAogICAgICAgICAgICBkcERpYWxvZ1RleHQ6IFsnU2F2ZUZyb20ubmV0IEhlbHBlcnMgYmlldGV0IElobmVuIE9mZmVyczRVIGFuLiBFcmhhbHRlbiBTaWUgVXBkYXRlcyBkZXIgYmVzdGVuIEFuZ2Vib3RlIHVuZCBHdXRzY2hlaW5lLiBLbGlja2VuIFNpZSAiT0siIHVuZCBzdGltbWVuIFNpZSBkZW4gJywgewogICAgICAgICAgICAgIGE6IHsKICAgICAgICAgICAgICAgIHRleHQ6ICdBbGxnZW1laW5lbiBHZXNjaMOkZnRzYmVkaW5ndW5nZW4nLAogICAgICAgICAgICAgICAgaHJlZjogJyN0YycKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sICcgenUuJ10sCiAgICAgICAgICAgIGRwRGlhbG9nQnRtOiBbJ09mZml6aWVsbGVzIEFuZ2Vib3Qgdm9uICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnU2F2ZUZyb20ubmV0IEhlbHBlcicsCiAgICAgICAgICAgICAgICBocmVmOiAnI3NmJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgJy4gUG93ZXJlZCBieSAnLCB7CiAgICAgICAgICAgICAgYTogewogICAgICAgICAgICAgICAgdGV4dDogJ09mZmVyczRVJywKICAgICAgICAgICAgICAgIGhyZWY6ICcjbzR1JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIGRwRGlhbG9nVW5pbnN0YWxsOiBbJ0RlaW5zdGFsbGllcmVuIGvDtm5uZW4gU2llIE9mZmVyczRVICcsIHsKICAgICAgICAgICAgICBhOiB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnaGllcicsCiAgICAgICAgICAgICAgICBocmVmOiAnI3VuJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIGRwRGlhbG9nTW9yZTogJ1dlaXRlcmUgSW5mb3JtYXRpb25lbicsCiAgICAgICAgICAgIGRwRGlhbG9nT2s6ICdPSycKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB2YXIgc3R5bGVGaXggPSB7CiAgICAgICAgICBlbjogewogICAgICAgICAgICBkcERpYWxvZ1VuaW5zdGFsbDogewogICAgICAgICAgICAgIG1hcmdpblRvcDogJzZweCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHBEaWFsb2dNb3JlOiB7CiAgICAgICAgICAgICAgbWFyZ2luVG9wOiAnNnB4JwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGxhbmdDb2RlID0gbGFuZ1ttb25vLmdsb2JhbC5sYW5ndWFnZS5sYW5nXSA/IG1vbm8uZ2xvYmFsLmxhbmd1YWdlLmxhbmcgOiAnZW4nOwoKICAgICAgICBsYW5nID0gbGFuZ1tsYW5nQ29kZV07CiAgICAgICAgc3R5bGVGaXggPSBzdHlsZUZpeFtsYW5nQ29kZV0gfHwge307CgogICAgICAgIHZhciBsYW5nUHJlcGFyZSA9IChmdW5jdGlvbihsYW5nQ29kZSwgbm9kZSkgewogICAgICAgICAgLy8gbGFuZ3VhZ2UgcG9zdCBwcm9jZXNzCiAgICAgICAgICB2YXIgbGluazsKICAgICAgICAgIGxpbmsgPSBub2RlLnF1ZXJ5U2VsZWN0b3IoJ2FbaHJlZj0iI3RjIl0nKTsKICAgICAgICAgIGxpbmsuaHJlZiA9ICdodHRwOi8vd3d3LmRlYWxwbHkuY29tL2V1bGEuaHRtbCc7CiAgICAgICAgICBsaW5rLnRhcmdldCA9ICdfYmxhbmsnOwogICAgICAgICAgbGluay5jbGFzc0xpc3QuYWRkKCdzZi1ibGFjaycpOwoKICAgICAgICAgIGxpbmsgPSBub2RlLnF1ZXJ5U2VsZWN0b3IoJ2FbaHJlZj0iI3NmIl0nKTsKICAgICAgICAgIGxpbmsuaHJlZiA9ICdodHRwOi8vc2F2ZWZyb20ubmV0L3VzZXIucGhwJzsKICAgICAgICAgIGxpbmsudGFyZ2V0ID0gJ19ibGFuayc7CgogICAgICAgICAgbGluayA9IG5vZGUucXVlcnlTZWxlY3RvcignYVtocmVmPSIjbzR1Il0nKTsKICAgICAgICAgIGxpbmsuaHJlZiA9ICdodHRwOi8vd3d3LmRlYWxwbHkuY29tL2luZGV4Lmh0bWwnOwogICAgICAgICAgbGluay50YXJnZXQgPSAnX2JsYW5rJzsKCiAgICAgICAgICBsaW5rID0gbm9kZS5xdWVyeVNlbGVjdG9yKCdhW2hyZWY9IiNtb3JlIl0nKTsKICAgICAgICAgIGxpbmsuaHJlZiA9ICdodHRwOi8vd3d3LmRlYWxwbHkuY29tL2luZGV4Lmh0bWwnOwogICAgICAgICAgbGluay50YXJnZXQgPSAnX2JsYW5rJzsKICAgICAgICB9KS5iaW5kKG51bGwsIGxhbmdDb2RlKTsKCiAgICAgICAgdGhpcy5wcmVwYXJlKGZ1bmN0aW9uKHN0b3JhZ2UpIHsKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICB3aXRoRGVsYXk6IDI1MCwKICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24oaXNBcHBseSwgaXNVbmluc3RhbGwpIHsKICAgICAgICAgICAgICBpZiAoZGV0YWlscy5maXJlZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkZXRhaWxzLmZpcmVkID0gMTsKCiAgICAgICAgICAgICAgdmFyIG5vdyA9IHBhcnNlSW50KERhdGUubm93KCkgLyAxMDAwKTsKCiAgICAgICAgICAgICAgaXNBcHBseSA9IGlzQXBwbHkgPyAxIDogMDsKCiAgICAgICAgICAgICAgaWYgKCFpc0FwcGx5ICYmICFpc1VuaW5zdGFsbCkgewogICAgICAgICAgICAgICAgc3RvcmFnZS5hZHZQcmVTaG93Q291bnQrKzsKCiAgICAgICAgICAgICAgICBpZiAoc3RvcmFnZS5hZHZQcmVTaG93Q291bnQgPiAyKSB7CiAgICAgICAgICAgICAgICAgIGlzQXBwbHkgPSAwOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RvcmFnZS5hZHZQcmVTaG93VGltZSA9IG5vdyArIDYgKiA2MCAqIDYwOwogICAgICAgICAgICAgICAgICBtb25vLnN0b3JhZ2Uuc2V0KHN0b3JhZ2UpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtb25vLnN0b3JhZ2UucmVtb3ZlKFsnYWR2UHJlU2hvd1RpbWUnLCAnYWR2UHJlU2hvd0NvdW50J10pOwoKICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ3VwZGF0ZU9wdGlvbicsCiAgICAgICAgICAgICAgICBrZXk6ICdhZHZQcmVTaG93JywKICAgICAgICAgICAgICAgIHZhbHVlOiBwcmVmZXJlbmNlLmFkdlByZVNob3cgPSAxCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgYWN0aW9uOiAndXBkYXRlT3B0aW9uJywKICAgICAgICAgICAgICAgIGtleTogJ3NvdmV0bmlrRW5hYmxlZCcsCiAgICAgICAgICAgICAgICB2YWx1ZTogcHJlZmVyZW5jZS5zb3ZldG5pa0VuYWJsZWQgPSBpc0FwcGx5CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHZhciBzdGF0ZSA9ICdmYWxzZSc7CiAgICAgICAgICAgICAgaWYgKGlzQXBwbHkpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gJ3RydWUnOwogICAgICAgICAgICAgICAgZGV0YWlscy5vbkFwcGx5ICYmIGRldGFpbHMub25BcHBseSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGhvc3RuYW1lID0gcHJlU2hvdy5nZXRIb3N0TmFtZSgpOwoKICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrJywKICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICBlYzogJ2RwTGlzdEV4cCcsCiAgICAgICAgICAgICAgICBlYTogJ3N0YXRlJywKICAgICAgICAgICAgICAgIGVsOiBob3N0bmFtZSArICcgJyArIHN0YXRlLAogICAgICAgICAgICAgICAgdGlkOiAnVUEtNjc3MzgxMzAtMScKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25BcHBseTogb25BcHBseQogICAgICAgICAgfTsKCiAgICAgICAgICBkZXRhaWxzLl9vbkNsb3NlID0gX3RoaXMub25DbG9zZS5iaW5kKF90aGlzLCBkZXRhaWxzKTsKCiAgICAgICAgICB2YXIgYWR2RGlhbG9nSW1nID0gJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQUVBQUFCY0NBSUFBQUFnWjBqM0FBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBQ2xKUkVGVWVOcGkrUDl2RXhNREF5TUJ6SVJnTXpKaEY4Zktwa1NNV0RZNW1BRUxtNEVlR0NEQUFLU0tBN1NBNkRFTEFBQUFBRWxGVGtTdVFtQ0MnOwogICAgICAgICAgdmFyIGFkdkRlc2NJbWcgPSAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFPc0FBQUJjQ0FJQUFBQUFwOVZQQUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQU9NNUpSRUZVZU5yc2ZRbGdITVdaYmgxOXphVVozWllzV3pJR1l3TzJaY0RoQ0FhWkpCd0xJYzU5a0N3MjRaSEF5d2FUemRzTnkyWU5TVmpZYkJLYmwzMlFKVmxzV0NCQU9Nd1ZFZ2l4c0xteDhZMXZXL0lwNjV6UlhIMVYxYXZxbmhuTmpFYWpNWkpzSmV1bUxXWjZhbnE2cTcvNjYvdlBnb3crRDA1dXBXMlI5NDc0ejVpTS9aYjcxdHpUbmV3eGdoK2JPRlI3YXNxOWIyeXZ1blJxNWtoMDdXRm1KTXMrUHZWa1o0N1dKZ0VBVC9aQ0tSdWpNck1JOXBOTWp6RUNvYUlXNjBDSUdHUFpEYVNRUDdZcmZMTFBUeUw0Qkd4Mm44R3NwQXZNRkQ3THFtR2lzMGdIUW9nZ29ZQWhBRmxLaWtzVnFxZm5aSitmUlBBSjJFZ3NpWVBsT2QxRmJZaUtkeURrWWppN3dYZis5K0U3dm1xR0NJYVludXpTRTR6Z1NKZzh1aUlTaVZDK2I5Nmd1d2ZYdENiNDMyc1hCdTkvc082dnJLZXNyb2hTVTV2Zlhia2tvWUFVbG1YbjgxU2JVMCtYMW05R2E0OTBML3cvbFNmQmQ4SVF6TEY3MzcyOTk5M2J4MThNL3RTQmIvM29YaVVmR1BOYXZDY1l3UW5UViszaGdqZFh4b0ppSGNnNGc0RFpEV2JPMHJyZkl1SE8vb3ZPanI3MDU4bkJFRDRKd1JGdTdoeDNERHVYdTJlZHN1ZnVPN3NMd3ZlMkpkWDNQemp4V004NTdIN1BqN29kNlE1UDJNNHdvQlJwK2QzRk9NMGQrbHRzMEpHWnpWcVNhaUd2dldtRHpydHgwd2JqUk43VVg4VitiQWplMzJidmI3ZG1OV3NGaFFmSDdtMUxhc2JtUXNGTjF4K09oT21KNmlacVFHcFovUDg1QU9Wa2xwRmlYNlEwTGFSVCs2eG16OEYrSDBESW5jcHV2djd3U1FpT2NEODJGakc1U2JsdFNhMzdta3VSelJ1U2I2eE9yR21ONzI4ek9YeXZYVmcrZHBQRi9qYnI3aDkxM2ZPTDRlbjFUZGNmdXVjWEUwWjNnaVpoVy9INTh2c3ExZ2NzdXlpTFlBRGh2QWJJSnl0U3lqVGhYT1JKVFhxa1BCaDl0Ry9PYXZieS9kcUZ4MGNqRVkvNXhaWFJlMzR4Y2RpbWo2N280NFBxL2djYjVyWDRSK3ZuOVk2SVZEVWxyNjhRaG95aFloM0lSYlp0NURYd1Y4SVFpRTJaSE55MzM2VVE2SDhVNEZnaUh2N1hIMEd2VjV0M2lUYXY1Zmp4NE1TR1BTZDBzbkRGc0ZsaVk5N3lxa3YzM24zbjBXUDlJV2JHV2VkN2RNdFA2ZjViV09TSExQb1VNM2NCa0xBNnQ4dmxkbDVqV0Y1SGMwbEMvdG1nakRqM3lEMTQ1bGxhMG9ZVGE4UjFYblNKYjRROVk3ZTN4eDU5K0lSUDVXM2g3aFViMXl4NjRZR1ZPOVlWNjVCRWdzUFhibSt6dG4wWWZlRCs3bTlkenkrZWRIZVBMWXVJdG00NCtMMzc3SEJzNXQ3SFR2Z0k1c0oxV01uS0c2eHBqZkVYSE1GdnZCNS82YytuRHBibzVsdi9oYTA0ckRvVGxEV3laQ2YwVUlnT2dKNjFJTG9aMkJiaVdGVUE4d0dtdnkyYVl4Q2M3a0ZzSWd2WEErazhxSjRCVUFEZ0FFTVV3QUVMY1RSc0JrSktMdmtBZzUxMlZ5OEl2YlFEVmRmdzQzcjIrUHhvVy9UWDkzRkFxR2ZQbFdlY2Vmd2ZSMWhQTEhyaFY2M3RIL0lYbVlNTFRwOWJtSWwxZC9Vdit5bS8ybXg1cks5dTlYMzJpeVBwQk1sUjVvYmM5bnoybjhNcjMwaDExdXViQWkzTlk5UVhkdnMrcVhGS2NSWWhoR3U3VmZ5QytmYTE2eXBkQkR1SWowVWlMSThUTXlLeHZXK0QrQUVLWDJhR0RxUUtQRGtCeTNVT09JQlZvUGdCNHVLVFQvRW14Q21qR1BZbkFkbk40cnNCWE0wYyt5NzBBMnZ2QkhENEVrQmE5SVQwMnRPZHY3bnJ5TE83UDUvTElpUW9xWGtYSEN4SDUzMDg5TUUreStIQjByQzNVMlNMUC9PRUM0ajRzNzhMblRIeitDTTQ1UEdITkY4MmZGdmJ0eFc4SS81OHczY3Q0WkROUDhQdGQwSmZZQXp0d1NRY3k3enVlZWlQZ1pZNVkyVnQzZlpoMyszZlY4ODVqOHNTdnVlaHViM05jRjlzM3BnY2RyeGV1N0NLdDdscFVWdGE0MHpPYThucEkyWVlMTkVGMUNCQUtsUUJzeUdRSVZBaFI2ekxTaGxJLzBrWmZCa3pnU3VNQjFRMEcyQjhCUFEvQjdvZTUrTDBieTZIbDMyeW5vYVBBSFVPUlB6TVFTalhVOU9HVXQzZ0M1NHd2ZUdxeXc4OThDU1kyZXdkaWZoSlBQTmt1dmUyY2lnWEZRRmp0UzI5N0RvdWc5dkNYZTViL29JemlxWlFkYjRFOHZxRHQvNGp2MGlhQmpHL1pzNkRwY1pUeHRhajRiOWtEbWNSS1FTdmVIblMwci9ESWY5WWRJVG5pay96V3pMV3ZjdDM1NFo5MnNXWCtyOStmWHJtTGI5djJWR0I0QTNKVWg0NUIvRWJyOGNlWGRIdGZtVmVTMW5Pc0l6MU15UEtORjhLbzZtWlhKaHZZYmJVaDJCSWh4c1VXcHJrVmFHbmhwR0RRQ0hBWmhJNkJHSlBpUjA1OEZmTFFHeXFXbGtEOVBNQnJHZFNBOFJlZHhCb0RhR3ptODFaelhTRUxFS2VjWmExYll2N0dsZlhPa01OeEEyQ0VmTW8wbkVTdzVwLytUVTN6My80enN5UmxUdmVYM3plVlhuTitPWHhYWjR4K2hNRnZ1T09ieGFoeVRnVTZQN1A1ekt0dGVtTjN1WnBZNlFOS0xQUE5qZDlRQ05oWjRSYTl1NmQycnhQSWg4Zk1QQ1RWNFN1V2xDK2E0ZSthVVBpZXo4b3lXUENRYisvM2RpOElURnRocGQvUFVmNzZUN010cS9FV2xrR1FDaGtRdFVHMUVVd2dweE9CQWp6RWtGa2gvYTNJUTlTK3p5Y2ZrQ1ZwTUNPVXJxeE9KRmhZRitIVkxhSDliNE9raStDNUJOQVh3WDB0UkR2cGVGK3V3TmMvYTFUSnpkNU5BMXovY2JjdEY3Lzh5dUpGNTR4MTczUExBdFhUNEN5V29yT2FxNTc5MERkdEhjbnpianA3VTB2clAvd3Z0WjFqVlYxNys4NytPcVczWE1hSjhrWUhRYzFyaWxVRzlLOFIrUGhqcGg0ZGg1Si9jcVpGeDAzSlpLUDJqZUxZM3hEK2VVWkx1RnRQbTNHK2hWak42RHQ5cjNodTI3UHNDWC8xMi93WEhGTmRvTVhWL1p4YUpaK3dwc1c3ZDNmWnJ5MGFrYk9yK3haUjE3NkxnNDZJNEVKdVlVYlk4aXZNeHVsQkxJRldKM0JLazFnRG8xZ0JTU1M4TUIvbjFaM1lWOXdiaGVMREd0R1NvdHZCZGhIUVhqTmhJcHJFUFExTWF2QmVHZXZ1YzJtdlNidGk5Sll3cDJDMUhQUFY4NDVUejNuL0NLbk5BaTg4KzVsbDBIN1hoeWNNblhxelpkK2JQdWh6aGZYYjc3amM5ZEVkZjM3anp6NnM2OTkrYlJhLy9Fa0ZhM3RXOXZDblF0bnp6OXV2OGhsOEEzRk1SNS9kNnUrdlQzRlhUcDZRd3N1a1NkVWpwV0hNRlNCZ3VYbXVuZFNpbEFrN1BuRWxka05wazMzSE5NSnIxNVFFUW5iYzg4UDVEall1dmJDUGE5Q0xlZ0FDeklFRUplak1vRTBQYWZ6RjM0Q2lzcGdHQVFIRHVEcmJ3elduOEttdDBSQkxQZFRKeWlOZ3hWNnVNeDNETVBwM3hmYUlWU2lXMzNxaE1PUzd3QXp0c3IxaDVWWkhaN3p1clNMbURxN1hKcFVEU1VmNmUwakhaM2s4Q0ZseHF5Q3Q2WVRmT0VkUC8vNUJYTjgrM1pFcDgzNThaY3VyZkFxMDJyTHoyazY5ZThlZnZxbStjMVh6cDQ5ZDhtUHZ6bi9VNW9FanB0RWJBclZORStZY2p3TmVWd0N2Vk1jNDUzTEhqOXc2N0xNMjVyRlg1bTBkUEZZRHl3dWpFbjNVZjdYOTdsclI5MDVZcnp6Q0g3dmx5ellBRVhjT2dTWVNVMzlVTE00bDNWNEttSmNCazh3SUpmQlZqSHJDTVJvM1RaYVZ3SHFKbkN4emRLR0RxN0lNY0FGSDU5SW9xai9NQzZiWm5GMWcvWkFpSmxyZ29jU3N2NHdRWjdiQzJwMGxzeVYwKzRPbmFnZ1pUS3ErZDJBOU01cENLLysyZjMzZmZOL05kamRuL3paUTYvZS9VK1NNQUdtdHJYN0kwKzgvZjYvZi9tVGZRbjYxZnNlZk9udnY0VWgrU3YyeVEyalNmaGJ6c2wrVzNuZFZjZkJFU28xVHVXN2VzNkZvKzhUU3Vxd2N6dkFuREF3Qm9YWGdVSHFJQVlXMEt0Z1FmeWsvVzJNbnNQNVhnelFmcEN5dTlrQU5iREVibm43U2wvNGdEZTZGMDFvTmowMTFwUlB4UU9ubWF6REdTQXlTQ2JwVzZzcnl1Snc3dldIaEZHWVpmMWMrdmU1WGttdC9Zd2lpQXBFRXYrNmRjTU5sMTdaV0M3ZCs5cWh2em03V1VJays4clBuUng2YkxWMU1FSWJndmlIbjEydzlJOXZmZitLODBlOUovYzdCcUxKVGVxSlJmRHdUTi9iZkxyU2xJcEdtTFQwVnY3Mm8wbDdZOTA3NGJ0K2tQekRjM2I3dmhQbE91STZVK1RmL29rbGVxR2taSXpNSE1NQXVkTjh5dndMWFh2WjBPaDEwU2JFNVZIQTRpQWxYUGxBcUFQOXU1UVBud3IyN1BiNXk4M214UkZ2dmUwSmtjMlArczJ3QkIzakI1U0FqZFI3VmtYL3VORUdFb0pGemsrNVJPOGFmQmNkVWZiTzdqMmZQWHNLWlRnY2lkM3l4YXNHdDduaGsvT2ZXN2Vadi9qNDFKb3Qrdy9zN0VxT1ZoOXk0TjYzN01oRmN6YWNOV1h0eCtkczRMcjE4WDJJL01IVk9ydGZDQVBISnplOFJUM1FjbTdQaWhkQ0MxcHFGbDg3RW1KZ2JkdkVkMkhUdVBpeXdJMS9mL3pIYS9RL2Y4R2dTcElIWlVrVnRqTW01REJFTEMxcldjN1lQcmFaQmdJUHM2UFNsb2Q5RGVjUWY1MSs2aFY5MGdTNjQwZ2dVQWU5VmZiMjMzcG4vVjAvT0F4WURBUTA2NkVYMjRNZVBnRGdVS09FdWVZOW9TSFc1SDIwNU1tVmQzM3BDL3dLMjNxVHRlVVZDci8rUVE5eGVtM2dzVFc5SE9JSXNwOWYrOVYvLy8wZjd2bmk1YVBoRXcxZk5YOVQ1aTNYTWI3MjJXMXZyajlidUdaSzJGWnMvTk9DMHk4SXBleVl4Nnl6T1YzaEJWeS9CbHo4dTdZYXV5UnJTK0NTYzVTbStxYmxkNVEyU3NxS2h6YzQxdXlOeDE4QVJ4LzR1Ykh1TFRUbE5KYnNna2hKMDA0QkV6aHlXc1FGY0FYYSthU3ZhZ2FCbW9td3llRUx1c0hVZVdiM0xzK0VNMms4Z3MwOUV0UWM0WnFrOVJPQnNCUGF4YVU4bDhHUnZMdjRzQ04rZW4xZFhablFCemNkT0RLaHJIQnZjOW5lVUZIWkZSZHpTNlVQaEZULzFvN295UHR3WGt2NXRRc241SElKbldQYUNSWWZObmFpYzlIenk2Yjg4dnBsN3o1L2pML0xod2YvMFdrQUJIUDVWaW8rZVBnOTBESjM2ck8vd0tIZzBHMjRQSzhDb0FtQTJRQ2NCb0J2Y0J2U3ZuZkFwOUIxbEhSMWx2TFRvN1Z6K09xclh4RzNudXpDZHBJaGVhQXZjQ0creTlpeFNXQXZpKzlFL1QxNDJwV3NkNTlhT3pNSndvQ1puTkFiMFZnaTJra2Jtc25COS8yZzNDRXBDTEIrd1BTaTg1OGJXRThPNU4zSTQyKys4NGs1MDFkc2ZJMi83dXFMblR1MWFhaGJudFhZdFBYQVVmZjExeTgrLzVFMTc0eEtUOTYvZk1hczVod0wzYVlOc2F2bWIzU2l0NHQ5OGQ3M25uZENLZUszdnZJQXg3RjdDNlh0cmlmSXlNT3UrMmxKOGNGSzAwU2wyT2RCQjdzNXZNTUpXOGtWVW9sWXJodDVFNjQrZnJsMDJyekwrZTY0bEh0QTZ6TTBneDBSd3V2c2VjcjZNWWxsanZaeWNQUVZYKzAwM1lvd1RmVUh6d0FzSFhIbEx5ZGRiWGJqSFByZTQ1NVRkS0dabFRJNlVtb203YzQ4b0xidzBSZDJidm5neU80Zi8zb3BmL3VOV1ZkMFI2TjFRWFVvdWw1ZDV2MzFxdmN2bmRIQVh6ZUUxRDJIRG5YR2FJMS9tTEJwbG9qWjdYdTRHZzI5UXhxU0gzdDIxazJMdHVVZHZQdk90bnVXbmxia3pDdDN2SjE1emU5bDBmTy91SFAxbzBzdis5YUMwNGZWMXhQT25yYkRPL1QzR0d3UkpXejlBSEJGd1pOdHdBQ2dPNitSNzNQWHhaOTUyTnFXOGxGYjJ6ZHBGMTl4M0JBc3owakZKSm5iWDg4QnArREJJKzBEaURsZWNjOStlZTROaVoydlFWdnVGMzVtOTV4SlVEbkpFKzRFeXRTSXh5L0Zka2orSmhNa1M2SFZqa1pwYm5PZUVlR1BmTW92cjd1azhsS2dwY05VWXNhT3d3ZHhWaHBwdnZiaTFZNzA5R1krdmU3U1R6N3ovdnB2ejg4UEhJcys4Rk45OVIreWo2am5YQlQ0MWo4VTZaVEpUWjZYVnAxOWpKNk9UZndXOGc3eUl5RXRjSXk5YjRFY0d5ZVVSaW5DK2hBQTJVR012c0dubFdlY0hicjliTHQ5ZC9LUFQvRXVjNkI4QW9LN29SSE85RmdxZUFmRE5GNXllTzB4MElnZzZIekxwM2dKS0xkSk1oaXMxWUdlL3JZQnRISkQ3dllBU01wcllXKzcxMzltU1FoMnhoWWc5aTRrZW9uZHVmcVJXbDlOck5QZTRmbUFmOVk4WWVyUmFLeW1MRlNrRDRPYTVsVTBteUxKYWZLcHMwNzkvcVByR1RnUDVzRDNuano0Y3JFU3VQRUhvOTd0RDIxOGRmREJKUmQvbzZWeHBOR09vK1UzNXh5bEsxZHRMT3c4a3hwUEM5eDRXOFhTSitRWmN6Z2JQZ0UydFVSbjVxRzdmZ05CSVVaa1llYVBIYmF2VmNvYkJIRlNjYkNpQVlQNHdFaFFQU1lrdGhnaDN2N3VReFJJcFlvY01WZlluVnp2NHdKc3hjWlhHcjJuK29KYXpCUmtqR3RtQ1lPZU1YbHlzWmdXUUJHQ2NUTVZtSzhnVUtaNTkvZnBXYXJ0ditYQmwyT1hQNTJ4NlBhVk85N0t1N3VXeHRsM1hITGRLT1RKT1dZQjE0bHdXaEhxVThMVzdkQmZMWXRJbUVQYVJhcnJBemYrMDRtd2YwUHo4SHFQcE5CczE1b3dCck9QekNTZ0FzeDl5TFpKM2JtbXVRZkZ3MUZ2aFRYQXFqbGlOZjZwekJXN3NscXpaNDhNNG9qTDR4SWxQS1NFMmVIV3RrMWNWdm4wNnI1Z1o5cDlEVlZaclJDUnRVUEtZRVZDRllFeWNYM3BXN3Ywck5rcjMxOTN5MlVYcDNXREs2RTNZSzViVGJvNm5PakhmK1ZpWlN3NmZlV09OOEo2amhZVTB2elBmdW5Ib3pJSlMrRzd2cHRtUC9QS2JyMTdaR2RyYzZTdjE3SFZqY2NjUmtZWWpIVUF5Wk9Xbm80bEZSWkdFeXhGMytLQ01zQzYzL1BWTkNyeVJOTFJHa2dtR1FoWUxKN1ZRaUkyd1NTS0t5ZFpYWDYvM1dsSkFZN0w0ZEhMM0N1d0R0eHh5VUxLNE4wdnZITDdOYmRtOUxaWHQrN0IwakRCbVNGL1dYdm4wVm1UVWhyenJNYUpmOXF5SWZNVnp1djREcjcrWGJ0OUYwZncyQ25XRDIxOEplOEloNi9EZ0VmSHE1d21iT3ZXY0c0NjRsRkloWnMxSlNqR1h4WXVNYURaejdDY3dVZ3FQaGg4UkNJaEhCSXFQTEtIbFRlSVc0NGNKUUJCNElNc05rQ3JJUlRHQjl0R2FyMHdBUFh1QnpYbmNnWmE4azlBVVdkdFIxZTBPbENXM2F2Um1EbXh0cko0Si9mMVIzeXBJRkt4VlhwbGo2UWxMT0NWWWE0UGY5cVk5am9Yd0l2UCswSlE5WFBSMnp6aFZFNkIrTi9ST3JuRUJ4OUwyN21pRDl4VmZ0ZkRJK01TSDJHS1diUGc5SGxEZlhyZnNuMDNMeDYxMUFObW05Q01BbDh3UzExaWJGRGdBU3NaMG9LcTlrcUtvbFpQRmFHeGRvTDRROUFkR1hrRFd4eVRtR24zUjQrcU5acGVDb0taZTM3R202SVhQbGovcWJQT3pKNTJUV1pyVUM0K0VRZTgzdDVJWkdwMVdZYjNUNjJyZjNYTHRzL01PZXQ0UHVKVmYvdC94KzdrVXVqMisyS1BMT016Q0txcXk3TGtISSt0TGR5eDZQbC9iVzFmejM2NHBtQ0QvVzJKSDl5NmRYS1Q5K29GRTBibEY2bXBBNXFWL2k3Q2c2a0lpbUJ3U0F3TlkyY0cvWHRVZjVrV21Db3N5bGoyZUFJc0U2ZVcxWi9JTlRCVFJDS2RrcVBNRFR0RVVpUUMyRnY1MTQvMjlrMnR6cEc0c2lMMzluUGRvN3JJS1JxcXFydkR2UUJNSGpoU1dmbTd0MW8vTStjRUpOV05GWUtseHVtaDIzOTEvSC80anRmLzY5NzNublFKZm12N3hwYkdBdXpscGtWQ3kzenB1YU5YTHhpZFFtelFqQ00ya0V6a3VKTUwyeUpnaVVJNEJOcldRZHZ1bmVJalFPZEtvYXI0TFJFZ240VTFSakYwOVVVRy9KVzBhNDh1NG85TEZmSWNxbnIzanUwTmxmVmxxcHd6R2huQW9weEtNUmxzRWVyeCs3UGJ6S2l2cnl1ditXc3FVb0dPdnoyTEM5MHB2L3pDbmFzZnpOVlA4NXV0YWUxWjB5cmNJbyt1MkI4SjI2TVREVTFOQnpsb2dDMGcrdEdUaFVXMkhJeDF3dkk2SnF6c0JFb3lWYndXc0xONEJCUytaUXh0SkFtSWw5ZGhqMWNEQ1ZxaXk0OWZHeVhobDk5NmJWWlRVMzZFdTJXcHcyVWlSZVB4VUNBbmNLTGFwNVo1ZkhHTC9RK3RtMVprNXlEYnRLRy9oUENPanZrUGY2Y3RmQ1NQVGd4dWVkT2lEeklOWGx6Wk1Sb1hpZXl1SFRuU2o3bkpGT3lqS1hKQ2dIZWd5Z2J2cEZrSVJMZ3VqQlVKYVg0VDJGazhHZ0hiWkFqWldCWFdSYTVXU2FvSEpHQ3BUQTBDNU5teEp0RjJtdEdiZHp0SlhROEdoa21Xd1FqNVBQbUcrWWtWbFRzT2QzN2tianpjMXQrNmN0ZGp5OWFPbjdwcEk1MVFObTBJMzMvdjdoZFhIbzZFcmZ1WG4zdnR3c1lpalp0Q0U1ZGNmTU9kcTMrVE9kSThZZHFDMDF2eUx1UHVPejdrSkRqejl2NTc5MXk3c0ttVWl6SGJEaHB0QjFQMndhWUdwYWtoaDBTMHI5WnlIUW9paUFzWG1OSVpkVTBVUmFkN0Qralp6TFVwS2sxTXNnaVh0WXhZVlBZS1F1d0VOYVI4TzBZU2NTZ0pBNk1CdEFDUk5Vb1NHSHZ0UWZLY3BlU0psTXFGQnE2ZHVxOVRwMGZMWHY4ZG1KWGp2dkpMbmw2aGdsY1U2UTJNNWFEUG45ZTNYbFU5SEk2YzNUaXh4T2NiRGV2cld0dDNiamk2N3ZYOS9DOS9LOXhweXo4OVRxaklTT01pTHByeko0N2dMT2E2TmhoU2l0UFdPeTY1OGJtZHF6ZDA3SFFzMjRGbnYvanZJYTBzcjgyakQrM1BmdHZlRmkvNU91SE8rVjh1L0RpRGdkUCs0MVRFRVpSbCttTUR3Y0dES2NKd1d4azRzbzFaZWdKb0ZFYUJwZU5rMGdrNnpxVnB0cWt5SkFHWnNDaVFKaGpUcTVPaW1FOE5nRzVvdU83NCtkMWFnQ2FJMjU2RFVaVXdWcU9ZVlVvUzFJSyt0V0J1ZUlLMTQyWHlsZS9nNm9HT3JROVZIWXh3VVZwTVhpUU4zYWQ2OHU2bHNhcjJqUjFiUyt6UEYxWnN2SFBSQzNrSFA3MXdOdC9IaXlZM1FnUi83YnFtVFJzMjVLcGY3MDl1YXBuVkhDcnlyZVdmWGpMbjF5SllmdFUzZnRVVUtnRDNlNWJPL3RwbkIveVE5eStmVytKMUtrMlRhaGJmMExuc040VVFYSVpKZ2tFcHgycUdIUll4QkhoRjhvV0lIMDdGV2tKWFFQb2NsN2t6YkttbEJxb01oellBWm1QTGxNWHlBaXpMRzRJQlNjckNJTXhQcFlFanZlb3JPOHRyREtVMmtaUXRwaUxiNDBHMkZPZzFsRjdiZXlCZXJpRHRWNGNEYi9aNFBGNjdRVWxjVU5lWGJPK3JMMU0yblhtdTlQS0QwNyswdUVyMVk0ZEVWNWI3eStJYUtGWU9BTVFNUFphTSsrUWNBVEdwSW1RUnU4VCtmUEdoVFhsSHBqVlBXTEw4bW5Ga2l4amhYSER6NHROZmV1N3dtdGJPekJIT0phNmEzL3JTcWt1TGdMaDV3dlFsRjkvSXNjdGZGR3h3OVlKSnR5MDU4KzQ3dHpvL01ZMi9MZjJTNnBmOGZjK0tKMG00UCsrNFBMR2FzZTUwUmx1R3k3SmM1NXRqQzJZUWNzVkxkYnJIMlVXVHVCQ1dkcUsrZDN1ejJkOHg4ZHdQT0FTcVQrbXJtKzI0enlXT1lBYnBJTDFRQlltd1JXMW5xRlNDNVU4MzNQN0tKRkRqbVBBNGdlbFBYdlVKNWFxUGx4L29kbXFrSUx0Uk0yVms4NmtoYWFxN2t0NWRYWFhDVDEvWGZXOS9Ba2lkdnBYL2NscFpYVXZ0REo5UDI3MXQ5M2xsMDlTSnZrcWtWR2srYVpCQ3l2aTRNV201cnl6dkVmc1V4Ykpwd2daZWFaaEhmN2d0elBsRGpvRTVwUDNzMlMrUEsxUEdLRVJYUHZic1JXZE5lVEVTTm5OQnZHckx2cXVESVdWb0x2SHQ0cWU5N1k2Wm16ZEc5cmZGNzFsNmJJRjhPQlNjdFBUT3RrVzM1a3RXQlVNckNmQ0FESVlzSFVKTnNoQXMvTUNNRW1CSDhPcG5QNmRINjMzQnc0R2dQWEhTcVVaaWhxbC9yR3RMY01jemF5ZE0zMUUrOVFDQVIvMlZhd09ON2JDYWFaS3UrS0xZSjNMMEI4eHBHT2d4UzR3VHdiWmhSMHdES29HYVV6bWJpZEx3SGswS0lLTktzVjNTTFdPcUljSjFUbWZrbUVCMXd0aUlBbnhWSEpKeDI5alF0V3ZEa2MzQXE0QUQ4U2Q2WGdLZDlXVlNjSUlXbWx2WjFPaXJiUENFbW56VkhnbWRGcXlWS2ZKamo0SUxCQVEzbHRmMHhYVnZjSmhzbjhmdmZUZVhQRFIvYitrVkhNVEZ2eFYvNWo3dkZkK0Ezc0JmRElLRElaVkwzSmRXQ3YxcFpuTjVCcldSc00wL0dzbVo3MTkrM2tmenNGUXUvRXBHbi9NMm40VkRZaHJWbWlyb3kxY3lPY3NoeDNXblZJNW5sbkdDSDVIbzN1MlZmVDJUMXI3NjZYai9CTnZ1cTZtdHZQU3l1UkRwYWpDbStmZDZ5N3Q2ZDAvdDJOS3MrT2orTnhmNDY0NkdwaHlvbkx3MUVkMXR4dzlLa3l4eFJ0c1Iyd3lZQnZSVk9Odzd4ajQ4WkFNRktSeWdDRmdVVUQrcER3S2JrQUUvSUJmL2hkVkhwOUlFaHlPV2dlSUZLa1FCQ1VTNUZ1bnBONkw5eWZET3ZqYkFSVDB4QmVQeFZub2tGUklqaEFKL1huWHc5R0RkQlZWVEozbURsWXJQSnltMW5vQUJpTXFHZi9RdnJFanh3NVlGMDcrMzlNcjZwdEN3UFc5dGV6L3h6UDNtdWxXaDI1Y2ZIeENQVG56d3JPWkt2by82eFFXSEcrN0Z1TVFkLzVCM3hPN2V5YlV0NENuUHBydU80MnNBeE1MS3BaSytucktPSGorTTEzcTl0aSs0TDVtSTFVOGhnWW8yWFRjd1Z3UnRtekhiVXhIeDRJaFlTY05Rd25zYk96ZHpNbkdoNG52ejRMdE50VE8zVHp4M2cxcTNwNnF1R3daQmVVVWk1RmhFYUJUdTcwV2NLNlRVU0VJVkZRVzh5Q1FEd1hIcFVKM2h2SUdpcml0R0NIRUNRMlZOdURkeWlWRFNpQUdFRWloOGVQL2J2eWYyVWlIZUEvd0lSN2JxMTlpSFBWODZlT0hsRjU1WEM3eW5CS3A5c3FwQS9wR2NDOS8xMGJCK1RzdVVHNWZNNTM5TDZYT1dpRVlmK0dmUjFlM2JZNC84TkhEalhjY0R3VDBybnVBUzY2L0RQV01aTnQ5bFRaSUwxYjJqa1RaR3M5T0huSFRnbEMwQ0RwZ25NR28vR3JRWkg5d2VtMG9LTUJtamZyOFhTeEpqQm05c20xeDR1dDQ4OFE4ckZsYkNXbmtNMEppWm9MRkRkYjNiWnUxOTRUTWJqVGRJMWM2NUxkMnNzNy81RXgwaGNOajJzWU5SRHhmd0dSUjYvZGpyd1h4SURLd1Q2aXkvNGJwZmhzclZFOWNiMEtROS9jcURHNnpyWnhrWFRnUzlPc3VwT3NFZnJPcmVEVkRrQVFNaFlFa3ptWXpHT1QvNTlYdFAvYnIvRllEOXd1YUc1WExGT3p2VU1LZThhVVpaWFVCUkpua3IxaDFvLzhselg3N2ltbVB3UDhlZitYK2s2MUJhR0w5M2ZNSVRwTFpGMysxNTZJbUdwVC9ocysxZktIQk4zVDYwNitpZXRmc2FwdGQzSHVodE9yTkI5WEdad21vbTUwd0xMTHhYRk1MTFc5VUNzWndwVzdXVHZmNkRuYjZhaW1oUFI4QzJzYUl5akNTZjM4c0VBZ1RKSUFhaFJOQ05iSWh4QUhHUldLWWdVd2w3UWpxa2tCd20rM2JVN24zL05DMUlXMXRqNXo3ZTJUR2xNNGtOaEl4MGJTdm1VWkJIWVRibEloUmxaZ0hFZFRKV3pLc3RQb21iVnBWbWZmbDAwQkJnTWJNa0g3V3I2am0wR0ljVXpHVGI3Nk9HeFpGTmlONmRORitMZDc5MjRIM0FHVHBXeFoyZHFwVWRUYndiL3VYMFVLbXpxNzU2NVlEZVBPTmp4d2ZCNHE2aXJXOXVtek9mUTVtRW80TXpSUjlkc1pmdmExbzdIZGZ1MkdZVTh4ODYxcThrSS9haEhaMngzbVRsNU9wcEg1dDZ3VFhuV0FZTlZvYmlmV2EwMjhodWFYZHRSVExLWmIxNU5KdExWTHp2U0RCcGNDMWRqaWZLa0NnTFNMR0VGRlVtS1FTTHNwcVU1b2V6ZWJnY05oTlB0cjhaSVhFUDlsQm9JVFZaV1pXY2VHcHZaVTBZVUxqdTl6T2VmbjQ2VUd3cHM1b25vWm9pM0hqQzFzYXlIMGtKY05SdEdsTHBsYWZTY2hVazdXTjc1bjVWNms2by83MVoyZEVIeWowaTI1ZERsdE5yMlNNcXhtcmxRUFlLcXMxQWYrelEydTc5cFQ4TDMrZStNMkRXUE9kVHh5Y0xmWUFFOTZ6NDdlWXBjOElyZjUvbnRlUGEyRTJMM3J4cS9oOG5sZi8yckNsUGo2bUg4TEdIOXZCZitjR3Q3KzlQdVRDRzJTMmQ3dDdZTm5sR1EzVkQxWnhQbklFdzRoUmk4cG4xZXphMVQ1bmRzSDM5bmtTLzFibnNWeVRjei9qV3MwTlVWTStaYlJsRldUbktFckdpNnBIZWdOZGpKNU9lV0g4bGxnbVhsQmdqaUtIanBSTllZeFpGYmxobU5zbW1sb0o5cDFWZnJrSWZwWmJKaUVrSVRuTmFSYldxR3NMZVV6ckZlbDRVWndpTFZ3V0t4TThNczZnTkU5UENzTkgxWEdSelRiQXpMdjdpWXhSMW5IZjdaYU81a3ZobFlOSWgzZGxjY2ZSNEkvUVlpdjE0cmxna05hYktoQ296eml2UjFlL2tRL2hIRWhlUnBSNkVJemdVR2xUK3NmSHFCYW53dlAxdHNUV3RZNWpjZHRFbEV5Smg4NzVsSDU0MTVhbFMydTk0Zis4WkYwNkxoWk8yTlZCeFExWWx6YThtbzliWjg4LzY0SkUvSHZ6K2twM3pyNkhSQ0NieGJIY0djSU1yczNOOU1kUjF5T2RWUlNWNjBxc25Rd2dUa1kyUGtNd25YeWJNeEZ4ZU1wS051RFFxcU9XVnRQTnJtejFJb1pBbGJkMndEWlR1WGlSa01vMW9lazRXUDRPYXpDUkVhQTVEZ0dqRWkyc01SMWN0cTlwai91MU1xOEVQb21iUmNTS3Y3VDIyRW1IK3J3dE5qdU1ZZW9ORlc4cE9MaytaaU80VExpSnBkQkRzMko0SzFQcThmL25GR1J2Wll3L3RIanNFejh3eGFBelRPTjVubE5lVVl3bnYzMzZ3YW1KRlR2REtLWFdIZDNmd2o3eHIzNHFmMXB6WXNIbmZ0ZC9FZG9MQnJGSURqaUtYQTJrb3hDdGxYSlNicHVXM2JZOVltcDVSU2NheUxLV1lBMGV3VFFjakRBbHdrNGdSSVNLWUV1bkVzSm1kQVRwaVNKZnRzR2E2cTlSbXhLMG11ZnczbDVxUE5ZSzV6RFlKT0JJSEJobEdmc3ZhcW81dDdGaWVvRHpqZkM2SkhRcFJwRm5RRWJwcTFySU94VXIrSk9La1ZBUjdtMmNPbHNFdWtiaHRTY3F0OE9MSzlrallHaU1FejJ1cEx4SEJmT2Jkdm01MzNhazF4R2FpaEhnZ0o4NVE5c2dIOWg0MjloMlFYbjBwSG5McWpoR1RXZjB3eXlFSDNYejJIRTJPbVpaTVJJWXZzOHlnVFdRRU9XNnBvc2dPZ2xtS1JwQ2lVN3dvNEE1TllsRlIyRFdEWUtoTEpDWVFuT0VIb3JLZklsR0k4aTBPYmlqOHVOQ1JWVjk3ejRHb2ZXeWhyYjdQM2FMTiswTFJOb09KKzVDcnRiNzh3b0VILzNOSHFRajJ0OHdicXQzTmk4K2ExMUxuK0NsTUR1SXhRakFmS3BPYkFxVWdPTjZuaHlxRFhGb21Jc21zd3FucHFFSUpUMnlzcDFVVHBxLzVnMi9XTEh2aUZCenlBcUk3SzJ4bUpLQno5MUkyTVlZV2tWMnZocEVJTXNLbElSVldXd2ZCVEN3eDZ4UUxwRU9LU0RmdGppdC9uRVZrbVNrQUIycEN0dmtPYVZhSE15WmhHOEY4aVlzZ0cwbnU5S2pxK1FwSWRtL3BQYmFsY3psL3dOV1RqZ1hCekRsU29PWFRUK3o3eVEvWEhUNlVLQlhCZ1V2bUZXbDY5OUlMMGtSaTE5Z1JDWGVjREl2Z0kvdU9OSjBwcWlWMEgrN3JEeGVJUzJhSWRYVjBLVTJOelhmZlduZlhuVkpBUnRUT1owMllNNGFNSFVDQWhpT1lzMTB1Ylkxa21UUEhjUUJUcjljamNSbk1oTEFVR2lHbFJVVXdJSVRxZ2dSblZVYWlNS3FhcGt3d0c3RDdpbXFYc210N3lER1B3SS9raGh6MUxaVUVDKzJEaWQ3UmZzb2tTMndRcCtCVGdZajdXMjk2OHg5dmVUdVpKSVN3MGxuRXJDSk5aelZYUGZic1pad1FyMms5d2xXNk1WUG02b2RGc0cwUUJoRldSRUsvcnB1S1ZpQlZRZFhVeXVwcVVYaXp3cWVmZlJINi9BV3lMN2NBQUVzdlFEOHdpMFBUUkZ6dFlrU3lqSUFUc3liYWU3eWE4SDY1NFdrTWdhRVI3T0FTRXNlOW15SEJMaUpqaXNYUG5BNkRjMFlEaG1VK2lRK0kzQUI3aHltUElIMTZ0RFozdUFLTWp4cjlZL0NnWFJPUUNWSVZ3UE1iZk9lR05ZODl2SXN6Tjl0bXBsRnNSWGcwOWRuSG5hS1VnSXNyWlZBcXl5Qzd4SlF0KzY2OWVrSFRmZmR1R1NNRVg3dndkTDRYUjNCdlI2U2lwanhGUElKbFJzSW93TWI4ZmxsU1VqZkowTDVWVDRHQWorWEtOb2FkZFpIZGtBUXgrUVBUaGdoWnhQSVRzd3dpeTFGN2tLeGdscVlPNHFHU0lpeEM1SHp3RVdBemt1V3A1b3lZUlR4R0ZqY1FRV3hBRmdpbWxBMHkwYk1URHQrc3E1RzJSZzZPd1lPMkhld1dKZyszZmUrZHh4N2F5Uno0Y2dHOGMzdTRXSTVHYU1FMTA1cWFkczYvUE5CeWNTbVRGNmVxanoxN3hmNjI2TmpOZFBjdm43OTVRMCtSOCsvYjJqYnJvcGx1ZzNBNHFpZU1Bc1lCakN6VFZvVFZCa3c5cXpwd1NnWFE5K1VLR1pHZmtWWGpuME1UR2hiQ21OcW16N0s4Q0FsVEdnY1VUb2QzY2JGSytaeG1GN0NtRFVoUUFBMUdMR1puV0FUbnZnVFJQaTBKc3Fxb0VFcXdKZ1Y4c21YYk1NK2FCc2RGN0dJcXZFalIvbnhvQ3l0YXluUFI4Ly9RRmo2WWVkc1dPYmprNHU4dW5QMkY0VVQ4a0dTSjYxcUNyVEhSelp6R2hmdU1JbUNRbkhVR1pwK3gvbDJqcmIxMFVFNXVLaHZUN250cDFUVkRYWXlSTkN2cnF6MWxuZ0dOakJYdUM2L2ZsNXJZRWF4cXFpSzdEV0dDek5Ma1JNeHV4cGdsREJBd2FRQkZac21vMzdaVUxEa1JrQkJLa2tzaE9IQWxaakhpQ09vaEhndkVFT3NpT3NQRWFic0hKOXU2UktPYWxYT1JoSG05a2wvRGhKaDV3VlhqZ0VGa09TeGwzNjYrZlZIYktwT0dESlJkc2ZHcDdMY2hyV3pCNlplUFJNQjkrN3N6SDN0b0IwSlF4RkF4TUdWcXNNalpVcG1lbkQ4RVdpNFpQd21vVGxUYUVPdHhtQ1JVTzJEOVZUemVVRzNWNEdhbVlYVjJadklaQWVrL1VLQVh4Qm93YVJZS21VMmdaWFBnMmNsRUdiRVZLRXhwVEpFbFZWTzR5SFJSVG15YldEWkNROHRnQkpOMjBxSldSZ2J6TGpheHJVczJ5REZFUUJrekJmRmZnSG5Bd1pBQk9DNlVPV2Y4U2NDSUhFbEVpaS9NbUwxeDZSdlNnaU41K3JPYXEyZk5xUkx5VllJTGJ6enprYWV2T0I2NXlxTzJXSXROV2R4a2hpMzhwWHdhNTBwYjFDQ0hJc1k3dTR6MSswQTQyYi9yc05rVkZnMGM4VnBlRS9MNEM5VEo3T3VMT2hUVGZXdlIyTkZVdUZhKzVYVUF6WVJpeW9UN21OaGxuQ056b2NzUGNZMVE4MmkyNDhYZ3ZVVXNMalFwTExLQUM0U21iYVlRbi9KVm83aGlKV1NTVThxSEFZNWdqRzJXaTJBR0FCcFh4YnBFakpFZHRvcjVsbHNhY3haS3V1VmozeHc1REc2K1pYWmxsZmFiUno3MWczK1pPMnl1OHZpcWJoWjljUzNjM2NHbEV3cDRsV21OMEttZXkvbTg4ZUVlMGh0TktqTFg0RHhCZi95TjdWU1R5NXBxais3dDBCR1lLTWtFSTZqS1RKR1FSK0h5elJjS1RKZzBJVFVua3lSTDlrQlZZL2xnY1dxNXA1Z3cveEdKY2hrS1pHSUd1QUIyMmFxaXlySXF1dzQ1VGhFb0I2ZE5pbGQ0TjRtZGJjNlZLQXg3REZPMnBYUkVoTXNURkluS2lBMVM1QndXRE1lTkp1Y3NoWEFvMFFNcXB4VGx6R0xqNU9HVzg2NXZDazBhK2E5KzVSdlRMN3BrWXNQazRXUGt4eGVDK1VSdUgreVNFUkJSZjRybHpQQ09GaUZpYXpBSEtKUWwvajZlMEVVU21HR1ptL1lwSFpGRTNLWUpxMS9YRlZsT0pJM2Uvbmp0ckdtSWF3QkhZMXJRU3lVdjdYcmQ2eGMyc2tLUmVTeGxqa1hRb3NMb1N5eXZvWmRCSjRLTVMzR1Ywd2lNTFNHRHhWVVEwK0lJeG5qSXBYdEVjcG9vZVRMd1hMbm9GYVkwVEpBdERWQk1DalNKeVJqYVpNZzgwL0d5eWVyamU5NzQzS1M1UTMzT2llL2k4Mjdnb3JjcDFEQ0tQOXN3dVNSZGEzd2htTVJFWkEyVFpXR0E0bjh4empLK09rbVpBS1ppSEoyRVhlVHhSdVh1cDdhOWNjclV6L2k4VGdrRzNhQngvY2pxVFI1WjdscTltZE5hUzYrb20veEM0RXhrSi9PRGJxSExnMTNZSUpDME1BTVdNU3JOWkJuQ3dwVEd4NG1zY2tVT1d1a3ZFTTVtYlNaSlF5MTV6OC9JREdvT1pEdUxBUUtGR3BlM3VoZWxtZ0prR1psMlh0cXdvNEdQS3hoci90OGZXaWRDL29lWWVaNzkwbitkU0hQZmFKMW9UZXZCa1orRVJ1TFFtVmFoRS9PZFRvUVlVTkJaN3NQVkRhTytQUGlGOCtjS0F5TjFTam54NTQrUjVOVXNSWUpsWHRucmtYMnFWR1lCYWcwdTcrY0dLYkRVdVpHdVl3cUpaZmh0MDRlY3FFc09QMW1XaGVYQkNRNTJZdE5va2VCelVkdWFVa3NnR0dVd2JTUGFyNXFEMWtvQ1hrVVVRc2x6ajdCeEtZUGo4ZTUrTXdIRzVUWTZtdHpkZDd4NzI2MXJSa0dOTXdtd2JDZDVoK3Zxa3Fzd0ZhR0VoTmdCeFh0dTAzUUpZU2Rmc29BdURaQ05wUGhnclptNUVqSlZLMVhFL1JxT2pVRlBCSWd0dXp4WTJFTTVnck9xbUFpWDh0QW80eTBKNDVxZWxURldJQVlNaVhCTkxuLzhNT3JSY01GMGQ1aXExVE4rbURDZkNmVWVNejdlbFA1UjArVDJ0L1hmZCsrR1NOalkzeFlkb1ozWTdvMjZ5V2NpN0VaVnhIS2JqbDA3VTZrYTV0TUFhRlBTbjRpN3I5UE9VR2ZxVG9sdEJKR0JwYWh3TmVUYklSaEE2UUFGZ1dGa1dTSWozdFRMZ2NqakZYTUJSa2pWWkRlL3lEVmRRT0hsZ0VQSlNuN0J1cDNreENCakRPYmFXOFNqUnhYRHFWZVpyUjRCbndZUmhvTkVzeHZaQTlOM01CNjBFejRGV2YxMmNvUlFJVjBIckcxdm11dGU5bHh4b3p6ajQ2TjFkZExJVDNIVG9sYzRmUG1MKys1ZGY4L1NTMFp5S25QN2ZpekxxWkFTQ1g4azVZWU5vRmxZTWJESTJPVXltT0hCc2c2NTZ5R25YTXJZc1BqWEpHb0Ywd3N1Y3g2T1ZGVmhxZmhIaDBnUTF4ZFMrSW9raEF3cmFSSVRwZDE0TWtFUjFZeXFKaVFveDVraUlSRVVRZk5QbFVJdUhHZm1DR3J0NkQ5eVR2a3hseUpuaVlqcG9KWmpseU00NVpOYTkzdU80TUNOdjNSQzJFWUJ3U01hV0MrdTNKTmh3UHoxUFV0YlN2bFdlT1hLOEhQUEtZMEROYi9VcHFiZzU3OUVlL3RsQlZObnNXUGtJQmdXY0JNTjYwbktEaUpIc3F4TFdHY1VEK2FiTEZQekQ0bTZyTHJKY2V5elREOTAxRGhDaUtvcFhwOUdiSkt4alZKYXJOQWw0cFNGQ21WUFNjZHVJd2FqaWtVeGxXeWNiYThRQ1BZV0NJb1lqenhZV1A2OEsvZTk5YlhHangrajBOMmYvT01EZHZ0bUR0KzhqL2lSK0tNL0xGdjgwSW1Yd1pzM2RHYlRpVTBidW1ZMVZ3OXpZK0Z3MjZKRi9HLzJ3V21yVmtIZFJCWWxHcDlaUlNVU0tFbVpCZVloS0hXUlRlYW16N3NBRmJHOFNKS2prcHhrYkJEbFJFNGRuYlNpeUZGS0dMQk1qNUgwWWtlTm80UW9mbytpS2lTVkIrU0VCOXRPbENVY2N2eFl3ZzNENEVEb0c0eXFCc0FVRVNrRGZhRzlZZUJSMk9EVlBaa0lUWU1wVCtINHdiTHFmZlhnZW41aitGaVdPc1hWay8xZi8wa0dzbHdZdTFCV3o3bFN1L2lyVGhxUzJMNXp3NnYvOFp0UG5UQUU1eEhmeHg3NmNGYnpNRVJpTUh5YmxpOFB0TFJZUjNxQWFVRk40VThZU1JKU2xIUWtMbU1sOTF1MlIxYVVNR1ZZVXNNSUowaWVNZGdKMmNrS0RxYVVxaHprdHVHeExjMDFSQkRLT0lXUVpVelNPaUlYcUl3VWl3L203TVVTU1VpWjlvQWkycStaenJwRU1Fc0dDMmV0SXZHaEFRdXl6bkZFZ3QzT1FsS1lKVTFtZTZEOEVlMFpNejQrRlBkOTRwRnRGWlhhai81dDNvbXhwazF1Q3VhU2l0M0Q4NGVWSzdPUDFDeGVYTGx3b1hpdWZWSG8wa2NPRVJtTG5icVU4eGdlSm1QWk5SejRxYkNpaENIV3MxS3kwdFFYT1NsR3FhcVV6Q0tJQTR1WTVZUjRnR3RLbzB4UkpTeGhsaFZISmZBNWRJSUdQNTFPakl6WkFURmtTRVRFVlE0YWdqSm1LaTQ4RnVENENZb1lNSFBMd0lvbmlUbEdQL0NiK3pjOTlmaU9FNFBnZVMzSDRJWXgyOXE0QU00K3dyRTdhZW5TMUtlZFlUY2Foam4rVzRFd2xxbm9BRC9TSXhVR0I2SEdRVkxJR0p4eFovQVgwS2FjbFNKaWhnQ1ZvS3UwTVNZTGI4WkFGVE9PYWVGU0hoSmVrRkNTdEF5WURwdHcwdU5vVE02TjZYRjFSRWpFMEdDRlJ3S0FkRHpoMTZuS1lFU2RaSTB4T0wvWXdEL2UwcnJ5cVYwbkFNRjVST0sySmVlWHpoKzh6YzBaK0hKeGErMCttTEkvTUtkb1FrNkVDMlNsWUJqbUxLUWxoRGNIRVk0WDFnR2hZMDFMWmROQTA4SzJyVmhtSU4xWVNITkoyS1FIVWpGRmh0SFF3Y0VjNnhhMURXSTQrYi9pNnJGSWp6T1RpcDF2eTZOUXhsU1dBR1dna0NiSEFCaFhiam1IY2pGclMwL2IyQ0NZRHhEUnFRLzh4NFlUZytDTTZoWU1xZGN1UEhPb1pwM0xsa1ZiV3pOdmxhWW1ycjA1cWRIT016Vk1ITmVCVXhiS1FUQVVNVFlwUUxKak1VWmtKemp3anJFUlRnNHlCbWVzd0c1UWhGZ3FLMmxTMDhCRzBwY3VpQzBpMFJSTnppcUh6VVd6SzRPSDZFcUlPQWtXTHVWVWlEcVVLSXFwWmtLeFVONE1ZRk8vQjN0VVpCZEtlMDVYeG1MakJyOXVJVGJsejRjM2pwbVFGeUErMmhIZnN5dDhBaEE4YzNZS3dUZmZVbXc5MEtQMzNqdWdwWVpDVTU5OU5nTmY0T3BOTm5VRnJSTjdqcEdiaHc0ejhCbGVKa0dXczRxV2szUnNZU2syMkpBaFdrS2FUbjBYWThRaXdoQmg2VDZFU1hvYVFKcXFab0xIM0NnamFnMEpMSXl3YnV1bWJXRzM5RHRnbUtLNFlqTms0enlOalREaDhGWVJJUVVXWTRSd3ZMRmc1M29rZFdlaVk2eCtJcjI5OHZ0OUp3TEJ6VFVwQkM4dVZxcDY1cjU5VGN1WE82bDRnTU9YVTRpY2VUVVNaNmFWam8xbFdKSEZhd1pHa3JyTEtFWW9LVWtKUUZFaHUydWFtQWlpeXpVNXhvaWYySDR1dGxNa1dKWTlIalZUSXMzSmVCSHh3VU1GQjNPQmJ4RFRZcG5ZZHNaSFNMOWlDaVlEY2gxeWxQbzB6cGhRUWJOY3VwTFFPT0lRenJKbDBvN1lFVG9XTXdOekUxL0Yzeld0QjA0WUQrYjhZZGg2MTF4djR6aWVzWDU5b0tVbFg4bnJDbWVMVDhRUlBPQWxMdG5RNzlxQTA2MUZ4VE1jbDNDQ1VUa3Yvb3M1U2NjRENScVVhM0tRV3VYVVRoa2l1SFJVVmNYalZRZE1hUWhSMjNJU05OQVFNd0MwMHhMYnRRUVQ1Q1o0d2tHK1krcFJ4VFJUa0FYQjB0ZGpQSjZickhWR0RrZHRmZFJQZk9OM21sTnFCd09IRDhVNmp5YU9ONEpkSGx4Y2g4dmU4cVJ2U2daM2h0T0JEWTVEVHBXZFo4blNYdUpTTHlaZEI5TEpGYWRZVW1KWWpsT1d0K0NXbys3anRPbVk0NHNnUWlVakdTSk9uUjdYUGl3S25VaFNoa1dJTkUrUm9HRVhUS0tBS1Z1RVRkUDF0REZEbGh1VlZnaW5YQWFMd0xUQkhvMkJleDFudmprc2cwUmZlN1JyMUUvODQ1L09lL0tGejlSTjlCTWl6SXZ2dlgza2VDUFloZThJWTNwb2J3Um1DdXJ3WjV0YlQ1eVZwc2lsdExoMGZDM2pNbGlKUWlucHVJL3ovZE5wQktja3NXM0xwdTVQZTlPRTRReExXT1NzWlVDR0lMRW8zNGV3UlFpWGhjNXA4c0Jab1NIWmNjWE0weU1kbG8vS2ZCalFnak1MYzR4TEVJdzdNU3lTTmRiMjdCbUxVMTl3MGNRWC92VDViLzlkTTdIcHF5L3ZPeEVJdnVPQ0VYMmZVdElYWXpJZWtFS09Hc2NHYThRbG1DSmdTcHQzMXM2U1loRFlyTUJ0c2xSZ2FXcldwNFpRNDBJb1U0eFZwQjBEbElWZ0VUbkpaYkJkbUFjNy9qK1N0UFVNdkdXaHhsa3hoZVFaZzJrcXJBZFJWdEMwTE13d0VMQnhCMkIrUGFyODl0R3RZM1Q2c3FCNjB5MXpIdnp0MzVnbTdlcE1IRzhFajNBakNZUEZFaEM3b1dMQ0N1Q2tyOUZjMFpSVkhtMW8vRHFBRzRpdmhTamhwRTBVQUFySVZLSVdybUtvSjN5V1h1NGFJaHljVVUxVlpJd3lDRVlZMmFiTmlRUXFqR0RJQmJSdTZ5amRwWmpDaUdZbUZTdlBFTUdjc0I2ZlNMMWpoWENDNExoZHQxdFNQb3dlR3ROZk9IMUd4ZjNMTC9QNTVMOHdCTnRkWVJGWkE5MmdYY2NiZ0hNcm1idCttNUprTU11eW1QSFRKQWY3dDFJK0RKVG1KVmpVRE5hVFhrQzFUR0E3UDQvWHAyRXNaYzduOG1BMmxFY0RpYWcwaXd6b2VZaWhWSHBjN3ZnaHFhQUlPRlI0QlJ5UDRXbnVsY203NDUzSFlYYncvc1VobUt0eEdLUm1UcEZmaEpHejNFT09Jd09tSGM3RkY1Z1lRTEN3NXhxeUduRm9hSDVOQmdheTJDbGt1Z1dUeVFDbHFpaDZsbUl5VU5PVW5DK21RaXNMbzB1a2doRExGS1Y2QnRicWlHcEdYa3lQZTNJSk0xbGlwTEFNSHNjSVZqeWQ0VVBoY1padU5FNWtjQVJtZ2dvWmhaSWtHTVVBRmxNMkExYUtqcDZPWTNNV0Q5Q3gwbC9ZSVljY1RTNTlkc09VNHJFS2FrdHVFU3JoUmNWUXhMYm55VW5Ld0JBTERJbFZBWmpOUmJScitrVVVtcGlFVlIwTWhyeFRrOExKc3kvRVJ0eGFTK01Ud2tnR3lkNk52VzBuRVR4b0MvY0RLVFZmQzJjWXg1NWphc3A5dHNPcDU5QVJ3Q2svbmxnOEFHSmR3bkhHY01HMldWVXJtVzVLUnFJaXM1SzlDTFZVVkk5WEk4VE9SekFicWgraERVUnNleWFteDVDY291MFVGWmlNa1pEQkJYVlROd1FCamRkSWQzNWpIWHI0SklKenU4VW1kbC9NNWJrdWhLQWlnVUxXZmxqVXB1WmFvREtXQTBZNWlVMWlPY1pvd1hUS1ZONisrNldrTGhHakxHT0tkYkl6eEg5MnR0Y1hPdFhiaDdLSlFHZ3ppOUpVMFZXblZocUpxU1lZSEFGc002OEhlbFE4MktXY3RxV3hjYXJKQ1RNUE9wVHNQWW5nWExuV24yQUozVjNuekdVUlNKR0ZualdnUTdtQWc4UExwVlNGbEJTQ0pTWE9RWnlmWDVSQ2V5Yk5VOWd1REYyemJUZkRQbVVNbG1TRUpkY1FrVVZlaUp1RFd2alJKaTNEY1VFN1FRUVV4a1ZNRHljVmczN2RKa0VmOW1xU1hRakJ6dVduQnVQNFE3QUlkZitnZDg5SkJPYyswSjRJTkcwR3MwUXBaeFF3ajdlV05LbG1oYVdKMEVoSjdoZUJhWU14eEZ3RXAyTGJPV25RelNBbFhvanNORmxna21BeU1EZUFWMVJXSzdqQWhlcytpVnZKZ2ZYQUtZb3BwaTBUYWJBTXBpRGt3NW8wWk9ZSkZQSEY0MVNYQTZybnRZT2I2SGd5Vm84REZzRXBSRlphc2hDM0Vob3NnS0JidFlFTks0UmRlSXB2SUJ3RjBDckVnOWxBNG9mVE5oR3ZJcFluNDg0UUpGb3NXaXpXbXhrWU9xSUVuck95NnlCNDhRT0UycnB0WkJ2YVlvb05ZQ0dRTWxibUUvNitRcVlJWjhtdlZObWVjY2tpWk8vUjZJRnhaWTRZQnl3aXJnL1VmQlp6TktlQnVFQm9DNFREWjh0bEtxazZvaFVORWR1ZVBwRkxDVVRXWlRSU1RXd3RaVXB6TkRuTm8wb1N6bG1oUURBVGxodC9QUEFSWWRRV2VFK1Y3ZU92d3E0cGJiQVpCRUpOQnVuVmUxZ2hUVzY4ZWpURXlKZUFGZTNXKzA4aWVHQXpEM1ZCbkwxTTRCRDFSK0h3QWlKamluQ1FZMk1jSzFpSVY3UVN5OFl4dDF5YWJjTll0QnhTS2N2M3dYdytEMG9YbTBxZG5JcHFQRVBrT3prSUJsWXFXSnUvaFRRc290SUtHTlA0M1ltRmFOTnAvZ1Z2ZEx5YTAxSWQwV2ZGVHlJNExZQ1RCdXVPQURrcmtWamsyZU5zMlpUS3B4aHVZczIxVkloRkNHUzFmMGpEQlhhcW5BcTZRSFJEMFJPQmxFdmJPU1pLOVloQ0p5QzM5QVJ3NnE0V3pLb1F4YVlzUnR6SkJERm9ZWnFVclVKU1RJQlRrVmphY3NjS1RoRHBPUC94dWRGZC9VZE9JamlEWUpQcEJoZ29zY09RaEpHemVGdGhmQlowV01HVXBIT2lJcHpZZFU1RVpFTlNZb1VNRVk1Z1JkUkJNT1E2VnpMaFRTYktrWlFtd1lCaWpCVlZaalIzNFRpV3lpSVpqQ3d1clhWaW1yYmxJSmpMZDJFTVRzaGlRYU5CV3B5NE9rMGVzT1FWaERoQzQ5SWU3RDRuU1h0Njd4c25FWnplNHJwWStEVWpYNm5qa011S3lrM1Bxa0s3WWU2SzJVUElKcFlPTDNhTUNRaGhIVXVKSWR3WndtQ2Jza1VnRm9zRkRMME1DVU9FYTBvRFhNK1NGWWt5bXAwMXl0K1J3c1VGeFhwSFNVdTNpSVVkZkdNRyt6VXpOampCRTZSeVF6UTVLd3Q3OENNWnZ4ekN1V2hGZTZObngvZ3hSL3gvQVFZQStzajZkNTN4blpnQUFBQUFTVVZPUks1Q1lJST0nOwoKICAgICAgICAgIGRldGFpbHMuYm94ID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgY2xhc3M6ICdzZi1hZHYtY29udGFpbmVyJywKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBwb3NpdGlvbjogJ2ZpeGVkJywKICAgICAgICAgICAgICB3aWR0aDogJzEwMCUnLAogICAgICAgICAgICAgIHRleHRBbGlnbjogJ3JpZ2h0JywKICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLAogICAgICAgICAgICAgIHpJbmRleDogOTk5OTk5OSwKICAgICAgICAgICAgICBib3R0b206IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgZGV0YWlscy5kaWFsb2cgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgY2xhc3M6ICdzZi1hZHYtZGlhbG9nJywKICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgICAgICB3aWR0aDogJzg4MnB4JywKICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnOTJweCcsCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmYnLAogICAgICAgICAgICAgICAgICBmb250RmFtaWx5OiAnQXJpYWwnLAogICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnbm9ybWFsJywKICAgICAgICAgICAgICAgICAgdGV4dEFsaWduOiAnbGVmdCcsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgICAgICBib3R0b206ICcyMHB4JywKICAgICAgICAgICAgICAgICAgcmlnaHQ6ICcwcHgnLAogICAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI2FhYScsCiAgICAgICAgICAgICAgICAgIGJvcmRlclJpZ2h0OiAwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb246IFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgICAgICAgICB2YXIgZWwgPSBlLnRhcmdldDsKICAgICAgICAgICAgICAgICAgaWYgKGVsLnRhZ05hbWUgIT09ICdBJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgaWYgKGVsLmhyZWYuaW5kZXhPZignI3VuJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGRldGFpbHMuX29uQ2xvc2UoMCwgMSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICBpZiAoZWwuaHJlZi5pbmRleE9mKCcjY2xvc2UnKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgZGV0YWlscy5fb25DbG9zZSgpOwogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgaWYgKGVsLmhyZWYuaW5kZXhPZignI29rJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGRldGFpbHMuX29uQ2xvc2UoMSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICAgICAgICAgIGNsYXNzOiAnc2YtYWR2LWRlc2MnLAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLAogICAgICAgICAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ6ICcyMzBweCcsCiAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nVG9wOiAnNnB4JywKICAgICAgICAgICAgICAgICAgICAgIG1hcmdpblJpZ2h0OiAnMzBweCcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3AnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICcxNnB4JwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICBtb25vLnBhcnNlVGVtcGxhdGUobGFuZy5kcERpYWxvZ1RleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3AnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiBtb25vLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjNjk2OTY5JwogICAgICAgICAgICAgICAgICAgICAgICB9LCBzdHlsZUZpeC5kcERpYWxvZ1VuaW5zdGFsbCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICAgICAgICAgIG1vbm8ucGFyc2VUZW1wbGF0ZShsYW5nLmRwRGlhbG9nVW5pbnN0YWxsKQogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogbW9uby5leHRlbmQoe30sIHN0eWxlRml4LmRwRGlhbG9nTW9yZSksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZi1tb3JlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGxhbmcuZHBEaWFsb2dNb3JlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJlZjogJyNtb3JlJwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZi1idG4gYXBwbHknLAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLAogICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICAgICAgICByaWdodDogJzI4cHgnLAogICAgICAgICAgICAgICAgICAgICAgYm90dG9tOiAnNXB4JywKICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMThweCcsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc0cHgnLAogICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogJzVweCAyNHB4JywKICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyM4N0FGMTgnLAogICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjZmZmJywKICAgICAgICAgICAgICAgICAgICAgIHRleHREZWNvcmF0aW9uOiAnbm9uZScKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHRleHQ6IGxhbmcuZHBEaWFsb2dPaywKICAgICAgICAgICAgICAgICAgICBocmVmOiAnI29rJwogICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyNnB4JywKICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyM4N0FGMTgnLAogICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICB0b3A6ICctMjhweCcsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXJUb3A6ICcxcHggc29saWQgI2FhYScsCiAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nTGVmdDogJzJweCcsCiAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6ICcycHgnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBsYW5nLmRwRGlhbG9nVG9wLAogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTdweCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFdlaWdodDogJ2JvbGQnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnI2ZmZicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzI4cHgnCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcwcHgnLAogICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMHB4JywKICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6ICcwIHNvbGlkIHRyYW5zcGFyZW50JywKICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogJzI2cHggMTVweCAwcHggMHB4JywKICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSaWdodENvbG9yOiAnIzg3QUYxOCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAnMCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogJy0xNXB4JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTZweCcsCiAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAnLTFweCcsCiAgICAgICAgICAgICAgICAgICAgICBib3R0b206ICctMThweCcsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI2FhYScsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSaWdodDogMCwKICAgICAgICAgICAgICAgICAgICAgIGJvcmRlclRvcDogMCwKICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmYnLAogICAgICAgICAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ6ICc0cHgnLAogICAgICAgICAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0OiAnNHB4JywKICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcxNnB4JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZi1ib3R0b20tcGFuZWwnLAogICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICBtb25vLnBhcnNlVGVtcGxhdGUobGFuZy5kcERpYWxvZ0J0bSkKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnaScsIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogJzBweCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICcwcHgnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogJzAgc29saWQgdHJhbnNwYXJlbnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAnMHB4IDBweCAxOHB4IDE1cHgnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlckxlZnRDb2xvcjogJyNhYWEnLAogICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogJy0xcHgnLAogICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0OiAnLTE1cHgnCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcwcHgnLAogICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMHB4JywKICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6ICcwIHNvbGlkIHRyYW5zcGFyZW50JywKICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogJzBweCAwcHggMTZweCAxM3B4JywKICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJMZWZ0Q29sb3I6ICcjZmZmJywKICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ6ICctMTNweCcKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1idG4nLCAnY2xvc2UnXSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAneCcsCiAgICAgICAgICAgICAgICAgICAgaHJlZjogJyNjbG9zZScsCiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsCiAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0OiAnMnB4JywKICAgICAgICAgICAgICAgICAgICAgIHRvcDogJzZweCcsCiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzE4cHgnLAogICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMThweCcsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0QWxpZ246ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJywKICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzdBN0M3QicsCiAgICAgICAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiAnYm9sZCcsCiAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogJzE0cHgnLAogICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzE2cHgnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dCh7CiAgICAgICAgICAgICAgICAgICcuc2YtYWR2LWNvbnRhaW5lcic6IHsKICAgICAgICAgICAgICAgICAgICBXZWJraXRVc2VyU2VsZWN0OiAnbm9uZScsCiAgICAgICAgICAgICAgICAgICAgTW96VXNlclNlbGVjdDogJ25vbmUnLAogICAgICAgICAgICAgICAgICAgIE9Vc2VyU2VsZWN0OiAnbm9uZScsCiAgICAgICAgICAgICAgICAgICAgdXNlclNlbGVjdDogJ25vbmUnLAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzAwMCcsCiAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogJ25vcm1hbCcsCiAgICAgICAgICAgICAgICAgICAgYXBwZW5kOiB7CiAgICAgICAgICAgICAgICAgICAgICBkaXY6IHsKICAgICAgICAgICAgICAgICAgICAgICAgYm94U2l6aW5nOiAnY29udGVudC1ib3gnCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgcDogewogICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICdub3JtYWwnCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgJy5zZi1hZHYtZGlhbG9nJzogewogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICd1cmwoJyArIGFkdkRpYWxvZ0ltZyArICcpJywKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJ3JlcGVhdC14JywKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAndG9wIGxlZnQnLAogICAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogJzEycHgnCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgJy5zZi1hZHYtZGVzYyc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAndXJsKCcgKyBhZHZEZXNjSW1nICsgJyknLAogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAnbm8tcmVwZWF0JywKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAndG9wIGxlZnQnLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICc5NHB4JywKICAgICAgICAgICAgICAgICAgICAgICAgYm94U2l6aW5nOiAnYm9yZGVyLWJveCcKICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAnYSc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjNjk2OTY5JywKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgJy5zZi1ibGFjayc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjMDAwJwogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICcuc2YtbW9yZSc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjM0UzRTNFJwogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICcuc2YtYm90dG9tLXBhbmVsJzogewogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyM2OTY5NjknCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgJy5zZi1idG4uYXBwbHk6aG92ZXInOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6ICcwLjgnCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgJy5zZi1idG4uYXBwbHk6YWN0aXZlJzogewogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAnMC45JwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KQogICAgICAgICAgICBdCiAgICAgICAgICB9KTsKCiAgICAgICAgICBsYW5nUHJlcGFyZShkZXRhaWxzLmJveCk7CgogICAgICAgICAgaWYgKGxvY2F0aW9uLmhvc3RuYW1lLmluZGV4T2YoJ3NwcmludC5jb20nKSAhPT0gLTEpIHsKICAgICAgICAgICAgZGV0YWlscy5kaWFsb2cuc3R5bGUucmlnaHQgPSAnNzNweCc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobG9jYXRpb24uaG9zdG5hbWUuaW5kZXhPZignbmV3ZWdnLmNvbScpICE9PSAtMSkgewogICAgICAgICAgICBkZXRhaWxzLmRpYWxvZy5zdHlsZS5yaWdodCA9ICc2cHgnOwogICAgICAgICAgfQoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRldGFpbHMuYm94LnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAwLjVzJzsKICAgICAgICAgICAgZGV0YWlscy5ib3guc3R5bGUub3BhY2l0eSA9IDA7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZGV0YWlscy5ib3gpOwogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGRldGFpbHMuYm94LnN0eWxlLm9wYWNpdHkgPSAxOwogICAgICAgICAgICB9LCA1MCk7CgogICAgICAgICAgICBkZXRhaWxzLm9uU2hvdyAmJiBkZXRhaWxzLm9uU2hvdygpOwogICAgICAgICAgfSwgZGV0YWlscy53aXRoRGVsYXkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIC8vQGluc2VydAoKICAgIHJ1bigpOwogIH0sIGZ1bmN0aW9uIGlzQWN0aXZlKGluaXREYXRhKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAobW9uby5nbG9iYWwuZXhBdmlhQmFyKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB2YXIgcHJlZmVyZW5jZSA9IGluaXREYXRhLmdldFByZWZlcmVuY2U7CgogICAgaWYgKCFwcmVmZXJlbmNlLmhhc0RQKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoIXByZWZlcmVuY2Uuc292ZXRuaWtFbmFibGVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAobW9uby5nbG9iYWwuZGRibEFkdikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBtb25vLmdsb2JhbC5kZGJsQWR2ID0gdHJ1ZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9LCBmdW5jdGlvbiBzeW5jSXNBdmFpbGFibGUoKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAobG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoIWRvY3VtZW50LmJvZHkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmIChtb25vLmlzSWZyYW1lKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmIChtb25vLmlzU2FmYXJpIHx8IG1vbm8uaXNGRiB8fCBtb25vLmlzR00pIHsKICAgICAgdmFyIGV4Y2x1ZGVMaXN0ID0gWwogICAgICAgICdmdHA6Ly8qJywKICAgICAgICAnZmlsZTovLyonLAogICAgICAgICcqOi8vKi5nb29nbGUuKi8qJywKICAgICAgICAnKjovLyouYWNpZHRlc3RzLm9yZy8qJywKCiAgICAgICAgJyo6Ly8qLnNhdmVmcm9tLm5ldC8qJywKICAgICAgICAnKjovLyoueW91dHViZS5jb20vKicsCiAgICAgICAgJyo6Ly8qLnZpbWVvLmNvbS8qJywKICAgICAgICAnKjovLyouZGFpbHltb3Rpb24uKi8qJywKICAgICAgICAnKjovLyoudmsuY29tLyonLAogICAgICAgICcqOi8vKi52a29udGFrdGUucnUvKicsCiAgICAgICAgJyo6Ly8qLm9kbm9rbGFzc25pa2kucnUvKicsCiAgICAgICAgJyo6Ly8qLm9rLnJ1LyonLAogICAgICAgICcqOi8vbXkubWFpbC5ydS8qJywKICAgICAgICAnKjovLyouc291bmRjbG91ZC5jb20vKicsCiAgICAgICAgJyo6Ly8qLmZhY2Vib29rLmNvbS8qJywKICAgICAgICAnKjovLyouaW5zdGFncmFtLmNvbS8qJywKICAgICAgICAnKjovLyoucnV0dWJlLnJ1LyonCiAgICAgIF07CgogICAgICB2YXIgcmVTdHIgPSBleGNsdWRlTGlzdC5tYXAoZnVuY3Rpb24ocGF0dGVybikgewogICAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgICB9KS5qb2luKCd8Jyk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAocmVTdHIpOwoKICAgICAgaWYgKHJlLnRlc3QobG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdG5hbWUpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgdmFyIGluQmxhY2tMaXN0ID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICJ2ay5jb20iLAogICAgICAgICJ5b3V0dWJlLmNvbSIsCiAgICAgICAgIm9kbm9rbGFzc25pa2kucnUiLAogICAgICAgICJvay5ydSIsCiAgICAgICAgInByaXZldC5ydSIsCiAgICAgICAgImZhY2Vib29rLmNvbSIsCiAgICAgICAgIm5ld3Muc3BvcnRib3gucnUiLAogICAgICAgICJwbGF5Lmdvb2dsZS5jb20iLAogICAgICAgICJyb2VtLnJ1IiwKICAgICAgICAibGlua2VkaW4uY29tIiwKICAgICAgICAiZXgudWEiLAogICAgICAgICJpbnN0YWdyYW0uY29tIiwKICAgICAgICAicnV0dWJlLnJ1IiwKICAgICAgICAiZS5tYWlsLnJ1IiwKICAgICAgICAiZm90a2kueWFuZGV4LnJ1IiwKICAgICAgICAic3VwcG9ydC5rYXNwZXJza3kucnUiLAogICAgICAgICJ2aW1lby5jb20iLAogICAgICAgICJjbHViLmZvdG8ucnUiLAogICAgICAgICJnYXJhbnQucnUiLAogICAgICAgICJ3ZWJtYXN0ZXIueWFuZGV4LnJ1IiwKICAgICAgICAic3VwcG9ydC5rYXNwZXJza3kucnUiLAogICAgICAgICJmb3RraS55YW5kZXgucnUiLAogICAgICAgICJtay5ydSIsCiAgICAgICAgIm1ldHJpa2EueWFuZGV4LnJ1IiwKICAgICAgICAiaW1hZ2VzLnlhbmRleC5ydSIsCiAgICAgICAgImRpc2sueWFuZGV4LnJ1IiwKICAgICAgICAibWFwcy55YW5kZXgucnUiLAogICAgICAgICJoZWxwLnlhbmRleC5ydSIsCiAgICAgICAgInd3dy55YXBsYWthbC5jb20iLAogICAgICAgICJ3d3cuZmFjZWJvb2suY29tIiwKICAgICAgICAibXkubWFpbC5ydSIKICAgICAgXTsKCiAgICAgIHJldHVybiBtb25vLm1hdGNoSG9zdChsb2NhdGlvbi5ob3N0bmFtZSwgbGlzdCk7CiAgICB9OwoKICAgIGlmIChpbkJsYWNrTGlzdCgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9KTsKICAodHlwZW9mIG1vbm8gPT09ICd1bmRlZmluZWQnKSAmJiAobW9ubyA9IHsKICAgIGxvYWRNb2R1bGU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxvYWRNb2R1bGVTdGFjay5wdXNoKGFyZ3VtZW50cyk7CiAgICB9LAogICAgbG9hZE1vZHVsZVN0YWNrOiBbXQogIH0pOwoKICBtb25vLmxvYWRNb2R1bGUoJ2RlYWxwbHlGcmFtZScsIGZ1bmN0aW9uKG1vZHVsZU5hbWUsIGluaXREYXRhKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgcHJlZmVyZW5jZSA9IGluaXREYXRhLmdldFByZWZlcmVuY2U7CgogICAgaWYgKCFkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3IoJy5vZmZlcnNfdWwnKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgIGFjdGlvbjogJ3RyYWNrJywKICAgICAgdDogJ2V2ZW50JywKICAgICAgZWM6ICdkZWFscGx5JywKICAgICAgZWE6ICdzaG93JywKICAgICAgZWw6ICdiYXInLAogICAgICB0aWQ6ICdVQS02NzczODEzMC0zJwogICAgfSk7CgogICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7CiAgICAgIGlmIChlLmJ1dHRvbiAhPT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGxpbmsgPSBlLnRhcmdldDsKCiAgICAgIHZhciBpc0xpbmsgPSBmYWxzZTsKCiAgICAgIGlmICgvZ290by8udGVzdChsaW5rLmlkKSkgewogICAgICAgIGlzTGluayA9IHRydWU7CiAgICAgIH0KCiAgICAgIGlmICghaXNMaW5rKSB7CiAgICAgICAgbGluayA9IG1vbm8uZ2V0UGFyZW50KGxpbmssICdBJyk7CgogICAgICAgIGlmICghbGluaykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFsaW5rLmNsYXNzTGlzdC5jb250YWlucygnY2xpYWNrYWJsZUFyZWEnKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaXNMaW5rID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKCFpc0xpbmspIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBsYWJlbCA9IHByZWZlcmVuY2UuY291bnRyeSArICcgbGluayc7CiAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgIGFjdGlvbjogJ3RyYWNrJywKICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgIGVjOiAnZGVhbHBseScsCiAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgZWw6IGxhYmVsLAogICAgICAgIHRpZDogJ1VBLTY3NzM4MTMwLTMnCiAgICAgIH0pOwogICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICBhY3Rpb246ICd0cmFjaycsCiAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICBlYzogJ2RlYWxwbHknLAogICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgIGVsOiBsYWJlbCwKICAgICAgICB0aWQ6ICdVQS03MDU1MDU1LTUnCiAgICAgIH0pOwogICAgfSk7CiAgfSwgZnVuY3Rpb24gaXNBY3RpdmUoaW5pdERhdGEpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBwcmVmZXJlbmNlID0gaW5pdERhdGEuZ2V0UHJlZmVyZW5jZTsKCiAgICBpZiAoIXByZWZlcmVuY2UuaGFzRFApIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICghcHJlZmVyZW5jZS5zb3ZldG5pa0VuYWJsZWQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICghcHJlZmVyZW5jZS5jb3VudHJ5KSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9LCBmdW5jdGlvbiBzeW5jSXNBdmFpbGFibGUoKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICBpZiAoIWRvY3VtZW50LmJvZHkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICghbW9uby5pc0lmcmFtZSgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAobW9uby5pc1NhZmFyaSB8fCBtb25vLmlzR00pIHsKICAgICAgdmFyIGxpc3QgPSBbCiAgICAgICAgJyo6Ly9mLm1naWNpbmpzLmluZm8vKicKICAgICAgXTsKCiAgICAgIHZhciByZVN0ciA9IGxpc3QubWFwKGZ1bmN0aW9uKHBhdHRlcm4pIHsKICAgICAgICByZXR1cm4gbW9uby51cmxQYXR0ZXJuVG9TdHJSZShwYXR0ZXJuKTsKICAgICAgfSkuam9pbignfCcpOwogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHJlU3RyKTsKCiAgICAgIGlmICghcmUudGVzdChsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0bmFtZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9KTsKICAodHlwZW9mIG1vbm8gPT09ICd1bmRlZmluZWQnKSAmJiAobW9ubyA9IHsKICAgIGxvYWRNb2R1bGU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxvYWRNb2R1bGVTdGFjay5wdXNoKGFyZ3VtZW50cyk7CiAgICB9LAogICAgbG9hZE1vZHVsZVN0YWNrOiBbXQogIH0pOwoKICBtb25vLmxvYWRNb2R1bGUoJ2F2aWFCYXInLCBmdW5jdGlvbihtb2R1bGVOYW1lLCBpbml0RGF0YSkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIGxhbmd1YWdlID0gaW5pdERhdGEuZ2V0TGFuZ3VhZ2U7CgogICAgKGZ1bmN0aW9uKCkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBhcHBJbmZvID0ge307CiAgICAgIHZhciB0YnIgPSB7fTsKCiAgICAgIHZhciBtYWluID0gdGJyLm1haW4gPSB7fTsKCiAgICAgIHRici5lbWl0ID0gZnVuY3Rpb24odHlwZSkgewogICAgICAgIGlmIChhcHBJbmZvW3R5cGVdKSB7CiAgICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgICAgICAgIGFyZ3Muc2hpZnQoKTsKICAgICAgICAgIGJyb3dzZXIuc2VuZE1lc3NhZ2UoewogICAgICAgICAgICBhY3Rpb246ICd0YnJFdmVudCcsCiAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgIGRhdGE6IGFyZ3MKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHRici5lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghYXBwSW5mby5kZWJ1ZykgcmV0dXJuOwogICAgICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICAgIGFyZ3MudW5zaGlmdCgndGJyJyk7CiAgICAgICAgY29uc29sZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmdzKTsKICAgICAgfTsKCiAgICAgIHRici5sb2cgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIWFwcEluZm8uZGVidWcpIHJldHVybjsKICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgICAgICBhcmdzLnVuc2hpZnQoJ3RicicpOwogICAgICAgIGNvbnNvbGUudHJhY2UuYXBwbHkoY29uc29sZSwgYXJncyk7CiAgICAgIH07CgogICAgICB0YnIuaG9zdG5hbWUgPSBsb2NhdGlvbi5ob3N0bmFtZTsKICAgICAgdmFyIGJyb3dzZXIgPSB7CiAgICAgICAgc3RvcmFnZTogewogICAgICAgICAgZ2V0OiBmdW5jdGlvbihkYXRhLCBjYikgewogICAgICAgICAgICByZXR1cm4gbW9uby5zdG9yYWdlLmdldChkYXRhLCBjYik7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBmdW5jdGlvbihkYXRhLCBjYikgewogICAgICAgICAgICByZXR1cm4gbW9uby5zdG9yYWdlLnNldChkYXRhLCBjYik7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzZW5kTWVzc2FnZTogZnVuY3Rpb24obXNnLCBjYikgewogICAgICAgICAgcmV0dXJuIG1vbm8uc2VuZE1lc3NhZ2UobXNnLCBjYik7CiAgICAgICAgfSwKICAgICAgICBnZXRVSUxhbmd1YWdlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBsYW5ndWFnZS5sYW5nOwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIG1vbm9VdGlscyA9IG1vbm87CiAgICAgIHZhciBjb21wb25lbnRzID0gU2F2ZUZyb21fVXRpbHM7CgogICAgICB0YnIuZ2V0RGF0YSA9IGZ1bmN0aW9uKGRldGFpbHMsIGNiKSB7CiAgICAgICAgZGV0YWlscy5hY3Rpb24gPSAndGJyR2V0RGF0YSc7CiAgICAgICAgcmV0dXJuIGJyb3dzZXIuc2VuZE1lc3NhZ2UoZGV0YWlscywgY2IpOwogICAgICB9OwogICAgICB2YXIgZ2V0UHJvZmlsZU5hbWUgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaGFzVHJhdmVsQmFyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLmRhdGFzZXQudHJhdmVsQmFyKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5kYXRhc2V0LnRyYXZlbEJhciA9ICcxJzsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBoYXNUcmF2ZWxCYXIoKSAmJiBtb25vLmdsb2JhbC5hdmlhQmFyUHJvZmlsZTsKICAgICAgfTsKICAgICAgdGJyLnByb2ZpbGVOYW1lID0gZ2V0UHJvZmlsZU5hbWUoKTsKCiAgICAgIGlmICghdGJyLnByb2ZpbGVOYW1lKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoY29tcG9uZW50cy5tdXRhdGlvbldhdGNoZXIuaXNBdmFpbGFibGUoKSkgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbWFpbi5ydW4oKTsKICAgICAgICB9LCAwKTsKICAgICAgfQogICAgICB2YXIgZ2V0TGFuZ3VhZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbGFuZ0NvZGUgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgbGFuZ0NvZGUgPSAnJzsKCiAgICAgICAgICBpZiAoYnJvd3Nlci5nZXRVSUxhbmd1YWdlKSB7CiAgICAgICAgICAgIGxhbmdDb2RlID0gYnJvd3Nlci5nZXRVSUxhbmd1YWdlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFsYW5nQ29kZSAmJiB0eXBlb2YgbmF2aWdhdG9yID09PSAnb2JqZWN0JykgewogICAgICAgICAgICBsYW5nQ29kZSA9IG5hdmlnYXRvci5sYW5ndWFnZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWxhbmdDb2RlIHx8IHR5cGVvZiBsYW5nQ29kZSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgbGFuZ0NvZGUgPSAnZW4nOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBsYW5nQ29kZS50b0xvd2VyQ2FzZSgpLnN1YnN0cigwLCAyKTsKICAgICAgICB9KSgpOwoKICAgICAgICB2YXIgbGFuZyA9IHsKICAgICAgICAgIHJ1OiB7CiAgICAgICAgICAgIGxhbmc6ICdydScsCiAgICAgICAgICAgIGZvdW5kT25lV2F5OiAn0J3QsNC50LTQtdC9INCx0LjQu9C10YIg0LTQtdGI0LXQstC70LU6JywKICAgICAgICAgICAgZm91bmRUd29XYXk6ICfQkdC40LvQtdGC0Ysg0LTQtdGI0LXQstC70LU6JywKICAgICAgICAgICAgdmlldzogJ9Cf0L7RgdC80L7RgtGA0LXRgtGMJywKICAgICAgICAgICAgb3JpZ2luOiAn0KLRg9C00LA6JywKICAgICAgICAgICAgZGVzdGluYXRpb246ICfQntCx0YDQsNGC0L3QvjonLAogICAgICAgICAgICBjbG9zZTogJ9CX0LDQutGA0YvRgtGMJywKCiAgICAgICAgICAgIGZvdW5kSG90ZWw6ICfQndCw0LnQtNC10L3QsCDQu9GD0YfRiNCw0Y8g0YbQtdC90LA6JywKICAgICAgICAgICAgYXJvdW5kSG90ZWw6ICfQoNGP0LTQvtC8INC10YHRgtGMINC+0YLQtdC70Ywg0LvRg9GH0YjQtTonLAogICAgICAgICAgICBjaGVja0luOiAn0JTQsNGC0LAg0LfQsNC10LfQtNCwOicsCiAgICAgICAgICAgIGNoZWNrT3V0OiAn0JTQsNGC0LAg0L7RgtGK0LXQt9C00LA6JywKCiAgICAgICAgICAgIGluTW9udGg6ICfQsiAlbW9udGglJywKICAgICAgICAgICAgY2FsTGFiZWw6ICfQktGL0LPQvtC00L3QvtC1INC/0YDQtdC00LvQvtC20LXQvdC40LUhJwogICAgICAgICAgfSwKICAgICAgICAgIGVuOiB7CiAgICAgICAgICAgIGxhbmc6ICdlbicsCiAgICAgICAgICAgIGZvdW5kT25lV2F5OiAnRm91bmQgYSBiZXR0ZXIgcHJpY2U6JywKICAgICAgICAgICAgZm91bmRUd29XYXk6ICdCZXR0ZXIgcHJpY2U6JywKICAgICAgICAgICAgdmlldzogJ0xlYXJuIG1vcmUnLAogICAgICAgICAgICBvcmlnaW46ICdEZXBhcnQ6JywKICAgICAgICAgICAgZGVzdGluYXRpb246ICdSZXR1cm46JywKICAgICAgICAgICAgY2xvc2U6ICdDbG9zZScsCgogICAgICAgICAgICBmb3VuZEhvdGVsOiAnRm91bmQgYSBiZXR0ZXIgcHJpY2U6JywKICAgICAgICAgICAgYXJvdW5kSG90ZWw6ICdGb3VuZCBhIGJldHRlciBob3RlbCBhcm91bmQ6JywKICAgICAgICAgICAgY2hlY2tJbjogJ0NoZWNrLWluOicsCiAgICAgICAgICAgIGNoZWNrT3V0OiAnQ2hlY2stb3V0OicsCgogICAgICAgICAgICBpbk1vbnRoOiAnaW4gJW1vbnRoJScsCiAgICAgICAgICAgIGNhbExhYmVsOiAnR2V0IGEgYmV0dGVyIGRlYWwhJwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGlmIChsYW5nQ29kZSA9PT0gJ3VrJykgewogICAgICAgICAgbGFuZ0NvZGUgPSAncnUnOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGxhbmdbbGFuZ0NvZGVdIHx8IGxhbmcuZW47CiAgICAgIH07CiAgICAgIHRici5sYW5ndWFnZSA9IGdldExhbmd1YWdlKCk7CgogICAgICBtb25vVXRpbHMuZXh0ZW5kKG1haW4sIHsKICAgICAgICBzdG9yYWdlOiBudWxsLAogICAgICAgIGNhY2hlOiB7fSwKICAgICAgICBwcm9maWxlTGlzdDogbnVsbCwKICAgICAgICBlcnJvck1hcDogewogICAgICAgICAgTE9XX1BSSUNFX0lTX05PVF9GT1VORDogMTAsCiAgICAgICAgICBSRVFVRVNUX0FCT1JURUQ6IDExLAogICAgICAgICAgQUlSUE9SVFNfUEFSU0VfRVJST1I6IDIwLAogICAgICAgICAgQUlSUE9SVFNfQkFEX1JFU1BPTlNFOiAyMSwKICAgICAgICAgIENJVElFU19QQVJTRV9FUlJPUjogMzAsCiAgICAgICAgICBDSVRJRVNfQkFEX1JFU1BPTlNFOiAzMSwKICAgICAgICAgIENDWV9QQVJTRV9FUlJPUjogNDAsCiAgICAgICAgICBDQ1lfRU1QVFlfUkVTUE9OU0U6IDQxLAogICAgICAgICAgQ0NZX05PVF9TVVBQT1JUOiA0MiwKICAgICAgICAgIEFWSUFfUjFfUEFSU0VfRVJST1I6IDUwLAogICAgICAgICAgQVZJQV9SMV9FTVBUWV9SRVNQT05TRTogNTEsCiAgICAgICAgICBBVklBX1IxX0ZBSUw6IDUyLAogICAgICAgICAgQVZJQV9SMV9FTVBUWV9EQVRBOiA1MywKICAgICAgICAgIEFWSUFfUjNfUEFSU0VfRVJST1I6IDYwLAogICAgICAgICAgQVZJQV9SM19FTVBUWV9SRVNQT05TRTogNjEsCiAgICAgICAgICBIT1RFTF9FTVBUWV9SRVNQT05TRTogNzAsCiAgICAgICAgICBIT1RFTF9QQVJTRV9FUlJPUjogNzIsCiAgICAgICAgICBBVklBX1I0X1BBUlNFX0VSUk9SOiA4MCwKICAgICAgICAgIEFWSUFfUjRfRU1QVFlfUkVTUE9OU0U6IDgxLAogICAgICAgICAgQVZJQV9SNF9FTVBUWV9EQVRBOiA4MiwKICAgICAgICAgIEFWSUFfQ0FMX1BBUlNFX0VSUk9SOiA5MCwKICAgICAgICAgIEFWSUFfQ0FMX0VNUFRZX1JFU1BPTlNFOiA5MSwKICAgICAgICAgIEFWSUFfQ0FMX0VNUFRZX0RBVEE6IDkyLAogICAgICAgICAgQVZJQV9DQUxfREFURV9QUklDRV9FTVBUWTogOTMsCiAgICAgICAgICBBVklBX0NBTF9NT05USF9QUklDRV9FTVBUWTogOTQsCiAgICAgICAgICBBVklBX1I1X1BBUlNFX0VSUk9SOiAxMDEsCiAgICAgICAgICBBVklBX1I1X0VNUFRZX1JFU1BPTlNFOiAxMDIsCiAgICAgICAgICBBVklBX1I1X0VNUFRZX0RBVEE6IDEwMywKICAgICAgICAgIFNDX0tFWV9FTVBUWTogMTA0CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gaG9zdG5hbWUKICAgICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAgICAgKi8KICAgICAgICBpc0FsbG93OiBmdW5jdGlvbihob3N0bmFtZSkgewogICAgICAgICAgdmFyIGJsYWNrTGlzdCA9IG1haW4uc3RvcmFnZS5ibGFja0xpc3Q7CgogICAgICAgICAgdmFyIGJsYWNrTGlzdEl0ZW0gPSBudWxsOwogICAgICAgICAgYmxhY2tMaXN0LnNvbWUoZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICBpZiAoaXRlbS5ob3N0bmFtZSA9PT0gaG9zdG5hbWUpIHsKICAgICAgICAgICAgICBibGFja0xpc3RJdGVtID0gaXRlbTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKCFibGFja0xpc3RJdGVtKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBub3cgPSBwYXJzZUludChEYXRlLm5vdygpIC8gMTAwMCk7CiAgICAgICAgICBpZiAoYmxhY2tMaXN0SXRlbS5leHBpcmUgPiBub3cpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwb3MgPSBibGFja0xpc3QuaW5kZXhPZihibGFja0xpc3RJdGVtKTsKICAgICAgICAgIGJsYWNrTGlzdC5zcGxpY2UocG9zLCAxKTsKCiAgICAgICAgICBtYWluLnNhdmUoKTsKCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNiCiAgICAgICAgICovCiAgICAgICAgbG9hZDogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICByZXR1cm4gYnJvd3Nlci5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGFjdGlvbjogJ3RickdldEluZm8nCiAgICAgICAgICB9LCBmdW5jdGlvbih0YnJJbmZvKSB7CiAgICAgICAgICAgIGlmICh0YnJJbmZvICYmIHR5cGVvZiB0YnJJbmZvID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgIGFwcEluZm8gPSB0YnJJbmZvOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYnJvd3Nlci5zdG9yYWdlLmdldCgnYXZpYUJhcicsIGZ1bmN0aW9uKHN0b3JhZ2UpIHsKICAgICAgICAgICAgICBtYWluLnN0b3JhZ2UgPSBzdG9yYWdlLmF2aWFCYXIgfHwge307CgogICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShtYWluLnN0b3JhZ2UuYmxhY2tMaXN0KSkgewogICAgICAgICAgICAgICAgbWFpbi5zdG9yYWdlLmJsYWNrTGlzdCA9IFtdOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBydW46IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgIHJldHVybiB0aGlzLmxvYWQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghYXBwSW5mby5pZCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG1haW4uc3RvcmFnZS5yZW1vdmVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIV90aGlzLmlzQWxsb3codGJyLmhvc3RuYW1lKSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gX3RoaXMucHJvZmlsZUxpc3RbdGJyLnByb2ZpbGVOYW1lXTsKICAgICAgICAgICAgaWYgKCF0ZW1wbGF0ZSkgewogICAgICAgICAgICAgIHRici5lcnJvcignVGVtcGxhdGUgaXMgbm90IGZvdW5kIScsIHRici5wcm9maWxlTmFtZSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcHJvZmlsZURldGFpbHMgPSB0ZW1wbGF0ZS5jYWxsKF90aGlzKTsKCiAgICAgICAgICAgIHJldHVybiBfdGhpcy5pbml0UHJvZmlsZShwcm9maWxlRGV0YWlscyk7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtjYl0KICAgICAgICAgKi8KICAgICAgICBzYXZlOiBmdW5jdGlvbihjYikgewogICAgICAgICAgcmV0dXJuIGJyb3dzZXIuc3RvcmFnZS5zZXQoewogICAgICAgICAgICBhdmlhQmFyOiBtYWluLnN0b3JhZ2UKICAgICAgICAgIH0sIGNiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB2YXIgZ2V0QXZpYSA9IGZ1bmN0aW9uKHRicikgewogICAgICAgIHZhciBtYWluID0gdGJyLm1haW47CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEB0eXBlZGVmIHtPYmplY3R9IEF2aWFJbmZvCiAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gb3JpZ2luCiAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gZGVzdGluYXRpb24KICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBkYXRlU3RhcnQKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBkYXRlRW5kCiAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gY3VycmVuY3kKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBwcmljZQogICAgICAgICAgICoKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gYmFyUmVxdWVzdERhdGEKICAgICAgICAgICAqLwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcGFyYW0ge0F2aWFJbmZvfSBwYWdlSW5mbwogICAgICAgICAgICovCiAgICAgICAgICBvbkdldERhdGE6IGZ1bmN0aW9uKHBhZ2VJbmZvKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgICB0YnIubG9nKCdJbmZvJywgcGFnZUluZm8pOwoKICAgICAgICAgICAgaWYgKHBhZ2VJbmZvLmJhclJlcXVlc3REYXRhKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhZ2VJbmZvLmJhclJlcXVlc3REYXRhID0gdHJ1ZTsKCiAgICAgICAgICAgIHZhciBjdXJyZW50QmFyID0gbWFpbi5iYXIuY3VycmVudDsKICAgICAgICAgICAgaWYgKGN1cnJlbnRCYXIpIHsKICAgICAgICAgICAgICBtYWluLmNsZWFySW5mb09iaihwYWdlSW5mbyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBvbkFib3J0ID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICB2YXIgZXZlbnROYW1lID0gJ2Rpc2NhcmQnOwogICAgICAgICAgICAgIGlmIChldmVudCA9PT0gJ2JldHRlclByaWNlJykgewogICAgICAgICAgICAgICAgZXZlbnROYW1lID0gZXZlbnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRici5lbWl0KCd0cmFjaycsIHsKICAgICAgICAgICAgICAgIGVjOiAnY2hlYXBmbGlnaHQnLAogICAgICAgICAgICAgICAgZWE6IGV2ZW50TmFtZSwKICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHZhciBpbmRleCA9IG1haW4uZXJyb3JNYXBbZXZlbnRdOwogICAgICAgICAgICAgIGlmIChpbmRleCkgewogICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gW2luZGV4LCBwYWdlSW5mby5vcmlnaW4sIHBhZ2VJbmZvLmRlc3RpbmF0aW9uLCBwYWdlSW5mby5wcmljZSwgcGFnZUluZm8uY3VycmVuY3ksIHBhZ2VJbmZvLmRhdGVTdGFydCwgcGFnZUluZm8uZGF0ZUVuZCB8fCAnJ10uam9pbignOycpOwogICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0RXJyb3InLAogICAgICAgICAgICAgICAgICBlYTogdGJyLmhvc3RuYW1lLAogICAgICAgICAgICAgICAgICBlbDogbGFiZWwsCiAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHRici5lbWl0KCd0cmFjaycsIHsKICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0JywKICAgICAgICAgICAgICBlYTogJ3JlcXVlc3REYXRhJywKICAgICAgICAgICAgICBlbDogdGJyLmhvc3RuYW1lLAogICAgICAgICAgICAgIGNkOiAnZmxpZ2h0cmVxdWVzdGRhdGEnLAogICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRyZXF1ZXN0ZGF0YScsCiAgICAgICAgICAgICAgdDogJ3NjcmVlbnZpZXcnCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbWFpbi5iYXIuaXNBYm9ydGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMucmVxdWVzdERhdGEocGFnZUluZm8sIGZ1bmN0aW9uKGVyciwgZGF0YSkgewogICAgICAgICAgICAgIGlmIChtYWluLmJhci5pc0Fib3J0ZWQpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRCYXIgJiYgY3VycmVudEJhci5jbG9zZSgpOwogICAgICAgICAgICAgICAgdGJyLmxvZygnQWJvcnRlZCEnKTsKICAgICAgICAgICAgICAgIG9uQWJvcnQoJ1JFUVVFU1RfQUJPUlRFRCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgY3VycmVudEJhciAmJiBjdXJyZW50QmFyLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBvbkFib3J0KGVycik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgbG93ZXJQcmljZSA9IG51bGw7CiAgICAgICAgICAgICAgdmFyIG5lZWRDb252ZXJ0aW5nID0gIW1haW4uY3VycmVuY3kuaXNTdXBwb3J0ZWRDY3kocGFnZUluZm8uY3VycmVuY3kpOwogICAgICAgICAgICAgIGRhdGEucHJpY2VzLmRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKG5lZWRDb252ZXJ0aW5nKSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gaXRlbS5jb252ZXJ0ZWRfdmFsdWUgPSBtYWluLmNvbnZlcnRDY3koaXRlbS52YWx1ZSwgcGFnZUluZm8uY3VycmVuY3kpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFsdWUgPSBpdGVtLnZhbHVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChsb3dlclByaWNlID09PSBudWxsIHx8IGxvd2VyUHJpY2UgPiB2YWx1ZSkgewogICAgICAgICAgICAgICAgICBsb3dlclByaWNlID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChsb3dlclByaWNlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ0xvdyBwcmljZSBpcyBub3QgZm91bmQhJywgcGFnZUluZm8ucHJpY2UpOwogICAgICAgICAgICAgICAgY3VycmVudEJhciAmJiBjdXJyZW50QmFyLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBvbkFib3J0KCdMT1dfUFJJQ0VfSVNfTk9UX0ZPVU5EJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0JywKICAgICAgICAgICAgICAgIGVhOiAncmVzcG9uc2VEYXRhJywKICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICBjZDogJ2ZsaWdodHJlc3BvbnNlZGF0YScsCiAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHRici5lbWl0KCd0cmFjaycsIHsKICAgICAgICAgICAgICAgIGNkOiAnZmxpZ2h0cmVzcG9uc2VkYXRhJywKICAgICAgICAgICAgICAgIHQ6ICdzY3JlZW52aWV3JwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBtYWluLmJhci5hdmlhQmFyU2F2ZUluSGlzdG9yeShwYWdlSW5mbyk7CgogICAgICAgICAgICAgIGlmIChsb3dlclByaWNlID4gcGFnZUluZm8ucHJpY2UpIHsKICAgICAgICAgICAgICAgIHRici5sb2coJ0hhcyBsb3dlciBwcmljZSEnLCBsb3dlclByaWNlLCBwYWdlSW5mby5wcmljZSk7CiAgICAgICAgICAgICAgICBpZiAoIWFwcEluZm8uZGVidWcpIHsKICAgICAgICAgICAgICAgICAgY3VycmVudEJhciAmJiBjdXJyZW50QmFyLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgIG9uQWJvcnQoJ2JldHRlclByaWNlJyk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBkZXRhaWxzID0ge307CiAgICAgICAgICAgICAgZGV0YWlscy50eXBlID0gJ2F2aWEnOwogICAgICAgICAgICAgIGRldGFpbHMucHJpY2VzID0gZGF0YS5wcmljZXM7CiAgICAgICAgICAgICAgZGV0YWlscy5wYWdlSW5mbyA9IHBhZ2VJbmZvOwoKICAgICAgICAgICAgICBtYWluLmJhci5jcmVhdGUoZGV0YWlscyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHJlcXVlc3RBaXJwb3J0czogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgdGJyLmdldERhdGEoewogICAgICAgICAgICAgIHVybDogJ2h0dHA6Ly9hcGkudHJhdmVscGF5b3V0cy5jb20vZGF0YS9haXJwb3J0cy5qc29uJwogICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZVRleHQpIHsKICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBudWxsOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1BhcnNlIGVycm9yIScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FJUlBPUlRTX1BBUlNFX0VSUk9SJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmVzcG9uc2UpKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1Jlc3BvbnNlIGlzIG5vdCBhcnJheSEnLCByZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCdBSVJQT1JUU19CQURfUkVTUE9OU0UnKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVzcG9uc2UuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmNvZGUgJiYgaXRlbS5jaXR5X2NvZGU7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNiKG51bGwsIHJlc3BvbnNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgbG9hZEFpcnBvcnRzOiBmdW5jdGlvbihjYikgewogICAgICAgICAgICBpZiAobWFpbi5jYWNoZS5haXJwb3J0TWFwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucmVxdWVzdEFpcnBvcnRzKGZ1bmN0aW9uKGVyciwgYWlycG9ydExpc3QpIHsKICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBhaXJwb3J0TWFwID0gbWFpbi5jYWNoZS5haXJwb3J0TWFwID0ge307CiAgICAgICAgICAgICAgYWlycG9ydExpc3QuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICBhaXJwb3J0TWFwW2l0ZW0uY29kZV0gPSBpdGVtOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgcmVxdWVzdENpdGllczogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgdGJyLmdldERhdGEoewogICAgICAgICAgICAgIHVybDogJ2h0dHA6Ly9hcGkudHJhdmVscGF5b3V0cy5jb20vZGF0YS9jaXRpZXMuanNvbicKICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2VUZXh0KSB7CiAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbnVsbDsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgdGJyLmVycm9yKCdQYXJzZSBlcnJvciEnLCByZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCdDSVRJRVNfUEFSU0VfRVJST1InKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShyZXNwb25zZSkpIHsKICAgICAgICAgICAgICAgIHRici5lcnJvcignUmVzcG9uc2UgaXMgbm90IGFycmF5IScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0NJVElFU19CQURfUkVTUE9OU0UnKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVzcG9uc2UuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmNvZGUgJiYgaXRlbS5uYW1lOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYihudWxsLCByZXNwb25zZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHJlcXVlc3RQcmljZXM6IGZ1bmN0aW9uKHBhZ2VJbmZvLCBvcmlnQ2IpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgdmFyIHRyYWNrRXJyb3IgPSBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgIHZhciBpbmRleCA9IG1haW4uZXJyb3JNYXBbZXZlbnRdOwogICAgICAgICAgICAgIGlmIChpbmRleCkgewogICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gW2luZGV4LCBwYWdlSW5mby5vcmlnaW4sIHBhZ2VJbmZvLmRlc3RpbmF0aW9uLCBwYWdlSW5mby5wcmljZSwgcGFnZUluZm8uY3VycmVuY3ksIHBhZ2VJbmZvLmRhdGVTdGFydCwgcGFnZUluZm8uZGF0ZUVuZCB8fCAnJ10uam9pbignOycpOwogICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0RXJyb3InLAogICAgICAgICAgICAgICAgICBlYTogdGJyLmhvc3RuYW1lLAogICAgICAgICAgICAgICAgICBlbDogbGFiZWwsCiAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBjYlRyeUNhbCA9IGZ1bmN0aW9uKGVyciwgZGF0YSkgewogICAgICAgICAgICAgIGlmICghZXJyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ0NiKGVyciwgZGF0YSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdHJhY2tFcnJvcihlcnIpOwogICAgICAgICAgICAgIH0sIDApOwoKICAgICAgICAgICAgICBpZiAocGFnZUluZm8uZGF0ZUVuZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlcXVlc3RDYWxQcmljZXMocGFnZUluZm8sIG9yaWdDYik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucmVxdWVzdE1vbnRoUHJpY2VzKHBhZ2VJbmZvLCBmdW5jdGlvbihlcnIsIGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmICghZXJyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnQ2IoZXJyLCBkYXRhKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpcy5yZXF1ZXN0Q2FsUHJpY2VzKHBhZ2VJbmZvLCBvcmlnQ2IpOwoKICAgICAgICAgICAgICAgIHRyYWNrRXJyb3IoZXJyKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBjYlRyeVNreXNjYW5uZXIgPSBmdW5jdGlvbihlcnIsIGRhdGEpIHsKICAgICAgICAgICAgICBpZiAoIWVycikgewogICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdDYihlcnIsIGRhdGEpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRyYWNrRXJyb3IoZXJyKTsKICAgICAgICAgICAgICB9LCAwKTsKCiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlcXVlc3RTa3lzY2FubmVyUHJpY2UocGFnZUluZm8sIGNiVHJ5Q2FsKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmICghcGFnZUluZm8uZGF0ZUVuZCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yZXF1ZXN0UHJpY2VzMyhwYWdlSW5mbywgY2JUcnlTa3lzY2FubmVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlcXVlc3RQcmljZXMxKHBhZ2VJbmZvLCBjYlRyeVNreXNjYW5uZXIpOwogICAgICAgICAgfSwKICAgICAgICAgIHJlcXVlc3RNb250aFByaWNlczogZnVuY3Rpb24ocGFnZUluZm8sIGNiKSB7CiAgICAgICAgICAgIG1haW4uY3VycmVuY3kuc2V0U3VwcG9ydGVkQ2N5KCdSVUInKTsKCiAgICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICAgIG9yaWdpbl9pYXRhOiBwYWdlSW5mby5vcmlnaW4sCiAgICAgICAgICAgICAgZGVzdGluYXRpb25faWF0YTogcGFnZUluZm8uZGVzdGluYXRpb24sCiAgICAgICAgICAgICAgZGlyZWN0X2RhdGU6IHBhZ2VJbmZvLmRhdGVTdGFydCwKICAgICAgICAgICAgICBhZmZpbGlhdGU6IHRydWUsCiAgICAgICAgICAgICAgYWR1bHRzOiAxCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0YnIuZ2V0RGF0YSh7CiAgICAgICAgICAgICAgdXJsOiAnaHR0cDovL21pbi1wcmljZXMtZ28uYXZpYXNhbGVzLnJ1L21vbnRoX21pbmltYWxfcHJpY2UuanNvbj8nICsgbW9ub1V0aWxzLnBhcmFtKGRhdGEpCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgIHZhciBkYXRhID0gbnVsbDsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1BhcnNlIGVycm9yIScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FWSUFfUjRfUEFSU0VfRVJST1InKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgICAgICAgdGJyLmVycm9yKCdSZXNwb25zZSBpcyBlbXB0eSEnLCByZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCdBVklBX1I0X0VNUFRZX1JFU1BPTlNFJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIWRhdGEuZGlyZWN0ICYmICFkYXRhLm5vdF9kaXJlY3QpIHsKICAgICAgICAgICAgICAgIHRici5lcnJvcignRWVtcHR5IGRhdGEhJywgZGF0YSk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FWSUFfUjRfRU1QVFlfREFUQScpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZGF0YS5kaXJlY3QgfHwgZGF0YS5ub3RfZGlyZWN0OwogICAgICAgICAgICAgIGlmIChkYXRhLmRpcmVjdCAmJiBkYXRhLm5vdF9kaXJlY3QgJiYgZGF0YS5kaXJlY3QgPiBkYXRhLm5vdF9kaXJlY3QpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gZGF0YS5ub3RfZGlyZWN0OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgIG9yaWdpbjogcGFnZUluZm8ub3JpZ2luLAogICAgICAgICAgICAgICAgZGVzdGluYXRpb246IHBhZ2VJbmZvLmRlc3RpbmF0aW9uLAogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgZGVwYXJ0X2RhdGU6IHBhZ2VJbmZvLmRhdGVTdGFydCwKICAgICAgICAgICAgICAgIHJldHVybl9kYXRlOiBwYWdlSW5mby5kYXRlRW5kLAogICAgICAgICAgICAgICAgbW9udGhQcmljZTogdHJ1ZQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgIGRhdGE6IFtkYXRhXQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIHJldHVybiBjYihudWxsLCByZXNwb25zZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHJlcXVlc3RDYWxQcmljZXM6IGZ1bmN0aW9uKHBhZ2VJbmZvLCBjYikgewogICAgICAgICAgICBtYWluLmN1cnJlbmN5LnNldFN1cHBvcnRlZENjeSgnUlVCJyk7CgogICAgICAgICAgICB2YXIgcmVxdWVzdERhdGEgPSB7CiAgICAgICAgICAgICAgb3JpZ2luOiBwYWdlSW5mby5vcmlnaW4sCiAgICAgICAgICAgICAgZGVzdGluYXRpb246IHBhZ2VJbmZvLmRlc3RpbmF0aW9uLAogICAgICAgICAgICAgIGRlcGFydF9kYXRlOiBwYWdlSW5mby5kYXRlU3RhcnQsCiAgICAgICAgICAgICAgb25lX3dheTogIXBhZ2VJbmZvLmRhdGVFbmQKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBnZXRFbmREYXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9IChuZXcgRGF0ZShwYWdlSW5mby5kYXRlU3RhcnQpKS5nZXRUaW1lKCk7CgogICAgICAgICAgICAgIHZhciBlbmREYXRlID0gc3RhcnRUaW1lICsgMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwOwoKICAgICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoZW5kRGF0ZSk7CiAgICAgICAgICAgICAgdmFyIHllYXIgPSBub3cuZ2V0VVRDRnVsbFllYXIoKTsKICAgICAgICAgICAgICB2YXIgbW9udGggPSBub3cuZ2V0VVRDTW9udGgoKSArIDE7CiAgICAgICAgICAgICAgaWYgKG1vbnRoIDwgMTApIHsKICAgICAgICAgICAgICAgIG1vbnRoID0gJzAnICsgbW9udGg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBkYXRlID0gbm93LmdldFVUQ0RhdGUoKTsKICAgICAgICAgICAgICBpZiAoZGF0ZSA8IDEwKSB7CiAgICAgICAgICAgICAgICBkYXRlID0gJzAnICsgZGF0ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBbeWVhciwgbW9udGgsIGRhdGVdLmpvaW4oJy0nKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBnZXRNb250aFByaWNlID0gZnVuY3Rpb24ocHJpY2VMaXN0LCBjYikgewogICAgICAgICAgICAgIHZhciBzdGFydERhdGUgPSBwYWdlSW5mby5kYXRlU3RhcnQ7CiAgICAgICAgICAgICAgdmFyIGVuZERhdGUgPSBnZXRFbmREYXRlKCk7CgogICAgICAgICAgICAgIHByaWNlTGlzdCA9IHByaWNlTGlzdC5maWx0ZXIoZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgICAgaWYgKCFpdGVtLnZhbHVlIHx8ICFpdGVtLmRlcGFydF9kYXRlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocGFnZUluZm8uZGF0ZUVuZCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5kZXBhcnRfZGF0ZSA+PSBzdGFydERhdGUgJiYgaXRlbS5yZXR1cm5fZGF0ZSA8IGVuZERhdGU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5kZXBhcnRfZGF0ZSA+PSBzdGFydERhdGUgJiYgaXRlbS5kZXBhcnRfZGF0ZSA8IGVuZERhdGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChwcmljZUxpc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ0NhbCBtb250aCBwcmljZSBpcyBub3QgZm91bmQhJyk7CiAgICAgICAgICAgICAgICBjYignQVZJQV9DQUxfTU9OVEhfUFJJQ0VfRU1QVFknKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IE1hdGgucm91bmQocHJpY2VMaXN0LnJlZHVjZShmdW5jdGlvbihwcmV2aW91c1ZhbHVlLCBpdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJldmlvdXNWYWx1ZSArIGl0ZW0udmFsdWU7CiAgICAgICAgICAgICAgfSwgMCkgLyBwcmljZUxpc3QubGVuZ3RoKTsKCiAgICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICAgIG9yaWdpbjogcGFnZUluZm8ub3JpZ2luLAogICAgICAgICAgICAgICAgZGVzdGluYXRpb246IHBhZ2VJbmZvLmRlc3RpbmF0aW9uLAogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgZGVwYXJ0X2RhdGU6IHBhZ2VJbmZvLmRhdGVTdGFydCwKICAgICAgICAgICAgICAgIG1vbnRoUHJpY2U6IHRydWUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAocGFnZUluZm8uZGF0ZUVuZCkgewogICAgICAgICAgICAgICAgb2JqLnJldHVybl9kYXRlID0gcGFnZUluZm8uZGF0ZUVuZDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBjYihudWxsLCB7CiAgICAgICAgICAgICAgICBkYXRhOiBbb2JqXQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIGdldFByaWNlcyA9IGZ1bmN0aW9uKHByaWNlTGlzdCwgY2IpIHsKICAgICAgICAgICAgICBwcmljZUxpc3QgPSBwcmljZUxpc3QuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmICghaXRlbS52YWx1ZSB8fCAhaXRlbS5kZXBhcnRfZGF0ZSB8fCAhaXRlbS5vcmlnaW4gfHwgIWl0ZW0uZGVzdGluYXRpb24pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChwYWdlSW5mby5kYXRlRW5kKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmRlcGFydF9kYXRlID09PSBwYWdlSW5mby5kYXRlU3RhcnQgJiYgaXRlbS5yZXR1cm5fZGF0ZSA9PT0gcGFnZUluZm8uZGF0ZUVuZDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmRlcGFydF9kYXRlID09PSBwYWdlSW5mby5kYXRlU3RhcnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChwcmljZUxpc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ0NhbCBkYXRlIHByaWNlIGlzIG5vdCBmb3VuZCEnKTsKICAgICAgICAgICAgICAgIGNiKCdBVklBX0NBTF9EQVRFX1BSSUNFX0VNUFRZJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgbGlzdCA9IHByaWNlTGlzdC5tYXAoZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb246IGl0ZW0uZGVzdGluYXRpb24sCiAgICAgICAgICAgICAgICAgIG9yaWdpbjogaXRlbS5vcmlnaW4sCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLAogICAgICAgICAgICAgICAgICBkZXBhcnRfZGF0ZTogaXRlbS5kZXBhcnRfZGF0ZQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAocGFnZUluZm8uZGF0ZUVuZCkgewogICAgICAgICAgICAgICAgICBvYmoucmV0dXJuX2RhdGUgPSBpdGVtLnJldHVybl9kYXRlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgcmV0dXJuIGNiKG51bGwsIHsKICAgICAgICAgICAgICAgIGRhdGE6IGxpc3QKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHRici5nZXREYXRhKHsKICAgICAgICAgICAgICB1cmw6ICdodHRwOi8vbWluLXByaWNlcy5hdmlhc2FsZXMucnUvY2FsZW5kYXJfcHJlbG9hZD8nICsgbW9ub1V0aWxzLnBhcmFtKHJlcXVlc3REYXRhKQogICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZVRleHQpIHsKICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBudWxsOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1BhcnNlIGVycm9yIScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FWSUFfQ0FMX1BBUlNFX0VSUk9SJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1Jlc3BvbnNlIGlzIGVtcHR5IScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FWSUFfQ0FMX0VNUFRZX1JFU1BPTlNFJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgY3VycmVudERlcGFydERhdGVQcmljZXMgPSByZXNwb25zZS5jdXJyZW50X2RlcGFydF9kYXRlX3ByaWNlcyB8fCBbXTsKICAgICAgICAgICAgICBpZiAoY3VycmVudERlcGFydERhdGVQcmljZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50RGVwYXJ0RGF0ZVByaWNlcyA9IG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcHJpY2VMaXN0ID0gY3VycmVudERlcGFydERhdGVQcmljZXMgfHwgcmVzcG9uc2UuYmVzdF9wcmljZXMgfHwgW107CiAgICAgICAgICAgICAgaWYgKHByaWNlTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRici5lcnJvcignQ2FsIGRhdGEgaXMgZW1wdHkhJywgcmVzcG9uc2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCdBVklBX0NBTF9FTVBUWV9EQVRBJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gZ2V0UHJpY2VzKGN1cnJlbnREZXBhcnREYXRlUHJpY2VzIHx8IFtdLCBmdW5jdGlvbihlcnIsIGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmICghZXJyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIsIGRhdGEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBnZXRNb250aFByaWNlKHByaWNlTGlzdCwgZnVuY3Rpb24oZXJyLCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIsIGRhdGEpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHJlcXVlc3RQcmljZXMxOiBmdW5jdGlvbihwYWdlSW5mbywgY2IpIHsKICAgICAgICAgICAgbWFpbi5jdXJyZW5jeS5zZXRTdXBwb3J0ZWRDY3koWydVU0QnLCAnRVVSJywgJ1JVQiddKTsKCiAgICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICAgIG9yaWdpbjogcGFnZUluZm8ub3JpZ2luLAogICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBwYWdlSW5mby5kZXN0aW5hdGlvbiwKICAgICAgICAgICAgICBjdXJyZW5jeTogcGFnZUluZm8uY3VycmVuY3ksCiAgICAgICAgICAgICAgZGVwYXJ0X2RhdGU6IHBhZ2VJbmZvLmRhdGVTdGFydAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKHBhZ2VJbmZvLmRhdGVFbmQpIHsKICAgICAgICAgICAgICBkYXRhLnJldHVybl9kYXRlID0gcGFnZUluZm8uZGF0ZUVuZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFtYWluLmN1cnJlbmN5LmlzU3VwcG9ydGVkQ2N5KHBhZ2VJbmZvLmN1cnJlbmN5KSkgewogICAgICAgICAgICAgIGRhdGEuY3VycmVuY3kgPSBtYWluLmN1cnJlbmN5LmRlZmF1bHRDY3k7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRhdGEudG9rZW4gPSAnZDkzNmI0Zjg5OWQyZTI2OTY5MjY5ZGQ1ODdmOTBhNjcnOwoKICAgICAgICAgICAgdGJyLmdldERhdGEoewogICAgICAgICAgICAgIHVybDogJ2h0dHA6Ly9hcGkudHJhdmVscGF5b3V0cy5jb20vdjEvcHJpY2VzL2NoZWFwPycgKyBtb25vVXRpbHMucGFyYW0oZGF0YSkKICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2VUZXh0KSB7CiAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbnVsbDsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgdGJyLmVycm9yKCdQYXJzZSBlcnJvciEnLCByZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCdBVklBX1IxX1BBUlNFX0VSUk9SJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1Jlc3BvbnNlIGlzIGVtcHR5IScsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIGNiKCdBVklBX1IxX0VNUFRZX1JFU1BPTlNFJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MgfHwgIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgIHRici5lcnJvcignQVBJIGlzIG5vdCBzdWNjZXNzIScsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIGNiKCdBVklBX1IxX0ZBSUwnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBfbGlzdCA9IFtdOwogICAgICAgICAgICAgIGZvciAodmFyIGNpdHlDb2RlIGluIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gcmVzcG9uc2UuZGF0YVtjaXR5Q29kZV07CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBsaXN0KSB7CiAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbGlzdFtpbmRleF07CiAgICAgICAgICAgICAgICAgIGlmICghaXRlbS5wcmljZSB8fCAhaXRlbS5kZXBhcnR1cmVfYXQpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIF9pdGVtID0ge307CiAgICAgICAgICAgICAgICAgIF9pdGVtLmRlc3RpbmF0aW9uID0gY2l0eUNvZGU7CiAgICAgICAgICAgICAgICAgIF9pdGVtLm9yaWdpbiA9IHBhZ2VJbmZvLm9yaWdpbjsKICAgICAgICAgICAgICAgICAgX2l0ZW0udmFsdWUgPSBpdGVtLnByaWNlOwogICAgICAgICAgICAgICAgICBfaXRlbS5kZXBhcnRfZGF0ZSA9IGl0ZW0uZGVwYXJ0dXJlX2F0OwogICAgICAgICAgICAgICAgICBpZiAocGFnZUluZm8uZGF0ZUVuZCkgewogICAgICAgICAgICAgICAgICAgIF9pdGVtLnJldHVybl9kYXRlID0gaXRlbS5yZXR1cm5fYXQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgX2xpc3QucHVzaChfaXRlbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoX2xpc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ0FQSSBkYXRhIGlzIGVtcHR5IScsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIGNiKCdBVklBX1IxX0VNUFRZX0RBVEEnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPSBfbGlzdDsKCiAgICAgICAgICAgICAgY2IobnVsbCwgcmVzcG9uc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICByZXF1ZXN0UHJpY2VzMzogZnVuY3Rpb24ocGFnZUluZm8sIGNiKSB7CiAgICAgICAgICAgIG1haW4uY3VycmVuY3kuc2V0U3VwcG9ydGVkQ2N5KCdSVUInKTsKCiAgICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICAgIG9yaWdpbjogcGFnZUluZm8ub3JpZ2luLAogICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBwYWdlSW5mby5kZXN0aW5hdGlvbiwKICAgICAgICAgICAgICBkZXBhcnRfZGF0ZTogcGFnZUluZm8uZGF0ZVN0YXJ0CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAocGFnZUluZm8uZGF0ZUVuZCkgewogICAgICAgICAgICAgIGRhdGEucmV0dXJuX2RhdGUgPSBwYWdlSW5mby5kYXRlRW5kOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0YnIuZ2V0RGF0YSh7CiAgICAgICAgICAgICAgdXJsOiAnaHR0cDovL21pbi1wcmljZXMuYXZpYXNhbGVzLnJ1L2RheV9wcmljZT8nICsgbW9ub1V0aWxzLnBhcmFtKGRhdGEpCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgIHZhciBkYXRhID0gbnVsbDsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1BhcnNlIGVycm9yIScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FWSUFfUjNfUEFSU0VfRVJST1InKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghZGF0YSB8fCAhZGF0YS5kZXN0aW5hdGlvbiB8fCAhZGF0YS5vcmlnaW4gfHwgIWRhdGEudmFsdWUgfHwgIWRhdGEuZGVwYXJ0X2RhdGUpIHsKICAgICAgICAgICAgICAgIHRici5lcnJvcignUmVzcG9uc2UgaXMgZW1wdHkhJywgcmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgIHJldHVybiBjYignQVZJQV9SM19FTVBUWV9SRVNQT05TRScpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gewogICAgICAgICAgICAgICAgZGF0YTogW2RhdGFdCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgY2IobnVsbCwgcmVzcG9uc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBza3lzY2FubmVyTWFya2V0czogewogICAgICAgICAgICBydTogJ3J1JywKICAgICAgICAgICAgZW46ICd1cycKICAgICAgICAgIH0sCiAgICAgICAgICByZXF1ZXN0U2t5c2Nhbm5lclByaWNlOiBmdW5jdGlvbihwYWdlSW5mbywgY2IpIHsKICAgICAgICAgICAgaWYgKCFhcHBJbmZvLnNreVNjYW5uZXJLZXkpIHsKICAgICAgICAgICAgICByZXR1cm4gY2IoJ1NDX0tFWV9FTVBUWScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtYWluLmN1cnJlbmN5LnNldFN1cHBvcnRlZENjeShbJ1VTRCcsICdFVVInLCAnUlVCJywgJ1VBSCcsICdCWVInLCAnS1pUJ10pOwoKICAgICAgICAgICAgdmFyIGNjeSA9IHBhZ2VJbmZvLmN1cnJlbmN5OwogICAgICAgICAgICBpZiAoIW1haW4uY3VycmVuY3kuaXNTdXBwb3J0ZWRDY3kocGFnZUluZm8uY3VycmVuY3kpKSB7CiAgICAgICAgICAgICAgY2N5ID0gbWFpbi5jdXJyZW5jeS5kZWZhdWx0Q2N5OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYXBpS2V5ID0gYXBwSW5mby5za3lTY2FubmVyS2V5OwoKICAgICAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgICAgYXBpS2V5OiBhcGlLZXkKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciB1cmwgPSAnaHR0cDovL3BhcnRuZXJzLmFwaS5za3lzY2FubmVyLm5ldC9hcGlzZXJ2aWNlcy9icm93c2VxdW90ZXMvdjEuMC97bWFya2V0fS97Y3VycmVuY3l9L3tsb2NhbGV9L3tvcmlnaW5QbGFjZX0ve2Rlc3RpbmF0aW9uUGxhY2V9L3tvdXRib3VuZFBhcnRpYWxEYXRlfS97aW5ib3VuZFBhcnRpYWxEYXRlfT8nOwogICAgICAgICAgICB2YXIgbWFya2V0ID0gJ3VzJzsKICAgICAgICAgICAgdmFyIG1hcmtldHMgPSB0aGlzLnNreXNjYW5uZXJNYXJrZXRzOwogICAgICAgICAgICBpZiAobWFya2V0c1t0YnIubGFuZ3VhZ2UubGFuZ10pIHsKICAgICAgICAgICAgICBtYXJrZXQgPSBtYXJrZXRzW3Rici5sYW5ndWFnZS5sYW5nXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3ttYXJrZXR9JywgbWFya2V0KTsKICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3tjdXJyZW5jeX0nLCBjY3kpOwogICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgne2xvY2FsZX0nLCB0YnIubGFuZ3VhZ2UubGFuZyk7CiAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCd7b3JpZ2luUGxhY2V9JywgcGFnZUluZm8ub3JpZ2luKTsKICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3tkZXN0aW5hdGlvblBsYWNlfScsIHBhZ2VJbmZvLmRlc3RpbmF0aW9uKTsKICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3tvdXRib3VuZFBhcnRpYWxEYXRlfScsIHBhZ2VJbmZvLmRhdGVTdGFydCk7CiAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCd7aW5ib3VuZFBhcnRpYWxEYXRlfScsIHBhZ2VJbmZvLmRhdGVFbmQgfHwgJycpOwoKICAgICAgICAgICAgdmFyIGdldFJlZmVycmFsVXJsID0gZnVuY3Rpb24ob3JpZ2luUGxhY2UsIGRlc3RpbmF0aW9uUGxhY2UpIHsKICAgICAgICAgICAgICB2YXIgb3JpZ2luUGxhY2VJZCA9IG9yaWdpblBsYWNlLkNpdHlJZCB8fCBvcmlnaW5QbGFjZS5JYXRhQ29kZTsKICAgICAgICAgICAgICB2YXIgZGVzdGluYXRpb25QbGFjZUlkID0gZGVzdGluYXRpb25QbGFjZS5DaXR5SWQgfHwgZGVzdGluYXRpb25QbGFjZS5JYXRhQ29kZTsKICAgICAgICAgICAgICB2YXIgdXJsID0gJ2h0dHA6Ly9wYXJ0bmVycy5hcGkuc2t5c2Nhbm5lci5uZXQvYXBpc2VydmljZXMvcmVmZXJyYWwvdjEuMC97bWFya2V0fS97Y3VycmVuY3l9L3tsb2NhbGV9L3tvcmlnaW5QbGFjZX0ve2Rlc3RpbmF0aW9uUGxhY2V9L3tvdXRib3VuZFBhcnRpYWxEYXRlfS97aW5ib3VuZFBhcnRpYWxEYXRlfSc7CiAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3ttYXJrZXR9JywgbWFya2V0KTsKICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgne2N1cnJlbmN5fScsIGNjeSk7CiAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3tsb2NhbGV9JywgdGJyLmxhbmd1YWdlLmxhbmcpOwogICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCd7b3JpZ2luUGxhY2V9Jywgb3JpZ2luUGxhY2VJZCk7CiAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3tkZXN0aW5hdGlvblBsYWNlfScsIGRlc3RpbmF0aW9uUGxhY2VJZCk7CiAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3tvdXRib3VuZFBhcnRpYWxEYXRlfScsIHBhZ2VJbmZvLmRhdGVTdGFydCk7CiAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ3tpbmJvdW5kUGFydGlhbERhdGV9JywgcGFnZUluZm8uZGF0ZUVuZCB8fCAnJyk7CiAgICAgICAgICAgICAgdXJsICs9ICc/JyArIG1vbm9VdGlscy5wYXJhbSh7CiAgICAgICAgICAgICAgICBhcGlLZXk6IGFwaUtleQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiB1cmw7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHR5cGVkZWYge09iamVjdH0gU2t5c2Nhbm5lclBsYWNlQXBpCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBDaXR5SWQKICAgICAgICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IENpdHlOYW1lCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBDb3VudHJ5TmFtZQogICAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gSWF0YUNvZGUKICAgICAgICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IE5hbWUKICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFBsYWNlSWQKICAgICAgICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFNreXNjYW5uZXJDb2RlCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBUeXBlCiAgICAgICAgICAgICAqLwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHR5cGVkZWYge09iamVjdH0gU2t5c2Nhbm5lclF1b3Rlc0JvdW5kTGVnQXBpCiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7W251bWJlcl19IENhcnJpZXJJZHMKICAgICAgICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IERlcGFydHVyZURhdGUKICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IERlc3RpbmF0aW9uSWQKICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IE9yaWdpbklkCiAgICAgICAgICAgICAqLwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQHR5cGVkZWYge09iamVjdH0gU2t5c2Nhbm5lclF1b3Rlc0FwaQogICAgICAgICAgICAgKiBAcHJvcGVydHkge1NreXNjYW5uZXJRdW90ZXNCb3VuZExlZ0FwaX0gT3V0Ym91bmRMZWcKICAgICAgICAgICAgICogQHByb3BlcnR5IHtTa3lzY2FubmVyUXVvdGVzQm91bmRMZWdBcGl9IFtJbmJvdW5kTGVnXQogICAgICAgICAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IERpcmVjdAogICAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gUXVvdGVEYXRlVGltZQogICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gUXVvdGVJZAogICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gTWluUHJpY2UKICAgICAgICAgICAgICovCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2UKICAgICAgICAgICAgICogQHBhcmFtIHtbU2t5c2Nhbm5lclBsYWNlQXBpXX0gcmVzcG9uc2UuUGxhY2VzCiAgICAgICAgICAgICAqIEBwYXJhbSB7W1NreXNjYW5uZXJRdW90ZXNBcGldfSByZXNwb25zZS5RdW90ZXMKICAgICAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2IKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHZhciBub3JtYWxpemF0aW9uID0gZnVuY3Rpb24ocmVzcG9uc2UsIGNiKSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSBbXTsKCiAgICAgICAgICAgICAgdmFyIGdldFBsYWNlQ29kZSA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgICAgICAgICB2YXIgcGxhY2UgPSBudWxsOwogICAgICAgICAgICAgICAgcmVzcG9uc2UuUGxhY2VzLnNvbWUoZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgICAgICBpZiAoaXRlbS5QbGFjZUlkID09PSBpZCkgewogICAgICAgICAgICAgICAgICAgIHBsYWNlID0gaXRlbTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcGxhY2U7CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgcmVzcG9uc2UuUXVvdGVzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgICAgaWYgKCFpdGVtLk91dGJvdW5kTGVnKSB7CiAgICAgICAgICAgICAgICAgIHRici5lcnJvcignT3V0Ym91bmRMZWcgaXMgbm90IGZvdW5kIScpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHBhZ2VJbmZvLmRhdGVFbmQgJiYgIWl0ZW0uSW5ib3VuZExlZykgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGRlc3RpbmF0aW9uUGxhY2UgPSBnZXRQbGFjZUNvZGUoaXRlbS5PdXRib3VuZExlZy5EZXN0aW5hdGlvbklkKTsKICAgICAgICAgICAgICAgIHZhciBvcmlnaW5QbGFjZSA9IGdldFBsYWNlQ29kZShpdGVtLk91dGJvdW5kTGVnLk9yaWdpbklkKTsKCiAgICAgICAgICAgICAgICB2YXIgb2JqID0gewogICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb25QbGFjZS5JYXRhQ29kZSwKICAgICAgICAgICAgICAgICAgb3JpZ2luOiBvcmlnaW5QbGFjZS5JYXRhQ29kZSwKICAgICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0uTWluUHJpY2UsCiAgICAgICAgICAgICAgICAgIGRlcGFydF9kYXRlOiBpdGVtLk91dGJvdW5kTGVnLkRlcGFydHVyZURhdGUsCiAgICAgICAgICAgICAgICAgIHZlbmRvcjogJ3NreXNjYW5uZXInLAogICAgICAgICAgICAgICAgICB1cmw6IGdldFJlZmVycmFsVXJsKG9yaWdpblBsYWNlLCBkZXN0aW5hdGlvblBsYWNlKQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAoaXRlbS5JbmJvdW5kTGVnKSB7CiAgICAgICAgICAgICAgICAgIG9iai5yZXR1cm5fZGF0ZSA9IGl0ZW0uSW5ib3VuZExlZy5EZXBhcnR1cmVEYXRlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghb2JqLmRlc3RpbmF0aW9uIHx8ICFvYmoub3JpZ2luKSB7CiAgICAgICAgICAgICAgICAgIHRici5lcnJvcignUGxhY2UgY29kZSBlcnJvciEnLCBvYmosIGl0ZW0pOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGF0YS5wdXNoKG9iaik7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGJyLmVycm9yKCdBUEkgZGF0YSBpcyBlbXB0eSEnLCByZXNwb25zZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FWSUFfUjVfRU1QVFlfREFUQScpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IobnVsbCwgewogICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gdGJyLmdldERhdGEoewogICAgICAgICAgICAgIHVybDogdXJsICsgbW9ub1V0aWxzLnBhcmFtKGRhdGEpLAogICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICdYLUZvcndhcmRlZC1Gb3InOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgIGlmICgvPFF1b3Rlc1xzK1wvPi8udGVzdChyZXNwb25zZVRleHQpKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1Jlc3BvbnNlIGlzIGVtcHR5IFhNTCEnLCByZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCdBVklBX1I1X0VNUFRZX0RBVEEnKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBkYXRhID0gbnVsbDsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1BhcnNlIGVycm9yIScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FWSUFfUjVfUEFSU0VfRVJST1InKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghZGF0YSB8fCAhQXJyYXkuaXNBcnJheShkYXRhLlF1b3RlcykgfHwgIUFycmF5LmlzQXJyYXkoZGF0YS5QbGFjZXMpKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1Jlc3BvbnNlIGlzIGVtcHR5IScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0FWSUFfUjVfRU1QVFlfUkVTUE9OU0UnKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBub3JtYWxpemF0aW9uKGRhdGEsIGNiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBBdmlhQXBpUHJpY2UKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBvcmlnaW4KICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBkZXN0aW5hdGlvbgogICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHZhbHVlCiAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gZGVwYXJ0X2RhdGUKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbcmV0dXJuX2RhdGVdCiAgICAgICAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFttb250aFByaWNlXQogICAgICAgICAgICovCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEB0eXBlZGVmIHtPYmplY3R9IEF2aWFBcGkKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBwcmljZXMKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7QXZpYUFwaVByaWNlW119IHByaWNlcy5kYXRhCiAgICAgICAgICAgKi8KICAgICAgICAgIC8qKgogICAgICAgICAgICogQGNhbGxiYWNrIEF2aWFSZXF1ZXN0Q2FsbGJhY2sKICAgICAgICAgICAqIEBwYXJhbSB7RXJyb3J9IGVycgogICAgICAgICAgICogQHBhcmFtIHtBdmlhQXBpfSBbZGF0YV0KICAgICAgICAgICAqLwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcGFyYW0ge0F2aWFJbmZvfSBwYWdlSW5mbwogICAgICAgICAgICogQHBhcmFtIHtBdmlhUmVxdWVzdENhbGxiYWNrfSBjYgogICAgICAgICAgICovCiAgICAgICAgICByZXF1ZXN0RGF0YTogZnVuY3Rpb24ocGFnZUluZm8sIGNiKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHZhciBkYXRhID0ge307CgogICAgICAgICAgICB2YXIgYXN5bmMgPSBuZXcgbW9ub1V0aWxzLkFzeW5jTGlzdChmdW5jdGlvbihlcnIpIHsKICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBjYihudWxsLCBkYXRhKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBhc3luYy53YWl0KCk7CgogICAgICAgICAgICB0aGlzLnJlcXVlc3RQcmljZXMocGFnZUluZm8sIGZ1bmN0aW9uKGVyciwgcHJpY2VzKSB7CiAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jLnJlYWR5KGVycik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBkYXRhLnByaWNlcyA9IHByaWNlczsKCiAgICAgICAgICAgICAgaWYgKCFtYWluLmNhY2hlLmNpdHlNYXApIHsKICAgICAgICAgICAgICAgIGFzeW5jLndhaXQoKTsKICAgICAgICAgICAgICAgIF90aGlzLnJlcXVlc3RDaXRpZXMoZnVuY3Rpb24oZXJyLCBjaXR5TGlzdCkgewogICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jLnJlYWR5KGVycik7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHZhciBjaXR5TWFwID0gbWFpbi5jYWNoZS5jaXR5TWFwID0ge307CiAgICAgICAgICAgICAgICAgIGNpdHlMaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGNpdHlNYXBbaXRlbS5jb2RlXSA9IGl0ZW07CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBhc3luYy5yZWFkeSgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIW1haW4uY3VycmVuY3kuaXNTdXBwb3J0ZWRDY3kocGFnZUluZm8uY3VycmVuY3kpKSB7CiAgICAgICAgICAgICAgICBhc3luYy53YWl0KCk7CgogICAgICAgICAgICAgICAgdmFyIGNjeVN1cHBvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgdmFyIGNjeUxpc3QgPSBtYWluLmNhY2hlLmNjeUxpc3Q7CiAgICAgICAgICAgICAgICAgIGlmIChjY3lMaXN0W3BhZ2VJbmZvLmN1cnJlbmN5LnRvTG93ZXJDYXNlKCldID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ0N1cnJlbmN5IGlzIG5vdCBzdXBwb3J0IScsIHBhZ2VJbmZvLmN1cnJlbmN5KTsKICAgICAgICAgICAgICAgICAgICBhc3luYy5yZWFkeSgnQ0NZX05PVF9TVVBQT1JUJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBhc3luYy5yZWFkeSgpOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAobWFpbi5jYWNoZS5jY3lMaXN0KSB7CiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNjeVN1cHBvcnQoKTsKICAgICAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhc3luYy53YWl0KCk7CgogICAgICAgICAgICAgICAgICBtYWluLmN1cnJlbmN5LnJlcXVlc3RDY3koZnVuY3Rpb24oZXJyLCBjY3lMaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICAgICAgYXN5bmMucmVhZHkoZXJyKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG1haW4uY2FjaGUuY2N5TGlzdCA9IGNjeUxpc3Q7CiAgICAgICAgICAgICAgICAgICAgYXN5bmMucmVhZHkoKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNjeVN1cHBvcnQoKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBhc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgX3RoaXMubG9hZEFpcnBvcnRzKGZ1bmN0aW9uKGVycikgewogICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICByZXR1cm4gYXN5bmMucmVhZHkoZXJyKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhc3luYy5yZWFkeSgpOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBhc3luYy5yZWFkeSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBwYWdlOiB7CiAgICAgICAgICAgIGdldFByaWNlOiBmdW5jdGlvbihwYXJhbXMsIHByaWNlUGFyYW1zKSB7CiAgICAgICAgICAgICAgdmFyIHByaWNlID0gbnVsbDsKICAgICAgICAgICAgICBpZiAocHJpY2VQYXJhbXMucHJpY2UpIHsKICAgICAgICAgICAgICAgIHByaWNlID0gcHJpY2VQYXJhbXMucHJpY2U7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcmljZVBhcmFtcy5taW5QcmljZU91dCAmJiBwcmljZVBhcmFtcy5taW5QcmljZUluKSB7CiAgICAgICAgICAgICAgICBwcmljZSA9IHByaWNlUGFyYW1zLm1pblByaWNlT3V0ICsgcHJpY2VQYXJhbXMubWluUHJpY2VJbjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByaWNlUGFyYW1zLm1pblByaWNlT3V0KSB7CiAgICAgICAgICAgICAgICBwcmljZSA9IHByaWNlUGFyYW1zLm1pblByaWNlT3V0OwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJpY2VQYXJhbXMubWluUHJpY2VJbikgewogICAgICAgICAgICAgICAgcHJpY2UgPSBwcmljZVBhcmFtcy5taW5QcmljZUluOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHByaWNlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXREYXRhOiBmdW5jdGlvbihwYXJhbXMsIHByaWNlUGFyYW1zKSB7CiAgICAgICAgICAgICAgdmFyIGNoZWNrS2V5cyA9IFsnb3JpZ2luJywgJ2Rlc3RpbmF0aW9uJywgJ2RhdGVTdGFydCcsICdjdXJyZW5jeScsICdwcmljZSddOwoKICAgICAgICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgICAgICAgIG9yaWdpbjogcGFyYW1zLm9yaWdpbiwKICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBwYXJhbXMuZGVzdGluYXRpb24sCiAgICAgICAgICAgICAgICBkYXRlU3RhcnQ6IHBhcmFtcy5kYXRlU3RhcnQsCiAgICAgICAgICAgICAgICBkYXRlRW5kOiBwYXJhbXMuZGF0ZUVuZCwKICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBwYXJhbXMuY3VycmVuY3ksCiAgICAgICAgICAgICAgICBwcmljZTogdGhpcy5nZXRQcmljZShwYXJhbXMsIHByaWNlUGFyYW1zKQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIHZhciByID0gY2hlY2tLZXlzLmV2ZXJ5KGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgcmV0dXJuICEhZGF0YVtrZXldOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoIXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFByaWNlSWQ6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgIHZhciBpZEtleXMgPSBbJ29yaWdpbicsICdkZXN0aW5hdGlvbicsICdkYXRlU3RhcnQnLCAnZGF0ZUVuZCcsICdjdXJyZW5jeSddOwogICAgICAgICAgICAgIHZhciBpZCA9IFtdOwoKICAgICAgICAgICAgICB2YXIgciA9IGlkS2V5cy5ldmVyeShmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICAgICAgaWQucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnZGF0ZUVuZCcpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gISF2YWx1ZTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKCFyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBpZC5qb2luKCc7Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9OwogICAgICBtYWluLmF2aWEgPSBnZXRBdmlhKHRicik7CiAgICAgIHZhciBnZXRIb3RlbCA9IGZ1bmN0aW9uKHRicikgewogICAgICAgIHZhciBtYWluID0gdGJyLm1haW47CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBjb252ZXJ0UHJpY2U6IGZ1bmN0aW9uKHByaWNlcywgY3VycmVuY3kpIHsKICAgICAgICAgICAgcHJpY2VzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgIGl0ZW0uY29udmVydGVkX3ZhbHVlID0gbWFpbi5jb252ZXJ0Q2N5KGl0ZW0udmFsdWUsIGN1cnJlbmN5KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0TG93UHJpY2U6IGZ1bmN0aW9uKHByaWNlcywgaXNTdWdnZXN0KSB7CiAgICAgICAgICAgIGlzU3VnZ2VzdCA9ICEhaXNTdWdnZXN0OwogICAgICAgICAgICB2YXIgdmFsdWUgPSBudWxsOwogICAgICAgICAgICBwcmljZXMuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXNTdWdnZXN0ID09PSAhIWl0ZW0uaXNTdWdnZXN0OwogICAgICAgICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICB2YXIgX3ZhbHVlID0gaXRlbS5jb252ZXJ0ZWRfdmFsdWUgfHwgaXRlbS52YWx1ZTsKICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgX3ZhbHVlIDwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gX3ZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0sCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEB0eXBlZGVmIHtPYmplY3R9IEhvdGVsSW5mbwogICAgICAgICAgICogQHByb3BlcnR5IHtzdHJpbmdbXX0gcXVlcnkKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBkYXRlSW4KICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBkYXRlT3V0CiAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gY3VycmVuY3kKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBhZHVsdHMKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBwcmljZQogICAgICAgICAgICoKICAgICAgICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gYmFyUmVxdWVzdERhdGEKICAgICAgICAgICAqLwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcGFyYW0ge0hvdGVsSW5mb30gcGFnZUluZm8KICAgICAgICAgICAqLwogICAgICAgICAgb25HZXREYXRhOiBmdW5jdGlvbihwYWdlSW5mbykgewogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgICAgdGJyLmxvZygnSW5mbycsIHBhZ2VJbmZvKTsKCiAgICAgICAgICAgIGlmIChwYWdlSW5mby5iYXJSZXF1ZXN0RGF0YSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYWdlSW5mby5iYXJSZXF1ZXN0RGF0YSA9IHRydWU7CgogICAgICAgICAgICB2YXIgY3VycmVudEJhciA9IG1haW4uYmFyLmN1cnJlbnQ7CiAgICAgICAgICAgIGlmIChjdXJyZW50QmFyKSB7CiAgICAgICAgICAgICAgbWFpbi5jbGVhckluZm9PYmoocGFnZUluZm8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgb25BYm9ydCA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgdmFyIGV2ZW50TmFtZSA9ICdkaXNjYXJkJzsKICAgICAgICAgICAgICBpZiAoZXZlbnQgPT09ICdiZXR0ZXJQcmljZScpIHsKICAgICAgICAgICAgICAgIGV2ZW50TmFtZSA9IGV2ZW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICBlYzogJ2hvdGVsJywKICAgICAgICAgICAgICAgIGVhOiBldmVudE5hbWUsCiAgICAgICAgICAgICAgICBlbDogdGJyLmhvc3RuYW1lLAogICAgICAgICAgICAgICAgdDogJ2V2ZW50JwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB2YXIgaW5kZXggPSBtYWluLmVycm9yTWFwW2V2ZW50XTsKICAgICAgICAgICAgICBpZiAoaW5kZXgpIHsKICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IHBhZ2VJbmZvLnF1ZXJ5WzBdOwogICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gW2luZGV4LCB0YnIubGFuZ3VhZ2UubGFuZywgcGFnZUluZm8uZGF0ZUluLCBwYWdlSW5mby5kYXRlT3V0LCBwYWdlSW5mby5hZHVsdHMsIHBhZ2VJbmZvLnByaWNlLCBwYWdlSW5mby5jdXJyZW5jeSwgcXVlcnldLmpvaW4oJzsnKTsKICAgICAgICAgICAgICAgIHRici5lbWl0KCd0cmFjaycsIHsKICAgICAgICAgICAgICAgICAgZWM6ICdob3RlbEVycm9yJywKICAgICAgICAgICAgICAgICAgZWE6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgZWw6IGxhYmVsLAogICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgZWM6ICdob3RlbCcsCiAgICAgICAgICAgICAgZWE6ICdyZXF1ZXN0RGF0YScsCiAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICBjZDogJ2hvdGVscmVxdWVzdGRhdGEnLAogICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgY2Q6ICdob3RlbHJlcXVlc3RkYXRhJywKICAgICAgICAgICAgICB0OiAnc2NyZWVudmlldycKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBtYWluLmJhci5pc0Fib3J0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0SG90ZWxEYXRhKHBhZ2VJbmZvLCBmdW5jdGlvbihlcnIsIGRhdGEpIHsKICAgICAgICAgICAgICBpZiAobWFpbi5iYXIuaXNBYm9ydGVkKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50QmFyICYmIGN1cnJlbnRCYXIuY2xvc2UoKTsKICAgICAgICAgICAgICAgIHRici5sb2coJ0Fib3J0ZWQhJyk7CiAgICAgICAgICAgICAgICBvbkFib3J0KCdSRVFVRVNUX0FCT1JURUQnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRCYXIgJiYgY3VycmVudEJhci5jbG9zZSgpOwogICAgICAgICAgICAgICAgb25BYm9ydChlcnIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCFtYWluLmN1cnJlbmN5LmlzU3VwcG9ydGVkQ2N5KHBhZ2VJbmZvLmN1cnJlbmN5KSkgewogICAgICAgICAgICAgICAgX3RoaXMuY29udmVydFByaWNlKGRhdGEucHJpY2VzLmRhdGEsIHBhZ2VJbmZvLmN1cnJlbmN5KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRici5lbWl0KCd0cmFjaycsIHsKICAgICAgICAgICAgICAgIGVjOiAnaG90ZWwnLAogICAgICAgICAgICAgICAgZWE6ICdyZXNwb25zZURhdGEnLAogICAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgIGNkOiAnaG90ZWxyZXNwb25zZWRhdGEnLAogICAgICAgICAgICAgICAgdDogJ2V2ZW50JwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICBjZDogJ2hvdGVscmVzcG9uc2VkYXRhJywKICAgICAgICAgICAgICAgIHQ6ICdzY3JlZW52aWV3JwogICAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgICAgdmFyIGxvd1RhcmdldFByaWNlID0gX3RoaXMuZ2V0TG93UHJpY2UoZGF0YS5wcmljZXMuZGF0YSk7CiAgICAgICAgICAgICAgdmFyIGlzTG93VGFyZ2V0UHJpY2UgPSBsb3dUYXJnZXRQcmljZSAmJiBsb3dUYXJnZXRQcmljZSA8IHBhZ2VJbmZvLnByaWNlOwoKICAgICAgICAgICAgICB2YXIgaXNMb3dTdWdnZXN0UHJpY2UgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAoIWlzTG93VGFyZ2V0UHJpY2UpIHsKICAgICAgICAgICAgICAgIHZhciBsb3dTdWdnZXN0UHJpY2UgPSBfdGhpcy5nZXRMb3dQcmljZShkYXRhLnByaWNlcy5kYXRhLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlzTG93U3VnZ2VzdFByaWNlID0gbG93U3VnZ2VzdFByaWNlICYmIGxvd1N1Z2dlc3RQcmljZSA8IHBhZ2VJbmZvLnByaWNlOwogICAgICAgICAgICAgICAgaWYgKCFpc0xvd1N1Z2dlc3RQcmljZSkgewogICAgICAgICAgICAgICAgICB2YXIgbWF4U3VnZ2VzdFByaWNlID0gcGFnZUluZm8ucHJpY2UgKyAoMjAgLyAxMDAgKiBwYWdlSW5mby5wcmljZSk7CiAgICAgICAgICAgICAgICAgIGlzTG93U3VnZ2VzdFByaWNlID0gbG93U3VnZ2VzdFByaWNlICYmIGxvd1N1Z2dlc3RQcmljZSA8IG1heFN1Z2dlc3RQcmljZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghaXNMb3dUYXJnZXRQcmljZSAmJiAhaXNMb3dTdWdnZXN0UHJpY2UpIHsKICAgICAgICAgICAgICAgIHRici5sb2coJ0hhcyBsb3cgcHJpY2UhJywgbG93VGFyZ2V0UHJpY2UsIHBhZ2VJbmZvLnByaWNlKTsKICAgICAgICAgICAgICAgIGlmIChhcHBJbmZvLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgIGlmICghbG93VGFyZ2V0UHJpY2UpIHsKICAgICAgICAgICAgICAgICAgICBpc0xvd1N1Z2dlc3RQcmljZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRCYXIgJiYgY3VycmVudEJhci5jbG9zZSgpOwogICAgICAgICAgICAgICAgICBvbkFib3J0KCdiZXR0ZXJQcmljZScpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgZGV0YWlscyA9IHt9OwogICAgICAgICAgICAgIGRldGFpbHMudHlwZSA9ICdob3RlbCc7CiAgICAgICAgICAgICAgZGV0YWlscy5zaG93U3VnZ2VzdFByaWNlID0gaXNMb3dTdWdnZXN0UHJpY2U7CiAgICAgICAgICAgICAgZGV0YWlscy5wcmljZXMgPSBkYXRhLnByaWNlczsKICAgICAgICAgICAgICBkZXRhaWxzLnBhZ2VJbmZvID0gcGFnZUluZm87CgogICAgICAgICAgICAgIG1haW4uYmFyLmNyZWF0ZShkZXRhaWxzKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgcmVxdWVzdEhvdGVsUHJpY2VzOiBmdW5jdGlvbihwYWdlSW5mbywgY2IpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgdmFyIGluZGV4ID0gMDsKCiAgICAgICAgICAgIHZhciBzdWdnZXN0cyA9IFtdOwoKICAgICAgICAgICAgdmFyIF9jYiA9IGZ1bmN0aW9uKGVyciwgcmVzcG9uc2UpIHsKICAgICAgICAgICAgICBpZiAoIWVyciAmJiByZXNwb25zZS5oYXNUYXJnZXQpIHsKICAgICAgICAgICAgICAgIGNiKGVyciwgcmVzcG9uc2UpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpbmRleCsrOwoKICAgICAgICAgICAgICAgIHZhciBoYXNRdWVyeSA9IHBhZ2VJbmZvLnF1ZXJ5W2luZGV4XTsKCiAgICAgICAgICAgICAgICBpZiAoIWVycikgewogICAgICAgICAgICAgICAgICBzdWdnZXN0cy5wdXNoLmFwcGx5KHN1Z2dlc3RzLCByZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgICAgaWYgKGhhc1F1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgZXJyID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChlcnIgJiYgaGFzUXVlcnkpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMucmVxdWVzdEhvdGVsUXVlcnlQcmljZXMocGFnZUluZm8sIGluZGV4LCBfY2IpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgY2IoZXJyLCB7CiAgICAgICAgICAgICAgICAgICAgZGF0YTogc3VnZ2VzdHMKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdEhvdGVsUXVlcnlQcmljZXMocGFnZUluZm8sIGluZGV4LCBfY2IpOwogICAgICAgICAgfSwKICAgICAgICAgIHJlcXVlc3RIb3RlbFF1ZXJ5UHJpY2VzOiBmdW5jdGlvbihwYWdlSW5mbywgaW5kZXgsIGNiKSB7CiAgICAgICAgICAgIG1haW4uY3VycmVuY3kuc2V0U3VwcG9ydGVkQ2N5KCdSVUInKTsKCiAgICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICAgIGhvdGVsX25hbWU6IHBhZ2VJbmZvLnF1ZXJ5W2luZGV4XSwKICAgICAgICAgICAgICBsb2NhbGU6IHRici5sYW5ndWFnZS5sYW5nLAogICAgICAgICAgICAgIGNoZWNrSW46IHBhZ2VJbmZvLmRhdGVJbiwKICAgICAgICAgICAgICBjaGVja091dDogcGFnZUluZm8uZGF0ZU91dCwKICAgICAgICAgICAgICBhZHVsdHM6IHBhZ2VJbmZvLmFkdWx0cwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZGF0YS5tYXJrZXIgPSBhcHBJbmZvLmlkOwogICAgICAgICAgICBkYXRhLmhvc3QgPSAnaDIuc2F2ZWZyb20ubmV0JzsKCiAgICAgICAgICAgIHJldHVybiB0YnIuZ2V0RGF0YSh7CiAgICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly95YXNlbi5ob3RlbGxvb2suY29tL3RwL3YyL2NoZWNrX2hvdGVsX3ByaWNlX2J5X25hbWUuanNvbj8nICsgbW9ub1V0aWxzLnBhcmFtKGRhdGEpCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgIHZhciBkYXRhID0gbnVsbDsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBIb3RlbEFwaUl0ZW0KICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gZGVlcGxpbmsKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlCiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gcHJpY2UKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzdGFycwogICAgICAgICAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHJhdGluZwogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gaXNTdWdnZXN0CiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gdmFsdWUKICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbY29udmVydGVkX3ZhbHVlXQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgICAgICAgICAgICAgKiBAcHJvcGVydHkge0hvdGVsQXBpSXRlbX0gW3RhcmdldF0KICAgICAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7W0hvdGVsQXBpSXRlbV19IHN1Z2dlc3RzCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgdGJyLmVycm9yKCdQYXJzZSBlcnJvciEnLCByZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCdIT1RFTF9QQVJTRV9FUlJPUicpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1Jlc3BvbnNlIGlzIGVtcHR5IScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0hPVEVMX0VNUFRZX1JFU1BPTlNFJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgKiBAdHlwZSB7W0hvdGVsQXBpSXRlbV19CiAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgdmFyIHByaWNlcyA9IFtdOwoKICAgICAgICAgICAgICB2YXIgaGFzVGFyZ2V0ID0gZmFsc2U7CgogICAgICAgICAgICAgIGlmIChkYXRhLnRhcmdldCkgewogICAgICAgICAgICAgICAgaGFzVGFyZ2V0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHByaWNlcy5wdXNoKGRhdGEudGFyZ2V0KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGRhdGEuc3VnZ2VzdHMgJiYgZGF0YS5zdWdnZXN0cy5mb3JFYWNoKGZ1bmN0aW9uKHN1Z2dlc3QpIHsKICAgICAgICAgICAgICAgIHN1Z2dlc3QuaXNTdWdnZXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHByaWNlcy5wdXNoKHN1Z2dlc3QpOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoIXByaWNlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRici5lcnJvcignUmVzcG9uc2UgaXMgZW1wdHkhJywgcmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgIHJldHVybiBjYignSE9URUxfRU1QVFlfUkVTUE9OU0UnKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHByaWNlcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBpdGVtLnByaWNlOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gY2IobnVsbCwgewogICAgICAgICAgICAgICAgaGFzVGFyZ2V0OiBoYXNUYXJnZXQsCiAgICAgICAgICAgICAgICBkYXRhOiBwcmljZXMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBIb3RlbEFwaQogICAgICAgICAgICogQHByb3BlcnR5IHtbSG90ZWxBcGlJdGVtXX0gcHJpY2VzCiAgICAgICAgICAgKi8KICAgICAgICAgIC8qKgogICAgICAgICAgICogQGNhbGxiYWNrIEhvdGVsUmVxdWVzdENhbGxiYWNrCiAgICAgICAgICAgKiBAcGFyYW0ge0Vycm9yfSBlcnIKICAgICAgICAgICAqIEBwYXJhbSB7SG90ZWxBcGl9IFtkYXRhXQogICAgICAgICAgICovCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwYXJhbSB7SG90ZWxJbmZvfSBwYWdlSW5mbwogICAgICAgICAgICogQHBhcmFtIHtIb3RlbFJlcXVlc3RDYWxsYmFja30gY2IKICAgICAgICAgICAqLwogICAgICAgICAgcmVxdWVzdEhvdGVsRGF0YTogZnVuY3Rpb24ocGFnZUluZm8sIGNiKSB7CiAgICAgICAgICAgIHZhciBkYXRhID0ge307CiAgICAgICAgICAgIHZhciBhc3luYyA9IG5ldyBtb25vVXRpbHMuQXN5bmNMaXN0KGZ1bmN0aW9uKGVycikgewogICAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGNiKG51bGwsIGRhdGEpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGFzeW5jLndhaXQoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdEhvdGVsUHJpY2VzKHBhZ2VJbmZvLCBmdW5jdGlvbihlcnIsIHByaWNlcykgewogICAgICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhc3luYy5yZWFkeShlcnIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZGF0YS5wcmljZXMgPSBwcmljZXM7CgogICAgICAgICAgICAgIGlmICghbWFpbi5jdXJyZW5jeS5pc1N1cHBvcnRlZENjeShwYWdlSW5mby5jdXJyZW5jeSkpIHsKICAgICAgICAgICAgICAgIGFzeW5jLndhaXQoKTsKICAgICAgICAgICAgICAgIHZhciBjY3lTdXBwb3J0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjY3lMaXN0ID0gbWFpbi5jYWNoZS5jY3lMaXN0OwogICAgICAgICAgICAgICAgICBpZiAoY2N5TGlzdFtwYWdlSW5mby5jdXJyZW5jeS50b0xvd2VyQ2FzZSgpXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGJyLmVycm9yKCdDdXJyZW5jeSBpcyBub3Qgc3VwcG9ydCEnLCBwYWdlSW5mby5jdXJyZW5jeSk7CiAgICAgICAgICAgICAgICAgICAgYXN5bmMucmVhZHkoJ0NDWV9OT1RfU1VQUE9SVCcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYXN5bmMucmVhZHkoKTsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgaWYgKG1haW4uY2FjaGUuY2N5TGlzdCkgewogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGNjeVN1cHBvcnQoKTsKICAgICAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICAgIG1haW4uY3VycmVuY3kucmVxdWVzdENjeShmdW5jdGlvbihlcnIsIGNjeUxpc3QpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICBhc3luYy5yZWFkeShlcnIpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbWFpbi5jYWNoZS5jY3lMaXN0ID0gY2N5TGlzdDsKICAgICAgICAgICAgICAgICAgICBhc3luYy5yZWFkeSgpOwoKICAgICAgICAgICAgICAgICAgICBjY3lTdXBwb3J0KCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYXN5bmMucmVhZHkoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgcGFnZTogewogICAgICAgICAgICBnZXRQcmljZTogZnVuY3Rpb24ocGFyYW1zLCBwcmljZVBhcmFtcykgewogICAgICAgICAgICAgIHZhciBwcmljZSA9IG51bGw7CiAgICAgICAgICAgICAgaWYgKHByaWNlUGFyYW1zLnByaWNlKSB7CiAgICAgICAgICAgICAgICBwcmljZSA9IHByaWNlUGFyYW1zLnByaWNlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJpY2VQYXJhbXMub25lRGF5UHJpY2UgJiYgcGFyYW1zLmRheUNvdW50KSB7CiAgICAgICAgICAgICAgICBwcmljZSA9IHByaWNlUGFyYW1zLm9uZURheVByaWNlICogcGFyYW1zLmRheUNvdW50OwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJpY2VQYXJhbXMub25lRGF5UHJpY2UgJiYgcGFyYW1zLmRhdGVJbiAmJiBwYXJhbXMuZGF0ZU91dCkgewogICAgICAgICAgICAgICAgdmFyIGRhdGVJbiA9IG5ldyBEYXRlKHBhcmFtcy5kYXRlSW4pOwogICAgICAgICAgICAgICAgdmFyIGRhdGVPdXQgPSBuZXcgRGF0ZShwYXJhbXMuZGF0ZU91dCk7CiAgICAgICAgICAgICAgICB2YXIgZGF5Q291bnQgPSBNYXRoLnJvdW5kKChkYXRlT3V0LmdldFRpbWUoKSAtIGRhdGVJbi5nZXRUaW1lKCkpIC8gMjQgLyA2MCAvIDYwIC8gMTAwMCk7CiAgICAgICAgICAgICAgICBwcmljZSA9IHByaWNlUGFyYW1zLm9uZURheVByaWNlICogZGF5Q291bnQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gcHJpY2U7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldERhdGE6IGZ1bmN0aW9uKHBhcmFtcywgcHJpY2VQYXJhbXMpIHsKICAgICAgICAgICAgICB2YXIgY2hlY2tLZXlzID0gWydxdWVyeScsICdkYXRlSW4nLCAnZGF0ZU91dCcsICdjdXJyZW5jeScsICdhZHVsdHMnLCAncHJpY2UnXTsKCiAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgICAgICBxdWVyeTogcGFyYW1zLnF1ZXJ5LAogICAgICAgICAgICAgICAgZGF0ZUluOiBwYXJhbXMuZGF0ZUluLAogICAgICAgICAgICAgICAgZGF0ZU91dDogcGFyYW1zLmRhdGVPdXQsCiAgICAgICAgICAgICAgICBjdXJyZW5jeTogcGFyYW1zLmN1cnJlbmN5LAogICAgICAgICAgICAgICAgYWR1bHRzOiBwYXJhbXMuYWR1bHRzLAogICAgICAgICAgICAgICAgcHJpY2U6IHRoaXMuZ2V0UHJpY2UocGFyYW1zLCBwcmljZVBhcmFtcykKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICB2YXIgciA9IGNoZWNrS2V5cy5ldmVyeShmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhIWRhdGFba2V5XTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKCFyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRQcmljZUlkOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgICAgICB2YXIgaWRLZXlzID0gWydkYXRlSW4nLCAnZGF0ZU91dCcsICdjdXJyZW5jeScsICdhZHVsdHMnXTsKICAgICAgICAgICAgICB2YXIgaWQgPSBbXTsKCiAgICAgICAgICAgICAgdmFyIHIgPSBpZEtleXMuZXZlcnkoZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBwYXJhbXNba2V5XTsKICAgICAgICAgICAgICAgIGlkLnB1c2godmFsdWUpOwogICAgICAgICAgICAgICAgcmV0dXJuICEhdmFsdWU7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmICghcikgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gaWQuam9pbignOycpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfTsKICAgICAgbWFpbi5ob3RlbCA9IGdldEhvdGVsKHRicik7CgogICAgICBtb25vVXRpbHMuZXh0ZW5kKG1haW4sIHsKICAgICAgICBjdXJyZW5jeTogewogICAgICAgICAgZGVmYXVsdENjeTogJ1JVQicsCiAgICAgICAgICBzdXBwb3J0ZWRDY3k6IFsnVVNEJywgJ0VVUicsICdSVUInXSwKICAgICAgICAgIHNldFN1cHBvcnRlZENjeTogZnVuY3Rpb24oY2N5KSB7CiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShjY3kpKSB7CiAgICAgICAgICAgICAgY2N5ID0gW2NjeV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zdXBwb3J0ZWRDY3kgPSBjY3k7CiAgICAgICAgICB9LAogICAgICAgICAgaXNTdXBwb3J0ZWRDY3k6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnN1cHBvcnRlZENjeS5pbmRleE9mKHZhbHVlKSAhPT0gLTE7CiAgICAgICAgICB9LAogICAgICAgICAgcmVxdWVzdENjeTogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgdGJyLmdldERhdGEoewogICAgICAgICAgICAgIHVybDogJ2h0dHA6Ly9lbmdpbmUuYXZpYXNhbGVzLnJ1L2N1cnJlbmNpZXMvYWxsX2N1cnJlbmNpZXNfcmF0ZXMnCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG51bGw7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHRici5lcnJvcignUGFyc2UgZXJyb3IhJywgcmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgIHJldHVybiBjYignQ0NZX1BBUlNFX0VSUk9SJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ1Jlc3BvbnNlIGlzIGVtcHR5IScsIHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoJ0NDWV9FTVBUWV9SRVNQT05TRScpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2IobnVsbCwgcmVzcG9uc2UpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgbW9ub1V0aWxzLmV4dGVuZChtYWluLCB7CiAgICAgICAgYmFyOiB7CiAgICAgICAgICBnZXRDbG9zZUJ0bjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgInN2ZyIpOwogICAgICAgICAgICB2YXIgc3ZnTlMgPSBzdmcubmFtZXNwYWNlVVJJOwogICAgICAgICAgICBzdmcuc2V0QXR0cmlidXRlKCd3aWR0aCcsICcxOS43OTknKTsKICAgICAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzE5Ljc5OScpOwogICAgICAgICAgICBzdmcuc2V0QXR0cmlidXRlKCd2aWV3Qm94JywgJzAgMCAxOS43OTg5ODk5IDE5Ljc5ODk4OTknKTsKCiAgICAgICAgICAgIHZhciBjb2xvciA9ICcjODg4MTYxJzsKICAgICAgICAgICAgdmFyIG9wYWNpdHkgPSAnLjUnOwoKICAgICAgICAgICAgdmFyIHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdwYXRoJyk7CiAgICAgICAgICAgIHN2Zy5hcHBlbmRDaGlsZChwYXRoKTsKICAgICAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLCAnTTguMDkyIDkuOUw1LjE0NiA2Ljk1MkM0LjU0NCA2LjM1IDQuNDUgNS40NSA0Ljk1IDQuOTVjLjUtLjUgMS40LS40MDYgMi4wMDMuMTk2TDkuOSA4LjA5MmwyLjk0Ni0yLjk0NmMuNjEtLjYxIDEuNTA0LS42OTUgMi4wMDMtLjE5Ni40OTguNS40MTIgMS4zOTQtLjE5NyAyLjAwM0wxMS43MDcgOS45bDIuOTQ2IDIuOTQ2Yy42MDIuNjAyLjY5NSAxLjUwNC4xOTYgMi4wMDMtLjUuNDk4LTEuNDAyLjQwNS0yLjAwNC0uMTk3TDkuOSAxMS43MDdsLTIuOTQ3IDIuOTQ2Yy0uNjEuNjEtMS41MDQuNjk1LTIuMDAzLjE5Ni0uNS0uNS0uNDEzLTEuMzk1LjE5Ni0yLjAwNEw4LjA5MiA5Ljl6Jyk7CiAgICAgICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdmaWxsJywgY29sb3IpOwogICAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnb3BhY2l0eScsIG9wYWNpdHkpOwogICAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZmlsbC1ydWxlJywgJ2V2ZW5vZGQnKTsKCiAgICAgICAgICAgIHJldHVybiBzdmc7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0VHdvV2F5TGluZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsICJzdmciKTsKICAgICAgICAgICAgdmFyIHN2Z05TID0gc3ZnLm5hbWVzcGFjZVVSSTsKICAgICAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCAnNDFweCcpOwogICAgICAgICAgICBzdmcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCAnMjRweCcpOwogICAgICAgICAgICBzdmcuc2V0QXR0cmlidXRlKCd2aWV3Qm94JywgJzAgMCA0MSAyNCcpOwoKICAgICAgICAgICAgdmFyIGNvbG9yID0gJyM1NjU2NTYnOwoKICAgICAgICAgICAgdmFyIGcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdnJyk7CiAgICAgICAgICAgIHN2Zy5hcHBlbmRDaGlsZChnKTsKICAgICAgICAgICAgZy5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1saW5lY2FwJywgJ3NxdWFyZScpOwogICAgICAgICAgICBnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgY29sb3IpOwogICAgICAgICAgICBnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzInKTsKICAgICAgICAgICAgZy5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnbm9uZScpOwogICAgICAgICAgICBnLnNldEF0dHJpYnV0ZSgnZmlsbC1ydWxlJywgJ2V2ZW5vZGQnKTsKCiAgICAgICAgICAgIHZhciBwYXRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKHN2Z05TLCAncGF0aCcpOwogICAgICAgICAgICBnLmFwcGVuZENoaWxkKHBhdGgpOwogICAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZCcsICdNNDAuMzMgMThIMi4yNE02IDEzTC43MjQgMTguMSA2IDIzLjInKTsKCiAgICAgICAgICAgIHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdwYXRoJyk7CiAgICAgICAgICAgIGcuYXBwZW5kQ2hpbGQocGF0aCk7CiAgICAgICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdkJywgJ00uNjcgNWgzOC4wOU0zNSAwbDUuMjc2IDUuMUwzNSAxMC4yJyk7CgogICAgICAgICAgICByZXR1cm4gc3ZnOwogICAgICAgICAgfSwKICAgICAgICAgIGdldE9uZVdheUxpbmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsICJzdmciKTsKICAgICAgICAgICAgdmFyIHN2Z05TID0gc3ZnLm5hbWVzcGFjZVVSSTsKICAgICAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCAnMTA1cHgnKTsKICAgICAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzExcHgnKTsKICAgICAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgndmlld0JveCcsICcwIDAgMTA1IDExJyk7CgogICAgICAgICAgICB2YXIgY29sb3IgPSAnIzU2NTY1Nic7CgogICAgICAgICAgICB2YXIgZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywgJ2cnKTsKICAgICAgICAgICAgc3ZnLmFwcGVuZENoaWxkKGcpOwogICAgICAgICAgICBnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWxpbmVjYXAnLCAnc3F1YXJlJyk7CiAgICAgICAgICAgIGcuc2V0QXR0cmlidXRlKCdzdHJva2UnLCBjb2xvcik7CiAgICAgICAgICAgIGcuc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpOwogICAgICAgICAgICBnLnNldEF0dHJpYnV0ZSgnZmlsbCcsICdub25lJyk7CiAgICAgICAgICAgIGcuc2V0QXR0cmlidXRlKCdmaWxsLXJ1bGUnLCAnZXZlbm9kZCcpOwoKICAgICAgICAgICAgdmFyIHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdwYXRoJyk7CiAgICAgICAgICAgIGcuYXBwZW5kQ2hpbGQocGF0aCk7CiAgICAgICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdkJywgJ00uODIzIDVIMTAyLjc2TTk5IDBsNS4yNzYgNS4xTDk5IDEwLjInKTsKCiAgICAgICAgICAgIHJldHVybiBzdmc7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0SG90ZWxCYXJJdGVtOiBmdW5jdGlvbihkZXRhaWxzKSB7CiAgICAgICAgICAgIHZhciBpc1N1Z2dlc3QgPSAhIWRldGFpbHMuc2hvd1N1Z2dlc3RQcmljZTsKICAgICAgICAgICAgdmFyIG1haW5JdGVtID0gbnVsbDsKICAgICAgICAgICAgZGV0YWlscy5wcmljZXMuZGF0YS5maWx0ZXIoZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpc1N1Z2dlc3QgPT09ICEhaXRlbS5pc1N1Z2dlc3Q7CiAgICAgICAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgIGlmIChtYWluSXRlbSA9PT0gbnVsbCB8fCBtYWluSXRlbS52YWx1ZSA+IGl0ZW0udmFsdWUpIHsKICAgICAgICAgICAgICAgIG1haW5JdGVtID0gaXRlbTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbWFpbkl0ZW07CiAgICAgICAgICB9LAogICAgICAgICAgcHJlcGFyZUhvdGVsSXRlbTogZnVuY3Rpb24ocGFnZUluZm8sIGl0ZW0pIHsKICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICBuYW1lOiBpdGVtLm5hbWUsCiAgICAgICAgICAgICAgdmFsdWU6IGl0ZW0uY29udmVydGVkX3ZhbHVlIHx8IGl0ZW0udmFsdWUsCiAgICAgICAgICAgICAgZGF0ZUluOiBwYWdlSW5mby5kYXRlSW4sCiAgICAgICAgICAgICAgZGF0ZU91dDogcGFnZUluZm8uZGF0ZU91dCwKICAgICAgICAgICAgICBjdXJyZW5jeTogcGFnZUluZm8uY3VycmVuY3ksCiAgICAgICAgICAgICAgbGluazogaXRlbS5kZWVwbGluaywKICAgICAgICAgICAgICBpc1N1Z2dlc3Q6ICEhaXRlbS5pc1N1Z2dlc3QKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICAgIH0sCiAgICAgICAgICBwcmVwYXJlQXZpYUl0ZW06IGZ1bmN0aW9uKHBhZ2VJbmZvLCBpdGVtKSB7CiAgICAgICAgICAgIHZhciBvYmogPSB7CiAgICAgICAgICAgICAgb3JpZ2luOiBpdGVtLm9yaWdpbiwKICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogaXRlbS5kZXN0aW5hdGlvbiwKICAgICAgICAgICAgICB2YWx1ZTogaXRlbS5jb252ZXJ0ZWRfdmFsdWUgfHwgaXRlbS52YWx1ZSwKICAgICAgICAgICAgICBkYXRlU3RhcnQ6IGl0ZW0uZGVwYXJ0X2RhdGUsCiAgICAgICAgICAgICAgZGF0ZUVuZDogaXRlbS5yZXR1cm5fZGF0ZSwKICAgICAgICAgICAgICBjdXJyZW5jeTogcGFnZUluZm8uY3VycmVuY3ksCiAgICAgICAgICAgICAgbW9udGhQcmljZTogISFpdGVtLm1vbnRoUHJpY2UsCiAgICAgICAgICAgICAgdmVuZG9yOiBpdGVtLnZlbmRvciB8fCAnYXZpYXNhbGVzJywKICAgICAgICAgICAgICB1cmw6IGl0ZW0udXJsCiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgICAgfSwKICAgICAgICAgIG1hcmdpblBhZ2U6IGZ1bmN0aW9uKGRldGFpbHMsIGJhckhlaWdodCkgewogICAgICAgICAgICB2YXIgaHRtbCA9IGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZTsKICAgICAgICAgICAgbWFpbi5wYWdlU3R5bGUgPSBtYWluLnBhZ2VTdHlsZSB8fCB7fTsKCiAgICAgICAgICAgIGlmIChiYXJIZWlnaHQpIHsKICAgICAgICAgICAgICB2YXIgYmFyID0gZGV0YWlscy5iYXJFbDsKICAgICAgICAgICAgICBtYWluLnBhZ2VTdHlsZS5tYXJnaW5Ub3AgPSBodG1sLnN0eWxlLm1hcmdpblRvcDsKICAgICAgICAgICAgICBtYWluLnBhZ2VTdHlsZS50cmFuc2l0aW9uID0gaHRtbC5zdHlsZS50cmFuc2l0aW9uOwoKICAgICAgICAgICAgICBodG1sLnN0eWxlLnRyYW5zaXRpb24gPSAnbWFyZ2luLXRvcCAwLjJzJzsKICAgICAgICAgICAgICBiYXIuc3R5bGUudHJhbnNpdGlvbiA9ICdtYXJnaW4tdG9wIDAuMnMnOwoKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaHRtbC5zdHlsZS5tYXJnaW5Ub3AgPSBiYXJIZWlnaHQgKyAncHgnOwogICAgICAgICAgICAgICAgaHRtbC5zdHlsZS5zZXRQcm9wZXJ0eSAmJiBodG1sLnN0eWxlLnNldFByb3BlcnR5KCdtYXJnaW4tdG9wJywgYmFySGVpZ2h0ICsgJ3B4JywgJ2ltcG9ydGFudCcpOwogICAgICAgICAgICAgICAgYmFyLnN0eWxlLm1hcmdpblRvcCA9IDA7CiAgICAgICAgICAgICAgfSwgMCk7CgogICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBodG1sLnN0eWxlLnRyYW5zaXRpb24gPSBtYWluLnBhZ2VTdHlsZS50cmFuc2l0aW9uOwogICAgICAgICAgICAgICAgYmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnJzsKICAgICAgICAgICAgICB9LCAyNTApOwoKICAgICAgICAgICAgICB2YXIgb25TaG93ID0gbWFpbi5jdXJyZW50UHJvZmlsZS5vblNob3c7CiAgICAgICAgICAgICAgb25TaG93ICYmIG9uU2hvdyhiYXJIZWlnaHQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGh0bWwuc3R5bGUubWFyZ2luVG9wID0gbWFpbi5wYWdlU3R5bGUubWFyZ2luVG9wOwoKICAgICAgICAgICAgICB2YXIgb25IaWRlID0gbWFpbi5jdXJyZW50UHJvZmlsZS5vbkhpZGU7CiAgICAgICAgICAgICAgb25IaWRlICYmIG9uSGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgb25SZXBsYWNlOiBmdW5jdGlvbihvbGREZXRhaWxzLCBkZXRhaWxzKSB7CiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvbGREZXRhaWxzLm9uUmVzaXplKTsKCiAgICAgICAgICAgIGlmIChkZXRhaWxzLmJhckVsKSB7CiAgICAgICAgICAgICAgZGV0YWlscy5iYXJFbC5zdHlsZS5tYXJnaW5Ub3AgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBbJ2JhckVsJywgJ3N0eWxlRWwnXS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICB2YXIgbm9kZSA9IG9sZERldGFpbHNbaXRlbV07CiAgICAgICAgICAgICAgdmFyIG5ld05vZGUgPSBkZXRhaWxzW2l0ZW1dOwogICAgICAgICAgICAgIHZhciBwYXJlbnQ7CiAgICAgICAgICAgICAgaWYgKG5vZGUgJiYgKHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZSkpIHsKICAgICAgICAgICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQobmV3Tm9kZSwgbm9kZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbihkZXRhaWxzLCBieVVzZXIpIHsKICAgICAgICAgICAgWydiYXJFbCcsICdzdHlsZUVsJ10uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgdmFyIG5vZGUgPSBkZXRhaWxzW2l0ZW1dOwogICAgICAgICAgICAgIHZhciBwYXJlbnQ7CiAgICAgICAgICAgICAgaWYgKG5vZGUgJiYgKHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZSkpIHsKICAgICAgICAgICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChub2RlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGV0YWlscy5vblJlc2l6ZSk7CgogICAgICAgICAgICBtYWluLmJhci5tYXJnaW5QYWdlKGRldGFpbHMpOwoKICAgICAgICAgICAgaWYgKGJ5VXNlcikgewogICAgICAgICAgICAgIG1haW4uc3RvcE9ic2VydmVyKCk7CgogICAgICAgICAgICAgIHZhciBibGFja0xpc3QgPSBtYWluLnN0b3JhZ2UuYmxhY2tMaXN0OwogICAgICAgICAgICAgIHZhciBub3cgPSBwYXJzZUludChEYXRlLm5vdygpIC8gMTAwMCk7CiAgICAgICAgICAgICAgYmxhY2tMaXN0LnB1c2goewogICAgICAgICAgICAgICAgaG9zdG5hbWU6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgIGV4cGlyZTogbm93ICsgNSAqIDYwICogNjAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgbWFpbi5zYXZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBnZXRTdHlsZTogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAgICAgICB2YXIgYmFyQ29sb3IgPSAnI2ZjZWZiNCc7CiAgICAgICAgICAgIHZhciBkZWZhdWx0Q29sb3IgPSAnIzMzMzMzMyc7CiAgICAgICAgICAgIHZhciBsYWJlbENvbG9yID0gJyMwMDVmODYnOwogICAgICAgICAgICB2YXIgcHJpY2VDb2xvciA9ICcjNGI5ZjAwJzsKICAgICAgICAgICAgdmFyIHZpZXdCZ0NvbG9yID0gJyM0YjlmMDAnOwogICAgICAgICAgICB2YXIgdmlld092ZXJCZ0NvbG9yID0gJyMxRjk2MDAnOwogICAgICAgICAgICB2YXIgY2xvc2VCdG5PdmVyT3BhY2l0eSA9ICcxJzsKCiAgICAgICAgICAgIHJldHVybiBtb25vVXRpbHMuY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgICAgICB0ZXh0OiBtb25vVXRpbHMuc3R5bGUyVGV4dChbewogICAgICAgICAgICAgICAgc2VsZWN0b3I6ICcjJyArIGRldGFpbHMucm5kSWQsCiAgICAgICAgICAgICAgICBzdHlsZTogbW9ub1V0aWxzLmV4dGVuZFBvcyh7fSwgbW9ub1V0aWxzLnN0eWxlUmVzZXQsIHsKICAgICAgICAgICAgICAgICAgZm9udDogJ25vcm1hbCBub3JtYWwgMTRweCBBcmlhbCwgc2Fucy1zZXJpZicsCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogYmFyQ29sb3IsCiAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLAogICAgICAgICAgICAgICAgICB0b3A6IDAsCiAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsCiAgICAgICAgICAgICAgICAgIG1hcmdpblRvcDogKC1kZXRhaWxzLmJhckhlaWdodCkgKyAncHgnLAogICAgICAgICAgICAgICAgICBib3hTaGFkb3c6ICcwIDAgMXB4IHJnYmEoMCwgMCwgMCwgMC41KScsCiAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICdub3JtYWwnLAogICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLAogICAgICAgICAgICAgICAgICBjb2xvcjogZGVmYXVsdENvbG9yCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIGFwcGVuZDogewogICAgICAgICAgICAgICAgICAnLnNmLWNlbGwnOiB7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ3RhYmxlLWNlbGwnLAogICAgICAgICAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICdtaWRkbGUnLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogZGV0YWlscy5iYXJIZWlnaHQgKyAncHgnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICcuc2YtY2VudGVyJzogewogICAgICAgICAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgJy5zZi1yaWdodCc6IHsKICAgICAgICAgICAgICAgICAgICB0ZXh0QWxpZ246ICdyaWdodCcKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgJy5zZi1jbG9zZS1idG4nOiB7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJywKICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzIycHgnLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogJzIycHgnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICcuc2YtY2xvc2UtYnRuOmhvdmVyIHBhdGgnOiB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogY2xvc2VCdG5PdmVyT3BhY2l0eQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLW5vd3JhcCc6IHsKICAgICAgICAgICAgICAgICAgICB3aGl0ZVNwYWNlOiAnbm93cmFwJwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLWxhYmVsJzogewogICAgICAgICAgICAgICAgICAgIGNvbG9yOiBsYWJlbENvbG9yCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICcuc2YtcG9pbnQnOiB7CiAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICcxOHB4JwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLXBsYWNlJzogewogICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnaW5oZXJpdCcKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgJy5zZi1wcmljZSc6IHsKICAgICAgICAgICAgICAgICAgICBjb2xvcjogcHJpY2VDb2xvciwKICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogJzI2cHgnLAogICAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICdib2xkJwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLXZpZXctYnRuJzogewogICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB2aWV3QmdDb2xvciwKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAnN3B4IDE4cHgnLAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnI2ZmZicsCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnNHB4JywKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICczMnB4JywKICAgICAgICAgICAgICAgICAgICBib3hTaXppbmc6ICdib3JkZXItYm94JywKICAgICAgICAgICAgICAgICAgICB0ZXh0RGVjb3JhdGlvbjogJ25vbmUnLAogICAgICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICcuc2Ytdmlldy1idG46aG92ZXInOiB7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB2aWV3T3ZlckJnQ29sb3IKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXRGb250U2l6ZVNhbmRib3g6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2FuZGJveCA9IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICBzdHlsZTogbW9ub1V0aWxzLmV4dGVuZFBvcyh7fSwgbW9ub1V0aWxzLnN0eWxlUmVzZXQsIHsKICAgICAgICAgICAgICAgIGZvbnQ6ICdub3JtYWwgbm9ybWFsIDEycHggQXJpYWwsIHNhbnMtc2VyaWYnLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLAogICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzYW5kYm94KTsKCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgZ2V0Tm9kZVNpemU6IGZ1bmN0aW9uKG5vZGUsIGNiKSB7CiAgICAgICAgICAgICAgICBzYW5kYm94LmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjbGllbnRXaWR0aCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKG5vZGUsIG51bGwpLmdldFByb3BlcnR5VmFsdWUoIndpZHRoIik7CiAgICAgICAgICAgICAgICAgIGNsaWVudFdpZHRoID0gTWF0aC5jZWlsKHBhcnNlRmxvYXQoY2xpZW50V2lkdGgpKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKGNsaWVudFdpZHRoKTsKICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHNhbmRib3gucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzYW5kYm94KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBjYWxjQmxvY2tTaXplOiBmdW5jdGlvbihibG9ja3MsIGNiKSB7CiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHZhciBkZWZhdWx0U3R5bGUgPSB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBzYW5kYm94ID0gbnVsbDsKCiAgICAgICAgICAgIHZhciByZWFkeSA9IDA7CiAgICAgICAgICAgIHZhciB3YWl0ID0gMDsKCiAgICAgICAgICAgIHZhciBvblJlYWR5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmVhZHkrKzsKICAgICAgICAgICAgICBpZiAod2FpdCAhPT0gcmVhZHkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2FuZGJveCAmJiBzYW5kYm94LnJlbW92ZSgpOwoKICAgICAgICAgICAgICBPYmplY3Qua2V5cyhibG9ja3MpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgICB2YXIgYmxvY2sgPSBibG9ja3Nba2V5XTsKCiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKCFibG9jay5mb250U2l6ZVdpZHRoKSB7CiAgICAgICAgICAgICAgICAgIHdpZHRoID0gYmxvY2sud2lkdGg7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBibG9jay53aWR0aExpc3QgPSBbXTsKICAgICAgICAgICAgICAgICAgdmFyIG1heFdpZHRoID0gOTk5OTk5OwogICAgICAgICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGJsb2NrLmZvbnRTaXplV2lkdGgpOwogICAgICAgICAgICAgICAgICBrZXlzLnJldmVyc2UoKS5mb3JFYWNoKGZ1bmN0aW9uKGZvbnRTaXplKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1pbldpZHRoID0gKGJsb2NrLmZvbnRTaXplV2lkdGhbZm9udFNpemVdIHx8IGJsb2NrLndpZHRoLmRlZmF1bHQpICsgKGJsb2NrLndpZHRoLnBsdXMgfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiBwYXJzZUZsb2F0KGZvbnRTaXplKSwKICAgICAgICAgICAgICAgICAgICAgIG1pbldpZHRoOiBtaW5XaWR0aCwKICAgICAgICAgICAgICAgICAgICAgIG1heFdpZHRoOiBtYXhXaWR0aAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgbWF4V2lkdGggPSBtaW5XaWR0aDsKICAgICAgICAgICAgICAgICAgICBibG9jay53aWR0aExpc3QucHVzaChvYmopOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgZGVsZXRlIGJsb2NrLmZvbnRTaXplV2lkdGg7CiAgICAgICAgICAgICAgICAgIHdpZHRoID0gYmxvY2sud2lkdGhMaXN0WzBdLm1pbldpZHRoOwogICAgICAgICAgICAgICAgICBibG9jay53aWR0aExpc3Quc2xpY2UoLTEpWzBdLm1pbldpZHRoID0gMDsKICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrLndpZHRoTGlzdC5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBibG9jay53aWR0aCA9IHdpZHRoOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBibG9jay53aWR0aExpc3Q7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBibG9jay5ub2RlLnN0eWxlLndpZHRoID0gd2lkdGggKyAncHgnOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHdhaXQrKzsKICAgICAgICAgICAgT2JqZWN0LmtleXMoYmxvY2tzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgIHZhciBibG9jayA9IGJsb2Nrc1trZXldOwogICAgICAgICAgICAgIGlmICghYmxvY2sud2lkdGggfHwgIWJsb2NrLndpZHRoLnN0cmluZ3MpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghc2FuZGJveCkgewogICAgICAgICAgICAgICAgc2FuZGJveCA9IF90aGlzLmdldEZvbnRTaXplU2FuZGJveCgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGJsb2NrLndpZHRoLmZvbnRTaXplKSkgewogICAgICAgICAgICAgICAgYmxvY2sud2lkdGguZm9udFNpemUgPSBbYmxvY2sud2lkdGguZm9udFNpemVdOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYmxvY2suZm9udFNpemVXaWR0aCA9IHt9OwogICAgICAgICAgICAgIGJsb2NrLndpZHRoLnN0cmluZ3MuZm9yRWFjaChmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICAgICAgICBibG9jay53aWR0aC5mb250U2l6ZS5mb3JFYWNoKGZ1bmN0aW9uKGZvbnRTaXplKSB7CiAgICAgICAgICAgICAgICAgIHdhaXQrKzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHNhbmRib3guZ2V0Tm9kZVNpemUobW9ub1V0aWxzLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXh0LAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiBtb25vVXRpbHMuZXh0ZW5kKHt9LCBkZWZhdWx0U3R5bGUsIHsKICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiBmb250U2l6ZSArICdweCcKICAgICAgICAgICAgICAgICAgICB9LCBibG9jay53aWR0aC5mb250U3R5bGUpCiAgICAgICAgICAgICAgICAgIH0pLCBmdW5jdGlvbihzaXplKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNTaXplID0gYmxvY2suZm9udFNpemVXaWR0aFtmb250U2l6ZV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNTaXplID09PSB1bmRlZmluZWQgfHwgY1NpemUgPCBzaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICBibG9jay5mb250U2l6ZVdpZHRoW2ZvbnRTaXplXSA9IHNpemU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvblJlYWR5KCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgb25SZWFkeSgpOwogICAgICAgICAgfSwKICAgICAgICAgIC8qKgogICAgICAgICAgICoKICAgICAgICAgICAqIEBwYXJhbSB7e29yaWdpbjogU3RyaW5nLCBkZXN0aW5hdGlvbjogU3RyaW5nLCBjdXJyZW5jeTogU3RyaW5nLCBwcmljZTogTnVtYmVyLCBkYXRlU3RhcnQ6IFN0cmluZywgZGF0ZUVuZDogU3RyaW5nfX0gcGFnZUluZm8KICAgICAgICAgICAqLwogICAgICAgICAgYXZpYUJhclNhdmVJbkhpc3Rvcnk6IGZ1bmN0aW9uKHBhZ2VJbmZvKSB7CiAgICAgICAgICAgIHZhciBvcmlnaW5DaXR5ID0gbWFpbi5nZXRDaXR5TmFtZShwYWdlSW5mby5vcmlnaW4pOwogICAgICAgICAgICB2YXIgZGVzdGluYXRpb25DaXR5ID0gbWFpbi5nZXRDaXR5TmFtZShwYWdlSW5mby5kZXN0aW5hdGlvbik7CiAgICAgICAgICAgIGlmICghb3JpZ2luQ2l0eSB8fCAhZGVzdGluYXRpb25DaXR5KSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgICAgICBvcmlnaW5DaXR5OiBvcmlnaW5DaXR5LAogICAgICAgICAgICAgIGRlc3RpbmF0aW9uQ2l0eTogZGVzdGluYXRpb25DaXR5LAogICAgICAgICAgICAgIG9yaWdpbjogcGFnZUluZm8ub3JpZ2luLAogICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBwYWdlSW5mby5kZXN0aW5hdGlvbiwKICAgICAgICAgICAgICBkYXRlU3RhcnQ6IHBhZ2VJbmZvLmRhdGVTdGFydCwKICAgICAgICAgICAgICBkYXRlRW5kOiBwYWdlSW5mby5kYXRlRW5kLAogICAgICAgICAgICAgIHRpbWU6IHBhcnNlSW50KERhdGUubm93KCkgLyAxMDAwKQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuIHRici5lbWl0KCdoaXN0b3J5JywgZGF0YSk7CiAgICAgICAgICB9LAogICAgICAgICAgYXZpYUJhckNyZWF0ZTogZnVuY3Rpb24oZGV0YWlscywgb2xkQmFyKSB7CiAgICAgICAgICAgIHZhciBwcmljZXMgPSBkZXRhaWxzLnByaWNlczsKICAgICAgICAgICAgdmFyIHBhZ2VJbmZvID0gZGV0YWlscy5wYWdlSW5mbzsKCiAgICAgICAgICAgIHZhciBtYWluSXRlbUluZGV4ID0gbWFpbi5nZXRBdmlhQmFySXRlbUluZGV4KHByaWNlcy5kYXRhKTsKICAgICAgICAgICAgaWYgKG1haW5JdGVtSW5kZXggPT09IC0xKSB7CiAgICAgICAgICAgICAgdGJyLmVycm9yKCdCYXIgaXRlbSBpcyBub3QgZm91bmQhJywgZGV0YWlscyk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaXNPbmVXYXkgPSAhcGFnZUluZm8uZGF0ZUVuZDsKCiAgICAgICAgICAgIHZhciBtYWluSXRlbSA9IG1haW4uYmFyLnByZXBhcmVBdmlhSXRlbShwYWdlSW5mbywgcHJpY2VzLmRhdGFbbWFpbkl0ZW1JbmRleF0pOwogICAgICAgICAgICB2YXIgaXNDYWxlbmRhciA9ICEhbWFpbkl0ZW0ubW9udGhQcmljZTsKCiAgICAgICAgICAgIHZhciB0cmFja0J5VmVuZG9yID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgIHZhciBtYXAgPSB7CiAgICAgICAgICAgICAgICBhdmlhc2FsZXM6ICdhcycsCiAgICAgICAgICAgICAgICBza3lzY2FubmVyOiAnc2MnCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgdmFyIHByZWZpeCA9IG1hcFttYWluSXRlbS52ZW5kb3JdOwogICAgICAgICAgICAgIGlmIChwcmVmaXgpIHsKICAgICAgICAgICAgICAgIGRhdGEuZWMgKz0gJy0nICsgcHJlZml4OwogICAgICAgICAgICAgICAgcmV0dXJuIHRici5lbWl0KCd0cmFjaycsIGRhdGEpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGJyLmVycm9yKCdQcmVmaXggaXMgbm90IGZvdW5kIScsIG1haW5JdGVtLnZlbmRvcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIGJhclVybCA9IG51bGw7CiAgICAgICAgICAgIGlmIChtYWluSXRlbS51cmwpIHsKICAgICAgICAgICAgICBiYXJVcmwgPSBtYWluSXRlbS51cmw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYmFyVXJsID0gJ2h0dHA6Ly9oeWRyYS5hdmlhc2FsZXMucnUvc2VhcmNoZXMvbmV3JyArICc/JyArIG1vbm9VdGlscy5wYXJhbSh7CiAgICAgICAgICAgICAgICBvcmlnaW5faWF0YTogcGFnZUluZm8ub3JpZ2luLAogICAgICAgICAgICAgICAgZGVzdGluYXRpb25faWF0YTogcGFnZUluZm8uZGVzdGluYXRpb24sCiAgICAgICAgICAgICAgICBhZHVsdHM6IDEsCiAgICAgICAgICAgICAgICBjaGlsZHJlbjogMCwKICAgICAgICAgICAgICAgIGluZmFudHM6IDAsCiAgICAgICAgICAgICAgICB0cmlwX2NsYXNzOiAwLAogICAgICAgICAgICAgICAgZGVwYXJ0X2RhdGU6IHBhZ2VJbmZvLmRhdGVTdGFydCwKICAgICAgICAgICAgICAgIHJldHVybl9kYXRlOiBwYWdlSW5mby5kYXRlRW5kLAogICAgICAgICAgICAgICAgbWFya2VyOiBhcHBJbmZvLmlkLAogICAgICAgICAgICAgICAgd2l0aF9yZXF1ZXN0OiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwcmljZU9iaiA9IG1haW4uZ2V0UHJpY2UobWFpbkl0ZW0uY3VycmVuY3ksIG1haW5JdGVtLnZhbHVlKTsKCiAgICAgICAgICAgIHZhciBzdHJpbmdzID0gewogICAgICAgICAgICAgIHByaWNlOiBwcmljZU9iai5zdHJpbmcsCiAgICAgICAgICAgICAgcG9pbnRBOiBtYWluLmdldENpdHlOYW1lKG1haW5JdGVtLm9yaWdpbiksCiAgICAgICAgICAgICAgcG9pbnRCOiBtYWluLmdldENpdHlOYW1lKG1haW5JdGVtLmRlc3RpbmF0aW9uKSwKICAgICAgICAgICAgICB2aWV3OiB0YnIubGFuZ3VhZ2UudmlldwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKCFzdHJpbmdzLnBvaW50QSB8fCAhc3RyaW5ncy5wb2ludEIpIHsKICAgICAgICAgICAgICB0YnIuZXJyb3IoJ0NpdHkgbmFtZSBpcyBub3QgZGVmaW5lZCEnLCBtYWluSXRlbSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYmxvY2tzID0ge307CgogICAgICAgICAgICBibG9ja3MuY2xvc2VCbG9jayA9IHsKICAgICAgICAgICAgICBub2RlOiBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICBjbGFzczogWydzZi1jZWxsJywgJ3NmLWNlbnRlciddLAogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgY3Vyc29yOiAnZGVmYXVsdCcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBjbG9zZUJ0bjogbW9ub1V0aWxzLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgICAgIGNsYXNzOiAnc2YtY2xvc2UtYnRuJywKICAgICAgICAgICAgICAgIGhyZWY6ICcjY2xvc2UnLAogICAgICAgICAgICAgICAgdGl0bGU6IHRici5sYW5ndWFnZS5jbG9zZSwKICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICBtYWluLmJhci5nZXRDbG9zZUJ0bigpCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgb246IFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICAgICAgICAgIGRldGFpbHMuY2xvc2UoMSk7CgogICAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgICAgZWM6ICdjaGVhcGZsaWdodCcsCiAgICAgICAgICAgICAgICAgICAgZWE6ICdjbG9zZScsCiAgICAgICAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgdHJhY2tCeVZlbmRvcih7CiAgICAgICAgICAgICAgICAgICAgZWM6ICdjaGVhcGZsaWdodCcsCiAgICAgICAgICAgICAgICAgICAgZWE6ICdjbG9zZScsCiAgICAgICAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICB3aWR0aDogMzYsCiAgICAgICAgICAgICAgbGVmdEZpeGVkOiAxCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJsb2Nrcy5jbG9zZUJsb2NrLm5vZGUuYXBwZW5kQ2hpbGQoYmxvY2tzLmNsb3NlQmxvY2suY2xvc2VCdG4pOwoKICAgICAgICAgICAgYmxvY2tzLmxlZnRSZXNpemVCbG9jayA9IHsKICAgICAgICAgICAgICBub2RlOiBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICBjbGFzczogWydzZi1jZWxsJ10KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICB3aWR0aDogMAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKGlzQ2FsZW5kYXIpIHsKICAgICAgICAgICAgICBzdHJpbmdzLmNhbExhYmVsID0gdGJyLmxhbmd1YWdlLmNhbExhYmVsOwoKICAgICAgICAgICAgICBibG9ja3MuY2FsTGFiZWwgPSB7CiAgICAgICAgICAgICAgICBub2RlOiBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLWNlbGwnLCAnc2YtbGFiZWwnXSwKICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5ncy5jYWxMYWJlbAogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB3aWR0aDogewogICAgICAgICAgICAgICAgICBzdHJpbmdzOiBbCiAgICAgICAgICAgICAgICAgICAgc3RyaW5ncy5jYWxMYWJlbAogICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IDIwMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlZnRGaXhlZDogMQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNPbmVXYXkpIHsKICAgICAgICAgICAgICBzdHJpbmdzLmZvdW5kT25lV2F5ID0gdGJyLmxhbmd1YWdlLmZvdW5kT25lV2F5OwogICAgICAgICAgICAgIHN0cmluZ3MuZGF0ZVN0YXJ0ID0gbWFpbi5nZXREYXRlKG1haW5JdGVtLmRhdGVTdGFydCk7CgogICAgICAgICAgICAgIGJsb2Nrcy5kYXRlQmxvY2sgPSB7CiAgICAgICAgICAgICAgICBub2RlOiBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLWNlbGwnXSwKICAgICAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICAgICAgbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtbGFiZWwnXSwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ3MuZm91bmRPbmVXYXkKICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1kYXRlJ10sCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmdzLmRhdGVTdGFydAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgd2lkdGg6IHsKICAgICAgICAgICAgICAgICAgc3RyaW5nczogWwogICAgICAgICAgICAgICAgICAgIHN0cmluZ3MuZm91bmRPbmVXYXksCiAgICAgICAgICAgICAgICAgICAgc3RyaW5ncy5kYXRlU3RhcnQKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgZm9udFNpemU6IDE0LAogICAgICAgICAgICAgICAgICBkZWZhdWx0OiAyMDAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWZ0Rml4ZWQ6IDEKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0cmluZ3MuZm91bmRUd29XYXkgPSB0YnIubGFuZ3VhZ2UuZm91bmRUd29XYXk7CgogICAgICAgICAgICAgIGJsb2Nrcy5kYXRlRm91bmRCbG9jayA9IHsKICAgICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCcsICdzZi1sYWJlbCcsICdzZi1yaWdodCddLAogICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmdzLmZvdW5kVHdvV2F5CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHdpZHRoOiB7CiAgICAgICAgICAgICAgICAgIHN0cmluZ3M6IFsKICAgICAgICAgICAgICAgICAgICBzdHJpbmdzLmZvdW5kVHdvV2F5CiAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxNCwKICAgICAgICAgICAgICAgICAgZGVmYXVsdDogMTIwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGVmdEZpeGVkOiAxCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgc3RyaW5ncy5vcmlnaW4gPSB0YnIubGFuZ3VhZ2Uub3JpZ2luICsgU3RyaW5nLmZyb21DaGFyQ29kZSgxNjApOwogICAgICAgICAgICAgIHN0cmluZ3MuZGVzdGluYXRpb24gPSB0YnIubGFuZ3VhZ2UuZGVzdGluYXRpb24gKyBTdHJpbmcuZnJvbUNoYXJDb2RlKDE2MCk7CgogICAgICAgICAgICAgIGJsb2Nrcy5kYXRlTGFiZXNCbG9jayA9IHsKICAgICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCddLAogICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1yaWdodCddLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5ncy5vcmlnaW4KICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1yaWdodCddLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5ncy5kZXN0aW5hdGlvbgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgd2lkdGg6IHsKICAgICAgICAgICAgICAgICAgc3RyaW5nczogWwogICAgICAgICAgICAgICAgICAgIHN0cmluZ3Mub3JpZ2luLAogICAgICAgICAgICAgICAgICAgIHN0cmluZ3MuZGVzdGluYXRpb24KICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgZm9udFNpemU6IDE0LAogICAgICAgICAgICAgICAgICBwbHVzOiAxMCwKICAgICAgICAgICAgICAgICAgZGVmYXVsdDogODAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWZ0Rml4ZWQ6IDEKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBzdHJpbmdzLmRhdGVTdGFydCA9IG1haW4uZ2V0RGF0ZShtYWluSXRlbS5kYXRlU3RhcnQpOwogICAgICAgICAgICAgIHN0cmluZ3MuZGF0ZUVuZCA9IG1haW4uZ2V0RGF0ZShtYWluSXRlbS5kYXRlRW5kKTsKCiAgICAgICAgICAgICAgYmxvY2tzLmRhdGVCbG9jayA9IHsKICAgICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCddLAogICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1ub3dyYXAnXSwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ3MuZGF0ZVN0YXJ0CiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2Ytbm93cmFwJ10sCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmdzLmRhdGVFbmQKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHdpZHRoOiB7CiAgICAgICAgICAgICAgICAgIHN0cmluZ3M6IFsKICAgICAgICAgICAgICAgICAgICBzdHJpbmdzLmRhdGVTdGFydCwKICAgICAgICAgICAgICAgICAgICBzdHJpbmdzLmRhdGVFbmQKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgZm9udFNpemU6IDE0LAogICAgICAgICAgICAgICAgICBkZWZhdWx0OiAxMDAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsZWZ0Rml4ZWQ6IDEKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNDYWxlbmRhcikgewogICAgICAgICAgICAgIHN0cmluZ3MuY2FsTW9udGggPSBtYWluLmdldENhbE1vbnRoKG1haW5JdGVtLmRhdGVTdGFydCk7CiAgICAgICAgICAgICAgc3RyaW5ncy5jYWxNb250aCA9IHRici5sYW5ndWFnZS5pbk1vbnRoLnJlcGxhY2UoJyVtb250aCUnLCBzdHJpbmdzLmNhbE1vbnRoKTsKCiAgICAgICAgICAgICAgdmFyIGlubGluZUFycm93ID0gbnVsbDsKICAgICAgICAgICAgICB2YXIgcGx1c1dpZHRoID0gMDsKICAgICAgICAgICAgICBpZiAoaXNPbmVXYXkpIHsKICAgICAgICAgICAgICAgIGlubGluZUFycm93ID0gbWFpbi5iYXIuZ2V0T25lV2F5TGluZSgpOwogICAgICAgICAgICAgICAgcGx1c1dpZHRoID0gMTQwOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpbmxpbmVBcnJvdyA9IG1haW4uYmFyLmdldFR3b1dheUxpbmVzKCk7CiAgICAgICAgICAgICAgICBwbHVzV2lkdGggPSA3NTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaW5saW5lQXJyb3cuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgogICAgICAgICAgICAgIGJsb2Nrcy5jYWxlbmRhckNhbnRlckJsb2NrID0gewogICAgICAgICAgICAgICAgbm9kZTogbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1jZWxsJywgJ3NmLWNlbnRlcicsICdzZi1wb2ludCddLAogICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1wbGFjZSddLAogICAgICAgICAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZ3MucG9pbnRBLAogICAgICAgICAgICAgICAgICAgICAgICAnICcsCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJwogICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kOiBpbmxpbmVBcnJvdwogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgJyAnLAogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdzLnBvaW50QiwKICAgICAgICAgICAgICAgICAgICAgICAgJyAnLAogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdzLmNhbE1vbnRoCiAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB3aWR0aDogewogICAgICAgICAgICAgICAgICBzdHJpbmdzOiBbCiAgICAgICAgICAgICAgICAgICAgc3RyaW5ncy5wb2ludEEgKyAnICcgKyBzdHJpbmdzLnBvaW50QiArICcgJyArIHN0cmluZ3MuY2FsTW9udGgKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgZm9udFNpemU6IFsyNiwgMjIsIDE4XSwKICAgICAgICAgICAgICAgICAgcGx1czogcGx1c1dpZHRoCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBibG9ja3MucG9pbnRBQmxvY2sgPSB7CiAgICAgICAgICAgICAgICBub2RlOiBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLWNlbGwnLCAnc2YtcmlnaHQnLCAnc2YtcG9pbnQnXSwKICAgICAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICAgICAgbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtcGxhY2UnLCAnc2YtcmlnaHQnXSwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ3MucG9pbnRBCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB3aWR0aDogewogICAgICAgICAgICAgICAgICBzdHJpbmdzOiBbCiAgICAgICAgICAgICAgICAgICAgc3RyaW5ncy5wb2ludEEKICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgZm9udFNpemU6IFsyNiwgMjIsIDE4XQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmIChpc09uZVdheSkgewogICAgICAgICAgICAgICAgYmxvY2tzLmFycm93QmxvY2sgPSB7CiAgICAgICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1jZWxsJywgJ3NmLWNlbnRlciddLAogICAgICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICAgICAgbWFpbi5iYXIuZ2V0T25lV2F5TGluZSgpCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgd2lkdGg6IDE0MAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYmxvY2tzLmFycm93QmxvY2sgPSB7CiAgICAgICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1jZWxsJywgJ3NmLWNlbnRlciddLAogICAgICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICAgICAgbWFpbi5iYXIuZ2V0VHdvV2F5TGluZXMoKQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgIHdpZHRoOiA3NQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJsb2Nrcy5wb2ludEJCbG9jayA9IHsKICAgICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCcsICdzZi1wb2ludCddLAogICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1wbGFjZSddLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5ncy5wb2ludEIKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHdpZHRoOiB7CiAgICAgICAgICAgICAgICAgIHN0cmluZ3M6IFsKICAgICAgICAgICAgICAgICAgICBzdHJpbmdzLnBvaW50QgogICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICBmb250U2l6ZTogWzI2LCAyMiwgMThdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYmxvY2tzLnByaWNlQmxvY2sgPSB7CiAgICAgICAgICAgICAgbm9kZTogbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCcsICdzZi1wcmljZScsICdzZi1jZW50ZXInLCAnc2Ytbm93cmFwJ10sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IG1haW4uZ2V0UHJpY2VOb2RlKHByaWNlT2JqKQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIHdpZHRoOiB7CiAgICAgICAgICAgICAgICBzdHJpbmdzOiBbCiAgICAgICAgICAgICAgICAgIHN0cmluZ3MucHJpY2UKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBmb250U2l6ZTogMjYsCiAgICAgICAgICAgICAgICBmb250U3R5bGU6IHsKICAgICAgICAgICAgICAgICAgZm9udFdlaWdodDogJ2JvbGQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVmYXVsdDogMTIwCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICByaWdodEZpeGVkOiAxCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgdmlld0xpbmsgPSBudWxsOwogICAgICAgICAgICBibG9ja3Mudmlld0Jsb2NrID0gewogICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLWNlbGwnLCAnc2YtY2VudGVyJ10sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgdmlld0xpbmsgPSBtb25vVXRpbHMuY3JlYXRlKCdhJywgewogICAgICAgICAgICAgICAgICAgIGNsYXNzOiAnc2Ytdmlldy1idG4nLAogICAgICAgICAgICAgICAgICAgIGhyZWY6IGJhclVybCwKICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6ICdfYmxhbmsnLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ3MudmlldywKICAgICAgICAgICAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgICAgICBjZDogJ2ZsaWdodGNsaWNrJywKICAgICAgICAgICAgICAgICAgICAgICAgdDogJ3NjcmVlbnZpZXcnCiAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVjOiAnY2hlYXBmbGlnaHQnLAogICAgICAgICAgICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRjbGljaycsCiAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNDYWxlbmRhcikgewogICAgICAgICAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRfYmV0dGVycHJpY2VfY2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdzY3JlZW52aWV3JwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRici5lbWl0KCd0cmFjaycsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0JywKICAgICAgICAgICAgICAgICAgICAgICAgICBlYTogJ2JldHRlcnByaWNlY2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRfYmV0dGVycHJpY2VfY2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICB0cmFja0J5VmVuZG9yKHsKICAgICAgICAgICAgICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0JywKICAgICAgICAgICAgICAgICAgICAgICAgICBlYTogJ2JldHRlcnByaWNlY2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRfYmV0dGVycHJpY2VfY2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRfY2FsZW5kYXJfY2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdzY3JlZW52aWV3JwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHRici5lbWl0KCd0cmFjaycsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0JywKICAgICAgICAgICAgICAgICAgICAgICAgICBlYTogJ2NhbGVuZGFyY2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRfY2FsZW5kYXJfY2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICB3aWR0aDogMTMwLAogICAgICAgICAgICAgIHJpZ2h0Rml4ZWQ6IDEKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJsb2Nrcy5yaWdodFJlc2l6ZUJsb2NrID0gewogICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLWNlbGwnXQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIHdpZHRoOiAwCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgbGVmdEZpeGVkQmxvY2tzID0gW107CiAgICAgICAgICAgIHZhciByaWdodEZpeGVkQmxvY2tzID0gW107CgogICAgICAgICAgICB2YXIgcm5kSWQgPSAncycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNyk7CiAgICAgICAgICAgIHZhciBiYXIgPSBkZXRhaWxzLmJhckVsID0gbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgIGlkOiBybmRJZCwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgdG9wOiAnLTFweCAhaW1wb3J0YW50JywKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICd0YWJsZSAhaW1wb3J0YW50JywKICAgICAgICAgICAgICAgIG9wYWNpdHk6ICcxICFpbXBvcnRhbnQnLAogICAgICAgICAgICAgICAgekluZGV4OiA5OTk5OTk5OSwKICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBhcHBlbmQ6IChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBibG9ja0xpc3QgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBibG9ja3MpIHsKICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrID0gYmxvY2tzW2tleV07CiAgICAgICAgICAgICAgICAgIGlmIChibG9jay5sZWZ0Rml4ZWQpIHsKICAgICAgICAgICAgICAgICAgICBsZWZ0Rml4ZWRCbG9ja3MucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChibG9jay5yaWdodEZpeGVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmlnaHRGaXhlZEJsb2Nrcy5wdXNoKGtleSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgYmxvY2tMaXN0LnB1c2goYmxvY2subm9kZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYmxvY2tMaXN0OwogICAgICAgICAgICAgIH0pKCksCiAgICAgICAgICAgICAgb246IFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgIHZpZXdMaW5rLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdjbGljaycpKTsKICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBjdXJyZW50Rm9udFNpemVPYmogPSB7fTsKICAgICAgICAgICAgaWYgKGlzQ2FsZW5kYXIpIHsKICAgICAgICAgICAgICBkZXRhaWxzLm9uQmxvY2tzUmVzaXplID0gZnVuY3Rpb24od2lkdGgsIGxlZnRCbG9ja3NTaXplLCByaWdodEJsb2NrU2l6ZSkgewogICAgICAgICAgICAgICAgdmFyIHR5cGUgPSAnY2FsZW5kYXJDYW50ZXJCbG9jayc7CiAgICAgICAgICAgICAgICB2YXIgYmxvY2tXaWR0aCA9IHBhcnNlSW50KHdpZHRoIC0gbGVmdEJsb2Nrc1NpemUgLSByaWdodEJsb2NrU2l6ZSk7CgogICAgICAgICAgICAgICAgdmFyIG5lZWRSZXNpemUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRGb250U2l6ZSA9IGN1cnJlbnRGb250U2l6ZU9ialt0eXBlXTsKICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGb250U2l6ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1dpZHRoID49IGN1cnJlbnRGb250U2l6ZS5taW5XaWR0aCAmJiBibG9ja1dpZHRoIDwgY3VycmVudEZvbnRTaXplLm1heFdpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBuZWVkUmVzaXplID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IGJsb2Nrc1t0eXBlXS53aWR0aExpc3Quc29tZShmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrV2lkdGggPj0gaXRlbS5taW5XaWR0aCAmJiBibG9ja1dpZHRoIDwgaXRlbS5tYXhXaWR0aCkgewogICAgICAgICAgICAgICAgICAgICAgY3VycmVudEZvbnRTaXplT2JqW3R5cGVdID0gaXRlbTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEZvbnRTaXplT2JqW3R5cGVdID0gYmxvY2tzW3R5cGVdLndpZHRoTGlzdC5zbGljZSgtMSlbMF07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKCk7CgogICAgICAgICAgICAgICAgaWYgKG5lZWRSZXNpemUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGZvbnRTaXplID0gY3VycmVudEZvbnRTaXplT2JqW3R5cGVdLmZvbnRTaXplOwogICAgICAgICAgICAgICAgICBibG9ja3NbdHlwZV0ubm9kZS5zdHlsZS5mb250U2l6ZSA9IGZvbnRTaXplICsgJ3B4JzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBibG9ja3NbdHlwZV0ubm9kZS5zdHlsZS53aWR0aCA9IGJsb2NrV2lkdGggKyAncHgnOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZGV0YWlscy5vbkJsb2Nrc1Jlc2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLCBsZWZ0QmxvY2tzU2l6ZSwgcmlnaHRCbG9ja1NpemUpIHsKICAgICAgICAgICAgICAgIHZhciBhcnJvd0Jsb2NrV2lkdGggPSB3aWR0aCAvIDIgLSBibG9ja3MuYXJyb3dCbG9jay53aWR0aCAvIDI7CgogICAgICAgICAgICAgICAgdmFyIGJsb2NrV2lkdGhPYmogPSB7CiAgICAgICAgICAgICAgICAgIHBvaW50QUJsb2NrOiBwYXJzZUludChhcnJvd0Jsb2NrV2lkdGggLSBsZWZ0QmxvY2tzU2l6ZSksCiAgICAgICAgICAgICAgICAgIHBvaW50QkJsb2NrOiBwYXJzZUludChhcnJvd0Jsb2NrV2lkdGggLSByaWdodEJsb2NrU2l6ZSkKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdmFyIG5lZWRSZXNpemUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIFsncG9pbnRBQmxvY2snLCAncG9pbnRCQmxvY2snXS5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGJsb2NrV2lkdGggPSBibG9ja1dpZHRoT2JqW3R5cGVdOwoKICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRGb250U2l6ZSA9IGN1cnJlbnRGb250U2l6ZU9ialt0eXBlXTsKICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGb250U2l6ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChibG9ja1dpZHRoID49IGN1cnJlbnRGb250U2l6ZS5taW5XaWR0aCAmJiBibG9ja1dpZHRoIDwgY3VycmVudEZvbnRTaXplLm1heFdpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBuZWVkUmVzaXplID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IGJsb2Nrc1t0eXBlXS53aWR0aExpc3Quc29tZShmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrV2lkdGggPj0gaXRlbS5taW5XaWR0aCAmJiBibG9ja1dpZHRoIDwgaXRlbS5tYXhXaWR0aCkgewogICAgICAgICAgICAgICAgICAgICAgY3VycmVudEZvbnRTaXplT2JqW3R5cGVdID0gaXRlbTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEZvbnRTaXplT2JqW3R5cGVdID0gYmxvY2tzW3R5cGVdLndpZHRoTGlzdC5zbGljZSgtMSlbMF07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChuZWVkUmVzaXplKSB7CiAgICAgICAgICAgICAgICAgIHZhciBmb250U2l6ZSA9IE1hdGgubWluKGN1cnJlbnRGb250U2l6ZU9iai5wb2ludEFCbG9jay5mb250U2l6ZSwgY3VycmVudEZvbnRTaXplT2JqLnBvaW50QkJsb2NrLmZvbnRTaXplKTsKICAgICAgICAgICAgICAgICAgYmxvY2tzLnBvaW50QUJsb2NrLm5vZGUuc3R5bGUuZm9udFNpemUgPSBmb250U2l6ZSArICdweCc7CiAgICAgICAgICAgICAgICAgIGJsb2Nrcy5wb2ludEJCbG9jay5ub2RlLnN0eWxlLmZvbnRTaXplID0gZm9udFNpemUgKyAncHgnOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJsb2Nrcy5wb2ludEFCbG9jay5ub2RlLnN0eWxlLndpZHRoID0gYmxvY2tXaWR0aE9iai5wb2ludEFCbG9jayArICdweCc7CiAgICAgICAgICAgICAgICBibG9ja3MucG9pbnRCQmxvY2subm9kZS5zdHlsZS53aWR0aCA9IGJsb2NrV2lkdGhPYmoucG9pbnRCQmxvY2sgKyAncHgnOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBiYXJIZWlnaHQgPSA0NjsKICAgICAgICAgICAgcmV0dXJuIG1haW4uYmFyLmNhbGNCbG9ja1NpemUoYmxvY2tzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgc3R5bGUgPSBkZXRhaWxzLnN0eWxlRWwgPSBtYWluLmJhci5nZXRTdHlsZSh7CiAgICAgICAgICAgICAgICBybmRJZDogcm5kSWQsCiAgICAgICAgICAgICAgICBiYXJIZWlnaHQ6IGJhckhlaWdodAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB2YXIgbGVmdEJsb2Nrc1NpemUgPSAwOwogICAgICAgICAgICAgIGxlZnRGaXhlZEJsb2Nrcy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgbGVmdEJsb2Nrc1NpemUgKz0gYmxvY2tzW2tleV0ud2lkdGg7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHZhciByaWdodEJsb2NrU2l6ZSA9IDA7CiAgICAgICAgICAgICAgcmlnaHRGaXhlZEJsb2Nrcy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgcmlnaHRCbG9ja1NpemUgKz0gYmxvY2tzW2tleV0ud2lkdGg7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHZhciBsYXN0QmFyV2lkdGggPSAwOwogICAgICAgICAgICAgIHZhciBjdXJyZW50V2lkdGhGaXggPSAwOwogICAgICAgICAgICAgIHZhciBiYXJNYXhXaWR0aCA9IDEyMDA7CgogICAgICAgICAgICAgIHZhciB1cGRhdGVCYXJXaWR0aCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoOwoKICAgICAgICAgICAgICAgIHZhciBzaXplRml4ID0gd2lkdGggLSBiYXJNYXhXaWR0aDsKICAgICAgICAgICAgICAgIGlmIChzaXplRml4ID4gMCkgewogICAgICAgICAgICAgICAgICB3aWR0aCA9IGJhck1heFdpZHRoOwoKICAgICAgICAgICAgICAgICAgdmFyIGZpeFdpZHRoID0gTWF0aC5mbG9vcihzaXplRml4IC8gMik7CiAgICAgICAgICAgICAgICAgIGlmIChmaXhXaWR0aCAhPT0gY3VycmVudFdpZHRoRml4KSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFdpZHRoRml4ID0gZml4V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgYmxvY2tzLmxlZnRSZXNpemVCbG9jay5ub2RlLnN0eWxlLndpZHRoID0gZml4V2lkdGggKyAncHgnOwogICAgICAgICAgICAgICAgICAgIGJsb2Nrcy5yaWdodFJlc2l6ZUJsb2NrLm5vZGUuc3R5bGUud2lkdGggPSBmaXhXaWR0aCArICdweCc7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFdpZHRoRml4ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRXaWR0aEZpeCA9IDA7CiAgICAgICAgICAgICAgICAgIGJsb2Nrcy5sZWZ0UmVzaXplQmxvY2subm9kZS5zdHlsZS53aWR0aCA9IDA7CiAgICAgICAgICAgICAgICAgIGJsb2Nrcy5yaWdodFJlc2l6ZUJsb2NrLm5vZGUuc3R5bGUud2lkdGggPSAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChsYXN0QmFyV2lkdGggPT09IHdpZHRoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxhc3RCYXJXaWR0aCA9IHdpZHRoOwoKICAgICAgICAgICAgICAgIHJldHVybiBkZXRhaWxzLm9uQmxvY2tzUmVzaXplKHdpZHRoLCBsZWZ0QmxvY2tzU2l6ZSwgcmlnaHRCbG9ja1NpemUpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGRldGFpbHMub25SZXNpemUgPSB1cGRhdGVCYXJXaWR0aDsKICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGV0YWlscy5vblJlc2l6ZSk7CgogICAgICAgICAgICAgIGlmIChvbGRCYXIpIHsKICAgICAgICAgICAgICAgIG9sZEJhci5yZXBsYWNlKGRldGFpbHMpOwogICAgICAgICAgICAgICAgdXBkYXRlQmFyV2lkdGgoKTsKCiAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgIGVjOiAnY2hlYXBmbGlnaHQnLAogICAgICAgICAgICAgICAgICBlYTogJ3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICghaXNDYWxlbmRhcikgewogICAgICAgICAgICAgICAgICB0cmFja0J5VmVuZG9yKHsKICAgICAgICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0JywKICAgICAgICAgICAgICAgICAgICBlYTogJ3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgIGNkOiAnZmxpZ2h0X2JldHRlcnByaWNlX3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgdDogJ3NjcmVlbnZpZXcnCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgIGNkOiAnZmxpZ2h0X2NhbGVuZGFyX3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgdDogJ3NjcmVlbnZpZXcnCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYWluLmJhci5ybmRDbGFzc05hbWUoYmFyLCBzdHlsZSk7CiAgICAgICAgICAgICAgICB2YXIgY3RyID0gbW9ub1V0aWxzLmNyZWF0ZShkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksIHsKICAgICAgICAgICAgICAgICAgYXBwZW5kOiBbYmFyLCBzdHlsZV0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY3RyKTsKCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB1cGRhdGVCYXJXaWR0aCgpOwogICAgICAgICAgICAgICAgICBtYWluLmJhci5tYXJnaW5QYWdlKGRldGFpbHMsIGJhckhlaWdodCk7CiAgICAgICAgICAgICAgICB9LCAwKTsKCiAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgIGNkOiAnZmxpZ2h0c2hvdycsCiAgICAgICAgICAgICAgICAgIHQ6ICdzY3JlZW52aWV3JwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICBlYzogJ2NoZWFwZmxpZ2h0JywKICAgICAgICAgICAgICAgICAgZWE6ICdzaG93JywKICAgICAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRzaG93JywKICAgICAgICAgICAgICAgICAgdDogJ2V2ZW50JwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKCFpc0NhbGVuZGFyKSB7CiAgICAgICAgICAgICAgICAgIHRyYWNrQnlWZW5kb3IoewogICAgICAgICAgICAgICAgICAgIGVjOiAnY2hlYXBmbGlnaHQnLAogICAgICAgICAgICAgICAgICAgIGVhOiAnc2hvdycsCiAgICAgICAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgICBjZDogJ2ZsaWdodHNob3cnLAogICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgICAgY2Q6ICdmbGlnaHRfYmV0dGVycHJpY2Vfc2hvdycsCiAgICAgICAgICAgICAgICAgICAgdDogJ3NjcmVlbnZpZXcnCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgIGNkOiAnZmxpZ2h0X2NhbGVuZGFyX3Nob3cnLAogICAgICAgICAgICAgICAgICAgIHQ6ICdzY3JlZW52aWV3JwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChpc0NhbGVuZGFyKSB7CiAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgIGVjOiAnY2hlYXBmbGlnaHQnLAogICAgICAgICAgICAgICAgICBlYTogJ2NhbGVuZGFyUHJpY2UnLAogICAgICAgICAgICAgICAgICBlbDogdGJyLmhvc3RuYW1lLAogICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGhvdGVsQmFyQ3JlYXRlOiBmdW5jdGlvbihkZXRhaWxzLCBvbGRCYXIpIHsKICAgICAgICAgICAgdmFyIHBhZ2VJbmZvID0gZGV0YWlscy5wYWdlSW5mbzsKCiAgICAgICAgICAgIHZhciBtYWluSXRlbSA9IG1haW4uYmFyLnByZXBhcmVIb3RlbEl0ZW0ocGFnZUluZm8sIG1haW4uYmFyLmdldEhvdGVsQmFySXRlbShkZXRhaWxzKSk7CiAgICAgICAgICAgIHZhciBpc1N1Z2dlc3QgPSAhIW1haW5JdGVtLmlzU3VnZ2VzdDsKCiAgICAgICAgICAgIHZhciBwcmljZU9iaiA9IG1haW4uZ2V0UHJpY2UobWFpbkl0ZW0uY3VycmVuY3ksIG1haW5JdGVtLnZhbHVlKTsKCiAgICAgICAgICAgIHZhciBzdHJpbmdzID0gewogICAgICAgICAgICAgIGZvdW5kSG90ZWw6IHRici5sYW5ndWFnZS5mb3VuZEhvdGVsICsgU3RyaW5nLmZyb21DaGFyQ29kZSgxNjApLAogICAgICAgICAgICAgIGFyb3VuZEhvdGVsOiB0YnIubGFuZ3VhZ2UuYXJvdW5kSG90ZWwgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKDE2MCksCiAgICAgICAgICAgICAgbmFtZTogbWFpbkl0ZW0ubmFtZSwKICAgICAgICAgICAgICBjaGVja0luOiB0YnIubGFuZ3VhZ2UuY2hlY2tJbiArIFN0cmluZy5mcm9tQ2hhckNvZGUoMTYwKSwKICAgICAgICAgICAgICBjaGVja091dDogdGJyLmxhbmd1YWdlLmNoZWNrT3V0ICsgU3RyaW5nLmZyb21DaGFyQ29kZSgxNjApLAogICAgICAgICAgICAgIGRhdGVJbjogbWFpbi5nZXREYXRlKG1haW5JdGVtLmRhdGVJbiksCiAgICAgICAgICAgICAgZGF0ZU91dDogbWFpbi5nZXREYXRlKG1haW5JdGVtLmRhdGVPdXQpLAogICAgICAgICAgICAgIHByaWNlOiBwcmljZU9iai5zdHJpbmcKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBibG9ja3MgPSB7fTsKICAgICAgICAgICAgYmxvY2tzLmNsb3NlQmxvY2sgPSB7CiAgICAgICAgICAgICAgbm9kZTogbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCcsICdzZi1jZW50ZXInXSwKICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgIGN1cnNvcjogJ2RlZmF1bHQnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgY2xvc2VCdG46IG1vbm9VdGlscy5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICAgICAgICBjbGFzczogJ3NmLWNsb3NlLWJ0bicsCiAgICAgICAgICAgICAgICBocmVmOiAnI2Nsb3NlJywKICAgICAgICAgICAgICAgIHRpdGxlOiB0YnIubGFuZ3VhZ2UuY2xvc2UsCiAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgbWFpbi5iYXIuZ2V0Q2xvc2VCdG4oKQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgICAgICAgICBkZXRhaWxzLmNsb3NlKDEpOwoKICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgIGVjOiAnaG90ZWwnLAogICAgICAgICAgICAgICAgICAgIGVhOiAnY2xvc2UnLAogICAgICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgICAgdDogJ2V2ZW50JwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgd2lkdGg6IDM2LAogICAgICAgICAgICAgIGxlZnRGaXhlZDogMQogICAgICAgICAgICB9OwogICAgICAgICAgICBibG9ja3MuY2xvc2VCbG9jay5ub2RlLmFwcGVuZENoaWxkKGJsb2Nrcy5jbG9zZUJsb2NrLmNsb3NlQnRuKTsKCiAgICAgICAgICAgIGJsb2Nrcy5sZWZ0UmVzaXplQmxvY2sgPSB7CiAgICAgICAgICAgICAgbm9kZTogbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCddCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgd2lkdGg6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmIChpc1N1Z2dlc3QpIHsKICAgICAgICAgICAgICBibG9ja3MuZGF0ZUZvdW5kQmxvY2sgPSB7CiAgICAgICAgICAgICAgICBub2RlOiBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLWNlbGwnLCAnc2YtbGFiZWwnLCAnc2YtcmlnaHQnXSwKICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5ncy5hcm91bmRIb3RlbAogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB3aWR0aDogewogICAgICAgICAgICAgICAgICBzdHJpbmdzOiBbCiAgICAgICAgICAgICAgICAgICAgc3RyaW5ncy5hcm91bmRIb3RlbAogICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IDE5MAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxlZnRGaXhlZDogMQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYmxvY2tzLmRhdGVGb3VuZEJsb2NrID0gewogICAgICAgICAgICAgICAgbm9kZTogbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1jZWxsJywgJ3NmLWxhYmVsJywgJ3NmLXJpZ2h0J10sCiAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ3MuZm91bmRIb3RlbAogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICB3aWR0aDogewogICAgICAgICAgICAgICAgICBzdHJpbmdzOiBbCiAgICAgICAgICAgICAgICAgICAgc3RyaW5ncy5mb3VuZEhvdGVsCiAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxNCwKICAgICAgICAgICAgICAgICAgZGVmYXVsdDogMTYwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGVmdEZpeGVkOiAxCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYmxvY2tzLnBvaW50QUJsb2NrID0gewogICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLWNlbGwnLCAnc2YtcG9pbnQnXSwKICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtcGxhY2UnXSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmdzLm5hbWUKICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICB3aWR0aDogewogICAgICAgICAgICAgICAgc3RyaW5nczogWwogICAgICAgICAgICAgICAgICBzdHJpbmdzLm5hbWUKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBmb250U2l6ZTogWzI2LCAyMiwgMThdCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgYmxvY2tzLmRhdGVMYWJlc0Jsb2NrID0gewogICAgICAgICAgICAgIG5vZGU6IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLWNlbGwnXSwKICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtcmlnaHQnXSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBzdHJpbmdzLmNoZWNrSW4KICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgIG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgICAgICBjbGFzczogWydzZi1yaWdodCddLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ3MuY2hlY2tPdXQKICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICB3aWR0aDogewogICAgICAgICAgICAgICAgc3RyaW5nczogWwogICAgICAgICAgICAgICAgICBzdHJpbmdzLmNoZWNrSW4sCiAgICAgICAgICAgICAgICAgIHN0cmluZ3MuY2hlY2tPdXQKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBmb250U2l6ZTogMTQsCiAgICAgICAgICAgICAgICBkZWZhdWx0OiA5NQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcmlnaHRGaXhlZDogMQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgYmxvY2tzLmRhdGVCbG9jayA9IHsKICAgICAgICAgICAgICBub2RlOiBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICBjbGFzczogWydzZi1jZWxsJ10sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgICAgIGNsYXNzOiBbJ3NmLW5vd3JhcCddLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IHN0cmluZ3MuZGF0ZUluCiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IFsnc2Ytbm93cmFwJ10sCiAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5ncy5kYXRlT3V0CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgd2lkdGg6IHsKICAgICAgICAgICAgICAgIHN0cmluZ3M6IFsKICAgICAgICAgICAgICAgICAgc3RyaW5ncy5kYXRlSW4sCiAgICAgICAgICAgICAgICAgIHN0cmluZ3MuZGF0ZU91dAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxNCwKICAgICAgICAgICAgICAgIGRlZmF1bHQ6IDEwMAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcmlnaHRGaXhlZDogMQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgYmxvY2tzLnByaWNlQmxvY2sgPSB7CiAgICAgICAgICAgICAgbm9kZTogbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCcsICdzZi1wcmljZScsICdzZi1jZW50ZXInLCAnc2Ytbm93cmFwJ10sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IG1haW4uZ2V0UHJpY2VOb2RlKHByaWNlT2JqKQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIHdpZHRoOiB7CiAgICAgICAgICAgICAgICBzdHJpbmdzOiBbCiAgICAgICAgICAgICAgICAgIHN0cmluZ3MucHJpY2UKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBmb250U2l6ZTogMjYsCiAgICAgICAgICAgICAgICBmb250U3R5bGU6IHsKICAgICAgICAgICAgICAgICAgZm9udFdlaWdodDogJ2JvbGQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcGx1czogMzAsCiAgICAgICAgICAgICAgICBkZWZhdWx0OiAxMjAKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHJpZ2h0Rml4ZWQ6IDEKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciB2aWV3TGluayA9IG51bGw7CiAgICAgICAgICAgIGJsb2Nrcy52aWV3QmxvY2sgPSB7CiAgICAgICAgICAgICAgbm9kZTogbW9ub1V0aWxzLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgICAgY2xhc3M6IFsnc2YtY2VsbCcsICdzZi1jZW50ZXInXSwKICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICB2aWV3TGluayA9IG1vbm9VdGlscy5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZi12aWV3LWJ0bicsCiAgICAgICAgICAgICAgICAgICAgaHJlZjogbWFpbkl0ZW0ubGluaywKICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6ICdfYmxhbmsnLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IHRici5sYW5ndWFnZS52aWV3LAogICAgICAgICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNkOiAnaG90ZWxjbGljaycsCiAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdzY3JlZW52aWV3JwogICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgICAgICBlYzogJ2hvdGVsJywKICAgICAgICAgICAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGNkOiAnaG90ZWxjbGljaycsCiAgICAgICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1N1Z2dlc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNkOiAnaG90ZWxOZWFyYnlDbGljaycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdDogJ3NjcmVlbnZpZXcnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgICAgICAgIGVjOiAnaG90ZWwnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVhOiAnbmVhcmJ5Q2xpY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2Q6ICdob3RlbE5lYXJieUNsaWNrJywKICAgICAgICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgd2lkdGg6IDEzMCwKICAgICAgICAgICAgICByaWdodEZpeGVkOiAxCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBibG9ja3MucmlnaHRSZXNpemVCbG9jayA9IHsKICAgICAgICAgICAgICBub2RlOiBtb25vVXRpbHMuY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICAgICAgICBjbGFzczogWydzZi1jZWxsJ10KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICB3aWR0aDogMAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIGxlZnRGaXhlZEJsb2NrcyA9IFtdOwogICAgICAgICAgICB2YXIgcmlnaHRGaXhlZEJsb2NrcyA9IFtdOwoKICAgICAgICAgICAgdmFyIHJuZElkID0gJ3MnICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpOwogICAgICAgICAgICB2YXIgYmFyID0gZGV0YWlscy5iYXJFbCA9IG1vbm9VdGlscy5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICBpZDogcm5kSWQsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIHRvcDogJy0xcHggIWltcG9ydGFudCcsCiAgICAgICAgICAgICAgICBkaXNwbGF5OiAndGFibGUgIWltcG9ydGFudCcsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAnMSAhaW1wb3J0YW50JywKICAgICAgICAgICAgICAgIHpJbmRleDogOTk5OTk5OTksCiAgICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYXBwZW5kOiAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgYmxvY2tMaXN0ID0gW107CiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYmxvY2tzKSB7CiAgICAgICAgICAgICAgICAgIHZhciBibG9jayA9IGJsb2Nrc1trZXldOwogICAgICAgICAgICAgICAgICBpZiAoYmxvY2subGVmdEZpeGVkKSB7CiAgICAgICAgICAgICAgICAgICAgbGVmdEZpeGVkQmxvY2tzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoYmxvY2sucmlnaHRGaXhlZCkgewogICAgICAgICAgICAgICAgICAgIHJpZ2h0Rml4ZWRCbG9ja3MucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGJsb2NrTGlzdC5wdXNoKGJsb2NrLm5vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGJsb2NrTGlzdDsKICAgICAgICAgICAgICB9KSgpLAogICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICB2aWV3TGluay5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnY2xpY2snKSk7CiAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgY3VycmVudEZvbnRTaXplT2JqID0ge307CiAgICAgICAgICAgIGRldGFpbHMub25CbG9ja3NSZXNpemUgPSBmdW5jdGlvbih3aWR0aCwgbGVmdEJsb2Nrc1NpemUsIHJpZ2h0QmxvY2tTaXplKSB7CiAgICAgICAgICAgICAgdmFyIHR5cGUgPSAncG9pbnRBQmxvY2snOwogICAgICAgICAgICAgIHZhciBibG9ja1dpZHRoID0gcGFyc2VJbnQod2lkdGggLSBsZWZ0QmxvY2tzU2l6ZSAtIHJpZ2h0QmxvY2tTaXplKTsKCiAgICAgICAgICAgICAgdmFyIG5lZWRSZXNpemUgPSBmYWxzZTsKICAgICAgICAgICAgICAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgY3VycmVudEZvbnRTaXplID0gY3VycmVudEZvbnRTaXplT2JqW3R5cGVdOwogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGb250U2l6ZSkgewogICAgICAgICAgICAgICAgICBpZiAoYmxvY2tXaWR0aCA+PSBjdXJyZW50Rm9udFNpemUubWluV2lkdGggJiYgYmxvY2tXaWR0aCA8IGN1cnJlbnRGb250U2l6ZS5tYXhXaWR0aCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG5lZWRSZXNpemUgPSB0cnVlOwoKICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IGJsb2Nrc1t0eXBlXS53aWR0aExpc3Quc29tZShmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICAgIGlmIChibG9ja1dpZHRoID49IGl0ZW0ubWluV2lkdGggJiYgYmxvY2tXaWR0aCA8IGl0ZW0ubWF4V2lkdGgpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50Rm9udFNpemVPYmpbdHlwZV0gPSBpdGVtOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRGb250U2l6ZU9ialt0eXBlXSA9IGJsb2Nrc1t0eXBlXS53aWR0aExpc3Quc2xpY2UoLTEpWzBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pKCk7CgogICAgICAgICAgICAgIGlmIChuZWVkUmVzaXplKSB7CiAgICAgICAgICAgICAgICB2YXIgZm9udFNpemUgPSBjdXJyZW50Rm9udFNpemVPYmpbdHlwZV0uZm9udFNpemU7CiAgICAgICAgICAgICAgICBibG9ja3NbdHlwZV0ubm9kZS5zdHlsZS5mb250U2l6ZSA9IGZvbnRTaXplICsgJ3B4JzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJsb2Nrc1t0eXBlXS5ub2RlLnN0eWxlLndpZHRoID0gYmxvY2tXaWR0aCArICdweCc7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgYmFySGVpZ2h0ID0gNDY7CiAgICAgICAgICAgIG1haW4uYmFyLmNhbGNCbG9ja1NpemUoYmxvY2tzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgc3R5bGUgPSBkZXRhaWxzLnN0eWxlRWwgPSBtYWluLmJhci5nZXRTdHlsZSh7CiAgICAgICAgICAgICAgICBybmRJZDogcm5kSWQsCiAgICAgICAgICAgICAgICBiYXJIZWlnaHQ6IGJhckhlaWdodAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB2YXIgbGVmdEJsb2Nrc1NpemUgPSAwOwogICAgICAgICAgICAgIGxlZnRGaXhlZEJsb2Nrcy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgbGVmdEJsb2Nrc1NpemUgKz0gYmxvY2tzW2tleV0ud2lkdGg7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHZhciByaWdodEJsb2NrU2l6ZSA9IDA7CiAgICAgICAgICAgICAgcmlnaHRGaXhlZEJsb2Nrcy5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgcmlnaHRCbG9ja1NpemUgKz0gYmxvY2tzW2tleV0ud2lkdGg7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHZhciBsYXN0QmFyV2lkdGggPSAwOwogICAgICAgICAgICAgIHZhciBjdXJyZW50V2lkdGhGaXggPSAwOwogICAgICAgICAgICAgIHZhciBiYXJNYXhXaWR0aCA9IDEyMDA7CgogICAgICAgICAgICAgIHZhciB1cGRhdGVCYXJXaWR0aCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoOwoKICAgICAgICAgICAgICAgIHZhciBzaXplRml4ID0gd2lkdGggLSBiYXJNYXhXaWR0aDsKICAgICAgICAgICAgICAgIGlmIChzaXplRml4ID4gMCkgewogICAgICAgICAgICAgICAgICB3aWR0aCA9IGJhck1heFdpZHRoOwoKICAgICAgICAgICAgICAgICAgdmFyIGZpeFdpZHRoID0gTWF0aC5mbG9vcihzaXplRml4IC8gMik7CiAgICAgICAgICAgICAgICAgIGlmIChmaXhXaWR0aCAhPT0gY3VycmVudFdpZHRoRml4KSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFdpZHRoRml4ID0gZml4V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgYmxvY2tzLmxlZnRSZXNpemVCbG9jay5ub2RlLnN0eWxlLndpZHRoID0gZml4V2lkdGggKyAncHgnOwogICAgICAgICAgICAgICAgICAgIGJsb2Nrcy5yaWdodFJlc2l6ZUJsb2NrLm5vZGUuc3R5bGUud2lkdGggPSBmaXhXaWR0aCArICdweCc7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFdpZHRoRml4ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRXaWR0aEZpeCA9IDA7CiAgICAgICAgICAgICAgICAgIGJsb2Nrcy5sZWZ0UmVzaXplQmxvY2subm9kZS5zdHlsZS53aWR0aCA9IDA7CiAgICAgICAgICAgICAgICAgIGJsb2Nrcy5yaWdodFJlc2l6ZUJsb2NrLm5vZGUuc3R5bGUud2lkdGggPSAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChsYXN0QmFyV2lkdGggPT09IHdpZHRoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxhc3RCYXJXaWR0aCA9IHdpZHRoOwoKICAgICAgICAgICAgICAgIHJldHVybiBkZXRhaWxzLm9uQmxvY2tzUmVzaXplKHdpZHRoLCBsZWZ0QmxvY2tzU2l6ZSwgcmlnaHRCbG9ja1NpemUpOwogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGRldGFpbHMub25SZXNpemUgPSB1cGRhdGVCYXJXaWR0aDsKICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGV0YWlscy5vblJlc2l6ZSk7CgogICAgICAgICAgICAgIGlmIChvbGRCYXIpIHsKICAgICAgICAgICAgICAgIG9sZEJhci5yZXBsYWNlKGRldGFpbHMpOwogICAgICAgICAgICAgICAgdXBkYXRlQmFyV2lkdGgoKTsKCiAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgIGVjOiAnaG90ZWwnLAogICAgICAgICAgICAgICAgICBlYTogJ3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgIGVsOiB0YnIuaG9zdG5hbWUsCiAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChpc1N1Z2dlc3QpIHsKICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgIGNkOiAnaG90ZWxOZWFyYnlVcGRhdGUnLAogICAgICAgICAgICAgICAgICAgIHQ6ICdzY3JlZW52aWV3JwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIHRici5lbWl0KCd0cmFjaycsIHsKICAgICAgICAgICAgICAgICAgICBlYzogJ2hvdGVsJywKICAgICAgICAgICAgICAgICAgICBlYTogJ25lYXJieVVwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgZWw6IHRici5ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgICBjZDogJ2hvdGVsTmVhcmJ5VXBkYXRlJywKICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYWluLmJhci5ybmRDbGFzc05hbWUoYmFyLCBzdHlsZSk7CiAgICAgICAgICAgICAgICB2YXIgY3RyID0gbW9ub1V0aWxzLmNyZWF0ZShkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksIHsKICAgICAgICAgICAgICAgICAgYXBwZW5kOiBbYmFyLCBzdHlsZV0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY3RyKTsKCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB1cGRhdGVCYXJXaWR0aCgpOwogICAgICAgICAgICAgICAgICBtYWluLmJhci5tYXJnaW5QYWdlKGRldGFpbHMsIGJhckhlaWdodCk7CiAgICAgICAgICAgICAgICB9LCAwKTsKCiAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgIGNkOiAnaG90ZWxzaG93JywKICAgICAgICAgICAgICAgICAgdDogJ3NjcmVlbnZpZXcnCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgIGVjOiAnaG90ZWwnLAogICAgICAgICAgICAgICAgICBlYTogJ3Nob3cnLAogICAgICAgICAgICAgICAgICBlbDogdGJyLmhvc3RuYW1lLAogICAgICAgICAgICAgICAgICBjZDogJ2hvdGVsc2hvdycsCiAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChpc1N1Z2dlc3QpIHsKICAgICAgICAgICAgICAgICAgdGJyLmVtaXQoJ3RyYWNrJywgewogICAgICAgICAgICAgICAgICAgIGNkOiAnaG90ZWxOZWFyYnlTaG93JywKICAgICAgICAgICAgICAgICAgICB0OiAnc2NyZWVudmlldycKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICB0YnIuZW1pdCgndHJhY2snLCB7CiAgICAgICAgICAgICAgICAgICAgZWM6ICdob3RlbCcsCiAgICAgICAgICAgICAgICAgICAgZWE6ICduZWFyYnlTaG93JywKICAgICAgICAgICAgICAgICAgICBlbDogdGJyLmhvc3RuYW1lLAogICAgICAgICAgICAgICAgICAgIGNkOiAnaG90ZWxOZWFyYnlTaG93JywKICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbihkZXRhaWxzKSB7CiAgICAgICAgICAgIHZhciBvbGRCYXIgPSBtYWluLmJhci5jdXJyZW50OwogICAgICAgICAgICBpZiAob2xkQmFyICYmIG9sZEJhci5pc0Nsb3NlZCkgewogICAgICAgICAgICAgIG9sZEJhciA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1haW4uYmFyLmN1cnJlbnQgPSBkZXRhaWxzOwoKICAgICAgICAgICAgZGV0YWlscy5pc0Nsb3NlZCA9IGZhbHNlOwogICAgICAgICAgICBkZXRhaWxzLmNsb3NlID0gZnVuY3Rpb24oYnlVc2VyKSB7CiAgICAgICAgICAgICAgaWYgKGRldGFpbHMuaXNDbG9zZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGV0YWlscy5pc0Nsb3NlZCA9IHRydWU7CgogICAgICAgICAgICAgIG1haW4uYmFyLm9uQ2xvc2UoZGV0YWlscywgYnlVc2VyKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGRldGFpbHMucmVwbGFjZSA9IGZ1bmN0aW9uKG5ld0RldGFpbHMpIHsKICAgICAgICAgICAgICBtYWluLmJhci5vblJlcGxhY2UoZGV0YWlscywgbmV3RGV0YWlscyk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoZGV0YWlscy50eXBlID09PSAnaG90ZWwnKSB7CiAgICAgICAgICAgICAgbWFpbi5iYXIuaG90ZWxCYXJDcmVhdGUoZGV0YWlscywgb2xkQmFyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtYWluLmJhci5hdmlhQmFyQ3JlYXRlKGRldGFpbHMsIG9sZEJhcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBybmRDbGFzc05hbWU6IGZ1bmN0aW9uKGJhciwgc3R5bGUpIHsKICAgICAgICAgICAgdmFyIGREYmwgPSB7fTsKICAgICAgICAgICAgdmFyIGdldFJuZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBsaW1pdCA9IDEwOwogICAgICAgICAgICAgIHZhciBybmQgPSBudWxsOwogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIGxpbWl0LS07CiAgICAgICAgICAgICAgICBybmQgPSAncycgKyAoTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpIHx8IERhdGUubm93KCkpOwogICAgICAgICAgICAgIH0gd2hpbGUgKGREYmxbcm5kXSAmJiBsaW1pdCA+IDApOwoKICAgICAgICAgICAgICBkRGJsW3JuZF0gPSAxOwoKICAgICAgICAgICAgICByZXR1cm4gcm5kOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIGNsYXNzTWFwID0ge307CiAgICAgICAgICAgIHZhciBzbGljZSA9IFtdLnNsaWNlOwogICAgICAgICAgICBzbGljZS5jYWxsKGJhci5xdWVyeVNlbGVjdG9yQWxsKCdbY2xhc3NdJykpLmZvckVhY2goZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgIHNsaWNlLmNhbGwobm9kZS5jbGFzc0xpc3QpLmZvckVhY2goZnVuY3Rpb24oY2xhc3NOYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAoIWNsYXNzTWFwW2NsYXNzTmFtZV0pIHsKICAgICAgICAgICAgICAgICAgY2xhc3NNYXBbY2xhc3NOYW1lXSA9IGdldFJuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7CiAgICAgICAgICAgICAgICB2YXIgcm5kID0gY2xhc3NNYXBbY2xhc3NOYW1lXTsKICAgICAgICAgICAgICAgIG5vZGUuY2xhc3NMaXN0LmFkZChybmQpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzdHlsZVRleHQgPSBzdHlsZS50ZXh0Q29udGVudDsKICAgICAgICAgICAgT2JqZWN0LmtleXMoY2xhc3NNYXApLmZvckVhY2goZnVuY3Rpb24ob3JpZ0NsYXNzTmFtZSkgewogICAgICAgICAgICAgIHZhciBuZXdDbGFzc05hbWUgPSBjbGFzc01hcFtvcmlnQ2xhc3NOYW1lXTsKICAgICAgICAgICAgICBzdHlsZVRleHQgPSBzdHlsZVRleHQucmVwbGFjZShuZXcgUmVnRXhwKG9yaWdDbGFzc05hbWUsICdnaScpLCBuZXdDbGFzc05hbWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBzdHlsZVRleHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIG1vbm9VdGlscy5leHRlbmQobWFpbiwgewogICAgICAgIGN1bHR1cmVJbmZvOiB7CiAgICAgICAgICBydTogewogICAgICAgICAgICB3ZWVrZGF5c1Nob3J0OiAn0JLRgV/Qn9C9X9CS0YJf0KHRgF/Qp9GCX9Cf0YJf0KHQsScuc3BsaXQoJ18nKSwKICAgICAgICAgICAgbW9udGhzOiAn0Y/QvdCy0LDRgNGPX9GE0LXQstGA0LDQu9GPX9C80LDRgNGC0LBf0LDQv9GA0LXQu9GPX9C80LDRj1/QuNGO0L3Rj1/QuNGO0LvRj1/QsNCy0LPRg9GB0YLQsF/RgdC10L3RgtGP0LHRgNGPX9C+0LrRgtGP0LHRgNGPX9C90L7Rj9Cx0YDRj1/QtNC10LrQsNCx0YDRjycuc3BsaXQoJ18nKSwKICAgICAgICAgICAgbW9udGhzQ2FsOiAn0Y/QvdCy0LDRgNC1X9GE0LXQstGA0LDQu9C1X9C80LDRgNGC0LVf0LDQv9GA0LXQu9C1X9C80LDQtV/QuNGO0L3QtV/QuNGO0LvQtV/QsNCy0LPRg9GB0YLQtV/RgdC10L3RgtGP0LHRgNC1X9C+0LrRgtGP0LHRgNC1X9C90L7Rj9Cx0YDQtV/QtNC10LrQsNCx0YDQtScuc3BsaXQoJ18nKSwKICAgICAgICAgICAgZGF0ZUZvcm1hdDogJ0QgTU1NTSwgZGRkJywKICAgICAgICAgICAgdGltZUZvcm1hdDogJ0hIOm1tJwogICAgICAgICAgfSwKICAgICAgICAgIGVuOiB7CiAgICAgICAgICAgIHdlZWtkYXlzU2hvcnQ6ICdTdW5fTW9uX1R1ZV9XZWRfVGh1X0ZyaV9TYXQnLnNwbGl0KCdfJyksCiAgICAgICAgICAgIG1vbnRoczogJ0phbnVhcnlfRmVicnVhcnlfTWFyY2hfQXByaWxfTWF5X0p1bmVfSnVseV9BdWd1c3RfU2VwdGVtYmVyX09jdG9iZXJfTm92ZW1iZXJfRGVjZW1iZXInLnNwbGl0KCdfJyksCiAgICAgICAgICAgIGRhdGVGb3JtYXQ6ICdEIE1NTU0sIGRkZCcsCiAgICAgICAgICAgIHRpbWVGb3JtYXQ6ICdoOm1tIEEnCiAgICAgICAgICB9LAogICAgICAgICAgZGU6IHsKICAgICAgICAgICAgd2Vla2RheXNTaG9ydDogJ1NvLl9Nby5fRGkuX01pLl9Eby5fRnIuX1NhLicuc3BsaXQoJ18nKSwKICAgICAgICAgICAgbW9udGhzOiAnSsOkbm5lcl9GZWJydWFyX03DpHJ6X0FwcmlsX01haV9KdW5pX0p1bGlfQXVndXN0X1NlcHRlbWJlcl9Pa3RvYmVyX05vdmVtYmVyX0RlemVtYmVyJy5zcGxpdCgnXycpLAogICAgICAgICAgICBkYXRlRm9ybWF0OiAnZGRkLCBELiBNTU1NJywKICAgICAgICAgICAgdGltZUZvcm1hdDogJ0hIOm1tJwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgY2N5Rm9ybWF0czogewogICAgICAgICAgVVNEOiB7CiAgICAgICAgICAgIHN5bWJvbDogIiQiLAogICAgICAgICAgICBzdGFuZGFyZDogIsKkIywjIzAuMDAiLAogICAgICAgICAgICBkZXRhaWxzOiB7CiAgICAgICAgICAgICAgc3ltYm9sUmlnaHQ6IGZhbHNlLAogICAgICAgICAgICAgIHN5bWJvbFNlcDogJycsCiAgICAgICAgICAgICAgdGhyZWVTZXA6ICcsJywKICAgICAgICAgICAgICB0b0ZpeGVkOiAyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBFVVI6IHsKICAgICAgICAgICAgc3ltYm9sOiAi4oKsIiwKICAgICAgICAgICAgc3RhbmRhcmQ6ICIjLCMjMC4wMMKgwqQiLAogICAgICAgICAgICBkZXRhaWxzOiB7CiAgICAgICAgICAgICAgc3ltYm9sUmlnaHQ6IHRydWUsCiAgICAgICAgICAgICAgc3ltYm9sU2VwOiAnICcsCiAgICAgICAgICAgICAgdGhyZWVTZXA6ICcsJywKICAgICAgICAgICAgICB0b0ZpeGVkOiAyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBSVUI6IHsKICAgICAgICAgICAgc3ltYm9sOiAi4oK9IiwKICAgICAgICAgICAgc3RhbmRhcmQ6ICIjLCMjMC4wMCDCpCIsCiAgICAgICAgICAgIGRldGFpbHM6IHsKICAgICAgICAgICAgICBzeW1ib2xSaWdodDogdHJ1ZSwKICAgICAgICAgICAgICBzeW1ib2xTZXA6ICcgJywKICAgICAgICAgICAgICB0aHJlZVNlcDogJywnLAogICAgICAgICAgICAgIHRvRml4ZWQ6IDIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0Tm9kZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdsaW5rLnNmLXByaWNlLWZvbnQnKTsKICAgICAgICAgICAgICBpZiAoIWxpbmspIHsKICAgICAgICAgICAgICAgIGxpbmsgPSBtb25vVXRpbHMuY3JlYXRlKCdsaW5rJywgewogICAgICAgICAgICAgICAgICBjbGFzczogJ3NmLXByaWNlLWZvbnQnLAogICAgICAgICAgICAgICAgICBocmVmOiAnaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3M/ZmFtaWx5PVBUK1NhbnM6Ym9sZCcsCiAgICAgICAgICAgICAgICAgIHJlbDogJ3N0eWxlc2hlZXQnLAogICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dC9jc3MnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gbW9ub1V0aWxzLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMuc3ltYm9sLAogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgZm9udEZhbWlseTogJyJQVCBTYW5zIiwgQXJpYWwsIHNlcmlmJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgQllSOiB7CiAgICAgICAgICAgIHN5bWJvbDogItGALiIsCiAgICAgICAgICAgIHN0YW5kYXJkOiAiIywjIzAuMDAgwqQiLAogICAgICAgICAgICBkZXRhaWxzOiB7CiAgICAgICAgICAgICAgc3ltYm9sUmlnaHQ6IHRydWUsCiAgICAgICAgICAgICAgc3ltYm9sU2VwOiAnICcsCiAgICAgICAgICAgICAgdGhyZWVTZXA6ICcsJywKICAgICAgICAgICAgICB0b0ZpeGVkOiAyCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBCWU46IHsKICAgICAgICAgICAgc3ltYm9sOiAi0YAuIiwKICAgICAgICAgICAgc3RhbmRhcmQ6ICIjLCMjMC4wMCDCpCIsCiAgICAgICAgICAgIGRldGFpbHM6IHsKICAgICAgICAgICAgICBzeW1ib2xSaWdodDogdHJ1ZSwKICAgICAgICAgICAgICBzeW1ib2xTZXA6ICcgJywKICAgICAgICAgICAgICB0aHJlZVNlcDogJywnLAogICAgICAgICAgICAgIHRvRml4ZWQ6IDIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIEtaVDogewogICAgICAgICAgICBzeW1ib2w6ICJUIiwgLy8i4oK4IiwKICAgICAgICAgICAgc3RhbmRhcmQ6ICIjLCMjMC4wMCDCpCIsCiAgICAgICAgICAgIGRldGFpbHM6IHsKICAgICAgICAgICAgICBzeW1ib2xSaWdodDogdHJ1ZSwKICAgICAgICAgICAgICBzeW1ib2xTZXA6ICcgJywKICAgICAgICAgICAgICB0aHJlZVNlcDogJywnLAogICAgICAgICAgICAgIHRvRml4ZWQ6IDIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIFVBSDogewogICAgICAgICAgICBzeW1ib2w6ICLigrQiLAogICAgICAgICAgICBzdGFuZGFyZDogIiMsIyMwLjAwIMKkIiwKICAgICAgICAgICAgZGV0YWlsczogewogICAgICAgICAgICAgIHN5bWJvbFJpZ2h0OiB0cnVlLAogICAgICAgICAgICAgIHN5bWJvbFNlcDogJyAnLAogICAgICAgICAgICAgIHRocmVlU2VwOiAnLCcsCiAgICAgICAgICAgICAgdG9GaXhlZDogMgogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjb252ZXJ0Q2N5OiBmdW5jdGlvbihwcmljZSwgdG9DY3kpIHsKICAgICAgICAgIHRvQ2N5ID0gdG9DY3kudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIHZhciBjY3lMaXN0ID0gbWFpbi5jYWNoZS5jY3lMaXN0OwogICAgICAgICAgdmFyIHZhbHVlID0gY2N5TGlzdFt0b0NjeV07CiAgICAgICAgICByZXR1cm4gcHJpY2UgLyB2YWx1ZTsKICAgICAgICB9LAogICAgICAgIGdldENpdHlOYW1lOiBmdW5jdGlvbihjaXR5Q29kZSkgewogICAgICAgICAgdmFyIGxhbmcgPSB0YnIubGFuZ3VhZ2UubGFuZzsKICAgICAgICAgIHZhciBjaXR5ID0gbWFpbi5jYWNoZS5jaXR5TWFwW2NpdHlDb2RlXTsKICAgICAgICAgIGlmICghY2l0eSkgewogICAgICAgICAgICB2YXIgYWlycG9ydCA9IG1haW4uY2FjaGUuYWlycG9ydE1hcFtjaXR5Q29kZV07CiAgICAgICAgICAgIGlmIChhaXJwb3J0KSB7CiAgICAgICAgICAgICAgY2l0eUNvZGUgPSBhaXJwb3J0LmNpdHlfY29kZTsKICAgICAgICAgICAgICBjaXR5ID0gbWFpbi5jYWNoZS5jaXR5TWFwW2NpdHlDb2RlXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFjaXR5KSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBsb2NhbE5hbWUgPSBjaXR5Lm5hbWVfdHJhbnNsYXRpb25zICYmIGNpdHkubmFtZV90cmFuc2xhdGlvbnNbbGFuZ107CiAgICAgICAgICByZXR1cm4gbG9jYWxOYW1lIHx8IGNpdHkubmFtZTsKICAgICAgICB9LAogICAgICAgIGdldERhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICB2YXIgdGltZSA9IG5ldyBEYXRlKHZhbHVlKTsKICAgICAgICAgIHZhciBjdWx0dXJlID0gbWFpbi5jdWx0dXJlSW5mb1t0YnIubGFuZ3VhZ2UubGFuZ10gfHwgbWFpbi5jdWx0dXJlSW5mby5lbjsKICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IGN1bHR1cmUuZGF0ZUZvcm1hdDsKICAgICAgICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgvKFthLXpBLVpdKykvZywgZnVuY3Rpb24odGV4dCwgdmFsdWUpIHsKICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgICAgIGNhc2UgJ0QnOgogICAgICAgICAgICAgICAgcmV0dXJuIHRpbWUuZ2V0VVRDRGF0ZSgpOwogICAgICAgICAgICAgIGNhc2UgJ01NTU0nOgogICAgICAgICAgICAgICAgcmV0dXJuIGN1bHR1cmUubW9udGhzW3RpbWUuZ2V0VVRDTW9udGgoKV07CiAgICAgICAgICAgICAgY2FzZSAnZGRkJzoKICAgICAgICAgICAgICAgIHJldHVybiBjdWx0dXJlLndlZWtkYXlzU2hvcnRbdGltZS5nZXRVVENEYXkoKV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHRlbXBsYXRlOwogICAgICAgIH0sCiAgICAgICAgZ2V0Q2FsTW9udGg6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICB2YXIgdGltZSA9IG5ldyBEYXRlKHZhbHVlKTsKICAgICAgICAgIHZhciBjdWx0dXJlID0gbWFpbi5jdWx0dXJlSW5mb1t0YnIubGFuZ3VhZ2UubGFuZ10gfHwgbWFpbi5jdWx0dXJlSW5mby5lbjsKICAgICAgICAgIHJldHVybiAoY3VsdHVyZS5tb250aHNDYWwgfHwgY3VsdHVyZS5tb250aHMpW3RpbWUuZ2V0VVRDTW9udGgoKV07CiAgICAgICAgfSwKICAgICAgICBnZXRQcmljZTogZnVuY3Rpb24oY2N5LCB2YWx1ZSkgewogICAgICAgICAgdmFyIGN1bHR1cmVDY3kgPSBtYWluLmNjeUZvcm1hdHNbY2N5XTsKCiAgICAgICAgICBpZiAoIWN1bHR1cmVDY3kpIHsKICAgICAgICAgICAgY3VsdHVyZUNjeSA9IHsKICAgICAgICAgICAgICBzeW1ib2w6IGNjeSwKICAgICAgICAgICAgICBkZXRhaWxzOiB7CiAgICAgICAgICAgICAgICBzeW1ib2xSaWdodDogdHJ1ZSwKICAgICAgICAgICAgICAgIHN5bWJvbFNlcDogJyAnLAogICAgICAgICAgICAgICAgdGhyZWVTZXA6ICcsJywKICAgICAgICAgICAgICAgIHRvRml4ZWQ6IDIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRldGFpbHMgPSBjdWx0dXJlQ2N5LmRldGFpbHM7CgogICAgICAgICAgdmFsdWUgPSB2YWx1ZS50b0ZpeGVkKGRldGFpbHMudG9GaXhlZCk7CiAgICAgICAgICB2YXIgc3BsaXRWYWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCkuc3BsaXQoJy4nKTsKCiAgICAgICAgICB2YXIgYiA9IHNwbGl0VmFsdWVbMV07CiAgICAgICAgICB2YXIgZml4ZWRWYWx1ZSA9ICcnOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZXRhaWxzLnRvRml4ZWQ7IGkrKykgewogICAgICAgICAgICBmaXhlZFZhbHVlICs9ICcwJzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChiID09PSBmaXhlZFZhbHVlKSB7CiAgICAgICAgICAgIGIgPSAnJzsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgYSA9IHNwbGl0VmFsdWVbMF07CgogICAgICAgICAgYSA9IGEuc3BsaXQoJycpLnJldmVyc2UoKS5qb2luKCcnKTsKICAgICAgICAgIGEgPSBhLnJlcGxhY2UoLyhcZHszfSkvZywgJyQxLCcpOwogICAgICAgICAgYSA9IGEuc3BsaXQoJycpLnJldmVyc2UoKS5qb2luKCcnKTsKICAgICAgICAgIGlmIChhWzBdID09PSAnLCcpIHsKICAgICAgICAgICAgYSA9IGEuc3Vic3RyKDEpOwogICAgICAgICAgfQogICAgICAgICAgYSA9IGEuc3BsaXQoJywnKTsKICAgICAgICAgIGEgPSBhLmpvaW4oZGV0YWlscy50aHJlZVNlcCk7CgogICAgICAgICAgc3BsaXRWYWx1ZSA9IFthXTsKICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgIHNwbGl0VmFsdWUucHVzaChiKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBzdHJWYWx1ZSA9IHNwbGl0VmFsdWUuam9pbignLicpOwoKICAgICAgICAgIHZhciBhcnIgPSBbc3RyVmFsdWVdOwogICAgICAgICAgaWYgKGRldGFpbHMuc3ltYm9sUmlnaHQpIHsKICAgICAgICAgICAgaWYgKGRldGFpbHMuc3ltYm9sU2VwKSB7CiAgICAgICAgICAgICAgYXJyLnB1c2goZGV0YWlscy5zeW1ib2xTZXApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyci5wdXNoKGN1bHR1cmVDY3kuc3ltYm9sKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChkZXRhaWxzLnN5bWJvbFNlcCkgewogICAgICAgICAgICAgIGFyci51bnNoaWZ0KGRldGFpbHMuc3ltYm9sU2VwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhcnIudW5zaGlmdChjdWx0dXJlQ2N5LnN5bWJvbCk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgc3RyVmFsdWVTeW1ib2wgPSBhcnIuam9pbignJyk7CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc3RyaW5nOiBzdHJWYWx1ZVN5bWJvbCwKICAgICAgICAgICAgdmFsdWU6IHN0clZhbHVlLAogICAgICAgICAgICBjdWx0dXJlQ2N5OiBjdWx0dXJlQ2N5CiAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgZ2V0UHJpY2VOb2RlOiBmdW5jdGlvbihwcmljZU9iaikgewogICAgICAgICAgdmFyIGN1bHR1cmVDY3kgPSBwcmljZU9iai5jdWx0dXJlQ2N5OwogICAgICAgICAgdmFyIGRldGFpbHMgPSBjdWx0dXJlQ2N5LmRldGFpbHM7CgogICAgICAgICAgdmFyIGdldFN5bWJvbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoY3VsdHVyZUNjeS5nZXROb2RlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGN1bHR1cmVDY3kuZ2V0Tm9kZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY3VsdHVyZUNjeS5zeW1ib2w7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBhcnIgPSBbcHJpY2VPYmoudmFsdWVdOwogICAgICAgICAgaWYgKGRldGFpbHMuc3ltYm9sUmlnaHQpIHsKICAgICAgICAgICAgaWYgKGRldGFpbHMuc3ltYm9sU2VwKSB7CiAgICAgICAgICAgICAgYXJyLnB1c2goZGV0YWlscy5zeW1ib2xTZXApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyci5wdXNoKGdldFN5bWJvbCgpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChkZXRhaWxzLnN5bWJvbFNlcCkgewogICAgICAgICAgICAgIGFyci51bnNoaWZ0KGRldGFpbHMuc3ltYm9sU2VwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhcnIudW5zaGlmdChnZXRTeW1ib2woKSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1vbm9VdGlscy5jcmVhdGUoZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLCB7CiAgICAgICAgICAgIGFwcGVuZDogYXJyCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGdldEF2aWFCYXJJdGVtSW5kZXg6IGZ1bmN0aW9uKHByaWNlTGlzdCkgewogICAgICAgICAgdmFyIG1pbkRhdGUgPSBudWxsOwogICAgICAgICAgdmFyIG1pbkl0ZW0gPSBudWxsOwoKICAgICAgICAgIHByaWNlTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgdmFyIG0gPSBpdGVtLmRlcGFydF9kYXRlLm1hdGNoKC8oXGR7NH0uXGR7Mn0uXGR7Mn0pLyk7CiAgICAgICAgICAgIG0gPSBtICYmIG1bMV07CiAgICAgICAgICAgIGlmICghbSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgZGF0ZSA9IChuZXcgRGF0ZShtKSkuZ2V0VGltZSgpOwoKICAgICAgICAgICAgaWYgKG1pbkRhdGUgPT09IG51bGwgfHwgbWluRGF0ZSA+IGRhdGUpIHsKICAgICAgICAgICAgICBtaW5EYXRlID0gZGF0ZTsKICAgICAgICAgICAgICBtaW5JdGVtID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRhdGUgIT09IG1pbkRhdGUpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChtaW5JdGVtID09PSBudWxsIHx8IGl0ZW0udmFsdWUgPCBtaW5JdGVtLnZhbHVlKSB7CiAgICAgICAgICAgICAgbWluSXRlbSA9IGl0ZW07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBpbmRleCA9IHByaWNlTGlzdC5pbmRleE9mKG1pbkl0ZW0pOwoKICAgICAgICAgIHRici5sb2coJ0JhciBpdGVtJywgaW5kZXgsIG1pbkl0ZW0pOwogICAgICAgICAgdGJyLmxvZygnUmVzdWx0IHByaWNlcycsIHByaWNlTGlzdCk7CgogICAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb25vVXRpbHMuZXh0ZW5kKG1haW4sIHsKICAgICAgICBwcm9maWxlOiBudWxsLAogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSBwcm9maWxlCiAgICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAgICovCiAgICAgICAgUGFnZTogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgIHZhciB0eXBlID0gbnVsbDsKICAgICAgICAgIHZhciBwYXJhbXMgPSB7fTsKICAgICAgICAgIHZhciBwcmljZU9iaiA9IHt9OwoKICAgICAgICAgIHZhciBnZXRQcmljZU9iaiA9IGZ1bmN0aW9uKHByaWNlSWQpIHsKICAgICAgICAgICAgdmFyIG9iaiA9IHByaWNlT2JqW3ByaWNlSWRdOwogICAgICAgICAgICBpZiAoIW9iaikgewogICAgICAgICAgICAgIHByaWNlT2JqW3ByaWNlSWRdID0gb2JqID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9iajsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIHJlbW92ZVByaWNlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwcmljZU9iaikgewogICAgICAgICAgICAgIGRlbGV0ZSBwcmljZU9ialtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBpc0VxID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhKSAmJiBiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGEpID09PSBKU09OLnN0cmluZ2lmeShiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGEgPT09IGI7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBvbkZvcm1DaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcHJpY2VJZCA9IG1haW5bdHlwZV0ucGFnZS5nZXRQcmljZUlkKHBhcmFtcyk7CgogICAgICAgICAgICB2YXIgaW5mbyA9IG1haW4uZ2V0SW5mb09iaigpOwogICAgICAgICAgICBkZWxldGUgaW5mby5iYXJSZXF1ZXN0RGF0YTsKCiAgICAgICAgICAgIHJlbW92ZVByaWNlKCk7CiAgICAgICAgICAgIGlmICghcHJpY2VJZCkgewogICAgICAgICAgICAgIHByb2ZpbGUubWF0Y2hQcmljZSA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHByb2ZpbGUubWF0Y2hQcmljZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgdmFyIG9uUHJpY2VDaGFuZ2UgPSBtb25vVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24ocHJpY2VQYXJhbXMpIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSBtYWluW3R5cGVdLnBhZ2UuZ2V0RGF0YShwYXJhbXMsIHByaWNlUGFyYW1zKTsKCiAgICAgICAgICAgIGRhdGEgJiYgX3RoaXMuc2V0RGF0YSh0eXBlLCBkYXRhKTsKICAgICAgICAgIH0sIDUwKTsKCgogICAgICAgICAgdGhpcy5zZXRUeXBlID0gZnVuY3Rpb24odGhlVHlwZSkgewogICAgICAgICAgICAvLyB0YnIubG9nKCdQYWdlIHNldFR5cGUnLCB0aGVUeXBlKTsKCiAgICAgICAgICAgIHR5cGUgPSB0aGVUeXBlOwogICAgICAgICAgfTsKCiAgICAgICAgICB0aGlzLnNldCA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgdmFsdWUgPSBtYWluLnZhbGlkYXRlKGtleSwgdmFsdWUpOwoKICAgICAgICAgICAgdmFyIGNWYWx1ZSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICBpZiAoIWlzRXEodmFsdWUsIGNWYWx1ZSkpIHsKICAgICAgICAgICAgICBwYXJhbXNba2V5XSA9IHZhbHVlOwoKICAgICAgICAgICAgICB0YnIubG9nKCdQYWdlIHNldCcsIGtleSwgdmFsdWUpOwoKICAgICAgICAgICAgICBvbkZvcm1DaGFuZ2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICB0aGlzLnNldFByaWNlID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgICB2YWx1ZSA9IG1haW4udmFsaWRhdGUoa2V5LCB2YWx1ZSk7CgogICAgICAgICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRici5lcnJvcignc2V0UHJpY2UgZXJyb3IsIHZhbHVlIGlzIG5vdCB2YWxpZCcsIGtleSwgdmFsdWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXR5cGUpIHsKICAgICAgICAgICAgICByZXR1cm4gdGJyLmVycm9yKCdzZXRQcmljZSBlcnJvciwgdHlwZSBpcyBub3QgZm91bmQhJywgcGFyYW1zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHByaWNlSWQgPSBtYWluW3R5cGVdLnBhZ2UuZ2V0UHJpY2VJZChwYXJhbXMpOwogICAgICAgICAgICB2YXIgZGF0YSA9IGdldFByaWNlT2JqKHByaWNlSWQpOwogICAgICAgICAgICB2YXIgY1ZhbHVlID0gZGF0YVtrZXldOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgY1ZhbHVlICE9PSB2YWx1ZSkgewogICAgICAgICAgICAgIGlmICghY1ZhbHVlIHx8IGNWYWx1ZSA+IHZhbHVlKSB7CiAgICAgICAgICAgICAgICBkYXRhW2tleV0gPSB2YWx1ZTsKCiAgICAgICAgICAgICAgICB0YnIubG9nKCdQYWdlIHNldFByaWNlJywga2V5LCB2YWx1ZSk7CgogICAgICAgICAgICAgICAgb25QcmljZUNoYW5nZShkYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0YnIubG9nKCdQYWdlIGNsZWFyJyk7CgogICAgICAgICAgICB0aGlzLm1hdGNoUHJpY2UgPSBmYWxzZTsKICAgICAgICAgICAgdHlwZSA9IG51bGw7CiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwYXJhbXMpIHsKICAgICAgICAgICAgICBwYXJhbXNba2V5XSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICB3YXRjaFRlbXBsYXRlT2JqOiB7CiAgICAgICAgICBwcmljZTogZnVuY3Rpb24ocHJvZmlsZSwgc3VtbWFyeSwgaXRlbSkgewogICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKICAgICAgICAgICAgaWYgKCFpdGVtLmtleSkgewogICAgICAgICAgICAgIGl0ZW0ua2V5ID0gJ3ByaWNlJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgbiA9IDAsIG5vZGU7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICB2YXIgcHJpY2UgPSBtYWluLnByZXBhcmVQcmljZShub2RlKTsKICAgICAgICAgICAgICBwYWdlLnNldFByaWNlKGl0ZW0ua2V5LCBwcmljZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBjdXJyZW5jeTogZnVuY3Rpb24ocHJvZmlsZSwgc3VtbWFyeSwgaXRlbSkgewogICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKICAgICAgICAgICAgaWYgKCFpdGVtLmtleSkgewogICAgICAgICAgICAgIGl0ZW0ua2V5ID0gJ2N1cnJlbmN5JzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yICh2YXIgbiA9IDAsIG5vZGU7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICB2YXIgdGV4dCA9IG5vZGUudGV4dENvbnRlbnQ7CiAgICAgICAgICAgICAgdmFyIGNjeSA9IHRleHQgJiYgdGV4dC5yZXBsYWNlKC9bXHNcdF0vZywgJycpOwogICAgICAgICAgICAgIGlmIChpdGVtLmN1cnJlbmN5TWFwICYmIGl0ZW0uY3VycmVuY3lNYXBbY2N5XSkgewogICAgICAgICAgICAgICAgY2N5ID0gaXRlbS5jdXJyZW5jeU1hcFtjY3ldOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBwYWdlLnNldChpdGVtLmtleSwgY2N5KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHByb2ZpbGUKICAgICAgICAgKiBAcGFyYW0gd2F0Y2hPYmoKICAgICAgICAgKiBAY29uc3RydWN0b3IKICAgICAgICAgKi8KICAgICAgICBXYXRjaGVyOiBmdW5jdGlvbihwcm9maWxlLCB3YXRjaE9iaikgewogICAgICAgICAgdmFyIG9ic2VydmVyID0gbnVsbDsKCiAgICAgICAgICB2YXIgd2F0Y2ggPSBmdW5jdGlvbihwcm9maWxlLCB3YXRjaE9iaikgewogICAgICAgICAgICB2YXIgcXVlcmllcyA9IFtdOwogICAgICAgICAgICB2YXIga2V5cyA9IFtdOwoKICAgICAgICAgICAgT2JqZWN0LmtleXMod2F0Y2hPYmopLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gd2F0Y2hPYmpba2V5XS5xdWVyeTsKICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocXVlcnkpKSB7CiAgICAgICAgICAgICAgICBxdWVyeSA9IFtxdWVyeV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBxdWVyeS5mb3JFYWNoKGZ1bmN0aW9uKHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgIHF1ZXJpZXMucHVzaChxdWVyeSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIGNvbXBvbmVudHMubXV0YXRpb25XYXRjaGVyLnJ1bih7CiAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHN1bW1hcnlMaXN0KSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgc3VtbWFyeTsgc3VtbWFyeSA9IHN1bW1hcnlMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgICAgICAgaWYgKHN1bW1hcnkuYWRkZWQubGVuZ3RoID09PSAwICYmIHN1bW1hcnkucmVtb3ZlZC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB3YXRjaE9ialtrZXlzW2ldXTsKCiAgICAgICAgICAgICAgICAgIHByb2ZpbGUuc3VtbWFyeVN0YWNrLnB1c2goW2l0ZW0sIHN1bW1hcnldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHF1ZXJpZXM6IHF1ZXJpZXMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHRoaXMuc3RvcCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBvYnNlcnZlciAmJiBvYnNlcnZlci5zdG9wKCk7CiAgICAgICAgICAgIG9ic2VydmVyID0gbnVsbDsKICAgICAgICAgIH07CgogICAgICAgICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBvYnNlcnZlciAmJiBvYnNlcnZlci5zdG9wKCk7CiAgICAgICAgICAgIG9ic2VydmVyID0gd2F0Y2gocHJvZmlsZSwgd2F0Y2hPYmopOwogICAgICAgICAgfTsKCiAgICAgICAgICB0aGlzLmRlc3Ryb3kgPSB0aGlzLnN0b3A7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0gcHJvZmlsZQogICAgICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICAgICAqLwogICAgICAgIFN1bW1hcnlTdGFjazogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgdmFyIHN0YWNrID0gW107CgogICAgICAgICAgdmFyIHRlbXBsYXRlT2JqID0gbWFpbi53YXRjaFRlbXBsYXRlT2JqOwoKICAgICAgICAgIHZhciBmbkFzeW5jID0gZnVuY3Rpb24oZm4pIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgICAgIGFyZ3Muc2hpZnQoKTsKCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjYikgewogICAgICAgICAgICAgIHZhciBpc0FzeW5jID0gZmFsc2U7CiAgICAgICAgICAgICAgdmFyIHNlbGYgPSB7CiAgICAgICAgICAgICAgICBhc3luYzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGlzQXN5bmMgPSB0cnVlOwogICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBmbi5hcHBseShzZWxmLCBhcmdzKTsKCiAgICAgICAgICAgICAgaWYgKCFpc0FzeW5jKSB7CiAgICAgICAgICAgICAgICBjYigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc3RhY2tJdGVtID0gc3RhY2tbMF07CiAgICAgICAgICAgIGlmICghc3RhY2tJdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVhZHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgcG9zID0gc3RhY2suaW5kZXhPZihzdGFja0l0ZW0pOwogICAgICAgICAgICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBzdGFjay5zcGxpY2UocG9zLCAxKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBuZXh0KCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgaXRlbSA9IHN0YWNrSXRlbVswXTsKICAgICAgICAgICAgaWYgKGl0ZW0uaXNQcmljZSAmJiAhcHJvZmlsZS5tYXRjaFByaWNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlYWR5KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzdW1tYXJ5ID0gc3RhY2tJdGVtWzFdOwoKICAgICAgICAgICAgaWYgKGl0ZW0udGVtcGxhdGUpIHsKICAgICAgICAgICAgICByZWFkeSA9IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSB0ZW1wbGF0ZU9ialtpdGVtLnRlbXBsYXRlXTsKICAgICAgICAgICAgICAgIHRlbXBsYXRlICYmIHRlbXBsYXRlKHByb2ZpbGUsIHN1bW1hcnksIGl0ZW0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgICAgIH0uYmluZChudWxsLCByZWFkeSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpdGVtLmNiKSB7CiAgICAgICAgICAgICAgcmVhZHkgPSBmdW5jdGlvbihjYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZuQXN5bmMoaXRlbS5jYiwgcHJvZmlsZSwgc3VtbWFyeSkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfS5iaW5kKG51bGwsIHJlYWR5KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlYWR5KCk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBjaGVja1N0YWNrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBsZW4gPSBzdGFjay5sZW5ndGg7CgogICAgICAgICAgICBpZiAobGVuID4gMzApIHsKICAgICAgICAgICAgICBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobGVuICE9PSAxKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV4dCgpOwogICAgICAgICAgfTsKCiAgICAgICAgICB0aGlzLnB1c2ggPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goZGF0YSk7CgogICAgICAgICAgICByZXR1cm4gY2hlY2tTdGFjaygpOwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGRldGFpbHMKICAgICAgICAgKiBAY29uc3RydWN0b3IKICAgICAgICAgKi8KICAgICAgICBQcm9maWxlOiBmdW5jdGlvbihkZXRhaWxzKSB7CiAgICAgICAgICB2YXIgcHJvZmlsZSA9IHRoaXM7CgogICAgICAgICAgdmFyIGtleSA9IG51bGw7CiAgICAgICAgICB2YXIgd2F0Y2hPYmogPSB7fTsKICAgICAgICAgIGZvciAoa2V5IGluIGRldGFpbHMuZm9ybVdhdGNoZXIpIHsKICAgICAgICAgICAgd2F0Y2hPYmpba2V5XSA9IGRldGFpbHMuZm9ybVdhdGNoZXJba2V5XTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoa2V5IGluIGRldGFpbHMucHJpY2VXYXRjaGVyKSB7CiAgICAgICAgICAgIHdhdGNoT2JqW2tleV0gPSBkZXRhaWxzLnByaWNlV2F0Y2hlcltrZXldOwogICAgICAgICAgICB3YXRjaE9ialtrZXldLmlzUHJpY2UgPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMubWF0Y2hQcmljZSA9IGZhbHNlOwogICAgICAgICAgdGhpcy5zdW1tYXJ5U3RhY2sgPSBuZXcgbWFpbi5TdW1tYXJ5U3RhY2socHJvZmlsZSk7CiAgICAgICAgICB0aGlzLndhdGNoZXIgPSBuZXcgbWFpbi5XYXRjaGVyKHByb2ZpbGUsIHdhdGNoT2JqKTsKCiAgICAgICAgICB0aGlzLnBhZ2UgPSBuZXcgbWFpbi5QYWdlKHByb2ZpbGUpOwogICAgICAgICAgdGhpcy5wYWdlLnNldERhdGEgPSBmdW5jdGlvbih0eXBlLCBwYXJhbXMpIHsKICAgICAgICAgICAgcGFyYW1zLnR5cGUgPSB0eXBlOwoKICAgICAgICAgICAgdmFyIGluZm8gPSBtYWluLmdldEluZm9PYmooKTsKICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHBhcmFtcykgewogICAgICAgICAgICAgIGluZm9ba2V5XSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtYWluLm9uR2V0UGFnZUluZm8ocGFyYW1zKTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIG9uUHJvZmlsZVJlYWR5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHByb2ZpbGUud2F0Y2hlci5zdGFydCgpOwogICAgICAgICAgfTsKCiAgICAgICAgICBpZiAoZGV0YWlscy5wcmVwYXJlKSB7CiAgICAgICAgICAgIGRldGFpbHMucHJlcGFyZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBvblByb2ZpbGVSZWFkeSAmJiBvblByb2ZpbGVSZWFkeSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG9uUHJvZmlsZVJlYWR5KCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIG9uUHJvZmlsZVJlYWR5ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy53YXRjaGVyICYmIHRoaXMud2F0Y2hlci5kZXN0cm95KCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpbml0UHJvZmlsZTogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAgICAgaWYgKGRldGFpbHMubG9jYXRpb25DaGVjayAmJiAhZGV0YWlscy5sb2NhdGlvbkNoZWNrKGxvY2F0aW9uLmhyZWYpKSB7CiAgICAgICAgICAgIHRici5lcnJvcignSW52YWxpZCBsb2NhdGlvbiEnLCBsb2NhdGlvbi5ocmVmKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY3VycmVudFByb2ZpbGUgPSBkZXRhaWxzOwoKICAgICAgICAgIGlmICh0aGlzLnByb2ZpbGUpIHsKICAgICAgICAgICAgdGhpcy5wcm9maWxlLmRlc3Ryb3koKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnByb2ZpbGUgPSBuZXcgdGhpcy5Qcm9maWxlKGRldGFpbHMpOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGRlbGF5CiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGxpbWl0CiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZm4KICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbY2JdCiAgICAgICAgICovCiAgICAgICAgd2FpdFJlc3BvbnNlOiBmdW5jdGlvbihkZWxheSwgbGltaXQsIGZuLCBjYikgewogICAgICAgICAgdmFyIHdhaXRSZXNwb25zZSA9IHRoaXMud2FpdFJlc3BvbnNlOwogICAgICAgICAgcmV0dXJuIChmdW5jdGlvbiB0aW1lcihyZXRyeSkgewogICAgICAgICAgICB0YnIubG9nKCd3YWl0UmVzcG9uc2UgcmV0cnknLCByZXRyeSk7CgogICAgICAgICAgICBpZiAod2FpdFJlc3BvbnNlLnRpbWVyKSB7CiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHdhaXRSZXNwb25zZS50aW1lcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZXRyeSA8IDApIHsKICAgICAgICAgICAgICB0YnIuZXJyb3IoJ3dhaXRSZXNwb25zZSByZXNwb25zZSBpcyBlbXB0eSEnKTsKICAgICAgICAgICAgICBjYiAmJiBjYigpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZuKGZ1bmN0aW9uKGVycikgewogICAgICAgICAgICAgIGlmICghZXJyKSB7CiAgICAgICAgICAgICAgICB0YnIubG9nKCd3YWl0UmVzcG9uc2UgZ2V0IHJlc3BvbnNlIScpOwogICAgICAgICAgICAgICAgY2IgJiYgY2IoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHdhaXRSZXNwb25zZS50aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB3YWl0UmVzcG9uc2UudGltZXIgPSBudWxsOwoKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lcigtLXJldHJ5KTsKICAgICAgICAgICAgICB9LCBkZWxheSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSkobGltaXQpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb25vVXRpbHMuZXh0ZW5kKG1haW4sIHsKICAgICAgICBjdXJyZW50UHJvZmlsZTogbnVsbCwKICAgICAgICBpbmZvTGlzdDoge30sCiAgICAgICAgY2xvc2VDdXJyZW50QmFyOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBjdXJyZW50QmFyID0gbWFpbi5iYXIuY3VycmVudDsKICAgICAgICAgIG1haW4uYmFyLmlzQWJvcnRlZCA9IHRydWU7CiAgICAgICAgICBpZiAoIWN1cnJlbnRCYXIgfHwgY3VycmVudEJhci5pc0Nsb3NlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50QmFyLmNsb3NlKCk7CiAgICAgICAgfSwKICAgICAgICBzdG9wT2JzZXJ2ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5wcm9maWxlICYmIHRoaXMucHJvZmlsZS5kZXN0cm95KCk7CiAgICAgICAgfSwKICAgICAgICBjbGVhckluZm9PYmo6IGZ1bmN0aW9uKHBhZ2VJbmZvKSB7CiAgICAgICAgICBmb3IgKHZhciB1cmwgaW4gbWFpbi5pbmZvTGlzdCkgewogICAgICAgICAgICBpZiAobWFpbi5pbmZvTGlzdFt1cmxdICE9PSBwYWdlSW5mbykgewogICAgICAgICAgICAgIGRlbGV0ZSBtYWluLmluZm9MaXN0W3VybF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGdldEluZm9PYmo6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHVybCA9IGRvY3VtZW50LlVSTDsKICAgICAgICAgIHZhciBpbmZvID0gbWFpbi5pbmZvTGlzdFt1cmxdOwogICAgICAgICAgaWYgKCFpbmZvKSB7CiAgICAgICAgICAgIGluZm8gPSBtYWluLmluZm9MaXN0W3VybF0gPSB7fTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpbmZvOwogICAgICAgIH0sCiAgICAgICAgb25HZXRQYWdlSW5mbzogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgcGFnZUluZm8gPSB0aGlzLmdldEluZm9PYmooKTsKCiAgICAgICAgICB2YXIgb2JqID0gdGhpc1twYWdlSW5mby50eXBlXTsKICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgIHJldHVybiB0YnIuZXJyb3IoJ1R5cGUgaXMgbm90IGZvdW5kIScsIHBhZ2VJbmZvKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gb2JqLm9uR2V0RGF0YShwYWdlSW5mbyk7CiAgICAgICAgfSwKICAgICAgICBnZXRQYXJhbXNGcm9tUGFnZTogZnVuY3Rpb24odmFyTGlzdCwgY2IpIHsKICAgICAgICAgIHZhciBpc09iak1vZGUgPSBmYWxzZTsKICAgICAgICAgIGlmICh0eXBlb2YgdmFyTGlzdCA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkodmFyTGlzdCkpIHsKICAgICAgICAgICAgaXNPYmpNb2RlID0gT2JqZWN0LmtleXModmFyTGlzdCk7CiAgICAgICAgICAgIHZhckxpc3QgPSBpc09iak1vZGUubWFwKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgIHJldHVybiB2YXJMaXN0W2tleV07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgY29tcG9uZW50cy5icmlkZ2UoewogICAgICAgICAgICBhcmdzOiBbdmFyTGlzdF0sCiAgICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKHZhckxpc3QsIGNiKSB7CiAgICAgICAgICAgICAgdmFyIHJMaXN0ID0gW107CiAgICAgICAgICAgICAgdmFyTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHZhciB2YXJzID0gaXRlbS5zcGxpdCgnLicpOwogICAgICAgICAgICAgICAgdmFyIG9iaiA9IHdpbmRvd1t2YXJzLnNoaWZ0KCldOwogICAgICAgICAgICAgICAgb2JqICYmIHZhcnMuc29tZShmdW5jdGlvbih2YXJpYWJsZSkgewogICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9ialt2YXJpYWJsZV0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqID0gb2JqW3ZhcmlhYmxlXTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBvYmogPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJMaXN0LnB1c2gob2JqKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjYihyTGlzdCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNiOiBmdW5jdGlvbihfZGF0YSkgewogICAgICAgICAgICAgIHZhciBkYXRhID0gX2RhdGE7CiAgICAgICAgICAgICAgaWYgKGlzT2JqTW9kZSkgewogICAgICAgICAgICAgICAgZGF0YSA9IHt9OwogICAgICAgICAgICAgICAgX2RhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpbmRleCkgewogICAgICAgICAgICAgICAgICBkYXRhW2lzT2JqTW9kZVtpbmRleF1dID0gaXRlbTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gY2IoZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgdmFsaWRhdG9yTWFwOiB7CiAgICAgICAgICBvcmlnaW46ICd2YWxpZGF0ZUlhdGFDb2RlJywKICAgICAgICAgIGRlc3RpbmF0aW9uOiAndmFsaWRhdGVJYXRhQ29kZScsCgogICAgICAgICAgZGF0ZVN0YXJ0OiAndmFsaWRhdGVEYXRlJywKICAgICAgICAgIGRhdGVFbmQ6ICd2YWxpZGF0ZURhdGUnLAogICAgICAgICAgZGF0ZUluOiAndmFsaWRhdGVEYXRlJywKICAgICAgICAgIGRhdGVPdXQ6ICd2YWxpZGF0ZURhdGUnLAoKICAgICAgICAgIGN1cnJlbmN5OiAndmFsaWRhdGVDY3knLAogICAgICAgICAgYWR1bHRzOiAndmFsaWRhdGVBZHVsdHMnLAoKICAgICAgICAgIHByaWNlOiAndmFsaWRhdGVQcmljZScsCiAgICAgICAgICBvbmVEYXlQcmljZTogJ3ZhbGlkYXRlUHJpY2UnLAogICAgICAgICAgbWluUHJpY2VJbjogJ3ZhbGlkYXRlUHJpY2UnLAogICAgICAgICAgbWluUHJpY2VPdXQ6ICd2YWxpZGF0ZVByaWNlJywKICAgICAgICAgIG1pblByaWNlQm90aDogJ3ZhbGlkYXRlUHJpY2UnLAoKICAgICAgICAgIHF1ZXJ5OiAndmFsaWRhdGVRdWVyeScsCiAgICAgICAgICBkYXlDb3VudDogJ3ZhbGlkYXRlTnVtYmVyJwogICAgICAgIH0sCiAgICAgICAgdmFsaWRhdGU6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICAgIHZhciB2YWxpZGF0ZUZuTmFtZSA9IHRoaXMudmFsaWRhdG9yTWFwW2tleV07CgogICAgICAgICAgaWYgKHZhbGlkYXRlRm5OYW1lKSB7CiAgICAgICAgICAgIHZhbHVlID0gdGhpc1t2YWxpZGF0ZUZuTmFtZV0odmFsdWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGJyLmVycm9yKCd2YWxpZGF0b3IgaXMgbm90IGZvdW5kIScsIGtleSwgdmFsdWUpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9LAogICAgICAgIHZhbGlkYXRlSWF0YUNvZGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICBpZiAoL15bQS1aXXszfSQvLnRlc3QodmFsdWUpKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgfQogICAgICAgICAgdGJyLmVycm9yKCdDaXR5IHZhbGlkYXRpb24gZXJyb3IhJywgdmFsdWUpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSwKICAgICAgICB2YWxpZGF0ZURhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAvLyB5eXl5LW1tLWRkCiAgICAgICAgICBpZiAoL15cZHs0fS1cZHsyfS1cZHsyfSQvLnRlc3QodmFsdWUpKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIHl5eXktbW0KICAgICAgICAgIGlmICgvXlxkezR9LVxkezJ9JC8udGVzdCh2YWx1ZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgdGJyLmVycm9yKCdEYXRlIHZhbGlkYXRpb24gZXJyb3IhJywgdmFsdWUpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSwKICAgICAgICB2YWxpZGF0ZUNjeTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIGlmICgvXltBLVpdezN9JC8udGVzdCh2YWx1ZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgdGJyLmVycm9yKCdDdXJyZW5jeSB2YWxpZGF0aW9uIGVycm9yIScsIHZhbHVlKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCiAgICAgICAgdmFsaWRhdGVOdW1iZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICB2YXIgaW50ID0gcGFyc2VJbnQodmFsdWUpOwogICAgICAgICAgaWYgKGlzTmFOKGludCkpIHsKICAgICAgICAgICAgdGJyLmVycm9yKCdOdW1iZXIgdmFsaWRhdGlvbiBlcnJvciEnLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGludDsKICAgICAgICB9LAogICAgICAgIHZhbGlkYXRlQWR1bHRzOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgdmFyIGludCA9IHRoaXMudmFsaWRhdGVOdW1iZXIodmFsdWUpOwogICAgICAgICAgaWYgKCFpbnQgfHwgaW50IDwgMSkgewogICAgICAgICAgICB0YnIuZXJyb3IoJ0FkdWx0cyB2YWxpZGF0aW9uIGVycm9yIScsIHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaW50OwogICAgICAgIH0sCiAgICAgICAgdmFsaWRhdGVRdWVyeTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgdGJyLmVycm9yKCdRdWVyeSB2YWxpZGF0aW9uIGVycm9yIScsIHZhbHVlKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCiAgICAgICAgdmFsaWRhdGVQcmljZTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIGlmICghL15cZCsoXC5cZCspPyQvLnRlc3QodmFsdWUpKSB7CiAgICAgICAgICAgIHRici5lcnJvcignUHJpY2UgdmFsaWRhdGlvbiBlcnJvciEnLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9LAogICAgICAgIHByZXBhcmVQcmljZTogZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgdmFyIHZhbHVlID0gbm9kZS50ZXh0Q29udGVudDsKICAgICAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICAgICAgdGJyLmxvZygnUHJpY2UgaXMgZW1wdHkhJywgdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoJywnLCAnLicpOwogICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9bXlxkXC5dL2csICcnKTsKICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXC4oXGR7Myx9KS8sICIkMSIpOwogICAgICAgICAgdmFyIG0gPSB2YWx1ZS5tYXRjaCgvKFxkKykoXC5cZCspPy8pOwogICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgIHRici5sb2coJ1ByaWNlIGlzIGVtcHR5IDIhJywgdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHZhbHVlID0gbVsxXTsKICAgICAgICAgIGlmIChtWzJdKSB7CiAgICAgICAgICAgIHZhbHVlICs9IG1bMl07CiAgICAgICAgICB9CiAgICAgICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICAgICAgaWYgKGlzTmFOKHZhbHVlKSkgewogICAgICAgICAgICB0YnIubG9nKCdQcmljZSBpcyBOYU4hJywgdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9LAogICAgICAgIHJlRm9ybWF0RGF0ZTogZnVuY3Rpb24odmFsdWUsIHJlLCB0ZW1wbGF0ZSkgewogICAgICAgICAgaWYgKHJlLnRlc3QodmFsdWUpKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBtID0gdmFsdWUubWF0Y2gocmUpOwogICAgICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGVtcGxhdGUucmVwbGFjZSgvXCQoXGQpL2csIGZ1bmN0aW9uKHRleHQsIGluZGV4KSB7CiAgICAgICAgICAgICAgcmV0dXJuIG1baW5kZXhdOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciBnZXRQcm9maWxlTGlzdCA9IGZ1bmN0aW9uKHRicikgewogICAgICAgIHZhciBtYWluID0gdGJyLm1haW47CgogICAgICAgIHZhciBwcm9maWxlTGlzdCA9IHt9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyouc2t5c2Nhbm5lci4qLyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC90cmFuc3BvcnRcL2ZsaWdodHNcLy8udGVzdCh1cmwpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBmb3JtV2F0Y2hlcjogewogICAgICAgICAgICAgIGN0cjogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnI2NvbnRlbnQtbWFpbicsCiAgICAgICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUsIHN1bW1hcnkpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBtYWluLmdldFBhcmFtc0Zyb21QYWdlKHsKICAgICAgICAgICAgICAgICAgICBvcmlnaW46ICdTa3lzY2FubmVyLkNvbXBvbmVudENvbnRleHQub3JpZ2luSWF0YUNvZGUnLAogICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiAnU2t5c2Nhbm5lci5Db21wb25lbnRDb250ZXh0LmRlc3RpbmF0aW9uSWF0YUNvZGUnLAogICAgICAgICAgICAgICAgICAgIGRhdGVTdGFydDogJ1NreXNjYW5uZXIuQ29tcG9uZW50Q29udGV4dC5vdXRib3VuZERhdGUnLAogICAgICAgICAgICAgICAgICAgIGRhdGVFbmQ6ICdTa3lzY2FubmVyLkNvbXBvbmVudENvbnRleHQuaW5ib3VuZERhdGUnLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiAnU2t5c2Nhbm5lci5Db21wb25lbnRDb250ZXh0LmN1cnJlbmN5JwogICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdhdmlhJyk7CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdvcmlnaW4nLCBkYXRhT2JqLm9yaWdpbik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2Rlc3RpbmF0aW9uJywgZGF0YU9iai5kZXN0aW5hdGlvbik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVTdGFydCcsIGRhdGFPYmouZGF0ZVN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZUVuZCcsIGRhdGFPYmouZGF0ZUVuZCk7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgZGF0YU9iai5jdXJyZW5jeSk7CgogICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5jYXJkLnJlc3VsdCAubWFpbnF1b3RlLXByaWNlJywKICAgICAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLm1vbW9uZG8uKi8qJ10gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICBsb2NhdGlvbkNoZWNrOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICAgICAgICByZXR1cm4gL1wvZmxpZ2h0c2VhcmNoXC8vLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiBbewogICAgICAgICAgICAgICAgICBjc3M6ICcjZmxpZ2h0LWxpc3QnLAogICAgICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBjc3M6ICcucmVzdWx0cycsCiAgICAgICAgICAgICAgICAgIGlzOiAncmVtb3ZlZCcKICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUsIHN1bW1hcnkpIHsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2F2aWEnKTsKCiAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBsb2NhdGlvbi5ocmVmOwoKICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gdXJsLm1hdGNoKC8jKC4rKS8pIHx8IHVybC5tYXRjaCgvXD8oLispLyk7CiAgICAgICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nID0gcXVlcnlTdHJpbmcgJiYgcXVlcnlTdHJpbmdbMV07CiAgICAgICAgICAgICAgICAgIGlmICghcXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgICAgICAgICBwYWdlLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gbW9ub1V0aWxzLnBhcnNlVXJsKHF1ZXJ5U3RyaW5nLCB7CiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiAxCiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIHBhcmFtc1snU08wJ10pOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGVzdGluYXRpb24nLCBwYXJhbXNbJ1NEMCddKTsKCiAgICAgICAgICAgICAgICAgIHZhciBkYXRlU3RhcnQgPSBtYWluLnJlRm9ybWF0RGF0ZShwYXJhbXNbJ1NEUDAnXSwgLyhcZHsyfSktKFxkezJ9KS0oXGR7NH0pLywgIiQzLSQyLSQxIik7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlU3RhcnQnLCBkYXRlU3RhcnQpOwoKICAgICAgICAgICAgICAgICAgdmFyIGRhdGVFbmQgPSBtYWluLnJlRm9ybWF0RGF0ZShwYXJhbXNbJ1NEUDEnXSwgLyhcZHsyfSktKFxkezJ9KS0oXGR7NH0pLywgIiQzLSQyLSQxIik7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjY3k6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy50aWNrZXRpbmZvIC5wcmljZSAudW5pdCcsCiAgICAgICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdjdXJyZW5jeScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcudGlja2V0aW5mbyAucHJpY2UgLnZhbHVlJywKICAgICAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25TaG93OiBmdW5jdGlvbihiYXJIZWlnaHQpIHsKICAgICAgICAgICAgICB2YXIgaGVhZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI211aS1oZWFkZXInKTsKICAgICAgICAgICAgICBpZiAoIWhlYWRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoZWFkZXIuc3R5bGUubWFyZ2luVG9wID0gYmFySGVpZ2h0ICsgJ3B4JzsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25IaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgaGVhZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI211aS1oZWFkZXInKTsKICAgICAgICAgICAgICBpZiAoIWhlYWRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoZWFkZXIuc3R5bGUubWFyZ2luVG9wID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyoub3pvbi50cmF2ZWwvKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgbG9jYXRpb25DaGVjazogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC9cL2ZsaWdodFwvc2VhcmNoXC8vLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5jb250ZW50JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICByZXR1cm4gbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiAnYS5kYXRhLlNlYXJjaFBhcmFtcy5Db2RlRnJvbTEnLAogICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiAnYS5kYXRhLlNlYXJjaFBhcmFtcy5Db2RlVG8xJywKICAgICAgICAgICAgICAgICAgICBkYXRlU3RhcnQ6ICdhLmRhdGEuU2VhcmNoUGFyYW1zLkRhdGUxJywKICAgICAgICAgICAgICAgICAgICBkYXRlRW5kOiAnYS5kYXRhLlNlYXJjaFBhcmFtcy5EYXRlMicsCiAgICAgICAgICAgICAgICAgICAgRGF0ZTM6ICdhLmRhdGEuU2VhcmNoUGFyYW1zLkRhdGUzJywKICAgICAgICAgICAgICAgICAgICBDb2RlRnJvbTI6ICdhLmRhdGEuU2VhcmNoUGFyYW1zLkNvZGVGcm9tMicsCiAgICAgICAgICAgICAgICAgICAgQ29kZVRvMjogJ2EuZGF0YS5TZWFyY2hQYXJhbXMuQ29kZVRvMicKICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZGF0YU9iaikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2JqLkRhdGUzKSB7CiAgICAgICAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ01vcmUgdHdvIHBhcmFtcy4nKTsKICAgICAgICAgICAgICAgICAgICAgIHBhZ2UuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5Db2RlRnJvbTIgJiYgKGRhdGFPYmoub3JpZ2luICE9PSBkYXRhT2JqLkNvZGVUbzIgfHwgZGF0YU9iai5kZXN0aW5hdGlvbiAhPT0gZGF0YU9iai5Db2RlRnJvbTIpKSB7CiAgICAgICAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ01vcmUgb25lIHdheSEnLCBkYXRhT2JqKTsKICAgICAgICAgICAgICAgICAgICAgIHBhZ2UuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2F2aWEnKTsKCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIGRhdGFPYmoub3JpZ2luKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGVzdGluYXRpb24nLCBkYXRhT2JqLmRlc3RpbmF0aW9uKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZVN0YXJ0JywgZGF0YU9iai5kYXRlU3RhcnQpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0YU9iai5kYXRlRW5kKTsKCiAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjY3k6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy50YXJpZmZzIC5wcmljZScsCiAgICAgICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUsIHN1bW1hcnkpIHsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICB2YXIgY2N5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmN1cnJlbmN5LWZvcm0gLmN1cnJlbmN5LWZpbHRlciBpbnB1dFtuYW1lPSJDdXJyZW5jeSJdJyk7CiAgICAgICAgICAgICAgICAgIGNjeSA9IGNjeSAmJiBjY3kudmFsdWU7CiAgICAgICAgICAgICAgICAgIGlmIChjY3kpIHsKICAgICAgICAgICAgICAgICAgICBjY3kgPSBjY3kucmVwbGFjZSgvW1xzXHRdL2csICcnKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCBjY3kpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBwcmljZVdhdGNoZXI6IHsKICAgICAgICAgICAgICBwcmljZTogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnLnRhcmlmZnMgLnByaWNlJywKICAgICAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyoub25ldHdvdHJpcC5jb20vKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiBbewogICAgICAgICAgICAgICAgICBjc3M6ICcjbGF5b3V0X3Jlc3VsdHMnCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5sb2FkZXInCiAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICByZXR1cm4gbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiAneGNudF90cmFuc3BvcnRfZnJvbScsCiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb246ICd4Y250X3RyYW5zcG9ydF90bycsCiAgICAgICAgICAgICAgICAgICAgZGF0ZVN0YXJ0OiAneGNudF90cmFuc3BvcnRfZGVwYXJ0X2RhdGUnLAogICAgICAgICAgICAgICAgICAgIGRhdGVFbmQ6ICd4Y250X3RyYW5zcG9ydF9yZXR1cm5fZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6ICd0dy5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3hjbnRfdHJhbnNwb3J0X3R5cGUnCiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGRhdGFPYmopIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai50eXBlICE9PSAnYWlyJykgewogICAgICAgICAgICAgICAgICAgICAgcGFnZS5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnb3JpZ2luJywgZGF0YU9iai5vcmlnaW4pOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkZXN0aW5hdGlvbicsIGRhdGFPYmouZGVzdGluYXRpb24pOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCBkYXRhT2JqLmN1cnJlbmN5KTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVTdGFydCA9IG1haW4ucmVGb3JtYXREYXRlKGRhdGFPYmouZGF0ZVN0YXJ0LCAvKFxkezR9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzIik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVTdGFydCcsIGRhdGVTdGFydCk7CgogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlRW5kID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0YU9iai5kYXRlRW5kLCAvKFxkezR9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzIik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVFbmQnLCBkYXRlRW5kKTsKCiAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBwcmljZVdhdGNoZXI6IHsKICAgICAgICAgICAgICBwcmljZTogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnLnByaWNlX2J1dHRvbiAubW9uZXktZm9ybWF0dGVkJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHByb2ZpbGVMaXN0WycqOi8vKi5rYXlhay4qLyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9mbGlnaHRzXC8vLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNyZXNib2R5JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICByZXR1cm4gbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiAnUjkuZ2xvYmFscy5hbmFseXRpY3MucGl4ZWxDb250ZXh0Lm9yaWdpbkNvZGUnLAogICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiAnUjkuZ2xvYmFscy5hbmFseXRpY3MucGl4ZWxDb250ZXh0LmRlc3RpbmF0aW9uQ29kZScsCiAgICAgICAgICAgICAgICAgICAgZGF0ZVN0YXJ0OiAnUjkuZ2xvYmFscy5hbmFseXRpY3MucGl4ZWxDb250ZXh0LmRlcGFydHVyZURhdGUnLAogICAgICAgICAgICAgICAgICAgIGRhdGVFbmQ6ICdSOS5nbG9iYWxzLmFuYWx5dGljcy5waXhlbENvbnRleHQucmV0dXJuRGF0ZScsCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6ICdSOS5nbG9iYWxzLmFuYWx5dGljcy5waXhlbENvbnRleHQuc2l0ZV9jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAgICAgdHJpcFR5cGU6ICdSOS5nbG9iYWxzLmFuYWx5dGljcy5waXhlbENvbnRleHQucm91bmRUcmlwJwogICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdhdmlhJyk7CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdvcmlnaW4nLCBkYXRhT2JqLm9yaWdpbik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2Rlc3RpbmF0aW9uJywgZGF0YU9iai5kZXN0aW5hdGlvbik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgZGF0YU9iai5jdXJyZW5jeSk7CgogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlU3RhcnQgPSBtYWluLnJlRm9ybWF0RGF0ZShkYXRhT2JqLmRhdGVTdGFydCwgLyhcZHs0fSktKFxkezJ9KS0oXGR7Mn0pLywgIiQxLSQyLSQzIik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVTdGFydCcsIGRhdGVTdGFydCk7CgogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlRW5kID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai50cmlwVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgZGF0ZUVuZCA9IG1haW4ucmVGb3JtYXREYXRlKGRhdGFPYmouZGF0ZUVuZCwgLyhcZHs0fSktKFxkezJ9KS0oXGR7Mn0pLywgIiQxLSQyLSQzIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CgogICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5mbGlnaHRyZXN1bHQgLnJlc3VsdHNfcHJpY2UnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLnRyYXZlbG9jaXR5LmNvbS8qJ10gPSBwcm9maWxlTGlzdFsnKjovLyoub3JiaXR6LmNvbS8qJ10gPSBwcm9maWxlTGlzdFsnKjovLyouZXhwZWRpYS5jb20vKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZ2V0QXZpYSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgICAgcmV0dXJuIC9cL0ZsaWdodHMtU2VhcmNoLy50ZXN0KHVybCk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBmb3JtV2F0Y2hlcjogewogICAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgICAgY3NzOiAnI2ZsaWdodE1vZHVsZUxpc3QnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgICBvcmlnaW46ICdJbnRlbnRNZWRpYVByb3BlcnRpZXMuZmxpZ2h0X29yaWdpbicsCiAgICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogJ0ludGVudE1lZGlhUHJvcGVydGllcy5mbGlnaHRfZGVzdGluYXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgZGF0ZVN0YXJ0OiAnSW50ZW50TWVkaWFQcm9wZXJ0aWVzLnRyYXZlbF9kYXRlX3N0YXJ0JywKICAgICAgICAgICAgICAgICAgICAgIGRhdGVFbmQ6ICdJbnRlbnRNZWRpYVByb3BlcnRpZXMudHJhdmVsX2RhdGVfZW5kJywKICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiAnSW50ZW50TWVkaWFQcm9wZXJ0aWVzLnNpdGVfY3VycmVuY3knLAogICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0ludGVudE1lZGlhUHJvcGVydGllcy5wcm9kdWN0X2NhdGVnb3J5JywKICAgICAgICAgICAgICAgICAgICAgIHRyaXBUeXBlOiAnSW50ZW50TWVkaWFQcm9wZXJ0aWVzLnRyaXBfdHlwZScKICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai50eXBlICE9PSAnZmxpZ2h0cycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZS5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdhdmlhJyk7CgogICAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIGRhdGFPYmoub3JpZ2luKTsKICAgICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkZXN0aW5hdGlvbicsIGRhdGFPYmouZGVzdGluYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgZGF0YU9iai5jdXJyZW5jeSk7CgogICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVTdGFydCA9IG1haW4ucmVGb3JtYXREYXRlKGRhdGFPYmouZGF0ZVN0YXJ0LCAvKFxkezR9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzIik7CiAgICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZVN0YXJ0JywgZGF0ZVN0YXJ0KTsKCiAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZUVuZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai50cmlwVHlwZSA9PT0gJ1JPVU5EX1RSSVAnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVFbmQgPSBtYWluLnJlRm9ybWF0RGF0ZShkYXRhT2JqLmRhdGVFbmQsIC8oXGR7NH0pKFxkezJ9KShcZHsyfSkvLCAiJDEtJDItJDMiKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CgogICAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgICBwcmljZTogewogICAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICAgIGNzczogJyNmbGlnaHRNb2R1bGVMaXN0IC5vZmZlci1wcmljZSAudmlzdWFsbHloaWRkZW4nCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgZ2V0SG90ZWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHJlcXVlc3RCYXNlRGF0YSA9IGZ1bmN0aW9uKHByb2ZpbGUsIGNiKSB7CiAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgIHJldHVybiBtYWluLmdldFBhcmFtc0Zyb21QYWdlKHsKICAgICAgICAgICAgICAgIGNpdHk6ICdJbnRlbnRNZWRpYVByb3BlcnRpZXMuaG90ZWxfY2l0eV9uYW1lJywKICAgICAgICAgICAgICAgIG5hbWU6ICdJbnRlbnRNZWRpYVByb3BlcnRpZXMuaG90ZWxfc3VwcGxpZXInLAogICAgICAgICAgICAgICAgYWR1bHRzOiAnSW50ZW50TWVkaWFQcm9wZXJ0aWVzLmFkdWx0cycsCiAgICAgICAgICAgICAgICByb29tczogJ0ludGVudE1lZGlhUHJvcGVydGllcy5ob3RlbF9yb29tcycsCiAgICAgICAgICAgICAgICBkYXRlSW46ICdJbnRlbnRNZWRpYVByb3BlcnRpZXMudHJhdmVsX2RhdGVfc3RhcnQnLAogICAgICAgICAgICAgICAgZGF0ZU91dDogJ0ludGVudE1lZGlhUHJvcGVydGllcy50cmF2ZWxfZGF0ZV9lbmQnLAogICAgICAgICAgICAgICAgY3VycmVuY3k6ICdJbnRlbnRNZWRpYVByb3BlcnRpZXMuc2l0ZV9jdXJyZW5jeScsCiAgICAgICAgICAgICAgICBwYWdlSWQ6ICdJbnRlbnRNZWRpYVByb3BlcnRpZXMucGFnZV9pZCcKICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5wYWdlSWQgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgY2IgJiYgY2IoMSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5wYWdlSWQgIT09ICdob3RlbC5kZXRhaWxzJyB8fCBkYXRhT2JqLnJvb21zID4gMSB8fCAhZGF0YU9iai5uYW1lKSB7CiAgICAgICAgICAgICAgICAgIHBhZ2UuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgY2IgJiYgY2IoMCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2hvdGVsJyk7CgogICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW2RhdGFPYmoubmFtZV07CiAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5jaXR5KSB7CiAgICAgICAgICAgICAgICAgIHF1ZXJ5LnVuc2hpZnQoZGF0YU9iai5uYW1lICsgJyAnICsgZGF0YU9iai5jaXR5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdxdWVyeScsIHF1ZXJ5KTsKCiAgICAgICAgICAgICAgICBwYWdlLnNldCgnYWR1bHRzJywgZGF0YU9iai5hZHVsdHMpOwogICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgZGF0YU9iai5jdXJyZW5jeSk7CgogICAgICAgICAgICAgICAgdmFyIGRhdGVJbiA9IG1haW4ucmVGb3JtYXREYXRlKGRhdGFPYmouZGF0ZUluLCAvKFxkezR9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzIik7CiAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZUluJywgZGF0ZUluKTsKCiAgICAgICAgICAgICAgICB2YXIgZGF0ZU91dCA9IG1haW4ucmVGb3JtYXREYXRlKGRhdGFPYmouZGF0ZU91dCwgLyhcZHs0fSkoXGR7Mn0pKFxkezJ9KS8sICIkMS0kMi0kMyIpOwogICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVPdXQnLCBkYXRlT3V0KTsKCiAgICAgICAgICAgICAgICBjYiAmJiBjYigwKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbG9jYXRpb25DaGVjazogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gL0hvdGVsLUluZm9ybWF0aW9uLy50ZXN0KHVybCk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBmb3JtV2F0Y2hlcjogewogICAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBbewogICAgICAgICAgICAgICAgICAgIGNzczogJy5ob3RlbEluZm9ybWF0aW9uJwogICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXN5bmMgPSB0aGlzLmFzeW5jKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1haW4ud2FpdFJlc3BvbnNlKDI1MCwgMjAsIGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVxdWVzdEJhc2VEYXRhKHByb2ZpbGUsIGNiKTsKICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3luYygpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBwcmljZVdhdGNoZXI6IHsKICAgICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgICAgY3NzOiAnI3Jvb21zLWFuZC1yYXRlcyAucm9vbS1wcmljZS1pbmZvLXdyYXBwZXIgLnJvb20tcHJpY2UnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnLAogICAgICAgICAgICAgICAgICBrZXk6ICdvbmVEYXlQcmljZScKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgoKICAgICAgICAgIHZhciBkZXRhaWxzID0gbnVsbDsKCiAgICAgICAgICBpZiAoL0hvdGVsLUluZm9ybWF0aW9uLy50ZXN0KGxvY2F0aW9uLmhyZWYpKSB7CiAgICAgICAgICAgIGRldGFpbHMgPSBnZXRIb3RlbCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGV0YWlscyA9IGdldEF2aWEoKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyoucHJpY2VsaW5lLmNvbS8qJ10gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBnZXRDaXR5Q29kZSA9IGZ1bmN0aW9uKGFpcnBvcnRDb2RlKSB7CiAgICAgICAgICAgIHZhciBjaXR5Q29kZSA9IGFpcnBvcnRDb2RlOwogICAgICAgICAgICBpZiAobWFpbi5jYWNoZS5haXJwb3J0TWFwKSB7CiAgICAgICAgICAgICAgdmFyIGFpcnBvcnRJbmZvID0gbWFpbi5jYWNoZS5haXJwb3J0TWFwW2FpcnBvcnRDb2RlXTsKICAgICAgICAgICAgICBpZiAoYWlycG9ydEluZm8gJiYgYWlycG9ydEluZm8uY2l0eV9jb2RlKSB7CiAgICAgICAgICAgICAgICBjaXR5Q29kZSA9IGFpcnBvcnRJbmZvLmNpdHlfY29kZTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGJyLmVycm9yKCdjaXR5Q29kZSBpcyBub3QgZm91bmQhJywgYWlycG9ydENvZGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY2l0eUNvZGU7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICBsb2NhdGlvbkNoZWNrOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICAgICAgICByZXR1cm4gL1wvZmx5XC8jXC9zZWFyY2hcLy8udGVzdCh1cmwpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBwcmVwYXJlOiBmdW5jdGlvbihjYikgewogICAgICAgICAgICAgIG1haW4uYXZpYS5sb2FkQWlycG9ydHMoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNmbHktc2VhcmNoLXJlc3VsdHMnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICB2YXIgdXJsID0gbG9jYXRpb24uaHJlZjsKICAgICAgICAgICAgICAgICAgdmFyIG0gPSB1cmwubWF0Y2goL1wvc2VhcmNoXC8oW14tXC9dKyktKFteLVwvXSspLShbXi1cL10rKVwvKD86KFteLVwvXSspLShbXi1cL10rKS0oW14tXC9dKylcLyk/XGQvKTsKICAgICAgICAgICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2F2aWEnKTsKCiAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW4gPSBtWzFdLnNwbGl0KCc6JylbMF07CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdvcmlnaW4nLCBnZXRDaXR5Q29kZShvcmlnaW4pKTsKCiAgICAgICAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbiA9IG1bMl0uc3BsaXQoJzonKVswXTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2Rlc3RpbmF0aW9uJywgZ2V0Q2l0eUNvZGUoZGVzdGluYXRpb24pKTsKCiAgICAgICAgICAgICAgICAgIHZhciBkYXRlU3RhcnQgPSBtYWluLnJlRm9ybWF0RGF0ZShtWzNdLCAvKFxkezR9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzIik7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlU3RhcnQnLCBkYXRlU3RhcnQpOwoKICAgICAgICAgICAgICAgICAgdmFyIGRhdGVFbmQgPSBtYWluLnJlRm9ybWF0RGF0ZShtWzZdLCAvKFxkezR9KShcZHsyfSkoXGR7Mn0pLywgIiQxLSQyLSQzIik7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjY3k6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJ3NwYW5bbmctYmluZD0iY3VycmVuY3lDb2RlIl0nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdjdXJyZW5jeScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcuZmx5LXNlYXJjaC1pdGluZXJhcnkgLnByaWNpbmctaW5mbyBkaXYudG90YWwnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLmFlcm9mbG90LnJ1LyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC93ZWJxdHJpcC5odG1sLy50ZXN0KHVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcuZmxpZ2h0LWxpc3QnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICB2YXIgZGF0YUFyciA9IG51bGw7CgogICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MOwogICAgICAgICAgICAgICAgICB2YXIgZGF0YVJlID0gLyJpdGluZXJhcnlBaXJwb3J0UGFpcnMiOihcW1teXF1dK10pLzsKICAgICAgICAgICAgICAgICAgbW9ub1V0aWxzLmdldFBhZ2VTY3JpcHQoaHRtbCwgZGF0YVJlKS5zb21lKGZ1bmN0aW9uKHNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgIHZhciBtID0gc2NyaXB0Lm1hdGNoKGRhdGFSZSk7CiAgICAgICAgICAgICAgICAgICAgbSA9IG0gJiYgbVsxXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBtb25vVXRpbHMuZmluZEpzb24obSkuc29tZShmdW5jdGlvbihhcnIpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ01vcmUgdHdvIHdheSEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgZGF0YUFyciA9IGFycjsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGlmICghZGF0YUFycikgewogICAgICAgICAgICAgICAgICAgIHRici5lcnJvcignRGF0YSBpcyBub3QgZm91bmQhJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgb3JpZ2luRGF0YSA9IGRhdGFBcnJbMF07CgogICAgICAgICAgICAgICAgICBpZiAoIW9yaWdpbkRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ09yaWdpbiBkYXRhIGlzIG5vdCBmb3VuZCEnLCBkYXRhQXJyKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwoKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIG9yaWdpbkRhdGEuZGVwYXJ0dXJlQ29kZSk7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkZXN0aW5hdGlvbicsIG9yaWdpbkRhdGEuYXJyaXZhbENvZGUpOwoKICAgICAgICAgICAgICAgICAgdmFyIGRhdGVTdGFydCA9IG1haW4ucmVGb3JtYXREYXRlKG9yaWdpbkRhdGEuZGF0ZSwgLyhcZHs0fSlcLyhcZHsyfSlcLyhcZHsyfSkvLCAiJDEtJDItJDMiKTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVTdGFydCcsIGRhdGVTdGFydCk7CgogICAgICAgICAgICAgICAgICB2YXIgZGF0ZUVuZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgIHZhciBkZXN0RGF0YSA9IGRhdGFBcnJbMV07CiAgICAgICAgICAgICAgICAgIGlmIChkZXN0RGF0YSkgewogICAgICAgICAgICAgICAgICAgIGRhdGVFbmQgPSBtYWluLnJlRm9ybWF0RGF0ZShkZXN0RGF0YS5kYXRlLCAvKFxkezR9KVwvKFxkezJ9KVwvKFxkezJ9KS8sICIkMS0kMi0kMyIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CgogICAgICAgICAgICAgICAgICB2YXIgY2N5ID0gLyJjdXJyZW5jeSI6IihbXiJdezN9KSIvLmV4ZWMoaHRtbCk7CiAgICAgICAgICAgICAgICAgIGNjeSA9IGNjeSAmJiBjY3lbMV07CiAgICAgICAgICAgICAgICAgIGlmIChjY3kpIHsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCBjY3kpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBwcmljZVdhdGNoZXI6IHsKICAgICAgICAgICAgICBtaW5QcmljZU91dDogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnI291dGJvdW5kcyAuZmxpZ2h0LWxpc3QgLnByaWNlcy1hbGwgLnByaWNlcy1hbW91bnQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScsCiAgICAgICAgICAgICAgICBrZXk6ICdtaW5QcmljZU91dCcKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG1pblByaWNlSW46IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNpbmJvdW5kcyAuZmxpZ2h0LWxpc3QgLnByaWNlcy1hbGwgLnByaWNlcy1hbW91bnQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScsCiAgICAgICAgICAgICAgICBrZXk6ICdtaW5QcmljZUluJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcHJpY2VCb3RoOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcjYm90aCAuZmxpZ2h0LWxpc3QgLnByaWNlcy1hbGwgLnByaWNlcy1hbW91bnQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLmFueXdheWFueWRheS5jb20vKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgbG9jYXRpb25DaGVjazogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC9cL2F2aWFcL29mZmVyc1wvLy50ZXN0KHVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcub2ZmZXJzLXRpY2tldHMtY29udGFpbmVyJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IGxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgICAgICAgIHZhciBtID0gdXJsLm1hdGNoKC9cL2F2aWFcL29mZmVyc1wvKFxkezJ9KShcZHsyfSkoXHd7M30pKFx3ezN9KSg/OihcZHsyfSkoXGR7Mn0pKFx3ezN9KShcd3szfSkpPy8pOwogICAgICAgICAgICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbS5zaGlmdCgpOwoKICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdhdmlhJyk7CgogICAgICAgICAgICAgICAgICB2YXIgaXNPbmVXYXkgPSAhbVs0XTsKCiAgICAgICAgICAgICAgICAgIGlmICghaXNPbmVXYXkgJiYgKG1bMl0gIT09IG1bN10gfHwgbVszXSAhPT0gbVs2XSkpIHsKICAgICAgICAgICAgICAgICAgICB0YnIuZXJyb3IoJ01vcmUgb25lIHdheSBpbiBVUkwhJywgbSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTsKCiAgICAgICAgICAgICAgICAgIHZhciBnZXRGb3JtYXREYXRlID0gZnVuY3Rpb24obW9udGgsIGRhdGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY1llYXIgPSBub3cuZ2V0VVRDRnVsbFllYXIoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgY0RhdGUgPSBub3cuZ2V0VVRDRGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIHZhciBjTW9udGggPSBub3cuZ2V0VVRDTW9udGgoKSArIDE7CiAgICAgICAgICAgICAgICAgICAgdmFyIGludE1vbnRoID0gcGFyc2VJbnQobW9udGgpOwogICAgICAgICAgICAgICAgICAgIHZhciBpbnREYXRlID0gcGFyc2VJbnQoZGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNNb250aCA+IGludE1vbnRoIHx8IChjTW9udGggPT09IGludE1vbnRoICYmIGludERhdGUgPCBjRGF0ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgIGNZZWFyICs9IDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBtYWluLnZhbGlkYXRlRGF0ZShbY1llYXIsIG1vbnRoLCBkYXRlXS5qb2luKCctJykpOwogICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIG1bMl0pOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGVzdGluYXRpb24nLCBtWzNdKTsKCiAgICAgICAgICAgICAgICAgIHZhciBkYXRlU3RhcnQgPSBnZXRGb3JtYXREYXRlKG1bMV0sIG1bMF0pOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZVN0YXJ0JywgZGF0ZVN0YXJ0KTsKCiAgICAgICAgICAgICAgICAgIHZhciBkYXRlRW5kID0gIWlzT25lV2F5ICYmIGdldEZvcm1hdERhdGUobVs1XSwgbVs0XSk7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjY3k6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5oZWFkZXItc2lkZWJhci1Ecm9wZG93bkN1cnJlbmN5IC5iLW1lbnUtaXRlbS1idXR0b24tdGV4dCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ2N1cnJlbmN5JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5vZmZlcnMtdGlja2V0cy1jb250YWluZXIgLmZhcmVUaWNrZXRzIC5iLXByaWNlJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHByb2ZpbGVMaXN0WycqOi8vKi5zdnlhem5veS50cmF2ZWwvKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiBbewogICAgICAgICAgICAgICAgICBjc3M6ICcjcmVzdWx0cycKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgY3NzOiAnLmJlc3QtcmVzdWx0cy1wcmljZScKICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIG1haW4uZ2V0UGFyYW1zRnJvbVBhZ2UoewogICAgICAgICAgICAgICAgICAgIG9yaWdpbjogJ2Zyb21fY29kZScsCiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb246ICd0b19jb2RlJywKICAgICAgICAgICAgICAgICAgICBkYXRlU3RhcnQ6ICdmcm9tX2RhdGUnLAogICAgICAgICAgICAgICAgICAgIGRhdGVFbmQ6ICd0b19kYXRlJywKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY3VyRGlyJwogICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFPYmoudHlwZSAhPT0gJy9hdmlhJykgewogICAgICAgICAgICAgICAgICAgICAgcGFnZS5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnb3JpZ2luJywgZGF0YU9iai5vcmlnaW4pOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkZXN0aW5hdGlvbicsIGRhdGFPYmouZGVzdGluYXRpb24pOwoKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZVN0YXJ0ID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0YU9iai5kYXRlU3RhcnQsIC8oXGR7Mn0pXC4oXGR7Mn0pXC4oXGR7NH0pLywgIiQzLSQyLSQxIik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVTdGFydCcsIGRhdGVTdGFydCk7CgogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlRW5kID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0YU9iai5kYXRlRW5kLCAvKFxkezJ9KVwuKFxkezJ9KVwuKFxkezR9KS8sICIkMy0kMi0kMSIpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3VtX3J1YicpKSB7CiAgICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCAnUlVCJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcuYm94LXJlc3VsdHMtYmVzdCAuYmVzdC1yZXN1bHRzLXByaWNlJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHByb2ZpbGVMaXN0WycqOi8vYXZpYS50aWNrZXRzLnJ1LyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9zZWFyY2hcL3Jlc3VsdHMvLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5yZXN1bHRfYmxvY2snCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBtYWluLmdldFBhcmFtc0Zyb21QYWdlKHsKICAgICAgICAgICAgICAgICAgICBvcmlnaW46ICdhdmlhX2Zvcm1fc2VhcmNoX3BhcmFtcy5mcm9tX2NvZGUnLAogICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiAnYXZpYV9mb3JtX3NlYXJjaF9wYXJhbXMudG9fY29kZScsCiAgICAgICAgICAgICAgICAgICAgZGF0ZVN0YXJ0OiAnYXZpYV9mb3JtX3NlYXJjaF9wYXJhbXMuZGVwYXJ0dXJlX2RhdGUnLAogICAgICAgICAgICAgICAgICAgIGRhdGVFbmQ6ICdhdmlhX2Zvcm1fc2VhcmNoX3BhcmFtcy5kZXBhcnR1cmVfZGF0ZTEnLAogICAgICAgICAgICAgICAgICAgIGZyb21Db2RlMTogJ2F2aWFfZm9ybV9zZWFyY2hfcGFyYW1zLmZyb21fY29kZTEnLAogICAgICAgICAgICAgICAgICAgIHRvQ29kZTE6ICdhdmlhX2Zvcm1fc2VhcmNoX3BhcmFtcy50b19jb2RlMScsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2N1cl9kb21haW5fbmFtZScKICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZGF0YU9iaikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2JqLnR5cGUgIT09ICdhdmlhJykgewogICAgICAgICAgICAgICAgICAgICAgdGJyLmVycm9yKCdJcyBub3QgYXZpYSBwYWdlIScpOwogICAgICAgICAgICAgICAgICAgICAgcGFnZS5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5kYXRlRW5kICYmIChkYXRhT2JqLm9yaWdpbiAhPT0gZGF0YU9iai50b0NvZGUxIHx8IGRhdGFPYmouZGVzdGluYXRpb24gIT09IGRhdGFPYmouZnJvbUNvZGUxKSkgewogICAgICAgICAgICAgICAgICAgICAgdGJyLmVycm9yKCdNb3JlIG9uZSB3YXknLCBkYXRhT2JqKTsKICAgICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnb3JpZ2luJywgZGF0YU9iai5vcmlnaW4pOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkZXN0aW5hdGlvbicsIGRhdGFPYmouZGVzdGluYXRpb24pOwoKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZVN0YXJ0ID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0YU9iai5kYXRlU3RhcnQsIC8oXGR7Mn0pXC4oXGR7Mn0pXC4oXGR7NH0pLywgIiQzLSQyLSQxIik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVTdGFydCcsIGRhdGVTdGFydCk7CgogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlRW5kID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0YU9iai5kYXRlRW5kLCAvKFxkezJ9KVwuKFxkezJ9KVwuKFxkezR9KS8sICIkMy0kMi0kMSIpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CgogICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgY2N5OiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcuY3VycmVuY3ktY2hhbmdlLWJsb2NrIC5uYXYtY3VycmVuY3kgLmlyYWRpb19taW5pbWFsLmNoZWNrZWQgKyBsYWJlbCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ2N1cnJlbmN5JywKICAgICAgICAgICAgICAgIGN1cnJlbmN5TWFwOiB7CiAgICAgICAgICAgICAgICAgIFJVUjogJ1JVQicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcjb2ZmZXJzX3RhYmxlIC5pdGVtLWJsb2NrIC5wcmljZS1ibG9jayBzdHJvbmcgc3Bhbjpub3QoLmhpZGRlbiknCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLnM3LnJ1LyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9zZWxlY3RFeGFjdERhdGVTZWFyY2hGbGlnaHRzXC5hY3Rpb24vLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiBbewogICAgICAgICAgICAgICAgICBjc3M6ICcjZXhwYW5kU2VhcmNoRm9ybScKICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICB2YXIgb3JpZ2luID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2V4cGFuZFNlYXJjaEZvcm0gaW5wdXQjZGVwYXJ0dXJlTG9jYXRpb25JYXRhQ29kZScpOwogICAgICAgICAgICAgICAgICBvcmlnaW4gPSBvcmlnaW4gJiYgb3JpZ2luLnZhbHVlOwoKICAgICAgICAgICAgICAgICAgdmFyIGRlc3RpbmF0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2V4cGFuZFNlYXJjaEZvcm0gaW5wdXQjYXJyaXZhbExvY2F0aW9uSWF0YUNvZGUnKTsKICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb24gPSBkZXN0aW5hdGlvbiAmJiBkZXN0aW5hdGlvbi52YWx1ZTsKCiAgICAgICAgICAgICAgICAgIHZhciBkYXRlU3RhcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZXhwYW5kU2VhcmNoRm9ybSBpbnB1dCNkZXBhcnR1cmVEYXRlcycpOwogICAgICAgICAgICAgICAgICBkYXRlU3RhcnQgPSBkYXRlU3RhcnQgJiYgZGF0ZVN0YXJ0LnZhbHVlOwogICAgICAgICAgICAgICAgICBpZiAoZGF0ZVN0YXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgZGF0ZVN0YXJ0ID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0ZVN0YXJ0LCAvKFxkezJ9KVwuKFxkezJ9KVwuKFxkezR9KS8sICIkMy0kMi0kMSIpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgZGF0ZUVuZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNleHBhbmRTZWFyY2hGb3JtIGlucHV0W25hbWU9Im1vZGVsLmFycml2YWxEYXRlIl0nKTsKICAgICAgICAgICAgICAgICAgZGF0ZUVuZCA9IGRhdGVFbmQgJiYgZGF0ZUVuZC52YWx1ZTsKICAgICAgICAgICAgICAgICAgaWYgKGRhdGVFbmQpIHsKICAgICAgICAgICAgICAgICAgICBkYXRlRW5kID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0ZUVuZCwgLyhcZHsyfSlcLihcZHsyfSlcLihcZHs0fSkvLCAiJDMtJDItJDEiKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbmN5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2V4cGFuZFNlYXJjaEZvcm0gaW5wdXRbbmFtZT0ibW9kZWwuY3VycmVuY3lUeXBlIl0nKTsKICAgICAgICAgICAgICAgICAgY3VycmVuY3kgPSBjdXJyZW5jeSAmJiBjdXJyZW5jeS52YWx1ZTsKCiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnb3JpZ2luJywgb3JpZ2luKTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2Rlc3RpbmF0aW9uJywgZGVzdGluYXRpb24pOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZVN0YXJ0JywgZGF0ZVN0YXJ0KTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVFbmQnLCBkYXRlRW5kKTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgY3VycmVuY3kpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2VPdXQ6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNpYmVfZXhhY3Rfb3V0Ym91bmRfZmxpZ2h0X3RhYmxlIC5zZWxlY3QtZmxpZ2h0cyBzcGFuW2RhdGEtcWE9ImFtb3VudCJdJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnLAogICAgICAgICAgICAgICAga2V5OiAnbWluUHJpY2VPdXQnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB0cmF2ZWxXaXRoUHJpY2VPdXQ6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNleGFjdF9vdXRib3VuZF9mbGlnaHRfdGFibGUgLnNlbGVjdC10YXJpZmYgc3BhbltkYXRhLXFhPSJhbW91bnQiXScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJywKICAgICAgICAgICAgICAgIGtleTogJ21pblByaWNlT3V0JwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcHJpY2VJbjogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnI2liZV9leGFjdF9pbmJvdW5kX2ZsaWdodF90YWJsZSAuc2VsZWN0LWZsaWdodHMgc3BhbltkYXRhLXFhPSJhbW91bnQiXScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJywKICAgICAgICAgICAgICAgIGtleTogJ21pblByaWNlSW4nCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB0cmF2ZWxXaXRoUHJpY2VJbjogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnI2V4YWN0X2luYm91bmRfZmxpZ2h0X3RhYmxlIC5zZWxlY3QtdGFyaWZmIHNwYW5bZGF0YS1xYT0iYW1vdW50Il0nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScsCiAgICAgICAgICAgICAgICBrZXk6ICdtaW5QcmljZUluJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyoua3VwaWJpbGV0LnJ1LyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogW3sKICAgICAgICAgICAgICAgICAgY3NzOiAnLnJlc3VsdHMtbGlzdC13cmFwJwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBjc3M6ICcucHJlbG9hZGVyJwogICAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgICBjYjogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBsb2NhdGlvbi5ocmVmOwogICAgICAgICAgICAgICAgICB2YXIgbSA9IHVybC5tYXRjaCgvXC9zZWFyY2hcLyg/Olx3XGR7M30pKFxkezJ9KShcd3szfSkoXHd7M30pKFx3ezN9KSg/OihcZHsyfSkoXHd7M30pKFx3ezN9KT8pPy8pOwoKICAgICAgICAgICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG0uc2hpZnQoKTsKCiAgICAgICAgICAgICAgICAgIGlmIChtWzZdKSB7CiAgICAgICAgICAgICAgICAgICAgdGJyLmVycm9yKCdNb3JlIHR3byB3YXkhJywgbSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgaXNPbmVXYXkgPSAhbVs0XTsKCiAgICAgICAgICAgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpOwoKICAgICAgICAgICAgICAgICAgdmFyIG1vbnRoTWFwID0gewogICAgICAgICAgICAgICAgICAgICdKQU4nOiAnMDEnLAogICAgICAgICAgICAgICAgICAgICdGRUInOiAnMDInLAogICAgICAgICAgICAgICAgICAgICdNQVInOiAnMDMnLAogICAgICAgICAgICAgICAgICAgICdBUFInOiAnMDQnLAogICAgICAgICAgICAgICAgICAgICdNQVknOiAnMDUnLAogICAgICAgICAgICAgICAgICAgICdKVU4nOiAnMDYnLAogICAgICAgICAgICAgICAgICAgICdKVUwnOiAnMDcnLAogICAgICAgICAgICAgICAgICAgICdBVUcnOiAnMDgnLAogICAgICAgICAgICAgICAgICAgICdTRVAnOiAnMDknLAogICAgICAgICAgICAgICAgICAgICdPQ1QnOiAxMCwKICAgICAgICAgICAgICAgICAgICAnTk9WJzogMTEsCiAgICAgICAgICAgICAgICAgICAgJ0RFQyc6IDEyCiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICB2YXIgZ2V0Rm9ybWF0RGF0ZSA9IGZ1bmN0aW9uKG1vbnRoLCBkYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgbW9udGggPSBtb250aE1hcFttb250aF07CgogICAgICAgICAgICAgICAgICAgIGlmICghbW9udGgpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIGNZZWFyID0gbm93LmdldFVUQ0Z1bGxZZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNEYXRlID0gbm93LmdldFVUQ0RhdGUoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgY01vbnRoID0gbm93LmdldFVUQ01vbnRoKCkgKyAxOwogICAgICAgICAgICAgICAgICAgIHZhciBpbnRNb250aCA9IHBhcnNlSW50KG1vbnRoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgaW50RGF0ZSA9IHBhcnNlSW50KGRhdGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChjTW9udGggPiBpbnRNb250aCB8fCAoY01vbnRoID09PSBpbnRNb250aCAmJiBpbnREYXRlIDwgY0RhdGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICBjWWVhciArPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFpbi52YWxpZGF0ZURhdGUoW2NZZWFyLCBtb250aCwgZGF0ZV0uam9pbignLScpKTsKICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwoKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIG1bMl0pOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGVzdGluYXRpb24nLCBtWzNdKTsKCiAgICAgICAgICAgICAgICAgIHZhciBkYXRlU3RhcnQgPSBnZXRGb3JtYXREYXRlKG1bMV0sIG1bMF0pOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZVN0YXJ0JywgZGF0ZVN0YXJ0KTsKCiAgICAgICAgICAgICAgICAgIHZhciBkYXRlRW5kID0gIWlzT25lV2F5ICYmIGdldEZvcm1hdERhdGUobVs1XSwgbVs0XSk7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CgogICAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZhLXJ1YicpKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgJ1JVQicpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBwcmljZVdhdGNoZXI6IHsKICAgICAgICAgICAgICBwcmljZTogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnbGkucmVzdWx0cy10b3RhbCBkaXYucmVzdWx0cy10b3RhbC1zdW0gPiBzcGFuID4gc3BhbicsCiAgICAgICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLnRyaXAucnUvKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgbG9jYXRpb25DaGVjazogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC9cL2ZsaWdodHNcL3NlYXJjaGVzXC8vLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNyZXN1bHRzLWNvbnRhaW5lcicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYjogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXNFbCA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2ZsaWdodHNfdmlld190eXBlX3RhYnMgYScpKTsKICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IG51bGw7CiAgICAgICAgICAgICAgICAgIHZhciByZSA9IC9lX3RyYXZlbF9mbGlnaHRzX3NlYXJjaC87CiAgICAgICAgICAgICAgICAgIHBhcmFtc0VsLnNvbWUoZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBoYXNQYXJhbXMgPSByZS50ZXN0KG5vZGUuaHJlZik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1BhcmFtcykgewogICAgICAgICAgICAgICAgICAgICAgdXJsID0gbm9kZS5ocmVmOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGlmICghdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgdGJyLmVycm9yKCdTZWFyY2ggdXJsIGlzIG5vdCBmb3VuZCEnKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBtb25vVXRpbHMucGFyc2VVcmwodXJsKTsKCiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwoKICAgICAgICAgICAgICAgICAgdmFyIG9yaWdpbiA9IHBhcmFtc1snZV90cmF2ZWxfZmxpZ2h0c19zZWFyY2hbZnJvbV0nXTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIG9yaWdpbik7CgogICAgICAgICAgICAgICAgICB2YXIgZGVzdGluYXRpb24gPSBwYXJhbXNbJ2VfdHJhdmVsX2ZsaWdodHNfc2VhcmNoW3RvXSddOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGVzdGluYXRpb24nLCBkZXN0aW5hdGlvbik7CgogICAgICAgICAgICAgICAgICB2YXIgZGF0ZVN0YXJ0ID0gcGFyYW1zWydlX3RyYXZlbF9mbGlnaHRzX3NlYXJjaFtkZXBhcnR1cmVdJ107CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlU3RhcnQnLCBkYXRlU3RhcnQpOwoKICAgICAgICAgICAgICAgICAgdmFyIGRhdGVFbmQgPSBwYXJhbXNbJ2VfdHJhdmVsX2ZsaWdodHNfc2VhcmNoW3JldHVybl0nXTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVFbmQnLCBkYXRlRW5kKTsKCiAgICAgICAgICAgICAgICAgIHZhciBjY3kgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbG9jYWxpemF0aW9uX3NlbGVjdG9yX2N1cnJlbmN5Jyk7CiAgICAgICAgICAgICAgICAgIGlmIChjY3kgJiYgY2N5LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgY2N5LnZhbHVlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5mbGlnaHRzLXByb2R1Y3QtZGV0YWlscyAucHJpY2Ugc3BhbiA+IGEnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLnNpbmRiYWQucnUvKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiBbewogICAgICAgICAgICAgICAgICBjc3M6ICcudHJpcHMnCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGNzczogJy53YWl0X2xvb3AnCiAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICByZXR1cm4gbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiAnQXBwLnNlYXJjaE1vZGVsLmF0dHJpYnV0ZXMucmVxdWVzdC5zcmMnLAogICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiAnQXBwLnNlYXJjaE1vZGVsLmF0dHJpYnV0ZXMucmVxdWVzdC5kc3QnLAogICAgICAgICAgICAgICAgICAgIGRhdGVTdGFydDogJ0FwcC5zZWFyY2hNb2RlbC5hdHRyaWJ1dGVzLnJlcXVlc3QuZGF0ZV9vdXQnLAogICAgICAgICAgICAgICAgICAgIGRhdGVFbmQ6ICdBcHAuc2VhcmNoTW9kZWwuYXR0cmlidXRlcy5yZXF1ZXN0LmRhdGVfaW4nCiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGRhdGFPYmopIHsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2F2aWEnKTsKCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIGRhdGFPYmoub3JpZ2luKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGVzdGluYXRpb24nLCBkYXRhT2JqLmRlc3RpbmF0aW9uKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZVN0YXJ0JywgZGF0YU9iai5kYXRlU3RhcnQpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0YU9iai5kYXRlRW5kKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ydWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCAnUlVCJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcudHJpcHMgLnRyaXAtd29ydGggLnRyaXAtd29ydGhfX3ByaWNlJywKICAgICAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyouYXZpYWthc3NhLnJ1LyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9yZXN1bHRzXC8vLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiBbewogICAgICAgICAgICAgICAgICBjc3M6ICcjcmVzdWx0TGlzdCcKICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHZhciBmb3JtU3dpdGNoID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ic2VhcmNoW3N3aXRjaF0iXScpOwogICAgICAgICAgICAgICAgICBmb3JtU3dpdGNoID0gZm9ybVN3aXRjaCAmJiBmb3JtU3dpdGNoLnZhbHVlOwoKICAgICAgICAgICAgICAgICAgbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiAnQVBSVF9EQVRBLnNlYXJjaFRpY2tldHMuY29kZUZyb20nLAogICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiAnQVBSVF9EQVRBLnNlYXJjaFRpY2tldHMuY29kZURlc3QnLAogICAgICAgICAgICAgICAgICAgIGRhdGVTdGFydDogJ0FQUlRfREFUQS5zZWFyY2hUaWNrZXRzLmRhdGVGcm9tJywKICAgICAgICAgICAgICAgICAgICBkYXRlRW5kOiAnQVBSVF9EQVRBLnNlYXJjaFRpY2tldHMuZGF0ZVRpbGwnLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdBUFJUX0RBVEEuc2VhcmNoVGlja2V0cy50eXBlJwogICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFPYmoudHlwZSAhPT0gJ2F2aWEnKSB7CiAgICAgICAgICAgICAgICAgICAgICBwYWdlLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdhdmlhJyk7CgogICAgICAgICAgICAgICAgICAgIGlmIChmb3JtU3dpdGNoID09PSAnbXVsdCcpIHsKICAgICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5kYXRlU3RhcnQgPT09IGRhdGFPYmouZGF0ZUVuZCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1Td2l0Y2ggPT09ICdvdycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YU9iai5kYXRlRW5kID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdvcmlnaW4nLCBkYXRhT2JqLm9yaWdpbik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2Rlc3RpbmF0aW9uJywgZGF0YU9iai5kZXN0aW5hdGlvbik7CgogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlU3RhcnQgPSBtYWluLnJlRm9ybWF0RGF0ZShkYXRhT2JqLmRhdGVTdGFydCwgLyhcZHsyfSlcLihcZHsyfSlcLihcZHs0fSkvLCAiJDMtJDItJDEiKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZVN0YXJ0JywgZGF0ZVN0YXJ0KTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVFbmQgPSBtYWluLnJlRm9ybWF0RGF0ZShkYXRhT2JqLmRhdGVFbmQsIC8oXGR7Mn0pXC4oXGR7Mn0pXC4oXGR7NH0pLywgIiQzLSQyLSQxIik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVFbmQnLCBkYXRlRW5kKTsKCiAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjY3k6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5wcmljZScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYjogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHZhciBjY3kgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJpY2UnKTsKICAgICAgICAgICAgICAgICAgaWYgKGNjeSkgewogICAgICAgICAgICAgICAgICAgIGlmICgv0YDRg9CxXC4vLnRlc3QoY2N5LnRleHRDb250ZW50KSkgewogICAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgJ1JVQicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNyZXN1bHRMaXN0IC5mbGlnaHQtcmVzdWx0IC5wcmljZScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyouYmlsZXRpeC5ydS8qJ10gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICBmb3JtV2F0Y2hlcjogewogICAgICAgICAgICAgIGN0cjogewogICAgICAgICAgICAgICAgcXVlcnk6IFt7CiAgICAgICAgICAgICAgICAgIGNzczogJy5mbGlnaHRzJwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBjc3M6ICcucHJvZ3Jlc3MtYWpheC1ib3JkZXInCiAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICBtYWluLmdldFBhcmFtc0Zyb21QYWdlKHsKICAgICAgICAgICAgICAgICAgICBvcmlnaW46ICd4Y250X3RyYW5zcG9ydF9mcm9tJywKICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogJ3hjbnRfdHJhbnNwb3J0X3RvJywKICAgICAgICAgICAgICAgICAgICBkYXRlU3RhcnQ6ICd4Y250X3RyYW5zcG9ydF9kZXBhcnRfZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgZGF0ZUVuZDogJ3hjbnRfdHJhbnNwb3J0X3JldHVybl9kYXRlJywKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQVBSVF9EQVRBLnNlYXJjaFRpY2tldHMudHlwZScKICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZGF0YU9iaikgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2JqLnR5cGUgIT09ICdhdmlhJykgewogICAgICAgICAgICAgICAgICAgICAgcGFnZS5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnb3JpZ2luJywgZGF0YU9iai5vcmlnaW4pOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkZXN0aW5hdGlvbicsIGRhdGFPYmouZGVzdGluYXRpb24pOwoKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZVN0YXJ0ID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0YU9iai5kYXRlU3RhcnQsIC8oXGR7NH0pKFxkezJ9KShcZHsyfSkvLCAiJDEtJDItJDMiKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZVN0YXJ0JywgZGF0ZVN0YXJ0KTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVFbmQgPSBtYWluLnJlRm9ybWF0RGF0ZShkYXRhT2JqLmRhdGVFbmQsIC8oXGR7NH0pKFxkezJ9KShcZHsyfSkvLCAiJDEtJDItJDMiKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZUVuZCcsIGRhdGVFbmQpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgY2N5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2N1cnJlbmN5X2Zvcm0gLnNlbGVjdGVkIGlucHV0W25hbWU9ImN1cnJlbmN5Il0nKTsKICAgICAgICAgICAgICAgICAgICBjY3kgPSBjY3kgJiYgY2N5LnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGlmIChjY3kpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChjY3kgPT09ICdSVVInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNjeSA9ICdSVUInOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgY2N5KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5vZmZlcnMgLm9mZmVyIC5wcmljZSAuY2FwdGlvbicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyoudXRhaXIucnUvKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiBbewogICAgICAgICAgICAgICAgICBjc3M6ICcuZGlyZWN0aW9uc193cmFwcGVyJwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBjc3M6ICcucHJvZ3Jlc3MtdGV4dCcKICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnYXZpYScpOwoKICAgICAgICAgICAgICAgICAgdmFyIG9yaWdpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2NhdGlvbi5kZXBhcnR1cmUgLmNvZGUnKTsKICAgICAgICAgICAgICAgICAgb3JpZ2luID0gb3JpZ2luICYmIG9yaWdpbi50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ29yaWdpbicsIG9yaWdpbik7CgogICAgICAgICAgICAgICAgICB2YXIgZGVzdGluYXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9jYXRpb24uYXJyaXZhbCAuY29kZScpOwogICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbiA9IGRlc3RpbmF0aW9uICYmIGRlc3RpbmF0aW9uLnRleHRDb250ZW50OwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGVzdGluYXRpb24nLCBkZXN0aW5hdGlvbik7CgogICAgICAgICAgICAgICAgICB2YXIgY2N5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQjbWF0cml4Y3VycmVuY3lbbmFtZT0iY3VycmVuY3kiXScpOwogICAgICAgICAgICAgICAgICBpZiAoY2N5KSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgY2N5LnZhbHVlKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuIG1haW4uZ2V0UGFyYW1zRnJvbVBhZ2UoewogICAgICAgICAgICAgICAgICAgIGRhdGVTdGFydDogJ2NmZ19zcGxpdF9mYXJlcy5zZWxlY3RlZF9kYXRlX3RvJywKICAgICAgICAgICAgICAgICAgICBkYXRlRW5kOiAnY2ZnX3NwbGl0X2ZhcmVzLnNlbGVjdGVkX2RhdGVfYmFjaycKICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZGF0YU9iaikgewogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlU3RhcnQgPSBtYWluLnJlRm9ybWF0RGF0ZShkYXRhT2JqLmRhdGVTdGFydCwgLyhcZHs0fSkoXGR7Mn0pKFxkezJ9KS8sICIkMS0kMi0kMyIpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlU3RhcnQnLCBkYXRlU3RhcnQpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZUVuZCA9IG1haW4ucmVGb3JtYXREYXRlKGRhdGFPYmouZGF0ZUVuZCwgLyhcZHs0fSkoXGR7Mn0pKFxkezJ9KS8sICIkMS0kMi0kMyIpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlRW5kJywgZGF0ZUVuZCk7CgogICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2VPdXQ6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5kaXJlY3Rpb24uZGlyZWN0aW9uLXRvIC5wcmljZScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJywKICAgICAgICAgICAgICAgIGtleTogJ21pblByaWNlT3V0JwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcHJpY2VJbjogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnLmRpcmVjdGlvbi5kaXJlY3Rpb24tYmFjayAucHJpY2UnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScsCiAgICAgICAgICAgICAgICBrZXk6ICdtaW5QcmljZUluJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyouYm9va2luZy4qLyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9ob3RlbFwvLy50ZXN0KHVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcjaG90ZWxUbXBsJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgICAgICAgdmFyIGhvdGVsTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNocF9ob3RlbF9uYW1lJyk7CiAgICAgICAgICAgICAgICAgIGhvdGVsTmFtZSA9IGhvdGVsTmFtZSAmJiBob3RlbE5hbWUudGV4dENvbnRlbnQudHJpbSgpOwogICAgICAgICAgICAgICAgICBpZiAoIWhvdGVsTmFtZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICByZXR1cm4gbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgY2l0eTogJ3V0YWdfZGF0YS5jaXR5X25hbWUnLAogICAgICAgICAgICAgICAgICAgIGNvdW50cnk6ICd1dGFnX2RhdGEuY291bnRyeV9uYW1lJywKICAgICAgICAgICAgICAgICAgICBkYXRlSW46ICd1dGFnX2RhdGEuZGF0ZV9pbicsCiAgICAgICAgICAgICAgICAgICAgZGF0ZU91dDogJ3V0YWdfZGF0YS5kYXRlX291dCcsCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6ICd1dGFnX2RhdGEuY3VycmVuY3knLAogICAgICAgICAgICAgICAgICAgIGFkdWx0czogJ3V0YWdfZGF0YS5hZHVsdHMnCiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGRhdGFPYmopIHsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2hvdGVsJyk7CgogICAgICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IFtob3RlbE5hbWVdOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2JqLmNpdHkgJiYgZGF0YU9iai5jb3VudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICBxdWVyeS51bnNoaWZ0KGhvdGVsTmFtZSArICcgJyArIGRhdGFPYmouY2l0eSArICcgJyArIGRhdGFPYmouY291bnRyeSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhT2JqLmNpdHkpIHsKICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5LnVuc2hpZnQoaG90ZWxOYW1lICsgJyAnICsgZGF0YU9iai5jaXR5KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFPYmouY291bnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgcXVlcnkudW5zaGlmdChob3RlbE5hbWUgKyAnICcgKyBkYXRhT2JqLmNvdW50cnkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ3F1ZXJ5JywgcXVlcnkpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZUluJywgZGF0YU9iai5kYXRlSW4pOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlT3V0JywgZGF0YU9iai5kYXRlT3V0KTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCBkYXRhT2JqLmN1cnJlbmN5KTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnYWR1bHRzJywgZGF0YU9iai5hZHVsdHMpOwoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcuYm9va2luZ19zdW1tYXJ5IC5yb29tUHJpY2Ugc3Ryb25nJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHByb2ZpbGVMaXN0WycqOi8vKi5hZ29kYS4qLyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9ob3RlbFwvLy50ZXN0KHVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcjaG90ZWwtaGVhZGVyJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgICAgICAgdmFyIGhvdGVsTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNob3RlbG5hbWUnKTsKICAgICAgICAgICAgICAgICAgaG90ZWxOYW1lICYmIChob3RlbE5hbWUgPSBob3RlbE5hbWUudGV4dENvbnRlbnQudHJpbSgpKTsKCiAgICAgICAgICAgICAgICAgIHZhciByb29tcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5vY2N1cGFuY3ktbnVtLnJvb21zJyk7CiAgICAgICAgICAgICAgICAgIHJvb21zICYmIChyb29tcyA9IHBhcnNlSW50KHJvb21zLnRleHRDb250ZW50KSk7CgogICAgICAgICAgICAgICAgICBpZiAoIWhvdGVsTmFtZSB8fCByb29tcyAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2hvdGVsJyk7CgogICAgICAgICAgICAgICAgICB2YXIgZGF0ZUluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQuY2hlY2tpbi1pbnB1dCcpOwogICAgICAgICAgICAgICAgICBkYXRlSW4gJiYgKGRhdGVJbiA9IGRhdGVJbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtZGF0ZScpKTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVJbicsIGRhdGVJbik7CgogICAgICAgICAgICAgICAgICB2YXIgZGF0ZU91dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0LmNoZWNrb3V0LWlucHV0Jyk7CiAgICAgICAgICAgICAgICAgIGRhdGVPdXQgJiYgKGRhdGVPdXQgPSBkYXRlT3V0LmdldEF0dHJpYnV0ZSgnZGF0YS1kYXRlJykpOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZU91dCcsIGRhdGVPdXQpOwoKICAgICAgICAgICAgICAgICAgdmFyIGFkdWx0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5vY2N1cGFuY3ktbnVtLmFkdWx0cycpOwogICAgICAgICAgICAgICAgICBhZHVsdHMgJiYgKGFkdWx0cyA9IHBhcnNlSW50KGFkdWx0cy50ZXh0Q29udGVudCkpOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnYWR1bHRzJywgYWR1bHRzKTsKCiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG1haW4uZ2V0UGFyYW1zRnJvbVBhZ2UoewogICAgICAgICAgICAgICAgICAgIGNpdHk6ICdydGFnX2NpdHluYW1lJwogICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CgogICAgICAgICAgICAgICAgICAgIHZhciBlbk5hbWUgPSBob3RlbE5hbWUubWF0Y2goL1woKC4rKVwpJC8pOwogICAgICAgICAgICAgICAgICAgIGVuTmFtZSA9IGVuTmFtZSAmJiBlbk5hbWVbMV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGVuTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgaG90ZWxOYW1lID0gaG90ZWxOYW1lLnJlcGxhY2UoJygnICsgZW5OYW1lICsgJyknLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW2hvdGVsTmFtZV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGVuTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgcXVlcnkucHVzaChlbk5hbWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5jaXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5OYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5LnVuc2hpZnQoZW5OYW1lICsgJyAnICsgZGF0YU9iai5jaXR5KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5LnVuc2hpZnQoaG90ZWxOYW1lICsgJyAnICsgZGF0YU9iai5jaXR5KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdxdWVyeScsIHF1ZXJ5KTsKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNjeTogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiBbCiAgICAgICAgICAgICAgICAgICAgJyNyb29tLWdyaWQtdGFibGUgLnByaWNlIHNwYW4ucm9vbS1ncm91cGluZy1yb29tLXByaWNlJywKICAgICAgICAgICAgICAgICAgICAnI3Jvb20tZ3JpZC10YWJsZSAucHJpY2UtcGFuZWwgLnNlbGxwcmljZScKICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgICAgICAgdmFyIGNjeSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXJyZW5jeScpOwogICAgICAgICAgICAgICAgICBjY3kgJiYgKGNjeSA9IGNjeS50ZXh0Q29udGVudCk7CgogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCBjY3kpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogWwogICAgICAgICAgICAgICAgICAgICcjcm9vbS1ncmlkLXRhYmxlIC5wcmljZSBzcGFuLnJvb20tZ3JvdXBpbmctcm9vbS1wcmljZScsCiAgICAgICAgICAgICAgICAgICAgJyNyb29tLWdyaWQtdGFibGUgLnByaWNlLXBhbmVsIC5zZWxscHJpY2UnCiAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJywKICAgICAgICAgICAgICAgIGtleTogJ29uZURheVByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyouaG90ZWxzLmNvbS8qJ10gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICBsb2NhdGlvbkNoZWNrOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICAgICAgICByZXR1cm4gL1wvaG90ZWxcL3xcL2hvXGQrXC8vLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNwcm9wZXJ0eS1kZXRhaWxzJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52Y2FyZCBoMVtpdGVtcHJvcD0ibmFtZSJdJyk7CiAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICYmIG5hbWUudGV4dENvbnRlbnQudHJpbSgpOwoKICAgICAgICAgICAgICAgICAgbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgZGF0ZUluOiAnY29tbW9uRGF0YUJsb2NrLnNlYXJjaC5jaGVja2luRGF0ZScsCiAgICAgICAgICAgICAgICAgICAgZGF0ZU91dDogJ2NvbW1vbkRhdGFCbG9jay5zZWFyY2guY2hlY2tvdXREYXRlJywKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnY29tbW9uRGF0YUJsb2NrLnByb3BlcnR5LmhvdGVsTmFtZScsCiAgICAgICAgICAgICAgICAgICAgY291bnRyeTogJ2NvbW1vbkRhdGFCbG9jay5wcm9wZXJ0eS5jb3VudHJ5JywKICAgICAgICAgICAgICAgICAgICBjaXR5OiAnY29tbW9uRGF0YUJsb2NrLnByb3BlcnR5LmNpdHknLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiAnY29tbW9uRGF0YUJsb2NrLnByb3BlcnR5LmZlYXR1cmVkUHJpY2UuY3VycmVuY3knLAogICAgICAgICAgICAgICAgICAgIHJvb21zOiAnY29tbW9uRGF0YUJsb2NrLnNlYXJjaC5udW1Sb29tcycsCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUm9vbXM6ICdjb21tb25EYXRhQmxvY2suc2VhcmNoLnJvb21zJwogICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFPYmoucm9vbXMgIT0gMSB8fCAhQXJyYXkuaXNBcnJheShkYXRhT2JqLnNlYXJjaFJvb21zKSB8fCBkYXRhT2JqLnNlYXJjaFJvb21zLmxlbmd0aCAhPT0gMSB8fCAhZGF0YU9iai5zZWFyY2hSb29tc1swXSkgewogICAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnaG90ZWwnKTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW107CiAgICAgICAgICAgICAgICAgICAgW2RhdGFPYmoubmFtZSwgbmFtZV0uZm9yRWFjaChmdW5jdGlvbihuYW1lLCBpbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKCFuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBxdWVyeS5wdXNoKG5hbWUpOwoKICAgICAgICAgICAgICAgICAgICAgIHZhciBwbGFjZSA9IFtkYXRhT2JqLmNpdHksIGRhdGFPYmouY291bnRyeV0uZmlsdGVyKGZ1bmN0aW9uKHBsYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhIXBsYWNlOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICBwbGFjZSA9IHBsYWNlLmpvaW4oJyAnKTsKCiAgICAgICAgICAgICAgICAgICAgICBxdWVyeS5zcGxpY2UoaW5kZXgsIDAsIFtuYW1lLCBwbGFjZV0uam9pbignICcpKTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ3F1ZXJ5JywgcXVlcnkpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZUluJywgZGF0YU9iai5kYXRlSW4pOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlT3V0JywgZGF0YU9iai5kYXRlT3V0KTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCBkYXRhT2JqLmN1cnJlbmN5KTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGFkdWx0cyA9IGRhdGFPYmouc2VhcmNoUm9vbXNbMF0ubnVtQWR1bHRzOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdhZHVsdHMnLCBhZHVsdHMpOwoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcjcm9vbXMtYW5kLXJhdGVzIC5jdXJyZW50LXByaWNlJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHByb2ZpbGVMaXN0WycqOi8vKi5vc3Ryb3Zvay5ydS8qJ10gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICBmb3JtV2F0Y2hlcjogewogICAgICAgICAgICAgIGN0cjogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiBbCiAgICAgICAgICAgICAgICAgICAgJy5yYXRlLXByaWNldmFsdWUnLAogICAgICAgICAgICAgICAgICAgICcuaG90ZWwtbWV0YXJvb20tcmF0ZS1wcmljZXZhbHVlJwogICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUsIHN1bW1hcnkpIHsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICB2YXIgaXNSb29tID0gL1wvcm9vbXNcLy8udGVzdChsb2NhdGlvbi5ocmVmKTsKICAgICAgICAgICAgICAgICAgdmFyIGlzSG90ZWwgPSAvXC9ob3RlbFwvLy50ZXN0KGxvY2F0aW9uLmhyZWYpOwoKICAgICAgICAgICAgICAgICAgaWYgKCFpc1Jvb20gJiYgIWlzSG90ZWwpIHsKICAgICAgICAgICAgICAgICAgICBwYWdlLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgYXN5bmMgPSB0aGlzLmFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIG1haW4uZ2V0UGFyYW1zRnJvbVBhZ2UoewogICAgICAgICAgICAgICAgICAgIGRhdGVJbjogJ3F1Yml0X2V2ZW50LnBhZ2VfY2hlY2tpbl9kYXRlJywKICAgICAgICAgICAgICAgICAgICBkYXRlT3V0OiAncXViaXRfZXZlbnQucGFnZV9jaGVja291dF9kYXRlJywKICAgICAgICAgICAgICAgICAgICBjaXR5OiAncXViaXRfZXZlbnQucGFnZV9jaXR5JywKICAgICAgICAgICAgICAgICAgICBjb3VudHJ5OiAncXViaXRfZXZlbnQucGFnZV9jb3VudHJ5JywKICAgICAgICAgICAgICAgICAgICBhZHVsdHM6ICdxdWJpdF9ldmVudC5wYWdlX2FkdWx0cycsCiAgICAgICAgICAgICAgICAgICAgY3VycmVuY3k6ICdxdWJpdF9ldmVudC5wcm9kdWN0X2N1cnJlbmN5JwogICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdob3RlbCcpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gxLmhvdGVsLWhlYWRlci10aXRsZScpOwogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICYmIG5hbWUudGV4dENvbnRlbnQ7CgogICAgICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IFtuYW1lXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5jaXR5ICYmIGRhdGFPYmouY291bnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgcXVlcnkudW5zaGlmdChuYW1lICsgJyAnICsgZGF0YU9iai5jaXR5ICsgJyAnICsgZGF0YU9iai5jb3VudHJ5KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFPYmouY2l0eSkgewogICAgICAgICAgICAgICAgICAgICAgcXVlcnkudW5zaGlmdChuYW1lICsgJyAnICsgZGF0YU9iai5jaXR5KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFPYmouY291bnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgcXVlcnkudW5zaGlmdChuYW1lICsgJyAnICsgZGF0YU9iai5jb3VudHJ5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ3F1ZXJ5JywgcXVlcnkpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnYWR1bHRzJywgZGF0YU9iai5hZHVsdHMpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdjdXJyZW5jeScsIGRhdGFPYmouY3VycmVuY3kpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZUluID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0YU9iai5kYXRlSW4sIC8oXGR7NH0pKFxkezJ9KShcZHsyfSkvLCAiJDEtJDItJDMiKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZUluJywgZGF0ZUluKTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVPdXQgPSBtYWluLnJlRm9ybWF0RGF0ZShkYXRhT2JqLmRhdGVPdXQsIC8oXGR7NH0pKFxkezJ9KShcZHsyfSkvLCAiJDEtJDItJDMiKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZU91dCcsIGRhdGVPdXQpOwoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNoYW5nZVBhZ2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJ2gxLmhvdGVsLWhlYWRlci10aXRsZScsCiAgICAgICAgICAgICAgICAgIGlzOiAncmVtb3ZlZCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYjogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHRici5sb2coJ3BhZ2UgY2hhbmdlIScpOwoKICAgICAgICAgICAgICAgICAgbWFpbi5jbG9zZUN1cnJlbnRCYXIoKTsKICAgICAgICAgICAgICAgICAgcGFnZS5jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogWwogICAgICAgICAgICAgICAgICAgICcucmF0ZS1wcmljZXZhbHVlJywKICAgICAgICAgICAgICAgICAgICAnLmhvdGVsLW1ldGFyb29tLXJhdGUtcHJpY2V2YWx1ZScKICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlLCBzdW1tYXJ5KSB7CiAgICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkTm9kZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgICAgICAgICAgdmFyIHByaWNlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IDAsIG5vZGU7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgICAgICBpID0gMDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoY2hpbGROb2RlID0gbm9kZS5jaGlsZE5vZGVzW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLm5vZGVUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0Q29udGVudCA9IGNoaWxkTm9kZS50ZXh0Q29udGVudC50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGV4dENvbnRlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IG1haW4ucHJlcGFyZVByaWNlKGNoaWxkTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0UHJpY2UoJ3ByaWNlJywgcHJpY2UpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyoudHJhdmVsLnJ1LyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGdldERhdGEgPSBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgdmFyIGNjeSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zd2l0Y2hlci1jaXR5IGJ1dHRvbicpOwogICAgICAgICAgICBjY3kgPSBjY3kgJiYgY2N5LnRleHRDb250ZW50OwogICAgICAgICAgICBjY3kgPSBjY3kgJiYgY2N5Lm1hdGNoKC8oW0EtWl17M30pLyk7CiAgICAgICAgICAgIGNjeSA9IGNjeSAmJiBjY3lbMV07CgogICAgICAgICAgICB2YXIgbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gxLmItaG90ZWxfdGl0bGUnKTsKICAgICAgICAgICAgbmFtZSA9IG5hbWUgJiYgbmFtZS50ZXh0Q29udGVudDsKICAgICAgICAgICAgbmFtZSA9IG5hbWUgJiYgbmFtZS50cmltKCk7CgogICAgICAgICAgICBpZiAoIWNjeSB8fCAhbmFtZSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHVybCA9IGxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBtb25vVXRpbHMucGFyc2VVcmwodXJsKTsKCiAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnaG90ZWwnKTsKCiAgICAgICAgICAgIHZhciBkYXRlSW4gPSBtYWluLnJlRm9ybWF0RGF0ZShwYXJhbXMuaW4sIC8oXGR7Mn0pXC4oXGR7Mn0pXC4oXGR7NH0pLywgIiQzLSQyLSQxIik7CiAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlSW4nLCBkYXRlSW4pOwoKICAgICAgICAgICAgdmFyIGRhdGVPdXQgPSBtYWluLnJlRm9ybWF0RGF0ZShwYXJhbXMub3V0LCAvKFxkezJ9KVwuKFxkezJ9KVwuKFxkezR9KS8sICIkMy0kMi0kMSIpOwogICAgICAgICAgICBwYWdlLnNldCgnZGF0ZU91dCcsIGRhdGVPdXQpOwoKICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW25hbWVdOwogICAgICAgICAgICB2YXIgaG90ZWxOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJyZWFkY3J1bWIgPiBsaS5hY3RpdmUgPiBzcGFuW3RpdGxlXScpOwogICAgICAgICAgICBob3RlbE5hbWUgPSBob3RlbE5hbWUgJiYgaG90ZWxOYW1lLnRpdGxlOwogICAgICAgICAgICBpZiAoaG90ZWxOYW1lKSB7CiAgICAgICAgICAgICAgcXVlcnkucHVzaChob3RlbE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhZ2Uuc2V0KCdxdWVyeScsIHF1ZXJ5KTsKCiAgICAgICAgICAgIHBhZ2Uuc2V0KCdhZHVsdHMnLCBwYXJhbXMub2NjKTsKICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgY2N5KTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9ob3RlbFwvLy50ZXN0KHVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcuYi1hdiAuYi1hdi1yYXRlX3ByaWNlX3J1YicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYjogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgICAgICAgICBnZXREYXRhKHByb2ZpbGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5iLWF2IC5iLWF2LXJhdGVfcHJpY2VfcnViJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHByb2ZpbGVMaXN0WycqOi8vKi5va3RvZ28ucnUvKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZ2V0RGF0YSA9IGZ1bmN0aW9uKHByb2ZpbGUsIGNiKSB7CiAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgcmV0dXJuIG1haW4uZ2V0UGFyYW1zRnJvbVBhZ2UoewogICAgICAgICAgICAgIG5hbWU6ICdBUFJUX0RBVEEuY3VycmVudFByb2R1Y3QubmFtZScsCiAgICAgICAgICAgICAgZGF0ZUluOiAnQVBSVF9EQVRBLnNlYXJjaFRpY2tldHMuZGF0ZUZyb20nLAogICAgICAgICAgICAgIGRhdGVPdXQ6ICdBUFJUX0RBVEEuc2VhcmNoVGlja2V0cy5kYXRlVGlsbCcsCiAgICAgICAgICAgICAgYWR1bHRzOiAnQVBSVF9EQVRBLnNlYXJjaFRpY2tldHMuY291bnQnLAogICAgICAgICAgICAgIGN1cnJlbmN5OiAnY3VycmVuY3knLAogICAgICAgICAgICAgIHR5cGU6ICdBUFJUX0RBVEEuc2VhcmNoVGlja2V0cy50eXBlJywKICAgICAgICAgICAgICBjb3VudHJ5OiAnQVBSVF9EQVRBLnNlYXJjaFRpY2tldHMuY291bnRyeScsCiAgICAgICAgICAgICAgY2l0eTogJ0FQUlRfREFUQS5zZWFyY2hUaWNrZXRzLmRlc3QnCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGRhdGFPYmopIHsKICAgICAgICAgICAgICBpZiAoZGF0YU9iai50eXBlICE9PSAnaG90ZWwnIHx8ICFkYXRhT2JqLm5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYigxKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnaG90ZWwnKTsKCiAgICAgICAgICAgICAgaWYgKGRhdGFPYmoubmFtZSkgewogICAgICAgICAgICAgICAgZGF0YU9iai5uYW1lID0gZGF0YU9iai5uYW1lLnRyaW0oKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBxdWVyeSA9IFtkYXRhT2JqLm5hbWVdOwogICAgICAgICAgICAgIGlmIChkYXRhT2JqLmNpdHkgJiYgZGF0YU9iai5jb3VudHJ5KSB7CiAgICAgICAgICAgICAgICBxdWVyeS51bnNoaWZ0KGRhdGFPYmoubmFtZSArICcgJyArIGRhdGFPYmouY2l0eSArICcgJyArIGRhdGFPYmouY291bnRyeSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhT2JqLmNpdHkpIHsKICAgICAgICAgICAgICAgIHF1ZXJ5LnVuc2hpZnQoZGF0YU9iai5uYW1lICsgJyAnICsgZGF0YU9iai5jaXR5KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFPYmouY291bnRyeSkgewogICAgICAgICAgICAgICAgcXVlcnkudW5zaGlmdChkYXRhT2JqLm5hbWUgKyAnICcgKyBkYXRhT2JqLmNvdW50cnkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBwYWdlLnNldCgncXVlcnknLCBxdWVyeSk7CgogICAgICAgICAgICAgIHBhZ2Uuc2V0KCdjdXJyZW5jeScsIGRhdGFPYmouY3VycmVuY3kpOwoKICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gbW9ub1V0aWxzLnBhcnNlVXJsKGxvY2F0aW9uLmhyZWYpOwogICAgICAgICAgICAgIGlmIChwYXJhbXMuaW4gJiYgcGFyYW1zLm91dCkgewogICAgICAgICAgICAgICAgdmFyIGRhdGVJbiA9IG1haW4ucmVGb3JtYXREYXRlKHBhcmFtcy5pbiwgLyhcZHsyfSlcLihcZHsyfSlcLihcZHs0fSkvLCAiJDMtJDItJDEiKTsKICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlSW4nLCBkYXRlSW4pOwoKICAgICAgICAgICAgICAgIHZhciBkYXRlT3V0ID0gbWFpbi5yZUZvcm1hdERhdGUocGFyYW1zLm91dCwgLyhcZHsyfSlcLihcZHsyfSlcLihcZHs0fSkvLCAiJDMtJDItJDEiKTsKICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlT3V0JywgZGF0ZU91dCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlSW4nLCBkYXRhT2JqLmRhdGVJbik7CiAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZU91dCcsIGRhdGFPYmouZGF0ZU91dCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocGFyYW1zLm9jYykgewogICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2FkdWx0cycsIHBhcmFtcy5vY2MpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYWdlLnNldCgnYWR1bHRzJywgZGF0YU9iai5hZHVsdHMpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2IoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICBmb3JtV2F0Y2hlcjogewogICAgICAgICAgICAgIGN0cjogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnLnByaWNlQ29udGFpbmVyICpbZGF0YS1wcmljZT0icGVyaW9kLXByaWNlIl0gc3Bhbi5ydWInCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICBtYWluLndhaXRSZXNwb25zZSg1MDAsIDIwLCBmdW5jdGlvbihjYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXREYXRhKHByb2ZpbGUsIGNiKTsKICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5wcmljZUNvbnRhaW5lciAqW2RhdGEtcHJpY2U9InBlcmlvZC1wcmljZSJdIHNwYW4ucnViJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHByb2ZpbGVMaXN0WycqOi8vKi5yb29tZ3VydS5ydS8qJ10gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICBsb2NhdGlvbkNoZWNrOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICAgICAgICByZXR1cm4gL1wvSG90ZWxcLy8udGVzdCh1cmwpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBmb3JtV2F0Y2hlcjogewogICAgICAgICAgICAgIGN0cjogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnI3JhdGVzU2VhcmNoUmVzdWx0c0hvbGRlcicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYjogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaDEuaGNfaHRsX2ludHJvX25hbWUnKTsKICAgICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUgJiYgbmFtZS50ZXh0Q29udGVudC50cmltKCk7CiAgICAgICAgICAgICAgICAgIGlmICghbmFtZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IG1vbm9VdGlscy5wYXJzZVVybChsb2NhdGlvbi5ocmVmKTsKICAgICAgICAgICAgICAgICAgdmFyIGFkdWx0cyA9IHBhcmFtcy5hZHVsdHNfMTsKCiAgICAgICAgICAgICAgICAgIHZhciBwbGFjZSA9IHBhcmFtcy5kZXN0aW5hdGlvbjsKICAgICAgICAgICAgICAgICAgcGxhY2UgPSBwbGFjZSAmJiBwbGFjZS5tYXRjaCgvcGxhY2U6KC4rKS8pOwogICAgICAgICAgICAgICAgICBwbGFjZSA9IHBsYWNlICYmIHBsYWNlWzFdLnRyaW0oKTsKCiAgICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IFtuYW1lXTsKICAgICAgICAgICAgICAgICAgaWYgKHBsYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgcXVlcnkudW5zaGlmdChuYW1lICsgJyAnICsgcGxhY2UpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgYXN5bmMgPSB0aGlzLmFzeW5jKCk7CgogICAgICAgICAgICAgICAgICBtYWluLmdldFBhcmFtc0Zyb21QYWdlKHsKICAgICAgICAgICAgICAgICAgICBmaWVsZHM6ICdIQy5Db21tb24uZmllbGRzJywKICAgICAgICAgICAgICAgICAgICBnQ3VycmVuY3lDb2RlOiAnZ0N1cnJlbmN5Q29kZScKICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZGF0YU9iaikgewogICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZHMgPSBkYXRhT2JqLmZpZWxkczsKICAgICAgICAgICAgICAgICAgICB2YXIgY2N5ID0gZGF0YU9iai5nQ3VycmVuY3lDb2RlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIWZpZWxkcyB8fCAhY2N5KSB7CiAgICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdob3RlbCcpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgncXVlcnknLCBxdWVyeSk7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2FkdWx0cycsIGFkdWx0cyk7CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlSW4nLCBmaWVsZHMuY2hlY2tpbik7CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVPdXQnLCBmaWVsZHMuY2hlY2tvdXQpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCBjY3kpOwoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcjaGNfaHRsX3BtX3JhdGVzX2NvbnRlbnQgLmhjX3RibF9jb2wyICNUb3RhbExpbmsnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLnRyaXBhZHZpc29yLnJ1LyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGdldERhdGEgPSBmdW5jdGlvbihwcm9maWxlLCBhc3luYykgewogICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgIHZhciBxdWVyeU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoMS5oZWFkZXInKTsKICAgICAgICAgICAgcXVlcnlOYW1lID0gcXVlcnlOYW1lICYmIHF1ZXJ5TmFtZS50ZXh0Q29udGVudC50cmltKCk7CgogICAgICAgICAgICB2YXIgbmFtZSA9IG51bGw7CiAgICAgICAgICAgIHZhciBhbHROYW1lID0gbnVsbDsKICAgICAgICAgICAgdmFyIG5hbWVOb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaDEuaGVhZGluZ19uYW1lJyk7CiAgICAgICAgICAgIGlmIChuYW1lTm9kZSkgewogICAgICAgICAgICAgIG5hbWVOb2RlID0gbmFtZU5vZGUuY2xvbmVOb2RlKHRydWUpOwogICAgICAgICAgICAgIHZhciBhbHRIZWFkID0gbmFtZU5vZGUucXVlcnlTZWxlY3RvcignLmFsdEhlYWQnKTsKICAgICAgICAgICAgICBpZiAoYWx0SGVhZCkgewogICAgICAgICAgICAgICAgYWx0TmFtZSA9IGFsdEhlYWQudGV4dENvbnRlbnQudHJpbSgpOwogICAgICAgICAgICAgICAgYWx0SGVhZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFsdEhlYWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBuYW1lID0gbmFtZU5vZGUudGV4dENvbnRlbnQudHJpbSgpOwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgdmFyIHRyZWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW1wcmVzc2lvblRyYWNraW5nVHJlZScpOwogICAgICAgICAgICB0cmVlID0gdHJlZSAmJiB0cmVlLmlubmVySFRNTDsKCiAgICAgICAgICAgIGlmICghdHJlZSkgewogICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY2N5ID0gdHJlZS5tYXRjaCgvXFxQQzooW0EtWl17M30pXFwvKTsKICAgICAgICAgICAgY2N5ID0gY2N5ICYmIGNjeVsxXTsKCiAgICAgICAgICAgIHZhciBkYXRlSW4gPSB0cmVlLm1hdGNoKC9cXENJOihcZHs0fS1cZHsyfS1cZHsyfSlcXC8pOwogICAgICAgICAgICBkYXRlSW4gPSBkYXRlSW4gJiYgZGF0ZUluWzFdOwoKICAgICAgICAgICAgdmFyIGRhdGVPdXQgPSB0cmVlLm1hdGNoKC9cXENPOihcZHs0fS1cZHsyfS1cZHsyfSlcXC8pOwogICAgICAgICAgICBkYXRlT3V0ID0gZGF0ZU91dCAmJiBkYXRlT3V0WzFdOwoKICAgICAgICAgICAgaWYgKCFuYW1lIHx8ICFjY3kgfHwgIWRhdGVJbiB8fCAhZGF0ZU91dCkgewogICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb21wb25lbnRzLmJyaWRnZSh7CiAgICAgICAgICAgICAgZnVuYzogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgICAgIHZhciBvYmogPSB7CiAgICAgICAgICAgICAgICAgIGFkdWx0c0NvdW50OiB0YS5yZXRyaWV2ZSgnbXVsdGlEUC5hZHVsdHNDb3VudCcpCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGNiKG9iaik7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjYjogZnVuY3Rpb24oZGF0YU9iaikgewogICAgICAgICAgICAgICAgaWYgKCFkYXRhT2JqIHx8ICFkYXRhT2JqLmFkdWx0c0NvdW50KSB7CiAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2hvdGVsJyk7CgogICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVJbicsIGRhdGVJbik7CiAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZU91dCcsIGRhdGVPdXQpOwogICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgY2N5KTsKCiAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBbbmFtZV07CiAgICAgICAgICAgICAgICBpZiAoYWx0TmFtZSkgewogICAgICAgICAgICAgICAgICBxdWVyeS5wdXNoKGFsdE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHF1ZXJ5TmFtZSkgewogICAgICAgICAgICAgICAgICBxdWVyeS51bnNoaWZ0KHF1ZXJ5TmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwYWdlLnNldCgncXVlcnknLCBxdWVyeSk7CgogICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2FkdWx0cycsIGRhdGFPYmouYWR1bHRzQ291bnQpOwoKICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcudmlld0RlYWxDaGV2cm9ucyAucHJpY2UnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICBnZXREYXRhKHByb2ZpbGUsIGFzeW5jKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcudmlld0RlYWxDaGV2cm9ucyAucHJpY2UnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScsCiAgICAgICAgICAgICAgICBrZXk6ICdvbmVEYXlQcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLmhpbHRvbi5jb20vKiddID0gcHJvZmlsZUxpc3RbJyo6Ly8qLmhpbHRvbi5ydS8qJ10gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBkZXRhaWxzID0gewogICAgICAgICAgICBsb2NhdGlvbkNoZWNrOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICAgICAgICByZXR1cm4gL1wvcmVzZXJ2YXRpb25cLy8udGVzdCh1cmwpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBmb3JtV2F0Y2hlcjogewogICAgICAgICAgICAgIGN0cjogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnI3Jvb21WaWV3UmVndWxhclZpZXcnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyLmhvdGVsTmFtZU5vTGluaycpOwogICAgICAgICAgICAgICAgICBuYW1lID0gbmFtZSAmJiBuYW1lLnRleHRDb250ZW50LnRyaW0oKTsKCiAgICAgICAgICAgICAgICAgIHZhciByb29tc0FkdWx0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdW1PY2N1cGFuY3knKTsKICAgICAgICAgICAgICAgICAgcm9vbXNBZHVsdHMgPSByb29tc0FkdWx0cyAmJiByb29tc0FkdWx0cy50ZXh0Q29udGVudC50cmltKCk7CgogICAgICAgICAgICAgICAgICB2YXIgY2N5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc2VsZWN0I2NoYW5nZUN1cnJlbmN5Jyk7CiAgICAgICAgICAgICAgICAgIGNjeSA9IGNjeSAmJiBjY3kudmFsdWU7CgogICAgICAgICAgICAgICAgICBpZiAoIW5hbWUgfHwgIXJvb21zQWR1bHRzIHx8ICFjY3kpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgbWFpbi5nZXRQYXJhbXNGcm9tUGFnZSh7CiAgICAgICAgICAgICAgICAgICAgZGF0ZUluZm86ICdkaWdpdGFsRGF0YS5wYWdlLmF0dHJpYnV0ZXMucHJvcGVydHlTZWFyY2hEYXRlSW5mbycKICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZGF0YU9iaikgewogICAgICAgICAgICAgICAgICAgIGlmICghZGF0YU9iai5kYXRlSW5mbykgewogICAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0VHlwZSgnaG90ZWwnKTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW25hbWVdOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdxdWVyeScsIHF1ZXJ5KTsKCiAgICAgICAgICAgICAgICAgICAgcm9vbXNBZHVsdHMgPSByb29tc0FkdWx0cy5tYXRjaCgvKFxkKykvZyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvb21zQWR1bHRzWzBdICE9ICcxJykgewogICAgICAgICAgICAgICAgICAgICAgYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2FkdWx0cycsIHJvb21zQWR1bHRzWzFdKTsKCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgY2N5KTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaERldGFpbHMgPSBkYXRhT2JqLmRhdGVJbmZvLnNwbGl0KCc6Jyk7CgogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlSW4gPSBzZWFyY2hEZXRhaWxzWzFdOwogICAgICAgICAgICAgICAgICAgIGRhdGVJbiA9IG1haW4ucmVGb3JtYXREYXRlKGRhdGVJbiwgLyhcZHsyfSkoXGR7Mn0pKFxkezR9KS8sICIkMy0kMS0kMiIpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlSW4nLCBkYXRlSW4pOwoKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZU91dCA9IHNlYXJjaERldGFpbHNbMl07CiAgICAgICAgICAgICAgICAgICAgZGF0ZU91dCA9IG1haW4ucmVGb3JtYXREYXRlKGRhdGVPdXQsIC8oXGR7Mn0pKFxkezJ9KShcZHs0fSkvLCAiJDMtJDEtJDIiKTsKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZU91dCcsIGRhdGVPdXQpOwoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcucHJpY2UgLnByaWNlYW1vdW50JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlLCBzdW1tYXJ5KSB7CiAgICAgICAgICAgICAgICAgIHZhciBhcnIgPSBbXTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IDAsIG5vZGU7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRlbCA9IG5vZGUucXVlcnlTZWxlY3RvcignZGVsJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlbCkgewogICAgICAgICAgICAgICAgICAgICAgZGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZGVsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2gobm9kZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgc3VtbWFyeS5hZGRlZCA9IGFycjsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJywKICAgICAgICAgICAgICAgIGtleTogJ29uZURheVByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyoubWFycmlvdHQuY29tLyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9yZXNlcnZhdGlvblwvLy50ZXN0KHVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcucmVzdWx0cy1jb250YWluZXInCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgdmFyIGFzeW5jID0gdGhpcy5hc3luYygpOwogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKCiAgICAgICAgICAgICAgICAgIG1haW4uZ2V0UGFyYW1zRnJvbVBhZ2UoewogICAgICAgICAgICAgICAgICAgIGRhdGFMYXllcjogJ2RhdGFMYXllcicKICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZGF0YU9iaikgewogICAgICAgICAgICAgICAgICAgIGlmICghZGF0YU9iai5kYXRhTGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai5kYXRhTGF5ZXIubnVtUm9vbXMgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdob3RlbCcpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGRhdGFPYmouZGF0YUxheWVyLnByb3BfbmFtZTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW25hbWVdOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2JqLmRhdGFMYXllci5wcm9wX2FkZHJlc3NfY2l0eSkgewogICAgICAgICAgICAgICAgICAgICAgcXVlcnkudW5zaGlmdChuYW1lICsgJyAnICsgZGF0YU9iai5kYXRhTGF5ZXIucHJvcF9hZGRyZXNzX2NpdHkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgncXVlcnknLCBxdWVyeSk7CgogICAgICAgICAgICAgICAgICAgIHZhciBhZHVsdHMgPSBkYXRhT2JqLmRhdGFMYXllci5udW1HdWVzdHNQZXJSb29tOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdhZHVsdHMnLCBhZHVsdHMpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVuY3kgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbmN5KSB7CiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tLXByaWNpbmctYmxvY2sgc3Bhbi50LW5pZ2h0bHknKTsKICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5ID0gY3VycmVuY3kgJiYgY3VycmVuY3kudGV4dENvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeSA9IGN1cnJlbmN5ICYmIGN1cnJlbmN5Lm1hdGNoKC8oW0EtWl17M30pXC8vKTsKICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5ID0gY3VycmVuY3kgJiYgY3VycmVuY3lbMV07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbmN5KSB7CiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeSA9IGRvY3VtZW50LmhlYWQuaW5uZXJIVE1MLm1hdGNoKC90bV9jdXJyZW5jeV90eXBlXHMqOlxzKiIoXHd7M30pIi8pOwogICAgICAgICAgICAgICAgICAgICAgY3VycmVuY3kgPSBjdXJyZW5jeSAmJiBjdXJyZW5jeVsxXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVuY3kpIHsKICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5ID0gZGF0YU9iai5kYXRhTGF5ZXIucHJvcF9jdXJyZW5jeV90eXBlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnY3VycmVuY3knLCBjdXJyZW5jeSk7CgogICAgICAgICAgICAgICAgICAgIHZhciBkYXRlSW4gPSBkYXRhT2JqLmRhdGFMYXllci5jaGNrSW5EYXQ7CiAgICAgICAgICAgICAgICAgICAgZGF0ZUluID0gbWFpbi5yZUZvcm1hdERhdGUoZGF0ZUluLCAvKFxkezJ9KVwvKFxkezJ9KVwvKFxkezR9KS8sICIkMy0kMS0kMiIpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlSW4nLCBkYXRlSW4pOwoKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZU91dCA9IGRhdGFPYmouZGF0YUxheWVyLmNoY2tPdXREYXRlOwogICAgICAgICAgICAgICAgICAgIGRhdGVPdXQgPSBtYWluLnJlRm9ybWF0RGF0ZShkYXRlT3V0LCAvKFxkezJ9KVwvKFxkezJ9KVwvKFxkezR9KS8sICIkMy0kMS0kMiIpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlT3V0JywgZGF0ZU91dCk7CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXlDb3VudCcsIGRhdGFPYmouZGF0YUxheWVyLm5tYk5pZ2h0cyk7CgogICAgICAgICAgICAgICAgICAgIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5yZXN1bHRzLWNvbnRhaW5lciAudC1wcmljZScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJywKICAgICAgICAgICAgICAgIGtleTogJ29uZURheVByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyouaG9zdGVsd29ybGQuY29tLyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9ob3N0ZWxkZXRhaWxzLy50ZXN0KHVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcucmVzdWx0Y29sdW1uJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNiOiBmdW5jdGlvbihwcm9maWxlKSB7CiAgICAgICAgICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgICAgICAgdmFyIHBhZ2UgPSBwcm9maWxlLnBhZ2U7CgogICAgICAgICAgICAgICAgICB2YXIgYXN5bmMgPSB0aGlzLmFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBtYWluLmdldFBhcmFtc0Zyb21QYWdlKHsKICAgICAgICAgICAgICAgICAgICBkYXRhTGF5ZXI6ICdkYXRhTGF5ZXInLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiAnJC5jdXJyZW5jeS5jb2RlJwogICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGFPYmouZGF0YUxheWVyKSkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBbXTsKICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgIGRhdGFPYmouZGF0YUxheWVyLmZvckVhY2goZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9iaiB8fCBvYmouZ3RtQXBwbGljYXRpb25FbnYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IG9iai5ndG1Qcm9wZXJ0eU5hbWU7CgogICAgICAgICAgICAgICAgICAgICAgdmFyIGNpdHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJjaXR5Il0nKTsKICAgICAgICAgICAgICAgICAgICAgIGNpdHkgPSBjaXR5ICYmIGNpdHkudmFsdWU7CgogICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50cnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJjb3VudHJ5Il0nKTsKICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnkgPSBjb3VudHJ5ICYmIGNvdW50cnkudmFsdWU7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGNpdHkgJiYgY291bnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeS5wdXNoKFtuYW1lLCBjaXR5LCBjb3VudHJ5XS5qb2luKCcgJykpOwogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaXR5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5LnB1c2goW25hbWUsIGNpdHldLmpvaW4oJyAnKSk7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvdW50cnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkucHVzaChbbmFtZSwgY291bnRyeV0uam9pbignICcpKTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBxdWVyeS5wdXNoKG5hbWUpOwoKICAgICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlSW4nLCBvYmouZ3RtQXJyaXZhbERhdGUpOwogICAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVPdXQnLCBvYmouZ3RtRGVwYXJ0dXJlRGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnYWR1bHRzJywgb2JqLmd0bVRvdGFsR3Vlc3RDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF5Q291bnQnLCBvYmouZ3RtVG90YWxHdWVzdENvdW50KTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdob3RlbCcpOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgncXVlcnknLCBxdWVyeSk7CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdjdXJyZW5jeScsIGRhdGFPYmouY3VycmVuY3kpOwoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcucm9vbXMgdHIgPiB0ZCA+IC5hdmVyYWdlcHJpY2UuY3VycmVuY3knCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdwcmljZScsCiAgICAgICAgICAgICAgICBrZXk6ICdvbmVEYXlQcmljZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIGRldGFpbHM7CiAgICAgICAgfTsKCiAgICAgICAgcHJvZmlsZUxpc3RbJyo6Ly8qLnRpa2V0LmNvbS8qJ10gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBnZXRPdXREYXRlID0gZnVuY3Rpb24oZGF0ZUluLCBkYXlzKSB7CiAgICAgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZShkYXRlSW4pOwogICAgICAgICAgICB2YXIgdGltZSA9IG5vdy5nZXRUaW1lKCk7CiAgICAgICAgICAgIHRpbWUgKz0gZGF5cyAqIDI0ICogNjAgKiA2MCAqIDEwMDA7CiAgICAgICAgICAgIG5vdyA9IG5ldyBEYXRlKHRpbWUpOwoKICAgICAgICAgICAgdmFyIHllYXIgPSBub3cuZ2V0VVRDRnVsbFllYXIoKTsKICAgICAgICAgICAgdmFyIG1vbnRoID0gbm93LmdldFVUQ01vbnRoKCkgKyAxOwogICAgICAgICAgICBpZiAobW9udGggPCAxMCkgewogICAgICAgICAgICAgIG1vbnRoID0gJzAnICsgbW9udGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGRhdGUgPSBub3cuZ2V0VVRDRGF0ZSgpOwogICAgICAgICAgICBpZiAoZGF0ZSA8IDEwKSB7CiAgICAgICAgICAgICAgZGF0ZSA9ICcwJyArIGRhdGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG1haW4udmFsaWRhdGVEYXRlKFt5ZWFyLCBtb250aCwgZGF0ZV0uam9pbignLScpKTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIGRldGFpbHMgPSB7CiAgICAgICAgICAgIGxvY2F0aW9uQ2hlY2s6IGZ1bmN0aW9uKHVybCkgewogICAgICAgICAgICAgIHJldHVybiAvXC9ob3RlbFwvLy50ZXN0KHVybCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvcm1XYXRjaGVyOiB7CiAgICAgICAgICAgICAgY3RyOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcucGlsaWgta2FtYXInCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2I6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHByb2ZpbGUucGFnZTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdob3RlbCcpOwoKICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IG1vbm9VdGlscy5wYXJzZVVybChsb2NhdGlvbi5ocmVmKTsKCiAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMucm9vbSAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkIGgxJyk7CiAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICYmIG5hbWUudGV4dENvbnRlbnQudHJpbSgpOwoKICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW25hbWVdOwoKICAgICAgICAgICAgICAgICAgdmFyIGFkZHJlc3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZCBzcGFuW2l0ZW1wcm9wPSJhZGRyZXNzIl0nKTsKICAgICAgICAgICAgICAgICAgYWRkcmVzcyA9IGFkZHJlc3MgJiYgYWRkcmVzcy50ZXh0Q29udGVudC50cmltKCk7CgogICAgICAgICAgICAgICAgICBpZiAoYWRkcmVzcykgewogICAgICAgICAgICAgICAgICAgIHF1ZXJ5LnVuc2hpZnQobmFtZSArICcgJyArIGFkZHJlc3MpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgcGxhY2UgPSBkb2N1bWVudC50aXRsZS5tYXRjaCgvXCgoW15cKV0rKVwpLyk7CiAgICAgICAgICAgICAgICAgIHBsYWNlID0gcGxhY2UgJiYgcGxhY2VbMV0udHJpbSgpOwogICAgICAgICAgICAgICAgICBpZiAocGxhY2UpIHsKICAgICAgICAgICAgICAgICAgICBxdWVyeS51bnNoaWZ0KG5hbWUgKyAnICcgKyBwbGFjZSkKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ3F1ZXJ5JywgcXVlcnkpOwogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZUluJywgcGFyYW1zLnN0YXJ0ZGF0ZSk7CgogICAgICAgICAgICAgICAgICBwYWdlLnNldCgnZGF0ZU91dCcsIGdldE91dERhdGUocGFyYW1zLnN0YXJ0ZGF0ZSwgcGFyYW1zLm5pZ2h0KSk7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdhZHVsdHMnLCBwYXJhbXMuYWR1bHQpOwoKICAgICAgICAgICAgICAgICAgdmFyIGNjeSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb25leSA+IGEnKTsKICAgICAgICAgICAgICAgICAgY2N5ID0gY2N5ICYmIGNjeS50ZXh0Q29udGVudC50cmltKCk7CiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdjdXJyZW5jeScsIGNjeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBwcmljZVdhdGNoZXI6IHsKICAgICAgICAgICAgICBwcmljZTogewogICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgY3NzOiAnLnBpbGloLWthbWFyIC5wcmljZSA+IC5jdXJyZW5jeScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ByaWNlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKCiAgICAgICAgICByZXR1cm4gZGV0YWlsczsKICAgICAgICB9OwoKICAgICAgICBwcm9maWxlTGlzdFsnKjovLyouaG90ZWxzY2xpY2suY29tLyonXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHJvb21UeXBlQWR1bHRNYXAgPSB7CiAgICAgICAgICAgIERCQzogMywKICAgICAgICAgICAgREJMOiAyLAogICAgICAgICAgICBFWFRSQTogMSwKICAgICAgICAgICAgSlJTOiAyLAogICAgICAgICAgICBRVUQ6IDQsCiAgICAgICAgICAgIFNHTDogMSwKICAgICAgICAgICAgU1RSOiAyLAogICAgICAgICAgICBUUkM6IDQsCiAgICAgICAgICAgIFRSUDogMywKICAgICAgICAgICAgVFNVOiAxLAogICAgICAgICAgICBUV0M6IDMsCiAgICAgICAgICAgIFRXTjogMgogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJy5yb29tQm9va2luZycKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYjogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwoKICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IG1vbm9VdGlscy5wYXJzZVVybChsb2NhdGlvbi5ocmVmKTsKICAgICAgICAgICAgICAgICAgdmFyIHJvb21UeXBlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMocm9vbVR5cGVBZHVsdE1hcCkuc29tZShmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtc1t0eXBlLnRvTG93ZXJDYXNlKCldKSB7CiAgICAgICAgICAgICAgICAgICAgICByb29tVHlwZSA9IHR5cGU7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgdmFyIGRhdGVJbiA9IHBhcmFtcy5mcm9tOwogICAgICAgICAgICAgICAgICB2YXIgZGF0ZU91dCA9IHBhcmFtcy50bzsKCiAgICAgICAgICAgICAgICAgIHZhciBhc3luYyA9IHRoaXMuYXN5bmMoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG1haW4uZ2V0UGFyYW1zRnJvbVBhZ2UoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdib29raW5nX3Jld3JpdGUnLAogICAgICAgICAgICAgICAgICAgIHJvb21zOiAnY3VycmVudF9yb29tJywKICAgICAgICAgICAgICAgICAgICBkYXRlSW46ICdnbG9iYWxfZnJvbWRhdGUnLAogICAgICAgICAgICAgICAgICAgIGRhdGVPdXQ6ICdnbG9iYWxfdG9kYXRlJywKICAgICAgICAgICAgICAgICAgICBkYXlDb3VudDogJ2dsb2JhbF9uaWdodHMnLAogICAgICAgICAgICAgICAgICAgIHJvb21UeXBlOiAnbkNvZGUnLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5OiAnY3VycmVuY3knCiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGRhdGFPYmopIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YU9iai50eXBlICE9PSAnaG90ZWxzJykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgYWR1bHRzID0gcm9vbVR5cGVBZHVsdE1hcFtkYXRhT2JqLnJvb21UeXBlIHx8IHJvb21UeXBlXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWFkdWx0cyB8fCBkYXRhT2JqLnJvb21zICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3luYygpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXRUeXBlKCdob3RlbCcpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoMS5ob3RlbCcpOwogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICYmIG5hbWUudGV4dENvbnRlbnQudHJpbSgpOwoKICAgICAgICAgICAgICAgICAgICBxdWVyeS5wdXNoKG5hbWUpOwoKICAgICAgICAgICAgICAgICAgICB2YXIgaG90ZWxJbmZvID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaG90ZWxfaW5mbyBzdHJvbmcnKSkuc2xpY2UoLTEpWzBdOwogICAgICAgICAgICAgICAgICAgIGhvdGVsSW5mbyA9IGhvdGVsSW5mbyAmJiBob3RlbEluZm8udGV4dENvbnRlbnQudHJpbSgpOwogICAgICAgICAgICAgICAgICAgIGhvdGVsSW5mbyAmJiBxdWVyeS51bnNoaWZ0KG5hbWUgKyAnICcgKyBob3RlbEluZm8pOwoKICAgICAgICAgICAgICAgICAgICBwYWdlLnNldCgncXVlcnknLCBxdWVyeSk7CgogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlSW4nLCBkYXRhT2JqLmRhdGVJbiB8fCBkYXRlSW4pOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlT3V0JywgZGF0YU9iai5kYXRlT3V0IHx8IGRhdGVPdXQpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdhZHVsdHMnLCBhZHVsdHMpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXlDb3VudCcsIGRhdGFPYmouZGF5Q291bnQpOwogICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdjdXJyZW5jeScsIGRhdGFPYmouY3VycmVuY3kpOwoKICAgICAgICAgICAgICAgICAgICBhc3luYygpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByaWNlV2F0Y2hlcjogewogICAgICAgICAgICAgIHByaWNlOiB7CiAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICBjc3M6ICcucm9vbUJvb2tpbmcgLmFncmVlbWVudC1yb3cgZGl2LnRvdGFsJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHByb2ZpbGVMaXN0WycqOi8vKi5ob3RlbHNjb21iaW5lZC5jb20vKiddID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZGV0YWlscyA9IHsKICAgICAgICAgICAgbG9jYXRpb25DaGVjazogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC9cL0hvdGVsXC8vLnRlc3QodXJsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm9ybVdhdGNoZXI6IHsKICAgICAgICAgICAgICBjdHI6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNoY19odGxfcG1fcmF0ZXNfY29udGVudCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjYjogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgICAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcHJvZmlsZS5wYWdlOwogICAgICAgICAgICAgICAgICBwYWdlLnNldFR5cGUoJ2hvdGVsJyk7CgogICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gbW9ub1V0aWxzLnBhcnNlVXJsKGxvY2F0aW9uLmhyZWYpOwoKICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcy5Sb29tcyAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gxLmhjX2h0bF9pbnRyb19uYW1lJyk7CiAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICYmIG5hbWUudGV4dENvbnRlbnQudHJpbSgpOwoKICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gW25hbWVdOwoKICAgICAgICAgICAgICAgICAgdmFyIHBsYWNlID0gZG9jdW1lbnQuaGVhZC5pbm5lckhUTUwubWF0Y2goL0hDXC5BZmZpbGlhdGVcLnNldEN1cnJlbnRQbGFjZU5hbWVcKCcoW14nXSspJ1wpLyk7CiAgICAgICAgICAgICAgICAgIHBsYWNlID0gcGxhY2UgJiYgcGxhY2VbMV07CiAgICAgICAgICAgICAgICAgIHBsYWNlICYmIHF1ZXJ5LnVuc2hpZnQobmFtZSArICcgJyArIHBsYWNlKTsKCiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdxdWVyeScsIHF1ZXJ5KTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2RhdGVJbicsIHBhcmFtcy5jaGVja2luKTsKCiAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0KCdkYXRlT3V0JywgcGFyYW1zLmNoZWNrb3V0KTsKICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2FkdWx0cycsIHBhcmFtcy5hZHVsdHNfMSk7CgogICAgICAgICAgICAgICAgICB2YXIgYXN5bmMgPSB0aGlzLmFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBtYWluLmdldFBhcmFtc0Zyb21QYWdlKHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogJ0hDLmdDdXJyZW5jeUNvZGUnCiAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGRhdGFPYmopIHsKCiAgICAgICAgICAgICAgICAgICAgcGFnZS5zZXQoJ2N1cnJlbmN5JywgZGF0YU9iai5jdXJyZW5jeSB8fCBwYXJhbXMuY3VycmVuY3lDb2RlKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jKCk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJpY2VXYXRjaGVyOiB7CiAgICAgICAgICAgICAgcHJpY2U6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICAgIGNzczogJyNoY19odGxfcG1fcmF0ZXNfY29udGVudCAjVG90YWxMaW5rJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAncHJpY2UnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwoKICAgICAgICAgIHJldHVybiBkZXRhaWxzOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBwcm9maWxlTGlzdDsKICAgICAgfTsKICAgICAgbWFpbi5wcm9maWxlTGlzdCA9IGdldFByb2ZpbGVMaXN0KHRicik7CiAgICB9KSgpOwogIH0sIGZ1bmN0aW9uIGlzQXZhaWxhYmxlKGluaXREYXRhKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgcHJlZmVyZW5jZSA9IGluaXREYXRhLmdldFByZWZlcmVuY2U7CgogICAgaWYgKCFwcmVmZXJlbmNlLmhhc0F2aWFCYXIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICghcHJlZmVyZW5jZS5hdmlhQmFyRW5hYmxlZCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfSwgZnVuY3Rpb24gc3luY0lzQXZhaWxhYmxlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNJZnJhbWUoKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdmFyIGxpc3QgPSBbCiAgICAgICcqOi8vKi5vem9uLnRyYXZlbC8qJywKICAgICAgJyo6Ly8qLm9uZXR3b3RyaXAuY29tLyonLAogICAgICAnKjovLyouc2t5c2Nhbm5lci4qLyonLAogICAgICAnKjovLyouYWVyb2Zsb3QucnUvKicsCiAgICAgICcqOi8vKi5tb21vbmRvLiovKicsCiAgICAgICcqOi8vKi5hbnl3YXlhbnlkYXkuY29tLyonLAogICAgICAnKjovLyouc3Z5YXpub3kudHJhdmVsLyonLAogICAgICAnKjovL2F2aWEudGlja2V0cy5ydS8qJywKICAgICAgJyo6Ly8qLnM3LnJ1LyonLAogICAgICAnKjovLyoua3VwaWJpbGV0LnJ1LyonLAogICAgICAnKjovLyoudHJpcC5ydS8qJywKICAgICAgJyo6Ly8qLnNpbmRiYWQucnUvKicsCiAgICAgICcqOi8vKi5hdmlha2Fzc2EucnUvKicsCiAgICAgICcqOi8vKi5iaWxldGl4LnJ1LyonLAogICAgICAnKjovLyoudXRhaXIucnUvKicsCgogICAgICAnKjovLyoua2F5YWsuKi8qJywKICAgICAgJyo6Ly8qLm9yYml0ei5jb20vKicsCiAgICAgICcqOi8vKi50cmF2ZWxvY2l0eS5jb20vKicsCiAgICAgICcqOi8vKi5leHBlZGlhLmNvbS8qJywKICAgICAgJyo6Ly8qLnByaWNlbGluZS5jb20vKicsCgogICAgICAnKjovLyouYm9va2luZy4qLyonLAogICAgICAnKjovLyouYWdvZGEuKi8qJywKICAgICAgJyo6Ly8qLmhvdGVscy5jb20vKicsCiAgICAgICcqOi8vKi5vc3Ryb3Zvay5ydS8qJywKICAgICAgJyo6Ly8qLnRyYXZlbC5ydS8qJywKICAgICAgJyo6Ly8qLm9rdG9nby5ydS8qJywKICAgICAgJyo6Ly8qLnJvb21ndXJ1LnJ1LyonLAogICAgICAnKjovLyoudHJpcGFkdmlzb3IucnUvKicsCiAgICAgICcqOi8vKi5oaWx0b24ucnUvKicsCiAgICAgICcqOi8vKi5oaWx0b24uY29tLyonLAogICAgICAnKjovLyoubWFycmlvdHQuY29tLyonLAoKICAgICAgJyo6Ly8qLmhvc3RlbHdvcmxkLmNvbS8qJywKICAgICAgJyo6Ly8qLnRpa2V0LmNvbS8qJywKICAgICAgJyo6Ly8qLmhvdGVsc2NsaWNrLmNvbS8qJywKICAgICAgJyo6Ly8qLmhvdGVsc2NvbWJpbmVkLmNvbS8qJwogICAgXTsKCiAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGxpc3RbaV07IGkrKykgewogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKG1vbm8udXJsUGF0dGVyblRvU3RyUmUoaXRlbSkpOwogICAgICBpZiAocmUudGVzdChsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0bmFtZSkpIHsKICAgICAgICBtb25vLmdsb2JhbC5hdmlhQmFyUHJvZmlsZSA9IGl0ZW07CiAgICAgICAgbW9uby5nbG9iYWwuZXhBdmlhQmFyID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9KTsKICAodHlwZW9mIG1vbm8gPT09ICd1bmRlZmluZWQnKSAmJiAobW9ubyA9IHsKICAgIGxvYWRNb2R1bGU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxvYWRNb2R1bGVTdGFjay5wdXNoKGFyZ3VtZW50cyk7CiAgICB9LAogICAgbG9hZE1vZHVsZVN0YWNrOiBbXQogIH0pOwoKICBtb25vLmxvYWRNb2R1bGUoJ3ZpbWVvJywgZnVuY3Rpb24obW9kdWxlTmFtZSwgaW5pdERhdGEpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgbGFuZ3VhZ2UgPSBpbml0RGF0YS5nZXRMYW5ndWFnZTsKICAgIHZhciBwcmVmZXJlbmNlID0gaW5pdERhdGEuZ2V0UHJlZmVyZW5jZTsKICAgIHZhciBtb2R1bGVTdGF0ZSA9IHByZWZlcmVuY2UubW9kdWxlVmltZW8gPyAxIDogMDsKICAgIHZhciBpZnJhbWUgPSBtb25vLmlzSWZyYW1lKCk7CgogICAgbW9uby5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnZ2V0TW9kdWxlSW5mbycpIHsKICAgICAgICBpZiAobWVzc2FnZS51cmwgIT09IGxvY2F0aW9uLmhyZWYpIHJldHVybjsKICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgc3RhdGU6IG1vZHVsZVN0YXRlLAogICAgICAgICAgbW9kdWxlTmFtZTogbW9kdWxlTmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2NoYW5nZVN0YXRlJykgewogICAgICAgIGlmIChtb2R1bGVOYW1lICE9PSBtZXNzYWdlLm1vZHVsZU5hbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZpbWVvLmNoYW5nZVN0YXRlKG1lc3NhZ2Uuc3RhdGUpOwogICAgICB9CiAgICB9KTsKCiAgICBpZiAobW9kdWxlU3RhdGUpIHsKICAgICAgbW9uby5hc3luY0NhbGwoZnVuY3Rpb24oKSB7CiAgICAgICAgdmltZW8ucnVuKCk7CiAgICAgIH0pOwogICAgfQoKICAgIHZhciB2aW1lbyA9IHsKICAgICAgcGFuZWxJZDogJ3NhdmVmcm9tX192aW1lb19saW5rcycsCiAgICAgIGJ0bkJveDogbnVsbCwKICAgICAgY2xpcElkOiBudWxsLAogICAgICB0aW1lcjogbnVsbCwKICAgICAgYnRuUHJlZml4OiAnc2RfbGRfYm50XycsCiAgICAgIHBvcHVwSXNTaG93OiBmYWxzZSwKICAgICAgZGxCdG5DbGFzc05hbWU6ICdzZi1kbC1idG4nLAogICAgICBjdXJyZW50TWVudTogbnVsbCwKICAgICAgbGlua0NhY2hlOiB7fSwKCiAgICAgIHJ1bjogZnVuY3Rpb24oKSB7CiAgICAgICAgbW9kdWxlU3RhdGUgPSAxOwogICAgICAgIGlmIChpZnJhbWUpIHsKICAgICAgICAgIHZpbWVvLmNsaXBJZCA9IHZpbWVvLmdldEZyYW1lQ2xpcElkKCk7CiAgICAgICAgICBpZiAodmltZW8uY2xpcElkKSB7CiAgICAgICAgICAgIHJldHVybiB2aW1lby5hcHBlbmRJZnJhbWVCdXR0b25zKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZnJhbWUgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMudmlkZW9GZWVkLmluamVjdFN0eWxlKCk7CgogICAgICAgIGlmIChTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIuaXNBdmFpbGFibGUoKSkgewogICAgICAgICAgdGhpcy5tdXRhdGlvbk1vZGUuZW5hYmxlKCk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgY2hhbmdlU3RhdGU6IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICAgICAgaWYgKGlmcmFtZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbW9kdWxlU3RhdGUgPSBzdGF0ZTsKCiAgICAgICAgdmltZW8udmlkZW9GZWVkLmRpc2FibGUoKTsKCiAgICAgICAgdmltZW8ucm1BbGxCdG4oKTsKCiAgICAgICAgdmltZW8ubXV0YXRpb25Nb2RlLnN0b3AoKTsKCiAgICAgICAgaWYgKHN0YXRlKSB7CiAgICAgICAgICB2aW1lby5ydW4oKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBoaWRlTWVudTogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHZpbWVvLmN1cnJlbnRNZW51KSB7CiAgICAgICAgICB2aW1lby5jdXJyZW50TWVudS5oaWRlKCk7CiAgICAgICAgICB2aW1lby5jdXJyZW50TWVudSA9IG51bGw7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZ2V0RnJhbWVDbGlwSWQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBmcmFtZUNsaXBJZCA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWYubWF0Y2goL3BsYXllclwudmltZW9cLmNvbVwvdmlkZW9cLyhbXHdcLV0rKS9pKTsKICAgICAgICBmcmFtZUNsaXBJZCA9IGZyYW1lQ2xpcElkICYmIGZyYW1lQ2xpcElkWzFdOwogICAgICAgIGlmIChmcmFtZUNsaXBJZCkgewogICAgICAgICAgcmV0dXJuIGZyYW1lQ2xpcElkOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGdldEJyb3dzZXJWaWRlb0RhdGE6IGZ1bmN0aW9uKGNvbnRhaW5lciwgaWQpIHsKICAgICAgICB2YXIgYnRuUGFyZW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy51cGxvYWRlZF9vbicpOwogICAgICAgIGlmICghYnRuUGFyZW50KSB7CiAgICAgICAgICBidG5QYXJlbnQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignI2luZm8gLm1ldGEgLnN0YXRzJyk7CiAgICAgICAgfQogICAgICAgIGlmICghYnRuUGFyZW50KSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICBpZCA9IGlkLm1hdGNoKC8oWzAtOV0rKSQvKTsKICAgICAgICAgIGlkID0gaWQgJiYgaWRbMV07CiAgICAgICAgfQogICAgICAgIGlmICghaWQpIHsKICAgICAgICAgIHZhciBmaXJzdExpbmsgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignYS5qcy10aXRsZScpIHx8IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdhJyk7CiAgICAgICAgICBpZiAoIWZpcnN0TGluaykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgdXJsID0gZmlyc3RMaW5rLmdldEF0dHJpYnV0ZSgnaHJlZicpOwogICAgICAgICAgaWYgKCF1cmwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWQgPSB1cmwubWF0Y2goL1wvKFswLTldKykkLyk7CiAgICAgICAgICBpZCA9IGlkICYmIGlkWzFdOwogICAgICAgIH0KICAgICAgICBpZiAoIWlkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpZDogaWQsCiAgICAgICAgICBwYXJlbnQ6IGJ0blBhcmVudCwKICAgICAgICAgIHN0eWxlOiAxCiAgICAgICAgfTsKICAgICAgfSwKCiAgICAgIGdldFZpZGVvSWQ6IGZ1bmN0aW9uKGNvbnRhaW5lcikgewogICAgICAgIGNvbnRhaW5lciA9IGNvbnRhaW5lciB8fCBkb2N1bWVudDsKICAgICAgICB2YXIgaWQgPSBudWxsOwogICAgICAgIHZhciBwbGF5ZXI7CgogICAgICAgIHBsYXllciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcucGxheWVyW2RhdGEtY2xpcC1pZF0nKTsKICAgICAgICBpZiAocGxheWVyKSB7CiAgICAgICAgICByZXR1cm4gcGxheWVyLmRhdGFzZXQuY2xpcElkOwogICAgICAgIH0KCiAgICAgICAgcGxheWVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXJbZGF0YS1mYWxsYmFjay11cmxdJyk7CiAgICAgICAgaWYgKHBsYXllcikgewogICAgICAgICAgdmFyIGZhbGxiYWNrVXJsID0gcGxheWVyLmRhdGFzZXQuZmFsbGJhY2tVcmwgfHwgJyc7CiAgICAgICAgICBmYWxsYmFja1VybCA9IGZhbGxiYWNrVXJsLm1hdGNoKC92aWRlb1wvKFswLTldKylcLy8pOwogICAgICAgICAgaWYgKGZhbGxiYWNrVXJsKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxsYmFja1VybFsxXTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHBsYXllciA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdkaXYucGxheWVyX3dyYXBwZXIgPiBkaXYuZmF1eF9wbGF5ZXJbZGF0YS1jbGlwX2lkXScpOwogICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgIGlkID0gcGxheWVyLmRhdGFzZXQuY2xpcF9pZDsKICAgICAgICAgIGlmIChpZCkgewogICAgICAgICAgICByZXR1cm4gaWQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKICAgICAgb25CdG5DbGljazogZnVuY3Rpb24odmlkZW9EYXRhLCBlKSB7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdmFyIGlkID0gdmlkZW9EYXRhLmlkOwoKICAgICAgICBpZiAoIWlkKSB7CiAgICAgICAgICB2YXIgY29udGFpbmVyID0gbnVsbDsKICAgICAgICAgIGlmICh2aWRlb0RhdGEucGxheWVyQ29udGFpbmVyKSB7CiAgICAgICAgICAgIGNvbnRhaW5lciA9IG1vbm8uZ2V0UGFyZW50KHZpZGVvRGF0YS5wYXJlbnQsIHZpZGVvRGF0YS5wbGF5ZXJDb250YWluZXIpOwogICAgICAgICAgfQogICAgICAgICAgaWQgPSB2aW1lby5nZXRWaWRlb0lkKGNvbnRhaW5lcik7CiAgICAgICAgfQoKICAgICAgICBpZiAoWzFdLmluZGV4T2YocHJlZmVyZW5jZS5jb2hvcnRJbmRleCkgIT09IC0xKSB7CiAgICAgICAgICB2YXIgaXNCcm93c2VDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jyb3dzZV9jb250ZW50Jyk7CiAgICAgICAgICBpZiAoaXNCcm93c2VDb250ZW50ICYmIGlzQnJvd3NlQ29udGVudC5jb250YWlucyh0aGlzKSkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ3ZpbWVvJywKICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICBlbDogJ3ZpZGVvLWxpc3QnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgZWM6ICd2aW1lbycsCiAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgZWw6ICd2aWRlby1zaW5nbGUnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgaXNCcm93c2VDb250ZW50ID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlmICh2aW1lby5jdXJyZW50TWVudSAmJiB2aW1lby5jdXJyZW50TWVudS5pc1Nob3cpIHsKICAgICAgICAgIHZpbWVvLmhpZGVNZW51KCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZnJvbUNhY2hlID0gdmltZW8ubGlua0NhY2hlW2lkXTsKICAgICAgICB2YXIgbGlua3MgPSBsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJzsKICAgICAgICBpZiAoZnJvbUNhY2hlKSB7CiAgICAgICAgICBsaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MudmltZW8oZnJvbUNhY2hlLmxpbmtzLCBmcm9tQ2FjaGUudGl0bGUpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRldGFpbHMgPSB7fTsKICAgICAgICBpZiAodmlkZW9EYXRhLnN0eWxlID09PSA0KSB7CiAgICAgICAgICBkZXRhaWxzLm9mZnNldFRvcCA9IDIwOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1lbnUgPSB2aW1lby5jdXJyZW50TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydCh0aGlzLCBsaW5rcywgJ3NmLXBvcHVwTWVudScsIGRldGFpbHMpOwoKICAgICAgICBpZiAoZnJvbUNhY2hlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgIGFjdGlvbjogJ2dldFZpbWVvTGlua3MnLAogICAgICAgICAgZXh0VmlkZW9JZDogaWQsCiAgICAgICAgICB1cmw6IGxvY2F0aW9uLmhyZWYKICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmxpbmtzKSB7CiAgICAgICAgICAgIHZpbWVvLmxpbmtDYWNoZVtpZF0gPSByZXNwb25zZTsKICAgICAgICAgICAgdmFyIG1lbnVMaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MudmltZW8ocmVzcG9uc2UubGlua3MsIHJlc3BvbnNlLnRpdGxlKTsKICAgICAgICAgICAgbWVudS51cGRhdGUobWVudUxpbmtzKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgbWVudS51cGRhdGUobGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kKTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIHJtQWxsQnRuOiBmdW5jdGlvbigpIHsKICAgICAgICBbJ3NmU2tpcCddLmZvckVhY2goZnVuY3Rpb24oYXR0cikgewogICAgICAgICAgdmFyIGRhdGFBdHRyID0gbW9uby5kYXRhQXR0cjJTZWxlY3RvcihhdHRyKTsKICAgICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbJyArIGRhdGFBdHRyICsgJ10nKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gZGF0YUF0dHJMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgaXRlbS5yZW1vdmVBdHRyaWJ1dGUoZGF0YUF0dHIpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgYnRuTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdmltZW8uZGxCdG5DbGFzc05hbWUpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gYnRuTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICBpZiAoaXRlbS5kYXRhc2V0LnNmVHlwZSA9PT0gJzEnIHx8IGl0ZW0uZGF0YXNldC5zZlR5cGUgPT09ICczJykgewogICAgICAgICAgICBpdGVtID0gaXRlbS5wYXJlbnROb2RlOwogICAgICAgICAgfQogICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGl0ZW0pOwogICAgICAgIH0KICAgICAgICB2aW1lby52aWRlb0ZlZWQucm1CdG4oKTsKCiAgICAgICAgdmltZW8uaGlkZU1lbnUoKTsKICAgICAgfSwKCiAgICAgIGFwcGVuZEJ0bjogZnVuY3Rpb24odmlkZW9EYXRhKSB7CiAgICAgICAgdmFyIGJveCA9IHZpZGVvRGF0YS5wYXJlbnQ7CgogICAgICAgIHZhciBleEJ0biA9IGJveC5xdWVyeVNlbGVjdG9yKCcuJyArIHZpbWVvLmRsQnRuQ2xhc3NOYW1lKTsKICAgICAgICBpZiAoZXhCdG4pIHsKICAgICAgICAgIGlmICghZXhCdG4uZGF0YXNldC5zZklkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGV4QnRuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZXhCdG4pOwogICAgICAgICAgZXhCdG4gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIGJ0bjsKICAgICAgICBpZiAodmlkZW9EYXRhLnN0eWxlID09PSAxKSB7CiAgICAgICAgICBidG4gPSBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICAgIGNsYXNzOiBbdmltZW8uZGxCdG5DbGFzc05hbWUsICdzZi1zdHlsZS0xJ10sCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgIHNmSWQ6IHZpZGVvRGF0YS5pZCwKICAgICAgICAgICAgICBzZlR5cGU6IHZpZGVvRGF0YS5zdHlsZQogICAgICAgICAgICB9LAogICAgICAgICAgICBocmVmOiAnIycgKyB2aWRlb0RhdGEuaWQKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmICh2aWRlb0RhdGEuc3R5bGUgPT09IDIpIHsKICAgICAgICAgIGJ0biA9IG1vbm8uY3JlYXRlKCdidXR0b24nLCB7CiAgICAgICAgICAgIHRleHQ6IGxhbmd1YWdlLmRvd25sb2FkLAogICAgICAgICAgICBjbGFzczogW3ZpbWVvLmRsQnRuQ2xhc3NOYW1lLCAnYnRuJywgJ2ljb25pZnlfZG93bl9iJ10sCiAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICBzZklkOiB2aWRlb0RhdGEuaWQsCiAgICAgICAgICAgICAgc2ZUeXBlOiB2aWRlb0RhdGEuc3R5bGUKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHZpZGVvRGF0YS5zdHlsZSA9PT0gMyB8fCB2aWRlb0RhdGEuc3R5bGUgPT09IDUpIHsKICAgICAgICAgIGJ0biA9IG1vbm8uY3JlYXRlKCdidXR0b24nLCB7CiAgICAgICAgICAgIGNsYXNzOiBbdmltZW8uZGxCdG5DbGFzc05hbWUsICdpcmlzX2J0bicsICdpcmlzX2J0bi1zd2l0Y2gnXSwKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgIHNmSWQ6IHZpZGVvRGF0YS5pZCwKICAgICAgICAgICAgICBzZlR5cGU6IHZpZGVvRGF0YS5zdHlsZQogICAgICAgICAgICB9LAogICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgICAgIGNsYXNzOiAnaXJpc19idG4tY29udGVudCcsCiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UuZG93bmxvYWQKICAgICAgICAgICAgICB9KQogICAgICAgICAgICBdCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAodmlkZW9EYXRhLnN0eWxlID09PSA0KSB7CiAgICAgICAgICBidG4gPSBtb25vLmNyZWF0ZSgnaScsIHsKICAgICAgICAgICAgY2xhc3M6IFt2aW1lby5kbEJ0bkNsYXNzTmFtZSwgJ3NmLXN0eWxlLTQnXSwKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgIHNmSWQ6IHZpZGVvRGF0YS5pZCwKICAgICAgICAgICAgICBzZlR5cGU6IHZpZGVvRGF0YS5zdHlsZQogICAgICAgICAgICB9LAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjRjhGOEY4JywKICAgICAgICAgICAgICB3aWR0aDogJzIwcHgnLAogICAgICAgICAgICAgIGhlaWdodDogJzIwcHgnLAogICAgICAgICAgICAgIGxpbmVIZWlnaHQ6IDAsCiAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJzEwcHgnLAogICAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICdtaWRkbGUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFwcGVuZDogbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dChbewogICAgICAgICAgICAgICAgc2VsZWN0b3I6ICcuJyArIHZpbWVvLmRsQnRuQ2xhc3NOYW1lICsgJy5zZi1zdHlsZS00JywKICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyM3Nzc3NzcnKSArICcpIGNlbnRlciBuby1yZXBlYXQgI0Y4RjhGOCcsCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnMTJweCcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJy4nICsgdmltZW8uZGxCdG5DbGFzc05hbWUgKyAnLnNmLXN0eWxlLTQ6aG92ZXInLAogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJ3VybCgnICsgU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnIzAwQjc1QScpICsgJykgY2VudGVyIG5vLXJlcGVhdCAjRjhGOEY4JywKICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAnLicgKyB2aW1lby5kbEJ0bkNsYXNzTmFtZSArICcuc2Ytc3R5bGUtNDphY3RpdmUnLAogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgb3V0bGluZTogMCwKICAgICAgICAgICAgICAgICAgYm94U2hhZG93OiAnaW5zZXQgMCAzcHggNXB4IHJnYmEoMCwgMCwgMCwgMC4xMjUpJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9KQogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKG1vbm8uaXNPcGVyYSkgewogICAgICAgICAgICBidG4uc3R5bGUuYmFja2dyb3VuZCA9ICcjRjhGOEY4JzsKICAgICAgICAgICAgYnRuLmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdpbWcnLCB7CiAgICAgICAgICAgICAgc3JjOiBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjNzc3Nzc3JyksCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIHdpZHRoOiAnMTJweCcsCiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMnB4JywKICAgICAgICAgICAgICAgIG1hcmdpbjogJzRweCcsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjRjhGOEY4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdmltZW8ub25CdG5DbGljay5iaW5kKGJ0biwgdmlkZW9EYXRhKSk7CgogICAgICAgIGlmICh2aWRlb0RhdGEuc3R5bGUgPT09IDEpIHsKICAgICAgICAgIGJ0biA9IG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICBidG4sCiAgICAgICAgICAgICAgJyB8ICcKICAgICAgICAgICAgXQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodmlkZW9EYXRhLnN0eWxlID09PSAzKSB7CiAgICAgICAgICBidG4gPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICBjbGFzczogJ2NsaXBfaW5mby11c2VyX2FjdGlvbnMnLAogICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICBidG4KICAgICAgICAgICAgXQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodmlkZW9EYXRhLnN0eWxlID09PSAxIHx8IHZpZGVvRGF0YS5zdHlsZSA9PT0gMikgewogICAgICAgICAgdmFyIGZpcnN0Q2hpbGQgPSBib3guZmlyc3RDaGlsZDsKICAgICAgICAgIGlmIChmaXJzdENoaWxkKSB7CiAgICAgICAgICAgIGJveC5pbnNlcnRCZWZvcmUoYnRuLCBmaXJzdENoaWxkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJveC5hcHBlbmRDaGlsZChidG4pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBib3guYXBwZW5kQ2hpbGQoYnRuKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBwbGF5ZXJTdGF0ZUNoYW5nZU9ic2VydmVyOiBudWxsLAogICAgICBvYnNlcnZlVmlkZW9VaTogZnVuY3Rpb24oYnRuT2JqLCBub2RlKSB7CiAgICAgICAgdmFyIHBsYXllck1lbnUgPSBub2RlOwogICAgICAgIGlmIChwbGF5ZXJNZW51KSB7CiAgICAgICAgICB2YXIgaGlkZUJ0blRpbWVyID0gbnVsbDsKICAgICAgICAgIHZhciBjb250cm9sc1JlID0gLyhcc3xeKXdpdGgtY29udHJvbHMoXHN8JCkvOwogICAgICAgICAgaWYgKHRoaXMucGxheWVyU3RhdGVDaGFuZ2VPYnNlcnZlcikgewogICAgICAgICAgICB0aGlzLnBsYXllclN0YXRlQ2hhbmdlT2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5wbGF5ZXJTdGF0ZUNoYW5nZU9ic2VydmVyID0gU2F2ZUZyb21fVXRpbHMubXV0YXRpb25BdHRyV2F0Y2hlci5ydW4oewogICAgICAgICAgICBhdHRyOiAnY2xhc3MnLAogICAgICAgICAgICB0YXJnZXQ6IHBsYXllck1lbnUsCiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdW1tYXJ5TGlzdCkgewogICAgICAgICAgICAgIHZhciBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMF07CiAgICAgICAgICAgICAgdmFyIHNob3dCZWZvcmUgPSAhY29udHJvbHNSZS50ZXN0KHN1bW1hcnkub2xkVmFsdWUpOwogICAgICAgICAgICAgIHZhciBzaG93QWZyZXQgPSAhY29udHJvbHNSZS50ZXN0KHN1bW1hcnkudmFsdWUpOwogICAgICAgICAgICAgIGlmICghc2hvd0JlZm9yZSAmJiBzaG93QWZyZXQpIHsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChoaWRlQnRuVGltZXIpOwogICAgICAgICAgICAgICAgaGlkZUJ0blRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgaWYgKCFidG5PYmoubG9ja0hpZGUpIHsKICAgICAgICAgICAgICAgICAgICBidG5PYmouY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3NmLWhpZGUtdWknKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBpZiAoc2hvd0JlZm9yZSAmJiAhc2hvd0FmcmV0KSB7CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoaGlkZUJ0blRpbWVyKTsKICAgICAgICAgICAgICAgIGJ0bk9iai5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2YtaGlkZS11aScpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgYXBwZW5kSWZyYW1lQnV0dG9uczogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgYnRuT2JqID0gU2F2ZUZyb21fVXRpbHMuZnJhbWVNZW51LmdldEJ0bih7CiAgICAgICAgICBxdWlja0J0blN0eWxlT2JqOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICBib3JkZXI6IDAsCiAgICAgICAgICAgIGJvcmRlclJhZGl1czogJy4zZW0nLAogICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJywKICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsCiAgICAgICAgICAgIHBhZGRpbmc6ICc2cHggOHB4JwogICAgICAgICAgfSwKICAgICAgICAgIHF1aWNrQnRuQ3NzU3R5bGU6IHsKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgyMywzNSwzNCwuNzUpJwogICAgICAgICAgfSwKICAgICAgICAgIHF1aWNrQnRuT3ZlckNzc1N0eWxlOiB7CiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYigwLCAxNzMsIDIzOSknCiAgICAgICAgICB9LAogICAgICAgICAgbm9kZUNzc1N0eWxlOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJwogICAgICAgICAgfSwKICAgICAgICAgIHNpbmdsZUJ0bjogdHJ1ZSwKICAgICAgICAgIGJ0bklkOiBfdGhpcy5wYW5lbElkLAogICAgICAgICAgY29udGFpbmVyU3R5bGU6IHsKICAgICAgICAgICAgbGVmdDogJzEwcHgnLAogICAgICAgICAgICB0b3A6ICcxMHB4JwogICAgICAgICAgfSwKICAgICAgICAgIHF1aWNrQnRuSWNvbjogbW9uby5jcmVhdGUoU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFN2ZygnZG93bmxvYWQnLCAnI2ZmZmZmZicpLCB7CiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgd2lkdGg6ICcxNnB4JywKICAgICAgICAgICAgICBoZWlnaHQ6ICcxNnB4JywKICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIG9uOiBbCiAgICAgICAgICAgIFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgICAgIGlmIChfdGhpcy5jdXJyZW50TWVudSAmJiBfdGhpcy5jdXJyZW50TWVudS5pc1Nob3cpIHsKICAgICAgICAgICAgICAgIF90aGlzLmhpZGVNZW51KCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgaWQgPSBfdGhpcy5jbGlwSWQ7CiAgICAgICAgICAgICAgdmFyIGZyb21DYWNoZSA9IF90aGlzLmxpbmtDYWNoZVtpZF07CiAgICAgICAgICAgICAgdmFyIGxpbmtzID0gbGFuZ3VhZ2UuZG93bmxvYWQgKyAnIC4uLic7CiAgICAgICAgICAgICAgaWYgKGZyb21DYWNoZSkgewogICAgICAgICAgICAgICAgbGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzLnZpbWVvKGZyb21DYWNoZS5saW5rcywgZnJvbUNhY2hlLnRpdGxlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBtZW51ID0gX3RoaXMuY3VycmVudE1lbnUgPSBTYXZlRnJvbV9VdGlscy5mcmFtZU1lbnUuZ2V0TWVudSh0aGlzLCBsaW5rcywgJ3NmLWZyYW1lLW1lbnUnLCB7CiAgICAgICAgICAgICAgICBsZWZ0TWVudVBvczogdHJ1ZSwKICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogYnRuT2JqLmNvbnRhaW5lciwKICAgICAgICAgICAgICAgIG9uU2hvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIGJ0bk9iai5ub2RlLmNsYXNzTGlzdC5hZGQoJ3NmLW92ZXInKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbkhpZGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBfdGhpcy5jdXJyZW50TWVudSA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGJ0bk9iai5ub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3NmLW92ZXInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKCFmcm9tQ2FjaGUpIHsKICAgICAgICAgICAgICAgIF90aGlzLmdldExpbmtzRnJvbVBhZ2UoZnVuY3Rpb24obGlua3MsIHRpdGxlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBtZW51TGlua3MgPSBsYW5ndWFnZS5ub0xpbmtzRm91bmQ7CiAgICAgICAgICAgICAgICAgIGlmIChsaW5rcykgewogICAgICAgICAgICAgICAgICAgIF90aGlzLmxpbmtDYWNoZVtpZF0gPSB7CiAgICAgICAgICAgICAgICAgICAgICBsaW5rczogbGlua3MsCiAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIG1lbnVMaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MudmltZW8obGlua3MsIHRpdGxlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtZW51TGlua3MpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSwKICAgICAgICAgICAgWydtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICBpZiAoZS5idXR0b24gPT09IDIpIHsKICAgICAgICAgICAgICAgIGlmIChvYnNlcnZlcikgewogICAgICAgICAgICAgICAgICBvYnNlcnZlci5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIG9ic2VydmVyID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpcy5oaWRlTWVudSgpOwoKICAgICAgICAgICAgICAgIGlmIChidG5PYmouY29udGFpbmVyLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgYnRuT2JqLmNvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGJ0bk9iai5jb250YWluZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0KICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgYnRuT2JqLnF1aWNrQnRuLnRpdGxlID0gbGFuZ3VhZ2UuZG93bmxvYWQ7CgogICAgICAgIGJ0bk9iai5jb250YWluZXIgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgY2xhc3M6ICdzZi1idG4tY3RyJywKICAgICAgICAgIGFwcGVuZDogYnRuT2JqLm5vZGUKICAgICAgICB9KTsKCiAgICAgICAgbW9uby5vbihidG5PYmouY29udGFpbmVyLCAnbW91c2VlbnRlcicsIGZ1bmN0aW9uKCkgewogICAgICAgICAgYnRuT2JqLmxvY2tIaWRlID0gdHJ1ZTsKICAgICAgICB9KTsKCiAgICAgICAgbW9uby5vbihidG5PYmouY29udGFpbmVyLCAnbW91c2VsZWF2ZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgYnRuT2JqLmxvY2tIaWRlID0gZmFsc2U7CiAgICAgICAgfSk7CgogICAgICAgIGJ0bk9iai5ub2RlLmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dChbewogICAgICAgICAgICBzZWxlY3RvcjogWwogICAgICAgICAgICAgICdib2R5OmhvdmVyIC5zZi1idG4tY3RyOm5vdCguc2YtaGlkZS11aSkgIycgKyBfdGhpcy5wYW5lbElkLAogICAgICAgICAgICAgICdib2R5OmhvdmVyIC5zZi1idG4tY3RyOm5vdCguc2YtaGlkZS11aSkgLnNmLWZyYW1lLW1lbnUnCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJwogICAgICAgICAgICB9CiAgICAgICAgICB9XSkKICAgICAgICB9KSk7CgogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYnRuT2JqLmNvbnRhaW5lcik7CgoKICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIucnVuKHsKICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdW1tYXJ5TGlzdCkgewogICAgICAgICAgICB2YXIgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzBdOwogICAgICAgICAgICB2YXIgbm9kZSA9IHN1bW1hcnkuYWRkZWRbMF07CiAgICAgICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgICAgX3RoaXMub2JzZXJ2ZVZpZGVvVWkoYnRuT2JqLCBub2RlKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgb2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgICAgICAgb2JzZXJ2ZXIgPSBudWxsOwogICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgcXVlcmllczogW3sKICAgICAgICAgICAgY3NzOiAnI3BsYXllciAuY2FwdGlvbnNbYXJpYS1saXZlPSJhc3NlcnRpdmUiXScsCiAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICB9XQogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgZ2V0TGlua3NGcm9tUGFnZTogZnVuY3Rpb24oY2IpIHsKICAgICAgICB2YXIgcmVMaXN0ID0gWwogICAgICAgICAgLyJ2aWRlbyI6ey8sCiAgICAgICAgICAvInJlcXVlc3QiOnsvLAogICAgICAgICAgLyJmaWxlcyI6LwogICAgICAgIF07CiAgICAgICAgdmFyIHNjcmlwdExpc3QgPSBtb25vLmdldFBhZ2VTY3JpcHQoZG9jdW1lbnQuYm9keS5pbm5lckhUTUwsIHJlTGlzdCk7CgogICAgICAgIHZhciBjb25maWcgPSBudWxsOwogICAgICAgIHNjcmlwdExpc3Quc29tZShmdW5jdGlvbihzY3JpcHQpIHsKICAgICAgICAgIHZhciBqc29uTGlzdCA9IG1vbm8uZmluZEpzb24oc2NyaXB0LCByZUxpc3QpOwogICAgICAgICAgcmV0dXJuIGpzb25MaXN0LnNvbWUoZnVuY3Rpb24oanNvbikgewogICAgICAgICAgICBpZiAoanNvbi52aWRlbyAmJiBqc29uLnJlcXVlc3QgJiYganNvbi5yZXF1ZXN0LmZpbGVzKSB7CiAgICAgICAgICAgICAgY29uZmlnID0ganNvbjsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHJlcXVlc3QgPSBudWxsOwogICAgICAgIHZhciBsaW5rcyA9IG51bGw7CiAgICAgICAgdmFyIHRpdGxlID0gbnVsbDsKCiAgICAgICAgdmFyIG9uUmVzcG9uc2UgPSBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGxpbmtzID0gcmVzcG9uc2UubGlua3MgfHwgbnVsbDsKICAgICAgICAgICAgdGl0bGUgPSByZXNwb25zZS50aXRsZSB8fCBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBjYihsaW5rcywgdGl0bGUpOwogICAgICAgIH07CgogICAgICAgIGlmIChjb25maWcpIHsKICAgICAgICAgIHJlcXVlc3QgPSB7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFZpbWVvTGlua3NGcm9tQ29uZmlnJywKICAgICAgICAgICAgY29uZmlnOiBjb25maWcKICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIG1vbm8uc2VuZE1lc3NhZ2UocmVxdWVzdCwgb25SZXNwb25zZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlcXVlc3QgPSB7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFZpbWVvTGlua3MnLAogICAgICAgICAgICBleHRWaWRlb0lkOiB2aW1lby5jbGlwSWQKICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIG1vbm8uc2VuZE1lc3NhZ2UocmVxdWVzdCwgb25SZXNwb25zZSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgdmlkZW9GZWVkOiB7CiAgICAgICAgYnRuQ2xhc3NOYW1lOiAnc2YtZmVlZC1kbC1idG4nLAogICAgICAgIHN0eWxlOiBudWxsLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAgICAgdmFyIGlkID0gdGhpcy5kYXRhc2V0LnNmSWQ7CiAgICAgICAgICB2YXIgaXNDb3VjaE1vZGUgPSB0aGlzLmRhdGFzZXQuc2ZDb3VjaE1vZGUgPiAwOwoKICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgdmFyIGlzQnJvemFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jyb3phcicpOwogICAgICAgICAgICB2YXIgaXNCcm93c2VDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jyb3dzZV9jb250ZW50Jyk7CiAgICAgICAgICAgIGlmIChpc0NvdWNoTW9kZSkgewogICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICAgIGVjOiAndmltZW8nLAogICAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgICBlbDogJ3ZpZGVvLXBsYXllcicKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGlmIChpc0Jyb3phciAmJiBpc0Jyb3phci5jb250YWlucyh0aGlzKSkgewogICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICAgIGVjOiAndmltZW8nLAogICAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgICBlbDogJ3ZpZGVvLWRpc2NvdmVyJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgaWYgKGlzQnJvd3NlQ29udGVudCAmJiBpc0Jyb3dzZUNvbnRlbnQuY29udGFpbnModGhpcykpIHsKICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICBlYzogJ3ZpbWVvJywKICAgICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgICAgZWw6ICd2aWRlby1saXN0JwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICAgIGVjOiAndmltZW8nLAogICAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgICBlbDogJ3ZpZGVvLW90aGVyJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHZpbWVvLmN1cnJlbnRNZW51ICYmIHZpbWVvLmN1cnJlbnRNZW51LmlzU2hvdykgewogICAgICAgICAgICB2aW1lby5oaWRlTWVudSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZyb21DYWNoZSA9IHZpbWVvLmxpbmtDYWNoZVtpZF07CiAgICAgICAgICB2YXIgbGlua3MgPSBsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJzsKICAgICAgICAgIGlmIChmcm9tQ2FjaGUpIHsKICAgICAgICAgICAgbGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzLnZpbWVvKGZyb21DYWNoZS5saW5rcywgZnJvbUNhY2hlLnRpdGxlKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbWVudSA9IHZpbWVvLmN1cnJlbnRNZW51ID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnF1aWNrSW5zZXJ0KHRoaXMsIGxpbmtzLCAnc2YtcG9wdXBNZW51Jyk7CgogICAgICAgICAgaWYgKGZyb21DYWNoZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHVybCA9IG51bGw7CiAgICAgICAgICBpZiAoLyJ1cmwiLy50ZXN0KGlkKSkgewogICAgICAgICAgICB1cmwgPSBKU09OLnBhcnNlKGlkKS51cmw7CiAgICAgICAgICAgIGlkID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAnZ2V0VmltZW9MaW5rcycsCiAgICAgICAgICAgIGV4dFZpZGVvSWQ6IGlkLAogICAgICAgICAgICB1cmw6IHVybAogICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgdmFyIG1lbnVMaW5rcyA9IG51bGw7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5saW5rcykgewogICAgICAgICAgICAgIHZpbWVvLmxpbmtDYWNoZVtpZF0gPSByZXNwb25zZTsKICAgICAgICAgICAgICBtZW51TGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzLnZpbWVvKHJlc3BvbnNlLmxpbmtzLCByZXNwb25zZS50aXRsZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWVudUxpbmtzID0gbGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1lbnUudXBkYXRlKG1lbnVMaW5rcyk7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGdldEJ0bjogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAgICAgdmFyIGJ0biA9IG1vbm8uY3JlYXRlKCdpJywgewogICAgICAgICAgICBjbGFzczogZGV0YWlscy5jbGFzc0xpc3QsCiAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICBzZklkOiBkZXRhaWxzLmlkLAogICAgICAgICAgICAgIHNmQ291Y2hNb2RlOiBkZXRhaWxzLmlzQ291Y2hNb2RlID8gMSA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb246IFsnY2xpY2snLCB0aGlzLm9uQ2xpY2tdCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAobW9uby5pc09wZXJhKSB7CiAgICAgICAgICAgIGJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gJyNGOEY4RjgnOwogICAgICAgICAgICBidG4uYXBwZW5kQ2hpbGQobW9uby5jcmVhdGUoJ2ltZycsIHsKICAgICAgICAgICAgICBzcmM6IFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyM3Nzc3NzcnKSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgd2lkdGg6ICcxMnB4JywKICAgICAgICAgICAgICAgIGhlaWdodDogJzEycHgnLAogICAgICAgICAgICAgICAgbWFyZ2luOiAnNHB4JywKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNGOEY4RjgnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGJ0bjsKICAgICAgICB9LAogICAgICAgIG9uSW1nT3ZlcjI6IGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIHZhciBsaW5rID0gdGhpcy5wYXJlbnROb2RlOwoKICAgICAgICAgIHZhciBwYXJlbnQ7CiAgICAgICAgICB2YXIgaWQ7CgogICAgICAgICAgaWYgKGxpbmsudGFnTmFtZSAhPT0gJ0EnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaHJlZiA9IGxpbmsuZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgICAgICBpZiAoIWhyZWYpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlkID0gaHJlZi5tYXRjaCgvXlwvKFxkKykkLyk7CiAgICAgICAgICBpZCA9IGlkICYmIGlkWzFdOwoKICAgICAgICAgIGlmICghaWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHBhcmVudCA9IGxpbmsucGFyZW50Tm9kZTsKICAgICAgICAgIGlmICghcGFyZW50IHx8ICFwYXJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb250ZXh0Y2xpcC1pbWcnKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBhcmVudC5kYXRhc2V0LnNmQnRuID4gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBwYXJlbnQuZGF0YXNldC5zZkJ0biA9ICcxJzsKCiAgICAgICAgICB2YXIgX3RoaXMgPSB2aW1lby52aWRlb0ZlZWQ7CgogICAgICAgICAgdmFyIGNsYXNzTGlzdCA9IFtfdGhpcy5idG5DbGFzc05hbWUsICdzZi10eXBlMS1idG4nXTsKCiAgICAgICAgICBsaW5rLmFwcGVuZENoaWxkKHZpbWVvLnZpZGVvRmVlZC5nZXRCdG4oewogICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgIGNsYXNzTGlzdDogY2xhc3NMaXN0CiAgICAgICAgICB9KSk7CgogICAgICAgICAgbGluayA9IG51bGw7CiAgICAgICAgICBwYXJlbnQgPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgb25JbWdPdmVyOiBmdW5jdGlvbihlKSB7CiAgICAgICAgICB2YXIgbGluayA9IHRoaXMucGFyZW50Tm9kZTsKCiAgICAgICAgICB2YXIgcGFyZW50OwogICAgICAgICAgdmFyIGlkOwoKICAgICAgICAgIGlmIChtb25vLm1hdGNoZXModGhpcywgJ2Rpdi5pcmlzX3ZpZGVvLXZpdGFsJykgfHwgbW9uby5tYXRjaGVzKHRoaXMsICdsaS5jbGlwX3RodW1ibmFpbCcpKSB7CiAgICAgICAgICAgIGxpbmsgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJy5pcmlzX3RodW1ibmFpbCcpOwogICAgICAgICAgICBwYXJlbnQgPSB0aGlzOwogICAgICAgICAgICB2YXIgbGlua05vZGUgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ2EuaXJpc19saW5rLWJveCcpOwogICAgICAgICAgICBpZiAobGlua05vZGUpIHsKICAgICAgICAgICAgICB2YXIgdXJsID0gbGlua05vZGUuaHJlZjsKICAgICAgICAgICAgICBpZCA9IHVybC5tYXRjaCgvXC8oWzAtOV0rKS8pOwogICAgICAgICAgICAgIGlkID0gaWQgJiYgaWRbMV07CgogICAgICAgICAgICAgIGlmICghaWQgJiYgdXJsKSB7CiAgICAgICAgICAgICAgICBpZCA9IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgJ3VybCc6IHVybAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFpZCAmJiBsaW5rLnRhZ05hbWUgPT0gJ0xJJykgewogICAgICAgICAgICBpZCA9IGxpbmsuZGF0YXNldC5yZXN1bHRJZDsKICAgICAgICAgICAgaWYgKGlkICYmIGlkLnN1YnN0cigwLCA1KSA9PT0gJ2NsaXBfJykgewogICAgICAgICAgICAgIGlkID0gaWQuc3Vic3RyKDUpOwogICAgICAgICAgICAgIHBhcmVudCA9IGxpbms7CiAgICAgICAgICAgICAgbGluayA9IHRoaXMucXVlcnlTZWxlY3RvcignLnRodW1ibmFpbF93cmFwcGVyJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgICBpZiAobGluay50YWdOYW1lICE9PSAnQScpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWQgPSBsaW5rLmRhdGFzZXQuY2xpcElkOwoKICAgICAgICAgICAgcGFyZW50ID0gbGluay5wYXJlbnROb2RlOwogICAgICAgICAgICBpZiAoIXBhcmVudCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpc0NvdWNoTW9kZSA9IGZhbHNlOwogICAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgICBpZCA9IHBhcmVudC5pZDsKICAgICAgICAgICAgaXNDb3VjaE1vZGUgPSBpZC5zdWJzdHIoMCwgNykgPT09ICdpdGVtX2lkJyAmJiBwYXJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjbGlwJyk7CiAgICAgICAgICAgIGlmICghaXNDb3VjaE1vZGUgJiYgaWQuc3Vic3RyKDAsIDQpICE9PSAnY2xpcCcpIHsKICAgICAgICAgICAgICBpZCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlkICYmIHBhcmVudC50YWdOYW1lID09PSAnQVJUSUNMRScgJiYgcGFyZW50LmNsYXNzTGlzdC5jb250YWlucygnY2xpcF9pdGVtJykpIHsKICAgICAgICAgICAgICBpZCA9IGxpbmsuZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWQgPSBpZC5tYXRjaCgvKFswLTldKykkLyk7CiAgICAgICAgICAgIGlmIChpZCkgewogICAgICAgICAgICAgIGlkID0gaWRbMV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaGFzQnRuID0gcGFyZW50LmRhdGFzZXQuc2ZCdG47CiAgICAgICAgICBpZiAoaGFzQnRuKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHBhcmVudC5kYXRhc2V0LnNmQnRuID0gJzEnOwoKICAgICAgICAgIHZhciBfdGhpcyA9IHZpbWVvLnZpZGVvRmVlZDsKCiAgICAgICAgICB2YXIgY2xhc3NMaXN0ID0gW190aGlzLmJ0bkNsYXNzTmFtZV07CiAgICAgICAgICBpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoJ3RodW1ibmFpbF9sZ193aWRlJykpIHsKICAgICAgICAgICAgY2xhc3NMaXN0LnB1c2goJ3NmLXR5cGUxLWJ0bicpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmNsYXNzTGlzdC5jb250YWlucygnY2xpcF90aHVtYm5haWwnKSB8fCB0aGlzLmNsYXNzTGlzdC5jb250YWlucygnaXJpc192aWRlby12aXRhbCcpKSB7CiAgICAgICAgICAgIGNsYXNzTGlzdC5wdXNoKCdzZi10eXBlMy1idG4nKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb2wgPSBwYXJlbnQucGFyZW50Tm9kZTsKICAgICAgICAgIGlmIChvbCAmJiBvbC5pZCA9PT0gJ2NsaXBzJykgewogICAgICAgICAgICBjbGFzc0xpc3QucHVzaCgnc2YtdHlwZTEtYnRuJyk7CiAgICAgICAgICAgIC8vIGNsYXNzTGlzdC5wdXNoKCdzZi10eXBlMi1idG4nKTsKICAgICAgICAgIH0KICAgICAgICAgIG9sID0gbnVsbDsKCiAgICAgICAgICBpZiAoaXNDb3VjaE1vZGUpIHsKICAgICAgICAgICAgY2xhc3NMaXN0LnB1c2goJ3NmLXR5cGUxLWJ0bicpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwYXJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwcm9tb19jbGlwJykgJiYgY2xhc3NMaXN0Lmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICBjbGFzc0xpc3QucHVzaCgnc2YtdHlwZTEtYnRuJyk7CiAgICAgICAgICAgIC8vIGNsYXNzTGlzdC5wdXNoKCdzZi10eXBlMi1idG4nKTsKICAgICAgICAgIH0KCiAgICAgICAgICBsaW5rLmFwcGVuZENoaWxkKHZpbWVvLnZpZGVvRmVlZC5nZXRCdG4oewogICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgIGNsYXNzTGlzdDogY2xhc3NMaXN0LAogICAgICAgICAgICBpc0NvdWNoTW9kZTogaXNDb3VjaE1vZGUKICAgICAgICAgIH0pKTsKCiAgICAgICAgICBsaW5rID0gbnVsbDsKICAgICAgICAgIHBhcmVudCA9IG51bGw7CiAgICAgICAgfSwKICAgICAgICBpbmplY3RTdHlsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5zdHlsZSkgewogICAgICAgICAgICAhdGhpcy5zdHlsZS5wYXJlbnROb2RlICYmIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnN0eWxlID0gbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoW3sKICAgICAgICAgICAgICBzZWxlY3RvcjogWwogICAgICAgICAgICAgICAgJ2EgPiAuc2YtZmVlZC1kbC1idG4nLAogICAgICAgICAgICAgICAgJ2EgLnNmLWZlZWQtZGwtYnRuLnNmLXR5cGUzLWJ0bicKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsCiAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI0Y4RjhGOCcsCiAgICAgICAgICAgICAgICB3aWR0aDogJzIwcHgnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAnMjBweCcsCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjNzc3Nzc3JykgKyAnKSBjZW50ZXIgbm8tcmVwZWF0ICNGOEY4RjgnLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JywKICAgICAgICAgICAgICAgIHRvcDogJ2F1dG8nLAogICAgICAgICAgICAgICAgbGVmdDogJ2F1dG8nLAogICAgICAgICAgICAgICAgbGluZUhlaWdodDogMAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIHNlbGVjdG9yOiBbCiAgICAgICAgICAgICAgICAnYSA+IC5zZi1mZWVkLWRsLWJ0bi5zZi10eXBlMS1idG4nLAogICAgICAgICAgICAgICAgJ2EgPiBkaXYgPiAuc2YtZmVlZC1kbC1idG4uc2YtdHlwZTMtYnRuJwogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIHRvcDogMAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIHNlbGVjdG9yOiBbCiAgICAgICAgICAgICAgICAnYSA+IC5zZi1mZWVkLWRsLWJ0bi5zZi10eXBlMi1idG4nCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgb3BhY2l0eTogMC41CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgc2VsZWN0b3I6IFsKICAgICAgICAgICAgICAgICdhID4gZGl2ID4gLnNmLWZlZWQtZGwtYnRuLnNmLXR5cGUzLWJ0bicKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICB6SW5kZXg6IDEwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgc2VsZWN0b3I6IFsKICAgICAgICAgICAgICAgICdhID4gLnNmLWZlZWQtZGwtYnRuOmhvdmVyJywKICAgICAgICAgICAgICAgICdhID4gZGl2ID4gLnNmLWZlZWQtZGwtYnRuLnNmLXR5cGUzLWJ0bjpob3ZlcicKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjMDBCNzVBJykgKyAnKSBjZW50ZXIgbm8tcmVwZWF0ICNGOEY4RjgnLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIHNlbGVjdG9yOiBbCiAgICAgICAgICAgICAgICAnYSA+IC5zZi1mZWVkLWRsLWJ0bi5zZi10eXBlMi1idG46aG92ZXInCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgb3BhY2l0eTogMC44CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgc2VsZWN0b3I6IFsKICAgICAgICAgICAgICAgICdhID4gLnNmLWZlZWQtZGwtYnRuOmFjdGl2ZScsCiAgICAgICAgICAgICAgICAnYSA+IGRpdiA+IC5zZi1mZWVkLWRsLWJ0bi5zZi10eXBlMy1idG46YWN0aXZlJwogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIG91dGxpbmU6IDAsCiAgICAgICAgICAgICAgICBib3hTaGFkb3c6ICdpbnNldCAwIDNweCA1cHggcmdiYSgwLCAwLCAwLCAwLjEyNSknCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgc2VsZWN0b3I6IFsKICAgICAgICAgICAgICAgICdhOmhvdmVyID4gLnNmLWZlZWQtZGwtYnRuJywKICAgICAgICAgICAgICAgICdhOmhvdmVyID4gZGl2ID4gLnNmLWZlZWQtZGwtYnRuLnNmLXR5cGUzLWJ0bicKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSkKICAgICAgICAgIH0pOwoKICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgICAgfSwKICAgICAgICBkaXNhYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICh0aGlzLnN0eWxlKSB7CiAgICAgICAgICAgIHRoaXMuc3R5bGUucGFyZW50Tm9kZSAmJiB0aGlzLnN0eWxlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBybUJ0bjogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgYnRuTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi1mZWVkLWRsLWJ0bicpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBidG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGl0ZW0pOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoJ3NmQnRuJyk7CiAgICAgICAgICB2YXIgZGF0YUF0dHJMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnWycgKyBkYXRhQXR0ciArICddJyk7CiAgICAgICAgICBmb3IgKGkgPSAwLCBpdGVtOyBpdGVtID0gZGF0YUF0dHJMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgaXRlbS5yZW1vdmVBdHRyaWJ1dGUoZGF0YUF0dHIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgbXV0YXRpb25Nb2RlOiB7CiAgICAgICAgb2JzZXJ2ZXI6IG51bGwsCiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5vYnNlcnZlcikgewogICAgICAgICAgICB0aGlzLm9ic2VydmVyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHdyYXBPbkltZ092ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFtb2R1bGVTdGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2aW1lby52aWRlb0ZlZWQub25JbWdPdmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICB3cmFwT25JbWdPdmVyMjogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHZpbWVvLnZpZGVvRmVlZC5vbkltZ092ZXIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm9ic2VydmVyID0gU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLnJ1bih7CiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbihzdW1tYXJ5TGlzdCkgewogICAgICAgICAgICAgIHZhciBzdW1tYXJ5LCBuLCBpLCBub2RlLCBzdHlsZUluZGV4LCB2aWRlb0lkOwoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMF07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgdmltZW8uaGlkZU1lbnUoKTsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgc3R5bGVJbmRleCA9IDI7CiAgICAgICAgICAgICAgICB2aW1lby5hcHBlbmRCdG4oewogICAgICAgICAgICAgICAgICBpZDogJycsCiAgICAgICAgICAgICAgICAgIHBhcmVudDogbm9kZSwKICAgICAgICAgICAgICAgICAgc3R5bGU6IHN0eWxlSW5kZXgsCiAgICAgICAgICAgICAgICAgIHBsYXllckNvbnRhaW5lcjogJyNjbGlwJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMV07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgdmltZW8uaGlkZU1lbnUoKTsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgdmFyIHN0YXRzID0gbm9kZS5xdWVyeVNlbGVjdG9yKCcuc3RhdHMnKSB8fCBub2RlLnF1ZXJ5U2VsZWN0b3IoJy50aW1lJyk7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXRzKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0eWxlSW5kZXggPSAxOwogICAgICAgICAgICAgICAgdmltZW8uYXBwZW5kQnRuKHsKICAgICAgICAgICAgICAgICAgaWQ6ICcnLAogICAgICAgICAgICAgICAgICBwYXJlbnQ6IHN0YXRzLAogICAgICAgICAgICAgICAgICBzdHlsZTogc3R5bGVJbmRleCwKICAgICAgICAgICAgICAgICAgcGxheWVyQ29udGFpbmVyOiAnI2NoYW5uZWxfY2xpcF9jb250YWluZXInCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFsyXTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgIGlmIChub2RlLmlkLnN1YnN0cigwLCA1KSAhPT0gJ2NsaXBfJykgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgdmlkZW9EYXRhID0gdmltZW8uZ2V0QnJvd3NlclZpZGVvRGF0YShub2RlLCBub2RlLmlkKTsKICAgICAgICAgICAgICAgIGlmICghdmlkZW9EYXRhKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZpbWVvLmFwcGVuZEJ0bih2aWRlb0RhdGEpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzNdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgbW9uby5vbmUobm9kZSwgJ21vdXNlb3ZlcicsIHZpbWVvLm11dGF0aW9uTW9kZS53cmFwT25JbWdPdmVyKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFs0XTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3Mobm9kZSwgJ2NsaXBfdGh1bWJuYWlsJyk7CgogICAgICAgICAgICAgICAgbW9uby5vbmUocGFyZW50LCAnbW91c2VvdmVyJywgdmltZW8ubXV0YXRpb25Nb2RlLndyYXBPbkltZ092ZXIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzVdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IG1vbm8uZ2V0UGFyZW50QnlDbGFzcyhub2RlLCAnaXJpc192aWRlby12aXRhbCcpOwoKICAgICAgICAgICAgICAgIG1vbm8ub25lKHBhcmVudCwgJ21vdXNlb3ZlcicsIHZpbWVvLm11dGF0aW9uTW9kZS53cmFwT25JbWdPdmVyKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFs2XTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgIHZpbWVvLmhpZGVNZW51KCk7CgogICAgICAgICAgICAgICAgdmFyIHdyYXBwZXIgPSBtb25vLmdldFBhcmVudChub2RlLCAnLmNsaXBfaW5mby13cmFwcGVyJyk7CiAgICAgICAgICAgICAgICBpZiAoIXdyYXBwZXIpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGNsaXBJbmZvQWN0aW9ucyA9IHdyYXBwZXIucXVlcnlTZWxlY3RvcignLmNsaXBfaW5mby1hY3Rpb25zJyk7CiAgICAgICAgICAgICAgICBpZiAoIWNsaXBJbmZvQWN0aW9ucykgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdHlsZUluZGV4ID0gMzsKICAgICAgICAgICAgICAgIHZpbWVvLmFwcGVuZEJ0bih7CiAgICAgICAgICAgICAgICAgIGlkOiAnJywKICAgICAgICAgICAgICAgICAgcGFyZW50OiBjbGlwSW5mb0FjdGlvbnMsCiAgICAgICAgICAgICAgICAgIHN0eWxlOiBzdHlsZUluZGV4LAogICAgICAgICAgICAgICAgICBwbGF5ZXJDb250YWluZXI6ICcuY2xpcF9tYWluJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbN107CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICB2aW1lby5oaWRlTWVudSgpOwoKICAgICAgICAgICAgICAgIHZhciB3cmFwcGVyID0gbW9uby5nZXRQYXJlbnQobm9kZSwgJy5jbGlwX21haW4tY29udGVudCcpOwogICAgICAgICAgICAgICAgaWYgKCF3cmFwcGVyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciBjbGlwSW5mb0FjdGlvbnMgPSB3cmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJy5jbGlwX2luZm8tYmNmIC5jbGlwX2luZm8tYWN0aW9ucycpOwogICAgICAgICAgICAgICAgaWYgKCFjbGlwSW5mb0FjdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3R5bGVJbmRleCA9IDU7CiAgICAgICAgICAgICAgICB2aW1lby5hcHBlbmRCdG4oewogICAgICAgICAgICAgICAgICBpZDogJycsCiAgICAgICAgICAgICAgICAgIHBhcmVudDogY2xpcEluZm9BY3Rpb25zLAogICAgICAgICAgICAgICAgICBzdHlsZTogc3R5bGVJbmRleCwKICAgICAgICAgICAgICAgICAgcGxheWVyQ29udGFpbmVyOiAnLmNsaXBfbWFpbicKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzhdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgbW9uby5vbmUobm9kZSwgJ21vdXNlb3ZlcicsIHZpbWVvLm11dGF0aW9uTW9kZS53cmFwT25JbWdPdmVyMik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbOV07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBzdHlsZUluZGV4ID0gNDsKICAgICAgICAgICAgICAgIHZpbWVvLmFwcGVuZEJ0bih7CiAgICAgICAgICAgICAgICAgIGlkOiAnJywKICAgICAgICAgICAgICAgICAgcGFyZW50OiBub2RlLAogICAgICAgICAgICAgICAgICBzdHlsZTogc3R5bGVJbmRleCwKICAgICAgICAgICAgICAgICAgcGxheWVyQ29udGFpbmVyOiAnLmNsaXAnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHF1ZXJpZXM6IFt7CiAgICAgICAgICAgICAgY3NzOiAnI2NsaXAgI2luZm8gI3Rvb2xzJywKICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgY3NzOiAnI2NoYW5uZWxfY2xpcF9jb250YWluZXIgI2luZm8gLm1ldGEnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcjYnJvd3NlX2NvbnRlbnQgb2wuYnJvd3NlX3ZpZGVvc192aWRlb3MgPiBsaScsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ2ltZy50aHVtYm5haWwnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuY2xpcF90aHVtYm5haWwgLmlyaXNfdGh1bWJuYWlsIGltZycsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5pcmlzX3ZpZGVvLXZpdGFsIC5pcmlzX3RodW1ibmFpbCBpbWcnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuY2xpcF9tYWluIC5jbGlwX2luZm8gYS5qcy11c2VyX2xpbmsuaXJpc19saW5rLWhlYWRlcicsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5jbGlwX21haW4gLmNsaXBfbWFpbi1jb250ZW50IGRpdi5pcmlzX2Rlc2MtY29udGVudC5kZXNjcmlwdGlvbi1jb250ZW50IHAnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuY29udGV4dGNsaXAtaW1nIGltZycsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5jbGllbnRfd3JhcHBlciAuY2xpcCBoZWFkZXIgaDEnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogIH0sIG51bGwsIGZ1bmN0aW9uIHN5bmNJc0FjdGl2ZSgpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICBpZiAobW9uby5pc1NhZmFyaSB8fCBtb25vLmlzR00pIHsKICAgICAgdmFyIGxpc3QgPSBbCiAgICAgICAgJyo6Ly8qLnZpbWVvLmNvbS8qJwogICAgICBdOwoKICAgICAgdmFyIHJlU3RyID0gbGlzdC5tYXAoZnVuY3Rpb24ocGF0dGVybikgewogICAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgICB9KS5qb2luKCd8Jyk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAocmVTdHIpOwoKICAgICAgaWYgKCFyZS50ZXN0KGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgndmsnLCBmdW5jdGlvbihtb2R1bGVOYW1lLCBpbml0RGF0YSkgewogICAgInVzZSBzdHJpY3QiOwoKICAgIHZhciBsYW5ndWFnZSA9IGluaXREYXRhLmdldExhbmd1YWdlOwogICAgdmFyIHByZWZlcmVuY2UgPSBpbml0RGF0YS5nZXRQcmVmZXJlbmNlOwogICAgdmFyIG1vZHVsZVN0YXRlID0gcHJlZmVyZW5jZS5tb2R1bGVWa29udGFrdGUgPyAxIDogMDsKICAgIHZhciBhbGxvd0Rvd25sb2FkTW9kZSA9IG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0Nocm9tZSB8fCBtb25vLmlzRkYgfHwgKG1vbm8uaXNHTSAmJiBtb25vLmlzVE0pOwoKICAgIHZhciBpZnJhbWUgPSBtb25vLmlzSWZyYW1lKCk7CiAgICB2YXIgdmlkZW9FeHQgPSBmYWxzZTsKCiAgICBpZiAoaWZyYW1lKSB7CiAgICAgIGlmIChsb2NhdGlvbi5ocmVmLnNlYXJjaCgvXC92aWRlb19leHRcLnBocFw/LisvKSA+IC0xKSB7CiAgICAgICAgdmlkZW9FeHQgPSB0cnVlOwogICAgICB9IGVsc2UKICAgICAgaWYgKGxvY2F0aW9uLmhyZWYuc2VhcmNoKC9cL3dpZGdldF9jb21tZW50c1wucGhwXD8uKy8pICE9PSAtMSkgewogICAgICAgIGlmcmFtZSA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIG1vbm8ub25NZXNzYWdlLmFkZExpc3RlbmVyKGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2dldE1vZHVsZUluZm8nKSB7CiAgICAgICAgaWYgKG1lc3NhZ2UudXJsICE9PSBsb2NhdGlvbi5ocmVmKSByZXR1cm47CiAgICAgICAgcmV0dXJuIGNiKHsKICAgICAgICAgIHN0YXRlOiBtb2R1bGVTdGF0ZSwKICAgICAgICAgIG1vZHVsZU5hbWU6IG1vZHVsZU5hbWUKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICdjaGFuZ2VTdGF0ZScpIHsKICAgICAgICBpZiAobW9kdWxlTmFtZSAhPT0gbWVzc2FnZS5tb2R1bGVOYW1lKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJldHVybiB2ay5jaGFuZ2VTdGF0ZShtZXNzYWdlLnN0YXRlKTsKICAgICAgfQogICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ3VwZGF0ZUxpbmtzJykgewogICAgICAgIHVwZGF0ZUxpbmtzKCk7CiAgICAgIH0KICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnZG93bmxvYWRNUDNGaWxlcycpIHsKICAgICAgICBpZiAoYWxsb3dEb3dubG9hZE1vZGUpIHsKICAgICAgICAgIGF1ZGlvLmRvd25sb2FkTVAzRmlsZXMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXVkaW8uc2hvd0xpc3RPZkF1ZGlvRmlsZXMoZmFsc2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICdkb3dubG9hZFBsYXlsaXN0JykgewogICAgICAgIGF1ZGlvLnNob3dMaXN0T2ZBdWRpb0ZpbGVzKHRydWUpOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2Rvd25sb2FkUGhvdG9zJykgewogICAgICAgIHBob3RvLmRvd25sb2FkUGhvdG8oKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKG1vZHVsZVN0YXRlKSB7CiAgICAgIG1vbm8uYXN5bmNDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgIHZrLnJ1bigpOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgdmsgPSB7CiAgICAgIGNvbnRleHRNZW51OiBudWxsLAogICAgICBpc011dGF0aW9uOiBmYWxzZSwKICAgICAgcnVuOiBmdW5jdGlvbigpIHsKICAgICAgICBtb2R1bGVTdGF0ZSA9IDE7CgogICAgICAgIGlmICgvbVwudmtcLmNvbS8udGVzdChsb2NhdGlvbi5ob3N0bmFtZSkpIHsKICAgICAgICAgIHJldHVybiBtVmsucnVuKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodmlkZW9FeHQpIHsKICAgICAgICAgIHZpZGVvLmFkZEZyYW1lQnRuKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBwaG90by5pbmplY3RTdHlsZSgpOwoKICAgICAgICBpZiAoU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLmlzQXZhaWxhYmxlKCkpIHsKICAgICAgICAgIHZrLmlzTXV0YXRpb24gPSB0cnVlOwogICAgICAgICAgYXVkaW8uYWRkQ3VzdG9tU3R5bGUoKTsKICAgICAgICAgIHZrLm11dGF0aW9uTW9kZS5lbmFibGUoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNoYW5nZVN0YXRlOiBmdW5jdGlvbihzdGF0ZSkgewogICAgICAgIGlmIChpZnJhbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbW9kdWxlU3RhdGUgPSBzdGF0ZTsKICAgICAgICByZW1vdmVEb3dubG9hZExpbmtzKCk7CiAgICAgICAgYXVkaW8uaGlkZUxpbmtzKCk7CgogICAgICAgIHZpZGVvRmVlZC5vZmYoKTsKCiAgICAgICAgdmsuaGlkZU1lbnUoKTsKCiAgICAgICAgcGhvdG8ucm1DdXJyZW50UGhvdG9CdG4oKTsKCiAgICAgICAgYXVkaW8ucm1CaXRyYXRlKCk7CgogICAgICAgIHBob3RvLnJtUGhvdG9BbGJ1bURsQnRuKCk7CgogICAgICAgIHZrLm11dGF0aW9uTW9kZS5zdG9wKCk7CgogICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgdmsucnVuKCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBoaWRlTWVudTogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHZrLmNvbnRleHRNZW51KSB7CiAgICAgICAgICB2ay5jb250ZXh0TWVudS5oaWRlKCk7CiAgICAgICAgICB2ay5jb250ZXh0TWVudSA9IG51bGw7CiAgICAgICAgfQogICAgICB9LAogICAgICBtdXRhdGlvbk1vZGU6IHsKICAgICAgICBvYnNlcnZlcjogbnVsbCwKICAgICAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICh0aGlzLm9ic2VydmVyKSB7CiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgfQoKICAgICAgICAgIFsnc2ZTa2lwJ10uZm9yRWFjaChmdW5jdGlvbihhdHRyKSB7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoYXR0cik7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbJyArIGRhdGFBdHRyICsgJ10nKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlQXR0cmlidXRlKGRhdGFBdHRyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICB3cmFwTmV3QXVkaW9Pbk1vdXNlT3ZlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGF1ZGlvLm9uTmV3TW91c2VPdmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfSwKICAgICAgICB3cmFwVmlkZW9GZWVkT25Nb3VzZU92ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKCFtb2R1bGVTdGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2aWRlb0ZlZWQub25MaW5rSG92ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9LAogICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5vYnNlcnZlcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5vYnNlcnZlci5zdGFydCgpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMub2JzZXJ2ZXIgPSBTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIucnVuKHsKICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHN1bW1hcnlMaXN0KSB7CiAgICAgICAgICAgICAgdmFyIHN1bW1hcnksIG4sIGksIG5vZGU7CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFswXTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgIG1vbm8ub25lKG5vZGUsICdtb3VzZW92ZXInLCB2ay5tdXRhdGlvbk1vZGUud3JhcFZpZGVvRmVlZE9uTW91c2VPdmVyKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFsxXTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgIHZhciBsYXllciA9IFNhdmVGcm9tX1V0aWxzLmdldFBhcmVudEJ5SWQobm9kZSwgJ212X2JveCcpOwogICAgICAgICAgICAgICAgdmFyIHBsYXllciA9IHZpZGVvLmdldFBsYXllck5vZGUobGF5ZXIpOwoKICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgdmlkZW8uZ2V0TGlua3NGcm9tUGxheWVyKGxheWVyLCBwbGF5ZXIsIHZpZGVvLm5ld0FwcGVuZEJ1dHRvbi5iaW5kKHZpZGVvKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMl07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBwaG90by5hZGROZXdQaG90b0FsYnVtRGxCdG4obm9kZSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbM107CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBwaG90by5hZGROZXdEbEN1cnJlbnRQaG90b0J0bihub2RlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvciAoaSA9IDQ7IGkgPCA3OyBpKyspIHsKICAgICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFtpXTsKICAgICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICAgIG1vbm8ub25lKG5vZGUsICdtb3VzZW92ZXInLCB2ay5tdXRhdGlvbk1vZGUud3JhcE5ld0F1ZGlvT25Nb3VzZU92ZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzddOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LnJlbW92ZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgbW9uby5vblJlbW92ZUxpc3RlbmVyKG5vZGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcXVlcmllczogW3sKICAgICAgICAgICAgICAgIGNzczogJy5wb3N0X3ZpZGVvX2Rlc2MgYS5sbmsnLAogICAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjc3M6ICcjbXZfYm94ICNtdl9wbGF5ZXJfYm94ID4gLnZpZGVvX2JveF93cmFwJywKICAgICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY3NzOiAnI3Bob3Rvc19hbGxfYmxvY2snLAogICAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjc3M6ICcucHZfcGhvdG9fd3JhcCAucHZfaW1nX2FyZWFfd3JhcCcsCiAgICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNzczogJy5hdWRpb19yb3cnLAogICAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBjc3M6ICcudG9wX2F1ZGlvX3BsYXllciAudG9wX2F1ZGlvX3BsYXllcl90aXRsZScsCiAgICAgICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGNzczogJy5hdWRpb19wYWdlX3BsYXllciAuYXVkaW9fcGFnZV9wbGF5ZXJfdGl0bGUnLAogICAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjc3M6ICcuJyArIG1vbm8ub25SZW1vdmVDbGFzc05hbWUsCiAgICAgICAgICAgICAgICBpczogJ3JlbW92ZWQnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIGRvd25sb2FkTGlua0NsYXNzTmFtZSA9ICdzYXZlZnJvbV92a19kb3dubG9hZCc7CgogICAgdmFyIHVwZGF0ZUxpbmtzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZrLmNoYW5nZVN0YXRlKDApOwogICAgICB2ay5jaGFuZ2VTdGF0ZSgxKTsKICAgIH07CgogICAgdmFyIHJlbW92ZURvd25sb2FkTGlua3MgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGVjdG9yID0gJ2EuJyArIGRvd25sb2FkTGlua0NsYXNzTmFtZSArCiAgICAgICAgJyxkaXYuJyArIGRvd25sb2FkTGlua0NsYXNzTmFtZSArCiAgICAgICAgJyxzcGFuLicgKyBkb3dubG9hZExpbmtDbGFzc05hbWU7CgogICAgICBhdWRpby5sYXN0Um93ID0gbnVsbDsKCiAgICAgIHZhciBlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICAgIGZvciAodmFyIGkgPSBlLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgaWYgKGF1ZGlvLmVsSXNIaWRkZW4oZVtpXSkpIHsKICAgICAgICAgIGVbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlW2ldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgdmFyIGdldEZvbGRlck5hbWUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGZvbGRlck5hbWUgPSBkb2N1bWVudC50aXRsZTsKICAgICAgdmFyIHNlcCA9IGZvbGRlck5hbWUuaW5kZXhPZignfCcpOwogICAgICBpZiAoc2VwICE9PSAtMSkgewogICAgICAgIGZvbGRlck5hbWUgPSBmb2xkZXJOYW1lLnN1YnN0cigwLCBzZXAgLSAxKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1vbm8uZmlsZU5hbWUubW9kaWZ5KGZvbGRlck5hbWUpOwogICAgfTsKCiAgICB2YXIgcGFyc2VWa1Jlc3BvbnNlID0gZnVuY3Rpb24oZGF0YSkgewogICAgICB2YXIgaW50dmFsID0gZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiBlID09PSAhMCA/IDEgOiBwYXJzZUludChlKSB8fCAwCiAgICAgIH07CgogICAgICB2YXIgZmxvYXR2YWwgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgcmV0dXJuIGUgPT09ICEwID8gMSA6IHBhcnNlRmxvYXQoZSkgfHwgMAogICAgICB9OwoKICAgICAgdmFyIGUgPSBkYXRhLnNwbGl0KCc8IT4nKTsKICAgICAgZm9yICh2YXIgbyA9IGUubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHsKICAgICAgICB2YXIgbiA9IGVbb107CiAgICAgICAgaWYgKCI8ISIgPT0gbi5zdWJzdHIoMCwgMikpIHsKICAgICAgICAgIHZhciBhID0gbi5pbmRleE9mKCI+IiksCiAgICAgICAgICAgIGkgPSBuLnN1YnN0cigyLCBhIC0gMik7CiAgICAgICAgICBzd2l0Y2ggKG4gPSBuLnN1YnN0cihhICsgMSksIGkpIHsKICAgICAgICAgICAgY2FzZSAianNvbiI6CiAgICAgICAgICAgICAgdmFyIGpzb24gPSBudWxsOwoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAganNvbiA9IEpTT04ucGFyc2Uobik7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KCiAgICAgICAgICAgICAgZVtvXSA9IGpzb247CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImludCI6CiAgICAgICAgICAgICAgZVtvXSA9IGludHZhbChuKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiZmxvYXQiOgogICAgICAgICAgICAgIGVbb10gPSBmbG9hdHZhbChuKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiYm9vbCI6CiAgICAgICAgICAgICAgZVtvXSA9IGludHZhbChuKSA/ICEwIDogITE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIm51bGwiOgogICAgICAgICAgICAgIGVbb10gPSBudWxsOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJwYWdldmlld19jYW5kaWRhdGUiOgogICAgICAgICAgICAgIGUucG9wKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImRlYnVnIjoKICAgICAgICAgICAgICBlLnBvcCgpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBlOwogICAgfTsKCiAgICB2YXIgcm1FbVRhZ3MgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgdmFyIHJlID0gLzxlbT4uKjxcL2VtPi87CiAgICAgIGlmIChyZS50ZXN0KHN0cikpIHsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvPFwvP2VtPi9nLCAnJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHN0cjsKICAgIH07CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vICBBVURJTwoKICAgIHZhciBhdWRpbyA9IHsKICAgICAgYXVkaW9FbENsYXNzTGlzdDogWydhdWRpbycsICdhdWRpb1JvdycsICdhdWRpb1Jvd1dhbGwnXSwKICAgICAgbGFzdFJvdzogbnVsbCwKICAgICAgY2xhc3NOYW1lOiBkb3dubG9hZExpbmtDbGFzc05hbWUsCiAgICAgIGNhY2hlOiB7fSwKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge0FycmF5fSBpZExpc3QKICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2IKICAgICAgICogQHJldHVybnMge3thYm9ydDogRnVuY3Rpb259fQogICAgICAgKi8KICAgICAgZ2V0TmV3VHJhY2tMaXN0QnlJZHM6IGZ1bmN0aW9uKGlkTGlzdCwgY2IsIHJldHJ5KSB7CiAgICAgICAgaWYgKHJldHJ5ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHJ5ID0gNTsKICAgICAgICB9CgogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIGxpbWl0ID0gMTA7CgogICAgICAgIGlmIChpZExpc3QubGVuZ3RoID4gbGltaXQpIHsKICAgICAgICAgIHJldHVybiAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlkTGlzdCA9IGlkTGlzdC5zbGljZSgwKTsKICAgICAgICAgICAgdmFyIF90cmFja0xpc3QgPSB7fTsKCiAgICAgICAgICAgIHZhciBhc3luYyA9IG5ldyBtb25vLkFzeW5jTGlzdChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gY2IobnVsbCwgX3RyYWNrTGlzdCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgYXN5bmMud2FpdCgpOwoKICAgICAgICAgICAgdmFyIG5leHQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgbGlzdCA9IGlkTGlzdC5zcGxpY2UoMCwgbGltaXQpOwogICAgICAgICAgICAgIGFzeW5jLndhaXQoKTsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgX3RoaXMuZ2V0TmV3VHJhY2tMaXN0QnlJZHMobGlzdCwgZnVuY3Rpb24oZXJyLCB0cmFja0xpc3QpIHsKICAgICAgICAgICAgICAgICAgaWRMaXN0Lmxlbmd0aCAmJiBuZXh0KCk7CgogICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jLnJlYWR5KCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGZ1bGxJZCBpbiB0cmFja0xpc3QpIHsKICAgICAgICAgICAgICAgICAgICBfdHJhY2tMaXN0W2Z1bGxJZF0gPSB0cmFja0xpc3RbZnVsbElkXTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jLnJlYWR5KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9LCAyNTApOwogICAgICAgICAgICB9OwogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIG5leHQoKTsKCiAgICAgICAgICAgIGFzeW5jLnJlYWR5KCk7CiAgICAgICAgICB9KSgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNhY2hlID0gX3RoaXMuY2FjaGU7CgogICAgICAgIHZhciBpZHMgPSBbXTsKICAgICAgICB2YXIgdHJhY2tMaXN0ID0ge307CiAgICAgICAgaWRMaXN0LmZvckVhY2goZnVuY3Rpb24oZnVsbElkKSB7CiAgICAgICAgICB2YXIgdHJhY2sgPSBjYWNoZVtmdWxsSWRdOwogICAgICAgICAgaWYgKHRyYWNrKSB7CiAgICAgICAgICAgIHRyYWNrTGlzdFtmdWxsSWRdID0gdHJhY2s7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZHMucHVzaChmdWxsSWQpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoIWlkcy5sZW5ndGgpIHsKICAgICAgICAgIHJldHVybiBjYihudWxsLCB0cmFja0xpc3QpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICAgICBkYXRhOiBtb25vLnBhcmFtKHsKICAgICAgICAgICAgYWN0OiAncmVsb2FkX2F1ZGlvJywKICAgICAgICAgICAgYWw6IDEsCiAgICAgICAgICAgIGlkczogaWRzLmpvaW4oJywnKQogICAgICAgICAgfSksCiAgICAgICAgICB1cmw6ICcvYWxfYXVkaW8ucGhwJywKICAgICAgICAgIGxvY2FsWEhSOiB0cnVlCiAgICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgICByZXR1cm4gY2IoIkRhdGEgaXMgZW1wdHkhIik7CiAgICAgICAgICB9CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHJlc3AgPSBwYXJzZVZrUmVzcG9uc2UoZGF0YSk7CgogICAgICAgICAgICB2YXIgcGxheWxpc3RBcnIgPSByZXNwWzVdOwoKICAgICAgICAgICAgLyppZiAoIXBsYXlsaXN0QXJyICYmIHJldHJ5ID4gMCkgewogICAgICAgICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5nZXROZXdUcmFja0xpc3RCeUlkcyhpZExpc3QsIGNiLCAtLXJldHJ5KTsKICAgICAgICAgICAgICB9LCAyNTApOwogICAgICAgICAgICB9Ki8KCiAgICAgICAgICAgIHBsYXlsaXN0QXJyICYmIHBsYXlsaXN0QXJyLmZvckVhY2goZnVuY3Rpb24odHJhY2spIHsKICAgICAgICAgICAgICB2YXIgZnVsbElkID0gdHJhY2tbMV0gKyAnXycgKyB0cmFja1swXTsKICAgICAgICAgICAgICB0cmFja0xpc3RbZnVsbElkXSA9IHRyYWNrOwogICAgICAgICAgICAgIGNhY2hlW2Z1bGxJZF0gPSB0cmFjazsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBPYmplY3Qua2V5cyhjYWNoZSkuc2xpY2UoMTAwMCkuZm9yRWFjaChmdW5jdGlvbihmdWxsSWQpIHsKICAgICAgICAgICAgICBkZWxldGUgY2FjaGVbZnVsbElkXTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoIU9iamVjdC5rZXlzKHRyYWNrTGlzdCkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdGhyb3cgIlRyYWNrIGxpc3QgaXMgZW1wdHkhIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNiKG51bGwsIHRyYWNrTGlzdCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJldHVybiBjYihlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIGdldExpbmtzRnJvbUpzb246IGZ1bmN0aW9uKGFsYnVtRGF0YSwgbGlzdCwgb25TdWNjZXNzLCBvbkVycm9yKSB7CiAgICAgICAgaWYgKCFsaXN0WydhbGwnXSkgewogICAgICAgICAgcmV0dXJuIG9uRXJyb3IoKTsKICAgICAgICB9CiAgICAgICAgdmFyIHRyYWNrTGlzdCA9IFtdOwogICAgICAgIHZhciBsaW5rTGlzdCA9IHt9OwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gbGlzdFsnYWxsJ11baV07IGkrKykgewogICAgICAgICAgaWYgKGFsYnVtRGF0YS5hSWQgIT09IHVuZGVmaW5lZCAmJiBpdGVtWzhdICE9PSBhbGJ1bURhdGEuYUlkKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGFJZCA9IGl0ZW1bMF0gKyAnXycgKyBpdGVtWzFdOwogICAgICAgICAgaWYgKGxpbmtMaXN0W2FJZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciB1cmwgPSBpdGVtWzJdOwogICAgICAgICAgdmFyIHRpdGxlID0gbW9uby5maWxlTmFtZS5kZWNvZGVTcGVjaWFsQ2hhcnMobW9uby5kZWNvZGVVbmljb2RlRXNjYXBlU2VxdWVuY2UoaXRlbVs1XSArICcgLSAnICsgaXRlbVs2XSkpOwoKICAgICAgICAgIHRyYWNrTGlzdC5wdXNoKHsKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgZmlsZW5hbWU6IG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRpdGxlICsgJy5tcDMnKQogICAgICAgICAgfSk7CiAgICAgICAgICBsaW5rTGlzdFthSWRdID0gdXJsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRyYWNrTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybiBvbkVycm9yKCk7CiAgICAgICAgfQogICAgICAgIG9uU3VjY2VzcyhsaW5rTGlzdCwgdHJhY2tMaXN0KTsKICAgICAgfSwKCiAgICAgIGdldEF1ZGlvTGlua3NWaWFBUEk6IGZ1bmN0aW9uKGFsYnVtRGF0YSwgb25TdWNjZXNzLCBvbkVycm9yLCByZVNlbmQpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgICBhY3Q6ICdsb2FkX2F1ZGlvc19zaWxlbnQnLAogICAgICAgICAgYWw6IDEKICAgICAgICB9OwogICAgICAgIGlmIChhbGJ1bURhdGEuZ2lkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHBhcmFtcy5naWQgPSBhbGJ1bURhdGEuZ2lkOwogICAgICAgIH0KICAgICAgICBpZiAoYWxidW1EYXRhLmlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHBhcmFtcy5pZCA9IGFsYnVtRGF0YS5pZDsKICAgICAgICB9CiAgICAgICAgaWYgKGFsYnVtRGF0YS5wbGVhc2VfZG9udF9kZG9zID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGFsYnVtRGF0YS5wbGVhc2VfZG9udF9kZG9zID0gMjsKICAgICAgICB9CiAgICAgICAgcGFyYW1zLnBsZWFzZV9kb250X2Rkb3MgPSBhbGJ1bURhdGEucGxlYXNlX2RvbnRfZGRvczsKICAgICAgICB2YXIgcG9zdCA9IG1vbm8ucGFyYW0ocGFyYW1zKTsKICAgICAgICBpZiAocmVTZW5kID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJlU2VuZCA9IDA7CiAgICAgICAgfQoKICAgICAgICB2YXIgb25YaHJFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHJlU2VuZCA+IDIpIHsKICAgICAgICAgICAgcmV0dXJuIG9uRXJyb3IoKTsKICAgICAgICAgIH0KICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIF90aGlzLmdldEF1ZGlvTGlua3NWaWFBUEkoYWxidW1EYXRhLCBvblN1Y2Nlc3MsIG9uRXJyb3IsICsrcmVTZW5kKTsKICAgICAgICAgIH0sIDI1MCk7CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIG1vbm8ucmVxdWVzdCh7CiAgICAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICAgICB1cmw6ICcvJyArIGFsYnVtRGF0YS5wYWdlLAogICAgICAgICAgZGF0YTogcG9zdCwKICAgICAgICAgIHRpbWVvdXQ6IDYwICogMTAwMCwKICAgICAgICAgIGxvY2FsWEhSOiB0cnVlCiAgICAgICAgfSwgZnVuY3Rpb24oZXJyLCByZXNwLCBkYXRhKSB7CiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiBvblhockVycm9yKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBvbkVycm9yKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHN0ciA9IHBhcnNlVmtSZXNwb25zZShkYXRhKVs1XTsKICAgICAgICAgICAgaWYgKCFzdHIgfHwgc3RyWzBdICE9PSAneycpIHsKICAgICAgICAgICAgICB0aHJvdyAiRGF0YSBpcyBlbXB0eSEiOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVnZXhwMSA9IC8iL2c7CiAgICAgICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC8nL2csICciJykucmVwbGFjZSgvPChbXj5dKik+L2csIGZ1bmN0aW9uKHN0ciwgYXJnMSkgewogICAgICAgICAgICAgIHZhciByID0gYXJnMS5yZXBsYWNlKHJlZ2V4cDEsICdcJycpOwogICAgICAgICAgICAgIHJldHVybiAnPCcgKyByICsgJz4nOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBsaXN0ID0gSlNPTi5wYXJzZShzdHIpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZXR1cm4gb25FcnJvcigpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBfdGhpcy5nZXRMaW5rc0Zyb21Kc29uKGFsYnVtRGF0YSwgbGlzdCwgb25TdWNjZXNzLCBvbkVycm9yKTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIGdldExpbmtzRnJvbUFsYnVtOiBmdW5jdGlvbihhbGJ1bURhdGEsIGNiKSB7CiAgICAgICAgdGhpcy5nZXRBdWRpb0xpbmtzVmlhQVBJKGFsYnVtRGF0YSwgY2IsIGZ1bmN0aW9uIG9uRXJyb3IoKSB7CiAgICAgICAgICBjYigpOwogICAgICAgIH0pOwogICAgICB9LAoKICAgICAgZ2V0QWxidW1JZDogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgdmFyIGFsYnVtRGF0YSA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgbTEgPSB1cmwubWF0Y2goL2F1ZGlvcyhcZCspLyk7CiAgICAgICAgaWYgKG0xICE9PSBudWxsKSB7CiAgICAgICAgICBhbGJ1bURhdGEgPSB7CiAgICAgICAgICAgIHBhZ2U6ICdhdWRpbycsCiAgICAgICAgICAgIGlkOiBtMVsxXSwKICAgICAgICAgICAgZ2lkOiAwCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICB2YXIgbTEgPSB1cmwubWF0Y2goL2F1ZGlvcy0oXGQrKS8pOwogICAgICAgIGlmIChtMSAhPT0gbnVsbCkgewogICAgICAgICAgYWxidW1EYXRhID0gewogICAgICAgICAgICBwYWdlOiAnYXVkaW8nLAogICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgZ2lkOiBtMVsxXQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgdmFyIGFsbG93QXJncyA9IGZhbHNlOwogICAgICAgIHZhciBhSWQgPSB1cmwubWF0Y2goL2FsYnVtX2lkPShcZCspLyk7CiAgICAgICAgaWYgKGFJZCkgewogICAgICAgICAgYWxidW1EYXRhLmFJZCA9IGFJZFsxXTsKICAgICAgICAgIGFsbG93QXJncyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChhbGxvd0FyZ3MgPT09IGZhbHNlKSB7CiAgICAgICAgICB2YXIgZnJpZW5kSWQgPSB1cmwubWF0Y2goL2ZyaWVuZD0oXGQrKS8pOwogICAgICAgICAgaWYgKGZyaWVuZElkKSB7CiAgICAgICAgICAgIGRlbGV0ZSBhbGJ1bURhdGEuZ2lkOwogICAgICAgICAgICBhbGJ1bURhdGEuaWQgPSBmcmllbmRJZFsxXTsKICAgICAgICAgICAgYWxidW1EYXRhLnBsZWFzZV9kb250X2Rkb3MgPSAzOwogICAgICAgICAgICBhbGxvd0FyZ3MgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGFsbG93QXJncyA9PT0gZmFsc2UgJiYgdXJsLmluZGV4T2YoJz8nKSAhPT0gLTEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsYnVtRGF0YTsKICAgICAgfSwKCiAgICAgIGdldE5ld05vZGVUcmFja0luZm86IGZ1bmN0aW9uKG5vZGUsIGNiKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgdHJhY2sgPSBfdGhpcy5yZWFkTmV3RGF0YUF1ZGlvKG5vZGUuZGF0YXNldC5hdWRpbyk7CgogICAgICAgIHZhciBpbmZvID0gX3RoaXMuZ2V0TmV3VHJhY2tJbmZvKHRyYWNrKTsKICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgIHJldHVybiBjYigiVHJhY2sgaW5mbyBpcyBub3QgZm91bmQhIik7CiAgICAgICAgfQoKICAgICAgICBpZiAoaW5mby51cmwpIHsKICAgICAgICAgIHJldHVybiBjYihudWxsLCBpbmZvKTsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAoaW5mby5mdWxsSWQpIHsKICAgICAgICAgIHJldHVybiBjYihudWxsLCBpbmZvKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGNiKCJUcmFjayBpbmZvIGlzIG5vdCBmb3VuZCEiKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBnZXROZXdBdWRpb0xpbmtzOiBmdW5jdGlvbihjb250YWluZXIsIGNiLCBza2lwQWxidW1JZENoZWNrLCBub1JlcGx5KSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICBjb250YWluZXIgPSBjb250YWluZXIgfHwgZG9jdW1lbnQ7CiAgICAgICAgdmFyIGZyb21QYWdlID0gY29udGFpbmVyID09PSBkb2N1bWVudDsKCiAgICAgICAgaWYgKCFza2lwQWxidW1JZENoZWNrICYmIGZyb21QYWdlKSB7CiAgICAgICAgICB2YXIgYWxidW1JbmZvID0gdGhpcy5nZXRBbGJ1bUlkKGxvY2F0aW9uLmhyZWYpOwogICAgICAgICAgaWYgKGFsYnVtSW5mbykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRMaW5rc0Zyb21BbGJ1bShhbGJ1bUluZm8sIGZ1bmN0aW9uKGxpbmtMaXN0LCB0cmFja0xpc3QpIHsKICAgICAgICAgICAgICBpZiAoIWxpbmtMaXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZ2V0TmV3QXVkaW9MaW5rcyhjb250YWluZXIsIGNiLCAxKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGNiKGxpbmtMaXN0LCB0cmFja0xpc3QpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgZnVsbElkTGlzdCA9IFtdOwoKICAgICAgICB2YXIgYXN5bmMgPSBuZXcgbW9uby5Bc3luY0xpc3QoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgYWJvcnQgPSBudWxsOwogICAgICAgICAgdmFyIHBvcHVwID0gcGhvdG8uZ2V0UG9wdXAoJycsICdhdWRpbycsIGZ1bmN0aW9uIG9uQ2xvc2UoKSB7CiAgICAgICAgICAgIGFib3J0ID0gdHJ1ZTsKICAgICAgICAgIH0pOwogICAgICAgICAgcG9wdXAub25QcmVwYXJlKGxhbmd1YWdlLmRvd25sb2FkICsgJyAuLi4nKTsKCiAgICAgICAgICB2YXIgX3RyYWNrTGlzdCA9IHt9OwoKICAgICAgICAgIHZhciBhc3luYyA9IG5ldyBtb25vLkFzeW5jTGlzdChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKGFib3J0KSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbGlua0xpc3QgPSB7fTsKICAgICAgICAgICAgdmFyIHRyYWNrTGlzdCA9IFtdOwoKICAgICAgICAgICAgZnVsbElkTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGZ1bGxJZCkgewogICAgICAgICAgICAgIHZhciB0cmFjayA9IF90cmFja0xpc3RbZnVsbElkXTsKICAgICAgICAgICAgICB2YXIgaW5mbyA9IHRyYWNrICYmIF90aGlzLmdldE5ld1RyYWNrSW5mbyh0cmFjayk7CiAgICAgICAgICAgICAgaWYgKCFpbmZvIHx8ICFpbmZvLnVybCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gX3RoaXMuZ2V0TmV3QXVkaW9GaWxlbmFtZShpbmZvKTsKICAgICAgICAgICAgICB2YXIgZnVsbFRpdGxlID0gX3RoaXMuZ2V0TmV3QXVkaW9GdWxsVGl0bGUoaW5mbyk7CgogICAgICAgICAgICAgIGxpbmtMaXN0W2luZm8uZnVsbElkXSA9IGluZm8udXJsOwoKICAgICAgICAgICAgICB0cmFja0xpc3QucHVzaCh7CiAgICAgICAgICAgICAgICB1cmw6IGluZm8udXJsLAogICAgICAgICAgICAgICAgdGl0bGU6IGZ1bGxUaXRsZSwKICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHBvcHVwLm9uUmVhZHkoKTsKCiAgICAgICAgICAgIHJldHVybiBjYihsaW5rTGlzdCwgdHJhY2tMaXN0KTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGFzeW5jLndhaXQoKTsKCiAgICAgICAgICB2YXIgaWRzTGlzdCA9IGZ1bGxJZExpc3Quc2xpY2UoMCk7CiAgICAgICAgICB2YXIgbWF4ID0gZnVsbElkTGlzdC5sZW5ndGg7CiAgICAgICAgICB2YXIgY291bnQgPSAwOwogICAgICAgICAgdmFyIG5leHQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGxpc3QgPSBpZHNMaXN0LnNwbGljZSgwLCAyMCk7CiAgICAgICAgICAgIHBvcHVwLm9uUHJvZ3Jlc3MoY291bnQsIG1heCk7CiAgICAgICAgICAgIGFzeW5jLndhaXQoKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBfdGhpcy5nZXROZXdUcmFja0xpc3RCeUlkcyhsaXN0LCBmdW5jdGlvbihlcnIsIHRyYWNrTGlzdCkgewogICAgICAgICAgICAgICAgaWRzTGlzdC5sZW5ndGggJiYgIWFib3J0ICYmIG5leHQoKTsKCiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBhc3luYy5yZWFkeSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAodmFyIGZ1bGxJZCBpbiB0cmFja0xpc3QpIHsKICAgICAgICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgICAgICAgX3RyYWNrTGlzdFtmdWxsSWRdID0gdHJhY2tMaXN0W2Z1bGxJZF07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jLnJlYWR5KCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sIDI1MCk7CiAgICAgICAgICB9OwogICAgICAgICAgbmV4dCgpOwoKICAgICAgICAgIHJldHVybiBhc3luYy5yZWFkeSgpOwogICAgICAgIH0pOwoKICAgICAgICBhc3luYy53YWl0KCk7CgogICAgICAgIFtdLnNsaWNlLmNhbGwoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5hdWRpb19yb3cnKSkuZm9yRWFjaChmdW5jdGlvbihub2RlKSB7CiAgICAgICAgICBpZiAoZnJvbVBhZ2UgJiYgX3RoaXMuZWxJc0hpZGRlbihub2RlKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG5vUmVwbHkgJiYgcGhvdG8uaXNSZXBseShub2RlKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgYXN5bmMud2FpdCgpOwogICAgICAgICAgcmV0dXJuIF90aGlzLmdldE5ld05vZGVUcmFja0luZm8obm9kZSwgZnVuY3Rpb24oZXJyLCBpbmZvKSB7CiAgICAgICAgICAgIGlmIChlcnIgfHwgIWluZm8uZnVsbElkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGFzeW5jLnJlYWR5KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmdWxsSWRMaXN0LmluZGV4T2YoaW5mby5mdWxsSWQpID09PSAtMSkgewogICAgICAgICAgICAgIGZ1bGxJZExpc3QucHVzaChpbmZvLmZ1bGxJZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBhc3luYy5yZWFkeSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBhc3luYy5yZWFkeSgpOwogICAgICB9LAoKICAgICAgZ2V0VGl0bGU6IGZ1bmN0aW9uKGNvbnRhaW5lciwgaWQpIHsKICAgICAgICBpZiAoIWlkIHx8ICFjb250YWluZXIpIHsKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CgogICAgICAgIHZhciBuYW1lID0gJyc7CgogICAgICAgIHZhciBwZXJmb3JtZXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignI3BlcmZvcm1lcicgKyBpZCk7CiAgICAgICAgaWYgKHBlcmZvcm1lciA9PT0gbnVsbCkgewogICAgICAgICAgcGVyZm9ybWVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJyNwZXJmb3JtZXJXYWxsJyArIGlkKTsKICAgICAgICB9CiAgICAgICAgaWYgKHBlcmZvcm1lciA9PT0gbnVsbCkgewogICAgICAgICAgcGVyZm9ybWVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5pbmZvIGInKTsKICAgICAgICB9CgogICAgICAgIHZhciB0aXRsZSA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcjdGl0bGUnICsgaWQpOwogICAgICAgIGlmICh0aXRsZSA9PT0gbnVsbCkgewogICAgICAgICAgdGl0bGUgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignI3RpdGxlV2FsbCcgKyBpZCk7CiAgICAgICAgfQogICAgICAgIGlmICh0aXRsZSA9PT0gbnVsbCkgewogICAgICAgICAgdGl0bGUgPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcignc3Bhbi50aXRsZScpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHBlcmZvcm1lciAhPT0gbnVsbCAmJiBwZXJmb3JtZXIudGV4dENvbnRlbnQpIHsKICAgICAgICAgIG5hbWUgKz0gcGVyZm9ybWVyLnRleHRDb250ZW50LnRyaW0oKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aXRsZSAhPT0gbnVsbCAmJiB0aXRsZS50ZXh0Q29udGVudCkgewogICAgICAgICAgaWYgKG5hbWUpIHsKICAgICAgICAgICAgbmFtZSArPSAnIC0gJzsKICAgICAgICAgIH0KCiAgICAgICAgICBuYW1lICs9IHRpdGxlLnRleHRDb250ZW50LnRyaW0oKTsKICAgICAgICB9CgogICAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgICByZXR1cm4gbmFtZS5yZXBsYWNlKC9cPGFccytbXlw+XStcPi9pZywgJycpLnJlcGxhY2UoL1w8XC9hXD4vaWcsICcnKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAnJzsKICAgICAgfSwKCiAgICAgIHNlY29uZHNGcm9tRHVyYXRpb246IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgdmFyIG0gPSB2YWx1ZS5tYXRjaCgvXig/OlxzKihcZCspXHMqXDopP1xzKihcZCspXHMqXDpccyooXGQrKS8pOwogICAgICAgIGlmIChtICYmIG0ubGVuZ3RoID4gMykgewogICAgICAgICAgaWYgKCFtWzFdKSB7CiAgICAgICAgICAgIG1bMV0gPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBwYXJzZUludChtWzFdKSAqIDM2MDAgKyBwYXJzZUludChtWzJdKSAqIDYwICsgcGFyc2VJbnQobVszXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgICAgfSwKCiAgICAgIHNlY29uZHNGcm9tRHVyYXRpb25Ob2RlOiBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgaWYgKCFub2RlKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHZhciB0ZXh0ID0gbm9kZS50ZXh0Q29udGVudDsKICAgICAgICBpZiAoIXRleHQpIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMuc2Vjb25kc0Zyb21EdXJhdGlvbih0ZXh0KTsKICAgICAgfSwKCiAgICAgIHRvb2x0aXA6IHsKICAgICAgICB0b29sdGlwOiB1bmRlZmluZWQsCiAgICAgICAgdXBkYXRlUG9zOiBmdW5jdGlvbihidXR0b24sIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBidG5Qb3NpdGlvbiA9IFNhdmVGcm9tX1V0aWxzLmdldFBvc2l0aW9uKGJ1dHRvbik7CiAgICAgICAgICB2YXIgc2l6ZSA9IFNhdmVGcm9tX1V0aWxzLmdldFNpemUodGhpcy50b29sdGlwKTsKCiAgICAgICAgICB0aGlzLnRvb2x0aXAuc3R5bGUudG9wID0gKGJ0blBvc2l0aW9uLnRvcCArIG9wdGlvbnMudG9wIC0gc2l6ZS5oZWlnaHQpICsgJ3B4JzsKCiAgICAgICAgICB2YXIgbGVmdCA9IGJ0blBvc2l0aW9uLmxlZnQgKyBwYXJzZUludChvcHRpb25zLndpZHRoIC8gMikgLSBwYXJzZUludChzaXplLndpZHRoIC8gMik7CiAgICAgICAgICB2YXIgcGFnZVdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCArIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDsKICAgICAgICAgIGlmIChwYWdlV2lkdGggPCBsZWZ0ICsgc2l6ZS53aWR0aCkgewogICAgICAgICAgICBsZWZ0ID0gcGFnZVdpZHRoIC0gc2l6ZS53aWR0aDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMudG9vbHRpcC5zdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7CiAgICAgICAgfSwKICAgICAgICBzaG93OiBmdW5jdGlvbihidXR0b24sIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICBpZiAodGhpcy50b29sdGlwICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnRvb2x0aXAgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgICAgIGNsYXNzOiAnc2YtdG9vbHRpcCcsCiAgICAgICAgICAgICAgc3R5bGU6IG1vbm8uZXh0ZW5kKHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnLAogICAgICAgICAgICAgICAgekluZGV4OiA5OTk5LAogICAgICAgICAgICAgICAgb3BhY2l0eTogMCwKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246ICdvcGFjaXR5IDAuMnMnLAogICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcKICAgICAgICAgICAgICB9LCBvcHRpb25zLnN0eWxlKSwKICAgICAgICAgICAgICBvbjogWydtb3VzZWVudGVyJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgX3RoaXMuaGlkZSgpOwogICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMudG9vbHRpcCk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnRvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgX3RoaXMudXBkYXRlUG9zKGJ1dHRvbiwgb3B0aW9ucyk7CiAgICAgICAgICAgIF90aGlzLnRvb2x0aXAuc3R5bGUub3BhY2l0eSA9IDE7CiAgICAgICAgICB9LCAwKTsKCiAgICAgICAgICByZXR1cm4gdGhpcy50b29sdGlwOwogICAgICAgIH0sCiAgICAgICAgaGlkZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLnRvb2x0aXAuc3R5bGUub3BhY2l0eSA9IDA7CiAgICAgICAgICB0aGlzLnRvb2x0aXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBybUJpdHJhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChhdWRpby5ybUJpdHJhdGUuc3R5bGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhdWRpby5ybUJpdHJhdGUuc3R5bGUgPSBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICAgIHRleHQ6ICcuc2YtYml0cmF0ZS12YWx1ZSB7ZGlzcGxheTogbm9uZTt9JwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgICB2YXIgYml0cmF0ZUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2YtYml0cmF0ZS12YWx1ZScpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gYml0cmF0ZUxpc3RbaV07IGkrKykgewogICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGluc2VydE5ld0JpdHJhdGU6IGZ1bmN0aW9uKGJpdHJhdGUsIGFjdGlvbkN0cikgewogICAgICAgIGlmICghYml0cmF0ZSB8fCAhYWN0aW9uQ3RyKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIWFjdGlvbkN0ci5jbGFzc0xpc3QuY29udGFpbnMoJ2F1ZGlvX2FjdHMnKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBhY3Rpb25DdHIucGFyZW50Tm9kZTsKICAgICAgICB2YXIgZHVyYXRpb25Db250YWluZXIgPSBwYXJlbnROb2RlICYmIHBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLmF1ZGlvX2R1cmF0aW9uJyk7CiAgICAgICAgcGFyZW50Tm9kZSA9IG51bGw7CgogICAgICAgIGlmICghZHVyYXRpb25Db250YWluZXIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChhdWRpby5ybUJpdHJhdGUuc3R5bGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgYXVkaW8ucm1CaXRyYXRlLnN0eWxlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYXVkaW8ucm1CaXRyYXRlLnN0eWxlKTsKICAgICAgICAgIGF1ZGlvLnJtQml0cmF0ZS5zdHlsZSA9IHVuZGVmaW5lZDsKICAgICAgICB9CgogICAgICAgIGlmIChkdXJhdGlvbkNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuc2YtYml0cmF0ZS12YWx1ZScpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgc3R5bGUgPSB7CiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgIHdpZHRoOiAnODBweCcsCiAgICAgICAgICB0ZXh0QWxpZ246ICdyaWdodCcsCiAgICAgICAgICByaWdodDogMCwKICAgICAgICAgIG9wYWNpdHk6ICcwLjgnLAogICAgICAgICAgdG9wOiAnMjRweCcsCiAgICAgICAgICBmb250U2l6ZTogJzExcHgnCiAgICAgICAgfTsKCiAgICAgICAgdmFyIGVsID0gbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICB0ZXh0OiAnICcgKyBiaXRyYXRlLAogICAgICAgICAgY2xhc3M6ICdzZi1iaXRyYXRlLXZhbHVlJywKICAgICAgICAgIHN0eWxlOiBzdHlsZQogICAgICAgIH0pOwoKICAgICAgICBkdXJhdGlvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChlbCk7CiAgICAgIH0sCgogICAgICBvbkRsQnRuT3ZlcjogZnVuY3Rpb24oZSkgewogICAgICAgIHZhciB0b29sdGlwID0gYXVkaW8udG9vbHRpcDsKICAgICAgICBpZiAoZS50eXBlICE9PSAnbW91c2VlbnRlcicpIHsKICAgICAgICAgIHRvb2x0aXAuaGlkZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIG5vZGUgPSB0aGlzOwogICAgICAgIHZhciBmdWxsSWQgPSBub2RlLmRhdGFzZXQuZnVsbElkOwoKICAgICAgICB2YXIgdG9wT2Zmc2V0ID0gLTY7CiAgICAgICAgaWYgKHRoaXMuZGF0YXNldC5iaXRyYXRlT2Zmc2V0VG9wKSB7CiAgICAgICAgICB0b3BPZmZzZXQgPSBwYXJzZUludCh0aGlzLmRhdGFzZXQuYml0cmF0ZU9mZnNldFRvcCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICAgIHRvcDogdG9wT2Zmc2V0LAogICAgICAgICAgd2lkdGg6IDI0LAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZicsCiAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjY2NjJywKICAgICAgICAgICAgY29sb3I6ICdyZ2IoNDgsIDQ4LCA0OCknCiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHR0cCA9IHRvb2x0aXAuc2hvdyhub2RlLCBvcHRpb25zKTsKICAgICAgICB0dHAuZGF0YXNldC5mdWxsSWQgPSBmdWxsSWQ7CgogICAgICAgIHZhciBzZXRUdHBMYWJlbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGJpdHJhdGUgPSBub2RlLmRhdGFzZXQuYml0cmF0ZTsKICAgICAgICAgIHZhciBzaXplID0gbm9kZS5kYXRhc2V0LnNpemU7CgogICAgICAgICAgdmFyIHRleHQgPSAnJzsKICAgICAgICAgIGlmICghc2l6ZSkgewogICAgICAgICAgICB0ZXh0ID0gbGFuZ3VhZ2UuZ2V0RmlsZVNpemVGYWlsVGl0bGU7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmIChiaXRyYXRlKSB7CiAgICAgICAgICAgIGF1ZGlvLmluc2VydE5ld0JpdHJhdGUoYml0cmF0ZSwgbm9kZS5wYXJlbnROb2RlKTsKICAgICAgICAgICAgdGV4dCA9ICcgKCcgKyBzaXplICsgJyB+ICcgKyBiaXRyYXRlICsgJyknOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dCA9ICcgKCcgKyBzaXplICsgJyknOwogICAgICAgICAgfQoKICAgICAgICAgIHR0cC5zdHlsZS5wYWRkaW5nID0gJzJweCA1cHggM3B4JzsKICAgICAgICAgIHR0cC50ZXh0Q29udGVudCA9IHRleHQ7CiAgICAgICAgfTsKCiAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zaXplKSB7CiAgICAgICAgICByZXR1cm4gc2V0VHRwTGFiZWwoKTsKICAgICAgICB9CgogICAgICAgIHR0cC5zdHlsZS5wYWRkaW5nID0gJzJweCAycHggMCAycHgnOwogICAgICAgIHR0cC50ZXh0Q29udGVudCA9ICcnOwogICAgICAgIHR0cC5hcHBlbmRDaGlsZChtb25vLmNyZWF0ZSgnaW1nJywgewogICAgICAgICAgc3JjOiAnL2ltYWdlcy91cGxvYWQuZ2lmJywKICAgICAgICAgIGhlaWdodDogOCwKICAgICAgICAgIHdpZHRoOiAzMiwKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIG1hcmdpblRvcDogJzJweCcsCiAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzFweCcKICAgICAgICAgIH0KICAgICAgICB9KSk7CgogICAgICAgIHZhciByZXF1aXJlQml0cmF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgYXVkaW8ucHJlbG9hZE5ld1RyYWNrVXJsKG5vZGUsIGZ1bmN0aW9uKGVycikgewogICAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgICAgaWYgKHR0cC5kYXRhc2V0LmZ1bGxJZCA9PT0gZnVsbElkKSB7CiAgICAgICAgICAgICAgICBzZXRUdHBMYWJlbCgpOwogICAgICAgICAgICAgICAgdG9vbHRpcC51cGRhdGVQb3Mobm9kZSwgb3B0aW9ucyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGF1ZGlvLm9uT3Zlckluc2VydEJpdHJhdGUobm9kZSwgbm9kZS5wYXJlbnROb2RlLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmICh0dHAuZGF0YXNldC5mdWxsSWQgPT09IGZ1bGxJZCkgewogICAgICAgICAgICAgICAgICBzZXRUdHBMYWJlbCgpOwogICAgICAgICAgICAgICAgICB0b29sdGlwLnVwZGF0ZVBvcyhub2RlLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgcmVxdWlyZUJpdHJhdGUoKTsKICAgICAgfSwKCiAgICAgIGlzTmV3UHJlbG9hZFN0YXRlOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICByZXR1cm4gLyNzZi1wcmVsb2FkJC8udGVzdCh1cmwpOwogICAgICB9LAoKICAgICAgcHJlbG9hZE5ld1RyYWNrVXJsOiBmdW5jdGlvbihub2RlLCBjYikgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIGhyZWYgPSBub2RlLmhyZWY7CgogICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZMb2FkaW5nID09PSAnMScpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghdGhpcy5pc05ld1ByZWxvYWRTdGF0ZShocmVmKSkgewogICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgfQoKICAgICAgICBub2RlLmRhdGFzZXQuc2ZMb2FkaW5nID0gJzEnOwoKICAgICAgICB2YXIgZnVsbElkID0gbm9kZS5kYXRhc2V0LmZ1bGxJZDsKICAgICAgICByZXR1cm4gdGhpcy5nZXROZXdUcmFja0xpc3RCeUlkcyhbZnVsbElkXSwgZnVuY3Rpb24oZXJyLCB0cmFja0xpc3QpIHsKICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoJ3NmTG9hZGluZycpKTsKCiAgICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICAgIHJldHVybiBjYihlcnIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0cmFjayA9IHRyYWNrTGlzdFtmdWxsSWRdOwogICAgICAgICAgdmFyIGluZm8gPSB0cmFjayAmJiBfdGhpcy5nZXROZXdUcmFja0luZm8odHJhY2spOwogICAgICAgICAgaWYgKCFpbmZvIHx8ICFpbmZvLnVybCkgewogICAgICAgICAgICByZXR1cm4gY2IoIlRyYWNrIGlzIG5vdCBmb3VuZCEiKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5vZGUuaHJlZiA9IGluZm8udXJsOwogICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIG9uTmV3RGxCdG5DbGljazogZnVuY3Rpb24oZSkgewogICAgICAgIFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkT25DbGljayhlKTsKCiAgICAgICAgdmFyIHJvd0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjYXVkaW9fJyArIHRoaXMuZGF0YXNldC5mdWxsSWQpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCByb3c7IHJvdyA9IHJvd0xpc3RbaV07IGkrKykgewogICAgICAgICAgcm93LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjZjRmN2ZjJzsKICAgICAgICB9CgogICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgIGlmIChtb25vLm1hdGNoZXModGhpcywgJy50b3BfYXVkaW9fcGxheWVyICcgKyB0aGlzLnRhZ05hbWUpKSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgIGVjOiAndmsnLAogICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgIGVsOiAnbXVzaWMtcGxheWVyJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKG1vbm8ubWF0Y2hlcyh0aGlzLCAnLmF1ZGlvX3BhZ2VfcGxheWVyICcgKyB0aGlzLnRhZ05hbWUpKSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgIGVjOiAndmsnLAogICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgIGVsOiAnbXVzaWMtcGxheW5vdycKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ3ZrJywKICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICBlbDogJ211c2ljLWxpc3QnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKCiAgICAgIG9uTmV3UHJlbG9hZFRyYWNrUmVhZHk6IGZ1bmN0aW9uKG5vZGUsIGVycikgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZUdGwgPT09ICcxJykgewogICAgICAgICAgbm9kZS5kYXRhc2V0LnNmVHRsID0gJzAnOwoKICAgICAgICAgIGF1ZGlvLm9uT3Zlckluc2VydEJpdHJhdGUobm9kZSwgbm9kZS5wYXJlbnROb2RlKTsKICAgICAgICB9CgogICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZEbCA9PT0gJzEnKSB7CiAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZEbCA9ICcwJzsKCiAgICAgICAgICBtb25vLnRyaWdnZXIobm9kZSwgJ2NsaWNrJywgewogICAgICAgICAgICBjYW5jZWxhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoJ3NmRGwnKSk7CiAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUobW9uby5kYXRhQXR0cjJTZWxlY3Rvcignc2ZUdGwnKSk7CiAgICAgIH0sCgogICAgICBvbk5ld0RsQnRuQ2xpY2tXcmFwcGVyOiBmdW5jdGlvbihldmVudCkgewogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIHZhciBub2RlID0gdGhpczsKCiAgICAgICAgaWYgKCFhdWRpby5pc05ld1ByZWxvYWRTdGF0ZShub2RlLmhyZWYpKSB7CiAgICAgICAgICByZXR1cm4gYXVkaW8ub25OZXdEbEJ0bkNsaWNrLmNhbGwobm9kZSwgZXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZkRsID09PSAnMScpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbm9kZS5kYXRhc2V0LnNmRGwgPSAnMSc7CgogICAgICAgIHJldHVybiBhdWRpby5wcmVsb2FkTmV3VHJhY2tVcmwodGhpcywgYXVkaW8ub25OZXdQcmVsb2FkVHJhY2tSZWFkeS5iaW5kKGF1ZGlvLCBub2RlKSk7CiAgICAgIH0sCgogICAgICBnZXROZXdEbEJ0bjogZnVuY3Rpb24oaW5mbywgZmlsZW5hbWUpIHsKICAgICAgICB2YXIgYXJncyA9IHsKICAgICAgICAgIGhyZWY6IGluZm8udXJsIHx8ICcjc2YtcHJlbG9hZCcsCiAgICAgICAgICBjbGFzczogW2F1ZGlvLmNsYXNzTmFtZSwgJ3NmLWF1ZGlvLWJ0biddLAogICAgICAgICAgZGF0YTogewogICAgICAgICAgICBkdXJhdGlvbjogaW5mby5kdXJhdGlvbiB8fCAnJywKICAgICAgICAgICAgZnVsbElkOiBpbmZvLmZ1bGxJZAogICAgICAgICAgfSwKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICAgIGhlaWdodDogJzE2cHgnLAogICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJwogICAgICAgICAgfSwKICAgICAgICAgIG9uOiBbCiAgICAgICAgICAgIFsnbW91c2VlbnRlcicsIHRoaXMub25EbEJ0bk92ZXJdLAogICAgICAgICAgICBbJ21vdXNlbGVhdmUnLCB0aGlzLm9uRGxCdG5PdmVyXQogICAgICAgICAgXQogICAgICAgIH07CgogICAgICAgIGlmIChmaWxlbmFtZSkgewogICAgICAgICAgYXJncy5kb3dubG9hZCA9IG1vbm8uZmlsZU5hbWUubW9kaWZ5KGZpbGVuYW1lKTsKICAgICAgICAgIGFyZ3Mub24ucHVzaChbJ2NsaWNrJywgdGhpcy5vbk5ld0RsQnRuQ2xpY2tXcmFwcGVyXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAobW9uby5pc0dNIHx8IG1vbm8uaXNPcGVyYSB8fCBtb25vLmlzU2FmYXJpKSB7CiAgICAgICAgICBhcmdzLnRpdGxlID0gbGFuZ3VhZ2UuZG93bmxvYWRUaXRsZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtb25vLmNyZWF0ZSgnYScsIGFyZ3MpOwogICAgICB9LAoKICAgICAgb25PdmVySW5zZXJ0Qml0cmF0ZTogZnVuY3Rpb24obm9kZSwgYWN0aW9ucywgY2IpIHsKICAgICAgICBpZiAoIWNiICYmIGF1ZGlvLmlzTmV3UHJlbG9hZFN0YXRlKG5vZGUuaHJlZikpIHsKICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlR0bCA9ICcxJzsKICAgICAgICAgIHJldHVybiBhdWRpby5wcmVsb2FkTmV3VHJhY2tVcmwobm9kZSwgYXVkaW8ub25OZXdQcmVsb2FkVHJhY2tSZWFkeS5iaW5kKGF1ZGlvLCBub2RlKSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgb25SZXNwb25zZSA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5maWxlU2l6ZSkgewogICAgICAgICAgICBub2RlLmhyZWYgPSAnI3NmLXByZWxvYWQnOwogICAgICAgICAgICBkZWxldGUgYXVkaW8uY2FjaGVbbm9kZS5kYXRhc2V0LmZ1bGxJZF07CiAgICAgICAgICAgIGNiICYmIGNiKHJlc3BvbnNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzaXplID0gU2F2ZUZyb21fVXRpbHMuc2l6ZUh1bWFuKHJlc3BvbnNlLmZpbGVTaXplLCAyKTsKICAgICAgICAgIHZhciBiaXRyYXRlID0gJyc7CiAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LmR1cmF0aW9uKSB7CiAgICAgICAgICAgIGJpdHJhdGUgPSBNYXRoLmZsb29yKChyZXNwb25zZS5maWxlU2l6ZSAvIG5vZGUuZGF0YXNldC5kdXJhdGlvbikgLyAxMjUpICsgJyAnICsgbGFuZ3VhZ2Uua2JwczsKICAgICAgICAgIH0KCiAgICAgICAgICBub2RlLmRhdGFzZXQuYml0cmF0ZSA9IGJpdHJhdGU7CiAgICAgICAgICBub2RlLmRhdGFzZXQuc2l6ZSA9IHNpemU7CgogICAgICAgICAgYXVkaW8uaW5zZXJ0TmV3Qml0cmF0ZShiaXRyYXRlLCBhY3Rpb25zKTsKCiAgICAgICAgICBjYiAmJiBjYihyZXNwb25zZSk7CiAgICAgICAgfTsKICAgICAgICB0cnkgewogICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldEZpbGVTaXplJywKICAgICAgICAgICAgdXJsOiBub2RlLmhyZWYKICAgICAgICAgIH0sIG9uUmVzcG9uc2UpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIG9uUmVzcG9uc2UobnVsbCk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZ2V0TmV3QXVkaW9GdWxsVGl0bGU6IGZ1bmN0aW9uKGluZm8pIHsKICAgICAgICB2YXIgZm5BcnIgPSBbXTsKCiAgICAgICAgaWYgKGluZm8udGl0bGUpIHsKICAgICAgICAgIGZuQXJyLnB1c2goaW5mby50aXRsZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoaW5mby5wZXJmb3JtZXIpIHsKICAgICAgICAgIGlmIChmbkFyci5sZW5ndGgpIHsKICAgICAgICAgICAgZm5BcnIudW5zaGlmdCgnIC0gJyk7CiAgICAgICAgICB9CgogICAgICAgICAgZm5BcnIudW5zaGlmdChpbmZvLnBlcmZvcm1lcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZm5BcnIuam9pbignJyk7CiAgICAgIH0sCgogICAgICBnZXROZXdBdWRpb0ZpbGVuYW1lOiBmdW5jdGlvbihpbmZvKSB7CiAgICAgICAgdmFyIGZ1bGxUaXRsZSA9IHRoaXMuZ2V0TmV3QXVkaW9GdWxsVGl0bGUoaW5mbyk7CgogICAgICAgIGlmIChmdWxsVGl0bGUpIHsKICAgICAgICAgIGZ1bGxUaXRsZSArPSAnLm1wMyc7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZnVsbFRpdGxlOwogICAgICB9LAoKICAgICAgaGFuZGxlTmV3Q3VycmVudEF1ZGlvUm93OiBmdW5jdGlvbihjb250YWluZXIsIGluZm8sIHR5cGUpIHsKICAgICAgICB2YXIgZmlsZW5hbWUgPSB0aGlzLmdldE5ld0F1ZGlvRmlsZW5hbWUoaW5mbyk7CiAgICAgICAgdmFyIGRsQnRuID0gdGhpcy5nZXROZXdEbEJ0bihpbmZvLCBmaWxlbmFtZSk7CgogICAgICAgIHZhciBhcnJvd0NvbG9yID0gJyM2QzhDQUMnOwogICAgICAgIGlmICh0eXBlID09PSAxKSB7CiAgICAgICAgICBhcnJvd0NvbG9yID0gJyNDNEQxREUnOwogICAgICAgIH0KCiAgICAgICAgZGxCdG4uY2xhc3NMaXN0LnJlbW92ZSgnc2YtYXVkaW8tYnRuJyk7CiAgICAgICAgbW9uby5jcmVhdGUoZGxCdG4sIHsKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgYXJyb3dDb2xvcikgKyAnKSBjZW50ZXIgbm8tcmVwZWF0JywKICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JywKICAgICAgICAgICAgd2lkdGg6ICcxMnB4JywKICAgICAgICAgICAgaGVpZ2h0OiAnMTJweCcsCiAgICAgICAgICAgIHBhZGRpbmc6IDAsCiAgICAgICAgICAgIG1hcmdpbjogMCwKICAgICAgICAgICAgY3NzRmxvYXQ6ICdsZWZ0JywKICAgICAgICAgICAgbWFyZ2luUmlnaHQ6ICczcHgnLAogICAgICAgICAgICBtYXJnaW5Ub3A6ICcxcHgnLAogICAgICAgICAgICBtYXJnaW5Cb3R0b206ICctMnB4JwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgYXR0ck9ic2VydmVyID0gbnVsbDsKCiAgICAgICAgbW9uby5vblJlbW92ZUV2ZW50KGRsQnRuLCBmdW5jdGlvbigpIHsKICAgICAgICAgIG1vbm8ub25lKGNvbnRhaW5lciwgJ21vdXNlb3ZlcicsIHZrLm11dGF0aW9uTW9kZS53cmFwTmV3QXVkaW9Pbk1vdXNlT3Zlcik7CiAgICAgICAgICBhdHRyT2JzZXJ2ZXIgJiYgYXR0ck9ic2VydmVyLnN0b3AoKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHR5cGUgPT09IDIpIHsKICAgICAgICAgIHZhciBwYXJlbnQgPSBtb25vLmdldFBhcmVudChjb250YWluZXIsICcuYXVkaW9fcGFnZV9wbGF5ZXInKTsKICAgICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgICAgYXR0ck9ic2VydmVyID0gU2F2ZUZyb21fVXRpbHMubXV0YXRpb25BdHRyV2F0Y2hlci5ydW4oewogICAgICAgICAgICAgIHRhcmdldDogcGFyZW50LAogICAgICAgICAgICAgIGF0dHI6IFsnZGF0YS1mdWxsLWlkJ10sCiAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZGxCdG4ucGFyZW50Tm9kZSAmJiBkbEJ0bi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGRsQnRuKTsKICAgICAgICAgICAgICAgIGF0dHJPYnNlcnZlciAmJiBhdHRyT2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZSA9PT0gMSkgewogICAgICAgICAgZGxCdG4uZGF0YXNldC5iaXRyYXRlT2Zmc2V0VG9wID0gLTI7CiAgICAgICAgfQoKICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGRsQnRuLCBjb250YWluZXIuZmlyc3RDaGlsZCk7CiAgICAgIH0sCgogICAgICBoYW5kbGVOZXdBdWRpb1JvdzogZnVuY3Rpb24oY29udGFpbmVyLCBidG5Db250YWluZXIsIGluZm8pIHsKICAgICAgICB2YXIgZmlsZW5hbWUgPSB0aGlzLmdldE5ld0F1ZGlvRmlsZW5hbWUoaW5mbyk7CiAgICAgICAgdmFyIGRsQnRuID0gdGhpcy5nZXROZXdEbEJ0bihpbmZvLCBmaWxlbmFtZSk7CgogICAgICAgIG1vbm8uY3JlYXRlKGRsQnRuLCB7CiAgICAgICAgICBjbGFzczogWydhdWRpb19hY3QnXSwKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsCiAgICAgICAgICAgIG1hcmdpblRvcDogJy0ycHgnLAogICAgICAgICAgICBtYXJnaW5Cb3R0b206ICctMnB4JwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZmlyc3RDaGlsZCA9IGJ0bkNvbnRhaW5lci5maXJzdENoaWxkOwogICAgICAgIGlmIChmaXJzdENoaWxkKSB7CiAgICAgICAgICBidG5Db250YWluZXIuaW5zZXJ0QmVmb3JlKGRsQnRuLCBmaXJzdENoaWxkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnRuQ29udGFpbmVyLmFwcGVuZENoaWxkKGRsQnRuKTsKICAgICAgICB9CgogICAgICAgIGlmIChwcmVmZXJlbmNlLnZrU2hvd0JpdHJhdGUgPT09IDEpIHsKICAgICAgICAgIHRoaXMub25PdmVySW5zZXJ0Qml0cmF0ZShkbEJ0biwgYnRuQ29udGFpbmVyKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBhZGROZXdEbFRyYWNrQnRuOiBmdW5jdGlvbihjb250YWluZXIpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB2YXIgYnRuQ29udGFpbmVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5hdWRpb19hY3RzJyk7CiAgICAgICAgaWYgKCFidG5Db250YWluZXIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLmdldE5ld05vZGVUcmFja0luZm8oY29udGFpbmVyLCBmdW5jdGlvbihlcnIsIGluZm8pIHsKICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzLmhhbmRsZU5ld0F1ZGlvUm93KGNvbnRhaW5lciwgYnRuQ29udGFpbmVyLCBpbmZvKTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIGdldE5ld1RyYWNrSW5mbzogZnVuY3Rpb24odHJhY2spIHsKICAgICAgICBpZiAoIXRyYWNrKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHZhciBpbmZvID0ge307CiAgICAgICAgaW5mby51cmwgPSB0cmFja1syXTsKICAgICAgICBpbmZvLnRpdGxlID0gdHJhY2tbM107CiAgICAgICAgaWYgKGluZm8udGl0bGUpIHsKICAgICAgICAgIGluZm8udGl0bGUgPSBybUVtVGFncyhpbmZvLnRpdGxlKTsKICAgICAgICB9CgogICAgICAgIGluZm8ucGVyZm9ybWVyID0gdHJhY2tbNF07CiAgICAgICAgaWYgKGluZm8ucGVyZm9ybWVyKSB7CiAgICAgICAgICBpbmZvLnBlcmZvcm1lciA9IHJtRW1UYWdzKGluZm8ucGVyZm9ybWVyKTsKICAgICAgICB9CgogICAgICAgIGluZm8uZHVyYXRpb24gPSBwYXJzZUludCh0cmFja1s1XSk7CgogICAgICAgIGlmICh0cmFja1sxXSAmJiB0cmFja1swXSkgewogICAgICAgICAgaW5mby5mdWxsSWQgPSB0cmFja1sxXSArICdfJyArIHRyYWNrWzBdOwogICAgICAgIH0KCiAgICAgICAgaW5mby5pZCA9IHRyYWNrWzBdOwogICAgICAgIGluZm8ub3duZXJJZCA9IHRyYWNrWzFdOwogICAgICAgIHJldHVybiBpbmZvOwogICAgICB9LAoKICAgICAgcmVhZE5ld0RhdGFBdWRpbzogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBhZGROZXdEbEN1cnJlbnRUcmFja0J0bjogZnVuY3Rpb24oY29udGFpbmVyLCB0eXBlKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICBTYXZlRnJvbV9VdGlscy5icmlkZ2UoewogICAgICAgICAgZnVuYzogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgdmFyIHRyYWNrID0gbnVsbDsKCiAgICAgICAgICAgIGlmICghdHJhY2sgJiYgdHlwZW9mIGFwICE9PSAndW5kZWZpbmVkJyAmJiBhcC5fY3VycmVudEF1ZGlvKSB7CiAgICAgICAgICAgICAgdHJhY2sgPSBhcC5fY3VycmVudEF1ZGlvOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXRyYWNrICYmIHR5cGVvZiBjdXIgIT09ICd1bmRlZmluZWQnICYmIGN1ci5hdWRpb1BhZ2UgJiYgY3VyLmF1ZGlvUGFnZS5fcmVhZHlBdWRpbykgewogICAgICAgICAgICAgIHRyYWNrID0gY3VyLmF1ZGlvUGFnZS5fcmVhZHlBdWRpbzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCF0cmFjaykgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0cmFjayA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmF1ZGlvX3Y5X3RyYWNrKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY2IodHJhY2spOwogICAgICAgICAgfSwKICAgICAgICAgIGNiOiBmdW5jdGlvbih0cmFjaykgewogICAgICAgICAgICBpZiAoIXRyYWNrKSB7CiAgICAgICAgICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXVkaW9fcGFnZV9wbGF5ZXJbZGF0YS1hdWRpb10nKTsKICAgICAgICAgICAgICB0cmFjayA9IG5vZGUgJiYgX3RoaXMucmVhZE5ld0RhdGFBdWRpbyhub2RlLmRhdGFzZXQuYXVkaW8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaW5mbyA9IHRyYWNrICYmIF90aGlzLmdldE5ld1RyYWNrSW5mbyh0cmFjayk7CiAgICAgICAgICAgIGlmICghaW5mbykgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG9uR2V0SW5mbyA9IGZ1bmN0aW9uKGluZm8pIHsKICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVOZXdDdXJyZW50QXVkaW9Sb3coY29udGFpbmVyLCBpbmZvLCB0eXBlKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmICghaW5mby51cmwpIHsKICAgICAgICAgICAgICBpZiAoaW5mby5mdWxsSWQpIHsKICAgICAgICAgICAgICAgIG9uR2V0SW5mbyhpbmZvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgb25HZXRJbmZvKGluZm8pOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgdGltZW91dDogMzAwCiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICBvbk5ld01vdXNlT3ZlcjogZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBfdGhpcyA9IGF1ZGlvOwogICAgICAgIHZhciByb3cgPSB0aGlzOwogICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYXVkaW8uY2xhc3NOYW1lKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBjdXJyZW50VHJhY2tUeXBlID0gbnVsbDsKICAgICAgICBpZiAocm93LmNsYXNzTGlzdC5jb250YWlucygndG9wX2F1ZGlvX3BsYXllcl90aXRsZScpKSB7CiAgICAgICAgICBjdXJyZW50VHJhY2tUeXBlID0gMTsKICAgICAgICB9CiAgICAgICAgaWYgKHJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ2F1ZGlvX3BhZ2VfcGxheWVyX3RpdGxlJykpIHsKICAgICAgICAgIGN1cnJlbnRUcmFja1R5cGUgPSAyOwogICAgICAgIH0KCiAgICAgICAgaWYgKGN1cnJlbnRUcmFja1R5cGUpIHsKICAgICAgICAgIF90aGlzLmFkZE5ld0RsQ3VycmVudFRyYWNrQnRuLmNhbGwoX3RoaXMsIHJvdywgY3VycmVudFRyYWNrVHlwZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzLmFkZE5ld0RsVHJhY2tCdG4uY2FsbChfdGhpcywgcm93KTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBhZGRDdXN0b21TdHlsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMuYWRkQ3VzdG9tU3R5bGUuaGFzU3R5bGUgPT09IDEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5hZGRDdXN0b21TdHlsZS5oYXNTdHlsZSA9IDE7CgogICAgICAgIHZhciBjdXJyZW50U3R5bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2F2ZWZyb20tc3R5bGVzLnNmLWF1ZGlvJyk7CiAgICAgICAgaWYgKGN1cnJlbnRTdHlsZSkgewogICAgICAgICAgY3VycmVudFN0eWxlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY3VycmVudFN0eWxlKTsKICAgICAgICB9CgogICAgICAgIFNhdmVGcm9tX1V0aWxzLmFkZFN0eWxlUnVsZXMoJy4nICsgZG93bmxvYWRMaW5rQ2xhc3NOYW1lICsgJy5zZi1hdWRpby1idG4nLCB7CiAgICAgICAgICAnYmFja2dyb3VuZCc6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyM1ZjdmYTInKSArICcpIGNlbnRlciBuby1yZXBlYXQgIWltcG9ydGFudCcsCiAgICAgICAgICAnb3BhY2l0eSc6ICcwLjQnCiAgICAgICAgfSwgJ3NmLWF1ZGlvJyk7CiAgICAgIH0sCgogICAgICBoaWRlTGlua3M6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLmFkZEN1c3RvbVN0eWxlLmhhc1N0eWxlKSB7CiAgICAgICAgICB0aGlzLmFkZEN1c3RvbVN0eWxlLmhhc1N0eWxlID0gMDsKCiAgICAgICAgICB2YXIgY3VycmVudFN0eWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NhdmVmcm9tLXN0eWxlcy5zZi1hdWRpbycpOwogICAgICAgICAgaWYgKGN1cnJlbnRTdHlsZSkgewogICAgICAgICAgICBjdXJyZW50U3R5bGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjdXJyZW50U3R5bGUpOwogICAgICAgICAgfQoKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmFkZFN0eWxlUnVsZXMoJy4nICsgZG93bmxvYWRMaW5rQ2xhc3NOYW1lLCB7CiAgICAgICAgICAgICdkaXNwbGF5JzogJ25vbmUnCiAgICAgICAgICB9LCAnc2YtYXVkaW8nKTsKICAgICAgICB9CiAgICAgICAgaWYgKGF1ZGlvLnRvb2x0aXAudG9vbHRpcCkgewogICAgICAgICAgYXVkaW8udG9vbHRpcC50b29sdGlwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYXVkaW8udG9vbHRpcC50b29sdGlwKTsKICAgICAgICAgIGF1ZGlvLnRvb2x0aXAudG9vbHRpcCA9IHVuZGVmaW5lZDsKICAgICAgICB9CgogICAgICAgIGF1ZGlvLmNhY2hlID0ge307CiAgICAgIH0sCgogICAgICBlbElzSGlkZGVuOiBmdW5jdGlvbiBpc0hpZGRlbihlbCkgewogICAgICAgIHJldHVybiAoZWwub2Zmc2V0UGFyZW50ID09PSBudWxsKQogICAgICB9LAoKICAgICAgZ2V0VGl0bGVGb3JMaW5rTGlzdDogZnVuY3Rpb24obGlua0xpc3QpIHsKICAgICAgICB2YXIgbGlzdCA9IFtdOwogICAgICAgIGlmICghbGlua0xpc3QpIHsKICAgICAgICAgIHJldHVybiBsaXN0OwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpIGluIGxpbmtMaXN0KSB7CiAgICAgICAgICB2YXIgaWQgPSBpOwogICAgICAgICAgdmFyIHJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdWRpbycgKyBpZCk7CiAgICAgICAgICBpZiAocm93ID09PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHRpdGxlID0gYXVkaW8uZ2V0VGl0bGUocm93LCBpZCk7CgogICAgICAgICAgdmFyIGR1cmF0aW9uID0gMDsKICAgICAgICAgIHZhciBkID0gcm93LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5kdXJhdGlvbicpOwogICAgICAgICAgaWYgKGQgIT09IG51bGwpIHsKICAgICAgICAgICAgZHVyYXRpb24gPSBhdWRpby5zZWNvbmRzRnJvbUR1cmF0aW9uTm9kZShkKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBtb25vLmZpbGVOYW1lLm1vZGlmeSh0aXRsZSA/IHRpdGxlICsgJy5tcDMnIDogJycpOwoKICAgICAgICAgIGxpc3QucHVzaCh7CiAgICAgICAgICAgIHVybDogbGlua0xpc3RbaV0sCiAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSwKICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbGlzdDsKICAgICAgfSwKCiAgICAgIGRvd25sb2FkTVAzRmlsZXM6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBjb250YWluZXIgPSBwaG90by5nZXRMYXllcigpIHx8IGRvY3VtZW50OwogICAgICAgIGF1ZGlvLmdldE5ld0F1ZGlvTGlua3MoY29udGFpbmVyLCBmdW5jdGlvbihsaW5rTGlzdCwgdHJhY2tMaXN0KSB7CiAgICAgICAgICB2YXIgbGlzdCA9IHRyYWNrTGlzdCB8fCBhdWRpby5nZXRUaXRsZUZvckxpbmtMaXN0KGxpbmtMaXN0KTsKCiAgICAgICAgICBpZiAobGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGFsZXJ0KGxhbmd1YWdlLnZrTXAzTGlua3NOb3RGb3VuZCk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBtcDMKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkTGlzdC5zaG93QmVmb3JlRG93bmxvYWRQb3B1cChsaXN0LCB7CiAgICAgICAgICAgIHR5cGU6ICdhdWRpbycsCiAgICAgICAgICAgIGZvbGRlck5hbWU6IGdldEZvbGRlck5hbWUoKQogICAgICAgICAgfSk7CiAgICAgICAgfSwgbnVsbCwgMSk7CiAgICAgIH0sCgogICAgICBzaG93TGlzdE9mQXVkaW9GaWxlczogZnVuY3Rpb24oc2hvd1BsYXlsaXN0KSB7CiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHBob3RvLmdldExheWVyKCkgfHwgZG9jdW1lbnQ7CiAgICAgICAgYXVkaW8uZ2V0TmV3QXVkaW9MaW5rcyhjb250YWluZXIsIGZ1bmN0aW9uKGxpbmtMaXN0LCB0cmFja0xpc3QpIHsKICAgICAgICAgIHZhciBsaXN0OwogICAgICAgICAgaWYgKHNob3dQbGF5bGlzdCkgewogICAgICAgICAgICBsaXN0ID0gdHJhY2tMaXN0IHx8IGF1ZGlvLmdldFRpdGxlRm9yTGlua0xpc3QobGlua0xpc3QpOwoKICAgICAgICAgICAgaWYgKGxpc3QubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFNhdmVGcm9tX1V0aWxzLnBsYXlsaXN0LnBvcHVwUGxheWxpc3QobGlzdCwgZ2V0Rm9sZGVyTmFtZSgpLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGlzdCA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBpIGluIGxpbmtMaXN0KSB7CiAgICAgICAgICAgICAgbGlzdC5wdXNoKHsKICAgICAgICAgICAgICAgIHVybDogbGlua0xpc3RbaV0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGxpc3QubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFNhdmVGcm9tX1V0aWxzLnBsYXlsaXN0LnBvcHVwRmlsZWxpc3QobGlzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBhbGVydChsYW5ndWFnZS52a01wM0xpbmtzTm90Rm91bmQpOwogICAgICAgIH0sIG51bGwsIDEpOwogICAgICB9CiAgICB9OwoKICAgIC8vICAvQVVESU8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vICBWSURFTwoKICAgIHZhciB2aWRlbyA9IHsKICAgICAgcGFuZWxJZDogJ3NhdmVmcm9tX192a192aWRlb19saW5rcycsCiAgICAgIHZpZGVvQXR0cjogJ2RhdGEtc2F2ZWZyb20tdmlkZW8nLAogICAgICBoaWRkZW5BdHRyOiAnZGF0YS1zYXZlZnJvbS1oaWRkZW4nLAogICAgICBidG5Cb3hJZDogJ3NmLWlmcmFtZS1kbC1idG4nLAogICAgICBidG5Cb3g6IG51bGwsCiAgICAgIHN0eWxlOiB7CiAgICAgICAgZm9udFNpemU6ICcxMHB0JywKICAgICAgICBtYXJnaW46ICcxNXB4IDAnLAogICAgICAgIHBhZGRpbmc6ICcwJwogICAgICB9LAoKICAgICAgZ2V0TGlua3NGb3JtVXJsOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICBpZiAoIXVybCkgcmV0dXJuOwoKICAgICAgICBpZiAodXJsLnN1YnN0cigwLCAyKSA9PT0gJy8vJykgewogICAgICAgICAgdXJsID0gJ2h0dHA6JyArIHVybDsKICAgICAgICB9CgogICAgICAgIGlmIChwcmVmZXJlbmNlLnNob3dVbW15SXRlbSAmJiB0aGlzLmlzUnV0dWJlTGluayh1cmwpKSB7CiAgICAgICAgICByZXR1cm4gdmlkZW8uZ2V0UnV0dWJlTGlua3ModXJsKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmlzUGxhZGZvcm1MaW5rKHVybCkpIHsKICAgICAgICAgIHJldHVybiB2aWRlby5nZXRQbGFkZm9ybUxpbmtzKHVybCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVxdWVzdDsKICAgICAgICB2YXIgaG9zdGluZ0xpc3QgPSBTYXZlRnJvbV9VdGlscy5lbWJlZERvd25sb2FkZXIuaG9zdGluZ3M7CiAgICAgICAgZm9yICh2YXIgaG9zdGluZ05hbWUgaW4gaG9zdGluZ0xpc3QpIHsKICAgICAgICAgIHZhciBob3N0aW5nID0gaG9zdGluZ0xpc3RbaG9zdGluZ05hbWVdOwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBob3N0aW5nLnJlW2ldOyBpKyspIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSB1cmwubWF0Y2goaXRlbSk7CiAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgcmVxdWVzdCA9IHsKICAgICAgICAgICAgICAgIGhvc3Rpbmc6IGhvc3RpbmdOYW1lLAogICAgICAgICAgICAgICAgYWN0aW9uOiBob3N0aW5nLmFjdGlvbiwKICAgICAgICAgICAgICAgIGV4dFZpZGVvSWQ6IGRhdGFbMV0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVxdWVzdCkgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJlcXVlc3QpIHJldHVybjsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcmVxdWVzdDogcmVxdWVzdAogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGdldExpbmtzRnJvbUZsYXNoVmFyczogZnVuY3Rpb24oZmxhc2hWYXJzKSB7CiAgICAgICAgdmFyIHBhcmFtcyA9IG1vbm8ucGFyc2VVcmwoZmxhc2hWYXJzLCB7CiAgICAgICAgICBwYXJhbXM6IHRydWUKICAgICAgICB9KTsKICAgICAgICB2YXIgbGlua3MgPSB2aWRlby5nZXRMaW5rc0Zyb21IdG1sNU1ldGFEYXRhKHBhcmFtcyk7CiAgICAgICAgcmV0dXJuIGxpbmtzOwogICAgICB9LAoKICAgICAgZ2V0TGlua3NGcm9tSHRtbDVNZXRhRGF0YTogZnVuY3Rpb24obWV0YURhdGEpIHsKICAgICAgICBpZiAoIW1ldGFEYXRhKSByZXR1cm47CgogICAgICAgIHZhciB0aXRsZSA9IG1ldGFEYXRhLm1kX3RpdGxlOwoKICAgICAgICBpZiAodGl0bGUgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwoKICAgICAgICB2YXIgdmlkZW9VcmxSZWdFeHAgPSAvdXJsKFswLTldKykvOwogICAgICAgIHZhciB1cmxMaXN0ID0ge307CgogICAgICAgIHZhciBoYXNMaW5rcyA9IGZhbHNlOwogICAgICAgIGZvciAodmFyIGtleSBpbiBtZXRhRGF0YSkgewogICAgICAgICAgaWYgKGtleSA9PT0gJ2V4dHJhX2RhdGEnICYmIG1ldGFEYXRhLmV4dHJhID09PSAiNTIiKSB7CiAgICAgICAgICAgIHVybExpc3RbJ0luc3RhZ3JhbSddID0gbWV0YURhdGFba2V5XTsKICAgICAgICAgICAgaGFzTGlua3MgPSB0cnVlOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBxdWFsaXR5ID0ga2V5Lm1hdGNoKHZpZGVvVXJsUmVnRXhwKTsKICAgICAgICAgIGlmIChxdWFsaXR5ID09PSBudWxsKSBjb250aW51ZTsKCiAgICAgICAgICB2YXIgbGluayA9IG1ldGFEYXRhW2tleV07CiAgICAgICAgICB2YXIgdlBvcyA9IGxpbmsuaW5kZXhPZignPycpOwogICAgICAgICAgaWYgKHZQb3MgIT09IC0xKSB7CiAgICAgICAgICAgIGxpbmsgPSBsaW5rLnN1YnN0cigwLCB2UG9zKTsKICAgICAgICAgIH0KICAgICAgICAgIGhhc0xpbmtzID0gdHJ1ZTsKICAgICAgICAgIHVybExpc3RbcXVhbGl0eVsxXV0gPSBsaW5rOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYXNMaW5rcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIGxpbmtzOiB1cmxMaXN0CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZ2V0UnV0dWJlTGlua3M6IGZ1bmN0aW9uKHNyYykgewogICAgICAgIGlmICghL3J1dHViZVteXC9dK1wvKD86cGxheXx2aWRlbylcL2VtYmVkXC8oXGQrKS8udGVzdChzcmMpICYmICEvdmlkZW9cLnJ1dHViZVwuLy50ZXN0KHNyYykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBsaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MucnV0dWJlKHNyYyk7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpc1VtbXk6IHRydWUsCiAgICAgICAgICBsaW5rczogbGlua3MKICAgICAgICB9OwogICAgICB9LAoKICAgICAgaXNSdXR1YmVMaW5rOiBmdW5jdGlvbihzcmMpIHsKICAgICAgICByZXR1cm4gL1wvXC8uKnJ1dHViZVwuLiovLnRlc3Qoc3JjKTsKICAgICAgfSwKCiAgICAgIGdldFBsYWRmb3JtTGlua3M6IGZ1bmN0aW9uKHNyYykgewogICAgICAgIGlmICghc3JjKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgcGFyYW1zID0gbW9uby5wYXJzZVVybChzcmMpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFBsYWRmb3JtVmlkZW8nLAogICAgICAgICAgICBleHRWaWRlb0lkOiB7CiAgICAgICAgICAgICAgcGxheWVySWQ6IHBhcmFtcy5wbCwKICAgICAgICAgICAgICB2aWRlb0lkOiBwYXJhbXMudmlkZW9pZAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSwKCiAgICAgIGlzUGxhZGZvcm1MaW5rOiBmdW5jdGlvbihzcmMpIHsKICAgICAgICByZXR1cm4gL1wvXC8uKnBsYWRmb3JtXC4uKi8udGVzdChzcmMpOwogICAgICB9LAoKICAgICAgZ2V0TGlua3NWaWRlb0VsOiBmdW5jdGlvbih2aWRlb0VsLCBsYXllcikgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgdGl0bGUgPSBsYXllci5xdWVyeVNlbGVjdG9yKCcudnZfc3VtbWFyeScpOwogICAgICAgIGlmICghdGl0bGUpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICB0aXRsZSA9IHRpdGxlLnRleHRDb250ZW50OwoKICAgICAgICB2YXIgbGlua0xpc3QgPSB7fTsKICAgICAgICB2YXIgaGFzTGlua3M7CiAgICAgICAgdmFyIHNvdXJjZUxpc3QgPSB2aWRlb0VsLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NvdXJjZScpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gc291cmNlTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICB2YXIgc3JjID0gbm9kZS5zcmMgfHwgJyc7CiAgICAgICAgICB2YXIgcG9zID0gc3JjLmluZGV4T2YoJz8nKTsKICAgICAgICAgIGlmIChwb3MgIT09IC0xKSB7CiAgICAgICAgICAgIHNyYyA9IHNyYy5zdWJzdHIoMCwgcG9zKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBtID0gc3JjLm1hdGNoKC9cLihcZCspXC5bXlwvXSskLyk7CiAgICAgICAgICBpZiAobSA9PT0gbnVsbCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGxpbmtMaXN0W21bMV1dID0gc3JjOwogICAgICAgICAgaGFzTGlua3MgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYXNMaW5rcykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIGxpbmtzOiBsaW5rTGlzdAogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGdldFBsYXllck5vZGU6IGZ1bmN0aW9uKGxheWVyKSB7CiAgICAgICAgdmFyIHBsYXllciA9IG51bGw7CiAgICAgICAgWwogICAgICAgICAgJyN2aWRlb195dF9wbGF5ZXInLAogICAgICAgICAgJyNodG1sNV9wbGF5ZXInLAogICAgICAgICAgJyNmbGFzaF92aWRlb19vYmonLAogICAgICAgICAgJyNwbGF5ZXJPYmonLAogICAgICAgICAgJyNwbGF5ZXInLAogICAgICAgICAgJy52aWRlb19ib3hfd3JhcCA+ICN2aWRlb19wbGF5ZXInCiAgICAgICAgXS5zb21lKGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICAgICAgICBwbGF5ZXIgPSBsYXllci5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHBsYXllcjsKICAgICAgfSwKCiAgICAgIGdldExpbmtzRnJvbU12OiBmdW5jdGlvbihvaWQsIHZpZCwgY2IpIHsKICAgICAgICBTYXZlRnJvbV9VdGlscy5icmlkZ2UoewogICAgICAgICAgYXJnczogW3ZpZCwgb2lkXSwKICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKHZpZCwgb2lkLCBjYikgewogICAgICAgICAgICB2YXIgbXZjdXIgPSB3aW5kb3cubXZjdXI7CiAgICAgICAgICAgIGlmICghbXZjdXIgfHwgIW12Y3VyLnBsYXllciB8fCAhbXZjdXIucGxheWVyLnZhcnMpIHsKICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHZhcnMgPSBtdmN1ci5wbGF5ZXIudmFyczsKICAgICAgICAgICAgaWYgKHZhcnMudmlkICE9PSB2aWQgfHwgdmFycy5vaWQgIT09IG9pZCkgewogICAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgICAgIHZhcnM6IG12Y3VyLnBsYXllci52YXJzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGNiOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbGlua3MgPSB2aWRlby5nZXRMaW5rc0Zyb21IdG1sNU1ldGFEYXRhKGRhdGEudmFycyk7CiAgICAgICAgICAgIHJldHVybiBjYihsaW5rcyk7CiAgICAgICAgICB9LAogICAgICAgICAgdGltZW91dDogMzAwCiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICBnZXRMaW5rc0Zyb21GcmFtZTogZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgICAgICB2YXIgaHRtbCA9IGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MOwogICAgICAgIHZhciBwYXJhbXMgPSBtb25vLnBhcnNlVXJsKGxvY2F0aW9uLmhyZWYpOwogICAgICAgIHZhciBvaWQgPSBwYXJzZUludChwYXJhbXMub2lkKTsKICAgICAgICB2YXIgaWQgPSBwYXJzZUludChwYXJhbXMuaWQpOwogICAgICAgIGlmIChvaWQgJiYgaWQpIHsKICAgICAgICAgIHZhciB2YXJzSnNvbiA9IG51bGw7CiAgICAgICAgICBtb25vLmZpbmRKc29uKGh0bWwsIFsvInZpZCI6LywgLyJvaWQiOi8sIC8ibWRfdGl0bGUiOi9dKS5zb21lKGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICB2YXJzSnNvbiA9IG9iajsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmICh2YXJzSnNvbiAmJiB2YXJzSnNvbi52aWQgPT09IGlkICYmIHZhcnNKc29uLm9pZCA9PT0gb2lkKSB7CiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7CiAgICAgICAgICAgICAgcmVxdWVzdDogewogICAgICAgICAgICAgICAgaG9zdGluZzogJ3ZrJywKICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldFZrTGlua3NGcm9tSnNvbk1zZycsCiAgICAgICAgICAgICAgICBqc29uOiB2YXJzSnNvbgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbGF5ZXIgPSBkb2N1bWVudC5ib2R5OwogICAgICAgICAgICB2YXIgcGxheWVyID0gdmlkZW8uZ2V0UGxheWVyTm9kZShsYXllcik7CiAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICByZXR1cm4gdmlkZW8uZ2V0TGlua3NGcm9tUGxheWVyKGxheWVyLCBwbGF5ZXIsIGZ1bmN0aW9uKGxpbmtzKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBsaW5rcyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBjYWxsYmFjaygnRVJST1InKTsKICAgICAgfSwKCiAgICAgIGdldExpbmtzRnJvbVBsYXllcjogZnVuY3Rpb24obGF5ZXIsIHBsYXllck5vZGUsIGNiKSB7CiAgICAgICAgaWYgKCFwbGF5ZXJOb2RlKSByZXR1cm47CgogICAgICAgIHZhciBsaW5rcywgZmxhc2hWYXJzOwogICAgICAgIGlmIChwbGF5ZXJOb2RlLnRhZ05hbWUgPT09ICdPQkpFQ1QnKSB7CiAgICAgICAgICBmbGFzaFZhcnMgPSBwbGF5ZXJOb2RlLnF1ZXJ5U2VsZWN0b3IoJ3BhcmFtW25hbWU9ImZsYXNodmFycyJdJyk7CiAgICAgICAgICBpZiAoZmxhc2hWYXJzKSB7CiAgICAgICAgICAgIGZsYXNoVmFycyA9IGZsYXNoVmFycy5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJyk7CiAgICAgICAgICAgIGxpbmtzID0gdmlkZW8uZ2V0TGlua3NGcm9tRmxhc2hWYXJzKGZsYXNoVmFycyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHBsYXllck5vZGUudGFnTmFtZSA9PT0gJ0lGUkFNRScpIHsKICAgICAgICAgIHZhciBzcmMgPSBwbGF5ZXJOb2RlLmdldEF0dHJpYnV0ZSgnc3JjJyk7CiAgICAgICAgICBpZiAoIWxpbmtzKSB7CiAgICAgICAgICAgIGxpbmtzID0gdmlkZW8uZ2V0TGlua3NGb3JtVXJsKHNyYyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlCiAgICAgICAgaWYgKHBsYXllck5vZGUudGFnTmFtZSA9PT0gJ0VNQkVEJykgewogICAgICAgICAgdmFyIHVybCA9IHBsYXllck5vZGUuZ2V0QXR0cmlidXRlKCdzcmMnKTsKICAgICAgICAgIGlmICghbGlua3MpIHsKICAgICAgICAgICAgZmxhc2hWYXJzID0gcGxheWVyTm9kZS5nZXRBdHRyaWJ1dGUoJ2ZsYXNodmFycycpOwogICAgICAgICAgICBpZiAoZmxhc2hWYXJzKSB7CiAgICAgICAgICAgICAgbGlua3MgPSB2aWRlby5nZXRMaW5rc0Zyb21GbGFzaFZhcnMoZmxhc2hWYXJzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFsaW5rcykgewogICAgICAgICAgICBsaW5rcyA9IHZpZGVvLmdldExpbmtzRm9ybVVybCh1cmwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocGxheWVyTm9kZS50YWdOYW1lID09PSAnVklERU8nICYmIHBsYXllck5vZGUuaWQgIT09ICdodG1sNV9wbGF5ZXInKSB7CiAgICAgICAgICBsaW5rcyA9IHZpZGVvLmdldExpbmtzVmlkZW9FbChwbGF5ZXJOb2RlLCBsYXllcik7CiAgICAgICAgfQogICAgICAgIGlmIChsaW5rcykgewogICAgICAgICAgcmV0dXJuIGNiKGxpbmtzLCBsYXllcik7CiAgICAgICAgfQogICAgICAgIGlmIChwbGF5ZXJOb2RlLnRhZ05hbWUgPT09ICdESVYnICYmIHBsYXllck5vZGUuaWQgPT09ICd2aWRlb19wbGF5ZXInKSB7CiAgICAgICAgICB2YXIgcGFyZW50SWQgPSBwbGF5ZXJOb2RlLnBhcmVudE5vZGUuaWQ7CiAgICAgICAgICB2YXIgb2lkVmlkID0gcGFyZW50SWQgJiYgcGFyZW50SWQubWF0Y2goL3ZpZGVvX2JveF93cmFwKC0/XGQrKV8oLT9cZCspLyk7CiAgICAgICAgICBpZiAob2lkVmlkKSB7CiAgICAgICAgICAgIG9pZFZpZC5zaGlmdCgpOwogICAgICAgICAgICBvaWRWaWQgPSBvaWRWaWQubWFwKGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGlkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmJyaWRnZSh7CiAgICAgICAgICAgICAgYXJnczogb2lkVmlkLAogICAgICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKG9pZCwgdmlkLCBjYikgewogICAgICAgICAgICAgICAgdmFyIG12Y3VyID0gd2luZG93Lm12Y3VyOwogICAgICAgICAgICAgICAgaWYgKCFtdmN1cikgewogICAgICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgcGF0aCA9ICd2aWRlbycgKyBvaWQgKyAnXycgKyB2aWQ7CiAgICAgICAgICAgICAgICBpZiAobXZjdXIubGlzdElkKSB7CiAgICAgICAgICAgICAgICAgIHBhdGggKz0gJz9saXN0PScgKyBtdmN1ci5saXN0SWQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGNiKHsKICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjYjogZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICAgICAgICAgICAgaG9zdGluZzogJ3ZrJywKICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdnZXRWS0xpbmtzJywKICAgICAgICAgICAgICAgICAgICBleHRWaWRlb0lkOiBkYXRhLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgb2lkVmlkOiBvaWRWaWQKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgbGF5ZXIpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgdGltZW91dDogMzAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocGxheWVyTm9kZS5pZCA9PT0gJ2h0bWw1X3BsYXllcicpIHsKICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmJyaWRnZSh7CiAgICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgICAgICAgaWYgKCF3aW5kb3cuaHRtbDV2aWRlbyB8fCAhd2luZG93Lmh0bWw1dmlkZW8udmFycykgewogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNiKHdpbmRvdy5odG1sNXZpZGVvLnZhcnMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjYjogZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgIHZhciBsaW5rcyA9IHZpZGVvLmdldExpbmtzRnJvbUh0bWw1TWV0YURhdGEoZGF0YSk7CiAgICAgICAgICAgICAgaWYgKGxpbmtzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IobGlua3MsIGxheWVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRpbWVvdXQ6IDMwMAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChwbGF5ZXJOb2RlLnRhZ05hbWUgPT09ICdBJykgewogICAgICAgICAgdmFyIGhyZWYgPSBwbGF5ZXJOb2RlLmhyZWY7CiAgICAgICAgICB2YXIgcG9zOwogICAgICAgICAgaWYgKChwb3MgPSBocmVmLmluZGV4T2YoJ2F3YXkucGhwP3RvPScpKSAhPT0gLTEpIHsKICAgICAgICAgICAgaHJlZiA9IGRlY29kZVVSSUNvbXBvbmVudChocmVmLnN1YnN0cihwb3MgKyAxMikpOwogICAgICAgICAgICBsaW5rcyA9IFNhdmVGcm9tX1V0aWxzLmVtYmVkRG93bmxvYWRlci5jaGVja1VybChocmVmKTsKICAgICAgICAgICAgaWYgKGxpbmtzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKHsKICAgICAgICAgICAgICAgIHJlcXVlc3Q6IGxpbmtzCiAgICAgICAgICAgICAgfSwgbGF5ZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAoKICAgICAgcHJlcGFyZVBsYWRmb3JtTGlua3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmFjdGlvbiA9PT0gJ2dldFJ1dHViZUxpbmtzJykgewogICAgICAgICAgcmVzcG9uc2UubGlua3MgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxpbmtzID0gcmVzcG9uc2UgJiYgcmVzcG9uc2UubGlua3M7CiAgICAgICAgdmFyIHRpdGxlID0gJ25vbmFtZSc7CiAgICAgICAgdmFyIGxpbmtMaXN0ID0ge307CgogICAgICAgIGlmIChsaW5rcykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBsaW5rc1tpXTsgaSsrKSB7CiAgICAgICAgICAgIHRpdGxlID0gaXRlbS50aXRsZTsKICAgICAgICAgICAgaWYgKGxpbmtMaXN0W2l0ZW0ucXVhbGl0eV0pIHsKICAgICAgICAgICAgICBpdGVtLnF1YWxpdHkgPSArJyAnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbmtMaXN0W2l0ZW0ucXVhbGl0eS50b1VwcGVyQ2FzZSgpXSA9IGl0ZW0udXJsOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgIGxpbmtzOiBsaW5rTGlzdAogICAgICAgIH0KICAgICAgfSwKCiAgICAgIHByZXBhcmVMaW5rczogZnVuY3Rpb24obGlua3MpIHsKICAgICAgICB2YXIgdGl0bGUgPSBsaW5rcy50aXRsZTsKCiAgICAgICAgdmFyIGxpbmtMaXN0ID0gW107CiAgICAgICAgZm9yICh2YXIgcXVhbGl0eSBpbiBsaW5rcy5saW5rcykgewogICAgICAgICAgdmFyIGl0ZW0gPSBsaW5rcy5saW5rc1txdWFsaXR5XTsKCiAgICAgICAgICB2YXIgZXh0ID0gaXRlbS5tYXRjaCgvW1x3XStcLihtcDR8Zmx2KSg/Olw/fCQpL2kpOwogICAgICAgICAgaWYgKCFleHQpIHsKICAgICAgICAgICAgZXh0ID0gJ2Zsdic7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBleHQgPSBleHRbMV07CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZm9ybWF0ID0gZXh0LnRvVXBwZXJDYXNlKCk7CgogICAgICAgICAgbGlua0xpc3QucHVzaCh7CiAgICAgICAgICAgIGhyZWY6IGl0ZW0sCiAgICAgICAgICAgIHF1YWxpdHk6IHF1YWxpdHksCiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgZXh0OiBleHQsCiAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0LAogICAgICAgICAgICBmb3JjZURvd25sb2FkOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBsaW5rTGlzdDsKICAgICAgfSwKCiAgICAgIG5ld0FwcGVuZEJ1dHRvbjogZnVuY3Rpb24obGlua3MsIGNvbnRhaW5lcikgewogICAgICAgIHZhciBmdW5jQ2xhc3NOYW1lID0gJ3NmLXVuZGVyLXZpZGVvJzsKCiAgICAgICAgdmFyIGNvbnRyb2xzID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJyNtdl9pbmZvJyk7CiAgICAgICAgdmFyIGFjdGlvbkJsb2NrID0gY29udHJvbHMgJiYgY29udHJvbHMucXVlcnlTZWxlY3RvcignLm12X2FjdGlvbnNfYmxvY2sgPiBkaXYnKTsKICAgICAgICBjb250cm9scyA9IG51bGw7CgogICAgICAgIHZhciB0b3BDb250cm9scyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcjbXZfdG9wX2NvbnRyb2xzJyk7CgogICAgICAgIGlmIChhY3Rpb25CbG9jayAmJiBhdWRpby5lbElzSGlkZGVuKGFjdGlvbkJsb2NrKSkgewogICAgICAgICAgYWN0aW9uQmxvY2sgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFhY3Rpb25CbG9jayAmJiAhdG9wQ29udHJvbHMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBpc0luVG9wQ29udHJvbHMgPSAhISghYWN0aW9uQmxvY2sgJiYgdG9wQ29udHJvbHMpOwoKICAgICAgICB2YXIgb2xkQnRuTGlzdCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGRvd25sb2FkTGlua0NsYXNzTmFtZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBvbGRCdG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTsKICAgICAgICB9CiAgICAgICAgbm9kZSA9IG51bGw7CiAgICAgICAgb2xkQnRuTGlzdCA9IG51bGw7CgogICAgICAgIHZhciBkbEJ0biA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICBjbGFzczogW2Rvd25sb2FkTGlua0NsYXNzTmFtZSwgZnVuY0NsYXNzTmFtZV0sCiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgfSwKICAgICAgICAgIG9uOiBbCiAgICAgICAgICAgIFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICAgICAgbW9uby5vblJlbW92ZUV2ZW50KHRoaXMsIHZrLmhpZGVNZW51KTsKCiAgICAgICAgICAgICAgaWYgKHZrLmNvbnRleHRNZW51ICYmIHZrLmNvbnRleHRNZW51LmlzU2hvdykgewogICAgICAgICAgICAgICAgdmsuaGlkZU1lbnUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICAgIGVjOiAndmsnLAogICAgICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICAgICAgZWw6ICd2aWRlby11bmRlci12aWRlbycKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIG1lbnUgPSB2ay5jb250ZXh0TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydCh0aGlzLCBsYW5ndWFnZS5kb3dubG9hZCArICcuLi4nLCAnc2Ytc2luZ2xlLXZpZGVvLW1lbnUnLCB7CiAgICAgICAgICAgICAgICBwYXJlbnQ6IGNvbnRhaW5lciwKICAgICAgICAgICAgICAgIG9mZnNldFRvcDogaXNJblRvcENvbnRyb2xzID8gMTAgOiAxMAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAobGlua3MuaXNVbW15KSB7CiAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShsaW5rcy5saW5rcyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAobGlua3MucmVxdWVzdCkgewogICAgICAgICAgICAgICAgdmFyIG9uUmVzcG9uc2UgPSBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICB2YXIgbUxpbmtzOwogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgbGlua3MucmVxdWVzdC5hY3Rpb24gPT09ICdnZXRQbGFkZm9ybVZpZGVvJykgewogICAgICAgICAgICAgICAgICAgIGlmIChwcmVmZXJlbmNlLnNob3dVbW15SXRlbSAmJiByZXNwb25zZS5hY3Rpb24gPT09ICdnZXRSdXR1YmVMaW5rcycpIHsKICAgICAgICAgICAgICAgICAgICAgIG1MaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MucnV0dWJlKHJlc3BvbnNlLmxpbmtzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgbUxpbmtzID0gdmlkZW8ucHJlcGFyZUxpbmtzKHZpZGVvLnByZXBhcmVQbGFkZm9ybUxpbmtzKHJlc3BvbnNlKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtTGlua3MpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5saW5rcykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtZW51LnVwZGF0ZShsYW5ndWFnZS5ub0xpbmtzRm91bmQpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG1MaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3NbbGlua3MucmVxdWVzdC5ob3N0aW5nXShyZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUpOwogICAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtTGlua3MpOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UobGlua3MucmVxdWVzdCwgb25SZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICBvblJlc3BvbnNlKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAobGlua3MucmVxdWVzdC5vaWRWaWQpIHsKICAgICAgICAgICAgICAgICAgdmlkZW8uZ2V0TGlua3NGcm9tTXYobGlua3MucmVxdWVzdC5vaWRWaWRbMF0sIGxpbmtzLnJlcXVlc3Qub2lkVmlkWzFdLCBmdW5jdGlvbihsaW5rcykgewogICAgICAgICAgICAgICAgICAgIGlmIChsaW5rcykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIG1MaW5rcyA9IHZpZGVvLnByZXBhcmVMaW5rcyhsaW5rcyk7CiAgICAgICAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtTGlua3MpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBtTGlua3MgPSB2aWRlby5wcmVwYXJlTGlua3MobGlua3MpOwogICAgICAgICAgICAgIG1lbnUudXBkYXRlKG1MaW5rcyk7CiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBbJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgWydrZXlkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH1dCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIGlmIChhY3Rpb25CbG9jaykgewogICAgICAgICAgbW9uby5jcmVhdGUoZGxCdG4sIHsKICAgICAgICAgICAgY2xhc3M6IFsnZmxhdF9idXR0b24nLCAnc2Vjb25kYXJ5JywgJ2J1dHRvbl9saWdodCcsICdmbF9sJ10sCiAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdpbWcnLCB7CiAgICAgICAgICAgICAgICBzcmM6IFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyM5OUFFQzgnKSwKICAgICAgICAgICAgICAgIHdpZHRoOiAxMiwKICAgICAgICAgICAgICAgIGhlaWdodDogMTIsCiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICctMnB4JywKICAgICAgICAgICAgICAgICAgbWFyZ2luUmlnaHQ6ICc3cHgnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICAgICAgICB0ZXh0OiBsYW5ndWFnZS5kb3dubG9hZAogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIF0KICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBtb3JlID0gYWN0aW9uQmxvY2sucXVlcnlTZWxlY3RvcignLm12X21vcmUnKTsKICAgICAgICAgIGlmIChtb3JlKSB7CiAgICAgICAgICAgIG1vcmUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoZGxCdG4sIG1vcmUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWN0aW9uQmxvY2suYXBwZW5kQ2hpbGQoZGxCdG4pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChpc0luVG9wQ29udHJvbHMpIHsKICAgICAgICAgIG1vbm8uY3JlYXRlKGRsQnRuLCB7CiAgICAgICAgICAgIGNsYXNzOiBbJ212X3RvcF9idXR0b24nXSwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICB0ZXh0QWxpZ246ICdjZW50ZXInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdpbWcnLCB7CiAgICAgICAgICAgICAgICBjbGFzczogWydtdl9zbWFsbF9jbG9zZV9pY29uJ10sCiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICdub25lJywKICAgICAgICAgICAgICAgICAgd2lkdGg6ICcyMHB4JywKICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMjBweCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzcmM6IFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyNGRkZGRkYnKSwKICAgICAgICAgICAgICAgIHdpZHRoOiAyMCwKICAgICAgICAgICAgICAgIGhlaWdodDogMjAKICAgICAgICAgICAgICB9KQogICAgICAgICAgICBdCiAgICAgICAgICB9KTsKCiAgICAgICAgICB2YXIgY2hpbGRFbGVtZW50ID0gdG9wQ29udHJvbHMuZmlyc3RDaGlsZDsKICAgICAgICAgIGlmICghY2hpbGRFbGVtZW50KSB7CiAgICAgICAgICAgIHRvcENvbnRyb2xzLmFwcGVuZENoaWxkKGRsQnRuKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgaWYgKCFhdWRpby5lbElzSGlkZGVuKHRvcENvbnRyb2xzLmxhc3RDaGlsZCkpIHsKICAgICAgICAgICAgdG9wQ29udHJvbHMuYXBwZW5kQ2hpbGQoZGxCdG4pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2hpbGUgKGNoaWxkRWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmcgJiYgIWF1ZGlvLmVsSXNIaWRkZW4oY2hpbGRFbGVtZW50Lm5leHRFbGVtZW50U2libGluZykpIHsKICAgICAgICAgICAgICBjaGlsZEVsZW1lbnQgPSBjaGlsZEVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNoaWxkRWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShkbEJ0biwgY2hpbGRFbGVtZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCgogICAgICBhcHBlbmROZXdGcmFtZUJ0bjogZnVuY3Rpb24obGlua3MsIGNvbnRhaW5lcikgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgaWYgKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuJyArIGRvd25sb2FkTGlua0NsYXNzTmFtZSkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBmaXJzdENsaWNrID0gdHJ1ZTsKCiAgICAgICAgdmFyIGJ0bk9iaiA9IFNhdmVGcm9tX1V0aWxzLmZyYW1lTWVudS5nZXRCdG4oewogICAgICAgICAgc2luZ2xlQnRuOiB0cnVlLAogICAgICAgICAgYnRuSWQ6IF90aGlzLmJ0bkJveElkLAogICAgICAgICAgY29udGFpbmVyU3R5bGU6IHsKICAgICAgICAgICAgdG9wOiAnMTBweCcsCiAgICAgICAgICAgIHJpZ2h0OiAnMTBweCcKICAgICAgICAgIH0sCiAgICAgICAgICBvbjogWwogICAgICAgICAgICBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICAgICAgICBpZiAodmsuY29udGV4dE1lbnUgJiYgdmsuY29udGV4dE1lbnUuaXNTaG93KSB7CiAgICAgICAgICAgICAgICB2ay5oaWRlTWVudSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIG1lbnUgPSB2ay5jb250ZXh0TWVudSA9IFNhdmVGcm9tX1V0aWxzLmZyYW1lTWVudS5nZXRNZW51KHRoaXMsIGxhbmd1YWdlLmRvd25sb2FkICsgJy4uLicsICdzZi1mcmFtZS1tZW51JywgewogICAgICAgICAgICAgICAgY29udGFpbmVyOiBidG5PYmouY29udGFpbmVyLAogICAgICAgICAgICAgICAgb25TaG93OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgYnRuT2JqLm5vZGUuY2xhc3NMaXN0LmFkZCgnc2Ytb3ZlcicpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9uSGlkZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHZrLmNvbnRleHRNZW51ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgYnRuT2JqLm5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnc2Ytb3ZlcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAobGlua3MucmVxdWVzdCkgewogICAgICAgICAgICAgICAgdmFyIG9uUmVzcG9uc2UgPSBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICB2YXIgbUxpbmtzOwogICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5saW5rcykgewogICAgICAgICAgICAgICAgICAgIG1lbnUudXBkYXRlKGxhbmd1YWdlLm5vTGlua3NGb3VuZCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICBpZiAobGlua3MucmVxdWVzdC5hY3Rpb24gPT09ICdnZXRQbGFkZm9ybVZpZGVvJykgewogICAgICAgICAgICAgICAgICAgIGlmIChwcmVmZXJlbmNlLnNob3dVbW15SXRlbSAmJiByZXNwb25zZS5hY3Rpb24gPT09ICdnZXRSdXR1YmVMaW5rcycpIHsKICAgICAgICAgICAgICAgICAgICAgIG1MaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MucnV0dWJlKHJlc3BvbnNlLmxpbmtzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgbUxpbmtzID0gX3RoaXMucHJlcGFyZUxpbmtzKF90aGlzLnByZXBhcmVQbGFkZm9ybUxpbmtzKHJlc3BvbnNlKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtTGlua3MpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1MaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3NbbGlua3MucmVxdWVzdC5ob3N0aW5nXShyZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUpOwoKICAgICAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtTGlua3MpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UobGlua3MucmVxdWVzdCwgb25SZXNwb25zZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgIG9uUmVzcG9uc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWVudS51cGRhdGUoX3RoaXMucHJlcGFyZUxpbmtzKGxpbmtzKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZmlyc3RDbGljayAmJiBbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBhY3Rpb246ICdnZXRBY3RpdmVUYWJVcmwnCiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbih0YWJVcmwpIHsKICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0YWJVcmwgPT09ICdzdHJpbmcnICYmIHRhYlVybC5pbmRleE9mKCd2ay5jb20vJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgICAgICAgICAgZWM6ICd2aycsCiAgICAgICAgICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICAgICAgICAgIGVsOiAndmlkZW8tb24tdmlkZW8nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgICAgICAgICAgZWM6ICd2aycsCiAgICAgICAgICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICAgICAgICAgIGVsOiAndmlkZW8taWZyYW1lJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZmlyc3RDbGljayA9IGZhbHNlOwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgWydtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICBpZiAoZS5idXR0b24gPT09IDIpIHsKICAgICAgICAgICAgICAgIHZrLmhpZGVNZW51KCk7CgogICAgICAgICAgICAgICAgaWYgKGJ0bk9iai5jb250YWluZXIucGFyZW50Tm9kZSkgewogICAgICAgICAgICAgICAgICBidG5PYmouY29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYnRuT2JqLmNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XQogICAgICAgICAgXQogICAgICAgIH0pOwoKICAgICAgICBidG5PYmouY29udGFpbmVyID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgIGNsYXNzOiAnc2YtYnRuLWN0cicsCiAgICAgICAgICBhcHBlbmQ6IGJ0bk9iai5ub2RlCiAgICAgICAgfSk7CgogICAgICAgIGJ0bk9iai5ub2RlLmFwcGVuZENoaWxkKG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dChbewogICAgICAgICAgICBzZWxlY3RvcjogWwogICAgICAgICAgICAgICdib2R5OmhvdmVyIC5zZi1idG4tY3RyICMnICsgX3RoaXMuYnRuQm94SWQsCiAgICAgICAgICAgICAgJ2JvZHk6aG92ZXIgLnNmLWJ0bi1jdHIgLnNmLWZyYW1lLW1lbnUnCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJwogICAgICAgICAgICB9CiAgICAgICAgICB9XSkKICAgICAgICB9KSk7CgogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYnRuT2JqLmNvbnRhaW5lcik7CiAgICAgIH0sCgogICAgICBhZGRGcmFtZUJ0bjogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2Vfd3JhcCcpOwogICAgICAgIGlmICghY29udGFpbmVyKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2aWRlby5nZXRMaW5rc0Zyb21GcmFtZShmdW5jdGlvbihlcnIsIGxpbmtzKSB7CiAgICAgICAgICBpZiAoIWVycikgewogICAgICAgICAgICB2aWRlby5hcHBlbmROZXdGcmFtZUJ0bihsaW5rcywgY29udGFpbmVyKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfTsKCiAgICB2YXIgdmlkZW9GZWVkID0gewogICAgICBsaW5rRGF0YUF0dHI6ICdzYXZlZnJvbUhhc0J0bicsCiAgICAgIGdldExpbmtBc0FqYXhSZXF1ZXN0OiBmdW5jdGlvbihfZGV0YWlscywgaW5kZXgpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgaW5kZXggPSBpbmRleCB8fCAwOwoKICAgICAgICB2YXIgZGV0YWlscyA9IG1vbm8uZXh0ZW5kKHt9LCBfZGV0YWlscyk7CgogICAgICAgIHZhciBhYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKGluZGV4IDwgMSkgewogICAgICAgICAgICByZXR1cm4gdmlkZW9GZWVkLmdldExpbmtBc0FqYXhSZXF1ZXN0KF9kZXRhaWxzLCArK2luZGV4KTsKICAgICAgICAgIH0KCiAgICAgICAgICBfZGV0YWlscy5lcnJvciAmJiBfZGV0YWlscy5lcnJvcigpOwogICAgICAgIH07CgogICAgICAgIHZhciBkYXRhID0gZGV0YWlscy5kYXRhOwoKICAgICAgICBpZiAoaW5kZXggPT09IDApIHsKICAgICAgICAgIGRhdGEuYWN0ID0gJ3Nob3dfaW5saW5lJzsKICAgICAgICB9IGVsc2UKICAgICAgICBpZiAoaW5kZXggPT09IDEpIHsKICAgICAgICAgIGRhdGEuYWN0ID0gJ3Nob3cnOwogICAgICAgIH0KCiAgICAgICAgbW9uby5yZXF1ZXN0KGRldGFpbHMsIGZ1bmN0aW9uKGVyciwgcmVzLCBkYXRhKSB7CiAgICAgICAgICBpZiAoZXJyIHx8ICFkYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBhYm9ydCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkYXRhLmluZGV4T2YoJ2hyZWY9Ii9qb2luIicpICE9PSAtMSkgewogICAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfZGV0YWlscy5zdWNjZXNzKGRhdGEpOwogICAgICAgIH0pOwogICAgICB9LAogICAgICBnZXRMaW5rQXNBamF4OiBmdW5jdGlvbihsaW5rLCBjYiwgbW9kdWxlTmFtZSkgewogICAgICAgIHZhciBvbkNsaWNrID0gbGluay5nZXRBdHRyaWJ1dGUoJ29uY2xpY2snKSB8fCAnJzsKICAgICAgICB2YXIgdmlkZW9EYXRhID0gb25DbGljay5tYXRjaCgvc2hvd1ZpZGVvXChbJyJdezF9KFteJyJdKylbJyJdezF9LC4/WyciXXsxfShbXiciXSspWyciXXsxfSwuKlwpLyk7CiAgICAgICAgaWYgKCF2aWRlb0RhdGEpIHsKICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgIH0KICAgICAgICB2aWRlb0ZlZWQuZ2V0TGlua0FzQWpheFJlcXVlc3QoewogICAgICAgICAgbG9jYWxYSFI6IDEsCiAgICAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICAgICB1cmw6ICcvYWxfdmlkZW8ucGhwJywKICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgbGlzdDogdmlkZW9EYXRhWzJdLAogICAgICAgICAgICB2aWRlbzogdmlkZW9EYXRhWzFdLAogICAgICAgICAgICBhY3Q6ICdzaG93X2lubGluZScsCiAgICAgICAgICAgIG1vZHVsZTogbW9kdWxlTmFtZSwKICAgICAgICAgICAgYWw6IDEKICAgICAgICAgIH0sCiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihwYWdlRGF0YSkgewogICAgICAgICAgICBpZiAoIXBhZ2VEYXRhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBmcmFtZVNyYyA9IHBhZ2VEYXRhLm1hdGNoKC88aWZyYW1lW14+XStzcmM9WyciXXsxfShbXiciPl0rKVsnIl17MX1bXj5dKz4vaSk7CiAgICAgICAgICAgIGlmICghZnJhbWVTcmMpIHsKICAgICAgICAgICAgICAvLyBzZWFyY2ggZGFpbHltb3Rpb24KICAgICAgICAgICAgICBmcmFtZVNyYyA9IHBhZ2VEYXRhLm1hdGNoKC92YXJccytvcHRzXHMrPVxzKyh7W159XSp9KS9pbSk7CiAgICAgICAgICAgICAgaWYgKGZyYW1lU3JjKSB7CiAgICAgICAgICAgICAgICBmcmFtZVNyYyA9IGZyYW1lU3JjWzFdLm1hdGNoKC91cmw6XHMrWyciXXsxfShbXiciXSspWyciXXsxfS9pKTsKICAgICAgICAgICAgICAgIGlmIChmcmFtZVNyYyAmJiBmcmFtZVNyY1sxXS5pbmRleE9mKCcvLycpICE9PSAwICYmIGZyYW1lU3JjWzFdLmluZGV4T2YoJ2h0dHAnKSAhPT0gMCkgewogICAgICAgICAgICAgICAgICBmcmFtZVNyYyA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWZyYW1lU3JjKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBhY3Rpb246ICdnZXRWa0xpbmtzRnJvbURhdGEnLAogICAgICAgICAgICAgICAgICBkYXRhOiBwYWdlRGF0YQogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKHJlc3BvbnNlLCAndmsnKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGNiKHt9LCAndmsnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWZyYW1lU3JjKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB1cmwgPSBmcmFtZVNyY1sxXTsKCiAgICAgICAgICAgIGlmIChwcmVmZXJlbmNlLnNob3dVbW15SXRlbSAmJiB2aWRlby5pc1J1dHViZUxpbmsodXJsKSkgewogICAgICAgICAgICAgIHJldHVybiBjYih2aWRlby5nZXRSdXR1YmVMaW5rcyh1cmwpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCcvLycpID09PSAwKSB7CiAgICAgICAgICAgICAgdXJsID0gJ2h0dHA6JyArIHVybDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodXJsLmluZGV4T2YoJ2h0dHAnKSAhPT0gMCkgewogICAgICAgICAgICAgIHJldHVybiBjYigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZGF0YSA9IFNhdmVGcm9tX1V0aWxzLmVtYmVkRG93bmxvYWRlci5jaGVja1VybCh1cmwpOwogICAgICAgICAgICBpZiAoIWRhdGEpIHsKICAgICAgICAgICAgICByZXR1cm4gY2IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7CiAgICAgICAgICAgICAgYWN0aW9uOiBkYXRhLmFjdGlvbiwKICAgICAgICAgICAgICBleHRWaWRlb0lkOiBkYXRhLmV4dFZpZGVvSWQKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UocmVxdWVzdCwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICB2YXIgaG9zdGluZyA9IGRhdGEuaG9zdGluZzsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmFjdGlvbiAhPT0gcmVxdWVzdC5hY3Rpb24pIHsKICAgICAgICAgICAgICAgIGhvc3RpbmcgPSBTYXZlRnJvbV9VdGlscy5lbWJlZERvd25sb2FkZXIucmVNYXBIb3N0aW5nKHJlc3BvbnNlLmFjdGlvbik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gY2IocmVzcG9uc2UsIGhvc3RpbmcpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNiKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGFkZERvd25sb2FkQnRuOiBmdW5jdGlvbihsaW5rKSB7CiAgICAgICAgdmFyIHVybCA9IGxpbmsuaHJlZjsKCiAgICAgICAgdmFyIGRsQnRuID0gbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICBocmVmOiAnaHR0cDovL3NhdmVmcm9tLm5ldC8/dXJsPScgKyBlbmNvZGVVUklDb21wb25lbnQodXJsKSwKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICB3aWR0aDogJzE2cHgnLAogICAgICAgICAgICBoZWlnaHQ6ICcxNnB4JywKICAgICAgICAgICAgbWFyZ2luTGVmdDogJzVweCcsCiAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJ3VybCgnICsgU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnIzc4QTJDQycpICsgJyknLAogICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAnbm8tcmVwZWF0JywKICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnLTRweCcKICAgICAgICAgIH0sCiAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAvLyBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICAgICAgbW9uby5vblJlbW92ZUV2ZW50KGJ0bldyYXBwZXIsIHZrLmhpZGVNZW51KTsKCiAgICAgICAgICAgIGlmICh2ay5jb250ZXh0TWVudSAmJiB2ay5jb250ZXh0TWVudS5pc1Nob3cpIHsKICAgICAgICAgICAgICB2ay5oaWRlTWVudSgpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhcmVudEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3drX2JveCcpOwogICAgICAgICAgICBpZiAoIXBhcmVudEVsIHx8ICFwYXJlbnRFbC5jb250YWlucyh0aGlzKSkgewogICAgICAgICAgICAgIHBhcmVudEVsID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYXJncyA9IHsKICAgICAgICAgICAgICBwYXJlbnQ6IHBhcmVudEVsCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgdXJsID0gdGhpcy5nZXRBdHRyaWJ1dGUoU2F2ZUZyb21fVXRpbHMuZW1iZWREb3dubG9hZGVyLmRhdGFBdHRyKTsKICAgICAgICAgICAgdmFyIGVSZXF1ZXN0ID0gU2F2ZUZyb21fVXRpbHMuZW1iZWREb3dubG9hZGVyLmNoZWNrVXJsKHVybCk7CiAgICAgICAgICAgIGlmICghZVJlcXVlc3QpIHsKICAgICAgICAgICAgICB2ay5jb250ZXh0TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydChkbEJ0biwgbGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kLCAnc2YtcG9wdXBNZW51JywgYXJncyk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHsKICAgICAgICAgICAgICBhY3Rpb246IGVSZXF1ZXN0LmFjdGlvbiwKICAgICAgICAgICAgICBleHRWaWRlb0lkOiBlUmVxdWVzdC5leHRWaWRlb0lkCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgbWVudSA9IHZrLmNvbnRleHRNZW51ID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnF1aWNrSW5zZXJ0KGRsQnRuLCBsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJywgJ3NmLXBvcHVwTWVudScsIGFyZ3MpOwoKICAgICAgICAgICAgdmFyIG9uUmVzcG9uc2UgPSBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIHZhciBob3N0aW5nID0gZVJlcXVlc3QuaG9zdGluZzsKCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmFjdGlvbiAhPSByZXF1ZXN0LmFjdGlvbikgewogICAgICAgICAgICAgICAgaG9zdGluZyA9IFNhdmVGcm9tX1V0aWxzLmVtYmVkRG93bmxvYWRlci5yZU1hcEhvc3RpbmcocmVzcG9uc2UuYWN0aW9uKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmxpbmtzKSAmJiByZXNwb25zZS5saW5rcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmxpbmtzID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxpbmtzKSB7CiAgICAgICAgICAgICAgICB2YXIgbGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzW2hvc3RpbmddKHJlc3BvbnNlLmxpbmtzLCByZXNwb25zZS50aXRsZSk7CiAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShsaW5rcyk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBob3RvLmdldE1vZHVsZU5hbWUodmlkZW9GZWVkLmdldExpbmtBc0FqYXguYmluZChudWxsLCBTYXZlRnJvbV9VdGlscy5nZXRQYXJlbnRCeVRhZ05hbWUoX3RoaXMucGFyZW50Tm9kZSwgJ0EnKSwgZnVuY3Rpb24ocmVzcG9uc2UsIGhvc3RpbmcpIHsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmxpbmtzKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmtzOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5pc1VtbXkpIHsKICAgICAgICAgICAgICAgICAgICAgIGxpbmtzID0gcmVzcG9uc2UubGlua3M7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGxpbmtzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rc1tob3N0aW5nXShyZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShsaW5rcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG1lbnUudXBkYXRlKGxhbmd1YWdlLm5vTGlua3NGb3VuZCk7CiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHJlcXVlc3QsIG9uUmVzcG9uc2UpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgb25SZXNwb25zZSh7fSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICBlYzogJ3ZrJywKICAgICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgICAgZWw6ICd2aWRlby1mZWVkLWFycm93JwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9XQogICAgICAgIH0pOwoKICAgICAgICBkbEJ0bi5zZXRBdHRyaWJ1dGUoU2F2ZUZyb21fVXRpbHMuZW1iZWREb3dubG9hZGVyLmRhdGFBdHRyLCB1cmwpOwoKICAgICAgICB2YXIgYnRuV3JhcHBlciA9IG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgY2xhc3M6ICdzZi12aWRlby1mZWVkLWNvbnRhaW5lcicsCiAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIH1dLAogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIGRsQnRuCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIHZhciBwb3N0VmlkZW9UaXRsZSA9IGxpbmsucXVlcnlTZWxlY3RvcignLnBvc3RfdmlkZW9fdGl0bGUnKTsKICAgICAgICBpZiAocG9zdFZpZGVvVGl0bGUpIHsKICAgICAgICAgIHBvc3RWaWRlb1RpdGxlLmFwcGVuZENoaWxkKGJ0bldyYXBwZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsaW5rLmFwcGVuZENoaWxkKGJ0bldyYXBwZXIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgb25MaW5rSG92ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsaW5rID0gdGhpczsKCiAgICAgICAgaWYgKGxpbmsudGFnTmFtZSAhPT0gJ0EnKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgaHJlZiA9IGxpbmsuaHJlZiB8fCAnJzsKICAgICAgICB2YXIgaWQgPSBsaW5rLmlkOwogICAgICAgIGlmIChpZC5pbmRleE9mKCdwb3N0X21lZGlhX2xuaycpICE9PSAwIHx8IGhyZWYuaW5kZXhPZignL3ZpZGVvJykgPT09IC0xKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodmsuY29udGV4dE1lbnUgJiYgdmsuY29udGV4dE1lbnUuaXNTaG93KSB7CiAgICAgICAgICB2ay5oaWRlTWVudSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGxpbmsuZGF0YXNldFt2aWRlb0ZlZWQubGlua0RhdGFBdHRyXSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsaW5rLmRhdGFzZXRbdmlkZW9GZWVkLmxpbmtEYXRhQXR0cl0gPSAxOwoKICAgICAgICB2aWRlb0ZlZWQuYWRkRG93bmxvYWRCdG4obGluayk7CiAgICAgIH0sCiAgICAgIG9mZjogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGJ0bkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2YtdmlkZW8tZmVlZC1jb250YWluZXInKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGJ0bkxpc3RbaV07IGkrKykgewogICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGl0ZW0pOwogICAgICAgIH0KICAgICAgICB2YXIgZGF0YUF0dHIgPSBtb25vLmRhdGFBdHRyMlNlbGVjdG9yKHZpZGVvRmVlZC5saW5rRGF0YUF0dHIpOwogICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcqWycgKyBkYXRhQXR0ciArICddJyk7CiAgICAgICAgZm9yIChpID0gMCwgaXRlbTsgaXRlbSA9IGRhdGFBdHRyTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgICBpdGVtLnJlbW92ZUF0dHJpYnV0ZShkYXRhQXR0cik7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vICAvVklERU8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vICBQSE9UTwoKICAgIHZhciBwaG90byA9IHsKICAgICAgcGhvdG9DYWNoZToge30sCiAgICAgIGFsYnVtQ2FjaGU6IHt9LAogICAgICBvZmZzZXRTdGVwOiAxMCwKICAgICAgZ2V0QWxidW1JZDogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgaWYgKC8oXD98JnwjKWFjdD1lZGl0L2kudGVzdCh1cmwpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZGF0YUxpc3QgPSBbXTsKCiAgICAgICAgZGF0YUxpc3QucHVzaCh1cmwpOwoKICAgICAgICB2YXIgcGFyYW1zID0gbW9uby5wYXJzZVVybCh1cmwpOwogICAgICAgIGlmIChwYXJhbXMudykgewogICAgICAgICAgZGF0YUxpc3QucHVzaChwYXJhbXMudyk7CiAgICAgICAgfQogICAgICAgIGlmIChwYXJhbXMueikgewogICAgICAgICAgZGF0YUxpc3QucHVzaC5hcHBseShkYXRhTGlzdCwgcGFyYW1zLnouc3BsaXQoJy8nKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoLyMvLnRlc3QodXJsKSkgewogICAgICAgICAgZGF0YUxpc3QucHVzaCh1cmwuc3Vic3RyKHVybC5pbmRleE9mKCcjJykgKyAxKSk7CiAgICAgICAgICBkYXRhTGlzdC5wdXNoKGRlY29kZVVSSUNvbXBvbmVudCh1cmwuc3Vic3RyKHVybC5pbmRleE9mKCcjJykgKyAxKSkpOwogICAgICAgIH0KCiAgICAgICAgZGF0YUxpc3QucmV2ZXJzZSgpOwoKICAgICAgICB2YXIgYWlkID0gbnVsbDsKICAgICAgICB2YXIgbSA9IG51bGw7CiAgICAgICAgZGF0YUxpc3Quc29tZShmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICBtID0gZGF0YS5tYXRjaCgvKD86XC98I3w9fF4pKGFsYnVtcz98dGFnfHBob3Rvc3xmZWVkKD86XGQrKT9ffHdhbGwpKC0/XGQrKSg/Ol8oXGQrKSk/L2kpOwogICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgaWYgKG1bM10pIHsKICAgICAgICAgICAgICBpZiAoL14oZmVlZHx3YWxsKS8udGVzdChtWzFdKSkgewogICAgICAgICAgICAgICAgYWlkID0gbVsxXSArIG1bMl0gKyAnXycgKyBtWzNdOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhaWQgPSAnYWxidW0nICsgbVsyXSArICdfJyArIG1bM107CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAobVsxXSA9PSAnYWxidW1zJykgewogICAgICAgICAgICAgICAgbVsxXSA9ICdwaG90b3MnOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYWlkID0gbVsxXSArIG1bMl07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBhaWQ7CiAgICAgIH0sCiAgICAgIGdldExpbmtzRnJvbUpzb246IGZ1bmN0aW9uKGxpc3QsIHdpdGhUaXRsZSwgb25TdWNjZXNzKSB7CiAgICAgICAgdmFyIGxpbmtzID0ge307CiAgICAgICAgdmFyIHRpdGxlID0gd2l0aFRpdGxlID8gdW5kZWZpbmVkIDogbnVsbDsKICAgICAgICBmb3IgKHZhciBuID0gMCwgaXRlbTsgaXRlbSA9IGxpc3Rbbl07IG4rKykgewogICAgICAgICAgaWYgKCFpdGVtLmlkKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRpdGxlID09PSB1bmRlZmluZWQgJiYgaXRlbS5hbGJ1bSkgewogICAgICAgICAgICB0aXRsZSA9IG1vbm8uZmlsZU5hbWUuZGVjb2RlU3BlY2lhbENoYXJzKG1vbm8uZGVjb2RlVW5pY29kZUVzY2FwZVNlcXVlbmNlKGl0ZW0uYWxidW0ucmVwbGFjZSgvPFtePl0rPi9nLCAnJykpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBwaG90b0luZm8gPSB0aGlzLmdldE1heFBob3RvU2l6ZShpdGVtKTsKICAgICAgICAgIGlmIChwaG90b0luZm8pIHsKICAgICAgICAgICAgbGlua3NbaXRlbS5pZF0gPSB0aGlzLnBob3RvQ2FjaGVbaXRlbS5pZF0gPSBwaG90b0luZm8udXJsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvblN1Y2Nlc3MobGlua3MsIHRpdGxlKTsKICAgICAgfSwKICAgICAgZ2V0TGlua3NWaWFBUEk6IGZ1bmN0aW9uKHBvc3QsIHdpdGhUaXRsZSwgb25TdWNjZXNzLCBvbkVycm9yLCByZVNlbmQpIHsKICAgICAgICBpZiAocmVTZW5kID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJlU2VuZCA9IDA7CiAgICAgICAgfQogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIHVybCA9ICcvYWxfcGhvdG9zLnBocCc7CiAgICAgICAgdmFyIG9uWGhyRXJyb3IgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChyZVNlbmQgPiAyKSB7CiAgICAgICAgICAgIHJldHVybiBvbkVycm9yKCk7CiAgICAgICAgICB9CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBfdGhpcy5nZXRMaW5rc1ZpYUFQSShwb3N0LCB3aXRoVGl0bGUsIG9uU3VjY2Vzcywgb25FcnJvciwgKytyZVNlbmQpOwogICAgICAgICAgfSwgMjUwKTsKICAgICAgICB9OwoKICAgICAgICBtb25vLnJlcXVlc3QoewogICAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICBkYXRhOiBwb3N0LAogICAgICAgICAgbG9jYWxYSFI6IHRydWUsCiAgICAgICAgICB0aW1lb3V0OiA2MCAqIDEwMDAKICAgICAgICB9LCBmdW5jdGlvbihlcnIsIHJlc3AsIGRhdGEpIHsKICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIG9uWGhyRXJyb3IoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIG9uRXJyb3IoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgYXJyID0gcGFyc2VWa1Jlc3BvbnNlKGRhdGEpOwoKICAgICAgICAgIHZhciBjb3VudCA9IGFycls2XTsKICAgICAgICAgIHZhciBsaXN0ID0gYXJyWzhdOwoKICAgICAgICAgIHJldHVybiBfdGhpcy5nZXRMaW5rc0Zyb21Kc29uKGxpc3QsIHdpdGhUaXRsZSwgb25TdWNjZXNzLmJpbmQoX3RoaXMsIGNvdW50KSk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGdldEFsYnVtTGlua3M6IGZ1bmN0aW9uKGlkLCBvblByb2dyZXNzLCBjYikgewogICAgICAgIHZhciB3aXRoVGl0bGUgPSB0cnVlOwogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIHRpdGxlID0gdW5kZWZpbmVkOwogICAgICAgIHZhciB1cmwgPSBsb2NhdGlvbi5ocmVmOwogICAgICAgIGlmICh1cmwuaW5kZXhPZignYWxidW1zJykgIT09IC0xIHx8IHVybC5pbmRleE9mKCd0YWdzJykgIT09IC0xIHx8IHVybC5pbmRleE9mKCdwaG90b3MnKSAhPT0gLTEpIHsKICAgICAgICAgIHRpdGxlID0gbnVsbDsKICAgICAgICAgIHdpdGhUaXRsZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgcG9zdCA9ICdhY3Q9c2hvdyZhbD0xJmxpc3Q9JyArIGlkICsgJyZvZmZzZXQ9e29mZnNldH0nOwogICAgICAgIHZhciBvZmZzZXQgPSAwOwogICAgICAgIHZhciBsaW5rTGlzdCA9IHt9OwogICAgICAgIHZhciBzdW1tID0gMDsKICAgICAgICB2YXIgaW5Qcm9ncmVzcyA9IDA7CiAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICB2YXIgYWJvcnQgPSBmYWxzZTsKICAgICAgICB2YXIgbmV4dFN0ZXAgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmIChhYm9ydCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpblByb2dyZXNzKys7CiAgICAgICAgICBfdGhpcy5nZXRMaW5rc1ZpYUFQSShwb3N0LnJlcGxhY2UoJ3tvZmZzZXR9Jywgb2Zmc2V0KSwgd2l0aFRpdGxlLCBmdW5jdGlvbiBvblN1Y2Nlc3MoZnVsbENvdW50LCBsaW5rcywgYVRpdGxlKSB7CiAgICAgICAgICAgIGlmICh0aXRsZSA9PT0gdW5kZWZpbmVkICYmIGFUaXRsZSkgewogICAgICAgICAgICAgIHRpdGxlID0gYVRpdGxlOwogICAgICAgICAgICAgIHdpdGhUaXRsZSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb3VudCA8IGZ1bGxDb3VudCkgewogICAgICAgICAgICAgIGNvdW50ID0gZnVsbENvdW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBuZXdMaW5rcyA9IDA7CiAgICAgICAgICAgIGZvciAodmFyIGl0ZW0gaW4gbGlua3MpIHsKICAgICAgICAgICAgICBpZiAobGlua0xpc3RbaXRlbV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxpbmtMaXN0W2l0ZW1dID0gbGlua3NbaXRlbV07CiAgICAgICAgICAgICAgbmV3TGlua3MrKzsKICAgICAgICAgICAgICBzdW1tKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb25Qcm9ncmVzcyhzdW1tLCBjb3VudCk7CiAgICAgICAgICAgIGluUHJvZ3Jlc3MtLTsKICAgICAgICAgICAgaWYgKG5ld0xpbmtzID09PSAwKSB7CiAgICAgICAgICAgICAgaWYgKGluUHJvZ3Jlc3MgPT09IDApIHsKICAgICAgICAgICAgICAgIGlmIChjb3VudCA9PT0gZnVsbENvdW50KSB7CiAgICAgICAgICAgICAgICAgIF90aGlzLmFsYnVtQ2FjaGVbaWRdID0gewogICAgICAgICAgICAgICAgICAgIGxpbmtzOiBsaW5rTGlzdCwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghdGl0bGUpIHsKICAgICAgICAgICAgICAgICAgdGl0bGUgPSBnZXRGb2xkZXJOYW1lKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYihsaW5rTGlzdCwgdGl0bGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dFN0ZXAoKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uIG9uRXJyb3IoKSB7CiAgICAgICAgICAgIGluUHJvZ3Jlc3MtLTsKCiAgICAgICAgICAgIGlmIChpblByb2dyZXNzID09PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNiKGxpbmtMaXN0LCB0aXRsZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgb2Zmc2V0ICs9IF90aGlzLm9mZnNldFN0ZXA7CiAgICAgICAgfTsKICAgICAgICBuZXh0U3RlcCgpOwogICAgICAgIG5leHRTdGVwKCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGFib3J0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgYWJvcnQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgZ2V0TW9kdWxlTmFtZTogZnVuY3Rpb24oY2IpIHsKICAgICAgICB2YXIgZGF0YUFyZyA9ICdzZk1vZHVsZSc7CiAgICAgICAgdmFyIHNjcmlwdCA9IG1vbm8uY3JlYXRlKCdzY3JpcHQnLCB7CiAgICAgICAgICB0ZXh0OiAnKCcgKyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHdpbmRvdy5jdXIgJiYgd2luZG93LmN1ci5tb2R1bGUgJiYgdHlwZW9mKHdpbmRvdy5jdXIubW9kdWxlKSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmRhdGFzZXRbJ3tkYXRhQXJnfSddID0gd2luZG93LmN1ci5tb2R1bGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0udG9TdHJpbmcoKS5yZXBsYWNlKCd7ZGF0YUFyZ30nLCBkYXRhQXJnKSArICcpKCk7JwogICAgICAgIH0pOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0KTsKICAgICAgICAgIGNiKGRvY3VtZW50LmJvZHkuZGF0YXNldFtkYXRhQXJnXSk7CiAgICAgICAgfSwgMCk7CiAgICAgIH0sCiAgICAgIGdldEZ1bGxTaXplU3JjOiBmdW5jdGlvbihsaXN0LCBjb3VudCwgb25Qcm9ncmVzcywgY2IpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBhYm9ydCA9IGZhbHNlOwogICAgICAgIHRoaXMuZ2V0TW9kdWxlTmFtZShmdW5jdGlvbihjdXJNb2R1bGUpIHsKICAgICAgICAgIHZhciBwb3N0ID0gJ2FjdD1zaG93JmFsPTEmbGlzdD17bGlzdH0mbW9kdWxlPScgKyBjdXJNb2R1bGUgKyAnJnBob3RvPXtpZH0nOwogICAgICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgICAgIHZhciBpblByb2dyZXNzID0gMDsKICAgICAgICAgIHZhciBsaW5rTGlzdCA9IHt9OwogICAgICAgICAgdmFyIHN1bW0gPSAwOwoKICAgICAgICAgIHZhciBrZXlMaXN0ID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIga2V5TGlzdCA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbGlzdCkgewogICAgICAgICAgICAgIGtleUxpc3QucHVzaChrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBrZXlMaXN0OwogICAgICAgICAgfSkoKTsKCiAgICAgICAgICB2YXIgbmV4dFN0ZXAgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKGFib3J0KSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGhvdG9JZCA9IGtleUxpc3RbaW5kZXhdOwogICAgICAgICAgICB2YXIgbGlzdEl0ZW0gPSBsaXN0W3Bob3RvSWRdOwogICAgICAgICAgICBpZiAobGlzdEl0ZW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmIChpblByb2dyZXNzID09PSAwKSB7CiAgICAgICAgICAgICAgICBjYihsaW5rTGlzdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW5Qcm9ncmVzcysrOwoKICAgICAgICAgICAgaWYgKF90aGlzLnBob3RvQ2FjaGVbcGhvdG9JZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGxpbmtMaXN0W3Bob3RvSWRdID0gX3RoaXMucGhvdG9DYWNoZVtwaG90b0lkXTsKICAgICAgICAgICAgICBzdW1tKys7CiAgICAgICAgICAgICAgb25Qcm9ncmVzcyhzdW1tLCBjb3VudCk7CiAgICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgICBuZXh0U3RlcCgpOwogICAgICAgICAgICAgIGluUHJvZ3Jlc3MtLTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGluZGV4Kys7CgogICAgICAgICAgICB2YXIgX3Bvc3QgPSBwb3N0LnJlcGxhY2UoJ3tsaXN0fScsIGxpc3RJdGVtLmxpc3QpLnJlcGxhY2UoJ3tpZH0nLCBwaG90b0lkKTsKICAgICAgICAgICAgX3RoaXMuZ2V0TGlua3NWaWFBUEkoX3Bvc3QsIGZhbHNlLCBmdW5jdGlvbiBvblN1Y2Nlc3MoX2NvdW50LCBsaW5rcykgewogICAgICAgICAgICAgIHZhciBsaW5rID0gbGlua3NbcGhvdG9JZF07CiAgICAgICAgICAgICAgaWYgKCFsaW5rKSB7CiAgICAgICAgICAgICAgICBsaW5rID0gbGlzdEl0ZW0uc3JjOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbGlua0xpc3RbcGhvdG9JZF0gPSBsaW5rOwoKICAgICAgICAgICAgICBzdW1tKys7CiAgICAgICAgICAgICAgb25Qcm9ncmVzcyhzdW1tLCBjb3VudCk7CgogICAgICAgICAgICAgIGluUHJvZ3Jlc3MtLTsKICAgICAgICAgICAgICBuZXh0U3RlcCgpOwogICAgICAgICAgICB9LCBmdW5jdGlvbiBvbkVycm9yKCkgewogICAgICAgICAgICAgIGxpbmtMaXN0W3Bob3RvSWRdID0gbGlzdEl0ZW0uc3JjOwoKICAgICAgICAgICAgICBzdW1tKys7CiAgICAgICAgICAgICAgb25Qcm9ncmVzcyhzdW1tLCBjb3VudCk7CgogICAgICAgICAgICAgIGluUHJvZ3Jlc3MtLTsKICAgICAgICAgICAgICBuZXh0U3RlcCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CiAgICAgICAgICBuZXh0U3RlcCgpOwogICAgICAgICAgbmV4dFN0ZXAoKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBhYm9ydCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBpc1JlcGx5OiBmdW5jdGlvbihlbCkgewogICAgICAgIHJldHVybiBtb25vLm1hdGNoZXMoZWwsICcucmVwbGllcyAnICsgZWwudGFnTmFtZSkgfHwgbW9uby5tYXRjaGVzKGVsLCAnLndsX3JlcGxpZXMgJyArIGVsLnRhZ05hbWUpOwogICAgICB9LAogICAgICBnZXRXYWxsUG9zdENvbnRlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwb3N0SWQgPSBsb2NhdGlvbi5ocmVmLm1hdGNoKC93YWxsKC0/XGQrX1xkKykvKTsKICAgICAgICBwb3N0SWQgPSBwb3N0SWQgJiYgcG9zdElkWzFdOwoKICAgICAgICBpZiAoIXBvc3RJZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3N0JyArIHBvc3RJZCkgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dwdCcgKyBwb3N0SWQpOwogICAgICB9LAogICAgICBmaW5kTGlua3M6IGZ1bmN0aW9uKGNvbnRhaW5lciwgb25Qcm9ncmVzcywgY2IsIGZvcmNlKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgbGlua3MgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYVtvbmNsaWNrXScpOwogICAgICAgIHZhciBsaW5rTGlzdCA9IHt9OwogICAgICAgIHZhciBjb3VudCA9IDA7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGVsOyBlbCA9IGxpbmtzW2ldOyBpKyspIHsKICAgICAgICAgIHZhciBvbmNsaWNrID0gZWwuZ2V0QXR0cmlidXRlKCdvbmNsaWNrJyk7CiAgICAgICAgICBpZiAob25jbGljay5zZWFyY2goL3Nob3dQaG90b1xzKlwoL2kpID09PSAtMSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChwaG90by5pc1JlcGx5KGVsKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBwaG90b0lkID0gJycsCiAgICAgICAgICAgIGxpc3RJZCA9ICcnOwogICAgICAgICAgdmFyIHBhcmFtcyA9IG9uY2xpY2subWF0Y2goL3Nob3dQaG90b1xzKlwoXHMqW1wiJ10oWy1cZF9dKylbXCInXVxzKixccypbXCInXShbXHdcLV0rKVtcIiddL2kpOwogICAgICAgICAgaWYgKHBhcmFtcyAmJiBwYXJhbXMubGVuZ3RoID4gMikgewogICAgICAgICAgICBwaG90b0lkID0gcGFyYW1zWzFdOwogICAgICAgICAgICBsaXN0SWQgPSBwYXJhbXNbMl07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocGhvdG9JZCAmJiBsaXN0SWQpIHsKICAgICAgICAgICAgdmFyIGpzb24gPSBvbmNsaWNrLm1hdGNoKC9ce1tcIiddP3RlbXBbXCInXT9ccyo6XHMqKFx7Lis/XH0pL2kpOwogICAgICAgICAgICBpZiAoanNvbikgewogICAgICAgICAgICAgIGpzb24gPSBqc29uWzFdLnJlcGxhY2UoLyhce3wsKVxzKihcdyspXHMqOi9pZywgJyQxIiQyIjonKTsKICAgICAgICAgICAgICB2YXIgc3JjID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZShqc29uKTsKCiAgICAgICAgICAgICAgICB2YXIgcGhvdG9JbmZvID0gX3RoaXMuZ2V0TWF4UGhvdG9TaXplKGpzb24pOwogICAgICAgICAgICAgICAgaWYgKHBob3RvSW5mbykgewogICAgICAgICAgICAgICAgICBzcmMgPSBwaG90b0luZm8udXJsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge30KCiAgICAgICAgICAgICAgaWYgKHNyYyAmJiBsaW5rTGlzdFtwaG90b0lkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBsaW5rTGlzdFtwaG90b0lkXSA9IHsKICAgICAgICAgICAgICAgICAgc3JjOiBzcmMsCiAgICAgICAgICAgICAgICAgIGxpc3Q6IGxpc3RJZAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjb3VudCA9PT0gMCAmJiBjb250YWluZXIgIT09IGRvY3VtZW50ICYmIGZvcmNlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBwb3N0Q29udGFpbmVyID0gdGhpcy5nZXRXYWxsUG9zdENvbnRlbnQoKTsKICAgICAgICAgIGlmICghcG9zdENvbnRhaW5lcikgewogICAgICAgICAgICByZXR1cm4gY2IodW5kZWZpbmVkKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzLmZpbmRMaW5rcyhwb3N0Q29udGFpbmVyLCBvblByb2dyZXNzLCBjYiwgMSk7CiAgICAgICAgfQogICAgICAgIGlmIChjb3VudCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIGNiKHVuZGVmaW5lZCk7CiAgICAgICAgfQogICAgICAgIG9uUHJvZ3Jlc3MoMCwgY291bnQpOwogICAgICAgIHJldHVybiB0aGlzLmdldEZ1bGxTaXplU3JjKGxpbmtMaXN0LCBjb3VudCwgb25Qcm9ncmVzcywgY2IpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0aXRsZQogICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZQogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNsb3NlCiAgICAgICAqIEByZXR1cm5zIHt7b25QcmVwYXJlOiBGdW5jdGlvbiwgb25Qcm9ncmVzczogRnVuY3Rpb24sIG9uUmVhZHk6IEZ1bmN0aW9uLCBvbkVycm9yOiBGdW5jdGlvbn19CiAgICAgICAqLwogICAgICBnZXRQb3B1cDogZnVuY3Rpb24odGl0bGUsIHR5cGUsIG9uQ2xvc2UpIHsKICAgICAgICB2YXIgdGVtcGxhdGUgPSBTYXZlRnJvbV9VdGlscy5wbGF5bGlzdC5nZXRJbmZvUG9wdXBUZW1wbGF0ZSgpOwogICAgICAgIHZhciBwcm9ncmVzc0VsOwoKICAgICAgICBtb25vLmNyZWF0ZSh0ZW1wbGF0ZS50ZXh0Q29udGFpbmVyLCB7CiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3AnLCB7CiAgICAgICAgICAgICAgdGV4dDogdGl0bGUsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGNvbG9yOiAnIzBEMEQwRCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzIwcHgnLAogICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAnMTFweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6ICcxM3B4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHByb2dyZXNzRWwgPSBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICB0ZXh0OiAnJywKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgY29sb3I6ICcjODY4Njg2JywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMjRweCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIHZhciBwb3B1cEVsID0gU2F2ZUZyb21fVXRpbHMucG9wdXBEaXYodGVtcGxhdGUuYm9keSwgJ3NmX3Byb2dyZXNzX3BvcHVwJywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIG9uQ2xvc2UpOwoKICAgICAgICB2YXIgc2V0U3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkgewogICAgICAgICAgaWYgKHNldFN0YXRlLnN0YXRlID09PSBzdGF0ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBzZXRTdGF0ZS5zdGF0ZSA9IHN0YXRlOwoKICAgICAgICAgIHRlbXBsYXRlLmJ1dHRvbkNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgcHJvZ3Jlc3NFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFdhcm5pbmdJY29uJywKICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgY29sb3I6ICcjNzdEMUZBJwogICAgICAgICAgfSwgZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgICB0ZW1wbGF0ZS5pY29uLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoJyArIGljb24gKyAnKSc7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChzdGF0ZSA9PT0gJ3Byb2dyZXNzJykgewogICAgICAgICAgICBwcm9ncmVzc0VsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlID09PSAnZXJyb3InKSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ2dldFdhcm5pbmdJY29uJywKICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgIGNvbG9yOiAnI0FBQUFBQScKICAgICAgICAgICAgfSwgZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgICAgIHRlbXBsYXRlLmljb24uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgaWNvbiArICcpJzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHByb2dyZXNzRWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG9uUHJlcGFyZTogZnVuY3Rpb24odGV4dCkgewogICAgICAgICAgICBzZXRTdGF0ZSgncHJvZ3Jlc3MnKTsKICAgICAgICAgICAgcHJvZ3Jlc3NFbC50ZXh0Q29udGVudCA9IHRleHQ7CiAgICAgICAgICB9LAogICAgICAgICAgb25Qcm9ncmVzczogZnVuY3Rpb24oY291bnQsIG1heCkgewogICAgICAgICAgICBwcm9ncmVzc0VsLnRleHRDb250ZW50ID0gbGFuZ3VhZ2UudmtGb3VuZEZpbGVzLnJlcGxhY2UoJyVkJywgY291bnQpICsgJyAnICsgbGFuZ3VhZ2UudmtGb3VuZE9mICsgJyAnICsgbWF4OwogICAgICAgICAgfSwKICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBtb25vLnRyaWdnZXIocG9wdXBFbCwgJ2tpbGwnKTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICAgIHNldFN0YXRlKCdlcnJvcicpOwogICAgICAgICAgICBwcm9ncmVzc0VsLnRleHRDb250ZW50ID0gdGV4dDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdldExheWVyOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGF5ZXJfd3JhcCcpOwogICAgICAgIGlmIChsYXllciA9PT0gbnVsbCB8fCBsYXllci5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgfHwgbGF5ZXIudGV4dENvbnRlbnQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBsYXllciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmIChsYXllciA9PT0gbnVsbCkgewogICAgICAgICAgbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2tfbGF5ZXJfd3JhcCcpOwogICAgICAgICAgaWYgKGxheWVyID09PSBudWxsIHx8IGxheWVyLnN0eWxlLmRpc3BsYXkgPT09ICJub25lIiB8fCBsYXllci50ZXh0Q29udGVudC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgbGF5ZXIgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGF5ZXI7CiAgICAgIH0sCiAgICAgIGdldExpbmtzOiBmdW5jdGlvbihjb250YWluZXIsIGlkKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgcHJvY2VzcyA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgcG9wdXAgPSB0aGlzLmdldFBvcHVwKGdldEZvbGRlck5hbWUoKSwgJ3Bob3RvJywgZnVuY3Rpb24gb25DbG9zZSgpIHsKICAgICAgICAgIHByb2Nlc3MgJiYgcHJvY2Vzcy5hYm9ydCgpOwogICAgICAgIH0pOwogICAgICAgIHZhciBfY2IgPSBmdW5jdGlvbihsaW5rTGlzdCwgdGl0bGUpIHsKICAgICAgICAgIGlmICghbGlua0xpc3QpIHsKICAgICAgICAgICAgbGlua0xpc3QgPSB7fTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBsaW5rcyA9IFtdOwogICAgICAgICAgZm9yICh2YXIgaXRlbSBpbiBsaW5rTGlzdCkgewogICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBTYXZlRnJvbV9VdGlscy5nZXRNYXRjaEZpcnN0KGxpbmtMaXN0W2l0ZW1dLCAvXC8oW1x3XC1dK1wuW2EtejAtOV17Myw0fSkoPzpcP3wkKS9pKTsKICAgICAgICAgICAgaWYgKCFmaWxlbmFtZSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbmtzLnB1c2goewogICAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSwKICAgICAgICAgICAgICB1cmw6IGxpbmtMaXN0W2l0ZW1dCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGxpbmtzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBwb3B1cC5vbkVycm9yKGxhbmd1YWdlLm5vTGlua3NGb3VuZCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgemVyb0NvdW50ID0gU3RyaW5nKGxpbmtzLmxlbmd0aCkubGVuZ3RoOwogICAgICAgICAgbGlua3MuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpbmRleCkgewogICAgICAgICAgICB2YXIgbnVtYmVyID0gU3RyaW5nKGluZGV4ICsgMSk7CiAgICAgICAgICAgIHdoaWxlIChudW1iZXIubGVuZ3RoIDwgemVyb0NvdW50KSB7CiAgICAgICAgICAgICAgbnVtYmVyID0gJzAnICsgbnVtYmVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGl0ZW0uZmlsZW5hbWUgPSBudW1iZXIgKyAnLScgKyBpdGVtLmZpbGVuYW1lOwogICAgICAgICAgfSk7CgogICAgICAgICAgcG9wdXAub25SZWFkeSgpOwoKICAgICAgICAgIHRpdGxlID0gdGl0bGUgfHwgZ2V0Rm9sZGVyTmFtZSgpOwogICAgICAgICAgaWYgKCFhbGxvd0Rvd25sb2FkTW9kZSkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMuc2hvd0xpc3RPZkxpbmtzKHRpdGxlLCBsaW5rcywgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBTYXZlRnJvbV9VdGlscy5kb3dubG9hZExpc3Quc2hvd0JlZm9yZURvd25sb2FkUG9wdXAobGlua3MsIHsKICAgICAgICAgICAgY291bnQ6IGxpbmtzLmxlbmd0aCwKICAgICAgICAgICAgZm9sZGVyTmFtZTogdGl0bGUsCiAgICAgICAgICAgIHR5cGU6ICdwaG90bycsCiAgICAgICAgICAgIG9uU2hvd0xpc3Q6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIC8vIHNob3cgbGlzdCBvbiBsaW5rcwogICAgICAgICAgICAgIF90aGlzLnNob3dMaXN0T2ZMaW5rcyh0aXRsZSwgbGlua3MsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIHBvcHVwLm9uUHJlcGFyZShsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJyk7CiAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICBpZiAodGhpcy5hbGJ1bUNhY2hlW2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIF9jYih0aGlzLmFsYnVtQ2FjaGVbaWRdLmxpbmtzLCB0aGlzLmFsYnVtQ2FjaGVbaWRdLnRpdGxlIHx8IGdldEZvbGRlck5hbWUoKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHByb2Nlc3MgPSB0aGlzLmdldEFsYnVtTGlua3MoaWQsIHBvcHVwLm9uUHJvZ3Jlc3MsIF9jYik7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIWNvbnRhaW5lciB8fCBjb250YWluZXIgPT09IGRvY3VtZW50KSB7CiAgICAgICAgICBjb250YWluZXIgPSB0aGlzLmdldExheWVyKCk7CiAgICAgICAgfQoKICAgICAgICBwcm9jZXNzID0gdGhpcy5maW5kTGlua3MoY29udGFpbmVyIHx8IGRvY3VtZW50LCBwb3B1cC5vblByb2dyZXNzLCBfY2IpOwogICAgICB9LAogICAgICBybVBob3RvQWxidW1EbEJ0bjogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGRsQWxidW1CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFsnLnNmLWRsLWFibHVtLWJ0bi1kaXZpZGUnLCAnLnNmLWRsLWFibHVtLWJ0biddKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGRsQWxidW1CdG5baV07IGkrKykgewogICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYWRkTmV3UGhvdG9BbGJ1bURsQnRuOiBmdW5jdGlvbihjb250YWluZXIpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB2YXIgcGhvdG9zQWxidW1JbnRyb0luZm8gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLnBob3Rvc19hbGJ1bV9pbnRyb19pbmZvJyk7CiAgICAgICAgdmFyIHBhZ2VCbG9ja0hlYWRlckV4dHJhID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5wYWdlX2Jsb2NrX2hlYWRlcl9leHRyYScpOwoKICAgICAgICB2YXIgYm9keSA9IHBob3Rvc0FsYnVtSW50cm9JbmZvIHx8IHBhZ2VCbG9ja0hlYWRlckV4dHJhOwoKICAgICAgICBpZiAoIWJvZHkgfHwgYm9keS5xdWVyeVNlbGVjdG9yKCcuc2YtZGwtYWJsdW0tYnRuJykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBkbEJ0biA9IG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgdGV4dDogbGFuZ3VhZ2UudmtEb3dubG9hZFBob3RvQWxidW0sCiAgICAgICAgICBocmVmOiAnIycsCiAgICAgICAgICBjbGFzczogJ3NmLWRsLWFibHVtLWJ0bicsCiAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgdmFyIGlkID0gcGhvdG8uZ2V0QWxidW1JZChsb2NhdGlvbi5ocmVmKTsKICAgICAgICAgICAgX3RoaXMuZ2V0TGlua3MuY2FsbChfdGhpcywgY29udGFpbmVyLCBpZCk7CgogICAgICAgICAgICBpZiAoWzFdLmluZGV4T2YocHJlZmVyZW5jZS5jb2hvcnRJbmRleCkgIT09IC0xKSB7CiAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgICAgZWM6ICd2aycsCiAgICAgICAgICAgICAgICBlYTogJ2NsaWNrJywKICAgICAgICAgICAgICAgIGVsOiAncGhvdG8tYWxib20nCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH1dCiAgICAgICAgfSk7CgogICAgICAgIHZhciBkbEJ0bldyYXBwZXIgPSBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgIGFwcGVuZDogZGxCdG4KICAgICAgICB9KTsKCiAgICAgICAgaWYgKHBob3Rvc0FsYnVtSW50cm9JbmZvKSB7CiAgICAgICAgICBkbEJ0bldyYXBwZXIuY2xhc3NMaXN0LmFkZCgncGhvdG9zX2FsYnVtX2luZm8nKTsKICAgICAgICAgIGRsQnRuV3JhcHBlciA9IG1vbm8uY3JlYXRlKGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwgewogICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgICAgIGNsYXNzOiAnZGl2aWRlIHNmLWRsLWFibHVtLWJ0bi1kaXZpZGUnLAogICAgICAgICAgICAgICAgdGV4dDogJ3wnCiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgZGxCdG5XcmFwcGVyCiAgICAgICAgICAgIF0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZQogICAgICAgIGlmIChwYWdlQmxvY2tIZWFkZXJFeHRyYSkgewogICAgICAgICAgZGxCdG5XcmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Bob3Rvc19jb21tZW50c19saW5rJyk7CiAgICAgICAgICBkbEJ0bldyYXBwZXIuc3R5bGUubWFyZ2luID0gJzAgMTVweCc7CiAgICAgICAgfQoKICAgICAgICBib2R5LmFwcGVuZENoaWxkKGRsQnRuV3JhcHBlcik7CiAgICAgIH0sCiAgICAgIGdldENvbnRhaW5lcjogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaG90b3NfYWxidW1zX2NvbnRhaW5lcicpOwogICAgICAgIGlmICghY29udGFpbmVyKSB7CiAgICAgICAgICBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGhvdG9zX2NvbnRhaW5lcicpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjsKICAgICAgfSwKICAgICAgZ2V0RmlsZW5hbWVGcm9tVXJsOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICByZXR1cm4gU2F2ZUZyb21fVXRpbHMuZ2V0TWF0Y2hGaXJzdCh1cmwsIC9cLyhbXHdcLV0rXC5bYS16MC05XXszLDR9KSg/Olw/fCQpL2kpOwogICAgICB9LAogICAgICBybUN1cnJlbnRQaG90b0J0bjogZnVuY3Rpb24oaW5zZXJ0Q29udGFpbmVyKSB7CiAgICAgICAgdmFyIGV4QnRuID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBpbWdMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGltZ0l0ZW07IGltZ0l0ZW0gPSBpbWdMaXN0W2ldOyBpKyspIHsKICAgICAgICAgIGlmICghaW5zZXJ0Q29udGFpbmVyIHx8ICFpbnNlcnRDb250YWluZXIuY29udGFpbnMoaW1nSXRlbSkpIHsKICAgICAgICAgICAgaW1nSXRlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGltZ0l0ZW0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXhCdG4gPSBpbWdJdGVtOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXhCdG47CiAgICAgIH0sCiAgICAgIHN0eWxlOiBudWxsLAogICAgICBpbmplY3RTdHlsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMuc3R5bGUpIHsKICAgICAgICAgIGlmICghdGhpcy5zdHlsZS5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLnN0eWxlID0gbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KHsKICAgICAgICAgICAgJ2RpdiA+IC5zZi1kbC1jdXJyZW50LXBob3RvLWJ0bic6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsCiAgICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkICNGOEY4RjgnLAogICAgICAgICAgICAgIHdpZHRoOiAnMjBweCcsCiAgICAgICAgICAgICAgaGVpZ2h0OiAnMjBweCcsCiAgICAgICAgICAgICAgcGFkZGluZzogMCwKICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjNzc3Nzc3JykgKyAnKSBjZW50ZXIgbm8tcmVwZWF0ICNGOEY4RjgnLAogICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnMTJweCcsCiAgICAgICAgICAgICAgdG9wOiAnMjBweCcsCiAgICAgICAgICAgICAgbGVmdDogJzMwcHgnLAogICAgICAgICAgICAgIHpJbmRleDogMTAsCiAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2RpdiA+IC5zZi1kbC1jdXJyZW50LXBob3RvLWJ0bi5zZi1zdHlsZS1ibGFjayc6IHsKICAgICAgICAgICAgICBib3JkZXI6IDAsCiAgICAgICAgICAgICAgYmFja2dyb3VuZDogJ3VybCgnICsgU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnI0ZGRicpICsgJykgY2VudGVyIG5vLXJlcGVhdCAjMDAwJywKICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJzE0cHgnLAogICAgICAgICAgICAgIHBhZGRpbmc6ICcycHggNHB4JywKICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICcycHgnLAogICAgICAgICAgICAgIG9wYWNpdHk6IDAuNCwKICAgICAgICAgICAgICB0cmFuc2l0aW9uOiAnb3BhY2l0eSAxMDBtcyBsaW5lYXInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdkaXYgPiAuc2YtZGwtY3VycmVudC1waG90by1idG46aG92ZXInOiB7CiAgICAgICAgICAgICAgYmFja2dyb3VuZDogJ3VybCgnICsgU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnIzAwQjc1QScpICsgJykgY2VudGVyIG5vLXJlcGVhdCAjRjhGOEY4JywKICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJzEycHgnLAogICAgICAgICAgICAgIG9wYWNpdHk6IDAuOAogICAgICAgICAgICB9LAogICAgICAgICAgICAnZGl2ID4gLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuLnNmLXN0eWxlLWJsYWNrOmhvdmVyJzogewogICAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyMwMEI3NUEnKSArICcpIGNlbnRlciBuby1yZXBlYXQgIzAwMCcsCiAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxNHB4JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnZGl2ID4gLnNmLWRsLWN1cnJlbnQtcGhvdG8tYnRuOmFjdGl2ZSc6IHsKICAgICAgICAgICAgICBvdXRsaW5lOiAwLAogICAgICAgICAgICAgIGJveFNoYWRvdzogJ2luc2V0IDAgM3B4IDVweCByZ2JhKDAsIDAsIDAsIDAuMTI1KScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2Rpdjpob3ZlciA+IC5zZi1kbC1jdXJyZW50LXBob3RvLWJ0bic6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgIH0sCiAgICAgIGdldE1heFBob3RvU2l6ZTogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHZhciB0ID0gbnVsbCwKICAgICAgICAgIHIgPSBudWxsOwogICAgICAgIFsidyIsICJ6IiwgInkiLCAieCJdLnNvbWUoZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICBpZiAodCA9IGRhdGFba2V5ICsgJ18nXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChyID0gZGF0YVtrZXkgKyAnX3NyYyddKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoIXQpIHsKICAgICAgICAgIHQgPSBbcl07CiAgICAgICAgfQoKICAgICAgICB2YXIgZ2VuVXJsID0gZnVuY3Rpb24oYmFzZVVybCwgdXJsKSB7CiAgICAgICAgICBpZiAoIXVybC5tYXRjaCgvXC5bYS16XXszfSQvaSkpIHsKICAgICAgICAgICAgdXJsICs9ICIuanBnIjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodXJsLm1hdGNoKC9odHRwcz86XC9cLy9pKSkgewogICAgICAgICAgICByZXR1cm4gdXJsOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAoYmFzZVVybCB8fCAnJykucmVwbGFjZSgvXC9bYS16MC05XzpcLl0qJC9pLCAnJykgKyAnLycgKyB1cmw7CiAgICAgICAgfTsKCiAgICAgICAgaWYgKCF0WzBdKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHZhciBpbmZvID0gewogICAgICAgICAgdXJsOiBnZW5VcmwoZGF0YS5iYXNlLCB0WzBdKSwKICAgICAgICAgIHdpZHRoOiB0WzJdICYmIHRbMV0sCiAgICAgICAgICBoZWlnaHQ6IHRbMV0gJiYgdFsyXQogICAgICAgIH07CgogICAgICAgIHJldHVybiBpbmZvOwogICAgICB9LAogICAgICBnZXROZXdDdXJyZW50UGhvdG9MaW5rOiBmdW5jdGlvbihpZCwgY2IpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIGlmICghaWQpIHsKICAgICAgICAgIHJldHVybiBjYigiSUQgaXMgZW1wdHkhIik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gU2F2ZUZyb21fVXRpbHMuYnJpZGdlKHsKICAgICAgICAgIGFyZ3M6IFtpZF0sCiAgICAgICAgICBmdW5jOiBmdW5jdGlvbihpZCwgY2IpIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgY3VyICE9PSAndW5kZWZpbmVkJyAmJiBjdXIucHZDdXJQaG90bykgewogICAgICAgICAgICAgIGlmIChjdXIucHZDdXJQaG90by5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgICAgIGRhdGEgPSBjdXIucHZDdXJQaG90bzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjYihkYXRhKTsKICAgICAgICAgIH0sCiAgICAgICAgICBjYjogZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEuaWQpIHsKICAgICAgICAgICAgICByZXR1cm4gY2IoIklEIGlzIG5vdCBmb3VuZCEiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBob3RvSW5mbyA9IF90aGlzLmdldE1heFBob3RvU2l6ZShkYXRhKTsKICAgICAgICAgICAgaWYgKCFwaG90b0luZm8pIHsKICAgICAgICAgICAgICByZXR1cm4gY2IoJ1VSTCBpcyBub3QgZm91bmQhJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjYihudWxsLCBwaG90b0luZm8pOwogICAgICAgICAgfSwKICAgICAgICAgIHRpbWVvdXQ6IDMwMAogICAgICAgIH0pOwogICAgICB9LAogICAgICBhZGROZXdEbEN1cnJlbnRQaG90b0J0bjogZnVuY3Rpb24oY29udGFpbmVyKSB7CiAgICAgICAgdmFyIGluc2VydENvbnRhaW5lciA9IGNvbnRhaW5lcjsKICAgICAgICB2YXIgZXhCdG4gPSB0aGlzLnJtQ3VycmVudFBob3RvQnRuKGluc2VydENvbnRhaW5lcik7CiAgICAgICAgaWYgKGV4QnRuKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB2YXIgcHZQaG90byA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdhI3B2X3Bob3RvW2hyZWZdJyk7CiAgICAgICAgaWYgKCFwdlBob3RvKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgYnRuID0gbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICBjbGFzczogWydzZi1kbC1jdXJyZW50LXBob3RvLWJ0bicsICdzZi1zdHlsZS1ibGFjayddLAogICAgICAgICAgaHJlZjogJyMnLAogICAgICAgICAgdGl0bGU6IGxhbmd1YWdlLmRvd25sb2FkLAogICAgICAgICAgb246IFsKICAgICAgICAgICAgWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgbW9uby5vblJlbW92ZUV2ZW50KHRoaXMsIHZrLmhpZGVNZW51KTsKCiAgICAgICAgICAgICAgaWYgKHZrLmNvbnRleHRNZW51ICYmIHZrLmNvbnRleHRNZW51LmlzU2hvdykgewogICAgICAgICAgICAgICAgdmsuaGlkZU1lbnUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBtZW51ID0gdmsuY29udGV4dE1lbnUgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucXVpY2tJbnNlcnQodGhpcywgbGFuZ3VhZ2UuZG93bmxvYWQgKyAnIC4uLicsICJwaG90b0RsTWVudSIsIHsKICAgICAgICAgICAgICAgIHBhcmVudDogaW5zZXJ0Q29udGFpbmVyCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHZhciBhYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1lbnUudXBkYXRlKGxhbmd1YWdlLm5vTGlua3NGb3VuZCk7CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgdmFyIGlkID0gcHZQaG90by5ocmVmLm1hdGNoKC9waG90bygtP1xkK19cZCspLyk7CiAgICAgICAgICAgICAgaWQgPSBpZCAmJiBpZFsxXTsKCiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmdldE5ld0N1cnJlbnRQaG90b0xpbmsoaWQsIGZ1bmN0aW9uKGVyciwgaW5mbykgewogICAgICAgICAgICAgICAgaWYgKGVycikgewogICAgICAgICAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgcGhvdG9GaWxlTmFtZSA9IG1vbm8uZmlsZU5hbWUubW9kaWZ5KF90aGlzLmdldEZpbGVuYW1lRnJvbVVybChpbmZvLnVybCkpOwogICAgICAgICAgICAgICAgdmFyIGRvdFBvcyA9IHBob3RvRmlsZU5hbWUubGFzdEluZGV4T2YoJy4nKTsKICAgICAgICAgICAgICAgIHZhciBwaG90b0V4dCA9IHBob3RvRmlsZU5hbWUuc3Vic3RyKGRvdFBvcyArIDEpOwogICAgICAgICAgICAgICAgdmFyIHBob3RvVGl0bGUgPSBwaG90b0ZpbGVOYW1lLnN1YnN0cigwLCBkb3RQb3MpOwoKICAgICAgICAgICAgICAgIHZhciBtZW51SXRlbXMgPSBbXTsKCiAgICAgICAgICAgICAgICBtZW51SXRlbXMucHVzaCh7CiAgICAgICAgICAgICAgICAgIGhyZWY6IGluZm8udXJsLAogICAgICAgICAgICAgICAgICB0aXRsZTogcGhvdG9UaXRsZSwKICAgICAgICAgICAgICAgICAgcXVhbGl0eTogbGFuZ3VhZ2UuZG93bmxvYWQsCiAgICAgICAgICAgICAgICAgIGZvcm1hdDogJyAnLAogICAgICAgICAgICAgICAgICBleHQ6IHBob3RvRXh0LAogICAgICAgICAgICAgICAgICBmb3JjZURvd25sb2FkOiB0cnVlLAogICAgICAgICAgICAgICAgICBpc090aGVyOiB0cnVlLAogICAgICAgICAgICAgICAgICBpc0JsYW5rOiB0cnVlLAogICAgICAgICAgICAgICAgICBmdW5jOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBtZW51LmhpZGUoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgbWVudUl0ZW1zLnB1c2goewogICAgICAgICAgICAgICAgICBocmVmOiAnI2dldEFsYnVtJywKICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLAogICAgICAgICAgICAgICAgICBxdWFsaXR5OiBsYW5ndWFnZS52a0Rvd25sb2FkUGhvdG9BbGJ1bSwKICAgICAgICAgICAgICAgICAgZm9ybWF0OiAnICcsCiAgICAgICAgICAgICAgICAgIGV4dDogJycsCiAgICAgICAgICAgICAgICAgIG5vU2l6ZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgaXNPdGhlcjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgZnVuYzogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICAgICAgcGhvdG8uZG93bmxvYWRQaG90bygpOwogICAgICAgICAgICAgICAgICAgIG1lbnUuaGlkZSgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtZW51SXRlbXMpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgWydtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgfV0KICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgU2F2ZUZyb21fVXRpbHMubXV0YXRpb25BdHRyV2F0Y2hlci5ydW4oewogICAgICAgICAgdGFyZ2V0OiBwdlBob3RvLAogICAgICAgICAgYXR0cjogWydocmVmJ10sCiAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh2ay5jb250ZXh0TWVudSAmJiB2ay5jb250ZXh0TWVudS5pc1Nob3cpIHsKICAgICAgICAgICAgICB2ay5oaWRlTWVudSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGluc2VydENvbnRhaW5lci5hcHBlbmRDaGlsZChidG4pOwogICAgICB9LAogICAgICBkb3dubG9hZFBob3RvOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgY29udGFpbmVyID0gdGhpcy5nZXRDb250YWluZXIoKTsKICAgICAgICB2YXIgaWQgPSB0aGlzLmdldEFsYnVtSWQobG9jYXRpb24uaHJlZik7CiAgICAgICAgaWYgKCFpZCkgewogICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHZfYWxidW1fbmFtZSBhJyk7CiAgICAgICAgICBpZiAobGluayAmJiAhYXVkaW8uZWxJc0hpZGRlbihsaW5rKSkgewogICAgICAgICAgICBpZCA9IHRoaXMuZ2V0QWxidW1JZChsaW5rLmhyZWYpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmdldExpbmtzKGNvbnRhaW5lciwgaWQpOwoKICAgICAgICBpZiAoWzFdLmluZGV4T2YocHJlZmVyZW5jZS5jb2hvcnRJbmRleCkgIT09IC0xKSB7CiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAndHJhY2tDb2hvcnQnLAogICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICBlYzogJ3ZrJywKICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgIGVsOiAncGhvdG8tbWVudScKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2hvd0xpc3RPZlBob3RvczogZnVuY3Rpb24odGl0bGUsIGxpbmtzKSB7CiAgICAgICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKC9bPD5dKy9nLCAnXycpOwogICAgICAgIHZhciBodG1sID0gJzwhRE9DVFlQRSBodG1sPjxodG1sPjxoZWFkPjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij48c3R5bGUgdHlwZT0idGV4dC9jc3MiPicgKwogICAgICAgICAgJ2EsaW1ne2Rpc3BsYXk6YmxvY2s7bWFyZ2luLWJvdHRvbTo1cHg7fScgKwogICAgICAgICAgJzwvc3R5bGU+PC9oZWFkPjxib2R5PicgKyB0aXRsZSArCiAgICAgICAgICAnPHAgc3R5bGU9IndpZHRoOjY0MHB4Ij4nICsKICAgICAgICAgIGxhbmd1YWdlLnZrTGlzdE9mUGhvdG9zSW5zdHJ1Y3Rpb24gKwogICAgICAgICAgJzwvcD48YnI+PGJyPic7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gbGlua3NbaV07IGkrKykgewogICAgICAgICAgdmFyIHNyYyA9IGl0ZW0udXJsOwogICAgICAgICAgdmFyIGZpbGVOYW1lID0gaXRlbS5maWxlbmFtZTsKICAgICAgICAgIGlmIChmaWxlTmFtZSkgewogICAgICAgICAgICBodG1sICs9ICc8YSBocmVmPSInICsgc3JjICsgJyIgZG93bmxvYWQ9IicgKyBmaWxlTmFtZSArICciPicgKwogICAgICAgICAgICAgICc8aW1nIHNyYz0iJyArIHNyYyArICciIGFsdD0icGhvdG8iPjwvYT4nOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaHRtbCArPSAnPGltZyBzcmM9IicgKyBzcmMgKyAnIiBhbHQ9InBob3RvIj4nOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaHRtbCArPSAnPC9ib2R5PjwvaHRtbD4nOwoKICAgICAgICB2YXIgdXJsID0gJ2RhdGE6dGV4dC9odG1sO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LCcgKyBlbmNvZGVVUklDb21wb25lbnQoYnRvYShTYXZlRnJvbV9VdGlscy51dGY4RW5jb2RlKGh0bWwpKSk7CgogICAgICAgIHdpbmRvdy5vcGVuKHVybCwgJ19ibGFuaycpOwogICAgICB9LAogICAgICBzaG93TGlzdE9mTGlua3M6IGZ1bmN0aW9uKHRpdGxlLCBsaW5rcywgc2hvd0xpc3RPZlBob3Rvc0xpbmspIHsKICAgICAgICB2YXIgbGlzdE9mUGhvdG9MaW5rOwogICAgICAgIGlmIChzaG93TGlzdE9mUGhvdG9zTGluaykgewogICAgICAgICAgbGlzdE9mUGhvdG9MaW5rID0gbW9uby5jcmVhdGUoZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLCB7CiAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICAgICAgICAgIHRleHQ6IGxhbmd1YWdlLnZrTGlzdE9mUGhvdG9zLAogICAgICAgICAgICAgICAgICAgIGhyZWY6ICcjJywKICAgICAgICAgICAgICAgICAgICBjbGFzczogJ3NmX19oaWRkZW4nLAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiAnYm9sZGVyJywKICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogJ25vbmUnLAogICAgICAgICAgICAgICAgICAgICAgdGV4dERlY29yYXRpb246ICd1bmRlcmxpbmUnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgIHBob3RvLnNob3dMaXN0T2ZQaG90b3ModGl0bGUsIGxpbmtzKTsKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIF0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsaXN0T2ZQaG90b0xpbmsgPSAnJzsKICAgICAgICB9CgogICAgICAgIHZhciB0ZXh0YXJlYVRleHQgPSAnJzsKICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IGxpbmtzW2ldOyBpKyspIHsKICAgICAgICAgIHRleHRhcmVhVGV4dCArPSBpdGVtLnVybCArICdcclxuJzsKICAgICAgICB9CgogICAgICAgIHZhciBjb250YWluZXIgPSBtb25vLmNyZWF0ZShkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksIHsKICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICB0ZXh0OiB0aXRsZSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgY29sb3I6ICcjMEQwRDBEJywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMjBweCcsCiAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICcxMXB4JywKICAgICAgICAgICAgICAgIG1hcmdpblRvcDogJzVweCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICBhcHBlbmQ6IG1vbm8ucGFyc2VUZW1wbGF0ZShsYW5ndWFnZS52a0xpc3RPZkxpbmtzSW5zdHJ1Y3Rpb24pCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBsaXN0T2ZQaG90b0xpbmssCgogICAgICAgICAgICBtb25vLmNyZWF0ZSgndGV4dGFyZWEnLCB7CiAgICAgICAgICAgICAgdGV4dDogdGV4dGFyZWFUZXh0LAogICAgICAgICAgICAgIGNvbHM6IDYwLAogICAgICAgICAgICAgIHJvd3M6IDEwLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICB3aWR0aDogJzEwMCUnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKCFtb25vLmlzQ2hyb21lICYmICFtb25vLmlzRkYpID8gdW5kZWZpbmVkIDogbW9uby5jcmVhdGUoJ2J1dHRvbicsIHsKICAgICAgICAgICAgICB0ZXh0OiBsYW5ndWFnZS5jb3B5LAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyN3B4JywKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLAogICAgICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkICM5ZTllOWUnLAogICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAnNnB4JywKICAgICAgICAgICAgICAgIHBhZGRpbmdMZWZ0OiAnMTBweCcsCiAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6ICcxMHB4JywKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzVweCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzE0cHgnLAogICAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICAgICAgICBjc3NGbG9hdDogJ3JpZ2h0JwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb246IFsnY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgX3RoaXMuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2FkZFRvQ2xpcGJvYXJkJywKICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dGFyZWFUZXh0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICBhcHBlbmQ6IG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dCh7CiAgICAgICAgICAgICAgICAgICcjc2F2ZWZyb21fcG9wdXBfYm94IGJ1dHRvbjpob3Zlcjpub3QoOmRpc2FibGVkKSc6IHsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjNTk3QTlFICFpbXBvcnRhbnQnLAogICAgICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnIzU5N0E5RSAhaW1wb3J0YW50JywKICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyNmZmYnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICcjc2F2ZWZyb21fcG9wdXBfYm94IGJ1dHRvbjphY3RpdmUnOiB7CiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC45CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgU2F2ZUZyb21fVXRpbHMucG9wdXBEaXYoY29udGFpbmVyKTsKICAgICAgfQogICAgfTsKCiAgICAvLyAgL1BIT1RPCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gZG8uLi4KCiAgICB2YXIgbVZrID0gewogICAgICBtb2JpbGVNZW51OiBudWxsLAogICAgICBvYnNlcnZlcjogbnVsbCwKICAgICAgc3R5bGVFbDogbnVsbCwKICAgICAgcnVuOiBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgaWYgKCFTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIuaXNBdmFpbGFibGUoKSkgewogICAgICAgICAgLy8gY29uc29sZS5lcnJvcignTXV0YXRpb25PYnNlcnZlciBpcyBub3Qgc3VwcG9ydGVkIScpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKF90aGlzLm9ic2VydmVyKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMub2JzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICB9CgogICAgICAgIF90aGlzLm9ic2VydmVyID0gU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLnJ1bih7CiAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VtbWFyeUxpc3QpIHsKICAgICAgICAgICAgdmFyIHN1bW1hcnksIG4sIG5vZGU7CgogICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMF07CiAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICBfdGhpcy5pbnNlcnRBdWRpb0J0bihub2RlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzFdOwogICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgaWYgKCFub2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKCd2aWRlb192aWV3JykpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgX3RoaXMuaW5zZXJ0VmlkZW9CdG4obm9kZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFsyXTsKICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkucmVtb3ZlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgbW9uby5vblJlbW92ZUxpc3RlbmVyKG5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgcXVlcmllczogW3sKICAgICAgICAgICAgY3NzOiAnZGl2LmF1ZGlvX2l0ZW0nLAogICAgICAgICAgICBpczogJ2FkZGVkJwogICAgICAgICAgfSwgewogICAgICAgICAgICBjc3M6ICdkaXYudnZfYm9keScsCiAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGNzczogJy4nICsgbW9uby5vblJlbW92ZUNsYXNzTmFtZSwKICAgICAgICAgICAgaXM6ICdyZW1vdmVkJwogICAgICAgICAgfV0KICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMuaW5zZXJ0U3R5bGUoKTsKICAgICAgfSwKICAgICAgaGlkZU1lbnU6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChtVmsubW9iaWxlTWVudSkgewogICAgICAgICAgbVZrLm1vYmlsZU1lbnUuaGlkZSgpOwogICAgICAgICAgbVZrLm1vYmlsZU1lbnUgPSBudWxsOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaW5zZXJ0U3R5bGU6IGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBpZiAodGhpcy5zdHlsZUVsKSB7CiAgICAgICAgICBpZiAoIXRoaXMuc3R5bGVFbC5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZUVsKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuc3R5bGVFbCA9IG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgIGNsYXNzOiAnc2Ytc3R5bGUnLAogICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KHsKICAgICAgICAgICAgc2VsZWN0b3I6ICcuJyArIGRvd25sb2FkTGlua0NsYXNzTmFtZSArICcuc2YtYXVkaW8nLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsCiAgICAgICAgICAgICAgZmxvYXQ6ICdyaWdodCcsCiAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnM3B4JywKICAgICAgICAgICAgICB3aWR0aDogJzIycHgnLAogICAgICAgICAgICAgIGhlaWdodDogJzIycHgnLAogICAgICAgICAgICAgIG1hcmdpblRvcDogJzFweCcsCiAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJzNweCcsCiAgICAgICAgICAgICAgbWFyZ2luUmlnaHQ6ICczcHgnLAogICAgICAgICAgICAgIGJhY2tncm91bmQ6ICd1cmwoJyArIFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTcmMoJ2Rvd25sb2FkJywgJyNmZmZmZmYnKSArICcpIGNlbnRlciBuby1yZXBlYXQnLAogICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnMTJweCcsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzVFODBBQScKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHRoaXMuc3R5bGVFbCk7CiAgICAgIH0sCiAgICAgIG9uQXVkaW9CdG5DbGljazogZnVuY3Rpb24oZSkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICBTYXZlRnJvbV9VdGlscy5kb3dubG9hZE9uQ2xpY2soZSk7CiAgICAgIH0sCiAgICAgIGdldEF1ZGlvRGxCdG5Ob2RlOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgcmV0dXJuIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgY2xhc3M6IFtkb3dubG9hZExpbmtDbGFzc05hbWUsICdzZi1hdWRpbyddLAogICAgICAgICAgaHJlZjogdXJsLAogICAgICAgICAgdGFyZ2V0OiAnX2JsYW5rJywKICAgICAgICAgIG9uOiBbJ2NsaWNrJywgdGhpcy5vbkF1ZGlvQnRuQ2xpY2tdCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGluc2VydEF1ZGlvQnRuOiBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciB1cmwgPSBub2RlLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7CiAgICAgICAgdXJsID0gdXJsICYmIHVybC52YWx1ZTsKICAgICAgICBpZiAoIXVybCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgcG9zID0gdXJsLmluZGV4T2YoJz8nKTsKICAgICAgICBpZiAocG9zICE9PSAtMSkgewogICAgICAgICAgdXJsID0gdXJsLnN1YnN0cigwLCBwb3MpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGFpRHVyID0gbm9kZS5xdWVyeVNlbGVjdG9yKCcuYWlfZHVyJyk7CgogICAgICAgIGlmICghYWlEdXIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBwYXJlbnQgPSBhaUR1ci5wYXJlbnROb2RlOwoKICAgICAgICB2YXIgYnRuID0gdGhpcy5nZXRBdWRpb0RsQnRuTm9kZSh1cmwpOwoKICAgICAgICB2YXIgZXhCdG4gPSBwYXJlbnQucXVlcnlTZWxlY3RvcignLicgKyBkb3dubG9hZExpbmtDbGFzc05hbWUpOwogICAgICAgIGlmIChleEJ0bikgewogICAgICAgICAgZXhCdG4ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoYnRuLCBleEJ0bik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBuZXh0RWwgPSBhaUR1ci5uZXh0RWxlbWVudFNpYmxpbmc7CgogICAgICAgICAgaWYgKCFuZXh0RWwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoYnRuLCBuZXh0RWwpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgb25WaWRlb0J0bkNsaWNrOiBmdW5jdGlvbihsaW5rcywgZSkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgbVZrLmhpZGVNZW51KCk7CgogICAgICAgIHZhciBsaWdodEJveCA9IG1Way5tb2JpbGVNZW51ID0gU2F2ZUZyb21fVXRpbHMubW9iaWxlTGlnaHRCb3guc2hvdyhsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJyk7CgogICAgICAgIHZhciBtTGlua3M7CiAgICAgICAgaWYgKGxpbmtzLnJlcXVlc3QpIHsKICAgICAgICAgIHZhciBvblJlc3BvbnNlID0gZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIGxpbmtzLnJlcXVlc3QuYWN0aW9uID09PSAnZ2V0UGxhZGZvcm1WaWRlbycpIHsKICAgICAgICAgICAgICBtTGlua3MgPSB2aWRlby5wcmVwYXJlTGlua3ModmlkZW8ucHJlcGFyZVBsYWRmb3JtTGlua3MocmVzcG9uc2UpKTsKCiAgICAgICAgICAgICAgbGlnaHRCb3gudXBkYXRlKG1MaW5rcyk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcmVzcG9uc2UgfHwgIXJlc3BvbnNlLmxpbmtzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGxpZ2h0Qm94LnVwZGF0ZShsYW5ndWFnZS5ub0xpbmtzRm91bmQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1MaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3NbbGlua3MucmVxdWVzdC5ob3N0aW5nXShyZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUpOwogICAgICAgICAgICBsaWdodEJveC51cGRhdGUobUxpbmtzKTsKICAgICAgICAgIH07CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKGxpbmtzLnJlcXVlc3QsIG9uUmVzcG9uc2UpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBvblJlc3BvbnNlKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtTGlua3MgPSB2aWRlby5wcmVwYXJlTGlua3MobGlua3MpOwogICAgICAgIGxpZ2h0Qm94LnVwZGF0ZShtTGlua3MpOwogICAgICB9LAogICAgICBhcHBlbmRWaWRlb0J0bjogZnVuY3Rpb24obGlua3MsIGxheWVyKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBjb250YWluZXIgPSBsYXllci5xdWVyeVNlbGVjdG9yKCcubXZfYWN0aW9ucycpOwogICAgICAgIHZhciBidG4gPSBtb25vLmNyZWF0ZSgnbGknLCB7CiAgICAgICAgICBjbGFzczogW2Rvd25sb2FkTGlua0NsYXNzTmFtZSwgJ3NmLXZpZGVvLWN0ciddLAogICAgICAgICAgYXBwZW5kOiBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgY2xhc3M6IFtkb3dubG9hZExpbmtDbGFzc05hbWUsICdtdmFfaXRlbSddLAogICAgICAgICAgICB0ZXh0OiBsYW5ndWFnZS5kb3dubG9hZCwKICAgICAgICAgICAgb246IFsnY2xpY2snLCB0aGlzLm9uVmlkZW9CdG5DbGljay5iaW5kKHRoaXMsIGxpbmtzKV0KICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgICAgY29udGFpbmVyICYmIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidG4pOwogICAgICAgIG1vbm8ub25SZW1vdmVFdmVudChidG4sIG1Way5oaWRlTWVudSk7CiAgICAgIH0sCiAgICAgIGluc2VydFZpZGVvQnRuOiBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBmaXJzdENoaWxkID0gbm9kZS5xdWVyeVNlbGVjdG9yQWxsKCdpZnJhbWUsIHZpZGVvLCBhJylbMF07CiAgICAgICAgaWYgKCFmaXJzdENoaWxkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2aWRlby5nZXRMaW5rc0Zyb21QbGF5ZXIobW9uby5nZXRQYXJlbnRCeUNsYXNzKG5vZGUsICd2aWRlb192aWV3JyksIGZpcnN0Q2hpbGQsIHRoaXMuYXBwZW5kVmlkZW9CdG4uYmluZCh0aGlzKSk7CiAgICAgIH0KICAgIH07CiAgfSwgbnVsbCwgZnVuY3Rpb24gc3luY0lzQWN0aXZlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vKi52ay5jb20vKicsCiAgICAgICAgJyo6Ly8qLnZrb250YWt0ZS5ydS8qJwogICAgICBdOwoKICAgICAgdmFyIHJlU3RyID0gbGlzdC5tYXAoZnVuY3Rpb24ocGF0dGVybikgewogICAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgICB9KS5qb2luKCd8Jyk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAocmVTdHIpOwoKICAgICAgaWYgKCFyZS50ZXN0KGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgneW91dHViZScsIGZ1bmN0aW9uKG1vZHVsZU5hbWUsIGluaXREYXRhKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGxhbmd1YWdlID0gaW5pdERhdGEuZ2V0TGFuZ3VhZ2U7CiAgICB2YXIgcHJlZmVyZW5jZSA9IGluaXREYXRhLmdldFByZWZlcmVuY2U7CiAgICB2YXIgbW9kdWxlU3RhdGUgPSBwcmVmZXJlbmNlLm1vZHVsZVlvdXR1YmUgPyAxIDogMDsKICAgIHZhciBhbGxvd0Rvd25sb2FkTW9kZSA9IG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0Nocm9tZSB8fCBtb25vLmlzRkYgfHwgKG1vbm8uaXNHTSAmJiBtb25vLmlzVE0pOwogICAgdmFyIGlmcmFtZSA9IG1vbm8uaXNJZnJhbWUoKTsKCiAgICBtb25vLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihmdW5jdGlvbihtZXNzYWdlLCBjYikgewogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICdnZXRNb2R1bGVJbmZvJykgewogICAgICAgIGlmIChtZXNzYWdlLnVybCAhPT0gbG9jYXRpb24uaHJlZikgcmV0dXJuOwogICAgICAgIHJldHVybiBjYih7CiAgICAgICAgICBzdGF0ZTogbW9kdWxlU3RhdGUsCiAgICAgICAgICBtb2R1bGVOYW1lOiBtb2R1bGVOYW1lCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnY2hhbmdlU3RhdGUnKSB7CiAgICAgICAgaWYgKG1vZHVsZU5hbWUgIT09IG1lc3NhZ2UubW9kdWxlTmFtZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZXR1cm4geW91dHViZS5jaGFuZ2VTdGF0ZShtZXNzYWdlLnN0YXRlKTsKICAgICAgfQogICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ3VwZGF0ZUxpbmtzJykgewogICAgICAgIHZhciB2SWQgPSB5b3V0dWJlLmdldElkRnJvbUxvY2F0aW9uKCk7CiAgICAgICAgaWYgKHZJZCkgewogICAgICAgICAgZ2V0UGxheWVyQ29uZmlnKGZ1bmN0aW9uKGNvbmZpZykgewogICAgICAgICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5hcmdzICYmIGNvbmZpZy5hcmdzLnZpZGVvX2lkID09PSB2SWQpIHsKICAgICAgICAgICAgICB2YXIgb2xkQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoeW91dHViZS5idXR0b25JZCk7CiAgICAgICAgICAgICAgaWYgKG9sZEJ0biAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgb2xkQnRuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2xkQnRuKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHl0VW1teUJ0bi5ybUJ0bigpOwogICAgICAgICAgICAgIHF1aWNrQ29udmVydC5ybUJ0bigpOwoKICAgICAgICAgICAgICB5b3V0dWJlLnJlc3BvbnNlQ2FjaGUgPSB7fTsKICAgICAgICAgICAgICB5b3V0dWJlLnZpZGVvX2lkID0gY29uZmlnLmFyZ3MudmlkZW9faWQ7CiAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YXRjaDctc3Vic2NyaXB0aW9uLWNvbnRhaW5lcicpOwogICAgICAgICAgICAgIHlvdXR1YmUuYXBwZW5kRG93bmxvYWRCdXR0b24oY29udGFpbmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2Rvd25sb2FkUGxheWxpc3QnKSB7CiAgICAgICAgeW91dHViZS5kb3dubG9hZFBsYXlsaXN0KCk7CiAgICAgIH0KICAgIH0pOwoKICAgIGlmIChtb2R1bGVTdGF0ZSkgewogICAgICBtb25vLmFzeW5jQ2FsbChmdW5jdGlvbigpIHsKICAgICAgICB5b3V0dWJlLnJ1bigpOwogICAgICB9KTsKICAgIH0KCiAgICB2YXIgeW91dHViZSA9IHsKICAgICAgc3dmYXJnczogbnVsbCwKICAgICAgdmlkZW9faWQ6ICcnLAoKICAgICAgYnV0dG9uSWQ6ICdzYXZlZnJvbV9feXRfYnRuJywKCiAgICAgIHJlc3BvbnNlQ2FjaGU6IHt9LAogICAgICBpc01vYmlsZTogZmFsc2UsCgogICAgICBtb2JpbGVNZW51OiBudWxsLAogICAgICBjdXJyZW50TWVudTogbnVsbCwKICAgICAgY3VycmVudFR1dG9yaWFsOiBudWxsLAoKICAgICAgcnVuOiBmdW5jdGlvbigpIHsKICAgICAgICBtb2R1bGVTdGF0ZSA9IDE7CiAgICAgICAgaWYgKGlmcmFtZSkgewogICAgICAgICAgdmFyIGVtYmVkVmlkZW9JZCA9IGxvY2F0aW9uLmhyZWYubWF0Y2goL1wvZW1iZWRcLyhbXHdcLV0rKS9pKTsKICAgICAgICAgIGVtYmVkVmlkZW9JZCA9IGVtYmVkVmlkZW9JZCAmJiBlbWJlZFZpZGVvSWRbMV07CgogICAgICAgICAgaWYgKCFlbWJlZFZpZGVvSWQpIHsKICAgICAgICAgICAgaWZyYW1lID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobG9jYXRpb24uaG9zdC5pbmRleE9mKCdtLicpID09PSAwKSB7CiAgICAgICAgICB5b3V0dWJlLmlzTW9iaWxlID0gdHJ1ZTsKCiAgICAgICAgICBpZiAoU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLmlzQXZhaWxhYmxlKCkpIHsKICAgICAgICAgICAgeW91dHViZS5tb2JpbGVNdXRhdGlvbk1vZGUuZW5hYmxlKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoaWZyYW1lKSB7CiAgICAgICAgICB5b3V0dWJlLnZpZGVvX2lkID0gZW1iZWRWaWRlb0lkOwoKICAgICAgICAgIHlvdXR1YmUuYXBwZW5kRnJhbWVCdXR0b24oKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIuaXNBdmFpbGFibGUoKSkgewogICAgICAgICAgeW91dHViZS52aWRlb0ZlZWQuaW5qZWN0U3R5bGUoKTsKICAgICAgICAgIHlvdXR1YmUubXV0YXRpb25Nb2RlLmVuYWJsZSgpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGNoYW5nZVN0YXRlOiBmdW5jdGlvbihzdGF0ZSkgewogICAgICAgIG1vZHVsZVN0YXRlID0gc3RhdGU7CiAgICAgICAgaWYgKGlmcmFtZSB8fCB5b3V0dWJlLmlzTW9iaWxlKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB5b3V0dWJlLnR1dG9yaWFsLmhpZGUoKTsKCiAgICAgICAgeW91dHViZS5oaWRlQ3VycmVudE1lbnUoKTsKCiAgICAgICAgeW91dHViZS52aWRlb0ZlZWQucm1CdG4oKTsKCiAgICAgICAgeW91dHViZS5tdXRhdGlvbk1vZGUuc3RvcCgpOwoKICAgICAgICB2YXIgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoeW91dHViZS5idXR0b25JZCk7CiAgICAgICAgaWYgKGJ0bikgewogICAgICAgICAgYnRuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYnRuKTsKICAgICAgICB9CgogICAgICAgIHl0VW1teUJ0bi5ybUJ0bigpOwogICAgICAgIHF1aWNrQ29udmVydC5ybUJ0bigpOwoKICAgICAgICBpZiAoc3RhdGUpIHsKICAgICAgICAgIHlvdXR1YmUucnVuKCk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgaGlkZUN1cnJlbnRNZW51OiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoeW91dHViZS5jdXJyZW50TWVudSkgewogICAgICAgICAgeW91dHViZS5jdXJyZW50TWVudS5oaWRlKCk7CiAgICAgICAgICB5b3V0dWJlLmN1cnJlbnRNZW51ID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBoaWRlTW9iaWxlTWVudTogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHlvdXR1YmUubW9iaWxlTWVudSkgewogICAgICAgICAgeW91dHViZS5tb2JpbGVNZW51LmhpZGUoKTsKICAgICAgICAgIHlvdXR1YmUubW9iaWxlTWVudSA9IG51bGw7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgbXV0YXRpb25Nb2RlOiB7CiAgICAgICAgb2JzZXJ2ZXI6IG51bGwsCiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoeW91dHViZS5tdXRhdGlvbk1vZGUub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgeW91dHViZS5tdXRhdGlvbk1vZGUub2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgfQoKICAgICAgICAgIFsnc2ZTa2lwJ10uZm9yRWFjaChmdW5jdGlvbihhdHRyKSB7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoYXR0cik7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbJyArIGRhdGFBdHRyICsgJ10nKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlQXR0cmlidXRlKGRhdGFBdHRyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICB3cmFwVmlkZW9GZWVkT25JbWdIb3ZlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGhpcy5kYXRhc2V0LnNmQnRuID4gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmRhdGFzZXQuc2ZCdG4gPSAnMSc7CgogICAgICAgICAgdmFyIGNvbnRleHQgPSBKU09OLnBhcnNlKHRoaXMuZGF0YXNldC5zZkNvbnRleHQpOwogICAgICAgICAgdGhpcy5hcHBlbmRDaGlsZCh5b3V0dWJlLnZpZGVvRmVlZC5nZXRCdG5Ob2RlKGNvbnRleHQuaWQsIGNvbnRleHQuc3R5bGVJbmRleCkpOwogICAgICAgIH0sCiAgICAgICAgd3JhcE5ld1ZpZGVvRmVlZE9uVGh1bWJuYWlsSG92ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF90aGlzID0geW91dHViZS5tdXRhdGlvbk1vZGU7CiAgICAgICAgICB2YXIgbm9kZSA9IHRoaXM7CiAgICAgICAgICB2YXIgdXJsID0gbm9kZS5ocmVmOwogICAgICAgICAgdmFyIG0gPSB1cmwgJiYgdXJsLm1hdGNoKHlvdXR1YmUudmlkZW9GZWVkLmhyZWZJZFBhdHRlcm4pOwogICAgICAgICAgdmFyIGlkID0gbSAmJiBtWzFdOwogICAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICAgIGlmICghbm9kZS5xdWVyeVNlbGVjdG9yKCcuc2YtZmVlZC1idG4nKSkgewogICAgICAgICAgICAgIHZhciBidG5Ob2RlID0geW91dHViZS52aWRlb0ZlZWQuZ2V0QnRuTm9kZShpZCwgMik7CiAgICAgICAgICAgICAgbW9uby5vblJlbW92ZUV2ZW50KGJ0bk5vZGUsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgbW9uby5vbmUobm9kZSwgJ21vdXNlb3ZlcicsIF90aGlzLndyYXBOZXdWaWRlb0ZlZWRPblRodW1ibmFpbEhvdmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBub2RlLmFwcGVuZENoaWxkKGJ0bk5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB1cmwgPSBudWxsOwogICAgICAgICAgbSA9IG51bGw7CiAgICAgICAgICBpZCA9IG51bGw7CiAgICAgICAgICBidG5Ob2RlID0gbnVsbDsKICAgICAgICB9LAogICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgIGlmIChfdGhpcy5vYnNlcnZlcikgewogICAgICAgICAgICByZXR1cm4gX3RoaXMub2JzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpcy5vYnNlcnZlciA9IFNhdmVGcm9tX1V0aWxzLm11dGF0aW9uV2F0Y2hlci5ydW4oewogICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VtbWFyeUxpc3QpIHsKICAgICAgICAgICAgICB2YXIgc3VtbWFyeSwgbm9kZSwgbiwgaSwgaWQsIGVsLCBjb250ZXh0OwoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMF07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICB5b3V0dWJlLmFwcGVuZERvd25sb2FkQnV0dG9uKG5vZGUpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHlvdXR1YmUudmlkZW9GZWVkLnRlc3RVcmwobG9jYXRpb24uaHJlZikpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCAzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0W2ldOwogICAgICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICAgICAgaWQgPSBub2RlLmRhdGFzZXQudmlkZW9JZHM7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICAgICAgICAgICAgICBlbCA9IG5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuaWQgPSBpZDsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc3R5bGVJbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgICBlbC5kYXRhc2V0LnNmQ29udGV4dCA9IEpTT04uc3RyaW5naWZ5KGNvbnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgbW9uby5vbmUoZWwsICdtb3VzZW92ZXInLCBfdGhpcy53cmFwVmlkZW9GZWVkT25JbWdIb3Zlcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZm9yIChpID0gMzsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbaV07CiAgICAgICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgICAgICBtb25vLm9uZShub2RlLnBhcmVudE5vZGUsICdtb3VzZW92ZXInLCBfdGhpcy53cmFwTmV3VmlkZW9GZWVkT25UaHVtYm5haWxIb3Zlcik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFs0XTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgIHlvdXR1YmUuYXBwZW5kTmV3RG93bmxvYWRCdXR0b24obm9kZSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbNV07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkucmVtb3ZlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBtb25vLm9uUmVtb3ZlTGlzdGVuZXIobm9kZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBxdWVyaWVzOiBbewogICAgICAgICAgICAgIGNzczogJyN3YXRjaDctc3Vic2NyaXB0aW9uLWNvbnRhaW5lcicsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ2J1dHRvbi5hZGR0by13YXRjaC1sYXRlci1idXR0b24tc2lnbi1pbicsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ2J1dHRvbi5hZGR0by13YXRjaC1sYXRlci1idXR0b24nLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICd5dGQtdGh1bWJuYWlsIGEjdGh1bWJuYWlsIGltZycsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJ3l0ZC13YXRjaCAjaW5mbyAjdG9wLWxldmVsLWJ1dHRvbnMnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuJyArIG1vbm8ub25SZW1vdmVDbGFzc05hbWUsCiAgICAgICAgICAgICAgaXM6ICdyZW1vdmVkJwogICAgICAgICAgICB9XQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgbW9iaWxlTXV0YXRpb25Nb2RlOiB7CiAgICAgICAgb2JzZXJ2ZXI6IG51bGwsCiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoeW91dHViZS5tdXRhdGlvbk1vZGUub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgeW91dHViZS5tdXRhdGlvbk1vZGUub2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgfQoKICAgICAgICAgIFsnc2ZTa2lwJ10uZm9yRWFjaChmdW5jdGlvbihhdHRyKSB7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ciA9IG1vbm8uZGF0YUF0dHIyU2VsZWN0b3IoYXR0cik7CiAgICAgICAgICAgIHZhciBkYXRhQXR0ckxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbJyArIGRhdGFBdHRyICsgJ10nKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBkYXRhQXR0ckxpc3RbaV07IGkrKykgewogICAgICAgICAgICAgIGl0ZW0ucmVtb3ZlQXR0cmlidXRlKGRhdGFBdHRyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgICBpZiAoX3RoaXMub2JzZXJ2ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzLm9ic2VydmVyLnN0YXJ0KCk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMub2JzZXJ2ZXIgPSBTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIucnVuKHsKICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKHN1bW1hcnlMaXN0KSB7CiAgICAgICAgICAgICAgdmFyIHN1bW1hcnksIG5vZGUsIG4sIGk7CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFswXTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5pZC5pbmRleE9mKCdrb3lhX2VsZW1fJykgIT09IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGlpID0gMDsKICAgICAgICAgICAgICAgIHdoaWxlIChpaSA8IDQgJiYgbm9kZSkgewogICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICBpaSsrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghbm9kZSB8fCBpaSAhPT0gNCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCgogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICB5b3V0dWJlLmFwcGVuZE1vYmlsZUJ1dHRvbignJywgbm9kZSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMV07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkucmVtb3ZlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBtb25vLm9uUmVtb3ZlTGlzdGVuZXIobm9kZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBxdWVyaWVzOiBbewogICAgICAgICAgICAgIGNzczogJ2RpdiA+IGRpdiA+IGRpdiA+IGFbb25jbGlja11baHJlZj0iIyJdID4gc3BhbltpZF0nLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuJyArIG1vbm8ub25SZW1vdmVDbGFzc05hbWUsCiAgICAgICAgICAgICAgaXM6ICdyZW1vdmVkJwogICAgICAgICAgICB9XQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgX29uU2VsZWN0QnRuQ2xpY2s6IGZ1bmN0aW9uKHdyYXBCdG5PYmosIGUpIHsKICAgICAgICBpZiAoZS5idXR0b24gPiAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgaWYgKHlvdXR1YmUuY3VycmVudE1lbnUgJiYgeW91dHViZS5jdXJyZW50TWVudS5pc1Nob3cpIHsKICAgICAgICAgIHlvdXR1YmUuaGlkZUN1cnJlbnRNZW51KCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgYnRuT2JqID0gd3JhcEJ0bk9iai5idG5PYmo7CgogICAgICAgIHZhciB2aWRlb0lkID0gYnRuT2JqLnZpZGVvSWQ7CgogICAgICAgIHZhciBtZW51ID0geW91dHViZS5jdXJyZW50TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydChidG5PYmoubm9kZSwgbGFuZ3VhZ2UuZG93bmxvYWQgKyAnIC4uLicsICdzZi1wb3B1cE1lbnUnLCB7CiAgICAgICAgICBvblNob3c6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBtb25vLm9uUmVtb3ZlRXZlbnQoYnRuT2JqLm5vZGUsIHlvdXR1YmUuaGlkZUN1cnJlbnRNZW51KTsKICAgICAgICAgIH0sCiAgICAgICAgICBvbkhpZGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBtb25vLm9mZlJlbW92ZUV2ZW50KGJ0bk9iai5ub2RlLCB5b3V0dWJlLmhpZGVDdXJyZW50TWVudSk7CiAgICAgICAgICB9LAogICAgICAgICAgb25JdGVtQ2xpY2s6IGZ1bmN0aW9uKGUsIG1lbnVJdGVtKSB7CiAgICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgdmFyIGl0YWcgPSBtZW51SXRlbS5pdGFnOwogICAgICAgICAgICBpZiAoaXRhZyA9PT0gJ3VtbXlBdWRpbycpIHsKICAgICAgICAgICAgICBpdGFnID0gJ3VtbXknOwogICAgICAgICAgICB9CgogICAgICAgICAgICBidG5PYmoubGFzdEl0YWcgIT09IGl0YWcgJiYgbW9uby5zdG9yYWdlLnNldCh7CiAgICAgICAgICAgICAgeXRMYXN0SVRhZzogaXRhZwogICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB5b3V0dWJlLnF1aWNrQnRuLnNldFZhbHVlKGJ0bk9iaik7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgeW91dHViZS5vbk1lbnVJdGVtQ2xpY2sobWVudUl0ZW0sIHsKICAgICAgICAgICAgICBpc1BhZ2VJdGVtOiAxLAogICAgICAgICAgICAgIHZpZGVvSWQ6IHZpZGVvSWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgb2Zmc2V0VG9wOiBidG5PYmoucG9wdXBNZW51ICYmIGJ0bk9iai5wb3B1cE1lbnUub2Zmc2V0VG9wLAogICAgICAgICAgb2Zmc2V0UmlnaHQ6IGJ0bk9iai5wb3B1cE1lbnUgJiYgYnRuT2JqLnBvcHVwTWVudS5vZmZzZXRSaWdodCwKICAgICAgICAgIHBhcmVudDogYnRuT2JqLnBvcHVwTWVudSAmJiBidG5PYmoucG9wdXBNZW51LnBhcmVudAogICAgICAgIH0pOwoKICAgICAgICB2YXIgYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIG1lbnUudXBkYXRlKGxhbmd1YWdlLm5vTGlua3NGb3VuZCk7CiAgICAgICAgfTsKCiAgICAgICAgaWYgKCF2aWRlb0lkKSB7CiAgICAgICAgICByZXR1cm4gYWJvcnQoKTsKICAgICAgICB9CgogICAgICAgIHZhciBvblJlc3BvbnNlID0gZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5saW5rcykgewogICAgICAgICAgICB2YXIgbWVudUxpbmtzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rcy55b3V0dWJlKHJlc3BvbnNlLmxpbmtzLCByZXNwb25zZS50aXRsZSwgcmVzcG9uc2Uuc3VidGl0bGVzKTsKICAgICAgICAgICAgbWVudS51cGRhdGUobWVudUxpbmtzKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGFib3J0KCk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIHJlc3BvbnNlID0geW91dHViZS5yZXNwb25zZUNhY2hlW3ZpZGVvSWRdOwogICAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgICAgcmV0dXJuIG9uUmVzcG9uc2UocmVzcG9uc2UpOwogICAgICAgIH0KCiAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICBhY3Rpb246ICdnZXRZb3V0dWJlTGlua3MnLAogICAgICAgICAgZXh0VmlkZW9JZDogdmlkZW9JZCwKICAgICAgICAgIHVybDogbG9jYXRpb24uaHJlZiwKICAgICAgICAgIGNoZWNrU3VidGl0bGVzOiB0cnVlCiAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgIGlmIChyZXNwb25zZS5saW5rcykgewogICAgICAgICAgICB5b3V0dWJlLnJlc3BvbnNlQ2FjaGVbdmlkZW9JZF0gPSByZXNwb25zZTsKICAgICAgICAgIH0KCiAgICAgICAgICBvblJlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGJ0bk9iai5pc0ZpcnN0TWVudVNob3cpIHsKICAgICAgICAgIGJ0bk9iai5pc0ZpcnN0TWVudVNob3cgPSBmYWxzZTsKCiAgICAgICAgICBpZiAoWzFdLmluZGV4T2YocHJlZmVyZW5jZS5jb2hvcnRJbmRleCkgIT09IC0xKSB7CiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgIGVjOiAneW91dHViZScsCiAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgZWw6ICd2aWRlby1zaW5nbGUnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgYXBwZW5kRG93bmxvYWRCdXR0b246IGZ1bmN0aW9uKHBhcmVudCkgewogICAgICAgIHZhciBjdXJyZW50QnRuID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJyMnICsgeW91dHViZS5idXR0b25JZCk7CiAgICAgICAgaWYgKGN1cnJlbnRCdG4pIHsKICAgICAgICAgIGN1cnJlbnRCdG4ucGFyZW50Tm9kZSAmJiBjdXJyZW50QnRuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY3VycmVudEJ0bik7CiAgICAgICAgICBjdXJyZW50QnRuID0gbnVsbDsKICAgICAgICB9CgoKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB2YXIgd3JhcEJ0bk9iaiA9IHt9OwogICAgICAgIHZhciBidG5PYmogPSBfdGhpcy5nZXRCdXR0b25VbmRlclZpZGVvKHlvdXR1YmUuX29uU2VsZWN0QnRuQ2xpY2suYmluZChudWxsLCB3cmFwQnRuT2JqKSk7CiAgICAgICAgd3JhcEJ0bk9iai5idG5PYmogPSBidG5PYmo7CiAgICAgICAgYnRuT2JqLmlzRmlyc3RNZW51U2hvdyA9IHRydWU7CgogICAgICAgIGJ0bk9iai5zZXRMb2FkaW5nU3RhdGUoKTsKCiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKGJ0bk9iai5ub2RlKTsKCiAgICAgICAgZ2V0UGxheWVyQ29uZmlnKGZ1bmN0aW9uKGNvbmZpZykgewogICAgICAgICAgdmFyIHZpZGVvSWQgPSBudWxsOwoKICAgICAgICAgIGlmIChjb25maWcgJiYgY29uZmlnLmFyZ3MgJiYgY29uZmlnLmFyZ3MudmlkZW9faWQpIHsKICAgICAgICAgICAgdmlkZW9JZCA9IGNvbmZpZy5hcmdzLnZpZGVvX2lkOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghdmlkZW9JZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgYnRuT2JqLm5vZGUuZGF0YXNldC5zZlZpZGVvSWQgPSB2aWRlb0lkOwoKICAgICAgICAgIGJ0bk9iai55dENvbmZpZyA9IGNvbmZpZzsKICAgICAgICAgIGJ0bk9iai52aWRlb0lkID0gdmlkZW9JZDsKICAgICAgICAgIGJ0bk9iai5pc1BhZ2UgPSAxOwoKICAgICAgICAgIHZhciBvbkdldExpbmtzQXJyID0gW107CgogICAgICAgICAgdmFyIGluc2VydFR1dG9yaWFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGluc2VydFR1dG9yaWFsID0gbnVsbDsKICAgICAgICAgICAgeW91dHViZS50dXRvcmlhbC5zaG93KHsKICAgICAgICAgICAgICB0YXJnZXQ6IGJ0bk9iai5ub2RlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICBvbkdldExpbmtzQXJyLnB1c2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBpbnNlcnRUdXRvcmlhbCAmJiBpbnNlcnRUdXRvcmlhbCgpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHByZWZlcmVuY2UuZW5hYmxlQ29udmVydGVyKSB7CiAgICAgICAgICAgIGluc2VydFR1dG9yaWFsID0gbnVsbDsKCiAgICAgICAgICAgIG9uR2V0TGlua3NBcnIucHVzaChmdW5jdGlvbihtZW51TGlua3MpIHsKICAgICAgICAgICAgICBpZiAobWVudUxpbmtzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGNvbnZCdG4gPSBxdWlja0NvbnZlcnQuY3JlYXRlKG1lbnVMaW5rcyk7CgogICAgICAgICAgICAgIGlmIChjb252QnRuKSB7CiAgICAgICAgICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoY29udkJ0bik7CgogICAgICAgICAgICAgICAgbW9uby5zdG9yYWdlLmdldChbJ29uY2VZdFR1dG9yaWFsVG9vbHRpcCcsICdvbmNlU2hvd0NvbnZSYXRlJ10sIGZ1bmN0aW9uKHN0b3JhZ2UpIHsKICAgICAgICAgICAgICAgICAgaWYgKCFzdG9yYWdlLm9uY2VZdFR1dG9yaWFsVG9vbHRpcCkgewogICAgICAgICAgICAgICAgICAgIHlvdXR1YmUudHV0b3JpYWwuc2hvdyh7CiAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGNvbnZCdG4KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgIGlmIChzdG9yYWdlLm9uY2VTaG93Q29udlJhdGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBxdWlja0NvbnZlcnQucmF0ZVRvb2x0aXAuYmluZCh7CiAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGNvbnZCdG4KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB1bW15QnRuID0geXRVbW15QnRuKGxhbmd1YWdlLCBwcmVmZXJlbmNlLCB2aWRlb0lkKTsKCiAgICAgICAgICAgIGlmICh1bW15QnRuKSB7CiAgICAgICAgICAgICAgb25HZXRMaW5rc0Fyci5wdXNoKGZ1bmN0aW9uKG1lbnVMaW5rcykgewogICAgICAgICAgICAgICAgdmFyIGxpbmtzID0gbWVudUxpbmtzLnNsaWNlKDApOwogICAgICAgICAgICAgICAgbGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUuc29ydE1lbnVJdGVtcyhsaW5rcywgewogICAgICAgICAgICAgICAgICB0eXBlTGlzdDogWyd2aWRlbycsICczZCcsICdtdXRlJywgJ211dGU2MCddLAogICAgICAgICAgICAgICAgICBncm91cENvbXBhcmU6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKGxpbmtzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGJlc3QgPSBsaW5rc1swXTsKICAgICAgICAgICAgICAgIHZhciBxdWFsaXR5ID0gYmVzdC5wcm9wICYmIGJlc3QucHJvcC5xdWFsaXR5OwoKICAgICAgICAgICAgICAgIGlmIChbJzhLJywgJzRLJywgJzE0NDAnLCAnMTA4MCddLmluZGV4T2YocXVhbGl0eSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtb25vLnRyaWdnZXIodW1teUJ0biwgJ2NoYW5nZVZhbHVlJywgewogICAgICAgICAgICAgICAgICBkZXRhaWw6IEpTT04uc3RyaW5naWZ5KGJlc3QucHJvcCAmJiBiZXN0LnByb3AucXVhbGl0eSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodW1teUJ0bik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBidG5PYmoub25HZXRMaW5rc0FyciA9IG9uR2V0TGlua3NBcnI7CgogICAgICAgICAgX3RoaXMucXVpY2tCdG4uc2V0VmFsdWUoYnRuT2JqKTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIGFwcGVuZE5ld0Rvd25sb2FkQnV0dG9uOiBmdW5jdGlvbihwYXJlbnQpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICB2YXIgY3VycmVudEJ0biA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcjJyArIHlvdXR1YmUuYnV0dG9uSWQpOwogICAgICAgIGlmIChjdXJyZW50QnRuKSB7CiAgICAgICAgICBjdXJyZW50QnRuLnBhcmVudE5vZGUgJiYgY3VycmVudEJ0bi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGN1cnJlbnRCdG4pOwogICAgICAgICAgY3VycmVudEJ0biA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB2YXIgYnRuT2JqID0gbmV3IHRoaXMuZ2V0TmV3QnV0dG9uVW5kZXJWaWRlbyh5b3V0dWJlLl9vblNlbGVjdEJ0bkNsaWNrKTsKICAgICAgICBidG5PYmouaXNGaXJzdE1lbnVTaG93ID0gdHJ1ZTsKICAgICAgICBidG5PYmouc2V0TG9hZGluZ1N0YXRlKCk7CgogICAgICAgIHZhciBzZWNvbmRCdG4gPSBwYXJlbnQuY2hpbGROb2Rlc1syXTsKICAgICAgICBpZiAoIXNlY29uZEJ0bikgewogICAgICAgICAgc2Vjb25kQnRuID0gcGFyZW50LmZpcnN0Q2hpbGQ7CiAgICAgICAgfQogICAgICAgIGlmIChzZWNvbmRCdG4pIHsKICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoYnRuT2JqLm5vZGUsIHNlY29uZEJ0bik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChidG5PYmoubm9kZSk7CiAgICAgICAgfQoKICAgICAgICBtb25vLm9uUmVtb3ZlRXZlbnQoYnRuT2JqLm5vZGUsIGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHBhcmVudC5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIHlvdXR1YmUuYXBwZW5kTmV3RG93bmxvYWRCdXR0b24ocGFyZW50KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgYnRuT2JqLnBvcHVwTWVudSA9IHsKICAgICAgICAgIG9mZnNldFRvcDogLTYsCiAgICAgICAgICBvZmZzZXRSaWdodDogLTEsCiAgICAgICAgICBwYXJlbnQ6IGJ0bk9iai5tZW51Q29udGFpbmVyCiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGdldE5ld1BsYXllckNvbmZpZyhmdW5jdGlvbihjb25maWcpIHsKICAgICAgICAgIHZhciB2aWRlb0lkID0gY29uZmlnICYmIGNvbmZpZy5hcmdzICYmIGNvbmZpZy5hcmdzLnZpZGVvX2lkOwogICAgICAgICAgaWYgKCF2aWRlb0lkKSB7CiAgICAgICAgICAgIG1vbm8uZGVidWcoJ3ZpZGVvSWQgaXMgbm90IGZvdW5kIScpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgYnRuT2JqLm5vZGUuZGF0YXNldC5zZlZpZGVvSWQgPSB2aWRlb0lkOwogICAgICAgICAgYnRuT2JqLnl0Q29uZmlnID0gY29uZmlnOwogICAgICAgICAgYnRuT2JqLnZpZGVvSWQgPSB2aWRlb0lkOwogICAgICAgICAgYnRuT2JqLmlzUGFnZSA9IDE7CgogICAgICAgICAgdmFyIG9uR2V0TGlua3NBcnIgPSBbXTsKICAgICAgICAgIGJ0bk9iai5vbkdldExpbmtzQXJyID0gb25HZXRMaW5rc0FycjsKCiAgICAgICAgICBvbkdldExpbmtzQXJyLnB1c2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHlvdXR1YmUudHV0b3JpYWwuc2hvdyh7CiAgICAgICAgICAgICAgdGFyZ2V0OiBidG5PYmoubm9kZSwKICAgICAgICAgICAgICBwYXJlbnQ6IGJ0bk9iai5tZW51Q29udGFpbmVyLAogICAgICAgICAgICAgIGJ0bkxlZnRPZmZzZXQ6IC02LAogICAgICAgICAgICAgIGJ0blRvcE9mZnNldDogMwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzLnF1aWNrQnRuLnNldFZhbHVlKGJ0bk9iaik7CiAgICAgICAgfSk7CiAgICAgIH0sCgoKICAgICAgZ2V0SWRGcm9tTG9jYXRpb246IGZ1bmN0aW9uKHVybCkgewogICAgICAgIGlmICghdXJsKSB7CiAgICAgICAgICB1cmwgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOwogICAgICAgIH0KCiAgICAgICAgdmFyIHZpZGVvSWQgPSB1cmwubWF0Y2goL1wvd2F0Y2hcPyg/Oi4rJik/dj0oW1x3XC1dKykvaSk7CiAgICAgICAgdmlkZW9JZCA9IHZpZGVvSWQgJiYgdmlkZW9JZFsxXTsKICAgICAgICBpZiAodmlkZW9JZCkgewogICAgICAgICAgcmV0dXJuIHZpZGVvSWQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSwKCiAgICAgIGFwcGVuZE1vYmlsZUJ1dHRvbjogZnVuY3Rpb24odmlkLCBjb250YWluZXIpIHsKICAgICAgICB2YXIgZmlyc3RDaGlsZCA9IGNvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZDsKICAgICAgICBmaXJzdENoaWxkID0gZmlyc3RDaGlsZCAmJiBmaXJzdENoaWxkLmZpcnN0RWxlbWVudENoaWxkOwogICAgICAgIGlmICghZmlyc3RDaGlsZCB8fCBmaXJzdENoaWxkLnRhZ05hbWUgIT09ICdIMScpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBidXR0b24gPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgZGF0YTogewogICAgICAgICAgICBpZDogdmlkCiAgICAgICAgICB9LAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIGhlaWdodDogJzI4cHgnLAogICAgICAgICAgICB3aWR0aDogJzE4cHgnLAogICAgICAgICAgICBtYXJnaW5SaWdodDogJzIwcHgnLAogICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjNzU3NTc1JykgKyAnKSBjZW50ZXIgbm8tcmVwZWF0JywKICAgICAgICAgICAgY3NzRmxvYXQ6ICdyaWdodCcKICAgICAgICAgIH0sCiAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgdmlkID0gdGhpcy5kYXRhc2V0LmlkIHx8IHlvdXR1YmUuZ2V0SWRGcm9tTG9jYXRpb24oKTsKCiAgICAgICAgICAgIHlvdXR1YmUuaGlkZU1vYmlsZU1lbnUoKTsKCiAgICAgICAgICAgIHZhciBsaWdodEJveCA9IHlvdXR1YmUubW9iaWxlTWVudSA9IFNhdmVGcm9tX1V0aWxzLm1vYmlsZUxpZ2h0Qm94LnNob3cobGFuZ3VhZ2UuZG93bmxvYWQgKyAnIC4uLicpOwoKICAgICAgICAgICAgdmFyIG9uUmVzcG9uc2UgPSBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIHZhciBtZW51TGlua3MgPSBudWxsOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5saW5rcykgewogICAgICAgICAgICAgICAgbWVudUxpbmtzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rcy55b3V0dWJlKHJlc3BvbnNlLmxpbmtzLCByZXNwb25zZS50aXRsZSB8fCB5b3V0dWJlLmdldFRpdGxlTW9kaWZ5KCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsaWdodEJveC51cGRhdGUobWVudUxpbmtzKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBmcm9tQ2FjaGUgPSB5b3V0dWJlLnJlc3BvbnNlQ2FjaGVbdmlkXTsKICAgICAgICAgICAgaWYgKGZyb21DYWNoZSkgewogICAgICAgICAgICAgIHJldHVybiBvblJlc3BvbnNlKGZyb21DYWNoZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgIGFjdGlvbjogJ2dldFlvdXR1YmVMaW5rcycsCiAgICAgICAgICAgICAgZXh0VmlkZW9JZDogdmlkLAogICAgICAgICAgICAgIHVybDogbG9jYXRpb24uaHJlZgogICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIGlmIChyZXNwb25zZS5saW5rcykgewogICAgICAgICAgICAgICAgeW91dHViZS5yZXNwb25zZUNhY2hlW3ZpZF0gPSByZXNwb25zZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgb25SZXNwb25zZShyZXNwb25zZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfV0KICAgICAgICB9KTsKCiAgICAgICAgbW9uby5vblJlbW92ZUV2ZW50KGJ1dHRvbiwgeW91dHViZS5oaWRlTW9iaWxlTWVudSk7CgogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICB9LAogICAgICBnZXROZXdCdXR0b25VbmRlclZpZGVvOiBmdW5jdGlvbihvblNlbGVjdEJ0bkNsaWNrKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB0aGlzLm5vZGUgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgaWQ6IHlvdXR1YmUuYnV0dG9uSWQsCiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBkaXNwbGF5OiBbCiAgICAgICAgICAgICAgJy1tcy1mbGV4Ym94JywKICAgICAgICAgICAgICAnLXdlYmtpdC1mbGV4JywKICAgICAgICAgICAgICAnZmxleCcKICAgICAgICAgICAgXSwKICAgICAgICAgICAgbWFyZ2luTGVmdDogJzhweCcsCiAgICAgICAgICAgIE1zRmxleERpcmVjdGlvbjogJ3JvdycsCiAgICAgICAgICAgIFdlYmtpdEZsZXhEaXJlY3Rpb246ICdyb3cnLAogICAgICAgICAgICBmbGV4RGlyZWN0aW9uOiAncm93JywKICAgICAgICAgICAgTXNGbGV4QWxpZ246ICdjZW50ZXInLAogICAgICAgICAgICBXZWJraXRBbGlnbkl0ZW1zOiAnY2VudGVyJywKICAgICAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsCiAgICAgICAgICAgIE1zRmxleFBhY2s6ICdjZW50ZXInLAogICAgICAgICAgICBXZWJraXRKdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsCiAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJywKICAgICAgICAgICAgcGFkZGluZzogJzAgOHB4IDAgMCcKICAgICAgICAgIH0sCiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgdGhpcy5tZW51Q29udGFpbmVyID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICB0aGlzLnF1aWNrQnRuID0gbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICAgICAgY2xhc3M6ICdzZi1xdWljay1kbC1idG4nLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnaW5oZXJpdCcsCiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyMnB4JywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjMDBCNzVBJywKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzNweCcsCiAgICAgICAgICAgICAgICBib3JkZXJUb3BSaWdodFJhZGl1czogMCwKICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzOiAwLAogICAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ6ICcyOHB4JywKICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLAogICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcyMnB4JywKICAgICAgICAgICAgICAgIHRleHREZWNvcmF0aW9uOiAnbm9uZScsCiAgICAgICAgICAgICAgICB6SW5kZXg6IDEsCiAgICAgICAgICAgICAgICBjb2xvcjogJyNmZmYnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBocmVmOiAnIycsCiAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnaScsIHsKICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgICAgICBsZWZ0OiAnNnB4JywKICAgICAgICAgICAgICAgICAgICB0b3A6ICczcHgnLAogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJ3VybCgnICsgU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnI2ZmZmZmZicpICsgJyknLAogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnMTJweCcsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJ25vLXJlcGVhdCcsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzE2cHgnLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogJzE2cHgnCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICAgICAgICAgIGNsYXNzOiAnc2YtYnRuLW5hbWUnLAogICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgIHBhZGRpbmdSaWdodDogJzEycHgnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRleHQ6IGxhbmd1YWdlLmRvd25sb2FkCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHRoaXMucXVpY2tCdG5TdHlsZSA9IG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoewogICAgICAgICAgICAgICAgc2VsZWN0b3I6ICcjJyArIHlvdXR1YmUuYnV0dG9uSWQsCiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBmb250RmFtaWx5OiAnUm9ib3RvLCBBcmlhbCwgc2Fucy1zZXJpZicsCiAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTNweCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhcHBlbmQ6IFt7CiAgICAgICAgICAgICAgICAgICdidXR0b246Oi1tb3otZm9jdXMtaW5uZXInOiB7CiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMCwKICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgJy5zZi1xdWljay1kbC1idG4nOiB7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzAwQjc1QScKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgJy5zZi1xdWljay1kbC1idG46aG92ZXInOiB7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiKDAsIDE2MywgODApJwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLXF1aWNrLWRsLWJ0bjphY3RpdmUnOiB7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiKDAsIDE1MSwgNzQpJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIG1lZGlhOiAnQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogMTI5M3B4KScsCiAgICAgICAgICAgICAgICAgIGFwcGVuZDogewogICAgICAgICAgICAgICAgICAgICcuc2YtcXVpY2stZGwtYnRuIC5zZi1idG4tbmFtZSc6IHsKICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdub25lJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgdGhpcy5zZWxlY3RCdG4gPSBtb25vLmNyZWF0ZSgnYnV0dG9uJywgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJy0ycHgnLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICdpbmhlcml0JywKICAgICAgICAgICAgICAgIGhlaWdodDogJzI0cHgnLAogICAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0OiAnMjFweCcsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjRjhGOEY4JywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjQ0NDQ0NDJywKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzNweCcsCiAgICAgICAgICAgICAgICBib3JkZXJUb3BMZWZ0UmFkaXVzOiAnMCcsCiAgICAgICAgICAgICAgICBib3JkZXJCb3R0b21MZWZ0UmFkaXVzOiAnMCcsCiAgICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJywKICAgICAgICAgICAgICAgIGNvbG9yOiAnIzlCOUI5QicsCiAgICAgICAgICAgICAgICB6SW5kZXg6IDAsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb246IFsnbW91c2Vkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9uU2VsZWN0QnRuQ2xpY2suY2FsbCh0aGlzLCB7CiAgICAgICAgICAgICAgICAgIGJ0bk9iajogX3RoaXMKICAgICAgICAgICAgICAgIH0sIGUpOwogICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RCdG5JY29uID0gbW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgICAgICAgdG9wOiAnOXB4JywKICAgICAgICAgICAgICAgICAgICByaWdodDogJzZweCcsCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiAnNXB4IHNvbGlkICM4NjgyODInLAogICAgICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbUNvbG9yOiAndHJhbnNwYXJlbnQnLAogICAgICAgICAgICAgICAgICAgIGJvcmRlckxlZnRDb2xvcjogJ3RyYW5zcGFyZW50JywKICAgICAgICAgICAgICAgICAgICBib3JkZXJSaWdodENvbG9yOiAndHJhbnNwYXJlbnQnCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9KQogICAgICAgICAgXQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLm5vZGUuY2xhc3NMaXN0LmFkZChtb25vLm9uUmVtb3ZlQ2xhc3NOYW1lKTsKCiAgICAgICAgdmFyIHNldFF1YWxpdHkgPSBmdW5jdGlvbih0ZXh0KSB7CiAgICAgICAgICB2YXIgbm9kZSA9IHR5cGVvZiB0ZXh0ID09PSAnb2JqZWN0JyA/IHRleHQgOiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTsKICAgICAgICAgIG5vZGUuc3R5bGUubWFyZ2luTGVmdCA9IDA7CiAgICAgICAgICB2YXIgZmlyc3QgPSBfdGhpcy5zZWxlY3RCdG4uZmlyc3RDaGlsZDsKICAgICAgICAgIGlmIChmaXJzdCA9PT0gX3RoaXMuc2VsZWN0QnRuSWNvbikgewogICAgICAgICAgICBfdGhpcy5zZWxlY3RCdG4uaW5zZXJ0QmVmb3JlKG5vZGUsIGZpcnN0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzLnNlbGVjdEJ0bi5yZXBsYWNlQ2hpbGQobm9kZSwgZmlyc3QpOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMuc2V0UXVhbGl0eSA9IHNldFF1YWxpdHk7CgogICAgICAgIHRoaXMuc2V0TG9hZGluZ1N0YXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBzZXRRdWFsaXR5KG1vbm8uY3JlYXRlKCdpbWcnLCB7CiAgICAgICAgICAgIHNyYzogU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnaW5mbycsICcjMzMzMzMzJyksCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgd2lkdGg6ICcxNHB4JywKICAgICAgICAgICAgICBoZWlnaHQ6ICcxNHB4JywKICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAnNnB4JywKICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICAgICAgICB0b3A6ICctMXB4JywKICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJwogICAgICAgICAgICB9CiAgICAgICAgICB9KSk7CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgZ2V0QnV0dG9uVW5kZXJWaWRlbzogZnVuY3Rpb24ob25TZWxlY3RCdG5DbGljaykgewogICAgICAgIHZhciBzZWxlY3RCdG5JY29uID0gbnVsbDsKICAgICAgICB2YXIgcXVpY2tCdG4gPSBudWxsOwogICAgICAgIHZhciBzZWxlY3RCdG4gPSBudWxsOwogICAgICAgIHZhciBub2RlID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgIGlkOiB5b3V0dWJlLmJ1dHRvbklkLAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIG1hcmdpbkxlZnQ6ICcxMHB4JywKICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScKICAgICAgICAgIH0sCiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgcXVpY2tCdG4gPSBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgICAgICBjbGFzczogJ3NmLXF1aWNrLWRsLWJ0bicsCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICdpbmhlcml0JywKICAgICAgICAgICAgICAgIGhlaWdodDogJzIycHgnLAogICAgICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkICMwMEI3NUEnLAogICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnM3B4JywKICAgICAgICAgICAgICAgIGJvcmRlclRvcFJpZ2h0UmFkaXVzOiAwLAogICAgICAgICAgICAgICAgYm9yZGVyQm90dG9tUmlnaHRSYWRpdXM6IDAsCiAgICAgICAgICAgICAgICBwYWRkaW5nTGVmdDogJzI4cHgnLAogICAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLAogICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzIycHgnLAogICAgICAgICAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJywKICAgICAgICAgICAgICAgIHpJbmRleDogMSwKICAgICAgICAgICAgICAgIGNvbG9yOiAnI2ZmZicKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGhyZWY6ICcjJywKICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdpJywgewogICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgICAgICAgIGxlZnQ6ICc2cHgnLAogICAgICAgICAgICAgICAgICAgIHRvcDogJzNweCcsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjZmZmZmZmJykgKyAnKScsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JywKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAnbm8tcmVwZWF0JywKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246ICdjZW50ZXInLAogICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTZweCcKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZi1idG4tbmFtZScsCiAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0OiAnMTJweCcKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UuZG93bmxvYWQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dCh7CiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJyMnICsgeW91dHViZS5idXR0b25JZCwKICAgICAgICAgICAgICAgIGFwcGVuZDogW3sKICAgICAgICAgICAgICAgICAgJ2J1dHRvbjo6LW1vei1mb2N1cy1pbm5lcic6IHsKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgICAgICAgICAgIG1hcmdpbjogMAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLXF1aWNrLWRsLWJ0bic6IHsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMDBCNzVBJwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLXF1aWNrLWRsLWJ0bjpob3Zlcic6IHsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2IoMCwgMTYzLCA4MCknCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICcuc2YtcXVpY2stZGwtYnRuOmFjdGl2ZSc6IHsKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2IoMCwgMTUxLCA3NCknCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgbWVkaWE6ICdAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiAxMjkzcHgpJywKICAgICAgICAgICAgICAgICAgYXBwZW5kOiB7CiAgICAgICAgICAgICAgICAgICAgJy5zZi1xdWljay1kbC1idG4gLnNmLWJ0bi1uYW1lJzogewogICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBzZWxlY3RCdG4gPSBtb25vLmNyZWF0ZSgnYnV0dG9uJywgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJy0ycHgnLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICdpbmhlcml0JywKICAgICAgICAgICAgICAgIGhlaWdodDogJzI0cHgnLAogICAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0OiAnMjFweCcsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjRjhGOEY4JywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjQ0NDQ0NDJywKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzNweCcsCiAgICAgICAgICAgICAgICBib3JkZXJUb3BMZWZ0UmFkaXVzOiAnMCcsCiAgICAgICAgICAgICAgICBib3JkZXJCb3R0b21MZWZ0UmFkaXVzOiAnMCcsCiAgICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJywKICAgICAgICAgICAgICAgIGNvbG9yOiAnIzlCOUI5QicsCiAgICAgICAgICAgICAgICB6SW5kZXg6IDAsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb246IFsnbW91c2Vkb3duJywgb25TZWxlY3RCdG5DbGlja10sCiAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICBzZWxlY3RCdG5JY29uID0gbW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgICAgICAgdG9wOiAnOXB4JywKICAgICAgICAgICAgICAgICAgICByaWdodDogJzZweCcsCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiAnNXB4IHNvbGlkICM4NjgyODInLAogICAgICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbUNvbG9yOiAndHJhbnNwYXJlbnQnLAogICAgICAgICAgICAgICAgICAgIGJvcmRlckxlZnRDb2xvcjogJ3RyYW5zcGFyZW50JywKICAgICAgICAgICAgICAgICAgICBib3JkZXJSaWdodENvbG9yOiAndHJhbnNwYXJlbnQnCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9KQogICAgICAgICAgXQogICAgICAgIH0pOwoKICAgICAgICBub2RlLmNsYXNzTGlzdC5hZGQobW9uby5vblJlbW92ZUNsYXNzTmFtZSk7CgogICAgICAgIHZhciBzZXRRdWFsaXR5ID0gZnVuY3Rpb24odGV4dCkgewogICAgICAgICAgdmFyIG5vZGUgPSB0eXBlb2YgdGV4dCA9PT0gJ29iamVjdCcgPyB0ZXh0IDogZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCk7CiAgICAgICAgICB2YXIgZmlyc3QgPSBzZWxlY3RCdG4uZmlyc3RDaGlsZDsKICAgICAgICAgIGlmIChmaXJzdCA9PT0gc2VsZWN0QnRuSWNvbikgewogICAgICAgICAgICBzZWxlY3RCdG4uaW5zZXJ0QmVmb3JlKG5vZGUsIGZpcnN0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGVjdEJ0bi5yZXBsYWNlQ2hpbGQobm9kZSwgZmlyc3QpOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBub2RlOiBub2RlLAogICAgICAgICAgc2VsZWN0QnRuOiBzZWxlY3RCdG4sCiAgICAgICAgICBxdWlja0J0bjogcXVpY2tCdG4sCiAgICAgICAgICBzZXRRdWFsaXR5OiBzZXRRdWFsaXR5LAogICAgICAgICAgc2V0TG9hZGluZ1N0YXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgc2V0UXVhbGl0eShtb25vLmNyZWF0ZSgnaW1nJywgewogICAgICAgICAgICAgIHNyYzogU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnaW5mbycsICcjMzMzMzMzJyksCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIHdpZHRoOiAnMTRweCcsCiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxNHB4JywKICAgICAgICAgICAgICAgIG1hcmdpbkxlZnQ6ICc2cHgnLAogICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAgICAgICB0b3A6ICctMXB4JywKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSwKICAgICAgdGl0bGVDaGFuZ2VPYnNlcnZlcjogbnVsbCwKICAgICAgcGxheWVyU3RhdGVDaGFuZ2VPYnNlcnZlcjogbnVsbCwKICAgICAgb2JzZXJ2ZUZyYW1lVmlkZW9DaGFuZ2U6IGZ1bmN0aW9uKGJ0bk9iaikgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICBpZiAoIVNhdmVGcm9tX1V0aWxzLm11dGF0aW9uV2F0Y2hlci5pc0F2YWlsYWJsZSgpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgcGxheWVyVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcueXRwLXRpdGxlLWxpbmsnKTsKICAgICAgICBpZiAocGxheWVyVGl0bGUpIHsKICAgICAgICAgIGlmICh0aGlzLnRpdGxlQ2hhbmdlT2JzZXJ2ZXIpIHsKICAgICAgICAgICAgdGhpcy50aXRsZUNoYW5nZU9ic2VydmVyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMudGl0bGVDaGFuZ2VPYnNlcnZlciA9IFNhdmVGcm9tX1V0aWxzLm11dGF0aW9uQXR0cldhdGNoZXIucnVuKHsKICAgICAgICAgICAgYXR0cjogJ2hyZWYnLAogICAgICAgICAgICB0YXJnZXQ6IHBsYXllclRpdGxlLAogICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VtbWFyeUxpc3QpIHsKICAgICAgICAgICAgICB2YXIgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzBdOwogICAgICAgICAgICAgIHZhciBvbGRWaWRlb0lkID0gc3VtbWFyeS5vbGRWYWx1ZSAmJiB5b3V0dWJlLmdldElkRnJvbUxvY2F0aW9uKHN1bW1hcnkub2xkVmFsdWUpOwogICAgICAgICAgICAgIHZhciB2aWRlb0lkID0gc3VtbWFyeS52YWx1ZSAmJiB5b3V0dWJlLmdldElkRnJvbUxvY2F0aW9uKHN1bW1hcnkudmFsdWUpOwogICAgICAgICAgICAgIGlmIChvbGRWaWRlb0lkICE9PSB2aWRlb0lkICYmIHlvdXR1YmUudmlkZW9faWQgIT09IHZpZGVvSWQpIHsKICAgICAgICAgICAgICAgIHlvdXR1YmUudmlkZW9faWQgPSB2aWRlb0lkOwoKICAgICAgICAgICAgICAgIGlmICh5b3V0dWJlLmZyYW1lUXVhbGl0eURldGVjdGVkKSB7CiAgICAgICAgICAgICAgICAgIGJ0bk9iai5saW5rID0gbnVsbDsKICAgICAgICAgICAgICAgICAgYnRuT2JqLnNldExvYWRpbmdTdGF0ZSgpOwoKICAgICAgICAgICAgICAgICAgX3RoaXMucXVpY2tCdG4uc2V0VmFsdWUoYnRuT2JqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBsYXllck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaHRtbDUtdmlkZW8tcGxheWVyJyk7CiAgICAgICAgaWYgKHBsYXllck1lbnUpIHsKICAgICAgICAgIHZhciBoaWRlQnRuVGltZXIgPSBudWxsOwogICAgICAgICAgdmFyIHl0cEF1dG9oaWRlUmUgPSAvKFxzfF4peXRwLWF1dG9oaWRlKFxzfCQpLzsKICAgICAgICAgIGlmICh0aGlzLnBsYXllclN0YXRlQ2hhbmdlT2JzZXJ2ZXIpIHsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJTdGF0ZUNoYW5nZU9ic2VydmVyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMucGxheWVyU3RhdGVDaGFuZ2VPYnNlcnZlciA9IFNhdmVGcm9tX1V0aWxzLm11dGF0aW9uQXR0cldhdGNoZXIucnVuKHsKICAgICAgICAgICAgYXR0cjogJ2NsYXNzJywKICAgICAgICAgICAgdGFyZ2V0OiBwbGF5ZXJNZW51LAogICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VtbWFyeUxpc3QpIHsKICAgICAgICAgICAgICB2YXIgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzBdOwogICAgICAgICAgICAgIHZhciBzaG93QmVmb3JlID0geXRwQXV0b2hpZGVSZS50ZXN0KHN1bW1hcnkub2xkVmFsdWUpOwogICAgICAgICAgICAgIHZhciBzaG93QWZyZXQgPSB5dHBBdXRvaGlkZVJlLnRlc3Qoc3VtbWFyeS52YWx1ZSk7CiAgICAgICAgICAgICAgaWYgKCFzaG93QmVmb3JlICYmIHNob3dBZnJldCkgewogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGhpZGVCdG5UaW1lcik7CiAgICAgICAgICAgICAgICBoaWRlQnRuVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBpZiAoIWJ0bk9iai5sb2NrSGlkZSkgewogICAgICAgICAgICAgICAgICAgIGJ0bk9iai5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc2YtaGlkZS11aScpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIGlmIChzaG93QmVmb3JlICYmICFzaG93QWZyZXQpIHsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChoaWRlQnRuVGltZXIpOwogICAgICAgICAgICAgICAgYnRuT2JqLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzZi1oaWRlLXVpJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBhcHBlbmRGcmFtZUJ1dHRvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIGlmIChkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIDwgMjIwIHx8IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0IDwgMTUwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgX3RoaXMgPSB5b3V0dWJlOwoKICAgICAgICB2YXIgZmlyc3RNZW51U2hvdyA9IHRydWU7CgogICAgICAgIHZhciBidG5PYmogPSBTYXZlRnJvbV9VdGlscy5mcmFtZU1lbnUuZ2V0QnRuKHsKICAgICAgICAgIGJ0bklkOiAnc2ZZdEZyYW1lQnRuJywKICAgICAgICAgIGNvbnRhaW5lclN0eWxlOiB7CiAgICAgICAgICAgIHRvcDogJzQwcHgnLAogICAgICAgICAgICByaWdodDogJzIwcHgnCiAgICAgICAgICB9LAogICAgICAgICAgb246IFsKICAgICAgICAgICAgWydtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICBpZiAoZS5idXR0b24gIT09IDIpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChfdGhpcy5vbkZyYW1lTW91c2VFbnRlckJpbmQpIHsKICAgICAgICAgICAgICAgIG1vbm8ub2ZmKGRvY3VtZW50LmJvZHksICdtb3VzZWVudGVyJywgX3RoaXMub25GcmFtZU1vdXNlRW50ZXJCaW5kKTsKICAgICAgICAgICAgICAgIG1vbm8ub2ZmKGRvY3VtZW50LmJvZHksICdtb3VzZWxlYXZlJywgX3RoaXMub25GcmFtZU1vdXNlTGVhdmVCaW5kKTsKICAgICAgICAgICAgICAgIF90aGlzLm9uRnJhbWVNb3VzZUVudGVyQmluZCA9IG51bGw7CiAgICAgICAgICAgICAgICBfdGhpcy5vbkZyYW1lTW91c2VMZWF2ZUJpbmQgPSBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoX3RoaXMudGl0bGVDaGFuZ2VPYnNlcnZlcikgewogICAgICAgICAgICAgICAgX3RoaXMudGl0bGVDaGFuZ2VPYnNlcnZlci5zdG9wKCk7CiAgICAgICAgICAgICAgICBfdGhpcy50aXRsZUNoYW5nZU9ic2VydmVyID0gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKF90aGlzLnBsYXllclN0YXRlQ2hhbmdlT2JzZXJ2ZXIpIHsKICAgICAgICAgICAgICAgIF90aGlzLnBsYXllclN0YXRlQ2hhbmdlT2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgICAgICAgICAgX3RoaXMucGxheWVyU3RhdGVDaGFuZ2VPYnNlcnZlciA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF90aGlzLmhpZGVDdXJyZW50TWVudSgpOwogICAgICAgICAgICAgIGlmIChidG5PYmouY29udGFpbmVyLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgIGJ0bk9iai5jb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChidG5PYmouY29udGFpbmVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dCiAgICAgICAgICBdLAogICAgICAgICAgb25TZWxlY3RCdG46IFsnbW91c2Vkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBpZiAoZS5idXR0b24gPiAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICB2YXIgdmlkID0gX3RoaXMudmlkZW9faWQ7CgogICAgICAgICAgICBpZiAoX3RoaXMuY3VycmVudE1lbnUpIHsKICAgICAgICAgICAgICB5b3V0dWJlLmhpZGVDdXJyZW50TWVudSgpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG1lbnUgPSBfdGhpcy5jdXJyZW50TWVudSA9IFNhdmVGcm9tX1V0aWxzLmZyYW1lTWVudS5nZXRNZW51KHRoaXMucGFyZW50Tm9kZSwgbGFuZ3VhZ2UuZG93bmxvYWQgKyAnIC4uLicsICdzZi1wb3B1cE1lbnUnLCB7CiAgICAgICAgICAgICAgY29udGFpbmVyOiBidG5PYmouY29udGFpbmVyLAogICAgICAgICAgICAgIG9uU2hvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBidG5PYmoubm9kZS5jbGFzc0xpc3QuYWRkKCdzZi1vdmVyJyk7CgogICAgICAgICAgICAgICAgaWYgKCFmaXJzdE1lbnVTaG93KSB7CiAgICAgICAgICAgICAgICAgIGZpcnN0TWVudVNob3cgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAgIGlmIChbMV0uaW5kZXhPZihwcmVmZXJlbmNlLmNvaG9ydEluZGV4KSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICAgICAgICAgIHQ6ICdldmVudCcsCiAgICAgICAgICAgICAgICAgICAgICBlYzogJ3lvdXR1YmUnLAogICAgICAgICAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgICAgICAgICBlbDogJ3ZpZGVvLWlmcmFtZScKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb25IaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIF90aGlzLmN1cnJlbnRNZW51ID0gbnVsbDsKICAgICAgICAgICAgICAgIGJ0bk9iai5ub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3NmLW92ZXInKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG9uSXRlbUNsaWNrOiBmdW5jdGlvbihlLCBtZW51SXRlbSkgewogICAgICAgICAgICAgICAgdmFyIGl0YWcgPSBtZW51SXRlbS5pdGFnOwogICAgICAgICAgICAgICAgaWYgKGl0YWcgPT09ICd1bW15QXVkaW8nKSB7CiAgICAgICAgICAgICAgICAgIGl0YWcgPSAndW1teSc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnRuT2JqLmxhc3RJdGFnICE9PSBpdGFnICYmIG1vbm8uc3RvcmFnZS5zZXQoewogICAgICAgICAgICAgICAgICB5dExhc3RJVGFnOiBpdGFnCiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMucXVpY2tCdG4uc2V0VmFsdWUoYnRuT2JqKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHlvdXR1YmUub25NZW51SXRlbUNsaWNrKG1lbnVJdGVtLCB7CiAgICAgICAgICAgICAgICAgIGlzRnJhbWVJdGVtOiAxLAogICAgICAgICAgICAgICAgICB2aWRlb0lkOiB2aWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgb25SZXNwb25zZSA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgdmFyIG1lbnVMaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MueW91dHViZShyZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUsIHJlc3BvbnNlLnN1YnRpdGxlcywgewogICAgICAgICAgICAgICAgdW1teVZpZDogMTM2CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgbWVudS51cGRhdGUobWVudUxpbmtzKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IF90aGlzLnJlc3BvbnNlQ2FjaGVbdmlkXTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG9uUmVzcG9uc2UocmVzcG9uc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICdnZXRZb3V0dWJlTGlua3MnLAogICAgICAgICAgICAgIGV4dFZpZGVvSWQ6IHZpZCwKICAgICAgICAgICAgICB1cmw6IGxvY2F0aW9uLmhyZWYsCiAgICAgICAgICAgICAgY2hlY2tTdWJ0aXRsZXM6IHRydWUKICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubGlua3MpIHsKICAgICAgICAgICAgICAgIF90aGlzLnJlc3BvbnNlQ2FjaGVbdmlkXSA9IHJlc3BvbnNlOwogICAgICAgICAgICAgICAgcmV0dXJuIG9uUmVzcG9uc2UocmVzcG9uc2UpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbWVudS51cGRhdGUobGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9XQogICAgICAgIH0pOwoKICAgICAgICBidG5PYmouc2V0TG9hZGluZ1N0YXRlKCk7CgogICAgICAgIGJ0bk9iai5jb250YWluZXIgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgY2xhc3M6ICdzZi1idG4tY3RyJywKICAgICAgICAgIGFwcGVuZDogYnRuT2JqLm5vZGUKICAgICAgICB9KTsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGJ0bk9iai5jb250YWluZXIpOwoKICAgICAgICB2YXIgb25CdG5Nb3VzZUVudGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBtb25vLm9mZihidG5PYmoubm9kZSwgJ21vdXNlZW50ZXInLCBvbkJ0bk1vdXNlRW50ZXIpOwoKICAgICAgICAgIGlmIChfdGhpcy5mcmFtZVF1YWxpdHlEZXRlY3RlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBfdGhpcy5mcmFtZVF1YWxpdHlEZXRlY3RlZCA9IHRydWU7CgogICAgICAgICAgX3RoaXMucXVpY2tCdG4uc2V0VmFsdWUoYnRuT2JqKTsKICAgICAgICB9OwoKICAgICAgICBtb25vLm9uKGJ0bk9iai5ub2RlLCAnbW91c2VlbnRlcicsIG9uQnRuTW91c2VFbnRlcik7CgogICAgICAgIG1vbm8ub25lKGRvY3VtZW50LCAnbW91c2VvdmVyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBfdGhpcy5vbkZyYW1lTW91c2VFbnRlcihidG5PYmopOwogICAgICAgIH0pOwoKICAgICAgICBtb25vLm9uKGJ0bk9iai5jb250YWluZXIsICdtb3VzZWVudGVyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBidG5PYmoubG9ja0hpZGUgPSB0cnVlOwogICAgICAgIH0pOwoKICAgICAgICBtb25vLm9uKGJ0bk9iai5jb250YWluZXIsICdtb3VzZWxlYXZlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBidG5PYmoubG9ja0hpZGUgPSBmYWxzZTsKICAgICAgICB9KTsKCiAgICAgICAgYnRuT2JqLm5vZGUuYXBwZW5kQ2hpbGQobW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KFt7CiAgICAgICAgICAgIHNlbGVjdG9yOiBbCiAgICAgICAgICAgICAgJ2JvZHk6aG92ZXIgLnNmLWJ0bi1jdHI6bm90KC5zZi1oaWRlLXVpKSAjc2ZZdEZyYW1lQnRuJywKICAgICAgICAgICAgICAnYm9keTpob3ZlciAuc2YtYnRuLWN0cjpub3QoLnNmLWhpZGUtdWkpIC5zZi1wb3B1cE1lbnUnCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJwogICAgICAgICAgICB9CiAgICAgICAgICB9XSkKICAgICAgICB9KSk7CgogICAgICAgIGlmICh0aGlzLm9uRnJhbWVNb3VzZUVudGVyQmluZCkgewogICAgICAgICAgbW9uby5vZmYoZG9jdW1lbnQuYm9keSwgJ21vdXNlZW50ZXInLCB0aGlzLm9uRnJhbWVNb3VzZUVudGVyQmluZCk7CiAgICAgICAgICBtb25vLm9mZihkb2N1bWVudC5ib2R5LCAnbW91c2VsZWF2ZScsIHRoaXMub25GcmFtZU1vdXNlTGVhdmVCaW5kKTsKICAgICAgICB9CgogICAgICAgIHRoaXMub25GcmFtZU1vdXNlRW50ZXJCaW5kID0gdGhpcy5vbkZyYW1lTW91c2VFbnRlci5iaW5kKHRoaXMsIGJ0bk9iaik7CiAgICAgICAgdGhpcy5vbkZyYW1lTW91c2VMZWF2ZUJpbmQgPSB0aGlzLm9uRnJhbWVNb3VzZUxlYXZlLmJpbmQodGhpcywgYnRuT2JqKTsKCiAgICAgICAgbW9uby5vbihkb2N1bWVudC5ib2R5LCAnbW91c2VlbnRlcicsIHRoaXMub25GcmFtZU1vdXNlRW50ZXJCaW5kKTsKICAgICAgICBtb25vLm9uKGRvY3VtZW50LmJvZHksICdtb3VzZWxlYXZlJywgdGhpcy5vbkZyYW1lTW91c2VMZWF2ZUJpbmQpOwoKICAgICAgICB0aGlzLm9ic2VydmVGcmFtZVZpZGVvQ2hhbmdlKGJ0bk9iaik7CiAgICAgIH0sCgogICAgICBmcmFtZVF1YWxpdHlEZXRlY3RlZDogZmFsc2UsCiAgICAgIGZyYW1lUXVhbGl0eVRpbWVyOiBudWxsLAoKICAgICAgb25GcmFtZU1vdXNlRW50ZXJCaW5kOiBudWxsLAogICAgICBvbkZyYW1lTW91c2VMZWF2ZUJpbmQ6IG51bGwsCgogICAgICBvbkZyYW1lTW91c2VFbnRlcjogZnVuY3Rpb24oYnRuT2JqKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgaWYgKCF0aGlzLmZyYW1lUXVhbGl0eURldGVjdGVkKSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5mcmFtZVF1YWxpdHlUaW1lcik7CiAgICAgICAgICB0aGlzLmZyYW1lUXVhbGl0eVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKF90aGlzLmZyYW1lUXVhbGl0eURldGVjdGVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF90aGlzLmZyYW1lUXVhbGl0eURldGVjdGVkID0gdHJ1ZTsKCgogICAgICAgICAgICBfdGhpcy5xdWlja0J0bi5zZXRWYWx1ZShidG5PYmopOwogICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBvbkZyYW1lTW91c2VMZWF2ZTogZnVuY3Rpb24oYnRuT2JqKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIGlmICghdGhpcy5mcmFtZVF1YWxpdHlEZXRlY3RlZCkgewogICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZnJhbWVRdWFsaXR5VGltZXIpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGdldFRpdGxlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YXRjaC1oZWFkbGluZS10aXRsZScpOwogICAgICAgIGlmICh0KQogICAgICAgICAgcmV0dXJuIHQudGV4dENvbnRlbnQ7CgogICAgICAgIHZhciBtZXRhID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21ldGEnKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1ldGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBuYW1lID0gbWV0YVtpXS5nZXRBdHRyaWJ1dGUoJ25hbWUnKTsKICAgICAgICAgIGlmIChuYW1lICYmIG5hbWUudG9Mb3dlckNhc2UoKSA9PSAndGl0bGUnKQogICAgICAgICAgICByZXR1cm4gbWV0YVtpXS5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnKTsKICAgICAgICB9CgogICAgICAgIGlmIChpZnJhbWUgfHwgeW91dHViZS5pc01vYmlsZSkKICAgICAgICAgIHJldHVybiBkb2N1bWVudC50aXRsZS5yZXBsYWNlKC8gLSBZb3VUdWJlJC8sICcnKTsKCiAgICAgICAgcmV0dXJuICcnOwogICAgICB9LAoKICAgICAgZ2V0VGl0bGVNb2RpZnk6IGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgdGl0bGUgPSB5b3V0dWJlLmdldFRpdGxlKCk7CiAgICAgICAgaWYgKHRpdGxlKSB7CiAgICAgICAgICB0aXRsZSA9IG1vZGlmeVRpdGxlKHRpdGxlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aXRsZTsKICAgICAgfSwKCiAgICAgIG9uTWVudUl0ZW1DbGljazogZnVuY3Rpb24obGluaywgZGV0YWlscykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBkZXRhaWxzID0gZGV0YWlscyB8fCB7fTsKCiAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICBpdGFnOiBsaW5rLml0YWcgfHwgJycsCiAgICAgICAgICBxdWFsaXR5OiBsaW5rLnF1YWxpdHkgfHwgJycsCiAgICAgICAgICBmb3JtYXQ6IGxpbmsuZm9ybWF0IHx8ICc/Pz8nLAogICAgICAgICAgJzNkJzogbGlua1snM2QnXSA/ICczRCcgOiAnJywKICAgICAgICAgIHNGcHM6IGxpbmsuc0ZwcyA/ICdmcHMnICsgKGxpbmsuZnBzIHx8IDYwKSA6ICcnLAogICAgICAgICAgbm9BdWRpbzogbGluay5ub0F1ZGlvID8gJ25vIGF1ZGlvJyA6ICcnLAogICAgICAgICAgdUlzQXVkaW86IGxpbmsudUlzQXVkaW8gPyAnYXVkaW8nIDogJycKICAgICAgICB9OwoKICAgICAgICBpZiAoIWxpbmsuZm9ybWF0KSB7CiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAndHJhY2snLAogICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICBlYzogJ3lvdXR1YmUnLAogICAgICAgICAgICBlYTogJ25ld19mb3JtYXQnLAogICAgICAgICAgICBlbDogbGluay5pdGFnICsgJyAnICsgZGV0YWlscy52aWRlb0lkCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBsYWJlbCA9IFsKICAgICAgICAgIGRhdGEuZm9ybWF0CiAgICAgICAgXTsKCiAgICAgICAgaWYgKGRhdGEucXVhbGl0eSA9PT0gJ3VtbXknKSB7CiAgICAgICAgICBpZiAoZGF0YS51SXNBdWRpbykgewogICAgICAgICAgICBsYWJlbC5wdXNoKGRhdGEudUlzQXVkaW8pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkZXRhaWxzLmlzRnJhbWUgfHwgZGV0YWlscy5pc0ZyYW1lSXRlbSkgewogICAgICAgICAgICBsYWJlbC5wdXNoKCdpZicpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoZGF0YS5leHRyYSkgewogICAgICAgICAgICBsYWJlbC5wdXNoKGRhdGEuZXh0cmEpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGRhdGEucXVhbGl0eSkgewogICAgICAgICAgICBsYWJlbC5wdXNoKGRhdGEucXVhbGl0eS5yZXBsYWNlKCcgJyArIG1vbm8uZ2xvYmFsLmxhbmd1YWdlLmticHMsICcnKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZGF0YS5zRnBzKSB7CiAgICAgICAgICAgIGxhYmVsLnB1c2goZGF0YS5zRnBzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChkYXRhWyczZCddKSB7CiAgICAgICAgICAgIGxhYmVsLnB1c2goZGF0YVsnM2QnXSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZGF0YS5ub0F1ZGlvKSB7CiAgICAgICAgICAgIGxhYmVsLnB1c2goZGF0YS5ub0F1ZGlvKTsKICAgICAgICAgIH0KICAgICAgICAgIGxhYmVsLnB1c2goZGF0YS5pdGFnKTsKICAgICAgICB9CgogICAgICAgIGxhYmVsID0gbGFiZWwuam9pbignICcpOwoKICAgICAgICBpZiAoWycxOCcsICcyMiddLmluZGV4T2YoU3RyaW5nKGRhdGEuaXRhZykpID09PSAtMSkgewogICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrJywKICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgZWM6ICd5b3V0dWJlJywKICAgICAgICAgICAgZWE6ICdkb3dubG9hZCcsCiAgICAgICAgICAgIGVsOiBsYWJlbAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgb25EbEJ0bkNsaWNrOiBmdW5jdGlvbihlLCBsaW5rLCBkZXRhaWxzKSB7CiAgICAgICAgZGV0YWlscyA9IGRldGFpbHMgfHwge307CiAgICAgICAgaWYgKCFsaW5rKSB7CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgbW9uby50cmlnZ2VyKHRoaXMucGFyZW50Tm9kZS5sYXN0Q2hpbGQsICdtb3VzZWRvd24nKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHlvdXR1YmUub25NZW51SXRlbUNsaWNrKGxpbmssIGRldGFpbHMpOwoKICAgICAgICBpZiAobGluay5xdWFsaXR5ICE9PSAndW1teScpIHsKICAgICAgICAgIGlmIChsaW5rLmZvcmNlRG93bmxvYWQpIHsKICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMuZG93bmxvYWRPbkNsaWNrKGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKCiAgICAgIHF1aWNrQnRuOiB7CiAgICAgICAgcHJlcE1lbnVMaW5rczogZnVuY3Rpb24obGlua3MsIHRpdGxlKSB7CiAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICB2YXIgbWVudUxpbmtzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rcy55b3V0dWJlKGxpbmtzLCB0aXRsZSk7CiAgICAgICAgICB2YXIgdW1teUxpbmtzID0ge307CgogICAgICAgICAgdmFyIGxpbmtMaXN0ID0gW107CiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaXRlbTsgaXRlbSA9IG1lbnVMaW5rc1tpXTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpdGVtLnF1YWxpdHkgPT09ICd1bW15JykgewogICAgICAgICAgICAgIHVtbXlMaW5rc1tpdGVtLml0YWddID0gaXRlbTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaW5rTGlzdC5wdXNoKHsKICAgICAgICAgICAgICBwcm9wOiBpdGVtCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgbWVudUxpbmtzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnNvcnRNZW51SXRlbXMobGlua0xpc3QpOwoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG1lbnVMaW5rczogbWVudUxpbmtzLAogICAgICAgICAgICB1bW15TGlua3M6IHVtbXlMaW5rcwogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICBzZXRWYWx1ZUluU2VsZWN0QnRuOiBmdW5jdGlvbihkZXRhaWxzLCB0ZXh0KSB7CiAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICBpZiAodHlwZW9mIHRleHQgIT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIHRleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBmaXJzdCA9IGRldGFpbHMuc2VsZWN0QnRuLmZpcnN0Q2hpbGQ7CiAgICAgICAgICBpZiAoZmlyc3QgPT09IGRldGFpbHMuc2VsZWN0QnRuLmxhc3RDaGlsZCkgewogICAgICAgICAgICBkZXRhaWxzLnNlbGVjdEJ0bi5pbnNlcnRCZWZvcmUodGV4dCwgZmlyc3QpCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkZXRhaWxzLnNlbGVjdEJ0bi5yZXBsYWNlQ2hpbGQodGV4dCwgZmlyc3QpOwogICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIGdldEJlc3RJdGVtOiBmdW5jdGlvbihtZW51TGlua3MpIHsKICAgICAgICAgIHZhciBzTGlzdCA9IFtdOwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGl0ZW07IGl0ZW0gPSBtZW51TGlua3NbaV07IGkrKykgewogICAgICAgICAgICBpZiAoaXRlbS5wcm9wLm5vQXVkaW8gfHwgaXRlbS5wcm9wLm5vVmlkZW8pIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXRlbS5wcm9wLmZvcm1hdCA9PT0gJ3VtbXknKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGl0ZW0ucHJvcC5leHRyYSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghaXRlbS5wcm9wLmlzSGlkZGVuKSB7CiAgICAgICAgICAgICAgc0xpc3QucHVzaChpdGVtLnByb3ApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFzTGlzdC5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBzTGlzdFswXTsKICAgICAgICB9LAoKICAgICAgICBiaW5kRGxCdG46IGZ1bmN0aW9uKGRldGFpbHMpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIHZhciBxdWlja0J0biA9IGRldGFpbHMucXVpY2tCdG47CiAgICAgICAgICBpZiAoZGV0YWlscy5xdWlja0J0bkV2ZW50KSB7CiAgICAgICAgICAgIHF1aWNrQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZGV0YWlscy5xdWlja0J0bkV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICAgIHF1aWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZGV0YWlscy5xdWlja0J0bkV2ZW50ID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICAgICAgaWYgKGRldGFpbHMubGluayAmJiB5b3V0dWJlLmN1cnJlbnRNZW51KSB7CiAgICAgICAgICAgICAgeW91dHViZS5oaWRlQ3VycmVudE1lbnUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGRsQnRuRGV0YWlscyA9IHsKICAgICAgICAgICAgICB2aWRlb0lkOiBkZXRhaWxzLnZpZGVvSWQgfHwgeW91dHViZS52aWRlb19pZAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoZGV0YWlscy5pc1BhZ2UpIHsKICAgICAgICAgICAgICBkbEJ0bkRldGFpbHMuaXNQYWdlID0gMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBkbEJ0bkRldGFpbHMuaXNGcmFtZSA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHlvdXR1YmUub25EbEJ0bkNsaWNrLmNhbGwodGhpcywgZSwgZGV0YWlscy5saW5rLCBkbEJ0bkRldGFpbHMpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgc2V0QmVzdFZhbHVlOiBmdW5jdGlvbihkZXRhaWxzLCBsaW5rKSB7CiAgICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgICB2YXIgcXVpY2tCdG4gPSBkZXRhaWxzLnF1aWNrQnRuOwoKICAgICAgICAgIGRldGFpbHMubGluayA9IGxpbms7CgogICAgICAgICAgdmFyIGJ0blRleHQgPSBsaW5rLnF1YWxpdHk7CiAgICAgICAgICBpZiAoIWxpbmsubm9WaWRlbykgewogICAgICAgICAgICBidG5UZXh0ID0gcGFyc2VJbnQoYnRuVGV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobGlua1snM2QnXSkgewogICAgICAgICAgICBidG5UZXh0ID0gJzNEICcgKyBidG5UZXh0OwogICAgICAgICAgfQogICAgICAgICAgaWYgKGxpbmsuc0ZwcykgewogICAgICAgICAgICBidG5UZXh0ICs9ICcgJyArIChsaW5rLmZwcyB8fCA2MCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRleHRDb250YWluZXIgPSBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgdGV4dDogYnRuVGV4dCwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAnNnB4JywKICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnYm90dG9tJwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoZGV0YWlscy5zZXRRdWFsaXR5KSB7CiAgICAgICAgICAgIGRldGFpbHMuc2V0UXVhbGl0eSh0ZXh0Q29udGFpbmVyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVJblNlbGVjdEJ0bihkZXRhaWxzLCB0ZXh0Q29udGFpbmVyKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdGl0bGUgPSBbbGluay5mb3JtYXQsIGJ0blRleHRdOwogICAgICAgICAgaWYgKGxpbmsubm9BdWRpbykgewogICAgICAgICAgICB0aXRsZS5wdXNoKGxhbmd1YWdlLndpdGhvdXRBdWRpbyk7CiAgICAgICAgICB9CiAgICAgICAgICB0aXRsZSA9IHRpdGxlLmpvaW4oJyAnKTsKCiAgICAgICAgICBxdWlja0J0bi50aXRsZSA9IHRpdGxlOwogICAgICAgICAgcXVpY2tCdG4uaHJlZiA9IGxpbmsuaHJlZjsKCiAgICAgICAgICBpZiAobGluay50aXRsZSAmJiBsaW5rLmZvcm1hdCkgewogICAgICAgICAgICB2YXIgZXh0ID0gbGluay5leHQ7CiAgICAgICAgICAgIGlmICghZXh0KSB7CiAgICAgICAgICAgICAgZXh0ID0gbGluay5mb3JtYXQudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBxdWlja0J0bi5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgbW9uby5maWxlTmFtZS5tb2RpZnkobGluay50aXRsZSArICcuJyArIGV4dCkpOwogICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHNldFVtbXlCYWRnZTogZnVuY3Rpb24oZGV0YWlscywgbGluaykgewogICAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgIHZhciBxdWlja0J0biA9IGRldGFpbHMucXVpY2tCdG47CgogICAgICAgICAgZGV0YWlscy5saW5rID0gbGluazsKCiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAnZ2V0VW1teUljb24nCiAgICAgICAgICB9LCBmdW5jdGlvbihkYXRhSW1nKSB7CiAgICAgICAgICAgIHZhciB1bW15SWNvbiA9IG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICB3aWR0aDogJzE2cHgnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTZweCcsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICd1cmwoJyArIGRhdGFJbWcgKyAnKScsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUmVwZWF0OiAnbm8tcmVwZWF0JywKICAgICAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAnNnB4JywKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ3RvcCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfdGhpcy5zZXRWYWx1ZUluU2VsZWN0QnRuKGRldGFpbHMsIHVtbXlJY29uKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHF1aWNrQnRuLnRpdGxlID0gbW9uby5jYXBpdGFsaXplKGxpbmsucXVhbGl0eSk7CiAgICAgICAgICBxdWlja0J0bi5ocmVmID0gbGluay5ocmVmOwoKICAgICAgICAgIHF1aWNrQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZG93bmxvYWQnKTsKICAgICAgICB9LAoKICAgICAgICBvbkdldExpbmtzOiBmdW5jdGlvbihkZXRhaWxzLCBsaW5rcywgdGl0bGUpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICBpZiAobGlua3MpIHsKICAgICAgICAgICAgdmFyIGNvdW50ID0gT2JqZWN0LmtleXMobGlua3MpLmxlbmd0aDsKICAgICAgICAgICAgaWYgKGxpbmtzLm1ldGEpIHsKICAgICAgICAgICAgICBjb3VudC0tOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWxpbmtzIHx8ICFjb3VudCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zZXRWYWx1ZUluU2VsZWN0QnRuKGRldGFpbHMsICcnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBtb25vLnN0b3JhZ2UuZ2V0KCd5dExhc3RJVGFnJywgZnVuY3Rpb24oc3RvcmFnZSkgewogICAgICAgICAgICB2YXIgbGFzdEl0YWcgPSBzdG9yYWdlLnl0TGFzdElUYWc7CiAgICAgICAgICAgIGlmIChsYXN0SXRhZyA9PT0gJ3VtbXlBdWRpbycpIHsKICAgICAgICAgICAgICBsYXN0SXRhZyA9ICd1bW15JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXRhaWxzLmxhc3RJdGFnID0gbGFzdEl0YWc7CgogICAgICAgICAgICB2YXIgbWVudUxpbmtzID0gX3RoaXMucHJlcE1lbnVMaW5rcyhsaW5rcywgdGl0bGUgfHwgeW91dHViZS5nZXRUaXRsZU1vZGlmeSgpKTsKCiAgICAgICAgICAgIGRldGFpbHMub25HZXRMaW5rc0FyciAmJiBkZXRhaWxzLm9uR2V0TGlua3NBcnIuZm9yRWFjaChmdW5jdGlvbihmbikgewogICAgICAgICAgICAgIHJldHVybiBmbihtZW51TGlua3MubWVudUxpbmtzKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAobGFzdEl0YWcgPT09ICd1bW15JyAmJiBtZW51TGlua3MudW1teUxpbmtzW2xhc3RJdGFnXSkgewogICAgICAgICAgICAgIF90aGlzLnNldFVtbXlCYWRnZShkZXRhaWxzLCBtZW51TGlua3MudW1teUxpbmtzW2xhc3RJdGFnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIGxpbmsgPSBfdGhpcy5nZXRCZXN0SXRlbShtZW51TGlua3MubWVudUxpbmtzKTsKICAgICAgICAgICAgICBpZiAobGluaykgewogICAgICAgICAgICAgICAgX3RoaXMuc2V0QmVzdFZhbHVlKGRldGFpbHMsIGxpbmspOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRWYWx1ZUluU2VsZWN0QnRuKGRldGFpbHMsICcnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgc2V0VmFsdWU6IGZ1bmN0aW9uKGRldGFpbHMpIHsKICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICB0aGlzLmJpbmREbEJ0bihkZXRhaWxzKTsKCiAgICAgICAgICB2YXIgdmlkID0gZGV0YWlscy52aWRlb0lkIHx8IHlvdXR1YmUudmlkZW9faWQ7CiAgICAgICAgICBpZiAoIXZpZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5vbkdldExpbmtzKGRldGFpbHMpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByZXNwb25zZSA9IHlvdXR1YmUucmVzcG9uc2VDYWNoZVt2aWRdOwogICAgICAgICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHRoaXMub25HZXRMaW5rcyhkZXRhaWxzLCByZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUpOwogICAgICAgICAgICByZXNwb25zZSA9IG51bGw7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb25SZXNwb25zZSA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVzcG9uc2UgfHwge307CgogICAgICAgICAgICBpZiAocmVzcG9uc2UuaXNRdWljaykgewogICAgICAgICAgICAgIGRldGFpbHMucXVpY2tCdG4uZGF0YXNldC5pc1F1aWNrID0gJzEnOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX3RoaXMub25HZXRMaW5rcyhkZXRhaWxzLCByZXNwb25zZS5saW5rcywgcmVzcG9uc2UudGl0bGUpOwogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgcmVxdWVzdCA9IHsKICAgICAgICAgICAgYWN0aW9uOiAnZ2V0WW91dHViZUxpbmtzJywKICAgICAgICAgICAgZXh0VmlkZW9JZDogdmlkLAogICAgICAgICAgICB1cmw6IGxvY2F0aW9uLmhyZWYsCiAgICAgICAgICAgIG5vRGFzaDogdHJ1ZQogICAgICAgICAgfTsKCiAgICAgICAgICBpZiAoZGV0YWlscy55dENvbmZpZykgewogICAgICAgICAgICByZXF1ZXN0LmFjdGlvbiA9ICdnZXRZb3V0dWJlTGlua3NGcm9tQ29uZmlnJzsKICAgICAgICAgICAgcmVxdWVzdC5jb25maWcgPSBkZXRhaWxzLnl0Q29uZmlnOwogICAgICAgICAgfQoKICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UocmVxdWVzdCwgb25SZXNwb25zZSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgdmlkZW9GZWVkOiB7CiAgICAgICAgc3R5bGU6IG51bGwsCiAgICAgICAgaHJlZklkUGF0dGVybjogL1tcPyZddj0oW14mXSspLywKICAgICAgICBpbWdJZFBhdHRlcm46IC92aVteXC9dKlwvKFteXC9dKykvLAogICAgICAgIHJMaXN0OiBbCiAgICAgICAgICAvXC9wbGF5bGlzdFw/LywKICAgICAgICAgIC8odXNlcnxjaGFubmVsfHNob3cpXC9bXlwvXSsoXC9mZWVkfFwvZmVhdHVyZWR8XC92aWRlb3N8JCkvaSwKICAgICAgICAgIC9cLyhmZWVkKVwvKHRyZW5kaW5nfHN1YnNjcmlwdGlvbnN8aGlzdG9yeSkvaQogICAgICAgIF0sCiAgICAgICAgdGVzdFVybDogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5yTGlzdC5zb21lKGZ1bmN0aW9uKHIpIHsKICAgICAgICAgICAgcmV0dXJuIHIudGVzdCh1cmwpOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBpbmplY3RTdHlsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5zdHlsZSkgewogICAgICAgICAgICAhdGhpcy5zdHlsZS5wYXJlbnROb2RlICYmIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnN0eWxlID0gbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgICBjbGFzczogJ3NmLWZlZWQtc3R5bGUnLAogICAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoW3sKICAgICAgICAgICAgICBzZWxlY3RvcjogWwogICAgICAgICAgICAgICAgJ2EgPiAuc2YtZmVlZC1idG4nLAogICAgICAgICAgICAgICAgJ2RpdiA+IC5zZi1mZWVkLWJ0bicsCiAgICAgICAgICAgICAgICAnc3BhbiA+IC5zZi1mZWVkLWJ0bicKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsCiAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI2QzZDNkMycsCiAgICAgICAgICAgICAgICB3aWR0aDogJzIwcHgnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAnMjBweCcsCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICByaWdodDogJzI2cHgnLAogICAgICAgICAgICAgICAgYm90dG9tOiAnMnB4JywKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzJweCcsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjNzc3Nzc3JykgKyAnKSBjZW50ZXIgbm8tcmVwZWF0ICNGOEY4RjgnLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JywKICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgc2VsZWN0b3I6IFsKICAgICAgICAgICAgICAgICdhID4gLnNmLWZlZWQtYnRuLnN0eWxlLTInCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgYm9yZGVyOiAwLAogICAgICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgICAgIG1hcmdpbjogJzRweCcsCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAnMnB4IDRweCcsCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjRkZGJykgKyAnKSBjZW50ZXIgbm8tcmVwZWF0ICMwMDAnLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxNHB4JywKICAgICAgICAgICAgICAgIG9wYWNpdHk6ICcuOCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBzZWxlY3RvcjogWwogICAgICAgICAgICAgICAgJ2EgPiAuc2YtZmVlZC1idG46aG92ZXInLAogICAgICAgICAgICAgICAgJ2RpdiA+IC5zZi1mZWVkLWJ0bjpob3ZlcicsCiAgICAgICAgICAgICAgICAnc3BhbiA+IC5zZi1mZWVkLWJ0bjpob3ZlcicKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAndXJsKCcgKyBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3JjKCdkb3dubG9hZCcsICcjMDBCNzVBJykgKyAnKSBjZW50ZXIgbm8tcmVwZWF0ICNGOEY4RjgnLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFNpemU6ICcxMnB4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIHNlbGVjdG9yOiBbCiAgICAgICAgICAgICAgICAnYSA+IC5zZi1mZWVkLWJ0bi5zdHlsZS0yOmhvdmVyJwogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGJvcmRlcjogMCwKICAgICAgICAgICAgICAgIHRvcDogMCwKICAgICAgICAgICAgICAgIGxlZnQ6IDAsCiAgICAgICAgICAgICAgICBtYXJnaW46ICc0cHgnLAogICAgICAgICAgICAgICAgcGFkZGluZzogJzJweCA0cHgnLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJ3VybCgnICsgU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnIzAwQjc1QScpICsgJykgY2VudGVyIG5vLXJlcGVhdCAjMDAwJywKICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBvcGFjaXR5OiAnLjgnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgc2VsZWN0b3I6IFsKICAgICAgICAgICAgICAgICdhID4gLnNmLWZlZWQtYnRuOmFjdGl2ZScsCiAgICAgICAgICAgICAgICAnZGl2ID4gLnNmLWZlZWQtYnRuOmFjdGl2ZScsCiAgICAgICAgICAgICAgICAnc3BhbiA+IC5zZi1mZWVkLWJ0bjphY3RpdmUnCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgb3V0bGluZTogMCwKICAgICAgICAgICAgICAgIGJveFNoYWRvdzogJ2luc2V0IDAgM3B4IDVweCByZ2JhKDAsIDAsIDAsIDAuMTI1KScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBzZWxlY3RvcjogWwogICAgICAgICAgICAgICAgJ2E6aG92ZXIgPiAuc2YtZmVlZC1idG4nLAogICAgICAgICAgICAgICAgJ2Rpdjpob3ZlciA+IC5zZi1mZWVkLWJ0bicsCiAgICAgICAgICAgICAgICAnc3Bhbjpob3ZlciA+IC5zZi1mZWVkLWJ0bicKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XSkKICAgICAgICAgIH0pOwoKICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZSk7CiAgICAgICAgfSwKICAgICAgICBybUJ0bjogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgbm9kZUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2YtZmVlZC1idG4nKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gbm9kZUxpc3RbaV07IGkrKykgewogICAgICAgICAgICBpdGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaXRlbSk7CiAgICAgICAgICB9CgogICAgICAgICAgWydzZkJ0bicsICdzZlNraXAnXS5mb3JFYWNoKGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgICAgICAgdmFyIGRhdGFBdHRyID0gbW9uby5kYXRhQXR0cjJTZWxlY3RvcihhdHRyKTsKICAgICAgICAgICAgbm9kZUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbJyArIGRhdGFBdHRyICsgJ10nKTsKICAgICAgICAgICAgZm9yIChpID0gMCwgaXRlbTsgaXRlbSA9IG5vZGVMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgICBpdGVtLnJlbW92ZUF0dHJpYnV0ZShkYXRhQXR0cik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCgogICAgICAgIGdldEJ0bk5vZGU6IGZ1bmN0aW9uKHZpZCwgc3R5bGVJbmRleCkgewogICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFsnc2YtZmVlZC1idG4nXTsKICAgICAgICAgIGlmIChzdHlsZUluZGV4KSB7CiAgICAgICAgICAgIGNsYXNzTmFtZS5wdXNoKCdzdHlsZS0nICsgc3R5bGVJbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgICAgIGNsYXNzOiBjbGFzc05hbWUsCiAgICAgICAgICAgIGFwcGVuZDogWyFtb25vLmlzT3BlcmEgPyB1bmRlZmluZWQgOiBtb25vLmNyZWF0ZSgnaW1nJywgewogICAgICAgICAgICAgIHNyYzogU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnIzc3Nzc3NycpLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICB3aWR0aDogJzEycHgnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTJweCcsCiAgICAgICAgICAgICAgICBtYXJnaW46ICc0cHgnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KV0sCiAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgICAgICBpZiAoeW91dHViZS5jdXJyZW50TWVudSAmJiB5b3V0dWJlLmN1cnJlbnRNZW51LmlzU2hvdykgewogICAgICAgICAgICAgICAgeW91dHViZS5oaWRlQ3VycmVudE1lbnUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBtZW51ID0geW91dHViZS5jdXJyZW50TWVudSA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5xdWlja0luc2VydChfdGhpcywgbGFuZ3VhZ2UuZG93bmxvYWQgKyAnIC4uLicsICdzZi1wb3B1cE1lbnUnLCB7CiAgICAgICAgICAgICAgICBvblNob3c6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBtb25vLm9uUmVtb3ZlRXZlbnQoX3RoaXMsIHlvdXR1YmUuaGlkZUN1cnJlbnRNZW51KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbkhpZGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBtb25vLm9mZlJlbW92ZUV2ZW50KF90aGlzLCB5b3V0dWJlLmhpZGVDdXJyZW50TWVudSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25JdGVtQ2xpY2s6IGZ1bmN0aW9uKGUsIG1lbnVJdGVtKSB7CiAgICAgICAgICAgICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgICAgICAgeW91dHViZS5vbk1lbnVJdGVtQ2xpY2sobWVudUl0ZW0sIHsKICAgICAgICAgICAgICAgICAgICBpc0ZlZWRJdGVtOiAxLAogICAgICAgICAgICAgICAgICAgIHZpZGVvSWQ6IHZpZAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246ICdnZXRZb3V0dWJlTGlua3MnLAogICAgICAgICAgICAgICAgZXh0VmlkZW9JZDogdmlkLAogICAgICAgICAgICAgICAgdXJsOiBsb2NhdGlvbi5ocmVmLAogICAgICAgICAgICAgICAgY2hlY2tTdWJ0aXRsZXM6IHRydWUKICAgICAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxpbmtzKSB7CiAgICAgICAgICAgICAgICAgIHZhciBtZW51TGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzLnlvdXR1YmUocmVzcG9uc2UubGlua3MsIHJlc3BvbnNlLnRpdGxlLCByZXNwb25zZS5zdWJ0aXRsZXMpOwogICAgICAgICAgICAgICAgICBtZW51LnVwZGF0ZShtZW51TGlua3MpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWVudS51cGRhdGUobGFuZ3VhZ2Uubm9MaW5rc0ZvdW5kKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKFsxXS5pbmRleE9mKHByZWZlcmVuY2UuY29ob3J0SW5kZXgpICE9PSAtMSkgewogICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrQ29ob3J0JywKICAgICAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICAgICAgZWM6ICd5b3V0dWJlJywKICAgICAgICAgICAgICAgICAgZWE6ICdjbGljaycsCiAgICAgICAgICAgICAgICAgIGVsOiAndmlkZW8tcGxheWxpc3QnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICBkb3dubG9hZFBsYXlsaXN0OiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZ2V0SWRMaXN0RnJvbVBhZ2UgPSBmdW5jdGlvbihjb250YWluZXIpIHsKICAgICAgICAgIHZhciBpZExpc3QgPSBbXTsKICAgICAgICAgIHZhciBpbWdMaXN0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tzcmNdJyk7CiAgICAgICAgICB2YXIgcGF0dGVybiA9IHlvdXR1YmUudmlkZW9GZWVkLmltZ0lkUGF0dGVybjsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBlbDsgZWwgPSBpbWdMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgdmFyIG1hdGNoZWQgPSBlbC5zcmMubWF0Y2gocGF0dGVybik7CiAgICAgICAgICAgIGlmICghbWF0Y2hlZCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpZExpc3QuaW5kZXhPZihtYXRjaGVkWzFdKSA9PT0gLTEpIHsKICAgICAgICAgICAgICBpZExpc3QucHVzaChtYXRjaGVkWzFdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkYXRhRWxMaXN0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJypbZGF0YS12aWRlby1pZF0nKTsKICAgICAgICAgIGZvciAoaSA9IDAsIGVsOyBlbCA9IGRhdGFFbExpc3RbaV07IGkrKykgewogICAgICAgICAgICB2YXIgaWQgPSBlbC5kYXRhc2V0LnZpZGVvSWQ7CiAgICAgICAgICAgIGlmIChpZExpc3QuaW5kZXhPZihpZCkgPT09IC0xKSB7CiAgICAgICAgICAgICAgaWRMaXN0LnB1c2goaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaWRMaXN0OwogICAgICAgIH07CiAgICAgICAgdmFyIGdldElkTGlua3MgPSBmdW5jdGlvbihjYikgewogICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50OwogICAgICAgICAgdmFyIHVybCA9IG1vbm8ucGFyc2VVcmwobG9jYXRpb24uaHJlZik7CiAgICAgICAgICBpZiAodXJsLmxpc3QpIHsKICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0WW91dHViZUlkTGlzdEZyb21QbGF5bGlzdCcsCiAgICAgICAgICAgICAgbGlzdElkOiB1cmwubGlzdCwKICAgICAgICAgICAgICBiYXNlVXJsOiBsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuaWRMaXN0IHx8IHJlc3BvbnNlLmlkTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIucGxheWxpc3QtdmlkZW9zLWNvbnRhaW5lciA+IC5wbGF5bGlzdC12aWRlb3MtbGlzdCIpOwogICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lciAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICByZXNwb25zZS5pZExpc3QgPSBnZXRJZExpc3RGcm9tUGFnZShjb250YWluZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS50aXRsZSkgewogICAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIucGxheWxpc3QtaW5mbyA+IC5wbGF5bGlzdC10aXRsZSIpOwogICAgICAgICAgICAgICAgICBpZiAodGl0bGUgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zZS50aXRsZSA9IHRpdGxlLnRleHRDb250ZW50LnJlcGxhY2UoL1xyP1xuL2csICIgIikudHJpbSgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNiKHJlc3BvbnNlLmlkTGlzdCwgcmVzcG9uc2UudGl0bGUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBpZExpc3QgPSBnZXRJZExpc3RGcm9tUGFnZShjb250YWluZXIpOwogICAgICAgICAgICBjYihpZExpc3QsIHlvdXR1YmUuZ2V0VGl0bGUoKSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB2YXIgZ2V0VmlkZW9MaW5rID0gZnVuY3Rpb24odmlkLCBtYXhTaXplLCB0eXBlTGlzdCwgY2IpIHsKICAgICAgICAgIHZhciB1c2VEYXNoID0gdHlwZUxpc3QuaW5kZXhPZignYXVkaW8nKSAhPT0gLTE7CiAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgYWN0aW9uOiAnZ2V0WW91dHViZUxpbmtzJywKICAgICAgICAgICAgZXh0VmlkZW9JZDogdmlkLAogICAgICAgICAgICBub0Rhc2g6IHVzZURhc2gKICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHZhciBsaW5rcyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxpbmtzKSB7CiAgICAgICAgICAgICAgbGlua3MgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucHJlcGFyZUxpbmtzLnlvdXR1YmUocmVzcG9uc2UubGlua3MsIHJlc3BvbnNlLnRpdGxlKTsKICAgICAgICAgICAgICBsaW5rcyA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5zb3J0TWVudUl0ZW1zKGxpbmtzLCB7CiAgICAgICAgICAgICAgICBub1Byb3A6IHRydWUsCiAgICAgICAgICAgICAgICBtYXhTaXplOiBtYXhTaXplLAogICAgICAgICAgICAgICAgbWluU2l6ZTogMiwKICAgICAgICAgICAgICAgIHR5cGVMaXN0OiB0eXBlTGlzdAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNiKGxpbmtzKTsKICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgdmFyIGdldFZpZGVvTGlua3MgPSBmdW5jdGlvbihpZExpc3QsIG1heFNpemUsIG9uUHJvZ3Jlc3MsIG9uUmVhZHkpIHsKICAgICAgICAgIHZhciBhYm9ydCA9IGZhbHNlOwogICAgICAgICAgdmFyIGxpbmtMaXN0ID0ge307CiAgICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgICAgdmFyIGluUHJvZ3Jlc3MgPSAwOwogICAgICAgICAgdmFyIGxpc3RMZW4gPSBpZExpc3QubGVuZ3RoOwoKICAgICAgICAgIHZhciB0eXBlTGlzdCA9IHVuZGVmaW5lZDsKICAgICAgICAgIGlmIChtYXhTaXplID09PSAnYXVkaW8nKSB7CiAgICAgICAgICAgIHR5cGVMaXN0ID0gWydhdWRpbyddOwogICAgICAgICAgICBtYXhTaXplID0gdW5kZWZpbmVkOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdHlwZUxpc3QgPSBbJ3ZpZGVvJ107CiAgICAgICAgICAgIG1heFNpemUgPSBwYXJzZUludChtYXhTaXplKSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGdldE5leHRPbmVJZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoYWJvcnQpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGlkID0gaWRMaXN0W2luZGV4XTsKICAgICAgICAgICAgaWYgKGlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBpZiAoaW5Qcm9ncmVzcyA9PT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9uUmVhZHkobGlua0xpc3QpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgIGluUHJvZ3Jlc3MrKzsKICAgICAgICAgICAgZ2V0VmlkZW9MaW5rKGlkLCBtYXhTaXplLCB0eXBlTGlzdCwgZnVuY3Rpb24obGlua3MpIHsKICAgICAgICAgICAgICB2YXIgZmlyc3RMaW5rID0gbGlua3MgPyBsaW5rc1swXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICBpZiAoZmlyc3RMaW5rKSB7CiAgICAgICAgICAgICAgICB2YXIgZXh0ID0gZmlyc3RMaW5rLmV4dDsKICAgICAgICAgICAgICAgIGlmICghZXh0KSB7CiAgICAgICAgICAgICAgICAgIGV4dCA9IGZpcnN0TGluay5mb3JtYXQudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBtb25vLmZpbGVOYW1lLm1vZGlmeShmaXJzdExpbmsudGl0bGUgKyAnLicgKyBleHQpOwogICAgICAgICAgICAgICAgbGlua0xpc3RbaWRdID0gewogICAgICAgICAgICAgICAgICB1cmw6IGZpcnN0TGluay5ocmVmLAogICAgICAgICAgICAgICAgICB0aXRsZTogZmlyc3RMaW5rLnRpdGxlLAogICAgICAgICAgICAgICAgICBmaWxlbmFtZTogZmlsZW5hbWUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG9uUHJvZ3Jlc3MoaW5kZXgsIGxpc3RMZW4pOwogICAgICAgICAgICAgIGluUHJvZ3Jlc3MtLTsKICAgICAgICAgICAgICBnZXROZXh0T25lSWQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgZ2V0TmV4dE9uZUlkKCk7CiAgICAgICAgICBnZXROZXh0T25lSWQoKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGFib3J0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBhYm9ydCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHZhciBnZXRQb3B1cCA9IGZ1bmN0aW9uKG9uQ2xvc2UpIHsKICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IFNhdmVGcm9tX1V0aWxzLnBsYXlsaXN0LmdldEluZm9Qb3B1cFRlbXBsYXRlKCk7CiAgICAgICAgICB2YXIgcHJvZ3Jlc3NFbDsKICAgICAgICAgIHZhciBxdWFsaXR5U2VsZWN0Qm94OwogICAgICAgICAgdmFyIHF1YWxpdHlTZWxlY3Q7CgogICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgIGFjdGlvbjogJ2dldFdhcm5pbmdJY29uJywKICAgICAgICAgICAgdHlwZTogJ3BsYXlsaXN0JywKICAgICAgICAgICAgY29sb3I6ICcjNzdEMUZBJwogICAgICAgICAgfSwgZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgICB0ZW1wbGF0ZS5pY29uLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoJyArIGljb24gKyAnKSc7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBtb25vLmNyZWF0ZSh0ZW1wbGF0ZS50ZXh0Q29udGFpbmVyLCB7CiAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UucGxheWxpc3QsCiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBjb2xvcjogJyMwRDBEMEQnLAogICAgICAgICAgICAgICAgICBmb250U2l6ZTogJzIwcHgnLAogICAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICcxMXB4JywKICAgICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAnMTNweCcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBxdWFsaXR5U2VsZWN0Qm94ID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0OiBsYW5ndWFnZS5xdWFsaXR5ICsgIjoiLAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyMwMDAwMDAnLAogICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzEzcHgnLAogICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzI0cHgnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICAgIHF1YWxpdHlTZWxlY3QgPSBtb25vLmNyZWF0ZSgnc2VsZWN0JywgewogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnNzVweCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJzVweCcKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ29wdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICc3MjAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICc3MjAnCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ29wdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICc0ODAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICc0ODAnCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ29wdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICczNjAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICczNjAnCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ29wdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICcyNDAnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICcyNDAnCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ29wdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdBdWRpbycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ2F1ZGlvJwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3AnLCB7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UucXVhbGl0eU5vdGUsCiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzg2ODY4NicsCiAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogJzE0cHgnLAogICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzI0cHgnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIHByb2dyZXNzRWwgPSBtb25vLmNyZWF0ZSgncCcsIHsKICAgICAgICAgICAgICAgIHRleHQ6ICcnLAogICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgY29sb3I6ICcjODY4Njg2JywKICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICcxNHB4JywKICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzI0cHgnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgXQogICAgICAgICAgfSk7CgogICAgICAgICAgdmFyIGNvbnRpbnVlQnRuLCBjYW5jZWxCdG47CiAgICAgICAgICBtb25vLmNyZWF0ZSh0ZW1wbGF0ZS5idXR0b25Db250YWluZXIsIHsKICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgY2FuY2VsQnRuID0gbW9uby5jcmVhdGUoJ2J1dHRvbicsIHsKICAgICAgICAgICAgICAgIHRleHQ6IGxhbmd1YWdlLmNhbmNlbCwKICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgIGhlaWdodDogJzI3cHgnLAogICAgICAgICAgICAgICAgICB3aWR0aDogJzExOHB4JywKICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZmZmZicsCiAgICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjOWU5ZTllJywKICAgICAgICAgICAgICAgICAgbWFyZ2luOiAnMTJweCcsCiAgICAgICAgICAgICAgICAgIG1hcmdpbkJvdHRvbTogJzExcHgnLAogICAgICAgICAgICAgICAgICBtYXJnaW5SaWdodDogJzRweCcsCiAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzVweCcsCiAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgY29udGludWVCdG4gPSBtb25vLmNyZWF0ZSgnYnV0dG9uJywgewogICAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2UuY29udGludWUsCiAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyN3B4JywKICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxMThweCcsCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLAogICAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgIzllOWU5ZScsCiAgICAgICAgICAgICAgICAgIG1hcmdpbjogJzEycHgnLAogICAgICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206ICcxMXB4JywKICAgICAgICAgICAgICAgICAgbWFyZ2luUmlnaHQ6ICc4cHgnLAogICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc1cHgnLAogICAgICAgICAgICAgICAgICBmb250U2l6ZTogJzE0cHgnLAogICAgICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIF0KICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBwb3B1cEVsID0gU2F2ZUZyb21fVXRpbHMucG9wdXBEaXYodGVtcGxhdGUuYm9keSwgJ3BsX3Byb2dyZXNzX3BvcHVwJywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIG9uQ2xvc2UpOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcXVhbGl0eVNlbGVjdDogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgICAgICBwcm9ncmVzc0VsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgdGVtcGxhdGUuYnV0dG9uQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgIHF1YWxpdHlTZWxlY3RCb3guc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgY29udGludWVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGNiKHF1YWxpdHlTZWxlY3QudmFsdWUpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgbW9uby50cmlnZ2VyKHBvcHVwRWwsICdraWxsJyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uUHJlcGFyZTogZnVuY3Rpb24odGV4dCkgewogICAgICAgICAgICAgIHByb2dyZXNzRWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgdGVtcGxhdGUuYnV0dG9uQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgcXVhbGl0eVNlbGVjdEJveC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgIHByb2dyZXNzRWwudGV4dENvbnRlbnQgPSB0ZXh0OwogICAgICAgICAgICB9LAogICAgICAgICAgICBvblByb2dyZXNzOiBmdW5jdGlvbihjb3VudCwgbWF4KSB7CiAgICAgICAgICAgICAgcHJvZ3Jlc3NFbC50ZXh0Q29udGVudCA9IGxhbmd1YWdlLnZrRm91bmRGaWxlcy5yZXBsYWNlKCclZCcsIGNvdW50KSArICcgJyArIGxhbmd1YWdlLnZrRm91bmRPZiArICcgJyArIG1heDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25SZWFkeTogZnVuY3Rpb24obGlzdCwgdGl0bGUpIHsKICAgICAgICAgICAgICBtb25vLnRyaWdnZXIocG9wdXBFbCwgJ2tpbGwnKTsKICAgICAgICAgICAgICBpZiAoYWxsb3dEb3dubG9hZE1vZGUpIHsKICAgICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmRvd25sb2FkTGlzdC5zaG93QmVmb3JlRG93bmxvYWRQb3B1cChsaXN0LCB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICdwbGF5bGlzdCcsCiAgICAgICAgICAgICAgICAgIGZvbGRlck5hbWU6IHRpdGxlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU2F2ZUZyb21fVXRpbHMucGxheWxpc3QucG9wdXBQbGF5bGlzdChsaXN0LCB0aXRsZSwgdHJ1ZSwgdW5kZWZpbmVkLCAndmlkZW8nKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uKHRleHQpIHsKICAgICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dldFdhcm5pbmdJY29uJywKICAgICAgICAgICAgICAgIHR5cGU6ICdwbGF5bGlzdCcsCiAgICAgICAgICAgICAgICBjb2xvcjogJyNBQUFBQUEnCiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oaWNvbikgewogICAgICAgICAgICAgICAgdGVtcGxhdGUuaWNvbi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSAndXJsKCcgKyBpY29uICsgJyknOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBwcm9ncmVzc0VsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgIHRlbXBsYXRlLmJ1dHRvbkNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgIHF1YWxpdHlTZWxlY3RCb3guc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICBwcm9ncmVzc0VsLnRleHRDb250ZW50ID0gdGV4dDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGFib3J0ID0gZmFsc2U7CiAgICAgICAgICB2YXIgZ2V0dGluZ0xpbmsgPSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgcG9wdXAgPSBnZXRQb3B1cChmdW5jdGlvbiBvbkNsb3NlKCkgewogICAgICAgICAgICBhYm9ydCA9IHRydWU7CiAgICAgICAgICAgIGlmIChnZXR0aW5nTGluaykgewogICAgICAgICAgICAgIGdldHRpbmdMaW5rLmFib3J0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcG9wdXAucXVhbGl0eVNlbGVjdChmdW5jdGlvbihtYXhTaXplKSB7CiAgICAgICAgICAgIHBvcHVwLm9uUHJlcGFyZShsYW5ndWFnZS5kb3dubG9hZCArICcgLi4uJyk7CiAgICAgICAgICAgIGdldElkTGlua3MoZnVuY3Rpb24oaWRMaXN0LCB0aXRsZSkgewogICAgICAgICAgICAgIGlmIChhYm9ydCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoIWlkTGlzdCB8fCBpZExpc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBwb3B1cC5vbkVycm9yKGxhbmd1YWdlLm5vTGlua3NGb3VuZCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBnZXR0aW5nTGluayA9IGdldFZpZGVvTGlua3MoaWRMaXN0LCBtYXhTaXplLCBwb3B1cC5vblByb2dyZXNzLCBmdW5jdGlvbiBvblJlYWR5KGxpbmtMaXN0KSB7CiAgICAgICAgICAgICAgICB2YXIgbGlua3MgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGlkIGluIGxpbmtMaXN0KSB7CiAgICAgICAgICAgICAgICAgIGxpbmtzLnB1c2gobGlua0xpc3RbaWRdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgZm9sZGVyTmFtZSA9IG1vbm8uZmlsZU5hbWUubW9kaWZ5KHRpdGxlKTsKICAgICAgICAgICAgICAgIHBvcHVwLm9uUmVhZHkobGlua3MsIGZvbGRlck5hbWUpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKFsxXS5pbmRleE9mKHByZWZlcmVuY2UuY29ob3J0SW5kZXgpICE9PSAtMSkgewogICAgICAgICAgICBtb25vLnNlbmRNZXNzYWdlKHsKICAgICAgICAgICAgICBhY3Rpb246ICd0cmFja0NvaG9ydCcsCiAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICBlYzogJ3lvdXR1YmUnLAogICAgICAgICAgICAgIGVhOiAnY2xpY2snLAogICAgICAgICAgICAgIGVsOiAndmlkZW8tbWVudScKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KCkKICAgIH07CgogICAgeW91dHViZS50dXRvcmlhbCA9IHsKICAgICAgc2hvdzogZnVuY3Rpb24oZGV0YWlscykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBpZiAoIVNhdmVGcm9tX1V0aWxzLlR1dG9yaWFsVG9vbHRpcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5oaWRlKCk7CgogICAgICAgIGlmICghcHJlZmVyZW5jZS5zaG93VHV0b3JpYWwpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtb25vLnN0b3JhZ2UuZ2V0KCdvbmNlWXRUdXRvcmlhbFRvb2x0aXAnLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgICBpZiAoc3RvcmFnZS5vbmNlWXRUdXRvcmlhbFRvb2x0aXApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgc3RvcmFnZS5vbmNlWXRUdXRvcmlhbFRvb2x0aXAgPSAxOwoKICAgICAgICAgIGRldGFpbHMub25DbG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBtb25vLnN0b3JhZ2Uuc2V0KHN0b3JhZ2UpOwoKICAgICAgICAgICAgYXR0cldhdGNoZXIgJiYgYXR0cldhdGNoZXIuc3RvcCgpOwogICAgICAgICAgfTsKCiAgICAgICAgICB5b3V0dWJlLmN1cnJlbnRUdXRvcmlhbCA9IG5ldyBTYXZlRnJvbV9VdGlscy5UdXRvcmlhbFRvb2x0aXAoZGV0YWlscyk7CgogICAgICAgICAgdmFyIGF0dHJXYXRjaGVyID0gbnVsbDsKICAgICAgICAgIHZhciBwYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BhZ2Uud2F0Y2gnKTsKICAgICAgICAgIGlmIChwYWdlKSB7CiAgICAgICAgICAgIGF0dHJXYXRjaGVyID0geW91dHViZS5jdXJyZW50VHV0b3JpYWwuYXR0cldhdGNoZXIgPSBTYXZlRnJvbV9VdGlscy5tdXRhdGlvbkF0dHJXYXRjaGVyLnJ1bih7CiAgICAgICAgICAgICAgYXR0cjogJ2NsYXNzJywKICAgICAgICAgICAgICB0YXJnZXQ6IHBhZ2UsCiAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRUdXRvcmlhbCA9IHlvdXR1YmUuY3VycmVudFR1dG9yaWFsOwogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRUdXRvcmlhbCAmJiBjdXJyZW50VHV0b3JpYWwudG9vbHRpcE5vZGUucGFyZW50Tm9kZSkgewogICAgICAgICAgICAgICAgICBjdXJyZW50VHV0b3JpYWwub25SZXNpemUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGF0dHJXYXRjaGVyLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LAogICAgICBoaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgY3VycmVudFR1dG9yaWFsID0geW91dHViZS5jdXJyZW50VHV0b3JpYWw7CiAgICAgICAgaWYgKGN1cnJlbnRUdXRvcmlhbCkgewogICAgICAgICAgY3VycmVudFR1dG9yaWFsLm9uQ2xvc2UgJiYgY3VycmVudFR1dG9yaWFsLm9uQ2xvc2UoMSk7CiAgICAgICAgICBpZiAoY3VycmVudFR1dG9yaWFsLmF0dHJXYXRjaGVyKSB7CiAgICAgICAgICAgIGN1cnJlbnRUdXRvcmlhbC5hdHRyV2F0Y2hlci5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgICB5b3V0dWJlLmN1cnJlbnRUdXRvcmlhbCA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHZhciBtb2RpZnlUaXRsZSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgdCA9IHQucmVwbGFjZSgvW1x4MkZceDVDXHgzQVx4N0NdL2csICctJyk7CiAgICAgIHQgPSB0LnJlcGxhY2UoL1tceDJBXHgzRl0vZywgJycpOwogICAgICB0ID0gdC5yZXBsYWNlKC9ceDIyL2csICdcJycpOwogICAgICB0ID0gdC5yZXBsYWNlKC9ceDNDL2csICcoJyk7CiAgICAgIHQgPSB0LnJlcGxhY2UoL1x4M0UvZywgJyknKTsKICAgICAgdCA9IHQucmVwbGFjZSgvKD86XlxzKyl8KD86XHMrJCkvZywgJycpOwogICAgICByZXR1cm4gdDsKICAgIH07CgogICAgdmFyIGdldFBsYXllckNvbmZpZyA9IGZ1bmN0aW9uKGNiKSB7CiAgICAgIHJldHVybiBTYXZlRnJvbV9VdGlscy5icmlkZ2UoewogICAgICAgIGZ1bmM6IGZ1bmN0aW9uKGNiKSB7CiAgICAgICAgICB2YXIgeXRQbGF5ZXJDb25maWcgPSB3aW5kb3cueXRwbGF5ZXIgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZzsKICAgICAgICAgIGlmICgheXRQbGF5ZXJDb25maWcpIHsKICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICB9CiAgICAgICAgICBjYih7CiAgICAgICAgICAgIGFyZ3M6IHl0UGxheWVyQ29uZmlnLmFyZ3MsCiAgICAgICAgICAgIHN0czogeXRQbGF5ZXJDb25maWcuc3RzLAogICAgICAgICAgICBhc3NldHM6IHl0UGxheWVyQ29uZmlnLmFzc2V0cwogICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIHRpbWVvdXQ6IDMwMCwKICAgICAgICBjYjogZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmFyZ3MgfHwgIWRhdGEuYXJncy52aWRlb19pZCkgewogICAgICAgICAgICB2YXIgbWV0YVZpZGVvSWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd2F0Y2g3LWNvbnRlbnQgbWV0YVtpdGVtcHJvcD0idmlkZW9JZCJdJyk7CiAgICAgICAgICAgIHZhciB2aWRlb0lkID0gbWV0YVZpZGVvSWQgJiYgbWV0YVZpZGVvSWQuZ2V0QXR0cmlidXRlKCdjb250ZW50Jyk7CiAgICAgICAgICAgIGlmICh2aWRlb0lkKSB7CiAgICAgICAgICAgICAgZGF0YSA9IGRhdGEgfHwge307CiAgICAgICAgICAgICAgZGF0YS5hcmdzID0gZGF0YS5hcmdzIHx8IHt9OwogICAgICAgICAgICAgIGRhdGEuYXJncy52aWRlb19pZCA9IHZpZGVvSWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBjYihkYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgZ2V0TmV3UGxheWVyQ29uZmlnID0gZnVuY3Rpb24oY2IpIHsKICAgICAgcmV0dXJuIFNhdmVGcm9tX1V0aWxzLmJyaWRnZSh7CiAgICAgICAgZnVuYzogZnVuY3Rpb24oY2IpIHsKICAgICAgICAgIHZhciBwbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW92aWVfcGxheWVyJyk7CgogICAgICAgICAgaWYgKCFwbGF5ZXIgfHwgIXBsYXllci5nZXRWaWRlb0RhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIGNiKCk7CiAgICAgICAgICB9CgogICAgICAgICAgKGZ1bmN0aW9uKGZuKSB7CiAgICAgICAgICAgIGlmIChmbiAmJiAhZm4uc2ZfYXBwbHkpIHsKICAgICAgICAgICAgICBmbi5zZl9hcHBseSA9IGZuLmFwcGx5OwogICAgICAgICAgICAgIGZuLmFwcGx5ID0gZnVuY3Rpb24oc2VsZiwgYXJncykgewogICAgICAgICAgICAgICAgdmFyIHBsYXllckFyZ3MgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgaWYgKHBsYXllckFyZ3MgJiYgcGxheWVyQXJncy52aWRlb19pZCkgewogICAgICAgICAgICAgICAgICB2YXIgdmFycyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocGxheWVyQXJncykpOwogICAgICAgICAgICAgICAgICBwbGF5ZXIuZ2V0U2ZQbGF5ZXJWYXJzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhcnM7CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZm4uc2ZfYXBwbHkoc2VsZiwgYXJncyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KShwbGF5ZXIubG9hZFZpZGVvQnlQbGF5ZXJWYXJzKTsKCgogICAgICAgICAgdmFyIHl0Q29uZmlnID0gd2luZG93Lnl0cGxheWVyICYmIHdpbmRvdy55dHBsYXllci5jb25maWc7CiAgICAgICAgICB2YXIgc3RzID0geXRDb25maWcgJiYgeXRDb25maWcuc3RzOwogICAgICAgICAgdmFyIGFzc2V0cyA9IHl0Q29uZmlnICYmIHl0Q29uZmlnLmFzc2V0czsKICAgICAgICAgIHZhciBhcmdzID0geXRDb25maWcgJiYgeXRDb25maWcuYXJnczsKICAgICAgICAgIHZhciB2aWRlb0RhdGEgPSBwbGF5ZXIuZ2V0VmlkZW9EYXRhKCkgfHwge307CiAgICAgICAgICB2YXIgc2ZDb25maWcgPSBwbGF5ZXIuZ2V0U2ZQbGF5ZXJWYXJzICYmIHBsYXllci5nZXRTZlBsYXllclZhcnMoKTsKCiAgICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgICBjb25maWc6IHsKICAgICAgICAgICAgICBzdHM6IHN0cywKICAgICAgICAgICAgICBhc3NldHM6IGFzc2V0cwogICAgICAgICAgICB9LAogICAgICAgICAgICB2aWRlb19pZDogdmlkZW9EYXRhLnZpZGVvX2lkLAogICAgICAgICAgICBzZkNvbmZpZzogc2ZDb25maWcsCiAgICAgICAgICAgIHl0Q29uZmlnOiBhcmdzCiAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgdGltZW91dDogMzAwLAogICAgICAgIGNiOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEuY29uZmlnLmFzc2V0cykgewogICAgICAgICAgICByZXR1cm4gY2IobnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHl0Q29uZmlnID0gZGF0YS55dENvbmZpZyB8fCB7fTsKICAgICAgICAgIHZhciBzZkNvbmZpZyA9IGRhdGEuc2ZDb25maWcgfHwge307CiAgICAgICAgICB2YXIgY29uZmlnID0gZGF0YS5jb25maWcgfHwge307CiAgICAgICAgICB2YXIgdmlkZW9faWQgPSBkYXRhLnZpZGVvX2lkOwoKICAgICAgICAgIGlmICghdmlkZW9faWQpIHsKICAgICAgICAgICAgdmlkZW9faWQgPSB5b3V0dWJlLmdldElkRnJvbUxvY2F0aW9uKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHNmQ29uZmlnLnZpZGVvX2lkICYmICghdmlkZW9faWQgfHwgdmlkZW9faWQgPT09IHNmQ29uZmlnLnZpZGVvX2lkKSkgewogICAgICAgICAgICBjb25maWcuYXJncyA9IHNmQ29uZmlnOwogICAgICAgICAgICBjYihjb25maWcpOwogICAgICAgICAgfSBlbHNlCiAgICAgICAgICBpZiAoeXRDb25maWcudmlkZW9faWQgJiYgdmlkZW9faWQgPT09IHl0Q29uZmlnLnZpZGVvX2lkKSB7CiAgICAgICAgICAgIGNvbmZpZy5hcmdzID0geXRDb25maWc7CiAgICAgICAgICAgIGNiKGNvbmZpZyk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgIGlmICh2aWRlb19pZCkgewogICAgICAgICAgICBjYih7CiAgICAgICAgICAgICAgYXJnczogewogICAgICAgICAgICAgICAgdmlkZW9faWQ6IHZpZGVvX2lkCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNiKG51bGwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIHZhciB5dFVtbXlCdG4gPSBmdW5jdGlvbihsYW5ndWFnZSwgcHJlZmVyZW5jZXMsIHZpZGVvSWQpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB5dFVtbXlCdG4ucm1CdG4oKTsKCiAgICAgIGlmICghcHJlZmVyZW5jZXMuc2hvd1VtbXlJdGVtKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIXByZWZlcmVuY2VzLnNob3dVbW15QnRuKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdXJsID0gJ3VtbXk6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0nICsgdmlkZW9JZDsKICAgICAgdmFyIHZpZCA9IDEzMDsKCiAgICAgIHZhciB0ZXh0Tm9kZSA9IG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgIGNsYXNzOiAnc2YtYnRuLW5hbWUnLAogICAgICAgIHRleHQ6IGxhbmd1YWdlLmRvd25sb2FkICsgJyAnCiAgICAgIH0pOwogICAgICB2YXIgcXVhbGl0eU5vZGUgPSBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICB0ZXh0OiAnSEQnCiAgICAgIH0pOwoKICAgICAgdmFyIHVtbXlMb2dvID0gbW9uby5jcmVhdGUoJ2knLCB7CiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICBsZWZ0OiAnNnB4JywKICAgICAgICAgIHRvcDogJzNweCcsCiAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJzE2cHgnLAogICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJ25vLXJlcGVhdCcsCiAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246ICdjZW50ZXInLAogICAgICAgICAgd2lkdGg6ICcxNnB4JywKICAgICAgICAgIGhlaWdodDogJzE2cHgnCiAgICAgICAgfQogICAgICB9KTsKICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgYWN0aW9uOiAnZ2V0VW1teUljb24nCiAgICAgIH0sIGZ1bmN0aW9uKGRhdGFJbWcpIHsKICAgICAgICB1bW15TG9nby5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSAndXJsKCcgKyBkYXRhSW1nICsgJyknOwogICAgICB9KTsKICAgICAgdmFyIGJ0biA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgaWQ6IHl0VW1teUJ0bi5pZCwKICAgICAgICBzdHlsZTogewogICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICBtYXJnaW5MZWZ0OiAnMTBweCcsCiAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJwogICAgICAgIH0sCiAgICAgICAgb246IFsnY2hhbmdlVmFsdWUnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBKU09OLnBhcnNlKGUuZGV0YWlsKTsKICAgICAgICAgIHZhciBuZXdRdWFsaXR5Tm9kZSA9IG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICB0ZXh0OiB2YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgICBxdWFsaXR5Tm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdRdWFsaXR5Tm9kZSwgcXVhbGl0eU5vZGUpOwogICAgICAgICAgcXVhbGl0eU5vZGUgPSBuZXdRdWFsaXR5Tm9kZTsKICAgICAgICB9XSwKICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICBjbGFzczogJ3NmLXF1aWNrLWRsLWJ0bicsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgZm9udFNpemU6ICdpbmhlcml0JywKICAgICAgICAgICAgICBoZWlnaHQ6ICcyMnB4JywKICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI0NDQ0NDQycsCiAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnM3B4JywKICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6ICc4cHgnLAogICAgICAgICAgICAgIHBhZGRpbmdMZWZ0OiAnMjhweCcsCiAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsCiAgICAgICAgICAgICAgbGluZUhlaWdodDogJzIycHgnLAogICAgICAgICAgICAgIHRleHREZWNvcmF0aW9uOiAnbm9uZScsCiAgICAgICAgICAgICAgekluZGV4OiAxLAogICAgICAgICAgICAgIGNvbG9yOiAnIzU3NTc1NycKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaHJlZjogdXJsLAogICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICB1bW15TG9nbywKICAgICAgICAgICAgICB0ZXh0Tm9kZSwKICAgICAgICAgICAgICBxdWFsaXR5Tm9kZQogICAgICAgICAgICBdLAogICAgICAgICAgICBvbjogWydjbGljaycsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGlmICgvXnVtbXkvLnRlc3QodGhpcy5ocmVmKSkgewogICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3RyYWNrJywKICAgICAgICAgICAgICAgICAgdDogJ2V2ZW50JywKICAgICAgICAgICAgICAgICAgZWM6ICd5b3V0dWJlJywKICAgICAgICAgICAgICAgICAgZWE6ICdkb3dubG9hZCcsCiAgICAgICAgICAgICAgICAgIGVsOiAndW1teSBoZCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0KICAgICAgICAgIH0pLAogICAgICAgICAgbW9uby5jcmVhdGUoJ3N0eWxlJywgewogICAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoW3sKICAgICAgICAgICAgICBzZWxlY3RvcjogJyMnICsgeXRVbW15QnRuLmlkLAogICAgICAgICAgICAgIGFwcGVuZDogW3sKICAgICAgICAgICAgICAgICcuc2YtcXVpY2stZGwtYnRuJzogewogICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjRjhGOEY4JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICcuc2YtcXVpY2stZGwtYnRuOmhvdmVyJzogewogICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjRURFREVEJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICcuc2YtcXVpY2stZGwtYnRuOmFjdGl2ZSc6IHsKICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI0Y4RjhGOCcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBtZWRpYTogJ0BtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDEyOTNweCknLAogICAgICAgICAgICAgICAgYXBwZW5kOiB7CiAgICAgICAgICAgICAgICAgICcuc2YtcXVpY2stZGwtYnRuIC5zZi1idG4tbmFtZSc6IHsKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH1dKQogICAgICAgICAgfSkKICAgICAgICBdCiAgICAgIH0pOwogICAgICB5dFVtbXlEaXJlY3QuYmluZFVtbXlCdG4oYnRuLCB7CiAgICAgICAgdmlkZW86ICd5dC0nICsgdmlkZW9JZCwKICAgICAgICB2aWQ6IHZpZAogICAgICB9KTsKCiAgICAgIHJldHVybiBidG47CiAgICB9OwogICAgeXRVbW15QnRuLmlkID0gJ3NmLXVtbXktYnRuJzsKICAgIHl0VW1teUJ0bi5ybUJ0biA9IGZ1bmN0aW9uKCkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBidG5MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnIycgKyB5dFVtbXlCdG4uaWQpOwogICAgICBmb3IgKHZhciBpID0gMCwgZWw7IGVsID0gYnRuTGlzdFtpXTsgaSsrKSB7CiAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7CiAgICAgIH0KICAgIH07CgogICAgdmFyIHl0VW1teURpcmVjdCA9IHsKICAgICAgY3JlYXRlSW5mb1BvcHVwOiBmdW5jdGlvbih5ZXNVcmwsIG5vVXJsKSB7CiAgICAgICAgInVzZSBzdHJpY3QiOwogICAgICAgIHZhciBsYW5ndWFnZSA9IG1vbm8uZ2xvYmFsLmxhbmd1YWdlOwoKICAgICAgICB2YXIgaW5mbzsKICAgICAgICB2YXIgaW5mb0NvbnRhaW5lciA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICBjbGFzczogJ3NmLXVtbXktaW5mby1jb25maXJtLXBvcHVwLWNvbnRhaW5lcicsCiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgekluZGV4OiA5OTk5CiAgICAgICAgICB9LAogICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzhweCBzb2xpZCB0cmFuc3BhcmVudCcsCiAgICAgICAgICAgICAgICBib3JkZXJSaWdodDogJzEwcHggc29saWQgcmdiKDE5MiwgMTg3LCAxODcpJywKICAgICAgICAgICAgICAgIGJvcmRlckxlZnQ6IDAsCiAgICAgICAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgICAgICAgIHRvcDogJzhweCcsCiAgICAgICAgICAgICAgICBsZWZ0OiAnMTFweCcsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzhweCBzb2xpZCB0cmFuc3BhcmVudCcsCiAgICAgICAgICAgICAgICBib3JkZXJSaWdodDogJzEwcHggc29saWQgI2ZmZicsCiAgICAgICAgICAgICAgICBib3JkZXJMZWZ0OiAwLAogICAgICAgICAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgICAgICAgICB0b3A6ICc4cHgnLAogICAgICAgICAgICAgICAgbGVmdDogJzEycHgnLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBpbmZvID0gbW9uby5jcmVhdGUoJ2RpdicsIHsKICAgICAgICAgICAgICBjbGFzczogJ3NmLXVtbXktY29uZmlybS1pbmZvLXBvcHVwJywKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZicsCiAgICAgICAgICAgICAgICBib3JkZXI6ICcxcHggc29saWQgI2NjYycsCiAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiAnMjFweCcsCiAgICAgICAgICAgICAgICBwYWRkaW5nOiAnNnB4IDVweCcsCiAgICAgICAgICAgICAgICB0ZXh0QWxpZ246ICdjZW50ZXInLAogICAgICAgICAgICAgICAgbWF4V2lkdGg6ICcyNDBweCcsCiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAnMTZweCcsCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJzEycHgnLAogICAgICAgICAgICAgICAgZm9udEZhbWlseTogJ2FyaWFsLCBzYW5zLXNlcmlmJywKICAgICAgICAgICAgICAgIGN1cnNvcjogJ2RlZmF1bHQnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgICAgICBhcHBlbmQ6IG1vbm8ucGFyc2VUZW1wbGF0ZShsYW5ndWFnZS51bW15VG9vbHRpcENvbmZpcm0pLAogICAgICAgICAgICAgICAgICBvbkNyZWF0ZTogZnVuY3Rpb24oZWwpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gZWwucXVlcnlTZWxlY3RvcignaW1nJyk7CiAgICAgICAgICAgICAgICAgICAgaW1nLnN0eWxlLnZlcnRpY2FsQWxpZ24gPSAndGV4dC1ib3R0b20nOwogICAgICAgICAgICAgICAgICAgIG1vbm8uc2VuZE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0VW1teUljb24nCiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZGF0YUltZykgewogICAgICAgICAgICAgICAgICAgICAgaW1nLnNyYyA9IGRhdGFJbWc7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3AnLCB7CiAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgdGV4dEFsaWduOiAncmlnaHQnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZi1idG4nLAogICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3NzRmxvYXQ6ICdsZWZ0JwogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGxhbmd1YWdlLnllcywKICAgICAgICAgICAgICAgICAgICAgIGhyZWY6IHllc1VybCwKICAgICAgICAgICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1vbm8uc3RvcmFnZS5nZXQoJ29uY2VVbW15TGFuZGluZ0hpZGUnLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0b3JhZ2Uub25jZVVtbXlMYW5kaW5nSGlkZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yYWdlLm9uY2VVbW15TGFuZGluZ0hpZGUgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbm8uc3RvcmFnZS5zZXQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNlVW1teUxhbmRpbmdIaWRlOiArK3N0b3JhZ2Uub25jZVVtbXlMYW5kaW5nSGlkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb0NvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGluZm9Db250YWluZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb0NvbnRhaW5lci5kYXRhc2V0LmhpZGUgPSAnMSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDI1MCk7CiAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdhJywgewogICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZi1idG4nLAogICAgICAgICAgICAgICAgICAgICAgdGV4dDogbGFuZ3VhZ2Uubm8sCiAgICAgICAgICAgICAgICAgICAgICBocmVmOiBub1VybCwKICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogJ19ibGFuaycKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdwJywgewogICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnbGFiZWwnLCB7CiAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2lucHV0JywgewogICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgb246IFsnY2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb25vLnN0b3JhZ2Uuc2V0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jZVVtbXlMYW5kaW5nSGlkZTogMwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb0NvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGluZm9Db250YWluZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb0NvbnRhaW5lci5kYXRhc2V0LmhpZGUgPSAnMSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGxhbmd1YWdlLnRvb2x0aXBIaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dCh7CiAgICAgICAgICAgICAgICAgICAgJy5zZi11bW15LWNvbmZpcm0taW5mby1wb3B1cCA+IHAnOiB7CiAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46ICc1cHggMCcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICcuc2YtdW1teS1jb25maXJtLWluZm8tcG9wdXAgbGFiZWwgPiAqJzogewogICAgICAgICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICcuc2YtdW1teS1jb25maXJtLWluZm8tcG9wdXAgLnNmLWJ0bic6IHsKICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6ICdpbmhlcml0JywKICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogJzIycHgnLAogICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkIHJnYigyMDQsIDIwNCwgMjA0KScsCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICczcHgnLAogICAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAnbWlkZGxlJywKICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLAogICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodDogJzIycHgnLAogICAgICAgICAgICAgICAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJywKICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAncmdiKDg3LCA4NywgODcpJywKICAgICAgICAgICAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicsCiAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46ICcwIDEwcHgnLAogICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICc4MHB4JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJy5zZi11bW15LWNvbmZpcm0taW5mby1wb3B1cCAuc2YtYnRuOmhvdmVyJzogewogICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2VkZWRlZCcKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSkKICAgICAgICAgIF0sCiAgICAgICAgICBvbjogWwogICAgICAgICAgICBbJ21vdXNlY2xpY2snLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIFsnbW91c2Vkb3duJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH1dCiAgICAgICAgICBdCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBpbmZvQ29udGFpbmVyOwogICAgICB9LAogICAgICBiaW5kVW1teUJ0bjogZnVuY3Rpb24oY29udGFpbmVyLCBwYXJhbXMpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgaWYgKCFwcmVmZXJlbmNlLnNob3dVbW15TGFuZGluZykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIHdlYlVybCA9ICdodHRwOi8vdmlkZW9kb3dubG9hZGVyLnVtbXkubmV0L2Fzc2V0cy9VbW15VkQtV2ViLUxvYWRlci1bJyArIHBhcmFtcy52aWQgKyAnLScgKyBwYXJhbXMudmlkZW8gKyAnXS5leGUnOwogICAgICAgIGlmICgvXk1hYy8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pKSB7CiAgICAgICAgICB3ZWJVcmwgPSAnaHR0cDovL3ZpZGVvZG93bmxvYWRlci51bW15Lm5ldC9zYXZlLWZyb20teW91dHViZS5odG1sPycgKyBtb25vLnBhcmFtKHsKICAgICAgICAgICAgdmlkOiBwYXJhbXMudmlkLAogICAgICAgICAgICB2aWRlbzogcGFyYW1zLnZpZGVvLAogICAgICAgICAgICB1dG1fc291cmNlOiAnc2F2ZWZyb20taGVscGVyJywKICAgICAgICAgICAgdXRtX21lZGl1bTogJ3lvdXR1YmUtaGVscGVyJywKICAgICAgICAgICAgdXRtX2NhbXBhaWduOiAndW1teScsCiAgICAgICAgICAgIHV0bV9jb250ZW50OiAndW1teV9pbnRlZ3JhdGlvbl9oJwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBtb25vLnN0b3JhZ2UuZ2V0KFsnb25jZVVtbXlMYW5kaW5nT3BlbmVkJywgJ29uY2VVbW15TGFuZGluZ0hpZGUnXSwgZnVuY3Rpb24oc3RvcmFnZSkgewogICAgICAgICAgaWYgKHN0b3JhZ2Uub25jZVVtbXlMYW5kaW5nSGlkZSA+IDIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghc3RvcmFnZS5vbmNlVW1teUxhbmRpbmdIaWRlKSB7CiAgICAgICAgICAgIHN0b3JhZ2Uub25jZVVtbXlMYW5kaW5nSGlkZSA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGJ0biA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdhJyk7CiAgICAgICAgICB2YXIgdW1teVVybCA9IGJ0bi5ocmVmOwoKICAgICAgICAgIGlmIChzdG9yYWdlLm9uY2VVbW15TGFuZGluZ09wZW5lZCkgewogICAgICAgICAgICByZXR1cm4gU2F2ZUZyb21fVXRpbHMuYmluZFVtbXlJbmZvKGNvbnRhaW5lciwgewogICAgICAgICAgICAgIGV4cFVtbXlJbmZvOiBfdGhpcy5jcmVhdGVJbmZvUG9wdXAuYmluZChfdGhpcywgdW1teVVybCwgd2ViVXJsKSwKICAgICAgICAgICAgICBub1VtbXk6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnRuLnRhcmdldCA9ICdfYmxhbmsnOwogICAgICAgICAgYnRuLmhyZWYgPSB3ZWJVcmw7CgogICAgICAgICAgdmFyIG9uY2VCdG5PbkNsaWNrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgYnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25jZUJ0bk9uQ2xpY2spOwogICAgICAgICAgICAgIG1vbm8uc3RvcmFnZS5zZXQoewogICAgICAgICAgICAgICAgb25jZVVtbXlMYW5kaW5nT3BlbmVkOiAxCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYnRuLnRhcmdldCA9ICdfc2VsZic7CiAgICAgICAgICAgICAgYnRuLmhyZWYgPSB1bW15VXJsOwogICAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmJpbmRVbW15SW5mbyhjb250YWluZXIsIHsKICAgICAgICAgICAgICAgIGV4cFVtbXlJbmZvOiBfdGhpcy5jcmVhdGVJbmZvUG9wdXAuYmluZChfdGhpcywgdW1teVVybCwgd2ViVXJsKSwKICAgICAgICAgICAgICAgIG5vVW1teTogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LCAyNTApOwogICAgICAgICAgfTsKCiAgICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbmNlQnRuT25DbGljayk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgdmFyIHF1aWNrQ29udmVydCA9IChmdW5jdGlvbigpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICB2YXIgaWQgPSAnc2YtY29udi1idG4nOwogICAgICB2YXIgZ2V0QnRuTm9kZSA9IGZ1bmN0aW9uKGxpbmspIHsKICAgICAgICBxdWlja0NvbnZlcnQucm1CdG4oKTsKCiAgICAgICAgdmFyIHF1YWxpdHlOb2RlID0gbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICB0ZXh0OiBsaW5rLmZvcm1hdC50b1VwcGVyQ2FzZSgpCiAgICAgICAgfSk7CgogICAgICAgIHZhciBidG4gPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIG1hcmdpbkxlZnQ6ICcxMHB4JywKICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScKICAgICAgICAgIH0sCiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ2EnLCB7CiAgICAgICAgICAgICAgY2xhc3M6ICdzZi1xdWljay1kbC1idG4nLAogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnaW5oZXJpdCcsCiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcyMnB4JywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjMDBCNzVBJywKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzNweCcsCiAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6ICc4cHgnLAogICAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ6ICcyOHB4JywKICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLAogICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcyMnB4JywKICAgICAgICAgICAgICAgIHRleHREZWNvcmF0aW9uOiAnbm9uZScsCiAgICAgICAgICAgICAgICB6SW5kZXg6IDEsCiAgICAgICAgICAgICAgICBjb2xvcjogJyNmZmYnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBocmVmOiBsaW5rLmhyZWYsCiAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnaScsIHsKICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgICAgICBsZWZ0OiAnNnB4JywKICAgICAgICAgICAgICAgICAgICB0b3A6ICczcHgnLAogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJ3VybCgnICsgU2F2ZUZyb21fVXRpbHMuc3ZnLmdldFNyYygnZG93bmxvYWQnLCAnI2ZmZmZmZicpICsgJyknLAogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAnMTJweCcsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJ25vLXJlcGVhdCcsCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiAnY2VudGVyJywKICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzE2cHgnLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogJzE2cHgnCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgcXVhbGl0eU5vZGUKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgbGluay5mdW5jKGUpOwogICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KFt7CiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJyMnICsgaWQsCiAgICAgICAgICAgICAgICBhcHBlbmQ6IFt7CiAgICAgICAgICAgICAgICAgICcuc2YtcXVpY2stZGwtYnRuJzogewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyMwMEI3NUEnCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICcuc2YtcXVpY2stZGwtYnRuOmhvdmVyJzogewogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyMwMEEzNTAgJwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAnLnNmLXF1aWNrLWRsLWJ0bjphY3RpdmUnOiB7CiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzAwOTc0QScKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgfSkKICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIGJ0bjsKICAgICAgfTsKCiAgICAgIHZhciBnZXRSYXRlTm9kZSA9IGZ1bmN0aW9uKGRldGFpbHMpIHsKICAgICAgICB2YXIgb25TdGFyT3ZlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIG5vZGUgPSB0aGlzOwogICAgICAgICAgd2hpbGUgKG5vZGUpIHsKICAgICAgICAgICAgbm9kZS5jbGFzc0xpc3QuYWRkKCdvdmVyJyk7CiAgICAgICAgICAgIG5vZGUgPSBub2RlLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBub2RlID0gdGhpcy5uZXh0RWxlbWVudFNpYmxpbmc7CiAgICAgICAgICB3aGlsZSAobm9kZSkgewogICAgICAgICAgICBub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ292ZXInKTsKICAgICAgICAgICAgbm9kZSA9IG5vZGUubmV4dEVsZW1lbnRTaWJsaW5nOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBnZXRTdGFyTm9kZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCAic3ZnIik7CiAgICAgICAgICB2YXIgc3ZnTlMgPSBzdmcubmFtZXNwYWNlVVJJOwoKICAgICAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgJzE4Jyk7CiAgICAgICAgICBzdmcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCAnMTgnKTsKICAgICAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLCAnMCAwIDI0IDI0Jyk7CgogICAgICAgICAgdmFyIHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoc3ZnTlMsICdwYXRoJyk7CiAgICAgICAgICBzdmcuYXBwZW5kQ2hpbGQocGF0aCk7CiAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZCcsICdNMTIuMDAyIDIuNTg4bDIuMjIyIDYuODM4aDcuMTlsLTUuODE2IDQuMjI3IDIuMjIyIDYuODM5LTUuODE4LTQuMjI3LTUuODE3IDQuMjI3IDIuMjIyLTYuODRMMi41OSA5LjQyN2g3LjE5eicpOwogICAgICAgICAgcGF0aC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICcjZjM5YzEyJyk7CiAgICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzEnKTsKCiAgICAgICAgICBzdmcuY2xhc3NMaXN0LmFkZCgnb3ZlcicpOwogICAgICAgICAgc3ZnLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIG9uU3Rhck92ZXIpOwoKICAgICAgICAgIHJldHVybiBzdmc7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGJveCA9IG1vbm8uY3JlYXRlKCdkaXYnLCB7CiAgICAgICAgICBjbGFzczogJ3NmLWNvbnYtdG9vbHRpcCcsCiAgICAgICAgICBvbjogWydtb3VzZXVwJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgfV0sCiAgICAgICAgICBhcHBlbmQ6IFsKICAgICAgICAgICAgbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICAgIGJvcmRlcjogJzhweCBzb2xpZCB0cmFuc3BhcmVudCcsCiAgICAgICAgICAgICAgICBib3JkZXJSaWdodDogJzEwcHggc29saWQgcmdiKDE5MiwgMTg3LCAxODcpJywKICAgICAgICAgICAgICAgIGJvcmRlckxlZnQ6IDAsCiAgICAgICAgICAgICAgICB0b3A6ICc4cHgnLAogICAgICAgICAgICAgICAgbGVmdDogMAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICB6SW5kZXg6IDEsCiAgICAgICAgICAgICAgICBib3JkZXI6ICc4cHggc29saWQgdHJhbnNwYXJlbnQnLAogICAgICAgICAgICAgICAgYm9yZGVyUmlnaHQ6ICcxMHB4IHNvbGlkICNmZmYnLAogICAgICAgICAgICAgICAgYm9yZGVyTGVmdDogMCwKICAgICAgICAgICAgICAgIHRvcDogJzhweCcsCiAgICAgICAgICAgICAgICBsZWZ0OiAnMXB4JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzcGFuJywgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmYnLAogICAgICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkICNjY2MnLAogICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogJzEwcHgnLAogICAgICAgICAgICAgICAgcGFkZGluZzogJzEwcHggMTBweCcsCiAgICAgICAgICAgICAgICBtYXhXaWR0aDogJzIyMHB4JywKICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQ6ICcxNnB4JywKICAgICAgICAgICAgICAgIGZvbnRTaXplOiAnMTRweCcsCiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiAnZm9udC1mYW1pbHk6IGFyaWFsLCBzYW5zLXNlcmlmJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICBtb25vLmNyZWF0ZSgnc3BhbicsIHsKICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzZi1zdGFyJywKICAgICAgICAgICAgICAgICAgYXBwZW5kOiBbCiAgICAgICAgICAgICAgICAgICAgZ2V0U3Rhck5vZGUoKSwKICAgICAgICAgICAgICAgICAgICBnZXRTdGFyTm9kZSgpLAogICAgICAgICAgICAgICAgICAgIGdldFN0YXJOb2RlKCksCiAgICAgICAgICAgICAgICAgICAgZ2V0U3Rhck5vZGUoKSwKICAgICAgICAgICAgICAgICAgICBnZXRTdGFyTm9kZSgpCiAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgc3RhckNvdW50ID0gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdzdmcub3ZlcicpLmxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgbW9uby5zZW5kTWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICd0cmFjaycsCiAgICAgICAgICAgICAgICAgICAgICB0OiAnZXZlbnQnLAogICAgICAgICAgICAgICAgICAgICAgZWM6ICdtcDMnLAogICAgICAgICAgICAgICAgICAgICAgZWE6ICdyYW5rJywKICAgICAgICAgICAgICAgICAgICAgIGVsOiBzdGFyQ291bnQKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGRvbmVOb2RlID0gbW9uby5jcmVhdGUoJ3NwYW4nLCB7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnVGhhbmsgeW91IScKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGRvbmVOb2RlLCB0aGlzKTsKCiAgICAgICAgICAgICAgICAgICAgbW9uby50cmlnZ2VyKGRldGFpbHMudGFyZ2V0LCAnc2ZSbUluZm9Qb3B1cCcpOwoKICAgICAgICAgICAgICAgICAgICBtb25vLnN0b3JhZ2Uuc2V0KHsKICAgICAgICAgICAgICAgICAgICAgIG9uY2VTaG93Q29udlJhdGU6IDAKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgIGJveC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogbW9uby5zdHlsZTJUZXh0KHsKICAgICAgICAgICAgICAgICAgICAnLnNmLWNvbnYtdG9vbHRpcCc6IHsKICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxMDAsCiAgICAgICAgICAgICAgICAgICAgICBhcHBlbmQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJy5zZi1idXR0b246aG92ZXInOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzEyNmRiMyAhaW1wb3J0YW50JwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAnLnNmLWJ1dHRvbjphY3RpdmUnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC45CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICdzdmcnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgJy5zZi1zdGFyIHN2ZyBwYXRoJzogewogICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6ICd0cmFuc3BhcmVudCcKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgJy5zZi1zdGFyIHN2Zy5vdmVyIHBhdGgnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogJyNmMWM0MGYnCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfSkKICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoJ3NmU2hvd0luZm9Qb3B1cCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHN0YXJzID0gYm94LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZi1zdGFyIHN2ZycpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBzdGFyc1tpXTsgaSsrKSB7CiAgICAgICAgICAgIG5vZGUuY2xhc3NMaXN0LmFkZCgnb3ZlcicpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gYm94OwogICAgICB9OwoKICAgICAgcmV0dXJuIHsKICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKGxpbmtzKSB7CiAgICAgICAgICB2YXIgbGluayA9IG51bGw7CiAgICAgICAgICBsaW5rcy5zb21lKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgaXRlbSA9IGl0ZW0ucHJvcDsKICAgICAgICAgICAgaWYgKGl0ZW0uZXh0cmEgJiYgaXRlbS5mb3JtYXQgPT09ICdNUDMnKSB7CiAgICAgICAgICAgICAgbGluayA9IGl0ZW07CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKCFsaW5rKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBnZXRCdG5Ob2RlKGxpbmspOwogICAgICAgIH0sCiAgICAgICAgcm1CdG46IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGJ0bkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjJyArIGlkKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBlbDsgZWwgPSBidG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICByYXRlVG9vbHRpcDogewogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGV0YWlscwogICAgICAgICAgICogQHBhcmFtIHtOb2RlfSBkZXRhaWxzLnRhcmdldAogICAgICAgICAgICovCiAgICAgICAgICBiaW5kOiBmdW5jdGlvbihkZXRhaWxzKSB7CiAgICAgICAgICAgIFNhdmVGcm9tX1V0aWxzLmJpbmRVbW15SW5mbyhkZXRhaWxzLnRhcmdldCwgewogICAgICAgICAgICAgIGV4cFVtbXlJbmZvOiBnZXRSYXRlTm9kZS5iaW5kKG51bGwsIGRldGFpbHMpLAogICAgICAgICAgICAgIGxlZnRPZmZzZXQ6IDEwLAogICAgICAgICAgICAgIG5vVW1teTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9KSgpOwoKICB9LCBudWxsLCBmdW5jdGlvbiBzeW5jSXNBY3RpdmUoKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vKi55b3V0dWJlLmNvbS8qJwogICAgICBdOwoKICAgICAgdmFyIHJlU3RyID0gbGlzdC5tYXAoZnVuY3Rpb24ocGF0dGVybikgewogICAgICAgIHJldHVybiBtb25vLnVybFBhdHRlcm5Ub1N0clJlKHBhdHRlcm4pOwogICAgICB9KS5qb2luKCd8Jyk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAocmVTdHIpOwoKICAgICAgaWYgKCFyZS50ZXN0KGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGlmICgvXC9cL2dhbWluZ1wueW91dHViZS8udGVzdChkb2N1bWVudC5VUkwpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9KTsKCiAgLy9AaW5zZXJ0CiAgKHR5cGVvZiBtb25vID09PSAndW5kZWZpbmVkJykgJiYgKG1vbm8gPSB7CiAgICBsb2FkTW9kdWxlOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5sb2FkTW9kdWxlU3RhY2sucHVzaChhcmd1bWVudHMpOwogICAgfSwKICAgIGxvYWRNb2R1bGVTdGFjazogW10KICB9KTsKCiAgbW9uby5sb2FkTW9kdWxlKCdpbnN0YWdyYW0nLCBmdW5jdGlvbihtb2R1bGVOYW1lLCBpbml0RGF0YSkgewogICAgdmFyIGxhbmd1YWdlID0gaW5pdERhdGEuZ2V0TGFuZ3VhZ2U7CiAgICB2YXIgcHJlZmVyZW5jZSA9IGluaXREYXRhLmdldFByZWZlcmVuY2U7CiAgICB2YXIgbW9kdWxlU3RhdGUgPSBwcmVmZXJlbmNlLm1vZHVsZUluc3RhZ3JhbSA/IDEgOiAwOwoKICAgIG1vbm8ub25NZXNzYWdlLmFkZExpc3RlbmVyKGZ1bmN0aW9uKG1lc3NhZ2UsIGNiKSB7CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2dldE1vZHVsZUluZm8nKSB7CiAgICAgICAgaWYgKG1lc3NhZ2UudXJsICE9PSBsb2NhdGlvbi5ocmVmKSByZXR1cm47CiAgICAgICAgcmV0dXJuIGNiKHsKICAgICAgICAgIHN0YXRlOiBtb2R1bGVTdGF0ZSwKICAgICAgICAgIG1vZHVsZU5hbWU6IG1vZHVsZU5hbWUKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICdjaGFuZ2VTdGF0ZScpIHsKICAgICAgICBpZiAobW9kdWxlTmFtZSAhPT0gbWVzc2FnZS5tb2R1bGVOYW1lKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnN0YWdyYW0uY2hhbmdlU3RhdGUobWVzc2FnZS5zdGF0ZSk7CiAgICAgIH0KICAgICAgaWYgKCFtb2R1bGVTdGF0ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAobWVzc2FnZS5hY3Rpb24gPT09ICd1cGRhdGVMaW5rcycpIHsKICAgICAgICByZXR1cm4gaW5zdGFncmFtLnVwZGF0ZUxpbmtzKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIGlmIChtb2R1bGVTdGF0ZSkgewogICAgICBtb25vLmFzeW5jQ2FsbChmdW5jdGlvbigpIHsKICAgICAgICBpbnN0YWdyYW0ucnVuKCk7CiAgICAgIH0pOwogICAgfQoKICAgIHZhciBpbnN0YWdyYW0gPSB7CiAgICAgIHVybFI6IC9cL1wvW15cL10rXC5bXlwvXStcL3BcLy8sCiAgICAgIGxhc3RXYWl0RWw6IG51bGwsCiAgICAgIGRsQnRuQ2xhc3NOYW1lOiAnc2F2ZWZyb20taGVscGVyLS1idG4nLAogICAgICBzdHlsZUVsOiBudWxsLAogICAgICBydW46IGZ1bmN0aW9uKCkgewogICAgICAgIG1vZHVsZVN0YXRlID0gMTsKCiAgICAgICAgdGhpcy5pbnNlcnRTdHlsZSgpOwoKICAgICAgICBpZiAoU2F2ZUZyb21fVXRpbHMubXV0YXRpb25XYXRjaGVyLmlzQXZhaWxhYmxlKCkpIHsKICAgICAgICAgIHRoaXMubXV0YXRpb25Nb2RlLmVuYWJsZSgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcm1TdHlsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5zdHlsZUVsICYmIHRoaXMuc3R5bGVFbC5wYXJlbnROb2RlICYmIHRoaXMuc3R5bGVFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuc3R5bGVFbCk7CiAgICAgIH0sCiAgICAgIGluc2VydFN0eWxlOiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAodGhpcy5zdHlsZUVsKSB7CiAgICAgICAgICBpZiAoIXRoaXMuc3R5bGVFbC5wYXJlbnROb2RlKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQodGhpcy5zdHlsZUVsKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuc3R5bGVFbCA9IG1vbm8uY3JlYXRlKCdzdHlsZScsIHsKICAgICAgICAgIHRleHQ6IG1vbm8uc3R5bGUyVGV4dChbewogICAgICAgICAgICBzZWxlY3RvcjogJy4nICsgdGhpcy5kbEJ0bkNsYXNzTmFtZSwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsCiAgICAgICAgICAgICAgYm9yZGVyOiAnMXB4IHNvbGlkICNGOEY4RjgnLAogICAgICAgICAgICAgIHRvcDogJzhweCcsCiAgICAgICAgICAgICAgbGVmdDogJzhweCcsCiAgICAgICAgICAgICAgcGFkZGluZzogMCwKICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjRjhGOEY4JywKICAgICAgICAgICAgICBjdXJzb3I6ICdwb2ludGVyJywKICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiAwCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgc2VsZWN0b3I6ICcuJyArIHRoaXMuZGxCdG5DbGFzc05hbWUgKyAnIHN2ZycsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgbWFyZ2luOiAnMnB4JwogICAgICAgICAgICB9CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHNlbGVjdG9yOiAnLicgKyB0aGlzLmRsQnRuQ2xhc3NOYW1lICsgJyBzdmcgcGF0aCcsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZmlsbDogJyM3Nzc3NzcnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgc2VsZWN0b3I6ICcuRW1iZWQgLicgKyB0aGlzLmRsQnRuQ2xhc3NOYW1lLAogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGJvcmRlcjogJzFweCBzb2xpZCAjQjVCNUI1JywKICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICc0cHgnLAogICAgICAgICAgICAgIHBhZGRpbmc6ICczcHgnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIHsKICAgICAgICAgICAgc2VsZWN0b3I6ICcuJyArIHRoaXMuZGxCdG5DbGFzc05hbWUgKyAnOmhvdmVyIHN2ZyBwYXRoJywKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBmaWxsOiAnIzNmNzI5YicKICAgICAgICAgICAgfQogICAgICAgICAgfSwgewogICAgICAgICAgICBzZWxlY3RvcjogJy4nICsgdGhpcy5kbEJ0bkNsYXNzTmFtZSArICc6YWN0aXZlJywKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBvdXRsaW5lOiAwLAogICAgICAgICAgICAgIGJveFNoYWRvdzogJ2luc2V0IDAgM3B4IDVweCByZ2JhKDAsIDAsIDAsIDAuMTI1KScKICAgICAgICAgICAgfQogICAgICAgICAgfSwgewogICAgICAgICAgICBzZWxlY3RvcjogJyo6aG92ZXIgPiAuJyArIHRoaXMuZGxCdG5DbGFzc05hbWUsCiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJwogICAgICAgICAgICB9CiAgICAgICAgICB9XSkKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCh0aGlzLnN0eWxlRWwpOwogICAgICB9LAogICAgICB1cGRhdGVMaW5rczogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5jaGFuZ2VTdGF0ZSgwKTsKICAgICAgICB0aGlzLmNoYW5nZVN0YXRlKDEpOwogICAgICB9LAogICAgICBjaGFuZ2VTdGF0ZTogZnVuY3Rpb24oc3RhdGUpIHsKICAgICAgICBtb2R1bGVTdGF0ZSA9IHN0YXRlOwogICAgICAgIHRoaXMucm1EbEJ0bigpOwogICAgICAgIHRoaXMucm1TdHlsZSgpOwogICAgICAgIHRoaXMubXV0YXRpb25Nb2RlLnN0b3AoKTsKICAgICAgICBpZiAoc3RhdGUpIHsKICAgICAgICAgIHRoaXMucnVuKCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBybURsQnRuOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYnRuTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgdGhpcy5kbEJ0bkNsYXNzTmFtZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGVsOyBlbCA9IGJ0bkxpc3RbaV07IGkrKykgewogICAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBnZXRWaWRlb0luZm86IGZ1bmN0aW9uKHZpZGVvKSB7CiAgICAgICAgLy8gdmFyIHBvc3RlciA9IHZpZGVvLmdldEF0dHJpYnV0ZSgncG9zdGVyJyk7CiAgICAgICAgdmFyIHNyYyA9IHZpZGVvLmdldEF0dHJpYnV0ZSgnc3JjJyk7CiAgICAgICAgaWYgKHR5cGVvZiBzcmMgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgZXh0ID0gJ21wNCc7CiAgICAgICAgaWYgKHNyYy5pbmRleE9mKCcuZmx2JykgIT09IC0xKSB7CiAgICAgICAgICBleHQgPSAnZmx2JzsKICAgICAgICB9CgogICAgICAgIHZhciBmaWxlbmFtZSA9IHNyYy5tYXRjaCgvXC8oW15cLz9dKykoPzokfFw/KS8pOwogICAgICAgIGZpbGVuYW1lID0gZmlsZW5hbWUgJiYgZmlsZW5hbWVbMV07CiAgICAgICAgaWYgKCFmaWxlbmFtZSkgewogICAgICAgICAgZmlsZW5hbWUgPSAnbm9uYW1lLicgKyBleHQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmaWxlbmFtZTogZmlsZW5hbWUsCiAgICAgICAgICB1cmw6IHNyYwogICAgICAgIH0KICAgICAgfSwKICAgICAgZ2V0SW1hZ2VJbmZvOiBmdW5jdGlvbihpbWFnZSwgaXNFbWJlZCkgewogICAgICAgIHZhciBzcmMgPSBudWxsOwogICAgICAgIGlmIChpc0VtYmVkKSB7CiAgICAgICAgICBzcmMgPSBpbWFnZS5nZXRBdHRyaWJ1dGUoJ3N0eWxlJykgfHwgJyc7CiAgICAgICAgICBzcmMgPSBzcmMubWF0Y2goLycoaHR0cFteXCddKykvKTsKICAgICAgICAgIHNyYyA9IHNyYyAmJiBzcmNbMV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNyYyA9IGltYWdlLmdldEF0dHJpYnV0ZSgnc3JjJyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIHNyYyAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHNyYyA9IHNyYy5yZXBsYWNlKC9cL1twc11cZCt4XGQrXC8vLCAnXC8nKTsKCiAgICAgICAgdmFyIGV4dCA9ICdqcGcnOwogICAgICAgIGlmIChzcmMuaW5kZXhPZignLnBuZycpICE9PSAtMSkgewogICAgICAgICAgZXh0ID0gJ3BuZyc7CiAgICAgICAgfQoKICAgICAgICB2YXIgZmlsZW5hbWUgPSBzcmMubWF0Y2goL1wvKFteXC8/XSspKD86JHxcPykvKTsKICAgICAgICBmaWxlbmFtZSA9IGZpbGVuYW1lICYmIGZpbGVuYW1lWzFdOwogICAgICAgIGlmICghZmlsZW5hbWUpIHsKICAgICAgICAgIGZpbGVuYW1lID0gJ25vbmFtZS4nICsgZXh0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgZmlsZW5hbWU6IGZpbGVuYW1lLAogICAgICAgICAgdXJsOiBzcmMKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdldERiQnRuRWw6IGZ1bmN0aW9uKHZpZGVvSW5mbykgewogICAgICAgIHJldHVybiBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgIGNsYXNzOiBbdGhpcy5kbEJ0bkNsYXNzTmFtZV0sCiAgICAgICAgICBocmVmOiB2aWRlb0luZm8udXJsLAogICAgICAgICAgZG93bmxvYWQ6IHZpZGVvSW5mby5maWxlbmFtZSwKICAgICAgICAgIHRpdGxlOiBsYW5ndWFnZS5kb3dubG9hZCwKICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICB6SW5kZXg6IDEwMAogICAgICAgICAgfSwKICAgICAgICAgIG9uOiBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5kb3dubG9hZE9uQ2xpY2soZSwgdW5kZWZpbmVkLCB7CiAgICAgICAgICAgICAgZWw6IHRoaXMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9XSwKICAgICAgICAgIGFwcGVuZDogWwogICAgICAgICAgICBTYXZlRnJvbV9VdGlscy5zdmcuZ2V0U3ZnKCdkb3dubG9hZCcsIG51bGwsIDE2LCAxNikKICAgICAgICAgIF0KICAgICAgICB9KTsKICAgICAgfSwKICAgICAgYWRkRGxCdG46IGZ1bmN0aW9uKGNvbnRhaW5lciwgdHlwZSkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgaXNFbWJlZCA9IHR5cGUgPT09IDE7CgogICAgICAgIHZhciBvbGRCdG4gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLicgKyB0aGlzLmRsQnRuQ2xhc3NOYW1lKTsKICAgICAgICBvbGRCdG4gJiYgb2xkQnRuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2xkQnRuKTsKICAgICAgICBvbGRCdG4gPSBudWxsOwoKICAgICAgICB2YXIgaU1lZGlhID0gY29udGFpbmVyOwoKICAgICAgICB2YXIgbWVkaWFJbmZvID0gbnVsbDsKCiAgICAgICAgdmFyIHZpZGVvID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoWydkaXYgPiBkaXYgPiB2aWRlb1tzcmNdJ10pOwogICAgICAgIGlmICh2aWRlbykgewogICAgICAgICAgbWVkaWFJbmZvID0gdGhpcy5nZXRWaWRlb0luZm8odmlkZW8pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFtZWRpYUluZm8pIHsKICAgICAgICAgIHZhciBpbWFnZSA9IG51bGw7CiAgICAgICAgICBpZiAoaXNFbWJlZCkgewogICAgICAgICAgICBpbWFnZSA9IGlNZWRpYS5xdWVyeVNlbGVjdG9yKCcuRW1iZWRGcmFtZSAuZWZJbWFnZVtzdHlsZV0nKTsKICAgICAgICAgICAgaWYgKGltYWdlKSB7CiAgICAgICAgICAgICAgbWVkaWFJbmZvID0gdGhpcy5nZXRJbWFnZUluZm8oaW1hZ2UsIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgaW1hZ2VMaXN0ID0gW10uc2xpY2UuY2FsbChpTWVkaWEucXVlcnlTZWxlY3RvckFsbChbJ2RpdiA+IGltZ1tzcmNdW2lkXj1wSW1hZ2VdJ10pKTsKICAgICAgICAgICAgaWYgKGltYWdlTGlzdC5sZW5ndGgpIHsKICAgICAgICAgICAgICBtZWRpYUluZm8gPSB0aGlzLmdldEltYWdlSW5mbyhpbWFnZUxpc3RbMF0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIW1lZGlhSW5mbykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRsQnRuID0gdGhpcy5nZXREYkJ0bkVsKG1lZGlhSW5mbyk7CgogICAgICAgIGlmIChpc0VtYmVkKSB7CiAgICAgICAgICB2YXIgZW1iZWRGb2xsb3dCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuRW1iZWRGb2xsb3dCdXR0b24nKTsKICAgICAgICAgIGlmIChlbWJlZEZvbGxvd0J1dHRvbikgewogICAgICAgICAgICB2YXIgZW1iZWRGb2xsb3dCdXR0b25TaXplID0gU2F2ZUZyb21fVXRpbHMuZ2V0U2l6ZShlbWJlZEZvbGxvd0J1dHRvbik7CiAgICAgICAgICAgIHZhciBlbWJlZEZvbGxvd0J1dHRvblBvc2l0aW9uID0gU2F2ZUZyb21fVXRpbHMuZ2V0UG9zaXRpb24oZW1iZWRGb2xsb3dCdXR0b24pOwogICAgICAgICAgICBkbEJ0bi5zdHlsZS5yaWdodCA9IChlbWJlZEZvbGxvd0J1dHRvblNpemUud2lkdGggKyAxMikgKyAncHgnOwogICAgICAgICAgICBkbEJ0bi5zdHlsZS5sZWZ0ID0gJ2F1dG8nOwogICAgICAgICAgICBkbEJ0bi5zdHlsZS50b3AgPSBlbWJlZEZvbGxvd0J1dHRvblBvc2l0aW9uLnRvcCArICdweCc7CiAgICAgICAgICAgIGRsQnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaU1lZGlhLmFwcGVuZENoaWxkKGRsQnRuKTsKICAgICAgfSwKICAgICAgbXV0YXRpb25Nb2RlOiB7CiAgICAgICAgb2JzZXJ2ZXI6IG51bGwsCiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5vYnNlcnZlcikgewogICAgICAgICAgICB0aGlzLm9ic2VydmVyLnN0b3AoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBbJ3NmU2tpcCddLmZvckVhY2goZnVuY3Rpb24oYXR0cikgewogICAgICAgICAgICB2YXIgZGF0YUF0dHIgPSBtb25vLmRhdGFBdHRyMlNlbGVjdG9yKGF0dHIpOwogICAgICAgICAgICB2YXIgZGF0YUF0dHJMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnWycgKyBkYXRhQXR0ciArICddJyk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gZGF0YUF0dHJMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgICBpdGVtLnJlbW92ZUF0dHJpYnV0ZShkYXRhQXR0cik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICh0aGlzLm9ic2VydmVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm9ic2VydmVyLnN0YXJ0KCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5vYnNlcnZlciA9IFNhdmVGcm9tX1V0aWxzLm11dGF0aW9uV2F0Y2hlci5ydW4oewogICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VtbWFyeUxpc3QpIHsKICAgICAgICAgICAgICB2YXIgc3VtbWFyeSwgbiwgaSwgbm9kZTsKCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzBdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgaW5zdGFncmFtLmFkZERsQnRuKG5vZGUucGFyZW50Tm9kZSwgMCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdW1tYXJ5ID0gc3VtbWFyeUxpc3RbMV07CiAgICAgICAgICAgICAgZm9yIChuID0gMDsgbm9kZSA9IHN1bW1hcnkuYWRkZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUuZGF0YXNldC5zZlNraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbm9kZS5kYXRhc2V0LnNmU2tpcCA9ICcxJzsKCiAgICAgICAgICAgICAgICBpbnN0YWdyYW0uYWRkRGxCdG4obm9kZSwgMSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBxdWVyaWVzOiBbewogICAgICAgICAgICAgIGNzczogJ2RpdiA+IGRpdiA+IGFydGljbGUgPiBoZWFkZXIgKyBkaXYgPiBkaXYgPiBkaXYnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuRW1iZWQnLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSwgbnVsbCwgZnVuY3Rpb24gc3luY0lzQWN0aXZlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vKi5pbnN0YWdyYW0uY29tLyonCiAgICAgIF07CgogICAgICB2YXIgcmVTdHIgPSBsaXN0Lm1hcChmdW5jdGlvbihwYXR0ZXJuKSB7CiAgICAgICAgcmV0dXJuIG1vbm8udXJsUGF0dGVyblRvU3RyUmUocGF0dGVybik7CiAgICAgIH0pLmpvaW4oJ3wnKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cChyZVN0cik7CgogICAgICBpZiAoIXJlLnRlc3QobG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdG5hbWUpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgaWYgKG1vbm8uaXNJZnJhbWUoKSAmJiAhL1wvXC9bXlwvXStcLlteXC9dK1wvcFwvLy50ZXN0KGRvY3VtZW50LlVSTCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgncnV0dWJlJywgZnVuY3Rpb24obW9kdWxlTmFtZSwgaW5pdERhdGEpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHZhciBsYW5ndWFnZSA9IGluaXREYXRhLmdldExhbmd1YWdlOwogICAgdmFyIHByZWZlcmVuY2UgPSBpbml0RGF0YS5nZXRQcmVmZXJlbmNlOwogICAgdmFyIG1vZHVsZVN0YXRlID0gcHJlZmVyZW5jZS5tb2R1bGVSdXR1YmUgPyAxIDogMDsKICAgIHZhciBjbGFzc05hbWUgPSAnc2YtZGwtYnRuJzsKCiAgICB2YXIgZnJhbWUgPSBtb25vLmlzSWZyYW1lKCk7CgogICAgbW9uby5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24obWVzc2FnZSwgY2IpIHsKICAgICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSAnZ2V0TW9kdWxlSW5mbycpIHsKICAgICAgICBpZiAobWVzc2FnZS51cmwgIT09IGxvY2F0aW9uLmhyZWYpIHJldHVybjsKICAgICAgICByZXR1cm4gY2IoewogICAgICAgICAgc3RhdGU6IG1vZHVsZVN0YXRlLAogICAgICAgICAgbW9kdWxlTmFtZTogbW9kdWxlTmFtZQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2NoYW5nZVN0YXRlJykgewogICAgICAgIGlmIChtb2R1bGVOYW1lICE9PSBtZXNzYWdlLm1vZHVsZU5hbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJ1dHViZS5jaGFuZ2VTdGF0ZShtZXNzYWdlLnN0YXRlKTsKICAgICAgfQogICAgICBpZiAoIW1vZHVsZVN0YXRlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ3VwZGF0ZUxpbmtzJykgewogICAgICAgIHJldHVybiBydXR1YmUudXBkYXRlTGlua3MoKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKG1vZHVsZVN0YXRlKSB7CiAgICAgIG1vbm8uYXN5bmNDYWxsKGZ1bmN0aW9uKCkgewogICAgICAgIHJ1dHViZS5ydW4oKTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIHJ1dHViZSA9IHsKICAgICAgY29udGV4dE1lbnU6IG51bGwsCiAgICAgIHJ1bjogZnVuY3Rpb24oKSB7CiAgICAgICAgbW9kdWxlU3RhdGUgPSAxOwoKICAgICAgICBpZiAoZnJhbWUpIHsKICAgICAgICAgIHJldHVybiBydXR1YmUuZnJhbWUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChTYXZlRnJvbV9VdGlscy5tdXRhdGlvbldhdGNoZXIuaXNBdmFpbGFibGUoKSkgewogICAgICAgICAgcnV0dWJlLm11dGF0aW9uTW9kZS5lbmFibGUoKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNoYW5nZVN0YXRlOiBmdW5jdGlvbihzdGF0ZSkgewogICAgICAgIG1vZHVsZVN0YXRlID0gc3RhdGU7CiAgICAgICAgdGhpcy5oaWRlTWVudSgpOwogICAgICAgIHRoaXMucm1EbExpbmtzKCk7CiAgICAgICAgdGhpcy5tdXRhdGlvbk1vZGUuc3RvcCgpOwogICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgdGhpcy5ydW4oKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGhpZGVNZW51OiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAocnV0dWJlLmNvbnRleHRNZW51KSB7CiAgICAgICAgICBydXR1YmUuY29udGV4dE1lbnUuaGlkZSgpOwogICAgICAgICAgcnV0dWJlLmNvbnRleHRNZW51ID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHVwZGF0ZUxpbmtzOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLmNoYW5nZVN0YXRlKDApOwogICAgICAgIHRoaXMuY2hhbmdlU3RhdGUoMSk7CiAgICAgIH0sCiAgICAgIHJtRGxMaW5rczogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjbGFzc05hbWUpOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gbGlua3NbaV07IGkrKykgewogICAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaW5zZXJ0RGxMaW5rOiBmdW5jdGlvbihjb250YWluZXIpIHsKICAgICAgICB2YXIgb2xkQnRuTGlzdCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNsYXNzTmFtZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBvbGRCdG5MaXN0W2ldOyBpKyspIHsKICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTsKICAgICAgICB9CiAgICAgICAgb2xkQnRuTGlzdCA9IG51bGw7CgogICAgICAgIHZhciBnZXRVbW15VXJsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgaHJlZiA9IGxvY2F0aW9uLmhyZWY7CiAgICAgICAgICByZXR1cm4gJ3VtbXknICsgaHJlZi5zdWJzdHIoaHJlZi5pbmRleE9mKCc6Ly8nKSk7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSBnZXRVbW15VXJsKCk7CgogICAgICAgIHZhciByZWZyZXNoTGluayA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGhyZWYgPSBnZXRVbW15VXJsKCk7CiAgICAgICAgICBpZiAoY3VycmVudFVybCAhPT0gaHJlZikgewogICAgICAgICAgICBjdXJyZW50VXJsID0gaHJlZjsKICAgICAgICAgICAgYnRuLmhyZWYgPSBocmVmOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBidG4gPSBtb25vLmNyZWF0ZSgnYScsIHsKICAgICAgICAgIHRleHQ6IGxhbmd1YWdlLmRvd25sb2FkLAogICAgICAgICAgaHJlZjogY3VycmVudFVybCwKICAgICAgICAgIGNsYXNzOiBbY2xhc3NOYW1lLCAnZy1zb2xpZC1saW5rJ10sCiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBtYXJnaW5MZWZ0OiAnNXB4JwogICAgICAgICAgfSwKICAgICAgICAgIHRhcmdldDogJ19ibGFuaycsCiAgICAgICAgICBvbjogWwogICAgICAgICAgICBbJ2NsaWNrJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgICAgICAgICByZWZyZXNoTGluaygpOwoKICAgICAgICAgICAgICBpZiAocnV0dWJlLmNvbnRleHRNZW51ICYmIHJ1dHViZS5jb250ZXh0TWVudS5pc1Nob3cpIHsKICAgICAgICAgICAgICAgIHJ1dHViZS5oaWRlTWVudSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGxpbmtzID0gU2F2ZUZyb21fVXRpbHMucG9wdXBNZW51LnByZXBhcmVMaW5rcy5ydXR1YmUoZ2V0VW1teVVybCgpKTsKICAgICAgICAgICAgICBydXR1YmUuY29udGV4dE1lbnUgPSBTYXZlRnJvbV9VdGlscy5wb3B1cE1lbnUucXVpY2tJbnNlcnQodGhpcywgbGlua3MsICdzZi1wb3B1cE1lbnUnKTsKICAgICAgICAgICAgfV0KICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgbW9uby5vblJlbW92ZUV2ZW50KGJ0biwgcnV0dWJlLmhpZGVNZW51KTsKCiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGJ0bik7CiAgICAgIH0sCiAgICAgIGZyYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBidG5JZCA9ICdzZkRsQnRuJzsKICAgICAgICB2YXIgYnRuT2JqID0gU2F2ZUZyb21fVXRpbHMuZnJhbWVNZW51LmdldEJ0bih7CiAgICAgICAgICBzaW5nbGVCdG46IHRydWUsCiAgICAgICAgICBidG5JZDogYnRuSWQsCiAgICAgICAgICBjb250YWluZXJTdHlsZTogewogICAgICAgICAgICByaWdodDogJzUwcHgnLAogICAgICAgICAgICB0b3A6ICcxMnB4JwogICAgICAgICAgfSwKICAgICAgICAgIHF1aWNrQnRuU3R5bGVPYmo6IHsKICAgICAgICAgICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCiAgICAgICAgICAgIGJvcmRlcjogMCwKICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnLjNlbScsCiAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLAogICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJywKICAgICAgICAgICAgcGFkZGluZzogJzRweCA2cHgnCiAgICAgICAgICB9LAogICAgICAgICAgcXVpY2tCdG5Dc3NTdHlsZTogewogICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcKICAgICAgICAgIH0sCiAgICAgICAgICBxdWlja0J0bkljb246IG1vbm8uY3JlYXRlKFNhdmVGcm9tX1V0aWxzLnN2Zy5nZXRTdmcoJ2Rvd25sb2FkJywgJyNmZmZmZmYnKSwgewogICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgIGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLAogICAgICAgICAgICAgIHdpZHRoOiAnMTZweCcsCiAgICAgICAgICAgICAgaGVpZ2h0OiAnMTZweCcsCiAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogJ21pZGRsZScKICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICBub2RlQ3NzU3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnCiAgICAgICAgICB9LAogICAgICAgICAgb246IFsKICAgICAgICAgICAgWydjbGljaycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICAgICAgaWYgKF90aGlzLmNvbnRleHRNZW51ICYmIF90aGlzLmNvbnRleHRNZW51LmlzU2hvdykgewogICAgICAgICAgICAgICAgX3RoaXMuaGlkZU1lbnUoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBsaW5rTGlzdCA9IFNhdmVGcm9tX1V0aWxzLnBvcHVwTWVudS5wcmVwYXJlTGlua3MucnV0dWJlKGxvY2F0aW9uLmhyZWYpOwogICAgICAgICAgICAgIHZhciBtZW51ID0gX3RoaXMuY29udGV4dE1lbnUgPSBTYXZlRnJvbV9VdGlscy5mcmFtZU1lbnUuZ2V0TWVudSh0aGlzLCBsaW5rTGlzdCwgJ3NmLWZyYW1lLW1lbnUnLCB7CiAgICAgICAgICAgICAgICBjb250YWluZXI6IGJ0bk9iai5jb250YWluZXIsCiAgICAgICAgICAgICAgICBvblNob3c6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICBidG5PYmoubm9kZS5jbGFzc0xpc3QuYWRkKCdzZi1vdmVyJyk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25IaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGV4dE1lbnUgPSBudWxsOwogICAgICAgICAgICAgICAgICBidG5PYmoubm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdzZi1vdmVyJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBbJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgIGlmIChlLmJ1dHRvbiA9PT0gMikgewogICAgICAgICAgICAgICAgbW9uby5vZmYoZG9jdW1lbnQuYm9keSwgJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKTsKCiAgICAgICAgICAgICAgICBfdGhpcy5oaWRlTWVudSgpOwoKICAgICAgICAgICAgICAgIGlmIChidG5PYmouY29udGFpbmVyLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgYnRuT2JqLmNvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGJ0bk9iai5jb250YWluZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV0KICAgICAgICAgIF0KICAgICAgICB9KTsKCiAgICAgICAgYnRuT2JqLnF1aWNrQnRuLnRpdGxlID0gbGFuZ3VhZ2UuZG93bmxvYWQ7CgogICAgICAgIGJ0bk9iai5jb250YWluZXIgPSBtb25vLmNyZWF0ZSgnZGl2JywgewogICAgICAgICAgY2xhc3M6ICdzZi1idG4tY3RyJywKICAgICAgICAgIGFwcGVuZDogYnRuT2JqLm5vZGUKICAgICAgICB9KTsKCiAgICAgICAgbW9uby5vbihidG5PYmouY29udGFpbmVyLCAnbW91c2VlbnRlcicsIGZ1bmN0aW9uKCkgewogICAgICAgICAgYnRuT2JqLmxvY2tIaWRlID0gdHJ1ZTsKICAgICAgICB9KTsKCiAgICAgICAgbW9uby5vbihidG5PYmouY29udGFpbmVyLCAnbW91c2VsZWF2ZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgYnRuT2JqLmxvY2tIaWRlID0gZmFsc2U7CiAgICAgICAgfSk7CgogICAgICAgIHZhciBoaWRlVGltZW91dCA9IG51bGw7CiAgICAgICAgdmFyIGhhc0NsYXNzTmFtZSA9IGZhbHNlOwogICAgICAgIHZhciB0aW1lb3V0Rm4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICghYnRuT2JqLmxvY2tIaWRlKSB7CiAgICAgICAgICAgIGJ0bk9iai5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc2YtaGlkZS11aScpOwogICAgICAgICAgICBoYXNDbGFzc05hbWUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdmFyIG9uTW91c2VNb3ZlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoaGFzQ2xhc3NOYW1lKSB7CiAgICAgICAgICAgIGJ0bk9iai5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2YtaGlkZS11aScpOwogICAgICAgICAgICBoYXNDbGFzc05hbWUgPSBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjbGVhclRpbWVvdXQoaGlkZVRpbWVvdXQpOwogICAgICAgICAgaGlkZVRpbWVvdXQgPSBzZXRUaW1lb3V0KHRpbWVvdXRGbiwgMyAqIDEwMDApOwogICAgICAgIH07CiAgICAgICAgbW9uby5vbihkb2N1bWVudC5ib2R5LCAnbW91c2Vtb3ZlJywgb25Nb3VzZU1vdmUpOwoKICAgICAgICBidG5PYmoubm9kZS5hcHBlbmRDaGlsZChtb25vLmNyZWF0ZSgnc3R5bGUnLCB7CiAgICAgICAgICB0ZXh0OiBtb25vLnN0eWxlMlRleHQoW3sKICAgICAgICAgICAgc2VsZWN0b3I6IFsKICAgICAgICAgICAgICAnYm9keTpob3ZlciAuc2YtYnRuLWN0cjpub3QoLnNmLWhpZGUtdWkpICMnICsgYnRuSWQsCiAgICAgICAgICAgICAgJ2JvZHk6aG92ZXIgLnNmLWJ0bi1jdHI6bm90KC5zZi1oaWRlLXVpKSAuc2YtZnJhbWUtbWVudScKICAgICAgICAgICAgXSwKICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snCiAgICAgICAgICAgIH0KICAgICAgICAgIH1dKQogICAgICAgIH0pKTsKCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChidG5PYmouY29udGFpbmVyKTsKICAgICAgfSwKICAgICAgbXV0YXRpb25Nb2RlOiB7CiAgICAgICAgb2JzZXJ2ZXI6IG51bGwsCiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5vYnNlcnZlcikgewogICAgICAgICAgICB0aGlzLm9ic2VydmVyLnN0b3AoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBbJ3NmU2tpcCddLmZvckVhY2goZnVuY3Rpb24oYXR0cikgewogICAgICAgICAgICB2YXIgZGF0YUF0dHIgPSBtb25vLmRhdGFBdHRyMlNlbGVjdG9yKGF0dHIpOwogICAgICAgICAgICB2YXIgZGF0YUF0dHJMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnWycgKyBkYXRhQXR0ciArICddJyk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpdGVtOyBpdGVtID0gZGF0YUF0dHJMaXN0W2ldOyBpKyspIHsKICAgICAgICAgICAgICBpdGVtLnJlbW92ZUF0dHJpYnV0ZShkYXRhQXR0cik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGlmICh0aGlzLm9ic2VydmVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm9ic2VydmVyLnN0YXJ0KCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5vYnNlcnZlciA9IFNhdmVGcm9tX1V0aWxzLm11dGF0aW9uV2F0Y2hlci5ydW4oewogICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oc3VtbWFyeUxpc3QpIHsKICAgICAgICAgICAgICB2YXIgc3VtbWFyeSwgbiwgaSwgbm9kZTsKCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzBdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LmFkZGVkW25dOyBuKyspIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLmRhdGFzZXQuc2ZTa2lwID4gMCkgewogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5vZGUuZGF0YXNldC5zZlNraXAgPSAnMSc7CgogICAgICAgICAgICAgICAgcnV0dWJlLmluc2VydERsTGluayhub2RlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1bW1hcnkgPSBzdW1tYXJ5TGlzdFsxXTsKICAgICAgICAgICAgICBmb3IgKG4gPSAwOyBub2RlID0gc3VtbWFyeS5hZGRlZFtuXTsgbisrKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhc2V0LnNmU2tpcCA+IDApIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub2RlLmRhdGFzZXQuc2ZTa2lwID0gJzEnOwoKICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBtb25vLmdldFBhcmVudEJ5Q2xhc3Mobm9kZSwgJ2ItdmlkZW8nKTsKICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBwYXJlbnQucXVlcnlTZWxlY3RvcignLmItYXV0aG9yIC5hdXRob3ItYmxvY2snKTsKICAgICAgICAgICAgICAgIGlmIChjb250YWluZXIpIHsKICAgICAgICAgICAgICAgICAgcnV0dWJlLmluc2VydERsTGluayhjb250YWluZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3VtbWFyeSA9IHN1bW1hcnlMaXN0WzJdOwogICAgICAgICAgICAgIGZvciAobiA9IDA7IG5vZGUgPSBzdW1tYXJ5LnJlbW92ZWRbbl07IG4rKykgewogICAgICAgICAgICAgICAgbW9uby5vblJlbW92ZUxpc3RlbmVyKG5vZGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcXVlcmllczogW3sKICAgICAgICAgICAgICBjc3M6ICcuYi12aWRlbyAuYi1hdXRob3IgLmF1dGhvci1ibG9jaycsCiAgICAgICAgICAgICAgaXM6ICdhZGRlZCcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNzczogJy5iLXZpZGVvIGRpdiNtZXRhaW5mby1ibG9jayBkaXYuYi1hdXRob3InLAogICAgICAgICAgICAgIGlzOiAnYWRkZWQnCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBjc3M6ICcuJyArIG1vbm8ub25SZW1vdmVDbGFzc05hbWUsCiAgICAgICAgICAgICAgaXM6ICdyZW1vdmVkJwogICAgICAgICAgICB9XQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0sIGZ1bmN0aW9uIGlzQWN0aXZlKGRhdGEpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIGlmICghZGF0YS5nZXRQcmVmZXJlbmNlLnNob3dVbW15SXRlbSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfSwgZnVuY3Rpb24gc3luY0lzQWN0aXZlKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgaWYgKG1vbm8uaXNTYWZhcmkgfHwgbW9uby5pc0dNKSB7CiAgICAgIHZhciBsaXN0ID0gWwogICAgICAgICcqOi8vKi5ydXR1YmUucnUvKicKICAgICAgXTsKCiAgICAgIHZhciByZVN0ciA9IGxpc3QubWFwKGZ1bmN0aW9uKHBhdHRlcm4pIHsKICAgICAgICByZXR1cm4gbW9uby51cmxQYXR0ZXJuVG9TdHJSZShwYXR0ZXJuKTsKICAgICAgfSkuam9pbignfCcpOwogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHJlU3RyKTsKCiAgICAgIGlmICghcmUudGVzdChsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0bmFtZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KCiAgICBpZiAobW9uby5pc0lmcmFtZSgpKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGxvY2F0aW9uLmhvc3RuYW1lID09PSB3aW5kb3cucGFyZW50LmxvY2F0aW9uLmhvc3RuYW1lKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0pOwogICh0eXBlb2YgbW9ubyA9PT0gJ3VuZGVmaW5lZCcpICYmIChtb25vID0gewogICAgbG9hZE1vZHVsZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubG9hZE1vZHVsZVN0YWNrLnB1c2goYXJndW1lbnRzKTsKICAgIH0sCiAgICBsb2FkTW9kdWxlU3RhY2s6IFtdCiAgfSk7CgogIG1vbm8ubG9hZE1vZHVsZSgnZnNTdGF0JywgZnVuY3Rpb24oKSB7CiAgICB2YXIgY29sbGVjdGlvblVybCA9ICdodHRwczovL2NyLWlucHV0Lm14cG5sLm5ldC9kYXRhJzsKICAgIGlmIChtb25vLmlzRkYpIHsKICAgICAgY29sbGVjdGlvblVybCA9ICdodHRwczovL2ZmLWlucHV0Lm14cG5sLm5ldC9kYXRhJzsKICAgIH0KCiAgICAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZXR0aW5ncyA9IHsKICAgICAgICB2ZXJzaW9uOiAiMS4wLjIzIiwKICAgICAgICB0eXBlOiAiY3MtZGNhIiwKICAgICAgICBwYXJ0bmVySWQ6ICIzOTU3MSIsCiAgICAgICAgY2hhbm5lbElkOiB3aW5kb3cuY2hyb21lICYmIHdpbmRvdy5jaHJvbWUucnVudGltZSAmJiB3aW5kb3cuY2hyb21lLnJ1bnRpbWUuaWQgfHwgIiIsCiAgICAgICAgc3ViSWQ6ICIwMDAwIiwKCiAgICAgICAgY29sbGVjdGlvblVybDogY29sbGVjdGlvblVybAogICAgICB9OwoKICAgICAgZnVuY3Rpb24gWGhyKCkgewoKICAgICAgICBmdW5jdGlvbiBzdHJpbmdpZnkodXJsUGFyYW1zKSB7CiAgICAgICAgICB2YXIgcGFyYW1zID0gW107CiAgICAgICAgICBmb3IgKHZhciBwIGluIHVybFBhcmFtcykgewogICAgICAgICAgICBpZiAodXJsUGFyYW1zLmhhc093blByb3BlcnR5KHApKSB7CiAgICAgICAgICAgICAgcGFyYW1zLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KHApICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybFBhcmFtc1twXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcGFyYW1zLmpvaW4oIiYiKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGJ1aWxkVXJsUGFyYW1ldGVycyh1cmwsIG9yaWdpbmFsUGFyYW1zKSB7CiAgICAgICAgICB2YXIgcHJvcHMgPSBvcmlnaW5hbFBhcmFtcyB8fCB7fTsKCiAgICAgICAgICBwcm9wcy5fY2hhbm5lbF9pZCA9IHNldHRpbmdzLmNoYW5uZWxJZDsKICAgICAgICAgIHByb3BzLl9wYXJ0bmVyX2lkID0gc2V0dGluZ3MucGFydG5lcklkOwogICAgICAgICAgcHJvcHMuX3N1Yl9pZCA9IHNldHRpbmdzLnN1YklkOwogICAgICAgICAgcHJvcHMuX2FwcF92ZXJzaW9uID0gc2V0dGluZ3MudmVyc2lvbjsKICAgICAgICAgIHByb3BzLl9hcHAgPSBzZXR0aW5ncy50eXBlOwoKICAgICAgICAgIHJldHVybiB1cmwgKyAnPycgKyBzdHJpbmdpZnkocHJvcHMpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaW5pdFhtbEh0dHBSZXF1ZXN0KGNhbGxiYWNrKSB7CiAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PSA0ICYmICh4aHIuc3RhdHVzID09IDIwMCB8fCB4aHIuc3RhdHVzID09IDIwNCkpIHsKICAgICAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlOwoKICAgICAgICAgIHJldHVybiB4aHI7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnNlbmRHZXQgPSBmdW5jdGlvbih0aGVVcmwsIHBhcmFtcywgY2FsbGJhY2spIHsKICAgICAgICAgIHZhciB1cmwgPSBidWlsZFVybFBhcmFtZXRlcnModGhlVXJsLCBwYXJhbXMpOwogICAgICAgICAgdmFyIHhociA9IGluaXRYbWxIdHRwUmVxdWVzdChjYWxsYmFjayk7CiAgICAgICAgICB4aHIub3BlbigiR0VUIiwgdXJsLCB0cnVlKTsKICAgICAgICAgIHhoci5zZW5kKCk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5zZW5kUG9zdCA9IGZ1bmN0aW9uKHRoZVVybCwgcGFyYW1zLCBkYXRhLCBjYWxsYmFjaykgewogICAgICAgICAgdmFyIHVybCA9IGJ1aWxkVXJsUGFyYW1ldGVycyh0aGVVcmwsIHBhcmFtcyk7CiAgICAgICAgICB2YXIgeGhyID0gaW5pdFhtbEh0dHBSZXF1ZXN0KGNhbGxiYWNrKTsKICAgICAgICAgIHhoci5vcGVuKCJQT1NUIiwgdXJsLCB0cnVlKTsKICAgICAgICAgIHhoci5zZW5kKGRhdGEpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIE5hdmlnYXRpb25MaXN0ZW5lcigpIHsKICAgICAgICB2YXIgY29tcG9zZXIgPSBuZXcgTmF2aWdhdGlvbkNvbXBvc2VyKCk7CiAgICAgICAgdmFyIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CgogICAgICAgIGZ1bmN0aW9uIGFkZExvY2F0aW9uQ2hhbmdlRGV0ZWN0aW9uKCkgewogICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChsb2NhdGlvbiAhPSB3aW5kb3cubG9jYXRpb24uaHJlZikgewogICAgICAgICAgICAgIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgICAgY29tcG9zZXIuY29tcG9zZUV2ZW50KCJtYWluX2ZyYW1lX3VybCIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgY29tcG9zZXIuY29tcG9zZUV2ZW50KCJtYWluX2ZyYW1lIik7CiAgICAgICAgICBhZGRMb2NhdGlvbkNoYW5nZURldGVjdGlvbigpOwoKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIE5hdmlnYXRpb25Db21wb3NlcigpIHsKICAgICAgICB2YXIgc2VuZGVyID0gbmV3IFdlYkV2ZW50U2VuZGVyKCk7CiAgICAgICAgdmFyIHBhcmVudEV2ZW50SWQ7CgogICAgICAgIGZ1bmN0aW9uIGlzQnJvd3Nlcihicm93c2VyTmFtZSkgewogICAgICAgICAgcmV0dXJuIG5hdmlnYXRvciAmJiBuYXZpZ2F0b3IudXNlckFnZW50ICYmIG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKGJyb3dzZXJOYW1lKSAhPSAtMTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEhhc2godXJsKSB7CiAgICAgICAgICB2YXIgaGFzaCA9IDAsCiAgICAgICAgICAgIGNocjsKCiAgICAgICAgICBmb3IgKHZhciBpZHggPSAwLCBsZW4gPSB1cmwubGVuZ3RoOyBpZHggPCBsZW47IGlkeCsrKSB7CiAgICAgICAgICAgIGNociA9IHVybC5jaGFyQ29kZUF0KGlkeCk7CiAgICAgICAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNocjsKICAgICAgICAgICAgaGFzaCB8PSAwOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGhhc2ggPCAwID8gLTEgKiBoYXNoIDogaGFzaDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNvbXBvc2VFdmVudElkcyh0cywgdXJsKSB7CiAgICAgICAgICByZXR1cm4gU3RyaW5nKHRzKSArIGdldEhhc2godXJsKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEJyb3dzZXJOYW1lKCkgewogICAgICAgICAgaWYgKGlzQnJvd3NlcigiY2hyb21lIikpIHsKICAgICAgICAgICAgcmV0dXJuICJjaHJvbWUiOwogICAgICAgICAgfSBlbHNlIGlmIChpc0Jyb3dzZXIoImZpcmVmb3giKSkgewogICAgICAgICAgICByZXR1cm4gImZpcmVmb3giCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gInVua25vd24iOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb21wb3NlRXZlbnQgPSBmdW5jdGlvbihldmVudFR5cGUpIHsKICAgICAgICAgIHZhciBldmVudCA9IHt9OwogICAgICAgICAgZXZlbnQudGltZVN0YW1wID0gRGF0ZS5ub3coKTsKICAgICAgICAgIGV2ZW50LnVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgZXZlbnQucmVxdWVzdFR5cGUgPSAibWFpbiI7CiAgICAgICAgICBldmVudC50eXBlID0gZXZlbnRUeXBlOwogICAgICAgICAgZXZlbnQuZXZlbnRJZCA9IGNvbXBvc2VFdmVudElkcyhldmVudC50aW1lU3RhbXAsIGV2ZW50LnVybCk7CgogICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT0gIm1haW5fZnJhbWUiKSB7CiAgICAgICAgICAgIHBhcmVudEV2ZW50SWQgPSBldmVudC5ldmVudElkOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT0gIm1haW5fZnJhbWVfdXJsIiAmJiBwYXJlbnRFdmVudElkKSB7CiAgICAgICAgICAgIGV2ZW50LnBhcmVudEV2ZW50SWQgPSBwYXJlbnRFdmVudElkOwogICAgICAgICAgfQoKICAgICAgICAgIGV2ZW50LmJyb3dzZXIgPSBnZXRCcm93c2VyTmFtZSgpOwogICAgICAgICAgZXZlbnQuaXNfb25saW5lID0gbmF2aWdhdG9yLm9uTGluZTsKICAgICAgICAgIGV2ZW50LndpbmRvd05hbWUgPSB3aW5kb3cubmFtZTsKICAgICAgICAgIGV2ZW50LndpbmRvd1RpdGxlID0gd2luZG93LmRvY3VtZW50LnRpdGxlOwogICAgICAgICAgZXZlbnQuZG9jdW1lbnRSZWZlcmVyID0gZG9jdW1lbnQucmVmZXJyZXI7CgogICAgICAgICAgc2VuZGVyLnNlbmRXZWJFdmVudChldmVudCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBXZWJFdmVudFNlbmRlcigpIHsKICAgICAgICB0aGlzLnNlbmRXZWJFdmVudCA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICB2YXIgd2ViRXZlbnRMaXN0ID0gbmV3IEFycmF5KEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7CgogICAgICAgICAgdmFyIHBheWxvYWQgPSBidG9hKGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeSh3ZWJFdmVudExpc3QpKSk7CiAgICAgICAgICBBUEkueGhyLnNlbmRQb3N0KHNldHRpbmdzLmNvbGxlY3Rpb25VcmwsIHt9LCBwYXlsb2FkKTsKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgQVBJID0ge307CiAgICAgIC8vQVBJIGluaXRpYWxpemF0aW9uCiAgICAgIEFQSS54aHIgPSBuZXcgWGhyKCk7CiAgICAgIHZhciBuYXZpZ2F0aW9uTGlzdGVuZXIgPSBuZXcgTmF2aWdhdGlvbkxpc3RlbmVyKCk7CiAgICAgIG5hdmlnYXRpb25MaXN0ZW5lci5zdGFydCgpOwogICAgfSkoKTsKICB9LCBmdW5jdGlvbiBpc0F2YWlsYWJsZShpbml0RGF0YSkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHByZWZlcmVuY2UgPSBpbml0RGF0YS5nZXRQcmVmZXJlbmNlOwoKICAgIGlmICghcHJlZmVyZW5jZS5oYXNGc1N0YXQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICghcHJlZmVyZW5jZS5zdGF0RW5hYmxlZCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfSk7CgogIGlmIChtb25vLmxvYWRNb2R1bGUubW9kdWxlTGlzdC5sZW5ndGggPT09IDApIHsKICAgIHJldHVybjsKICB9CgogIHZhciBfcGFnZVJlYWR5ID0gZnVuY3Rpb24oKSB7CiAgICBfcGFnZVJlYWR5ID0gbnVsbDsKCiAgICB2YXIgbW9kdWxlTGlzdCA9IG1vbm8ubG9hZE1vZHVsZS5tb2R1bGVMaXN0OwoKICAgIHZhciBtYWluTW9kdWxlTGlzdCA9IFsKICAgICAgJ2RhaWx5bW90aW9uJywKICAgICAgJ2ZhY2Vib29rJywKICAgICAgJ29kbm9rbGFzc25pa2knLAogICAgICAnbWFpbHJ1JywKICAgICAgJ3NhdmVmcm9tJywKICAgICAgJ3NvdW5kY2xvdWQnLAogICAgICAndmltZW8nLAogICAgICAndmsnLAogICAgICAneW91dHViZScsCiAgICAgICdpbnN0YWdyYW0nLAogICAgICAncnV0dWJlJywKICAgICAgJ2xtJwogICAgXTsKCiAgICBtb2R1bGVMaXN0LnNvbWUoZnVuY3Rpb24obW9kdWxlQXJncykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBtb2R1bGVOYW1lID0gbW9kdWxlQXJnc1swXTsKCiAgICAgIGlmIChtYWluTW9kdWxlTGlzdC5pbmRleE9mKG1vZHVsZU5hbWUpICE9PSAtMSkgewogICAgICAgIF9tb2R1bGVOYW1lID0gbW9kdWxlTmFtZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSk7CgogICAgZW5naW5lLmluaXQoKTsKICB9OwoKICBfcGFnZVJlYWR5ID0gKGZ1bmN0aW9uKGNiKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciB2YWx1ZSA9IG51bGw7CiAgICAgIHRyeSB7CiAgICAgICAgdmFsdWUgPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2VbJ3NhdmVmcm9tLWhlbHBlci1leHRlbnNpb24nXTsKICAgICAgfSBjYXRjaCAoZSkge30KCiAgICAgIGlmICh2YWx1ZSAhPT0gJzEnKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNiKCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgbW9uby5lcnJvcignTG9hZGluZyBlcnJvciEnLCBlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSkoX3BhZ2VSZWFkeSk7CgoKICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgaWYgKFsnaW50ZXJhY3RpdmUnLCAnY29tcGxldGUnXS5pbmRleE9mKGRvY3VtZW50LnJlYWR5U3RhdGUpICE9PSAtMSkgewogICAgICBfcGFnZVJlYWR5KCk7CiAgICB9IGVsc2UgewogICAgICB2YXIgb25SZWFkeSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBvblJlYWR5LCBmYWxzZSk7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBvblJlYWR5LCBmYWxzZSk7CiAgICAgICAgX3BhZ2VSZWFkeSgpOwogICAgICB9OwoKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIG9uUmVhZHksIGZhbHNlKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBvblJlYWR5LCBmYWxzZSk7CiAgICB9CiAgfSwgMTAwMCk7Cn0pKCk7"},{"name":"YouTube Grid & Preview Player","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["http://www.youtube.com/*","https://www.youtube.com/*"],"orig_noframes":true,"orig_run_at":"document-idle","use_blockers":[],"use_connects":["googleapis.com"],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"autoLoadOther":"btrue","autoLoadSearch":"btrue","defEnable":"btrue","gridEnable":"btrue","gridHist":"btrue","gridPlist":"btrue","gridRel":"btrue","gridSearch":"btrue","gridTrend":"btrue","newTab":"bfalse","playerClose":"btrue","playerDef":"sdefault","playerDim":"btrue","playerEnable":"btrue","playerFit":"bfalse","playerFocus":"bfalse","playerNext":"btrue","playerPause":"btrue","playerPos":"s11","playerPosAuto":"bfalse","playerSize":"slarge","rateEnable":"btrue","userLink":"bfalse","ytFocus":"bfalse"},"ts":1471843871976},"enabled":true,"position":3,"file_url":"https://greasyfork.org/scripts/12998-youtube-grid-preview-player/code/YouTube%20Grid%20%20Preview%20Player.user.js","uuid":"1861a35a-db70-41c8-adb9-bfec6440689f","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBZb3VUdWJlIEdyaWQgJiBQcmV2aWV3IFBsYXllcgovLyBAbmFtZXNwYWNlICAgIFlvdVR1YmVHcmlkVmlldwovLyBAdmVyc2lvbiAgICAgIDEuMS43Ci8vIEBkZXNjcmlwdGlvbiAgWW91VHViZSBncmlkIHZpZXcgbGF5b3V0IGFuZCBwcmV2aWV3IHBsYXllci4gVmlkZW8gcmF0aW5ncyBhbmQgZGVmaW5pdGlvbiBpbmZvIG9uIHRodW1icy4gQXV0byBsb2FkIHBhZ2UgY29udGVudCBhbmQgc2VhcmNoIHJlc3VsdHMuCi8vIEBhdXRob3IgICAgICAgQ29zdGFzCi8vIEBtYXRjaCAgICAgICAgaHR0cDovL3d3dy55b3V0dWJlLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgaHR0cHM6Ly93d3cueW91dHViZS5jb20vKgovLyBAaWNvbiAgICAgICAgIGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0NBWUFBQUJ6ZW5yMEFBQUFlVWxFUVZSNDJ1MlV3UTJBTUF3RGs1MllDV2FDbWRncDdRc2hLUDZRS243WXYwcHVkRXFjdUJYTEJYQi83R2FCekZ2M1ozaytBZFlZL3ozY3IrSVpIZ3l3UENaenhydjRUNDhBeUFGQWVLYUgwSUNtcjJHRnVEcEFrUUdPTFJCQU9RQUlqdzVSdHJnNlFKRUJqaTBRUURrQUNJOE9VYllFMEFEYm9ub3djTm42c2dBQUFBQkpSVTVFcmtKZ2dnPT0KLy8gQGdyYW50IAkJIEdNX3NldFZhbHVlCi8vIEBncmFudCAJCSBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBub2ZyYW1lcwovLyA9PS9Vc2VyU2NyaXB0PT0KCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vUmF0aW5nIHRocmVzaG9sZHMKCnZhciByZWRfdGhyZXNob2xkID0gNTA7CnZhciBvcmFuZ2VfdGhyZXNob2xkID0gNzA7CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovL1VzZXJzY3JpcHQgc3BlY2lmaWMgZnVuY3Rpb25zCgp2YXIgZG9jID0gZG9jdW1lbnQ7CnZhciB3aW4gPSB3aW5kb3c7CgppZiAod2luLmZyYW1lRWxlbWVudCkgdGhyb3cgbmV3IEVycm9yKCJTdG9wcGVkIEphdmFTY3JpcHQuIik7CgpmdW5jdGlvbiBzZXRfcHJlZihwcmVmZXJlbmNlLCBuZXdfdmFsdWUpIHsKICAgIEdNX3NldFZhbHVlKHByZWZlcmVuY2UsIG5ld192YWx1ZSk7Cn0KCmZ1bmN0aW9uIGdldF9wcmVmKHByZWZlcmVuY2UpIHsKICAgIHJldHVybiBHTV9nZXRWYWx1ZShwcmVmZXJlbmNlKTsKfQoKZnVuY3Rpb24gaW5pdF9wcmVmKHByZWZlcmVuY2UsIG5ld192YWx1ZSkgewogICAgdmFyIHZhbHVlID0gZ2V0X3ByZWYocHJlZmVyZW5jZSk7CiAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgIHNldF9wcmVmKHByZWZlcmVuY2UsIG5ld192YWx1ZSk7CiAgICAgICAgdmFsdWUgPSBuZXdfdmFsdWU7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7Cn0KCmZ1bmN0aW9uIGh0dHBSZXEodXJsLCBjYWxsYmFjaywgcGFyYW0xLCBwYXJhbTIsIHBhcmFtMywgcGFyYW00KSB7CiAgICAvL21lc3NhZ2UodXJsKTsKCiAgICBHTV94bWxodHRwUmVxdWVzdCh7CiAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICB1cmw6IHVybCwKICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAvL21lc3NhZ2UocmVzcG9uc2UucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UucmVzcG9uc2VUZXh0LCBwYXJhbTEsIHBhcmFtMiwgcGFyYW0zLCBwYXJhbTQpOwogICAgICAgIH0KICAgIH0pOwp9Cgp2YXIgbXlwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFN0eWxlcwoKdmFyIHN0eWxlX2Fkc19vdGhlciA9ICJcCi8qIHJlbW92ZSBhZHMgKi9cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfc2VhcmNoXSAjZ29vZ2xlX2ZsYXNoX2lubGluZV9kaXYsXAojY29udGVudFtncmlkdHViZV9hdXRvX2xvYWRfc2VhcmNoXSAjZ29vZ2xlX2ZsYXNoX2lubGluZV9kaXYsXAojY29udGVudFtncmlkdHViZV9ncmlkX3NlYXJjaF0gLmJyYW5kZWQtcGFnZS12Mi1zZWNvbmRhcnktY29sLFwKI2NvbnRlbnRbZ3JpZHR1YmVfYXV0b19sb2FkX3NlYXJjaF0gLmJyYW5kZWQtcGFnZS12Mi1zZWNvbmRhcnktY29sLFwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9zZWFyY2hdIC5weXYtYWZjLWFkcy1jb250YWluZXIsXAojY29udGVudFtncmlkdHViZV9hdXRvX2xvYWRfc2VhcmNoXSAucHl2LWFmYy1hZHMtY29udGFpbmVyIHtkaXNwbGF5Om5vbmUgIWltcG9ydGFudDt9XAovKiBoaWRlIHBhZ2VyICovXAojY29udGVudFtncmlkdHViZV9hdXRvX2xvYWRfc2VhcmNoXSAuc2VhcmNoLXBhZ2VyIHtkaXNwbGF5Om5vbmUgIWltcG9ydGFudDt9XAovKiB1c2VyIGxpbmtzICovXAphW2dyaWR0dWJlX21ldGFfdXNlcl9tYXJrMl0ge2Rpc3BsYXk6aW5saW5lICFpbXBvcnRhbnQ7IHRleHQtZGVjb3JhdGlvbjpub25lICFpbXBvcnRhbnQ7fVwKYVtncmlkdHViZV9tZXRhX3VzZXJfbWFyazJdOmhvdmVyIHt0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lICFpbXBvcnRhbnQ7fVwKbGkudmlkZW8tbGlzdC1pdGVtLnJlbGF0ZWQtbGlzdC1pdGVtOmhvdmVyIGFbZ3JpZHR1YmVfbWV0YV91c2VyX21hcmsyXSB7Y29sb3I6IzE2N2FjNiAhaW1wb3J0YW50O31cCi8qIHdhdGNoZWQgdmlkZW9zICovXAoud2F0Y2hlZCAudmlkZW8tdGh1bWIge29wYWNpdHk6MSAhaW1wb3J0YW50O31cCiI7Cgp2YXIgc3R5bGVfZ3JpZF9zZWFyY2ggPSAiXAovKkdyaWQgZm9yIHNlYXJjaCByZXN1bHRzKi9cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfc2VhcmNoXSB7d2lkdGg6IDk2JSAhaW1wb3J0YW50O31cCiNyZXN1bHRzIC5pdGVtLXNlY3Rpb24ge21hcmdpbi1sZWZ0OjVweCAhaW1wb3J0YW50O31cCiNyZXN1bHRzIG9sLml0ZW0tc2VjdGlvbiA+IGxpIHt3aWR0aDogMTk2cHggIWltcG9ydGFudDsgaGVpZ2h0OiAxOTZweCAhaW1wb3J0YW50OyBmbG9hdDogbGVmdCAhaW1wb3J0YW50OyBtYXJnaW46NXB4IDEwcHggIWltcG9ydGFudDsgb3ZlcmZsb3c6aGlkZGVuICFpbXBvcnRhbnQ7fVwKI3Jlc3VsdHMgb2wuaXRlbS1zZWN0aW9uID4gbGk6aG92ZXIge292ZXJmbG93OnZpc2libGUgIWltcG9ydGFudDt9XAojcmVzdWx0cyBvbC5pdGVtLXNlY3Rpb24gPiBsaTpob3ZlciA+IGRpdiB7ei1pbmRleDoxICFpbXBvcnRhbnQ7IGJhY2tncm91bmQtY29sb3I6d2hpdGUgIWltcG9ydGFudDt9XAojcmVzdWx0cyBvbC5pdGVtLXNlY3Rpb24gPiBsaSA+IGRpdiB7cGFkZGluZzowcHggMHB4IDNweCAwcHggIWltcG9ydGFudDt9XAojcmVzdWx0cyAueXQtbG9ja3VwLWNoYW5uZWwgLnZpZGVvLXRodW1iIHtmbG9hdDpsZWZ0ICFpbXBvcnRhbnQ7fVwKI3Jlc3VsdHMgLnl0LWxvY2t1cC1jb250ZW50IHtmbG9hdDpsZWZ0ICFpbXBvcnRhbnQ7IHdpZHRoOjEwMCUgIWltcG9ydGFudDt9XAojcmVzdWx0cyAueXQtbG9ja3VwLXRpdGxlIHtmb250LXNpemU6IDEzcHggIWltcG9ydGFudDsgbGluZS1oZWlnaHQ6MS4yZW0gIWltcG9ydGFudDsgbWF4LWhlaWdodDoyLjRlbSAhaW1wb3J0YW50OyBtYXJnaW4tYm90dG9tOjFweCAhaW1wb3J0YW50O31cCiNyZXN1bHRzIC55dC1sb2NrdXAtdGl0bGUgLnl0LXVpeC10aWxlLWxpbmsge2xpbmUtaGVpZ2h0OjEuMmVtICFpbXBvcnRhbnQ7fVwKI3Jlc3VsdHMgLnl0LWxvY2t1cC1ieWxpbmUge2ZvbnQtc2l6ZTogMTFweCAhaW1wb3J0YW50OyBsaW5lLWhlaWdodDoxM3B4ICFpbXBvcnRhbnQ7fVwKI3Jlc3VsdHMgLnl0LWxvY2t1cC1tZXRhIHtmb250LXNpemU6IDExcHggIWltcG9ydGFudDsgbGluZS1oZWlnaHQ6MTNweCAhaW1wb3J0YW50O31cCiNyZXN1bHRzIC55dC1sb2NrdXAtZGVzY3JpcHRpb24ge2ZvbnQtc2l6ZTogMTBweCAhaW1wb3J0YW50OyBsaW5lLWhlaWdodDoxMnB4ICFpbXBvcnRhbnQ7fVwKI3Jlc3VsdHMgLnl0LWxvY2t1cC1iYWRnZXMge21hcmdpbjowcHggIWltcG9ydGFudDt9XAojcmVzdWx0cyAueXQtbG9ja3VwLXBsYXlsaXN0LWl0ZW1zIHttYXJnaW46MHB4ICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9zZWFyY2hdICNyZXN1bHRzIC55dC1sb2NrdXAtYWN0aW9uLW1lbnUge21hcmdpbi1yaWdodDotOHB4ICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9zZWFyY2hdOm5vdChbZ3JpZHR1YmVfYXV0b19sb2FkX3NlYXJjaF0pIC5zZWFyY2gtcGFnZXIge2Rpc3BsYXk6aW5saW5lLWJsb2NrICFpbXBvcnRhbnQ7IHdpZHRoOjEwMCUgIWltcG9ydGFudDsgbWFyZ2luLXRvcDo1MHB4ICFpbXBvcnRhbnQ7fVwKIjsKCnZhciBzdHlsZV9ncmlkX2hpc3RvcnkgPSAiXAovKkdyaWQgZm9yIGhpc3RvcnkqL1wKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9oaXN0XSB7d2lkdGg6IDk2JSAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfaGlzdF0gI2Jyb3dzZS1pdGVtcy1wcmltYXJ5IHttYXJnaW4tbGVmdDoxMHB4ICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9oaXN0XSAuaXRlbS1zZWN0aW9uLWhlYWRlciB7bWFyZ2luLWxlZnQ6LTVweCAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfaGlzdF0gb2wuaXRlbS1zZWN0aW9uID4gbGk6bm90KC5pdGVtLXNlY3Rpb24taGVhZGVyKSB7d2lkdGg6IDE5NnB4ICFpbXBvcnRhbnQ7IGhlaWdodDogMTk2cHggIWltcG9ydGFudDsgZmxvYXQ6IGxlZnQgIWltcG9ydGFudDsgbWFyZ2luOjVweCAxMHB4ICFpbXBvcnRhbnQ7IG92ZXJmbG93OmhpZGRlbiAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfaGlzdF0gb2wuaXRlbS1zZWN0aW9uID4gbGk6bm90KC5pdGVtLXNlY3Rpb24taGVhZGVyKTpob3ZlciB7b3ZlcmZsb3c6dmlzaWJsZSAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfaGlzdF0gb2wuaXRlbS1zZWN0aW9uID4gbGk6bm90KC5pdGVtLXNlY3Rpb24taGVhZGVyKTpob3ZlciA+IGRpdiB7ei1pbmRleDoxICFpbXBvcnRhbnQ7IGJhY2tncm91bmQtY29sb3I6d2hpdGUgIWltcG9ydGFudDt9XAojY29udGVudFtncmlkdHViZV9ncmlkX2hpc3RdIG9sLml0ZW0tc2VjdGlvbiA+IGxpOm5vdCguaXRlbS1zZWN0aW9uLWhlYWRlcikgPiBkaXYge3BhZGRpbmc6MHB4IDBweCAzcHggMHB4ICFpbXBvcnRhbnQ7IGJvcmRlci1ib3R0b206MHB4ICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9oaXN0XSAueXQtbG9ja3VwLWNoYW5uZWwgLnZpZGVvLXRodW1iIHtmbG9hdDpsZWZ0ICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9oaXN0XSAueXQtbG9ja3VwLWNvbnRlbnQge2Zsb2F0OmxlZnQgIWltcG9ydGFudDsgd2lkdGg6MTAwJSAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfaGlzdF0gLnl0LWxvY2t1cC10aXRsZSB7Zm9udC1zaXplOjEzcHggIWltcG9ydGFudDsgbGluZS1oZWlnaHQ6MS4yZW0gIWltcG9ydGFudDsgbWF4LWhlaWdodDoyLjRlbSAhaW1wb3J0YW50OyBtYXJnaW4tYm90dG9tOjFweCAhaW1wb3J0YW50OyBtYXJnaW4tcmlnaHQ6MTVweCAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfaGlzdF0gLnl0LWxvY2t1cC10aXRsZSAueXQtdWl4LXRpbGUtbGluayB7bGluZS1oZWlnaHQ6MS4yZW0gIWltcG9ydGFudDsgbWFyZ2luLXJpZ2h0OjBweCAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfaGlzdF0gLnl0LWxvY2t1cC1ieWxpbmUge2ZvbnQtc2l6ZTogMTFweCAhaW1wb3J0YW50OyBsaW5lLWhlaWdodDoxM3B4ICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9oaXN0XSAueXQtbG9ja3VwLW1ldGEge2ZvbnQtc2l6ZTogMTFweCAhaW1wb3J0YW50OyBsaW5lLWhlaWdodDoxM3B4ICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF9oaXN0XSAueXQtbG9ja3VwLWRlc2NyaXB0aW9uIHtmb250LXNpemU6IDEwcHggIWltcG9ydGFudDsgbGluZS1oZWlnaHQ6MTJweCAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfaGlzdF0gLnl0LWxvY2t1cC1iYWRnZXMge21hcmdpbjowcHggIWltcG9ydGFudDt9XAojY29udGVudFtncmlkdHViZV9ncmlkX2hpc3RdIC55dC11aXgtbWVudS10b3AtbGV2ZWwtYnV0dG9uLWNvbnRhaW5lciB7bWFyZ2luLXJpZ2h0Oi00cHggIWltcG9ydGFudDt9XAoiOwoKdmFyIHN0eWxlX2dyaWRfdHJlbmRpbmcgPSAiXAovKkdyaWQgZm9yIHRyZW5kaW5nKi9cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfdHJlbmRdIHt3aWR0aDogOTYlICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF90cmVuZF0gLmV4cGFuZGVkLXNoZWxmLWNvbnRlbnQtaXRlbS13cmFwcGVyIHt3aWR0aDogMTk2cHggIWltcG9ydGFudDsgaGVpZ2h0OiAxOTZweCAhaW1wb3J0YW50OyBmbG9hdDogbGVmdCAhaW1wb3J0YW50OyBtYXJnaW46NXB4IDEwcHggIWltcG9ydGFudDsgb3ZlcmZsb3c6aGlkZGVuICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF90cmVuZF0gLnl0LWxvY2t1cC1jaGFubmVsIC52aWRlby10aHVtYiB7ZmxvYXQ6bGVmdCAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfdHJlbmRdIC55dC1sb2NrdXAtY29udGVudCB7ZmxvYXQ6bGVmdCAhaW1wb3J0YW50OyB3aWR0aDoxMDAlICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF90cmVuZF0gLnl0LWxvY2t1cC10aXRsZSB7Zm9udC1zaXplOjEzcHggIWltcG9ydGFudDsgbGluZS1oZWlnaHQ6MS4yZW0gIWltcG9ydGFudDsgbWF4LWhlaWdodDoyLjRlbSAhaW1wb3J0YW50OyBtYXJnaW4tYm90dG9tOjFweCAhaW1wb3J0YW50O31cCiNjb250ZW50W2dyaWR0dWJlX2dyaWRfdHJlbmRdIC55dC1sb2NrdXAtdGl0bGUgLnl0LXVpeC10aWxlLWxpbmsge2xpbmUtaGVpZ2h0OjEuMmVtICFpbXBvcnRhbnQ7IG1hcmdpbi1yaWdodDowcHggIWltcG9ydGFudDt9XAojY29udGVudFtncmlkdHViZV9ncmlkX3RyZW5kXSAueXQtbG9ja3VwLWJ5bGluZSB7Zm9udC1zaXplOiAxMXB4ICFpbXBvcnRhbnQ7IGxpbmUtaGVpZ2h0OjEzcHggIWltcG9ydGFudDt9XAojY29udGVudFtncmlkdHViZV9ncmlkX3RyZW5kXSAueXQtbG9ja3VwLW1ldGEge2ZvbnQtc2l6ZTogMTFweCAhaW1wb3J0YW50OyBsaW5lLWhlaWdodDoxM3B4ICFpbXBvcnRhbnQ7fVwKI2NvbnRlbnRbZ3JpZHR1YmVfZ3JpZF90cmVuZF0gLnl0LWxvY2t1cC1kZXNjcmlwdGlvbiB7Zm9udC1zaXplOiAxMHB4ICFpbXBvcnRhbnQ7IGxpbmUtaGVpZ2h0OjEycHggIWltcG9ydGFudDt9XAoiOwoKdmFyIHN0eWxlX2dyaWRfcmVsYXRlZCA9ICJcCi8qR3JpZCBmb3IgcmVsYXRlZCovXAojd2F0Y2g3LXNpZGViYXItYWRzIHtkaXNwbGF5Om5vbmUgIWltcG9ydGFudDt9IC8qYWRzKi9cCi8qI3dhdGNoNy1zaWRlYmFyLWNvbnRlbnRzIHttaW4taGVpZ2h0OjE3NzBweCAhaW1wb3J0YW50O30qL1wKI3dhdGNoLXJlbGF0ZWQge3Bvc2l0aW9uOmFic29sdXRlICFpbXBvcnRhbnQ7fVwKI3dhdGNoLXJlbGF0ZWQgbGk6bm90KC5yZWxhdGVkLWxpc3QtaXRlbSkge2Rpc3BsYXk6bm9uZSAhaW1wb3J0YW50O30gLyphZHMqL1wKI3dhdGNoLXJlbGF0ZWQgbGkge3dpZHRoOiAxOTVweCAhaW1wb3J0YW50OyBoZWlnaHQ6MTYwcHggIWltcG9ydGFudDsgbWFyZ2luLWJvdHRvbTowcHggIWltcG9ydGFudDsgZmxvYXQ6IGxlZnQgIWltcG9ydGFudDsgb3ZlcmZsb3c6aGlkZGVuICFpbXBvcnRhbnQ7fVwKI3dhdGNoLXJlbGF0ZWQgLmNvbnRlbnQtd3JhcHBlciB7d2lkdGg6MTY4cHggIWltcG9ydGFudDsgbWFyZ2luLWxlZnQ6NXB4ICFpbXBvcnRhbnQ7IG1hcmdpbi10b3A6OTRweCAhaW1wb3J0YW50O31cCiN3YXRjaC1yZWxhdGVkIC55dC1wbC10aHVtYi1saW5rIC50aXRsZSB7d2lkdGg6MTY4cHggIWltcG9ydGFudDsgbWFyZ2luLXRvcDo5NXB4ICFpbXBvcnRhbnQ7fVwKI3dhdGNoLXJlbGF0ZWQgLnRpdGxlIHtmb250LXNpemU6MTJweCAhaW1wb3J0YW50OyBsaW5lLWhlaWdodDoxLjJlbSAhaW1wb3J0YW50OyBtYXgtaGVpZ2h0OjIuNGVtICFpbXBvcnRhbnQ7IG1hcmdpbjoxcHggMHB4ICFpbXBvcnRhbnQ7fVwKIjsKCnZhciBzdHlsZV9ncmlkX3BsaXN0ID0gIlwKLypHcmlkIGZvciBwbGF5bGlzdHMqL1wKLnBsLXZpZGVvIHtwb3NpdGlvbjpyZWxhdGl2ZSAhaW1wb3J0YW50OyB3aWR0aDoyNTBweCAhaW1wb3J0YW50OyBoZWlnaHQ6MjAwcHggIWltcG9ydGFudDsgbWFyZ2luLXRvcDo1cHggIWltcG9ydGFudDsgbWFyZ2luLWJvdHRvbTo1cHggIWltcG9ydGFudDsgYm9yZGVyLWJvdHRvbTowcHggIWltcG9ydGFudDsgZmxvYXQ6IGxlZnQgIWltcG9ydGFudDsgb3ZlcmZsb3c6aGlkZGVuICFpbXBvcnRhbnQ7fVwKLnBsLXZpZGVvIC5wbC12aWRlby10aHVtYm5haWwge3dpZHRoOiAxOTZweCAhaW1wb3J0YW50OyBwYWRkaW5nLWJvdHRvbToycHggIWltcG9ydGFudDt9XAoucGwtdmlkZW8gLnl0LXRodW1iIHt3aWR0aDogMTk2cHggIWltcG9ydGFudDsgaGVpZ2h0OiAxMTBweCAhaW1wb3J0YW50O31cCi5wbC12aWRlbyAueXQtdGh1bWItY2xpcCA+IGltZyB7d2lkdGg6MTk2cHggIWltcG9ydGFudDsgaGVpZ2h0OmF1dG8gIWltcG9ydGFudDt9XAoucGwtdmlkZW8gLnBsLXZpZGVvLXRpdGxlICB7ZGlzcGxheTpibG9jayAhaW1wb3J0YW50OyBtaW4td2lkdGg6MHB4ICFpbXBvcnRhbnQ7IHdpZHRoOjE5NnB4ICFpbXBvcnRhbnQ7IHBhZGRpbmc6MHB4IDBweCAwcHggMzVweCAhaW1wb3J0YW50O31cCi5wbC12aWRlbyAucGwtdmlkZW8tdGl0bGUtbGluayB7d2lkdGg6MTAwJSAhaW1wb3J0YW50OyBtYXgtaGVpZ2h0OjMuOWVtICFpbXBvcnRhbnQ7IG92ZXJmbG93OmhpZGRlbiAhaW1wb3J0YW50OyB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpcyAhaW1wb3J0YW50O31cCi5wbC12aWRlbyAucGwtdmlkZW8tb3duZXIge21hcmdpbi10b3A6IDBweCAhaW1wb3J0YW50O31cCi5wbC12aWRlbyAucGwtdmlkZW8tYmFkZ2VzIHtwYWRkaW5nOjVweCAwcHggMHB4IDM1cHggIWltcG9ydGFudDt9XAoucGwtdmlkZW8gLnBsLXZpZGVvLWFkZGVkLWJ5IHtkaXNwbGF5Om5vbmUgIWltcG9ydGFudDt9XAoucGwtdmlkZW8gLnBsLXZpZGVvLXRpbWUge3Bvc2l0aW9uOmFic29sdXRlICFpbXBvcnRhbnQ7IHRvcDotMjNweCAhaW1wb3J0YW50OyBsZWZ0OjIwcHggIWltcG9ydGFudDsgdGV4dC1hbGlnbjpsZWZ0ICFpbXBvcnRhbnQ7IGNvbG9yOmdyYXkgIWltcG9ydGFudDt9XAoucGwtdmlkZW8tZWRpdC1vcHRpb25zIHtwb3NpdGlvbjphYnNvbHV0ZSAhaW1wb3J0YW50OyB0b3A6MzdweCAhaW1wb3J0YW50OyByaWdodDotMTI2cHggIWltcG9ydGFudDt9XAoiOwoKdmFyIHN0eWxlX2Jhc2ljID0gIlwKLyogbWVzc2FnZXMgKi9cCi5ncmlkdHViZV9tZXNzYWdlIHtmb250OjEycHgvMTVweCBhcmlhbCxzYW5zLXNlcmlmOyB0ZXh0LWFsaWduOmxlZnQ7IHdoaXRlLXNwYWNlOnByZTsgZmxvYXQ6bGVmdDsgY2xlYXI6Ym90aDsgY29sb3I6YmxhY2s7IGJhY2tncm91bmQ6YmVpZ2U7IG1hcmdpbjoxMHB4IDBweCAwcHggMzAwcHg7IHotaW5kZXg6MjE0NzQ4MzY0Nzt9XAovKiBzZWxlY3Rpb24gaWNvbnMgKi9cCiNncmlkdHViZV9pY29uX2FyZWEge3Bvc2l0aW9uOnJlbGF0aXZlOyBoZWlnaHQ6MjNweDsgd2lkdGg6NThweDsgZmxvYXQ6cmlnaHQgIWltcG9ydGFudDsgY2xlYXI6bm9uZTt9XAouZ3JpZHR1YmVfaWNvbl9hcmVhX3NlYXJjaCwgLmdyaWR0dWJlX2ljb25fYXJlYV9oaXN0IHttYXJnaW46MHB4IDBweCAtN3B4IDEwcHg7fVwKLmdyaWR0dWJlX2ljb25fYXJlYV9wbGlzdCB7bWFyZ2luOi0yNnB4IDEwMHB4IDBweCAwcHg7IGJvcmRlcjoxcHggZG90dGVkIGxpZ2h0Z3JheTsgcGFkZGluZzo1cHg7fVwKI2dyaWR0dWJlX2ljb25fYXJlYSBpbWcge2N1cnNvcjpwb2ludGVyOyBoZWlnaHQ6MTZweDsgd2lkdGg6MTZweDsgcGFkZGluZzo0cHggM3B4IDNweCA0cHg7IG1hcmdpbjowcHggM3B4OyBib3JkZXItcmFkaXVzOjJweDsgcG9zaXRpb246cmVsYXRpdmU7IG92ZXJmbG93OnZpc2libGU7IG9wYWNpdHk6MC44O31cCiNncmlkdHViZV9pY29uX2FyZWEgaW1nOmhvdmVyIHtvcGFjaXR5OjE7fVwKI2dyaWR0dWJlX2ljb25fYXJlYSBpbWdbc2VsZWN0ZWRdIHtib3gtc2hhZG93OjBweCAwcHggMHB4IDFweCBncmF5O31cCi8qIGJvdHRvbSBiYXIgKi9cCiNncmlkdHViZV9ib3R0b21fYXJlYSB7cG9zaXRpb246cmVsYXRpdmU7IGNsZWFyOmJvdGg7IHdpZHRoOjEwMCU7IHBhZGRpbmctYm90dG9tOjIwcHg7fVwKLmdyaWR0dWJlX3Jlc3VsdF9iYXIge3Bvc2l0aW9uOnJlbGF0aXZlOyB3aWR0aDo1MCU7IGhlaWdodDo4NHB4OyBjbGVhcjpib3RoOyBtYXJnaW46YXV0bzt9XAouZ3JpZHR1YmVfcmVzdWx0X2Jhcl9pbm5lciB7Zm9udDpib2xkIDE4cHgvMzRweCBhcmlhbCxzYW5zLXNlcmlmOyB3aWR0aDoxMDAlOyBoZWlnaHQ6MzRweDsgcG9zaXRpb246YWJzb2x1dGU7IHRvcDo0MHB4OyBjb2xvcjpzdGVlbGJsdWU7IGN1cnNvcjpwb2ludGVyOyBib3JkZXItcmFkaXVzOjVweDsgdGV4dC1hbGlnbjpjZW50ZXI7IGJhY2tncm91bmQ6bGluZWFyLWdyYWRpZW50KHdoaXRlLGxpZ2h0Z3JheSk7IG9wYWNpdHk6MC44OyBvdmVyZmxvdzpoaWRkZW47fVwKLmdyaWR0dWJlX3Jlc3VsdF9iYXJfaW5uZXI6aG92ZXIge29wYWNpdHk6MTt9XAouZ3JpZHR1YmVfcmVzdWx0X2JhciBpbWcge2hlaWdodDoyNnB4OyB3aWR0aDoyNnB4OyBtYXJnaW4tcmlnaHQ6N3B4OyB2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7fVwKLyogcHJlZnMgKi9cCiNncmlkdHViZV9wcmVmX3BvcHVwIHtmb250OjExcHgvMTFweCBhcmlhbCxzYW5zLXNlcmlmOyBjb2xvcjp3aGl0ZTsgYmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoIzc4ODg5OCwjNjg3ODg4KTsgcGFkZGluZzo1cHg7IGJvcmRlci1yYWRpdXM6NXB4OyBib3gtc2hhZG93OjBweCAwcHggNXB4IDVweCBzbGF0ZWdyYXk7IC8qei1pbmRleDoyMTQ3NDgzNjQ3OyovIHotaW5kZXg6MjE0NzQ4MzY0Njt9XAojZ3JpZHR1YmVfcHJlZl9wb3B1cFt0b3BdIHtwb3NpdGlvbjpmaXhlZDsgcmlnaHQ6MHB4OyB0b3A6MHB4O31cCiNncmlkdHViZV9wcmVmX3BvcHVwW2JvdHRvbV0ge3Bvc2l0aW9uOmZpeGVkOyByaWdodDowcHg7IGJvdHRvbTowcHg7fVwKI2dyaWR0dWJlX3ByZWZfcG9wdXAgPiBkaXYgIHtwYWRkaW5nOjJweDt9XAouZ3JpZHR1YmVfcHJlZl9ncm91cCB7bWFyZ2luLWxlZnQ6MTVweDsgY29sb3I6eWVsbG93O31cCi5ncmlkdHViZV9wcmVmX2dyb3VwID4gc3BhbiB7cGFkZGluZzoycHg7fVwKI2dyaWR0dWJlX3ByZWZfY2xvc2Uge2ZvbnQ6MTRweC8xNHB4IGFyaWFsLHNhbnMtc2VyaWY7IGNvbG9yOmJsYWNrOyBwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjNweDsgcmlnaHQ6NXB4OyBjdXJzb3I6cG9pbnRlcjt9XAojZ3JpZHR1YmVfcHJlZl9jbG9zZTpob3ZlciB7Y29sb3I6bGlnaHRncmF5O31cCiNncmlkdHViZV9wcmVmX3RpdGxlIHtmb250OmJvbGQgMTRweC8xNHB4IGFyaWFsLHNhbnMtc2VyaWY7IHBhZGRpbmc6NXB4ICFpbXBvcnRhbnQ7IGNvbG9yOmFsaWNlYmx1ZTt9XAojZ3JpZHR1YmVfcHJlZl9idXR0b24ge2N1cnNvcjpwb2ludGVyOyB3aWR0aDoyMHB4OyBoZWlnaHQ6MjBweDsgYmFja2dyb3VuZC1zaXplOmNvbnRhaW47IGJhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDsgb3BhY2l0eTowLjc7fVwKI2dyaWR0dWJlX3ByZWZfYnV0dG9uW3RvcF0ge3Bvc2l0aW9uOmFic29sdXRlOyByaWdodDowcHg7IHRvcDowcHg7IHZpc2liaWxpdHk6aGlkZGVuOyB6LWluZGV4OjEwO31cCiNncmlkdHViZV9wcmVmX2J1dHRvbltib3R0b21dIHtwb3NpdGlvbjpmaXhlZDsgcmlnaHQ6MHB4OyBib3R0b206MHB4OyB2aXNpYmlsaXR5OnZpc2libGU7fVwKI2dyaWR0dWJlX3ByZWZfYnV0dG9uOmhvdmVyIHtvcGFjaXR5OjAuOTt9XAojZ3JpZHR1YmVfcHJlZl9idXR0b24ge2JhY2tncm91bmQtaW1hZ2U6IHVybCgnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQ0FZQUFBQnplbnIwQUFBQWVVbEVRVlI0MnUyVXdRMkFNQXdEazUyWUNXYUNtZGdwN1FzaEtQNlFLbjdZdjBwdWRFcWN1QlhMQlhCLzdHYUJ6RnYzWjNrK0FkWVkvejNjcitJWkhneXdQQ1p6eHJ2NFQ0OEF5QUZBZUthSDBJQ21yMkdGdURwQWtRR09MUkJBT1FBSWp3NVJ0cmc2UUpFQmppMFFRRGtBQ0k4T1ViWUUwQURib25vd2NObjZzZ0FBQUFCSlJVNUVya0pnZ2c9PScpO31cCiN5dC1tYXN0aGVhZC1jb250YWluZXI6aG92ZXIgICNncmlkdHViZV9wcmVmX2J1dHRvbiB7dmlzaWJpbGl0eTp2aXNpYmxlICFpbXBvcnRhbnQ7fVwKLyogbWV0YSBkYXRhICovXAouZ3JpZHR1YmVfbWV0YV9kZWZfY29udGFpbmVyIHtmb250OmJvbGQgMTBweC8xM3B4IGFyaWFsLHNhbnMtc2VyaWY7IHBvc2l0aW9uOmFic29sdXRlOyBib3R0b206MHB4OyBsZWZ0OjBweDsgYmFja2dyb3VuZDojRjBGMEYwOyBwYWRkaW5nOjBweCAzcHg7IGJvcmRlci1yYWRpdXM6MnB4OyBvcGFjaXR5OjAuOTsgZGlzcGxheTpub25lOyBjdXJzb3I6ZGVmYXVsdDt9XAouZ3JpZHR1YmVfbWV0YV9kZWZfY29udGFpbmVyW3JldmVhbF0ge2Rpc3BsYXk6YmxvY2s7fVwKLmdyaWR0dWJlX21ldGFfZGVmX2NvbnRhaW5lcltzcGFjZV0gLmdyaWR0dWJlX21ldGFfZGVmX2hkIHttYXJnaW4tcmlnaHQ6M3B4O31cCi5ncmlkdHViZV9tZXRhX2RlZl9mb3JtYXQge3Bvc2l0aW9uOnJlbGF0aXZlOyBjb2xvcjpibGFjazt9XAouZ3JpZHR1YmVfbWV0YV9kZWZfaGQge3Bvc2l0aW9uOnJlbGF0aXZlOyBjb2xvcjptYWdlbnRhO31cCi5ncmlkdHViZV9tZXRhX3JhdGUge2ZvbnQ6Ym9sZCAxMHB4LzEzcHggYXJpYWwsc2Fucy1zZXJpZjsgcG9zaXRpb246YWJzb2x1dGU7IHRvcDowcHg7IHJpZ2h0OjBweDsgYmFja2dyb3VuZDpncmVlbjsgY29sb3I6d2hpdGU7IG9wYWNpdHk6MC45OyBwYWRkaW5nOjBweCAzcHg7IGJvcmRlci1yYWRpdXM6MnB4OyBjdXJzb3I6ZGVmYXVsdDt9XAouZ3JpZHR1YmVfbWV0YV9yYXRlW2JhZF0ge2JhY2tncm91bmQ6cmVkICFpbXBvcnRhbnQ7fVwKLmdyaWR0dWJlX21ldGFfcmF0ZVttZWRdIHtiYWNrZ3JvdW5kOmRhcmtvcmFuZ2UgIWltcG9ydGFudDt9XAojZ3JpZHR1YmVfbWV0YV9ib3gge3Bvc2l0aW9uOnJlbGF0aXZlOyBmbG9hdDpsZWZ0OyBoZWlnaHQ6MTNweDsgbWFyZ2luLXRvcDozcHg7fVwKI2dyaWR0dWJlX21ldGFfYm94IC5ncmlkdHViZV9tZXRhX2RlZl9jb250YWluZXIge2ZvbnQ6Ym9sZCAxMXB4LzEzcHggYXJpYWwsc2Fucy1zZXJpZjsgb3BhY2l0eToxOyBwb3NpdGlvbjpyZWxhdGl2ZTsgY2xlYXI6bm9uZTsgZmxvYXQ6bGVmdDsgYmFja2dyb3VuZDp3aGl0ZTt9XAojZ3JpZHR1YmVfbWV0YV9ib3ggLmdyaWR0dWJlX21ldGFfcmF0ZSB7b3BhY2l0eToxOyBwb3NpdGlvbjpyZWxhdGl2ZTsgY2xlYXI6bm9uZTsgZmxvYXQ6cmlnaHQ7IG1hcmdpbi1sZWZ0OjVweDt9XAojZ3JpZHR1YmVfdGl0bGVfY29udGFpbmVyIHtwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjVweDsgcmlnaHQ6MHB4O31cCi8qIHBsYXkgYnV0dG9uKi9cCiNncmlkdHViZV9tZXRhX3BsYXlpbmcge2ZvbnQ6Ym9sZCAxMnB4LzEycHggYXJpYWwsc2Fucy1zZXJpZjsgcG9zaXRpb246YWJzb2x1dGU7IHRvcDowcHg7IGxlZnQ6MHB4OyBiYWNrZ3JvdW5kOnJlZDsgY29sb3I6d2hpdGU7IG9wYWNpdHk6MC45OyBwYWRkaW5nOjNweCA1cHg7IGJvcmRlci1yYWRpdXM6MnB4OyBjdXJzb3I6ZGVmYXVsdDsgei1pbmRleDoxO31cCipbZ3JpZHR1YmVfbWV0YV90aHVtYl9tYXJrXTpob3ZlciAuZ3JpZHR1YmVfbWV0YV9wbGF5IHt2aXNpYmlsaXR5OnZpc2libGUgIWltcG9ydGFudDt9XAouZ3JpZHR1YmVfbWV0YV9wbGF5X2NvbnRhaW5lciB7cG9zaXRpb246YWJzb2x1dGU7IGJvdHRvbTowcHg7IGxlZnQ6MHB4OyB3aWR0aDoxMDAlOyB2aXNpYmlsaXR5OmhpZGRlbjt9XAouZ3JpZHR1YmVfbWV0YV9wbGF5IHt2aXNpYmlsaXR5OmhpZGRlbiAhaW1wb3J0YW50OyBkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnQ7IHBvc2l0aW9uOnJlbGF0aXZlICFpbXBvcnRhbnQ7IHBhZGRpbmctYm90dG9tOjFweCAhaW1wb3J0YW50OyBtYXJnaW46MHB4IGF1dG8gIWltcG9ydGFudDsgd2lkdGg6MjVweCAhaW1wb3J0YW50OyBoZWlnaHQ6MjVweCAhaW1wb3J0YW50OyBvcGFjaXR5OjAuNzUgIWltcG9ydGFudDsgY3Vyc29yOnBvaW50ZXIgIWltcG9ydGFudDsgYmFja2dyb3VuZC1zaXplOiAyNXB4ICFpbXBvcnRhbnQ7IGJhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdCAhaW1wb3J0YW50OyB0ZXh0LWRlY29yYXRpb246bm9uZSAhaW1wb3J0YW50O31cCi5ncmlkdHViZV9tZXRhX3BsYXk6aG92ZXIge29wYWNpdHk6MSAhaW1wb3J0YW50O31cCi5ncmlkdHViZV9tZXRhX3BsYXkge2JhY2tncm91bmQtaW1hZ2U6IHVybCgnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQ0FZQUFBQnplbnIwQUFBQUJITkNTVlFJQ0FnSWZBaGtpQUFBQUFsd1NGbHpBQUFHN0FBQUJ1d0JIblU0TlFBQUFCbDBSVmgwVTI5bWRIZGhjbVVBZDNkM0xtbHVhM05qWVhCbExtOXlaNXZ1UEJvQUFBT3FTVVJCVkZpRjVaZFBTQnhuR01aL005OHMxVjFuVjAxQTE3VlpVd01ScXNHWTlGeVFsQkpRMmdZUEliYUIwbk1nd1laV2V1bXhJUWhsVDdhUVcwTWhsNTRDdlFRaUlTUWhraXhOXApiV0tYYU5TYVl1enU2djRaOTgrMzgvV2dZOVZ1OWw4MzVOQUh2c3ZNOTgzenZzLzd2UFBPYUVvcFhpZjAxOG9PR0FBZmpZNEdnRXZBdTBEbksrYjhBNWdDdnZqcDZ0Vmw3Y016Wjk0RXdrQXJnTS9uNDJCWEY3cGVYM0ZzMjJiKzJUUFcxOWVkU3pHZzN3QW1nRmJUTlBseWJJeURCdzdVbFhndjVoY1grV1ppZ21ReTJRcE1pSjYrdmhEUTlQbjU4N3dWREdMYjlpdGRYdE9rdTd1Ylc3ZHZBK3d6Z0hhMzIwMVhNRWcybnllYnp5T2xwTjY5b1FHR1wKWWZDR3kwVlhNSWpiN2NheXJIWURvRE1RSUpQTGtVeW5LZGgybmFsM1ErZzZwc2REWnlEQTc1SElaaGNvSUpGS0lRdUZrb2Z6MlN4Q0NIVERxRGtBMjdaSnBGTGJDdXNBdVZ5T3ZKUW9wVXF1V0R6TzVPUWtmeTR2bDkxYmF1V2xKSmZML1JPQWxMSmlFeTBzTGZGdEtNVFAxNitUc2F5YXpTaWxCTFplUkk0MDVhQnNtOEpXbVc3Y3ZNbjBnd2VNbkRyRm9jT0hheTdKcGdlVXFpaUFRcUd3SFFCQUxCN24reXRYT05MWHgvRFFFS2JQVnpHeE00T3FcClUwQ3BYUUU0ZUJnT016TXp3d2ZEd3d3Y08xYVZTYXRTd041UmdyMVRWRXJKajlldWNlZnVYVVpHUm1qeis4c21BenVtWVVYbUtSU1FVaUtsM0M3SDN2VjBmcDVMbHk5emEyb0tyY1J6ZHlsUUxLT2lDa0RSRXV6RmU0T0RmRG82eWxvcXhVbzBXbkp2elNVb2hnNi9uL0d4TVhwNmVvZ3NMSkRkNnZWaXFNMkVMd2xBQ01ISHAwL3oyZG16TEsyczhNdnNiTmxuT2FpNkRaMFhpSU1qdmIxOFBUNk94K3ZsNFpNbkZaWEk0ZHdPQUtwdnd5YVBod3ZuXAp6akYwOGlTemMzTXNycTVXUkx3WDI4T29HZys4ZitJRVgxMjhTTUt5dUJjTzF6UzZuVE9iQ2xSWUFuZGpJOStGUXZUMjl2SmJKTUpHTmxzRHRSUEJqaExvdW82dEZGcVpNL3YyNzhkc2FtTDYwYVBhaWRuTTN2bm1OSVFRYUVLd1lWazBORFNVUEpoTXAwbW0wLytKSENDVHlhQUxnY3N3TUx5bXFXd3B0ZlZFZ2t3bWc5dnRSZ2lCcHBYVG96bzRCcllzaTJ3dWg3SnR2RjZ2TWpyYTIxK3NScU50cVZTS3RLWVJpOGZyU3Z5eVlEU2d3KzkvWVJ3L1wKZXZUcG5mdjMyOWFpVVF5WEMrcWNlUkYybEczVDB0ek04ZjcrT1czbThlUCsrTnJhalh2VDA2MVNTcVJTWmI4Tnk2Rm9DcHFHRUlJR3c4RGxjdkhPd0VDODJlY2IxSlJTL0JXTHZaMU1Kbi9JNS9OK2xHcFVPd3hRU28rU1B0bTY5NjhkbXJiaEV1SzUxelEvYVdscCtWWDczLzhkL3czeTdOUDlEaTJmUGdBQUFBQkpSVTVFcmtKZ2dnPT0nKSAhaW1wb3J0YW50O31cCi8qIHByZXZpZXcgcGxheWVyICovXAojZ3JpZHR1YmVfcGxheWVyX2FyZWEge3Bvc2l0aW9uOmZpeGVkOyB3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTsgdG9wOjBweDsgbGVmdDowcHg7IGJhY2tncm91bmQ6cmdiYSgwLDAsMCwwLjUpOyBvdmVyZmxvdzpoaWRkZW4gIWltcG9ydGFudDsgei1pbmRleDoyMTQ3NDgzNjQ2ICFpbXBvcnRhbnQ7IH1cCiNncmlkdHViZV9wbGF5ZXJfYXJlYTIge3Bvc2l0aW9uOnJlbGF0aXZlOyB3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTsgdmlzaWJpbGl0eTpoaWRkZW47fVwKI2dyaWR0dWJlX3BsYXllcl9ib3gge3Bvc2l0aW9uOmFic29sdXRlOyBiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCgjNjA2MDYwLCM1MDUwNTAsIzYwNjA2MCkgIWltcG9ydGFudDsgYm94LXNoYWRvdzowcHggMHB4IDEwcHggNXB4ICM2MDYwNjA7IGJvcmRlci1yYWRpdXM6MTBweDsgbWF4LXdpZHRoOjEwMCU7IG1heC1oZWlnaHQ6MTAwJTt9XAojZ3JpZHR1YmVfcGxheWVyX2JveFtwbGF5ZXJfcG9zPScwMCddOm5vdChbcGxheWVyX3NpemU9J2ZpdCddKSB7dG9wOjBweDsgbGVmdDowcHg7fVwKI2dyaWR0dWJlX3BsYXllcl9ib3hbcGxheWVyX3Bvcz0nMDEnXTpub3QoW3BsYXllcl9zaXplPSdmaXQnXSkge3RvcDowcHg7IGxlZnQ6MHB4OyByaWdodDowcHg7IG1hcmdpbjphdXRvO31cCiNncmlkdHViZV9wbGF5ZXJfYm94W3BsYXllcl9wb3M9JzAyJ106bm90KFtwbGF5ZXJfc2l6ZT0nZml0J10pIHt0b3A6MHB4OyByaWdodDowcHg7fVwKI2dyaWR0dWJlX3BsYXllcl9ib3hbcGxheWVyX3Bvcz0nMTAnXTpub3QoW3BsYXllcl9zaXplPSdmaXQnXSkge3RvcDowcHg7IGJvdHRvbTowcHg7IGxlZnQ6MHB4OyBtYXJnaW46YXV0bzt9XAojZ3JpZHR1YmVfcGxheWVyX2JveFtwbGF5ZXJfcG9zPScxMSddOm5vdChbcGxheWVyX3NpemU9J2ZpdCddKSB7dG9wOjBweDsgYm90dG9tOjBweDsgbGVmdDowcHg7IHJpZ2h0OjBweDsgbWFyZ2luOmF1dG87fVwKI2dyaWR0dWJlX3BsYXllcl9ib3hbcGxheWVyX3Bvcz0nMTInXTpub3QoW3BsYXllcl9zaXplPSdmaXQnXSkge3RvcDowcHg7IGJvdHRvbTowcHg7IHJpZ2h0OjBweDsgbWFyZ2luOmF1dG87fVwKI2dyaWR0dWJlX3BsYXllcl9ib3hbcGxheWVyX3Bvcz0nMjAnXTpub3QoW3BsYXllcl9zaXplPSdmaXQnXSkge2JvdHRvbTowcHg7IGxlZnQ6MHB4O31cCiNncmlkdHViZV9wbGF5ZXJfYm94W3BsYXllcl9wb3M9JzIxJ106bm90KFtwbGF5ZXJfc2l6ZT0nZml0J10pIHtib3R0b206MHB4OyBsZWZ0OjBweDsgcmlnaHQ6MHB4OyBtYXJnaW46YXV0bzt9XAojZ3JpZHR1YmVfcGxheWVyX2JveFtwbGF5ZXJfcG9zPScyMiddOm5vdChbcGxheWVyX3NpemU9J2ZpdCddKSB7Ym90dG9tOjBweDsgcmlnaHQ6MHB4O31cCiNncmlkdHViZV9wbGF5ZXJfYm94W3BsYXllcl9wb3M9J3JpZ2h0J106bm90KFtwbGF5ZXJfc2l6ZT0nZml0J10pIHtmbG9hdDpyaWdodDt9XAojZ3JpZHR1YmVfcGxheWVyX2JveFtwbGF5ZXJfc2l6ZT0ndGlueSddIHsvKjMyMHgxODAqLyB3aWR0aDozNjBweDsgaGVpZ2h0OjIyMHB4O31cCiNncmlkdHViZV9wbGF5ZXJfYm94W3BsYXllcl9zaXplPSdzbWFsbCddIHsvKjUxMngyODgqLyB3aWR0aDo1NTJweDsgaGVpZ2h0OjMyOHB4O31cCiNncmlkdHViZV9wbGF5ZXJfYm94W3BsYXllcl9zaXplPSdtZWRpdW0nXSB7Lyo3Njh4NDMyKi8gIHdpZHRoOjgwOHB4OyBoZWlnaHQ6NDcycHg7fVwKI2dyaWR0dWJlX3BsYXllcl9ib3hbcGxheWVyX3NpemU9J2xhcmdlJ10gey8qMTAyNHg1NzYqLyB3aWR0aDoxMDY0cHg7IGhlaWdodDo2MTZweDt9XAojZ3JpZHR1YmVfcGxheWVyX2JveFtwbGF5ZXJfc2l6ZT0naHVnZSddIHsvKjEyODB4NzIwKi8gd2lkdGg6MTMyMHB4OyBoZWlnaHQ6NzYwcHg7fVwKI2dyaWR0dWJlX3BsYXllcl9ib3hbcGxheWVyX3NpemU9J2ZpdCddIHt3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTt9XAojZ3JpZHR1YmVfcGxheWVyX2hvbGRlciB7cG9zaXRpb246cmVsYXRpdmU7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlO31cCiNncmlkdHViZV9wbGF5ZXJfaG9sZGVyMiB7cG9zaXRpb246YWJzb2x1dGU7IHRvcDoyMHB4OyBsZWZ0OjIwcHg7IHJpZ2h0OjIwcHg7IGJvdHRvbToyMHB4OyBtYXJnaW46YXV0bzt9XAojZ3JpZHR1YmVfcGxheWVyX2ZyYW1lIHtwb3NpdGlvbjpyZWxhdGl2ZTsgd2lkdGg6MTAwJTsgaGVpZ2h0OjEwMCU7IGRpc3BsYXk6YmxvY2s7IGJvcmRlcjowcHg7fVwKI2dyaWR0dWJlX3BsYXllcl9idXR0b25fYXJlYV90b3Age2ZvbnQ6Ym9sZCAxMnB4LzIwcHggYXJpYWwsc2Fucy1zZXJpZjsgY29sb3I6IzEwMTAxMDsgcG9zaXRpb246YWJzb2x1dGU7IHRvcDowcHg7IGxlZnQ6MTVweDt9XAojZ3JpZHR1YmVfcGxheWVyX2J1dHRvbl9hcmVhX2JvdHRvbSB7Zm9udDpib2xkIDE4cHgvMjBweCBhcmlhbCxzYW5zLXNlcmlmOyBjb2xvcjojMTAxMDEwOyBwb3NpdGlvbjphYnNvbHV0ZTsgYm90dG9tOjBweDsgbGVmdDoyMHB4O31cCi5ncmlkdHViZV9wbGF5ZXJfYnV0dG9uIHtwb3NpdGlvbjpyZWxhdGl2ZTsgY3Vyc29yOnBvaW50ZXI7IHBhZGRpbmc6MHB4IDVweDt9XAouZ3JpZHR1YmVfcGxheWVyX2J1dHRvbltidXR0b25fa2luZD0nbGVmdCddIHtwYWRkaW5nOjBweCAycHggMHB4IDVweDt9XAouZ3JpZHR1YmVfcGxheWVyX2J1dHRvbltidXR0b25fa2luZD0ncmlnaHQnXSB7cGFkZGluZzowcHggMnB4O31cCi5ncmlkdHViZV9wbGF5ZXJfYnV0dG9uW2J1dHRvbl9raW5kPSd1cCddIHtwYWRkaW5nOjBweCAycHg7fVwKLmdyaWR0dWJlX3BsYXllcl9idXR0b25bYnV0dG9uX2tpbmQ9J2Rvd24nXSB7cGFkZGluZzowcHggNXB4IDBweCAycHg7fVwKLmdyaWR0dWJlX3BsYXllcl9idXR0b246aG92ZXIge2NvbG9yOiNFMEUwRTA7fVwKI2dyaWR0dWJlX3BsYXllcl9jbG9zZV9tYXJrIHtmb250OjE0cHgvMjBweCBhcmlhbCxzYW5zLXNlcmlmOyBjb2xvcjojQjBCMEIwOyBwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjBweDsgcmlnaHQ6NXB4OyBjdXJzb3I6cG9pbnRlcjsgdmlzaWJpbGl0eTpoaWRkZW47fVwKI2dyaWR0dWJlX3BsYXllcl9jbG9zZV9tYXJrOmhvdmVyIHtjb2xvcjojRTBFMEUwO31cCiNncmlkdHViZV9wbGF5ZXJfYm94OmhvdmVyICNncmlkdHViZV9wbGF5ZXJfY2xvc2VfbWFyayB7dmlzaWJpbGl0eTppbmhlcml0O31cCi8qIHBsYXllciBvcHRpb25zICovXAojZ3JpZHR1YmVfcGxheWVyX29wdGlvbnNfcG9wdXAge3Bvc2l0aW9uOmFic29sdXRlOyBsZWZ0OjBweDsgdG9wOjBweDsgYm9yZGVyOmJsYWNrIDFweCBzb2xpZDsgZm9udDoxMXB4LzExcHggYXJpYWwsc2Fucy1zZXJpZjsgY29sb3I6d2hpdGU7IGJhY2tncm91bmQ6bGluZWFyLWdyYWRpZW50KCM4ODg4ODgsIzc4Nzg3OCk7IHBhZGRpbmc6NXB4OyBib3JkZXItcmFkaXVzOjVweDsgLyp6LWluZGV4OjIxNDc0ODM2NDc7Ki8gei1pbmRleDoyMTQ3NDgzNjQ2O31cCiNncmlkdHViZV9wbGF5ZXJfb3B0aW9uc19wb3B1cCA+IGRpdiAge3BhZGRpbmc6MnB4O31cCi5ncmlkdHViZV9wbGF5ZXJfb3B0aW9uc19ncm91cCA+IHNwYW4ge3BhZGRpbmc6MnB4O31cCi5ncmlkdHViZV9wbGF5ZXJfb3B0aW9uc190ZXh0IHtmb250LXdlaWdodDpib2xkOyBtYXJnaW4tbGVmdDo1cHg7IG1hcmdpbi10b3A6N3B4OyBjb2xvcjpsZW1vbmNoaWZmb247fVwKLmdyaWR0dWJlX3BsYXllcl9vcHRpb25zX2Nsb3NlIHtmb250OjE0cHgvMTRweCBhcmlhbCxzYW5zLXNlcmlmOyBjb2xvcjpibGFjazsgcG9zaXRpb246YWJzb2x1dGU7IHRvcDozcHg7IHJpZ2h0OjVweDsgY3Vyc29yOnBvaW50ZXI7fVwKLmdyaWR0dWJlX3BsYXllcl9vcHRpb25zX2Nsb3NlOmhvdmVyIHtjb2xvcjpsaWdodGdyYXk7fVwKLmdyaWR0dWJlX3BsYXllcl9vcHRpb25zX3RpdGxlIHtmb250OmJvbGQgMTNweC8xM3B4IGFyaWFsLHNhbnMtc2VyaWY7IHBhZGRpbmc6NXB4ICFpbXBvcnRhbnQ7IGNvbG9yOmxlbW9uY2hpZmZvbjt9XAoiOwoKLy9tb3JlIGljb25zCnZhciBpY29uX2dyaWQgPSAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQUtFbEVRVlI0Mm1Oa1lHRDR6NEFBaktUeVlRSmsweVRiaU0wRkZBR3F1R0EwREViRFlCaUVBUURzcmtBUmRTRk1XQUFBQUFCSlJVNUVya0pnZ2c9PSI7CnZhciBpY29uX2xpc3QgPSAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQU0wbEVRVlI0Mm1Oa1lHRDR6NEFBakEwTkRjaDh2QUNvbHBFUmFnQXlUUktBYVVUbWsyd0FSUUREQmFOaE1Cb0dJelFNQU1tK0lCR1VhVnJHQUFBQUFFbEZUa1N1UW1DQyI7CgoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovL2Jhc2ljCgpmdW5jdGlvbiBuZXdOb2RlKGtpbmQsIGlkLCBjbGFzc25hbWUsIHJlZm5vZGUsIHBvc2l0aW9uKSB7CgogICAgdmFyIG5vZGUgPSBkb2MuY3JlYXRlRWxlbWVudChraW5kKTsKCiAgICBpZiAobm9kZSA9PSBudWxsKSByZXR1cm4gbnVsbDsKCiAgICBpZiAoaWQgIT0gbnVsbCkgbm9kZS5pZCA9IGlkOwoKICAgIGlmIChjbGFzc25hbWUgIT0gbnVsbCkgbm9kZS5jbGFzc05hbWUgPSBjbGFzc25hbWU7CgogICAgaWYgKHJlZm5vZGUgIT0gbnVsbCkgewogICAgICAgIHN3aXRjaCAocG9zaXRpb24pIHsKICAgICAgICAgICAgLy9pbnNlcnQgYWZ0ZXIgcmVmbm9kZQogICAgICAgICAgICBjYXNlICdhZnRlcic6CiAgICAgICAgICAgICAgICBpZiAocmVmbm9kZS5uZXh0U2libGluZyAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJlZm5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgcmVmbm9kZS5uZXh0U2libGluZyk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcmVmbm9kZS5wYXJlbnROb2RlLmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgLy9pbnNlcnQgYmVmb3JlIHJlZm5vZGUKICAgICAgICAgICAgY2FzZSAnYmVmb3JlJzoKICAgICAgICAgICAgICAgIHJlZm5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgcmVmbm9kZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAvL2luc2VydCBhcyBmaXJzdCBjaGlsZCBvZiByZWZub2RlICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGNhc2UgJ2ZpcnN0JzoKICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IHJlZm5vZGUuY2hpbGROb2Rlc1swXTsKICAgICAgICAgICAgICAgIGlmIChjaGlsZCAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHJlZm5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIGNoaWxkKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZWZub2RlLmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgLy9pbnNlcnQgYXMgbGFzdCBjaGlsZCBvZiByZWZub2RlCiAgICAgICAgICAgIGNhc2UgJ2xhc3QnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmVmbm9kZS5hcHBlbmRDaGlsZChub2RlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gbm9kZTsKfQoKCmZ1bmN0aW9uIG1lc3NhZ2Uoc3RyKSB7CiAgICB2YXIgbm9kZSA9IG5ld05vZGUoImRpdiIsIG51bGwsICJncmlkdHViZV9tZXNzYWdlIiwgZG9jLmJvZHkpOwogICAgbm9kZS50ZXh0Q29udGVudCA9IHN0ciArICJcbiI7Cn0KCgpmdW5jdGlvbiBpbnNlcnRTdHlsZShzdHIsIGlkKSB7CiAgICB2YXIgc3R5bGVOb2RlID0gbnVsbDsKCiAgICBpZiAoaWQgIT0gbnVsbCkgewogICAgICAgIHN0eWxlTm9kZSA9IGRvYy5nZXRFbGVtZW50QnlJZChpZCk7CiAgICB9CgogICAgaWYgKHN0eWxlTm9kZSA9PSBudWxsKSB7CiAgICAgICAgc3R5bGVOb2RlID0gbmV3Tm9kZSgic3R5bGUiLCBpZCwgbnVsbCwgZG9jLmhlYWQpOwogICAgICAgIHN0eWxlTm9kZS5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dC9jc3MiKTsKICAgIH0KCiAgICBpZiAoc3R5bGVOb2RlLnRleHRDb250ZW50ICE9IHN0cikKICAgICAgICBzdHlsZU5vZGUudGV4dENvbnRlbnQgPSBzdHI7Cn0KCgpmdW5jdGlvbiBpbmplY3RTY3JpcHQoc3RyLCBzcmMpIHsKICAgIHZhciBzY3JpcHQgPSBkb2MuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICBpZiAoc3RyKSBzY3JpcHQudGV4dENvbnRlbnQgPSBzdHI7CiAgICBpZiAoc3JjKSBzY3JpcHQuc3JjID0gc3JjOwogICAgZG9jLmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIGlmICghc3JjKSBkb2MuYm9keS5yZW1vdmVDaGlsZChzY3JpcHQpOwp9CgoKZnVuY3Rpb24geHBhdGgob3V0ZXJfZG9tLCBpbm5lcl9kb20sIHF1ZXJ5KSB7CiAgICAvL1hQYXRoUmVzdWx0Lk9SREVSRURfTk9ERV9TTkFQU0hPVF9UWVBFID0gNwogICAgcmV0dXJuIG91dGVyX2RvbS5ldmFsdWF0ZShxdWVyeSwgaW5uZXJfZG9tLCBudWxsLCA3LCBudWxsKTsKfQoKCmZ1bmN0aW9uIGRvY3NlYXJjaChxdWVyeSkgewogICAgcmV0dXJuIHhwYXRoKGRvYywgZG9jLCBxdWVyeSk7Cn0KCgpmdW5jdGlvbiBpbm5lcnNlYXJjaChpbm5lciwgcXVlcnkpIHsKICAgIHJldHVybiB4cGF0aChkb2MsIGlubmVyLCBxdWVyeSk7Cn0KCgpmdW5jdGlvbiBzaW11bENsaWNrKGVsKSB7CiAgICB2YXIgY2xpY2tFdmVudCA9IGRvYy5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMnKTsKICAgIGNsaWNrRXZlbnQuaW5pdEV2ZW50KCdjbGljaycsIHRydWUsIHRydWUpOwogICAgZWwuZGlzcGF0Y2hFdmVudChjbGlja0V2ZW50KTsKfQoKCmZ1bmN0aW9uIGptZXNzYWdlKGpzb24pIHsKICAgIG1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoanNvbiwgbnVsbCwgJyAgICAgICAgICAgICAgICAgICcpKTsKfQoKZnVuY3Rpb24gZGlzYWJsZV9hamF4KGUpIHsKICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7Cn0KCmZ1bmN0aW9uIGZpbHRlcihzdHIsIHcsIGRlbGltKSB7CiAgICBpZiAoc3RyID09IG51bGwpIHJldHVybiBudWxsOwoKICAgIHZhciByID0gbnVsbDsKICAgIHZhciBtID0gc3RyLm1hdGNoKFJlZ0V4cCgiWyIgKyBkZWxpbSArICJdIiArIHcgKyAiW14iICsgZGVsaW0gKyAiXSoiKSk7CiAgICBpZiAobSAhPSBudWxsKSB7CiAgICAgICAgciA9IG1bMF07CiAgICAgICAgciA9IHIucmVwbGFjZShSZWdFeHAoIlsiICsgZGVsaW0gKyAiXSIgKyB3KSwgIiIpOwogICAgfQogICAgcmV0dXJuIHI7Cn0KCgpmdW5jdGlvbiBudW1iZXJfY29tbWEoc3RyKSB7CiAgICBpZiAoc3RyID09IG51bGwpIHJldHVybiBudWxsOwoKICAgIHJldHVybiBzdHIucmVwbGFjZSgvXEIoPz0oXGR7M30pKyg/IVxkKSkvZywgIiwiKQp9CgoKLy9yZXR1cm5zIG9iamVjdCB3aXRoIGZpZWxkczogc2l6ZSwgZm9ybWF0LCBIRCwgVUhECmZ1bmN0aW9uIGV4dHJhY3RfcmVzb2x1dGlvbih0eHQpIHsKICAgIGlmICh0eHQgPT0gbnVsbCkgcmV0dXJuIG51bGw7CgogICAgLy9tZXNzYWdlKHR4dCk7CgogICAgdmFyIHN0ciA9IGZpbHRlcigiJSIgKyB0eHQsICIyNnNpemUlM0QiLCAiJSIpOwogICAgaWYgKHN0ciA9PSBudWxsIHx8IHN0ciA9PSAiIikgewogICAgICAgIHN0ciA9IGZpbHRlcigiJiIgKyB0eHQsICJmbXRfbGlzdD0iLCAiJj8iKTsKICAgIH0KCiAgICBpZiAoc3RyID09IG51bGwpIHJldHVybiBudWxsOwoKICAgIC8vbWVzc2FnZShzdHIpOwoKICAgIHZhciBtID0gc3RyLm1hdGNoKC8oWzAtOV0pK3goWzAtOV0pKy8pOwoKICAgIGlmIChtID09IG51bGwpIHJldHVybiBudWxsOwoKICAgIGlmIChtLmxlbmd0aCA9PSAwKSByZXR1cm4gbnVsbDsKCiAgICB2YXIgcG9zX21heCA9IC0xOwogICAgdmFyIGZvcm1hdF9tYXggPSAiIjsKICAgIHZhciBpbnQwX21heCA9IC0xOwogICAgdmFyIGludDFfbWF4ID0gLTE7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHNpemUgPSBtW2ldOwogICAgICAgIHZhciBudW1zID0gc2l6ZS5zcGxpdCgieCIpOwogICAgICAgIHZhciBpbnQxID0gcGFyc2VJbnQobnVtc1sxXSk7CgogICAgICAgIGlmIChpbnQxID4gaW50MV9tYXgpIHsKICAgICAgICAgICAgcG9zX21heCA9IGk7CiAgICAgICAgICAgIGZvcm1hdF9tYXggPSBudW1zWzFdOwogICAgICAgICAgICBpbnQwX21heCA9IHBhcnNlSW50KG51bXNbMF0pOwogICAgICAgICAgICBpbnQxX21heCA9IGludDE7CiAgICAgICAgfQogICAgfQoKICAgIHZhciByZXQgPSBuZXcgT2JqZWN0KCk7CiAgICByZXQuc2l6ZSA9IG1bcG9zX21heF07CiAgICByZXQuZm9ybWF0ID0gZm9ybWF0X21heDsKICAgIHJldC5IRCA9ICgoaW50MF9tYXggPj0gMTI4MCkgfHwgKGludDFfbWF4ID49IDcyMCkpOwogICAgcmV0LlVIRCA9IChpbnQwX21heCA+PSA3NjgwKSA/ICc4SycgOiAoaW50MF9tYXggPj0gNTEyMCkgPyAnNUsnIDogKGludDBfbWF4ID49IDM4NDApID8gJzRLJyA6IG51bGw7CiAgICAvL2ptZXNzYWdlKHJldCk7CgogICAgcmV0dXJuIHJldDsKfQoKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy9wcmVmZXJlbmNlcwoKdmFyIHByZWZfcGxheWVyRW5hYmxlID0gaW5pdF9wcmVmKCJwbGF5ZXJFbmFibGUiLCB0cnVlKTsKdmFyIHByZWZfZ3JpZEVuYWJsZSA9IGluaXRfcHJlZigiZ3JpZEVuYWJsZSIsIHRydWUpOwp2YXIgcHJlZl9ncmlkU2VhcmNoID0gaW5pdF9wcmVmKCJncmlkU2VhcmNoIiwgdHJ1ZSk7CnZhciBwcmVmX2dyaWRUcmVuZCA9IGluaXRfcHJlZigiZ3JpZFRyZW5kIiwgdHJ1ZSk7CnZhciBwcmVmX2dyaWRIaXN0ID0gaW5pdF9wcmVmKCJncmlkSGlzdCIsIHRydWUpOwp2YXIgcHJlZl9ncmlkUGxpc3QgPSBpbml0X3ByZWYoImdyaWRQbGlzdCIsIHRydWUpOwp2YXIgcHJlZl9ncmlkUmVsID0gaW5pdF9wcmVmKCJncmlkUmVsIiwgdHJ1ZSk7CnZhciBwcmVmX2F1dG9Mb2FkU2VhcmNoID0gaW5pdF9wcmVmKCJhdXRvTG9hZFNlYXJjaCIsIHRydWUpOwp2YXIgcHJlZl9hdXRvTG9hZE90aGVyID0gaW5pdF9wcmVmKCJhdXRvTG9hZE90aGVyIiwgdHJ1ZSk7CnZhciBwcmVmX2RlZkVuYWJsZSA9IGluaXRfcHJlZigiZGVmRW5hYmxlIiwgdHJ1ZSk7CnZhciBwcmVmX3JhdGVFbmFibGUgPSBpbml0X3ByZWYoInJhdGVFbmFibGUiLCB0cnVlKTsKdmFyIHByZWZfdXNlckxpbmsgPSBpbml0X3ByZWYoInVzZXJMaW5rIiwgZmFsc2UpOwp2YXIgcHJlZl9uZXdUYWIgPSBpbml0X3ByZWYoIm5ld1RhYiIsIGZhbHNlKTsKdmFyIHByZWZfeXRGb2N1cyA9IGluaXRfcHJlZigieXRGb2N1cyIsIGZhbHNlKTsKCgppZiAoIXByZWZfZ3JpZEVuYWJsZSkgewogICAgcHJlZl9ncmlkU2VhcmNoID0gZmFsc2U7CiAgICBwcmVmX2dyaWRUcmVuZCA9IGZhbHNlOwogICAgcHJlZl9ncmlkSGlzdCA9IGZhbHNlOwogICAgcHJlZl9ncmlkUGxpc3QgPSBmYWxzZTsKICAgIHByZWZfZ3JpZFJlbCA9IGZhbHNlOwp9CgoKZnVuY3Rpb24gbmV3X2NoZWNrYm94KHByZWZuYW1lLCBzdHIsIG5vZGVfa2luZCwgcGFyZW50LCB2YWx1ZSwgZnVuYykgewogICAgdmFyIGRpdiA9IG5ld05vZGUobm9kZV9raW5kLCBudWxsLCAiZ3JpZHR1YmVfZ2VuZXJpYyIsIHBhcmVudCk7CiAgICB2YXIgaW5wdXQgPSBuZXdOb2RlKCJpbnB1dCIsIG51bGwsICJncmlkdHViZV9nZW5lcmljIiwgZGl2KTsKICAgIGlucHV0LnR5cGUgPSAiY2hlY2tib3giOwogICAgaWYgKCF2YWx1ZSkgewogICAgICAgIGlucHV0LmNoZWNrZWQgPSBnZXRfcHJlZihwcmVmbmFtZSk7CiAgICAgICAgaW5wdXQub25jbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciB2YWwgPSBnZXRfcHJlZihwcmVmbmFtZSk7CiAgICAgICAgICAgIHNldF9wcmVmKHByZWZuYW1lLCAhdmFsKTsKICAgICAgICAgICAgZS50YXJnZXQuY2hlY2tlZCA9ICF2YWw7CiAgICAgICAgICAgIGlmIChmdW5jKSBmdW5jKCk7CiAgICAgICAgfTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGlucHV0LnZhbHVlID0gdmFsdWU7CiAgICAgICAgaW5wdXQuY2hlY2tlZCA9IChnZXRfcHJlZihwcmVmbmFtZSkgPT0gaW5wdXQudmFsdWUpOwogICAgICAgIGlucHV0Lm9uY2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdmFsID0gZ2V0X3ByZWYocHJlZm5hbWUpOwogICAgICAgICAgICBzZXRfcHJlZihwcmVmbmFtZSwgZS50YXJnZXQudmFsdWUpOwogICAgICAgICAgICBlLnRhcmdldC5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgdmFyIG90aGVyID0gaW5uZXJzZWFyY2gocGFyZW50LnBhcmVudE5vZGUsICIuLy9pbnB1dFtAdmFsdWU9JyIgKyB2YWwgKyAiJ10iKS5zbmFwc2hvdEl0ZW0oMCk7CiAgICAgICAgICAgIGlmIChvdGhlcikgb3RoZXIuY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgICBpZiAoZnVuYykgZnVuYygpOwogICAgICAgIH07CiAgICB9CiAgICB2YXIgc3BhbiA9IG5ld05vZGUoInNwYW4iLCBudWxsLCAiZ3JpZHR1YmVfZ2VuZXJpYyIsIGRpdik7CiAgICBzcGFuLnRleHRDb250ZW50ID0gc3RyOwp9CgoKZnVuY3Rpb24gcHJlZl9wb3B1cChwb3MpIHsKICAgIHZhciBwb3B1cCA9IGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfcHJlZl9wb3B1cCIpOwogICAgaWYgKHBvcHVwKSByZXR1cm47CgogICAgcG9wdXAgPSBuZXdOb2RlKCJzcGFuIiwgImdyaWR0dWJlX3ByZWZfcG9wdXAiLCBudWxsLCBkb2MuYm9keSk7CiAgICBpZiAocG9zKSBwb3B1cC5zZXRBdHRyaWJ1dGUocG9zLCAidHJ1ZSIpOwoKICAgIHZhciB0aXRsZV9ub2RlID0gbmV3Tm9kZSgiZGl2IiwgImdyaWR0dWJlX3ByZWZfdGl0bGUiLCBudWxsLCBwb3B1cCk7CiAgICB0aXRsZV9ub2RlLnRleHRDb250ZW50ID0gIkdyaWQgJiBQbGF5ZXIgT3B0aW9ucyI7CgogICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKICAgIGZ1bmN0aW9uIG1hcmsoKSB7CiAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICB9CgogICAgdmFyIGNsb3NlbWFyayA9IG5ld05vZGUoInNwYW4iLCAiZ3JpZHR1YmVfcHJlZl9jbG9zZSIsIG51bGwsIHBvcHVwKTsKICAgIGNsb3NlbWFyay50ZXh0Q29udGVudCA9ICJcdTI3NEMiOwogICAgY2xvc2VtYXJrLnRpdGxlID0gImNsb3NlIG9wdGlvbnMiOwogICAgY2xvc2VtYXJrLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcG9wdXAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChwb3B1cCk7CiAgICAgICAgaWYgKGNoYW5nZWQpIHdpbi5sb2NhdGlvbi5yZWxvYWQoKTsKICAgIH07CgogICAgbmV3X2NoZWNrYm94KCJwbGF5ZXJFbmFibGUiLCAiUHJldmlldyBQbGF5ZXIiLCAiZGl2IiwgcG9wdXAsIG51bGwsIG1hcmspOwogICAgbmV3X2NoZWNrYm94KCJncmlkRW5hYmxlIiwgIkdyaWQgVmlldyIsICJkaXYiLCBwb3B1cCwgbnVsbCwgbWFyayk7CiAgICBpZiAocHJlZl9ncmlkRW5hYmxlKSB7CiAgICAgICAgdmFyIGdyb3VwMSA9IG5ld05vZGUoImRpdiIsIG51bGwsICJncmlkdHViZV9wcmVmX2dyb3VwIiwgcG9wdXApOwogICAgICAgIHZhciBncm91cDIgPSBuZXdOb2RlKCJkaXYiLCBudWxsLCAiZ3JpZHR1YmVfcHJlZl9ncm91cCIsIHBvcHVwKTsKICAgICAgICBuZXdfY2hlY2tib3goImdyaWRTZWFyY2giLCAiU2VhcmNoIiwgInNwYW4iLCBncm91cDEsIG51bGwsIG1hcmspOwogICAgICAgIG5ld19jaGVja2JveCgiZ3JpZEhpc3QiLCAiSGlzdG9yeSIsICJzcGFuIiwgZ3JvdXAxLCBudWxsLCBtYXJrKTsKICAgICAgICBuZXdfY2hlY2tib3goImdyaWRQbGlzdCIsICJQbGF5bGlzdHMiLCAic3BhbiIsIGdyb3VwMSwgbnVsbCwgbWFyayk7CiAgICAgICAgbmV3X2NoZWNrYm94KCJncmlkVHJlbmQiLCAiVHJlbmRpbmciLCAic3BhbiIsIGdyb3VwMiwgbnVsbCwgbWFyayk7CiAgICAgICAgbmV3X2NoZWNrYm94KCJncmlkUmVsIiwgIlJlbGF0ZWQiLCAic3BhbiIsIGdyb3VwMiwgbnVsbCwgbWFyayk7CiAgICB9CiAgICBuZXdfY2hlY2tib3goImF1dG9Mb2FkU2VhcmNoIiwgIkF1dG8gTG9hZCBmb3IgU2VhcmNoIFJlc3VsdHMiLCAiZGl2IiwgcG9wdXAsIG51bGwsIG1hcmspOwogICAgbmV3X2NoZWNrYm94KCJhdXRvTG9hZE90aGVyIiwgIkF1dG8gTG9hZCBmb3IgT3RoZXIgUGFnZXMiLCAiZGl2IiwgcG9wdXAsIG51bGwsIG1hcmspOwogICAgbmV3X2NoZWNrYm94KCJkZWZFbmFibGUiLCAiU2hvdyBWaWRlbyBEZWZpbml0aW9uIiwgImRpdiIsIHBvcHVwLCBudWxsLCBtYXJrKTsKICAgIG5ld19jaGVja2JveCgicmF0ZUVuYWJsZSIsICJTaG93IFZpZGVvIFJhdGluZyIsICJkaXYiLCBwb3B1cCwgbnVsbCwgbWFyayk7CiAgICBuZXdfY2hlY2tib3goInVzZXJMaW5rIiwgIk9wZW4gVXNlciBMaW5rcyBpbiBVc2VyIFZpZGVvcyIsICJkaXYiLCBwb3B1cCwgbnVsbCwgbWFyayk7CiAgICBuZXdfY2hlY2tib3goIm5ld1RhYiIsICJPcGVuIExpbmtzIGluIE5ldyBUYWIiLCAiZGl2IiwgcG9wdXAsIG51bGwsIG1hcmspOwogICAgbmV3X2NoZWNrYm94KCJ5dEZvY3VzIiwgIlBhdXNlIGF0IG91dCBvZiBGb2N1cyBUYWIiLCAiZGl2IiwgcG9wdXAsIG51bGwsIG1hcmspOwp9CgoKZnVuY3Rpb24gcHJlZl9idXR0b24oKSB7CiAgICB2YXIgbm9kZSA9IGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfcHJlZl9idXR0b24iKTsKICAgIHZhciBwb3MgPSBudWxsOwogICAgaWYgKCFub2RlKSB7CiAgICAgICAgdmFyIHBhciA9IGRvYy5nZXRFbGVtZW50QnlJZCgieXQtbWFzdGhlYWQtY29udGFpbmVyIik7CiAgICAgICAgaWYgKHBhcikgewogICAgICAgICAgICBub2RlID0gbmV3Tm9kZSgic3BhbiIsICJncmlkdHViZV9wcmVmX2J1dHRvbiIsIG51bGwsIHBhcik7CiAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJ0b3AiLCAidHJ1ZSIpOwogICAgICAgICAgICBwb3MgPSAidG9wIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG5vZGUgPSBuZXdOb2RlKCJzcGFuIiwgImdyaWR0dWJlX3ByZWZfYnV0dG9uIiwgbnVsbCwgZG9jLmJvZHkpOwogICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgiYm90dG9tIiwgInRydWUiKTsKICAgICAgICAgICAgcG9zID0gImJvdHRvbSI7CiAgICAgICAgfQogICAgfQogICAgbm9kZS50aXRsZSA9ICJHcmlkICYgUGxheWVyIE9wdGlvbnMiOwogICAgbm9kZS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIHByZWZfcG9wdXAocG9zKTsKICAgIH07Cn0KCnByZWZfYnV0dG9uKCk7Cgp2YXIgcHJlZl9idXR0b25fdGltZW91dCA9IG51bGw7CgpmdW5jdGlvbiBwcmVmX2J1dHRvbl9zaG93KCkgewogICAgdmFyIG5vZGUgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoImdyaWR0dWJlX3ByZWZfYnV0dG9uIik7CiAgICBpZiAoIW5vZGUpIHJldHVybjsKCiAgICB2YXIgcG9zID0gbm9kZS5nZXRBdHRyaWJ1dGUoInRvcCIpOwogICAgaWYgKCEocG9zID09ICJ0cnVlIikpIHJldHVybjsKCiAgICBub2RlLnN0eWxlLnZpc2liaWxpdHkgPSAidmlzaWJsZSI7CiAgICBpZiAocHJlZl9idXR0b25fdGltZW91dCkKICAgICAgICB3aW4uY2xlYXJUaW1lb3V0KHByZWZfYnV0dG9uX3RpbWVvdXQpOwp9CgpmdW5jdGlvbiBwcmVmX2J1dHRvbl9oaWRlKCkgewogICAgdmFyIG5vZGUgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoImdyaWR0dWJlX3ByZWZfYnV0dG9uIik7CiAgICBpZiAoIW5vZGUpIHJldHVybjsKCiAgICB2YXIgcG9zID0gbm9kZS5nZXRBdHRyaWJ1dGUoInRvcCIpOwogICAgaWYgKCEocG9zID09ICJ0cnVlIikpIHJldHVybjsKCiAgICAvL25vZGUuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgcHJlZl9idXR0b25fdGltZW91dCA9IHdpbi5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgbm9kZS5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7IH0sIDIwMDApOwp9CgoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gQ2hvaWNlIEljb25zCgpmdW5jdGlvbiBjaG9pY2VfaWNvbnMocGFnZV9raW5kKSB7CgogICAgaWYgKGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfaWNvbl9hcmVhIikgIT0gbnVsbCkgcmV0dXJuOwoKICAgIGZ1bmN0aW9uIHNldGZ1bmMocHJlZnZhbHVlLCBwcmVmbmFtZSwgaXNsaXN0KSB7CiAgICAgICAgaWYgKGlzbGlzdCA/IHByZWZ2YWx1ZSA6ICFwcmVmdmFsdWUpIHsKICAgICAgICAgICAgc2V0X3ByZWYocHJlZm5hbWUsICFwcmVmdmFsdWUpOwogICAgICAgICAgICB3aW4ubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGJ1aWxkX2ljb25zKHByZWZfZ3JpZF92YWx1ZSwgcHJlZl9ncmlkX25hbWUsIHJlZm5vZGUsIHBvc2l0aW9uKSB7CiAgICAgICAgdmFyIGljb25fYm94ID0gbmV3Tm9kZSgic3BhbiIsICJncmlkdHViZV9pY29uX2FyZWEiLCAiZ3JpZHR1YmVfaWNvbl9hcmVhXyIgKyBwYWdlX2tpbmQsIHJlZm5vZGUsIHBvc2l0aW9uKTsKICAgICAgICBpZiAoIWljb25fYm94KSByZXR1cm47CgogICAgICAgIGljb25fYm94Lm9ubW91c2VvdmVyID0gcHJlZl9idXR0b25fc2hvdzsKICAgICAgICBpY29uX2JveC5vbm1vdXNlb3V0ID0gcHJlZl9idXR0b25faGlkZTsKCiAgICAgICAgLy9saXN0IGljb24KICAgICAgICB2YXIgaW1nX2xpc3QgPSBuZXdOb2RlKCJpbWciLCBudWxsLCBudWxsLCBpY29uX2JveCk7CiAgICAgICAgaWYgKCFwcmVmX2dyaWRfdmFsdWUpCiAgICAgICAgICAgIGltZ19saXN0LnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCAidHJ1ZSIpOwoKICAgICAgICBpbWdfbGlzdC5zcmMgPSBpY29uX2xpc3Q7CiAgICAgICAgaW1nX2xpc3QudGl0bGUgPSAibGlzdCB2aWV3IjsKICAgICAgICBpbWdfbGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsgc2V0ZnVuYyhwcmVmX2dyaWRfdmFsdWUsIHByZWZfZ3JpZF9uYW1lLCB0cnVlKTsgfSk7CgogICAgICAgIC8vZ3JpZCBpY29uCiAgICAgICAgdmFyIGltZ19ncmlkID0gbmV3Tm9kZSgiaW1nIiwgbnVsbCwgbnVsbCwgaWNvbl9ib3gpOwogICAgICAgIGlmIChwcmVmX2dyaWRfdmFsdWUpCiAgICAgICAgICAgIGltZ19ncmlkLnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCAidHJ1ZSIpOwoKICAgICAgICBpbWdfZ3JpZC5zcmMgPSBpY29uX2dyaWQ7CiAgICAgICAgaW1nX2dyaWQudGl0bGUgPSAiZ3JpZCB2aWV3IjsKICAgICAgICBpbWdfZ3JpZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHsgc2V0ZnVuYyhwcmVmX2dyaWRfdmFsdWUsIHByZWZfZ3JpZF9uYW1lLCBmYWxzZSk7IH0pOwogICAgfQoKCiAgICAvLyBpbml0aWFsaXphdGlvbgogICAgdmFyIHJlZm5vZGUgPSBudWxsOwoKICAgIHN3aXRjaCAocGFnZV9raW5kKSB7CiAgICAgICAgY2FzZSAic2VhcmNoIjoKICAgICAgICAgICAgcmVmbm9kZSA9IGRvY3NlYXJjaCgiLy8qW2NvbnRhaW5zKEBjbGFzcywnbnVtLXJlc3VsdHMnKV0iKS5zbmFwc2hvdEl0ZW0oMCk7CiAgICAgICAgICAgIGlmIChyZWZub2RlKQogICAgICAgICAgICAgICAgYnVpbGRfaWNvbnMocHJlZl9ncmlkU2VhcmNoLCAiZ3JpZFNlYXJjaCIsIHJlZm5vZGUsICdhZnRlcicpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAicGxpc3QiOgogICAgICAgICAgICByZWZub2RlID0gZG9jc2VhcmNoKCIvLypbY29udGFpbnMoQGNsYXNzLCdwbGF5bGlzdC1hY3Rpb25zJyldIikuc25hcHNob3RJdGVtKDApOwogICAgICAgICAgICBpZiAocmVmbm9kZSkKICAgICAgICAgICAgICAgIGJ1aWxkX2ljb25zKHByZWZfZ3JpZFBsaXN0LCAiZ3JpZFBsaXN0IiwgcmVmbm9kZSwgJ2FmdGVyJyk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJoaXN0IjoKICAgICAgICAgICAgcmVmbm9kZSA9IGRvY3NlYXJjaCgiLy8qW0BpZD0nY2hhbm5lbC1uYXZpZ2F0aW9uLW1lbnUnXSIpLnNuYXBzaG90SXRlbSgwKTsKICAgICAgICAgICAgaWYgKHJlZm5vZGUpCiAgICAgICAgICAgICAgICBidWlsZF9pY29ucyhwcmVmX2dyaWRIaXN0LCAiZ3JpZEhpc3QiLCByZWZub2RlLCAnYWZ0ZXInKTsKICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0KCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBQbGF5ZXIKCnZhciBiYXNpY19zdHIgPSAiKGNvbnRhaW5zKEBjbGFzcywndmlkZW8tdGh1bWInKSBvciBjb250YWlucyhAY2xhc3MsJ3RodW1iLXdyYXAnKSlcCiAgICAgICAgICAgICAgICAgYW5kIChub3QoZGVzY2VuZGFudDo6Kltjb250YWlucyhAY2xhc3MsJ3ZpZGVvLXRodW1iJykgb3IgY29udGFpbnMoQGNsYXNzLCd0aHVtYi13cmFwJyldKSlcCiAgICAgICAgICAgICAgICAgYW5kIChub3QoYW5jZXN0b3I6OipbKEBncmlkdHViZV9hZHNfbWFyaylcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKEBpZD0ncGxheWVyLXBsYXlsaXN0JylcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKEBpZD0ncGwtc3VnZ2VzdGlvbnMnKSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICghcHJlZl9ncmlkUmVsID8gIiIgOiAiIG9yIChAaWQ9J3B5di13YXRjaC1yZWxhdGVkLWRlc3QtdXJsJykiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgKHByZWZfZ3JpZFBsaXN0ID8gIiIgOiAiIG9yIChAaWQ9J3BsLXZpZGVvLWxpc3QnKSIpICsgIlwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSkiOwoKZnVuY3Rpb24gcGxheWVyX3NjcmlwdCgpIHsKICAgIGluamVjdFNjcmlwdCgiXAogICAgICAgICAgICAgICAgICAgICAgIGlmIChZVCkge1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwbGF5ZXIgPSBuZXcgWVQuUGxheWVyKCdncmlkdHViZV9wbGF5ZXJfZnJhbWUnKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3J0ID0gbnVsbDtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBlcnJvcl9yZXNldCgpIHsgaWYgKGVycm9ydCkgd2luZG93LmNsZWFyVGltZW91dChlcnJvcnQpOyB9XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tfZXJyb3IodCxmaWQpIHtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnQgPSB3aW5kb3cuc2V0VGltZW91dChcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChmaWQpIHtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyaWR0dWJlX3BsYXllcl9mcmFtZScpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmKSByZXR1cm47XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5nZXRBdHRyaWJ1dGUoJ2ZpZCcpICE9IGZpZCkgcmV0dXJuO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBwbGF5ZXIuZ2V0UGxheWVyU3RhdGUoKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gcGxheWVyLmdldFBsYXlsaXN0KCk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHBsYXllci5nZXRQbGF5bGlzdEluZGV4KCk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSAhPSBudWxsID8gYS5sZW5ndGggPT0gMCA6IGZhbHNlKVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3BsYXllbmQnKSk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHMgPT0gLTEgfHwgcyA9PSA1KVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoYSAhPSBudWxsICYmIGkgIT0gbnVsbCkgPyBpIDwgYS5sZW5ndGggLSAxIDogZmFsc2UpXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLm5leHRWaWRlbygpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdwbGF5ZW5kJykpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdCwgZmlkKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ29uUmVhZHknLFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZHR1YmVfcGxheWVyX2ZyYW1lJyk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYpIHtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxID0gZi5nZXRBdHRyaWJ1dGUoJ3F1YWxpdHknKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxICE9ICdkZWZhdWx0JyAmJiBxICE9IG51bGwpIHBsYXllci5zZXRQbGF5YmFja1F1YWxpdHkocSk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ29uU3RhdGVDaGFuZ2UnLFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZHR1YmVfcGxheWVyX2ZyYW1lJyk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWYpIHJldHVybjtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzID0gcGxheWVyLmdldFBsYXllclN0YXRlKCk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHBsYXllci5nZXRQbGF5bGlzdCgpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBwbGF5ZXIuZ2V0UGxheWxpc3RJbmRleCgpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmQgPSAoKGEgIT0gbnVsbCAmJiBpICE9IG51bGwpID8gaSA9PSBhLmxlbmd0aCAtIDEgOiB0cnVlKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxID0gZi5nZXRBdHRyaWJ1dGUoJ3F1YWxpdHknKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzID09IC0xICYmIHEgIT0gJ2RlZmF1bHQnICYmIHEgIT0gbnVsbCkgcGxheWVyLnNldFBsYXliYWNrUXVhbGl0eShxKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHMgPT0gMCAmJiBjb25kKSB7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfcmVzZXQoKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdwbGF5ZW5kJykpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyaWR0dWJlX3BsYXllcl9mcmFtZScpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmcmFtZSkge1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2Vycm9yKDEwMDAwLGZyYW1lLmdldEF0dHJpYnV0ZSgnZmlkJykpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRuZXd2aWRlbycsXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHgpIHtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlkID0geC50YXJnZXQuZ2V0QXR0cmlidXRlKCdmaWQnKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0geC50YXJnZXQuZ2V0QXR0cmlidXRlKCduZXd2aWR1cmwnKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGxpc3QgPSB4LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ3BsaXN0Jyk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfcmVzZXQoKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGlzdCkge1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5sb2FkUGxheWxpc3QoeydsaXN0JzpwbGlzdH0pO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2Vycm9yKDEwMDAwLGZpZCk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHVybCkge1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5sb2FkVmlkZW9CeVVybCh1cmwpO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrX2Vycm9yKDEwMDAwLGZpZCk7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ3BhdXNldmlkZW8nLFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh4KSB7XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnBhdXNlVmlkZW8oKTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XAogICAgICAgICAgICAgICAgICAgICAgfSIpOwp9Cgp2YXIgY2hvaWNlc19kZWYgPSBbJ2RlZmF1bHQnLCAnc21hbGwnLCAnbWVkaXVtJywgJ2xhcmdlJywgJ2hkNzIwJywgJ2hkMTA4MCcsICdoZDE0NDAnLCAnaGlnaHJlcyddOwp2YXIgY2hvaWNlc19zaXplID0gWyd0aW55JywgJ3NtYWxsJywgJ21lZGl1bScsICdsYXJnZScsICdodWdlJ107CnZhciBjaG9pY2VzX3BvcyA9IFsnMDAnLCAnMDEnLCAnMDInLCAnMTAnLCAnMTEnLCAnMTInLCAnMjAnLCAnMjEnLCAnMjInXTsKCi8vcGxheWVyIHByZWZlcmVuY2VzCmlmIChwcmVmX3BsYXllckVuYWJsZSkgewogICAgaW5pdF9wcmVmKCJwbGF5ZXJGaXQiLCBmYWxzZSk7CiAgICBpbml0X3ByZWYoInBsYXllckRlZiIsICJkZWZhdWx0Iik7CiAgICBpbml0X3ByZWYoInBsYXllclNpemUiLCAibWVkaXVtIik7CiAgICBpbml0X3ByZWYoInBsYXllclBvcyIsICIxMSIpOwogICAgaW5pdF9wcmVmKCJwbGF5ZXJOZXh0IiwgdHJ1ZSk7CiAgICBpbml0X3ByZWYoInBsYXllckNsb3NlIiwgdHJ1ZSk7CiAgICBpbml0X3ByZWYoInBsYXllclBhdXNlIiwgdHJ1ZSk7CiAgICBpbml0X3ByZWYoInBsYXllckZvY3VzIiwgZmFsc2UpOwogICAgaW5pdF9wcmVmKCJwbGF5ZXJEaW0iLCB0cnVlKTsKICAgIGluaXRfcHJlZigicGxheWVyUG9zQXV0byIsIGZhbHNlKTsKCiAgICAvL2ZpeCBjaGFyIHByZWZlcmVuY2VzCiAgICBpZiAoY2hvaWNlc19kZWYuaW5kZXhPZihnZXRfcHJlZigicGxheWVyRGVmIikpIDwgMCkgc2V0X3ByZWYoInBsYXllckRlZiIsICdkZWZhdWx0Jyk7CiAgICBpZiAoY2hvaWNlc19zaXplLmluZGV4T2YoZ2V0X3ByZWYoInBsYXllclNpemUiKSkgPCAwKSBzZXRfcHJlZigicGxheWVyU2l6ZSIsICdtZWRpdW0nKTsKICAgIGlmIChjaG9pY2VzX3Bvcy5pbmRleE9mKGdldF9wcmVmKCJwbGF5ZXJQb3MiKSkgPCAwKSBzZXRfcHJlZigicGxheWVyUG9zIiwgJzExJyk7Cn0KCgpmdW5jdGlvbiBwbGF5ZXJfb3B0aW9ucyhwYXJlbnQpIHsKICAgIHZhciBwb3B1cCA9IGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfcGxheWVyX29wdGlvbnNfcG9wdXAiKTsKICAgIGlmIChwb3B1cCkgcmV0dXJuOwoKICAgIHBvcHVwID0gbmV3Tm9kZSgic3BhbiIsICJncmlkdHViZV9wbGF5ZXJfb3B0aW9uc19wb3B1cCIsIG51bGwsIHBhcmVudCk7CgogICAgdmFyIHRpdGxlX25vZGUgPSBuZXdOb2RlKCJkaXYiLCBudWxsLCAiZ3JpZHR1YmVfcGxheWVyX29wdGlvbnNfdGl0bGUiLCBwb3B1cCk7CiAgICB0aXRsZV9ub2RlLnRleHRDb250ZW50ID0gIlByZXZpZXcgUGxheWVyIE9wdGlvbnMiOwoKICAgIHZhciBjbG9zZW1hcmsgPSBuZXdOb2RlKCJzcGFuIiwgbnVsbCwgImdyaWR0dWJlX3BsYXllcl9vcHRpb25zX2Nsb3NlIiwgcG9wdXApOwogICAgY2xvc2VtYXJrLnRleHRDb250ZW50ID0gIlx1Mjc0QyI7CiAgICBjbG9zZW1hcmsudGl0bGUgPSAiY2xvc2Ugb3B0aW9ucyI7CiAgICBjbG9zZW1hcmsub25jbGljayA9IGNsb3NlX3BsYXllcl9vcHRpb25zOwoKCiAgICBuZXdfY2hlY2tib3goInBsYXllck5leHQiLCAiQ29udGludW91cyBQbGF5IiwgImRpdiIsIHBvcHVwKTsKICAgIG5ld19jaGVja2JveCgicGxheWVyRGltIiwgIkRpbSBCYWNrZ3JvdW5kIiwgImRpdiIsIHBvcHVwKTsKICAgIG5ld19jaGVja2JveCgicGxheWVyUG9zQXV0byIsICJBdXRvIEFkanVzdCBQb3NpdGlvbiIsICJkaXYiLCBwb3B1cCk7CiAgICBuZXdfY2hlY2tib3goInBsYXllckNsb3NlIiwgIkNsb3NlIG9uIENsaWNraW5nIE91dHNpZGUgUGxheWVyIiwgImRpdiIsIHBvcHVwKTsKICAgIG5ld19jaGVja2JveCgicGxheWVyUGF1c2UiLCAiUGF1c2UgWW91VHViZSBQbGF5ZXIgYXQgTGF1bmNoIiwgImRpdiIsIHBvcHVwKTsKICAgIG5ld19jaGVja2JveCgicGxheWVyRm9jdXMiLCAiUGF1c2UgYXQgb3V0IG9mIEZvY3VzIFRhYiIsICJkaXYiLCBwb3B1cCk7CgogICAgdmFyIGRpdiA9IG5ld05vZGUoImRpdiIsIG51bGwsICJncmlkdHViZV9wbGF5ZXJfb3B0aW9uc190ZXh0IiwgcG9wdXApOwogICAgLy9kZWZhdWx0LCBzbWFsbCwgbWVkaXVtLCBsYXJnZSwgaGQ3MjAsIGhkMTA4MCwgaGQxNDQwLCBoaWdocmVzOwogICAgZGl2LnRleHRDb250ZW50ID0gIkRlZmluaXRpb24iOwogICAgdmFyIGdyb3VwMSA9IG5ld05vZGUoImRpdiIsIG51bGwsICJncmlkdHViZV9wbGF5ZXJfb3B0aW9uc19ncm91cCIsIHBvcHVwKTsKICAgIHZhciBncm91cDIgPSBuZXdOb2RlKCJkaXYiLCBudWxsLCAiZ3JpZHR1YmVfcGxheWVyX29wdGlvbnNfZ3JvdXAiLCBwb3B1cCk7CiAgICBuZXdfY2hlY2tib3goInBsYXllckRlZiIsICJEZWZhdWx0IiwgInNwYW4iLCBncm91cDEsICJkZWZhdWx0Iik7CiAgICBuZXdfY2hlY2tib3goInBsYXllckRlZiIsICJMUSAyNDAiLCAic3BhbiIsIGdyb3VwMSwgInNtYWxsIik7CiAgICBuZXdfY2hlY2tib3goInBsYXllckRlZiIsICJNUSAzNjAiLCAic3BhbiIsIGdyb3VwMSwgIm1lZGl1bSIpOwogICAgbmV3X2NoZWNrYm94KCJwbGF5ZXJEZWYiLCAiSFEgNDgwIiwgInNwYW4iLCBncm91cDEsICJsYXJnZSIpOwogICAgbmV3X2NoZWNrYm94KCJwbGF5ZXJEZWYiLCAiSEQgNzIwIiwgInNwYW4iLCBncm91cDIsICJoZDcyMCIpOwogICAgbmV3X2NoZWNrYm94KCJwbGF5ZXJEZWYiLCAiSEQgMTA4MCIsICJzcGFuIiwgZ3JvdXAyLCAiaGQxMDgwIik7CiAgICBuZXdfY2hlY2tib3goInBsYXllckRlZiIsICJIRCAxNDQwIiwgInNwYW4iLCBncm91cDIsICJoZDE0NDAiKTsKICAgIG5ld19jaGVja2JveCgicGxheWVyRGVmIiwgIk1BWCIsICJzcGFuIiwgZ3JvdXAyLCAiaGlnaHJlcyIpOwp9CgoKZnVuY3Rpb24gY2xvc2VfcGxheWVyX29wdGlvbnMoKSB7CiAgICB2YXIgcG9wdXAgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoImdyaWR0dWJlX3BsYXllcl9vcHRpb25zX3BvcHVwIik7CiAgICBpZiAocG9wdXApIHBvcHVwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocG9wdXApOwp9CgoKZnVuY3Rpb24gYnVpbGRfcGxheWVyKCkgewogICAgLy9jb25zdGFudHMKICAgIHZhciBuZXh0X2Nob2ljZSA9IG5ldyBPYmplY3QoKTsKICAgIG5leHRfY2hvaWNlWydwbHVzJ10gPSBuZXcgT2JqZWN0KCk7CiAgICBuZXh0X2Nob2ljZVsnbWludXMnXSA9IG5ldyBPYmplY3QoKTsKICAgIG5leHRfY2hvaWNlWydsZWZ0J10gPSBuZXcgT2JqZWN0KCk7CiAgICBuZXh0X2Nob2ljZVsncmlnaHQnXSA9IG5ldyBPYmplY3QoKTsKICAgIG5leHRfY2hvaWNlWyd1cCddID0gbmV3IE9iamVjdCgpOwogICAgbmV4dF9jaG9pY2VbJ2Rvd24nXSA9IG5ldyBPYmplY3QoKTsKCiAgICBuZXh0X2Nob2ljZVsncGx1cyddWyd0aW55J10gPSAnc21hbGwnOwogICAgbmV4dF9jaG9pY2VbJ3BsdXMnXVsnc21hbGwnXSA9ICdtZWRpdW0nOwogICAgbmV4dF9jaG9pY2VbJ3BsdXMnXVsnbWVkaXVtJ10gPSAnbGFyZ2UnOwogICAgbmV4dF9jaG9pY2VbJ3BsdXMnXVsnbGFyZ2UnXSA9ICdodWdlJzsKICAgIG5leHRfY2hvaWNlWydwbHVzJ11bJ2h1Z2UnXSA9ICdodWdlJzsKCiAgICBuZXh0X2Nob2ljZVsnbWludXMnXVsndGlueSddID0gJ3RpbnknOwogICAgbmV4dF9jaG9pY2VbJ21pbnVzJ11bJ3NtYWxsJ10gPSAndGlueSc7CiAgICBuZXh0X2Nob2ljZVsnbWludXMnXVsnbWVkaXVtJ10gPSAnc21hbGwnOwogICAgbmV4dF9jaG9pY2VbJ21pbnVzJ11bJ2xhcmdlJ10gPSAnbWVkaXVtJzsKICAgIG5leHRfY2hvaWNlWydtaW51cyddWydodWdlJ10gPSAnbGFyZ2UnOwoKICAgIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDM7IGkrKykKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgICAgICAgIG5leHRfY2hvaWNlWydsZWZ0J11baS50b1N0cmluZygpICsgai50b1N0cmluZygpXSA9IGkudG9TdHJpbmcoKSArIChqIC0gMSA+PSAwID8gaiAtIDEgOiAwKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgbmV4dF9jaG9pY2VbJ3JpZ2h0J11baS50b1N0cmluZygpICsgai50b1N0cmluZygpXSA9IGkudG9TdHJpbmcoKSArIChqICsgMSA8PSAyID8gaiArIDEgOiAyKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgbmV4dF9jaG9pY2VbJ3VwJ11baS50b1N0cmluZygpICsgai50b1N0cmluZygpXSA9IChpIC0gMSA+PSAwID8gaSAtIDEgOiAwKS50b1N0cmluZygpICsgai50b1N0cmluZygpOwogICAgICAgICAgICAgICAgbmV4dF9jaG9pY2VbJ2Rvd24nXVtpLnRvU3RyaW5nKCkgKyBqLnRvU3RyaW5nKCldID0gKGkgKyAxIDw9IDIgPyBpICsgMSA6IDIpLnRvU3RyaW5nKCkgKyBqLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0KICAgIH0KCiAgICB2YXIgYXJlYSA9IG51bGw7CiAgICB2YXIgYXJlYTIgPSBudWxsOwogICAgdmFyIGJveCA9IG51bGw7CiAgICB2YXIgaG9sZGVyID0gbnVsbDsKICAgIHZhciBob2xkZXIyID0gbnVsbDsKCiAgICB2YXIgbmV3X3NpemUgPSBnZXRfcHJlZigicGxheWVyU2l6ZSIpOwogICAgdmFyIG5ld19wb3MgPSBnZXRfcHJlZigicGxheWVyUG9zIik7CiAgICB2YXIgbmV3X2ZpdCA9IGdldF9wcmVmKCJwbGF5ZXJGaXQiKTsKCiAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICB2YXIgZnJhbWVfY291bnQgPSAwOwoKICAgIC8vcHVibGljCiAgICB0aGlzLnBsYXllclNob3cgPSBmdW5jdGlvbiAodmlkLCBwaWQsIG5vZGUpIHsKICAgICAgICB2YXIgdmlzID0gYm94LnN0eWxlLnZpc2liaWxpdHk7CiAgICAgICAgaWYgKHZpcyA9PSAiaGlkZGVuIikgewogICAgICAgICAgICBuZXdfc2l6ZSA9IGdldF9wcmVmKCJwbGF5ZXJTaXplIik7CiAgICAgICAgICAgIG5ld19wb3MgPSBnZXRfcHJlZigicGxheWVyUG9zIik7CiAgICAgICAgICAgIG5ld19maXQgPSBnZXRfcHJlZigicGxheWVyRml0Iik7CiAgICAgICAgfQogICAgICAgIHBsYXllckFkanVzdCgobmV3X2ZpdCA/ICdmaXQnIDogbmV3X3NpemUpLCBuZXdfcG9zLCAidmlzaWJsZSIsIHZpZCwgcGlkKTsKICAgICAgICBpZiAoIW5ld19maXQgJiYgZ2V0X3ByZWYoInBsYXllclBvc0F1dG8iKSkgYWRqdXN0X2F1dG9fcG9zKG5vZGUpOwogICAgICAgIGFkanVzdF9wbGF5aW5nKG5vZGUpOwogICAgfQoKICAgIHRoaXMucGxheWVyQ2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcGxheWVyQWRqdXN0KG51bGwsIG51bGwsICJoaWRkZW4iLCBudWxsLCBudWxsKTsKICAgICAgICBjbG9zZV9wbGF5ZXJfb3B0aW9ucygpOwogICAgICAgIGFkanVzdF9wbGF5aW5nKCk7CiAgICAgICAgbW92ZV9lbmFibGUgPSBmYWxzZTsKICAgIH0KCiAgICB0aGlzLnBsYXllclBhdXNlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBmcmFtZSA9IGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfcGxheWVyX2ZyYW1lIik7CiAgICAgICAgaWYgKGZyYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgdmFyIGV2ZW50ID0gZG9jLmNyZWF0ZUV2ZW50KCdFdmVudCcpOwogICAgICAgICAgICBldmVudC5pbml0RXZlbnQoJ3BhdXNldmlkZW8nLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgZnJhbWUuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vcHJpdmF0ZQogICAgZnVuY3Rpb24gcGxheWVyVXJsKHZpZCwgcGlkKSB7CgogICAgICAgIHZhciB1cmwgPSB3aW4ubG9jYXRpb24ucHJvdG9jb2wgKyAiLy93d3cueW91dHViZS5jb20vIjsKCiAgICAgICAgaWYgKHZpZCkgdXJsICs9ICJlbWJlZC8iICsgdmlkICsgIj8iICsgKHBpZCA/ICImbGlzdD0iICsgcGlkIDogIiIpOwogICAgICAgIGVsc2UgaWYgKHBpZCkgdXJsICs9ICJlbWJlZD9saXN0VHlwZT1wbGF5bGlzdCZsaXN0PSIgKyBwaWQ7CgogICAgICAgIHVybCArPSAiJmF1dG9wbGF5PTEmZnM9MSZpdl9sb2FkX3BvbGljeT0zJnJlbD0xJnZlcnNpb249MyZlbmFibGVqc2FwaT0xIjsKCiAgICAgICAgcmV0dXJuICh1cmwpOwogICAgfQoKCiAgICBmdW5jdGlvbiBhZGp1c3RfcGxheWluZyhub2RlKSB7CiAgICAgICAgdmFyIHBsYXlpbmcgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoImdyaWR0dWJlX21ldGFfcGxheWluZyIpOwogICAgICAgIGlmIChwbGF5aW5nKQogICAgICAgICAgICBwbGF5aW5nLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocGxheWluZyk7CgogICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgIHBsYXlpbmcgPSBuZXdOb2RlKCJzcGFuIiwgImdyaWR0dWJlX21ldGFfcGxheWluZyIsIG51bGwsIG5vZGUpOwogICAgICAgICAgICBwbGF5aW5nLnRleHRDb250ZW50ID0gIm5vdyBwbGF5aW5nIjsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIGFkanVzdF9hdXRvX3Bvcyhub2RlKSB7CgogICAgICAgIHZhciBub2RlX3JlY3QgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIHZhciBib3hfcmVjdCA9IGJveC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgICAgLy9pZiAoKG5vZGVfcmVjdC50b3AgPiBkb2MuYm9keS5jbGllbnRIZWlnaHQpIHx8CiAgICAgICAgLy8gICAgKG5vZGVfcmVjdC5sZWZ0ID4gZG9jLmJvZHkuY2xpZW50V2lkdGgpKSByZXR1cm47CgogICAgICAgIGlmIChib3hfcmVjdC5yaWdodCA8IG5vZGVfcmVjdC5sZWZ0IHx8CiAgICAgICAgICAgIGJveF9yZWN0LmxlZnQgPiBub2RlX3JlY3QucmlnaHQgfHwKICAgICAgICAgICAgYm94X3JlY3QudG9wID4gbm9kZV9yZWN0LmJvdHRvbSB8fAogICAgICAgICAgICBib3hfcmVjdC5ib3R0b20gPCBub2RlX3JlY3QudG9wKSByZXR1cm47CgogICAgICAgIHZhciBub2RlX1hfY2VudGVyID0gKG5vZGVfcmVjdC5sZWZ0ICsgbm9kZV9yZWN0LndpZHRoIC8gMik7CiAgICAgICAgdmFyIG5vZGVfWV9jZW50ZXIgPSAobm9kZV9yZWN0LnRvcCArIG5vZGVfcmVjdC5oZWlnaHQgLyAyKTsKCiAgICAgICAgdmFyIFhfZml0ID0gKGJveF9yZWN0LndpZHRoIC8gMikgKyAobm9kZV9yZWN0LndpZHRoIC8gMik7CiAgICAgICAgdmFyIFlfZml0ID0gKGJveF9yZWN0LmhlaWdodCAvIDIpICsgKG5vZGVfcmVjdC5oZWlnaHQgLyAyKTsKCiAgICAgICAgdmFyIFggPSBbXTsKICAgICAgICB2YXIgWSA9IFtdOwogICAgICAgIFhbMF0gPSBNYXRoLmFicygoYm94X3JlY3Qud2lkdGggLyAyKSAtIG5vZGVfWF9jZW50ZXIpOwogICAgICAgIFhbMV0gPSBNYXRoLmFicygoZG9jLmJvZHkuY2xpZW50V2lkdGggLyAyKSAtIG5vZGVfWF9jZW50ZXIpOwogICAgICAgIFhbMl0gPSBNYXRoLmFicyhkb2MuYm9keS5jbGllbnRXaWR0aCAtIChib3hfcmVjdC53aWR0aCAvIDIpIC0gbm9kZV9YX2NlbnRlcik7CgogICAgICAgIFlbMF0gPSBNYXRoLmFicygoYm94X3JlY3QuaGVpZ2h0IC8gMikgLSBub2RlX1lfY2VudGVyKTsKICAgICAgICBZWzFdID0gTWF0aC5hYnMoKGRvYy5ib2R5LmNsaWVudEhlaWdodCAvIDIpIC0gbm9kZV9ZX2NlbnRlcik7CiAgICAgICAgWVsyXSA9IE1hdGguYWJzKGRvYy5ib2R5LmNsaWVudEhlaWdodCAtIChib3hfcmVjdC5oZWlnaHQgLyAyKSAtIG5vZGVfWV9jZW50ZXIpOwoKICAgICAgICB2YXIgbWluWCA9IDA7CiAgICAgICAgaWYgKFhbMV0gPCBYW21pblhdKSBtaW5YID0gMTsKICAgICAgICBpZiAoWFsyXSA8IFhbbWluWF0pIG1pblggPSAyOwoKICAgICAgICB2YXIgbWluWSA9IDA7CiAgICAgICAgaWYgKFlbMV0gPCBZW21pblldKSBtaW5ZID0gMTsKICAgICAgICBpZiAoWVsyXSA8IFlbbWluWV0pIG1pblkgPSAyOwoKICAgICAgICB2YXIgbWluWF9maXQgPSAtMTsKICAgICAgICB2YXIgbWluWV9maXQgPSAtMTsKICAgICAgICB2YXIgWHZhbCA9IC0xOwogICAgICAgIHZhciBZdmFsID0gLTE7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICAgICAgaWYgKFhbaV0gPj0gWF9maXQgJiYgKFhbaV0gPCBYdmFsIHx8IFh2YWwgPT0gLTEpKSB7CiAgICAgICAgICAgICAgICBtaW5YX2ZpdCA9IGk7CiAgICAgICAgICAgICAgICBYdmFsID0gWFtpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoWVtpXSA+PSBZX2ZpdCAmJiAoWVtpXSA8IFl2YWwgfHwgWXZhbCA9PSAtMSkpIHsKICAgICAgICAgICAgICAgIG1pbllfZml0ID0gaTsKICAgICAgICAgICAgICAgIFl2YWwgPSBZW2ldOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobWluWF9maXQgPT0gLTEgJiYgbWluWV9maXQgPT0gLTEpIHJldHVybjsKCiAgICAgICAgaWYgKFh2YWwgPD0gWXZhbCkKICAgICAgICAgICAgaWYgKG1pblhfZml0ICE9IC0xKQogICAgICAgICAgICAgICAgbWluWV9maXQgPSBtaW5ZOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBtaW5YX2ZpdCA9IG1pblg7CiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiAobWluWV9maXQgIT0gLTEpCiAgICAgICAgICAgICAgICBtaW5YX2ZpdCA9IG1pblg7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIG1pbllfZml0ID0gbWluWTsKCiAgICAgICAgbmV3X3BvcyA9IG1pbllfZml0LnRvU3RyaW5nKCkgKyBtaW5YX2ZpdC50b1N0cmluZygpOwogICAgICAgIHBsYXllckFkanVzdChudWxsLCBuZXdfcG9zKTsKICAgIH0KCgogICAgZnVuY3Rpb24gcGxheV9uZXh0KGZpbmRwcmV2aW91cykgewoKICAgICAgICB2YXIgcGxheWluZyA9IGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfbWV0YV9wbGF5aW5nIik7CiAgICAgICAgaWYgKCFwbGF5aW5nKSByZXR1cm47CgogICAgICAgIHZhciBwb3MgPSAtMjsKICAgICAgICB2YXIgbCA9IG51bGw7CgogICAgICAgIHZhciBteWltZyA9IGlubmVyc2VhcmNoKHBsYXlpbmcucGFyZW50Tm9kZSwgIi4vL2ltZ1tAc3JjIG9yIEBkYXRhLXRodW1iXSIpLnNuYXBzaG90SXRlbSgwKTsKICAgICAgICBpZiAobXlpbWcpIHsKICAgICAgICAgICAgLy9sID0gZG9jc2VhcmNoKCIvLypbKCIgKyBiYXNpY19zdHIgKyAiKSBhbmQgKG5vdChhbmNlc3Rvcjo6Kltjb250YWlucyhAY2xhc3MsJ3Z2ZS1jaGVjaycpXSkpXS8vaW1nW2NvbnRhaW5zKEBzcmMsJ3ZpLycpIG9yIGNvbnRhaW5zKEBzcmMsJ3ZpX3dlYnAvJyldIik7CiAgICAgICAgICAgIGwgPSBkb2NzZWFyY2goIi8vKlsoIiArIGJhc2ljX3N0ciArICIpXS8vaW1nW2NvbnRhaW5zKEBzcmMsJ3ZpLycpIG9yIGNvbnRhaW5zKEBzcmMsJ3ZpX3dlYnAvJykgb3IgY29udGFpbnMoQHNyYywnL3AvJyldIik7CgogICAgICAgICAgICBteWltZy5zZXRBdHRyaWJ1dGUoIm1hdGNoZmluZCIsICJ0cnVlIik7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGwuc25hcHNob3RMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGwuc25hcHNob3RJdGVtKGkpLmdldEF0dHJpYnV0ZSgibWF0Y2hmaW5kIikpIHsKICAgICAgICAgICAgICAgICAgICBwb3MgPSBpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBteWltZy5yZW1vdmVBdHRyaWJ1dGUoIm1hdGNoZmluZCIpOwogICAgICAgIH0KCiAgICAgICAgcG9zID0gKGZpbmRwcmV2aW91cyA/IHBvcyAtIDEgOiBwb3MgKyAxKTsKCiAgICAgICAgaWYgKHBvcyA+PSAwKSB7CiAgICAgICAgICAgIHZhciBpbWcgPSBsLnNuYXBzaG90SXRlbShwb3MpOwogICAgICAgICAgICBpZiAoaW1nKSB7CiAgICAgICAgICAgICAgICB2YXIgc3RyMSA9IGltZy5nZXRBdHRyaWJ1dGUoInNyYyIpOwogICAgICAgICAgICAgICAgdmFyIHZpZCA9IGZpbHRlcihzdHIxLCAidmkvIiwgIi8mPyMiKTsKICAgICAgICAgICAgICAgIGlmICghdmlkKSB2aWQgPSBmaWx0ZXIoc3RyMSwgInZpX3dlYnAvIiwgIi8mPyMiKTsKCiAgICAgICAgICAgICAgICB2YXIgcGlkID0gZmluZF9wbGlzdChpbWcpOwogICAgICAgICAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgibWF0Y2hmaW5kaW1nIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZG9jc2VhcmNoKCIvLypbIiArIGJhc2ljX3N0ciArICIgYW5kICguLy9pbWdbQG1hdGNoZmluZGltZ10pXSIpLnNuYXBzaG90SXRlbSgwKTsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICB0aGF0LnBsYXllclNob3codmlkLCBwaWQsIHRhcmdldCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbWcucmVtb3ZlQXR0cmlidXRlKCJtYXRjaGZpbmRpbWciKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gcGxheWVyQWRqdXN0KHNpemUsIHBvcywgdmlzLCB2aWQsIHBpZCkgewoKICAgICAgICBpZiAodmlzICE9IG51bGwpIHsKICAgICAgICAgICAgYm94LnN0eWxlLnZpc2liaWxpdHkgPSB2aXM7CiAgICAgICAgICAgIGFyZWEuc3R5bGUudmlzaWJpbGl0eSA9IChnZXRfcHJlZigicGxheWVyRGltIikgPyB2aXMgOiAiaGlkZGVuIik7CgogICAgICAgICAgICB2YXIgZnJhbWUgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoImdyaWR0dWJlX3BsYXllcl9mcmFtZSIpOwogICAgICAgICAgICBpZiAoZnJhbWUgIT0gbnVsbCAmJiAodmlzID09ICdoaWRkZW4nKSkgewogICAgICAgICAgICAgICAgZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmcmFtZSk7CiAgICAgICAgICAgICAgICBmcmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2aXMgPT0gInZpc2libGUiKSB7CiAgICAgICAgICAgICAgICB2YXIgdmlkdXJsID0gcGxheWVyVXJsKHZpZCwgcGlkKTsKICAgICAgICAgICAgICAgIHZhciBkZWYgPSBnZXRfcHJlZigicGxheWVyRGVmIik7CiAgICAgICAgICAgICAgICBmcmFtZV9jb3VudCsrOwoKICAgICAgICAgICAgICAgIGlmIChmcmFtZSkgewogICAgICAgICAgICAgICAgICAgIGZyYW1lLnNldEF0dHJpYnV0ZSgibmV3dmlkdXJsIiwgdmlkdXJsKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGlkKSBmcmFtZS5zZXRBdHRyaWJ1dGUoInBsaXN0IiwgcGlkKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGZyYW1lLnJlbW92ZUF0dHJpYnV0ZSgicGxpc3QiKTsKICAgICAgICAgICAgICAgICAgICBmcmFtZS5zZXRBdHRyaWJ1dGUoInF1YWxpdHkiLCBkZWYpOwogICAgICAgICAgICAgICAgICAgIGZyYW1lLnNldEF0dHJpYnV0ZSgiZmlkIiwgZnJhbWVfY291bnQudG9TdHJpbmcoKSk7CgogICAgICAgICAgICAgICAgICAgIHZhciBldmVudCA9IGRvYy5jcmVhdGVFdmVudCgnRXZlbnQnKTsKICAgICAgICAgICAgICAgICAgICBldmVudC5pbml0RXZlbnQoJ2xvYWRuZXd2aWRlbycsIHRydWUsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGZyYW1lLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZnJhbWUgPSBuZXdOb2RlKCJpZnJhbWUiLCAiZ3JpZHR1YmVfcGxheWVyX2ZyYW1lIiwgbnVsbCwgaG9sZGVyMik7CiAgICAgICAgICAgICAgICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQvaHRtbCIpOwogICAgICAgICAgICAgICAgICAgIGZyYW1lLnNldEF0dHJpYnV0ZSgiZnJhbWVib3JkZXIiLCAiMCIpOwogICAgICAgICAgICAgICAgICAgIGZyYW1lLnNldEF0dHJpYnV0ZSgiYWxsb3dmdWxsc2NyZWVuIiwgInRydWUiKTsKICAgICAgICAgICAgICAgICAgICBmcmFtZS5zZXRBdHRyaWJ1dGUoInF1YWxpdHkiLCBkZWYpOwogICAgICAgICAgICAgICAgICAgIGZyYW1lLnNldEF0dHJpYnV0ZSgiZmlkIiwgZnJhbWVfY291bnQudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgZnJhbWUuc3JjID0gdmlkdXJsOwogICAgICAgICAgICAgICAgICAgIGZyYW1lLmFkZEV2ZW50TGlzdGVuZXIoJ3BsYXllbmQnLCBmdW5jdGlvbiBmKCkgeyBpZiAoZ2V0X3ByZWYoInBsYXllck5leHQiKSkgcGxheV9uZXh0KCk7IH0pOwoKICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfc2NyaXB0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzaXplICE9IG51bGwpIHsKICAgICAgICAgICAgYm94LnNldEF0dHJpYnV0ZSgicGxheWVyX3NpemUiLCBzaXplKTsKICAgICAgICAgICAgaG9sZGVyLnNldEF0dHJpYnV0ZSgicGxheWVyX3NpemUiLCBzaXplKTsKICAgICAgICB9CgogICAgICAgIGlmIChwb3MgIT0gbnVsbCkKICAgICAgICAgICAgYm94LnNldEF0dHJpYnV0ZSgicGxheWVyX3BvcyIsIHBvcyk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGNsaWNrX3Bvc19zaXplKGUpIHsKICAgICAgICB2YXIga2luZCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgiYnV0dG9uX2tpbmQiKTsKCiAgICAgICAgaWYgKG5ld19maXQgJiYgIShraW5kID09ICdvcHRpb25zJyB8fCBraW5kID09ICdwcmV2JyB8fCBraW5kID09ICduZXh0JykpIHsKICAgICAgICAgICAgc2V0X3ByZWYoInBsYXllckZpdCIsIGZhbHNlKTsKICAgICAgICAgICAgbmV3X2ZpdCA9IGZhbHNlOwogICAgICAgICAgICBwbGF5ZXJBZGp1c3QobmV3X3NpemUsIG5ld19wb3MpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKGtpbmQpIHsKICAgICAgICAgICAgY2FzZSAncGx1cyc6CiAgICAgICAgICAgIGNhc2UgJ21pbnVzJzoKICAgICAgICAgICAgICAgIG5ld19zaXplID0gbmV4dF9jaG9pY2Vba2luZF1bbmV3X3NpemVdOwogICAgICAgICAgICAgICAgc2V0X3ByZWYoInBsYXllclNpemUiLCBuZXdfc2l6ZSk7CiAgICAgICAgICAgICAgICBwbGF5ZXJBZGp1c3QobmV3X3NpemUsIG5ld19wb3MpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdmaXQnOgogICAgICAgICAgICAgICAgc2V0X3ByZWYoInBsYXllckZpdCIsIHRydWUpOwogICAgICAgICAgICAgICAgbmV3X2ZpdCA9IHRydWU7CiAgICAgICAgICAgICAgICBwbGF5ZXJBZGp1c3QoJ2ZpdCcpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdsZWZ0JzoKICAgICAgICAgICAgY2FzZSAncmlnaHQnOgogICAgICAgICAgICBjYXNlICd1cCc6CiAgICAgICAgICAgIGNhc2UgJ2Rvd24nOgogICAgICAgICAgICAgICAgbmV3X3BvcyA9IG5leHRfY2hvaWNlW2tpbmRdW25ld19wb3NdOwogICAgICAgICAgICAgICAgc2V0X3ByZWYoInBsYXllclBvcyIsIG5ld19wb3MpOwogICAgICAgICAgICAgICAgcGxheWVyQWRqdXN0KG5ld19zaXplLCBuZXdfcG9zKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnb3B0aW9ucyc6CiAgICAgICAgICAgICAgICBwbGF5ZXJfb3B0aW9ucyhib3gpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdwcmV2JzoKICAgICAgICAgICAgICAgIHBsYXlfbmV4dCh0cnVlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnbmV4dCc6CiAgICAgICAgICAgICAgICBwbGF5X25leHQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gbmV3X2J1dHRvbihraW5kLCBzdHIsIHN0cl9wb3B1cCwgcGFyZW50KSB7CiAgICAgICAgdmFyIG5vZGUgPSBuZXdOb2RlKCJzcGFuIiwgbnVsbCwgImdyaWR0dWJlX3BsYXllcl9idXR0b24iLCBwYXJlbnQpOwogICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSBzdHI7CiAgICAgICAgbm9kZS50aXRsZSA9IHN0cl9wb3B1cDsKICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgiYnV0dG9uX2tpbmQiLCBraW5kKTsKICAgICAgICBub2RlLm9uY2xpY2sgPSBjbGlja19wb3Nfc2l6ZTsKICAgIH0KCiAgICAvL2luaXRpYWxpemF0aW9uOwogICAgaWYgKGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfcGxheWVyX2FyZWEiKSkgcmV0dXJuOwoKICAgIGFyZWEgPSBuZXdOb2RlKCJkaXYiLCAiZ3JpZHR1YmVfcGxheWVyX2FyZWEiLCBudWxsLCBkb2MuYm9keSk7CiAgICBhcmVhMiA9IG5ld05vZGUoImRpdiIsICJncmlkdHViZV9wbGF5ZXJfYXJlYTIiLCBudWxsLCBhcmVhKTsKICAgIGJveCA9IG5ld05vZGUoImRpdiIsICJncmlkdHViZV9wbGF5ZXJfYm94IiwgbnVsbCwgYXJlYTIpOwogICAgaG9sZGVyID0gbmV3Tm9kZSgiZGl2IiwgImdyaWR0dWJlX3BsYXllcl9ob2xkZXIiLCBudWxsLCBib3gpOwogICAgaG9sZGVyMiA9IG5ld05vZGUoImRpdiIsICJncmlkdHViZV9wbGF5ZXJfaG9sZGVyMiIsIG51bGwsIGhvbGRlcik7CiAgICBib3guc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgYXJlYS5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICBob2xkZXIudGl0bGUgPSAiY2xvc2UgcGxheWVyIjsKCiAgICBob2xkZXIub25jbGljayA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGUudGFyZ2V0LmlkID09ICJncmlkdHViZV9wbGF5ZXJfaG9sZGVyIikgdGhhdC5wbGF5ZXJDbG9zZSgpOwogICAgfTsKCiAgICBhcmVhLm9uY2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnRhcmdldC5pZCA9PSAiZ3JpZHR1YmVfcGxheWVyX2FyZWEiKQogICAgICAgICAgICBpZiAoZ2V0X3ByZWYoInBsYXllckNsb3NlIikpIHRoYXQucGxheWVyQ2xvc2UoKTsKICAgIH07CgogICAgdmFyIGJ1dHRvbkFyZWEgPSBuZXdOb2RlKCJzcGFuIiwgImdyaWR0dWJlX3BsYXllcl9idXR0b25fYXJlYV90b3AiLCBudWxsLCBib3gpOwogICAgbmV3X2J1dHRvbigicGx1cyIsICJcdTI3OTUiLCAiaW5jcmVhc2UgcGxheWVyIHNpemUiLCBidXR0b25BcmVhKTsKICAgIG5ld19idXR0b24oIm1pbnVzIiwgIlx1Mjc5NiIsICJkZWNyZWFzZSBwbGF5ZXIgc2l6ZSIsIGJ1dHRvbkFyZWEpOwogICAgbmV3X2J1dHRvbigiZml0IiwgIlx1MjYxMCIsICJmaXQgcGxheWVyIHRvIHdpbmRvdyIsIGJ1dHRvbkFyZWEpOwogICAgbmV3X2J1dHRvbignbGVmdCcsICdcdTI1QzQnLCAnbW92ZSBwbGF5ZXIgbGVmdCcsIGJ1dHRvbkFyZWEpOwogICAgbmV3X2J1dHRvbigncmlnaHQnLCAnXHUyNUJBJywgJ21vdmUgcGxheWVyIHJpZ2h0JywgYnV0dG9uQXJlYSk7CiAgICBuZXdfYnV0dG9uKCd1cCcsICdcdTI1QjInLCAnbW92ZSBwbGF5ZXIgdXAnLCBidXR0b25BcmVhKTsKICAgIG5ld19idXR0b24oJ2Rvd24nLCAnXHUyNUJDJywgJ21vdmUgcGxheWVyIGRvd24nLCBidXR0b25BcmVhKTsKICAgIG5ld19idXR0b24oIm9wdGlvbnMiLCAiT3B0aW9ucyIsICJwbGF5ZXIgb3B0aW9ucyIsIGJ1dHRvbkFyZWEpOwoKICAgIHZhciBib3R0b21BcmVhID0gbmV3Tm9kZSgic3BhbiIsICJncmlkdHViZV9wbGF5ZXJfYnV0dG9uX2FyZWFfYm90dG9tIiwgbnVsbCwgYm94KTsKICAgIG5ld19idXR0b24oInByZXYiLCAiXHUxNDBBXHUxNDBBIiwgInBsYXkgcHJldmlvdXMgaW4gcGFnZSIsIGJvdHRvbUFyZWEpOwogICAgbmV3X2J1dHRvbigibmV4dCIsICJcdTE0MDVcdTE0MDUiLCAicGxheSBuZXh0IGluIHBhZ2UiLCBib3R0b21BcmVhKTsKICAgIC8vbmV3X2J1dHRvbigibG9vcCIsICJcdTIxQkIiLCAicmVwZWF0IHZpZGVvIiwgYm90dG9tQXJlYSk7CgogICAgdmFyIG1hcmsgPSBuZXdOb2RlKCJzcGFuIiwgImdyaWR0dWJlX3BsYXllcl9jbG9zZV9tYXJrIiwgbnVsbCwgYm94KTsKICAgIG1hcmsudGV4dENvbnRlbnQgPSAiXHUyNzRDIjsKICAgIG1hcmsudGl0bGUgPSAiY2xvc2UgcGxheWVyIjsKICAgIG1hcmsub25jbGljayA9IHRoaXMucGxheWVyQ2xvc2U7Cn0KCgp2YXIgcGxheWVyID0gbnVsbDsKaWYgKHByZWZfcGxheWVyRW5hYmxlKSB7CiAgICBwbGF5ZXIgPSBuZXcgYnVpbGRfcGxheWVyKCk7CiAgICBpbmplY3RTY3JpcHQobnVsbCwgJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2lmcmFtZV9hcGknKTsKfQoKCmZ1bmN0aW9uIHBsYXllcl9jbG9zZShlKSB7CiAgICBpZiAoIXBsYXllcikgcmV0dXJuOwoKICAgIGlmIChlKSB7CiAgICAgICAgaWYgKCFnZXRfcHJlZigicGxheWVyQ2xvc2UiKSkgcmV0dXJuOwoKICAgICAgICB2YXIgcGF0dGVybiA9IC9ncmlkdHViZXx5dHBjfGJ1dHRvbnxzdWJzY3JpYmUvOwoKICAgICAgICBpZiAoZS50YXJnZXQuaWQpCiAgICAgICAgICAgIGlmIChlLnRhcmdldC5pZC5tYXRjaChwYXR0ZXJuKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZSkKICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZS5tYXRjaChwYXR0ZXJuKSkKICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lID09ICJCVVRUT04iIHx8IGUudGFyZ2V0Lm5vZGVOYW1lID09ICJJTlBVVCIpCiAgICAgICAgICAgIHJldHVybjsKICAgIH0KCiAgICBwbGF5ZXIucGxheWVyQ2xvc2UoKTsKfQoKCmZ1bmN0aW9uIHl0cGF1c2UoKSB7CiAgICBpbmplY3RTY3JpcHQoInZhciBhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2M0LXBsYXllcicpIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZpZV9wbGF5ZXInKTtcCiAgICAgICAgICAgICAgICAgICBpZiAoYSAhPSBudWxsKVwKICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnBhdXNlVmlkZW8gIT0gbnVsbCl7XAogICAgICAgICAgICAgICAgICAgICAgICAgIGEucGF1c2VWaWRlbygpO1wKICAgICAgICAgICAgICAgICAgICAgIH1cCiAgICAgICAgICAgICAgICAgICIpOwp9CgoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy9tZXRhIGRhdGEKCnZhciBhcGlfa2V5ID0gIkFJemFTeUF4bjZtNGstWWRzWWhyd1VaMk14Zl9MaDVqQy1sV2V5QSI7CgpmdW5jdGlvbiBkYXRhX2VudHJ5X3YzKGVudHJ5KSB7CgogICAgdmFyIHJldCA9IG5ldyBPYmplY3QoKTsKCiAgICByZXQuZmVlZEtpbmQgPSBudWxsOwogICAgcmV0LmZlZWRJZCA9IG51bGw7CgogICAgcmV0LnRpdGxlID0gbnVsbDsKICAgIHJldC5kZXNjciA9IG51bGw7CiAgICByZXQubGVuZ3RoID0gbnVsbDsKCiAgICByZXQudmlld3MgPSBudWxsOwogICAgcmV0Lmxlbmd0aCA9IG51bGw7CiAgICByZXQubGlrZXMgPSBudWxsOwogICAgcmV0LmRpc2xpa2VzID0gbnVsbDsKICAgIHJldC5IRCA9IG51bGw7CgogICAgcmV0LnVzZXIgPSBuZXcgT2JqZWN0KCk7CiAgICByZXQudXNlci5pZCA9IG51bGw7CiAgICByZXQudXNlci5uYW1lID0gbnVsbDsKICAgIHJldC51c2VyLmNoYW5uZWxJZCA9IG51bGw7CgogICAgaWYgKGVudHJ5LmtpbmQpCiAgICAgICAgaWYgKGVudHJ5LmtpbmQgPT0gInlvdXR1YmUjdmlkZW8iKQogICAgICAgICAgICByZXQuZmVlZEtpbmQgPSAidmlkZW8iOwoKICAgIGlmIChlbnRyeS5pZCkKICAgICAgICByZXQuZmVlZElkID0gZW50cnkuaWQ7CgogICAgLy9tZXNzYWdlKCJmZWVkS2luZD0iICsgcmV0LmZlZWRLaW5kKTsKICAgIC8vbWVzc2FnZSgiZmVlZElkPSIgKyByZXQuZmVlZElkKTsKCiAgICBpZiAoZW50cnkuc25pcHBldCkgewogICAgICAgIGlmIChlbnRyeS5zbmlwcGV0LnRpdGxlKQogICAgICAgICAgICByZXQudGl0bGUgPSBlbnRyeS5zbmlwcGV0LnRpdGxlOwogICAgICAgIGlmIChlbnRyeS5zbmlwcGV0LmRlc2NyaXB0aW9uKQogICAgICAgICAgICByZXQuZGVzY3IgPSBlbnRyeS5zbmlwcGV0LmRlc2NyaXB0aW9uOwogICAgICAgIGlmIChlbnRyeS5zbmlwcGV0LmNoYW5uZWxJZCkKICAgICAgICAgICAgcmV0LnVzZXIuY2hhbm5lbElkID0gZW50cnkuc25pcHBldC5jaGFubmVsSWQ7CiAgICAgICAgaWYgKGVudHJ5LnNuaXBwZXQuY2hhbm5lbFRpdGxlKQogICAgICAgICAgICByZXQudXNlci5uYW1lID0gZW50cnkuc25pcHBldC5jaGFubmVsVGl0bGU7CgogICAgICAgIC8vbWVzc2FnZSgidGl0bGU9IiArIHJldC50aXRsZSk7CiAgICAgICAgLy9tZXNzYWdlKCJkZXNjcmlwdGlvbj0iICsgcmV0LmRlc2NyKTsKICAgICAgICAvL21lc3NhZ2UoImNoYW5uZWxJZD0iICsgcmV0LnVzZXIuY2hhbm5lbElkKTsKICAgIH0KCgogICAgaWYgKGVudHJ5LmNvbnRlbnREZXRhaWxzKSB7CiAgICAgICAgaWYgKGVudHJ5LmNvbnRlbnREZXRhaWxzLmRlZmluaXRpb24pCiAgICAgICAgICAgIGlmIChlbnRyeS5jb250ZW50RGV0YWlscy5kZWZpbml0aW9uID09ICJoZCIpCiAgICAgICAgICAgICAgICByZXQuSEQgPSB0cnVlOwoKICAgICAgICBpZiAoZW50cnkuY29udGVudERldGFpbHMuZHVyYXRpb24pCiAgICAgICAgICAgIHJldC5sZW5ndGggPSBlbnRyeS5jb250ZW50RGV0YWlscy5kdXJhdGlvbjsKCiAgICAgICAgLy9tZXNzYWdlKCJIRD0iICsgcmV0LkhEKTsKICAgICAgICAvL21lc3NhZ2UoImxlbmd0aD0iICsgcmV0Lmxlbmd0aCArICIgIGNvbnZlcnRlZDoiICsgdGltZV9jb2x1bW4ocmV0Lmxlbmd0aCkpOwogICAgfQoKICAgIGlmIChlbnRyeS5zdGF0aXN0aWNzKSB7CiAgICAgICAgaWYgKGVudHJ5LnN0YXRpc3RpY3Mudmlld0NvdW50KQogICAgICAgICAgICByZXQudmlld3MgPSBlbnRyeS5zdGF0aXN0aWNzLnZpZXdDb3VudDsKICAgICAgICBpZiAoZW50cnkuc3RhdGlzdGljcy5saWtlQ291bnQpCiAgICAgICAgICAgIHJldC5saWtlcyA9IGVudHJ5LnN0YXRpc3RpY3MubGlrZUNvdW50OwogICAgICAgIGlmIChlbnRyeS5zdGF0aXN0aWNzLmRpc2xpa2VDb3VudCkKICAgICAgICAgICAgcmV0LmRpc2xpa2VzID0gZW50cnkuc3RhdGlzdGljcy5kaXNsaWtlQ291bnQ7CgogICAgICAgIC8vbWVzc2FnZSgidmlld3M9IiArIHJldC52aWV3cyArICIgICAgIGxpa2VzPSIgKyByZXQubGlrZXMgKyAiICAgICAgIGRpc2xpa2VzPSIgKyByZXQuZGlzbGlrZXMpOwogICAgfQoKICAgIHJldHVybiByZXQ7Cn0KCgpmdW5jdGlvbiBkYXRhX2ZlZWRfdjMoanNvbl90eHQpIHsKCiAgICAvL29iamVjdCB0byBiZSByZXR1cm5lZAogICAgdmFyIHJldCA9IG5ldyBPYmplY3QoKTsKICAgIHJldC50b3RhbFJlc3VsdHMgPSAwOwogICAgcmV0LmVudHJ5ID0gbmV3IEFycmF5KCk7CgogICAgLy9tYWluIGNvZGUKICAgIHZhciBqb2IgPSBudWxsOyAvL2pzb24gb2JqZWN0CiAgICBpZiAoanNvbl90eHQgIT0gbnVsbCkKICAgICAgICBqb2IgPSBKU09OLnBhcnNlKGpzb25fdHh0KTsKCiAgICBpZiAoam9iID09IG51bGwpIHJldHVybiByZXQ7CgogICAgLy9qbWVzc2FnZShqb2IpOwoKICAgIGlmIChqb2IucGFnZUluZm8gIT0gbnVsbCkKICAgICAgICBpZiAoam9iLnBhZ2VJbmZvLnRvdGFsUmVzdWx0cyAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldC50b3RhbFJlc3VsdHMgPSBqb2IucGFnZUluZm8udG90YWxSZXN1bHRzOwogICAgICAgICAgICAvL21lc3NhZ2UoInRvdGFsUmVzdWx0cz0iICsgcmV0LnRvdGFsUmVzdWx0cyk7CiAgICAgICAgfQoKICAgIGlmIChqb2IuaXRlbXMgIT0gbnVsbCkKICAgICAgICBpZiAoam9iLml0ZW1zLmxlbmd0aCAhPSAwKQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGpvYi5pdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBkYXRhX2VudHJ5X3YzKGpvYi5pdGVtc1tpXSk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5mZWVkS2luZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0LmVudHJ5LnB1c2goZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICByZXR1cm4gcmV0Owp9CgoKZnVuY3Rpb24gY2FsbGJhY2syKGpzb25fdHh0LCBkZWZfbm9kZSwgYnVpbGRIRCwgYnVpbGRSYXRlLCBwYXJlbnQpIHsKICAgIC8vbWVzc2FnZShqc29uX3R4dCk7CgogICAgdmFyIGZlZWQgPSBkYXRhX2ZlZWRfdjMoanNvbl90eHQpOwoKICAgIGlmIChmZWVkLmVudHJ5Lmxlbmd0aCAhPSAxKSByZXR1cm47CiAgICB2YXIgZW50cnkgPSBmZWVkLmVudHJ5WzBdOwoKICAgIC8vbWVzc2FnZSgiaGVyZSIpOwoKICAgIGlmIChidWlsZEhEKSB7CiAgICAgICAgaWYgKGVudHJ5LkhEICE9IG51bGwpIHsKICAgICAgICAgICAgZGVmX25vZGUuc2V0QXR0cmlidXRlKCJyZXZlYWwiLCAidHJ1ZSIpOwogICAgICAgICAgICBkZWZfbm9kZS50aXRsZSA9ICJoaWdoIGRlZmluaXRpb24iOwogICAgICAgICAgICB2YXIgbm9kZV9oZCA9IG5ld05vZGUoInNwYW4iLCBudWxsLCAiZ3JpZHR1YmVfbWV0YV9kZWZfaGQiLCBkZWZfbm9kZSk7CiAgICAgICAgICAgIG5vZGVfaGQudGV4dENvbnRlbnQgPSAiSEQiOwogICAgICAgIH0KICAgIH0KCiAgICAvL21lc3NhZ2UoInRoZXJlIik7CgogICAgaWYgKGJ1aWxkUmF0ZSkgewogICAgICAgIHZhciBudW1fbGlrZXMgPSAoZW50cnkubGlrZXMgIT0gbnVsbCA/IHBhcnNlSW50KGVudHJ5Lmxpa2VzKSA6IDApOwogICAgICAgIHZhciBudW1fZGlzbGlrZXMgPSAoZW50cnkuZGlzbGlrZXMgIT0gbnVsbCA/IHBhcnNlSW50KGVudHJ5LmRpc2xpa2VzKSA6IDApOwoKICAgICAgICBpZiAoKG51bV9saWtlcyAhPSAwKSB8fCAobnVtX2Rpc2xpa2VzICE9IDApKSB7CiAgICAgICAgICAgIHZhciBwZXJjID0gMTAwIC0gTWF0aC5yb3VuZChudW1fZGlzbGlrZXMgKiAxMDAuMCAvIChudW1fbGlrZXMgKyBudW1fZGlzbGlrZXMpKTsKCiAgICAgICAgICAgIHZhciByYXRlQnJpZWYgPSBuZXdOb2RlKCJkaXYiLCBudWxsLCAiZ3JpZHR1YmVfbWV0YV9yYXRlIiwgcGFyZW50KTsKICAgICAgICAgICAgcmF0ZUJyaWVmLnRpdGxlID0gcGVyYyArICIlIGxpa2VzOiArIiArIG51bWJlcl9jb21tYShudW1fbGlrZXMudG9TdHJpbmcoKSkgKyAiICAtIiArIG51bWJlcl9jb21tYShudW1fZGlzbGlrZXMudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIHJhdGVCcmllZi5vbm1vdXNlb3ZlciA9IHByZWZfYnV0dG9uX3Nob3c7CiAgICAgICAgICAgIHJhdGVCcmllZi5vbm1vdXNlb3V0ID0gcHJlZl9idXR0b25faGlkZTsKCiAgICAgICAgICAgIGlmIChlbnRyeS52aWV3cyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB2YXIgdmlld19udW0gPSBudW1iZXJfY29tbWEoZW50cnkudmlld3MpOwogICAgICAgICAgICAgICAgcmF0ZUJyaWVmLnRpdGxlICs9ICJcbiIgKyB2aWV3X251bSArICIgdmlld3MiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocGVyYyA+PSByZWRfdGhyZXNob2xkKSB7CiAgICAgICAgICAgICAgICByYXRlQnJpZWYudGV4dENvbnRlbnQgPSAiXHVEODNEXHVEQzREICIgKyBwZXJjOwogICAgICAgICAgICAgICAgaWYgKHBlcmMgPCBvcmFuZ2VfdGhyZXNob2xkKSB7CiAgICAgICAgICAgICAgICAgICAgcmF0ZUJyaWVmLnNldEF0dHJpYnV0ZSgibWVkIiwgInRydWUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJhdGVCcmllZi50ZXh0Q29udGVudCA9ICJcdUQ4M0RcdURDNEUgIiArIHBlcmM7CiAgICAgICAgICAgICAgICByYXRlQnJpZWYuc2V0QXR0cmlidXRlKCJiYWQiLCAidHJ1ZSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gY2FsbGJhY2sxKHR4dCwgZGVmX25vZGUsIHVybDIsIHBhcmVudCkgewogICAgLy9tZXNzYWdlKHR4dCk7CiAgICB2YXIgcmVzID0gZXh0cmFjdF9yZXNvbHV0aW9uKHR4dCk7CgogICAgaWYgKHJlcykgewogICAgICAgIGRlZl9ub2RlLnNldEF0dHJpYnV0ZSgicmV2ZWFsIiwgInRydWUiKTsKICAgICAgICBkZWZfbm9kZS50aXRsZSA9IHJlcy5zaXplICsgIiBkZWZpbml0aW9uIjsKICAgICAgICBpZiAocmVzLkhEKSB7CiAgICAgICAgICAgIHZhciBub2RlX2hkID0gbmV3Tm9kZSgic3BhbiIsIG51bGwsICJncmlkdHViZV9tZXRhX2RlZl9oZCIsIGRlZl9ub2RlKTsKICAgICAgICAgICAgbm9kZV9oZC50ZXh0Q29udGVudCA9IHJlcy5VSEQgPyByZXMuVUhEIDogIkhEIjsKICAgICAgICAgICAgZGVmX25vZGUuc2V0QXR0cmlidXRlKCJzcGFjZSIsICJ0cnVlIik7CiAgICAgICAgfQogICAgICAgIHZhciBub2RlX2F0dHIgPSBuZXdOb2RlKCJzcGFuIiwgbnVsbCwgImdyaWR0dWJlX21ldGFfZGVmX2Zvcm1hdCIsIGRlZl9ub2RlKTsKICAgICAgICBub2RlX2F0dHIudGV4dENvbnRlbnQgPSByZXMuZm9ybWF0OwoKICAgICAgICBpZiAocHJlZl9yYXRlRW5hYmxlKSB7CiAgICAgICAgICAgIC8vbWVzc2FnZSgiY2FsbGJhY2siKTsKICAgICAgICAgICAgaHR0cFJlcSh1cmwyLCBjYWxsYmFjazIsIG51bGwsIGZhbHNlLCB0cnVlLCBwYXJlbnQpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgIC8vbWVzc2FnZSgiY2FsbGJhY2siKTsKICAgICAgICBodHRwUmVxKHVybDIsIGNhbGxiYWNrMiwgZGVmX25vZGUsIHRydWUsIHByZWZfcmF0ZUVuYWJsZSwgcGFyZW50KTsKICAgIH0KfQoKCmZ1bmN0aW9uIGRlZl9yYXRlKHZfaWQsIHBhcmVudCkgewogICAgdmFyIHVybDEgPSAiaHR0cHM6Ly93d3cueW91dHViZS5jb20vZ2V0X3ZpZGVvX2luZm8/dmlkZW9faWQ9IiArIHZfaWQ7CiAgICB2YXIgdXJsMiA9ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS95b3V0dWJlL3YzL3ZpZGVvcz9pZD0iICsgdl9pZCArICIma2V5PSIgKyBhcGlfa2V5ICsgIiZwYXJ0PWNvbnRlbnREZXRhaWxzLHN0YXRpc3RpY3MiOwoKICAgIC8vaHR0cHJlcQogICAgaWYgKHByZWZfZGVmRW5hYmxlKSB7CiAgICAgICAgdmFyIGRlZl9ub2RlID0gbmV3Tm9kZSgic3BhbiIsIG51bGwsICJncmlkdHViZV9tZXRhX2RlZl9jb250YWluZXIiLCBwYXJlbnQpOwogICAgICAgIGh0dHBSZXEodXJsMSwgY2FsbGJhY2sxLCBkZWZfbm9kZSwgdXJsMiwgcGFyZW50KTsKICAgICAgICBkZWZfbm9kZS5vbm1vdXNlb3ZlciA9IHByZWZfYnV0dG9uX3Nob3c7CiAgICAgICAgZGVmX25vZGUub25tb3VzZW91dCA9IHByZWZfYnV0dG9uX2hpZGU7CiAgICB9CiAgICBlbHNlCiAgICAgICAgaWYgKHByZWZfcmF0ZUVuYWJsZSkKICAgICAgICAgICAgaHR0cFJlcSh1cmwyLCBjYWxsYmFjazIsIG51bGwsIGZhbHNlLCB0cnVlLCBwYXJlbnQpOwp9CgoKZnVuY3Rpb24gcGxheSh2aWQsIHBpZCwgcGFyZW50KSB7CiAgICB2YXIgcGxheUFyZWEgPSBuZXdOb2RlKCJkaXYiLCBudWxsLCAiZ3JpZHR1YmVfbWV0YV9wbGF5X2NvbnRhaW5lciIsIHBhcmVudCk7CiAgICB2YXIgcGxheU5vZGUgPSBuZXdOb2RlKCJhIiwgbnVsbCwgImdyaWR0dWJlX21ldGFfcGxheSIsIHBsYXlBcmVhKTsKICAgIHBsYXlOb2RlLmhyZWYgPSAiamF2YXNjcmlwdDo7IjsKICAgIHBsYXlOb2RlLnRhcmdldCA9ICJfc2VsZiI7CiAgICBwbGF5Tm9kZS5zZXRBdHRyaWJ1dGUoJ2dyaWR0dWJlX21ldGFfbGlua19tYXJrJywgJ3RydWUnKTsKICAgIHBsYXlOb2RlLnRpdGxlID0gImNsaWNrIHRvIHBsYXkiOwoKICAgIGZ1bmN0aW9uIHBsYXlfaGFuZGxlKGUpIHsKICAgICAgICBkaXNhYmxlX2FqYXgoZSk7CgogICAgICAgIHZhciBwYXJwYXIgPSBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGU7CgogICAgICAgIGlmIChpbm5lcnNlYXJjaChwYXJwYXIsICIuLy8qW0BpZD0nZ3JpZHR1YmVfbWV0YV9wbGF5aW5nJ10iKS5zbmFwc2hvdExlbmd0aCA+IDApCiAgICAgICAgICAgIHBsYXllcl9jbG9zZSgpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBwbGF5ZXIucGxheWVyU2hvdyh2aWQsIHBpZCwgcGFycGFyKTsKICAgICAgICAgICAgaWYgKGdldF9wcmVmKCJwbGF5ZXJQYXVzZSIpKSB5dHBhdXNlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHBsYXlOb2RlLm9uY2xpY2sgPSBwbGF5X2hhbmRsZTsKICAgIHBsYXlOb2RlLm9ubW91c2VvdmVyID0gcHJlZl9idXR0b25fc2hvdzsKICAgIHBsYXlOb2RlLm9ubW91c2VvdXQgPSBwcmVmX2J1dHRvbl9oaWRlOwp9CgoKZnVuY3Rpb24gZmluZF9wbGlzdChpbWcpIHsKICAgIHZhciBhbmMgPSBpbm5lcnNlYXJjaChpbWcsICIuLy9hbmNlc3Rvcjo6Kltjb250YWlucyhAaHJlZiwnJmxpc3Q9JykgYW5kIGNvbnRhaW5zKEBjbGFzcywneXQtcGwtdGh1bWInKV0iKS5zbmFwc2hvdEl0ZW0oMCk7CiAgICB2YXIgcGxpc3QgPSBudWxsOwogICAgaWYgKGFuYykKICAgICAgICBwbGlzdCA9IGZpbHRlcihhbmMuaHJlZiwgImxpc3Q9IiwgIi8mPyMiKTsKICAgIC8vbWVzc2FnZShwbGlzdCk7CiAgICByZXR1cm4gcGxpc3Q7Cn0KCgpmdW5jdGlvbiBtZXRhX2RhdGEoKSB7CgogICAgdmFyIHZpZF9zdHIgPSAiLy8qWyIgKyBiYXNpY19zdHIgKyAiIGFuZCAobm90KC4vL2ltZ1tAZGF0YS10aHVtYl0pKSBhbmQgKG5vdChAZ3JpZHR1YmVfbWV0YV90aHVtYl9tYXJrKSldIjsKCiAgICB2YXIgbGlua19zdHIgPSAiLy9kaXZbKEBpZD0nY29udGVudCcpIG9yIChjb250YWlucyhAY2xhc3MsJ3BsYXlsaXN0LWluZm8nKSldXAogICAgICAgICAgICAgICAgICAgICAgICAvL2FbKG5vdChAZ3JpZHR1YmVfbWV0YV9saW5rX21hcmspKVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCAobm90KGNvbnRhaW5zKEBocmVmLCdqYXZhc2NyaXB0JykpKVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCAobm90KGFuY2VzdG9yOjoqW2NvbnRhaW5zKEBjbGFzcywnYnJhbmRlZC1wYWdlLXYyLXRvcC1yb3cnKVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGNvbnRhaW5zKEBjbGFzcywgJ3RhYnMtYXJlYScpXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgY29udGFpbnMoQGNsYXNzLCAnc2VhcmNoLWhlYWRlcicpXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgY29udGFpbnMoQGNsYXNzLCAnc2VhcmNoLXBhZ2VyJylcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBjb250YWlucyhAY2xhc3MsICdzcGVsbC1jb3JyZWN0aW9uJylcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBjb250YWlucyhAY2xhc3MsICdtZW51LWNvbnRhaW5lcicpXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgY29udGFpbnMoQGlkLCAnY3JlYXRvci1wYWdlLXNpZGViYXInKVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGNvbnRhaW5zKEBpZCwgJ2NoYW5uZWwtbmF2aWdhdGlvbi1tZW51JylcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBjb250YWlucyhAaWQsICd3YXRjaC1kaXNjdXNzaW9uJylcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pKVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0iOwoKICAgIHZhciB1c2VyX3N0ciA9ICIvLypbY29udGFpbnMoQGNsYXNzLCd5dC1sb2NrdXAtYnlsaW5lJylcCiAgICAgICAgICAgICAgICAgICAgICAgIG9yIGNvbnRhaW5zKEBjbGFzcywgJ3BsLXZpZGVvLW93bmVyJylcCiAgICAgICAgICAgICAgICAgICAgICAgIG9yIGNvbnRhaW5zKEBjbGFzcywncGwtaGVhZGVyLWRldGFpbHMnKVwKICAgICAgICAgICAgICAgICAgICAgICAgb3IgY29udGFpbnMoQGNsYXNzLCAneXQtdXNlci1pbmZvJylcCiAgICAgICAgICAgICAgICAgICAgICAgIG9yIGNvbnRhaW5zKEBjbGFzcywgJ2F1dGhvci1hdHRyaWJ1dGlvbicpXAogICAgICAgICAgICAgICAgICAgICAgICBvciBjb250YWlucyhAY2xhc3MsICdjb250ZW50LXVwbG9hZGVyJyldXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vYVsoY29udGFpbnMoQGhyZWYsJy91c2VyLycpIG9yIGNvbnRhaW5zKEBocmVmLCcvY2hhbm5lbC8nKSkgYW5kIChub3QoQGdyaWR0dWJlX21ldGFfdXNlcl9tYXJrKSldIjsKCiAgICB2YXIgdXNlcl9zdHIyID0gIi8vbGlbY29udGFpbnMoQGNsYXNzLCdyZWxhdGVkLWxpc3QtaXRlbScpXVwKICAgICAgICAgICAgICAgICAgICAgLy9zcGFuW2NvbnRhaW5zKEBjbGFzcywnZy1ob3ZlcmNhcmQnKSBhbmQgKEBkYXRhLXl0aWQpIGFuZCAoQGRhdGEtbmFtZSkgYW5kIChub3QoQGdyaWR0dWJlX21ldGFfdXNlcl9tYXJrMikpXSI7CgogICAgZnVuY3Rpb24gY2hlY2tfZGVmX3JhdGVfcGxheSgpIHsKICAgICAgICBpZiAocHJlZl9kZWZFbmFibGUgfHwgcHJlZl9yYXRlRW5hYmxlIHx8IHByZWZfcGxheWVyRW5hYmxlKSB7CgogICAgICAgICAgICBpZiAocHJlZl9kZWZFbmFibGUgfHwgcHJlZl9yYXRlRW5hYmxlKSB7CiAgICAgICAgICAgICAgICBpZiAod2luLmxvY2F0aW9uLmhyZWYuaW5kZXhPZigid2F0Y2g/IikgPj0gMCkgewogICAgICAgICAgICAgICAgICAgIHZhciB3dmlkID0gZmlsdGVyKHdpbi5sb2NhdGlvbi5ocmVmLCAidj0iLCAiPyYjIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHd2aWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhciA9IGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfbWV0YV9ib3giKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoImdyaWR0dWJlX3RpdGxlX2NvbnRhaW5lciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHAgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoIndhdGNoNy11c2VyLWhlYWRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcCkgdGFyZ2V0ID0gbmV3Tm9kZSgic3BhbiIsICJncmlkdHViZV90aXRsZV9jb250YWluZXIiLCBudWxsLCBwcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyID0gbmV3Tm9kZSgic3BhbiIsICdncmlkdHViZV9tZXRhX2JveCcsIG51bGwsIHRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmX3JhdGUod3ZpZCwgcGFyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9jaGVjayBldmVyeXRoaW5nIGVsc2UKICAgICAgICAgICAgdmFyIHAgPSBkb2NzZWFyY2godmlkX3N0cik7CiAgICAgICAgICAgIC8vbWVzc2FnZShwLnNuYXBzaG90TGVuZ3RoKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwLnNuYXBzaG90TGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBwLnNuYXBzaG90SXRlbShpKTsKICAgICAgICAgICAgICAgIHBhcmVudC5zZXRBdHRyaWJ1dGUoJ2dyaWR0dWJlX21ldGFfdGh1bWJfbWFyaycsICd0cnVlJyk7CiAgICAgICAgICAgICAgICB2YXIgaW1nID0gaW5uZXJzZWFyY2gocGFyZW50LCAiLi8vaW1nW2NvbnRhaW5zKEBzcmMsJ3ZpLycpIG9yIGNvbnRhaW5zKEBzcmMsJ3ZpX3dlYnAvJykgb3IgY29udGFpbnMoQHNyYywnL3AvJyldIikuc25hcHNob3RJdGVtKDApOwogICAgICAgICAgICAgICAgaWYgKCFpbWcpIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIHZhciB2aWQgPSBmaWx0ZXIoaW1nLnNyYywgInZpLyIsICIvJj8jIik7CiAgICAgICAgICAgICAgICBpZiAoIXZpZCkgdmlkID0gZmlsdGVyKGltZy5zcmMsICJ2aV93ZWJwLyIsICIvJj8jIik7CgogICAgICAgICAgICAgICAgaWYgKHZpZCkgey8vdmlkZW8gb3IgcGxheWxpc3QKICAgICAgICAgICAgICAgICAgICBpZiAocHJlZl9kZWZFbmFibGUgfHwgcHJlZl9yYXRlRW5hYmxlKQogICAgICAgICAgICAgICAgICAgICAgICBkZWZfcmF0ZSh2aWQsIHBhcmVudCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHByZWZfcGxheWVyRW5hYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBmb3IgcGxheWxpc3QKICAgICAgICAgICAgICAgICAgICB2YXIgcGxpc3QgPSBmaW5kX3BsaXN0KGltZyk7CiAgICAgICAgICAgICAgICAgICAgLy9tZXNzYWdlKHBsaXN0KTsKICAgICAgICAgICAgICAgICAgICBwbGF5KHZpZCwgcGxpc3QsIHBhcmVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIGNoZWNrX3RhYigpIHsKICAgICAgICAvL25ldyB0YWIgZm9yIGxpbmtzCiAgICAgICAgaWYgKHByZWZfbmV3VGFiKSB7CiAgICAgICAgICAgIHZhciBhbm9kZXMgPSBkb2NzZWFyY2gobGlua19zdHIpOwogICAgICAgICAgICAvL21lc3NhZ2UoYW5vZGVzLnNuYXBzaG90TGVuZ3RoKTsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBhbm9kZXMuc25hcHNob3RMZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgdmFyIGEgPSBhbm9kZXMuc25hcHNob3RJdGVtKGopOwogICAgICAgICAgICAgICAgYS50YXJnZXQgPSAiX2JsYW5rIjsKICAgICAgICAgICAgICAgIGEuc2V0QXR0cmlidXRlKCdncmlkdHViZV9tZXRhX2xpbmtfbWFyaycsICd0cnVlJyk7CiAgICAgICAgICAgICAgICBhLm9uY2xpY2sgPSBkaXNhYmxlX2FqYXg7CiAgICAgICAgICAgICAgICAvL21lc3NhZ2UoYS5ocmVmKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gY2hlY2tfdXNlcigpIHsKICAgICAgICAvL29wZW4gdXNlciBsaW5rcyBpbiB2aWRlbyBzZWN0aW9uCiAgICAgICAgaWYgKHByZWZfdXNlckxpbmspIHsKICAgICAgICAgICAgdmFyIGFub2RlcyA9IGRvY3NlYXJjaCh1c2VyX3N0cik7CiAgICAgICAgICAgIC8vbWVzc2FnZShhbm9kZXMuc25hcHNob3RMZW5ndGgpOwogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFub2Rlcy5zbmFwc2hvdExlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IGFub2Rlcy5zbmFwc2hvdEl0ZW0oaik7CiAgICAgICAgICAgICAgICBhLnNldEF0dHJpYnV0ZSgnZ3JpZHR1YmVfbWV0YV91c2VyX21hcmsnLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgLy9tZXNzYWdlKGEuaHJlZik7CgogICAgICAgICAgICAgICAgdmFyIGFyciA9IGEuaHJlZi5zcGxpdCgvdXNlclsvXXxjaGFubmVsWy9dLyk7CiAgICAgICAgICAgICAgICAvL21lc3NhZ2UoYXJyKTsKICAgICAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoICE9IDIpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKGFyclsxXS5pbmRleE9mKCcvJykgIT0gLTEpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgYS5ocmVmICs9ICIvdmlkZW9zIjsKICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIC8vcmVsYXRlZCB1c2VyIGxpbmtzCiAgICAgICAgdmFyIHVub2RlcyA9IGRvY3NlYXJjaCh1c2VyX3N0cjIpOwogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdW5vZGVzLnNuYXBzaG90TGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgdmFyIG5vZGUgPSB1bm9kZXMuc25hcHNob3RJdGVtKGopOwogICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgnZ3JpZHR1YmVfbWV0YV91c2VyX21hcmsyJywgJ3RydWUnKTsKICAgICAgICAgICAgLy9tZXNzYWdlKGEuaHJlZik7CgogICAgICAgICAgICB2YXIgYSA9IGRvYy5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgIHZhciBhdHRyID0gbm9kZS5hdHRyaWJ1dGVzOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGF0dHIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGEuc2V0QXR0cmlidXRlKGF0dHJbaV0ubm9kZU5hbWUsIGF0dHJbaV0ubm9kZVZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhLnNldEF0dHJpYnV0ZSgiZ3JpZHR1YmVfbWV0YV91c2VyX21hcmsyIiwgInRydWUiKTsKICAgICAgICAgICAgYS5ocmVmID0gd2luLmxvY2F0aW9uLnByb3RvY29sICsgIi8vd3d3LnlvdXR1YmUuY29tL2NoYW5uZWwvIiArIG5vZGUuZ2V0QXR0cmlidXRlKCJkYXRhLXl0aWQiKSArIChwcmVmX3VzZXJMaW5rID8gIi92aWRlb3MiIDogIiIpOwogICAgICAgICAgICBhLnRleHRDb250ZW50ID0gbm9kZS50ZXh0Q29udGVudDsKICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChhLCBub2RlKTsKICAgICAgICB9CiAgICB9CgoKICAgIGNoZWNrX2RlZl9yYXRlX3BsYXkoKTsKICAgIGNoZWNrX3RhYigpOwogICAgY2hlY2tfdXNlcigpOwp9CgoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gU2VhcmNoIHBhZ2VzCgp2YXIgYXV4ID0gbmV3IE9iamVjdCgpOwoKZnVuY3Rpb24gYm90dG9tX2JhcihraW5kKSB7CiAgICB2YXIgaXJlbmQgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoImdyaWR0dWJlX3Jlc3VsdF9lbmQiKTsKICAgIHZhciB0eHRfbm9kZSA9IG51bGw7CiAgICB2YXIgaW1nX25vZGUgPSBudWxsOwogICAgaWYgKGlyZW5kID09IG51bGwpIHsKICAgICAgICB2YXIgcmVzdWx0c19lbmRfYmFyID0gZG9jLmdldEVsZW1lbnRCeUlkKCJncmlkdHViZV9yZXN1bHRzX2VuZF9iYXIiKTsKICAgICAgICBpcmVuZCA9IG5ld05vZGUoImRpdiIsICJncmlkdHViZV9yZXN1bHRfZW5kIiwgImdyaWR0dWJlX3Jlc3VsdF9iYXJfaW5uZXIiLCByZXN1bHRzX2VuZF9iYXIpOwogICAgICAgIGltZ19ub2RlID0gbmV3Tm9kZSgiaW1nIiwgImdyaWR0dWJlX3Jlc3VsdF9lbmRfaW1nIiwgbnVsbCwgaXJlbmQpOwogICAgICAgIGltZ19ub2RlLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICBpbWdfbm9kZS5zcmMgPSAiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9pbWFnZXMvbnljbGkxLmdpZiI7CiAgICAgICAgdHh0X25vZGUgPSBuZXdOb2RlKCJzcGFuIiwgImdyaWR0dWJlX3Jlc3VsdF9lbmRfdGV4dCIsIG51bGwsIGlyZW5kKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHR4dF9ub2RlID0gZG9jLmdldEVsZW1lbnRCeUlkKCJncmlkdHViZV9yZXN1bHRfZW5kX3RleHQiKTsKICAgICAgICBpbWdfbm9kZSA9IGRvYy5nZXRFbGVtZW50QnlJZCgiZ3JpZHR1YmVfcmVzdWx0X2VuZF9pbWciKTsKICAgIH0KCiAgICBzd2l0Y2ggKGtpbmQpIHsKICAgICAgICBjYXNlICJsb2FkaW5nIjoKICAgICAgICAgICAgaXJlbmQub25jbGljayA9IGZ1bmN0aW9uIChlKSB7IH07CiAgICAgICAgICAgIHR4dF9ub2RlLnRleHRDb250ZW50ID0gIkxvYWRpbmcgUGFnZSAiICsgYXV4Lm5leHRfYnV0dG9uLnRleHRDb250ZW50OwogICAgICAgICAgICBpbWdfbm9kZS5zdHlsZS52aXNpYmlsaXR5ID0gInZpc2libGUiOwogICAgICAgICAgICBpbWdfbm9kZS5zdHlsZS53aWR0aCA9ICJhdXRvIjsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIGlyZW5kLm9uY2xpY2sgPSBmdW5jdGlvbiAoZSkgeyB3aW4uc2Nyb2xsKDAsIDApOyB9OwogICAgICAgICAgICBpcmVuZC5zZXRBdHRyaWJ1dGUoInRpdGxlIiwgImdvIHRvIHRvcCBvZiBwYWdlIik7CiAgICAgICAgICAgIHR4dF9ub2RlLnRleHRDb250ZW50ID0gIkVuZCBvZiBSZXN1bHRzIiArIChhdXgubGFzdF9wYWdlID8gIiAtIFBhZ2UgIiArIGF1eC5sYXN0X3BhZ2UgOiAiIik7CiAgICAgICAgICAgIGltZ19ub2RlLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICAgICAgaW1nX25vZGUuc3R5bGUud2lkdGggPSAiMHB4IjsKICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0KCgpmdW5jdGlvbiBzZWFyY2hfcGFnZXMoY29uZCkgewogICAgLy9tZXNzYWdlKGNvbmQpOwoKICAgIHZhciBuZXh0X3N0ciA9ICIvLypbY29udGFpbnMoQGNsYXNzLCdzZWFyY2gtcGFnZXInKV0vYVtjb250YWlucyhAY2xhc3MsJ3l0LXVpeC1idXR0b24nKSBhbmQgKEBocmVmKSBhbmQgKHByZWNlZGluZy1zaWJsaW5nOjpidXR0b24pXSI7CgogICAgdmFyIHBhcmVudCA9IGRvY3NlYXJjaCgiLy8qW0BpZD0ncmVzdWx0cyddL29sL2xpL29sIikuc25hcHNob3RJdGVtKDApOwogICAgaWYgKCFwYXJlbnQpIHJldHVybjsKCiAgICBmdW5jdGlvbiBmaW5kX25leHRfc2VhcmNoKCkgewogICAgICAgIGlmIChhdXgubmV4dF9idXR0b24pIHsKICAgICAgICAgICAgYXV4Lm5leHRfaHJlZiA9IGF1eC5uZXh0X2J1dHRvbi5nZXRBdHRyaWJ1dGUoImhyZWYiKTsKICAgICAgICAgICAgaWYgKGF1eC5uZXh0X2hyZWYuaW5kZXhPZih3aW4ubG9jYXRpb24ub3JpZ2luKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBhdXgubmV4dF9ocmVmID0gd2luLmxvY2F0aW9uLm9yaWdpbiArIGF1eC5uZXh0X2hyZWY7CiAgICAgICAgICAgICAgICAvL21lc3NhZ2UoImZpeGVkIHVybCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vbWVzc2FnZShhdXgubmV4dF9ocmVmKTsKICAgICAgICAgICAgLy9tZXNzYWdlKGF1eC5uZXh0X2J1dHRvbi50ZXh0Q29udGVudCk7CiAgICAgICAgICAgIGF1eC5sYXN0X3BhZ2UgPSBhdXgubmV4dF9idXR0b24udGV4dENvbnRlbnQ7CiAgICAgICAgICAgIGJvdHRvbV9iYXIoImxvYWRpbmciKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgICAgICBib3R0b21fYmFyKCJlbmQiKTsKICAgIH0KCiAgICAvL0luaXRpYWxpemUKICAgIGlmICghcGFyZW50LmdldEF0dHJpYnV0ZSgiZ3JpZHR1YmVfYXV0b19wYWdlX3N0YXJ0ZWQiKSkgewoKICAgICAgICBwYXJlbnQuc2V0QXR0cmlidXRlKCJncmlkdHViZV9hdXRvX3BhZ2Vfc3RhcnRlZCIsICJ0cnVlIik7CgogICAgICAgIC8vZGlzYWJsZSBhamF4IGZyb20gcmVzdWx0cwogICAgICAgIC8vdmFyIGxpaXRlbXMgPSBkb2NzZWFyY2goIi8vKltAaWQ9J3Jlc3VsdHMnXS9vbC9saS9vbC9saSIpOwogICAgICAgIC8vZm9yICh2YXIgaSA9IDA7IGkgPCBsaWl0ZW1zLnNuYXBzaG90TGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyAgICBsaWl0ZW1zLnNuYXBzaG90SXRlbShpKS5vbmNsaWNrID0gZGlzYWJsZV9hamF4OwogICAgICAgIC8vfQoKICAgICAgICBhdXguYm90dG9tX2FyZWEgPSBuZXdOb2RlKCJkaXYiLCAiZ3JpZHR1YmVfYm90dG9tX2FyZWEiLCBudWxsLCBwYXJlbnQpOwogICAgICAgIG5ld05vZGUoImRpdiIsICJncmlkdHViZV9yZXN1bHRzX2VuZF9iYXIiLCAiZ3JpZHR1YmVfcmVzdWx0X2JhciIsIGF1eC5ib3R0b21fYXJlYSk7CgogICAgICAgIGF1eC5sYXN0X3BhZ2UgPSBudWxsOwogICAgICAgIGF1eC5uZXh0X2J1dHRvbiA9IGRvY3NlYXJjaChuZXh0X3N0cikuc25hcHNob3RJdGVtKDApOwogICAgICAgIGZpbmRfbmV4dF9zZWFyY2goKTsKICAgICAgICBhdXguZmV0Y2hfcGVuZGluZyA9IGZhbHNlOwogICAgfQoKCiAgICBmdW5jdGlvbiBleGVjX3BhZ2UoaHRtKSB7CiAgICAgICAgLy9tZXNzYWdlKGh0bSk7CiAgICAgICAgdmFyIG5ld2RvYyA9IG15cGFyc2VyLnBhcnNlRnJvbVN0cmluZyhodG0sICJ0ZXh0L2h0bWwiKTsKCiAgICAgICAgdmFyIGxpID0geHBhdGgobmV3ZG9jLCBuZXdkb2MsICIvLypbQGlkPSdyZXN1bHRzJ10vb2wvbGkvb2wvbGlbbm90KC4vLypbY29udGFpbnMoQGNsYXNzLCdzcGVsbC1jb3JyZWN0aW9uJykgb3IgY29udGFpbnMoQGNsYXNzLCdkaXNwbGF5LW1lc3NhZ2UnKV0pXSIpOwoKICAgICAgICAvL21lc3NhZ2UobGkuc25hcHNob3RMZW5ndGgpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpLnNuYXBzaG90TGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGNsb25lID0gbGkuc25hcHNob3RJdGVtKGkpLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICAgICAgY2xvbmUuc2V0QXR0cmlidXRlKCJncmlkdHViZV9jbG9uZV9ub2RlIiwgInRydWUiKTsKICAgICAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShjbG9uZSwgYXV4LmJvdHRvbV9hcmVhKTsKICAgICAgICAgICAgLy9kaXNhYmxlIGFqYXgKICAgICAgICAgICAgLy9jbG9uZS5vbmNsaWNrID0gZGlzYWJsZV9hamF4OwogICAgICAgIH0KCiAgICAgICAgYXV4Lm5leHRfYnV0dG9uID0geHBhdGgobmV3ZG9jLCBuZXdkb2MsIG5leHRfc3RyKS5zbmFwc2hvdEl0ZW0oMCk7CiAgICAgICAgZmluZF9uZXh0X3NlYXJjaCgpOwogICAgICAgIGF1eC5mZXRjaF9wZW5kaW5nID0gZmFsc2U7CiAgICAgICAgLy9tZXNzYWdlKCJkb25lIik7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGZldGNoKCkgewogICAgICAgIGlmIChhdXguZmV0Y2hfcGVuZGluZykgcmV0dXJuOwoKICAgICAgICBpZiAoYXV4Lm5leHRfYnV0dG9uKSB7CiAgICAgICAgICAgIGh0dHBSZXEoYXV4Lm5leHRfaHJlZiwgZXhlY19wYWdlKTsKICAgICAgICAgICAgYXV4LmZldGNoX3BlbmRpbmcgPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoY29uZCkgZmV0Y2goKTsKfQoKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFBsaXN0CgpmdW5jdGlvbiBwbGlzdF9hZGp1c3QoKSB7CiAgICBpZiAoIXByZWZfZ3JpZFBsaXN0KSByZXR1cm47CgogICAgLy9hZGp1c3QgdGh1bWIgcXVhbGl0eQogICAgdmFyIGFpdGVtcyA9IGRvY3NlYXJjaCgiLy8qW2NvbnRhaW5zKEBjbGFzcywncGwtdmlkZW8nKV0vL2ltZ1tjb250YWlucyhAc3JjLCdocWRlZmF1bHQuanBnP2N1c3RvbScpIG9yIGNvbnRhaW5zKEBkYXRhLXRodW1iLCAnaHFkZWZhdWx0LmpwZz9jdXN0b20nKV0iKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFpdGVtcy5zbmFwc2hvdExlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGl0ZW0gPSBhaXRlbXMuc25hcHNob3RJdGVtKGkpOwogICAgICAgIHZhciBzcmMgPSBpdGVtLmdldEF0dHJpYnV0ZSgic3JjIik7CiAgICAgICAgdmFyIGRhdGEgPSBpdGVtLmdldEF0dHJpYnV0ZSgiZGF0YS10aHVtYiIpOwoKICAgICAgICBpZiAoc3JjKSB7CiAgICAgICAgICAgIHZhciBuZXdfc3JjID0gc3JjLnJlcGxhY2UoL2hxZGVmYXVsdC5qcGdbP11jdXN0b20oLiopLywgJ21xZGVmYXVsdC5qcGcnKTsKICAgICAgICAgICAgaWYgKHNyYyAhPSBuZXdfc3JjKQogICAgICAgICAgICAgICAgaXRlbS5zZXRBdHRyaWJ1dGUoInNyYyIsIG5ld19zcmMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgdmFyIG5ld19kYXRhID0gZGF0YS5yZXBsYWNlKC9ocWRlZmF1bHQuanBnWz9dY3VzdG9tKC4qKS8sICdtcWRlZmF1bHQuanBnJyk7CiAgICAgICAgICAgIGlmIChkYXRhICE9IG5ld19kYXRhKQogICAgICAgICAgICAgICAgaXRlbS5zZXRBdHRyaWJ1dGUoImRhdGEtdGh1bWIiLCBuZXdfZGF0YSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vcmVtb3ZlIGRlbGV0ZWQgdmlkcwogICAgdmFyIGRpdGVtcyA9IGRvY3NlYXJjaCgiLy8qWyhAaWQ9J3BsLXZpZGVvLWxpc3QnKSBhbmQgKG5vdChjb250YWlucyhAY2xhc3MsJ3BsLXZpZGVvLWxpc3QtZWRpdGFibGUnKSkpXVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdHJbY29udGFpbnMoQGNsYXNzLCdwbC12aWRlbycpIGFuZCAobm90KEBncmlkdHViZV9tYXJrZWRfZGVsZXRlZCkpXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kICgoQGRhdGEtdGl0bGU9J1tEZWxldGVkIFZpZGVvXScpIG9yIChAZGF0YS10aXRsZT0nW1ByaXZhdGUgVmlkZW9dJykpXSIpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGl0ZW1zLnNuYXBzaG90TGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgaXRlbSA9IGRpdGVtcy5zbmFwc2hvdEl0ZW0oaSk7CiAgICAgICAgaXRlbS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIGl0ZW0uc2V0QXR0cmlidXRlKCJncmlkdHViZV9tYXJrZWRfZGVsZXRlZCIsIHRydWUpOwogICAgfQp9CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBSZWxhdGVkCgpmdW5jdGlvbiByZWxhdGVkX2FkanVzdCh3aW5fcmVzaXplZCkgewogICAgaWYgKCFwcmVmX2dyaWRSZWwpIHJldHVybjsKCiAgICB2YXIgbm9kZSA9IGRvYy5nZXRFbGVtZW50QnlJZCgid2F0Y2g3LXNpZGViYXItY29udGVudHMiKTsKICAgIGlmICghbm9kZSkgcmV0dXJuOwoKICAgIHZhciBzdHJudW0gPSBub2RlLmdldEF0dHJpYnV0ZSgiZ3JpZHR1YmVfc3RvcmVkX251bSIpOwogICAgdmFyIHN0b3JlZF9udW0gPSBzdHJudW0gPyBwYXJzZUludChzdHJudW0pIDogMDsKCiAgICB2YXIgbGl0ZW1zID0gZG9jc2VhcmNoKCIvL3VsW0BpZD0nd2F0Y2gtcmVsYXRlZCddLy9saVtjb250YWlucyhAY2xhc3MsJ3JlbGF0ZWQtbGlzdC1pdGVtJyldIik7CgogICAgdmFyIG51bSA9IGxpdGVtcy5zbmFwc2hvdExlbmd0aDsKCiAgICAvL21lc3NhZ2UobnVtKTsKICAgIGlmIChudW0gPT0gMCkgcmV0dXJuOwoKICAgIGlmIChudW0gPT0gc3RvcmVkX251bSAmJiAhd2luX3Jlc2l6ZWQpIHJldHVybjsKCiAgICBub2RlLnNldEF0dHJpYnV0ZSgiZ3JpZHR1YmVfc3RvcmVkX251bSIsIG51bS50b1N0cmluZygpKTsKCiAgICAvL3ZhciBmaXJzdCA9IGxpdGVtcy5zbmFwc2hvdEl0ZW0oMCk7CiAgICB2YXIgbGFzdCA9IGxpdGVtcy5zbmFwc2hvdEl0ZW0obnVtIC0gMSk7CgogICAgdmFyIHkxID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7CiAgICB2YXIgeTIgPSBsYXN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbTsKCiAgICB2YXIgZCA9IE1hdGgucm91bmQoTWF0aC5hYnMoeTEgLSB5MikpOwogICAgLy9tZXNzYWdlKCJkaWZmPSIgKyBkKTsKICAgIHZhciByZXMgPSBkICsgMzA7CiAgICB2YXIgc3RyID0gcmVzLnRvU3RyaW5nKCkgKyAicHgiOwoKICAgIGlmIChub2RlLnN0eWxlLmhlaWdodCAhPSBzdHIpCiAgICAgICAgbm9kZS5zdHlsZS5oZWlnaHQgPSBzdHI7Cn0KCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBNYWluCgpmdW5jdGlvbiBpbl9zZWFyY2hfcGFnZSgpIHsKICAgIHJldHVybiAod2luLmxvY2F0aW9uLnBhdGhuYW1lLmluZGV4T2YoIi9yZXN1bHRzIikgPT0gMCk7Cn0KCmZ1bmN0aW9uIGluX3BsaXN0X3BhZ2UoKSB7CiAgICByZXR1cm4gKHdpbi5sb2NhdGlvbi5wYXRobmFtZS5pbmRleE9mKCIvcGxheWxpc3QiKSA9PSAwKTsKfQoKZnVuY3Rpb24gaW5fdHJlbmRfcGFnZSgpIHsKICAgIHJldHVybiAod2luLmxvY2F0aW9uLnBhdGhuYW1lID09ICIvZmVlZC90cmVuZGluZyIpOwp9CgpmdW5jdGlvbiBpbl9oaXN0X3BhZ2UoKSB7CiAgICByZXR1cm4gKHdpbi5sb2NhdGlvbi5wYXRobmFtZSA9PSAiL2ZlZWQvaGlzdG9yeSIpOwp9CgovL2luc2VydCBzdHlsZXMKaW5zZXJ0U3R5bGUoc3R5bGVfYmFzaWMsICJncmlkdHViZV9zdHlsZV9iYXNpYyIpOwppbnNlcnRTdHlsZShzdHlsZV9hZHNfb3RoZXIsICJncmlkdHViZV9zdHlsZV9hZHNfb3RoZXIiKTsKCmlmIChwcmVmX3BsYXllckVuYWJsZSkgLy9oaWRlIG92ZXJsYXkgb2YgcGxheWxpc3QKICAgIGluc2VydFN0eWxlKCIueXQtcGwtdGh1bWItb3ZlcmxheSB7ZGlzcGxheTpub25lICFpbXBvcnRhbnQ7fSIsICJncmlkdHViZV9zdHlsZV9saXN0X292ZXJsYXkiKTsKCmlmIChwcmVmX2dyaWRFbmFibGUpIHsKICAgIGlmIChwcmVmX2dyaWRTZWFyY2gpCiAgICAgICAgaW5zZXJ0U3R5bGUoc3R5bGVfZ3JpZF9zZWFyY2gsICJncmlkdHViZV9zdHlsZV9ncmlkX3NlYXJjaCIpOwoKICAgIGlmIChwcmVmX2dyaWRQbGlzdCkKICAgICAgICBpbnNlcnRTdHlsZShzdHlsZV9ncmlkX3BsaXN0LCAiZ3JpZHR1YmVfc3R5bGVfZ3JpZF9wbGlzdCIpOwoKICAgIGlmIChwcmVmX2dyaWRUcmVuZCkKICAgICAgICBpbnNlcnRTdHlsZShzdHlsZV9ncmlkX3RyZW5kaW5nLCAiZ3JpZHR1YmVfc3R5bGVfZ3JpZF90cmVuZGluZyIpOwoKICAgIGlmIChwcmVmX2dyaWRIaXN0KQogICAgICAgIGluc2VydFN0eWxlKHN0eWxlX2dyaWRfaGlzdG9yeSwgImdyaWR0dWJlX3N0eWxlX2dyaWRfaGlzdG9yeSIpOwoKICAgIGlmIChwcmVmX2dyaWRSZWwpCiAgICAgICAgaW5zZXJ0U3R5bGUoc3R5bGVfZ3JpZF9yZWxhdGVkLCAiZ3JpZHR1YmVfc3R5bGVfZ3JpZF9yZWxhdGVkIik7Cn0KCi8vbWFyayBjb250ZW50IGlmIGluIHNlYXJjaCBtb2RlIHRvIGFwcGx5IGNvcnJlY3Qgc3R5bGUKZnVuY3Rpb24gbWFya19jb250ZW50KCkgewogICAgdmFyIGNvbnRlbnQgPSBkb2MuZ2V0RWxlbWVudEJ5SWQoImNvbnRlbnQiKTsKICAgIGlmICghY29udGVudCkgcmV0dXJuOwoKICAgIHZhciBpbnNlYXJjaCA9IGluX3NlYXJjaF9wYWdlKCk7CgogICAgaWYgKGluc2VhcmNoICYmIHByZWZfZ3JpZFNlYXJjaCAmJiAhY29udGVudC5nZXRBdHRyaWJ1dGUoImdyaWR0dWJlX2dyaWRfc2VhcmNoIikpCiAgICAgICAgY29udGVudC5zZXRBdHRyaWJ1dGUoImdyaWR0dWJlX2dyaWRfc2VhcmNoIiwgInRydWUiKTsKICAgIGVsc2UKICAgICAgICBpZiAoIWluc2VhcmNoICYmIGNvbnRlbnQuZ2V0QXR0cmlidXRlKCJncmlkdHViZV9ncmlkX3NlYXJjaCIpKQogICAgICAgICAgICBjb250ZW50LnJlbW92ZUF0dHJpYnV0ZSgiZ3JpZHR1YmVfZ3JpZF9zZWFyY2giKTsKCiAgICBpZiAoaW5zZWFyY2ggJiYgcHJlZl9hdXRvTG9hZFNlYXJjaCAmJiAhY29udGVudC5nZXRBdHRyaWJ1dGUoImdyaWR0dWJlX2F1dG9fbG9hZF9zZWFyY2giKSkKICAgICAgICBjb250ZW50LnNldEF0dHJpYnV0ZSgiZ3JpZHR1YmVfYXV0b19sb2FkX3NlYXJjaCIsICJ0cnVlIik7CiAgICBlbHNlCiAgICAgICAgaWYgKCFpbnNlYXJjaCAmJiBjb250ZW50LmdldEF0dHJpYnV0ZSgiZ3JpZHR1YmVfYXV0b19sb2FkX3NlYXJjaCIpKQogICAgICAgICAgICBjb250ZW50LnJlbW92ZUF0dHJpYnV0ZSgiZ3JpZHR1YmVfYXV0b19sb2FkX3NlYXJjaCIpOwoKICAgIHZhciBpbnRyZW5kID0gaW5fdHJlbmRfcGFnZSgpOwoKICAgIGlmIChpbnRyZW5kICYmIHByZWZfZ3JpZFRyZW5kICYmICFjb250ZW50LmdldEF0dHJpYnV0ZSgiZ3JpZHR1YmVfZ3JpZF90cmVuZCIpKQogICAgICAgIGNvbnRlbnQuc2V0QXR0cmlidXRlKCJncmlkdHViZV9ncmlkX3RyZW5kIiwgInRydWUiKTsKICAgIGVsc2UKICAgICAgICBpZiAoIWludHJlbmQgJiYgY29udGVudC5nZXRBdHRyaWJ1dGUoImdyaWR0dWJlX2dyaWRfdHJlbmQiKSkKICAgICAgICAgICAgY29udGVudC5yZW1vdmVBdHRyaWJ1dGUoImdyaWR0dWJlX2dyaWRfdHJlbmQiKTsKCiAgICB2YXIgaW5oaXN0ID0gaW5faGlzdF9wYWdlKCk7CgogICAgaWYgKGluaGlzdCAmJiBwcmVmX2dyaWRIaXN0ICYmICFjb250ZW50LmdldEF0dHJpYnV0ZSgiZ3JpZHR1YmVfZ3JpZF9oaXN0IikpCiAgICAgICAgY29udGVudC5zZXRBdHRyaWJ1dGUoImdyaWR0dWJlX2dyaWRfaGlzdCIsICJ0cnVlIik7CiAgICBlbHNlCiAgICAgICAgaWYgKCFpbmhpc3QgJiYgY29udGVudC5nZXRBdHRyaWJ1dGUoImdyaWR0dWJlX2dyaWRfaGlzdCIpKQogICAgICAgICAgICBjb250ZW50LnJlbW92ZUF0dHJpYnV0ZSgiZ3JpZHR1YmVfZ3JpZF9oaXN0Iik7Cn0KCgovL3JlbW92ZSBtb3JlX2FkcyBpbiBncmlkIHNlYXJjaCBtb2RlIG9yIGF1dG8gbG9hZApmdW5jdGlvbiByZW1vdmVfbW9yZV9hZHMoKSB7CiAgICBpZiAoaW5fc2VhcmNoX3BhZ2UoKSAmJiAocHJlZl9ncmlkU2VhcmNoIHx8IHByZWZfYXV0b0xvYWRTZWFyY2gpKSB7CiAgICAgICAgdmFyIG5vZGVzID0gZG9jc2VhcmNoKCIvL2xpLypbKGNvbnRhaW5zKEBjbGFzcywncHl2LWFmYy1hZHMtY29udGFpbmVyJylcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgY29udGFpbnMoQGNsYXNzLCdzZWFyY2gtcmVmaW5lbWVudHMnKVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBjb250YWlucyhAY2xhc3MsJ2V4cGxvcmF0b3J5LXNlY3Rpb24nKVwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBjb250YWlucyhAY2xhc3MsJ2ZlZWQtaXRlbS1jb250YWluZXInKSlcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kIChub3QoQGdyaWR0dWJlX2Fkc19tYXJrKSldIik7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZXMuc25hcHNob3RMZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgbm9kZSA9IG5vZGVzLnNuYXBzaG90SXRlbShpKTsKICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoImdyaWR0dWJlX2Fkc19tYXJrIiwgInRydWUiKTsKICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgfQogICAgfQp9CgoKLy9hdXRvX3BhZ2UgbG9hZCBldmVyeXRoaW5nCmZ1bmN0aW9uIGF1dG9fcGFnZV9sb2FkKHdpbl9yZXNpemVfc2Nyb2xsKSB7CiAgICBpZiAoIXByZWZfYXV0b0xvYWRTZWFyY2ggJiYgIXByZWZfYXV0b0xvYWRPdGhlcikgcmV0dXJuOwoKICAgIHZhciBzY3JvbGxNYXhZID0gKHdpbi5zY3JvbGxNYXhZIHwgKGRvYy5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gZG9jLmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpKTsKCiAgICBpZiAoaW5fc2VhcmNoX3BhZ2UoKSAmJiBwcmVmX2F1dG9Mb2FkU2VhcmNoKSB7CiAgICAgICAgLy9tZXNzYWdlKHdpbi5wYWdlWU9mZnNldCArICIgICAgIiArIHdpbi5zY3JvbGxNYXhZICsgIiAgICAiICsgd2luLmlubmVySGVpZ2h0KTsKICAgICAgICBzZWFyY2hfcGFnZXMod2luLnBhZ2VZT2Zmc2V0ID49IHNjcm9sbE1heFkgLSB3aW4uaW5uZXJIZWlnaHQpOwogICAgICAgIC8vc2VhcmNoX3BhZ2VzKHRydWUpOwogICAgfQoKICAgIC8vYXV0byBwYWdlIGZvciBvdGhlciBwYWdlcwoKICAgIGlmIChwcmVmX2F1dG9Mb2FkT3RoZXIpIHsKICAgICAgICB2YXIgYnV0dG9uX2xpc3QgPSBkb2NzZWFyY2goIi8vYnV0dG9uWygoQGlkPSd3YXRjaC1tb3JlLXJlbGF0ZWQtYnV0dG9uJylcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKGNvbnRhaW5zKEBjbGFzcywnbG9hZC1tb3JlLWJ1dHRvbicpKSlcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kIChub3QoY29udGFpbnMoQGNsYXNzLCAnZXJyb3InKSBvciBjb250YWlucyhAY2xhc3MsICdsb2FkaW5nJykpKV0iKTsKCgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnV0dG9uX2xpc3Quc25hcHNob3RMZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgYnV0dG9uID0gYnV0dG9uX2xpc3Quc25hcHNob3RJdGVtKGkpOwoKICAgICAgICAgICAgaWYgKHdpbl9yZXNpemVfc2Nyb2xsKSBidXR0b24uc2V0QXR0cmlidXRlKCJncmlkdHViZWNsaWNrIiwgIjAiKTsKICAgICAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICAgICAgdmFyIGNvdW50c3RyID0gYnV0dG9uLmdldEF0dHJpYnV0ZSgiZ3JpZHR1YmVjbGljayIpOwogICAgICAgICAgICBpZiAoY291bnRzdHIpIGNvdW50ID0gcGFyc2VJbnQoY291bnRzdHIpOwoKICAgICAgICAgICAgaWYgKChidXR0b24uc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpICYmIChjb3VudCA8IDEwKSkgewogICAgICAgICAgICAgICAgLy9hbGVydChjb25kICsgIiAgIiArIGNvdW50KTsKICAgICAgICAgICAgICAgIHZhciByZWN0ID0gYnV0dG9uLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICAgICAgLy9tZXNzYWdlKHJlY3QudG9wICsgIiAgIiArICAgd2luLnBhZ2VZT2Zmc2V0KTsKICAgICAgICAgICAgICAgIGlmICgyICogd2luLmlubmVySGVpZ2h0ID49IHJlY3QudG9wKQogICAgICAgICAgICAgICAgICAgIHNpbXVsQ2xpY2soYnV0dG9uKTsKICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImdyaWR0dWJlY2xpY2siLCAoY291bnQgKyAxKS50b1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCi8vY2xvc2UgcGxheWVyIGF0IG91dCBvZiBmb2N1cyBwYWdlIChleGNlcHQgbGFzdCkKZnVuY3Rpb24gZ2V0X3N0b3JhZ2VfY291bnQoKSB7CiAgICB2YXIgdmFsdWUgPSAtMTsKICAgIHZhciB0YWJzdHIgPSB3aW4ubG9jYWxTdG9yYWdlLmdldEl0ZW0oImdyaWR0dWJlX3RhYl9jb3VudCIpOwogICAgaWYgKHRhYnN0cikgdmFsdWUgPSBwYXJzZUludCh0YWJzdHIpOwogICAgcmV0dXJuIHZhbHVlOwp9CgpmdW5jdGlvbiBzZXRfc3RvcmFnZV9jb3VudCgpIHsKICAgIHZhciB2YWx1ZSA9IGdldF9zdG9yYWdlX2NvdW50KCk7CiAgICB2YWx1ZSsrOwogICAgaWYgKHZhbHVlID4gMTAwMDAwMCkgdmFsdWUgPSAwOwogICAgd2luLmxvY2FsU3RvcmFnZS5zZXRJdGVtKCJncmlkdHViZV90YWJfY291bnQiLCB2YWx1ZS50b1N0cmluZygpKTsKICAgIHJldHVybiB2YWx1ZTsKfQoKdmFyIHRhYl9jb3VudCA9IC0yOwp2YXIgc2V0X3N0b3JhZ2VfZXhlY3V0ZWQgPSBmYWxzZTsKCmZ1bmN0aW9uIGNoZWNrX2ZvY3VzKCkgewoKICAgIGlmICghZG9jLmhhc0ZvY3VzKCkpIHsKICAgICAgICAvL21lc3NhZ2UoIm91dCBvZiBmb2N1czogIiArIHRhYl9jb3VudCk7CiAgICAgICAgLy9jaGVjayBpZiBsYXN0IGZvY3VzZWQgdGFiCiAgICAgICAgaWYgKGdldF9zdG9yYWdlX2NvdW50KCkgIT0gdGFiX2NvdW50KSB7CiAgICAgICAgICAgIGlmIChwcmVmX3l0Rm9jdXMpIHl0cGF1c2UoKTsKICAgICAgICAgICAgaWYgKHByZWZfcGxheWVyRW5hYmxlKQogICAgICAgICAgICAgICAgaWYgKGdldF9wcmVmKCJwbGF5ZXJGb2N1cyIpKQogICAgICAgICAgICAgICAgICAgIHBsYXllci5wbGF5ZXJQYXVzZSgpOwogICAgICAgIH0KICAgICAgICBzZXRfc3RvcmFnZV9leGVjdXRlZCA9IGZhbHNlOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgLy9tZXNzYWdlKCJpbiBmb2N1czogIiArIHRhYl9jb3VudCk7CiAgICAgICAgaWYgKCFzZXRfc3RvcmFnZV9leGVjdXRlZCkgewogICAgICAgICAgICB0YWJfY291bnQgPSBzZXRfc3RvcmFnZV9jb3VudCgpOwogICAgICAgICAgICBzZXRfc3RvcmFnZV9leGVjdXRlZCA9IHRydWU7CiAgICAgICAgfQogICAgfQp9Cgp2YXIgb2xkX2FkZHIgPSB3aW4ubG9jYXRpb24uaHJlZjsKdmFyIG5vY2hhbmdlc19jb3VudCA9IC0xOwoKd2luLmFkZEV2ZW50TGlzdGVuZXIoImZvY3VzIiwgZnVuY3Rpb24gKCkgeyBub2NoYW5nZXNfY291bnQgPSAtMTsgY2hlY2tfZm9jdXMoKTsgfSwgZmFsc2UpOwp3aW4uYWRkRXZlbnRMaXN0ZW5lcigiYmx1ciIsIGZ1bmN0aW9uICgpIHsgbm9jaGFuZ2VzX2NvdW50ID0gLTE7IGNoZWNrX2ZvY3VzKCk7IH0sIGZhbHNlKTsKd2luLmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIGZ1bmN0aW9uICgpIHsgbm9jaGFuZ2VzX2NvdW50ID0gLTE7IHJlbGF0ZWRfYWRqdXN0KHRydWUpOyBhdXRvX3BhZ2VfbG9hZCh0cnVlKTsgfSwgZmFsc2UpOwp3aW4uYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgZnVuY3Rpb24gKCkgeyBub2NoYW5nZXNfY291bnQgPSAtMTsgYXV0b19wYWdlX2xvYWQodHJ1ZSk7IH0sIGZhbHNlKTsKd2luLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGUpIHsgbm9jaGFuZ2VzX2NvdW50ID0gLTE7IHBsYXllcl9jbG9zZShlKTsgfSwgZmFsc2UpOwoKLy9tYWluIHJvdXRpbmUKZnVuY3Rpb24gY2hlY2tfY2hhbmdlcygpIHsKICAgIGlmIChvbGRfYWRkciA9PSB3aW4ubG9jYXRpb24uaHJlZikgewogICAgICAgIG5vY2hhbmdlc19jb3VudCsrOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgbm9jaGFuZ2VzX2NvdW50ID0gMDsKICAgICAgICBvbGRfYWRkciA9IHdpbi5sb2NhdGlvbi5ocmVmOwogICAgICAgIHBsYXllcl9jbG9zZSgpOwogICAgICAgIC8vbWVzc2FnZSgibmV3IGFkZHIiKTsKICAgIH0KCiAgICBpZiAobm9jaGFuZ2VzX2NvdW50ID49IDIwKSByZXR1cm47CgogICAgY2hlY2tfZm9jdXMoKTsKCiAgICBpZiAocHJlZl9ncmlkRW5hYmxlKSB7CiAgICAgICAgbWFya19jb250ZW50KCk7CiAgICAgICAgaWYgKGluX3NlYXJjaF9wYWdlKCkpIGNob2ljZV9pY29ucygic2VhcmNoIik7CiAgICAgICAgaWYgKGluX2hpc3RfcGFnZSgpKSBjaG9pY2VfaWNvbnMoImhpc3QiKTsKICAgICAgICBpZiAoaW5fcGxpc3RfcGFnZSgpKSB7IGNob2ljZV9pY29ucygicGxpc3QiKTsgcGxpc3RfYWRqdXN0KCk7IH0KICAgICAgICByZWxhdGVkX2FkanVzdChmYWxzZSk7CiAgICB9CiAgICBtZXRhX2RhdGEoKTsKICAgIHJlbW92ZV9tb3JlX2FkcygpOwogICAgYXV0b19wYWdlX2xvYWQoZmFsc2UpOwp9Cgp3aW4uc2V0SW50ZXJ2YWwoY2hlY2tfY2hhbmdlcywgMTAwMCk7CmNoZWNrX2NoYW5nZXMoKTs="},{"name":"Reading content","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http://wikipedia.tld/*","http://*.wikipedia.tld/*","http://wikipedia.org/*","http://*.wikipedia.org/*","https://developer.chrome.com/*","http://developer.chrome.com/*","http://www.w3schools.com/*","https://www.w3schools.com/*","https://wikipedia.org/*","https://*.wikipedia.org/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469951850916,"data":{}},"enabled":true,"position":4,"uuid":"80288d2d-270e-4f6d-a372-e1a7c740b88b","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBSZWFkaW5nIGNvbnRlbnQKLy8gQG5hbWVzcGFjZSAgICBjb250ZW50UmVhZAovLyBAdmVyc2lvbiAgICAgIDAuMQovLyBAZGVzY3JpcHRpb24gIENsZWFyIGhlYWQgYW5kIGxlZnQgc2lkZWJhciB1cCBlLmkgaXQgaW1wcm92ZXMgcmVhZGFiaWxpdHkgb2YgY29udGVudC4KLy8gQGF1dGhvciAgICAgICBZb3UKLy8gQGluY2x1ZGUgICAgICAgaHR0cDovL3dpa2lwZWRpYS50bGQvKgovLyBAaW5jbHVkZSAgICAgICBodHRwOi8vKi53aWtpcGVkaWEudGxkLyoKLy8vLyBTaW5jZSBUTEQgZG9lc24ndCB3b3JrIGluIENocm9tZToKLy8gQGluY2x1ZGUgICAgICAgaHR0cDovL3dpa2lwZWRpYS5vcmcvKgovLyBAaW5jbHVkZSAgICAgICBodHRwOi8vKi53aWtpcGVkaWEub3JnLyoKLy8gQGluY2x1ZGUgICAgICAgaHR0cHM6Ly9kZXZlbG9wZXIuY2hyb21lLmNvbS8qCi8vIEBpbmNsdWRlICAgICAgIGh0dHA6Ly9kZXZlbG9wZXIuY2hyb21lLmNvbS8qCi8vIEBpbmNsdWRlICAgICAgIGh0dHA6Ly93d3cudzNzY2hvb2xzLmNvbS8qCi8vIEBpbmNsdWRlICAgICAgIGh0dHBzOi8vd3d3Lnczc2Nob29scy5jb20vKgovLy8vIGh0dHBzOgovLyBAaW5jbHVkZSAgICAgICBodHRwczovL3dpa2lwZWRpYS5vcmcvKgovLyBAaW5jbHVkZSAgICAgICBodHRwczovLyoud2lraXBlZGlhLm9yZy8qCi8vIEBncmFudCAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCi8vIHdpa2lwZWRpYQp2YXIgdmVyaWZ5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKTsKaWYgKHZlcmlmeSl7CnZhciBjb250ZW50TWFyZ2luID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5zdHlsZS5tYXJnaW5MZWZ0OwogICAgaWYgKGNvbnRlbnRNYXJnaW4gIT0gIjBweCIpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbXctbmF2aWdhdGlvbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ213LXBhZ2UtYmFzZScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjBweCI7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtdy1uYXZpZ2F0aW9uJykuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtdy1wYWdlLWJhc2UnKS5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRlbnQnKS5zdHlsZS5tYXJnaW5MZWZ0ID0gIiI7CiAgICB9Cn0KCi8vY29uc29sZS5sb2coJ3RoYXQgd29yaycpOwovLyAgIGh0dHBzOi8vZGV2ZWxvcGVyLmNocm9tZS5jb20vKgp2YXIgdmVyaWZ5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2l0ZW1wcm9wPSJhcnRpY2xlQm9keSJdJyk7CmlmKHZlcmlmeSl7CnZhciBjb250ZW50TWFyZ2luQ2hyb21lRGV2ZWxvcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2l0ZW1wcm9wPSJhcnRpY2xlQm9keSJdJykuc3R5bGUubWFyZ2luTGVmdDsKICAgIGlmIChjb250ZW50TWFyZ2luQ2hyb21lRGV2ZWxvcGVyICE9ICIwcHgiKSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2W2l0ZW1wcm9wPSJhcnRpY2xlQm9keSJdJykuc3R5bGUubWFyZ2luTGVmdCA9ICIwcHgiOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ25hdi5pbmxpbmUtdG9jLm5vLXBlcm1hbGluaycpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbmF2LmlubGluZS1zaXRlLXRvYy5uby1wZXJtYWxpbmsnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXZbaXRlbXByb3A9ImFydGljbGVCb2R5Il0nKS5zdHlsZS5tYXJnaW5MZWZ0ID0gIiI7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbmF2LmlubGluZS10b2Mubm8tcGVybWFsaW5rJykuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ25hdi5pbmxpbmUtc2l0ZS10b2Mubm8tcGVybWFsaW5rJykuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgfQp9Ci8vY29uc29sZS5sb2coJ3RoYXQgd29yaycpOwovLyAgIGh0dHA6Ly93d3cudzNzY2hvb2xzLmNvbS8KdmFyIHZlcmlmeSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNiZWxvd3RvcG5hdicpOwppZih2ZXJpZnkpewp2YXIgY29udGVudE1hcmdpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNiZWxvd3RvcG5hdicpLnN0eWxlLm1hcmdpbkxlZnQ7CiAgICBpZiAoY29udGVudE1hcmdpbiAhPSAiMHB4IikgewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNiZWxvd3RvcG5hdicpLnN0eWxlLm1hcmdpbkxlZnQgPSAiMHB4IjsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFpbicpLnN0eWxlLndpZHRoID0gIjEwMCUiOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b3BuYXYnKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsZWZ0bWVudWlubmVyJykuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAvL2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzaWRlbmF2Jykuc3R5bGUuZGlzcGxheSA9ICJub25lICFpbXBvcnRhbnQiOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi53My1zaWRlbmF2LnczLWNvbGxhcHNlLnczLXNsaW0nKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYmVsb3d0b3BuYXYnKS5zdHlsZS5tYXJnaW5MZWZ0ID0gIiI7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RvcG5hdicpLnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbGVmdG1lbnVpbm5lcicpLnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgICAgICAvL2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzaWRlbmF2Jykuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi53My1zaWRlbmF2LnczLWNvbGxhcHNlLnczLXNsaW0nKS5zdHlsZS5kaXNwbGF5ID0gIiI7CiAgICB9Cn0KCg=="},{"name":"Wikipedia Inline Article Viewer","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http://wikipedia.tld/*","http://*.wikipedia.tld/*","http://wikipedia.org/*","http://*.wikipedia.org/*","https://wikipedia.org/*","https://*.wikipedia.org/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469648549282,"data":{}},"enabled":true,"position":5,"file_url":"https://greasyfork.org/scripts/7678-wikipedia-inline-article-viewer/code/Wikipedia%20Inline%20Article%20Viewer.user.js","uuid":"b8fd3e59-dd37-4a2e-9c2f-81b99df54673","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgV2lraXBlZGlhIElubGluZSBBcnRpY2xlIFZpZXdlcgovLyBAbmFtZXNwYWNlICAgICBodHRwOi8vcHJvamVjdHMuYXBhdGh5YW50LmNvbS93aWtpcGVkaWFpbmxpbmUvCi8vIEBkZXNjcmlwdGlvbiAgIEFkZHMgYSBob3ZlciBldmVudCB0byBpbnRlcm5hbCBhcnRpY2xlIGxpbmtzIG9uIHdpa2lwZWRpYSBwYWdlcyB3aGljaCwgb3BlbnMgdGhlIGFydGljbGUgaW5saW5lIGluIGEgZGh0bWwgZnJhbWUuCi8vIEB2ZXJzaW9uICAgICAgIDEuMi4xMAovLyBAaW5jbHVkZSAgICAgICBodHRwOi8vd2lraXBlZGlhLnRsZC8qCi8vIEBpbmNsdWRlICAgICAgIGh0dHA6Ly8qLndpa2lwZWRpYS50bGQvKgovLy8vIFNpbmNlIFRMRCBkb2Vzbid0IHdvcmsgaW4gQ2hyb21lOgovLyBAaW5jbHVkZSAgICAgICBodHRwOi8vd2lraXBlZGlhLm9yZy8qCi8vIEBpbmNsdWRlICAgICAgIGh0dHA6Ly8qLndpa2lwZWRpYS5vcmcvKgovLy8vIGh0dHBzOgovLyBAaW5jbHVkZSAgICAgICBodHRwczovL3dpa2lwZWRpYS5vcmcvKgovLyBAaW5jbHVkZSAgICAgICBodHRwczovLyoud2lraXBlZGlhLm9yZy8qCi8vIEBncmFudCAgICAgICAgIEdNX2xvZwovLyBAZ3JhbnQgICAgICAgICBHTV94bWxodHRwUmVxdWVzdAovLyBAZ3JhbnQgICAgICAgICBHTV9hZGRTdHlsZQovLyA9PS9Vc2VyU2NyaXB0PT0KCi8vIFdpa2lwZWRpYSBJbmxpbmUgQXJ0aWNsZSBWaWV3ZXIKLy8gdmVyc2lvbiAwLjEuNQovLyAyMDA3LTA3LTE3Ci8vIENvcHlyaWdodCAoYykgMjAwNSwgQnJlbnQgQ2hhcmJvbm5lYXUKLy8gUmVsZWFzZWQgdW5kZXIgdGhlIEdQTCBsaWNlbnNlCi8vIGh0dHA6Ly93d3cuZ251Lm9yZy9jb3B5bGVmdC9ncGwuaHRtbAovLwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLwovLyBUaGlzIGlzIGEgR3JlYXNlbW9ua2V5IHVzZXIgc2NyaXB0LgovLwovLyBUbyBpbnN0YWxsLCB5b3UgbmVlZCBHcmVhc2Vtb25rZXk6IGh0dHA6Ly9ncmVhc2Vtb25rZXkubW96ZGV2Lm9yZy8KLy8gVGhlbiByZXN0YXJ0IEZpcmVmb3ggYW5kIHJldmlzaXQgdGhpcyBzY3JpcHQuCi8vIFVuZGVyIFRvb2xzLCB0aGVyZSB3aWxsIGJlIGEgbmV3IG1lbnUgaXRlbSB0byAiSW5zdGFsbCBVc2VyIFNjcmlwdCIuCi8vIEFjY2VwdCB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uIGFuZCBpbnN0YWxsLgovLwovLyBUbyB1bmluc3RhbGwsIGdvIHRvIFRvb2xzL01hbmFnZSBVc2VyIFNjcmlwdHMsCi8vIHNlbGVjdCAiV2lraXBlZGlhIElubGluZSBBcnRpY2xlIFZpZXdlciIsIGFuZCBjbGljayBVbmluc3RhbGwuCi8vCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovKiBKb2V5J3MgdmVyc2lvbiwgaW5zdGVhZCBvZiBhZGRpbmcgYW4gaW1hZ2UtYnV0dG9uIGFmdGVyIGV2ZXJ5IGxpbmssCiAqIGFjdGl2YXRlcyBvbiBtb3VzZSBob3Zlci4gIFRoaXMgZG9lcyBub3Qgc2xvdyBkb3duIHBhZ2UgbG9hZCEKICoKICogQW4gYWx0ZXJuYXRpdmUgbWlnaHQgYmU6IG9uIGxpbmsgaG92ZXIsIGZsb2F0IHVwIGFuIGltYWdlLWJ1dHRvbiB0aGUgdXNlcgogKiBjYW4gY2xpY2sgZm9yIGlubGluZSBwcmV2aWV3LiAgSGlkZSB0aGUgYnV0dG9uIG9uIHVuaG92ZXIuCiAqCiAqIEZvciBGRiBJIHJlbmFtZWQgZG9jdW1lbnQud2lkdGggdG8gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aC4KICovCgovLyBCVUc6IFdvcmtzIGZpbmUgdW5kZXIgaW4gQ2hyb21lLCBidXQgbm90IGluIEZpcmVmb3ghCgovLyBGSVhFRDogV2hlbiBvcGVuaW5nIGEgd2luZG93IGZvciBzb21lIGFydGljbGVzLCBzdWNoIGFzICJUaGUgV2F3b25hIFRyZWUiIG9uIHBhZ2UgIllvc2VtaXRlIiwgIkNvb3JkaW5hdGVzIiBhcHBlYXJlZCBwbGFjZWQgaW4gdGhlIGlubGluZSB3aW5kb3cncyBoZWFkZXIsIG9ic2N1cmluZyB0aGUgImNsb3NlIiBidXR0b24uCgovLyBGSVhFRDogTm93IHdoZW4gYW4gaW5saW5lIGFydGljbGUgaXMgc2Nyb2xsZWQsIGFuZCBhIGxpbmsgaW4gaXQgaXMgaG92ZXJlZCwgdGhlIHNlY29uZCBuZXcgd2luZG93IHNvbWV0aW1lcyBhcHBlYXJzIGluIHRoZSB3cm9uZyBwbGFjZS4KCnZhciBhbGxvd1ByZXZpZXdzSW5QcmV2aWV3cyA9IHRydWU7ICAgLy8gSWYgZmFsc2UsIGZlYXR1cmUgaXMgbm90IGF2YWlsYWJsZSBmb3IgbGlua3MgaW5zaWRlIHByZXZpZXdlZCBhcnRpY2xlcy4KCnZhciByZW1vdmVUT0MgPSB0cnVlOwoKdmFyIGlubGluZVdpbmRvd0NvdW50ID0gMDsKCnZhciBzdHlsZVByZXZpZXdlZExpbmtzID0gdHJ1ZTsKCi8qCnZhciBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7Cmljb24uc3JjID0gImRhdGE6aW1hZ2UvcG5nLCU4OVBORyUwRCUwQSUxQSUwQSUwMCUwMCUwMCUwRElIRFIlMDAlMDAlMDAlMEElMDAlIisKCQkJIjAwJTAwJTBBJTA4JTA2JTAwJTAwJTAwJThEMiVDRiVCRCUwMCUwMCUwMCUwNGdBTUElMDAlMDAlQUYlQzg3JTA1JTgiKwoJCQkiQSVFOSUwMCUwMCUwMCUxOXRFWHRTb2Z0d2FyZSUwMEFkb2JlJTIwSW1hZ2VSZWFkeXElQzllJTNDJTAwJTAwJTAwJSIrCgkJCSI5MklEQVR4JURBYiVGQyVGRiVGRiUzRiUwMyUwQyVBQ18lQkYlMUUlQzFBJTAzJTJDJUU4JTAyJTgxJTgxJzElMTQlIisKCQkJIkFEX28lQ0UlQzAlODRNN0glRTIlQ0MlMTlhJTE0MSVCMCVDMjNnJUNFJUZDR1YlMjQlMkIlN0IlODdBWlolMEZFMSUiKwoJCQkiMTMlQ0MlNUQwJTFBJUE0JUM4JUM0JUU0LSVDMyVEMyVBNyU5NyUxOCUxRSUzRlZBdSVBMyU4OSU4OSUwOSU5NCVCQiIrCgkJCSIlMUYlQUMlMDhkJTEySCUxMSVCMiU3QiVFMSU5RSU4MSg2JTAxKiVFQSU4NiU5QiUwNHIlMDZOXzMwOCUwMiVGMWMlIisKCQkJIkEwaSU4MSU4QyUxOCU5RUElMDYlMjAlOTNlZWVRJTNDJTA4NyUxMSVFOCUxMSUwNiVDQyVGMEQ1JTExJTIwJUMwJTAiKwoJCQkiMCVFNVo5JTFFJUE2JThGcSUxNyUwMCUwMCUwMCUwMElFTkQlQUVCJTYwJTgyIjsKaWNvbi5zdHlsZS5ib3JkZXIgPSAnbm9uZSc7Cmljb24ud2lkdGggPSAxMDsKaWNvbi5oZWlnaHQgPSAxMDsKCmZ1bmN0aW9uIHJld3JpdGVMaW5rcygpIHsKCS8vIFRoaXMgZnVuY3Rpb24gZ3JhYnMgYWxsIHRoZSBsaW5rcyB3aXRoaW4gdGhlIHBhZ2UncyAjY29udGVudCBkaXYgYW5kIAoJLy8gc2VuZHMgdGhlbSBvZmYgdG8gYmUgbW9kaWZpZWQKCgl2YXIgbGlua3MsIGN1cnJlbnRMaW5rOwoKCS8vIFhQYXRoIHRvIHNlbGVjdCBhbGwgYW5jaG9yIHRhZ3Mgd2l0aCBhbiBocmVmIHRoYXQgYmVnaW5zIHdpdGggL3dpa2kvCglsaW5rcyA9IGRvY3VtZW50LmV2YWx1YXRlKAoJCScvL2RpdltAaWQ9ImNvbnRlbnQiXS8vYVtzdGFydHMtd2l0aChAaHJlZiwiL3dpa2kvIildJywKCQlkb2N1bWVudCwKCQludWxsLAoJCVhQYXRoUmVzdWx0LlVOT1JERVJFRF9OT0RFX1NOQVBTSE9UX1RZUEUsCgkJbnVsbCk7CgoJZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5rcy5zbmFwc2hvdExlbmd0aDsgaSsrKSB7CgkJY3VycmVudExpbmsgPSBsaW5rcy5zbmFwc2hvdEl0ZW0oaSk7CgoJCS8vIGRvIHNvbWV0aGluZyB3aXRoIHRoaXNMaW5rCgkJaWYgKCBjdXJyZW50TGluay5nZXRBdHRyaWJ1dGUoJ2lubGluZXZpZXdhcHBlbmRlZCcpICE9ICd0cnVlJyAKCQkJCSYmIGN1cnJlbnRMaW5rLmdldEF0dHJpYnV0ZSgnaW5saW5ldmlld2xpbmsnKSAhPSAndHJ1ZScKCQkJCSYmIGN1cnJlbnRMaW5rLmNsYXNzTmFtZSAhPSAnaW1hZ2UnICkgewoJCQlhcHBlbmRJbmxpbmVCdXR0b24oY3VycmVudExpbmspOwoJCX0KCX0KCS8vIGhpZGUgbGluayBpY29ucyBpbiB0aGUgcHJpbnQgc3R5bGUgc2hlZXQKCS8vIEdNX2xvZyhkb2N1bWVudC5zdHlsZVNoZWV0cyk7Cglmb3IgKHZhciBpPTA7IGk8ZG9jdW1lbnQuc3R5bGVTaGVldHMubGVuZ3RoOyBpKyspIHsKCQkvL0dNX2xvZyhkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5tZWRpYS5tZWRpYVRleHQpOwoJCWlmICgvXGJwcmludFxiLy50ZXN0IChkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5tZWRpYS5tZWRpYVRleHQpKSB7CgkJCWRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLmluc2VydFJ1bGUgKCcuaW5saW5lbGluayB7ZGlzcGxheTpub25lfScsIDApOwoJCQlicmVhazsKCQl9Cgl9Cn0KCmZ1bmN0aW9uIGFwcGVuZElubGluZUJ1dHRvbihsaW5rKSB7CgkvLyBDcmVhdGUgdGhlIG5ldyBlbGVtZW50IHRvIGhvbGQgYWxsIHRoYXQgd2UncmUgZG9pbmcuLi4KCXZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgoJLy8gVGhpcyB3aWxsIHByZXZlbnQgdGhlIHZpZXcgaW5saW5lIGljb24gZnJvbSBicmVha2luZyBhd2F5IGZyb20gdGhlIGxhc3Qgd29yZCBvZiB0aGUKCS8vIGFydGljbGUgbGluawoJY29udGFpbmVyLnN0eWxlLndoaXRlU3BhY2UgPSAnbm93cmFwJzsKCgkvLyBXZSB3YW50IHRoZSBsaW5rIHRvIHdyYXAgbm9ybWFsbHkgdGhvdWdoLCBhbmQgb25seSBob2xkIHRoZSBuZXcgaWNvbiB0byB0aGUgbGFzdCB3b3JkCgkvLyBzbyB3ZSBzaG91bGQgZXhwbGljaXRseSBzZXQgbm9ybWFsIHdyYXAgb24gdGhlIGxpbmsgZWxlbWVudAoJbGluay5zdHlsZS53aGl0ZVNwYWNlID0gJ25vcm1hbCc7CgoJLy8gQWRkIGEgbmV3IGFuY2hvciBpbnNpZGUgdGhlIG5ldyBidXR0b24KCS8vIFdlIHVzZSBpbm5lckhUTUwgYmVjYXVzZSBpdCdzIHF1aWNrZXIgdGhhbiB3cml0aW5nIG91dCB0aGUgc3R5bGUgcHJvcGVydGllcwoJLy8gb25lIGJ5IG9uZSB3aXRoIGphdmFzY3JpcHQKCWNvbnRhaW5lci5pbm5lckhUTUwgPSAnPGEgY2xhc3M9ImlubGluZWxpbmsiIGhyZWY9IicgKyBsaW5rLnBhdGhuYW1lICsgJyIgaW5saW5ldmlld2xpbms9InRydWUiIGlubGluZXdpbmRvdz0iJyArIChpbmxpbmVXaW5kb3dDb3VudCsrKSArICciIHN0eWxlPSJ0ZXh0LWRlY29yYXRpb246IG5vbmU7IG1hcmdpbi1sZWZ0OiAwLjNlbTsiPjwvYT4nOwoKCS8vIFB1bGwgb3V0IG91ciBpbm5lckhUTUwgZ2VuZXJhdGVkIGFuY2hvciBlbGVtZW50Li4uCgl2YXIgbmV3TGluayA9IGNvbnRhaW5lci5maXJzdENoaWxkOwoKCS8vIEFkZCBhIGNsaWNrIGV2ZW50IGxpc3RlbmVyIHRvIG91ciBuZXcgbGluawoJLy8gdGhpcyBldmVudCBoYW5kbGVyIGlzIHdoZXJlIHRoZSBpbmxpbmUgcGFnZSB3aWxsIGJlIGZldGNoZWQKCW5ld0xpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBpbmxpbmVWaWV3Q2xpY2tIYW5kbGVyLCB0cnVlKTsgCgluZXdMaW5rLmFwcGVuZENoaWxkKGljb24uY2xvbmVOb2RlKGZhbHNlKSk7CgoJLy8gSW5zZXJ0IHRoZSBuZXcgY29udGFpbmVyIGJlZm9yZSB0aGUgY3VycmVudCBsaW5rLi4uCglsaW5rLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNvbnRhaW5lcixsaW5rKTsKCgkvLyBOb3cgbW92ZSB0aGUgbGluayBpbnNpZGUgdGhlIGNvbnRhaW5lciBiZWZvcmUgdGhlIG5ldyBsaW5rCgkvLyAoRllJOiB0aGlzIGRhbmNlIGhlcmUgaXMgZm9yIHRoZSB3aGl0ZXBhY2UgYnJlYWsgc3R1ZmYgd2UgaW1wbGVtZW50ZWQgZWFybGllcikKCWNvbnRhaW5lci5pbnNlcnRCZWZvcmUobGluaywgbmV3TGluayk7CgoJLy8gRXhwZXJpZW5jZWQgc29tZSB3ZWlyZCBtdWx0aXBsZS1hcHBlbmRpbmdzLi4uIHRoaXMgd2FzIGFkZGVkCgkvLyB0byBhdHRlbXB0IHRvIHN0b3AgdGhpcyBiZWhhdmlvci4uLgoJbGluay5zZXRBdHRyaWJ1dGUoJ2lubGluZXZpZXdhcHBlbmRlZCcsJ3RydWUnKTsKCXJldHVybiB0cnVlOwoKfQoKZnVuY3Rpb24gaW5saW5lVmlld0NsaWNrSGFuZGxlcihldmVudCkgewoJLy8gRXZlbnQgaGFuZGxlciB3aGljaCB0YWtlcyBjbGlja3MgZnJvbSBvdXIgaW5qZWN0ZWQgaW5saW5lIHZpZXcgaWNvbiBsaW5rcy4uLgoJdmFyIGhyZWYsIGxpbms7CgoJLy8gQ3JlYXRlIHRoZSBuZXcgZGh0bWwgZnJhbWUKCWlmICggZXZlbnQudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAnYScgKSB7CgkJLy8gdXNlciBtYW5hZ2VkIHRvIGNsaWNrIHRoZSBhY3R1YWwgYW5jaG9yIGFuZCBub3QgdGhlIGljb24KCQlocmVmID0gZXZlbnQudGFyZ2V0LnBhdGhuYW1lOwoJCWxpbmsgPSBldmVudC50YXJnZXQ7CgoJfQllbHNlIGlmICggZXZlbnQudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAnaW1nJyApIHsgCgkJLy8gdXNlciBjbGlja2VkIHRoZSBpY29uCgkJaHJlZiA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLnBhdGhuYW1lOwoJCWxpbmsgPSBldmVudC50YXJnZXQucGFyZW50Tm9kZTsKCgl9ZWxzZXsKCQkvLyBObyBpZGVhIGhvdyB0aGlzIGZ1bmN0aW9uIHdhcyBsYXVuY2hlZCwgc28gd2UgY2Fubm90IHByb2NlZWQuCgkJR01fbG9nKCdpbmxpbmVWaWV3Q2xpY2tIYW5kbGVyIHRyaWdnZXJlZCBmcm9tIHVua25vd24gZWxlbWVudC4gQ2Fubm90IHByb2NlZWQuJyk7CgkJcmV0dXJuIGZhbHNlOwoJfQoKCXdpbmRvd0lEID0gbGluay5nZXRBdHRyaWJ1dGUoJ2lubGluZXdpbmRvdycpOwkJCgkvLyBjaGVjayB0byBzZWUgaWYgdGhlIHdpbmRvdyBpcyBvcGVuIGFuZCBpZiBzbyBjbG9zZSBpdCwgb3RoZXJ3aXNlIHBvcCBhIG5ldyB3aW5kb3cKCXZhciBvcGVuV2luZG93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lubGluZVdpbmRvdy0nICsgd2luZG93SUQpOwoJaWYob3BlbldpbmRvdykgewoJCW9wZW5XaW5kb3cucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvcGVuV2luZG93KTsKCX0gZWxzZSB7CgkJaW5saW5lV2luZG93ID0gbmV3SW5saW5lV2luZG93KGV2ZW50LCBocmVmLCBsaW5rLCB3aW5kb3dJRCk7Cgl9CgoJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCXJldHVybiB0cnVlOwp9CiovCgpmdW5jdGlvbiBuZXdJbmxpbmVXaW5kb3coZXZlbnQsIGhyZWYsIGxpbmssIHdpbmRvd0lEKXsKCS8vIENsb3NlIGFsbCBwcmV2aW91cyBpbmxpbmUgd2luZG93cy4uLgoJLy9jbG9zZUlubGluZVdpbmRvd3MoKTsKCgkvLyBTZXR1cCBzb21lIGNvbnN0YW50cyBmb3IgdXNlIGluIGNyZWF0aW5nIHRoZSBpbmxpbmUgd2luZG93Li4uCgl2YXIgd2luZG93V2lkdGggPSBNYXRoLnJvdW5kKGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggKiAwLjkwKTsKCXZhciB3aW5kb3dIZWlnaHQgPSBNYXRoLnJvdW5kKHdpbmRvdy5pbm5lckhlaWdodCAqIDAuOCk7Cgl2YXIgd2luZG93UGFkZGluZyA9IDEzOwoJdmFyIHdpbmRvd1RleHRQYWRkaW5nID0gMTA7Cgl2YXIgd2luZG93Rm9udFNpemUgPSAxNjsKCXZhciB3aW5kb3dCb3JkZXJTaXplID0gMTsKCXZhciB3aW5kb3dCdXR0b25IZWlnaHQgPSAxMjsKCXZhciB3aW5kb3dCdXR0b25UZXh0U2l6ZSA9IDExOwoKCXZhciB3aW5kb3dGdWxsSUQgPSAnaW5saW5lV2luZG93LScgKyB3aW5kb3dJRDsKCgkvLyBzdG9wIHRoZSB3aW5kb3cgYmVmb3JlIGdldHRpbmcgdGhpcyBjbG9zZSB0byB0aGUgbGVmdC9yaWdodC90b3AvYm90dG9tIG9mIHRoZSBzY3JlZW4KCXZhciBwYWdlQm91bmRQYWRkaW5nID0gMTA7CgoJdmFyIHhwb3MsIHlwb3M7CgoJLy8gZ2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgZWxlbWVudCB0aGF0IHdhcyBjbGlja2VkIG9uLi4uCgl2YXIgZWxlbWVudFRvcCA9IGdldEVsZW1lbnRPZmZzZXQobGluaywnVG9wJyk7Cgl2YXIgZWxlbWVudExlZnQgPSBnZXRFbGVtZW50T2Zmc2V0KGxpbmssJ0xlZnQnKTsKCS8vdmFyIGVsZW1lbnRUb3AgPSAkKGxpbmspLm9mZnNldCgpLnRvcDsKCS8vdmFyIGVsZW1lbnRMZWZ0ID0gJChsaW5rKS5vZmZzZXQoKS5sZWZ0OwoJdmFyIGVsZW1lbnRIZWlnaHQgPSBwYXJzZUludCh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShsaW5rLCIiKS5nZXRQcm9wZXJ0eVZhbHVlKCdsaW5lLWhlaWdodCcpKTsKCS8vIFNvbWV0aW1lcyAoSSBkb24ndCBrbm93IHdoeSksIGdldFByb3BlcnR5VmFsdWUoImxpbmUtaGVpZ2h0IikgcHJvZHVjZXMgTmFOLgoJZWxlbWVudEhlaWdodCA9IGVsZW1lbnRIZWlnaHQgfHwgbGluay5jbGllbnRIZWlnaHQ7CgkvLyBCdXQgdGhlbiBjbGllbnRIZWlnaHQgcHJvZHVjZXMgMC4KCS8vIEZvcnR1bmF0ZWx5IHdlIGNhbiB1c2UgalF1ZXJ5IHRvIGZpbmQgdGhlIGhlaWdodC4KCWVsZW1lbnRIZWlnaHQgPSBlbGVtZW50SGVpZ2h0IHx8ICQobGluaykuaGVpZ2h0KCk7CglHTV9sb2coImVsZW1lbnRIZWlnaHQ9IitlbGVtZW50SGVpZ2h0KTsKCglHTV9hZGRTdHlsZSgiLmlubGluZS13aW5kb3cgI2Nvb3JkaW5hdGVzIHsgcG9zaXRpb246IGluaXRpYWw7IH0iKTsKCgoJLy8gc2V0dXAgdGhlIHgtcG9zaXRpb24gb2YgdGhlIGlubGluZSB3aW5kb3cuLi4KCS8vIGNoZWNrIHRvIHNlZSBpZiB0aGUgbGVmdCAxLzMgb2YgdGhlIHdpbmRvdyB3aWxsIG92ZXJsYXAgdGhlIGxlZnQgcGFnZSBib3VuZC4uCglpZiAoIGVsZW1lbnRMZWZ0IC0gKHdpbmRvd1dpZHRoLzMpIDwgcGFnZUJvdW5kUGFkZGluZyApIHsKCQl4cG9zID0gcGFnZUJvdW5kUGFkZGluZzsKCX0gCgkvLyBjaGVjayB0byBzZWUgaWYgdGhlIHJpZ2h0IDIvMyBvZiB0aGUgd2luZG93IHdpbGwgb3ZlcmxhcCB0aGUgcmlnaHQgcGFnZSBib3VuZC4uLgoJZWxzZSBpZiAoIGVsZW1lbnRMZWZ0ICsgKHdpbmRvd1dpZHRoKjIvMykgPiBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIC0gcGFnZUJvdW5kUGFkZGluZyApIHsKCQl4cG9zID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCAtIHBhZ2VCb3VuZFBhZGRpbmcgLSB3aW5kb3dXaWR0aDsKCX0KCWVsc2UgewoJCS8vIGlmIHdlJ3JlIG5vdCBnb2luZyB0byBoaXQgZWl0aGVyIHdhbGwsIHNldCB0aGUgd2luZG93IHRvIGJlIG9mZnNldAoJCS8vIGJ5IDEvMyB0byB0aGUgbGVmdCBvZiB3aGVyZSB3ZSBjbGlja2VkIChsb29rcyBiZXR0ZXIgdGhhbiBjZW50ZXJpbmcKCQl4cG9zID0gZWxlbWVudExlZnQgLSAod2luZG93V2lkdGgvMyk7Cgl9CgoJLy8gc2V0dXAgdGhlIHktcG9zaXRpb25pbmcgb2YgdGhlIGlubGluZSB3aW5kb3cuLi4KCgl2YXIgd2luZG93QXBwZWFyc09uU2lkZTsKCgkvLyBjaGVjayB0byBzZWUgaWYgdGhlIHdpbmRvdyBnb2VzIGJleW9uZCB0aGUgYm90dG9tIG9mIHRoZSB2aWV3cG9ydC4uLgoJaWYgKCBlbGVtZW50VG9wICsgd2luZG93SGVpZ2h0ICsgcGFnZUJvdW5kUGFkZGluZyA+IHdpbmRvdy5wYWdlWU9mZnNldCArIHdpbmRvdy5pbm5lckhlaWdodCApIHsKCQl5cG9zID0gZWxlbWVudFRvcCAtIHdpbmRvd0hlaWdodDsKCQl3aW5kb3dBcHBlYXJzT25TaWRlID0gJ1RvcCc7Cgl9IGVsc2UgeyAKCQl5cG9zID0gZWxlbWVudFRvcCArIGVsZW1lbnRIZWlnaHQ7CgkJd2luZG93QXBwZWFyc09uU2lkZSA9ICdCb3R0b20nOwoJfQoJLy8gSWYgd2UgcHV0IGl0IGFib3ZlIHRoZSBlbGVtZW50LCBtYWtlIHN1cmUgd2UgZGlkbid0IGdvIG9mZiB0aGUgdG9wLgoJaWYgKHlwb3MgPCA0KSB7CgkJeXBvcyA9IDQ7Cgl9CgoJdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJY29udGFpbmVyLmlkID0gd2luZG93RnVsbElEOwoJY29udGFpbmVyLmNsYXNzTmFtZSA9ICJpbmxpbmUtd2luZG93IjsKCgl2YXIgY3NzQm94V2lkdGggPSBNYXRoLnJvdW5kKCh3aW5kb3dXaWR0aCAtICh3aW5kb3dQYWRkaW5nK3dpbmRvd0JvcmRlclNpemUpKjIpL2RvY3VtZW50LmJvZHkuY2xpZW50V2lkdGgqMTAwKTsKCXZhciBjc3NCb3hIZWlnaHQgPSB3aW5kb3dIZWlnaHQgLSAod2luZG93UGFkZGluZyt3aW5kb3dCb3JkZXJTaXplKjIpOwoKCWNvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0iJyArCgkJJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgJysKCQkvLyBXZSBjYW4gcG9zaXRpb24gd2l0aCB0b3AvbGVmdC4KCQkndG9wOiAnICsgeXBvcyArICdweDsnICsKCQknbGVmdDogJyArIHhwb3MgKyAncHg7ICcgKwoJCS8vIE9yIHVzaW5nIG1hcmdpbi4KCQkvLydtYXJnaW46ICcgKyB5cG9zICsgJ3B4IDAgMCAnICsgeHBvcyArICdweDsgJyArCgkJLy8gV2Ugb25seSBuZWVkIHRoZSBmb2xsb3dpbmcgaWYgd2UgYXJlbid0IGFkZGluZyB0byB0aGUgdG9wIG9mIHRoZSBwYWdlLgoJCS8vJ3RvcDogMHB4OyBsZWZ0OiAwcHg7ICcgKwoJCSdwYWRkaW5nOiAnICsgTWF0aC5yb3VuZCgod2luZG93UGFkZGluZy13aW5kb3dCdXR0b25IZWlnaHQpLzIpICsncHggJyArIHdpbmRvd1BhZGRpbmcgKyAncHggJyArIHdpbmRvd1BhZGRpbmcgKyAncHg7ICcgKwoJCSd3aWR0aDogJyArIGNzc0JveFdpZHRoICsgJyU7ICcgKwoJCSdoZWlnaHQ6ICcrIGNzc0JveEhlaWdodCArICdweDsgJyArCgkJJ2JhY2tncm91bmQtY29sb3I6ICMwMDA7ICcrCgkJJ2JvcmRlcjogJyArIHdpbmRvd0JvcmRlclNpemUgKyAncHggc29saWQgI0UwRTBFMDsgJysKCQknLW1vei1ib3JkZXItcmFkaXVzOiA1cHg7ICcrCgkJJ3otaW5kZXg6IDk5OTsgJysKCQkvLydvcGFjaXR5OiAwLjk1OyAnKwoJCSdmb250LXNpemU6ICcgKyB3aW5kb3dGb250U2l6ZSArICdwdDsgJysKCQknIj4nKwoJCSc8ZGl2IHN0eWxlPSInKwoJCSdmbG9hdDogcmlnaHQ7ICcrCgkJJ2JhY2tncm91bmQtY29sb3I6ICNEREQ7ICcrCgkJJ21hcmdpbjogMCAzcHggJyArIE1hdGgucm91bmQoKHdpbmRvd1BhZGRpbmctd2luZG93QnV0dG9uSGVpZ2h0KS8yKSArJ3B4OyAnKwoJCSdwYWRkaW5nOiAwIDNweDsgJysKCQknLW1vei1ib3JkZXItcmFkaXVzOiAycHg7ICcrCgkJJ2hlaWdodDogJyArIHdpbmRvd0J1dHRvbkhlaWdodCArICdweDsgJysKCQknZm9udC1zaXplOiAnICsgd2luZG93QnV0dG9uVGV4dFNpemUgKyAncHg7ICcrCgkJJ2xpbmUtaGVpZ2h0OiAnICsgd2luZG93QnV0dG9uVGV4dFNpemUgKyAncHg7ICcrCgkJJ2ZvbnQtd2VpZ2h0OiBib2xkJysKCQknIj48YSBocmVmPSIjIiBvbkNsaWNrPSJpbm5lcldpbmRvdyA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGU7IGlubmVyV2luZG93LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaW5uZXJXaW5kb3cpOyByZXR1cm4gZmFsc2U7IiBzdHlsZT0idGV4dC1kZWNvcmF0aW9uOiBub25lOyI+Y2xvc2U8L2E+PC9kaXY+JysKCQknPGRpdiBzdHlsZT0iJysKCQknZmxvYXQ6IHJpZ2h0OyAnKwoJCSdiYWNrZ3JvdW5kLWNvbG9yOiAjREREOyAnKwoJCSdtYXJnaW46IDAgM3B4ICcgKyBNYXRoLnJvdW5kKCh3aW5kb3dQYWRkaW5nLXdpbmRvd0J1dHRvbkhlaWdodCkvMikgKydweDsgJysKCQkncGFkZGluZzogMCAzcHg7ICcrCgkJJy1tb3otYm9yZGVyLXJhZGl1czogMnB4OyAnKwoJCSdoZWlnaHQ6ICcgKyB3aW5kb3dCdXR0b25IZWlnaHQgKyAncHg7ICcrCgkJJ2ZvbnQtc2l6ZTogJyArIHdpbmRvd0J1dHRvblRleHRTaXplICsgJ3B4OyAnKwoJCSdsaW5lLWhlaWdodDogJyArIHdpbmRvd0J1dHRvblRleHRTaXplICsgJ3B4OyAnKwoJCSdmb250LXdlaWdodDogYm9sZCcrCgkJJyI+PGEgaHJlZj0iJyArIGhyZWYgKyAnIiBzdHlsZT0idGV4dC1kZWNvcmF0aW9uOiBub25lOyI+Z28gdG8gZnVsbCBhcnRpY2xlPC9hPjwvZGl2PicrCgkJJzxkaXYgaWQ9ImlubmVyV2luZG93Q29udC0nICsgd2luZG93SUQgKyAnIiBzdHlsZT0iJysKCQknYm9yZGVyOiAxcHggZGFzaGVkIGJsYWNrOyAnKwoJCSdiYWNrZ3JvdW5kOiB3aGl0ZTsgJysKCQkncGFkZGluZzogJyArIHdpbmRvd1RleHRQYWRkaW5nICsgJ3B4OyAnKwoJCSdvdmVyZmxvdzogYXV0bzsgJysKCQknY2xlYXI6IGJvdGg7ICcrCgkJJ2hlaWdodDogJyArICh3aW5kb3dIZWlnaHQgLSAod2luZG93VGV4dFBhZGRpbmcrd2luZG93UGFkZGluZyt3aW5kb3dCb3JkZXJTaXplKSoyKSArICdweDsgJyArCgkJJyI+bG9hZGluZzxzcGFuIHN0eWxlPSJ0ZXh0LWRlY29yYXRpb246IGJsaW5rIj4uLi48L3NwYW4+PC9kaXY+JysJCgkJJzwvZGl2Pic7CgkvLyBBbHdheXMgaW5zZXJ0aW5nIGF0IHRoZSB0b3Agb2YgdGhlIHRyZWUgbWVhbnMgdGhhdCB3aW5kb3dzIG9wZW5lZCBsYXRlciB3b3VsZCBhcHBlYXIgYmVsb3cgd2luZG93cyBvcGVuZWQgZWFybGllciEKCS8vZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUoY29udGFpbmVyLCBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQpOwoJLy8gVGhpcyByZXF1aXJlcyB1cyB0byBwZXJmb3JtIHBvc2l0aW9uaW5nIHdpdGggdG9wLGxlZnQgcmF0aGVyIHRoYW4gbWFyZ2luIGluIHN0eWxpbmcgYWJvdmUuCgkvLyBJdCBpcyBhbHNvIHVzZWQgYWZ0ZXIgYSBjbGljayBldmVudCB0byBkaXNwbGF5IHRoZSB3aW5kb3cgb24gdGhlIHRvcCAoc2VlIGJlbG93KS4KCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTsKCS8vIE5ldyBtZXRob2Q6CgkvKgoJdmFyIGV4aXN0aW5nV2luZG93cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImlubGluZS13aW5kb3ciKTsKCXZhciBpbnNlcnRUYXJnZXQ7CglpZiAoZXhpc3RpbmdXaW5kb3dzLmxlbmd0aCA+IDApIHsKCQl2YXIgbGFzdFdpbmRvdyA9IGV4aXN0aW5nV2luZG93c1tleGlzdGluZ1dpbmRvd3MubGVuZ3RoIC0gMV07CgkJaW5zZXJ0VGFyZ2V0ID0gbGFzdFdpbmRvdy5uZXh0U2libGluZzsKCX0gZWxzZSB7CgkJaW5zZXJ0VGFyZ2V0ID0gZG9jdW1lbnQuYm9keS5maXJzdENoaWxkOwoJfQoJZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUoY29udGFpbmVyLCBpbnNlcnRUYXJnZXQpOwoJKi8KCgkvLyBXaGVuIGNsaWNraW5nIGFueXdoZXJlIG9uIGFuIGlubmVyV2luZG93LCBicmluZyBpdCB0byB0aGUgdG9wLgoJY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKXsKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7Cgl9LCB0cnVlKTsKCglpZiAoc3R5bGVQcmV2aWV3ZWRMaW5rcykgewoJCWxpbmsuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNGRkZGRTAnOwoJCWxpbmsuc3R5bGUucGFkZGluZyA9ICcycHgnOwoJCWxpbmsuc3R5bGUubWFyZ2luID0gJy0ycHgnOwoJCWxpbmsuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCAjRTBFMEUwJzsKCQlsaW5rLnN0eWxlWyJib3JkZXIiK3dpbmRvd0FwcGVhcnNPblNpZGVdID0gJzBweCc7CgkJY29udGFpbmVyLnByZXZpZXdlZExpbmsgPSBsaW5rOyAgIC8vIG5hdWdodHkKCX0KCglwb3B1bGF0ZUlubmVyV2luZG93KGhyZWYsd2luZG93SUQpOwp9CgpmdW5jdGlvbiBwb3B1bGF0ZUlubmVyV2luZG93KGhyZWYsd2luZG93SUQpIHsKCglwcmludEhyZWYgPSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBkb2N1bWVudC5sb2NhdGlvbi5ob3N0ICsgKGRvY3VtZW50LmxvY2F0aW9uLnBvcnQgPyAnOicgKyBkb2N1bWVudC5sb2NhdGlvbi5wb3J0IDogJycpOwoJcHJpbnRIcmVmICs9IGhyZWYgKyAoaHJlZi5pbmRleE9mKCc/JykgPiAtMSA/ICcmJyA6ICc/JyApICsgJ3ByaW50YWJsZT15ZXMnOwoKCUdNX3htbGh0dHBSZXF1ZXN0KHsKCQltZXRob2Q6J0dFVCcsCgkJdXJsOiBwcmludEhyZWYsCgkJb25sb2FkOmZ1bmN0aW9uKHJlc3BvbnNlKSB7CgkJCXZhciBoZWFkaW5ncywgaGVhZGVyLCBjb250ZW50OwoJCQl2YXIgaW5uZXJXaW5kb3dDb250ZW50Qm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lubmVyV2luZG93Q29udC0nICsgd2luZG93SUQpOwoJCQl2YXIgeG1sRG9jOwoJCQkvLyBQcmUgMC42LjQgTWV0aG9kLi4uCgkJCS8vdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsKCQkJLy8gUG9zdCAwLjYuNCBNZXRob2QuLi4gICBqb2V5IGRpc2FibGVkIGl0LCBub3Qgd29ya2luZyBpbiBGRiBHTQoJCQlpZiAoZmFsc2UgJiYgdHlwZW9mKFhQQ05hdGl2ZVdyYXBwZXIpID09ICJmdW5jdGlvbiIpIHsKCQkJCXZhciBkcCA9IG5ldyBYUENOYXRpdmVXcmFwcGVyKHdpbmRvdywgIkRPTVBhcnNlcigpIik7CgkJCQl2YXIgcGFyc2VyID0gbmV3IGRwLkRPTVBhcnNlcigpOwoJCQkJeG1sRG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhyZXNwb25zZS5yZXNwb25zZVRleHQsICJhcHBsaWNhdGlvbi94aHRtbCt4bWwiKTsKCQkJfSBlbHNlIHsKCQkJCS8vIHhtbERvYyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsgLy8gZG9lcyBub3QgaGF2ZSBnZXRFbGVtZW50c0J5VGFnTmFtZSEKCQkJCXhtbERvYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJCQkJeG1sRG9jLmlubmVySFRNTCA9IHJlc3BvbnNlLnJlc3BvbnNlVGV4dDsKCQkJCS8vIHhtbERvYyA9IHhtbERvYy5maXJzdENoaWxkOwoJCQl9CgoJCQlpZigheG1sRG9jKSB7CgkJCQlpZiAoaW5uZXJXaW5kb3dDb250ZW50Qm94KSBpbm5lcldpbmRvd0NvbnRlbnRCb3guaW5uZXJIVE1MID0gJ0Vycm9yIGxvYWRpbmcgcGFnZS4nOwoJCQl9CgoJCQloZWFkaW5ncyA9IHhtbERvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaDEnKTsKCQkJZm9yKHZhciBpPTA7IGkgPCBoZWFkaW5ncy5sZW5ndGg7IGkrKykgaWYgKCBoZWFkaW5nc1tpXS5jbGFzc05hbWUgPT0gJ2ZpcnN0SGVhZGluZycgKSB7CgkJCQloZWFkZXIgPSBoZWFkaW5nc1tpXS5maXJzdENoaWxkLmRhdGE7IAoJCQkJYnJlYWs7CgkJCX0KCgkJCWNvbnRlbnQgPSBmaW5kRWxlbWVudEJ5SWQoeG1sRG9jLCdtdy1jb250ZW50LXRleHQnKTsgLy8gQ3V0cyBvdXQgc29tZSBvZiB0aGUgdW53YW50ZWQgc3R1ZmYKCQkJY29udGVudCA9IGNvbnRlbnQgfHwgZmluZEVsZW1lbnRCeUlkKHhtbERvYywnYm9keUNvbnRlbnQnKTsKCQkJY29udGVudCA9IGNvbnRlbnQgfHwgZmluZEVsZW1lbnRCeUlkKHhtbERvYywnY29udGVudCcpOyAvLyBXaGF0IHdlIHVzZWQgcHJldmlvdXNseQoKCQkJaWYgKHJlbW92ZVRPQykgewoJCQkJdmFyIHRvYyA9IGZpbmRFbGVtZW50QnlJZCh4bWxEb2MsJ3RvYycpOwoJCQkJaWYgKHRvYykgewoJCQkJCXRvYy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRvYyk7CgkJCQl9CgkJCX0KCgkJCWlmIChpbm5lcldpbmRvd0NvbnRlbnRCb3gpIHsKCQkJCWlmIChjb250ZW50ICYmIGNvbnRlbnQuaGFzQ2hpbGROb2RlcygpKSB7CgkJCQkJd2hpbGUoaW5uZXJXaW5kb3dDb250ZW50Qm94Lmhhc0NoaWxkTm9kZXMoKSkgaW5uZXJXaW5kb3dDb250ZW50Qm94LnJlbW92ZUNoaWxkKGlubmVyV2luZG93Q29udGVudEJveC5jaGlsZE5vZGVzWzBdKTsKCgkJCQkJdmFyIGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpOwoJCQkJCWhlYWQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaGVhZGVyKSk7CgkJCQkJLy9pbm5lcldpbmRvd0NvbnRlbnRCb3guYXBwZW5kQ2hpbGQoaGVhZCk7CgoJCQkJCS8vCQkJCQlmb3IodmFyIGNoaWxkQ291bnQgPSAwOyBjaGlsZENvdW50IDw9IGNvbnRlbnQuY2hpbGROb2Rlcy5sZW5ndGg7IGNoaWxkQ291bnQrKyl7CgkJCQkJY29udGVudC5pZCA9ICcnOwoJCQkJCWlubmVyV2luZG93Q29udGVudEJveC5hcHBlbmRDaGlsZChjb250ZW50KTsKCQkJCQkvLwkJCQkJfQoJCQkJCS8vaW5uZXJXaW5kb3dDb250ZW50Qm94LmlubmVySFRNTCA9IChoZWFkZXI/JzxoMT4nICsgaGVhZGVyICsgJzwvaDE+JyA6ICcnKSArIGNvbnRlbnQuaW5uZXJIVE1MOwoJCQkJfSBlbHNlIHsKCQkJCQlpbm5lcldpbmRvd0NvbnRlbnRCb3guaW5uZXJIVE1MID0gJ0Vycm9yIGxvYWRpbmcgcGFnZS4nOwoJCQkJfQoJCQl9ZWxzZXsKCQkJCUdNX2xvZygiQ291bGRuJ3QgZmluZCBhIHdpbmRvdyAnIiArIHdpbmRvd0lEICsgIicgdG8gcG9wdWxhdGUgY29udGVudCBmb3IgJyIgKyBocmVmICsgIiciKTsKCQkJfQoJCX0gLyosCgkJb25lcnJvcjpmdW5jdGlvbihlcnIpewoJCQlHTV9sb2coIkVycm9yIGxvYWRpbmcgIitwcmludEhyZWYrIjogIitlcnIpOwoJCQljb25zb2xlLmVycm9yKGVycik7CgkJfSAqLwoJfSk7Cn0KCmZ1bmN0aW9uIGZpbmRFbGVtZW50QnlJZChub2RlLCBpZCkgewoJaWYgKG5vZGUuaWQgPT0gaWQpIHsKCQlyZXR1cm4gbm9kZTsKCX0KCWlmIChub2RlLmNoaWxkTm9kZXMpIHsKCQlmb3IgKHZhciBpPTA7aTxub2RlLmNoaWxkTm9kZXMubGVuZ3RoO2krKykgewoJCQl2YXIgZm91bmQgPSBmaW5kRWxlbWVudEJ5SWQobm9kZS5jaGlsZE5vZGVzW2ldLGlkKTsKCQkJaWYgKGZvdW5kKQoJCQkJcmV0dXJuIGZvdW5kOwoJCX0KCX0KCXJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBmaW5kUGFyZW50SW5saW5lV2luZG93KG5vZGUpIHsKCXdoaWxlIChub2RlKSB7CgkJaWYgKG5vZGUuaWQgJiYgbm9kZS5pZC5pbmRleE9mKCJpbmxpbmVXaW5kb3ctIik9PTApIHsKCQkJcmV0dXJuIG5vZGU7CgkJfQoJCW5vZGUgPSBub2RlLnBhcmVudE5vZGU7Cgl9CglyZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gY2xvc2VJbmxpbmVXaW5kb3dzKCl7Cglmb3IodmFyIGkgPSAwOyBpIDwgaW5saW5lV2luZG93Q291bnQ7IGkrKykgewoJCWNsb3NlSW5saW5lV2luZG93KCdpbmxpbmVXaW5kb3ctJyArIGkpOwoJfQoJLy8gRG8gbm90IHJlc2V0IGlubGluZVdpbmRvd0NvdW50LiAgRXZlbiB0aG91Z2ggd2UgY2xvc2VkIHRoZSB3aW5kb3dzLCB3ZSBkaWRuJ3QgY2xlYXIgdGhlIGluZGV4ZXMgb24gdGhlIGhvdmVyZWQgbGlua3MuICBBbmQgdGhlc2Ugd2lsbCBiZSByZS11c2VkIGlmIHRoZXkgYXJlIGVuY291bnRlcmVkIGFnYWluISAgSXQgaXMgc2ltcGxlciBpZiB3ZSBqdXN0IGtlZXAgaW5jcmVhc2luZyBpbmxpbmVXaW5kb3dDb3VudCBzbyBpdCBpcyB1bmlxdWUgZm9yIGV2ZXJ5IGhvdmVyZWQgbGluaywgYW5kIGNvdmVycyBhbGwgcHJldmlvdXNseSBvcGVuZWQgd2luZG93IElEcyAoaW5jbHVkaW5nIGFueSB3aGljaCBoYXZlIGJlZW4gY2xvc2VkIGFuZCByZS1vcGVuZWQgYWdhaW4gYnkgYSBzZWNvbmQgaG92ZXIpLgoJLy9pbmxpbmVXaW5kb3dDb3VudCA9IDA7Cn0KCmZ1bmN0aW9uIGNsb3NlSW5saW5lV2luZG93KGlkKXsKCXZhciBpbmxpbmVXaW5kb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CgoJaWYgKCBpbmxpbmVXaW5kb3cgKSB7CgkJaW5saW5lV2luZG93LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgkJaW5saW5lV2luZG93LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaW5saW5lV2luZG93KTsKCQlpZiAoc3R5bGVQcmV2aWV3ZWRMaW5rcyAmJiBpbmxpbmVXaW5kb3cucHJldmlld2VkTGluaykgewoJCQl2YXIgbGluayA9IGlubGluZVdpbmRvdy5wcmV2aWV3ZWRMaW5rOwoJCQlsaW5rLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcnOwoJCQlsaW5rLnN0eWxlLnBhZGRpbmcgPSAnJzsKCQkJbGluay5zdHlsZS5tYXJnaW4gPSAnJzsKCQkJbGluay5zdHlsZS5ib3JkZXIgPSAnJzsKCQkJbGluay5zdHlsZS5ib3JkZXJUb3AgPSAnJzsKCQkJbGluay5zdHlsZS5ib3JkZXJCb3R0b20gPSAnJzsKCQl9Cgl9Cgp9CgpmdW5jdGlvbiBnZXRFbGVtZW50T2Zmc2V0KGVsZW1lbnQsd2hpY2hDb29yZCkgewoJdmFyIGNvdW50ID0gMDsKCXdoaWxlIChlbGVtZW50IT1udWxsKSB7CgkJLy9HTV9sb2coIkdldHRpbmcgb2Zmc2V0Iit3aGljaENvb3JkKyIgZnJvbSAiK2VsZW1lbnQudGFnTmFtZSsiIyIrZWxlbWVudC5pZCsiOiAiK2VsZW1lbnRbJ29mZnNldCcrd2hpY2hDb29yZF0pOwoJCWNvdW50ICs9IGVsZW1lbnRbJ29mZnNldCcgKyB3aGljaENvb3JkXTsKCQkvLyBJdGVyYXRlIHVwd2FyZHMgdW50aWwgd2UgZmluZCBlbGVtZW50Lm9mZnNldFBhcmVudCwgcmVtb3ZpbmcgYW55IHNjcm9sbFRvcCBlbmNvdW50ZXJlZCBvbiB0aGUgd2F5LgoJCXZhciBzY3JvbGxQYXJlbnQgPSBlbGVtZW50OwoJCXdoaWxlIChzY3JvbGxQYXJlbnQgIT09IG51bGwpIHsKCQkJLy8gQnV0IGlnbm9yZSBzY3JvbGxUb3Agb2YgPGJvZHk+IGVsZW1lbnQgLSB3ZSB3YW50IHRvIGtlZXAgdGhhdCEKCQkJaWYgKHNjcm9sbFBhcmVudC5vZmZzZXRQYXJlbnQgIT09IG51bGwpIHsKCQkJCWNvdW50IC09IHNjcm9sbFBhcmVudFsnc2Nyb2xsJyArIHdoaWNoQ29vcmRdOwoJCQl9CgkJCXNjcm9sbFBhcmVudCA9IHNjcm9sbFBhcmVudC5wYXJlbnRFbGVtZW50OwoJCQlpZiAoc2Nyb2xsUGFyZW50ID09PSBlbGVtZW50Lm9mZnNldFBhcmVudCkgewoJCQkJYnJlYWs7CgkJCX0KCQl9CgkJZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50OwoJfQoJcmV0dXJuIGNvdW50Owp9CgovLyBCZWdpbiB0aGUgYWN0aW9uCi8vc2V0VGltZW91dChyZXdyaXRlTGlua3MsNDAwMCk7CgovLyBKb2V5J3MgaG92ZXIgZGV0ZWN0aW9uOgovLyBCVUcgVE9ETzogQ2FuIGZpcmUgd2hlbiB0aGUgdXNlciBzY3JvbGxzIHRoZSBwYWdlIGFuZCB0aGF0IGNhdXNlcyBhIGxpbmsgdG8gYXBwZWFyIHVuZGVyIHRoZSBtb3VzZS4KLy8gICAgICAgICAgIENvdWxkIGJlIGF2b2lkZWQgYnkgb25seSBjaGVja2luZyBmb3IgaG92ZXIgYWZ0ZXIgYSAnbW91c2Vtb3ZlJyBldmVudC4KdmFyIGhvdmVyVGltZXIsIGhvdmVyVGFyZ2V0OwpmdW5jdGlvbiBpc1N1aXRhYmxlTGluayhldnQpIHsKCXZhciB0YXJnZXQgPSBldnQudGFyZ2V0IHx8IGV2dC5zb3VyY2VFbGVtZW50OwoJcmV0dXJuICh0YXJnZXQgJiYgdGFyZ2V0LnRhZ05hbWU9PSJBIiAmJiB0YXJnZXQuZ2V0QXR0cmlidXRlKCJocmVmIikuaW5kZXhPZigiL3dpa2kvIik9PTApOwoJLy8gQ2hlY2s6ICcvL2RpdltAaWQ9ImNvbnRlbnQiXS8vYVtzdGFydHMtd2l0aChAaHJlZiwiL3dpa2kvIildJywKfQpmdW5jdGlvbiBvbk1vdXNlT3ZlcihldnQpIHsKCWlmIChpc1N1aXRhYmxlTGluayhldnQpICYmIGV2dC5hbHRLZXkpIHsKCQlob3ZlclRhcmdldCA9IGV2dC50YXJnZXQgfHwgZXZ0LnNvdXJjZUVsZW1lbnQ7CgkJaG92ZXJUaW1lciA9IHNldFRpbWVvdXQoaG92ZXJEZXRlY3RlZCwgMjAwMCk7Cgl9Cn0KZnVuY3Rpb24gb25Nb3VzZU91dChldnQpIHsKCWlmIChpc1N1aXRhYmxlTGluayhldnQpKSB7CgkJaWYgKGhvdmVyVGltZXIpIHsKCQkJY2xlYXJUaW1lb3V0KGhvdmVyVGltZXIpOwoJCQlob3ZlclRpbWVyID0gbnVsbDsKCQl9Cgl9Cn0KZnVuY3Rpb24gb25DbGljayhldnQpIHsKCS8vIFRoZSB1c2VyIGhhcyBjbGlja2VkIG9uIGEgbGluaywgc28gdGhlIGJyb3dzZXIgc2hvdWxkIGdvIHRoZXJlLgoJLy8gRXF1aXZhbGVudCBiZWhhdmlvdXIgdG8gbW91c2Ugb3V0IC0gY2FuY2VsIGFueSBob3ZlciBkZXRlY3Rpb24uCglvbk1vdXNlT3V0KGV2dCk7Cn0KZnVuY3Rpb24gaG92ZXJEZXRlY3RlZCgpIHsKCWlmICghYWxsb3dQcmV2aWV3c0luUHJldmlld3MgJiYgZmluZFBhcmVudElubGluZVdpbmRvdyhob3ZlclRhcmdldCkpIHsKCQlyZXR1cm47Cgl9CgkvLyBJZiB3ZSBhcmUgdXNpbmcgYSBwcmV2aW91c2x5IGhvdmVyZWQgbGluayB0aGVuIHdlIHdpbGwgcmUtdXNlIGhpcyBpbmRleC4gIElmIG5vdCwgd2Ugd2lsbCBjcmVhdGUgYSBuZXcgaW5kZXguCglpZiAoIWhvdmVyVGFyZ2V0LmdldEF0dHJpYnV0ZSgnaW5saW5ld2luZG93JykpIHsKCQlob3ZlclRhcmdldC5zZXRBdHRyaWJ1dGUoJ2lubGluZXdpbmRvdycsaW5saW5lV2luZG93Q291bnQrKyk7Cgl9Cgl2YXIgd2luZG93SUQgPSBob3ZlclRhcmdldC5nZXRBdHRyaWJ1dGUoJ2lubGluZXdpbmRvdycpOwoJLy8gY2hlY2sgdG8gc2VlIGlmIHRoZSB3aW5kb3cgaXMgb3BlbiBhbmQgaWYgc28gY2xvc2UgaXQsIG90aGVyd2lzZSBwb3AgYSBuZXcgd2luZG93Cgl2YXIgb3BlbldpbmRvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmxpbmVXaW5kb3ctJyArIHdpbmRvd0lEKTsKCWlmKG9wZW5XaW5kb3cpIHsKCQkvLyBvcGVuV2luZG93LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob3BlbldpbmRvdyk7Cgl9IGVsc2UgewoJCWlubGluZVdpbmRvdyA9IG5ld0lubGluZVdpbmRvdyhudWxsLCBob3ZlclRhcmdldC5wYXRobmFtZSwgaG92ZXJUYXJnZXQsIHdpbmRvd0lEKTsKCX0KfQpkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3ZlciIsb25Nb3VzZU92ZXIsdHJ1ZSk7CmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdXQiLG9uTW91c2VPdXQsdHJ1ZSk7CmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLG9uQ2xpY2ssdHJ1ZSk7CgovLyBFYXNpZXIgY2xvc2UsIGp1c3QgY2xpY2sgYW55d2hlcmUgb3V0c2lkZSB0aGUgaW5saW5lV2luZG93IHRvIGNsb3NlIGl0Lgpkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIixmdW5jdGlvbihldnQpewoJdmFyIG5vZGUgPSBldnQudGFyZ2V0IHx8IGV2dC5zb3VyY2VFbGVtZW50OwoJdmFyIHBhcmVudFdpbmRvdyA9IGZpbmRQYXJlbnRJbmxpbmVXaW5kb3cobm9kZSk7CglpZiAoIXBhcmVudFdpbmRvdykgewoJCWNsb3NlSW5saW5lV2luZG93cygpOwoJfQp9LHRydWUpOwo="},{"name":"Hover Preview_native","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["*"],"orig_excludes":["http://wikipedia.tld/*","http://*.wikipedia.tld/*","http://wikipedia.org/*","http://*.wikipedia.org/*","https://wikipedia.org/*","https://*.wikipedia.org/*","http://www.youtube.com/*","https://www.youtube.com/*"],"orig_includes":["*","http://*","https://*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1470004582446,"data":{}},"enabled":true,"position":6,"uuid":"3e3a94e1-8f85-41aa-9734-ce490871798c","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgIEhvdmVyIFByZXZpZXdfbmF0aXZlCi8vIEBuYW1lc3BhY2UgICAgICBIUAovLyBAZGVzY3JpcHRpb24gICAgUG9wcyB1cCBhIGZsb2F0aW5nIGRpdiB3aGVuIHlvdSBob3ZlciBvdmVyIGEgbGluaywgY29udGFpbmluZyB0aGUgdGFyZ2V0IHBhZ2UhCi8vIEB2ZXJzaW9uICAgICAgICAwLjEKLy8gQHJlcXVpcmUgICAgICAgIGZpbGU6Ly9qOlxHT09HTEVcZXh0X3NldHRpbmdzXHNjcmlwdHNcSG92ZXIgUHJldmlldy51c2VyLmpzCi8vIEBpbmNsdWRlICAgICAgICAqCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly8qCi8vIEBleGNsdWRlICAgICAgICBodHRwOi8vd2lraXBlZGlhLnRsZC8qCi8vIEBleGNsdWRlICAgICAgICBodHRwOi8vKi53aWtpcGVkaWEudGxkLyoKLy8vLyBTaW5jZSBUTEQgZG9lc24ndCB3b3JrIGluIENocm9tZToKLy8gQGV4Y2x1ZGUgICAgICAgIGh0dHA6Ly93aWtpcGVkaWEub3JnLyoKLy8gQGV4Y2x1ZGUgICAgICAgIGh0dHA6Ly8qLndpa2lwZWRpYS5vcmcvKgovLy8vIGh0dHBzOgovLyBAZXhjbHVkZSAgICAgICAgaHR0cHM6Ly93aWtpcGVkaWEub3JnLyoKLy8gQGV4Y2x1ZGUgICAgICAgIGh0dHBzOi8vKi53aWtpcGVkaWEub3JnLyoKLy8vLwovLyBAZXhjbHVkZSAgICAgICAgaHR0cDovL3d3dy55b3V0dWJlLmNvbS8qCi8vIEBleGNsdWRlICAgICAgICBodHRwczovL3d3dy55b3V0dWJlLmNvbS8qCi8vIEBjb25uZWN0ICAgICAgICAqCi8vID09L1VzZXJTY3JpcHQ9PQo="},{"name":"Hover Preview","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["*"],"orig_excludes":["http://wikipedia.tld/*","http://*.wikipedia.tld/*","http://wikipedia.org/*","http://*.wikipedia.org/*","https://wikipedia.org/*","https://*.wikipedia.org/*","http://www.youtube.com/*","https://www.youtube.com/*"],"orig_includes":["*","http://*","https://*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469647568253,"data":{}},"enabled":false,"position":7,"file_url":"https://greasyfork.org/scripts/8042-hover-preview/code/Hover%20Preview.user.js","uuid":"482f7703-dfdb-4c7f-af55-fc72f86df2dd","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgIEhvdmVyIFByZXZpZXcKLy8gQG5hbWVzcGFjZSAgICAgIEhQCi8vIEBkZXNjcmlwdGlvbiAgICBQb3BzIHVwIGEgZmxvYXRpbmcgZGl2IHdoZW4geW91IGhvdmVyIG92ZXIgYSBsaW5rLCBjb250YWluaW5nIHRoZSB0YXJnZXQgcGFnZSEKLy8gQGluY2x1ZGUgICAgICAgICoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qCi8vIEBpbmNsdWRlICAgICBodHRwczovLyoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0cDovL3dpa2lwZWRpYS50bGQvKgovLyBAZXhjbHVkZSAgICAgICBodHRwOi8vKi53aWtpcGVkaWEudGxkLyoKLy8vLyBTaW5jZSBUTEQgZG9lc24ndCB3b3JrIGluIENocm9tZToKLy8gQGV4Y2x1ZGUgICAgICAgaHR0cDovL3dpa2lwZWRpYS5vcmcvKgovLyBAZXhjbHVkZSAgICAgICBodHRwOi8vKi53aWtpcGVkaWEub3JnLyoKLy8vLyBodHRwczoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0cHM6Ly93aWtpcGVkaWEub3JnLyoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0cHM6Ly8qLndpa2lwZWRpYS5vcmcvKgovLy8vIAovLyBAZXhjbHVkZSAgICAgICBodHRwOi8vd3d3LnlvdXR1YmUuY29tLyoKLy8gQGV4Y2x1ZGUgICAgICAgaHR0cHM6Ly93d3cueW91dHViZS5jb20vKgovLyBAY29ubmVjdCAgICAgICAqCi8vIEB2ZXJzaW9uIDAuMC4xLjIwMTUwMjEzMDM1MDQ2Ci8vID09L1VzZXJTY3JpcHQ9PQoKLy8gVE9ETzoKLy8gRG9uJ3QgYWN0IGlmIHRoZSB0YXJnZXQgaXMgYSBmaWxlLXR5cGUuICBpLmUuIHdlIGRvbid0IHdhbnQgdG8gYmUgcHJvbXB0ZWQKLy8gdG8gc2F2ZSBhIHppcCBmaWxlIGp1c3QgYmVjYXVzZSB3ZSBob3ZlcmVkIG9uIGl0LgovLyBLTk9XTiBVTkZJWEFCTEUgQlVHOgovLyBEYW1uaXQgc29tZSBwYWdlcyBicmVhayBvdXQgb2YgdGhlIGlmcmFtZSEgIERvbid0IHRyeSB0byB1c2UgdGhpcyBvbgovLyBTdGFja092ZXJmbG93IGxpbmtzIQoKLy8gaWYgKHdpbmRvdy5kb2N1bWVudCAhPSBkb2N1bWVudCkgewoJLy8gcmV0dXJuOyAvLyBEb24ndCBydW4gaW4gaWZyYW1lcwovLyB9CgovLyBRdWl0ZSBuaWNlIG9uIGFwYWNoZSBmaWxlIGxpc3RpbmdzIG9mIC5qcGVncywgYnV0IGEgYml0IHNsb3cuICBJZGVhbGx5IHByZS1sb2FkIGhvdmVyYWJsZSBpbWFnZXM/Ci8vIENvdWxkIGJlIGEgYml0IGhlYXZ5LiAgSXQgZGVwZW5kcyBvbiB0aGUgcGFnZS4uLgovLyBBIGRpZmZlcmVudCBib29rbWFya2xldCB0byB0dXJuIGFsbCAibGlua3MgdG8gaW1hZ2VzIiBpbnRvICJpbWFnZXMiIHdvdWxkIGJlIG5pY2UuIDopCgp2YXIgZm9jdXNSZWFjdGlvblRpbWUgPSAxMDA7CnZhciB1bmZvY3VzUmVhY3Rpb25UaW1lID0gNTAwOwoKdmFyIGZvY3VzID0gdW5kZWZpbmVkOwp2YXIgbGFzdEZvY3VzID0gdW5kZWZpbmVkOwp2YXIgdGltZXIgPSBudWxsOwoKdmFyIG15UG9wdXA7CnZhciBteUZyYW1lOwoKdmFyIGlzT3ZlclBvcHVwID0gZmFsc2U7CgpmdW5jdGlvbiBjaGVja0ZvY3VzKCkgewoJaWYgKGZvY3VzKSB7CgkJLy8gaWYgKGZvY3VzID09IGxhc3RGb2N1cykgewoJCQkvLyBVc2VyIGhhcyBkZWZpbml0ZWx5IGJlZW4gaGVyZSBhIHdoaWxlCgkJCXNob3dQcmV2aWV3V2luZG93KGZvY3VzKTsKCQkvLyB9IGVsc2UgewoJCS8vIH0KCQkvLyBsYXN0Rm9jdXMgPSBmb2N1czsKCX0KfQoKZnVuY3Rpb24gZWVrQU1vdXNlKGV2dCkgewoJaWYgKGV2dC5jdXJyZW50VGFyZ2V0LnRhZ05hbWUgIT09ICJBIikgewoJCXJldHVybjsKCX0KCWlmICghZm9jdXMgJiYgZXZ0LmFsdEtleSkgewoJCWZvY3VzID0gZXZ0LmN1cnJlbnRUYXJnZXQ7CgkJLy8gc2V0VGltZW91dCgnY2hlY2tGb2N1cygpOycsZm9jdXNSZWFjdGlvblRpbWUpOwoJCS8vIEhhY2sgdG8gYnJpbmcgdGhlIHBvcHVwIGJhY2sgaW1tZWRpYXRlbHkgaWYgd2UndmUgZ29uZSBiYWNrIHRvIHRoZSBzYW1lIGxpbmsuCgkJaWYgKG15RnJhbWUgJiYgZm9jdXMuaHJlZiAmJiBteUZyYW1lLmhyZWYgPT0gZm9jdXMuaHJlZikgewoJCQlzaG93UHJldmlld1dpbmRvdyhmb2N1cyxldnQpOwoJCX0gZWxzZSB7CgkJCWlmICh0aW1lcikgewoJCQkJY2xlYXJUaW1lb3V0KHRpbWVyKTsKCQkJfQoJCQl0aW1lciA9IHNldFRpbWVvdXQoY2hlY2tGb2N1cyxmb2N1c1JlYWN0aW9uVGltZSk7CgkJfQoJfSBlbHNlIHsKCQl3aW5kb3cuc3RhdHVzID0gIkFscmVhZHkgZm9jdXNlZCBvbiBhIGxpbmsgd3RmISI7Cgl9Cn0KCmZ1bmN0aW9uIHBoZXdNb3VzZUdvbmUoZXZ0KSB7CglpZiAoZXZ0LmN1cnJlbnRUYXJnZXQudGFnTmFtZSAhPT0gIkEiKSB7CgkJcmV0dXJuOwoJfQoJZm9jdXMgPSB1bmRlZmluZWQ7CglpZiAodGltZXIpIHsKCQljbGVhclRpbWVvdXQodGltZXIpOwoJfQoJLy8gVEVTVElORzogRG9uJ3QgaGlkZSB0aGUgcG9wdXAgaWYgbW91c2UgaXMgY3VycmVudGx5IG92ZXIgdGhlIHBvcHVwIQoJdGltZXIgPSBzZXRUaW1lb3V0KGNsZWFyUG9wdXAsdW5mb2N1c1JlYWN0aW9uVGltZSk7Cn0KCmZ1bmN0aW9uIGNsZWFyUG9wdXAoZSkgewoJaWYgKGlzT3ZlclBvcHVwIHx8IGZvY3VzKQoJCXJldHVybjsKCWlmIChteVBvcHVwKSB7CgkJLy8gbXlQb3B1cC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG15UG9wdXApOwoJCS8vIG15UG9wdXAgPSB1bmRlZmluZWQ7IC8vIGV3dyBjYWNoZSBpdCEKCQlteVBvcHVwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Cgl9Cn0KCi8vIERPTkU6IElmIHRoZSB1c2VyIGNsaWNrcyBhIGxpbmssIHRoaXMgaXNuJ3QgcmVhbGx5IGEgaG92ZXIsIHNvIHdlIHNob3VsZCBub3QKLy8gYWN0aXZhdGUgYW5kIGp1c3QgbGV0IHRoZSB1c2VyJ3MgY2xpY2sgYmUgcHJvY2Vzc2VkIQpmdW5jdGlvbiBhQ2xpY2soZXZ0KSB7Cglmb2N1cyA9IHVuZGVmaW5lZDsKfQoKZnVuY3Rpb24gY3JlYXRlUG9wdXAoKSB7CgkvLyBDcmVhdGUgZnJhbWUKCW15UG9wdXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdESVYnKTsKCS8qKiBTZWVtcyBzdHlsZSBkb2VzIG5vdCB3b3JrIGZvciBLb25xdWVyb3IgdGhpcyB3YXkuICoqLwoJbXlQb3B1cC5pbm5lckhUTUwgPQoJCSI8U1RZTEUgdHlwZT0ndGV4dC9jc3MnPiBpZnJhbWUucHJldmlldyB7IGNvbG9yOiAjZmY4ODIyOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOyBtYXJnaW46IDBweDsgcGFkZGluZzogMnB4OyBib3JkZXI6IDJweCBzb2xpZCByZWQ7IHRleHQtYWxpZ246IGNlbnRlcjsgfSA8L1NUWUxFPiIKCQkrCgkJIjxJRlJBTUUgY2xhc3M9J3ByZXZpZXcnICBtZXRob2Q9J3Bvc3QnIHdpZHRoPSciKyh3aW5kb3cuaW5uZXJXaWR0aCowLjgpKyInIGhlaWdodD0nIisod2luZG93LmlubmVySGVpZ2h0KjAuOSkrIicgc3JjPSdhYm91dDpibGFuayc+PC9JRlJBTUU+IjsKCW15UG9wdXAuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdmVyIiwgZnVuY3Rpb24oZXZ0KSB7IGlzT3ZlclBvcHVwPXRydWU7IH0sIGZhbHNlKTsKCW15UG9wdXAuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdXQiLCBmdW5jdGlvbihldnQpIHsgaXNPdmVyUG9wdXA9ZmFsc2U7IHNldFRpbWVvdXQoY2xlYXJQb3B1cCx1bmZvY3VzUmVhY3Rpb25UaW1lKTsgfSwgZmFsc2UpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24oZXZ0KSB7IGlmKGV2dC5rZXlDb2RlID09IDI3KXsgaXNPdmVyUG9wdXA9ZmFsc2U7IHNldFRpbWVvdXQoY2xlYXJQb3B1cCx1bmZvY3VzUmVhY3Rpb25UaW1lKTsgfSB9LCBmYWxzZSk7CgoJZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKG15UG9wdXApOwoJLyoKCW15UG9wdXAuc3R5bGUuYm9yZGVyID0gIjRweCBzb2xpZCB3aGl0ZSI7CglteVBvcHVwLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICIjMDA0NDAwIjsKCW15UG9wdXAuc3R5bGUubWFyZ2luID0gIjRweCI7CglteVBvcHVwLnN0eWxlLnBhZGRpbmcgPSAiNHB4IjsKCSovCgkvL215UG9wdXAuc3R5bGUud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCAqIDAuOSArICJweCI7CgkvL215UG9wdXAuc3R5bGUuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0ICogMC45ICsgInB4IjsKCW15UG9wdXAuc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiOwoJbXlQb3B1cC5zdHlsZS5yaWdodCA9ICIxMnB4IjsKCW15UG9wdXAuc3R5bGUuYm90dG9tID0gIjEycHgiOwoJbXlQb3B1cC5zdHlsZS56SW5kZXggPSAiMTAwMDAiOwoJbXlGcmFtZSA9IG15UG9wdXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0lGUkFNRScpWzBdOwp9CgpmdW5jdGlvbiBzaG93UHJldmlld1dpbmRvdyhsaW5rLGV2dCkgewoJaWYgKCFteUZyYW1lKSB7CgkJY3JlYXRlUG9wdXAoKTsKCX0KCW15UG9wdXAuc3R5bGUuZGlzcGxheSA9ICcnOwoJaWYgKCFteUZyYW1lLnNyYyB8fCBteUZyYW1lLnNyYyAhPSBsaW5rLmhyZWYpCgkJbXlGcmFtZS5zcmMgPSBsaW5rLmhyZWY7Cn0KCmZ1bmN0aW9uIGluaXQoKSB7Cglmb3IgKHZhciBpPTA7aTxkb2N1bWVudC5saW5rcy5sZW5ndGg7aSsrKSB7CgkJdmFyIGxpbmsgPSBkb2N1bWVudC5saW5rc1tpXTsKCQkvKiogQXBwYXJlbnRseSBkZXByZWNhdGVkLiAqKi8KCQkvLyBsaW5rLm9ubW91c2VvdmVyID0gZWVrQU1vdXNlOwoJCS8vIGxpbmsub25tb3VzZW91dCA9IHBoZXdNb3VzZUdvbmU7CgkJLyoqIFRoZSBuZXcgd2F5OiAqKi8KCQlsaW5rLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3ZlciIsIGVla0FNb3VzZSwgZmFsc2UpOwoJCWxpbmsuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdXQiLCBwaGV3TW91c2VHb25lLCBmYWxzZSk7CgkJbGluay5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFDbGljaywgZmFsc2UpOwoJCS8vIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgZnVuY3Rpb24oZXZ0KSB7IGxvY2F0ZShldnQpOyB9LCB0cnVlKTsKCX0KfQoKaW5pdCgpOwoKLy8gd2luZG93LmRvY3VtZW50LmNoZWNrRm9jdXMgPSBjaGVja0ZvY3VzOwoK"},{"name":"Various things","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://www.google.*/search?*","http://www.google.*/search?*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1470020067790,"data":{}},"enabled":true,"position":8,"uuid":"6e7527ea-04fd-4498-9b61-4406ba2703bb","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBWYXJpb3VzIHRoaW5ncwovLyBAbmFtZXNwYWNlICAgIGh0dHA6Ly90YW1wZXJtb25rZXkubmV0LwovLyBAdmVyc2lvbiAgICAgIDAuMQovLyBAZGVzY3JpcHRpb24gIHRyeSB0byB0YWtlIG92ZXIgdGhlIHdvcmxkIQovLyBAYXV0aG9yICAgICAgIFlvdQovLyBAcmVxdWlyZSAgICAgIGh0dHA6Ly9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9qcXVlcnkvMS9qcXVlcnkubWluLmpzCi8vLy8gQG1hdGNoICAgICAgICBodHRwczovL3d3dy5nb29nbGUuKi8qICAgICAgICAgLy8gZG9uJ3Qgd29yawovLyBAaW5jbHVkZSAgICAgICAgaHR0cHM6Ly93d3cuZ29vZ2xlLiovc2VhcmNoPyoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cuZ29vZ2xlLiovc2VhcmNoPyoKLy8vLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3JhbmRvbXdvcmQuY29tLwovLy8vIEBpbmNsdWRlICAgICAgICBodHRwczovL3JhbmRvbXdvcmQuY29tLwovLy8vIEBpbmNsdWRlICAgICAgICBodHRwczovL3d3dy5nb29nbGUucnUvc2VhcmNoP3E9dHJhbnNsYXRlK3RvK2VuZ2xpc2gqCi8vLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cuZ29vZ2xlLnJ1L3NlYXJjaD9xPXRyYW5zbGF0ZSt0bytlbmdsaXNoKgovLy8vIEBpbmNsdWRlICAgICAgICBodHRwczovL3d3dy5nb29nbGUucnUvc2VhcmNoP3E9dHJhbnNsYXRlK3RvK3J1c3NpYW4qCi8vLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cuZ29vZ2xlLnJ1L3NlYXJjaD9xPXRyYW5zbGF0ZSt0bytydXNzaWFuKgovLyBAcnVuLWF0ICAgICAgIGRvY3VtZW50LWVuZAovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09CgovKgpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICB2YXIgYmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hkdGInKTsKaWYoYmFyKXsKICAgIGJhci5zdHlsZS5wb3NpdGlvbiA9ICJmaXhlZCI7Cn0KICAgIH0sIDEwMDApOwoqLwoKZnVuY3Rpb24gbWFpbigpIHsKICAgICAvL2FsZXJ0KCdIZWxsbyBXb3JsZCEnKTsKICAgIC8vY2hyb21lLmV4dGVuc2lvbi5nZXRCYWNrZ3JvdW5kUGFnZSgpLmNvbnNvbGUubG9nKCdmb28nKTsKICAgICQoJy5fTEouX3F4Zy54cGRhcnIuX1dHaC52a19hcmMnKS5jbGljaygpOwp9CnNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgICAkKCdkaXYuX0xKLl9xeGcueHBkYXJyLl9XR2gudmtfYXJjJykuY2xpY2soKTsKICAgICAgIC8vICQoJyNyYW5kb21fd29yZCcpLmRibGNsaWNrKCk7Ci8vYWxlcnQoICJZb3UgaGF2ZSAiICsgJCgiI3JhbmRvbV93b3JkIikuc2l6ZSgpICsgIiBlbGVtZW50cyIgKTsKICAgIH0sIDMwMDApOwogICAgLy8kKCcuX0xKJykuY2xpY2soKTsKLy9hbGVydCggIllvdSBoYXZlICIgKyAkKCJkaXYuX0xKLl9xeGcueHBkYXJyLl9XR2gudmtfYXJjIikuc2l6ZSgpICsgIiBlbGVtZW50cyIgKTsKLy92YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7Ci8vc2NyaXB0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcoJysgbWFpbiArJykoKTsnKSk7Ci8vKGRvY3VtZW50LmJvZHkgfHwgZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmFwcGVuZENoaWxkKHNjcmlwdCk7"},{"name":"Simple YouTube MP3 Button","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["*://www.youtube.com/watch?v=*"],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1467663945114,"data":{}},"enabled":false,"position":9,"file_url":"https://greasyfork.org/scripts/20015-simple-youtube-mp3-button/code/Simple%20YouTube%20MP3%20Button.user.js","uuid":"68a84093-97cc-4aa0-85ac-5a0c0df15cf3","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBTaW1wbGUgWW91VHViZSBNUDMgQnV0dG9uCi8vIEBuYW1lc3BhY2UgICAgaHR0cHM6Ly93d3cueW91dHViZWlubXAzLmNvbQovLyBAdmVyc2lvbiAgICAgIDEuMC4yLjIKLy8gQGRlc2NyaXB0aW9uICBBZGRzIGEgZG93bmxvYWQgYnV0dG9uIHRvIFlvdVR1YmUgdmlkZW9zIHdoaWNoIGFsbG93cyB5b3UgdG8gZG93bmxvYWQgdGhlIE1QMyBvZiB0aGUgdmlkZW8gd2l0aG91dCBoYXZpbmcgdG8gbGVhdmUgdGhlIHBhZ2UKLy8gQGF1dGhvciAgICAgICBBcmFyaQovLyBAbWF0Y2ggICAgICAgICo6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0qCi8vIEBydW4tYXQgICAgICAgZG9jdW1lbnQtZW5kCi8vID09L1VzZXJTY3JpcHQ9PQpzdGFydCgpOwogICAgICAgICAgCmZ1bmN0aW9uIHN0YXJ0KCkgewogIHZhciBwYWdlY29udGFpbmVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlLWNvbnRhaW5lcicpOwogIGlmICghcGFnZWNvbnRhaW5lcikgcmV0dXJuOwogIGlmICgvXmh0dHBzPzpcL1wvd3d3XC55b3V0dWJlLmNvbVwvd2F0Y2hcPy8udGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZikpIHJ1bigpOyAgICAgICAKICB2YXIgaXNBamF4PS9jbGFzc1tcd1xzIictPV0rc3BmXC1saW5rLy50ZXN0KHBhZ2Vjb250YWluZXIuaW5uZXJIVE1MKTsKICB2YXIgbG9nb2NvbnRhaW5lcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nby1jb250YWluZXInKTsgIAogIGlmIChsb2dvY29udGFpbmVyICYmICFpc0FqYXgpIHsgLy8gZml4IGZvciBibG9ja2VkIHZpZGVvcwogICAgaXNBamF4PSgnICcrbG9nb2NvbnRhaW5lci5jbGFzc05hbWUrJyAnKS5pbmRleE9mKCcgc3BmLWxpbmsgJyk+PTA7CiAgfQogIHZhciBjb250ZW50PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50Jyk7CiAgaWYgKGlzQWpheCAmJiBjb250ZW50KSB7IC8vIEFqYXggVUkKICAgICAgdmFyIG1vPXdpbmRvdy5NdXRhdGlvbk9ic2VydmVyfHx3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjsKICAgICAgaWYodHlwZW9mIG1vIT09J3VuZGVmaW5lZCcpIHsKICAgICAgICB2YXIgb2JzZXJ2ZXI9bmV3IG1vKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24obXV0YXRpb24pIHsKICAgICAgICAgICAgICBpZihtdXRhdGlvbi5hZGRlZE5vZGVzIT09bnVsbCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpPG11dGF0aW9uLmFkZGVkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24uYWRkZWROb2Rlc1tpXS5pZD09J3dhdGNoNy1jb250YWluZXInIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0aW9uLmFkZGVkTm9kZXNbaV0uaWQ9PSd3YXRjaDctbWFpbi1jb250YWluZXInKSB7IC8vIG9sZCB2YWx1ZTogbW92aWVfcGxheWVyCiAgICAgICAgICAgICAgICAgICAgICBydW4oKTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGNvbnRlbnQsIHtjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9KTsgLy8gb2xkIHZhbHVlOiBwYWdlY29udGFpbmVyCiAgICAgIH0gZWxzZSB7IC8vIE11dGF0aW9uT2JzZXJ2ZXIgZmFsbGJhY2sgZm9yIG9sZCBicm93c2VycwogICAgICAgIHBhZ2Vjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgb25Ob2RlSW5zZXJ0ZWQsIGZhbHNlKTsKICAgICAgfQogIH0gCn0KCmZ1bmN0aW9uIG9uTm9kZUluc2VydGVkKGUpIHsgCiAgICBpZiAoZSAmJiBlLnRhcmdldCAmJiAoZS50YXJnZXQuaWQ9PSd3YXRjaDctY29udGFpbmVyJyB8fCAKICAgICAgICBlLnRhcmdldC5pZD09J3dhdGNoNy1tYWluLWNvbnRhaW5lcicpKSB7IC8vIG9sZCB2YWx1ZTogbW92aWVfcGxheWVyCiAgICAgIHJ1bigpOwogIH0KfQoKZnVuY3Rpb24gZmluYWxCdXR0b24oKXsKCQoJdmFyIGJ1dHRvbklmcmFtZURvd25sb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaWZyYW1lIik7CglidXR0b25JZnJhbWVEb3dubG9hZC5zcmMgPSAnLy93d3cueW91dHViZWlubXAzLmNvbS93aWRnZXQvYnV0dG9uLz9jb2xvcj1iYTE3MTcmYW1wO3ZpZGVvPScgKyB3aW5kb3cubG9jYXRpb24uaHJlZjsKCWJ1dHRvbklmcmFtZURvd25sb2FkLnNjcm9sbGluZyA9ICJubyI7CglidXR0b25JZnJhbWVEb3dubG9hZC5pZCA9ICJidXR0b25JZnJhbWUiOwoJYnV0dG9uSWZyYW1lRG93bmxvYWQuc3R5bGUgPSAid2lkdGg6MTAwJTtoZWlnaHQ6NjBweDtwYWRkaW5nLXRvcDoyMHB4O3BhZGRpbmctYm90dG9tOjIwcHg7IjsKCQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWhlYWRlciIpLmFwcGVuZENoaWxkKGJ1dHRvbklmcmFtZURvd25sb2FkKTsKCQp9CgpmdW5jdGlvbiBydW4oKXsKCQoJaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJ1dHRvbklmcmFtZSIpID09PSBudWxsICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN1YnN0cmluZygwLCAyNSkuaW5kZXhPZigieW91dHViZS5jb20iKSA+IC0xICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoIndhdGNoP3Y9IikgPiAtMSl7CgkJCgkJdmFyIHBhcmVudEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJCQoJCXBhcmVudEJ1dHRvbi5jbGFzc05hbWUgPSAieXQtdWl4LWJ1dHRvbiB5dC11aXgtYnV0dG9uLWRlZmF1bHQiOwoJCXBhcmVudEJ1dHRvbi5pZCA9ICJwYXJlbnRCdXR0b24iOwoJCXBhcmVudEJ1dHRvbi5zdHlsZSA9ICJoZWlnaHQ6IDIzcHg7bWFyZ2luLWxlZnQ6IDI4cHg7cGFkZGluZy1ib3R0b206MXB4OyI7CgkJCgkJcGFyZW50QnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CgkJCQoJCQl0aGlzLnN0eWxlID0gImRpc3BsYXk6bm9uZSI7CgkJCWZpbmFsQnV0dG9uKCk7CgkJCQoJCX07CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoNy11c2VyLWhlYWRlciIpLmFwcGVuZENoaWxkKHBhcmVudEJ1dHRvbik7CgkJCgkJdmFyIGNoaWxkQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwoJCQoJCWNoaWxkQnV0dG9uLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJEb3dubG9hZCBNUDMiKSk7CgkJCgkJY2hpbGRCdXR0b24uY2xhc3NOYW1lID0gInl0LXVpeC1idXR0b24tY29udGVudCI7CgkJY2hpbGRCdXR0b24uc3R5bGUgPSAibGluZS1oZWlnaHQ6IDI1cHg7Zm9udC1zaXplOiAxMnB4OyI7CgkJCgkJcGFyZW50QnV0dG9uLmFwcGVuZENoaWxkKGNoaWxkQnV0dG9uKTsKCQkKCX0KCQp9"},{"name":"Youtube MP3 Download Button","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["http*://www.youtube.com/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469599457286,"data":{}},"enabled":false,"position":10,"file_url":"https://greasyfork.org/scripts/4992-youtube-mp3-download-button/code/Youtube%20MP3%20Download%20Button.user.js","uuid":"0a87a5ba-b557-405e-b13b-1263b239134d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgWW91dHViZSBNUDMgRG93bmxvYWQgQnV0dG9uCi8vIEBuYW1lc3BhY2UgIGh0dHA6Ly9uaW5qYXN1bml0ZS5jb20KLy8gQHZlcnNpb24gICAgMS4xCi8vIEBkZXNjcmlwdGlvbiAgQWRkcyBhIE1QMyBEb3dubG9hZCBidXR0b24gbmV4dCB0byB0aGUgc3Vic2NyaWJlIGJ1dHRvbiwgdGhhbmtzIHRvIHlvdXR1YmVpbm1wMyBmb3IgdGhlaXIgc2ltcGxlIGRvd25sb2FkIHNlcnZpY2UgKGh0dHA6Ly95b3V0dWJlaW5tcDMuY29tL2FwaS8pLiBCYXNlZCBvZmYgbWFnbnVzJ3MgeW91dHViZTJtcDMgY29kZS4gSnVzdCB1c2VkIHNvbWV0aGluZyBkaWZmZXJlbnQgYXMgaXQgd29udCBvcGVuIGFub3RoZXIgdGFiLgovLyBAbWF0Y2ggICAgICAgICBodHRwKjovL3d3dy55b3V0dWJlLmNvbS8qCi8vIEByZXF1aXJlICAgICAgIGh0dHA6Ly9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9qcXVlcnkvMS9qcXVlcnkubWluLmpzCi8vIEBjb3B5cmlnaHQgIDIwMTQrLCBTb3Vsd2VhdmVyCi8vID09L1VzZXJTY3JpcHQ9PQoKICAgICAgICB2YXIgbGlua1BhdGggPSdodHRwOi8veW91dHViZWlubXAzLmNvbS9mZXRjaC8/dmlkZW89JytlbmNvZGVVUklDb21wb25lbnQoZG9jdW1lbnQuVVJMKSsiJmhxPTEiOwogICAgICAgICQoICAnPGEgaWQ9InlvdXR1YmUybXAzIiBjbGFzcz0ieXQtdWl4LWJ1dHRvbiB5dC11aXgtYnV0dG9uLWRlZmF1bHQiIGhyZWY9IicrbGlua1BhdGgrJyIgc3R5bGU9Im1hcmdpbi1sZWZ0OiA4cHg7IGhlaWdodDogMjZweDsgcGFkZGluZzogMCAyMnB4OyAvKiBiYWNrZ3JvdW5kLWNvbG9yOiAjZTYyMTE3OyAqLyI+PGltZyBzcmM9Imh0dHA6Ly95b3V0dWJlaW5tcDMuY29tL2ljb24vZG93bmxvYWQucG5nIiBzdHlsZT0idmVydGljYWwtYWxpZ246bWlkZGxlO2NvbG9yOiB3aGl0ZTsiPiA8c3BhbiBjbGFzcz0ieXQtdWl4LWJ1dHRvbi1jb250ZW50IiBzdHlsZT0ibGluZS1oZWlnaHQ6IDI1cHg7IC8qIGZvbnQtdmFyaWFudDogc21hbGwtY2FwczsgKi8gZm9udC1zaXplOiAxMnB4OyAvKiBjb2xvcjogI2ZlZmVmZTsgKi8iPk1QMyBEb3dubG9hZDwvc3Bhbj48L2E+JykuaW5zZXJ0QWZ0ZXIoICIjd2F0Y2g3LXN1YnNjcmlwdGlvbi1jb250YWluZXIiICk7ICAg"},{"name":"jQuery","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http://*","https://*"],"orig_matches":["http://*/*","https://*/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469589489313,"data":{}},"enabled":false,"position":11,"uuid":"207610f9-2c3d-443a-92d6-0f84df2169df","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBqUXVlcnkKLy8gQG5hbWVzcGFjZSAgICBodHRwOi8vdGFtcGVybW9ua2V5Lm5ldC8KLy8gQHZlcnNpb24gICAgICAwLjEKLy8gQGRlc2NyaXB0aW9uICB0cnkgdG8gdGFrZSBvdmVyIHRoZSB3b3JsZCEKLy8gQGF1dGhvciAgICAgICBZb3UKLy8gQG1hdGNoICAgICAgICBodHRwOi8vKi8qCi8vIEBtYXRjaCAgICAgICAgaHR0cHM6Ly8qLyoKLy8gQGdyYW50ICAgICAgICBub25lCi8vIEByZXF1aXJlICAgICAgaHR0cDovL2FqYXguZ29vZ2xlYXBpcy5jb20vYWpheC9saWJzL2pxdWVyeS8xL2pxdWVyeS5taW4uanMKLy8gQGluY2x1ZGUgICAgICBodHRwOi8vKgovLyBAaW5jbHVkZSAgICAgIGh0dHBzOi8vKgovLyA9PS9Vc2VyU2NyaXB0PT0KCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5sb2coIkknbSBydW5uaW5nIHdpdGggalF1ZXJ5ISIpOwp9KTs="},{"name":"Code with jQuery","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://developer.chrome.com/*","http://developer.chrome.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1470551550101,"data":{}},"enabled":false,"position":12,"uuid":"184e6c35-3b70-4898-ae85-483be645e422","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBDb2RlIHdpdGggalF1ZXJ5Ci8vIEBuYW1lc3BhY2UgICAgaHR0cDovL3RhbXBlcm1vbmtleS5uZXQvCi8vIEB2ZXJzaW9uICAgICAgMC4xCi8vIEBkZXNjcmlwdGlvbiAgdHJ5IHRvIHRha2Ugb3ZlciB0aGUgd29ybGQhCi8vIEBhdXRob3IgICAgICAgWW91Ci8vIEBncmFudCAgICAgICAgbm9uZQovLyBAcmVxdWlyZSAgICAgIGh0dHA6Ly9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9qcXVlcnkvMS9qcXVlcnkubWluLmpzCi8vIEBpbmNsdWRlICAgICAgaHR0cHM6Ly9kZXZlbG9wZXIuY2hyb21lLmNvbS8qCi8vIEBpbmNsdWRlICAgICAgaHR0cDovL2RldmVsb3Blci5jaHJvbWUuY29tLyoKLy8gPT0vVXNlclNjcmlwdD09CgokKCduYXYuaW5saW5lLXNpdGUtdG9jLm5vLXBlcm1hbGluaycpLmNzcygiZGlzcGxheSIsIm5vbmUiKTsKJCgnZGl2W2l0ZW1wcm9wPSJhcnRpY2xlQm9keSJdJykuY3NzKCJtYXJnaW4tbGVmdCIsICIwcHgiKTsKCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogICAgY29uc29sZS5sb2coIkknbSBydW5uaW5nIHdpdGggalF1ZXJ5ISIpOwp9KTs="},{"name":"Include jQuery 2.0.3","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1470897122981,"data":{}},"enabled":false,"position":13,"uuid":"441f7983-ae81-4de5-a1f4-50a9457d1aad","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIEluY2x1ZGUgalF1ZXJ5IDIuMC4zCi8vIEBuYW1lc3BhY2UgICBpbmNsdWRlSnF1ZXJ5Ci8vIEBpbmNsdWRlICAgICAqCi8vIEB2ZXJzaW9uICAgICAwLjEKLy8gQGdyYW50ICAgICAgIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQKLy8gPT0vVXNlclNjcmlwdD09CgpHTV9yZWdpc3Rlck1lbnVDb21tYW5kKCfQn9C+0LTQutC70Y7Rh9C40YLRjCBqUXVlcnkgMi4wLjMnLCBpbmNsdWRlSnF1ZXJ5LCAnaicpOwoKZnVuY3Rpb24gaW5jbHVkZUpxdWVyeSgpIHsKICAgIGluY2x1ZGVTY3JpcHRPblBhZ2UoJy8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzIuMC4zL2pxdWVyeS5taW4uanMnKTsKfQoKZnVuY3Rpb24gaW5jbHVkZVNjcmlwdE9uUGFnZSh1cmwpIHsKICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXSwKICAgICAgICBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKSwKICAgICAgICBwcm90b2NvbCA9IHVuc2FmZVdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbDsKCiAgICBzY3JpcHQuc3JjPSBwcm90b2NvbCArIHVybDsKICAgIGhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKfQ=="},{"name":"depositfiles_downloader","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["/^https?:\\/\\/(www\\.)?(dfiles|depositfiles)\\.(ru|com)\\/files\\/.*$/"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469597478380,"data":{}},"enabled":false,"position":14,"file_url":"https://openuserjs.org/install/Black_Sun/depositfiles_downloader.user.js","uuid":"bc690782-b429-493c-b8ad-0471ad796cb5","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGRlcG9zaXRmaWxlc193YWl0ZXIKLy8gQG5hbWUgICAgICAgICAgIGRlcG9zaXRmaWxlc19kb3dubG9hZGVyCi8vIEBuYW1lc3BhY2UgICAgICBodHRwczovL29wZW51c2VyanMub3JnL3NjcmlwdHMvQmxhY2tfU3VuL2RlcG9zaXRmaWxlc19kb3dubG9hZGVyCi8vIEB2ZXJzaW9uICAgICAgICA1LjAuMQovLyBAaGlzdG9yeSAgICAgICAgNS4wLjEg0JjQt9C80LXQvdGR0L0gaW5jbHVkZSwg0YDQsNCx0L7RgtCwINCz0LDRgNCw0L3RgtC40YDRg9C10YLRgdGPINGC0L7Qu9GM0LrQviDQvdCwIGdyZWFzZW1vbmV5Ci8vIEBoaXN0b3J5ICAgICAgICA1LjAg0JTQvtCx0LDQstC70LXQvdC+INCw0LLRgtC+0L7QttC40LTQsNC90LjQtSDQv9GA0Lgg0LvQuNC80LjRgtC1INC4INC40YHQv9GA0LDQstC70LXQvdCwINC+0YjQuNCx0LrQsCDRgdGB0YvQu9C+0Log0YEgbGltaXQ9MSDQvdCwINC60L7QvdGG0LUgKGlzc3VlIGJ5IHJheW1hbjg5KS4KLy8gQGhpc3RvcnkgICAgICAgIDQuNyDQnNC+0LTQuNGE0LjRhtC40YDQvtCy0LDQuyDQutC+0LQg0L/QvtC0IEdyZWFzZW1vbmtleSwg0YIu0LouIFNjcmlwdGlzaCDQsNCy0YLQvtGAINC/0L7RhdC+0LTRgyDQt9Cw0LHRgNC+0YHQuNC7LgovLyBAaGlzdG9yeSAgICAgICAgNC42INCh0L7QstGB0LXQvCDRg9Cx0YDQsNC7IGpRdWVyeSDQuNC3INGB0LrRgNC40L/RgtCwINC4INC00L7QsdCw0LLQuNC7IEdNX3NhZmVIVE1MUGFyc2VyLCDRgdC/0LDRgdC40LHQviBLT0xBTklDSCDQt9CwINC90LDQstC+0LTQutGDCi8vIEBoaXN0b3J5ICAgICAgICA0LjUuMC4xIFVwZGF0ZWQ6INCd0L7QstCw0Y8g0YHRgdGL0LvQutCwINC00LvRjyDQvtCx0L3QvtCy0LvQtdC90LjRjyDRgdC60YDQuNC/0YLQsAovLyBAaGlzdG9yeSAgICAgICAgNC41LjAg0J3QsNGB0YLQsNC70L4g0LLRgNC10LzRjyDQstCy0LXRgdGC0Lgg0L3QvtCy0YPRjiDRgdC40YHRgtC10LzRgyDQstC10YDRgdC40Lkg0Lgg0LTQsNGC0Ywg0LPRgNCw0L3RgiDRhNGD0L3QutGG0LjRj9C8Ci8vIEBoaXN0b3J5ICAgICAgICA0LjQg0JTQvtCx0LDQstC70LXQvdCwINC/0L7QtNC00LXRgNC20LrQsCBkZmlsZXMucnUKLy8gQGhpc3RvcnkgICAgICAgIDQuMyDQmCDRgdGA0LDQt9GDIDQuMy4g0JTQvtCx0LDQstC70LXQvdC+OtCY0L3RhNC+0YDQvNCw0YbQuNGPINC+INC/0YDQvtGB0YzQsdC1INC/0L7QtNC+0LbQtNCw0YLRjCwg0Lgg0LvQuNC80LjRgtC1INC/0L7QtNC60LvRjtGH0LXQvdC40LkuCi8vIEBoaXN0b3J5ICAgICAgICA0LjIg0JTQvtCx0LDQstC70LXQvdC+OiDQkNCy0YLQvtC+0L/RgNC10LTQtdC70LXQvdC40LUg0YHRgtGA0LDQvdGLINGB0YHRi9C70LrQuAovLyBAaGlzdG9yeSAgICAgICAgNC4xINCd0LXQsdC+0LvRjNGI0L7QuSDRhNC40LrRgQovLyBAaGlzdG9yeSAgICAgICAgNC4wIFN1cnByaXNlLgovLyBAaGlzdG9yeSAgICAgICAgMy4wINCf0LXRgNC10LTQtdC70LDQvSDRgdC60YDQuNC/0YIsINGC0LXQv9C10YDRjCDQvdCw0LbQuNC80LDQtdGCLCDQtNC+0LHQsNCy0LvQtdC90LAg0LjQvdGE0LAg0LIg0YLQsNCx0LUg0L4g0YHQtdC60YPQvdC00LDRhSwg0LDQstGC0L7RgdC60LDRh9C40LLQsNC90LjQtSDQvdC1INGA0LDQsdC+0YLQsNC10YIsINGCLtC6LiDRgtCw0Lwg0LrQsNC/0YLRh9CwINC4LCDQtNCwLCDQtdGRINC90YPQttC90L4g0LLQstC+0LTQuNGC0YwgOigKLy8gQGhpc3RvcnkgICAgICAgIDIuOCDQpNC40LrRgSDQv9C+0LQg0L3QvtCy0YvQuSDQstC40LQg0LrQvtC00LAg0Lgg0LTQvtCx0LDQstC70LXQvdCwINC40L3RhNCwINC+INC70LjQvNC40YLQtS4KLy8gQGhpc3RvcnkgICAgICAgIDIuNyDQntCx0L3QvtCy0LvQtdC90YsgaW5jbHVkZQovLyBAaGlzdG9yeSAgICAgICAgMi42INCe0LHQvdC+0LLQuNC7INC60L7QtCwg0LTQvtCx0LDQstC40Lsg0L3QsNGB0YLRgNC+0LnQutC4INC4INC40YUg0YPQtNCw0LvQtdC90LjRjyDQtNC70Y8gRmlyZWZveChncmVhc2Vtb25rZXkg0LjQu9C4IHNjcmlwdGlzaCkg0LggQ2hyb21lKFRlbXBlcm1vbmtleSksINC00LvRjyDQntC/0LXRgNGLINC90LDRgdGC0YDQvtC50LrQuCDQvtGB0YLQsNC70LjRgdGMINCyINC60L7QtNC1INGB0LrRgNC40L/RgtCwINCyINC90LDRh9Cw0LvQtS4KLy8gQGhpc3RvcnkgICAgICAgIDIuNSDQndC+0LLRi9C5INGB0YLQuNC70Ywg0LIg0LrQvtC90YbQtSDQv9C+0LvRg9GH0LXQvdC40Y8g0YHRgdGL0LvQutC4LCDRgdCw0LzQsCDQutC90L7Qv9C60LAg0L/Qu9GO0YEg0YHRgdGL0LvQutCwINC4INC/0L7Qu9C1INGBINGB0YHRi9C70LrQvtC5Ci8vIEBoaXN0b3J5ICAgICAgICAyLjQg0JTQvtCx0LDQstC70LXQvdC+INC+0L/RgNC10LTQtdC70LXQvdC40LUg0L/RgNC10LLRi9GI0LXQvdC40Y8g0LvQuNC80LjRgtCwINGB0LrQsNGH0LjQstCw0L3QuNGPLiDQlNC70Y8g0LHRgNCw0YPQt9C10YDQsCBPcGVyYSwg0L/RgNC+0LPRgNCw0LzQvNGLIHVzZXJqc21hbmFnZXIg0LTQvtCx0LDQstC70LXQvdCwINGB0YHRi9C70LrQsCDQvtCx0L3QvtCy0LvQtdC90LjRjyDRgdC60YDQuNC/0YLQsC4KLy8gQGhpc3RvcnkgICAgICAgIDIuMyDQlNC+0LHQsNCy0LvQtdC90LAg0L7Qv9GG0LjRjyDQuNC90LTQuNC60LDRhtC40Lgg0YDQsNCx0L7RgtGLINGB0LrRgNC40L/RgtCwLCDQutC+0LPQtNCwINCy0Ysg0LTRg9C80LDQtdGC0LUg0YfRgtC+INGB0LrRgNC40L/RgiDQvdC1INGA0LDQsdC+0YLQsNC10YIuCi8vIEBoaXN0b3J5ICAgICAgICAyLjIg0KPQsdGA0LDQvdC+INC/0YDQtdC00YPQv9GA0LXQttC00LXQvdC40LUg0L4g0L3QsNGH0LDQu9C1INC30LDQv9GA0L7RgdCwLCDRgtCw0Log0LbQtSDRg9C80LXQvdGM0YjQtdC90L4g0LLRgNC10LzRjyDQvtC20LjQtNCw0L3QuNGPINCyINC60L7QvdGG0LUsINC10YHQu9C4INC90LUg0LHRg9C00LXRgiDRgNCw0LHQvtGC0LDRgtGMINCw0LLRgtC+0YHQutCw0YfQuNCy0LDQvdC40LUg0L3QsNC/0LjRiNC40YLQtSDQvNC90LUg0L7QsSDRjdGC0L7QvC4KLy8gQGhpc3RvcnkgICAgICAgIDIuMSDQmNGB0L/RgNCw0LLQu9C10L3RiyDQvdC10LrQvtGC0L7RgNGL0LUg0L/QtdGA0LXQvNC10L3QvdGL0LUuCi8vIEBoaXN0b3J5ICAgICAgICAyLjAg0JTQvtCx0LDQstC70LXQvdCwINC+0L/RhtC40Y8g0LDQstGC0L7QvNCw0YLQuNGH0LXRgdC60L7Qs9C+INGB0LrQsNGH0LjQstCw0L3QuNGPINC/0L7RgdC70LUg0L/QvtGP0LLQu9C10L3QuNGPINC60L3QvtC/0LrQuCwg0LTQvtCx0LDQstC70LXQvdC+INC+0L/QuNGB0LDQvdC40LUsINC40LfQvNC10L3RkdC9IG5hbWVzcGFjZSDRgdC60YDQuNC/0YLQsC4KLy8gQGhpc3RvcnkgICAgICAgIDEuMCDQoNC10LvQuNC3LgovLyBAYXV0aG9yICAgICAgICAgQmxhY2tfU3VuCi8vIEBkZXNjcmlwdGlvbiAgICDQkNCy0YLQvtC80LDRgtC40YfQtdGB0LrQuCDQuNC70Lgg0LLRgNGD0YfQvdGD0Y4g0L/QvtC30LLQvtC70Y/QtdGCINGB0LrQsNGH0LjQstCw0YLRjCDRhNCw0LnQu9GLINCx0LXQtyDQvtC20LjQtNCw0L3QuNGPLgovLyBAaW5jbHVkZSAgICAgICAgL15odHRwcz86XC9cLyh3d3dcLik/KGRmaWxlc3xkZXBvc2l0ZmlsZXMpXC4ocnV8Y29tKVwvZmlsZXNcLy4qJC8KLy8gQHVwZGF0ZVVSTCBodHRwczovL29wZW51c2VyanMub3JnL2luc3RhbGwvQmxhY2tfU3VuL2RlcG9zaXRmaWxlc19kb3dubG9hZGVyLnVzZXIuanMKLy8gQERvd25sb2FkIGh0dHBzOi8vb3BlbnVzZXJqcy5vcmcvaW5zdGFsbC9CbGFja19TdW4vZGVwb3NpdGZpbGVzX2Rvd25sb2FkZXIudXNlci5qcwovLyBAZ3JhbnQgR01fcmVnaXN0ZXJNZW51Q29tbWFuZAovLyBAZ3JhbnQgR01fZGVsZXRlVmFsdWUKLy8gQGdyYW50IEdNX3NldFZhbHVlCi8vIEBncmFudCBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgR01feG1saHR0cFJlcXVlc3QKLy8gPT0vVXNlclNjcmlwdD09CnZhciB1bGk7CmlmKHRoaXMub3BlcmEpewoJdmFyIGF1dG9kb3dubG9hZD10cnVlOyAKfQplbHNlCnsKCUdNX3JlZ2lzdGVyTWVudUNvbW1hbmQoItCj0LTQsNC70LjRgtGMINC90LDRgdGC0YDQvtC50LrRgyDQsNCy0YLQvtGB0LrQsNGH0LjQstCw0L3QuNGPIiwgZnVuY3Rpb24oKSB7R01fZGVsZXRlVmFsdWUoImF1dG8iKX0pOwoJaWYoR01fZ2V0VmFsdWUoJ2F1dG8nKT09PXVuZGVmaW5lZCkKCXsKCQlpZihjb25maXJtKCfQn9C10YDQstC40YfQvdCw0Y8g0L3QsNGB0YLRgNC+0LnQutCwINGB0LrRgNC40L/RgtCwXG4g0LTQu9GPINGB0LHRgNC+0YHQsCDQvdCw0YHRgtGA0L7QudC60Lgg0LXRgdGC0Ywg0L/Rg9C90LrRgiDQvNC10L3RjiDQsiDQutC+0LzQsNC90LTQsNGFINGB0LrRgNC40L/RgtCwXG5cbtCS0Ysg0YXQvtGC0LjRgtC1INC40YHQv9C+0LvRjNC30L7QstCw0YLRjCDQsNCy0YLQvtGB0LrQsNGH0LjQstCw0L3QuNC1PycpKQoJCXsKCQkJdmFyIGF1dG9kb3dubG9hZD10cnVlO0dNX3NldFZhbHVlKCdhdXRvJyx0cnVlKTt9ZWxzZXt2YXIgYXV0b2Rvd25sb2FkPWZhbHNlO0dNX3NldFZhbHVlKCdhdXRvJyxmYWxzZSk7CgkJfQoJfQoJZWxzZSBpZihHTV9nZXRWYWx1ZSgnYXV0bycpIT09dW5kZWZpbmVkKXt2YXIgYXV0b2Rvd25sb2FkPUdNX2dldFZhbHVlKCdhdXRvJyl9Cn0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsZnVuY3Rpb24oKXsKCXZhciBnYXRlID0gbmV3IEZvcm1EYXRhKCk7Cgl2YXIgc3M9IiI7CglnYXRlLmFwcGVuZCgiZ2F0ZXdheV9yZXN1bHQiLCAxKTsKCXZhciBpbmZvPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImRpdi52aW9sYXRpb24iKTsKCXZhciBkaXZ3YWl0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBkaXZ3YWl0LmlubmVySFRNTCA9ICfQn9C+0LbQsNC70YPQudGB0YLQsCDQv9C+0LTQvtC20LTQuNGC0LUsINGB0LrQsNGH0LjQstCw0L3QuNC1INGB0LrQvtGA0L4g0L3QsNGH0L3RkdGC0YHRjy4nOwoJZGl2d2FpdC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywnZm9udC1zaXplOjE4cHg7Y29sb3I6Z3JlZW4nKTsKICAgIGRpdndhaXQuaWQgPSAnd2FpdCc7CiAgICBpbmZvLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGRpdndhaXQsIGluZm8pOwoJdmFyIGxsPWxvY2F0aW9uLmhyZWYuc3BsaXQoJy8nKVszXTsKCWlmKGxsLmluZGV4T2YoJ2ZpbGVzJykhPS0xKXt1bGk9J2h0dHA6Ly9kZmlsZXMucnUvJytsbCsnLycrbG9jYXRpb24uaHJlZi5zcGxpdCgnLycpWzRdfWVsc2V7dWxpPWxvY2F0aW9uLmhyZWZ9CglHTV94bWxodHRwUmVxdWVzdCgKCXsKCQltZXRob2Q6IlBPU1QiLAoJCWRhdGE6Z2F0ZSwKCQl1cmw6dWxpLAoJCWhlYWRlcnM6ewoJCQkiVXNlci1BZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzOyBVOyBXaW5kb3dzIE5UIDUuMTsgcnU7IHJ2OjEuOC4xLjIwKSBEZXBvc2l0RmlsZXMvRmlsZU1hbmFnZXIgMC45LjkuMjA2IiwgICAgICAKCQkJIkFjY2VwdCI6IiovKiIKCQl9LAoJCW9ubG9hZDpmdW5jdGlvbihyZXNwb25zZSkgCgkJewoJCQlpZiAocmVzcG9uc2UucmVhZHlTdGF0ZSA9PSA0KSAKCQkJewoJCQkJdmFyIGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcocmVzcG9uc2UucmVzcG9uc2VUZXh0LCAidGV4dC9odG1sIik7CgkJCQl2YXIgYXI9ZG9jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoInJlcGVhdCIpWzBdOwoJCQkJdmFyIGlwPWRvYy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJpcCIpWzBdOwoJCQkJdmFyIGw9Jyc7CgkJCQlpZiAoYXIgIT09IHVuZGVmaW5lZCkgbD1hci5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpWzBdLmdldEF0dHJpYnV0ZSgnaHJlZicpOwogICAgICAgICAgICAgICAgaWYgKGlwICE9PSB1bmRlZmluZWQpCgkJCQl7CgkJCQkJY2xlYXJJbnRlcnZhbChzcykKCQkJCQl2YXIgc3Q9aXAucXVlcnlTZWxlY3RvcignZGl2LmlwYmcnKS5xdWVyeVNlbGVjdG9yKCdzdHJvbmcnKS5pbm5lckhUTUwucmVwbGFjZSgvKC4qKShcc1swLTldezEsfVxzKSjQvNC40L3Rg9GCKSguKikvaWcsIiQyIik7CgkJCQkJc3Q9c3QqMQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YWl0IikuaW5uZXJIVE1MID0gIjxpIHN0eWxlPSdjb2xvcjpibHVlJz7QkNCy0YLQvtC30LDQv9GA0L7RgSDQv9C+0LLRgtC+0YDQuNGC0YHRjyDRh9C10YDQtdC3ICIrc3QrIiDQvNC40L3Rg9GCKNGDKSwg0L3QtSDQvtCx0L3QvtCy0LvRj9C50YLQtSDRgdGC0YDQsNC90LjRhtGDPC9pPjxicj4iK2lwLmlubmVySFRNTDsKCQkJCQlzZXRJbnRlcnZhbChmdW5jdGlvbigpewoJCQkJCQlpZihzdD4wKXN0PXN0LTEKCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhaXQiKS5pbm5lckhUTUwgPSAiPGkgc3R5bGU9J2NvbG9yOmJsdWUnPtCQ0LLRgtC+0LfQsNC/0YDQvtGBINC/0L7QstGC0L7RgNC40YLRgdGPINGH0LXRgNC10LcgIitzdCsiINC80LjQvdGD0YIo0YMpLCDQvdC1INC+0LHQvdC+0LLQu9GP0LnRgtC1INGB0YLRgNCw0L3QuNGG0YM8L2k+PGJyPiIraXAuaW5uZXJIVE1MOwoJCQkJCX0sMSo2MCoxMDAwKQoJCQkJCXZhciB0aW1lcnI9c3QqMSo2MCoxMDAwOwoJCQkJICAgIHNzPXNldEludGVydmFsKGZ1bmN0aW9uKCl7ZHJldHJ5KCl9LHRpbWVycikKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQljbGVhckludGVydmFsKHNzKQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YWl0IikuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9ImJhY2tncm91bmQ6bGlnaHRibHVlO3RleHQtYWxpZ246Y2VudGVyO2hlaWdodDozMHB4OyI+PGEgaHJlZj0iJytsKyciIHN0eWxlPSJmb250LXNpemU6IDIwcHg7Ij5Eb3dubG9hZDwvYT48L2Rpdj4nOwoJCQkJCWlmKGF1dG9kb3dubG9hZClsb2NhdGlvbi5ocmVmPWw7CgkJCQl9CgkJCX0gCgkJfQoJfSk7CgpmdW5jdGlvbiBkcmV0cnkoKXsKCUdNX3htbGh0dHBSZXF1ZXN0KAoJewoJCW1ldGhvZDoiUE9TVCIsCgkJZGF0YTpnYXRlLAoJCXVybDp1bGksCgkJaGVhZGVyczp7CgkJCSJVc2VyLUFnZW50IjoiTW96aWxsYS81LjAgKFdpbmRvd3M7IFU7IFdpbmRvd3MgTlQgNS4xOyBydTsgcnY6MS44LjEuMjApIERlcG9zaXRGaWxlcy9GaWxlTWFuYWdlciAwLjkuOS4yMDYiLCAgICAgIAoJCQkiQWNjZXB0IjoiKi8qIgoJCX0sCgkJb25sb2FkOmZ1bmN0aW9uKHJlc3BvbnNlKSAKCQl7CgkJCWlmIChyZXNwb25zZS5yZWFkeVN0YXRlID09IDQpIAoJCQl7CgkJCQl2YXIgZG9jID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhyZXNwb25zZS5yZXNwb25zZVRleHQsICJ0ZXh0L2h0bWwiKTsKCQkJCXZhciBhcj1kb2MuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgicmVwZWF0IilbMF07CgkJCQl2YXIgaXA9ZG9jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImlwIilbMF07CgkJCQl2YXIgbD0nJzsKCQkJCWlmIChhciAhPT0gdW5kZWZpbmVkKSBsPWFyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJylbMF0uZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgICAgICAgICAgICBpZiAoaXAgIT09IHVuZGVmaW5lZCkKCQkJCXsKCQkJCQljbGVhckludGVydmFsKHNzKQoJCQkJCXZhciBzdD1pcC5xdWVyeVNlbGVjdG9yKCdkaXYuaXBiZycpLnF1ZXJ5U2VsZWN0b3IoJ3N0cm9uZycpLmlubmVySFRNTC5yZXBsYWNlKC8oLiopKFxzWzAtOV17MSx9XHMpKNC80LjQvdGD0YIpKC4qKS9pZywiJDIiKTsKCQkJCQlzdD1zdCoxCgkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhaXQiKS5pbm5lckhUTUwgPSAiPGkgc3R5bGU9J2NvbG9yOmJsdWUnPtCe0YjQuNCx0LrQsCwg0LXRgdC70Lgg0LLRiyDQstC40LTQuNGC0LUg0Y3RgtC+INGB0L7QvtCx0YnQtdC90LjQtSwg0LfQvdCw0YfQuNGCINGH0YLQvi3RgtC+INC90LUg0YLQsNC6Ljxicj4g0JDQstGC0L7Qt9Cw0L/RgNC+0YEg0L/QvtCy0YLQvtGA0LjRgtGB0Y8g0YfQtdGA0LXQtyAiK3N0KyIg0LzQuNC90YPRgijRgyksINC90LUg0L7QsdC90L7QstC70Y/QudGC0LUg0YHRgtGA0LDQvdC40YbRgzwvaT48YnI+IitpcC5pbm5lckhUTUw7CgkJCQkJc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsKCQkJCQkJaWYoc3Q+MClzdD1zdC0xCgkJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YWl0IikuaW5uZXJIVE1MID0gIjxpIHN0eWxlPSdjb2xvcjpibHVlJz7QntGI0LjQsdC60LAsINC10YHQu9C4INCy0Ysg0LLQuNC00LjRgtC1INGN0YLQviDRgdC+0L7QsdGJ0LXQvdC40LUsINC30L3QsNGH0LjRgiDRh9GC0L4t0YLQviDQvdC1INGC0LDQui48YnI+INCQ0LLRgtC+0LfQsNC/0YDQvtGBINC/0L7QstGC0L7RgNC40YLRgdGPINGH0LXRgNC10LcgIitzdCsiINC80LjQvdGD0YIo0YMpLCDQvdC1INC+0LHQvdC+0LLQu9GP0LnRgtC1INGB0YLRgNCw0L3QuNGG0YM8L2k+PGJyPiIraXAuaW5uZXJIVE1MOwoJCQkJCX0sMSo2MCoxMDAwKQoJCQkJCXZhciB0aW1lcnI9c3QqMSo2MCoxMDAwOwoJCQkJICAgIHNzPXNldEludGVydmFsKGZ1bmN0aW9uKCl7ZHJldHJ5KCl9LHRpbWVycikKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQljbGVhckludGVydmFsKHNzKQoJCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YWl0IikuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9ImJhY2tncm91bmQ6bGlnaHRibHVlO3RleHQtYWxpZ246Y2VudGVyO2hlaWdodDozMHB4OyI+PGEgaHJlZj0iJytsKyciIHN0eWxlPSJmb250LXNpemU6IDIwcHg7Ij5Eb3dubG9hZDwvYT48L2Rpdj4nOwoJCQkJCWlmKGF1dG9kb3dubG9hZClsb2NhdGlvbi5ocmVmPWw7CgkJCQl9CgkJCX0gCgkJfQp9KTsKfQp9LGZhbHNlKTs="},{"name":"Mouseover Popup Image Viewer","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["*"],"orig_excludes":[],"orig_includes":["http*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":["*"],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"cfg":"s{\"version\":5,\"delay\":500,\"start\":\"auto\",\"zoom\":\"context\",\"center\":false,\"cursor\":false,\"imgtab\":false,\"close\":true,\"preload\":false,\"css\":\"\",\"scales\":[],\"hosts\":\"\",\"scale\":1.5,\"xhr\":true}"},"ts":1469598730159},"enabled":false,"position":15,"file_url":"https://greasyfork.org/scripts/404-mouseover-popup-image-viewer/code/Mouseover%20Popup%20Image%20Viewer.user.js","uuid":"57c5bbb9-fe78-4286-9e00-189b82e38ec6","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIE1vdXNlb3ZlciBQb3B1cCBJbWFnZSBWaWV3ZXIKLy8gQG5hbWVzcGFjZSAgIGh0dHA6Ly93OXAuY28vdXNlcnNjcmlwdHMvCi8vIEBkZXNjcmlwdGlvbiBTaG93cyBpbWFnZXMgYW5kIHZpZGVvcyBiZWhpbmQgbGlua3MgYW5kIHRodW1ibmFpbHMuCi8vIEB2ZXJzaW9uICAgICAyMDE2LjYuMTkuMgovLyBAYXV0aG9yICAgICAga3VlaGxzY2hyYW5rCi8vIEBob21lcGFnZSAgICBodHRwOi8vdzlwLmNvL3VzZXJzY3JpcHRzL21waXYvCi8vIEBpY29uICAgICAgICBodHRwczovL3c5cC5jby91c2Vyc2NyaXB0cy9tcGl2L2ljb24ucG5nCi8vIEBpbmNsdWRlICAgICBodHRwKgovLyBAZ3JhbnQgICAgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgICAgIEdNX3NldFZhbHVlCi8vIEBncmFudCAgICAgICBHTV94bWxodHRwUmVxdWVzdAovLyBAZ3JhbnQgICAgICAgR01fb3BlbkluVGFiCi8vIEBncmFudCAgICAgICBHTV9yZWdpc3Rlck1lbnVDb21tYW5kCi8vIEBncmFudCAgICAgICBHTV9zZXRDbGlwYm9hcmQKLy8gQGNvbm5lY3Qtc3JjICoKLy8gPT0vVXNlclNjcmlwdD09CgondXNlIHN0cmljdCc7Cgp2YXIgZCA9IGRvY3VtZW50LCB3biA9IHdpbmRvdywgaG9zdG5hbWUgPSBsb2NhdGlvbi5ob3N0bmFtZSwgdHJ1c3RlZCA9IFsnZ3JlYXN5Zm9yay5vcmcnLCAndzlwLmNvJ10sIGltZ3RhYiA9IGQuaW1hZ2VzLmxlbmd0aCA9PSAxICYmIGQuaW1hZ2VzWzBdLnBhcmVudE5vZGUgPT0gZC5ib2R5ICYmICFkLmxpbmtzLmxlbmd0aCwgY2ZnID0gbG9hZENmZygpLCBlbmFibGVkID0gY2ZnLmltZ3RhYiB8fCAhaW1ndGFiLCBfID0ge30sIGhvc3RzOwoKZnVuY3Rpb24gbG9hZENmZygpIHsKCXJldHVybiBmaXhDZmcoR01fZ2V0VmFsdWUoJ2NmZycpLCB0cnVlKTsKfQoKZnVuY3Rpb24gZml4Q2ZnKHMsIHNhdmUpIHsKCXZhciBjZmcsIGRlZiA9IHsKCQl2ZXJzaW9uOiA1LAoJCWRlbGF5OiA1MDAsCgkJc3RhcnQ6ICdhdXRvJywKCQl6b29tOiAnY29udGV4dCcsCgkJY2VudGVyOiBmYWxzZSwKCQljdXJzb3I6IGZhbHNlLAoJCWltZ3RhYjogZmFsc2UsCgkJY2xvc2U6IHRydWUsCgkJcHJlbG9hZDogZmFsc2UsCgkJY3NzOiAnJywKCQlzY2FsZXM6IFtdLAoJCWhvc3RzOiAnJywKCQlzY2FsZTogMS41LAoJCXhocjogdHJ1ZQoJfTsKCXRyeSB7IGNmZyA9IEpTT04ucGFyc2Uocyk7IH0gY2F0Y2goZXgpIHt9CglpZih0eXBlb2YgY2ZnICE9ICdvYmplY3QnIHx8ICFjZmcpIGNmZyA9IHt9OyBlbHNlIGlmKGNmZy52ZXJzaW9uID09IGRlZi52ZXJzaW9uKSByZXR1cm4gY2ZnOwoJZm9yKHZhciBkcCBpbiBkZWYpIHsKCQlpZihkZWYuaGFzT3duUHJvcGVydHkoZHApICYmIHR5cGVvZiBjZmdbZHBdICE9IHR5cGVvZiBkZWZbZHBdKSBjZmdbZHBdID0gZGVmW2RwXTsKCX0KCWlmKGNmZy52ZXJzaW9uID09IDMgJiYgY2ZnLnNjYWxlc1swXSA9PT0gMCkgY2ZnLnNjYWxlc1swXSA9ICcwISc7Cglmb3IodmFyIGNwIGluIGNmZykgewoJCWlmKCFkZWYuaGFzT3duUHJvcGVydHkoY3ApKSBkZWxldGUgY2ZnW2NwXTsKCX0KCWNmZy52ZXJzaW9uID0gZGVmLnZlcnNpb247CglpZihzYXZlKSBzYXZlQ2ZnKGNmZyk7CglyZXR1cm4gY2ZnOwp9CgpmdW5jdGlvbiBzYXZlQ2ZnKG5ld0NmZykgewoJR01fc2V0VmFsdWUoJ2NmZycsIEpTT04uc3RyaW5naWZ5KGNmZyA9IG5ld0NmZykpOwp9CgpmdW5jdGlvbiBsb2FkSG9zdHMoKSB7Cgl2YXIgaG9zdHMgPSBbCgkJe2Q6J3N0YXJ0cGFnZScsIHI6L1xib2l1PSguKykvLCBzOickMScsIGZvbGxvdzp0cnVlfSwKCQl7cjovW1wvXD89XShodHRwcz8uKz8pKCZ8JCkvLCBzOickMScsIGZvbGxvdzp0cnVlfSwKCQl7ZDonNGNoYW4ub3JnJywgZTonLmlzX2NhdGFsb2cgLnRocmVhZCBhW2hyZWYqPSIvdGhyZWFkLyJdLCAuY2F0YWxvZy10aHJlYWQgYVtocmVmKj0iL3RocmVhZC8iXScsIHE6Jy5vcCAuZmlsZVRleHQgYScsIGNzczonI3Bvc3QtcHJldmlld3tkaXNwbGF5Om5vbmV9J30sCgkJe3I6LzUwMHB4XC5jb21cL3Bob3RvXC8vLCBxOidtZXRhW3Byb3BlcnR5PSJvZzppbWFnZSJdJ30sCgkJe3I6L2F0dGFjaG1lbnRcLnBocC4rYXR0YWNobWVudGlkL30sCgkJe3I6L2FibG9hZFwuZGVcL2ltYWdlLywgcTonI2ltYWdlJ30sCgkJe2Q6J2FtYXpvbi4nLCByOi8oaHR0cHM/OlwvXC9bXC5hLXotXSthbWF6b25cLmNvbVwvaW1hZ2VzXC9JXC8uKz8pXC4vLCBzOmZ1bmN0aW9uKG0pIHsgdmFyIHVoID0gZC5nZXRFbGVtZW50QnlJZCgndW5pdmVyc2FsLWhvdmVyJyk7IGlmKHVoKSByZXR1cm4gJyc7IHJldHVybiBtWzFdICsgJy5qcGcnOyB9LCBjc3M6JyN6b29tV2luZG93e2Rpc3BsYXk6bm9uZSFpbXBvcnRhbnQ7fSd9LAoJCXtyOi9kZXBpY1wubWVcL1swLTlhLXpdezgsfS8sIHE6JyNwaWMnfSwKCQl7cjovZGV2aWFudGFydFwuY29tXC9hcnRcLy8sIHM6ZnVuY3Rpb24obSwgbm9kZSkgeyByZXR1cm4gL1xiKGZpbG18bGl0KS8udGVzdChub2RlLmNsYXNzTmFtZSkgfHwgL2luIEZsYXNoLy50ZXN0KG5vZGUudGl0bGUpID8gJycgOiBtLmlucHV0OyB9LCBxOlsnI2Rvd25sb2FkLWJ1dHRvbltocmVmKj0iLmpwZyJdLCAjZG93bmxvYWQtYnV0dG9uW2hyZWYqPSIuZ2lmIl0sICNkb3dubG9hZC1idXR0b25baHJlZio9Ii5wbmciXSwgI2dtaS1SZXNWaWV3U2l6ZXJfZnVsbGltZycsICdpbWcuZGV2LWNvbnRlbnQtZnVsbCddfSwKCQl7cjovZGlzcXVzXC5jb20vLCBzOicnfSwKCQl7cjovZHJvcGJveFwuY29tXC9zaD9cLy4rXC4oanBlP2d8Z2lmfHBuZykvaSwgcTonI2Rvd25sb2FkX2J1dHRvbl9saW5rJ30sCgkJe3I6L2ViYXlcLlteXC9dK1wvaXRtXC8vLCBxOmZ1bmN0aW9uKHRleHQpIHsgcmV0dXJuIHRleHQubWF0Y2goL2h0dHBzPzpcL1wvaVwuZWJheWltZ1wuY29tXC9bXlwuXStcLkpQRy9pKVswXS5yZXBsYWNlKC9+fjYwX1xkKy8sICd+fjYwXzU3Jyk7IH19LAoJCXtyOi9pLmViYXlpbWcuY29tLywgczpmdW5jdGlvbihtICxub2RlKSB7IGlmKHFzKCcuem9vbV90cmlnZ2VyX21hc2snLCBub2RlLnBhcmVudE5vZGUpKSByZXR1cm4gJyc7IHJldHVybiBtLmlucHV0LnJlcGxhY2UoL35+NjBfXGQrLywgJ35+NjBfNTcnKTsgfX0sCgkJe3I6L2Zhc3RwaWNcLnJ1XC92aWV3XC8vLCBxOicjcGljQ29udGFpbmVyIGltZyd9LAoJCXtkOidmYWNlYm9vay5jb20nLCBlOidhW2hyZWYqPSJyZWY9aG92ZXJjYXJkIl0nLCBzOmZ1bmN0aW9uKG0sIG5vZGUpIHsgcmV0dXJuICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vcGhvdG8ucGhwP2ZiaWQ9JyArIC9cL1swLTldK18oWzAtOV0rKV8vLmV4ZWMocXMoJ2ltZycsIG5vZGUpLnNyYylbMV07IH0sIGZvbGxvdzp0cnVlfSwKCQl7ZDonZmFjZWJvb2suY29tJywgcjovKGZiY2RufGZiZXh0ZXJuYWwpLio/KGFwcF9mdWxsX3Byb3h5fHNhZmVfaW1hZ2UpLis/KHNyY3x1cmwpPShodHRwLis/KVsmXCInXS8sIHM6ZnVuY3Rpb24obSwgbm9kZSkgeyByZXR1cm4gY29udGFpbnMobm9kZS5wYXJlbnROb2RlLmNsYXNzTmFtZSwgJ3ZpZGVvJykgJiYgY29udGFpbnMobVs0XSwgJ2ZiY2RuJykgPyAnJyA6IGRlY29kZVVSSUNvbXBvbmVudChtWzRdKTsgfSwgaHRtbDp0cnVlLCBmb2xsb3c6dHJ1ZX0sCgkJe3I6L2ZhY2Vib29rXC5jb21cLyhwaG90b1wucGhwfFteXC9dK1wvcGhvdG9zXC8pLywgczpmdW5jdGlvbihtLCBub2RlKSB7IGlmKG5vZGUuaWQgPT0gJ2ZiUGhvdG9JbWFnZScpIHJldHVybiBmYWxzZTsgaWYoL2dyYWRpZW50XC5wbmckLy50ZXN0KG0uaW5wdXQpKSByZXR1cm4gJyc7IHJldHVybiBtLmlucHV0LnJlcGxhY2UoJ3d3dy5mYWNlYm9vay5jb20nLCAnbWJhc2ljLmZhY2Vib29rLmNvbScpOyB9LCBxOidkaXYgKyBzcGFuID4gYTpmaXJzdC1jaGlsZCcsIHJlY3Q6JyNmYlByb2ZpbGVDb3Zlcid9LAoJCXtyOi9mYmNkbi4rP1swLTldK18oWzAtOV0rKV9bMC05XStfW2Etel1cLihqcGd8cG5nKS8sIHM6ZnVuY3Rpb24obSkgeyB0cnkgeyBpZigvW1wuXl1mYWNlYm9va1wuY29tJC8udGVzdChob3N0bmFtZSkpIHJldHVybiB1bnNhZmVXaW5kb3cuUGhvdG9Tbm93bGlmdC5nZXRJbnN0YW5jZSgpLnN0cmVhbS5jYWNoZS5pbWFnZVttWzFdXS51cmw7IH0gY2F0Y2goZXgpIHt9IHJldHVybiBmYWxzZTsgfSwgbWFudWFsOnRydWV9LAoJCXtyOi8oaHR0cHM/OlwvXC8oZmJjZG4tW1x3XC5cLV0rYWthbWFpaGR8W1x3XC5cLV0rP2ZiY2RuKVwubmV0XC9bXHdcL1wuXC1dKz8pX1thLXpdXC4oanBnfHBuZykoXD9bMC05YS16QS1aMC05PV8mXSspPy8sIHM6ZnVuY3Rpb24obSwgbm9kZSkgeyBpZihub2RlLmlkID09ICdmYlBob3RvSW1hZ2UnKSB7IHZhciBhID0gcXMoJ2EuZmJQaG90b3NQaG90b0FjdGlvbnNJdGVtW2hyZWYkPSJkbD0xIl0nLCBkLmJvZHkpOyBpZihhKSB7IHJldHVybiBjb250YWlucyhhLmhyZWYsIG0uaW5wdXQubWF0Y2goL1swLTldK19bMC05XStfWzAtOV0rLylbMF0pID8gJycgOiBhLmhyZWY7IH0gfSBpZihtWzRdKSByZXR1cm4gZmFsc2U7IGlmKGNvbnRhaW5zKG5vZGUucGFyZW50Tm9kZS5vdXRlckhUTUwsICcvaG92ZXJjYXJkLycpKSByZXR1cm4gJyc7IHZhciBncCA9IG5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlOyBpZihjb250YWlucyhub2RlLm91dGVySFRNTCwgJ3Byb2ZpbGUnKSAmJiBjb250YWlucyhncC5ocmVmLCAnL3Bob3RvJykpIHJldHVybiBmYWxzZTsgcmV0dXJuIG1bMV0ucmVwbGFjZSgvXC9bc3BjXVtcZFwueF0rL2csICcnKS5yZXBsYWNlKCcvdi8nLCAnLycpICsgJ19uLicgKyBtWzNdOyB9LCByZWN0OicucGhvdG9XcmFwJ30sCgkJe3I6L2ZpcmVwaWNcLm9yZ1wvXD92PS8sIHE6Jy53ZWxsIGltZ1tzcmMqPSJmaXJlcGljLm9yZyJdJ30sCgkJe3I6L2ZsaWNrclwuY29tXC9waG90b3NcLyhbMC05XStATlswLTldK3xbYS16MC05X1wtXSspXC8oWzAtOV0rKS8sIHM6ZnVuY3Rpb24obSkgeyByZXR1cm4gbS5pbnB1dC5pbmRleE9mKCcvc2l6ZXMvJykgPCAwID8gJ2h0dHBzOi8vd3d3LmZsaWNrci5jb20vcGhvdG9zLycgKyBtWzFdICsgJy8nICsgbVsyXSArICcvc2l6ZXMvc3EvJyA6IGZhbHNlOyB9LCBxOmZ1bmN0aW9uKHRleHQsIGRvYykgeyB2YXIgbGlua3MgPSBxc2EoJy5zaXplcy1saXN0IGEnLCBkb2MpOyByZXR1cm4gJ2h0dHBzOi8vd3d3LmZsaWNrci5jb20nICsgbGlua3NbbGlua3MubGVuZ3RoLTFdLmdldEF0dHJpYnV0ZSgnaHJlZicpOyB9LCBmb2xsb3c6dHJ1ZX0sCgkJe3I6L2ZsaWNrclwuY29tXC9waG90b3NcLy4rXC9zaXplc1wvLywgcTonI2FsbHNpemVzLXBob3RvID4gaW1nJ30sCgkJe3I6L2dhbGxlcnkobm92YXxzZW5zZSlcLnNlXC9zaXRlXC92XC8vLCBxOidhW2hyZWYqPSIvdXBsb2FkLyJdJ30sCgkJe3I6L2dpZmJpblwuY29tXC8uK1wuZ2lmJC8sIHhocjp0cnVlfSwKCQl7cjovKGdmeWNhdFwuY29tXC8pKGlmcmFtZVwvKT8oW2Etel0rKS9pLCBzOidodHRwczovLyQxJDMnLCBxOlsnbWV0YVtjb250ZW50JD0iLndlYm0iXScsICcjd2VibXNvdXJjZScsICdzb3VyY2Vbc3JjJD0iLndlYm0iXSddfSwKCQl7cjovZ29vZ2xldXNlcmNvbnRlbnRcLmNvbVwvKHByb3h5fGdhZGdldHNcL3Byb3h5Lis/KGh0dHAuKz8pJikvLCBzOmZ1bmN0aW9uKG0pIHsgcmV0dXJuIG1bMl0gPyBkZWNvZGVVUklDb21wb25lbnQobVsyXSkgOiBtLmlucHV0LnJlcGxhY2UoL3dcZCstaFxkKygkfC1wKS8sICd3MC1oMCcpOyB9fSwKCQl7cjovKGdvb2dsZXVzZXJjb250ZW50fGdncGh0KVwuY29tXC8vLCBzOmZ1bmN0aW9uKG0sIG5vZGUpIHsgaWYoY29udGFpbnMobS5pbnB1dCwgJ3dlYmNhY2hlLicpIHx8IG5vZGUub3V0ZXJIVE1MLm1hdGNoKC9mYXZpY29uc1w/fFxiKE9sIFJmIEVwfE9sIFpiIGFnfFpiIEhQYnxaYiBHdGJ8UmYgUGd8aG8gUFFjfFVrIHdpIGhFfGdvIHdpIFdofHdlIEQwYnxCZWEpXGIvKSB8fCBtYXRjaGVzKG5vZGUsICcuZy1ob3ZlcmNhcmQgKiwgYVtocmVmKj0icHJvZmlsZV9yZWRpcmVjdG9yIl0gPiBpbWcnKSkgcmV0dXJuICcnOyByZXR1cm4gbS5pbnB1dC5yZXBsYWNlKC9cL3NcZHsyLH0tW15cL10rfFwvd1xkKy1oXGQrLywgJy9zMCcpLnJlcGxhY2UoLz1bXlwvXSskLywgJycpOyB9fSwKCQl7cjovaGViZXJnZXItaW1hZ2VcLmZyXC9pbWFnZXMvLCBxOicjbXlpbWcnfSwKCQl7cjovaG9zdGluZ2thcnRpbm9rXC5jb21cL3Nob3ctaW1hZ2VcLnBocC4qLywgcTonLmltYWdlIGltZyd9LAoJCXtyOi9pbWFnZWFyblwuY29tXC9pbWFnZS8sIHE6JyNpbWcnLCB4aHI6dHJ1ZX0sCgkJe3I6L2ltYWdlZmFwXC5jb21cLyhpbWFnZXxwaG90bykvLCBxOmZ1bmN0aW9uKHRleHQsIGRvYykgeyByZXR1cm4gcXMoJypbaXRlbXByb3A9ImNvbnRlbnRVcmwiXScsIGRvYykudGV4dENvbnRlbnQ7IH19LAoJCXtyOi9pbWFnZWJhbVwuY29tXC9pbWFnZVwvLywgcTonaW1nW2lkXScsIHRhYmZpeDp0cnVlLCB4aHI6Y29udGFpbnMoaG9zdG5hbWUsICdwbGFuZXRzdXp5Jyl9LAoJCXtyOi9pbWFnZWJhblwuKHJ1fG5ldClcL3Nob3d8aW1nbm92YVwuY29tfGN3ZWItcGl4XC5jb218KGltYWdlYnVua3xpbWFnZXdhc3RlKVwuY29tXC8oaW1hZ2V8cGljdHVyZXNcL1swLTldKykvLCBxOicjaW1nX29iaicsIHhocjp0cnVlfSwKCQl7cjovKGltYWdlcGRiXC5jb218aW1nc3VyZVwuY29tfHd3d1wucGl4b3ZlcmZsb3dcLmNvbXxpbWd3aWtpXC5vcmd8ZnJlZWltZ3VwXC5jb21cL3h4eClcL1w/dj0oWzAtOV0rJHwuKyg/PVwuW2Etel0rKSkvLCBzOidodHRwOi8vJDEvaW1hZ2VzLyQyLmpwZycsIHhocjp0cnVlfSwKCQl7cjovaW1nKFxkKylcLihpbWFnZXNoYWNrXC51cylcL2ltZ1xcMVwvXGQrXC8oLis/KVwudGgoLispJC8sIHM6J2h0dHBzOi8vJDIvZG93bmxvYWQvJDEvJDMkNCd9LAoJCXtyOi9pbWFnZXNoYWNrXC51c1wvaVwvLywgcTonI3NoYXJlLWRsJ30sCgkJe3I6L2ltYWdlc2hvc3RcLnJ1XC9waG90b1wvL2ksIHE6JyNicGhvdG8nfSwKCQl7cjovaW1hZ2V0ZWFtXC5vcmdcL2ltZy8sIHE6J2ltZ1thbHQ9ImltYWdlIl0nfSwKCQl7cjovKGltYWdldHdpc3RcLmNvbXxpbWFnZXNoaW1hZ2VcLmNvbXxpbWdmbGFyZVwuY29tfGltZ2Vhcm5cLm5ldClcL1thLXowLTldezgsfS8sIHE6J2ltZy5waWMnLCB4aHI6dHJ1ZX0sCgkJe3I6L2ltYWdldXBwZXJcLmNvbVwvaVwvLywgcTonI2ltZycsIHhocjp0cnVlfSwKCQl7cjovaW1hZ2VwaXhcLm9yZ1wvaW1hZ2VcLyguKylcLmh0bWwkLywgczonaHR0cDovL2ltYWdlcGl4Lm9yZy9mdWxsLyQxLmpwZycsIHhocjp0cnVlfSwKCQl7cjovaW1hZ2Vwb3J0ZXJcLmNvbVwvaVwvLywgczonL190Ly8nLCB4aHI6dHJ1ZX0sCgkJe3I6L2ltYWdldmVudWVcLmNvbVwvaW1nXC5waHAvLCBxOicjdGhlcGljJ30sCgkJe3I6L2ltYWdlemlsbGFcLm5ldFwvc2hvd1wvLywgcTonI3Bob3RvJywgeGhyOnRydWV9LAoJCXtyOi9tZWRpYS1pbWRiXC5jb21cL2ltYWdlc1wvLis/XC5qcGcvLCBzOicvVjFcXC4/Xy4rP1xcLi8vZycsIGRpc3RpbmN0OnRydWV9LAoJCXtyOi9pbWdib3hcLmNvbVwvKFthLXowLTldKykkL2ksIHE6JyNpbWcnLCB4aHI6aG9zdG5hbWUgIT0gJ2ltZ2JveC5jb20nfSwKCQl7cjovaW1nY2hpbGlcLihuZXR8Y29tKVwvc2hvdy8sIHE6JyNzaG93X2ltYWdlJywgeGhyOnRydWV9LAoJCXtyOi8oaG9zdHVyaW1hZ2VcLmNvbXxpbWFnZW9udGltZVwub3JnfGltZ2dvb1wuY29tfGltZ3dlbFwuY29tfGltYWdlYm9vbVwubmV0fGltYWdlb25cLm9yZ3xpbWc0ZXZlclwubmV0fGltZ2NhbmR5XC5uZXR8aW1nZGV2aWxcLmNvbXxpbWdydW5cLm5ldHxpbWd1bHRcLmNvbXxpbWdcLnl0fHBpY3Nwb3JuZnJlZVwubWV8cGl4bGl2XC5jb218cGl4eHhcLm1lfHVwbGltZ1wuY29tfHh4eHNjcmVlbnNcLmNvbXx4eHh1cGxvYWRcLm9yZylcL2ltZy18aW1nYmJcLm5ldFwvdi0vLCBzOicvXFwvKHYtWzAtOWEtZl0rKV8uKy8vJDEvJywgcTpbJ2ltZy5jZW50cmVkX3Jlc2l6ZWQsICNpbWFnZScsICdpbWdbc3JjKj0iL3VwbG9hZC9iaWcvIl0nXSwgeGhyOnRydWUsIHBvc3Q6J2ltZ0NvbnRpbnVlPUNvbnRpbnVlJTIwdG8lMjBpbWFnZSUyMC4uLiUyMCd9LAoJCXtyOi8oZm94eWltZ1wubGlua3xpbWdjbGlja1wubmV0fGltZ2RyYWdvblwuY29tfGltZ21haWRcLm5ldHxpbWdwYXlpbmdcLmNvbXxpbWFnZWVlclwuY29tfGltZ2RpYW1vbmRcLmNvbXxpbWdtZWdhXC5jb218aW1nc2VlXC5tZXxpbWd0cmV4XC5jb218aW1ndGlnZXJcLm9yZ3xwaWMtbWFuaWFjXC5jb218cGljZXhwb3NlZFwuY29tKVwvKFthLXowLTldKykvLCAgcTonaW1nLnBpYycsIHhocjp0cnVlLCBwb3N0OmZ1bmN0aW9uKG0pIHsgcmV0dXJuICdvcD12aWV3JmlkPScgKyBtWzJdICsgJyZwcmU9MSZzdWJtaXQ9Q29udGludWUlMjB0byUyMGltYWdlLi4uJzsgfX0sCgkJe3I6L2ltZ2ZsaXBcLmNvbVwvKGl8Z2lmKVwvKFteXC8/I10rKS8sIHM6ZnVuY3Rpb24obSkgeyByZXR1cm4gJ2h0dHBzOi8vaS5pbWdmbGlwLmNvbS8nICsgbVsyXSArIChtWzFdID09ICdpJyA/ICcuanBnJyA6ICcubXA0Jyk7IH19LAoJCXtyOi9pbWdyaWxsXC5jb21cL3VwbG9hZFwvLywgczonL3NtYWxsL2JpZy8nLCB4aHI6dHJ1ZX0sCgkJe3I6L2ltZ3RoZWlmXC5jb21cL2ltYWdlXC8vLCBxOidhID4gaW1nW3NyYyo9Ii9waWN0dXJlcy8iXSd9LAoJCXtyOi9pbWd1clwuY29tXC8oYXxnYWxsZXJ5fHRcL1thLXowLTlfLV0rKVwvKFthLXowLTldKykoI1thLXowLTldKyk/L2ksIHM6ZnVuY3Rpb24obSkgeyByZXR1cm4gJ2h0dHBzOi8vaW1ndXIuY29tLycgKyBtWzFdICsgJy8nICsgbVsyXSArICcnICsgKG1bM10gfHwgJycpOyB9LCBnOmZ1bmN0aW9uKHRleHQsIHVybCwgY2IpIHsgdmFyIG1rID0gZnVuY3Rpb24obywgaW1ncykgeyB2YXIgaXRlbXMgPSBbXTsgaWYoIW8gfHwgIWltZ3MpIHJldHVybiBpdGVtczsgZm9yKHZhciBpID0gMCwgbGVuID0gaW1ncy5sZW5ndGgsIGN1cjsgaSA8IGxlbiAmJiAoY3VyID0gaW1nc1tpXSk7IGkrKykgeyB2YXIgaXUgPSAnaHR0cHM6Ly9pLmltZ3VyLmNvbS8nICsgY3VyLmhhc2ggKyBjdXIuZXh0OyBpZihjdXIuZXh0ID09ICcuZ2lmJyAmJiAhKGN1ci5hbmltYXRlZCA9PT0gZmFsc2UpKSBpdSA9IFtpdS5yZXBsYWNlKCcuZ2lmJywgJy53ZWJtJyksIGl1LnJlcGxhY2UoJy5naWYnLCAnLm1wNCcpLCBpdV07IGl0ZW1zLnB1c2goe3VybDppdSwgZGVzYzpjdXIudGl0bGUgJiYgY3VyLmRlc2NyaXB0aW9uID8gY3VyLnRpdGxlICsgJyAtICcgKyBjdXIuZGVzY3JpcHRpb24gOiAoY3VyLnRpdGxlIHx8IGN1ci5kZXNjcmlwdGlvbil9KTsgfSBpZihvLmlzX2FsYnVtICYmICFjb250YWlucyhpdGVtc1swXS5kZXNjLCBvLnRpdGxlKSkgaXRlbXMudGl0bGUgPSBvLnRpdGxlOyByZXR1cm4gaXRlbXM7IH0sIG0gPSAvKG1lcmdlQ29uZmlnXCgnZ2FsbGVyeScsXHMqfEltZ3VyXC5BbGJ1bVwuZ2V0SW5zdGFuY2VcKCkoXHtbXHNcU10rP1x9KVwpOy8uZXhlYyh0ZXh0KSwgbzEgPSBldmFsKCcoJyArIG1bMl0ucmVwbGFjZSgvYW5hbHl0aWNzXHMqOlxzKmFuYWx5dGljcy8sICdhbmFseXRpY3M6bnVsbCcpLnJlcGxhY2UoL2RlY29kZVVSSUNvbXBvbmVudFwoLis/XCkvLCAnbnVsbCcpICsgJyknKSwgbyA9IG8xLmltYWdlIHx8IG8xLmFsYnVtLCBpbWdzID0gby5pc19hbGJ1bSA/IG8uYWxidW1faW1hZ2VzLmltYWdlcyA6IFtvXTsgaWYoIW8ubnVtX2ltYWdlcyB8fCBvLm51bV9pbWFnZXMgPD0gaW1ncy5sZW5ndGgpIHJldHVybiBtayhvLCBpbWdzKTsgR01feG1saHR0cFJlcXVlc3Qoe21ldGhvZDonR0VUJyx1cmw6J2h0dHBzOi8vaW1ndXIuY29tL2FqYXhhbGJ1bXMvZ2V0aW1hZ2VzLycgKyBvLmhhc2ggKyAnL2hpdC5qc29uP2FsbD10cnVlJyxvbmxvYWQ6ZnVuY3Rpb24ocmVzKSB7IHZhciBpbWdzOyB0cnkgeyBpbWdzID0gSlNPTi5wYXJzZShyZXMucmVzcG9uc2VUZXh0KS5kYXRhLmltYWdlczsgfSBjYXRjaChleCkge30gY2IobWsobywgaW1ncykpOyB9fSk7IH0sIGNzczonLnBvc3QgPiAuaG92ZXIgeyBkaXNwbGF5Om5vbmUhaW1wb3J0YW50OyB9J30sCgkJe3I6L2ltZ3VyXC5jb21cLy4rLC9pLCBnOmZ1bmN0aW9uKHRleHQsIHVybCkgeyB2YXIgaG4gPSAvKFthLXpdezIsfVwuKT9pbWd1clwuY29tLy5leGVjKHVybClbMF07IHJldHVybiAvLitcLyhbYS16MC05LF0rKS9pLmV4ZWModXJsKVsxXS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbihpZCkgeyByZXR1cm4ge3VybDonaHR0cHM6Ly9pLicgKyBobiArICcvJyArIGlkICsgJy5qcGcnfTsgfSk7IH19LAoJCXtyOi8oW2Etel17Mix9XC4pP2ltZ3VyXC5jb21cLyhyXC9bYS16XStcL3xbYS16MC05XSsjKT8oW2EtejAtOV17NSx9KSgkfFw/fFwuKFthLXpdKykpL2ksIHM6ZnVuY3Rpb24obSwgbm9kZSkgeyBpZigvbWVtZWdlbnxyYW5kb218cmVnaXN0ZXJ8c2VhcmNofHNpZ25pbi8udGVzdChtLmlucHV0KSkgcmV0dXJuICcnOyBpZigvKGlcLihbYS16XStcLik/KT9pbWd1clwuY29tXC8oYVwvfGdhbGxlcnlcLyk/Ly50ZXN0KG5vZGUucGFyZW50Tm9kZS5ocmVmIHx8IG5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmhyZWYpKSByZXR1cm4gZmFsc2U7IHZhciB1cmwgPSAnaHR0cHM6Ly9pLicgKyAobVsxXSB8fCAnJykucmVwbGFjZSgnd3d3LicsICcnKSArICdpbWd1ci5jb20vJyArIG1bM10ucmVwbGFjZSgvKC57N30pW2JobV0kLywgJyQxJykgKyAnLicgKyAobVs1XSA/IG1bNV0ucmVwbGFjZSgvZ2lmdj8vLCAnd2VibScpIDogJ2pwZycpOyByZXR1cm4gY29udGFpbnModXJsLCAnLndlYm0nKSA/IFt1cmwsIHVybC5yZXBsYWNlKCcud2VibScsICcubXA0JyksIHVybC5yZXBsYWNlKCcud2VibScsICcuZ2lmJyldIDogdXJsOyB9fSwKCQl7ZDonaW5zdGFncmFtLmNvbScsIGU6WydhW2hyZWYqPSIvcC8iXScsICdhW3JvbGU9ImJ1dHRvbiJdW2RhdGEtcmVhY3RpZCo9InNjb250ZW50LSJdJywgJ2FydGljbGUgZGl2J10sIHM6ZnVuY3Rpb24obSwgbm9kZSkgeyB2YXIgbiA9IGNsb3Nlc3Qobm9kZSwgJ2FbaHJlZio9Ii9wLyJdLCBhcnRpY2xlJyk7IGlmKCFuKSByZXR1cm4gZmFsc2U7IHZhciBhID0gbWF0Y2hlcyhuLCAnYVtocmVmKj0iL3AvIl0nKSA/IG4gOiBxcygnYVtocmVmKj0iL3AvIl0nLCBuKTsgcmV0dXJuIGEuaHJlZjsgfSwgZm9sbG93OnRydWV9LAoJCXtyOi9pbnN0YWdyKFwuYW18YW1cLmNvbSlcL3BcLy9pLCBzOmZ1bmN0aW9uKG0pIHsgcmV0dXJuIG0uaW5wdXQuc3Vic3RyKDAsIG0uaW5wdXQubGFzdEluZGV4T2YoJy8nKSkgKyAnP19fYT0xJzsgfSwgcTpmdW5jdGlvbih0ZXh0KSB7IHZhciBtID0gSlNPTi5wYXJzZSh0ZXh0KS5tZWRpYTsgcmV0dXJuIG0udmlkZW9fdXJsIHx8IG0uZGlzcGxheV9zcmMucmVwbGFjZSgvXC9bc3BdXGQreFxkK1wvLywgJy8nKS5yZXBsYWNlKC9cPy4rLywgJycpOyB9LCByZWN0OidkaXYuUGhvdG9HcmlkTWVkaWFJdGVtJywgYzpmdW5jdGlvbih0ZXh0KSB7IHJldHVybiBKU09OLnBhcnNlKHRleHQpLm1lZGlhLmNhcHRpb247IH0gfSwKCQl7cjovKGlzdG9yZWltZ1wuY29tXC9pfGl0bWFnZXNcLnJ1XC9pbWFnZVwvdmlldylcLy8sIHE6JyNpbWFnZSd9LAoJCXtkOidrYXQuY3InLCByOi9jb25maXJtXC91cmxcLyhbXlwvXSspLywgczpmdW5jdGlvbihtKSB7IHJldHVybiB3bi5hdG9iKGRlY29kZVVSSUNvbXBvbmVudChtWzFdKSk7IH0sIGZvbGxvdzp0cnVlfSwKCQl7cjovKGxhenlnaXJsc1wuaW5mb1wvLitfLis/XC9bYS16MC05X10rKSgkfFw/KS9pLCBzOidodHRwOi8vd3d3LiQxP2Rpc3BsYXk9ZnVsbHNpemUnLCBxOidpbWcucGhvdG8nLCB4aHI6aG9zdG5hbWUgIT0gJ3d3dy5sYXp5Z2lybHMuaW5mbyd9LAoJCXtyOi9sZC1ob3N0XC5kZVwvc2hvdy8sIHE6JyNpbWFnZSd9LAoJCXtyOi8obGlzdGFsfGxpc2ltZylcLmNvbVwvKHZpZXcpP2ltYWdlXC8oWzAtOV0rKS8sIHM6J2h0dHA6Ly9pdjEubGlzaW1nLmNvbS9pbWFnZS8kMy8wZnVsbC5qcGcnfSwKCQl7cjovKGxpdmVtZW1lXC5jb218bHZtZVwubWUpXC8oW15cLl0rKSQvLCBzOidodHRwOi8vaS5sdm1lLm1lLyQyLmpwZyd9LAoJCXtyOi9sb3N0cGljXC5uZXRcL1w/KHBob3RvfHZpZXcpLywgcTpbJyNjb29sID4gaW1nJywgJy5jYXNlbSBpbWcnXX0sCgkJe3I6L21ha2VhbWVtZVwub3JnXC9tZW1lXC8oW15cLz8jXSspLywgczonaHR0cHM6Ly9tZWRpYS5tYWtlYW1lbWUub3JnL2NyZWF0ZWQvJDEuanBnJ30sCgkJe3I6L21vZGVsbWF5aGVtXC5jb21cL3Bob3Rvc1wvLywgczonL19tLy8nfSwKCQl7cjovbW9kZWxtYXloZW1cLmNvbVwvYXZhdGFyc1wvLywgczonL190L19tLyd9LAoJCXtyOi8obWluXC51c3xtaW51c1wuY29tKVwvKGlcL3xsKShbYS16MC05XSspJC9pLCBzOidodHRwczovL2kubWludXMuY29tL2kkMy5qcGcnfSwKCQl7cjovKG1pblwudXN8bWludXNcLmNvbSlcL21bYS16MC05XSskL2ksIGc6ZnVuY3Rpb24odGV4dCkgeyB2YXIgbSA9IC9nYWxsZXJ5ZGF0YSA9ICh7W1x3XFddKz99KTsvLmV4ZWModGV4dCksIG8gPSBKU09OLnBhcnNlKG1bMV0pLCBpdGVtcyA9IFtdOyBpdGVtcy50aXRsZSA9IG8ubmFtZTsgZm9yKHZhciBpID0gMCwgbGVuID0gby5pdGVtcy5sZW5ndGgsIGN1cjsgaSA8IGxlbiAmJiAoY3VyID0gby5pdGVtc1tpXSk7IGkrKykgeyBpdGVtcy5wdXNoKHt1cmw6J2h0dHBzOi8vaS5taW51cy5jb20vaScgKyBjdXIuaWQgKyAnLmpwZycsIGRlc2M6Y3VyLmNhcHRpb259KTsgfSByZXR1cm4gaXRlbXM7IH19LAoJCXtyOi8ocGFub3JhbWlvXC5jb21cLy4qP3Bob3RvKFwvfF9pZD0pfGdvb2dsZVwuY29tXC9tdy1wYW5vcmFtaW9cL3Bob3Rvc1wvW2Etel0rXC8pKFxkKykvLCBzOidodHRwOi8vc3RhdGljLnBhbm9yYW1pby5jb20vcGhvdG9zL29yaWdpbmFsLyQzLmpwZyd9LAoJCXtyOi8oXGQrXC5waG90b2J1Y2tldFwuY29tXC8uK1wvKShcP1thLXo9Jl0rPSk/KC4rXC4oanBlP2d8cG5nfGdpZikpLywgczonaHR0cDovL2kkMSQzJywgeGhyOiFjb250YWlucyhob3N0bmFtZSwgJ3Bob3RvYnVja2V0LmNvbScpfSwKCQl7cjovKHBob3Rvc2V4XC5iaXp8cG9zdGVyYW1cLnJ1KVwvLis/aWQ9L2ksIHE6J2ltZ1tzcmMqPSIvcGljX2IvIl0nLCB4aHI6dHJ1ZX0sCgkJe3I6L3BpYzRhbGxcLmV1XC8oaW1hZ2VzXC98dmlld1wucGhwXD9maWxlbmFtZT0pKC4rKS8sIHM6J2h0dHA6Ly8kMS9pbWFnZXMvJDMnfSwKCQl7cjovcGljY3lcLmluZm9cL3ZpZXczXC8oLiopXC8vLCBzOidodHRwOi8vcGljY3kuaW5mby92aWV3My8kMS9vcmlnLycsIHE6JyNtYWluaW0nfSwKCQl7cjovcGljc2VlXC5uZXRcLyhbXGRcLV0rKVwvKC4rPylcLmh0bWwvLHM6J2h0dHA6Ly9waWNzZWUubmV0L3VwbG9hZC8kMS8kMid9LAoJCXtyOi9waWN0dXJlc2NyZWFtXC5jb21cL1w/dj0vLCBxOicjaW1hZ2VuIGltZyd9LAoJCXtyOi8ocGljdHVyZXNjcmVhbVwuW2EtelwvXSt8aW1hZ2VzY3JlYW1cLmNvbVwvaW1nKVwvKHNvZnR8eCkvLCBxOidhID4gaW1nW3NyYyo9Ii9pbWFnZXMvIl0nfSwKCQl7cjovcGltcGFuZGhvc3RcLmNvbVwvKGltYWdlfGd1ZXN0KVwvLywgczonL3NtYWxsfG1lZGl1bS9vcmlnaW5hbC8nLCBxOicjaW1hZ2UnfSwKCQl7cjovcGl4aG9zdFwub3JnXC9zaG93XC8vLCBxOicjc2hvd19pbWFnZScsIHhocjp0cnVlfSwKCQl7cjovcGl4aHViXC5ldVwvaW1hZ2VzLywgcTonLmltYWdlLXNob3cgaW1nJywgeGhyOnRydWV9LAoJCXtyOi8ocGl4cm91dGV8aW1nc3BpY2UpXC5jb21cLy4rXC5odG1sJC8sIHE6J2ltZ1tpZF0nLCB4aHI6dHJ1ZX0sCgkJe3I6LyhwaXhzb3JcLmNvbXxldXJvLXBpY1wuZXUpXC9zaGFyZS0oW2EtejAtOV9dKykvaSwgczonaHR0cDovL3d3dy4kMS9pbWFnZS5waHA/aWQ9JDInLCB4aHI6dHJ1ZX0sCgkJe3I6L3Bvc3RpbWE/Z2U/XC5vcmdcL2ltYWdlXC9cdysvLCBxOidjZW50ZXIgaW1nJ30sCgkJe3I6L3JhZGlrYWxcLnJ1XC8oZnB8LitcLmh0bWwpLywgcTpmdW5jdGlvbih0ZXh0KSB7IHJldHVybiB0ZXh0Lm1hdGNoKC9odHRwOlwvXC9bYS16MC05XStcLnJhZGlrYWxcLnJ1W2EtejAtOVwvXStcLihqcGd8Z2lmfHBuZykvaSlbMF07IH19LAoJCXtkOidyZWRkaXQuY29tJywgcjovaVwucmVkZGl0dXBsb2Fkc1wuY29tL30sCgkJe3I6L3NjcmVlbmxpc3RcLnJ1XC9kZXRhaWxzLywgcTonI3BpY3R1cmUnfSwKCQl7cjovc2hhcmVueHNcLmNvbVwvLitvcmlnaW5hbCQvLCBxOidpbWcudmlld19waG90bycsIHhocjp0cnVlfSwKCQl7cjovc2hhcmVueHNcLmNvbVwvKGdhbGxlcnl8dmlldylcLy8sIHE6J2FbaHJlZiQ9Im9yaWdpbmFsIl0nLCBmb2xsb3c6dHJ1ZX0sCgkJe3I6L3N0b29vcmFnZVwuY29tXC9zaG93XC8vLCBxOicjcGFnZV9ib2R5IGRpdiBkaXYgaW1nJywgeGhyOnRydWV9LAoJCXtyOi8oKGF3c21waWN8ZGFtaW1hZ2V8aW1hZ2VkZWNvZGV8aW1naGl0fGltZ3RyaWFsfG9jYWxvYWR8c3dvb3BpYylcLmNvbXwoaW1ncHJvb2Z8aW1nc2VydmV8aW1nZ2V0KVwubmV0fChkcmFnaW1hZ2V8Z29nb2ltYWdlfGltZ3Nwb3R8aW1nc3R1ZGlvfG1hZGltYWdlKVwub3JnfGltZ3NcLml0fGltYWdlXC5yZSlcL2ltZy0vLCBxOidpbWcuY2VudHJlZF9yZXNpemVkLCBpbWcuY2VudHJlZCcsIHhocjp0cnVlfSwKCQl7cjovdHVyYm9pbWFnZWhvc3RcLmNvbVwvcFwvLywgcTonI2ltYWdlaWQnLCB4aHI6dHJ1ZX0sCgkJe3I6L3R3aW1nLitcL3Byb2ZpbGVfaW1hZ2VzL2ksIHM6Jy9fKHJlYXNvbmFibHlfc21hbGx8bm9ybWFsfGJpZ2dlcnxcZCt4XGQrKVxcLi8uL2cnfSwKCQl7cjovKFthLXowLTldK1wudHdpbWdcLmNvbVwvbWVkaWFcL1thLXowLTlfLV0rXC4oanBlP2d8cG5nfGdpZikpL2ksIHM6J2h0dHBzOi8vJDE6bGFyZ2UnLCByZWN0OidkaXYudHdlZXQgYS50d2l0dGVyLXRpbWVsaW5lLWxpbmssIGRpdi5Ud2l0dGVyUGhvdG8tbWVkaWEnfSwKCQl7ZDondHVtYmxyLmNvbScsICBlOidkaXYucGhvdG9fc3RhZ2VfaW1nLCBkaXYucGhvdG9fc3RhZ2UgPiBjYW52YXMnLCBzOmZ1bmN0aW9uKG0sIG5vZGUpIHsgcmV0dXJuIC9odHRwW14iXSsvLmV4ZWMobm9kZS5zdHlsZS5jc3NUZXh0ICsgbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW1nLXNyYycpKVswXTsgfSwgZm9sbG93OnRydWV9LAoJCXtyOi90dW1ibHJcLmNvbS4rXzUwMFwuanBnLywgczpbJy9fNTAwL18xMjgwLycsICcnXX0sCgkJe3I6L3R3aW1nXC5jb21cLzFcL3Byb3h5Lis/dD0oLis/KVsmX10vaSwgczpmdW5jdGlvbihtKSB7IHJldHVybiB3bi5hdG9iKG1bMV0pLm1hdGNoKC9odHRwLisvKTsgfX0sCgkJe3I6L3BpY1wudHdpdHRlclwuY29tXC9bYS16MC05XSsvaSwgcTpmdW5jdGlvbih0ZXh0KSB7IHJldHVybiB0ZXh0Lm1hdGNoKC9odHRwcz86XC9cL3R3aXR0ZXJcLmNvbVwvW15cL10rXC9zdGF0dXNcL1xkK1wvcGhvdG9cL1xkKy9pKVswXTsgfSwgZm9sbG93OnRydWV9LAoJCXtkOid0d2VldGRlY2sudHdpdHRlci5jb20nLCBlOidhLm1lZGlhLWl0ZW0sIGEuanMtbWVkaWEtaW1hZ2UtbGluaycsIHM6ZnVuY3Rpb24obSwgbm9kZSkgeyByZXR1cm4gL2h0dHBbXlwpXSsvLmV4ZWMobm9kZS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UpWzBdOyB9LCBmb2xsb3c6dHJ1ZX0sCgkJe3I6L3R3aXRwaWNcLmNvbShcL3Nob3dcL1thLXpdKyk/XC8oW2EtejAtOV0rKSgkfCMpL2ksIHM6J2h0dHBzOi8vdHdpdHBpYy5jb20vc2hvdy9sYXJnZS8kMid9LAoJCXtyOi90d2l0dGVyXC5jb21cLy4rXC9zdGF0dXNcLy4rXC9waG90b1wvLywgcTonLk9sZE1lZGlhIGltZywgLm1lZGlhIGltZywgdmlkZW8uYW5pbWF0ZWQtZ2lmLCAuQWRhcHRpdmVNZWRpYS1zaW5nbGVQaG90byBpbWcnLCBmb2xsb3c6ZnVuY3Rpb24odXJsKSB7IHJldHVybiAhL1wubXA0JC8udGVzdCh1cmwpOyB9fSwKCQl7ZDondHdpdHRlci5jb20nLCBlOicuZ3JpZC10d2VldCA+IC5tZWRpYS1vdmVybGF5JywgczpmdW5jdGlvbihtLCBub2RlKSB7IHJldHVybiBub2RlLnByZXZpb3VzRWxlbWVudFNpYmxpbmcuc3JjOyB9LCBmb2xsb3c6dHJ1ZX0sCgkJe3I6L3VwaXhcLm1lXC9maWxlcy8sIHM6Jy8jLy8nfSwKCQl7cjovKHZpbmV8c2Vlbml2ZSlcLmNvbT9cL3ZcLy8sIHE6J3ZpZGVvIHNvdXJjZSwgbWV0YVtwcm9wZXJ0eT0idHdpdHRlcjpwbGF5ZXI6c3RyZWFtIl0nfSwKCQl7cjovKHdlYlwuc3RhZ3IoXC5hbXxhbVwuY29tKXx3ZWJzdGFcLm1lKVwvcFwvL2ksIHE6ZnVuY3Rpb24odGV4dCwgZG9jKSB7IHZhciBub2RlID0gZmluZE5vZGUoWydkaXYuanAtanBsYXllcicsICdtZXRhW3Byb3BlcnR5PSJvZzppbWFnZSJdJ10sIGRvYyk7IHJldHVybiBmaW5kRmlsZShub2RlLCBfLnVybCkucmVwbGFjZSgvXC9bc3BdXGQreFxkK1wvLywgJy8nKTsgfSwgcmVjdDonZGl2LlBob3RvR3JpZE1lZGlhSXRlbScsIGM6ZnVuY3Rpb24odGV4dCwgZG9jKSB7IHZhciBzID0gcXMoJ21ldGFbbmFtZT0iZGVzY3JpcHRpb24iXScsIGRvYykuZ2V0QXR0cmlidXRlKCdjb250ZW50Jyk7IHJldHVybiBzLnN1YnN0cigwLCBzLmxhc3RJbmRleE9mKCcgfCAnKSk7IH0gfSwKCQl7cjovd2lraS4rXC8odGh1bWJ8aW1hZ2VzKVwvLitcLihqcGU/Z3xnaWZ8cG5nfHN2ZylcLyhyZXZpc2lvblwvKT8vaSwgczonL1xcL3RodW1iKD89XFwvKXxcXC9zY2FsZS10by13aWR0aCgtW2Etel0rKT9cXC9bMC05XSt8XFwvcmV2aXNpb25cXC9sYXRlc3R8XFwvW15cXC9dKyQvL2cnLCB4aHI6IWNvbnRhaW5zKGhvc3RuYW1lLCAnd2lraScpfSwKCQl7cjovKCh4eHhob3N0fHRpbnlwaXgpXC5tZXwoeHh4Y2VzfGltZ3NpbilcLmNvbSlcL3ZpZXdlci8sIHE6WycudGV4dF9hbGlnbl9jZW50ZXIgPiBpbWcnLCAnaW1nW2FsdF0nXSwgeGhyOnRydWV9LAoJCXtyOi8oaVswLTldKlwueXRpbWdcLmNvbVwvdmlcL1teXC9dKykvLCBzOidodHRwczovLyQxLzAuanBnJywgcmVjdDonLnZpZGVvLWxpc3QtaXRlbSd9LAoJCXtyOi9cL1wvKFteXC9dKylcL3ZpZXdlclwucGhwXD9maWxlPSguKykvLCBzOidodHRwOi8vJDEvaW1hZ2VzLyQyJywgeGhyOnRydWV9LAoJCXtyOi9cL2FsYnVtcy4rXC90aHVtYl9bXlwvXS8sIHM6Jy90aHVtYl8vLyd9LAoJCXtyOi9cL1wvW15cL10rW15cPzpdK1wuKGpwZT9nP3xnaWZ8cG5nfHN2Z3x3ZWJtKSgkfFw/KS9pLCBkaXN0aW5jdDp0cnVlfQoJXTsKCWlmKGNmZy5ob3N0cykgewoJCXZhciBsaW5lcyA9IGNmZy5ob3N0cy5zcGxpdCgvW1xyXG5dKy8pOwoJCWZvcih2YXIgaSA9IGxpbmVzLmxlbmd0aCwgczsgaS0tICYmIChzID0gbGluZXNbaV0pOykgewoJCQl0cnkgewoJCQkJdmFyIGggPSBKU09OLnBhcnNlKHMpOwoJCQkJaWYoaC5yKSBoLnIgPSBuZXcgUmVnRXhwKGguciwgJ2knKTsKCQkJCWlmKGgucyAmJiB0eXBlb2YgaC5zID09ICdzdHJpbmcnICYmIGNvbnRhaW5zKGgucywgJ3JldHVybiAnKSkgaC5zID0gbmV3IEZ1bmN0aW9uKCdtJywgJ25vZGUnLCBoLnMpOwoJCQkJaWYoaC5xICYmIHR5cGVvZiBoLnEgPT0gJ3N0cmluZycgJiYgY29udGFpbnMoaC5xLCAncmV0dXJuICcpKSBoLnEgPSBuZXcgRnVuY3Rpb24oJ3RleHQnLCAnZG9jJywgJ25vZGUnLCBoLnEpOwoJCQkJaWYoY29udGFpbnMoaC5jLCAncmV0dXJuICcpKSBoLmMgPSBuZXcgRnVuY3Rpb24oJ3RleHQnLCAnZG9jJywgJ25vZGUnLCBoLmMpOwoJCQkJaG9zdHMuc3BsaWNlKDAsIDAsIGgpOwoJCQl9IGNhdGNoKGV4KSB7CgkJCQloYW5kbGVFcnJvcignSG9zdCBydWxlIGludmFsaWQ6ICcgKyBzKTsKCQkJfQoJCX0KCX0KCXJldHVybiBob3N0cy5maWx0ZXIoZnVuY3Rpb24oaCkgeyByZXR1cm4gIWguZCB8fCBjb250YWlucyhob3N0bmFtZSwgaC5kKTsgfSk7Cn0KCmZ1bmN0aW9uIG9uTW91c2VPdmVyKGUpIHsKCWlmKCFlbmFibGVkIHx8IGUuc2hpZnRLZXkgfHwgXy56b29tIHx8ICFhY3RpdmF0ZShlLnRhcmdldCwgZS5jdHJsS2V5KSkgcmV0dXJuOwoJdXBkYXRlTW91c2UoZSk7CglpZihlLmN0cmxLZXkpIHsKCQlzdGFydFBvcHVwKCk7Cgl9IGVsc2UgaWYoY2ZnLnN0YXJ0ID09ICdhdXRvJyAmJiAhXy5tYW51YWwpIHsKCQlpZihjZmcucHJlbG9hZCkgewoJCQlfLnByZWxvYWRTdGFydCA9IERhdGUubm93KCk7CgkJCXN0YXJ0UG9wdXAoKTsKCQkJc2V0U3RhdHVzKCdwcmVsb2FkaW5nJywgJ2FkZCcpOwoJCX0gZWxzZSB7CgkJCV8udGltZW91dCA9IHduLnNldFRpbWVvdXQoc3RhcnRQb3B1cCwgY2ZnLmRlbGF5KTsKCQl9CgkJaWYoY2ZnLnByZWxvYWQpIHduLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHNldFN0YXR1cygncHJlbG9hZGluZycsICdyZW1vdmUnKTsgfSwgY2ZnLmRlbGF5KTsKCX0KCWVsc2UKCQlzZXRTdGF0dXMoJ3JlYWR5Jyk7Cn0KCmZ1bmN0aW9uIG9uTW91c2VPdXQoZSkgewoJaWYoIWUucmVsYXRlZFRhcmdldCAmJiAhZS5zaGlmdEtleSkgZGVhY3RpdmF0ZSgpOwp9CgpmdW5jdGlvbiBvbk1vdXNlTW92ZShlKSB7Cgl1cGRhdGVNb3VzZShlKTsKCWlmKGUuc2hpZnRLZXkpIHJldHVybiAoXy5sYXp5VW5sb2FkID0gdHJ1ZSk7CglpZighXy56b29tZWQgJiYgIV8uY3IpIHJldHVybiBkZWFjdGl2YXRlKCk7CglpZihfLnpvb20pIHsKCQlwbGFjZVBvcHVwKCk7CgkJaWYoIWNmZy5jdXJzb3IpIHsKCQkJdmFyIGJ4ID0gXy52aWV3LndpZHRoLzYsIGJ5ID0gXy52aWV3LmhlaWdodC82OwoJCQlzZXRTdGF0dXMoJ2VkZ2UnLCBfLmN4IDwgYnggfHwgXy5jeCA+IF8udmlldy53aWR0aCAtIGJ4IHx8IF8uY3kgPCBieSB8fCBfLmN5ID4gXy52aWV3LmhlaWdodCAtIGJ5ID8gJ2FkZCcgOiAncmVtb3ZlJyk7CgkJfQoJfQp9CgpmdW5jdGlvbiBvbk1vdXNlRG93bihlKSB7CglpZihlLndoaWNoICE9IDMgJiYgIWUuc2hpZnRLZXkpIGRlYWN0aXZhdGUodHJ1ZSk7CgllbHNlIGlmKGUuc2hpZnRLZXkgJiYgZS53aGljaCA9PSAxICYmIF8ucG9wdXAgJiYgXy5wb3B1cC5jb250cm9scykgXy5jb250cm9sbGVkID0gXy56b29tZWQgPSB0cnVlOwp9CgpmdW5jdGlvbiBvbk1vdXNlU2Nyb2xsKGUpIHsKCXZhciBkaXIgPSAoZS5kZWx0YVkgfHwgLWUud2hlZWxEZWx0YSkgPiAwID8gMSA6IC0xOwoJaWYoXy56b29tKSB7CgkJZHJvcChlKTsKCQl2YXIgaWR4ID0gXy5zY2FsZXMuaW5kZXhPZihfLnNjYWxlKTsKCQlpZHggLT0gZGlyOwoJCWlmKGlkeCA+PSAwICYmIGlkeCA8IF8uc2NhbGVzLmxlbmd0aCkgXy5zY2FsZSA9IF8uc2NhbGVzW2lkeF07CgkJaWYoaWR4ID09IDAgJiYgY2ZnLmNsb3NlKSB7CgkJCWlmKCFfLmdJdGVtcyB8fCBfLmdJdGVtcy5sZW5ndGggPCAyKSByZXR1cm4gZGVhY3RpdmF0ZSh0cnVlKTsKCQkJXy56b29tID0gZmFsc2U7CgkJCXNob3dGaWxlSW5mbygpOwoJCX0KCQlpZihfLnpvb21pbmcpIF8ucG9wdXAuY2xhc3NMaXN0LmFkZCgnbXBpdi16b29taW5nJyk7CgkJcGxhY2VQb3B1cCgpOwoJCXVwZGF0ZVRpdGxlKCk7Cgl9IGVsc2UgaWYoXy5nSXRlbXMgJiYgXy5nSXRlbXMubGVuZ3RoID4gMSAmJiBfLnBvcHVwKSB7CgkJZHJvcChlKTsKCQluZXh0R2FsbGVyeUl0ZW0oZGlyKTsKCX0gZWxzZSBpZihjZmcuem9vbSA9PSAnd2hlZWwnICYmIGRpciA8IDAgJiYgXy5wb3B1cCkgewoJCWRyb3AoZSk7CgkJdG9nZ2xlWm9vbSgpOwoJfSBlbHNlIHsKCQlkZWFjdGl2YXRlKCk7Cgl9Cn0KCmZ1bmN0aW9uIG9uS2V5RG93bihlKSB7CglpZihlLmtleUNvZGUgPT0gMTYpIHsKCQlzZXRTdGF0dXMoJ3NoaWZ0JywgJ2FkZCcpOwoJCWlmKF8ucG9wdXAgJiYgJ2NvbnRyb2xzJyBpbiBfLnBvcHVwKSBfLnBvcHVwLmNvbnRyb2xzID0gdHJ1ZTsKCX0gZWxzZSBpZihlLmtleUNvZGUgPT0gMTcgJiYgKGNmZy5zdGFydCAhPSAnYXV0bycgfHwgXy5tYW51YWwpICYmICFfLnBvcHVwKSB7CgkJc3RhcnRQb3B1cCgpOwoJfQp9CgpmdW5jdGlvbiBvbktleVVwKGUpIHsKCXN3aXRjaChlLmtleUNvZGUpIHsKCQljYXNlIDE2OgoJCQlzZXRTdGF0dXMoJ3NoaWZ0JywgJ3JlbW92ZScpOwoJCQlpZihfLnBvcHVwLmNvbnRyb2xzKSBfLnBvcHVwLmNvbnRyb2xzID0gZmFsc2U7CgkJCWlmKF8uY29udHJvbGxlZCkgcmV0dXJuIF8uY29udHJvbGxlZCA9IGZhbHNlOwoJCQlfLnBvcHVwICYmIChfLnpvb21lZCB8fCAhKCdjcicgaW4gXykgfHwgXy5jcikgPyB0b2dnbGVab29tKCkgOiBkZWFjdGl2YXRlKHRydWUpOwoJCQlicmVhazsKCQljYXNlIDE3OgoJCQlicmVhazsKCQljYXNlIDI3OgoJCQlkZWFjdGl2YXRlKHRydWUpOwoJCQlicmVhazsKCQljYXNlIDM5OgoJCWNhc2UgNzQ6CgkJCWRyb3AoZSk7CgkJCW5leHRHYWxsZXJ5SXRlbSgxKTsKCQkJYnJlYWs7CgkJY2FzZSAzNzoKCQljYXNlIDc1OgoJCQlkcm9wKGUpOwoJCQluZXh0R2FsbGVyeUl0ZW0oLTEpOwoJCQlicmVhazsKCQljYXNlIDY4OgoJCQlkcm9wKGUpOwoJCQl2YXIgbmFtZSA9IChfLml1cmwgfHwgXy5wb3B1cC5zcmMpLnNwbGl0KCcvJykucG9wKCkucmVwbGFjZSgvWzojXD9dLiovLCAnJyk7CgkJCWlmKCFjb250YWlucyhuYW1lLCAnLicpKSBuYW1lICs9ICcuanBnJzsKCQkJc2F2ZUZpbGUoXy5wb3B1cC5zcmMsIG5hbWUsIGZ1bmN0aW9uKCkgeyBzZXRCYXIoJ0NvdWxkIG5vdCBkb3dubG9hZCAnICsgbmFtZSArICcuJywgJ2Vycm9yJyk7IH0pOwoJCQlicmVhazsKCQljYXNlIDg0OgoJCQlfLmxhenlVbmxvYWQgPSB0cnVlOwoJCQlpZihfLnRhYmZpeCAmJiAhXy54aHIgJiYgdGFnKF8ucG9wdXApID09ICdJTUcnICYmIGNvbnRhaW5zKG5hdmlnYXRvci51c2VyQWdlbnQsICdHZWNrby8nKSkKCQkJCUdNX29wZW5JblRhYignZGF0YTp0ZXh0L2h0bWw7LCcgKyBlbmNvZGVVUklDb21wb25lbnQoJzxodG1sPjxoZWFkPjxzdHlsZT5ib2R5e21hcmdpbjowO3BhZGRpbmc6MDtiYWNrZ3JvdW5kOiMyMjJ9LmZpdHtvdmVyZmxvdzpoaWRkZW59LmZpdD5pbWd7bWF4LXdpZHRoOjEwMHZ3O21heC1oZWlnaHQ6MTAwdmh9Ym9keT5pbWd7bWFyZ2luOmF1dG87cG9zaXRpb246YWJzb2x1dGU7bGVmdDowO3JpZ2h0OjA7dG9wOjA7Ym90dG9tOjB9PC9zdHlsZT48L2hlYWQ+PGJvZHkgY2xhc3M9ImZpdCI+PGltZyBvbmNsaWNrPSJkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoXCdmaXRcJykiIHNyYz0iJyArIF8ucG9wdXAuc3JjICsgJyI+PC9ib2R5PjwvaHRtbD4nKSk7CgkJCWVsc2UKCQkJCUdNX29wZW5JblRhYihfLnBvcHVwLnNyYyk7CgkJCWRlYWN0aXZhdGUoKTsKCQkJYnJlYWs7CgkJZGVmYXVsdDoKCQkJZGVhY3RpdmF0ZSh0cnVlKTsKCX0KCn0KCmZ1bmN0aW9uIHNhdmVGaWxlKHVybCwgbmFtZSwgb25FcnJvcikgewoJdmFyIHNhdmUgPSBmdW5jdGlvbih1cmwpIHsKCQl2YXIgYSA9IGNlKCdhJyk7CgkJYS5ocmVmID0gdXJsOwoJCWEuZG93bmxvYWQgPSBuYW1lOwoJCWEuZGlzcGF0Y2hFdmVudChuZXcgTW91c2VFdmVudCgnY2xpY2snKSk7Cgl9OwoJaWYoY29udGFpbnMoWydibG9iOicsICdkYXRhOiddLCB1cmwuc3Vic3RyKDAsIDUpKSkgcmV0dXJuIHNhdmUodXJsKTsKCUdNX3htbGh0dHBSZXF1ZXN0KHsKCQltZXRob2Q6ICdHRVQnLAoJCXVybDogdXJsLAoJCXJlc3BvbnNlVHlwZTogJ2Jsb2InLAoJCW9ubG9hZDogZnVuY3Rpb24ocmVzKSB7CgkJCXRyeSB7CgkJCQl2YXIgb3UgPSB3bi5VUkwuY3JlYXRlT2JqZWN0VVJMKHJlcy5yZXNwb25zZSk7CgkJCQlzYXZlKG91KTsKCQkJCXduLnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHduLlVSTC5yZXZva2VPYmplY3RVUkwob3UpOyB9LCAxMDAwKTsKCQkJfSBjYXRjaChleCkgewoJCQkJb25FcnJvcihleCk7CgkJCX0KCQl9LAoJCW9uRXJyb3I6IG9uRXJyb3IKCX0pOwp9CgpmdW5jdGlvbiBvbkNvbnRleHQoZSkgewoJaWYoZS5zaGlmdEtleSkgcmV0dXJuOwoJaWYoY2ZnLnpvb20gPT0gJ2NvbnRleHQnICYmIF8ucG9wdXAgJiYgdG9nZ2xlWm9vbSgpKSByZXR1cm4gZHJvcChlKTsKCWlmKChjZmcuc3RhcnQgPT0gJ2NvbnRleHQnIHx8IChjZmcuc3RhcnQgPT0gJ2F1dG8nICYmIF8ubWFudWFsKSkgJiYgIV8uc3RhdHVzICYmICFfLnBvcHVwKSB7CgkJc3RhcnRQb3B1cCgpOwoJCXJldHVybiBkcm9wKGUpOwoJfQoJd24uc2V0VGltZW91dChmdW5jdGlvbigpIHsgZGVhY3RpdmF0ZSh0cnVlKTsgfSwgNTApOwp9CgpmdW5jdGlvbiBvbk1lc3NhZ2UoZSkgewoJaWYoIWNvbnRhaW5zKHRydXN0ZWQsIGUub3JpZ2luLnN1YnN0cihlLm9yaWdpbi5pbmRleE9mKCcvLycpICsgMikpIHx8IHR5cGVvZiBlLmRhdGEgIT0gJ3N0cmluZycgfHwgZS5kYXRhLmluZGV4T2YoJ21waXYtcnVsZSAnKSAhPT0gMCkgcmV0dXJuOwoJaWYoIXFzKCcjbXBpdi1zZXR1cCcsIGQpKSBzZXR1cCgpOwoJdmFyIGlucCA9IHFzKCcjbXBpdi1ob3N0cyBpbnB1dDpmaXJzdC1vZi10eXBlJywgZCk7CglpbnAudmFsdWUgPSBlLmRhdGEuc3Vic3RyKDEwKS50cmltKCk7CglpbnAuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2lucHV0Jywge2J1YmJsZXM6dHJ1ZX0pKTsKCWlucC5wYXJlbnROb2RlLnNjcm9sbFRvcCA9IDA7CglpbnAuc2VsZWN0KCk7Cn0KCmZ1bmN0aW9uIHN0YXJ0UG9wdXAoKSB7CglzZXRTdGF0dXMoZmFsc2UpOwoJXy5nID8gc3RhcnRHYWxsZXJ5UG9wdXAoKSA6IHN0YXJ0U2luZ2xlUG9wdXAoXy51cmwpOwp9CgpmdW5jdGlvbiBzdGFydFNpbmdsZVBvcHVwKHVybCkgewoJc2V0U3RhdHVzKCdsb2FkaW5nJyk7CglkZWxldGUgXy5pdXJsOwoJaWYoXy5mb2xsb3cgJiYgIV8ucSAmJiAhXy5zKSB7CgkJcmV0dXJuIGZpbmRSZWRpcmVjdChfLnVybCwgZnVuY3Rpb24odXJsKSB7CgkJCXZhciBpbmZvID0gZmluZEluZm8odXJsLCBfLm5vZGUsIHRydWUpOwoJCQlpZighaW5mbyB8fCAhaW5mby51cmwpIHRocm93ICJDb3VsZG4ndCBmb2xsb3cgcmVkaXJlY3Rpb24gdGFyZ2V0OiAiICsgdXJsOwoJCQlyZXN0YXJ0U2luZ2xlUG9wdXAoaW5mbyk7CgkJfSk7Cgl9CglpZighXy5xIHx8IEFycmF5LmlzQXJyYXkoXy51cmxzKSkgewoJCWlmKHR5cGVvZiBfLmMgPT0gJ2Z1bmN0aW9uJykgewoJCQlfLmNhcHRpb24gPSBfLmMoZC5kb2N1bWVudEVsZW1lbnQub3V0ZXJIVE1MLCBkLCBfLm5vZGUpOwoJCX0gZWxzZSBpZih0eXBlb2YgXy5jID09ICdzdHJpbmcnKSB7CgkJCXZhciBjbm9kZSA9IGZpbmROb2RlKF8uYywgZCk7CgkJCV8uY2FwdGlvbiA9IGNub2RlID8gZmluZENhcHRpb24oY25vZGUpIDogJyc7CgkJfQoJCV8uaXVybCA9IHVybDsKCQlyZXR1cm4gXy54aHIgPyBkb3dubG9hZEltYWdlKHVybCwgXy51cmwpIDogc2V0UG9wdXAodXJsKTsKCX0KCXBhcnNlUGFnZSh1cmwsIGZ1bmN0aW9uKGl1cmwsIGNhcCwgdXJsKSB7CgkJaWYoIWl1cmwpIHRocm93ICdGaWxlIG5vdCBmb3VuZC4nOwoJCWlmKHR5cGVvZiBjYXAgIT0gJ3VuZGVmaW5lZCcpIF8uY2FwdGlvbiA9IGNhcDsKCQlpZihfLmZvbGxvdyA9PT0gdHJ1ZSB8fCB0eXBlb2YgXy5mb2xsb3cgPT0gJ2Z1bmN0aW9uJyAmJiBfLmZvbGxvdyhpdXJsKSkgewoJCQl2YXIgaW5mbyA9IGZpbmRJbmZvKGl1cmwsIF8ubm9kZSwgdHJ1ZSk7CgkJCWlmKCFpbmZvIHx8ICFpbmZvLnVybCkgdGhyb3cgIkNvdWxkbid0IGZvbGxvdyBVUkw6ICIgKyBpdXJsOwoJCQlyZXR1cm4gcmVzdGFydFNpbmdsZVBvcHVwKGluZm8pOwoJCX0KCQlfLml1cmwgPSBpdXJsOwoJCWlmKF8ueGhyKSBkb3dubG9hZEltYWdlKGl1cmwsIHVybCk7IGVsc2Ugc2V0UG9wdXAoaXVybCk7Cgl9KTsKfQoKZnVuY3Rpb24gcmVzdGFydFNpbmdsZVBvcHVwKGluZm8pIHsKCWZvcih2YXIgcHJvcCBpbiBpbmZvKSBfW3Byb3BdID0gaW5mb1twcm9wXTsKCXN0YXJ0U2luZ2xlUG9wdXAoXy51cmwpOwp9CgpmdW5jdGlvbiBzdGFydEdhbGxlcnlQb3B1cCgpIHsKCXNldFN0YXR1cygnbG9hZGluZycpOwoJdmFyIHN0YXJ0VXJsID0gXy51cmw7Cglkb3dubG9hZFBhZ2UoXy51cmwsIGZ1bmN0aW9uKHRleHQsIHVybCkgewoJCXRyeSB7CgkJCXZhciBjYiA9IGZ1bmN0aW9uKGl0ZW1zKSB7CgkJCQlpZighXy51cmwgfHwgXy51cmwgIT0gc3RhcnRVcmwpIHJldHVybjsKCQkJCV8uZ0l0ZW1zID0gaXRlbXM7CgkJCQlpZihfLmdJdGVtcy5sZW5ndGggPT0gMCkgewoJCQkJCV8uZ0l0ZW1zID0gZmFsc2U7CgkJCQkJdGhyb3cgJ2VtcHR5JzsKCQkJCX0KCQkJCV8uZ0luZGV4ID0gZmluZEdhbGxlcnlQb3NpdGlvbihfLnVybCk7CgkJCQl3bi5zZXRUaW1lb3V0KG5leHRHYWxsZXJ5SXRlbSwgMCk7CgkJCX07CgkJCXZhciBpdGVtcyA9IF8uZyh0ZXh0LCB1cmwsIGNiKTsKCQkJaWYodHlwZW9mIGl0ZW1zICE9ICd1bmRlZmluZWQnKSBjYihpdGVtcyk7CgkJfSBjYXRjaChleCkgewoJCQloYW5kbGVFcnJvcignUGFyc2luZyBlcnJvcjogJyArIGV4KTsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gZmluZEdhbGxlcnlQb3NpdGlvbihnVXJsKSB7Cgl2YXIgZGlyID0gMCwgc2VsID0gZ1VybC5zcGxpdCgnIycpWzFdOwoJaWYoc2VsKSB7CgkJaWYoL15bMC05XSskLy50ZXN0KHNlbCkpIHsKCQkJZGlyICs9IHBhcnNlSW50KHNlbCk7CgkJfSBlbHNlIHsKCQkJZm9yKHZhciBpID0gXy5nSXRlbXMubGVuZ3RoOyBpLS07KSB7CgkJCQl2YXIgdXJsID0gXy5nSXRlbXNbaV0udXJsOwoJCQkJaWYoQXJyYXkuaXNBcnJheSh1cmwpKSB1cmwgPSB1cmxbMF07CgkJCQl2YXIgZmlsZSA9IHVybC5zdWJzdHIodXJsLmxhc3RJbmRleE9mKCcvJykgKyAxKTsKCQkJCWlmKGNvbnRhaW5zKGZpbGUsIHNlbCkpIHsKCQkJCQlkaXIgKz0gaTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0KCX0KCXJldHVybiBkaXI7Cn0KCmZ1bmN0aW9uIGxvYWRHYWxsZXJ5UGFyc2VyKGcpIHsKCWlmKHR5cGVvZiBnID09ICdmdW5jdGlvbicpIHJldHVybiBnOwoJaWYodHlwZW9mIGcgPT0gJ3N0cmluZycpIHJldHVybiBuZXcgRnVuY3Rpb24oJ3RleHQnLCAndXJsJywgJ2NiJywgZyk7CglyZXR1cm4gZnVuY3Rpb24odGV4dCwgdXJsKSB7CgkJdmFyIHFFID0gZy5lbnRyeSwgcUMgPSBnLmNhcHRpb24sIHFJID0gZy5pbWFnZSwgcVQgPSBnLnRpdGxlLCBmaXggPSAodHlwZW9mIGcuZml4ID09ICdzdHJpbmcnID8gbmV3IEZ1bmN0aW9uKCdzJywgJ2lzVVJMJywgZy5maXgpIDogZy5maXgpIHx8IGZ1bmN0aW9uKHMpIHsgcmV0dXJuIHMudHJpbSgpOyB9OwoJCXZhciBkb2MgPSBjcmVhdGVEb2ModGV4dCksIGl0ZW1zID0gW10sIG5vZGVzID0gcXNhKHFFIHx8IHFJLCBkb2MpOwoJCWlmKCFBcnJheS5pc0FycmF5KHFDKSkgcUMgPSBbcUNdOwoJCWZvcih2YXIgaSA9IDAsIG5vZGUsIGxlbiA9IG5vZGVzLmxlbmd0aDsgaSA8IGxlbiAmJiAobm9kZSA9IG5vZGVzW2ldKTsgaSsrKSB7CgkJCXZhciBpdGVtID0ge307CgkJCXRyeSB7CgkJCQlpdGVtLnVybCA9IGZpeChmaW5kRmlsZShxRSA/IHFzKHFJLCBub2RlKSA6IG5vZGUsIHVybCksIHRydWUpOwoJCQkJaXRlbS5kZXNjID0gcUMucmVkdWNlKGZ1bmN0aW9uKHByZXYsIHEpIHsKCQkJCQl2YXIgbiA9IHFzKHEsIG5vZGUpOwoJCQkJCWlmKCFuKSB7CgkJCQkJCVtub2RlLnByZXZpb3VzRWxlbWVudFNpYmxpbmcsIG5vZGUubmV4dEVsZW1lbnRTaWJsaW5nXS5mb3JFYWNoKGZ1bmN0aW9uKGVzKSB7CgkJCQkJCQlpZihlcyAmJiBtYXRjaGVzKGVzLCBxRSkgPT09IGZhbHNlKSBuID0gbWF0Y2hlcyhlcywgcSkgPyBlcyA6IHFzKHEsIGVzKTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJCXJldHVybiBuID8gKHByZXYgPyBwcmV2ICsgJyAtICcgOiAnJykgKyBmaXgobi50ZXh0Q29udGVudCkgOiBwcmV2OwoJCQkJfSwgJycpOwoJCQl9IGNhdGNoKGV4KSB7fQoJCQlpZihpdGVtLnVybCkgaXRlbXMucHVzaChpdGVtKTsKCQl9CgkJdmFyIHRpdGxlID0gcXMocVQsIGRvYyk7CgkJaWYodGl0bGUpIGl0ZW1zLnRpdGxlID0gZml4KHRpdGxlLmdldEF0dHJpYnV0ZSgnY29udGVudCcpIHx8IHRpdGxlLnRleHRDb250ZW50KTsKCQlyZXR1cm4gaXRlbXM7Cgl9Owp9CgpmdW5jdGlvbiBuZXh0R2FsbGVyeUl0ZW0oZGlyKSB7CglpZihkaXIgPiAwICYmIChfLmdJbmRleCArPSBkaXIpID49IF8uZ0l0ZW1zLmxlbmd0aCkKCQlfLmdJbmRleCA9IDA7CgllbHNlIGlmKGRpciA8IDAgJiYgKF8uZ0luZGV4ICs9IGRpcikgPCAwKQoJCV8uZ0luZGV4ID0gXy5nSXRlbXMubGVuZ3RoIC0gMTsKCXZhciBpdGVtID0gXy5nSXRlbXNbXy5nSW5kZXhdOwoJaWYoQXJyYXkuaXNBcnJheShpdGVtLnVybCkpIHsKCQlfLnVybHMgPSAgaXRlbS51cmwuc2xpY2UoMCk7CgkJXy51cmwgPSBfLnVybHMuc2hpZnQoKTsKCX0gZWxzZSB7CgkJZGVsZXRlIF8udXJsczsKCQlfLnVybCA9IGl0ZW0udXJsOwoJfQoJc2V0UG9wdXAoZmFsc2UpOwoJc3RhcnRTaW5nbGVQb3B1cChfLnVybCk7CglzaG93RmlsZUluZm8oKTsKCXByZWxvYWROZXh0R2FsbGVyeUl0ZW0oZGlyKTsKfQoKZnVuY3Rpb24gcHJlbG9hZE5leHRHYWxsZXJ5SXRlbShkaXIpIHsKCXZhciBpZHggPSBfLmdJbmRleCArIGRpcjsKCWlmKF8ucG9wdXAgJiYgaWR4ID49IDAgJiYgaWR4IDwgXy5nSXRlbXMubGVuZ3RoKSB7CgkJdmFyIHVybCA9IF8uZ0l0ZW1zW2lkeF0udXJsOwoJCWlmKEFycmF5LmlzQXJyYXkodXJsKSkgdXJsID0gdXJsWzBdOwoJCW9uKF8ucG9wdXAsICdsb2FkJywgZnVuY3Rpb24oKSB7CgkJCXZhciBpbWcgPSBjZSgnaW1nJyk7CgkJCWltZy5zcmMgPSB1cmw7CgkJfSk7Cgl9Cn0KCmZ1bmN0aW9uIGFjdGl2YXRlKG5vZGUsIGZvcmNlKSB7CglpZihub2RlID09IF8ucG9wdXAgfHwgbm9kZSA9PSBkLmJvZHkgfHwgbm9kZSA9PSBkLmRvY3VtZW50RWxlbWVudCkgcmV0dXJuOwoJdmFyIGluZm8gPSBwYXJzZU5vZGUobm9kZSk7CglpZighaW5mbyB8fCAhaW5mby51cmwgfHwgaW5mby5ub2RlID09IF8ubm9kZSkgcmV0dXJuOwoJaWYoaW5mby5kaXN0aW5jdCAmJiAhZm9yY2UpIHsKCQl2YXIgc2NhbGUgPSBmaW5kU2NhbGUoaW5mby51cmwsIGluZm8ubm9kZS5wYXJlbnROb2RlKTsKCQlpZihzY2FsZSAmJiBzY2FsZSA8IGNmZy5zY2FsZSkgcmV0dXJuOwoJfQoJaWYoXy5ub2RlKSBkZWFjdGl2YXRlKCk7CglfID0gaW5mbzsKCV8udmlldyA9IHZpZXdSZWN0KCk7CglfLnN0eWxlID0gYWRkU3R5bGUoJ1wKCQkjbXBpdi1iYXIgeyBwb3NpdGlvbjpmaXhlZDt6LWluZGV4OjIxNDc0ODM2NDc7bGVmdDowO3JpZ2h0OjA7dG9wOjA7dHJhbnNmb3JtOnNjYWxlWSgwKTstd2Via2l0LXRyYW5zZm9ybTpzY2FsZVkoMCk7dHJhbnNmb3JtLW9yaWdpbjp0b3A7LXdlYmtpdC10cmFuc2Zvcm0tb3JpZ2luOnRvcDt0cmFuc2l0aW9uOnRyYW5zZm9ybSA1MDBtcyBlYXNlIDEwMDBtczstd2Via2l0LXRyYW5zaXRpb246LXdlYmtpdC10cmFuc2Zvcm0gNTAwbXMgZWFzZSAxMDAwbXM7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtmb250LXNpemU6MTVweDtmb250LXdlaWdodDpib2xkO2JhY2tncm91bmQ6cmdiYSgwLCAwLCAwLCAwLjYpO2NvbG9yOndoaXRlO3BhZGRpbmc6NHB4IDEwcHg7IH1cCgkJI21waXYtYmFyLm1waXYtc2hvdyB7IHRyYW5zZm9ybTpzY2FsZVkoMSk7LXdlYmtpdC10cmFuc2Zvcm06c2NhbGVZKDEpOyB9XAoJCSNtcGl2LXBvcHVwIHsgZGlzcGxheTpub25lO2JvcmRlcjoxcHggc29saWQgZ3JheTtib3gtc2l6aW5nOmNvbnRlbnQtYm94O2JhY2tncm91bmQtY29sb3I6d2hpdGU7cG9zaXRpb246Zml4ZWQ7ei1pbmRleDoyMTQ3NDgzNjQ3O21hcmdpbjowO21heC13aWR0aDpub25lO21heC1oZWlnaHQ6bm9uZTt3aWxsLWNoYW5nZTpkaXNwbGF5LHdpZHRoLGhlaWdodCxsZWZ0LHRvcDtjdXJzb3I6JyArIChjZmcuY3Vyc29yID8gJ2RlZmF1bHQnIDogJ25vbmUnKSArICc7IH1cCgkJI21waXYtcG9wdXAubXBpdi1zaG93IHsgZGlzcGxheTppbmxpbmU7IH1cCgkJI1lUTFQtcHJldmlldywgYm9keSA+IGRpdi50aXBzeSB7IGRpc3BsYXk6bm9uZSFpbXBvcnRhbnQ7IH1cCgkJLm1waXYtbG9hZGluZzpub3QoLm1waXYtcHJlbG9hZGluZykgKiB7IGN1cnNvcjp3YWl0IWltcG9ydGFudDsgfVwKCQkubXBpdi1lZGdlICNtcGl2LXBvcHVwIHsgY3Vyc29yOmRlZmF1bHQ7IH1cCgkJLm1waXYtZXJyb3IgKiB7IGN1cnNvcjpub3QtYWxsb3dlZCFpbXBvcnRhbnQ7IH1cCgkJLm1waXYtcmVhZHkgKiwgLm1waXYtbGFyZ2UgKiB7IGN1cnNvcjp6b29tLWluIWltcG9ydGFudDsgY3Vyc29yOi13ZWJraXQtem9vbS1pbiFpbXBvcnRhbnQ7IH1cCgkJLm1waXYtc2hpZnQgKiB7IGN1cnNvcjpkZWZhdWx0IWltcG9ydGFudDsgfScgKwoJCShjb250YWlucyhjZmcuY3NzLCAneycpID8gY2ZnLmNzcyA6ICcjbXBpdi1wb3B1cCB7JyArIGNmZy5jc3MgKyAnfScpICsKCQkoXy5jc3MgPyBfLmNzcyA6ICcnKSk7CglfLnpvb21pbmcgPSBjb250YWlucyhjZmcuY3NzLCAnbXBpdi16b29taW5nJyk7CglbXy5ub2RlLnBhcmVudE5vZGUsIF8ubm9kZSwgXy5ub2RlLmZpcnN0RWxlbWVudENoaWxkXS5zb21lKGZ1bmN0aW9uKG4pIHsKCQkJaWYobiAmJiBuLnRpdGxlICYmIG4udGl0bGUgIT0gbi50ZXh0Q29udGVudCAmJiAhY29udGFpbnMoZC50aXRsZSwgbi50aXRsZSkgJiYgIS9eaHR0cFxTKyQvLnRlc3Qobi50aXRsZSkpIHsKCQkJCV8udG9vbHRpcCA9IHtub2RlOm4sIHRleHQ6bi50aXRsZX07CgkJCQluLnRpdGxlID0gJyc7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0pOwoJb24oZCwgJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlKTsKCW9uKGQsICdtb3VzZW91dCcsIG9uTW91c2VPdXQpOwoJb24oZCwgJ21vdXNlZG93bicsIG9uTW91c2VEb3duKTsKCW9uKGQsICdjb250ZXh0bWVudScsIG9uQ29udGV4dCk7CglvbihkLCAna2V5ZG93bicsIG9uS2V5RG93bik7CglvbihkLCAna2V5dXAnLCBvbktleVVwKTsKCW9uKGQsICdvbndoZWVsJyBpbiBkID8gJ3doZWVsJyA6ICdtb3VzZXdoZWVsJywgb25Nb3VzZVNjcm9sbCk7CglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gZGVhY3RpdmF0ZSh3YWl0KSB7Cgl3bi5jbGVhclRpbWVvdXQoXy50aW1lb3V0KTsKCWlmKF8ucmVxKSB0cnkgeyBfLnJlcS5hYm9ydCgpOyB9IGNhdGNoKGV4KSB7fQoJaWYoXy50b29sdGlwKSBfLnRvb2x0aXAubm9kZS50aXRsZSA9IF8udG9vbHRpcC50ZXh0OwoJdXBkYXRlVGl0bGUodHJ1ZSk7CglzZXRTdGF0dXMoZmFsc2UpOwoJc2V0UG9wdXAoZmFsc2UpOwoJc2V0QmFyKGZhbHNlKTsKCXJtKF8uc3R5bGUpOwoJXyA9IHt9OwoJb2ZmKGQsICdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSk7CglvZmYoZCwgJ21vdXNlb3V0Jywgb25Nb3VzZU91dCk7CglvZmYoZCwgJ21vdXNlZG93bicsIG9uTW91c2VEb3duKTsKCW9mZihkLCAnY29udGV4dG1lbnUnLCBvbkNvbnRleHQpOwoJb2ZmKGQsICdrZXlkb3duJywgb25LZXlEb3duKTsKCW9mZihkLCAna2V5dXAnLCBvbktleVVwKTsKCW9mZihkLCAnb253aGVlbCcgaW4gZCA/ICd3aGVlbCcgOiAnbW91c2V3aGVlbCcsIG9uTW91c2VTY3JvbGwpOwoJaWYod2FpdCkgewoJCWVuYWJsZWQgPSBmYWxzZTsKCQl3bi5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBlbmFibGVkID0gdHJ1ZTsgfSwgMjAwKTsKCX0KfQoKZnVuY3Rpb24gcGFyc2VOb2RlKG5vZGUpIHsKCXZhciBhLCBpbWcsIHVybCwgaW5mbzsKCWlmKCFob3N0cykgeyBob3N0cyA9IGxvYWRIb3N0cygpOyBHTV9yZWdpc3Rlck1lbnVDb21tYW5kKCdTZXQgdXAgTW91c2VvdmVyIFBvcHVwIEltYWdlIFZpZXdlcicsIHNldHVwKTsgfQoJaWYodGFnKG5vZGUpID09ICdBJykgewoJCWEgPSBub2RlOwoJfSBlbHNlIHsKCQlpZih0YWcobm9kZSkgPT0gJ0lNRycpIHsKCQkJaW1nID0gbm9kZTsKCQkJaWYoaW1nLnNyYy5zdWJzdHIoMCwgNSkgIT0gJ2RhdGE6JykgdXJsID0gcmVsMmFicyhpbWcuc3JjLCBsb2NhdGlvbi5ocmVmKTsKCQl9CgkJaW5mbyA9IGZpbmRJbmZvKHVybCwgbm9kZSk7CgkJaWYoaW5mbykgcmV0dXJuIGluZm87CgkJYSA9IHRhZyhub2RlLnBhcmVudE5vZGUpID09ICdBJyA/IG5vZGUucGFyZW50Tm9kZSA6ICh0YWcobm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUpID09ICdBJyA/IG5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlIDogZmFsc2UpOwoJfQoJaWYoYSkgewoJCXVybCA9IGEuZ2V0QXR0cmlidXRlKCdkYXRhLWV4cGFuZGVkLXVybCcpIHx8IGEuZ2V0QXR0cmlidXRlKCdkYXRhLWZ1bGwtdXJsJykgfHwgYS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdXJsJykgfHwgYS5ocmVmOwoJCWlmKHVybC5sZW5ndGggPiA3NTAgfHwgdXJsLnN1YnN0cigwLCA1KSA9PSAnZGF0YTonKSB1cmwgPSBmYWxzZTsKCQllbHNlIGlmKGNvbnRhaW5zKHVybCwgJy8vdC5jby8nKSkgdXJsID0gJ2h0dHA6Ly8nICsgYS50ZXh0Q29udGVudDsKCQlpbmZvID0gZmluZEluZm8odXJsLCBhKTsKCQlpZihpbmZvKSByZXR1cm4gaW5mbzsKCX0KCWlmKGltZykgcmV0dXJuIHt1cmw6aW1nLnNyYywgbm9kZTppbWcsIHJlY3Q6cmVjdChpbWcpLCBkaXN0aW5jdDp0cnVlfTsKfQoKZnVuY3Rpb24gZmluZEluZm8odXJsLCBub2RlLCBub0h0bWwsIHNraXBIb3N0KSB7Cglmb3IodmFyIGkgPSAwLCBsZW4gPSBob3N0cy5sZW5ndGgsIHRuID0gdGFnKG5vZGUpLCBoLCBtLCBodG1sLCB1cmxzOyBpIDwgbGVuICYmIChoID0gaG9zdHNbaV0pOyBpKyspIHsKCQlpZihoLmUgJiYgIW1hdGNoZXMobm9kZSwgaC5lKSB8fCBoID09IHNraXBIb3N0KSBjb250aW51ZTsKCQlpZihoLnIpIHsKCQkJaWYoaC5odG1sICYmICFub0h0bWwgJiYgKHRuID09ICdBJyB8fCB0biA9PSAnSU1HJyB8fCBoLmUpKSB7CgkJCQlpZighaHRtbCkgaHRtbCA9IG5vZGUub3V0ZXJIVE1MOwoJCQkJbSA9IGguci5leGVjKGh0bWwpOwoJCQl9IGVsc2UgaWYodXJsKSB7CgkJCQltID0gaC5yLmV4ZWModXJsKTsKCQkJfSBlbHNlIHsKCQkJCW0gPSBudWxsOwoJCQl9CgkJfSBlbHNlIHsKCQkJbSA9IHVybCA/IC8uKi8uZXhlYyh1cmwpIDogW107CgkJfQoJCWlmKCFtIHx8IHRuID09ICdJTUcnICYmICEoJ3MnIGluIGgpKSBjb250aW51ZTsKCQlpZigncycgaW4gaCkgewoJCQl1cmxzID0gKEFycmF5LmlzQXJyYXkoaC5zKSA/IGgucyA6IFtoLnNdKS5tYXAoZnVuY3Rpb24ocykgeyBpZih0eXBlb2YgcyA9PSAnc3RyaW5nJykgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXBsYWNlKHMsIG0pKTsgaWYodHlwZW9mIHMgPT0gJ2Z1bmN0aW9uJykgcmV0dXJuIHMobSwgbm9kZSk7IHJldHVybiBzOyB9KTsKCQkJaWYoaC5xICYmIHVybHMubGVuZ3RoID4gMSkgeyBjb25zb2xlLmxvZygnUnVsZSBkaXNjYXJkZWQuIFN1YnN0aXR1dGlvbiBhcnJheXMgY2FuXCd0IGJlIGNvbWJpbmVkIHdpdGggcHJvcGVydHkgcS4nKTsgY29udGludWU7IH0KCQkJaWYoQXJyYXkuaXNBcnJheSh1cmxzWzBdKSkgdXJscyA9IHVybHNbMF07CgkJCWlmKHVybHNbMF0gPT09IGZhbHNlKSBjb250aW51ZTsKCQkJdXJscyA9IHVybHMubWFwKGZ1bmN0aW9uKHUpIHsgcmV0dXJuIHUgPyBkZWNvZGVVUklDb21wb25lbnQodSkgOiB1OyB9KTsKCQl9IGVsc2UgewoJCQl1cmxzID0gW20uaW5wdXRdOwoJCX0KCQlpZigoaC5mb2xsb3cgPT09IHRydWUgfHwgdHlwZW9mIGguZm9sbG93ID09ICdmdW5jdGlvbicgJiYgaC5mb2xsb3codXJsc1swXSkpICYmICFoLnEgJiYgaC5zKSByZXR1cm4gZmluZEluZm8odXJsc1swXSwgbm9kZSwgZmFsc2UsIGgpOwoJCXZhciBpbmZvID0gewoJCQlub2RlOiBub2RlLAoJCQl1cmw6IHVybHMuc2hpZnQoKSwKCQkJdXJsczogdXJscy5sZW5ndGggPyB1cmxzIDogZmFsc2UsCgkJCXI6IGguciwKCQkJcTogaC5xLAoJCQljOiBoLmMsCgkJCWc6IGguZyA/IGxvYWRHYWxsZXJ5UGFyc2VyKGguZykgOiBoLmcsCgkJCXhocjogY2ZnLnhociAmJiBoLnhociwKCQkJdGFiZml4OiBoLnRhYmZpeCwKCQkJcG9zdDogdHlwZW9mIGgucG9zdCA9PSAnZnVuY3Rpb24nID8gaC5wb3N0KG0pIDogaC5wb3N0LAoJCQlmb2xsb3c6IGguZm9sbG93LAoJCQljc3M6IGguY3NzLAoJCQltYW51YWw6IGgubWFudWFsLAoJCQlkaXN0aW5jdDogaC5kaXN0aW5jdCwKCQkJcmVjdDogcmVjdChub2RlLCBoLnJlY3QpCgkJfTsKCQlpZihjb250YWlucyhob3N0bmFtZSwgJ3R3aXR0ZXIuY29tJykgJiYgIS8oZmFjZWJvb2t8Z29vZ2xlfHR3aW1nfHR3aXR0ZXIpXC5jb21cLy8udGVzdChpbmZvLnVybCkgfHwgaG9zdG5hbWUgPT0gJ2dpdGh1Yi5jb20nICYmICEvZ2l0aHViLy50ZXN0KGluZm8udXJsKSB8fCBjb250YWlucyhob3N0bmFtZSwgJ2ZhY2Vib29rLmNvbScpICYmIC9cYmltZ3VyXC5jb20vLnRlc3QoaW5mby51cmwpKSBpbmZvLnhociA9ICdkYXRhJzsKCQlyZXR1cm4gaW5mbzsKCX0KfQoKZnVuY3Rpb24gZG93bmxvYWRQYWdlKHVybCwgY2IpIHsKCXZhciByZXEsIG9wdHMgPSB7CgkJbWV0aG9kOiAnR0VUJywKCQl1cmw6IHVybCwKCQlvbmxvYWQ6IGZ1bmN0aW9uKHJlcykgewoJCQl0cnkgewoJCQkJaWYocmVxICE9IF8ucmVxKSByZXR1cm47CgkJCQlkZWxldGUgXy5yZXE7CgkJCQlpZihyZXMuc3RhdHVzID4gMzk5KSB0aHJvdyAnU2VydmVyIGVycm9yOiAnICsgcmVzLnN0YXR1czsKCQkJCWNiKHJlcy5yZXNwb25zZVRleHQsIHJlcy5maW5hbFVybCB8fCB1cmwpOwoJCQl9IGNhdGNoKGV4KSB7CgkJCQloYW5kbGVFcnJvcihleCk7CgkJCX0KCQl9LAoJCW9uZXJyb3I6IGZ1bmN0aW9uKHJlcykgewoJCQlpZihyZXEgPT0gXy5yZXEpIGhhbmRsZUVycm9yKHJlcyk7CgkJfQoJfTsKCWlmKF8ucG9zdCkgewoJCW9wdHMubWV0aG9kID0gJ1BPU1QnOwoJCW9wdHMuZGF0YSA9IF8ucG9zdDsKCQlvcHRzLmhlYWRlcnMgPSB7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcsJ1JlZmVyZXInOnVybH07Cgl9CglfLnJlcSA9IHJlcSA9IEdNX3htbGh0dHBSZXF1ZXN0KG9wdHMpOwp9CgpmdW5jdGlvbiBkb3dubG9hZEltYWdlKHVybCwgcmVmZXJlcikgewoJdmFyIHN0YXJ0ID0gRGF0ZS5ub3coKSwgYmFyLCByZXE7CglfLnJlcSA9IHJlcSA9IEdNX3htbGh0dHBSZXF1ZXN0KHsKCQltZXRob2Q6ICdHRVQnLAoJCXVybDogdXJsLAoJCW92ZXJyaWRlTWltZVR5cGU6ICd0ZXh0L3BsYWluOyBjaGFyc2V0PXgtdXNlci1kZWZpbmVkJywKCQloZWFkZXJzOiB7J0FjY2VwdCc6J2ltYWdlL3BuZyxpbWFnZS8qO3E9MC44LCovKjtxPTAuNScsJ1JlZmVyZXInOnJlZmVyZXJ9LAoJCW9ucHJvZ3Jlc3M6IGZ1bmN0aW9uKGUpIHsKCQkJaWYocmVxICE9IF8ucmVxKSByZXR1cm47CgkJCWlmKCFiYXIgJiYgRGF0ZS5ub3coKSAtIHN0YXJ0ID4gMzAwMCAmJiBlLmxvYWRlZC9lLnRvdGFsIDwgMC41KSBiYXIgPSB0cnVlOwoJCQlpZihiYXIpIHNldEJhcihwYXJzZUludChlLmxvYWRlZC9lLnRvdGFsICogMTAwKSArICclIG9mICcgKyAoZS50b3RhbC8xMDAwMDAwKS50b0ZpeGVkKDEpICsgJyBNQicsICd4aHInKTsKCQl9LAoJCW9ubG9hZDogZnVuY3Rpb24ocmVzKSB7CgkJCXRyeSB7CgkJCQlpZihyZXEgIT0gXy5yZXEpIHJldHVybjsKCQkJCWRlbGV0ZSBfLnJlcTsKCQkJCXNldEJhcihmYWxzZSk7CgkJCQlpZihyZXMuc3RhdHVzID4gMzk5KSB0aHJvdyAnSFRUUCBlcnJvciAnICsgcmVzLnN0YXR1czsKCQkJCXZhciB0eHQgPSByZXMucmVzcG9uc2VUZXh0LCB1aTggPSBuZXcgVWludDhBcnJheSh0eHQubGVuZ3RoKSwgdHlwZTsKCQkJCWZvcih2YXIgaSA9IHR4dC5sZW5ndGg7IGktLTspIHsKCQkJCQl1aThbaV0gPSB0eHQuY2hhckNvZGVBdChpKTsKCQkJCX0KCQkJCWlmKC9Db250ZW50LVR5cGU6XHMqKC4rKS9pLmV4ZWMocmVzLnJlc3BvbnNlSGVhZGVycykgJiYgIWNvbnRhaW5zKFJlZ0V4cC4kMSwgJ3RleHQvcGxhaW4nKSkgdHlwZSA9IFJlZ0V4cC4kMTsKCQkJCWlmKCF0eXBlKSB7CgkJCQkJdmFyIGV4dCA9IC9cLihbYS16MC05XSs/KSgkfFw/fCMpL2kuZXhlYyh1cmwpID8gUmVnRXhwLiQxLnRvTG93ZXJDYXNlKCkgOiAnanBnJywgdHlwZXMgPSB7Ym1wOidpbWFnZS9ibXAnLCBnaWY6J2ltYWdlL2dpZicsIGpwZTonaW1hZ2UvanBlZycsIGpwZWc6J2ltYWdlL2pwZWcnLCBqcGc6J2ltYWdlL2pwZWcnLCBtcDQ6J3ZpZGVvL21wNCcsIHBuZzonaW1hZ2UvcG5nJywgc3ZnOidpbWFnZS9zdmcreG1sJywgdGlmOidpbWFnZS90aWZmJywgdGlmZjonaW1hZ2UvdGlmZicsIHdlYm06J3ZpZGVvL3dlYm0nfTsKCQkJCQl0eXBlID0gZXh0IGluIHR5cGVzID8gdHlwZXNbZXh0XSA6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOwoJCQkJfQoJCQkJdmFyIGIgPSBuZXcgQmxvYihbdWk4LmJ1ZmZlcl0sIHt0eXBlOnR5cGV9KTsKCQkJCWlmKHduLlVSTCAmJiBfLnhociAhPSAnZGF0YScpIHJldHVybiBzZXRQb3B1cCh3bi5VUkwuY3JlYXRlT2JqZWN0VVJMKGIpKTsKCQkJCXZhciBmciA9IG5ldyBGaWxlUmVhZGVyKCk7CgkJCQlmci5vbmxvYWQgPSBmdW5jdGlvbigpIHsgc2V0UG9wdXAoZnIucmVzdWx0KTsgfTsKCQkJCWZyLm9uZXJyb3IgPSBoYW5kbGVFcnJvcjsKCQkJCWZyLnJlYWRBc0RhdGFVUkwoYik7CgkJCX0gY2F0Y2goZXgpIHsKCQkJCWhhbmRsZUVycm9yKGV4KTsKCQkJfQoJCX0sCgkJb25lcnJvcjogZnVuY3Rpb24ocmVzKSB7CgkJCWlmKHJlcSA9PSBfLnJlcSkgaGFuZGxlRXJyb3IocmVzKTsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gZmluZFJlZGlyZWN0KHVybCwgY2IpIHsKCXZhciByZXE7CglfLnJlcSA9IHJlcSA9IEdNX3htbGh0dHBSZXF1ZXN0KHsKCQl1cmw6IHVybCwKCQltZXRob2Q6ICdIRUFEJywKCQloZWFkZXJzOiB7UmVmZXJlcjpsb2NhdGlvbi5ocmVmLnJlcGxhY2UobG9jYXRpb24uaGFzaCwgJycpfSwKCQlvbmxvYWQ6IGZ1bmN0aW9uKHJlcykgewoJCQlpZihyZXEgPT0gXy5yZXEpIGNiKHJlcy5maW5hbFVybCk7CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIHBhcnNlUGFnZSh1cmwsIGNiKSB7Cglkb3dubG9hZFBhZ2UodXJsLCBmdW5jdGlvbihodG1sLCB1cmwpIHsKCQl2YXIgaXVybCwgY2FwLCBkb2MgPSBjcmVhdGVEb2MoaHRtbCk7CgkJaWYodHlwZW9mIF8ucSA9PSAnZnVuY3Rpb24nKSB7CgkJCWl1cmwgPSBfLnEoaHRtbCwgZG9jLCBfLm5vZGUpOwoJCQlpZihBcnJheS5pc0FycmF5KGl1cmwpKSB7CgkJCQlfLnVybHMgPSBpdXJsLnNsaWNlKDApOwoJCQkJaXVybCA9IF8udXJscy5zaGlmdCgpOwoJCQl9CgkJfSBlbHNlIHsKCQkJdmFyIGlub2RlID0gZmluZE5vZGUoXy5xLCBkb2MpOwoJCQlpdXJsID0gaW5vZGUgPyBmaW5kRmlsZShpbm9kZSwgdXJsKSA6IGZhbHNlOwoJCX0KCQlpZih0eXBlb2YgXy5jID09ICdmdW5jdGlvbicpIHsKCQkJY2FwID0gXy5jKGh0bWwsIGRvYywgXy5ub2RlKTsKCQl9IGVsc2UgaWYodHlwZW9mIF8uYyA9PSAnc3RyaW5nJykgewoJCQl2YXIgY25vZGUgPSBmaW5kTm9kZShfLmMsIGRvYyk7CgkJCWNhcCA9IGNub2RlID8gZmluZENhcHRpb24oY25vZGUpIDogJyc7CgkJfQoJCWNiKGl1cmwsIGNhcCwgdXJsKTsKCX0pOwp9CgpmdW5jdGlvbiBmaW5kTm9kZShxLCBkb2MpIHsKCXZhciBub2RlOwoJaWYoIXEpIHJldHVybjsKCWlmKCFBcnJheS5pc0FycmF5KHEpKSBxID0gW3FdOwoJZm9yKHZhciBpID0gMCwgbGVuID0gcS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCW5vZGUgPSBxcyhxW2ldLCBkb2MpOwoJCWlmKG5vZGUpIGJyZWFrOwoJfQoJcmV0dXJuIG5vZGU7Cn0KCmZ1bmN0aW9uIGZpbmRGaWxlKG4sIHVybCkgewoJdmFyIGJhc2UgPSBxcygnYmFzZVtocmVmXScsIG4ub3duZXJEb2N1bWVudCk7Cgl2YXIgcGF0aCA9ICBuLmdldEF0dHJpYnV0ZSgnc3JjJykgfHwgbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtbTR2JykgfHwgbi5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSB8fCBuLmdldEF0dHJpYnV0ZSgnY29udGVudCcpIHx8IC9odHRwcz86XC9cL1suXC9hLXowLTlfKyVcLV0rXC4oanBlP2d8Z2lmfHBuZ3xzdmd8d2VibXxtcDQpL2kuZXhlYyhuLm91dGVySFRNTCkgJiYgUmVnRXhwLmxhc3RNYXRjaDsKCXJldHVybiBwYXRoID8gcmVsMmFicyhwYXRoLnRyaW0oKSwgYmFzZSA/IGJhc2UuZ2V0QXR0cmlidXRlKCdocmVmJykgOiB1cmwpIDogZmFsc2U7Cn0KCmZ1bmN0aW9uIGZpbmRDYXB0aW9uKG4pIHsKCXJldHVybiBuLmdldEF0dHJpYnV0ZSgnY29udGVudCcpIHx8IG4uZ2V0QXR0cmlidXRlKCd0aXRsZScpIHx8IG4udGV4dENvbnRlbnQ7Cn0KCmZ1bmN0aW9uIGNoZWNrUHJvZ3Jlc3Moc3RhcnQpIHsKCWlmKHN0YXJ0ID09PSB0cnVlKSB7CgkJaWYoY2hlY2tQcm9ncmVzcy5pbnRlcnZhbCkgd24uY2xlYXJJbnRlcnZhbChjaGVja1Byb2dyZXNzLmludGVydmFsKTsKCQljaGVja1Byb2dyZXNzLmludGVydmFsID0gd24uc2V0SW50ZXJ2YWwoY2hlY2tQcm9ncmVzcywgMTUwKTsKCQlyZXR1cm47Cgl9Cgl2YXIgcCA9IF8ucG9wdXA7CglpZighcCkgcmV0dXJuIHduLmNsZWFySW50ZXJ2YWwoY2hlY2tQcm9ncmVzcy5pbnRlcnZhbCk7CglpZighdXBkYXRlU2l6ZSgpKSByZXR1cm47Cgl3bi5jbGVhckludGVydmFsKGNoZWNrUHJvZ3Jlc3MuaW50ZXJ2YWwpOwoJaWYoXy5wcmVsb2FkU3RhcnQpIHsKCQl2YXIgd2FpdCA9IF8ucHJlbG9hZFN0YXJ0ICsgY2ZnLmRlbGF5IC0gRGF0ZS5ub3coKTsKCQlpZih3YWl0ID4gMCkgcmV0dXJuIF8udGltZW91dCA9IHduLnNldFRpbWVvdXQoY2hlY2tQcm9ncmVzcywgd2FpdCk7Cgl9CglpZihfLnVybHMgJiYgXy51cmxzLmxlbmd0aCAmJiBNYXRoLm1heChfLm5oZWlnaHQsIF8ubndpZHRoKSA8IDEzMCkgcmV0dXJuIGhhbmRsZUVycm9yKHt0eXBlOidlcnJvcid9KTsKCXNldFN0YXR1cyhmYWxzZSk7CglwLmNsaWVudEhlaWdodDsKCXAuY2xhc3NOYW1lID0gJ21waXYtc2hvdyc7Cgl1cGRhdGVTcGFjaW5nKCk7Cgl1cGRhdGVTY2FsZXMoKTsKCXVwZGF0ZVRpdGxlKCk7CglwbGFjZVBvcHVwKCk7CglpZighXy5iYXIpIHNob3dGaWxlSW5mbygpOwoJaWYoXy5sYXJnZSA9IF8ubndpZHRoID4gcC5jbGllbnRXaWR0aCArIF8ubWJ3IHx8IF8ubmhlaWdodCA+IHAuY2xpZW50SGVpZ2h0ICsgXy5tYmgpIHNldFN0YXR1cygnbGFyZ2UnKTsKCWlmKGNmZy5pbWd0YWIgJiYgaW1ndGFiIHx8IGNmZy56b29tID09ICdhdXRvJykgdG9nZ2xlWm9vbSgpOwp9CgpmdW5jdGlvbiB1cGRhdGVTaXplKCkgewoJdmFyIHAgPSBfLnBvcHVwOwoJXy5uaGVpZ2h0ID0gcC5uYXR1cmFsSGVpZ2h0IHx8IHAudmlkZW9IZWlnaHQgfHwgcC5sb2FkZWQgJiYgODAwOwoJXy5ud2lkdGggID0gcC5uYXR1cmFsV2lkdGggfHwgcC52aWRlb1dpZHRoIHx8IHAubG9hZGVkICYmIDEyMDA7CglyZXR1cm4gISFfLm5oZWlnaHQ7Cn0KCmZ1bmN0aW9uIHVwZGF0ZVNwYWNpbmcoKSB7Cgl2YXIgcyA9IHduLmdldENvbXB1dGVkU3R5bGUoXy5wb3B1cCk7CglfLnB3ID0gc3R5bGVTdW0ocywgWydwYWRkaW5nLWxlZnQnLCAncGFkZGluZy1yaWdodCddKTsKCV8ucGggPSBzdHlsZVN1bShzLCBbJ3BhZGRpbmctdG9wJywgJ3BhZGRpbmctYm90dG9tJ10pOwoJXy5tYncgPSBzdHlsZVN1bShzLCBbJ21hcmdpbi1sZWZ0JywgJ21hcmdpbi1yaWdodCcsICdib3JkZXItbGVmdC13aWR0aCcsICdib3JkZXItcmlnaHQtd2lkdGgnXSk7CglfLm1iaCA9IHN0eWxlU3VtKHMsIFsnbWFyZ2luLXRvcCcsICdtYXJnaW4tYm90dG9tJywgJ2JvcmRlci10b3Atd2lkdGgnLCAnYm9yZGVyLWJvdHRvbS13aWR0aCddKTsKfQoKZnVuY3Rpb24gdXBkYXRlU2NhbGVzKCkgewoJdmFyIHNjYWxlcyA9IGNmZy5zY2FsZXMubGVuZ3RoID8gY2ZnLnNjYWxlcyA6IFsnMCEnLCAwLjEyNSwgMC4yNSwgMC41LCAwLjc1LCAxLCAxLjUsIDIsIDMsIDUsIDgsIDE2XSwgZml0ID0gTWF0aC5taW4oKCBfLnZpZXcud2lkdGggLSBfLm1idykvXy5ud2lkdGgsIChfLnZpZXcuaGVpZ2h0IC0gXy5tYmgpL18ubmhlaWdodCksIGN1dG9mZiA9IF8uc2NhbGUgPSBNYXRoLm1pbigxLCBmaXQpOwoJXy5zY2FsZXMgPSBbXTsKCWZvcih2YXIgaSA9IHNjYWxlcy5sZW5ndGg7IGktLTspIHsKCQl2YXIgdmFsID0gcGFyc2VGbG9hdChzY2FsZXNbaV0pIHx8IGZpdCwgb3B0ID0gdHlwZW9mIHNjYWxlc1tpXSA9PSAnc3RyaW5nJyA/IHNjYWxlc1tpXS5zbGljZSgtMSkgOiAwOwoJCWlmKG9wdCA9PSAnIScpIGN1dG9mZiA9IHZhbDsKCQlpZihvcHQgPT0gJyonKSBfLnpzY2FsZSA9IHZhbDsKCQlpZih2YWwgIT0gXy5zY2FsZSkgXy5zY2FsZXMucHVzaCh2YWwpOwoJfQoJXy5zY2FsZXMgPSBfLnNjYWxlcy5maWx0ZXIoZnVuY3Rpb24oeCkgeyByZXR1cm4geCA+PSBjdXRvZmY7IH0pOwoJXy5zY2FsZXMuc29ydChmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhIC0gYjsgfSk7CglfLnNjYWxlcy51bnNoaWZ0KF8uc2NhbGUpOwp9CgpmdW5jdGlvbiB1cGRhdGVNb3VzZShlKSB7CglfLmN4ID0gZS5jbGllbnRYOwoJXy5jeSA9IGUuY2xpZW50WTsKCXZhciByID0gXy5yZWN0OwoJaWYocikgXy5jciA9IF8uY3ggPCByLnJpZ2h0ICsgMiAmJiBfLmN4ID4gci5sZWZ0IC0gMiAmJiBfLmN5IDwgci5ib3R0b20gKyAyICYmIF8uY3kgPiByLnRvcCAtIDI7Cn0KCmZ1bmN0aW9uIHNob3dGaWxlSW5mbygpIHsKCWlmKF8uZ0l0ZW1zKSB7CgkJdmFyIGl0ZW0gPSBfLmdJdGVtc1tfLmdJbmRleF07CgkJdmFyIGMgPSBfLmdJdGVtcy5sZW5ndGggPiAxID8gJ1snICsgKF8uZ0luZGV4ICsgMSkgKyAnLycgKyBfLmdJdGVtcy5sZW5ndGggKyAnXSAnIDogJyc7CgkJaWYoXy5nSW5kZXggPT0gMCAmJiBfLmdJdGVtcy50aXRsZSAmJiAoIWl0ZW0uZGVzYyB8fCAhY29udGFpbnMoaXRlbS5kZXNjLCBfLmdJdGVtcy50aXRsZSkpKSBjICs9IF8uZ0l0ZW1zLnRpdGxlICsgKGl0ZW0uZGVzYyA/ICcgLSAnIDogJycpOwoJCWlmKGl0ZW0uZGVzYykgYyArPSBpdGVtLmRlc2M7CgkJaWYoYykgc2V0QmFyKGMudHJpbSgpLCAnZ2FsbGVyeScsIHRydWUpOwoJfSBlbHNlIGlmKCdjYXB0aW9uJyBpbiBfKSB7CgkJc2V0QmFyKF8uY2FwdGlvbiwgJ2NhcHRpb24nKTsKCX0gZWxzZSBpZihfLnRvb2x0aXApIHsKCQlzZXRCYXIoXy50b29sdGlwLnRleHQsICd0b29sdGlwJyk7Cgl9Cn0KCmZ1bmN0aW9uIHVwZGF0ZVRpdGxlKHJlc2V0KSB7CglpZihyZXNldCkgewoJCWlmKHR5cGVvZiBfLnRpdGxlID09ICdzdHJpbmcnKSBkLnRpdGxlID0gXy50aXRsZTsKCX0gZWxzZSB7CgkJaWYodHlwZW9mIF8udGl0bGUgIT0gJ3N0cmluZycpIF8udGl0bGUgPSBkLnRpdGxlOwoJCWQudGl0bGUgPSBNYXRoLnJvdW5kKF8uc2NhbGUgKiAxMDApICsgJyUgLSAnICsgXy5ud2lkdGggKyAneCcgKyBfLm5oZWlnaHQ7Cgl9Cn0KCmZ1bmN0aW9uIHBsYWNlUG9wdXAoKSB7Cgl2YXIgcCA9IF8ucG9wdXA7CglpZighcCkgcmV0dXJuOwoJdmFyIHggPSBudWxsLCB5ID0gbnVsbCwgdyA9IE1hdGgucm91bmQoXy5zY2FsZSAqIF8ubndpZHRoKSwgaCA9IE1hdGgucm91bmQoXy5zY2FsZSAqIF8ubmhlaWdodCksIGN4ID0gXy5jeCwgY3kgPSBfLmN5LCB2dyA9IF8udmlldy53aWR0aCwgdmggPSBfLnZpZXcuaGVpZ2h0OwoJaWYoIV8uem9vbSAmJiAoIV8uZ0l0ZW1zIHx8IF8uZ0l0ZW1zLmxlbmd0aCA8IDIpICYmICFjZmcuY2VudGVyKSB7CgkJdmFyIHIgPSBfLnJlY3QsIHJ4ID0gKHIubGVmdCArIHIucmlnaHQpIC8gMiwgcnkgPSAoci50b3AgKyByLmJvdHRvbSkgLyAyOwoJCWlmKHZ3IC0gci5yaWdodCAtIDQwID4gdyArIF8ubWJ3IHx8IHcgKyBfLm1idyA8IHIubGVmdCAtIDQwKSB7CgkJCWlmKGggKyBfLm1iaCA8IHZoIC0gNjApIHkgPSBNYXRoLm1pbihNYXRoLm1heChyeSAtIGgvMiwgMzApLCB2aCAtIGggLSAzMCk7CgkJCXggPSByeCA+IHZ3LzIgPyByLmxlZnQgLSA0MCAtIHcgOiByLnJpZ2h0ICsgNDA7CgkJfSBlbHNlIGlmKHZoIC0gci5ib3R0b20gLSA0MCA+IGggKyBfLm1iaCB8fCBoICsgXy5tYmggPCByLnRvcCAtIDQwKSB7CgkJCWlmKHcgKyBfLm1idyA8IHZ3IC0gNjApIHggPSBNYXRoLm1pbihNYXRoLm1heChyeCAtIHcvMiwgMzApLCB2dyAtIHcgLSAzMCk7CgkJCXkgPSByeSA+IHZoLzIgPyByLnRvcCAtIDQwIC0gaCA6IHIuYm90dG9tICsgNDA7CgkJfQoJfQoJaWYoeCA9PSBudWxsKSB4ID0gTWF0aC5yb3VuZCgodncgPiB3ID8gdncvMiAtIHcvMiA6IC0xICogTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgNS8zKihjeC92dy0wLjIpKSkgKiAodyAtIHZ3KSkgLSAoXy5wdyArIF8ubWJ3KS8yKTsKCWlmKHkgPT0gbnVsbCkgeSA9IE1hdGgucm91bmQoKHZoID4gaCA/IHZoLzIgLSBoLzIgOiAtMSAqIE1hdGgubWluKDEsIE1hdGgubWF4KDAsIDUvMyooY3kvdmgtMC4yKSkpICogKGggLSB2aCkpIC0gKF8ucGggKyBfLm1iaCkvMik7CglwLnN0eWxlLmNzc1RleHQgPSAnd2lkdGg6JyArIHcgKyAncHghaW1wb3J0YW50O2hlaWdodDonICsgaCArICdweCFpbXBvcnRhbnQ7bGVmdDonICsgeCArICdweCFpbXBvcnRhbnQ7dG9wOicgKyB5ICsgJ3B4IWltcG9ydGFudCc7Cn0KCmZ1bmN0aW9uIHRvZ2dsZVpvb20oKSB7Cgl2YXIgcCA9IF8ucG9wdXA7CglpZighcCB8fCAhXy5zY2FsZXMgfHwgXy5zY2FsZXMubGVuZ3RoIDwgMikgcmV0dXJuOwoJXy56b29tID0gIV8uem9vbTsKCV8uem9vbWVkID0gdHJ1ZTsKCV8uc2NhbGUgPSBfLnNjYWxlc1sgXy56b29tID8gKF8uc2NhbGVzLmluZGV4T2YoXy56c2NhbGUpID4gMCA/IF8uc2NhbGVzLmluZGV4T2YoXy56c2NhbGUpIDogMSkgOiAwXTsKCWlmKF8uem9vbWluZykgcC5jbGFzc0xpc3QuYWRkKCdtcGl2LXpvb21pbmcnKTsKCXBsYWNlUG9wdXAoKTsKCXVwZGF0ZVRpdGxlKCk7CglzZXRTdGF0dXMoXy56b29tID8gJ3pvb20nIDogZmFsc2UpOwoJaWYoY2ZnLnpvb20gIT0gJ2F1dG8nKSBzZXRCYXIoZmFsc2UpOwoJaWYoIV8uem9vbSkgc2hvd0ZpbGVJbmZvKCk7CglyZXR1cm4gXy56b29tOwp9CgpmdW5jdGlvbiBoYW5kbGVFcnJvcihvKSB7Cgl2YXIgbSA9IFtvLm1lc3NhZ2UgfHwgKG8ucmVhZHlTdGF0ZSA/ICdSZXF1ZXN0IGZhaWxlZC4nIDogKG8udHlwZSA9PSAnZXJyb3InID8gJ0ZpbGUgY2FuXCd0IGJlIGRpc3BsYXllZC4nICsgKHFzKCdkaXZbYmdhY3RpdmUqPSJmbGFzaGJsb2NrIl0nLCBkKSA/ICcgQ2hlY2sgRmxhc2hibG9jayBzZXR0aW5ncy4nIDogJycpIDogbykpXTsKCQl0cnkgewoJCQlpZihvLnN0YWNrKSBtLnB1c2goJyBAICcgKyBvLnN0YWNrLnJlcGxhY2UoLzw/QGZpbGU6Lis/XC5qcy9nLCAnJykpOwoJCQlpZihfLnIpIG0ucHVzaCgnUmVnRXhwOiAnICsgXy5yKTsKCQkJaWYoXy51cmwpIG0ucHVzaCgnVVJMOiAnICsgXy51cmwpOwoJCQlpZihfLml1cmwpIG0ucHVzaCgnRmlsZTogJyArIF8uaXVybCk7CgkJCWNvbnNvbGUubG9nKG0uam9pbignXG4nKSk7CgkJfSBjYXRjaChleCkge30KCWlmKGNvbnRhaW5zKGhvc3RuYW1lLCAnZ29vZ2xlJykgJiYgY29udGFpbnMobG9jYXRpb24uc2VhcmNoLCAndGJtPWlzY2gnKSAmJiAhXy54aHIgJiYgY2ZnLnhocikgewoJCV8ueGhyID0gdHJ1ZTsKCQlzdGFydFNpbmdsZVBvcHVwKF8udXJsKTsKCX0gZWxzZSBpZihfLnVybHMgJiYgXy51cmxzLmxlbmd0aCkgewoJCV8udXJsID0gXy51cmxzLnNoaWZ0KCk7CgkJaWYoIV8udXJsKQoJCQlkZWFjdGl2YXRlKCk7CgkJZWxzZQoJCQlzdGFydFNpbmdsZVBvcHVwKF8udXJsKTsKCX0gZWxzZSBpZihfLm5vZGUpIHsKCQlzZXRTdGF0dXMoJ2Vycm9yJyk7CgkJc2V0QmFyKG1bMF0sICdlcnJvcicpOwoJfQp9CgpmdW5jdGlvbiBzZXRTdGF0dXMoc3RhdHVzLCBmbGFnKSB7Cgl2YXIgZGUgPSBkLmRvY3VtZW50RWxlbWVudCwgY24gPSBkZS5jbGFzc05hbWU7CglpZihmbGFnID09ICdyZW1vdmUnKSB7CiAgICAgICAgY24gPSBjbi5yZXBsYWNlKCdtcGl2LScgKyBzdGF0dXMsICcnKTsKCX0gZWxzZSB7CgkJaWYoZmxhZyAhPSAnYWRkJykgY24gPSBjbi5yZXBsYWNlKC9tcGl2LVthLXpdKy9nLCAnJyk7CgkJaWYoc3RhdHVzICYmICFjb250YWlucyhjbiwgJ21waXYtJyArIHN0YXR1cykpIGNuICs9ICcgbXBpdi0nICsgc3RhdHVzOwoJfQoJZGUuY2xhc3NOYW1lID0gY247Cn0KCmZ1bmN0aW9uIHNldFBvcHVwKHNyYykgewoJdmFyIHAgPSBfLnBvcHVwOwoJaWYocCkgewoJCV8uem9vbSA9IGZhbHNlOwoJCW9mZihwLCAnZXJyb3InLCBoYW5kbGVFcnJvcik7CgkJaWYodHlwZW9mIHAucGF1c2UgPT0gJ2Z1bmN0aW9uJykgcC5wYXVzZSgpOwoJCWlmKCFfLmxhenlVbmxvYWQpIHsKCQkJaWYocC5zcmMuc3Vic3RyKDAsIDUpID09ICdibG9iOicpIHduLlVSTC5yZXZva2VPYmplY3RVUkwocC5zcmMpOwoJCQlwLnNyYyA9ICcnOwoJCX0KCQlybShwKTsKCQlkZWxldGUgXy5wb3B1cDsKCX0KCWlmKCFzcmMpIHJldHVybjsKCWlmKHNyYy5zdWJzdHIoMCwgNSkgIT0gJ2RhdGE6JyAmJiAvXC4od2VibXxtcDQpKCR8XD8pLy50ZXN0KHNyYykgfHwgc3JjLnN1YnN0cigwLCAxMCkgPT0gJ2RhdGE6dmlkZW8nKSB7CgkJdmFyIHN0YXJ0ID0gRGF0ZS5ub3coKSwgYmFyOwoJCXZhciBvblByb2dyZXNzID0gZnVuY3Rpb24oZSkgewoJCQl2YXIgcCA9IGUudGFyZ2V0OwoJCQlpZighcC5kdXJhdGlvbiB8fCAhcC5idWZmZXJlZC5sZW5ndGggfHwgRGF0ZS5ub3coKSAtIHN0YXJ0IDwgMjAwMCkgcmV0dXJuOwoJCQl2YXIgcGVyID0gcGFyc2VJbnQocC5idWZmZXJlZC5lbmQoMCkvcC5kdXJhdGlvbiAqIDEwMCk7CgkJCWlmKCFiYXIgJiYgcGVyID4gMCAmJiBwZXIgPCA1MCkgYmFyID0gdHJ1ZTsKCQkJaWYoYmFyKSBzZXRCYXIocGVyICsgJyUgb2YgJyArIE1hdGgucm91bmQocC5kdXJhdGlvbikgKyAncycsICd4aHInKTsKCQl9OwoJCXAgPSBfLnBvcHVwID0gY2UoJ3ZpZGVvJyk7CgkJcC5hdXRvcGxheSA9IHRydWU7CgkJcC5sb29wID0gdHJ1ZTsKCQlwLnZvbHVtZSA9IDAuNTsKCQlwLmNvbnRyb2xzID0gZmFsc2U7CgkJb24ocCwgJ3Byb2dyZXNzJywgb25Qcm9ncmVzcyk7CgkJb24ocCwgJ2NhbnBsYXl0aHJvdWdoJywgZnVuY3Rpb24oZSkgeyBvZmYoZS50YXJnZXQsICdwcm9ncmVzcycsIG9uUHJvZ3Jlc3MpOyBpZihfLmJhciAmJiBfLmJhci5jbGFzc0xpc3QuY29udGFpbnMoJ21waXYteGhyJykpIHsgc2V0QmFyKGZhbHNlKTsgc2hvd0ZpbGVJbmZvKCk7IH0gfSk7Cgl9IGVsc2UgewoJCXAgPSBfLnBvcHVwID0gY2UoJ2ltZycpOwoJfQoJcC5pZCA9ICdtcGl2LXBvcHVwJzsKCW9uKHAsICdlcnJvcicsIGhhbmRsZUVycm9yKTsKCW9uKHAsICdsb2FkJywgZnVuY3Rpb24oKSB7IHRoaXMubG9hZGVkID0gdHJ1ZTsgfSk7CglpZihfLnpvb21pbmcpIG9uKHAsICd0cmFuc2l0aW9uZW5kJywgZnVuY3Rpb24oZSkgeyBlLnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdtcGl2LXpvb21pbmcnKTsgfSk7CglfLmJhciA/IGQuYm9keS5pbnNlcnRCZWZvcmUocCwgXy5iYXIpIDogZC5ib2R5LmFwcGVuZENoaWxkKHApOwoJcC5zcmMgPSBzcmM7CglwID0gbnVsbDsKCWNoZWNrUHJvZ3Jlc3ModHJ1ZSk7Cn0KCmZ1bmN0aW9uIHNldEJhcihsYWJlbCwgY24pIHsKCXZhciBiID0gXy5iYXI7CglpZighbGFiZWwpIHsKCQlybShiKTsKCQlkZWxldGUgXy5iYXI7CgkJcmV0dXJuOwoJfQoJaWYoIWIpIHsKCQliID0gXy5iYXIgPSBjZSgnZGl2Jyk7CgkJYi5pZCA9ICdtcGl2LWJhcic7Cgl9CgliLmlubmVySFRNTCA9IGxhYmVsOwoJaWYoIWIucGFyZW50Tm9kZSkgewoJCWQuYm9keS5hcHBlbmRDaGlsZChiKTsKCQliLmNsaWVudEhlaWdodDsKCX0KCWIuY2xhc3NOYW1lID0gJ21waXYtc2hvdyBtcGl2LScgKyBjbjsKfQoKZnVuY3Rpb24gcmVsMmFicyhyZWwsIGFicykgewoJaWYocmVsLnN1YnN0cigwLCA1KSA9PSAnZGF0YTonKSByZXR1cm4gcmVsOwoJdmFyIHJlID0gL14oW2Etel0rOilcL1wvLzsKCWlmKHJlLnRlc3QocmVsKSkgIHJldHVybiByZWw7CglpZighcmUuZXhlYyhhYnMpKSByZXR1cm47CglpZihyZWwuaW5kZXhPZignLy8nKSA9PT0gMCkgcmV0dXJuIFJlZ0V4cC4kMSArIHJlbDsKCWlmKHJlbFswXSA9PSAnLycpIHJldHVybiBhYnMuc3Vic3RyKDAsIGFicy5pbmRleE9mKCcvJywgUmVnRXhwLmxhc3RNYXRjaC5sZW5ndGgpKSArIHJlbDsKCXJldHVybiBhYnMuc3Vic3RyKDAsIGFicy5sYXN0SW5kZXhPZignLycpKSArICcvJyArIHJlbDsKfQoKZnVuY3Rpb24gcmVwbGFjZShzLCBtKSB7CglpZighbSkgcmV0dXJuIHM7CglpZihzLmNoYXJBdCgwKSA9PSAnLycgJiYgcy5jaGFyQXQoMSkgIT0gJy8nKSB7CgkJdmFyIG1pZCA9IC9bXlxcXVwvLy5leGVjKHMpLmluZGV4KzE7CgkJdmFyIGVuZCA9IHMubGFzdEluZGV4T2YoJy8nKTsKCQl2YXIgcmUgPSBuZXcgUmVnRXhwKHMuc3Vic3RyaW5nKDEsIG1pZCksIHMuc3Vic3RyKGVuZCsxKSk7CgkJcmV0dXJuIG0uaW5wdXQucmVwbGFjZShyZSwgcy5zdWJzdHJpbmcobWlkKzEsIGVuZCkpOwoJfQoJZm9yKHZhciBpID0gbS5sZW5ndGg7IGktLTspIHsKCQlzID0gcy5yZXBsYWNlKCckJytpLCBtW2ldKTsKCX0KCXJldHVybiBzOwp9CgpmdW5jdGlvbiBhZGRTdHlsZShjc3MpIHsKCXZhciBzID0gY2UoJ3N0eWxlJyk7CglzLnRleHRDb250ZW50ID0gY3NzOwoJZC5oZWFkLmFwcGVuZENoaWxkKHMpOwoJcmV0dXJuIHM7Cn0KCmZ1bmN0aW9uIHN0eWxlU3VtKHMsIHApIHsKCWZvcih2YXIgaSA9IHAubGVuZ3RoLCB4ID0gMDsgaS0tOykgewoJCXggKz0gcGFyc2VJbnQocy5nZXRQcm9wZXJ0eVZhbHVlKFtwW2ldXSkpIHx8IDA7Cgl9CglyZXR1cm4geDsKfQoKZnVuY3Rpb24gZmluZFNjYWxlKHVybCwgcGFyZW50KSB7Cgl2YXIgaW1ncyA9IHFzYSgnaW1nLCB2aWRlbycsIHBhcmVudCk7Cglmb3IodmFyIGkgPSBpbWdzLmxlbmd0aCwgaW1nOyBpLS0gJiYgKGltZyA9IGltZ3NbaV0pOykgewoJCWlmKGltZy5zcmMgIT0gdXJsKSBjb250aW51ZTsKCQl2YXIgcyA9IE1hdGgubWF4KChpbWcubmF0dXJhbEhlaWdodCB8fCBpbWcudmlkZW9IZWlnaHQpL2ltZy5vZmZzZXRIZWlnaHQsIChpbWcubmF0dXJhbFdpZHRoIHx8IGltZy52aWRlb1dpZHRoKS9pbWcub2Zmc2V0V2lkdGgpOwoJCWlmKGlzRmluaXRlKHMpKSByZXR1cm4gczsKCX0KfQoKZnVuY3Rpb24gdmlld1JlY3QoKSB7Cgl2YXIgbm9kZSA9IGQuY29tcGF0TW9kZSA9PSAnQmFja0NvbXBhdCcgPyBkLmJvZHkgOiBkLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiB7d2lkdGg6bm9kZS5jbGllbnRXaWR0aCwgaGVpZ2h0Om5vZGUuY2xpZW50SGVpZ2h0fTsKfQoKZnVuY3Rpb24gcmVjdChub2RlLCBxKSB7Cgl2YXIgbjsKCWlmKHEpIHsKCQluID0gbm9kZTsKCQl3aGlsZSh0YWcobiA9IG4ucGFyZW50Tm9kZSkgIT0gJ0JPRFknKSB7CgkJCWlmKG1hdGNoZXMobiwgcSkpIHJldHVybiBuLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoJCX0KCX0KCXZhciBub2RlcyA9IHFzYSgnKicsIG5vZGUpOwoJZm9yKHZhciBpID0gbm9kZXMubGVuZ3RoOyBpLS0gJiYgKG4gPSBub2Rlc1tpXSk7KSB7CgkJaWYobi5vZmZzZXRIZWlnaHQgPiBub2RlLm9mZnNldEhlaWdodCkgbm9kZSA9IG47Cgl9CglyZXR1cm4gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKfQoKZnVuY3Rpb24gbWF0Y2hlcyhuLCBxKSB7Cgl2YXIgcCA9IEVsZW1lbnQucHJvdG90eXBlLCBtID0gcC5tYXRjaGVzIHx8IHAubW96TWF0Y2hlc1NlbGVjdG9yIHx8IHAud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IHAub01hdGNoZXNTZWxlY3RvcjsKCWlmKG0pIHJldHVybiBtLmNhbGwobiwgcSk7Cn0KCmZ1bmN0aW9uIGNsb3Nlc3QobiwgcSkgewoJd2hpbGUobikgewoJCWlmKG1hdGNoZXMobiwgcSkpIHJldHVybiBuOwoJCW4gPSBuLnBhcmVudE5vZGU7Cgl9Cn0KCmZ1bmN0aW9uIHRhZyhuKSB7CglyZXR1cm4gbi50YWdOYW1lLnRvVXBwZXJDYXNlKCk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZURvYyh0ZXh0KSB7Cgl2YXIgZG9jID0gZC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVIVE1MRG9jdW1lbnQoJ01QSVYnKTsKCWRvYy5kb2N1bWVudEVsZW1lbnQuaW5uZXJIVE1MID0gdGV4dDsKCXJldHVybiBkb2M7Cn0KCmZ1bmN0aW9uIHJtKG4pIHsKCWlmKG4gJiYgbi5wYXJlbnROb2RlKSBuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobik7Cn0KCmZ1bmN0aW9uIG9uKG4sIGUsIGYpIHsKCW4uYWRkRXZlbnRMaXN0ZW5lcihlLCBmKTsKfQoKZnVuY3Rpb24gb2ZmKG4sIGUsIGYpIHsKCW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCBmKTsKfQoKZnVuY3Rpb24gZHJvcChlKSB7CgllLnByZXZlbnREZWZhdWx0KCk7CgllLnN0b3BQcm9wYWdhdGlvbigpOwp9CgpmdW5jdGlvbiBjZShzKSB7CglyZXR1cm4gZC5jcmVhdGVFbGVtZW50KHMpOwp9CgpmdW5jdGlvbiBxcyhzLCBuKSB7CglyZXR1cm4gbi5xdWVyeVNlbGVjdG9yKHMpOwp9CgpmdW5jdGlvbiBxc2EocywgbikgewoJcmV0dXJuIG4ucXVlcnlTZWxlY3RvckFsbChzKTsKfQoKZnVuY3Rpb24gY29udGFpbnMoYSwgYikgewoJcmV0dXJuIGEgJiYgYS5pbmRleE9mKGIpID4gLTE7Cn0KCmZ1bmN0aW9uIHNldHVwKCkgewoJdmFyICQgPSBmdW5jdGlvbihzKSB7IHJldHVybiBkLmdldEVsZW1lbnRCeUlkKCdtcGl2LScrcyk7IH07Cgl2YXIgY2xvc2UgPSBmdW5jdGlvbigpIHsgcm0oJCgnc2V0dXAnKSk7IGlmKCFjb250YWlucyh0cnVzdGVkLCBob3N0bmFtZSkpIG9mZih3biwgJ21lc3NhZ2UnLCBvbk1lc3NhZ2UpOyB9OwoJdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKCkgeyAkKCdkZWxheScpLnBhcmVudE5vZGUuc3R5bGUuZGlzcGxheSA9ICQoJ3ByZWxvYWQnKS5wYXJlbnROb2RlLnN0eWxlLmRpc3BsYXkgPSAkKCdzdGFydC1hdXRvJykuc2VsZWN0ZWQgPyAnJyA6ICdub25lJzsJfTsKCXZhciBjaGVjayA9IGZ1bmN0aW9uKGUpIHsKCQl2YXIgdCA9IGUudGFyZ2V0LCBvazsKCQl0cnkgewoJCQl2YXIgcGVzID0gdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwoJCQlpZih0LnZhbHVlKSB7CgkJCQlpZighcGVzKSB7IHZhciBpbnAgPSB0LmNsb25lTm9kZSgpOyBpbnAudmFsdWUgPSAnJzsgdC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShpbnAsIHQpOyB9CgkJCQluZXcgUmVnRXhwKEpTT04ucGFyc2UodC52YWx1ZSkucik7CgkJCX0gZWxzZSBpZihwZXMpIHsKCQkJCXBlcy5mb2N1cygpOwoJCQkJcm0odCk7CgkJCX0KCQkJb2sgPSAxOwoJCX0gY2F0Y2goZXgpIHt9CgkJdC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBvayA/ICcnIDogJyNmZmFhYWEnOwoJfTsKCXZhciBleHAgPSBmdW5jdGlvbihlKSB7CgkJZHJvcChlKTsKCQl2YXIgcyA9IEpTT04uc3RyaW5naWZ5KGdldENmZygpKTsKCQlpZih0eXBlb2YgR01fc2V0Q2xpcGJvYXJkID09ICdmdW5jdGlvbicpIHsKCQkJR01fc2V0Q2xpcGJvYXJkKHMpOwoJCQl3bi5hbGVydCgnU2V0dGluZ3MgY29waWVkIHRvIGNsaXBib2FyZCEnKTsKCQl9IGVsc2UgewoJCQl3bi5hbGVydChzKTsKCQl9Cgl9OwoJdmFyIGltcCA9IGZ1bmN0aW9uKGUpIHsKCQlkcm9wKGUpOwoJCXZhciBzID0gd24ucHJvbXB0KCdQYXN0ZSBzZXR0aW5nczonKTsKCQlpZighcykgcmV0dXJuOwoJCWluaXQoZml4Q2ZnKHMpKTsKCX07Cgl2YXIgaW5zdGFsbCA9IGZ1bmN0aW9uKGUpIHsKCQlkcm9wKGUpOwoJCWUudGFyZ2V0LnBhcmVudE5vZGUuaW5uZXJIVE1MID0gJzxzcGFuPkxvYWRpbmcuLi48L3NwYW4+PGlmcmFtZSBzdHlsZT0id2lkdGg6MTAwJTtoZWlnaHQ6MjZweDtib3JkZXI6MDttYXJnaW46MDtkaXNwbGF5Om5vbmU7IiBzcmM9Ii8vdzlwLmNvL3VzZXJzY3JpcHRzL21waXYvbW9yZV9ob3N0X3J1bGVzLmh0bWwiIG9ubG9hZD0idGhpcy5zdHlsZS5kaXNwbGF5PVwnXCc7dGhpcy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLnN0eWxlLmRpc3BsYXk9XCdub25lXCc7Ij48L2lmcmFtZT4nOwoJfTsKCXZhciBnZXRDZmcgPSBmdW5jdGlvbigpIHsKCQl2YXIgY2ZnID0ge307CgkJdmFyIGRlbGF5ID0gcGFyc2VJbnQoJCgnZGVsYXknKS52YWx1ZSk7CgkJaWYoIWlzTmFOKGRlbGF5KSAmJiBkZWxheSA+PSAwKSBjZmcuZGVsYXkgPSBkZWxheTsKCQl2YXIgc2NhbGUgPSBwYXJzZUZsb2F0KCQoJ3NjYWxlJykudmFsdWUucmVwbGFjZSgnLCcsICcuJykpOwoJCWlmKCFpc05hTihzY2FsZSkpIGNmZy5zY2FsZSA9IE1hdGgubWF4KDEsIHNjYWxlKTsKCQljZmcuc3RhcnQgPSAkKCdzdGFydC1jb250ZXh0Jykuc2VsZWN0ZWQgPyAnY29udGV4dCcgOiAoJCgnc3RhcnQtY3RybCcpLnNlbGVjdGVkID8gJ2N0cmwnIDogJ2F1dG8nKTsKCQljZmcuem9vbSA9ICQoJ3pvb20tY29udGV4dCcpLnNlbGVjdGVkID8gJ2NvbnRleHQnIDogKCQoJ3pvb20td2hlZWwnKS5zZWxlY3RlZCA/ICd3aGVlbCcgOiAoJCgnem9vbS1zaGlmdCcpLnNlbGVjdGVkID8gJ3NoaWZ0JyA6ICdhdXRvJykpOwoJCWNmZy5jZW50ZXIgPSAkKCdjZW50ZXInKS5jaGVja2VkOwoJCWNmZy5jdXJzb3IgPSAhJCgnY3Vyc29yJykuY2hlY2tlZDsKCQljZmcuaW1ndGFiID0gJCgnaW1ndGFiJykuY2hlY2tlZDsKCQljZmcuY2xvc2UgPSAkKCdjbG9zZScpLnNlbGVjdGVkOwoJCWNmZy5wcmVsb2FkID0gJCgncHJlbG9hZCcpLmNoZWNrZWQ7CgkJY2ZnLmNzcyA9ICQoJ2NzcycpLnZhbHVlLnRyaW0oKTsKCQljZmcuc2NhbGVzID0gJCgnc2NhbGVzJykudmFsdWUudHJpbSgpLnNwbGl0KC9bLDtdKlxzKy8pLm1hcChmdW5jdGlvbih4KSB7IHJldHVybiB4LnJlcGxhY2UoJywnLCAnLicpOyB9KS5maWx0ZXIoZnVuY3Rpb24oeCkgeyByZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQoeCkpOyB9KTsKCQljZmcueGhyID0gJCgneGhyJykuY2hlY2tlZDsKCQl2YXIgaW5wcyA9IHFzYSgnaW5wdXQnLCAkKCdob3N0cycpKSwgbGluZXMgPSBbXTsKCQlmb3IodmFyIGkgPSAwOyBpIDwgaW5wcy5sZW5ndGg7IGkrKykgewoJCQl2YXIgcyA9IGlucHNbaV0udmFsdWUudHJpbSgpOwoJCQlpZihzKSBsaW5lcy5wdXNoKHMpOwoJCX0KCQlsaW5lcy5zb3J0KCk7CgkJY2ZnLmhvc3RzID0gbGluZXMuam9pbignXG4nKTsKCQlyZXR1cm4gZml4Q2ZnKEpTT04uc3RyaW5naWZ5KGNmZykpOwoJfTsKCXZhciBpbml0ID0gZnVuY3Rpb24oY2ZnKSB7CgkJY2xvc2UoKTsKCQlpZighY29udGFpbnModHJ1c3RlZCwgaG9zdG5hbWUpKSBvbih3biwgJ21lc3NhZ2UnLCBvbk1lc3NhZ2UpOwoJCWFkZFN0eWxlKCdcCgkJCSNtcGl2LXNldHVwIHsgcG9zaXRpb246Zml4ZWQ7ei1pbmRleDoyMTQ3NDgzNjQ3O3RvcDoyMHB4O3JpZ2h0OjIwcHg7cGFkZGluZzoyMHB4IDMwcHg7YmFja2dyb3VuZDojZWVlO3dpZHRoOjY0MHB4O2JvcmRlcjoxcHggc29saWQgYmxhY2s7IH1cCgkJCSNtcGl2LXNldHVwICogeyBjb2xvcjpibGFjazt0ZXh0LWFsaWduOmxlZnQ7bWluLWhlaWdodDp1bnNldDttYXJnaW46dW5zZXQ7cGFkZGluZzp1bnNldDtsaW5lLWhlaWdodDoxNXB4O2ZvbnQtc2l6ZToxMnB4O2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7Ym94LXNoYWRvdzpub25lOyB9XAoJCQkjbXBpdi1zZXR1cCBhIHsgY29sb3I6ZGFya2JsdWUhaW1wb3J0YW50O3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmUhaW1wb3J0YW50OyB9XAoJCQkjbXBpdi1zZXR1cCB1bCB7IG1hcmdpbjoxMHB4IDAgMTVweCAwO3BhZGRpbmc6MDtsaXN0LXN0eWxlOm5vbmU7YmFja2dyb3VuZDojZWVlO2JvcmRlcjowOyB9XAoJCQkjbXBpdi1zZXR1cCBpbnB1dCwgI21waXYtc2V0dXAgc2VsZWN0LCAjbXBpdi1jc3MgeyBkaXNwbGF5OmlubGluZTtib3JkZXI6MXB4IHNvbGlkIGdyYXk7cGFkZGluZzoycHg7YmFja2dyb3VuZDp3aGl0ZTsgfVwKCQkJI21waXYtY3NzIHsgcmVzaXplOnZlcnRpY2FsOyBoZWlnaHQ6NDVweDsgfVwKCQkJI21waXYtc2NhbGVzIHsgd2lkdGg6MTMwcHg7IH1cCgkJCSNtcGl2LXNldHVwIGxpIHsgbWFyZ2luOjA7cGFkZGluZzo3cHggMDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7YmFja2dyb3VuZDojZWVlO2JvcmRlcjowIH1cCgkJCSNtcGl2LXpvb20geyBtYXJnaW4tcmlnaHQ6IDE4cHg7IH1cCgkJCSNtcGl2LWRlbGF5LCAjbXBpdi1zY2FsZSB7IHdpZHRoOjM2cHg7IH1cCgkJCSNtcGl2LWN1cnNvciwgI21waXYtaW1ndGFiLCAjbXBpdi14aHIsICNtcGl2LXByZWxvYWQgeyBtYXJnaW4tbGVmdDoxOHB4OyB9XAoJCQkjbXBpdi1ob3N0cyB7IG1heC1oZWlnaHQ6MTUwcHg7b3ZlcmZsb3cteTphdXRvOyBwYWRkaW5nOjJweDsgbWFyZ2luOjRweCAwO2NsZWFyOmJvdGg7IH1cCgkJCSNtcGl2LWhvc3RzIGlucHV0LCAjbXBpdi1jc3MgeyB3aWR0aDo5OCU7bWFyZ2luOjNweCAwOyB9XAoJCQkjbXBpdi1zZXR1cCBidXR0b24geyB3aWR0aDoxNTBweDttYXJnaW46MCAxMHB4O3RleHQtYWxpZ246Y2VudGVyOyB9XAoJCScpOwoJCXZhciBkaXYgPSBjZSgnZGl2Jyk7CgkJZGl2LmlkID0gJ21waXYtc2V0dXAnOwoJCWQuYm9keS5hcHBlbmRDaGlsZChkaXYpOwoJCWRpdi5pbm5lckhUTUwgPSAnXAoJCQk8ZGl2PjxhIGhyZWY9Imh0dHA6Ly93OXAuY28vdXNlcnNjcmlwdHMvbXBpdi8iPk1vdXNlb3ZlciBQb3B1cCBJbWFnZSBWaWV3ZXI8L2E+PHNwYW4gc3R5bGU9ImZsb2F0OnJpZ2h0Ij48YSBocmVmPSIjIiBpZD0ibXBpdi1pbXBvcnQiPkltcG9ydDwvYT4gfCA8YSBocmVmPSIjIiBpZD0ibXBpdi1leHBvcnQiPkV4cG9ydDwvYT48L3NwYW4+PC9kaXY+PHVsPlwKCQkJPGxpPlBvcHVwOiA8c2VsZWN0PjxvcHRpb24gaWQ9Im1waXYtc3RhcnQtYXV0byI+YXV0b21hdGljYWxseTwvb3B0aW9uPjxvcHRpb24gaWQ9Im1waXYtc3RhcnQtY29udGV4dCI+cmlnaHQgY2xpY2sgb3IgY3RybDwvb3B0aW9uPjxvcHRpb24gaWQ9Im1waXYtc3RhcnQtY3RybCI+Y3RybDwvb3B0aW9uPjwvc2VsZWN0PiA8c3Bhbj5hZnRlciA8aW5wdXQgaWQ9Im1waXYtZGVsYXkiIHR5cGU9InRleHQiLz4gbXM8L3NwYW4+IDxzcGFuPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9Im1waXYtcHJlbG9hZCIvPiBTdGFydCBsb2FkaW5nIGltbWVkaWF0ZWx5PC9zcGFuPjwvbGk+XAoJCQk8bGk+T25seSBzaG93IHBvcHVwIG92ZXIgc2NhbGVkLWRvd24gaW1hZ2Ugd2hlbiBuYXR1cmFsIHNpemUgaXMgPGlucHV0IGlkPSJtcGl2LXNjYWxlIiB0eXBlPSJ0ZXh0Ii8+IHRpbWVzIGxhcmdlcjwvbGk+XAoJCQk8bGk+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ibXBpdi1jZW50ZXIiLz4gQWx3YXlzIGNlbnRlcmVkIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9Im1waXYtY3Vyc29yIi8+IEF1dG9oaWRlIGN1cnNvciA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJtcGl2LWltZ3RhYiIvPiBSdW4gaW4gaW1hZ2UgdGFicyA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJtcGl2LXhociIgb25jbGljaz0icmV0dXJuIHRoaXMuY2hlY2tlZCB8fCBjb25maXJtKFwnRG8gbm90IGRpc2FibGUgdGhpcyB1bmxlc3MgeW91IHNwb29mIHRoZSBIVFRQIGhlYWRlcnMgeW91cnNlbGYuXCcpIi8+IEFudGktaG90bGlua2luZyB3b3JrYXJvdW5kPC9saT5cCgkJCTxsaT5ab29tOiA8c2VsZWN0IGlkPSJtcGl2LXpvb20iPjxvcHRpb24gaWQ9Im1waXYtem9vbS1jb250ZXh0Ij5yaWdodCBjbGljayBvciBzaGlmdDwvb3B0aW9uPjxvcHRpb24gaWQ9Im1waXYtem9vbS13aGVlbCI+d2hlZWwgdXAgb3Igc2hpZnQ8L29wdGlvbj48b3B0aW9uIGlkPSJtcGl2LXpvb20tc2hpZnQiPnNoaWZ0PC9vcHRpb24+PG9wdGlvbiBpZD0ibXBpdi16b29tLWF1dG8iPmF1dG9tYXRpY2FsbHk8L29wdGlvbj48L3NlbGVjdD4gQ3VzdG9tIHNjYWxlIGZhY3RvcnM6IDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ibXBpdi1zY2FsZXMiIHBsYWNlaG9sZGVyPSJlLmcuIDAgMC41IDEqIDIiLz4gPHNwYW4gdGl0bGU9InZhbHVlcyBzbWFsbGVyIHRoYW4gbm9uLXpvb21lZCBzaXplIGFyZSBpZ25vcmVkLCAwID0gZml0IHRvIHdpbmRvdywgMCEgPSBzYW1lIGFzIDAgYnV0IGFsc28gcmVtb3ZlcyBzbWFsbGVyIHZhbHVlcywgYXN0ZXJpc2sgYWZ0ZXIgdmFsdWUgbWFya3MgZGVmYXVsdCB6b29tIGZhY3RvciAoZS5nLiAxKikiIHN0eWxlPSJjdXJzb3I6aGVscCI+KD8pPC9zcGFuPjwvbGk+XAoJCQk8bGk+SWYgem9vbWluZyBvdXQgZnVydGhlciBpcyBub3QgcG9zc2libGUsIDxzZWxlY3Q+PG9wdGlvbj5zdGF5IGluIHpvb20gbW9kZTwvb3B0aW9uPjxvcHRpb24gaWQ9Im1waXYtY2xvc2UiPmNsb3NlIHBvcHVwPC9vcHRpb24+PC9zZWxlY3Q+PC9saT5cCgkJCTxsaT48YSBocmVmPSJodHRwOi8vdzlwLmNvL3VzZXJzY3JpcHRzL21waXYvY3NzLmh0bWwiIHRhcmdldD0iX2JsYW5rIj5DdXN0b20gQ1NTOjwvYT48ZGl2Pjx0ZXh0YXJlYSBpZD0ibXBpdi1jc3MiIHNwZWxsY2hlY2s9ImZhbHNlIj48L3RleHRhcmVhPjwvbGk+XAoJCQk8bGk+PGEgaHJlZj0iaHR0cDovL3c5cC5jby91c2Vyc2NyaXB0cy9tcGl2L2hvc3RfcnVsZXMuaHRtbCIgdGFyZ2V0PSJfYmxhbmsiPkN1c3RvbSBob3N0IHJ1bGVzOjwvYT48aW5wdXQgdHlwZT0idGV4dCIgaWQ9Im1waXYtc2VhcmNoIiBwbGFjZWhvbGRlcj0iU2VhcmNoIiBzdHlsZT0iZGlzcGxheTpub25lO2Zsb2F0OnJpZ2h0O3dpZHRoOjcwcHg7cGFkZGluZzoxcHggMnB4O2ZvbnQtc2l6ZToxMHB4OyIvPjxkaXYgaWQ9Im1waXYtaG9zdHMiPjxpbnB1dCB0eXBlPSJ0ZXh0IiBzcGVsbGNoZWNrPSJmYWxzZSI+PC9kaXY+PC9saT5cCgkJCTxsaT48YSBocmVmPSIjIiBpZD0ibXBpdi1pbnN0YWxsIj5JbnN0YWxsIHJ1bGUgZnJvbSByZXBvc2l0b3J5Li4uPC9hPjwvbGk+XAoJCQk8L3VsPjxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyIj48YnV0dG9uIGlkPSJtcGl2LW9rIj5PSzwvYnV0dG9uPjxidXR0b24gaWQ9Im1waXYtY2FuY2VsIj5DYW5jZWw8L2J1dHRvbj48L2Rpdj4nOwoJCWlmKGNmZy5ob3N0cykgewoJCQl2YXIgcGFyZW50ID0gJCgnaG9zdHMnKTsKCQkJdmFyIGxpbmVzID0gY2ZnLmhvc3RzLnNwbGl0KC9bXHJcbl0rLyk7CgkJCWZvcih2YXIgaSA9IDAsIHM7IGkgPCBsaW5lcy5sZW5ndGggJiYgKHMgPSBsaW5lc1tpXSk7IGkrKykgewoJCQkJdmFyIGlucCA9IHBhcmVudC5maXJzdEVsZW1lbnRDaGlsZC5jbG9uZU5vZGUoKTsKCQkJCWlucC52YWx1ZSA9IHM7CgkJCQlwYXJlbnQuYXBwZW5kQ2hpbGQoaW5wKTsKCQkJCWNoZWNrKHt0YXJnZXQ6aW5wfSk7CgkJCX0KCQkJaWYobGluZXMubGVuZ3RoID4gNSB8fCBzZXR1cC5zZWFyY2gpIHsKCQkJCXZhciBzZSA9ICQoJ3NlYXJjaCcpLCBzZiA9IGZ1bmN0aW9uKCkgewoJCQkJCXZhciBpbnBzID0gcXNhKCdpbnB1dCcsICQoJ2hvc3RzJykpLCBzID0gc2UudmFsdWUudG9Mb3dlckNhc2UoKTsKCQkJCQlzZXR1cC5zZWFyY2ggPSBzOwoJCQkJCWZvcih2YXIgaSA9IDA7IGkgPCBpbnBzLmxlbmd0aDsgaSsrKSB7CgkJCQkJCWlucHNbaV0uc3R5bGUuZGlzcGxheSA9ICFpbnBzW2ldLnZhbHVlIHx8IGNvbnRhaW5zKGlucHNbaV0udmFsdWUudG9Mb3dlckNhc2UoKSwgcykgPyAnJyA6ICdub25lJzsKCQkJCQl9CgkJCQl9OwoJCQkJb24oc2UsICdpbnB1dCcsIHNmKTsKCQkJCXNlLnZhbHVlID0gc2V0dXAuc2VhcmNoIHx8ICcnOwoJCQkJaWYoc2UudmFsdWUpIHNmKCk7CgkJCQlzZS5zdHlsZS5kaXNwbGF5ID0gJyc7CgkJCX0KCQl9CgkJb24oJCgnc3RhcnQtYXV0bycpLnBhcmVudE5vZGUsICdjaGFuZ2UnLCB1cGRhdGUpOwoJCW9uKCQoJ2NhbmNlbCcpLCAnY2xpY2snLCBjbG9zZSk7CgkJb24oJCgnZXhwb3J0JyksICdjbGljaycsIGV4cCk7CgkJb24oJCgnaW1wb3J0JyksICdjbGljaycsIGltcCk7CgkJb24oJCgnaG9zdHMnKSwgJ2lucHV0JywgY2hlY2spOwoJCW9uKCQoJ2luc3RhbGwnKSwgJ2NsaWNrJywgaW5zdGFsbCk7CgkJb24oJCgnb2snKSwgJ2NsaWNrJywgZnVuY3Rpb24oKSB7CgkJCXNhdmVDZmcoZ2V0Q2ZnKCkpOwoJCQlob3N0cyA9IGxvYWRIb3N0cygpOwoJCQljbG9zZSgpOwoJCX0pOwoJCSQoJ2RlbGF5JykudmFsdWUgPSBjZmcuZGVsYXk7CgkJJCgnc2NhbGUnKS52YWx1ZSA9IGNmZy5zY2FsZTsKCQkkKCdjZW50ZXInKS5jaGVja2VkID0gY2ZnLmNlbnRlcjsKCQkkKCdjdXJzb3InKS5jaGVja2VkID0gIWNmZy5jdXJzb3I7CgkJJCgnaW1ndGFiJykuY2hlY2tlZCA9IGNmZy5pbWd0YWI7CgkJJCgnY2xvc2UnKS5zZWxlY3RlZCA9IGNmZy5jbG9zZTsKCQkkKCdwcmVsb2FkJykuY2hlY2tlZCA9IGNmZy5wcmVsb2FkOwoJCSQoJ2NzcycpLnZhbHVlID0gY2ZnLmNzczsKCQkkKCdzY2FsZXMnKS52YWx1ZSA9IGNmZy5zY2FsZXMuam9pbignICcpOwoJCSQoJ3hocicpLmNoZWNrZWQgPSBjZmcueGhyOwoJCSQoJ3pvb20tJyArIGNmZy56b29tKS5zZWxlY3RlZCA9IHRydWU7CgkJJCgnc3RhcnQtJyArIGNmZy5zdGFydCkuc2VsZWN0ZWQgPSB0cnVlOwoJCXVwZGF0ZSgpOwoJCXZhciBmcmVlID0gdmlld1JlY3QoKS5oZWlnaHQgLSBkaXYub2Zmc2V0SGVpZ2h0IC0gNjA7CgkJJCgnaG9zdHMnKS5zdHlsZS5tYXhIZWlnaHQgPSBwYXJzZUludCgkKCdob3N0cycpLm9mZnNldEhlaWdodCArIDAuOCAqIGZyZWUpICsgJ3B4JzsKCQkkKCdjc3MnKS5zdHlsZS5oZWlnaHQgPSBwYXJzZUludCgkKCdjc3MnKS5vZmZzZXRIZWlnaHQgKyAwLjIgKiBmcmVlKSArICdweCc7CgkJZGl2ID0gbnVsbDsKCX07Cglpbml0KGxvYWRDZmcoKSk7Cn0KCm9uKGQsICdtb3VzZW92ZXInLCBvbk1vdXNlT3Zlcik7CmlmKGNvbnRhaW5zKGhvc3RuYW1lLCAnZ29vZ2xlJykpIHsKCXZhciBub2RlID0gZC5nZXRFbGVtZW50QnlJZCgnbWFpbicpOwoJaWYobm9kZSkgb24obm9kZSwgJ21vdXNlb3ZlcicsIG9uTW91c2VPdmVyKTsKfSBlbHNlIGlmKGNvbnRhaW5zKHRydXN0ZWQsIGhvc3RuYW1lKSkgewoJb24od24sICdtZXNzYWdlJywgb25NZXNzYWdlKTsKCW9uKGQsICdjbGljaycsIGZ1bmN0aW9uKGUpIHsKCQl2YXIgdCA9IGUudGFyZ2V0OwoJCWlmKGUud2hpY2ggIT0gMSB8fCAhL0JMT0NLUVVPVEV8Q09ERXxQUkUvLnRlc3QodGFnKHQpICsgdGFnKHQucGFyZW50Tm9kZSkpIHx8ICEvXlxzKlx7XHMqIi4rOi4rXH1ccyokLy50ZXN0KHQudGV4dENvbnRlbnQpKSByZXR1cm47CgkJd24ucG9zdE1lc3NhZ2UoJ21waXYtcnVsZSAnICsgdC50ZXh0Q29udGVudCwgJyonKTsKCQllLnByZXZlbnREZWZhdWx0KCk7Cgl9KTsKfQo="},{"name":"Direct links out","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["*://google.*","*://www.google.*","*://encrypted.google.*"],"orig_matches":["*://yandex.ru/*","*://yandex.ua/*","*://yandex.by/*","*://yandex.kz/*","*://yandex.com.tr/*","*://yandex.com/*","*://*.yandex.ru/*","*://*.yandex.ua/*","*://*.yandex.by/*","*://*.yandex.kz/*","*://*.yandex.com.tr/*","*://*.yandex.com/*","*://youtube.com/*","*://*.youtube.com/*","*://deviantart.com/*","*://*.deviantart.com/*","*://joyreactor.cc/*","*://*.joyreactor.cc/*","*://reactor.cc/*","*://*.reactor.cc/*","*://joyreactor.com/*","*://*.joyreactor.com/*","*://vk.com/*","*://*.vk.com/*","*://ok.ru/*","*://*.ok.ru/*","*://steamcommunity.com/*","*://*.steamcommunity.com/*","*://facebook.com/*","*://*.facebook.com/*","*://twitter.com/*","*://*.twitter.com/*","*://4pda.ru/*","*://*.4pda.ru/*","*://kat.cr/*","*://kickassto.co/*","*://katproxy.is/*","*://thekat.tv/*","*://*.kat.cr/*","*://*.kickassto.co/*","*://*.katproxy.is/*","*://*.thekat.tv/*","*://addons.mozilla.org/*","*://pixiv.net/*","*://*.pixiv.net/*","*://tumblr.com/*","*://*.tumblr.com/*","*://danieldefo.ru/*","*://*.danieldefo.ru/*","*://yaplakal.com/*","*://*.yaplakal.com/*","*://soundcloud.com/*","*://*.soundcloud.com/*","*://upwork.com/*","*://*.upwork.com/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469598925912,"data":{}},"enabled":false,"position":16,"file_url":"https://greasyfork.org/scripts/15857-direct-links-out/code/Direct%20links%20out.user.js","uuid":"cecd69e7-ccc8-47ad-bf47-2573e30f68ac","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIERpcmVjdCBsaW5rcyBvdXQKLy8gQG5hbWU6cnUgICAgINCf0YDRj9C80YvQtSDRgdGB0YvQu9C60Lgg0L3QsNGA0YPQttGDCi8vIEBkZXNjcmlwdGlvbiBSZW1vdmVzIGFsbCAiWW91IGFyZSBsZWF2aW5nIG91ciBzaXRlIiBhbmQgcmVkaXJlY3Rpb24gc3R1ZmYgZnJvbSBsaW5rcwovLyBAZGVzY3JpcHRpb246cnUg0KPQsdC40YDQsNC10YIgItCR0LvQsC3QsdC70LAt0LHQu9CwLCDQktGLINC/0L7QutC40LTQsNC10YLQtSDQvdCw0Ygg0YHQsNC50YIiINC4INC/0LXRgNC10LDQtNGA0LXRgdCw0YbQuNC4INC40Lcg0YHRgdGL0LvQvtC6Ci8vIEBuYW1lc3BhY2UgICBodHRwczovL2dpdGh1Yi5jb20vbm9rZXlhCi8vIEBhdXRob3IgICAgICBub2tleWEKLy8gQHVwZGF0ZSAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2tleWEvZGlyZWN0LWxpbmtzLW91dC9yYXcvbWFzdGVyL2RpcmVjdC1saW5rcy1vdXQudXNlci5qcwovLyBAaWNvbiAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL25va2V5YS9kaXJlY3QtbGlua3Mtb3V0L21hc3Rlci9pY29uLnBuZwovLyBAdmVyc2lvbiAgICAgMi4xNAovLyBAZ3JhbnQgICAgICAgbm9uZQovL2dvb2dsZQovLyBAaW5jbHVkZSAgICAgKjovL2dvb2dsZS4qCi8vIEBpbmNsdWRlICAgICAqOi8vd3d3Lmdvb2dsZS4qCi8vIEBpbmNsdWRlICAgICAqOi8vZW5jcnlwdGVkLmdvb2dsZS4qCi8veWFuZGV4Ci8vIEBtYXRjaCAgICAgICAqOi8veWFuZGV4LnJ1LyoKLy8gQG1hdGNoICAgICAgICo6Ly95YW5kZXgudWEvKgovLyBAbWF0Y2ggICAgICAgKjovL3lhbmRleC5ieS8qCi8vIEBtYXRjaCAgICAgICAqOi8veWFuZGV4Lmt6LyoKLy8gQG1hdGNoICAgICAgICo6Ly95YW5kZXguY29tLnRyLyoKLy8gQG1hdGNoICAgICAgICo6Ly95YW5kZXguY29tLyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLnlhbmRleC5ydS8qCi8vIEBtYXRjaCAgICAgICAqOi8vKi55YW5kZXgudWEvKgovLyBAbWF0Y2ggICAgICAgKjovLyoueWFuZGV4LmJ5LyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLnlhbmRleC5rei8qCi8vIEBtYXRjaCAgICAgICAqOi8vKi55YW5kZXguY29tLnRyLyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLnlhbmRleC5jb20vKgovL3lvdXR1YmUKLy8gQG1hdGNoICAgICAgICo6Ly95b3V0dWJlLmNvbS8qCi8vIEBtYXRjaCAgICAgICAqOi8vKi55b3V0dWJlLmNvbS8qCi8vZGV2aWFudGFydAovLyBAbWF0Y2ggICAgICAgKjovL2RldmlhbnRhcnQuY29tLyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLmRldmlhbnRhcnQuY29tLyoKLy9qb3lyZWFjdG9yCi8vIEBtYXRjaCAgICAgICAqOi8vam95cmVhY3Rvci5jYy8qCi8vIEBtYXRjaCAgICAgICAqOi8vKi5qb3lyZWFjdG9yLmNjLyoKLy8gQG1hdGNoICAgICAgICo6Ly9yZWFjdG9yLmNjLyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLnJlYWN0b3IuY2MvKgovLyBAbWF0Y2ggICAgICAgKjovL2pveXJlYWN0b3IuY29tLyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLmpveXJlYWN0b3IuY29tLyoKLy92awovLyBAbWF0Y2ggICAgICAgKjovL3ZrLmNvbS8qCi8vIEBtYXRjaCAgICAgICAqOi8vKi52ay5jb20vKgovL29rCi8vIEBtYXRjaCAgICAgICAqOi8vb2sucnUvKgovLyBAbWF0Y2ggICAgICAgKjovLyoub2sucnUvKgovL3N0ZWFtCi8vIEBtYXRjaCAgICAgICAqOi8vc3RlYW1jb21tdW5pdHkuY29tLyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLnN0ZWFtY29tbXVuaXR5LmNvbS8qCi8vZmIKLy8gQG1hdGNoICAgICAgICo6Ly9mYWNlYm9vay5jb20vKgovLyBAbWF0Y2ggICAgICAgKjovLyouZmFjZWJvb2suY29tLyoKLy90d2l0dGVyCi8vIEBtYXRjaCAgICAgICAqOi8vdHdpdHRlci5jb20vKgovLyBAbWF0Y2ggICAgICAgKjovLyoudHdpdHRlci5jb20vKgovLzRwZGEKLy8gQG1hdGNoICAgICAgICo6Ly80cGRhLnJ1LyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLjRwZGEucnUvKgovL2tpY2thc3MKLy8gQG1hdGNoICAgICAgICo6Ly9rYXQuY3IvKgovLyBAbWF0Y2ggICAgICAgKjovL2tpY2thc3N0by5jby8qCi8vIEBtYXRjaCAgICAgICAqOi8va2F0cHJveHkuaXMvKgovLyBAbWF0Y2ggICAgICAgKjovL3RoZWthdC50di8qCi8vIEBtYXRjaCAgICAgICAqOi8vKi5rYXQuY3IvKgovLyBAbWF0Y2ggICAgICAgKjovLyoua2lja2Fzc3RvLmNvLyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLmthdHByb3h5LmlzLyoKLy8gQG1hdGNoICAgICAgICo6Ly8qLnRoZWthdC50di8qCi8vQU1PCi8vIEBtYXRjaCAgICAgICAqOi8vYWRkb25zLm1vemlsbGEub3JnLyoKLy9waXhpdgovLyBAbWF0Y2ggICAgICAgKjovL3BpeGl2Lm5ldC8qCi8vIEBtYXRjaCAgICAgICAqOi8vKi5waXhpdi5uZXQvKgovL3R1bWJscgovLyBAbWF0Y2ggICAgICAgKjovL3R1bWJsci5jb20vKgovLyBAbWF0Y2ggICAgICAgKjovLyoudHVtYmxyLmNvbS8qCi8vZGFuaWVsZGVmbwovLyBAbWF0Y2ggICAgICAgKjovL2RhbmllbGRlZm8ucnUvKgovLyBAbWF0Y2ggICAgICAgKjovLyouZGFuaWVsZGVmby5ydS8qCi8veWFwbGFrYWwKLy8gQG1hdGNoICAgICAgICo6Ly95YXBsYWthbC5jb20vKgovLyBAbWF0Y2ggICAgICAgKjovLyoueWFwbGFrYWwuY29tLyoKLy9zb3VuZGNsb3VkCi8vIEBtYXRjaCAgICAgICAqOi8vc291bmRjbG91ZC5jb20vKgovLyBAbWF0Y2ggICAgICAgKjovLyouc291bmRjbG91ZC5jb20vKgovL3Vwd29yawovLyBAbWF0Y2ggICAgICAgKjovL3Vwd29yay5jb20vKgovLyBAbWF0Y2ggICAgICAgKjovLyoudXB3b3JrLmNvbS8qCgovLyA9PS9Vc2VyU2NyaXB0PT0KKGZ1bmN0aW9uKCkgewogICAgLy8gYW5jaG9ycyBhbmQgZnVuY3Rpb25zCiAgICB2YXIgYW5jaG9yOwogICAgdmFyIGFmdGVyOwogICAgdmFyIHJ3TGluayA9IGZ1bmN0aW9uKCl7fTsKICAgIHZhciByd0FsbCA9IGZ1bmN0aW9uKCl7fTsKICAgIHZhciByZXRUcnVlID0gZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9OyAvL2R1bW15IGZ1bmN0aW9uIHRvIGFsd2F5cyByZXR1cm4gdHJ1ZQoKICAgIC8vIHNpbXBsZSByZXdyaXRlIGxpbmsgLSAgYmFzZWQgb24gYW5jaG9ycwogICAgZnVuY3Rpb24gcndTaW1wbGUobGluayl7CiAgICAgICAgaWYgKGFuY2hvcil7CiAgICAgICAgICAgIHZhciBuZHggPSBsaW5rLmhyZWYuaW5kZXhPZihhbmNob3IpOwogICAgICAgICAgICBpZiAobmR4ICE9IC0xKXsKICAgICAgICAgICAgICAgIHZhciBuZXdsaW5rID0gbGluay5ocmVmLnN1YnN0cmluZyhuZHggKyBhbmNob3IubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGlmIChhZnRlcil7CiAgICAgICAgICAgICAgICAgICAgbmR4ID0gbmV3bGluay5pbmRleE9mKGFmdGVyKTsKICAgICAgICAgICAgICAgICAgICBpZiAobmR4ICE9IC0xKQogICAgICAgICAgICAgICAgICAgICAgICBuZXdsaW5rID0gbmV3bGluay5zdWJzdHJpbmcoMCwgbmR4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxpbmsuaHJlZiA9IHVuZXNjYXBlKG5ld2xpbmspOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcndhU2ltcGxlKCl7CiAgICAgICAgdmFyIGxpbmtzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2EnKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmtzLmxlbmd0aDsgKytpKQogICAgICAgICAgICByd0xpbmsobGlua3NbaV0pOwogICAgfQogICAgLy8gdHdpdHRlcgogICAgZnVuY3Rpb24gcndUd2l0dGVyKGxpbmspewogICAgICAgIGlmIChsaW5rLmhhc0F0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZC11cmwnKSl7CiAgICAgICAgICAgIGxpbmsuaHJlZiA9IGxpbmsuZ2V0QXR0cmlidXRlKCdkYXRhLWV4cGFuZGVkLXVybCcpOwogICAgICAgICAgICBsaW5rLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZC11cmwnKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiByd2FUd2l0dGVyKCl7CiAgICAgICAgdmFyIGxpbmtzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndHdpdHRlci10aW1lbGluZS1saW5rJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5rcy5sZW5ndGg7ICsraSkKICAgICAgICAgICAgcndMaW5rKGxpbmtzW2ldKTsKICAgIH0KICAgIC8vIGtpY2thc3MKICAgIGZ1bmN0aW9uIHJ3S2lja2FzcyhsaW5rKXsKICAgICAgICB2YXIgbmR4ID0gbGluay5ocmVmLmluZGV4T2YoYW5jaG9yKTsKICAgICAgICBpZiAobmR4ICE9IC0xKXsKICAgICAgICAgICAgbGluay5ocmVmID0gd2luZG93LmF0b2IodW5lc2NhcGUobGluay5ocmVmLnN1YnN0cmluZyhuZHggKyBhbmNob3IubGVuZ3RoLCBsaW5rLmhyZWYubGVuZ3RoIC0gMSkpKTsKICAgICAgICAgICAgbGluay5jbGFzc05hbWUgPSAnJzsKICAgICAgICB9CiAgICB9CiAgICAvLyB5b3V0dWJlCiAgICBmdW5jdGlvbiByd1lvdXR1YmUobGluayl7CiAgICAgICAgaWYgKC9yZWRpcmVjdC9pLnRlc3QobGluay5jbGFzc05hbWUpKQogICAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZGF0YS1yZWRpcmVjdC1ocmVmLXVwZGF0ZWQnLCAndHJ1ZScpOwogICAgICAgIHJ3U2ltcGxlKGxpbmspOwogICAgfQogICAgLy8gZmFjZWJvb2sKICAgIGZ1bmN0aW9uIHJ3RmFjZWJvb2sobGluayl7CiAgICAgICAgaWYgKC9yZWZlcnJlcl9sb2cvaS50ZXN0KGxpbmsub25jbGljaykpewogICAgICAgICAgICBsaW5rLnJlbW92ZUF0dHJpYnV0ZSgnb25jbGljaycpOwogICAgICAgICAgICBsaW5rLnJlbW92ZUF0dHJpYnV0ZSgnb25tb3VzZW92ZXInKTsKICAgICAgICB9CiAgICAgICAgcndTaW1wbGUobGluayk7CiAgICB9CiAgICAvLyBnb29nbGUKICAgIGZ1bmN0aW9uIHJ3R29vZ2xlKGxpbmspewogICAgICAgIC8vIHJlcGxhY2UgZ2xvYmFsIHJ3dCBzY3JpcHQKICAgICAgICBpZiAod2luZG93LnJ3dCAmJiB3aW5kb3cucnd0ICE9IHJldFRydWUpewogICAgICAgICAgICBkZWxldGUgd2luZG93LnJ3dDsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ3J3dCcsIHsgdmFsdWU6IHJldFRydWUsIHdyaXRhYmxlOiBmYWxzZSB9KTsKICAgICAgICB9CgogICAgICAgIC8vIG1haW4gc2VhcmNoCiAgICAgICAgaWYgKGxpbmsuaGFzQXR0cmlidXRlKCdvbm1vdXNlZG93bicpKQogICAgICAgICAgICBsaW5rLnJlbW92ZUF0dHJpYnV0ZSgnb25tb3VzZWRvd24nKTsKICAgICAgICAvLyBpbWFnZXMKICAgICAgICBpZiAobGluay5oYXNBdHRyaWJ1dGUoJ2pzYWN0aW9uJykpewogICAgICAgICAgIHZhciB0bXAgPSBsaW5rLmdldEF0dHJpYnV0ZSgnanNhY3Rpb24nKTsKICAgICAgICAgICBpZiAodG1wKQogICAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnanNhY3Rpb24nLCB0bXAucmVwbGFjZSgvKG1vdXNlZG93bjppcmMucmx8a2V5ZG93bjppcmMucmxrKS9nLCcnKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIHlhbmRleAogICAgZnVuY3Rpb24gcndZYW5kZXgobGluayl7CiAgICAgICAgLy8gbWFpbiBzZWFyY2gKICAgICAgICBpZiAobGluay5oYXNBdHRyaWJ1dGUoJ29ubW91c2Vkb3duJykpCiAgICAgICAgICAgIGxpbmsucmVtb3ZlQXR0cmlidXRlKCdvbm1vdXNlZG93bicpOwogICAgICAgIC8vIGltYWdlcwogICAgICAgIC8vVE9ETwogICAgfQogICAgLy9tb3ppbGxhIGFkZG9ucyBzdG9yZQogICAgZnVuY3Rpb24gcndBTU8obGluayl7CiAgICAgICAgaWYgKC9vdXRnb2luZy5tb3ppbGxhLm9yZy9pLnRlc3QobGluay5ocmVmKSl7CiAgICAgICAgICAgIHZhciB0bXAgPSBsaW5rLmhyZWY7CiAgICAgICAgICAgIGxpbmsuaHJlZiA9ICIjIjsKICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byBmaWdodCBtb3ppbGxhJ3MgcmVwbGFjaW5nIG9mIGRpcmVjdCByZWRpcmVjdCBzdHJpbmcgd2l0aCBqcXVlcnkgZXZlbnRzCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgbGluay5ocmVmID0gdW5lc2NhcGUodG1wLnJlcGxhY2UoLyhodHRwfGh0dHBzKTpcL1wvb3V0Z29pbmcubW96aWxsYS5vcmdcL3YxXC9bMC05YS16QS1aXStcLy9pLCcnKSk7IH0sIDEwMCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGRhbml1ZWxkZWZvCiAgICBmdW5jdGlvbiByd0RhbmllbERlZm8obGluayl7CiAgICAgICAgaWYgKGxpbmsuaGFzQXR0cmlidXRlKCdkYXRhLXByb3h5LWhyZWYnKSkKICAgICAgICAgICAgbGluay5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtcHJveHktaHJlZicpOwogICAgfQoKICAgIC8vIGRldGVybWluZSBhbmNob3JzLCBmdW5jdGlvbnMgYW5kIGxpc3RlbmVycwogICAgKGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgcndMaW5rID0gcndTaW1wbGU7CiAgICAgICAgcndBbGwgPSByd2FTaW1wbGU7CgogICAgICAgIHZhciBsb2MgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7CiAgICAgICAgaWYgKC9nb29nbGUvaS50ZXN0KGxvYykpCiAgICAgICAgICAgIHJ3TGluayA9IHJ3R29vZ2xlOwogICAgICAgIGVsc2UgaWYgKC95b3V0dWJlL2kudGVzdChsb2MpKXsKICAgICAgICAgICAgYW5jaG9yID0gJ3JlZGlyZWN0P3E9JzsKICAgICAgICAgICAgYWZ0ZXIgPSAnJnJlZGlyX3Rva2VuPSc7CiAgICAgICAgICAgIHJ3TGluayA9IHJ3WW91dHViZTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoL2ZhY2Vib29rL2kudGVzdChsb2MpKXsKICAgICAgICAgICAgYW5jaG9yID0gJ3U9JzsKICAgICAgICAgICAgYWZ0ZXIgPSAnJmg9JzsKICAgICAgICAgICAgcndMaW5rID0gcndGYWNlYm9vazsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoL3R3aXR0ZXIvaS50ZXN0KGxvYykpewogICAgICAgICAgICByd0xpbmsgPSByd1R3aXR0ZXI7CiAgICAgICAgICAgIHJ3QWxsID0gcndhVHdpdHRlcjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoL3lhbmRleC9pLnRlc3QobG9jKSkKICAgICAgICAgICAgcndMaW5rID0gcndZYW5kZXg7CiAgICAgICAgZWxzZSBpZiAoL3ZrL2kudGVzdChsb2MpKXsKICAgICAgICAgICAgYW5jaG9yID0gJ3RvPSc7CiAgICAgICAgICAgIGFmdGVyID0gJyZwb3N0PSc7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKC9vay9pLnRlc3QobG9jKSl7CiAgICAgICAgICAgIGFuY2hvciA9ICdzdC5saW5rPSc7CiAgICAgICAgICAgIGFmdGVyID0gJyZzdC5uYW1lPSc7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKC9waXhpdi9pLnRlc3QobG9jKSkKICAgICAgICAgICAgYW5jaG9yID0gJ2p1bXAucGhwPyc7CiAgICAgICAgZWxzZSBpZiAoL3R1bWJsci9pLnRlc3QobG9jKSl7CiAgICAgICAgICAgIGFuY2hvciA9ICJyZWRpcmVjdD96PSI7CiAgICAgICAgICAgIGFmdGVyID0gIiZ0PSI7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKC9kZXZpYW50YXJ0L2kudGVzdChsb2MpKQogICAgICAgICAgICBhbmNob3IgPSAnb3V0Z29pbmc/JzsKICAgICAgICBlbHNlIGlmICgvc3RlYW0vaS50ZXN0KGxvYykpCiAgICAgICAgICAgIGFuY2hvciA9ICd1cmw9JzsKICAgICAgICBlbHNlIGlmICgvKGthdHxraWNrYXNzKS9pLnRlc3QobG9jKSl7CiAgICAgICAgICAgIGFuY2hvciA9ICdjb25maXJtL3VybC8nOwogICAgICAgICAgICByd0xpbmsgPSByd0tpY2thc3M7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKC9zb3VuZGNsb3VkL2kudGVzdChsb2MpKQogICAgICAgICAgICBhbmNob3IgPSAiZXhpdC5zYy8/dXJsPSI7CiAgICAgICAgZWxzZSBpZiAoL3Vwd29yay9pLnRlc3QobG9jKSkKICAgICAgICAgICAgYW5jaG9yID0gJ2xlYXZpbmctb2Rlc2s/cmVmPSc7CiAgICAgICAgZWxzZSBpZiAoLzRwZGEvaS50ZXN0KGxvYykpewogICAgICAgICAgICBhbmNob3IgPSAnZ28vP3U9JzsKICAgICAgICAgICAgYWZ0ZXIgPSAnJmU9JzsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoL3JlYWN0b3IvaS50ZXN0KGxvYykpCiAgICAgICAgICAgIGFuY2hvciA9ICd1cmw9JzsKICAgICAgICBlbHNlIGlmICgvbW96aWxsYS9pLnRlc3QobG9jKSkKICAgICAgICAgICAgcndMaW5rID0gcndBTU87CiAgICAgICAgZWxzZSBpZiAoL2RhbmllbGRlZm8vaS50ZXN0KGxvYykpCiAgICAgICAgICAgIHJ3TGluayA9IHJ3RGFuaWVsRGVmbzsKICAgICAgICBlbHNlIGlmICgveWFwbGFrYWwvaS50ZXN0KGxvYykpCiAgICAgICAgICAgIGFuY2hvciA9ICJnby8/IjsKCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICB2YXIgbm9kZSA9IGV2ZW50LnRhcmdldDsKICAgICAgICAgICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBIVE1MQW5jaG9yRWxlbWVudCkKICAgICAgICAgICAgICAgIHJ3TGluayhub2RlKTsKICAgICAgICAgICAgdmFyIGxpbmtzID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmtzLmxlbmd0aDsgKytpKQogICAgICAgICAgICAgICAgcndMaW5rKGxpbmtzW2ldKTsKICAgICAgICB9LCBmYWxzZSk7CiAgICB9KSgpOwogICAgcndBbGwoKTsKfSkoKTsK"},{"name":"YouTube Link Title","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["googleapis.com","vimeo.com","vine.co","liveleak.com","worldstarhiphop.com","dailymotion.com","coub.com","vid.me","streamable.com"],"orig_excludes":["http*//*.google.*/*","*//*.googleapis.com/*","*//vimeo.com/*","*//*.vimeo.com/*","*//*.worldstarhiphop.com/*","*//vine.co/*","*//*.dailymotion.com/*","*//coub.com/*","*//vid.me/*","*//*.vid.me/*","*://disqus.com/embed/*worldstarhiphop*","*//streamable.com/*","*//*.streamable.com/*"],"orig_includes":["http*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"big":"btrue","cache":"s{\"ythRF0kb9MRlg\":\"Video not found\\t4\",\"ytovpKSL5jnAA\":\"Battery powered plane gets a test flight - Elektra One - D-MELN\",\"ytObmAOJA__1k\":\"Glass engine, rendered CAD animation, combustion high speed imaging, based on a Pannonia block\",\"ytW2eILCrW53M\":\"Deutz engine 1\",\"yt2QB7XPMeLnA\":\"Deutz engine 2\",\"ytY_e7rA4fBAo\":\"Elon Musk on why Hydrogen fuel cell is dumb (2015.1.13)\",\"ytB_Whbb_hlPs\":\"Hydrogen Fuel Cell electric bike\",\"vm25279206\":\"Fuel Starvation\\t\\thttps://i.vimeocdn.com/video/166349982_295x166.jpg\",\"ytu0uPmrSRM7w\":\"Ilmor 5 Stroke Engine\",\"ytUmA_3CRHFQU\":\"Sixth Stroke - An Interview with Chanayil Cleetus Anil, NIYKADO Motors\",\"ytr1EVfr0diZY\":\"Live conversation between UN Secretary General Ban Ki-Moon & Bertrand Piccard\",\"yto_9oDFMiIhw\":\"Design Of Solar Impulse 1 to European Flights 2011\",\"ytcqOHbihYbhE\":\"Intelligence in Wikipedia\",\"ytVM3OPNwGOFg\":\"Resisting Internet Censorship: Katherine Maher of Access at SHARE Beirut\",\"yt7VApsZ4Ltac\":\"Success with Code Avengers\",\"ytTxPpH8LJfdg\":\"5.ua ::    \\\"  \\\"\",\"yt6OFL_6UQgog\":\"     Yanukovych\",\"ytWimc2kyuYjE\":\"  ?   () .\",\"yt5RScapkojhI\":\" IP- Asterisk:  \",\"ytwX6NwBa1csY\":\"Using SDXC Memory Cards is Easy\",\"ytvQqeAk__vvE\":\"CodeOverview for GVim\",\"ytA3PDXmYoF5U\":\"GoPro HERO3: Almost as Epic as the HERO3+\",\"cbz12n97i\":\"Hollaback Chicken\\t\\thttps://coubsecure-a.akamaihd.net/get/bucket:12.21/p/coub/simple/cw_image/0be3b055b27/f3f464e3cd755b5d1da63/big_1409579755_1381491418_00032.jpg\",\"vnhLQIB3Ka0Vl\":\"Flat Iron \\t\\thttps://v.cdn.vine.co/r/thumbs/E77952692D1035360409206550528_1ca211dd7ba.4.7.16276969947760525878.mp4_82b1VK7Y_7lPcHEYtuwtsbe2NC9B0VoL5jX6JHTWAwuk73rqQU46nsNbxT7ChbbT.jpg?versionId=tAgi.miyDNaQlHQQx7Ddr2zpaHk3t533\",\"ytNWHfY_lvKIQ\":\"Learning from StackOverflow.com\",\"ytlIFE7h3m40U\":\"The Art of the Bodge: How I Made The Emoji Keyboard\",\"ytJv0UQR-5ZLs\":\"A Common Lisp FullScreen Window Manager (CLFSWM) presentation\",\"ytNlD2L-AUQ_Q\":\"Edit Replacements\",\"ytaRrPZ73ZEYA\":\"Personal Variable List\",\"ytKKvHVR7gLUY\":\"Install AHK Studio and download a plugin\",\"ytYCI4T09L7OI\":\"Getting Started\",\"ytMDcVR5enjP8\":\"MACHO MAN Trailer 2015 (HD) - Christian Ulmen, Nora Tschirner & Axel Stein\",\"ytoaF-HdgZVU8\":\"A Royal Night Out - Official UK Trailer - In Cinemas Now!\",\"ytIP0nMv_NI1s\":\"Google Chrome Extensions: Developing and Debugging\",\"ytNim4_f5QUxA\":\"Vim Training Class 1 - Basic motions and commands\",\"yt2pqipq-UEwQ\":\"Vim Training Class 2 - Customizing and Extending Vim\",\"ytLftssGgRl5M\":\"Re:Flex Motion Morph Tutorial\",\"ytY0m10OGcw14\":\"Sam Chao's \\\"All Damn Day\\\" Video\",\"yt9TolpbhGftQ\":\"Slick Willies -June Monthly 2016\",\"ytIK0mI8y3ADk\":\"Drawing Boards x Level x Smash Skates @ Flo\",\"yt1AnHBoAh1W4\":\"Boomtown Ramp 2014\",\"ytxog5rhN5e8w\":\"Vans Shop Riot 2016 UK Skateboard Competition - Slick Willies\",\"ytTavRhEulwQk\":\"  #1.  1:  HTML     \",\"yt-ymjT8C-tHc\":\"Configuring and deploying to IIS ASP.NET\",\"ytjobvVaekOKA\":\"The Big Bang Theory: \\\"Get back on the whores\\\"\",\"yteRZ4pO0gVWw\":\"DOM Mutation Observers & The Mutation Summary Library\",\"ytYpYqOneduiw\":\"Advisor Assignments and Placing and Removing Holds\",\"ytOUcWtCpPjew\":\"CalCentral for Advising: Queries\",\"ytxm6Lg0H2-AQ\":\"Where Did MyBerkeley App Go: Webinar 3/21/16\",\"ytiTy8gXRNbwc\":\"The Student Enrollment Experience\",\"ytamONbknrGFI\":\"The Schedule of Classes for Advisors\",\"ytDhBGH4spsiI\":\"Overview of CalCentral for Advising: The Student Experience\",\"vm95045348\":\"Introduction to the Babun Project\\t\\thttps://i.vimeocdn.com/video/474915578_295x166.jpg\",\"ytuEdRLlqdgA4\":\"iPad Art - Morgan Freeman Finger Painting\",\"ytweF-_dLYrzw\":\"Video not found\\t4\",\"ytHi2V1x1AkD8\":\"Tom Preston-Werner at Mail.ru Office 2010\",\"ytLn-B_fs9QMY\":\"Founders & CEOs of Eventbrite, GitHub, Mozilla, & ALOM on Startup Culture\",\"ytk2vJNNAQZlg\":\"Jive and Fox Business Host GitHub CEO Tom Preston-Werner\",\"yt7DoB0SCUtOk\":\"Tom Preston-Werner interviewed at OSCON 2013\",\"vm17118008\":\"Tom Preston-Werner - Mastering Git Basics\\t\\thttps://i.vimeocdn.com/video/105875001_640.jpg\",\"vm39016099\":\"Tom Preston-Werner - Optimizing for Happiness\\t\\thttps://i.vimeocdn.com/video/268999630_295x166.jpg\",\"vm35640883\":\"NLC 11: Closing keynote - Tom Preston-Werner (GitHub)\\t\\thttps://i.vimeocdn.com/video/243850374_295x166.jpg\",\"ytQ5ieU-yA_rU\":\"OptimizedHTML 1.0 -      \",\"ytp-Sdyj9qnmY\":\"     (   Google PageSpeed)\",\"ytH4cG4tbc-xQ\":\"Sass    -  \",\"ytZJZfIw3P8No\":\"ECMAScript 6 / ES6 New Features - Tutorial 1 - Let\",\"ytxZbMVj9XSUo\":\"Emacs running in Neovim\",\"ytK1XEVClxa_c\":\"CANT FOCUS? CHECK THIS OUT! | BY ANIKA MORJARIA\",\"ytUmb59mMvCxA\":\"Vim Multicursors\",\"ytNBdKplKl_3Q\":\"Gulp 3:  Vinyl-FS\",\"yt_BFWG82mMkw\":\"Gulp 4:   \",\"ytuPk6lQoTThE\":\"Gulp 1:   Gulp?   Grunt  Webpack\",\"ytxptUdO3GuG8\":\"Gulp 2:    \",\"ytoiMJNIG-yvg\":\"Gulp 7:  : browser-sync\",\"ytjocvHauHcA4\":\"Gulp 5:  , watch\",\"ytotkXzef2wQY\":\"Gulp 8:  \",\"ytuYZPNrT-e-8\":\"Gulp 6:   \",\"ytIjg9I1CY7Ok\":\"Gulp 9:     through2\",\"ytpjdrg6n5puU\":\"Gulp 10:   : eslint, gulp-if, stream-combiner2\",\"yt5aJB4vJlHBs\":\"Gulp 11:     Node.JS?\",\"ytVqYAitDKbpo\":\"Gulp 13:  + , , \",\"ytQc6go3cNuRk\":\"Gulp 12:  gulpfile'\",\"ytohWOWqskHWU\":\"Gulp 14:  Gulp  Webpack\",\"ytriIVNjPOyDo\":\"How to Pronounce Gulp\",\"ytE9FxNzv1Tr8\":\"Making HTTP realtime with HTTP 2.0 - Realtime Conf 2013\",\"ytU45e-zq4bTs\":\"[CSSconf.eu 2013] Peter Gasston - Future CSS in Web Components\",\"ytGpwpsbHM4gk\":\"Vim Align Plugin\",\"ytf1BEjGet8M8\":\"Morphine - Buena | 2 Meter Sessies | 25/5/1994\",\"ytYhqsjUUHj6g\":\"Vim as a Python IDE - Martin Brochhaus\",\"yt67OZNp9Z0CQ\":\"VIM Python-mode\",\"ytg5GamptmWeA\":\"Going cross-platform: how htop was made portable\",\"yt1-_YsRJ6Grs\":\"     Microsoft SQL Server Management Studio\",\"ytl6x-tIGrfEs\":\" IP-\",\"ytPbaG8I8OkAs\":\"  Windows Server 2016\",\"ytoJ3mK1m41TM\":\"    \",\"ytU5MAUWV6DVo\":\" \",\"yt1Yc-u5IyufI\":\",     Linux\",\"ytedNA4BuDWxY\":\"   SQL Server 2016\",\"ytTLVI2MzSQAc\":\"  proc1     Linux\",\"yt2zemgtuurUM\":\"    Windows\",\"ytmqjvUH5XN9M\":\"  :       \",\"ytbSBmqgVGhn8\":\"  SharePoint 2013  \",\"yt8S1snIWlV6I\":\" . Wireshark -  1\",\"ytsTOwJOHAfgQ\":\" FreeBSD\",\"ytPpLn26xBcn4\":\" UNIX (Linux/FreeBSD)   \\\"\\\"\",\"yt8XLRObfWwqQ\":\"    \\\"\\\"\",\"ytOHevIeUyA5g\":\"    LogParser\",\"ytSQRLwq_YCLI\":\"     Kaspersky Lab ( 1))\",\"yt5Y67Q7um1WU\":\" WebVPN   - Squid\",\"ytC0MOFGn4RcI\":\":\\\" ip- -\\\"\",\"vm25764692\":\"Threesome.vim work-in-progress demo\\t\\thttps://i.vimeocdn.com/video/169838259_295x166.jpg\"}","country":"s","darken":"btrue","embed_mode":"splayer","previews":"btrue","reverse_buttons":"bfalse","rewrite":"btrue","urls_only":"bfalse"},"ts":1473223456748},"enabled":true,"position":17,"file_url":"https://greasyfork.org/scripts/413-youtube-link-title/code/YouTube%20Link%20Title.user.js","uuid":"baf1f229-9311-46a5-84b2-b4a4cf6fa415","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgIFlvdVR1YmUgTGluayBUaXRsZQovLyBAZGVzY3JpcHRpb24gICAgQWRkcyB2aWRlbyB0aXRsZXMsIHNob3dzIHByZXZpZXdzIGFuZCBlbWJlZHMgb24gY2xpY2suIEFsc28gc3VwcG9ydGVkOiBWaW1lbywgTGl2ZUxlYWssIERhaWx5bW90aW9uLCB2aWRtZSwgV29ybGRTdGFySGlwSG9wLCBWaW5lLCBDb3ViLCBTdHJlYW1hYmxlCi8vIEBuYW1lc3BhY2UgICAgICBodHRwOi8vdzlwLmNvL3VzZXJzY3JpcHRzLwovLyBAdmVyc2lvbiAgICAgICAgMjAxNi43LjcKLy8gQGF1dGhvciAgICAgICAgIGt1ZWhsc2NocmFuawovLyBAaG9tZXBhZ2UgICAgICAgaHR0cDovL3c5cC5jby91c2Vyc2NyaXB0cy95dGx0Ci8vIEBpY29uICAgICAgICAgICBodHRwczovL3c5cC5jby91c2Vyc2NyaXB0cy95dGx0L2ljb24ucG5nCi8vIEBpbmNsdWRlICAgICAgICBodHRwKgovLyBAZXhjbHVkZSAgICAgICAgaHR0cCovLyouZ29vZ2xlLiovKgovLyBAZXhjbHVkZSAgICAgICAgKi8vKi5nb29nbGVhcGlzLmNvbS8qCi8vIEBleGNsdWRlICAgICAgICAqLy92aW1lby5jb20vKgovLyBAZXhjbHVkZSAgICAgICAgKi8vKi52aW1lby5jb20vKgovLyBAZXhjbHVkZSAgICAgICAgKi8vKi53b3JsZHN0YXJoaXBob3AuY29tLyoKLy8gQGV4Y2x1ZGUgICAgICAgICovL3ZpbmUuY28vKgovLyBAZXhjbHVkZSAgICAgICAgKi8vKi5kYWlseW1vdGlvbi5jb20vKgovLyBAZXhjbHVkZSAgICAgICAgKi8vY291Yi5jb20vKgovLyBAZXhjbHVkZSAgICAgICAgKi8vdmlkLm1lLyoKLy8gQGV4Y2x1ZGUgICAgICAgICovLyoudmlkLm1lLyoKLy8gQGV4Y2x1ZGUgICAgICAgICo6Ly9kaXNxdXMuY29tL2VtYmVkLyp3b3JsZHN0YXJoaXBob3AqCi8vIEBleGNsdWRlICAgICAgICAqLy9zdHJlYW1hYmxlLmNvbS8qCi8vIEBleGNsdWRlICAgICAgICAqLy8qLnN0cmVhbWFibGUuY29tLyoKLy8gQGdyYW50ICAgICAgICAgIEdNX2dldFZhbHVlCi8vIEBncmFudCAgICAgICAgICBHTV9zZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QKLy8gQGdyYW50ICAgICAgICAgIEdNX2FkZFN0eWxlCi8vIEBncmFudCAgICAgICAgICBHTV9yZWdpc3Rlck1lbnVDb21tYW5kCi8vIEBjb25uZWN0LXNyYyAgICBnb29nbGVhcGlzLmNvbQovLyBAY29ubmVjdC1zcmMgICAgdmltZW8uY29tCi8vIEBjb25uZWN0LXNyYyAgICB2aW5lLmNvCi8vIEBjb25uZWN0LXNyYyAgICBsaXZlbGVhay5jb20KLy8gQGNvbm5lY3Qtc3JjICAgIHdvcmxkc3RhcmhpcGhvcC5jb20KLy8gQGNvbm5lY3Qtc3JjICAgIGRhaWx5bW90aW9uLmNvbQovLyBAY29ubmVjdC1zcmMgICAgY291Yi5jb20KLy8gQGNvbm5lY3Qtc3JjICAgIHZpZC5tZQovLyBAY29ubmVjdC1zcmMgICAgc3RyZWFtYWJsZS5jb20KLy8gPT0vVXNlclNjcmlwdD09CgondXNlIHN0cmljdCc7CgpmdW5jdGlvbiBvbkxvYWQoKSB7CglpZihsb2NhdGlvbi5ob3N0bmFtZS5pbmRleE9mKCdsaXZlbGVhay5jb20nKSA+IC0xKSB7CgkJcmV0dXJuIGxvY2F0aW9uLnBhdGhuYW1lID09ICcvbGxfZW1iZWQnICYmIGxvY2F0aW9uLmhhc2ggPT0gJyNwbGF5JyA/IGxvY2F0aW9uLmhyZWYgPSAnamF2YXNjcmlwdDp2b2lkKGp3cGxheWVyLmFwaS5zZWxlY3RQbGF5ZXIoKS5wbGF5KCkpOycgOiBmYWxzZTsKCX0gZWxzZSBpZihsb2NhdGlvbi5ob3N0bmFtZS5pbmRleE9mKCd5b3V0dWJlLmNvbScpID4gLTEgfHwgbG9jYXRpb24uaG9zdG5hbWUuaW5kZXhPZigneW91dHViZS1ub2Nvb2tpZS5jb20nKSA+IC0xKSB7CgkJaWYobG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZignL2VtYmVkLycpID09IDAgJiYgd2luZG93LnRvcCAhPSB3aW5kb3cuc2VsZikgewoJCQlkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3IoJy55dHAtY2hyb21lLWNvbnRyb2xzIGFbaHJlZio9Ind3dy55b3V0dWJlLmNvbSJdJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7CgkJCQl3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHtZVExUOidjbG9zZSd9LCAnKicpOwoJCQl9KTsKCQl9CgkJcmV0dXJuOwoJfQoJY2ZnLmxvYWQoKTsKCXZhciBxID0gJ2FbaHJlZio9Ii8vdC5jby8iXSc7Cglmb3IodmFyIHNpZCBpbiBzaXRlcykgewoJCXEgKz0gc2l0ZXNbc2lkXS5wYXR0ZXJucy5yZWR1Y2UoZnVuY3Rpb24ocHJldiwgY3VyKSB7IHJldHVybiAgcHJldiArICcsYVtocmVmKj0iJyArIGN1ciArJyJdJzsgfSwgJycpOwoJfQoJbGlua3MucXVlcnkgPSBxOwoJbGlua3MucHJvY2VzcyhkLmJvZHkpOwoJdmFyIE0gPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlcjsKCWlmKE0pIHsKCQl2YXIgb3B0cyA9IGxvY2F0aW9uLmhvc3RuYW1lID09ICd3d3cuZmFjZWJvb2suY29tJyA/IHtjaGlsZExpc3Q6dHJ1ZSwgc3VidHJlZTp0cnVlLCBhdHRyaWJ1dGVzOnRydWUsIGF0dHJpYnV0ZUZpbHRlcjpbJ2hyZWYnXX0gOiB7Y2hpbGRMaXN0OnRydWUsIHN1YnRyZWU6dHJ1ZX07CgkJbmV3IE0ob25NdXRhdGlvbnMpLm9ic2VydmUoZC5ib2R5LCBvcHRzKTsKCX0gZWxzZSB7CgkJZC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIG9uTm9kZUluc2VydGVkKTsKCX0KCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgb25NZXNzYWdlKTsKCUdNX3JlZ2lzdGVyTWVudUNvbW1hbmQoJ1NldCB1cCBZb3VUdWJlIExpbmsgVGl0bGUnLCBzZXR1cC5zaG93KTsKfQoKZnVuY3Rpb24gb25Ob2RlSW5zZXJ0ZWQoZSkgewoJdmFyIHQgPSBlLnRhcmdldDsKCWlmKHQubm9kZVR5cGUgPT0gMSkgd2luZG93LnNldFRpbWVvdXQobGlua3MucHJvY2VzcywgMTAwLCB0KTsKfQoKZnVuY3Rpb24gb25NdXRhdGlvbnMobXV0cykgewoJZm9yKHZhciBpID0gbXV0cy5sZW5ndGgsIG07IGktLSAmJiAobSA9IG11dHNbaV0pOykgewoJCWlmKG0udHlwZSA9PSAnYXR0cmlidXRlcycpIHsKCQkJd2luZG93LnNldFRpbWVvdXQobGlua3MucHJvY2VzcywgMTAwLCBtLnRhcmdldCk7CgkJfSBlbHNlIHsKCQkJZm9yKHZhciBqID0gbS5hZGRlZE5vZGVzLmxlbmd0aCwgbm9kZTsgai0tICYmIChub2RlID0gbS5hZGRlZE5vZGVzW2pdKTspIHsKCQkJCWlmKG5vZGUubm9kZVR5cGUgPT0gMSkgd2luZG93LnNldFRpbWVvdXQobGlua3MucHJvY2VzcywgMTAwLCBub2RlKTsKCQkJfQoJCX0KCX0KfQoKZnVuY3Rpb24gb25NZXNzYWdlKGUpIHsKCWlmKHR5cGVvZiBlLmRhdGEgIT0gJ29iamVjdCcgfHwgIWUuZGF0YS5ZVExUKSByZXR1cm47Cgl2YXIgbGkgPSBlLmRhdGEuWVRMVDsKCWlmKGxpID09ICdjbG9zZScpIHJldHVybiBwb3B1cC5jbG9zZSgpOwoJaWYod2luZG93LmZyYW1lcy5sZW5ndGggPiAxKSB7CgkJbGkuc2VsZiA9IHRydWU7CgkJZS5zb3VyY2UucG9zdE1lc3NhZ2Uoe1lUTFQ6bGl9LCAnKicpOwoJfSBlbHNlIHsKCQlwb3B1cC5zaG93KGxpKTsKCX0KfQoKZnVuY3Rpb24gY2UobiwgcHJvcHMpIHsKCXZhciBuID0gZC5jcmVhdGVFbGVtZW50KG4pOwoJaWYocHJvcHMpIHsKCQlmb3JFYWNoKHByb3BzLCBmdW5jdGlvbihwKSB7CgkJCWlmKHAgPT0gJ2NsaWNrJyB8fCBwID09ICdtb3VzZWRvd24nIHx8IHAgPT0gJ21vdXNlZG93bicpIHsKCQkJCW4uYWRkRXZlbnRMaXN0ZW5lcihwLCBwcm9wc1twXSk7CgkJCX0gZWxzZSB7CgkJCQluW3BdID0gcHJvcHNbcF07CgkJCX0KCQl9KTsKCX0KCXJldHVybiBuOwp9CgpmdW5jdGlvbiBmb3JFYWNoKG8sIGYpIHsKCXZhciBwcm9wcyA9IE9iamVjdC5rZXlzKG8pOwoJZm9yKHZhciBpID0gcHJvcHMubGVuZ3RoLCBwOyBpLS0gJiYgKHAgPSBwcm9wc1tpXSk7KSB7CgkJaWYoby5oYXNPd25Qcm9wZXJ0eShwKSkgZihwKTsKCX0KfQoKZnVuY3Rpb24gcm0oaWQpIHsKCXZhciBub2RlID0gJChpZCk7CglpZihub2RlKSBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7Cn0KCnZhciBkID0gZG9jdW1lbnQsICQgPSBmdW5jdGlvbihpZCkgeyByZXR1cm4gZC5nZXRFbGVtZW50QnlJZChpZCk7IH0sIGxvZyA9IGZ1bmN0aW9uKHMpIHsgY29uc29sZS5sb2cocyk7IH07Cgp2YXIgc2V0dXAgPSB7CglpZDogJ1lUTFQtc2V0dXAnLAoJaHRtbDogZnVuY3Rpb24oKSB7CgkJdmFyIGggPSAnPGRpdj5Zb3VUdWJlIExpbmsgVGl0bGU8L2Rpdj48dWw+JzsKCQl0aGlzLmZvckVhY2goZnVuY3Rpb24obikgewoJCQl2YXIgcyA9IGNmZy5zZXR0aW5nc1tuXTsKCQkJaWYodHlwZW9mIHMuZGVmYXVsdCA9PSAnYm9vbGVhbicpIHsKCQkJCWggKz0gJzxsaT48aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9IicrIG4gKyciPiAnICsgcy50aXRsZSArICc8L2xpPicKCQkJfSBlbHNlIGlmKHMub3B0aW9ucykgewoJCQkJaCArPSAnPGxpPicgKyBzLnRpdGxlICsgJzogPHNlbGVjdCBuYW1lPSInICsgbiArICciPic7CgkJCQlmb3JFYWNoKHMub3B0aW9ucywgZnVuY3Rpb24ob24pIHsKCQkJCQloICs9ICc8b3B0aW9uIHZhbHVlPSInICsgb24gKyAnIj4nICsgcy5vcHRpb25zW29uXSArJzwvb3B0aW9uPic7CgkJCQl9KTsKCQkJCWggKz0gJzwvc2VsZWN0PjwvbGk+JzsKCQkJfSBlbHNlIGlmKHR5cGVvZiBzLmRlZmF1bHQgPT0gJ3N0cmluZycpIHsKCQkJCWggKz0gJzxsaT4nICsgcy50aXRsZSArICc6IDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSInKyBuICsnIiBtYXhsZW5ndGg9IicgKyBzLm1heGxlbmd0aCArICciIHN0eWxlPSJ3aWR0aDonICsgcy5tYXhsZW5ndGgqMTIgKydweCI+PC9saT4nOwoJCQl9CgkJfSk7CgkJcmV0dXJuIGggKz0gJzwvdWw+PGRpdj48YnV0dG9uIG5hbWU9InNhdmUiPlNhdmUgc2V0dGluZ3M8L2J1dHRvbj48L2Rpdj48L2Rpdj4nOwoJfSwKCXE6IGZ1bmN0aW9uKG4pIHsKCQlyZXR1cm4gZC5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMuaWQgKyAnICpbbmFtZT0iJyArIG4gKyAnIl0nKTsKCX0sCglnZXQ6IGZ1bmN0aW9uKG4pIHsKCQl2YXIgcyA9IGNmZy5zZXR0aW5nc1tuXTsKCQlpZih0eXBlb2Ygcy5kZWZhdWx0ID09ICdib29sZWFuJykgcmV0dXJuIHRoaXMucShuKS5jaGVja2VkOwoJCWlmKHMub3B0aW9ucykgewl2YXIgc2VsID0gdGhpcy5xKG4pOyByZXR1cm4gc2VsLm9wdGlvbnNbc2VsLnNlbGVjdGVkSW5kZXhdLnZhbHVlOyB9CgkJaWYodHlwZW9mIHMuZGVmYXVsdCA9PSAnc3RyaW5nJykgcmV0dXJuIHRoaXMucShuKS52YWx1ZTsKCX0sCglzZXQ6IGZ1bmN0aW9uKG4sIHZhbCkgewoJCXZhciBzID0gY2ZnLnNldHRpbmdzW25dOwoJCWlmKHR5cGVvZiBzLmRlZmF1bHQgPT0gJ2Jvb2xlYW4nKSB7CgkJCXRoaXMucShuKS5jaGVja2VkID0gdmFsOwoJCX0gZWxzZSBpZihzLm9wdGlvbnMpIHsKCQkJdmFyIHNlbCA9IHRoaXMucShuKTsKCQkJZm9yKHZhciBpID0gc2VsLm9wdGlvbnMubGVuZ3RoOyBpLS07KSB7CWlmKHNlbC5vcHRpb25zW2ldLnZhbHVlID09IHZhbCkgc2VsLnNlbGVjdGVkSW5kZXggPSBpOyB9CgkJfSBlbHNlIGlmKHR5cGVvZiBzLmRlZmF1bHQgPT0gJ3N0cmluZycpIHsKCQkJdGhpcy5xKG4pLnZhbHVlID0gdmFsLnRyaW0oKTsKCQl9Cgl9LAoJZm9yRWFjaDogZnVuY3Rpb24oZikgewoJCWZvckVhY2goY2ZnLnNldHRpbmdzLCBmdW5jdGlvbihuKSB7IGlmKGNmZy5zZXR0aW5nc1tuXS50aXRsZSkgZihuKTsgfSk7Cgl9LAoJc2hvdzogZnVuY3Rpb24oKSB7CgkgICAgcm0oc2V0dXAuaWQpOwoJICAgIEdNX2FkZFN0eWxlKCdcCgkgICAgICAgICMnK3NldHVwLmlkKycgeyBwb3NpdGlvbjpmaXhlZDt6LWluZGV4OjIxNDc0ODM2NDc7dG9wOjQwcHg7cmlnaHQ6NDBweDtwYWRkaW5nOjIwcHggMzBweDtiYWNrZ3JvdW5kLWNvbG9yOndoaXRlO3dpZHRoOmF1dG87Ym9yZGVyOjFweCBzb2xpZCBibGFjayB9XAoJICAgICAgICAjJytzZXR1cC5pZCsnICogeyBjb2xvcjpibGFjazt0ZXh0LWFsaWduOmxlZnQ7bGluZS1oZWlnaHQ6bm9ybWFsO2ZvbnQtc2l6ZToxMnB4IH1cCgkgICAgICAgICMnK3NldHVwLmlkKycgZGl2IHsgdGV4dC1hbGlnbjpjZW50ZXI7Zm9udC13ZWlnaHQ6Ym9sZDtmb250LXNpemU6MTRweCB9XAoJICAgICAgICAjJytzZXR1cC5pZCsnIHVsIHsgbWFyZ2luOjE1cHggMCAxNXB4IDA7cGFkZGluZzowO2xpc3Qtc3R5bGU6bm9uZSB9XAoJICAgICAgICAjJytzZXR1cC5pZCsnIGxpIHsgbWFyZ2luOjA7cGFkZGluZzozcHggMCAzcHggMDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGUgfScKCSAgICApOwoJCWQuYm9keS5hcHBlbmRDaGlsZChjZSgnZGl2Jywge2lkOnNldHVwLmlkLGlubmVySFRNTDpzZXR1cC5odG1sKCl9KSk7CgkJc2V0dXAucSgnc2F2ZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7CgkJCWlmKHNldHVwLmdldCgnY291bnRyeScpICE9IGNmZy5jb3VudHJ5KSBjYWNoZS5jbGVhcigneXQnKTsKCQkJc2V0dXAuZm9yRWFjaChmdW5jdGlvbihuKSB7IGNmZ1tuXSA9IHNldHVwLmdldChuKTsgfSk7CgkJCWNmZy54ID0gY2ZnLnkgPSBmYWxzZTsKCQkJY2ZnLnNhdmUoKTsKCQkJdGhpcy5kaXNhYmxlZCA9IHRydWU7CgkJCXRoaXMuaW5uZXJIVE1MID0gJ1JlbG9hZGluZy4uLic7CgkJCWxvY2F0aW9uLnJlbG9hZCgpOwoJCX0pOwoJCXNldHVwLmZvckVhY2goZnVuY3Rpb24obikgewoJCQlzZXR1cC5zZXQobiwgY2ZnW25dKTsKCQkJc2V0dXAucShuKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBzZXR1cC51cGRhdGUpOwoJCX0pOwoJCXNldHVwLnVwZGF0ZSgpOwoJfSwKCXVwZGF0ZTogZnVuY3Rpb24oKSB7CgkJc2V0dXAuZm9yRWFjaChmdW5jdGlvbihuKSB7CgkJCXZhciBzID0gY2ZnLnNldHRpbmdzW25dOwoJCQlpZighcy5kZXBlbmRzKSByZXR1cm47CgkJCXNldHVwLnEobikucGFyZW50Tm9kZS5zdHlsZS5kaXNwbGF5ID0gKE9iamVjdC5rZXlzKHMuZGVwZW5kcykuZXZlcnkoZnVuY3Rpb24oZG4pIHsgcmV0dXJuIHMuZGVwZW5kc1tkbl0udGVzdChzZXR1cC5nZXQoZG4pKTsgfSkpID8gJycgOiAnbm9uZSc7CgkJfSk7Cgl9Cn0KCnZhciBsaW5rcyA9IHsKCXByb2Nlc3M6IGZ1bmN0aW9uKG5vZGUpIHsKCQl2YXIgaSA9IDAsIGxpc3QgPSBub2RlLnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PSAnQScgPyBbbm9kZV0gOiBub2RlLnF1ZXJ5U2VsZWN0b3JBbGwobGlua3MucXVlcnkpLCBpc0ZCID0gbG9jYXRpb24uaG9zdG5hbWUgPT0gJ3d3dy5mYWNlYm9vay5jb20nOwoJCWlmKGxpc3QubGVuZ3RoIDwgMSkgcmV0dXJuOwoJCWZ1bmN0aW9uIHByb2Nlc3NDaHVuaygpIHsKCQkJdmFyIGEsIGxpLCB2aSwgbnVtID0gMCwgYWUgPSBkLmFjdGl2ZUVsZW1lbnQ7CgkJCXdoaWxlKGEgPSBsaXN0W2krK10pIHsKCQkJCWlmKCEobGkgPSBsaW5rcy5wYXJzZUluZm8oYSkpIHx8IGFlICYmIGFlICE9IGQuYm9keSAmJiBhZS5jb250YWlucyhhKSB8fCBpc0ZCICYmIChhLnBhcmVudE5vZGUub3V0ZXJIVE1MLmluZGV4T2YoJ3NoYXJlTGluaycpID4gLTEgfHwgYS5wYXJlbnROb2RlLm91dGVySFRNTC5pbmRleE9mKCdTY2FsZWRJbWFnZUNvbnRhaW5lcicpID4gLTEpKSBjb250aW51ZTsKCQkJCWlmKCh2aSA9IGNhY2hlLmdldChsaS5zaWQsIGxpLnZpZCkpIHx8IGNmZy51cmxzX29ubHkgJiYgIWxpLnVybCkgewoJCQkJCWxpbmtzLmRlY29yYXRlKGEsIGxpLCB2aSk7CgkJCQl9IGVsc2UgewoJCQkJCShmdW5jdGlvbihhLCBsaSkgewoJCQkJCQluZXQuaW5mbyhsaSwgZnVuY3Rpb24odmkpIHsgbGlua3MuZGVjb3JhdGUoYSwgbGksIHZpKTsgfSk7CgkJCQkJfSkoYSwgbGkpOwoJCQkJfQoJCQkJaWYoKytudW0gPT0gMTUpIHJldHVybiB3aW5kb3cuc2V0VGltZW91dChwcm9jZXNzQ2h1bmssIDEwMCk7CgkJCX0KCQkJbGlzdCA9IG51bGw7CgkJfQoJCW5vZGUgPSBudWxsOwoJCXByb2Nlc3NDaHVuaygpOwoJfSwKCXBhcnNlSW5mbzogZnVuY3Rpb24oYSkgewoJCXZhciB1cmwgPSBhLmdldEF0dHJpYnV0ZSgnZGF0YS1leHBhbmRlZC11cmwnKSB8fCBhLmdldEF0dHJpYnV0ZSgnZGF0YS1mdWxsLXVybCcpIHx8IGEuaHJlZjsKCQl0cnkgeyB1cmwgPSBkZWNvZGVVUklDb21wb25lbnQodXJsLnJlcGxhY2UoL15odHRwcz86XC9cLyg/Ond3d1wuZmFjZWJvb2tcLmNvbVwvLit8c3lzXC40Y2hhblwub3JnXC9kZXJlZmVyXD91cmw9fG91dFwucmVkZGl0XC5jb20uKykoaHR0cC4rKS8sICckMScpKS5yZXBsYWNlKC8mdG9rZW49W14mXSsvLCAnJyk7IH0gY2F0Y2goZXgpIHt9OwoJCXZhciB0ZXN0ID0gZnVuY3Rpb24ocGF0dGVybikgeyByZXR1cm4gdGhpcy5pbmRleE9mKHBhdHRlcm4udG9Mb3dlckNhc2UoKSkgIT0gLTE7IH07CgkJZm9yKHZhciBzaWQgaW4gc2l0ZXMpIHsKCQkJdmFyIHMgPSBzaXRlc1tzaWRdLCBpbmZvOwoJCQlpZighc2l0ZXNbc2lkXS5wYXR0ZXJucy5zb21lKHRlc3QsIHVybC50b0xvd2VyQ2FzZSgpKSkgY29udGludWU7CgkJCWlmKGluZm8gPSBzaXRlc1tzaWRdLnBhcnNlKHVybCkpIHJldHVybiB7c2lkOnNpZCx2aWQ6aW5mby52aWQsdDppbmZvLnQsdXJsOnNpdGVzW3NpZF0ucGF0dGVybnMuc29tZSh0ZXN0LCBhLnRleHRDb250ZW50LnRvTG93ZXJDYXNlKCkpLG9Vcmw6dXJsfTsKCQl9CgkJcmV0dXJuIG51bGw7Cgl9LAoJZGVjb3JhdGU6IGZ1bmN0aW9uKGEsIGxpLCB2aSkgewoJCWlmKFsnbGwnLCAnd2gnXS5pbmRleE9mKGxpLnNpZCkgPiAtMSAmJiAhdmkuc3RhdHVzICYmIGxvY2F0aW9uLnByb3RvY29sID09ICdodHRwczonKSB2aS5zdGF0dXMgPSA1OwoJCWlmKGEuY2xhc3NOYW1lLmluZGV4T2YoJ1lUTFQtJykgPiAtMSkgewoJCQlhLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsaWNrLCBmYWxzZSk7CgkJCWEucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgdGhpcy5vbk1vdXNlT3ZlciwgZmFsc2UpOwoJCX0gZWxzZSB7CgkJCWlmKCF0aGlzLnN0eWxlQWRkZWQpIHsKCQkJCXZhciBjc3MgPSAnXAoJCQkJCSNZVExULXByZXZpZXcgeyBwb3NpdGlvbjpmaXhlZDt6LWluZGV4OjIxNDc0ODM2NDU7d2lkdGg6MzIwcHg7cGFkZGluZzowO2JvcmRlcjoxcHggc29saWQgYmxhY2s7YmFja2dyb3VuZC1jb2xvcjpibGFjazsgfVwKCQkJCQkjWVRMVC1wcmV2aWV3IGltZyB7IG1heC1oZWlnaHQ6MjQwcHg7d2lkdGg6aW5oZXJpdDt2ZXJ0aWNhbC1hbGlnbjpib3R0b207IH1cCgkJCQkJI1lUTFQtcHJldmlldyBkaXYgeyBwYWRkaW5nOjRweCAycHg7d2lkdGg6MzE2cHg7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjtmb250LXNpemU6MTNweDtjb2xvcjp3aGl0ZTtmb250LXdlaWdodDpib2xkOyB9XAoJCQkJCWEuWVRMVC1uYSB7IHRleHQtZGVjb3JhdGlvbjogbGluZS10aHJvdWdoIWltcG9ydGFudDsgfVwKCQkJCQlhLllUTFQtdGV4dCB7IGZvbnQtd2VpZ2h0OmJvbGQhaW1wb3J0YW50O2ZvbnQtc3R5bGU6aXRhbGljIWltcG9ydGFudDsgfVwKCQkJCQlhLllUTFQtaWNvbiB7IHBhZGRpbmctbGVmdDoxOHB4IWltcG9ydGFudDsgfVwKCQkJCQlhLllUTFQtaWNvbi5ZVExULW5hOmhvdmVyLCBhLllUTFQtaWNvbi5ZVExULW5lOmhvdmVyIHsgYmFja2dyb3VuZDp0cmFuc3BhcmVudCB1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRUFBUUFLSUdBTy92Nyt2cjY3Nit2bVZsWlpxYW12Ly8vLy8vL3dBQUFDSDVCQUVBQUFZQUxBQUFBQUFRQUJBQUFBTS9hTHJjL3RBSVFpc1JqNERDT1NBWk40eERBVHBFVjR6bU1sVmRXWjZHeHFXcjJDcTRtYXUwbmswVkNIWmVsc3VpQnd5cGJwa05rY1pBV2pDUnJDSUJBRHM9KSBjZW50ZXIgbGVmdCBuby1yZXBlYXQhaW1wb3J0YW50OyB9JzsKCQkJCWZvcih2YXIgc2lkIGluIHNpdGVzKSB7CgkJCQkJY3NzICs9ICdhLllUTFQtaWNvbi0nICsgc2lkICsgJyB7IGJhY2tncm91bmQ6dHJhbnNwYXJlbnQgdXJsKCcgKyBzaXRlc1tzaWRdLmljb24gKyAnKSBjZW50ZXIgbGVmdCBuby1yZXBlYXQhaW1wb3J0YW50OyB9JzsKCQkJCX0KCQkJCUdNX2FkZFN0eWxlKGNzcyk7CgkJCQl0aGlzLnN0eWxlQWRkZWQgPSB0cnVlOwoJCQl9CgkJCXZhciBjID0gJyBZVExULWxpbmsnOwoJCQlpZihsaS51cmwgfHwgbG9jYXRpb24uaG9zdG5hbWUgPT0gJ3R3aXR0ZXIuY29tJykgewoJCQkJYyArPSAnIFlUTFQtdGV4dCBZVExULWljb24gWVRMVC1pY29uLScgKyBsaS5zaWQ7CgkJCQlpZih2aSkgYS5pbm5lckhUTUwgPSB2aS50aXRsZTsKCQkJfSBlbHNlIHsKCQkJCWlmKHZpICYmICFjZmcucHJldmlld3MgJiYgdmkudGl0bGUpIGEudGl0bGUgPSB2aS50aXRsZTsKCQkJCWlmKGEuaGFzQ2hpbGROb2RlcygpICYmIGEuaW5uZXJIVE1MLmluZGV4T2YoJzxpbWcnKSA9PSAtMSAmJiBhLnRleHRDb250ZW50LnRyaW0oKSkgewoJCQkJCWMgKz0gJyBZVExULWljb24gWVRMVC1pY29uLScgKyBsaS5zaWQ7CgkJCQl9CgkJCX0KCQkJaWYodmkuc3RhdHVzID09IDMgfHwgdmkuc3RhdHVzID09IDQpIHsKCQkJCWMgKz0gJyBZVExULW5hJzsKCQkJfSBlbHNlIGlmKHZpLnN0YXR1cyA9PSA1KSB7CgkJCQljICs9ICcgWVRMVC1uZSc7CgkJCX0KCQkJYS5jbGFzc05hbWUgKz0gYzsKCQkJaWYoY2ZnLnJld3JpdGUgJiYgc2l0ZXNbbGkuc2lkXS51cmwpIHsKCQkJCWEuaHJlZiA9IHNpdGVzW2xpLnNpZF0udXJsKGxpLnZpZCwgbGkudCwgbGkub1VybCk7CgkJCX0KCQl9CgkJaWYoY2ZnLmVtYmVkX21vZGUgIT0gJ29mZicpIHsKCQkJYS50YXJnZXQgPSAnX2JsYW5rJzsKCQkJaWYoIXZpLnN0YXR1cykgewoJCQkJYS5vbmNsaWNrID0gbnVsbDsKCQkJCWEuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xpY2spOwoJCQl9CgkJfQoJCWlmKGNmZy5wcmV2aWV3cyAmJiAodmkgJiYgdmkucHJldmlldyB8fCBzaXRlc1tsaS5zaWRdLnByZXZpZXcpICYmICFhLnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpKSB7CgkJCXZhciB1cmwgPSBlbWJlZGRpbmcucHJldmlldyh2aSwgbGkpOwoJCQlpZihbJ3R3aXR0ZXIuY29tJywgJ2dpdGh1Yi5jb20nXS5pbmRleE9mKGxvY2F0aW9uLmhvc3RuYW1lKSA+IC0xKSB7CgkJCQlhLnRpdGxlID0gJyc7CgkJCQlHTV94bWxodHRwUmVxdWVzdCh7CgkJCQkJbWV0aG9kOiAnR0VUJywKCQkJCQl1cmw6IHVybCwKCQkJCQlvdmVycmlkZU1pbWVUeXBlOiAndGV4dC9wbGFpbjsgY2hhcnNldD14LXVzZXItZGVmaW5lZCcsCgkJCQkJaGVhZGVyczogeydBY2NlcHQnOidpbWFnZS9wbmcsaW1hZ2UvKjtxPTAuOCwqLyo7cT0wLjUnfSwKCQkJCQlvbmxvYWQ6IGZ1bmN0aW9uKHJlcykgewoJCQkJCQl2YXIgdHh0ID0gcmVzLnJlc3BvbnNlVGV4dCwgdWk4ID0gbmV3IFVpbnQ4QXJyYXkodHh0Lmxlbmd0aCksIGZyID0gbmV3IEZpbGVSZWFkZXIoKTsKCQkJCQkJZm9yKHZhciBpID0gdHh0Lmxlbmd0aDsgaS0tOykgdWk4W2ldID0gdHh0LmNoYXJDb2RlQXQoaSk7CgkJCQkJCWZyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgeyBhLnNldEF0dHJpYnV0ZSgnZGF0YS15dGx0LXByZXZpZXcnLCBmci5yZXN1bHQpOyB9OwoJCQkJCQlmci5yZWFkQXNEYXRhVVJMKG5ldyBCbG9iKFt1aTguYnVmZmVyXSwge3R5cGU6J2ltYWdlL2pwZWcnfSkpOwoJCQkJCX0KCQkJCX0pOwoJCQl9IGVsc2UgewoJCQkJYS5zZXRBdHRyaWJ1dGUoJ2RhdGEteXRsdC1wcmV2aWV3JywgdXJsKTsKCQkJCW5ldyBJbWFnZSgpLnNyYyA9IHVybDsKCQkJfQoJCQlhLnNldEF0dHJpYnV0ZSgnZGF0YS15dGx0LXRpdGxlJywgdmkudGl0bGUpOwoJCQlhLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIHRoaXMub25Nb3VzZU92ZXIpOwoJCX0KCX0sCglvbkNsaWNrOiBmdW5jdGlvbihlKSB7CgkJaWYoZS5jdHJsS2V5IHx8IGUuYWx0S2V5IHx8IGUuc2hpZnRLZXkgfHwgZS5tZXRhS2V5IHx8IGUuYnV0dG9uICE9IDApIHJldHVybjsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQlybSgnWVRMVC1wcmV2aWV3Jyk7CgkJZW1iZWRkaW5nLnBsYXkodGhpcyk7Cgl9LAoJb25Nb3VzZU92ZXI6IGZ1bmN0aW9uKGUpIHsKCQlybSgnWVRMVC1wcmV2aWV3Jyk7CgkJdmFyIHVybCA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXl0bHQtcHJldmlldycpLCB0aXRsZSA9IHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXl0bHQtdGl0bGUnKTsKCQl2YXIgcW0gPSBkLmNvbXBhdE1vZGUgPT0gJ0JhY2tDb21wYXQnOwoJCXZhciB3ID0gcW0gPyBkLmJvZHkuY2xpZW50V2lkdGggOiBkLmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgaCA9IHFtID8gZC5ib2R5LmNsaWVudEhlaWdodCA6IGQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDsKCQl2YXIgZGl2ID0gY2UoJ2RpdicsIHtpZDonWVRMVC1wcmV2aWV3J30pOwoJCWlmKHVybCkgewoJCQl2YXIgaW1nID0gY2UoJ2ltZycsIHtzcmM6dXJsfSk7CgkJCWRpdi5hcHBlbmRDaGlsZChpbWcpOwoJCX0KCQlpZih0aXRsZSAmJiB0aGlzLnRleHRDb250ZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0aXRsZS50b0xvd2VyQ2FzZSgpKSA9PSAtMSkgZGl2LmFwcGVuZENoaWxkKGNlKCdkaXYnLCB7aW5uZXJIVE1MOnRpdGxlfSkpOwoJCWQuYm9keS5hcHBlbmRDaGlsZChkaXYpOwoJCXZhciByID0gKHRoaXMuZmlyc3RFbGVtZW50Q2hpbGQgfHwgdGhpcykuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgkJdmFyIGR3ID0gTWF0aC5tYXgoZGl2Lm9mZnNldFdpZHRoLCAzMjApLCBkaCA9IE1hdGgubWF4KGRpdi5vZmZzZXRIZWlnaHQsIDI0MCk7CgkJaWYoaCAtIHIuaGVpZ2h0ID4gMipkaCkgewoJCQlpZihyLnRvcCArIHIuYm90dG9tID4gaCkgewoJCQkJZGl2LnN0eWxlLmJvdHRvbSA9IGggLSByLnRvcCArIDE1ICsgJ3B4JzsKCQkJfSBlbHNlIHsKCQkJCWRpdi5zdHlsZS50b3AgPSByLmJvdHRvbSArIDE1ICsgJ3B4JzsKCQkJfQoJCQlkaXYuc3R5bGUubGVmdCA9IE1hdGgubWluKHcgLSBkdyAtIDEwLCBNYXRoLm1heCgxMCwgZS5wYWdlWCAtIGR3LzIpKSArICdweCc7CgkJfSBlbHNlIHsKCQkJaWYoci5yaWdodCArIHIubGVmdCA+IHcpIHsKCQkJCWRpdi5zdHlsZS5yaWdodCA9IHcgLSByLnJpZ2h0ICsgci53aWR0aCArIDE1ICsgJ3B4JzsKCQkJfSBlbHNlIHsKCQkJCWRpdi5zdHlsZS5sZWZ0ID0gci5sZWZ0ICsgci53aWR0aCArIDE1ICsgJ3B4JzsKCQkJfQoJCQlpZihyLnRvcCtyLmJvdHRvbSA+IGgpIHsKCQkJCWRpdi5zdHlsZS5ib3R0b20gPSBNYXRoLm1heCgyMCwgaCAtIHIudG9wIC0gci5oZWlnaHQvMiAtIGRoLzIpICsgJ3B4JzsKCQkJfSBlbHNlIHsKCQkJCWRpdi5zdHlsZS50b3AgPSBNYXRoLm1heCgxMCwgci50b3AgKyByLmhlaWdodC8yIC0gZGgvMikgKyAncHgnOwoJCQl9CgkJfQoJCWQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCBsaW5rcy5vbk1vdXNlT3V0KTsKCX0sCglvbk1vdXNlT3V0OiBmdW5jdGlvbihlKSB7CgkJZC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIGxpbmtzLm9uTW91c2VPdXQsIGZhbHNlKTsKCQlybSgnWVRMVC1wcmV2aWV3Jyk7Cgl9Cn07Cgp2YXIgbmV0ID0gewoJaW5mbzogZnVuY3Rpb24obGksIGYpIHsKCQl2YXIgaWQgPSBsaS5zaWQgKyBsaS52aWQ7CgkJaWYodHlwZW9mIG5ldC5wZW5kaW5nW2lkXSAhPSAnb2JqZWN0JykgewoJCQluZXQucGVuZGluZ1tpZF0gPSBbZl07CgkJCXNpdGVzW2xpLnNpZF0ucmVxdWVzdChsaS52aWQsIGZ1bmN0aW9uKHZpKSB7CgkJCQlpZih2aSkgewoJCQkJCWNhY2hlLnNldChsaS5zaWQsIGxpLnZpZCwgdmkpOwoJCQkJCWZvcih2YXIgaSA9IG5ldC5wZW5kaW5nW2lkXS5sZW5ndGg7IGktLTspIHsKCQkJCQkJd2luZG93LnNldFRpbWVvdXQobmV0LnBlbmRpbmdbaWRdW2ldLCAwLCB2aSk7CgkJCQkJfQoJCQkJfQoJCQkJZGVsZXRlIG5ldC5wZW5kaW5nW2lkXTsKCQkJCX0pOwoJCX0gZWxzZSB7CgkJCW5ldC5wZW5kaW5nW2lkXS5wdXNoKGYpOwoJCX0KCX0sCglwZW5kaW5nOiB7fSwKCWpzb246IGZ1bmN0aW9uKHVybCwgZikgewoJCUdNX3htbGh0dHBSZXF1ZXN0KHsKCQkJbWV0aG9kOgknR0VUJywKCQkJdXJsOgl1cmwsCgkJCW9ubG9hZDoJZnVuY3Rpb24ocmVxKSB7CgkJCQl2YXIgb2JqOwoJCQkJdHJ5IHsKCQkJCQlvYmogPSBKU09OLnBhcnNlKHJlcS5yZXNwb25zZVRleHQpOwoJCQkJfSBjYXRjaChleCkgewoJCQkJCWxvZygnSlNPTiBkYXRhIGZyb20gJyArIHVybCArICcgY291bGQgbm90IGJlIHBhcnNlZDogJyArIGV4ICsgJ1xuSFRUUDogJyArIHJlcS5zdGF0dXMgKyAnXG5SZXNwb25zZTogJyArIHJlcS5yZXNwb25zZVRleHQpOwoJCQkJfQoJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwgcmVxLnN0YXR1cywgb2JqLCByZXEucmVzcG9uc2VUZXh0KTsKCQkJfSwKCQkJb25lcnJvcjogZnVuY3Rpb24ocmVxKSB7CgkJCQlsb2coJ1JlcXVlc3QgdG8gJyArIHVybCArICcgZmFpbGVkLicpOwoJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwgcmVxLnN0YXR1cywgbnVsbCwgcmVxLnJlc3BvbnNlVGV4dCk7CgkJCX0KCQl9KTsKCX0sCgl0ZXh0OiBmdW5jdGlvbih1cmwsIHJlLCBmKSB7CgkJR01feG1saHR0cFJlcXVlc3QoewoJCQltZXRob2Q6CSdHRVQnLAoJCQl1cmw6CXVybCwKCQkJb25sb2FkOglmdW5jdGlvbihyZXEpIHsKCQkJCXZhciBtID0gW10sIHR4dCA9IHJlcS5yZXNwb25zZVRleHQ7CgkJCQlmb3IodmFyIGkgPSAwLCBsZW4gPSByZS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQkJCW0ucHVzaChyZVtpXS5leGVjKHR4dCkpOwoJCQkJfQoJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwgcmVxLnN0YXR1cywgbSk7CgkJCX0sCgkJCW9uZXJyb3I6IGZ1bmN0aW9uKHJlcSkgewoJCQkJbG9nKCdSZXF1ZXN0IHRvICcgKyB1cmwgKyAnIGZhaWxlZC4nKTsKCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDAsIHJlcS5zdGF0dXMsIFtdKTsKCQkJfQoJCX0pOwoJfQp9OwoKdmFyIGVtYmVkZGluZyA9IHsKCXBsYXk6IGZ1bmN0aW9uKGEpIHsKCQl2YXIgbGkgPSBsaW5rcy5wYXJzZUluZm8oYSk7CgkJaWYoY2ZnLmVtYmVkX21vZGUgPT0gJ2lubGluZScpIHsKCQkJdmFyIGVtYmVkID0gZW1iZWRkaW5nLmVtYmVkKGxpLCBjZmcuYmlnKTsKCQkJYS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChlbWJlZCwgYSk7CgkJCXdpbmRvdy5zZXRUaW1lb3V0KHdpbmRvdy5zY3JvbGxUbywgMCwgMCwgd2luZG93LnNjcm9sbFkgKyBlbWJlZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgLSB3aW5kb3cuaW5uZXJIZWlnaHQvMiArIGVtYmVkLm9mZnNldEhlaWdodC8yKTsKCQl9IGVsc2UgaWYoY2ZnLmVtYmVkX21vZGUgPT0gJ3dpbmRvdycgfHwgbG9jYXRpb24uaG9zdG5hbWUgPT0gJ2FwaS5zb2xpZG9waW5pb24uY29tJyAmJiBsb2NhdGlvbi5zZWFyY2guaW5kZXhPZignbmV4dGJpZ2Z1dHVyZS5jb20nKSkgewoJCQl2YXIgZW1iZWQgPSBlbWJlZGRpbmcuZW1iZWQobGksIGNmZy5iaWcpOwoJCQl2YXIgdyA9IHBhcnNlSW50KGVtYmVkLnN0eWxlLndpZHRoKSwgaCA9IHBhcnNlSW50KGVtYmVkLnN0eWxlLmhlaWdodCk7CgkJCWVtYmVkLnN0eWxlLndpZHRoID0gJzEwMCUnOwoJCQllbWJlZC5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7CgkJCXZhciBkaXYgPSBjZSgnZGl2Jyk7CgkJCWRpdi5hcHBlbmRDaGlsZChlbWJlZCk7CgkJCXZhciBmZWF0dXJlcyA9ICdsZWZ0PScrKHdpbmRvdy5zY3JlZW4ud2lkdGgvMi13LzIpKycsdG9wPScrKHdpbmRvdy5zY3JlZW4uaGVpZ2h0LzItaC8yKSsnLHdpZHRoPScrdysnLGhlaWdodD0nK2grJyxzdGF0dXM9bm8sc2Nyb2xsYmFycz1ubyxsb2NhdGlvbj1ubyxtZW51YmFyPW5vLHRvb2xiYXI9bm8scGVyc29uYWxiYXI9bm8sZGVwZW5kZW50PW5vJzsKCQkJd2luZG93Lm9wZW4oJ2RhdGE6dGV4dC9odG1sLDxodG1sPjx0aXRsZT5WaWRlbyBQbGF5ZXI8L3RpdGxlPjxib2R5IHN0eWxlPSJwYWRkaW5nOjA7bWFyZ2luOjA7b3ZlcmZsb3c6aGlkZGVuO2JhY2tncm91bmQ6YmxhY2siPicgKyBlbmNvZGVVUklDb21wb25lbnQoZGl2LmlubmVySFRNTCkgKyAnPC9ib2R5PjwvaHRtbD4nLCAnWW91VHViZSBMaW5rIFRpdGxlJywgZmVhdHVyZXMpOwoJCQlkaXYucmVtb3ZlQ2hpbGQoZW1iZWQpOwoJCX0gZWxzZSBpZihjZmcuZW1iZWRfbW9kZSA9PSAncGxheWVyJykgewoJCQlwb3B1cC5zaG93KGxpKTsKCQl9Cgl9LAoJZW1iZWQ6IGZ1bmN0aW9uKGxpLCBiaWcpIHsKCQl2YXIgc2l0ZSA9IHNpdGVzW2xpLnNpZF0sIGVtYmVkID0gY2UoJ2lmcmFtZScsIHtjbGFzc05hbWU6J1lUTFQtZW1iZWQnfSk7CgkJZW1iZWQuc2V0QXR0cmlidXRlKCd3ZWJraXRBbGxvd0Z1bGxTY3JlZW4nLCAnJyk7CgkJZW1iZWQuc2V0QXR0cmlidXRlKCdhbGxvd2Z1bGxzY3JlZW4nLCAnJyk7CgkJZW1iZWQuc2V0QXR0cmlidXRlKCdZVExULXNpZCcsIGxpLnNpZCk7CgkJZW1iZWRkaW5nLnJlc2l6ZShlbWJlZCwgYmlnKTsKCQllbWJlZC5zcmMgPSBzaXRlLmVtYmVkKGxpLnZpZCwgbGkudCk7CgkJZW1iZWQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgkJcmV0dXJuIGVtYmVkOwoJfSwKCXJlc2l6ZTogZnVuY3Rpb24oZW1iZWQsIGJpZykgewoJCXZhciBzaXRlID0gc2l0ZXNbZW1iZWQuZ2V0QXR0cmlidXRlKCdZVExULXNpZCcpXTsKCQl2YXIgdyA9IHNpdGUuc2l6ZXNbYmlnPzE6MF1bMF07CgkJdmFyIGggPSBzaXRlLnNpemVzW2JpZz8xOjBdWzFdOwoJCWVtYmVkLnN0eWxlLndpZHRoID0gdyArICdweCc7CgkJZW1iZWQuc3R5bGUuaGVpZ2h0ID0gaCArICdweCc7Cgl9LAoJcHJldmlldzogZnVuY3Rpb24odmksIGxpKSB7CgkJaWYodmkgJiYgdmkucHJldmlldykgewoJCQkgcmV0dXJuIHZpLnByZXZpZXc7CgkJfSBlbHNlIGlmKHNpdGVzW2xpLnNpZF0ucHJldmlldykgewoJCQlyZXR1cm4gc2l0ZXNbbGkuc2lkXS5wcmV2aWV3KGxpLnZpZCk7CgkJfQoJfQp9OwoKdmFyIHBvcHVwID0gewoJc2hvdzogZnVuY3Rpb24obGkpIHsKCQlpZih3aW5kb3cudG9wICE9IHdpbmRvdy5zZWxmICYmICFsaS5zZWxmKSByZXR1cm4gd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSh7WVRMVDpsaX0sICcqJyk7CgkJdGhpcy5jbG9zZSgpOwoJCWlmKCF0aGlzLnN0eWxlQWRkZWQpIHsKCQkJR01fYWRkU3R5bGUoJ1wKCQkJCSNZVExULWJnIHsgcG9zaXRpb246Zml4ZWQ7ei1pbmRleDoyMTQ3NDgzNjQ3O3RvcDowO3JpZ2h0OjA7Ym90dG9tOjA7bGVmdDowO2JhY2tncm91bmQtY29sb3I6YmxhY2s7b3BhY2l0eTowLjk7IH1cCgkJCQkjWVRMVC1wbGF5ZXIgeyBkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmZpeGVkO3otaW5kZXg6MjE0NzQ4MzY0NztsaW5lLWhlaWdodDpub3JtYWw7YmFja2dyb3VuZC1jb2xvcjpibGFjaztib3JkZXI6MnB4IHNvbGlkIGJsYWNrO2ZvbnQtc2l6ZToxM3B4O2xpbmUtaGVpZ2h0OjE2cHg7cGFkZGluZzowO21hcmdpbjowO2xlZnQ6YXV0bzt0b3A6YXV0bztyaWdodDphdXRvO2JvdHRvbTphdXRvOyB9XAoJCQkJI1lUTFQtcGxheWVyLXRpdGxlYmFyIHsgZGlzcGxheTpibG9jaztsaW5lLWhlaWdodDoxN3B4O3BhZGRpbmc6MDtiYWNrZ3JvdW5kOiMxYjFiMWI7Ym9yZGVyLWJvdHRvbToycHggc29saWQgYmxhY2s7dGV4dC1hbGlnbjonKyhjZmcucmV2ZXJzZV9idXR0b25zPydsZWZ0JzoncmlnaHQnKSsnOyB9XAoJCQkJI1lUTFQtcGxheWVyLWxlZnQgeyBkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6LTZweDt0b3A6NnB4O2JvdHRvbTo2cHg7d2lkdGg6OHB4O3BhZGRpbmc6MDttYXJnaW46MDtiYWNrZ3JvdW5kOm5vbmU7Y3Vyc29yOmV3LXJlc2l6ZTtzIH1cCgkJCQkjWVRMVC1wbGF5ZXItYm90dG9tIHsgZGlzcGxheTpibG9jaztwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjZweDtyaWdodDo2cHg7Ym90dG9tOi02cHg7aGVpZ2h0OjhweDtwYWRkaW5nOjA7bWFyZ2luOjA7YmFja2dyb3VuZDpub25lO2N1cnNvcjpucy1yZXNpemU7cyB9XAoJCQkJI1lUTFQtcGxheWVyLWRhcmtlbiB7IHBhZGRpbmc6MHB4IDExcHggM3B4IDExcHg7IH1cCgkJCQkjWVRMVC1wbGF5ZXItcmVzaXplIHsgcGFkZGluZzoxcHggMTFweCAycHggMTFweDsgfVwKCQkJCSNZVExULXBsYXllci1jbG9zZSB7IHBhZGRpbmc6MHB4IDI4cHggM3B4IDI4cHg7IH1cCgkJCQkjWVRMVC1wbGF5ZXIgLllUTFQtZW1iZWQgeyBib3JkZXI6MDtsaW5lLWhlaWdodDpub3JtYWw7IH1cCgkJCQkjWVRMVC1wbGF5ZXIgLllUTFQtcGxheWVyLXRpdGxlYmFyLWJ1dHRvbiB7IHZlcnRpY2FsLWFsaWduOnRvcDtkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW46MDtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNHB4O3RleHQtZGVjb3JhdGlvbjpub25lO2JvcmRlcjowO2JvcmRlci0nKyhjZmcucmV2ZXJzZV9idXR0b25zPydyaWdodCc6J2xlZnQnKSsnOjJweCBzb2xpZCBibGFjaztjb2xvcjojNzU3NTc1O3RleHQtZGVjb3JhdGlvbjpub25lO2N1cnNvcjpwb2ludGVyO2ZvbnQtZmFtaWx5OiJzZWdvZSB1aSIsdmVyZGFuYSxzYW5zLXNlcmlmOyB9XAoJCQkJI1lUTFQtcGxheWVyIC5ZVExULXBsYXllci10aXRsZWJhci1idXR0b246aG92ZXIgeyBjb2xvcjojOTU5NTk1IWltcG9ydGFudDsgfVwKCQkJCS5ZVExULWVtYmVkIHsgZGlzcGxheTpibG9jaztiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrO2JvcmRlcjoycHggc29saWQgYmxhY2s7bWFyZ2luOjA7cGFkZGluZzowOyB9XAoJCQkJI1lUTFQtcGxheWVyLllUTFQtcGxheWVyLW1vdmluZyB7IG9wYWNpdHk6MC44O2N1cnNvcjptb3ZlO2JvcmRlcjoycHggc29saWQgd2hpdGU7IH1cCgkJCQkjWVRMVC1wbGF5ZXIuWVRMVC1wbGF5ZXItcmVzaXppbmcgeyBvcGFjaXR5OjAuODsgfVwKCQkJCSNZVExULXBsYXllci5ZVExULXBsYXllci1tb3ZpbmcgLllUTFQtZW1iZWQsICNZVExULXBsYXllci5ZVExULXBsYXllci1yZXNpemluZyAuWVRMVC1lbWJlZCB7IHZpc2liaWxpdHk6aGlkZGVuOyB9XAoJCQkJLllUTFQtbm9zZWxlY3QgeyAtbW96LXVzZXItc2VsZWN0Om5vbmU7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lOy1vLXVzZXItc2VsZWN0Om5vbmU7IH0nCgkJCSk7CgkJCXRoaXMuc3R5bGVBZGRlZCA9IHRydWU7CgkJfQoJCXRoaXMubGkgPSBsaTsKCQl2YXIgdGl0bGViYXIgPSBjZSgnZGl2Jywge2lkOidZVExULXBsYXllci10aXRsZWJhcicsbW91c2Vkb3duOnRoaXMub25UaXRsZWJhck1vdXNlRG93bn0pOwoJCXZhciBidXR0b25zID0gWwoJCQljZSgnYScsIHtpZDonWVRMVC1wbGF5ZXItZGFya2VuJyxjbGFzc05hbWU6J1lUTFQtcGxheWVyLXRpdGxlYmFyLWJ1dHRvbiBZVExULW5vc2VsZWN0Jyxpbm5lckhUTUw6JyYjOTc4ODsnLGNsaWNrOnRoaXMub25EYXJrZW5DbGlja30pLAoJCQljZSgnYScsIHtpZDonWVRMVC1wbGF5ZXItcmVzaXplJyxjbGFzc05hbWU6J1lUTFQtcGxheWVyLXRpdGxlYmFyLWJ1dHRvbiBZVExULW5vc2VsZWN0JyxjbGljazp0aGlzLm9uUmVzaXplQ2xpY2t9KSwKCQkJY2UoJ2EnLCB7aWQ6J1lUTFQtcGxheWVyLWNsb3NlJyxjbGFzc05hbWU6J1lUTFQtcGxheWVyLXRpdGxlYmFyLWJ1dHRvbiBZVExULW5vc2VsZWN0Jyxpbm5lckhUTUw6J1gnLGNsaWNrOnRoaXMub25DbG9zZUNsaWNrfSkKCQldOwoJCWlmKGNmZy5yZXZlcnNlX2J1dHRvbnMpIGJ1dHRvbnMucmV2ZXJzZSgpOwoJCWZvcih2YXIgaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgaSsrKSB7CgkJCXRpdGxlYmFyLmFwcGVuZENoaWxkKGJ1dHRvbnNbaV0pOwoJCX0KCQl2YXIgcGxheWVyID0gY2UoJ2RpdicsIHtpZDonWVRMVC1wbGF5ZXInfSk7CgkJcGxheWVyLmFwcGVuZENoaWxkKHRpdGxlYmFyKTsKCQlwbGF5ZXIuYXBwZW5kQ2hpbGQoY2UoJ2RpdicsIHtpZDonWVRMVC1wbGF5ZXItbGVmdCcsbW91c2Vkb3duOnRoaXMub25Cb3JkZXJNb3VzZURvd259KSk7CgkJcGxheWVyLmFwcGVuZENoaWxkKGNlKCdkaXYnLCB7aWQ6J1lUTFQtcGxheWVyLWJvdHRvbScsbW91c2Vkb3duOnRoaXMub25Cb3JkZXJNb3VzZURvd259KSk7CgkJcGxheWVyLmFwcGVuZENoaWxkKGVtYmVkZGluZy5lbWJlZChsaSwgY2ZnLmJpZykpOwoJCWlmKGNmZy5kYXJrZW4pIGQuYm9keS5hcHBlbmRDaGlsZChjZSgnZGl2Jywge2lkOidZVExULWJnJ30pKTsKCQlkLmJvZHkuYXBwZW5kQ2hpbGQocGxheWVyKTsKCQl0aGlzLnVwZGF0ZSgpOwoJCXZhciB3ID0gcGxheWVyLm9mZnNldFdpZHRoLCBoID0gcGxheWVyLm9mZnNldEhlaWdodDsKCQl2YXIgeCA9IHBhcnNlRmxvYXQoY2ZnLngpLCB5ID0gcGFyc2VGbG9hdChjZmcueSk7CgkJdmFyIHFtID0gZC5jb21wYXRNb2RlID09ICdCYWNrQ29tcGF0JzsKCQl2YXIgY3cgPSBxbSA/IGQuYm9keS5jbGllbnRXaWR0aCA6IGQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoOwoJCXZhciBjaCA9IHFtID8gZC5ib2R5LmNsaWVudEhlaWdodCA6IGQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDsKCQl2YXIgbXggPSBjdyAtIHggLSB3LzI7CgkJdmFyIGlzUG9zVmFsaWQgPSBteCA+IDAgJiYgbXggPCBjdyAmJiB5ID4gLTUgJiYgeSA8IGNoIC0gaC8yOwoJCXBsYXllci5zdHlsZS5yaWdodCA9IChpc1Bvc1ZhbGlkID8geCA6IDgwKSArICdweCc7CgkJcGxheWVyLnN0eWxlLnRvcCAgID0gKGlzUG9zVmFsaWQgPyB5IDogY2gvMiAtIGgvMikgKyAncHgnOwoJCWQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMub25LZXlEb3duKTsKCX0sCgljbG9zZTogZnVuY3Rpb24oKSB7CgkJcm0oJ1lUTFQtcGxheWVyJyk7CgkJcm0oJ1lUTFQtYmcnKTsKCQlkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBwb3B1cC5vbktleURvd24sIHRydWUpOwoJfSwKCXVwZGF0ZTogZnVuY3Rpb24oZSkgewoJCSQoJ1lUTFQtcGxheWVyLXJlc2l6ZScpLmlubmVySFRNTCA9IGNmZy5iaWcgPyAnJiM2NTI5MzsnIDogJyYjNjUyOTE7JzsKCX0sCglvbkNsb3NlQ2xpY2s6IGZ1bmN0aW9uKGUpIHsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJcG9wdXAuY2xvc2UoKTsKCX0sCglvblJlc2l6ZUNsaWNrOiBmdW5jdGlvbihlKSB7CgkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCWNmZy5iaWcgPSAhY2ZnLmJpZzsKCQljZmcuc2F2ZSgpOwoJCXZhciBlbWJlZCA9IGQuYm9keS5xdWVyeVNlbGVjdG9yKCcjWVRMVC1wbGF5ZXIgLllUTFQtZW1iZWQnKTsKCQllbWJlZGRpbmcucmVzaXplKGVtYmVkLCBjZmcuYmlnKTsKCQlwb3B1cC51cGRhdGUoKTsKCX0sCglvbkRhcmtlbkNsaWNrOiBmdW5jdGlvbihlKSB7CgkJaWYoJCgnWVRMVC1iZycpKSB7CgkJCXJtKCdZVExULWJnJyk7CgkJCWNmZy5kYXJrZW4gPSBmYWxzZTsKCQkJY2ZnLnNhdmUoKTsKCQl9IGVsc2UgewoJCQl2YXIgcGxheWVyID0gJCgnWVRMVC1wbGF5ZXInKTsKCQkJcGxheWVyLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGNlKCdkaXYnLCB7aWQ6J1lUTFQtYmcnfSksIHBsYXllcik7CgkJCWNmZy5kYXJrZW4gPSB0cnVlOwoJCQljZmcuc2F2ZSgpOwoJCX0KCX0sCglvbktleURvd246IGZ1bmN0aW9uKGUpIHsKCQlpZihlLmtleUNvZGUgPT0gMjcpIHBvcHVwLmNsb3NlKCk7Cgl9LAoJb25UaXRsZWJhck1vdXNlRG93bjogZnVuY3Rpb24oZSkgewoJCXZhciB0ID0gZS50YXJnZXQ7CgkJaWYodC5pZCAhPSAnWVRMVC1wbGF5ZXItdGl0bGViYXInKSByZXR1cm47CgkJdC5wYXJlbnROb2RlLmNsYXNzTmFtZSA9ICdZVExULXBsYXllci1tb3ZpbmcnOwoJCXZhciByID0gdC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQl0LmR4ID0gZS5jbGllbnRYIC0gci5sZWZ0OwoJCXQuZHkgPSBlLmNsaWVudFkgLSByLnRvcDsKCQlkLmJvZHkuY2xhc3NOYW1lICs9ICcgWVRMVC1ub3NlbGVjdCc7CgkJZC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBwb3B1cC5vblRpdGxlYmFyTW91c2VNb3ZlKTsKCQlkLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBwb3B1cC5vblRpdGxlYmFyTW91c2VVcCk7Cgl9LAoJb25UaXRsZWJhck1vdXNlTW92ZTogZnVuY3Rpb24oZSkgewoJCXZhciB0aXRsZWJhciA9ICQoJ1lUTFQtcGxheWVyLXRpdGxlYmFyJyk7CgkJdGl0bGViYXIucGFyZW50Tm9kZS5zdHlsZS5yaWdodCA9IChkLmNvbXBhdE1vZGUgPT0gJ0JhY2tDb21wYXQnID8gZC5ib2R5LmNsaWVudFdpZHRoIDogZC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgpIC0gZS5jbGllbnRYIC0gdGl0bGViYXIub2Zmc2V0V2lkdGggKyB0aXRsZWJhci5keCAtIDIgKyAncHgnOwoJCXRpdGxlYmFyLnBhcmVudE5vZGUuc3R5bGUudG9wID0gZS5jbGllbnRZIC0gdGl0bGViYXIuZHkgLSAyICsgJ3B4JzsKCX0sCglvblRpdGxlYmFyTW91c2VVcDogZnVuY3Rpb24oZSkgewoJCXZhciB0aXRsZWJhciA9ICQoJ1lUTFQtcGxheWVyLXRpdGxlYmFyJyk7CgkJdGl0bGViYXIucGFyZW50Tm9kZS5jbGFzc05hbWUgPSAnJzsKCQl0aXRsZWJhci5keCA9IG51bGw7CgkJdGl0bGViYXIuZHkgPSBudWxsOwoJCWQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgcG9wdXAub25UaXRsZWJhck1vdXNlTW92ZSwgZmFsc2UpOwoJCWQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHBvcHVwLm9uVGl0bGViYXJNb3VzZVVwLCBmYWxzZSk7CgkJZC5ib2R5LmNsYXNzTmFtZSA9IGQuYm9keS5jbGFzc05hbWUucmVwbGFjZSgnWVRMVC1ub3NlbGVjdCcsICcnKTsKCQljZmcueCA9IHBhcnNlSW50KHRpdGxlYmFyLnBhcmVudE5vZGUuc3R5bGUucmlnaHQpOwoJCWNmZy55ID0gdGl0bGViYXIucGFyZW50Tm9kZS5zdHlsZS50b3A7CgkJY2ZnLnNhdmUoKTsKCX0sCglvbkJvcmRlck1vdXNlRG93bjogZnVuY3Rpb24oZSkgewoJCXZhciBlbWJlZCA9IGQuYm9keS5xdWVyeVNlbGVjdG9yKCcjWVRMVC1wbGF5ZXIgLllUTFQtZW1iZWQnKTsKCQllbWJlZC5wYXJlbnROb2RlLmNsYXNzTmFtZSA9ICdZVExULXBsYXllci1yZXNpemluZyc7CgkJdmFyIHIgPSBlbWJlZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQllbWJlZC5yYXRpbyA9IHIud2lkdGgvci5oZWlnaHQ7CgkJZW1iZWQuYW5jaG9yID0gW3IucmlnaHQsIHIudG9wXTsKCQllbWJlZC5jb250cm9sID0gZS50YXJnZXQuaWQ7CgkJZC5ib2R5LmNsYXNzTmFtZSArPSAnIFlUTFQtbm9zZWxlY3QnOwoJCWQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgcG9wdXAub25Cb3JkZXJNb3VzZU1vdmUpOwoJCWQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHBvcHVwLm9uQm9yZGVyTW91c2VVcCk7Cgl9LAoJb25Cb3JkZXJNb3VzZU1vdmU6IGZ1bmN0aW9uKGUpIHsKCQl2YXIgZW1iZWQgPSBkLmJvZHkucXVlcnlTZWxlY3RvcignI1lUTFQtcGxheWVyIC5ZVExULWVtYmVkJyksIHcsIGg7CgkJaWYoZW1iZWQuY29udHJvbCA9PSAnWVRMVC1wbGF5ZXItbGVmdCcpIHsKCQkJdmFyIGR4ID0gZW1iZWQuYW5jaG9yWzBdIC0gZS5jbGllbnRYOwoJCQl3ID0gZHg7CgkJCWggPSBkeCAvIGVtYmVkLnJhdGlvOwoJCX0gZWxzZSB7CgkJCXZhciBkeSA9IGUuY2xpZW50WSAtIGVtYmVkLmFuY2hvclsxXTsKCQkJdyA9IGVtYmVkLnJhdGlvICogZHk7CgkJCWggPSBkeTsKCQl9CgkJZW1iZWQuc3R5bGUud2lkdGggPSB3ICsgJ3B4JzsKCQllbWJlZC5zdHlsZS5oZWlnaHQgPSBoICsgJ3B4JzsKCX0sCglvbkJvcmRlck1vdXNlVXA6IGZ1bmN0aW9uKGUpIHsKCQl2YXIgZW1iZWQgPSBkLmJvZHkucXVlcnlTZWxlY3RvcignI1lUTFQtcGxheWVyIC5ZVExULWVtYmVkJyk7CgkJZW1iZWQucGFyZW50Tm9kZS5jbGFzc05hbWUgPSAnJzsKCQllbWJlZC54ID0gbnVsbDsKCQllbWJlZC55ID0gbnVsbDsKCQllbWJlZC53ID0gbnVsbDsKCQllbWJlZC5oID0gbnVsbDsKCQlkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHBvcHVwLm9uQm9yZGVyTW91c2VNb3ZlLCBmYWxzZSk7CgkJZC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgcG9wdXAub25Cb3JkZXJNb3VzZVVwLCBmYWxzZSk7CgkJZC5ib2R5LmNsYXNzTmFtZSA9IGQuYm9keS5jbGFzc05hbWUucmVwbGFjZSgnWVRMVC1ub3NlbGVjdCcsICcnKTsKCX0sCn07Cgp2YXIgc2l0ZXMgPSB7CgkneXQnOnsKCQlwYXR0ZXJuczpbInlvdXR1YmUuY29tIiwgInlvdXR1LmJlIiwgInlvdXR1YmUuZ29vZ2xlYXBpcy5jb20iXSwKCQlwYXJzZTpmdW5jdGlvbih1cmwpIHsgcmV0dXJuIC9eaHR0cHM/OlwvXC8oKHd3d1wufG1cLik/eW91dHUoXC5iZXxiZVwuKGdvb2dsZWFwaXNcLik/Y29tKS4rdls9XC9dfCNwXC9bYS16XVwvLitcL3x5b3V0dVwuYmVcLykoW2EtejAtOV8tXXs4LH0pKC4qWyMmXD9ddD0oWzAtOWhtc10rKSk/L2kuZXhlYyh1cmwpID8ge3ZpZDpSZWdFeHAuJDUsIHQ6UmVnRXhwLiQ3fSA6IG51bGw7IH0sCgkJc2l6ZXM6W1s2NDAsMzYwXSxbODUzLDQ4MF1dLAoJCWVtYmVkOmZ1bmN0aW9uKHZpZCwgdCkgeyB2YXIgbSA9IC8oKFxkKyloKT8oKFxkKyltKT8oXGQrKT8vLmV4ZWModCk7IHQgPSBwYXJzZUludChtWzJdIHx8IDApKjM2MDAgKyBwYXJzZUludChtWzRdIHx8IDApKjYwICsgcGFyc2VJbnQobVs1XSB8fCAwKTsgcmV0dXJuICdodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8nICsgdmlkICsgJz9hdXRvcGxheT0xJnJlbD0xJyArICh0ID8gJyZzdGFydD0nICsgdCA6ICcnKTsgfSwKCQl1cmw6ZnVuY3Rpb24odmlkLCB0LCBvVXJsKSB7IHJldHVybiAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0nICsgdmlkICsgKC9cYihsaXN0PVthLXowLTlfLV0rKS9pLmV4ZWMob1VybCkgPyAnJicgKyBSZWdFeHAuJDEgOiAnJykgKyAodCA/ICcjdD0nICsgdCA6ICcnKTsgfSwKCQlwcmV2aWV3OmZ1bmN0aW9uKHZpZCkgeyByZXR1cm4gJ2h0dHBzOi8vaW1nLnlvdXR1YmUuY29tL3ZpLycgKyB2aWQgKyAnLzAuanBnJzsgfSwKCQlpY29uOidkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJBQUFBQVFDQU1BQUFBb0xROVRBQUFBQkdkQlRVRUFBTEdQQy94aEJRQUFBTVpRVEZSRmtRMEl5QklMeUJJTGtRMEl5QklMa1EwSWtRMEl5QklMeUJJTGtRMElwQThKbVE0SmxRNEluZzRKdXhFS3RSQUt3QkVLeEJFTHlCSUxrUTBJQUFBQStmbjV3UmNRdFIwWXZoOFlxUnNXcngwWG94c1Y1NldqOHZMeTkrL3Z5VE10dHhnUzI1MmI2T2pvMFdOZm5SY1R5OGpJbGc0SnpMKy9YQWdGampBdGRBb0hpRk5SbUE0SWJ4UVFnUXdJMDVxWW13NEpySTJNOGZIeDFkWFY1K2ZuM2QzZGtRMElwQThKdFJBS3lCSUxuZzRKcWc4SnJ4QUt1eEVLbVE0SndCRUt4QkVMbFE0SXR4YmpWQUFBQUJWMFVrNVRDYVVKQnZtaWhOS2kyUHpNaCtycS9NeUh6TXdBRDVTMEtRQUFBSXRKUkVGVUdOT0Z6OGNXZ2pBQVJOR3hLeDJDdldEdkZSSUxDdWovLzVRSmNZTXV2S3QzWmpkd3YrQm55T2VjNHUyajRsUmQyTThNRzFiQ05YcGVJbGt3SXE1VkgweWlsQUh6eWpWOXZ6OGFpakx4RURxVTB2RWhUZHlGTm1Oc3NVb1R5b1hyQnNGcHR4V2xRQSs1Nld5elBvb0lkYWd4TjEvdVkwbUY5c3JRZ0JJaFo2bEdTTG1BdjIvZnIyZ292MS9NRWxRQUFBQUFTVVZPUks1Q1lJST0nLAoJCXJlcXVlc3Q6ZnVuY3Rpb24odmlkLCBmKSB7CgkJCXZhciBwYXJ0ID0gWydzbmlwcGV0JywgJ3N0YXR1cyddLCBmaWVsZHMgPSBbJ2lkJywgJ3NuaXBwZXQvdGl0bGUnLCAnc3RhdHVzL3ByaXZhY3lTdGF0dXMnLCAnc3RhdHVzL2VtYmVkZGFibGUnXSwgY291bnRyeTsKCQkJaWYoY2ZnLmNvdW50cnkpIHsKCQkJCWNvdW50cnkgPSBjZmcuY291bnRyeS50b1VwcGVyQ2FzZSgpOwoJCQkJcGFydC5wdXNoKCdjb250ZW50RGV0YWlscycpOwoJCQkJZmllbGRzLnB1c2goJ2NvbnRlbnREZXRhaWxzL3JlZ2lvblJlc3RyaWN0aW9uJyk7CgkJCX0KCQkJbmV0Lmpzb24oJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3lvdXR1YmUvdjMvdmlkZW9zP2lkPScgKyB2aWQgKyAnJnBhcnQ9JyArIHBhcnQuam9pbignLCcpICsgJyZmaWVsZHM9aXRlbXMoJyArIGZpZWxkcy5qb2luKCcsJykgKyAnKSYnICsgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsIFsxMDcsMTAxLDEyMSw2MSw2NSw3MywxMjIsOTcsODMsMTIxLDY4LDg3LDEyMCw3OSwxMTQsNTIsNzYsMTA1LDUyLDY1LDU0LDcyLDExNiw4OSwxMjAsNTcsMTA3LDU1LDk4LDg2LDk4LDY3LDgxLDU0LDU2LDExOCwxMTIsMTE5LDc0LDc0LDExNywxMTEsOTldKSwgZnVuY3Rpb24oY29kZSwgb2JqLCB0eHQpIHsKCQkJCWlmKGNvZGUgIT0gMjAwKSByZXR1cm4gd2luZG93LnNldFRpbWVvdXQoZiwgMCk7CgkJCQl2YXIgaXRlbSA9IG9iai5pdGVtc1swXTsKCQkJCWlmKCFpdGVtKSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOidWaWRlbyBub3QgZm91bmQnLCBzdGF0dXM6NH0pOwoJCQkJfSBlbHNlIGlmKGl0ZW0uc3RhdHVzLnByaXZhY3lTdGF0dXMgPT0gJ3ByaXZhdGUnKSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOidQcml2YXRlIHZpZGVvJywgc3RhdHVzOjN9KTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIHN0YXR1czsKCQkJCQlpZihpdGVtLmNvbnRlbnREZXRhaWxzICYmIGl0ZW0uY29udGVudERldGFpbHMucmVnaW9uUmVzdHJpY3Rpb24pIHsKCQkJCQkJdmFyIHJyID0gaXRlbS5jb250ZW50RGV0YWlscy5yZWdpb25SZXN0cmljdGlvbjsKCQkJCQkJaWYocnIuYmxvY2tlZCAmJiByci5ibG9ja2VkLmluZGV4T2YoY291bnRyeSkgPiAtMSB8fCByci5hbGxvd2VkICYmIHJyLmFsbG93ZWQuaW5kZXhPZihjb3VudHJ5KSA8IDApIHN0YXR1cyA9IDM7CgkJCQkJfSBlbHNlIGlmKCFpdGVtLnN0YXR1cy5lbWJlZGRhYmxlKSB7CgkJCQkJCXN0YXR1cyA9IDU7CgkJCQkJfQoJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDAsIHt0aXRsZTppdGVtLnNuaXBwZXQudGl0bGUsIHN0YXR1czpzdGF0dXN9KTsKCQkJCX0KCQkJfSk7CgkJfQoJfSwKCSd2bSc6ewoJCXBhdHRlcm5zOlsidmltZW8uY29tIl0sCgkJcGFyc2U6ZnVuY3Rpb24odXJsKSB7IHJldHVybiAvXmh0dHBzPzpcL1wvdmltZW9cLmNvbVwvKG1cLyk/KFswLTldKykvaS5leGVjKHVybCkgPyB7dmlkOlJlZ0V4cC4kMn0gOiBudWxsOyB9LAoJCXNpemVzOltbNjQwLDM2MF0sWzg1MywgNDgwXV0sCgkJZW1iZWQ6ZnVuY3Rpb24odmlkLCB0KSB7IHJldHVybiAnaHR0cHM6Ly9wbGF5ZXIudmltZW8uY29tL3ZpZGVvLycgKyB2aWQgKyAnP3RpdGxlPTEmcG9ydHJhaXQ9MSZieWxpbmU9MSZjb2xvcj1hYTAwMDAmYXV0b3BsYXk9MSc7IH0sCgkJdXJsOmZ1bmN0aW9uKHZpZCwgdCkgeyByZXR1cm4gJ2h0dHBzOi8vdmltZW8uY29tLycgKyB2aWQ7IH0sCgkJaWNvbjonZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRUFBUUFNUWZBQXVVdVF5bnp6dTgzdS8wOVJ5eTJTdTMyMHJDNEliVzZtS09uZ3FIcTVHdnVvTzN4aFZiYzBtOTJ6VjdrZURvNjBSOGo4SGM1S0hFend1YXdHU2x1YVRnOEFoMWxmRDUvQm1Qc0pQSTEzZlI2TExkNmYvLy93dWF2ZzJ0MWdBQUFDSDVCQUVBQUI4QUxBQUFBQUFRQUJBQUFBVnU0TmVOWkZtS2dxZXVyQ3FNYmJ6Q2JyRVdoMGFvOU1GZE5nTm5XT0YxQ0pVaFIrUFpESVlSWTJNUkdXWUlGc1ZRWWdSWUhOQkFjNGd3cWlhUG9VZklrUURNS3Nud2tCNVlacDBWUlRtRXNHZ2VHSHdJYjNnckFWb0RDQWt0Z0I0V0VBeU1qWTRBWXBRaUpwb2pIeUVBT3c9PScsCgkJcmVxdWVzdDpmdW5jdGlvbih2aWQsIGYpIHsKCQkJbmV0Lmpzb24oJ2h0dHBzOi8vdmltZW8uY29tL2FwaS9vZW1iZWQuanNvbj91cmw9aHR0cDovL3ZpbWVvLmNvbS8nICsgdmlkLCBmdW5jdGlvbihjb2RlLCBvYmopIHsKCQkJCWlmKGNvZGUgPT0gNDA0KSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOidWaWRlbyBub3QgZm91bmQnLCBzdGF0dXM6NH0pOwoJCQkJfSBlbHNlIGlmKGNvZGUgPT0gNDAzKSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOidVbmtub3duIHZpZGVvJywgc3RhdHVzOjV9KTsKCQkJCX0gZWxzZSBpZihjb2RlID09IDIwMCAmJiBvYmopIHsKCQkJCQl3aW5kb3cuc2V0VGltZW91dChmLCAwLCB7dGl0bGU6b2JqLnRpdGxlID8gb2JqLnRpdGxlIDogJ1Vua25vd24gdmlkZW8nLCBwcmV2aWV3Om9iai50aHVtYm5haWxfdXJsfSk7CgkJCQl9IGVsc2UgewoJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDApOwoJCQkJfQoJCQl9KTsKCQl9Cgl9LAoJJ3ZuJzp7CgkJcGF0dGVybnM6WyJ2aW5lLmNvIl0sCgkJcGFyc2U6ZnVuY3Rpb24odXJsKSB7IHJldHVybiAvXmh0dHBzPzpcL1wvKHd3d1wuKT92aW5lXC5jb1wvdlwvKFthLXowLTldKykvaS5leGVjKHVybCkgPyB7dmlkOlJlZ0V4cC4kMn0gOiBudWxsOyB9LAoJCXNpemVzOltbNTAwLDUwMF0sWzY2MCw2NjBdXSwKCQllbWJlZDpmdW5jdGlvbih2aWQpIHsgcmV0dXJuICdodHRwczovL3ZpbmUuY28vdi8nICsgdmlkICsgJy9jYXJkP2F1ZGlvPTEnOyB9LAoJCXVybDpmdW5jdGlvbih2aWQpIHsgcmV0dXJuICdodHRwczovL3ZpbmUuY28vdi8nICsgdmlkOyB9LAoJCWljb246J2RhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEVBQVFBTE1BQUFxbmZMWGsxL2I3K2pTMWtzM3Q1SnZaeUZiQnBPZjI4b25TdmhpcmhITExzd0NqZGdDa2R3Q2pkLy8vL3dDa2VDSDVCQUFBQUFBQUxBQUFBQUFRQUJBQUFBUnA4TWs1VFFnb05icXJjR0NnTVFaaVVJU0RIY0s1SUU0eERlelFCSTZ5dk9wY1B6amR3dENiQkFFcEYrMWdreWdjaElFaXMwa2tkd3dyMURVcEZDVURuT0FnSEk2YlR0QUJRY0dKR0ExdFllVEpTV0JNTEFVLy9aUTVBRjRmTVFDQWUzNkZoaFFHWEJRUkFEcz0nLAoJCXJlcXVlc3Q6ZnVuY3Rpb24odmlkLCBmKSB7CgkJCW5ldC50ZXh0KCdodHRwczovL3ZpbmUuY28vdi8nICsgdmlkLCBbLyJvZzp0aXRsZSIgY29udGVudD0iKC4rPykiPi8sIC8ib2c6aW1hZ2UiIGNvbnRlbnQ9IiguKz8pIi9dLCBmdW5jdGlvbihjb2RlLCBtKSB7CgkJCQl2YXIgdGl0bGUgPSBtWzBdLCBwcmV2aWV3ID0gbVsxXTsKCQkJCWlmKGNvZGUgPT0gNDA0KSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOidWaWRlbyBub3QgZm91bmQnLCBzdGF0dXM6NH0pOwoJCQkJfSBlbHNlIGlmKGNvZGUgPT0gMjAwICYmIHRpdGxlKSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOnRpdGxlID8gdGl0bGVbMV0gOiAnVW5rbm93biB2aWRlbycsIHByZXZpZXc6cHJldmlldyA/IHByZXZpZXdbMV0gOiBudWxsfSk7CgkJCQl9IGVsc2UgewoJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDApOwoJCQkJfQoJCQl9KTsKCQl9Cgl9LAoJJ2xsJzp7CgkJcGF0dGVybnM6WyJsaXZlbGVhay5jb20vdmlldyJdLAoJCXBhcnNlOiBmdW5jdGlvbih1cmwpIHsgcmV0dXJuIC9eaHR0cHM/OlwvXC8obXx3d3cpXC5saXZlbGVha1wuY29tXC92aWV3LitpPShbMC05YS16X10rKS9pLmV4ZWModXJsKSA/IHt2aWQ6UmVnRXhwLiQyfSA6IG51bGw7IH0sCgkJc2l6ZXM6W1s2MjUsMzUyXSxbODUyLDQ4MF1dLAoJCWVtYmVkOmZ1bmN0aW9uKHZpZCkgeyByZXR1cm4gJ2h0dHA6Ly93d3cubGl2ZWxlYWsuY29tL2xsX2VtYmVkP2k9JyArIHZpZCArICcjcGxheSc7IH0sCgkJdXJsOmZ1bmN0aW9uKHZpZCkgeyByZXR1cm4gJ2h0dHA6Ly93d3cubGl2ZWxlYWsuY29tL3ZpZXc/aT0nICsgdmlkOyB9LAoJCWljb246J2RhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEVBQVFBSUFBQVB6OC9KY0FBQ0g1QkFBQUFBQUFMQUFBQUFBUUFCQUFBQUlyakkrcEIrMWdXb0xoUmNxdXJEaHF1bVhjRm5vajJGWGZOYTFjZTdJSVNxYjBEY0pQUGkrZjR3c1dBQUE3JywKCQlyZXF1ZXN0OmZ1bmN0aW9uKHZpZCwgZikgewoJCQluZXQudGV4dCgnaHR0cDovL3d3dy5saXZlbGVhay5jb20vdmlldz9pPScgKyB2aWQsIFsvSXRlbSBub3QgZm91bmQhL2ksIC88dGl0bGU+TGl2ZUxlYWtcLmNvbSAtICguKz8pPFwvdGl0bGU+L2ksIC8ib2c6aW1hZ2UiIGNvbnRlbnQ9IiguKz8pIi9dLCBmdW5jdGlvbihjb2RlLCBtKSB7CgkJCQl2YXIgbm90Zm91bmQgPSBtWzBdLCB0aXRsZSA9IG1bMV0sIHByZXZpZXcgPSBtWzJdOwoJCQkJaWYobm90Zm91bmQpIHsKCQkJCQl3aW5kb3cuc2V0VGltZW91dChmLCAwLCB7dGl0bGU6J1ZpZGVvIG5vdCBmb3VuZCcsIHN0YXR1czo0fSk7CgkJCQl9IGVsc2UgaWYoY29kZSA9PSAyMDAgJiYgdGl0bGUpIHsKCQkJCQl3aW5kb3cuc2V0VGltZW91dChmLCAwLCB7dGl0bGU6dGl0bGUgPyB0aXRsZVsxXSA6ICdVbmtub3duIHZpZGVvJywgcHJldmlldzpwcmV2aWV3ID8gcHJldmlld1sxXS5yZXBsYWNlKCdfdGh1bWJfJywgJ19zZl8nKSA6IG51bGx9KTsKCQkJCX0gZWxzZSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0sCgknd2gnOnsKCQlwYXR0ZXJuczpbIndvcmxkc3RhcmhpcGhvcC5jb20iXSwKCQlwYXJzZTogZnVuY3Rpb24odXJsKSB7IHJldHVybiAvXmh0dHBzPzpcL1wvKHd3d1wufG1cLik/d29ybGRzdGFyaGlwaG9wXC5jb21cLy4rdj0oW2EtejAtOV0rKS9pLmV4ZWModXJsKSA/IHt2aWQ6UmVnRXhwLiQyfSA6IG51bGw7IH0sCgkJc2l6ZXM6W1s0NDgsMzc0XSxbNjQwLDUzNF1dLAoJCWVtYmVkOmZ1bmN0aW9uKHZpZCkgeyByZXR1cm4gJ2h0dHA6Ly93d3cud29ybGRzdGFyaGlwaG9wLmNvbS92aWRlb3MvZWEvMTY3MTE2ODAvJyArIHZpZDsgfSwKCQl1cmw6ZnVuY3Rpb24odmlkKSB7IHJldHVybiAnaHR0cDovL3d3dy53b3JsZHN0YXJoaXBob3AuY29tL3ZpZGVvcy92aWRlby5waHA/dj0nICsgdmlkOyB9LAoJCWljb246J2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBSUFBQUNRa1dnMkFBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBWHBKUkVGVWVOcHNVdDFLQWtFWS9SeTJ5eDZnRjRnUUlYb2FrWkFRa2VncVFpSjZnSWlJSlNRa1JHU1JpUENxTnpHanZlOEp2T29xK1R6Mm5ablpiYWtHbmYxK3p0bHo1dHVwclY5bUVwZHpJckFIQkk3UE1uRStCWWhJRkVvd0swa2txR3cxbTFiN21zMllJSEdKWVJJRHVzUUlpaWdBTFJYQzh1OEM2OFFvRlZScW9mZjVQS1VIdHFWeGVKUS9UVTIrMFdyblZvZno3M0RiclRaOUw2ZlpqdEVWSzlYNEUxbUZOQVRRa0JwcytaZzVWVjFrbzcxMlIrT2lqeGlXZ2FvQkZ0bllBcDRkUUQ0WjF6czlpeHJkSG8rRDhCY3JXdC8yZkRLaVhkajhZS2VocnZWM3V5ZG1ZejRhV25FRnpNZERrSE5zdTZXZ1BkZ0FTS0N4aDN0NjhPTlFWT3lKc0ZVVWFoL0RRUmlQeEkxSlVXQVNaeDZIeU8rZ0phRisycGNDVnlYa2c3UkM4SWZqRGZCNWZwY1c0SjhWTUtIcUNZanN0WW1jVVdRajhZdHUvUDZlM3BTYUNlRFZITWY0bGw0NytoZC80NEoxdDkrL1FDejVDK2NKRW1aL2NINHAveTE0Ri9ERFNLcU4xOXVydndxL3lOOENEQUI5ZFRBY1BBM0daZ0FBQUFCSlJVNUVya0pnZ2c9PScsCgkJcmVxdWVzdDpmdW5jdGlvbih2aWQsIGYpIHsKCQkJbmV0LnRleHQoJ2h0dHA6Ly93d3cud29ybGRzdGFyaGlwaG9wLmNvbS92aWRlb3MvdmlkZW8ucGhwP3Y9JyArIHZpZCwgWy88dGl0bGU+KFZpZGVvOiApPyguKz8pXHMqKFwoXCpXYXJuaW5nfDxcL3RpdGxlPikvaSwgLyJpbWFnZV9zcmMiIGhyZWY9IiguKz8pIi9dLCBmdW5jdGlvbihjb2RlLCBtKSB7CgkJCQl2YXIgdGl0bGUgPSBtWzBdLCBwcmV2aWV3ID0gbVsxXTsKCQkJCWlmKHRpdGxlKSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOnRpdGxlWzJdLCBwcmV2aWV3OnByZXZpZXcgPyBwcmV2aWV3WzFdIDogbnVsbH0pOwoJCQkJfSBlbHNlIHsKCQkJCQl3aW5kb3cuc2V0VGltZW91dChmLCAwKTsKCQkJCX0KCQkJfSk7CgkJfQoJfSwKCSdkbSc6ewoJCXBhdHRlcm5zOlsiZGFpbHltb3Rpb24uY29tL3ZpZGVvIl0sCgkJcGFyc2U6ZnVuY3Rpb24odXJsKSB7IHJldHVybiAvXmh0dHBzPzpcL1wvd3d3XC5kYWlseW1vdGlvblwuY29tXC92aWRlb1wvKFthLXowLTldKykoLitzdGFydD0oWzAtOV0rKSk/L2kuZXhlYyh1cmwpID8ge3ZpZDpSZWdFeHAuJDEsdDpSZWdFeHAuJDN9IDogbnVsbDsgfSwKCQlzaXplczpbWzYyMCwzNTJdLFs4NTMsNDgwXV0sCgkJZW1iZWQ6ZnVuY3Rpb24odmlkLCB0KSB7IHJldHVybiAnaHR0cHM6Ly93d3cuZGFpbHltb3Rpb24uY29tL2VtYmVkL3ZpZGVvLycgKyB2aWQgKyAnP2xvZ289MCZhdXRvcGxheT0xJyArICh0ID8gJyZzdGFydD0nICsgdCA6ICcnKTsgfSwKCQl1cmw6ZnVuY3Rpb24odmlkLCB0KSB7IHJldHVybiAnaHR0cHM6Ly93d3cuZGFpbHltb3Rpb24uY29tL3ZpZGVvLycgKyB2aWQgKyAodCA/ICc/c3RhcnQ9JyArIHQgOiAnJyk7IH0sCgkJaWNvbjonZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRUFBUUFNUUFBR0IwaHZIWENpNWFxNm1ZWlRobHRzaVVDRWQxeWRtbEFYU0ltTWkxZzdLQ0RlUFVaZE8zVGpKV2w1ZHBCZjd3QVQ1anBOclBrTkNzSnlWUW5PekJCSjZrbGNDWUx4MUptZHZoNjJXVDVmTGlLWVYzVjlXOEdyMjd0VWxycWpWWWx5SDVCQUFBQUFBQUxBQUFBQUFRQUJBQUFBV2ZJQVo1WkdtU2tKZ1piT3V5R1FRWlJGMVhubDBiTW0wakhJU093SnY5RmhTSjBNYjc2Q3FMZzJKQUVOZytUaXNCb1RrNE5vS3c5ZE9vQ2p5VlFPSHJFUk1hRGNGazRtRUV2SW9PUkF5WFF3WWNEd2NGQnhZSmV3SjlGeDBTQVlJSEZBb0ZIeE9KRFJNWENRV09CNUNTQ0hOd21BTUtENDhVQlFVSkZ4TndGeGNXRXFhZHFJYXZsd0lYSHdBUkN4WVdEQkVBRUJkeUdLMVl5Y3BrRXhnaEFEcz0nLAoJCXJlcXVlc3Q6ZnVuY3Rpb24odmlkLCBmKSB7CgkJCW5ldC5qc29uKCdodHRwczovL3d3dy5kYWlseW1vdGlvbi5jb20vc2VydmljZXMvb2VtYmVkP2Zvcm1hdD1qc29uJnVybD1odHRwOi8vd3d3LmRhaWx5bW90aW9uLmNvbS92aWRlby8nICsgdmlkLCBmdW5jdGlvbihjb2RlLCBvYmopIHsKCQkJCWlmKGNvZGUgPT0gNDA0KSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOidWaWRlbyBub3QgZm91bmQnLCBzdGF0dXM6NH0pOwoJCQkJfSBlbHNlIGlmKGNvZGUgPT0gMjAwICYmIG9iaikgewoJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDAsIHt0aXRsZTpvYmoudGl0bGUgPyBvYmoudGl0bGUgOiAnVW5rbm93biB2aWRlbycsIHByZXZpZXc6b2JqLnRodW1ibmFpbF91cmx9KTsKCQkJCX0gZWxzZSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0sCgknY2InOnsKCQlwYXR0ZXJuczpbImNvdWIuY29tL3ZpZXcvIl0sCgkJcGFyc2U6ZnVuY3Rpb24odXJsKSB7IHJldHVybiAvXmh0dHBzPzpcL1wvY291YlwuY29tXC92aWV3XC8oW2EtejAtOV0rKS9pLmV4ZWModXJsKSA/IHt2aWQ6UmVnRXhwLiQxfSA6IG51bGw7IH0sCgkJc2l6ZXM6W1s2NDAsMzYwXSxbODUzLDQ4MF1dLAoJCWVtYmVkOmZ1bmN0aW9uKHZpZCwgdCkgeyByZXR1cm4gJ2h0dHBzOi8vY291Yi5jb20vZW1iZWQvJyArIHZpZCArICc/bXV0ZWQ9ZmFsc2UmYXV0b3N0YXJ0PXRydWUmbm9TaXRlQnV0dG9ucz10cnVlJzsgfSwKCQl1cmw6ZnVuY3Rpb24odmlkLCB0KSB7IHJldHVybiAnaHR0cHM6Ly9jb3ViLmNvbS92aWV3LycgKyB2aWQ7IH0sCgkJaWNvbjonZGF0YTppbWFnZS9naWY7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FNQUFBQW9MUTlUQUFBQVdsQk1WRVVBQUFBRE0vOEFJUDhETXY4QUsvOERNdjhETXY4QU1QOEVNdjhFTXY4RU0vOERNdi8vLy84VVFQK0RtdjlrZ2YvdDhQL00xdi9qNmY4ZFNQOTZrLy9aNGYrTW92L0J6ZjhNT2YrMHd2ODdYLzkxai8rWXEvOXJodjlzemFsVUFBQUFDblJTVGxNQXZ3akNCcFNZS28vaHVQMjg2UUFBQUhwSlJFRlVHTk5sajlzU2d5QU1SR2tyQlE0UjFLcTkvLzl2Q2lxT28rY3RtV3gyVjJXTWRkNDdhOVJDcFZtNVgrZjV3c2F0U2d2TkRwMzBRRDAySXRLTUR6REtwcm1WdG8raGt3aFdPUWp5ZnVXN2J3MU9lWGpLaDRJL0x0aEwraXhabnc0aGhrSCtZQmZiMEdYYlg3WTlCanRGUDVjcjlTbjFKeU9aQ2EyU2ZUZGZBQUFBQUVsRlRrU3VRbUNDJywKCQlyZXF1ZXN0OmZ1bmN0aW9uKHZpZCwgZikgewoJCQluZXQuanNvbignaHR0cHM6Ly9jb3ViLmNvbS9hcGkvb2VtYmVkLmpzb24/dXJsPWh0dHA6Ly9jb3ViLmNvbS92aWV3LycgKyB2aWQsIGZ1bmN0aW9uKGNvZGUsIG9iaikgewoJCQkJaWYoY29kZSA9PSA0MDQpIHsKCQkJCQl3aW5kb3cuc2V0VGltZW91dChmLCAwLCB7dGl0bGU6J1ZpZGVvIG5vdCBmb3VuZCcsIHN0YXR1czo0fSk7CgkJCQl9IGVsc2UgaWYoY29kZSA9PSA0MDMpIHsKCQkJCQl3aW5kb3cuc2V0VGltZW91dChmLCAwLCB7dGl0bGU6J1Vua25vd24gdmlkZW8nLCBzdGF0dXM6NX0pOwoJCQkJfSBlbHNlIGlmKGNvZGUgPT0gMjAwICYmIG9iaikgewoJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDAsIHt0aXRsZTpvYmoudGl0bGUgPyBvYmoudGl0bGUgOiAnVW5rbm93biB2aWRlbycsIHByZXZpZXc6b2JqLnRodW1ibmFpbF91cmx9KTsKCQkJCX0gZWxzZSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCk7CgkJCQl9CgkJCX0pOwoJCX0KCX0sCgkndmQnOnsKCQlwYXR0ZXJuczpbInZpZC5tZS8iXSwKCQlwYXJzZTpmdW5jdGlvbih1cmwpIHsgcmV0dXJuIC9eaHR0cHM/OlwvXC92aWRcLm1lXC8oZVwvKT8oW2EtejAtOV0rKSQvaS5leGVjKHVybCkgPyB7dmlkOlJlZ0V4cC4kMn0gOiBudWxsOyB9LAoJCXNpemVzOltbNjQwLDM2MF0sWzg1Myw0ODBdXSwKCQllbWJlZDpmdW5jdGlvbih2aWQsIHQpIHsgcmV0dXJuICdodHRwczovL3ZpZC5tZS9lLycgKyB2aWQgKyAnP2F1dG9wbGF5PTEnOyB9LAoJCXVybDpmdW5jdGlvbih2aWQsIHQpIHsgcmV0dXJuICdodHRwczovL3ZpZC5tZS8nICsgdmlkOyB9LAoJCWljb246J2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBTUFBQUFvTFE5VEFBQUFqVkJNVkVVQUFBQStQajRwS1NrcUtpb25KeWNyS3lzdExTMUtTa3BKU1VrME5EUTBORFF0TFMzLy8vOHRMUzByS3lzcEtTbHZiMjgxTlRYS3lzckR3OE8vdjc5T1RrN2IyOXVqbzZPTmpZMktpb3BuWjJkWVdGalgxOWU0dUxnOFBEejI5dmJ0N2UzT3pzNnhzYkducDZlV2xwYUhoNGQzZDNkbVptWmFXbHBJU0Vnd01EQzV1YmwxZFhWcWFtcG9hR2pscjZTZ0FBQUFESFJTVGxNQS9LcVZTeG9IOE8vbTViUHlTaFZaQUFBQXQwbEVRVlFZMDJXUFJ4S0RNQXhGalhHQUFITEQ5TjVMeXYyUEY5dkRMbStoR1gxcDhUN1NlQVEvSGVlSmlZY3NEemNvVmRPb01uQWZkbzk0RmxzeUh1bkVjL2tRM3d6YzlSQUo3UDMrQ1FqQ1pkdzM4N3B0YXo3MmNZbFJxRWJlVVdZUWgxSWhjcEthaWZNQ3VFN0Iwc1RSUVNxVzZVMHBueFpoZ3JDdFJOM1ZBSFYzaUtvTkVTNXlxZ0V3SXk4d0lyN2NHVmhZSlgxaXhPUVhHS1VNZHFuRnJMcWNQMmxhNWRLbzIzSis4VXFTdHZCTnViLzZQN3pLRHRZUkpMYkhBQUFBQUVsRlRrU3VRbUNDJywKCQlyZXF1ZXN0OmZ1bmN0aW9uKHZpZCwgZikgewoJCQluZXQudGV4dCgnaHR0cHM6Ly92aWQubWUvJyArIHZpZCwgWy8ib2c6dGl0bGUiIGNvbnRlbnQ9IiguKz8pIj4vLCAvIm9nOmltYWdlIiBjb250ZW50PSIoLis/KSIvXSwgZnVuY3Rpb24oY29kZSwgbSkgewoJCQkJdmFyIHRpdGxlID0gbVswXSwgcHJldmlldyA9IG1bMV07CgkJCQlpZihjb2RlID09IDQwNCkgewoJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDAsIHt0aXRsZTonVmlkZW8gbm90IGZvdW5kJywgc3RhdHVzOjR9KTsKCQkJCX0gZWxzZSB7CgkJCQkJd2luZG93LnNldFRpbWVvdXQoZiwgMCwge3RpdGxlOnRpdGxlID8gdGl0bGVbMV0gOiAnVW5rbm93biB2aWRlbycsIHByZXZpZXc6cHJldmlldyA/IHByZXZpZXdbMV0gOiBudWxsfSk7CgkJCQl9CgkJCX0pOwoJCX0KCX0sCgknc3QnOnsKCQlwYXR0ZXJuczpbInN0cmVhbWFibGUuY29tLyJdLAoJCXBhcnNlOmZ1bmN0aW9uKHVybCkgeyByZXR1cm4gL15odHRwcz86XC9cL3N0cmVhbWFibGVcLmNvbVwvKFthLXowLTldKykkL2kuZXhlYyh1cmwpID8ge3ZpZDpSZWdFeHAuJDF9IDogbnVsbDsgfSwKCQlzaXplczpbWzY1MCwzNjBdLFs4NzAsNDgwXV0sCgkJZW1iZWQ6ZnVuY3Rpb24odmlkLCB0KSB7IHJldHVybiAnaHR0cHM6Ly9zdHJlYW1hYmxlLmNvbS9lLycgKyB2aWQgKyAnP2F1dG9wbGF5PTEnOyB9LAoJCXVybDpmdW5jdGlvbih2aWQsIHQpIHsgcmV0dXJuICdodHRwczovL3N0cmVhbWFibGUuY29tLycgKyB2aWQ7IH0sCgkJaWNvbjonZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FNQUFBQW9MUTlUQUFBQXJsQk1WRVVBQUFBUGtQb1BrUG9Pa1BvUGtQb09rUG9Qa1BvUGtQb1Rrdm9Qa1BvUGtQb09rUG9Qa1BvUGtQb1BrUG9Pa1BvcG5Qb3JuZm9Qa1BvUGtQcG51ZnhydXZ3UGtQb1BrUHFFeHYwUGtQcUV4djBQa1BvTmovb0xqdnIvLy84N3BQc2ltUHY4L3YvYTd2NVRzUHdubS92My9QL3orZjlwdXZ4Q3FQc2JsZm9Va3ZydjkvN3A5ZjdnOGY2bTF2MW11ZnhodHZ6TjZQNi80ZjY4NFAydDJmMTB2L3hNclB0SnEvc3hvUHN1bnZ0Q1Z6WEtBQUFBRzNSU1RsTUErZkVGejVTSkp2VFZzbzJHZ0NBSzJOYStwcFNRZ240dUxpamZFcFNWQUFBQXRFbEVRVlFZMDAzUDVaSUNRUXdFNE95d2N0amQ0ZElaV1JmYzRmMWZER1lwNVB1VjdxcFVKV1Q5ZGwwaDNFNUFUNDJ1ZzVyak4rbzh3RnZMTmhOOGFULzJIVEFubFVTbFN3bk1hUXpXa1ZyRUpsTFpWdktJWEdBVmJkZm1zRHp0MGdROUV0QktzNHpEZ3BOd3d6K1BvbEFYUm5TVUtPdkNSYlZjNWZ2TTVOZDFhdkJQSGZCNW9iSlloeXJOSlE4cGNNQmxZVmplNGtRQ1V5SWZYeng3ZXV1VCszLzFNLzdyT2M5bUsyZzNoV2g2TXp2ZkFTL2JGd2tuTzJodUFBQUFBRWxGVGtTdVFtQ0MnLAoJCXJlcXVlc3Q6ZnVuY3Rpb24odmlkLCBmKSB7CgkJCW5ldC50ZXh0KCdodHRwczovL3N0cmVhbWFibGUuY29tLycgKyB2aWQsIFsvPGgxW14+XSo+KC4rPyk8LywgLyJvZzppbWFnZSIgY29udGVudD0iKC4rPykiL10sIGZ1bmN0aW9uKGNvZGUsIG0pIHsKCQkJCXZhciB0aXRsZSA9IG1bMF0sIHByZXZpZXcgPSBtWzFdOwoJCQkJaWYoY29kZSA9PSA0MDQpIHsKCQkJCQl3aW5kb3cuc2V0VGltZW91dChmLCAwLCB7dGl0bGU6J1ZpZGVvIG5vdCBmb3VuZCcsIHN0YXR1czo0fSk7CgkJCQl9IGVsc2UgewoJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDAsIHt0aXRsZTp0aXRsZSA/IHRpdGxlWzFdIDogJ1Vua25vd24gdmlkZW8nLCBwcmV2aWV3OnByZXZpZXcgPyBwcmV2aWV3WzFdLnJlcGxhY2UoJ2h0dHA6Ly8nLCAnaHR0cHM6Ly8nKSA6IG51bGx9KTsKCQkJCX0KCQkJfSk7CgkJfQoJfSwKfTsKCnZhciBjYWNoZSA9IHsKCWdldDogZnVuY3Rpb24oc2lkLCB2aWQpIHsKCQlpZighY2FjaGUub2JqKSBjYWNoZS5sb2FkKCk7CgkJdmFyIGRhdGEgPSBjYWNoZS5vYmpbc2lkICsgdmlkXTsKCQlpZighZGF0YSkgcmV0dXJuIGZhbHNlOwoJCWRhdGEgPSBkYXRhLnNwbGl0KCdcdCcpOwoJCXJldHVybiBkYXRhWzBdID8ge3RpdGxlOmRhdGFbMF0sc3RhdHVzOmRhdGFbMV0scHJldmlldzpkYXRhWzJdfSA6IGZhbHNlOwoJfSwKCXNldDogZnVuY3Rpb24oc2lkLCB2aWQsIGluZm8pIHsKCQlpZighaW5mbykgcmV0dXJuOwoJCWNhY2hlLmxvYWQoKTsKCQljYWNoZS5vYmpbc2lkICsgdmlkXSA9IFtpbmZvLnRpdGxlLGluZm8uc3RhdHVzLGluZm8ucHJldmlld10uam9pbignXHQnKS50cmltKCk7CgkJY2FjaGUuc2F2ZSgpOwoJfSwKCXNhdmU6IGZ1bmN0aW9uKCkgewoJCWlmKCFjYWNoZS5vYmopIHJldHVybjsKCQl0cnkgewoJCQljYWNoZS5jbGVhbigpOwoJCQlHTV9zZXRWYWx1ZSgnY2FjaGUnLCBKU09OLnN0cmluZ2lmeShjYWNoZS5vYmopKTsKCQl9IGNhdGNoKGV4KSB7IGxvZygnRXJyb3Igd2hpbGUgc2F2aW5nIGNhY2hlOiAnICsgZXgpOyB9CgkJY2FjaGUub2JqID0gbnVsbDsKCX0sCglsb2FkOiBmdW5jdGlvbigpIHsKCQl0cnkgewoJCQljYWNoZS5vYmogPSBKU09OLnBhcnNlKEdNX2dldFZhbHVlKCdjYWNoZScpKTsKCQl9IGNhdGNoKGV4KSB7IH0KCQlpZihjYWNoZS5vYmogPT0gbnVsbCB8fCB0eXBlb2YoY2FjaGUub2JqKSAhPSAnb2JqZWN0JykgY2FjaGUub2JqID0ge307Cgl9LAoJY2xlYW46IGZ1bmN0aW9uKCkgewoJCXZhciBvdmVyZmxvdyA9IE9iamVjdC5rZXlzKGNhY2hlLm9iaikubGVuZ3RoIC0gMzAwOwoJCWlmKG92ZXJmbG93IDwgMSkgcmV0dXJuOwoJCXZhciBpID0gMCwgZiA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgkJZm9yKHZhciBwIGluIGNhY2hlLm9iaikgewoJCQlpZihmLmNhbGwoY2FjaGUub2JqLCBwKSkgewoJCQkJZGVsZXRlIGNhY2hlLm9ialtwXTsKCQkJCWlmKCsraSA9PSBvdmVyZmxvdyArIDIwKSByZXR1cm47CgkJCX0KCQl9Cgl9LAoJY2xlYXI6IGZ1bmN0aW9uKHNpZCkgewoJCWNhY2hlLmxvYWQoKTsKCQl2YXIgZiA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgkJZm9yKHZhciBwIGluIGNhY2hlLm9iaikgewoJCQlpZihwLmluZGV4T2Yoc2lkKSA9PSAwICYmIGYuY2FsbChjYWNoZS5vYmosIHApKSB7CgkJCQlkZWxldGUgY2FjaGUub2JqW3BdOwoJCQl9CgkJfQoJCWNhY2hlLnNhdmUoKTsKCX0KfTsKCnZhciBjZmcgPSB7CglzZXR0aW5nczogewoJCWNvdW50cnk6IHsgdGl0bGU6J0NoZWNrIGZvciByZXN0cmljdGlvbnM/IEVudGVyIHlvdXIgPGEgaHJlZj0iaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JU09fMzE2Ni0xX2FscGhhLTIjT2ZmaWNpYWxseV9hc3NpZ25lZF9jb2RlX2VsZW1lbnRzIiB0YXJnZXQ9Il9ibGFuayIgc3R5bGU9InRleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmUhaW1wb3J0YW50OyIgdGl0bGU9ImUuZy4gVVMsIEdCIG9yIERFIj5jb3VudHJ5IGNvZGU8L2E+JywgZGVmYXVsdDonJywgbWF4bGVuZ3RoOjJ9LAoJCXJldmVyc2VfYnV0dG9uczogeyB0aXRsZTonTW92ZSBidXR0b25zIHRvIHRoZSBsZWZ0JywgZGVmYXVsdDpmYWxzZSwgZGVwZW5kczp7ZW1iZWRfbW9kZTovcGxheWVyL30gfSwKCQliaWc6IHsgdGl0bGU6JzQ4MHAgaW5zdGVhZCBvZiAzNjBwJywgZGVmYXVsdDpmYWxzZSwgZGVwZW5kczp7ZW1iZWRfbW9kZTovd2luZG93fGlubGluZS99IH0sCgkJZW1iZWRfbW9kZTogeyB0aXRsZTonRW1iZWQgb24gY2xpY2snLCBkZWZhdWx0OidwbGF5ZXInLCBvcHRpb25zOntvZmY6J29mZicsIHBsYXllcjonaW4tcGFnZSBwb3B1cCcsIGlubGluZTonaW5saW5lJywgd2luZG93Oidwb3B1cCB3aW5kb3cnfSB9LAoJCXJld3JpdGU6IHsgdGl0bGU6J1Jld3JpdGUgYWRkcmVzc2VzIHRvIG5vbi1tb2JpbGUgSFRUUFMgVVJMcycsIGRlZmF1bHQ6dHJ1ZSB9LAoJCXVybHNfb25seTogeyB0aXRsZTonTG9vayB1cCBpbmZvIG9ubHkgd2hlbiBsaW5rIHRleHQgaXMgVVJMJywgZGVmYXVsdDpmYWxzZSB9LAoJCXByZXZpZXdzOiB7IHRpdGxlOidTaG93IHByZXZpZXcgaW1hZ2Ugb24gaG92ZXInLCBkZWZhdWx0OnRydWUgfSwKCQlkYXJrZW46IHt9LAoJCXg6IHt9LAoJCXk6IHt9Cgl9LAoJbG9hZDogZnVuY3Rpb24oKSB7CgkJZm9yRWFjaChjZmcuc2V0dGluZ3MsIGZ1bmN0aW9uKG4pIHsgY2ZnW25dID0gR01fZ2V0VmFsdWUobiwgY2ZnLnNldHRpbmdzW25dLmRlZmF1bHQpOyB9KTsKCX0sCglzYXZlOiBmdW5jdGlvbigpIHsKCQlmb3JFYWNoKGNmZy5zZXR0aW5ncywgZnVuY3Rpb24obikgeyBpZih0eXBlb2YgY2ZnW25dICE9ICd1bmRlZmluZWQnKSBHTV9zZXRWYWx1ZShuLCBjZmdbbl0pOyB9KTsKCX0KfTsKCndpbmRvdy5zZXRUaW1lb3V0KG9uTG9hZCwgMTAwKTsK"},{"name":"YouTube Auto Buffer & Auto HD","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":true,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http://*.youtube.com/*","http://youtube.com/*","https://*.youtube.com/*","https://youtube.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469607858095,"data":{}},"enabled":false,"position":18,"file_url":"https://greasyfork.org/scripts/494-youtube-auto-buffer-auto-hd/code/YouTube%20Auto%20Buffer%20%20Auto%20HD.user.js","uuid":"93712d58-ae1e-4d0b-b11b-9281cc958317","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgWW91VHViZSBBdXRvIEJ1ZmZlciAmIEF1dG8gSEQKLy8gQG5hbWVzcGFjZSAgICAgaHR0cDovL3VzZXJzY3JpcHRzLm9yZy91c2Vycy8yMzY1MgovLyBAZGVzY3JpcHRpb24gICBCdWZmZXJzIHRoZSB2aWRlbyB3aXRob3V0IGF1dG9wbGF5aW5nIGFuZCBwdXRzIGl0IGluIEhEIGlmIHRoZSBvcHRpb24gaXMgb24uIEZvciBGaXJlZm94LCBPcGVyYSwgJiBDaHJvbWUKLy8gQGljb24gICAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHViLmNvbS9qb2VzaW1tb25zL1lvdVR1YmUtLS1BdXRvLUJ1ZmZlci0tLUF1dG8tSEQvbWFzdGVyL21lZGlhL2xvZ28tNjR4NjQucG5nCi8vIEBpbmNsdWRlICAgICAgIGh0dHA6Ly8qLnlvdXR1YmUuY29tLyoKLy8gQGluY2x1ZGUgICAgICAgaHR0cDovL3lvdXR1YmUuY29tLyoKLy8gQGluY2x1ZGUgICAgICAgaHR0cHM6Ly8qLnlvdXR1YmUuY29tLyoKLy8gQGluY2x1ZGUgICAgICAgaHR0cHM6Ly95b3V0dWJlLmNvbS8qCi8vIEBjb3B5cmlnaHQgICAgIEpvZVNpbW1vbnMKLy8gQGF1dGhvciAgICAgICAgSm9lU2ltbW9ucwovLyBAdmVyc2lvbiAgICAgICAxLjIuODgKLy8gQGxpY2Vuc2UgICAgICAgR1BMIHZlcnNpb24gMyBvciBhbnkgbGF0ZXIgdmVyc2lvbjsgaHR0cDovL3d3dy5nbnUub3JnL2NvcHlsZWZ0L2dwbC5odG1sCi8vIEByZXF1aXJlICAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8xODg1LWpvZXNpbW1vbnMtbGlicmFyeS9jb2RlL0pvZVNpbW1vbnMnJTIwTGlicmFyeS5qcz92ZXJzaW9uPTc5MTUKLy8gQHJlcXVpcmUgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzIxMDQteW91dHViZS1idXR0b24tY29udGFpbmVyLXJlcXVpcmUvY29kZS9Zb3VUdWJlJTIwLSUyMEJ1dHRvbiUyMENvbnRhaW5lciUyMChAcmVxdWlyZSkuanM/dmVyc2lvbj01NDkzCi8vIEByZXF1aXJlICAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8xODg0LWdtLWNvbmZpZy9jb2RlL0dNX2NvbmZpZy5qcz92ZXJzaW9uPTQ4MzYKLy8gQGdyYW50ICAgICAgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICAgR01fc2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICAgR01fcmVnaXN0ZXJNZW51Q29tbWFuZAovLyA9PS9Vc2VyU2NyaXB0PT0KCi8qIENIQU5HRUxPRwoKICAgIDEuMi44OCAoNS8yMi8yMDE1KQogICAgICAgIC0gZml4ZWQgSFRNTDUgb24gRmlyZWZveAogICAgICAgIC0gZml4ZWQgc2NyaXB0IG9uIENocm9tZQogICAgICAgIC0gYWRkZWQgYSBuZXcgb3B0aW9uIHRvIGRpc2FibGUgYXV0b3BsYXlpbmcgdGhlIG5leHQgdmlkZW8gb24gcGxheWxpc3RzCiAgICAgICAgLSByZW1vdmVkIHRoZW1lIGNvbG9yIG9wdGlvbiAtIG9ubHkgd29ya3Mgb24gZmxhc2ggYW5kIHRoYXQncyBnb25lIG5vdwoKICAgIDEuMi44NyAoMS8yMi8yMDE0KQogICAgICAgIC0gZml4ZWQgb2RkIGludGVybmFsIGVycm9yIHRoYXQgbWFkZSB0aGUgcGxheWVyIG5vdCBzaG93CiAgICAgICAgLSBmaXhlZCBwcm9ibGVtIHdpdGggIlJlZCBCYXIiIG5vdCBiZWluZyBkaXNhYmxlZCBwcm9wZXJseQoKICAgIDEuMi44NiAoMTIvMjEvMjAxMykKICAgICAgICAtIGZpeGVkIExhcmdlIHBsYXllciBidXR0b24gKGFzIGZhciBhcyBJIGNhbiB0ZWxsKQogICAgICAgIC0gYWRkZWQgQXV0b21hdGljIHF1YWxpdHkgb3B0aW9uICh0aGUgWW91VHViZSBkZWZhdWx0KQogICAgICAgIC0gc3dpdGNoZWQgdGhlIERBU0ggb3B0aW9uIGRlZmF1bHQgdG8gZW5hYmxlZAogICAgICAgICAgICB0aGlzIGlzIHJlYWxseSB3aGF0IHRoZSBzY3JpcHQgd2FzIG1hZGUgZm9yLi4uIGF1dG8tYnVmZmVyaW5nCgogICAgMS4yLjg1ICgxMi8xMS8yMDEzKQogICAgICAgIC0gYWRkZWQgYSBzY3JpcHQgaWNvbgogICAgICAgIC0gYWRkZWQgYSAiUGxheWVyIENvbG9yIFNjaGVtZSIgb3B0aW9uCiAgICAgICAgLSBmaXhlZCBidWcgd2l0aCBTUEYgbm90IGJlaW5nIGRlLWFjdGl2YXRlZCBwcm9wZXJseSBpbiBub24tRmlyZWZveCBicm93c2VycwogICAgICAgIC0gZml4ZWQgdm9sdW1lIGJ1ZwogICAgICAgIC0gZml4ZWQgYWRkaW5nIHRpbWUgaW4gdXJsIGJ1Zy4gaXQgd2lsbCBub3cgc2tpcCB0byB0aGUgcmlnaHQgcG9ydGlvbiBvZiB0aGUgdmlkZW8KICAgICAgICAtIGNoYW5nZWQgaW50ZXJuYWwgbmFtZSBvZiB0aGUgIkFjdGl2YXRpb24gTW9kZSIgb3B0aW9uLiBzaG91bGRuJ3QgYWZmZWN0IHRoZSB1c2VyCiAgICAgICAgLSB0aGUgc2NyaXB0IGRvZXNuJ3QgYWRkIGFueSBqYXZhc2NyaXB0IHRvIHRoZSBwYWdlIGFueW1vcmUKICAgICAgICAgICAgaXQgdXNlcyBvbllvdVR1YmVQbGF5ZXJSZWFkeSB0byBkZXRlY3Qgd2hlbiB0aGUgcGxheWVyIGlzIHJlYWR5OwogICAgICAgICAgICAgICAgaXQncyBtdWNoIG1vcmUgcGVyZm9ybWFudCB0aGFuIGFuIGludGVydmFsCgogICAgMS4yLjg0ICgxMC8zMS8yMDEzKQogICAgICAgIC0gYWRkZWQgcHJpbWl0aXZlIHR5cGUgY2hlY2tpbmcgd2hlbiBjb3B5aW5nIHl0cGxheWVyLmNvbmZpZy5hcmdzIGludG8gdGhlIGZsYXNodmFycy4KICAgICAgICAgICAgdGhpcyBmaXhlcyB0aGUgaXNzdWUgd2l0aCBGbGFzaGdvdCBhbmQgcG9zc2libHkgb3RoZXIgYWRkLW9ucwogICAgICAgIC0gZml4ZWQgbm9uLWFjdGl2YXRpb24gYnkgbW92aW5nIHRoZSBfc3BmX3N0YXRlIGNoZWNrIHRvIHRoZSB0b3Agb2YgaW5pdC4KICAgICAgICAgICAgdGhpcyBkaXNhYmxlcyBTUEYgb24gZXZlcnkgWW91VHViZSBwYWdlIG5vdywgYW5kIHNob3VsZCBtYWtlIHRoZSBzY3JpcHQgYWN0aXZhdGUgY29ycmVjdGx5CiAgICAgICAgLSBjaGFuZ2VkIGFsbCBSZWdFeHAgdGVzdCBtZXRob2RzIHRvIG1hdGNoLiBtYXRjaCBzZWVtcyBtb3JlIGNvbnNpc3RlbnQuCiAgICAgICAgICAgIEkndmUgaGFkIGNhc2VzIHdoZXJlIHRlc3QgZG9lc24ndCB3b3JrLCBidXQgbWF0Y2ggZG9lcwoKICAgIDEuMi44MyAoMTAvMjgvMjAxMykKICAgICAgICAtIGFkZGVkIGF1dG8gSEQsIHZvbHVtZSwgYW5kIG1vcmUgYWN0aXZhdGlvbiBtb2RlcyBmb3IgaHRtbDUgKHRoYW5rcyB0byB5b3V0dWJlIHVwZGF0aW5nIGl0cyBBUEkpCiAgICAgICAgLSBjaGFuZ2VkIHRoZSBkZWZhdWx0IHF1YWxpdHkgdG8gMTA4MHAKICAgICAgICAtIGNoYW5nZWQgdGhlIHdvcmRpbmcgb2Ygc29tZSBvcHRpb25zCiAgICAgICAgLSBjaGFuZ2VkIHRoZSAiRGlzYWJsZSBEYXNoIFBsYXliYWNrIiBvcHRpb24gdG8gZmFsc2UgZm9yIGRlZmF1bHQKICAgICAgICAtIGRpc2FibGVkIFNQRiAoYWthIFJlZCBCYXIgZmVhdHVyZSkgY29tcGxldGVseSB1bnRpbCBJIGdldCBwbGF5bGlzdHMgd29ya2luZyBiZXR0ZXIKICAgICAgICAtIGNoYW5nZWQgdGhlIHNldFByZWYgcHJvdG90eXBlIGZ1bmN0aW9uIHRvIGEgcmVndWxhciBmdW5jdGlvbgoKICAgIDEuMi44MiAoOS81LzIwMTMpCiAgICAgICAgLSBhZGRlZCBzdXBwb3J0IGZvciBvbGRlciBGaXJlZm94IHZlcnNpb25zICh0ZXN0ZWQgb24gMy42KQogICAgICAgIC0gYWRkZWQgYSBuZXcgb3B0aW9uIHRvIGRpc2FibGUgJ2Rhc2gnIHBsYXliYWNrICh2aWRlb3MgbG9hZGluZyBpbiBibG9ja3MvcGllY2VzKQogICAgICAgIC0gcmUtYWRkZWQgYWQgcmVtb3ZhbCBmZWF0dXJlIChleHBlcmltZW50YWwgZm9yIG5vdykKCiAgICAxLjIuODEKICAgICAgICAtIGZpeGVkIEhUTUw1IHN1cHBvcnQuIFlUIGNoYW5nZWQgdGFnIG5hbWVzIHNvIHRoZSBzY3JpcHQgZ290IGNvbmZ1c2VkCiAgICAgICAgLSBtYWRlIGEgZmV3IG1pbm9yIHBlcmZvcm1hbmNlIHR3ZWFrcwogICAgICAgIC0gZml4ZWQgJ3BsYXkgc3ltYm9sIGluIHRpdGxlJyBidWcgaW4gYXV0b2J1ZmZlciBtb2RlIChpdCB3b3VsZCBzaG93IHBsYXlpbmcsIGV2ZW4gdGhvdWdoIGl0J3MgcGF1c2VkL2J1ZmZlcmluZykKCiAgICAxLjIuODAKICAgICAgICAtIHN3aXRjaGVkIHRvIEpTTC5zZXRJbnRlcnZhbCBmb3IgY29uc2lzdGVuY3kgYW5kIGRyaWZ0IGFjY29tbW9kYXRpb24KICAgICAgICAtIHZpc3VhbCB0d2Vha3MgdG86CiAgICAgICAgICAgIG1zZygpLgogICAgICAgICAgICAgICAgdGhlIHJlc3Qgb2YgdGhlIHBhZ2Ugbm93IGRpbXMgd2hpbGUgdGhlIG1zZyBib3ggaXMgdmlzaWJsZQogICAgICAgICAgICAgICAgY2hhbmdlZCB0aGUgc3BhY2luZyBvZiBtb3N0IG9mIHRoZSBlbGVtZW50cwogICAgICAgICAgICAgICAgY2hhbmdlZCB0aGUgZm9udCBzaXplcyBhbmQgdGhlIGZvbnQgKEFyaWFsKQogICAgICAgICAgICAgICAgYWRkZWQgYSBjbG9zZSBidXR0b24gaW5zdGVhZCBvZiByZXF1aXJpbmcgYSBkb3VibGUgY2xpY2sKICAgICAgICAgICAgICAgIG1hZGUgaXQgYXV0by1vcGVuIHRoZSBvcHRpb25zIHNjcmVlbiB3aGVuIHRoZSBtc2cgaXMgY2xvc2VkCiAgICAgICAgICAgIEdNX2NvbmZpZy4KICAgICAgICAgICAgICAgIG1hZGUgdGhlIGJhY2tncm91bmQgY29sb3IgbW9yZSBtZWxsb3cgYW5kIG1vdmVkIHRoZSBzZWN0aW9uIHRpdGxlIG5lYXIgdGhlIG1pZGRsZQoKICAgIDEuMi43OQogICAgICAgIC0gYWRqdXN0ZWQgdG8gdGhlIG5ldyBwbGF5IHN5bWJvbCBpbiB0aGUgeW91dHViZSB0aXRsZSBmZWF0dXJlCiAgICAgICAgLSBDaGFuZ2VkIG1hcmdpbnMgb24gdGhlIHNldHRpbmdzIGJ1dHRvbiB3aGVuIGluIGZvb3RlcgogICAgICAgIC0gU3dpdGNoZWQgSlNML3B1c2hTdGF0ZSBjaGVja2luZyBvcmRlci4KICAgICAgICAgICAgUHJldmlvdXNseSBpbiAxLjIuNzgsIGlmIEpTTCBkaWRuJ3QgZXhpc3Qgb3Igd2Fzbid0IEByZXF1aXJlZCwgdGhlIHNjcmlwdAogICAgICAgICAgICB3b3VsZCBzdGlsbCBsb29wIGV2ZXJ5IDUwMG1zIHRvIHJlLXNldCB0aGUgcHVzaFN0YXRlIG1ldGhvZCwgZXZlbiB0aG91Z2ggdGhlCiAgICAgICAgICAgIHNjcmlwdCB3YXNuJ3QgZ29pbmcgdG8gYmUgcnVubmluZy4KICAgICAgICAgICAgSSBzd2l0Y2hlZCB0aGF0IHNvIHRoYXQgSlNMIGhhcyB0byBleGlzdCBiZWZvcmUgdGhlIHNjcmlwdCBkb2VzIGFueXRoaW5nLgoKICAgIDEuMi43OAogICAgICAgIC0gRml4ZWQgYnVnIHdoZXJlIG9wdGlvbnMgYnV0dG9uIHdhc24ndCBnZXR0aW5nIGFkZGVkIHRvIHRoZSBmb290ZXIgd2l0aCB0aGUgbmV3IFJlZCBCYXIgWVQgZmVhdHVyZQoKICAgIDEuMi43NwogICAgICAgIC0gQWRhcHRlZCB0byB0aGUgbmV3IFlvdVR1YmUgZmVhdHVyZSB0aGF0IHVzZXMgSFRNTDUncyBoaXN0b3J5LnB1c2hTdGF0ZSB0byBsb2FkIHZpZGVvcwogICAgICAgIC0gU21hbGwgZml4ZXMgaGVyZSBhbmQgdGhlcmUKICAgICAgICAtIEV4Y2x1ZGVkICh3aXRoIFJlZ0V4cCkgcGFnZXMgd2l0aG91dCB2aWRlb3Mgb24gdGhlbQogICAgICAgIC0gRml4ZWQgR01fY29uZmlnLmxvZygpCiAgICAgICAgLSBEZWNsYXJlZCBhbGwgdmFyaWFibGVzIGF0IHRoZSBiZWdpbm5pbmcgb2YgZnVuY3Rpb25zCiAgICAgICAgLSBNYWRlIGZpbmRpbmcgdGhlIHZpZGVvIHBsYXllciBhIGxpdHRsZSBtb3JlIHJlbGlhYmxlCiAgICAgICAgLSBNYWtlICdhdXRvcGxheSBvbiBwbGF5bGlzdHMnIHdvcmsgd2l0aCBIVE1MNSB2aWRlb3MKCiAgICAxLjIuNzYKICAgICAgICAtIEFkZGVkIG5ldyBxdWFsaXR5IG9wdGlvbiAoJzEwODBwKycgLSBmb3IgYW55dGhpbmcgaGlnaGVyIHRoYW4gMTA4MHApCgogICAgMS4yLjc1CiAgICAgICAgLSBBZGRlZCBhIG5ldyBvcHRpb24gKHRvIG1vdmUgb3B0aW9uIGJ1dHRvbiB0byBwYWdlIGZvb3RlcikKICAgICAgICAtIEFkZGVkIGEgbmV3IG9wdGlvbiAodG8gYXV0b3BsYXkgb24gcGxheWxpc3RzIHJlZ2FyZGxlc3Mgb2YgYXV0b1twbGF5L2J1ZmZlcl0gc2V0dGluZykKICAgICAgICAtIEFkZGVkIGEgZmlyc3QgdGltZSB1c2VyIG1lc3NhZ2UgYm94CiAgICAgICAgLSBGaXhlZCBidWcgd2l0aCBHTV9jb25maWcncyBbc2V0L2dldF1WYWx1ZSBmdW5jdGlvbnMuIENocm9tZS9PcGVyYSB3ZXJlIG5vdCB1c2luZyBsb2NhbFN0b3JhZ2UgYmVmb3JlIHRoaXMgdXBkYXRlCgogICAgMS4yLjc0CiAgICAgICAgLSBBZGFwdGVkIHRvIFlvdVR1YmUncyBuZXcgbGF5b3V0CgogICAgMS4yLjczCiAgICAgICAgLSBBZGRlZCBjb21wYXRpYmlsaXR5IGZvciB1c2VyIHBhZ2VzCgogICAgMS4yLjcyCiAgICAgICAgLSBNYWRlIGl0IGZ1bGx5IHdvcmtpbmcgYWdhaW4gaW4gT3BlcmEgJiBDaHJvbWUKICAgICAgICAtIFN3aXRjaGVkIGZyb20gc2V0SW50ZXJ2YWwgdG8gc2V0VGltZW91dCBkdWUgdG8gaW5zdGFiaWxpdHkKICAgICAgICAtIEFkZGVkIGFuIGFub255bW91cyBmdW5jdGlvbiB3cmFwcGVyCgogICAgMS4yLjcxCiAgICAgICAgLSBBZGRlZCBjb21wYXRpYmlsaXR5IGZvciBIVE1MNQoKKi8KCgoKCi8vIHJ1biB0aGUgc2NyaXB0IGluIGFuIElJRkUsIHRvIGhpZGUgaXRzIHZhcmlhYmxlcyBmcm9tIHRoZSBnbG9iYWwgc2NvcGUKKGZ1bmN0aW9uICh1bmRlZmluZWQpIHsKCiAgICAndXNlIHN0cmljdCc7CgogICAgdmFyIGFCbGFuayA9IFsnJywgJycsICcnXSwKICAgICAgICBVUkwgPSBsb2NhdGlvbi5ocmVmLAogICAgICAgIG5hdklEID0gJ3dhdGNoNy11c2VyLWhlYWRlcicsCiAgICAgICAgcllvdXR1YmVVcmwgPSAvXmh0dHBzPzpcL1wvKFteXC5dK1wuKT95b3V0dWJlXC5jb21cLy8sCiAgICAgICAgLy8gcllvdXR1YmVCbGFja2xpc3RlZFVybCA9IC9eaHR0cHM/OlwvXC8oW15cLl0rXC4pP3lvdXR1YmVcLmNvbVwvKGZlZWRcLyg/IXN1YnNjcmlwdGlvbnMpfGFjY291bnR8aW5ib3h8bXlffHRhZ3N8dmlld19hbGx8YW5hbHl0aWNzKS9pLAogICAgICAgIHJMaXN0ID0gL1s/Jl1saXN0PS9pLAogICAgICAgIHJQbGF5U3ltYm9sID0gL15cdTI1QjZccyovLAogICAgICAgIHNjcmlwdF9uYW1lID0gJ1lvdVR1YmUgLSBBdXRvLUJ1ZmZlciAmIEF1dG8tSEQnLAogICAgICAgIHRUaW1lID0gKFVSTC5tYXRjaCgvWyYjP110PShbc20wLTldKykvKSB8fCBhQmxhbmspWzFdLAogICAgICAgIGFkcyA9IFsKICAgICAgICAgICAgJ3N1cHBvcnRlZF93aXRob3V0X2FkcycsCiAgICAgICAgICAgICdhZDNfbW9kdWxlJywKICAgICAgICAgICAgJ2Fkc2Vuc2VfdmlkZW9fZG9jX2lkJywKICAgICAgICAgICAgJ2FsbG93ZWRfYWRzJywKICAgICAgICAgICAgJ2Jhc2VVcmwnLAogICAgICAgICAgICAnY2FmZV9leHBlcmltZW50X2lkJywKICAgICAgICAgICAgJ2Fmdl9pbnNsYXRlX2FkX3RhZycsCiAgICAgICAgICAgICdhZHZpZGVvJywKICAgICAgICAgICAgJ2FkX2RldmljZScsCiAgICAgICAgICAgICdhZF9jaGFubmVsX2NvZGVfaW5zdHJlYW0nLAogICAgICAgICAgICAnYWRfY2hhbm5lbF9jb2RlX292ZXJsYXknLAogICAgICAgICAgICAnYWRfZXVybCcsCiAgICAgICAgICAgICdhZF9mbGFncycsCiAgICAgICAgICAgICdhZF9ob3N0JywKICAgICAgICAgICAgJ2FkX2hvc3RfdGllcicsCiAgICAgICAgICAgICdhZF9sb2dnaW5nX2ZsYWcnLAogICAgICAgICAgICAnYWRfcHJlcm9sbCcsCiAgICAgICAgICAgICdhZF9zbG90cycsCiAgICAgICAgICAgICdhZF90YWcnLAogICAgICAgICAgICAnYWRfdmlkZW9fcHViX2lkJywKICAgICAgICAgICAgJ2FmdHYnLAogICAgICAgICAgICAnYWZ2JywKICAgICAgICAgICAgJ2Fmdl9hZF90YWcnLAogICAgICAgICAgICAnYWZ2X2luc3RyZWFtX21heCcsCiAgICAgICAgICAgICdhZnZfYWRfdGFnX3Jlc3RyaWN0ZWRfdG9faW5zdHJlYW0nLAogICAgICAgICAgICAnYWZ2X3ZpZGVvX21pbl9jcG0nLAogICAgICAgICAgICAncHJlZmV0Y2hfYWRfbGl2ZV9zdHJlYW0nCiAgICAgICAgXSwKICAgICAgICBoYXNNYWluQmVlblJ1biwgbWlzc2luZ19yZXF1aXJlLCBuYXYsIHV3LCB3YWl0X2ludHY7CgogICAgZnVuY3Rpb24gdG9OdW0oYSkgewogICAgICAgIHJldHVybiBwYXJzZUludChhLCAxMCk7CiAgICB9CgogICAgLy8gbXNnIGJ5IEpvZVNpbW1vbnMKICAgIGZ1bmN0aW9uIG1zZyhpbmZvT2JqZWN0KSB7CgogICAgICAgIHZhciBib3hfaWRfbmFtZSA9ICdzY3JpcHRfbXNnJywKICAgICAgICAgICAgYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYm94X2lkX25hbWUpLAogICAgICAgICAgICByTGluZWJyZWFrcyA9IC9bXHJcbl0vZywKICAgICAgICAgICAgdGl0bGUgPSB0eXBlb2YgaW5mb09iamVjdC50aXRsZSA9PT0gJ3N0cmluZycgJiYgaW5mb09iamVjdC50aXRsZS5sZW5ndGggPiAzID8gaW5mb09iamVjdC50aXRsZSA6ICdNZXNzYWdlIEJveCBieSBKb2VTaW1tb25zLic7CgogICAgICAgIC8vIGFkZCBCUiB0YWdzIHRvIGxpbmUgYnJlYWtzCiAgICAgICAgaW5mb09iamVjdC50ZXh0ID0gaW5mb09iamVjdC50ZXh0LnJlcGxhY2UockxpbmVicmVha3MsICc8YnIgLz5cbicpOwoKICAgICAgICBmdW5jdGlvbiBtc2dfY2xvc2UoZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGJveF9pZF9uYW1lKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmZvT2JqZWN0Lm9uY2xvc2UgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGluZm9PYmplY3Qub25jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYm94ID09IG51bGwpIHsKICAgICAgICAgICAgSlNMLmFkZFN0eWxlKCcnICsKICAgICAgICAgICAgICAgICdAa2V5ZnJhbWVzIGJsaW5rIHsgJyArCiAgICAgICAgICAgICAgICAgICAgJzUwJSB7IGNvbG9yOiAjQjk1QzAwOyB9ICcgKwogICAgICAgICAgICAgICAgJ31cblxuJyArCiAgICAgICAgICAgICAgICAnIycgKyBib3hfaWRfbmFtZSArICcgLm1zZy1oZWFkZXIgeyAnICsKICAgICAgICAgICAgICAgICAgICAnYW5pbWF0aW9uOiBibGluayAxcyBsaW5lYXIgaW5maW5pdGUgbm9ybWFsOyAnICsKICAgICAgICAgICAgICAgICd9JyArCiAgICAgICAgICAgICcnKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCgKICAgICAgICAgICAgICAgIEpTTC5jcmVhdGUoJ2RpdicsIHtpZCA6IGJveF9pZF9uYW1lLCBzdHlsZSA6ICdwb3NpdGlvbjogZml4ZWQ7IHRvcDogMDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgei1pbmRleDogOTk5OTk5OyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNik7J30sIFsKICAgICAgICAgICAgICAgICAgICAvLyBtYWluIGJveAogICAgICAgICAgICAgICAgICAgIEpTTC5jcmVhdGUoJ2RpdicsIHtpZCA6IGJveF9pZF9uYW1lICsgJ19ib3gnLCBzdHlsZSA6ICdwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogMjUlOyBsZWZ0OiAyNSU7IHdpZHRoOiA1MCU7IGhlaWdodDogNTAlOyBwYWRkaW5nLXRvcDogNTBweDsgYmFja2dyb3VuZC1jb2xvcjogI0U5RTlFOTsgYm9yZGVyOiAzcHggZG91YmxlICMwMDYxOTU7J30sIFsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGVhZGVyCiAgICAgICAgICAgICAgICAgICAgICAgIEpTTC5jcmVhdGUoJ2RpdicsIHtzdHlsZSA6ICdtYXJnaW46IDAgYXV0bzsgcGFkZGluZy1ib3R0b206IDQwcHg7IGNvbG9yOiAjRjA3ODAwOyBmb250LXNpemU6IDIxcHQ7IGZvbnQtZmFtaWx5OiBBcmlhbCwgVmVyZGFuYSwgIk15cmlhZCBQcm8iOyBmb250LXdlaWdodDogbm9ybWFsOyB0ZXh0LXNoYWRvdzogMnB4IDJweCA0cHggI0M3QzdDNzsgdGV4dC1hbGlnbjogY2VudGVyOycsICdjbGFzcycgOiAnbXNnLWhlYWRlcicsIHRleHRDb250ZW50IDogdGl0bGV9KSwKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRleHQgKG1lc3NhZ2UpCiAgICAgICAgICAgICAgICAgICAgICAgIEpTTC5jcmVhdGUoJ2RpdicsIHtpbm5lckhUTUwgOiBpbmZvT2JqZWN0LnRleHQsIHN0eWxlIDogJ3RleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luOiAwIGF1dG87IHBhZGRpbmctdG9wOiAzOXB4OyBib3JkZXItdG9wOiAxcHggc29saWQgI0IwQjBCMDsgY29sb3I6ICMwMDAwMDA7IGZvbnQtc2l6ZTogMTFwdDsgZm9udC1mYW1pbHk6IEFyaWFsLCBWZXJkYW5hLCAiTXlyaWFkIFBybyI7IGZvbnQtd2VpZ2h0OiBub3JtYWw7IHRleHQtc2hhZG93OiAwIDAgOHB4ICNBRUFFQUU7J30pLAoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2UgYnV0dG9uCiAgICAgICAgICAgICAgICAgICAgICAgIEpTTC5jcmVhdGUoJ2RpdicsIHtzdHlsZSA6ICdwb3NpdGlvbjogYWJzb2x1dGU7IGJvdHRvbTogMjBweDsgbGVmdDogMDsgd2lkdGg6IDEwMCU7IHRleHQtYWxpZ246IGNlbnRlcjsnfSwgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgSlNMLmNyZWF0ZSgnaW5wdXQnLCB7aWQgOiBib3hfaWRfbmFtZSArICdfY2xvc2UnLCB0eXBlIDogJ2J1dHRvbicsIHZhbHVlIDogJ0Nsb3NlIE1lc3NhZ2UnLCBvbmNsaWNrIDogbXNnX2Nsb3NlLCBzdHlsZSA6ICdtYXJnaW46IDAgYXV0bzsgcGFkZGluZzogMnB4IDIwcHg7IGZvbnQtc2l6ZTogMTFwdDsgZm9udC1mYW1pbHk6IEFyaWFsLCBWZXJkYW5hLCAiTXlyaWFkIFBybyI7IGZvbnQtd2VpZ2h0OiBub3JtYWw7J30pCiAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm94LmlubmVySFRNTCArPSBpbmZvT2JqZWN0LnRleHQ7CiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIC8vIHdpbGwgcmV0dXJuIHRydWUgaWYgdGhlIHZhbHVlIGlzIGEgcHJpbWl0aXZlIHZhbHVlCiAgICBmdW5jdGlvbiBpc1ByaW1pdGl2ZVR5cGUodmFsdWUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGVvZiB2YWx1ZSkgewogICAgICAgICAgICBjYXNlICdzdHJpbmcnOiBjYXNlICdudW1iZXInOiBjYXNlICdib29sZWFuJzogY2FzZSAndW5kZWZpbmVkJzogewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzogewogICAgICAgICAgICAgICAgcmV0dXJuICF2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFByZWYoc3RyLCB2YWx1ZXMpIHsKICAgICAgICB2YXIgaSwgdmFsdWUsIHJRdWVyeTsKCiAgICAgICAgZm9yIChpID0gMDsgdmFsdWUgPSB2YWx1ZXNbaV07IGkgKz0gMSkgewogICAgICAgICAgICAvLyAoc2V2ZXJhbCBsaW5lcyBmb3IgcmVhZGFiaWxpdHkpCiAgICAgICAgICAgIHJRdWVyeSA9IG5ldyBSZWdFeHAoJ1s/Jl0/JyArIHZhbHVlWzBdICsgJz1bXiZdKicpOwogICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZShyUXVlcnksICcnKSArICcmJyArIHZhbHVlWzBdICsgJz0nICsgdmFsdWVbMV07CiAgICAgICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9eJit8JiskL2csICcnKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdHI7CiAgICB9CgogICAgLy8gdW53cmFwcyB0aGUgZWxlbWVudCBzbyB3ZSBjYW4gdXNlIGl0cyBtZXRob2RzIGZyZWVseQogICAgZnVuY3Rpb24gdW53cmFwKGVsZW0pIHsKICAgICAgICBpZiAoZWxlbSkgewogICAgICAgICAgICBpZiAoIHR5cGVvZiBYUENOYXRpdmVXcmFwcGVyID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBYUENOYXRpdmVXcmFwcGVyLnVud3JhcCA9PT0gJ2Z1bmN0aW9uJyApIHsKICAgICAgICAgICAgICAgIHJldHVybiBYUENOYXRpdmVXcmFwcGVyLnVud3JhcChlbGVtKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtLndyYXBwZWRKU09iamVjdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0ud3JhcHBlZEpTT2JqZWN0OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZWxlbTsKICAgIH0KCiAgICBmdW5jdGlvbiBmaXhQbGF5U3ltYm9sKCkgewogICAgICAgIGRvY3VtZW50LnRpdGxlID0gZG9jdW1lbnQudGl0bGUucmVwbGFjZShyUGxheVN5bWJvbCwgJycpOwogICAgfQoKICAgIC8vIGdyYWJzIHRoZSB1bi13cmFwcGVkIHBsYXllcgogICAgZnVuY3Rpb24gZ2V0UGxheWVyKCkgewogICAgICAgIHZhciBkb2MgPSB1dy5kb2N1bWVudDsKICAgICAgICByZXR1cm4gZG9jLmdldEVsZW1lbnRCeUlkKCdjNC1wbGF5ZXInKSB8fCBkb2MuZ2V0RWxlbWVudEJ5SWQoJ21vdmllX3BsYXllcicpOwogICAgfQoKICAgIC8vIGFkZHMgdGhlIE9wdGlvbnMgYnV0dG9uIGJlbG93IHRoZSB2aWRlbwogICAgZnVuY3Rpb24gYWRkQnV0dG9uKCkgewogICAgICAgIHZhciBmb290ZXIgPSBHTV9jb25maWcuZ2V0KCdmb290ZXInKSA9PT0gdHJ1ZSwKICAgICAgICAgICAgZm9vdGVySG9sZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zvb3Rlci1tYWluJyk7CgogICAgICAgIGFkZEJ1dHRvblRvQ29udGFpbmVyKCdBdXRvLUJ1ZmZlciBPcHRpb25zJywgZnVuY3Rpb24gKCkgeyBHTV9jb25maWcub3BlbigpOyB9LCAnYXV0b2J1ZmZlci1vcHRpb25zJyk7CgogICAgICAgIGlmIChmb290ZXIgJiYgZm9vdGVySG9sZGVyKSB7CiAgICAgICAgICAgIGZvb3RlckhvbGRlci5hcHBlbmRDaGlsZCggZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dG9idWZmZXItb3B0aW9ucycpICk7CiAgICAgICAgfQogICAgfQoKICAgICAvLyB0aGlzIGZ1bmN0aW9uIHNldHMgdXAgdGhlIHNjcmlwdAogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICBoYXNNYWluQmVlblJ1biA9IGZhbHNlOwoKICAgICAgICAvLyBnZXQgdGhlIHJhdyB3aW5kb3cgb2JqZWN0IG9mIHRoZSBZb3VUdWJlIHBhZ2UKICAgICAgICB1dyA9IHR5cGVvZiB1bnNhZmVXaW5kb3cgIT09ICd1bmRlZmluZWQnID8gdW5zYWZlV2luZG93IDogdW53cmFwKHdpbmRvdyk7CgogICAgICAgIC8vIGRpc2FibGUgUmVkIEJhciBha2EgU1BGCiAgICAgICAgaWYgKHV3Ll9zcGZfc3RhdGUgJiYgdXcuX3NwZl9zdGF0ZS5jb25maWcpIHsKICAgICAgICAgICAgdXcuX3NwZl9zdGF0ZS5jb25maWdbJ25hdmlnYXRlLWxpbWl0J10gPSAwOwogICAgICAgICAgICB1dy5fc3BmX3N0YXRlLmNvbmZpZ1snbmF2aWdhdGUtcGFydC1yZWNlaXZlZC1jYWxsYmFjayddID0gZnVuY3Rpb24gKHRhcmdldFVybCkgewogICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9IHRhcmdldFVybDsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKHV3Lnl0c3BmICYmIHV3Lnl0c3BmLmNvbmZpZyAmJiB0eXBlb2YgdXcueXRzcGYuZW5hYmxlZCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgdXcueXRzcGYuZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICB1dy55dHNwZi5jb25maWdbJ25hdmlnYXRlLWxpbWl0J10gPSAwOwogICAgICAgIH0KCiAgICAgICAgdXcub25Zb3VUdWJlUGxheWVyUmVhZHkgPSBmdW5jdGlvbiBvbllvdVR1YmVQbGF5ZXJSZWFkeShwbGF5ZXIpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBwbGF5ZXIgPT09ICdvYmplY3QnICYmIGhhc01haW5CZWVuUnVuID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgd2luZG93LnBvc3RNZXNzYWdlKCdZVEFCX19yZWFkeScsICcqJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBKU0wud2FpdEZvcih7CiAgICAgICAgICAgIHNlbGVjdG9yIDogJyNjNC1wbGF5ZXIsICNtb3ZpZV9wbGF5ZXInLAogICAgICAgICAgICB2ZXJpZmllciA6IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IHVud3JhcCggZWxlbVswXSApOwogICAgICAgICAgICAgICAgcmV0dXJuIChlbGVtLmdldFBsYXllclN0YXRlKCkgPT0gMSAmJiB0eXBlb2YgZWxlbS5wYXVzZVZpZGVvID09PSAnZnVuY3Rpb24nKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZG9uZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChoYXNNYWluQmVlblJ1biA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChtYWluLCAwKTsgLy8gcnVuIG1haW4oKSBhc3luY2hyb25vdXNseSAobGVzcyBmcmVlemluZykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8vIHRoaXMgaXMgdGhlIG1haW4gZnVuY3Rpb24uIGl0IGRvZXMgYWxsIHRoZSBhdXRvYnVmZmVyaW5nLCBxdWFsaXR5L3ZvbHVtZSBjaGFuZ2luZywgYW5ub3RhdGlvbiBoaWRpbmcsIGV0YwogICAgZnVuY3Rpb24gbWFpbigpIHsKICAgICAgICB2YXIgcGxheWVyID0gZ2V0UGxheWVyKCksCiAgICAgICAgICAgIHBhcmVudCA9IHBsYXllci5wYXJlbnROb2RlLAogICAgICAgICAgICBhbHJlYWR5QnVmZmVyZWQgPSBmYWxzZSwKICAgICAgICAgICAgdGltZSA9IDAsCiAgICAgICAgICAgIGFyZ3MsIGFyZywgYnVmZmVyX2ludHYsIGZ2LCBpc0hUTUw1LCBwbGF5ZXJDbG9uZSwKICAgICAgICAgICAgcGxheUlmUGxheWxpc3QsIHZhbCwgdXNlck9wdHMsIHd0cEludHY7CgogICAgICAgIC8vIGRvbid0IGxldCBtYWluKCkgcnVuIGFnYWluIHVubGVzcyBhIG5ldyB2aWRlbyBpcyBsb2FkZWQKICAgICAgICBoYXNNYWluQmVlblJ1biA9IHRydWU7CgogICAgICAgIC8vIHNldCB1cCB0aGUgdXNlciBvcHRpb25zIG9iamVjdAogICAgICAgIHVzZXJPcHRzID0gewogICAgICAgICAgICBhY3RpdmF0aW9uTW9kZSAgICA6IEdNX2NvbmZpZy5nZXQoJ2FjdGl2YXRpb25Nb2RlJyksCiAgICAgICAgICAgIGRpc2FibGVBdXRvcGxheSAgIDogR01fY29uZmlnLmdldCgnZGlzYWJsZUF1dG9wbGF5JykgPT09IHRydWUsCiAgICAgICAgICAgIGRpc2FibGVEYXNoICAgICAgIDogR01fY29uZmlnLmdldCgnZGlzYWJsZURhc2gnKSA9PT0gdHJ1ZSwKICAgICAgICAgICAgaGlkZUFubm90YXRpb25zICAgOiBHTV9jb25maWcuZ2V0KCdoaWRlQW5ub3RhdGlvbnMnKSA9PT0gdHJ1ZSwKICAgICAgICAgICAgaGlkZUFkcyAgICAgICAgICAgOiBHTV9jb25maWcuZ2V0KCdoaWRlQWRzJykgPT09IHRydWUsCiAgICAgICAgICAgIHF1YWxpdHkgICAgICAgICAgIDogR01fY29uZmlnLmdldCgnYXV0b0hEJyksCiAgICAgICAgICAgIHZvbHVtZSAgICAgICAgICAgIDogR01fY29uZmlnLmdldCgndm9sdW1lJykKICAgICAgICB9OwoKICAgICAgICAvLyBzZXQgdXAgb3RoZXIgdmFyaWFibGVzCiAgICAgICAgaXNIVE1MNSA9IHV3Lnl0cGxheWVyLmNvbmZpZy5odG1sNSA9PSB0cnVlOwogICAgICAgIHBsYXllckNsb25lID0gaXNIVE1MNSA9PT0gZmFsc2UgPyBwbGF5ZXIuY2xvbmVOb2RlKHRydWUpIDogbnVsbDsgLy8gY2xvbmUgcGxheWVyIGlmIGZsYXNoCiAgICAgICAgZnYgPSBpc0hUTUw1ID09PSBmYWxzZSA/IHBsYXllci5nZXRBdHRyaWJ1dGUoJ2ZsYXNodmFycycpIDogJyc7IC8vIGdldCBmbGFzaHZhcnMgaWYgZmxhc2gKICAgICAgICBwbGF5SWZQbGF5bGlzdCA9IFVSTC5tYXRjaChyTGlzdCkgIT0gbnVsbCAmJiBHTV9jb25maWcuZ2V0KCdhdXRvcGxheXBsYXlsaXN0cycpID09PSB0cnVlOwoKICAgICAgICBpZiAodXcueXRwbGF5ZXIgJiYgdXcueXRwbGF5ZXIuY29uZmlnICYmIHV3Lnl0cGxheWVyLmNvbmZpZy5hcmdzKSB7CiAgICAgICAgICAgIGFyZ3MgPSB1dy55dHBsYXllci5jb25maWcuYXJnczsKICAgICAgICB9CgogICAgICAgIC8vIGdldCB2aWRlbyBzdGFydGluZyB0aW1lIGZyb20gdGhlIHVybCBvciBwbGF5ZXIgaXRzZWxmCiAgICAgICAgaWYgKCB0VGltZS5tYXRjaCgvXGQrbS8pICkgewogICAgICAgICAgICB0aW1lICs9IHRvTnVtKCB0VGltZS5tYXRjaCgvKFxkKyltLylbMV0gKSAqIDYwOwogICAgICAgIH0KICAgICAgICBpZiAoIHRUaW1lLm1hdGNoKC9cZCtzLykgKSB7CiAgICAgICAgICAgIHRpbWUgKz0gdG9OdW0oIHRUaW1lLm1hdGNoKC8oXGQrKXMvKVsxXSApOwogICAgICAgIH0KICAgICAgICBpZiAoIHRUaW1lLm1hdGNoKC9eXGQrJC8pICkgewogICAgICAgICAgICB0aW1lICs9IHRvTnVtKHRUaW1lKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRpbWUgPD0gMykgewogICAgICAgICAgICAvLyBpZiBubyB0aW1lIGlzIGluIHRoZSB1cmwsIGNoZWNrIHRoZSBwbGF5ZXIncyB0aW1lCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBzb21ldGltZXMgY2F1c2VzIGEgd2VpcmQgZXJyb3IuCiAgICAgICAgICAgICAgICAvLyBpdCB3aWxsIHNheSBnZXRDdXJyZW50VGltZSBpc24ndCBhIGZ1bmN0aW9uLAogICAgICAgICAgICAgICAgLy8gZXZlbiB0aG91Z2ggdGhlIHR5cGVvZiBpcyAiZnVuY3Rpb24iLAogICAgICAgICAgICAgICAgLy8gYW5kIGFsZXJ0aW5nIGl0cyB2YWx1ZSBzYXlzIFtuYXRpdmUgY29kZV0KICAgICAgICAgICAgICAgIHRpbWUgPSBNYXRoLmZsb29yKCBwbGF5ZXIuZ2V0Q3VycmVudFRpbWUoKSApOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICBpZiAodGltZSA8PSAzKSB7CiAgICAgICAgICAgICAgICB0aW1lID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2V0IHRoZSB2b2x1bWUgdG8gdGhlIHVzZXIncyBwcmVmZXJlbmNlCiAgICAgICAgaWYgKHVzZXJPcHRzLnZvbHVtZSAhPSAxMDAwKSB7CiAgICAgICAgICAgIHBsYXllci5zZXRWb2x1bWUodXNlck9wdHMudm9sdW1lKTsKICAgICAgICB9CgogICAgICAgIGlmIChpc0hUTUw1KSB7CiAgICAgICAgICAgIC8vIHNldCB2aWRlbyBxdWFsaXR5CiAgICAgICAgICAgIGlmICh1c2VyT3B0cy5xdWFsaXR5ICE9PSAnZGVmYXVsdCcgJiYgcGxheWVyLmdldFBsYXliYWNrUXVhbGl0eSgpICE9PSB1c2VyT3B0cy5xdWFsaXR5KSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIuc2V0UGxheWJhY2tRdWFsaXR5KHVzZXJPcHRzLnF1YWxpdHkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBzZWVrIHRvIHRoZSByaWdodCB0aW1lCiAgICAgICAgICAgIHBsYXllci5zZWVrVG8odGltZSk7CgogICAgICAgICAgICAvLyBoYW5kbGUgdGhlIGFjdGl2YXRpb24gbW9kZSAoYnVmZmVyL3BsYXkpCiAgICAgICAgICAgIGlmIChwbGF5SWZQbGF5bGlzdCA9PT0gZmFsc2UgJiYgdXNlck9wdHMuYWN0aXZhdGlvbk1vZGUgPT09ICdidWZmZXInKSB7CiAgICAgICAgICAgICAgICBwbGF5ZXIucGF1c2VWaWRlbygpOwoKICAgICAgICAgICAgICAgIC8vIHNvbWV0aW1lcyBpdCBkb2Vzbid0IGxpa2UgcGF1c2luZyB3aGVuIHRvbGQsCiAgICAgICAgICAgICAgICAvLyBzbyBrZWVwIHRyeWluZyB0byBwYXVzZSB1bnRpbCBpdCBkb2VzCiAgICAgICAgICAgICAgICB3dHBJbnR2ID0gSlNMLnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGxheWVyID0gZ2V0UGxheWVyKCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuZ2V0UGxheWVyU3RhdGUoKSA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5wYXVzZVZpZGVvKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgSlNMLmNsZWFySW50ZXJ2YWwod3RwSW50dik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgNTApOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gY29weSAneXRwbGF5ZXIuY29uZmlnLmFyZ3MnIGludG8gdGhlIGZsYXNoIHZhcnMKICAgICAgICAgICAgaWYgKGFyZ3MpIHsKICAgICAgICAgICAgICAgIGZvciAoYXJnIGluIGFyZ3MpIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2FyZ107CiAgICAgICAgICAgICAgICAgICAgaWYgKCBhcmdzLmhhc093blByb3BlcnR5KGFyZykgJiYgaXNQcmltaXRpdmVUeXBlKHZhbCkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ2ID0gc2V0UHJlZihmdiwgWyBbIGFyZywgZW5jb2RlVVJJQ29tcG9uZW50KHZhbCkgXSBdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGFkIHJlbW92YWwKICAgICAgICAgICAgaWYgKHVzZXJPcHRzLmhpZGVBZHMpIHsKICAgICAgICAgICAgICAgIGZ2ID0gZnYucmVwbGFjZShuZXcgUmVnRXhwKCcoJmFtcDt8WyY/XSk/KCcgKyBhZHMuam9pbignfCcpICsgJyk9W14mXSonLCAnZycpLCAnJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRpc2FibGUgREFTSCBwbGF5YmFjawogICAgICAgICAgICBpZiAodXNlck9wdHMuZGlzYWJsZURhc2gpIHsKICAgICAgICAgICAgICAgIGZ2ID0gc2V0UHJlZihmdiwgWwogICAgICAgICAgICAgICAgICAgIFsnZGFzaG1wZCcsICcnXSwKICAgICAgICAgICAgICAgICAgICBbJ2Rhc2gnLCAnMCddCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZWRpdCB0aGUgZmxhc2h2YXJzCiAgICAgICAgICAgIGZ2ID0gc2V0UHJlZihmdiwgWwogICAgICAgICAgICAgICAgWyd2cScsIHVzZXJPcHRzLnF1YWxpdHldLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBxdWFsaXR5CiAgICAgICAgICAgICAgICBbJ2F1dG9wbGF5JywgKHVzZXJPcHRzLmFjdGl2YXRpb25Nb2RlICE9PSAnbm9uZScgfHwgcGxheUlmUGxheWxpc3QpID8gJzEnIDogJzAnIF0sICAvLyBlbmFibGUvZGlzYWJsZSBhdXRvcGxheQogICAgICAgICAgICAgICAgWydpdl9sb2FkX3BvbGljeScsIHVzZXJPcHRzLmhpZGVBbm5vdGF0aW9ucyA/ICczJyA6ICcxJyBdLCAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5hYmxlL2Rpc2FibGUgYW5ub3RhdGlvbnMKCiAgICAgICAgICAgICAgICAvLyBzb21lICJqdXN0LWluLWNhc2UiIHNldHRpbmdzCiAgICAgICAgICAgICAgICBbJ2VuYWJsZWpzYXBpJywgICAgICAgICAgICcxJ10sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbmFibGUgSlMgQVBJCiAgICAgICAgICAgICAgICBbJ2pzYXBpY2FsbGJhY2snLCAgICAgICAgICdvbllvdVR1YmVQbGF5ZXJSZWFkeSddLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbmFibGUgSlMgcmVhZHkgY2FsbGJhY2sKICAgICAgICAgICAgICAgIFsnZnMnLCAgICAgICAgICAgICAgICAgICAgJzEnXSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVuYWJsZSBmdWxsc2NyZWVuIGJ1dHRvbiwganVzdCBpbi1jYXNlCiAgICAgICAgICAgICAgICBbJ21vZGVzdGJyYW5kaW5nJywgICAgICAgICcxJ10sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRlIFlvdVR1YmUgbG9nbyBpbiBwbGF5ZXIKICAgICAgICAgICAgICAgIFsnZGlzYWJsZWtiJywgICAgICAgICAgICAgJzAnXSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVuYWJsZSBrZXlib2FyZCBjb250cm9scyBpbiBwbGF5ZXIKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAvLyBzZXQgdGhlIHBsYXllcidzIHRpbWUKICAgICAgICAgICAgZnYgPSBzZXRQcmVmKCBmdiwgWyBbJ3N0YXJ0JywgdGltZV0gXSApOwoKICAgICAgICAgICAgLy8gc2V0IHRoZSBuZXcgcGxheWVyJ3MgZmxhc2h2YXJzCiAgICAgICAgICAgIHBsYXllckNsb25lLnNldEF0dHJpYnV0ZSgnZmxhc2h2YXJzJywgZnYpOwoKICAgICAgICAgICAgLy8gcmVwbGFjZSB0aGUgb3JpZ2luYWwgcGxheWVyIHdpdGggdGhlIG1vZGlmaWVkIGNsb25lCiAgICAgICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQocGxheWVyQ2xvbmUsIHBsYXllcik7CgogICAgICAgICAgICBpZiAodXNlck9wdHMuYWN0aXZhdGlvbk1vZGUgPT09ICdidWZmZXInICYmIHBsYXlJZlBsYXlsaXN0ID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgLy8gaGFuZGxlIGF1dG8tYnVmZmVyaW5nCiAgICAgICAgICAgICAgICBidWZmZXJfaW50diA9IEpTTC5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBsYXllciA9IGdldFBsYXllcigpOwoKICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyICYmIHR5cGVvZiBwbGF5ZXIuZ2V0UGxheWVyU3RhdGUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgSlNMLmNsZWFySW50ZXJ2YWwoYnVmZmVyX2ludHYpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF1c2UgdGhlIHZpZGVvIHNvIGl0IGNhbiBidWZmZXIKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnBhdXNlVmlkZW8oKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlZWsgYmFjayB0byBiZWdpbm5pbmcgaWYgdGltZSBlbGFwc2VkIGlzIG5vdCBtdWNoCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIuZ2V0Q3VycmVudFRpbWUoKSA8PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuc2Vla1RvKDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGp1c3QgdG8gdGhlICdwbGF5IHN5bWJvbCBpbiB0aXRsZScgZmVhdHVyZQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmaXhQbGF5U3ltYm9sLCAxMDAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJPcHRzLmFjdGl2YXRpb25Nb2RlID09PSAnbm9uZScpIHsKICAgICAgICAgICAgICAgIC8vIGFkanVzdCB0byB0aGUgJ3BsYXkgc3ltYm9sIGluIHRpdGxlJyBmZWF0dXJlCiAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmaXhQbGF5U3ltYm9sLCAxNTAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZGlzYWJsZSBhdXRvcGxheSBvbiBwbGF5bGlzdHMgaWYgZGVzaXJlZAogICAgICAgIGlmICh1c2VyT3B0cy5kaXNhYmxlQXV0b3BsYXkpIHsKICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHV3Ll95dF93d3cpIHsKICAgICAgICAgICAgICAgIGlmICggKCcnICsgdXcuX3l0X3d3d1trZXldKS5pbmRleE9mKCd3aW5kb3cuc3BmLm5hdmlnYXRlJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgdXcuX3l0X3d3d1trZXldID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHNob3cgdGhlIGZpcnN0IHRpbWUgdXNlciBtZXNzYWdlLCB0aGVuIHNldCBpdCB0byBuZXZlciBzaG93IGFnYWluCiAgICAgICAgaWYgKEdNX2NvbmZpZy5nZXRWYWx1ZSgneXQtYXV0b2J1ZmZlci1hdXRvaGQtZmlyc3QnLCAneWVzJykgPT09ICd5ZXMnKSB7CiAgICAgICAgICAgIG1zZyh7CiAgICAgICAgICAgICAgICB0ZXh0IDogJ1dlbGNvbWUgdG8gIicgKyBzY3JpcHRfbmFtZSArICciLlxuXG5cblxuJyArCiAgICAgICAgICAgICAgICAgICAgJ1RoZXJlIGlzIGFuIG9wdGlvbnMgYnV0dG9uIGJlbG93IHRoZSB2aWRlby5cblxuXG5cbicgKwogICAgICAgICAgICAgICAgICAgICdUaGUgb3B0aW9ucyBzY3JlZW4gd2lsbCBhdXRvbWF0aWNhbGx5IG9wZW4gd2hlbiB5b3UgY2xvc2UgdGhpcyBtZXNzYWdlLicsCiAgICAgICAgICAgICAgICB0aXRsZSA6ICciJyArIHNjcmlwdF9uYW1lICsgJyIgTWVzc2FnZScsCiAgICAgICAgICAgICAgICBvbmNsb3NlIDogZnVuY3Rpb24gKCkgeyBHTV9jb25maWcub3BlbigpOyB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBHTV9jb25maWcuc2V0VmFsdWUoJ3l0LWF1dG9idWZmZXItYXV0b2hkLWZpcnN0JywgJ25vJyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIG1ha2Ugc3VyZSB0aGUgcGFnZSBpcyBub3QgaW4gYSBmcmFtZQogICAgLy8gJiBpcyBvbiBhIFlvdVR1YmUgcGFnZSAodGhlIEBpbmNsdWRlIHdvcmtzIG1vc3Qgb2YgdGhlIHRpbWUsIGJ1dCB0aGlzIGlzIDEwMCUpCiAgICAvLyAmIGlzbid0IG9uIGEgYmxhY2tsaXN0ZWQgWW91VHViZSBwYWdlCiAgICBpZiAoIHdpbmRvdy5mcmFtZUVsZW1lbnQgfHwgd2luZG93ICE9PSB3aW5kb3cudG9wIHx8ICFVUkwubWF0Y2gocllvdXR1YmVVcmwpIC8qfHwgVVJMLm1hdGNoKHJZb3V0dWJlQmxhY2tsaXN0ZWRVcmwpKi8gKSB7IHJldHVybjsgfQoKICAgIC8vIHF1aXQgaWYgb25lIG9mIHRoZSBAcmVxdWlyZXMgaXMgbm9uLWV4aXN0ZW50CiAgICBpZiAodHlwZW9mIEpTTCA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIEdNX2NvbmZpZyA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGFkZEJ1dHRvblRvQ29udGFpbmVyID09PSAndW5kZWZpbmVkJykgewogICAgICAgIG1pc3NpbmdfcmVxdWlyZSA9IHR5cGVvZiBKU0wgPT09ICd1bmRlZmluZWQnID8gJ0pTTCcgOiB0eXBlb2YgR01fY29uZmlnID09PSAndW5kZWZpbmVkJyA/ICdHTV9jb25maWcnIDogdHlwZW9mIGFkZEJ1dHRvblRvQ29udGFpbmVyID8gJ0J1dHRvbiBDb250YWluZXInIDogJ3Vua25vd24nOwoKICAgICAgICByZXR1cm4gYWxlcnQoJycgKwogICAgICAgICAgICAnQSBAcmVxdWlyZSBpcyBtaXNzaW5nICgnICsgbWlzc2luZ19yZXF1aXJlICsgJykuXG5cbicgKwogICAgICAgICAgICAnRWl0aGVyIHlvdVwncmUgbm90IHVzaW5nIHRoZSBjb3JyZWN0IHBsdWctaW4sIG9yIEByZXF1aXJlIGlzblwndCB3b3JraW5nLlxuXG4nICsKICAgICAgICAgICAgJ1BsZWFzZSByZXZpZXcgdGhlIHNjcmlwdFwncyBtYWluIHBhZ2UgdG8gc2VlIHdoaWNoIGJyb3dzZXIgJiBhZGQtb24gdG8gdXNlLicgKwogICAgICAgICcnKTsKICAgIH0KCiAgICAvLyBhZGQgYSB1c2VyLXNjcmlwdCBjb21tYW5kCiAgICBpZiAodHlwZW9mIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBHTV9yZWdpc3Rlck1lbnVDb21tYW5kKCciJyArIHNjcmlwdF9uYW1lICsgJyIgT3B0aW9ucycsIEdNX2NvbmZpZy5vcGVuKTsKICAgIH0KCiAgICAvLyBpbml0IEdNX2NvbmZpZwogICAgR01fY29uZmlnLmluaXQoJyInICsgc2NyaXB0X25hbWUgKyAnIiBPcHRpb25zJywgewogICAgICAgIGFjdGl2YXRpb25Nb2RlIDogewogICAgICAgICAgICBzZWN0aW9uIDogWydNYWluIE9wdGlvbnMnXSwKICAgICAgICAgICAgbGFiZWwgOiAnQWN0aXZhdGlvbiBNb2RlJywKICAgICAgICAgICAgdHlwZSA6ICdzZWxlY3QnLAogICAgICAgICAgICBvcHRpb25zIDogewogICAgICAgICAgICAgICAgJ2J1ZmZlcicgOiAnQXV0by1QYXVzZScsCiAgICAgICAgICAgICAgICAncGxheScgOiAnQXV0byBQbGF5JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnZGVmYXVsdCcgOiAnYnVmZmVyJwogICAgICAgIH0sCiAgICAgICAgYXV0b0hEIDogewogICAgICAgICAgICBsYWJlbCA6ICdBdXRvIEhEJywKICAgICAgICAgICAgdHlwZSA6ICdzZWxlY3QnLAogICAgICAgICAgICBvcHRpb25zIDogewogICAgICAgICAgICAgICAgJ2RlZmF1bHQnIDogJ0F1dG9tYXRpYyAoZGVmYXVsdCknLAogICAgICAgICAgICAgICAgJ3RpbnknIDogJzE0NHAnLAogICAgICAgICAgICAgICAgJ3NtYWxsJyA6ICcyNDBwJywKICAgICAgICAgICAgICAgICdtZWRpdW0nIDogJzM2MHAnLAogICAgICAgICAgICAgICAgJ2xhcmdlJyA6ICc0ODBwJywKICAgICAgICAgICAgICAgICdoZDcyMCcgOiAnNzIwcCAoSEQpJywKICAgICAgICAgICAgICAgICdoZDEwODAnIDogJzEwODBwIChIRCknLAogICAgICAgICAgICAgICAgJ2hkMTQ0MCcgOiAnMTQ0MHAgKEhEKScsCiAgICAgICAgICAgICAgICAnaGlnaHJlcycgOiAnT3JpZ2luYWwgKGhpZ2hlc3QpJwogICAgICAgICAgICB9LAogICAgICAgICAgICAnZGVmYXVsdCcgOiAnaGQxMDgwJwogICAgICAgIH0sCiAgICAgICAgZGlzYWJsZURhc2ggOiB7CiAgICAgICAgICAgIGxhYmVsIDogJ0Rpc2FibGUgREFTSCBQbGF5YmFjaycsCiAgICAgICAgICAgIHR5cGUgOiAnY2hlY2tib3gnLAogICAgICAgICAgICAnZGVmYXVsdCcgOiB0cnVlLAogICAgICAgICAgICB0aXRsZSA6ICciREFTSCIgbG9hZHMgdGhlIHZpZGVvIGluIGJsb2Nrcy9waWVjZXM7IGRpc3J1cHRzIGF1dG9idWZmZXJpbmcgLS0gTm90ZTogUXVhbGl0aWVzIGFyZSBsaW1pdGVkIHdoZW4gZGlzYWJsZWQnCiAgICAgICAgfSwKICAgICAgICBoaWRlQWRzIDogewogICAgICAgICAgICBsYWJlbCA6ICdEaXNhYmxlIEFkcycsCiAgICAgICAgICAgIHR5cGUgOiAnY2hlY2tib3gnLAogICAgICAgICAgICAnZGVmYXVsdCcgOiB0cnVlLAogICAgICAgICAgICB0aXRsZSA6ICdTaG91bGQgZGlzYWJsZSBhZHZlcnRpc2VtZW50cy4gQWRCbG9jayBFZGdlIGlzIGJldHRlciwgdGhvdWdoLiBHZXQgdGhhdCBpbnN0ZWFkJwogICAgICAgIH0sCiAgICAgICAgaGlkZUFubm90YXRpb25zIDogewogICAgICAgICAgICBsYWJlbCA6ICdEaXNhYmxlIEFubm90YXRpb25zJywKICAgICAgICAgICAgdHlwZSA6ICdjaGVja2JveCcsCiAgICAgICAgICAgICdkZWZhdWx0JyA6IGZhbHNlLAogICAgICAgICAgICB0aXRsZSA6ICdOb3Qgd29ya2luZyBmb3IgSFRNTDUgLSBQTSBtZSBmb3Igc3VnZ2VzdGlvbnMnCiAgICAgICAgfSwKICAgICAgICBkaXNhYmxlQXV0b3BsYXkgOiB7CiAgICAgICAgICAgIGxhYmVsIDogJ0Rpc2FibGUgQXV0b3BsYXktTmV4dC1WaWRlbyBJbiBQbGF5bGlzdCcsCiAgICAgICAgICAgIHR5cGUgOiAnY2hlY2tib3gnLAogICAgICAgICAgICAnZGVmYXVsdCcgOiBmYWxzZQogICAgICAgIH0sCiAgICAgICAgdm9sdW1lIDogewogICAgICAgICAgICBzZWN0aW9uIDogWydPdGhlciBPcHRpb25zJ10sCiAgICAgICAgICAgIGxhYmVsIDogJ1NldCB2b2x1bWUgdG86ICcsCiAgICAgICAgICAgIHR5cGUgOiAnc2VsZWN0JywKICAgICAgICAgICAgb3B0aW9ucyA6IHsKICAgICAgICAgICAgICAgICcxMDAwJyA6ICdEb25cJ3QgQ2hhbmdlJywKICAgICAgICAgICAgICAgICcwJyA6ICcwJSAoT2ZmKScsCiAgICAgICAgICAgICAgICAnNScgOiAnNSUnLAogICAgICAgICAgICAgICAgJzEwJyA6ICcxMCUnLAogICAgICAgICAgICAgICAgJzIwJyA6ICcyMCUnLAogICAgICAgICAgICAgICAgJzI1JyA6ICcyNSUgKHF1YXJ0ZXIpJywKICAgICAgICAgICAgICAgICczMCcgOiAnMzAlJywKICAgICAgICAgICAgICAgICc0MCcgOiAnNDAlJywKICAgICAgICAgICAgICAgICc1MCcgOiAnNTAlIChoYWxmKScsCiAgICAgICAgICAgICAgICAnNjAnIDogJzYwJScsCiAgICAgICAgICAgICAgICAnNzAnIDogJzcwJScsCiAgICAgICAgICAgICAgICAnNzUnIDogJzc1JSAodGhyZWUgcXVhcnRlcnMpJywKICAgICAgICAgICAgICAgICc4MCcgOiAnODAlJywKICAgICAgICAgICAgICAgICc5MCcgOiAnOTAlJywKICAgICAgICAgICAgICAgICcxMDAnIDogJzEwMCUgKGZ1bGwpJywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGl0bGUgOiAnV2hhdCB0byBzZXQgdGhlIHZvbHVtZSB0bycsCiAgICAgICAgICAgICdkZWZhdWx0JyA6ICcxMDAwJwogICAgICAgIH0sCiAgICAgICAgYXV0b3BsYXlwbGF5bGlzdHMgOiB7CiAgICAgICAgICAgIGxhYmVsIDogJ0F1dG9wbGF5IG9uIFBsYXlsaXN0cyAob3ZlcnJpZGUpJywKICAgICAgICAgICAgdHlwZSA6ICdjaGVja2JveCcsCiAgICAgICAgICAgICdkZWZhdWx0JyA6IGZhbHNlLAogICAgICAgICAgICB0aXRsZSA6ICdUaGlzIHdpbGwgZW5hYmxlIGF1dG9wbGF5IG9uIHBsYXlsaXN0cywgcmVnYXJkbGVzcyBvZiB0aGUgIkFjdGl2YXRpb24gTW9kZSIgb3B0aW9uJwogICAgICAgIH0sCiAgICAgICAgZm9vdGVyIDogewogICAgICAgICAgICBsYWJlbCA6ICdPcHRpb25zIEJ1dHRvbiBJbiBGb290ZXInLAogICAgICAgICAgICB0eXBlIDogJ2NoZWNrYm94JywKICAgICAgICAgICAgJ2RlZmF1bHQnIDogZmFsc2UsCiAgICAgICAgICAgIHRpdGxlIDogJ1RoaXMgd2lsbCBtYWtlIHRoZSBvcHRpb25zIGJ1dHRvbiBzaG93IGF0IHRoZSBib3R0b20gb2YgdGhlIHBhZ2UgaW4gdGhlIGZvb3RlcicKICAgICAgICB9CiAgICB9LCAnJyArCiAgICAnYm9keSB7ICcgKwogICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yOiAjREREREREICFpbXBvcnRhbnQ7ICcgKwogICAgICAgICdjb2xvcjogIzQzNDM0MyAhaW1wb3J0YW50OyAnICsKICAgICAgICAnZm9udC1mYW1pbHk6IEFyaWFsLCBWZXJkYW5hLCBzYW5zLXNlcmlmICFpbXBvcnRhbnQ7ICcgKwogICAgJ30nICsKICAgICcjY29uZmlnX2hlYWRlciB7ICcgKwogICAgICAgICdmb250LXNpemU6IDE2cHQgIWltcG9ydGFudDsgJyArCiAgICAnfScgKwogICAgJy5jb25maWdfdmFyIHsgJyArCiAgICAgICAgJ21hcmdpbi1sZWZ0OiAyMCUgIWltcG9ydGFudDsgJyArCiAgICAgICAgJ21hcmdpbi10b3A6IDIwcHggIWltcG9ydGFudDsgJyArCiAgICAnfScgKwogICAgJyNoZWFkZXIgeyAnICsKICAgICAgICAnbWFyZ2luLWJvdHRvbTogNDBweCAhaW1wb3J0YW50OyAnICsKICAgICAgICAnbWFyZ2luLXRvcDogMjBweCAhaW1wb3J0YW50OyAnICsKICAgICd9JyArCiAgICAnLmluZGVudDQwIHsgJyArCiAgICAgICAgJ21hcmdpbi1sZWZ0OiAyMCUgIWltcG9ydGFudDsgJyArCiAgICAnfScgKyAKICAgICcuY29uZmlnX3ZhciAqIHsgJyArCiAgICAgICAgJ2ZvbnQtc2l6ZTogMTBwdCAhaW1wb3J0YW50OyAnICsKICAgICd9JyArCiAgICAnLnNlY3Rpb25faGVhZGVyX2hvbGRlciB7ICcgKwogICAgICAgICdib3JkZXItYm90dG9tOiAxcHggc29saWQgI0JCQkJCQiAhaW1wb3J0YW50OyAnICsKICAgICAgICAnbWFyZ2luLXRvcDogMTRweCAhaW1wb3J0YW50OyAnICsKICAgICd9JyArCiAgICAnLnNlY3Rpb25faGVhZGVyIHsgJyArCiAgICAgICAgJ2JhY2tncm91bmQtY29sb3I6ICNCRURCRkYgIWltcG9ydGFudDsgJyArCiAgICAgICAgJ2NvbG9yOiAjNDM0MzQzICFpbXBvcnRhbnQ7ICcgKwogICAgICAgICdtYXJnaW4tbGVmdDogMjAlICFpbXBvcnRhbnQ7ICcgKwogICAgICAgICdtYXJnaW4tdG9wOiA4cHggIWltcG9ydGFudDsgJyArCiAgICAgICAgJ3BhZGRpbmc6IDJweCAyMDBweCAhaW1wb3J0YW50OyAnICsKICAgICAgICAndGV4dC1kZWNvcmF0aW9uOiBub25lICFpbXBvcnRhbnQ7ICcgKwogICAgJ30nICsKICAgICcuc2VjdGlvbl9raWRzIHsgJyArCiAgICAgICAgJ21hcmdpbi1ib3R0b206IDE0cHggIWltcG9ydGFudDsgJyArCiAgICAnfScgKwogICAgJy5zYXZlY2xvc2VfYnV0dG9ucyB7ICcgKwogICAgICAgICdmb250LXNpemU6IDE0cHQgIWltcG9ydGFudDsgJyArCiAgICAnfScgKwogICAgJyNidXR0b25zX2hvbGRlciB7ICcgKwogICAgICAgICdwYWRkaW5nLXJpZ2h0OiA1MHB4OyAnICsKICAgICd9JyArCiAgICAnJywgewogICAgICAgIGNsb3NlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBKU0woJyNjNC1wbGF5ZXIsICNtb3ZpZV9wbGF5ZXInKS5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpOwogICAgICAgICAgICBKU0woJyNsaWdodHNfb3V0JykuaGlkZSgpOwogICAgICAgIH0sCiAgICAgICAgb3BlbiA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgSlNMKCcjYzQtcGxheWVyLCAjbW92aWVfcGxheWVyJykuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpOwogICAgICAgICAgICBKU0woJyNsaWdodHNfb3V0Jykuc2hvdygnYmxvY2snKTsKICAgICAgICAgICAgSlNMKCcjR01fY29uZmlnJykuY3NzKCdoZWlnaHQnLCAnODAlJykuY3NzKCd3aWR0aCcsICc4MCUnKS5jc3MoJ3pJbmRleCcsICc5OTk5OTk5OTk5OTknKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyB0aGlzIGlzIGZvciB0aGUgImxpZ2h0cyBvdXQiIGZlYXR1cmUgb2YgR01fY29uZmlnCiAgICBKU0wucnVuQXQoJ2ludGVyYWN0aXZlJywgZnVuY3Rpb24gKCkgewogICAgICAgIEpTTChkb2N1bWVudC5ib2R5KS5hcHBlbmQoJ2RpdicsIHsKICAgICAgICAgICAgaWQgOiAnbGlnaHRzX291dCcsCiAgICAgICAgICAgIHN0eWxlIDogJ2Rpc3BsYXk6IG5vbmU7IHBvc2l0aW9uOiBmaXhlZDsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOyB6LWluZGV4OiA5OTk5OTk5OTk5OTg7IGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC43Mik7JwogICAgICAgIH0pOwoKICAgICAgICAvLyBjYWxsIHRoZSBmdW5jdGlvbiB0aGF0IHNldHMgdXAgZXZlcnl0aGluZwogICAgICAgIGluaXQoKTsKICAgIH0pOwoKICAgIC8vIGFkZCBhIG1lc3NhZ2UgbGlzdGVuZXIgZm9yIHdoZW4gdGhlIHVuc2FmZVdpbmRvdyBmdW5jdGlvbiBmaXJlcyBhIG1lc3NhZ2UKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKG1zZykgewogICAgICAgIGlmIChtc2cuZGF0YSA9PT0gJ1lUQUJfX3JlYWR5JykgewogICAgICAgICAgICBtYWluKCk7CiAgICAgICAgfQogICAgfSwgZmFsc2UpOwoKICAgIC8vIHdhaXQgZm9yIGFuIGVsZW1lbnQgdGhhdCBjYW4gaG9sZCB0aGUgb3B0aW9ucyBidXR0b24gdG8gbG9hZCwKICAgIC8vIHRoZW4gcnVuIG91ciBhZGQgYnV0dG9uIGZ1bmN0aW9uCiAgICBKU0wud2FpdEZvcih7CiAgICAgICAgc2VsZWN0b3IgOiAnI3dhdGNoNy1oZWFkbGluZSwgI2doLW92ZXJ2aWV3dGFiIGRpdi5jNC1zcG90bGlnaHQtbW9kdWxlLWNvbXBvbmVudCwgI2Zvb3Rlci1tYWluJywKICAgICAgICBkb25lIDogYWRkQnV0dG9uCiAgICB9KTsKCn0oKSk7"},{"name":"Google site: Tool (Site results / Exclude sites)","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http*://www.google.*/*","http*://encrypted.google.*/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469599618516,"data":{}},"enabled":true,"position":19,"file_url":"https://greasyfork.org/scripts/1679-google-site-tool-site-results-exclude-sites/code/Google%20site:%20Tool%20(Site%20results%20%20Exclude%20sites).user.js","uuid":"e20e6854-8856-420d-ab34-a4d922f53ba0","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIEdvb2dsZSBzaXRlOiBUb29sIChTaXRlIHJlc3VsdHMgLyBFeGNsdWRlIHNpdGVzKQovLyBAYXV0aG9yICAgICAgSmVmZmVyc29uICJqc2NoZXIyMDAwIiBTY2hlcgovLyBAbmFtZXNwYWNlICAgSmVmZmVyc29uU2NoZXIKLy8gQGNvcHlyaWdodCAgIENvcHlyaWdodCAyMDE1IEplZmZlcnNvbiBTY2hlcgovLyBAbGljZW5zZSAgICAgQlNEIHdpdGggcmVzdHJpY3Rpb24KLy8gQGRlc2NyaXB0aW9uIEVhc2lseSBhZGQgc2l0ZTogb3IgLXNpdGU6IHRvIG1vZGlmeSB5b3VyIGN1cnJlbnQgR29vZ2xlIHF1ZXJ5LiB2MS4yLjAgMjAxNS0xMC0xMQovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly93d3cuZ29vZ2xlLiovKgovLyBAaW5jbHVkZSAgICAgaHR0cCo6Ly9lbmNyeXB0ZWQuZ29vZ2xlLiovKgovLyBAdmVyc2lvbiAgICAgMS4yLjAKLy8gQGdyYW50ICAgICAgIEdNX2dldFZhbHVlCi8vIEBncmFudCAgICAgICBHTV9zZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgR01fcmVnaXN0ZXJNZW51Q29tbWFuZAovLyBAcmVzb3VyY2UgICAgbXljb24gaHR0cDovL3d3dy5qZWZmZXJzb25zY2hlci5jb20vZ20vc3JjL2dmcmstR3NULXZlcjEyMC5wbmcKLy8gPT0vVXNlclNjcmlwdD09Ci8vIERJU0NMQUlNRVI6ICAgICBVc2UgYXQgeW91ciBvd24gcmlzay4gRnVuY3Rpb25hbGl0eSBhbmQgaGFybWxlc3NuZXNzIGNhbm5vdCBiZSBndWFyYW50ZWVkLgp2YXIgc2NyaXB0X2Fib3V0ID0gImh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8xNjc5LWdvb2dsZS1zaXRlLXRvb2wtc2l0ZS1yZXN1bHRzLWV4Y2x1ZGUtc2l0ZXMiOwovKgpDb3B5cmlnaHQgKGMpIDIwMTUgSmVmZmVyc29uIFNjaGVyLiBBbGwgcmlnaHRzIHJlc2VydmVkLgoKUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0IGFuZCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb246CgoxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCgoyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCgozLiBOZWl0aGVyIHRoZSBuYW1lIG9mIHRoZSBjb3B5cmlnaHQgaG9sZGVyIG5vciB0aGUgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCgpSRVNUUklDVElPTjogVVNFIFdJVEggQU5ZIEBpbmNsdWRlIG9yIEBtYXRjaCBUSEFUIENPVkVSUyBGQUNFQk9PSy5DT00gSVMgUFJPSElCSVRFRCBBTkQgVU5MSUNFTlNFRC4KClRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiovCnZhciBnc3Rfc3R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKZ3N0X3N0eS5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dC9jc3MiKTsKZ3N0X3N0eS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiLmdoaHBhbmV7cG9zaXRpb246YWJzb2x1dGU7Y29sb3I6IzMzMztiYWNrZ3JvdW5kLWNvbG9yOiNmY2ZjZmM7Ym9yZGVyOjFweCBzb2xpZCAjY2NjOyIgKwogICJib3JkZXItcmFkaXVzOjRweDtwYWRkaW5nOjAuMjVlbSAxLjVlbTtmb250LXNpemU6MTNweDtkaXNwbGF5Om5vbmV9IC5naGhke3Bvc2l0aW9uOnJlbGF0aXZlO2xpbmUtaGVpZ2h0OjEuMmVtO2N1cnNvcjpwb2ludGVyO30gIiArCiAgIiNnc3RTaXRlRm9ybSBpbnB1dFt0eXBlPSdyYWRpbydde3ZlcnRpY2FsLWFsaWduOmJvdHRvbTttYXJnaW4tdG9wOjVweDttYXJnaW4tYm90dG9tOjFweH0gIikpOwpkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGdzdF9zdHkpOwoKLy8gR2V0IHByZWZlcmVuY2VzIGZyb20gYnJvd3Nlcgp2YXIgZGVmYXVsdFByZWZzID0gewogICJzZWVtb3JlIjpbIlktTiIsIkFkZCBTZWUgTW9yZSBSZXN1bHRzIGxpbmtzIChZfE4pLCBPcGVuIGluIGEgbmV3IHdpbmRvdyAoWXxOKSJdLAogICJzdWJkb21haW4iOlsiTiIsIlN0cmlwIGxlZnRtb3N0IHN1YmRvbWFpbiAoWT1hbGx8Tj13d3cgb25seSkiXSwKICAicmVzZXJ2ZWQyIjpbIlgiLCJZIl0KfTsKdmFyIGdzdFByZWZzID0gR01fZ2V0VmFsdWUoImdzdFByZWZzIik7CmlmICghZ3N0UHJlZnMgfHwgZ3N0UHJlZnMubGVuZ3RoID09IDApewogIHZhciBnc3RQcmVmTyA9IGRlZmF1bHRQcmVmczsKfSBlbHNlIHsKICBpZiAoZ3N0UHJlZnMuaW5kZXhPZigicmVzZXJ2ZWQxIik+LTEpeyAvLyB1cGRhdGUgd2l0aCBuZXcgcHJlZmVyZW5jZXMKICAgIHZhciBnc3RQcmVmTyA9IGNvbnZlcnRQcmVmcyhkZWZhdWx0UHJlZnMsIGdzdFByZWZzKTsKICAgIEdNX3NldFZhbHVlKCJnc3RQcmVmcyIsSlNPTi5zdHJpbmdpZnkoZ3N0UHJlZk8pKTsKICB9IGVsc2UgewogICAgdmFyIGdzdFByZWZPID0gSlNPTi5wYXJzZShnc3RQcmVmcyk7CiAgfQp9CnZhciBzZWVtb3JlbGluayA9IGdzdFByZWZPLnNlZW1vcmVbMF07CnZhciBzdHJpcGFueSA9IGdzdFByZWZPLnN1YmRvbWFpblswXTsKCi8vID09ID09ID09IERldGVjdCBhZGRlZCBub2RlcyAvIGF0dGFjaCBNdXRhdGlvbk9ic2VydmVyID09ID09ID09CmlmIChkb2N1bWVudC5ib2R5KXsKICAvLyBBZGQgY2xpY2sgZXZlbnRzCiAgZ3N0X2NoZWNrTm9kZShkb2N1bWVudC5ib2R5KTsKICAvLyBDcmVhdGUgZm9ybQogIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImdzdFNpdGVGb3JtIikpIGdzdF9hZGRTaXRlRm9ybSgpOwogIC8vIFdhdGNoIGZvciBjaGFuZ2VzIHRoYXQgY291bGQgYmUgbmV3IGluc3RhbnQgb3IgQUpBWCBzZWFyY2ggcmVzdWx0cwogIHZhciBNdXRPYiwgY2hnTW9uLCBpLCBodHRwZWxzLCBvcHRzOwogIHZhciBNdXRPYiA9ICh3aW5kb3cuTXV0YXRpb25PYnNlcnZlcikgPyB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciA6IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyOwogIGlmIChNdXRPYil7CiAgICBjaGdNb24gPSBuZXcgTXV0T2IoZnVuY3Rpb24obXV0YXRpb25TZXQpewogICAgICBtdXRhdGlvblNldC5mb3JFYWNoKGZ1bmN0aW9uKG11dGF0aW9uKXsKICAgICAgICBmb3IgKGk9MDsgaTxtdXRhdGlvbi5hZGRlZE5vZGVzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgIGlmIChtdXRhdGlvbi5hZGRlZE5vZGVzW2ldLm5vZGVUeXBlID09IDEpewogICAgICAgICAgICBnc3RfY2hlY2tOb2RlKG11dGF0aW9uLmFkZGVkTm9kZXNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIC8vIGF0dGFjaCBjaGdNb24gdG8gZG9jdW1lbnQuYm9keQogICAgb3B0cyA9IHtjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9OwogICAgY2hnTW9uLm9ic2VydmUoZG9jdW1lbnQuYm9keSwgb3B0cyk7CiAgfQp9CgpmdW5jdGlvbiBnc3RfY2hlY2tOb2RlKGVsKXsKICBpZiAoZWwubm9kZU5hbWUgPT0gIkxJIiB8fCAoZWwubm9kZU5hbWUgPT0gImRpdiIgJiYgZWwuY2xhc3NOYW1lID09ICJnIikpIHZhciBsaWVscyA9IFtlbF07CiAgZWxzZSB2YXIgbGllbHMgPSBlbC5xdWVyeVNlbGVjdG9yQWxsKCdsaS5nLCBkaXYuZycpOwogIGlmIChsaWVscy5sZW5ndGggPiAwKXsKICAgIHZhciBpLCBjaXRlLCBhZWw7CiAgICBmb3IgKHZhciBpPTA7IGk8bGllbHMubGVuZ3RoOyBpKyspewogICAgICB2YXIgY2l0ZSA9IGxpZWxzW2ldLnF1ZXJ5U2VsZWN0b3IoJ2NpdGUnKTsKICAgICAgaWYgKGNpdGUpe2lmICghY2l0ZS5oYXNBdHRyaWJ1dGUoInNpdGVsaXN0ZW5lciIpKXsKICAgICAgICBpZiAoY2l0ZS5wYXJlbnROb2RlLm5vZGVOYW1lID09ICJBIil7CiAgICAgICAgICAvLyBUT0RPIC0gdGhpcyBpcyBmb3IgY2l0ZXMgdW5kZXIgYnVuY2hlcyBvZiBuZXdzIGFydGljbGVzOyBuZWVkIHRvIGV4Y2x1ZGUgR29vZ2xlCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBhZWwgPSBsaWVsc1tpXS5xdWVyeVNlbGVjdG9yKCJoMyBhIik7CiAgICAgICAgICBpZiAoIWFlbCkgYWVsID0gbGllbHNbaV0ucXVlcnlTZWxlY3RvcigiYSIpOwogICAgICAgICAgaWYgKGFlbCl7CiAgICAgICAgICAgIGlmKGFlbC5oYXNBdHRyaWJ1dGUoImhyZWYiKSl7CiAgICAgICAgICAgICAgaWYgKGFlbC5nZXRBdHRyaWJ1dGUoImhyZWYiKS5pbmRleE9mKCJodHRwIik9PTAgfHwgYWVsLmdldEF0dHJpYnV0ZSgiaHJlZiIpLmluZGV4T2YoIi9pbnRlcnN0aXRpYWwiKT09MCl7CiAgICAgICAgICAgICAgICBjaXRlLnNldEF0dHJpYnV0ZSgic2l0ZWxpc3RlbmVyIiwgYWVsLmdldEF0dHJpYnV0ZSgiaHJlZiIpLnN1YnN0cihhZWwuZ2V0QXR0cmlidXRlKCJocmVmIikuaW5kZXhPZigiaHR0cCIpKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNpdGUuc2V0QXR0cmlidXRlKCJzaXRlbGlzdGVuZXIiLCBjaXRlLnRleHRDb250ZW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY2l0ZS5zZXRBdHRyaWJ1dGUoInNpdGVsaXN0ZW5lciIsIGNpdGUudGV4dENvbnRlbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaXRlLnNldEF0dHJpYnV0ZSgic2l0ZWxpc3RlbmVyIiwgY2l0ZS50ZXh0Q29udGVudCk7ICAgICAKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNpdGUuaGFzQXR0cmlidXRlKCJzaXRlbGlzdGVuZXIiKSl7CiAgICAgICAgICBjaXRlLnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsKICAgICAgICAgIGNpdGUuc2V0QXR0cmlidXRlKCJ0aXRsZSIsIkxpbWl0IHNlYXJjaCB0byB0aGlzIHNpdGUgb3IgZXhjbHVkZSB0aGlzIHNpdGUiKTsKICAgICAgICAgIGNpdGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBnc3Rfc2hvd1NpdGVGb3JtLCBmYWxzZSk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWVtb3JlbGluay5zcGxpdCgiLSIpWzBdID09ICJZIil7CiAgICAgICAgICB2YXIgZGl2bWFzID0gbGllbHNbaV0ucXVlcnlTZWxlY3RvcigiZGl2LnMgZGl2Lm1hcyIpOwogICAgICAgICAgaWYgKGRpdm1hcyl7CiAgICAgICAgICAgIGRpdm1hcy5zdHlsZS5tYXJnaW5MZWZ0ID0gIjIycHgiOwogICAgICAgICAgICB2YXIgY2l0ZWhvc3QgPSBjaXRlLnRleHRDb250ZW50OwogICAgICAgICAgICBpZiAoY2l0ZWhvc3QuaW5kZXhPZigiaHR0cDovLyIpID09IDApIGNpdGVob3N0ID0gY2l0ZWhvc3Quc3Vic3RyKDcpOwogICAgICAgICAgICBpZiAoY2l0ZWhvc3QuaW5kZXhPZigiaHR0cHM6Ly8iKSA9PSAwKSBjaXRlaG9zdCA9IGNpdGVob3N0LnN1YnN0cig4KTsKICAgICAgICAgICAgaWYgKGNpdGVob3N0LmluZGV4T2YoImZ0cDovLyIpID09IDApIGNpdGVob3N0ID0gY2l0ZWhvc3Quc3Vic3RyKDYpOwogICAgICAgICAgICBpZiAoY2l0ZWhvc3QuaW5kZXhPZigiICIpID4gMCkgY2l0ZWhvc3QgPSBjaXRlaG9zdC5zdWJzdHIoMCwgY2l0ZWhvc3QuaW5kZXhPZigiICIpKTsKICAgICAgICAgICAgaWYgKGNpdGVob3N0LmluZGV4T2YoIi8iKSA+IDApIGNpdGVob3N0ID0gY2l0ZWhvc3Quc3Vic3RyKDAsIGNpdGVob3N0LmluZGV4T2YoIi8iKSk7CiAgICAgICAgICAgIHZhciBsb2NuZXcgPSBnc3RfcmVRcnkoIitzaXRlOiIrY2l0ZWhvc3QsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKGxvY25ldyAhPSAiY2FuY2VsIil7CiAgICAgICAgICAgICAgdmFyIHBuZXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7CiAgICAgICAgICAgICAgcG5ldy5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIm1hcmdpbjowLjNlbSAwIDAgMDsiKTsKICAgICAgICAgICAgICB2YXIgbGlua25ldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgICBsaW5rbmV3LmlubmVySFRNTCA9ICJNb3JlIHJlc3VsdHMgZnJvbSAiICsgY2l0ZWhvc3QgKyAiJm5ic3A7wrsiOwogICAgICAgICAgICAgIGxpbmtuZXcuaHJlZiA9IGxvY25ldzsKICAgICAgICAgICAgICBwbmV3LmFwcGVuZENoaWxkKGxpbmtuZXcpOwogICAgICAgICAgICAgIGRpdm1hcy5hcHBlbmRDaGlsZChwbmV3KTsKICAgICAgICAgICAgICAvLyB2MS4xLjMgZml4IGxpbmtzIHdoZXJlIHRoZSBVUkwgYmFyIGlzbid0IHVwZGF0ZWQgdW50aWwgdGhlIGxpbmsgaXMgY3JlYXRlZAogICAgICAgICAgICAgIGxpbmtuZXcuc2V0QXR0cmlidXRlKCJjaXRlaG9zdCIsIGNpdGVob3N0KTsKICAgICAgICAgICAgICBsaW5rbmV3LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3ZlciIsIGdzdF9yZWZyZXNoTGluaywgZmFsc2UpOwogICAgICAgICAgICAgIC8vIHYxLjEuNCBhZGQgdGFyZ2V0IGF0dHJpYnV0ZSB0byBvcGVuIGluIGEgbmV3IHdpbmRvdy90YWIKICAgICAgICAgICAgICBpZiAoc2VlbW9yZWxpbmsuc3BsaXQoIi0iKVsxXSA9PSAiWSIpewogICAgICAgICAgICAgICAgbGlua25ldy5zZXRBdHRyaWJ1dGUoInRhcmdldCIsICJfYmxhbmsiKTsKICAgICAgICAgICAgICAgIGxpbmtuZXcuaW5uZXJIVE1MICs9ICLCuyI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHYxLjEuNiBoaWRlIChkdXBsaWNhdGUpIGxpbmsgR29vZ2xlIGFkZHMgdW5kZXIgc29tZSByZXN1bHRzCiAgICAgICAgICAgIHZhciBnb29nbW9yZSA9IGRpdm1hcy5xdWVyeVNlbGVjdG9yKCJkaXYubWFzLXNjLXJvdyIpOwogICAgICAgICAgICBpZiAoZ29vZ21vcmUpIGdvb2dtb3JlLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9fQogICAgfQogIH0KfQoKLy8gRnVuY3Rpb25zIHJlbGF0aW5nIHRvIHRoZSBzaXRlRm9ybQpmdW5jdGlvbiBnc3RfYWRkU2l0ZUZvcm0oKXsKICB2YXIgc2ZkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgc2ZkLmlkID0gImdzdFNpdGVGb3JtIjsKICBzZmQuY2xhc3NOYW1lID0gImdoaHBhbmUiOwogIHNmZC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwiei1pbmRleDoxMDU7dG9wOi0yLjc1ZW07IikKICBzZmQuaW5uZXJIVE1MID0gIjxmb3JtIG9uc3VibWl0PVwicmV0dXJuIGZhbHNlO1wiPjxwIGlkPVwiZ3N0QnV0dG9uc1wiPiIgKwogICAgIjxidXR0b24gaWQ9XCJnc3RzZjFcIiB0aXRsZT1cIlRoaXMgc2l0ZSBvbmx5XCI+Jm5ic3A7Jm5ic3A7KyZuYnNwOyZuYnNwOzwvYnV0dG9uPiAiICsKICAgICI8YnV0dG9uIGlkPVwiZ3N0c2YyXCIgdGl0bGU9XCJFeGNsdWRlIHRoaXMgc2l0ZVwiPiZuYnNwOyZuYnNwOy0mbmJzcDsmbmJzcDs8L2J1dHRvbj4gIiArCiAgICAiPGJ1dHRvbiBpZD1cImdzdHNmM1wiIHRpdGxlPVwiQ2xvc2UgcGFuZVwiPiZuYnNwOyZuYnNwO3gmbmJzcDsmbmJzcDs8L2J1dHRvbj48L3A+IiArCiAgICAiPHAgaWQ9XCJnc3RSYWRpb3NcIj48L3A+PHAgc3R5bGU9XCJwYWRkaW5nLXRvcDozcHg7Y3Vyc29yOnBvaW50ZXI7Y29sb3I6IzAwZlwiIG9uY2xpY2s9XCJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3N0T3B0aW9ucycpLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzt0aGlzLnN0eWxlLmRpc3BsYXk9J25vbmUnO1wiPkVkaXQgU2NyaXB0IE9wdGlvbnM8L3A+IiArCiAgICAiPHAgaWQ9XCJnc3RPcHRpb25zXCIgc3R5bGU9XCJwYWRkaW5nLXRvcDozcHg7ZGlzcGxheTpub25lXCI+U2NyaXB0IE9wdGlvbnM6PGJyPjxsYWJlbCB0aXRsZT1cIlNob3cgJ01vcmUgcmVzdWx0cyBmcm9tJyBsaW5rIGFmdGVyIHNlbGVjdGVkIGhpdHNcIj48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgbmFtZT1cImNoa3NlZW1vcmVcIiBpZD1cImNoa3NlZW1vcmVcIj4gQWRkICIgKwogICAgIidNb3JlIHJlc3VsdHMgZnJvbScgbGluazwvbGFiZWw+PGJyPiZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOzxsYWJlbCB0aXRsZT1cIk9wZW4gaW4gYSBuZXcgd2luZG93IG9yIHRhYlwiPjxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwiY2hrc210YXJnZXRcIiBpZD1cImNoa3NtdGFyZ2V0XCI+IE9wZW4gaW4gbmV3IHdpbmRvdzwvbGFiZWw+PGJyPiIgKwogICAgIjxsYWJlbCB0aXRsZT1cIkxpc3QgZG9tYWluIHdpdGhvdXQgbGVmdG1vc3Qgc3ViZG9tYWluXCI+PGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG5hbWU9XCJjaGtzdHJpcGFueVwiIGlkPVwiY2hrc3RyaXBhbnlcIj4gRmlyc3QmbmJzcDtvcHRpb24mbmJzcDthbHdheXMmbmJzcDtvbWl0Jm5ic3A7bGVmdG1vc3QmbmJzcDtzdWJkb21haW48L2xhYmVsPjwvcD4iICsKICAgICI8cCBzdHlsZT1cInBhZGRpbmctdG9wOjNweFwiPjxzdHJvbmc+R29vZ2xlIHNpdGU6IFRvb2w8L3N0cm9uZz4gdjEuMi4wICg8YSBocmVmPVwiIiArIHNjcmlwdF9hYm91dCArICJcIiB0YXJnZXQ9XCJfYmxhbmtcIj5BYm91dDwvYT4pPHNwYW4gc3R5bGU9XCJmb250LXNpemU6MC44ZW07Y29sb3I6I2FhYVwiPiIgKwogICAgIjxicj5Db3B5cmlnaHQgJmNvcHk7IDIwMTUgSmVmZmVyc29uIFNjaGVyPC9zcGFuPjwvcD48L2Zvcm0+IjsKICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNmZCk7CiAgZml4c2VlbW9yZSgpOwogIGZpeHN1YmRvbWFpbigpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnc3RzZjEiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsZ3N0X3JlUXVlcnksZmFsc2UpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnc3RzZjIiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsZ3N0X3JlUXVlcnksZmFsc2UpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnc3RzZjMiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsZ3N0Y2xvc2Vmb3JtLGZhbHNlKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2hrc2VlbW9yZSIpLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsdXBkdHNlZW1vcmUsZmFsc2UpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGtzbXRhcmdldCIpLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsdXBkdHNlZW1vcmUsZmFsc2UpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGtzdHJpcGFueSIpLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsdXBkdHN1YmRvbWFpbixmYWxzZSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImdzdFNpdGVGb3JtIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLGdoaGtpbGxldmVudCxmYWxzZSk7Cn0KZnVuY3Rpb24gZ3N0X3Nob3dTaXRlRm9ybShlKSB7CiAgdmFyIHIxPXdpbmRvdy5nZXRTZWxlY3Rpb24oKS5nZXRSYW5nZUF0KDApOwogIGlmICghcjEuY29sbGFwc2VkKXsgLy8gRG9uJ3Qgc2hvdyBkaWFsb2cgaWYgdXNlciBzZWxlY3RlZCBwYXJ0IG9mIHRoZSBjaXRlICh2MS4wLjApCiAgICB2YXIgcjI9ZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsKICAgIHIyLnNlbGVjdE5vZGUoZS5jdXJyZW50VGFyZ2V0KTsKICAgIGlmIChyMi5jb21wYXJlQm91bmRhcnlQb2ludHMocjIuRU5EX1RPX1NUQVJULCByMSk8MSAmJiByMi5jb21wYXJlQm91bmRhcnlQb2ludHMocjIuRU5EX1RPX0VORCwgcjEpPi0xKSByZXR1cm47CiAgfQogIHZhciBjaXRldHh0LCBzaXRlY29tcCwgcmFkcCwgcGF0aCwgaywgeiwgc2ZybTsKICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnc3RTaXRlRm9ybSIpKSBnc3RfYWRkU2l0ZUZvcm0oKTsKICAvLyBCdWlsZCByYWRpb3MKICBjaXRldHh0ID0gZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgic2l0ZWxpc3RlbmVyIik7CiAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgaWYgKGNpdGV0eHQuaW5kZXhPZigiaHR0cDovLyIpID09IDApIGNpdGV0eHQgPSBjaXRldHh0LnN1YnN0cig3KTsKICBpZiAoY2l0ZXR4dC5pbmRleE9mKCJodHRwczovLyIpID09IDApIGNpdGV0eHQgPSBjaXRldHh0LnN1YnN0cig4KTsKICBpZiAoY2l0ZXR4dC5pbmRleE9mKCJmdHA6Ly8iKSA9PSAwKSBjaXRldHh0ID0gY2l0ZXR4dC5zdWJzdHIoNik7CiAgc2l0ZWNvbXAgPSBjaXRldHh0LnNwbGl0KCIvIik7CiAgcmFkcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnc3RSYWRpb3MiKTsKICByYWRwLmlubmVySFRNTCA9ICIiOwogIGZvciAodmFyIGs9MDsgazxzaXRlY29tcC5sZW5ndGgtMTsgaysrKXsKICAgIC8vIFRPRE86IGRvIG5vdCBkdXBsaWNhdGUgYSBzaXRlIG9yIC1zaXRlIHBhcmFtZXRlcnMgYWxyZWFkeSBpbiB0aGUgcXVlcnk/CiAgICBpZiAoayA9PSAwKXsgLy8gY2hlY2sgZm9yIHJlbW92aW5nIGxlZnRtb3N0IHN1YmRvbWFpbgogICAgICBpZiAoc3RyaXBhbnkgPT0gIlkiKXsgLy8gdHJ5IHRvIHJlbW92ZSBhbnl0aGluZwogICAgICAgIGlmIChzaXRlY29tcFtrXS5zcGxpdCgiLiIpLmxlbmd0aCA+IDIpewogICAgICAgICAgcmFkcC5pbm5lckhUTUwgKz0gIjxsYWJlbCBzdHlsZT1cIndoaXRlLXNwYWNlOnByZVwiPjxpbnB1dCB0eXBlPVwicmFkaW9cIiBuYW1lPVwic2l0ZXN0clwiIHZhbHVlPVwiIiArIGsgKyAid1wiIGNoZWNrZWQ9XCJjaGVja2VkXCI+IDxzcGFuPiIgKwogICAgICAgICAgICBzaXRlY29tcFtrXS5zdWJzdHIoc2l0ZWNvbXBba10uaW5kZXhPZigiLiIpICsgMSkgKyAiPC9zcGFuPjwvbGFiZWw+IgogICAgICAgICAgcmFkcC5pbm5lckhUTUwgKz0gIjxicj48bGFiZWwgc3R5bGU9XCJ3aGl0ZS1zcGFjZTpwcmVcIj48aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInNpdGVzdHJcIiB2YWx1ZT1cIiIgKyBrICsgIlwiPiA8c3Bhbj4iICsKICAgICAgICAgICAgc2l0ZWNvbXBba10gKyAiPC9zcGFuPjwvbGFiZWw+IgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYWRwLmlubmVySFRNTCArPSAiPGxhYmVsIHN0eWxlPVwid2hpdGUtc3BhY2U6cHJlXCI+PGlucHV0IHR5cGU9XCJyYWRpb1wiIG5hbWU9XCJzaXRlc3RyXCIgdmFsdWU9XCIiICsgayArICJcIiBjaGVja2VkPVwiY2hlY2tlZFwiPiA8c3Bhbj4iICsKICAgICAgICAgICAgc2l0ZWNvbXBba10gKyAiPC9zcGFuPjwvbGFiZWw+IgogICAgICAgIH0KICAgICAgfSBlbHNlIHsgLy8gdHJ5IHRvIHJlbW92ZSB3d3cgb25seQogICAgICAgIGlmIChzaXRlY29tcFtrXS5zdWJzdHIoMCwgc2l0ZWNvbXBba10uaW5kZXhPZigiLiIpKS50b0xvd2VyQ2FzZSgpID09ICJ3d3ciKXsKICAgICAgICAgIHJhZHAuaW5uZXJIVE1MICs9ICI8bGFiZWwgc3R5bGU9XCJ3aGl0ZS1zcGFjZTpwcmVcIj48aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInNpdGVzdHJcIiB2YWx1ZT1cIiIgKyBrICsgIndcIiBjaGVja2VkPVwiY2hlY2tlZFwiPiA8c3Bhbj4iICsKICAgICAgICAgICAgc2l0ZWNvbXBba10uc3Vic3RyKHNpdGVjb21wW2tdLmluZGV4T2YoIi4iKSArIDEpICsgIjwvc3Bhbj48L2xhYmVsPiIKICAgICAgICAgIHJhZHAuaW5uZXJIVE1MICs9ICI8YnI+PGxhYmVsIHN0eWxlPVwid2hpdGUtc3BhY2U6cHJlXCI+PGlucHV0IHR5cGU9XCJyYWRpb1wiIG5hbWU9XCJzaXRlc3RyXCIgdmFsdWU9XCIiICsgayArICJcIj4gPHNwYW4+IiArCiAgICAgICAgICAgIHNpdGVjb21wW2tdICsgIjwvc3Bhbj48L2xhYmVsPiIKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmFkcC5pbm5lckhUTUwgKz0gIjxsYWJlbCBzdHlsZT1cIndoaXRlLXNwYWNlOnByZVwiPjxpbnB1dCB0eXBlPVwicmFkaW9cIiBuYW1lPVwic2l0ZXN0clwiIHZhbHVlPVwiIiArIGsgKyAiXCIgY2hlY2tlZD1cImNoZWNrZWRcIj4gPHNwYW4+IiArCiAgICAgICAgICAgIHNpdGVjb21wW2tdICsgIjwvc3Bhbj48L2xhYmVsPiIKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmKHNpdGVjb21wW2srMV0gIT0gIiIpewogICAgICAgIHBhdGggPSAiIjsKICAgICAgICBmb3IgKHo9MDsgejxrOyB6KyspewogICAgICAgICAgcGF0aCArPSBzaXRlY29tcFt6XSArICIvIjsKICAgICAgICB9CiAgICAgICAgcGF0aCArPSBzaXRlY29tcFtrXTsKICAgICAgICByYWRwLmlubmVySFRNTCArPSAiPGJyPjxsYWJlbCBzdHlsZT1cIndoaXRlLXNwYWNlOnByZVwiPjxpbnB1dCB0eXBlPVwicmFkaW9cIiBuYW1lPVwic2l0ZXN0clwiIHZhbHVlPVwiIiArIGsgKyAiXCI+IDxzcGFuPiIgKwogICAgICAgICAgcGF0aCArICI8L3NwYW4+PC9sYWJlbD4iICAKICAgICAgfQogICAgICBpZiAoayA9PSAzKSBicmVhazsgLy8gbGV0J3Mgbm90IGdvIG92ZXJib2FyZC4uLgogICAgfQogIH0KICAvLyBQb3NpdGlvbiBmb3JtCiAgc2ZybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnc3RTaXRlRm9ybSIpOwogIHRkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2hodGVtcCIpOwogIGlmICghdGRpdil7CiAgICB0ZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICB0ZGl2LmlkID0gImdoaHRlbXAiOwogIH0KICBsdCA9IGUuY3VycmVudFRhcmdldC5vZmZzZXRMZWZ0ICsgMjA7IAogIHRkaXYuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OiIgKyAgbHQgKyAicHg7dG9wOjA7ei1pbmRleDoxMDA7d2lkdGg6NTAwcHg7Iik7CiAgZS5jdXJyZW50VGFyZ2V0LnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQodGRpdik7CiAgdGRpdi5hcHBlbmRDaGlsZChzZnJtKTsKICAvLyBBZGQgbGluayBpZiB1c2VyIGNsaWNrZWQgcGFydCBvZiB0aGUgY2l0ZSB0aGF0J3MgYSBsaW5rCiAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lID09ICJBIil7CiAgICB2YXIgcG5ldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKTsKICAgIHBuZXcuaWQgPSAiZ3N0bGluayI7CiAgICB2YXIgYW5ldyA9IGUudGFyZ2V0LmNsb25lTm9kZSh0cnVlKTsKICAgIHBuZXcuYXBwZW5kQ2hpbGQoYW5ldyk7CiAgICBzZnJtLmluc2VydEJlZm9yZShwbmV3LCBzZnJtLmZpcnN0Q2hpbGQpOwogIH0KICBzZnJtLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnc3RzZjEiKS5mb2N1cygpOwogIGZpeHNlZW1vcmUoKTsKfQpmdW5jdGlvbiBnc3RjbG9zZWZvcm0oZSl7CiAgaWYgKCFlKSByZXR1cm47CiAgdmFyIHNmcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ3N0U2l0ZUZvcm0iKTsKICB2YXIgdGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnaGh0ZW1wIik7CiAgc2ZybS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogIHZhciBwbGluayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJnc3RsaW5rIik7CiAgaWYgKHBsaW5rKSBwbGluay5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHBsaW5rKTsKICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNmcm0pOwogIHRkaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0ZGl2KTsKfQovLyBNaXNjIGZ1bmN0aW9ucwpmdW5jdGlvbiBnaGhraWxsZXZlbnQoZSl7CiAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT0gImJ1dHRvbiIgfHwgZS50YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PSAiaW5wdXQiKSByZXR1cm47CiAgZS5zdG9wUHJvcGFnYXRpb24oKTsKfQpmdW5jdGlvbiBnc3RfcmVRdWVyeShlKXsKICAvLyBidWlsZCBzaXRlIHN0cmluZwogIGlmIChlLnRhcmdldC5pZCA9PSAiZ3N0c2YxIikgdmFyIHNzID0gIitzaXRlOiI7IAogIGVsc2UgdmFyIHNzID0gIistc2l0ZToiOwogIHZhciByYWRzID0gZS50YXJnZXQuZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCcjZ3N0UmFkaW9zIGlucHV0W3R5cGU9InJhZGlvIl0nKTsKICBmb3IgKHZhciBpPTA7IGk8cmFkcy5sZW5ndGg7IGkrKyl7CiAgICBpZihyYWRzW2ldLmNoZWNrZWQpewogICAgICBzcyArPSByYWRzW2ldLm5leHRFbGVtZW50U2libGluZy50ZXh0Q29udGVudDsKICAgICAgZ3N0X3JlUXJ5KHNzLCB0cnVlKTsKICAgICAgYnJlYWs7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGdzdF9yZVFyeShkLCBnbyl7CiAgLy8gY29tcHV0ZSBuZXcgVVJMCiAgaWYgKCFkKSByZXR1cm47CiAgdmFyIGNhbmNlbCA9IGZhbHNlOwogIHZhciBxYSA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN1YnN0cih3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCI/IikrMSkuc3BsaXQoIiYiKTsKICB2YXIgdXBkYXRlZCA9IGZhbHNlOwogIGZvciAodmFyIGo9cWEubGVuZ3RoLTE7IGo+PTA7IGotLSl7CiAgICBpZiAodXBkYXRlZCA9PSBmYWxzZSl7CiAgICAgIGlmIChxYVtqXS5zcGxpdCgiPSIpWzBdID09ICJxIil7CiAgICAgICAgaWYgKHFhW2pdLmluZGV4T2YoZCkgPiAtMSB8fCBxYVtqXS5pbmRleE9mKGQucmVwbGFjZSgiOiIsICIlM0EiKSkgPiAtMSkgY2FuY2VsID0gdHJ1ZTsKICAgICAgICBlbHNlIHZhciBpcHEgPSBxYVtqXTsKICAgICAgICBxYVtqXSArPSBkOwogICAgICAgIHVwZGF0ZWQgPSB0cnVlOwogICAgICAgIHZhciBzdWJzdHFyeSA9IHFhW2pdOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChxYVtqXS5pbmRleE9mKCIjcT0iKSA+IC0xKXsKICAgICAgICAgIGlmIChxYVtqXS5pbmRleE9mKGQpID4gLTEgfHwgcWFbal0uaW5kZXhPZihkLnJlcGxhY2UoIjoiLCAiJTNBIikpID4gLTEpIGNhbmNlbCA9IHRydWU7CiAgICAgICAgICBlbHNlIHZhciBpcHEgPSBxYVtqXS5zdWJzdHIocWFbal0uaW5kZXhPZigiI3E9IikrMSk7CiAgICAgICAgICBxYVtqXSArPSBkOwogICAgICAgICAgdXBkYXRlZCA9IHRydWU7CiAgICAgICAgICB2YXIgc3Vic3RxcnkgPSBxYVtqXS5zdWJzdHIocWFbal0uaW5kZXhPZigiI3E9IikrMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAocWFbal0uc3BsaXQoIj0iKVswXSA9PSAicSIpewogICAgICAgIGlmIChnbykgcWFbal0gPSBpcHE7CiAgICAgICAgZWxzZSBxYVtqXSA9IHN1YnN0cXJ5OwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChxYVtqXS5pbmRleE9mKCIjcT0iKSA+IC0xKXsKICAgICAgICAgIGlmIChnbykgcWFbal0gPSBxYVtqXS5zdWJzdHIoMCwgcWFbal0uaW5kZXhPZigiI3E9IikrMSkgKyBpcHE7CiAgICAgICAgICBlbHNlIHFhW2pdID0gcWFbal0uc3Vic3RyKDAsIHFhW2pdLmluZGV4T2YoIiNxPSIpKzEpICsgc3Vic3Rxcnk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGlmIChjYW5jZWwgIT0gdHJ1ZSkgdmFyIGxvY25ldyA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN1YnN0cigwLCB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCI/IikrMSkgKyBxYS5qb2luKCImIik7CiAgZWxzZSBsb2NuZXcgPSAiY2FuY2VsIjsKICBpZiAoZ28pIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbG9jbmV3OwogIGVsc2UgcmV0dXJuIGxvY25ldzsKfQpmdW5jdGlvbiB1cGR0c2VlbW9yZShlKXsgLy8gU3RvcmUgc2V0dGluZ3MgZm9yIFNlZSBNb3JlIHByZWZlcmVuY2UKICB2YXIgY2hrID0gZS50YXJnZXQ7CiAgdmFyIHNtcGFydHMgPSBzZWVtb3JlbGluay5zcGxpdCgiLSIpOwogIGlmIChjaGsuY2hlY2tlZCl7CiAgICBpZiAoY2hrLmlkID09ICJjaGtzZWVtb3JlIikgc21wYXJ0c1swXSA9ICJZIjsKICAgIGlmIChjaGsuaWQgPT0gImNoa3NtdGFyZ2V0Iil7CiAgICAgIHNtcGFydHNbMV0gPSAiWSI7CiAgICAgIGZpeGV4aXN0aW5nbGlua3ModHJ1ZSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIGlmIChjaGsuaWQgPT0gImNoa3NlZW1vcmUiKSBzbXBhcnRzWzBdID0gIk4iOwogICAgaWYgKGNoay5pZCA9PSAiY2hrc210YXJnZXQiKXsKICAgICAgc21wYXJ0c1sxXSA9ICJOIjsKICAgICAgZml4ZXhpc3RpbmdsaW5rcyhmYWxzZSk7CiAgICB9CiAgfQogIHNlZW1vcmVsaW5rID0gc21wYXJ0cy5qb2luKCItIik7CiAgZ3N0UHJlZk8uc2VlbW9yZVswXSA9IHNlZW1vcmVsaW5rOwogIEdNX3NldFZhbHVlKCJnc3RQcmVmcyIsSlNPTi5zdHJpbmdpZnkoZ3N0UHJlZk8pKTsKICBmaXhzZWVtb3JlKCk7Cn0KZnVuY3Rpb24gZml4c2VlbW9yZSgpeyAgLy8gQ2hlY2sgYm94ZXMgZm9yIFNlZSBNb3JlIHByZWZlcmVuY2UKICBpZiAoc2VlbW9yZWxpbmsuc3BsaXQoIi0iKS5sZW5ndGggPT0gMSkgc2VlbW9yZWxpbmsgPSBzZWVtb3JlbGluayArICItTiI7CiAgdmFyIGNoayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGtzZWVtb3JlIik7CiAgaWYgKHNlZW1vcmVsaW5rLnNwbGl0KCItIilbMF0gPT0gIlkiKXsKICAgIGNoay5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJjaGVja2VkIik7CiAgICBjaGsuY2hlY2tlZCA9IHRydWU7CiAgfSBlbHNlIHsKICAgIGNoay5yZW1vdmVBdHRyaWJ1dGUoImNoZWNrZWQiKTsKICAgIGNoay5jaGVja2VkID0gZmFsc2U7ICAKICB9CiAgdmFyIGNoayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGtzbXRhcmdldCIpOwogIGlmIChzZWVtb3JlbGluay5zcGxpdCgiLSIpWzFdID09ICJZIil7CiAgICBjaGsuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwiY2hlY2tlZCIpOwogICAgY2hrLmNoZWNrZWQgPSB0cnVlOwogIH0gZWxzZSB7CiAgICBjaGsucmVtb3ZlQXR0cmlidXRlKCJjaGVja2VkIik7CiAgICBjaGsuY2hlY2tlZCA9IGZhbHNlOyAgCiAgfQp9CmZ1bmN0aW9uIGZpeGV4aXN0aW5nbGlua3MoYmxuVGFyZ2V0QmxhbmspewogIHZhciBzZWVtb3JlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImFbY2l0ZWhvc3RdIik7CiAgZm9yICh2YXIgaT0wOyBpPHNlZW1vcmVzLmxlbmd0aDsgaSsrKXsKICAgIGlmIChzZWVtb3Jlc1tpXS5oYXNBdHRyaWJ1dGUoInRhcmdldCIpKXsKICAgICAgc2VlbW9yZXNbaV0ucmVtb3ZlQXR0cmlidXRlKCJ0YXJnZXQiKTsKICAgICAgc2VlbW9yZXNbaV0uaW5uZXJIVE1MID0gc2VlbW9yZXNbaV0uaW5uZXJIVE1MLnN1YnN0cigwLCBzZWVtb3Jlc1tpXS5pbm5lckhUTUwubGVuZ3RoLTEpOyAvL8K7CiAgICB9CiAgICBpZiAoYmxuVGFyZ2V0QmxhbmspewogICAgICBzZWVtb3Jlc1tpXS5zZXRBdHRyaWJ1dGUoInRhcmdldCIsICJfYmxhbmsiKTsKICAgICAgc2VlbW9yZXNbaV0uaW5uZXJIVE1MICs9ICLCuyI7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIHVwZHRzdWJkb21haW4oZSl7IC8vIFN0b3JlIHNldHRpbmdzIGZvciBzdWJkb21haW4gc3RyaXBwaW5nIHByZWYKICB2YXIgY2hrID0gZS50YXJnZXQ7CiAgaWYgKGNoay5jaGVja2VkKXsKICAgIHN0cmlwYW55ID0gIlkiOwogIH0gZWxzZSB7CiAgICBzdHJpcGFueSA9ICJOIjsKICB9CiAgZ3N0UHJlZk8uc3ViZG9tYWluWzBdID0gc3RyaXBhbnk7CiAgR01fc2V0VmFsdWUoImdzdFByZWZzIixKU09OLnN0cmluZ2lmeShnc3RQcmVmTykpOwogIGZpeHN1YmRvbWFpbigpOwogIC8vIFRPRE86IE5lZWQgdG8gY2xvc2UgYW5kIHJlLW9wZW4gZGlhbG9nIHRvIHJlZ2VuZXJhdGUgZG9tYWluIGxpc3QuLi4KfQpmdW5jdGlvbiBmaXhzdWJkb21haW4oKXsgIC8vIENoZWNrIGJveCBmb3Igc3ViZG9tYWluIHN0cmlwcGluZyBwcmVmCiAgdmFyIGNoayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGtzdHJpcGFueSIpOwogIGlmIChzdHJpcGFueSA9PSAiWSIpewogICAgY2hrLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsImNoZWNrZWQiKTsKICAgIGNoay5jaGVja2VkID0gdHJ1ZTsKICB9IGVsc2UgewogICAgY2hrLnJlbW92ZUF0dHJpYnV0ZSgiY2hlY2tlZCIpOwogICAgY2hrLmNoZWNrZWQgPSBmYWxzZTsgIAogIH0KfQpmdW5jdGlvbiBnc3RfcmVmcmVzaExpbmsoZSl7CiAgaWYgKGUudGFyZ2V0Lm5vZGVOYW1lICE9ICJBIikgcmV0dXJuOwogIHZhciBsb2NuZXcgPSBnc3RfcmVRcnkoIitzaXRlOiIrZS50YXJnZXQuZ2V0QXR0cmlidXRlKCJjaXRlaG9zdCIpLCBmYWxzZSk7CiAgaWYgKGxvY25ldyAhPSAiY2FuY2VsIikgZS50YXJnZXQuaHJlZiA9IGxvY25ldzsKfQpmdW5jdGlvbiBjb252ZXJ0UHJlZnMoYXJyUHJlZnMsIG9sZFByZWZzKXsKICB2YXIgZ3N0UHJlZk90ZW1wID0gYXJyUHJlZnM7CiAgdmFyIG9sZFByZWZzT3RlbXAgPSBKU09OLnBhcnNlKG9sZFByZWZzKTsKICBpZiAob2xkUHJlZnMuaW5kZXhPZigic2VlbW9yZSIpPi0xKSBnc3RQcmVmT3RlbXAuc2VlbW9yZVswXSA9IG9sZFByZWZzT3RlbXAuc2VlbW9yZVswXTsKICBpZiAob2xkUHJlZnMuaW5kZXhPZigic3ViZG9tYWluIik+LTEpIGdzdFByZWZPdGVtcC5zdWJkb21haW5bMF0gPSBvbGRQcmVmc090ZW1wLnN1YmRvbWFpblswXTsKICByZXR1cm4gZ3N0UHJlZk90ZW1wOwp9Cg=="},{"name":"Google Search Extra Buttons","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http://www.google.*/search*","https://www.google.*/search*","https://www.google.*/*","https://encrypted.google.*/search*","https://encrypted.google.*/*","https://spmbt.github.io/googleSearchExtraButtons/saveYourLocalStorage.html"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469600574380,"data":{}},"enabled":false,"position":20,"file_url":"https://greasyfork.org/scripts/7543-google-search-extra-buttons/code/Google%20Search%20Extra%20Buttons.user.js","uuid":"7eeb936f-0f1e-4bae-b1d6-d7fc60085acb","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIEdvb2dsZSBTZWFyY2ggRXh0cmEgQnV0dG9ucwovLyBAbmFtZTpydSAgICAgR29vZ2xlU2VhcmNoRXh0cmFCdXR0b25zCi8vIEBkZXNjcmlwdGlvbiBBZGQgYnV0dG9ucyAobGFzdCAxLzIvMyBkYXlzLCB3ZWVrcywgUERGIHNlYXJjaCBldGMuKSBmb3IgR29vZ2xlIHNlYXJjaCBwYWdlCi8vIEBkZXNjcmlwdGlvbjpydSDQmtC90L7Qv9C60Lgg0LLQsNGA0LjQsNC90YLQvtCyINC/0L7QuNGB0LrQsCDQtNC70Y8g0YHRgtGA0LDQvdC40YbRiyDQv9C+0LjRgdC60LAgR29vZ2xlICgxLTItMyDQtNC90Y8sINC90LXQtNC10LvQuCwgUERGLCAuLi4pCi8vIEB2ZXJzaW9uICAgICAyMC4yMDE2LjQuMTIKLy8gQG5hbWVzcGFjZSAgIHNwbWJ0LmdpdGh1Yi5jb20KLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly93d3cuZ29vZ2xlLiovc2VhcmNoKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly93d3cuZ29vZ2xlLiovc2VhcmNoKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly93d3cuZ29vZ2xlLiovKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly9lbmNyeXB0ZWQuZ29vZ2xlLiovc2VhcmNoKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly9lbmNyeXB0ZWQuZ29vZ2xlLiovKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly9zcG1idC5naXRodWIuaW8vZ29vZ2xlU2VhcmNoRXh0cmFCdXR0b25zL3NhdmVZb3VyTG9jYWxTdG9yYWdlLmh0bWwKLy8gPT0vVXNlclNjcmlwdD09CmlmKGxvY2F0aW9uLmhvc3Q9PSdzcG1idC5naXRodWIuaW8nKXsKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24oZXYpewoJCWlmKC9eaHR0cHM/OlwvXC93d3dcLmdvb2dsZVwuLy50ZXN0KGV2Lm9yaWdpbikpewoJCQl2YXIgZCA9IHR5cGVvZiBldi5kYXRhID09J3N0cmluZycgJiYgZXYuZGF0YVswXSA9PSd7JyA/IEpTT04ucGFyc2UoZXYuZGF0YSkgOiBldi5kYXRhOwoJCQlpZighZC5kbykgcmV0dXJuOwoJCQl2YXIgdG9rID0gZC50b2ssIGtleSA9IGQua2V5OwoJCQlzd2l0Y2goZC5kbyl7CgkJCQljYXNlICdzZXQnOgoJCQkJCXZhciBwcmV2ID0gbG9jYWxTdG9yYWdlW2tleV07CgkJCQkJaWYoZC52YWwgIT09dW5kZWZpbmVkKQoJCQkJCQlsb2NhbFN0b3JhZ2Vba2V5XSA9IEpTT04uc3RyaW5naWZ5KGQudmFsKTsKCQkJCQllbHNlCgkJCQkJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICdnZXQnOgoJCQkJCXByZXYgPSBsb2NhbFN0b3JhZ2Vba2V5XTsKCQkJCQlwcmV2ID0gcHJldiA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBwcmV2ID09J3N0cmluZycmJiBwcmV2WzBdICE9J3snPyBwcmV2IDogSlNPTi5wYXJzZShwcmV2KTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ3JlbW92ZSc6CgkJCQkJcHJldiA9IGxvY2FsU3RvcmFnZVtrZXldOwoJCQkJCWlmKHByZXYgIT09dW5kZWZpbmVkKQoJCQkJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpOwoJCQl9CgkJCS8vY29uc29sZS5sb2coJ1tpb10nLCB0b2ssICdwcmV2PScsIHByZXYpOwoJCQkvL2V2LnNvdXJjZS5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShwcmV2ICE9PXVuZGVmaW5lZCA/IHt0b2s6IHRvaywgcHJldjogcHJldn0gOiB7dG9rOiB0b2ssIHVuZGVmOjF9KSwgZXYub3JpZ2luKTsKCQl9fSwhMSk7Cn1lbHNlCgooZnVuY3Rpb24oc2V0dHMpeyAvL2xhbmcsIHNpdGVzLCBsYXN0SG91cnNMZXNzCgp2YXIgJHggPSBmdW5jdGlvbihlbCwgaCl7aWYoaCkgZm9yKHZhciBpIGluIGgpIGVsW2ldID0gaFtpXTsgcmV0dXJuIGVsO30gLy89PT1leHRlbmQ9PT0KCSwkcGQgPSBmdW5jdGlvbihldil7ZXYucHJldmVudERlZmF1bHQoKTt9CgksJHEgPSBmdW5jdGlvbihxLCBlbCl7cmV0dXJuIChlbHx8ZG9jdW1lbnQpLnF1ZXJ5U2VsZWN0b3IocSl9CgksbGggPSBsb2NhdGlvbi5ocmVmCgksZCA9IGRvY3VtZW50CiwkZSA9IGZ1bmN0aW9uKGcpeyAvLz09PWNyZWF0ZSBvciB1c2UgZXhpc3RpbmcgZWxlbWVudD09PSAvL2c9e2VsfGNsb25lLGNsLGh0LGNzLGF0LGF0UmVtb3ZlLG9uLGFwVH0KCWcuZWwgPSBnLmVsIHx8IGcuY2xvbmUgfHwnRElWJzsKCXZhciBvID0gZy5vID0gZy5jbG9uZSAmJiBnLmNsb25lLmNsb25lTm9kZSAmJiBnLmNsb25lLmNsb25lTm9kZSghMCkKCQkJfHwgKHR5cGVvZiBnLmVsID09J3N0cmluZycgPyBkLmNyZWF0ZUVsZW1lbnQoZy5lbCkgOiBnLmVsKTsKCWlmKG8peyAvL2V4ZWN1dGUgaWYgZXhpc3QKCQlpZihnLmNsKQoJCQlvLmNsYXNzTmFtZSA9IGcuY2w7CgkJaWYoZy5jbEFkZCkKCQkJby5jbGFzc0xpc3QuYWRkKGcuY2xBZGQpOwoJCWlmKGcuY3MpCgkJCSR4KG8uc3R5bGUsIGcuY3MpOwoJCWlmKGcuaHQgfHwgZy5hdCl7CgkJCXZhciBhdCA9IGcuYXQgfHx7fTsgaWYoZy5odCkgYXQuaW5uZXJIVE1MID0gZy5odDt9CgkJaWYoYXQpCgkJCWZvcih2YXIgaSBpbiBhdCl7CgkJCQlpZihpPT0naW5uZXJIVE1MJykgb1tpXSA9IGF0W2ldOwoJCQkJZWxzZSBvLnNldEF0dHJpYnV0ZShpLCBhdFtpXSk7fQoJCWlmKGcuYXRSZW1vdmUpCgkJCWZvcih2YXIgaSBpbiBnLmF0UmVtb3ZlKQoJCQkJby5yZW1vdmVBdHRyaWJ1dGUoZy5hdFJlbW92ZVtpXSk7CgkJaWYoZy5vbikKCQkJZm9yKHZhciBpIGluIGcub24pIGlmKGcub25baV0pCgkJCQlvLmFkZEV2ZW50TGlzdGVuZXIoaSwgZy5vbltpXSwhMSk7CgkJZy5hcCAmJiBvLmFwcGVuZENoaWxkKGcuYXApOwoJCWcuYXBUICYmIGcuYXBULmFwcGVuZENoaWxkKG8pOwoJfQoJcmV0dXJuIG87Cn0sCmFkZFJ1bGVzID0gZnVuY3Rpb24oY3NzKXsKCXZhciBoZWFkcyA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKQoJCSxub2RlID0gZC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwoJaGVhZHMubGVuZ3RoICYmIGhlYWRzWzBdLmFwcGVuZENoaWxkKG5vZGUpOwoJbm9kZS5hcHBlbmRDaGlsZChkLmNyZWF0ZVRleHROb2RlKGNzcykpOwp9OwovKioKICogY2hlY2sgb2NjdXJyZW5jZSBvZiB0aGlyZC1wYXJ0eSBldmVudCB3aXRoIGdyb3dpbmcgaW50ZXJ2YWwKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbXtOdW1iZXJ9IGgudCBzdGFydCBwZXJpb2Qgb2YgY2hlY2sKICogQHBhcmFte051bWJlcn0gaC5pIG51bWJlciBvZiBjaGVja3MKICogQHBhcmFte051bWJlcn0gaC5tIG11bHRpcGxpZXIgb2YgcGVyaW9kIGluY3JlbWVudAogKiBAcGFyYW17RnVuY3Rpb259IGguY2hlY2sgZXZlbnQgY29uZGl0aW9uCiAqIEBwYXJhbXtGdW5jdGlvbn0gaC5vY2N1ciBldmVudCBoYW5kbGVyCiAqLwp2YXIgVG91dCA9IGZ1bmN0aW9uKGgpewoJCXZhciB0aCA9IHRoaXM7CgkJKGZ1bmN0aW9uKCl7CgkJCWlmKChoLmRhdCA9IGguY2hlY2soKSApKSAvL3dhaXQgb2YgcG9zaXRpdmUgcmVzdWx0LCB0aGVuIG9jY3VycwoJCQkJaC5vY2N1cigpOwoJCQllbHNlIGlmKGguaS0tID4wKSAvL25leHQgc2xvd2VyIHN0ZXAKCQkJCXRoLnd3ID0gc2V0VGltZW91dChhcmd1bWVudHMuY2FsbGVlLCAoaC50ICo9IGgubSkgKTsKCQl9KSgpOwoJfQovL2ZvciB4TG9jU3RvcjoKCSx4TG9jU3Rvck9yaWdpbiA9IGQubG9jYXRpb24ucHJvdG9jb2wgKycvL3NwbWJ0LmdpdGh1Yi5pbycKCSxxciwgcXJzID17fSAvL3NldCBvZiBxdWVyaWVzICJrZXktY2FsbHMiICjQvtC6LCB0b3V0TGl0dCwgdG91dExvbmcsIG5vU2VydmljZSwgbm9TdG9yYWdlKQoJLHFySSA9IDAgLy9xdWVyaWVzIGNvdW50ZXIKCSxxck4gPSAxMiAvL21heCBudW1iZXIgb2Ygd2FpdGluZyBxdWVyaWVzCgksZXJySU1heCA9IDEyMCwgZXJyTk1heCA9IGVycklNYXggLy9tYXggbnVtYmVyIG9mIGVycm9ycwoJLG5zID0nZ29vZ1hCdXR0b25zXycgLy9uYW1lc3BhY2UgZm9yIGtleXMKCSxsaXN0ZW5Nc2cKLyoqCiAqIGV4dGVybmFsIGxvY2FsU3RvcmFnZSBmb3IgdXNpbmcgYW5vdGhlciBkb21haW4gaWYgY3VycmVudCBkb21haW4gc3RvcmFnZSBpcyBlcmFzZWQgYW55d2hlcmUKICogQHBhcmFte1N0cmluZ30gaC5kbyAtIGFjdGlvbjogc2V0fGdldHxyZW1vdmUKICogQHBhcmFte1N0cmluZ30gaC5rZXkKICogQHBhcmFte09iamVjdHx1bmRlZmluZWR9IGgudmFsIChhbnkgdHlwZSkKICogQHBhcmFte051bWJlcnx1bmRlZmluZWR9IGgudG91dExpdHQKICogQHBhcmFte051bWJlcnx1bmRlZmluZWR9IGgudG91dAogKiBAcGFyYW17RnVuY3Rpb259IGguY0IgLSBjYWxsYmFjayB3aXRoIDIgYXJndW1lbnRzCiAqIEBwYXJhbXtGdW5jdGlvbnx1bmRlZmluZWR9IGguZXJyIC0gY2FsbGJhY2sgZm9yIGVyciB3aXRoIG9uZSBhcmd1bWVudAogKi8KCSx4TG9jU3RvciA9IGZ1bmN0aW9uKGgpewoJCXZhciBoMCA9IGg7CgkJaC50b3V0TGl0dCA9IGgudG91dExpdHQgfHwgNDAwOwoJCWgudG91dCA9IGgudG91dCB8fCA0MDAwOwoJCXZhciBpZnIgPSBkLmdldEVsZW1lbnRCeUlkKCd4TG9jU3RvcicpCgkJCSxxdWVyeSA9IGZ1bmN0aW9uKCl7CgkJCQlpZigocXJJICs9IDEpID4gcXJOKXsKCQkJCQl4Q2F0Y2goJ2xvbmdRcnMnLCBudWxsLCBoKTsKCQkJCQlyZXR1cm47fQoJCQkJaWZyLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoJHgoewoJCQkJCQlkbzogaC5kbwoJCQkJCQksdG9rOiB0b2tlbgoJCQkJCQksa2V5OiBucyArIGgua2V5CgkJCQkJfSwgaC52YWwgIT09dW5kZWZpbmVkID8ge3ZhbDogaC52YWx9Ont9KSApCgkJCQksIHhMb2NTdG9yT3JpZ2luKTsKCQkJCXFyc1t0b2tlbl0gPSAkeCh7IC8vZm9yIHdhaXQgb2YgcmVzcG9uc2UKCQkJCQl3VG91dExpdHQ6IChmdW5jdGlvbihoLCBxckksIGVycklNYXgpe3JldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CgkJCQkJCQlxckkgLT0gMTsKCQkJCQkJCWlmKChlcnJJTWF4IC09IDEpID49MCkKCQkJCQkJCQk7Ly9jb25zb2xlLndhcm4oJ3RvdXRMaXR0JywgaCk7CgkJCQkJCQljaGtFcnJNYXgoKTsKCQkJCQkJfSwgaC50b3V0TGl0dCk7fSkoaCwgcXJJLCBlcnJJTWF4KQoJCQkJCSx3VG91dDogKGZ1bmN0aW9uKGgsIHFySSl7cmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKCQkJCQkJCXFySSAtPSAxOwoJCQkJCQkJLy94Q2F0Y2goJ3RvdXQnLCBudWxsLCBoKTsKCQkJCQkJCS8veExvY1N0b3IoaDApOwoJCQkJCQl9LCBoLnRvdXQpO30pKGgsIHFySSkKCQkJCX0sIGgpOwoJCQl9CgkJCSx0b2tlbiA9ICtuZXcgRGF0ZSgpICsgKE1hdGgucmFuZG9tKCkrJycpLnN1YnN0cigxLDgpCgkJCSxlbCA9IGguZWw7CgkJZGVsZXRlIGguZWw7CgkJaWYoaWZyKSBxdWVyeSgpOwoJCWVsc2UgaWZyID0gJGUoewoJCQllbDogJ2lmcmFtZScsCgkJCWF0OntpZDogJ3hMb2NTdG9yJwoJCQkJLHNyYzogeExvY1N0b3JPcmlnaW4gKycvZ29vZ2xlU2VhcmNoRXh0cmFCdXR0b25zL3NhdmVZb3VyTG9jYWxTdG9yYWdlLmh0bWwnfSwKCQkJY3M6IHtkaXNwbGF5OiAnbm9uZSd9LAoJCQlvbjoge2xvYWQ6IHF1ZXJ5fSwKCQkJYXBUOiBlbCB8fCBkLmJvZHkKCQl9KTsKCQlpZighbGlzdGVuTXNnKSBhZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24oZXYpewoJCQlpZihldi5vcmlnaW4gPT0geExvY1N0b3JPcmlnaW4peyAgICAvLyB7InRvayI6Ijx2YWx1ZT4iWywiZXJyIjoiPHR4dD4iXSwiaCI6Li4ufQoJCQkJLy9jb25zb2xlLmxvZygnZnJvbV9pbycsIEpTT04ucGFyc2UoZXYuZGF0YSkpCgkJCQl2YXIgcmVzcCA9IGV2LmRhdGEgJiYgZXYuZGF0YVswXSA9PSd7JyAmJiBKU09OLnBhcnNlKGV2LmRhdGEpOwoJCQkJaWYoIXJlc3ApIHhDYXRjaCgnYmFkX2Zvcm1hdCcsIHJlc3AsIGgpOwoJCQkJaWYoKCBxciA9IHFyc1tyZXNwLnRva10gKSl7CgkJCQkJcXJJIC09IDE7CgkJCQkJcXIuY0IocmVzcC5wcmV2LCByZXNwLnVuZGVmKTsKCQkJCQl2YXIgZXIgPSBxci5lcnI7CgkJCQkJZGVsZXRlIHFyc1tyZXNwLnRva107fSAvLyBlbHNlIGlnbm9yZSB1bnN1ZmZpY2llbnQgdG9rZW4KCQkJCWlmKHJlc3AuZXJyICYmICghZXIgfHwgZXIocmVzcC5lcnIpKSApIC8vaW5kaXZpZHVhbCBvciBjb21tb24gZXJyb3IgcHJvY2Vzc2luZyBkZXBlbmRzIG9mIGVyKCkKCQkJCQl4Q2F0Y2gocmVzcC5lcnIsIHJlc3AsIGgpOwoJCX19LCExKTsKCQlsaXN0ZW5Nc2cgPTE7Cgl9LAoJCS8vZm9yIHRlc3RzOiBsb2NhbFN0b3JhZ2UuZ29vZ1hCdXR0b25zX2R3bXloID0gSlNPTi5zdHJpbmdpZnkoe2g6WzEsMiwxLDEsMV19KQoJCS8vJCgnI3hMb2NTdG9yJykuY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSgneyJkbyI6ImdldCIsImtleSI6Imdvb2dYQnV0dG9uc19kd215aCJ9JywnaHR0cHM6Ly9zcG1idC5naXRodWIuaW8nKQoJeENhdGNoID0gZnVuY3Rpb24oZXIsIHJlc3AsIGgpewoJCWlmKChlcnJJTWF4IC09IDEpID49MCkKCQkJY29uc29sZS5lcnJvcigndG9rOicsIHJlc3AgJiYgcmVzcC50b2sgfHwnLS0nLCc7IGVycjonLCBlciwnOyAgaDonLCBoLCc7IHJlc3BIOicsIHJlc3AgJiYgcmVzcC5oKTsKCQljaGtFcnJNYXgoKTsKCX0sCgljaGtFcnJNYXggPSBmdW5jdGlvbigpe2lmKCFlcnJJTWF4KSBjb25zb2xlLmVycm9yKCdUb28gbWFueSBlcnIgbWVzc2FnZXM6JywgZXJyTk1heCl9CgksJGwgPXtydTp7CgkJJ3NlYXJjaCBpbiBQREYgZmlsZXMnOifQv9C+0LjRgdC6INC/0L4g0LTQvtC60YPQvNC10L3RgtCw0LwgUERGJwoJCSwnc2VhcmNoIGluJzon0LjRgdC60LDRgtGMINC/0L4nCgkJLCdmcm9tIC8gdG8nOifQt9CwINC/0LXRgNC40L7QtCcKCQksJ2xhc3QnOlsn0LfQsCDQv9C+0YHQu9C10LTQvdC40LknLCfQt9CwINC/0L7RgdC70LXQtNC90LjQtScsJ9C30LAg0L/QvtGB0LvQtdC00L3RjtGOJ10KCQksJ2RheSc6J9GB0YPRgtC60LgnCgkJLCdkYXlzJzpbJ9C00L3RjycsJ9C00L3QtdC5J10KCQksJ3dlZWsnOifQvdC10LTQtdC70Y4nCgkJLCd3ZWVrcyc6WyfQvdC10LTQtdC70LgnLCfQvdC10LTQtdC70YwnXQoJCSwnbW9udGgnOifQvNC10YHRj9GGJwoJCSwnbW9udGhzJzpbJ9C80LXRgdGP0YbQsCcsJ9C80LXRgdGP0YbQtdCyJ10KCQksJ3llYXInOifQs9C+0LQnCgkJLCd5ZWFycyc6WyfQs9C+0LTQsCcsJ9C70LXRgiddCgkJLCdob3VyJzon0YfQsNGBJwoJCSwnaG91cnMnOlsn0YfQsNGB0LAnLCfRh9Cw0YHQvtCyJ10KCQksJ1NldHRpbmdzJzon0J3QsNGB0YLRgNC+0LnQutC4JwoJCSwnb2YgdXNlcnNjcmlwdCc6J9GO0LfQtdGA0YHQutGA0LjQv9GC0LAnCgkJLCdyZWxvYWQgcGFnZSBmb3IgZWZmZWN0Jzon0L/QtdGA0LXQt9Cw0LPRgNGD0LfQuNGC0Ywg0YHRgtGA0LDQvdC40YbRgycKCQksJ0ludGVyZmFjZSBsYW5ndWFnZSc6J9Cv0LfRi9C6INC40L3RgtC10YDRhNC10LnRgdCwJwoJCSwnTGVzcyBwb3NpdGlvbnMgYXQgdGhlIGVuZCBvZiBzZWxlY3RzJzon0JzQtdC90YzRiNC1INCy0YvQsdC+0YDQsCDQsiDQutC+0L3RhtC1INGB0LXQu9C10LrRgtC+0LInCgkJLCdTaXRlcyc6J9Ch0LDQudGC0YsnCgl9LGZyOnsKCQknc2VhcmNoIGluIFBERiBmaWxlcyc6J2xhIHJlY2hlcmNoZSBkYW5zIGxlcyBmaWNoaWVycyBQREYnCgkJLCdzZWFyY2ggaW4nOidyZWNoZXJjaGVyIGRhbnMnCgkJLCdmcm9tIC8gdG8nOidwb3VyIGxhIHDDqXJpb2RlJwoJCSwnbGFzdCc6WydsZSBkZXJuaWVyJywnZGFucyBsZXMgZGVybmllcnMnLCdkYW5zIGxlcyBkZXJuaWVycyddCgkJLCdkYXknOidqb3VyJwoJCSwnZGF5cyc6Wydqb3VycycsJ2pvdXJzJ10KCQksJ3dlZWsnOidzZW1haW5lJwoJCSwnd2Vla3MnOlsnc2VtYWluZXMnLCdzZW1haW5lcyddCgkJLCdtb250aCc6J21vaXMnCgkJLCdtb250aHMnOlsnbW9pcycsJ21vaXMnXQoJCSwneWVhcic6J2FuJwoJCSwneWVhcnMnOlsnYW5zJywnYW5zJ10KCQksJ2hvdXInOidoZXVyZScKCQksJ2hvdXJzJzpbJ2hldXJlcycsJ2hldXJlcyddCgkJLCdTZXR0aW5ncyc6J1BhcmFtw6h0cmVzJwoJCSwnb2YgdXNlcnNjcmlwdCc6J2RlIFVzZXJzY3JpcHQnCgkJLCdyZWxvYWQgcGFnZSBmb3IgZWZmZWN0JzoncmVjaGFyZ2VyIGxhIHBhZ2UgcG91ciBlZmZldCcKCQksJ0ludGVyZmFjZSBsYW5ndWFnZSc6J0xhbmd1ZSBkZSBsXCdpbnRlcmZhY2UnCgkJLCdMZXNzIHBvc2l0aW9ucyBhdCB0aGUgZW5kIG9mIHNlbGVjdHMnOidNb2lucyBkZSBjaG9peCBsZXMgbG9uZ3VlcyBsaXN0ZXMnCgkJLCdTaXRlcyc6J0xlcyBzaXRlcycKCX0sZGU6ewoJCSdzZWFyY2ggaW4gUERGIGZpbGVzJzonU3VjaGUgaW4gUERGLURhdGVpZW4nCgkJLCdzZWFyY2ggaW4nOidTdWNoZSBpbicKCQksJ2Zyb20gLyB0byc6J2ltIFplaXRyYXVtJwoJCSwnbGFzdCc6WydsZXR6dGUnLCdsZXR6dGUnLCdsZXR6dGUnXQoJCSwnZGF5JzonVGFnJwoJCSwnZGF5cyc6WydUYWdlJywnVGFnZSddCgkJLCd3ZWVrJzonV29jaGUnCgkJLCd3ZWVrcyc6WydXb2NoZW4nLCdXb2NoZW4nXQoJCSwnbW9udGgnOidNb25hdCcKCQksJ21vbnRocyc6WydNb25hdGUnLCdNb25hdGUnXQoJCSwneWVhcic6J0phaHInCgkJLCd5ZWFycyc6WydKYWhyZScsJ0phaHJlJ10KCQksJ2hvdXInOidTdHVuZGUnCgkJLCdob3Vycyc6WydTdHVuZGVuJywnU3R1bmRlbiddCgkJLCdTZXR0aW5ncyc6J0VpbnN0ZWxsdW5nZW4nCgkJLCdvZiB1c2Vyc2NyaXB0Jzondm9uIFVzZXJzY3JpcHQnCgkJLCdyZWxvYWQgcGFnZSBmb3IgZWZmZWN0JzonU2VpdGUgbmV1IGxhZGVuJwoJCSwnSW50ZXJmYWNlIGxhbmd1YWdlJzonU3ByYWNoZScKCQksJ0xlc3MgcG9zaXRpb25zIGF0IHRoZSBlbmQgb2Ygc2VsZWN0cyc6J1dlbmlnZXIgQXVzd2FobCBpbiBsYW5nZW4gTGlzdGVuJwoJCSwnU2l0ZXMnOidXZWJzaXRlcycKCX0sZXM6ewoJCSdzZWFyY2ggaW4gUERGIGZpbGVzJzonYsO6c3F1ZWRhIGVuIGFyY2hpdm9zIFBERicKCQksJ3NlYXJjaCBpbic6J2J1c2NhIGVuJwoJCSwnZnJvbSAvIHRvJzoncGFyYSBlbCBwZXLDrW9kbycKCQksJ2xhc3QnOlsnZWwgw7psdGltbycsJ2VuIGxvcyDDumx0aW1vcycsJ2VuIGxvcyDDumx0aW1vcyddCgkJLCdkYXknOidkw61hJwoJCSwnZGF5cyc6Wydkw61hcycsJ2TDrWFzJ10KCQksJ3dlZWsnOidTZW1hbmEnCgkJLCd3ZWVrcyc6WydzZW1hbmFzJywnc2VtYW5hcyddCgkJLCdtb250aCc6J21lcycKCQksJ21vbnRocyc6WydtZXNlcycsJ21lc2VzJ10KCQksJ3llYXInOidhw7FvJwoJCSwneWVhcnMnOlsnYcOxb3MnLCdhw7FvcyddCgkJLCdob3VyJzonaG9yYScKCQksJ2hvdXJzJzpbJ2hvcmFzJywnaG9yYXMnXQoJCSwnU2V0dGluZ3MnOidBanVzdGVzJwoJCSwnb2YgdXNlcnNjcmlwdCc6J2RlIHVzZXJzY3JpcHQnCgkJLCdyZWxvYWQgcGFnZSBmb3IgZWZmZWN0JzoncMOhZ2luYSBwYXJhIGVmZWN0byBkZSByZWNhcmdhcicKCQksJ0ludGVyZmFjZSBsYW5ndWFnZSc6J0lkaW9tYSBkZSBpbnRlcmZheicKCQksJ0xlc3MgcG9zaXRpb25zIGF0IHRoZSBlbmQgb2Ygc2VsZWN0cyc6J01lbm9zIGVsZWNjacOzbiBlbiBsaXN0YXMgbGFyZ2FzJwoJCSwnU2l0ZXMnOidTaXRpb3MnCgl9fTsgLy9pZiAhbGFuZywgdGhlbiBubyBoaW50cwphZGRSdWxlcygnLmhwIC5zZnNiYywuc2ZzYmN7ZGlzcGxheTogaW5saW5lLWJsb2NrfS5zaXRlTGlzdDpob3ZlciBidXR0b257ZGlzcGxheTogYmxvY2t9JwoJKycuZ2JfSWIgPi5nYl9le2hlaWdodDo0N3B4fS5nYl9GYnt6LWluZGV4OjEwODd9LnRzZi1we3otaW5kZXg6MjAzfScKCSsnLmxzYmIgLnhCdXR0LC5sc2JiID4uc2l0ZUxpc3R7ei1pbmRleDogMjAwMjsgd2lkdGg6MzRweDsgaGVpZ2h0OjE3cHg7IHBhZGRpbmc6MCAycHg7IGxpbmUtaGVpZ2h0OjE0cHg7JwoJCSsnZm9udC1zaXplOjE0cHg7IGJvcmRlcjoxcHggc29saWQgdHJhbnNwYXJlbnQ7IGJhY2tncm91bmQtY29sb3I6IzQ4ODlmMTsgY29sb3I6I2ZmZjsgb3BhY2l0eTogMC42NH0nCgkrJy5sc2JiID4uc2l0ZUxpc3R7d2lkdGg6MzJweDsgaGVpZ2h0OmF1dG87IHBhZGRpbmc6MXB4IDAgMnB4OyB0ZXh0LWFsaWduOmNlbnRlcn0nCgkrJy5sc2JiID4uc2l0ZUxpc3QgLmxzYntmb250LXdlaWdodDogbm9ybWFsOyBjb2xvcjojZDRkNGQ0fS5sc2JiIC5sc2I6aG92ZXJ7b3BhY2l0eTogMTsgY29sb3I6I2ZmZn0nCgkrJy5zaXRlTGlzdCAuc2V0dCAudHh0e3BhZGRpbmc6IDAgMnB4fScKCSsnLnNpdGVMaXN0IC5zZXR0SW57ZGlzcGxheTogbm9uZTsgd2lkdGg6IDI1MHB4OyBwYWRkaW5nOiAycHggNHB4OyB0ZXh0LWFsaWduOmxlZnQ7IGJvcmRlcjoxcHggc29saWQgIzQ4ZjsnCgkJKydiYWNrZ3JvdW5kLWNvbG9yOiNlZWY7IGNvbG9yOiMzMzZ9JwoJKycuc2l0ZUxpc3QgLnNldHRJbiBocnttYXJnaW46MnB4IDB9JwoJKycuc2JpYnRkIC5zZnNiYyAubm9qc2IsIC5zaXRlTGlzdCAuc2V0dDpob3ZlciAuc2V0dEluLCAuc2l0ZUxpc3QgLnNldHRJbi5jaGFuZ2VkLCcKCQkrJy5zaXRlTGlzdCAuc2V0dEluLmNoYW5nZWQgLnJlbG9hZHtkaXNwbGF5OiBibG9ja30uc2l0ZUxpc3QgLnNldHRJbiAucmVsb2FkLCAuc2l0ZUxpc3QuaGlkZG57ZGlzcGxheTogbm9uZX0nCgkrJ2Rpdi5nYl9nW2FyaWEtbGFiZWw9InByb21vIl17ZGlzcGxheTogbm9uZX0nKTsgLy9oaWRlIHByb21vCnhMb2NTdG9yKHtkbzonZ2V0Jywga2V5OidzZXR0JywgdmFsOnNldHRzLCBjQjogZnVuY3Rpb24ocHJldix1bmRlZil7CglTID0gcHJldiB8fCBzZXR0czsKCVMuZHdteWggPSBTLmR3bXloIHx8IHNldHRzLmR3bXloOyAvL3RlbXAuIHRyYW5zaXRpb25hbCBleHByLgoJY29uc29sZS50aW1lU3RhbXAgPSBmdW5jdGlvbigpe307CgpuZXcgVG91dCh7dDoxMjAsIGk6OCwgbTogMS42CgksY2hlY2s6IGZ1bmN0aW9uKCl7CgkJcmV0dXJuIGQgJiYgZC5nZXRFbGVtZW50c0J5TmFtZSgncScpICYmIGQuZ2V0RWxlbWVudHNCeU5hbWUoJ3EnKVswXTsKCX0sCglvY2N1cjogZnVuY3Rpb24oKXsKCQl2YXIgbGFuZyA9IFMubGFuZyAhPSBudWxsICYmIFMubGFuZyB8fCBzZXR0cy5sYW5nCgkJCSxzaXRlcyA9IFMuc2l0ZXMgJiYgKFMuc2l0ZXMubGVuZ3RoICYmIFMuc2l0ZXNbMF0gfHwgUy5zaXRlcy5sZW5ndGggPjEpICYmIFMuc2l0ZXMKCQkJCXx8IHR5cGVvZiBzaXRlcyA9PSdzdHJpbmcnJiYgW3NpdGVzXSB8fCAhUy5zaXRlcyAmJiBzZXR0cy5zaXRlcyB8fCBudWxsOwoJCXZhciBzdHJTaXRlcyA9IHNpdGVzICYmIHNpdGVzLmpvaW4oJ1xuJykucmVwbGFjZSgvXlxuLywnXG5cbicpIHx8JycKCQkJLCRMID0gJGxbbGFuZ10gfHwgJGwucnU7IC8vZGVmYXVsdCB0ZW1wbGF0ZSBvZiBsYW5nCgkJaWYoIWxhbmcgfHwgISRsW2xhbmddIHx8IGxhbmcgPT0nZW4nKSBmb3IodmFyIGwgaW4gJEwpeyAvL3JlcGxhY2UgJ2VuJyBsYW5nIGZvciBkZWZhdWx0IG9yIHN1YnN0aXR1dGlvbgoJCQlpZigkTFtsXSBpbnN0YW5jZW9mIEFycmF5KSBmb3IodmFyIGwyIGluICRMW2xdKQoJCQkJJExbbF1bbDJdID0gbDsKCQkJZWxzZQoJCQkJJExbbF0gPSBsOwoJCX0KCQl2YXIgJExTZXR0aW5ncyA9ICRMWydTZXR0aW5ncyddOwoJCWlmKHNpdGVzICYmIHNpdGVzLmxlbmd0aCkKCQkJc2l0ZXMucHVzaCgkTFNldHRpbmdzKQoJCXZhciBtYWluUGcgPSAvXC9zZWFyY2hcPy8udGVzdChsaCkKCQkJLGlucHV0U2VhcmNoID0gdGhpcy5kYXQKCQkJLGJ1dHRTZWFyY2ggPSBkLmdldEVsZW1lbnRzQnlOYW1lKCJidG5HIikgJiYgZC5nZXRFbGVtZW50c0J5TmFtZSgnYnRuRycpWzBdCgkJCSxidXR0UyA9ewoJCQkJUERGOnt1cmw6J2ZpbGV0eXBlOnBkZicsIHR4dDokTFsnc2VhcmNoIGluIFBERiBmaWxlcyddfQoJCQkJLHNpdGU6e3VybDonc2l0ZTonKyBTLnNpdGVzWzBdLCB0eHQ6JExbJ3NlYXJjaCBpbiddKycgJysgUy5zaXRlc1swXSwgb25lOidkYXknfSAvL3lvdSBtYXkgY29tbWVudCB0aGlzIGxpbmUKCQkJCSwnLi4gOiAuLic6e3VybDonJywgdHh0OiRMWydmcm9tIC8gdG8nXX0KCQkJCSwnMUQnOnt1cmw6JyZ0YnM9cWRyOmQnLCB0eHQ6JExbJ2xhc3QnXVsxXSArJyAnKyAkTFsnZGF5J10sIG9uZTonZGF5JywgdXA6MTMsbGV0dDonRCd9CgkJCQksJzFXJzp7dXJsOicmdGJzPXFkcjp3JywgdHh0OiRMWydsYXN0J11bMl0gKycgJysgJExbJ3dlZWsnXSwgb25lOid3ZWVrJywgdXA6MTQsbGV0dDonVyd9CgkJCQksJzFNJzp7dXJsOicmdGJzPXFkcjptJywgdHh0OiRMWydsYXN0J11bMF0gKycgJysgJExbJ21vbnRoJ10sIG9uZTonbW9udGgnLCB1cDoyMCxsZXR0OidNJ30KCQkJCSwnMVknOnt1cmw6JyZ0YnM9cWRyOnknLCB0eHQ6JExbJ2xhc3QnXVswXSArJyAnKyAkTFsneWVhciddLCBvbmU6J3llYXInLCB1cDoxMCxsZXR0OidZJ30KCQkJCSwnMUgnOnt1cmw6JyZ0YnM9cWRyOmgnLCB0eHQ6JExbJ2xhc3QnXVswXSArJyAnKyAkTFsnaG91ciddLCBvbmU6J2hvdXInLCB1cDoyMyxsZXR0OidIJ30KCQkJCSxET0M6e3VybDonZmlsZXR5cGU6ZG9jJywgdHh0OiRMWydzZWFyY2ggaW4gUERGIGZpbGVzJ10ucmVwbGFjZSgvUERGLywnRE9DJyl9CgkJfSwgaWkgPSAwLCBpRCA9IC0xOwoJCSFzaXRlcyAmJiBkZWxldGUgYnV0dFMuc2l0ZTsKCQlidXR0U2VhcmNoLnBhcmVudE5vZGUuc3R5bGUucG9zaXRpb24gPSdyZWxhdGl2ZSc7CgkJaWYoYnV0dFNlYXJjaCAmJiB0b3AgPT0gc2VsZikgZm9yKHZhciBpIGluIGJ1dHRTKSBpZihpICE9J3NpdGUnfHwgUy5zaXRlcyl7IC8vYnV0dG9ucyB1bmRlciBzZWFyY2ggaW5wdXQgbGluZQoJCQlpZihpLmxlbmd0aCA9PTIpIGlEKys7IGVsc2UgaUQ9LTE7CgkJCXZhciBiSSA9IGJ1dHRTW2ldCgkJCQksR2VzY2ggPSAoe206J2xldHp0ZXInLGY6J2xldHp0ZScsbjonbGV0enRlcyd9KVsnbSxmLG0sbixmJy5zcGxpdCgnLCcpW2lEXV0KCQkJCSxoaW50ID0gZnVuY3Rpb24oail7cmV0dXJuIChqKzEpICsnICcrIChqICUgMTAgfHwgaj09MTAgPyAkTFtiSS5vbmUgKydzJ11baiAlIDEwIDw0ICYmIChqLzEwfDApIT0xID8wOjFdIDogJExbYkkub25lXSkgfQoJCQkJLGJ1dHQyID0gJGUoe2Nsb25lOiBpID09J3NpdGUnfHwgaS5sZW5ndGggPT0yCgkJCQkJCT8gJGUoe2NsOiAnc2l0ZUxpc3QnLCBjczoge2N1cnNvcjonZGVmYXVsdCd9LCBhdDoge3NpdGU6IFMuc2l0ZXNbMF0sIGRhdGU6IGJJLnVybH0gfSkKCQkJCQkJOiBpICE9Jy4uIDogLi4nfHwgbWFpblBnID8gYnV0dFNlYXJjaCA6ICRlKHtjbDogJ3NpdGVMaXN0IGhpZGRuJ30pCgkJCQkJLGNsQWRkOid4QnV0dCcKCQkJCQksYXRSZW1vdmU6IFsnaWQnLCAnbmFtZSddCgkJCQkJLGF0OiB7dmFsdWU6IGlEICE9LTEgJiYgUy5kd215aFtpRF0gIT0xID8gUy5kd215aFtpRF0gKyBiSS5sZXR0IDogaQoJCQkJCQksaW5uZXJIVE1MOiAnPHNwYW4gY2xhc3M9dHh0IG9uY2xpY2s9dGhpcy5wYXJlbnROb2RlLmNsaWNrKCk7cmV0dXJuITEgdGl0bGU9IicgKyhsYW5nIHx8IGk9PSdzaXRlJ3x8IGk9PScuLiA6IC4uJwoJCQkJCQkJCT8gKGlEPT0tMSB8fCBTLmR3bXloW2lEXT09MSA/IGJJLnR4dCA6ICRMWydsYXN0J11bMV0gKycgJysgaGludChTLmR3bXloW2lEXS0xKSkucmVwbGFjZSgvbGV0enRlLyxHZXNjaCkgOicnKSsnIj4nCgkJCQkJCQkrKGlEICE9LTEgJiYgUy5kd215aFtpRF0gIT0xID8gUy5kd215aFtpRF0gKyBiSS5sZXR0IDogaSkgKyc8L3NwYW4+J30KCQkJCQksY3M6IHtwb3NpdGlvbjogJ2Fic29sdXRlJywgdG9wOiAnMzNweCcsIGxlZnQ6ICgtMTI3ICsgMzcgKiAoaWkrKyAtIChpaSA+MiAmJiAhbWFpblBnKSkpICsncHgnfQoJCQkJCSxvbjoge2NsaWNrOiAoZnVuY3Rpb24oYkksIGksIGlEKXsKCQkJCQkJcmV0dXJuIC9QREZ8RE9DfHNpdGUvLnRlc3QoaSkKCQkJCQkJCT8gZnVuY3Rpb24oZXYpewoJCQkJCQkJCXZhciBkb2MsIHQgPSBldi50YXJnZXQ7CgkJCQkJCQkJaWYodC5jbGFzc05hbWUgPT0nZGVmYScpCgkJCQkJCQkJCXNhdmVMb2NTdG9yKCcnLCcnLCdyZW1vdmUnKTsgJHBkKGV2KTsKCQkJCQkJCQlpZigoKHQuZ2V0QXR0cmlidXRlKCdzaXRlJykgPT1udWxsICYmIHQucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ3NpdGUnKSA9PW51bGwpCgkJCQkJCQkJCXx8IHQuZ2V0QXR0cmlidXRlKCdzaXRlJyk9PSRMU2V0dGluZ3MgfHwgdC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnc2l0ZScpPT0kTFNldHRpbmdzKQoJCQkJCQkJCQkJJiYgIS9QREZ8RE9DLy50ZXN0KHQuZ2V0QXR0cmlidXRlKCd2YWx1ZScpKSkgcmV0dXJuOwoJCQkJCQkJCS8vY29uc29sZS5sb2coJ2NsaWM6JyxpLGJJLGV2LCB0LmNsYXNzTmFtZSwgaW5wdXRTZWFyY2gudmFsdWUsIHRoaXMuZm9ybSkKCQkJCQkJCQlpbnB1dFNlYXJjaC52YWx1ZSA9IGlucHV0U2VhcmNoLnZhbHVlLnJlcGxhY2UoLyBzaXRlXDpbXHcuXSokL2lnLCAnJykKCQkJCQkJCQkJLnJlcGxhY2UoLyggfFwrfCZhc18pZmlsZXR5cGUoOnwlM0EpW15cJl0qL2csJycpICsnICcrICgvUERGfERPQy8udGVzdChpKSA/IGJJLnVybAoJCQkJCQkJCQkJOiAnc2l0ZTonKyAodC5nZXRBdHRyaWJ1dGUoJ3NpdGUnKXx8IHQucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ3NpdGUnKXx8JycpKTsKCQkJCQkJCWlmKC94QnV0dHx0eHQvLnRlc3QodC5jbGFzc05hbWUpICYmICEoaT09J3NpdGUnICYmICEoL2xpc3QvLnRlc3QodC5wYXJlbnROb2RlLmNsYXNzTmFtZSkgfHwgL2xpc3QvLnRlc3QodC5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NOYW1lKSkpKSBidXR0U2VhcmNoLmNsaWNrKCk7CgkJCQkJCQl9OiAhYkkudXJsID8gZnVuY3Rpb24oZXYpeyAvL2Zyb20tdG8gZGF0ZQoJCQkJCQkJCXZhciBlbCA9ICRxKCcjY2RybG5rJyksIG87CgkJCQkJCQkJZWwgJiYgZWwuZGlzcGF0Y2hFdmVudCgoKG8gPSBkLmNyZWF0ZUV2ZW50KCdFdmVudHMnKSkuaW5pdEV2ZW50KCdjbGljaycsICEwLCAhMSksIG8pKTsKCQkJCQkJCQkkcGQoZXYpOwoJCQkJCQkJfTogZnVuY3Rpb24oZXYpeyAvL2xhc3QgaW50ZXJ2YWwKCQkJCQkJCQlsb2NhdGlvbi5ocmVmID0gJy9zZWFyY2g/cT0nKyBlbmNvZGVVUklDb21wb25lbnQoaW5wdXRTZWFyY2gudmFsdWUpCgkJCQkJCQkJCSsoKGV2LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGUnKXx8ZXYudGFyZ2V0LnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRlJykpCgkJCQkJCQkJCQkrIChldi50YXJnZXQuZ2V0QXR0cmlidXRlKCd2YWx1ZScpfHxldi50YXJnZXQucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJykpLnJlcGxhY2UoL1xEL2csJycpIHx8IGJJLnVybCkKCQkJCQkJCQkJKygvWyY/XXRibT0vLnRlc3QobGgpID8gJyYnKy90Ym09W14mXSovLmV4ZWMobGgpWzBdOicnKTsgLy9zYXZpbmcgdHlwZSBvZiBwYWdlCgkJCQkJCQkJUy5kd215aFtpRF0gPSArKGV2LnRhcmdldC5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJyl8fGV2LnRhcmdldC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgndmFsdWUnKSkucmVwbGFjZSgvXEQvZywnJyk7CgkJCQkJCQkJJHBkKGV2KTsKCQkJCQkJCQlldi5zdG9wUHJvcGFnYXRpb24oKTsKCQkJCQkJCQlzYXZlTG9jU3RvcigpOwoJCQkJCQkJfQoJCQkJCQl9KShiSSwgaSwgaUQpLAoJCQkJCQltb3VzZW92ZXI6IGkgPT0nc2l0ZScgfHwgaS5sZW5ndGggPT0yID8gKGZ1bmN0aW9uKGJJLGkpe3JldHVybiBmdW5jdGlvbihldil7CgkJCQkJCQljbGVhclRpbWVvdXQoYkkud3cpOwoJCQkJCQkJJHEoJy5saXN0JywgZXYuY3VycmVudFRhcmdldCkuc3R5bGUuZGlzcGxheSA9J2Jsb2NrJzsKCQkJCQkJfX0pKGJJLGkpIDonJywKCQkJCQkJbW91c2VvdXQ6IGkgPT0nc2l0ZScgfHwgaS5sZW5ndGggPT0yID8gKGZ1bmN0aW9uKGJJLGkpe3JldHVybiBmdW5jdGlvbihldil7CgkJCQkJCQl2YXIgdCA9IGV2LmN1cnJlbnRUYXJnZXQ7CgkJCQkJCQljbGVhclRpbWVvdXQoYkkud3cpOwoJCQkJCQkJYkkud3cgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CgkJCQkJCQkJJHEoJy5saXN0Jyx0KS5zdHlsZS5kaXNwbGF5ID0nbm9uZSc7CgkJCQkJCQl9LCA0NTApOwoJCQkJCQl9fSkoYkksaSkgOicnLAoJCQkJCQljaGFuZ2U6IHNhdmVMb2NTdG9yCgkJCQkJfQoJCQkJCSxhcFQ6IGJ1dHRTZWFyY2gucGFyZW50Tm9kZQoJCQkJfSk7CgkJCWJJLmVsID0gYnV0dDI7CgkJCWlmKGkgPT0nc2l0ZScgfHwgaS5sZW5ndGggPT0yKXsgLy9kcm9wZG93biBsaXN0cyB1bmRlciBzb21lIGJ1dHRvbnMKCQkJCXZhciBzaXRlTGlzdCA9ICRlKHtjbDonbGlzdCcsY3M6e2Rpc3BsYXk6J25vbmUnfSwgYXBUOiBidXR0Mn0pLCBhcnIgPVtdOwoJCQkJZm9yKHZhciBqID0wOyBqIDw9IGJJLnVwIC0xIC0oaT09JzFXJyYmIFMubGFzdEhvdXJzTGVzcyA/NDowKSAtKGk9PScxTScmJiBTLmxhc3RIb3Vyc0xlc3MgPzk6MCk7IGorKykKCQkJCQkJaWYoaSAhPScxSCcgfHwgIVMubGFzdEhvdXJzTGVzcyB8fCBqIDwgOCB8fCBqICUgMiApCgkJCQkJYXJyLnB1c2goaGludChqKSk7CgkJCQkvL2NvbnNvbGUubG9nKFMuc2l0ZXMsaSwgUy5kd215aCk7CgkJCQl2YXIgbGlzdCA9IGkgPT0gJ3NpdGUnID8gc2l0ZXN8fFtdIDogaSA9PScxRCcmJiAhc2l0ZXMgPyBhcnIuY29uY2F0KFskTFNldHRpbmdzXSkgOiBhcnI7CgkJCQlmb3IodmFyIGogaW4gbGlzdCkgaWYoaiAhPTAgfHwgaUQhPS0xICYmIFMuZHdteWhbaURdICE9MSkKCQkJCQl2YXIgc0kgPSBsaXN0W2pdCgkJCQkJCSxidXR0MyA9ICRlKHtjbG9uZTogc0k9PSRMU2V0dGluZ3MKCQkJCQkJCQk/ICRlKHtjbDogJ3NldHQgbHNiJ30pCgkJCQkJCQkJOiBidXR0U2VhcmNoCgkJCQkJCQksY2xBZGQ6J3hCdXR0JwoJCQkJCQkJLGF0UmVtb3ZlOlsnaWQnLCduYW1lJ10KCQkJCQkJCSxhdDp7dmFsdWU6IHNJCgkJCQkJCQkJLHNpdGU6IHNJCgkJCQkJCQkJLGRhdGU6IGJJLnVybAoJCQkJCQkJCSx0aXRsZTogc0k9PSRMU2V0dGluZ3MgfHwgIWxhbmcgPycnOihpID09J3NpdGUnID8gJExbJ3NlYXJjaCBpbiddICsnICcrIHNJCgkJCQkJCQkJCTogaj09MCA/IGJJLnR4dCA6ICRMWydsYXN0J11bMV0gKycgJysgc0kpLnJlcGxhY2UoL2xldHp0ZS8sR2VzY2gpCgkJCQkJCQkJLGlubmVySFRNTDonPHNwYW4gY2xhc3M9dHh0PicrIHNJICsnPC9zcGFuPicrIChzSSAhPSAkTFNldHRpbmdzICYmISghUy5zaXRlcyAmJiBpID09JzFIJykKCQkJCQkJCQkJPycnOic8ZGl2IGNsYXNzPSJzZXR0SW4iPicKCQkJCQkJCQkJCSskTC5TZXR0aW5ncyArJyAnKyAkTFsnb2YgdXNlcnNjcmlwdCddICsnPGJyPiJHb29nbGUgU2VhcmNoIEV4dHJhIEJ1dHRvbnMiPGhyPicKCQkJCQkJCQkJCSskTFsnSW50ZXJmYWNlIGxhbmd1YWdlJ10gKyc6IDxzZWxlY3QgY2xhc3M9ImxhbmciIHN0eWxlPSJ3aWR0aDo3MHB4Ij4nCgkJCQkJCQkJCQkrKGZ1bmN0aW9uKCl7dmFyIHM9JzxvcHRpb24nKyAobGFuZz09J2VuJz8nIHNlbGVjdGVkJzonJykgKyc+ZW48L29wdGlvbj4nOwoJCQkJCQkJCQkJCWZvcih2YXIgaSBpbiAkbCkKCQkJCQkJCQkJCQkJcys9JzxvcHRpb24nKyAobGFuZz09aSA/JyBzZWxlY3RlZCc6JycpICsnPicrIGkgKyc8L29wdGlvbj4nOwoJCQkJCQkJCQkJCXJldHVybiBzICsnPG9wdGlvbiB2YWx1ZT0iIicrIChsYW5nPT0nJz8nIHNlbGVjdGVkJzonJykgKyc+ZW4gdy9vIGhpbnRzPC9vcHRpb24+J30pKCkKCQkJCQkJCQkJCSsnPC9zZWxlY3Q+PGJyPicKCQkJCQkJCQkJCSsnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjbGFzcz0ibGVzcyIgaWQ9ImhvdXJzTGVzcyInKyAoUy5sYXN0SG91cnNMZXNzID8nIGNoZWNrZWQnOicnKSArJy8+JwoJCQkJCQkJCQkJCSsnPGxhYmVsIGZvcj0iaG91cnNMZXNzIiBpZD0iaG91cnNMZXNzTCI+JysgJExbJ0xlc3MgcG9zaXRpb25zIGF0IHRoZSBlbmQgb2Ygc2VsZWN0cyddICsnPC9sYWJlbD48YnI+JwoJCQkJCQkJCQkJKyc8aT48YSBocmVmPSIjIiBjbGFzcz0iZGVmYSIgc3R5bGU9ImZsb2F0OiByaWdodCI+RGVmYXVsdCBzZXR0aW5nczwvYT48L2k+JwoJCQkJCQkJCQkJKyRMLlNpdGVzICsnOiA8YnI+PHRleHRhcmVhIGNsYXNzPSJzaXRlcyIgc3R5bGU9IndpZHRoOjk3JSIgcm93cz04PicKCQkJCQkJCQkJCQkrIHN0clNpdGVzICsnPC90ZXh0YXJlYT48YnI+JwoJCQkJCQkJCQkJKyc8YSBjbGFzcz0icmVsb2FkIiBocmVmPSMgb25jbGljaz0ibG9jYXRpb24ucmVsb2FkKCk7cmV0dXJuITEiPicKCQkJCQkJCQkJCQkrICRMWydyZWxvYWQgcGFnZSBmb3IgZWZmZWN0J10gKyc8L2E+JwoJCQkJCQkJCQkrJzwvZGl2PicpfQoJCQkJCQkJLGNzOiB7cG9zaXRpb246IHNJICE9ICRMU2V0dGluZ3MgPydzdGF0aWMnOidhYnNvbHV0ZScsZGlzcGxheTonYmxvY2snLCB3aWR0aDonYXV0bycsIGhlaWdodDogc0kgIT0gJExTZXR0aW5ncyA/JzE4cHgnOicxNnB4JwoJCQkJCQkJCSxtYXJnaW46JzJweCAwIC0xcHggLTEzcHgnLCBwYWRkaW5nOjAsIHRleHRBbGlnbjonbGVmdCcsIGZvbnRXZWlnaHQ6J25vcm1hbCcsIG9wYWNpdHk6MX0KCQkJCQkJCSxvbjp7Y2xpY2s6IGZ1bmN0aW9uKGV2KXsKCQkJCQkJCQkvL2NvbnNvbGUubG9nKCdjMycsZXYudGFyZ2V0Lm91dGVySFRNTCk7CgkJCQkJCQkJdmFyIGNoayA9ICRxKCcjaG91cnNMZXNzJyk7CgkJCQkJCQkJaWYoY2hrICYmIC9ob3Vyc0xlc3MvLnRlc3QoZXYudGFyZ2V0LmlkKSl7CgkJCQkJCQkJCWNoay5vdXRlckhUTUwgPSAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjbGFzcz0ibGVzcyIgaWQ9ImhvdXJzTGVzcyInCgkJCQkJCQkJCQkJKyhjaGsuZ2V0QXR0cmlidXRlKCdjaGVja2VkJykhPW51bGwgPycnOicgY2hlY2tlZD0iY2hlY2tlZCInKSsnPic7CgkJCQkJCQkJCXNhdmVMb2NTdG9yKCk7CgkJCQkJCQkJfQoJCQkJCQkJCSRwZChldik7fX0KCQkJCQkJCSxhcFQ6IHNpdGVMaXN0CgkJCQkJCX0pOwoJCQkJc2l0ZUxpc3Quc3R5bGUuaGVpZ2h0ID0nYXV0byc7IHNpdGVMaXN0LnN0eWxlLnRleHRBbGlnbiA9J2NlbnRlcic7CgkJCX0KCQl9Cgl9Cn0pOwoKfSwgZWw6IGQuYm9keX0pOwoJdmFyIHNhdmVMb2NTdG9yID0gZnVuY3Rpb24oZXYsIHZhbCwgZG8yKXsgdmFyIGFhYSxhYWIsYWFjLCB0ID0gZXYgJiYgZXYudGFyZ2V0LmZvcm0gfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IHx8IGRvY3VtZW50LmJvZHk7CgkJeExvY1N0b3Ioe2RvOiBkbzIgfHwnc2V0Jywga2V5OidzZXR0JwoJCQksIHZhbDp7bGFuZzogKGFhYT1kLnF1ZXJ5U2VsZWN0b3JBbGwoJy5sYW5nJywgdCkpW2FhYS5sZW5ndGgtMV0udmFsdWUKCQkJCSxzaXRlczogKGFhYj1kLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaXRlcycsIHQpKVthYWIubGVuZ3RoLTFdLnZhbHVlLnJlcGxhY2UoL15bIFx0XSp8WyBcblx0XSokL2csJycpCgkJCQkJCS5zcGxpdCgnXG4nKQoJCQkJLGxhc3RIb3Vyc0xlc3M6IChhYWM9ZC5xdWVyeVNlbGVjdG9yQWxsKCcubGVzcycsIHQpKVthYWMubGVuZ3RoLTFdLmNoZWNrZWQKCQkJCSxkd215aDogUy5kd215aCB8fCBzZXR0cy5kd215aAoJCQl9CgkJCSxjQjogZnVuY3Rpb24ocHJldil7CgkJCQljb25zb2xlLmluZm8oJ1NldHRpbmdzIGFyZSBzYXZlZC4gcHJldj0nLCBwcmV2KTt9CgkJfSk7CgkJJHEoJy5zaXRlTGlzdCAuc2V0dEluJykuY2xhc3NMaXN0LmFkZCgnY2hhbmdlZCcpOwoJfTsKCn0pKHsgLy93cml0ZSAibGFuZzonJywiIHRvIHJlbW92ZSBoaW50czsgJ2VuJyBmb3IgRW5nbGlzaCBoaW50cyAoZnIgLSBGcmFuw6dhaXMsIGVzIC0gZXNwYWdub2wpLCAncnUnIGZvciBSdXNzaWFuCglsYW5nOicnfHwgKG5hdmlnYXRvci5sYW5ndWFnZXMgJiYgbmF2aWdhdG9yLmxhbmd1YWdlc1sxXSB8fCBuYXZpZ2F0b3IubGFuZ3VhZ2Uuc3Vic3RyKDAsMikpIC8vPScnIGlmIGhpZGUgaGludHMsIG9yIDIgbGV0dGVycyBmcm9tICRse30KCSxzaXRlczogWyAvLz1hcnJheSBvciBvbmUgc2l0ZSBpbiBzdHJpbmcKCQknJywnc2xhc2hkb3Qub3JnJywncmVkZGl0LmNvbScsJ3RlY2hjcnVuY2guY29tJywnaGFicmFoYWJyLnJ1JywnZ2Vla3RpbWVzLnJ1JwoJCSwnc21hc2hpbmdtYWdhemluZS5jb20nLCdlbmdhZGdldC5jb20nXSAvL3dyaXRlIHlvdXIgZmF2b3JpdGUgc2l0ZXMKCSxsYXN0SG91cnNMZXNzOiAxIC8vPWJvb2xlYW4gLSBub3Qgc2hvdyBvZGQgc29tZSB2YWx1ZXMgb2YgaG91cnMgYWZ0ZXIgOCBoCgksZHdteWg6IFsxLDEsMSwxLDFdIC8vPWFycmF5IG9mIG51bWJlcnMgLSBjdXJyZW50IHZhbHMgb2YgZGF5cywgd2Vla3MsIG1vbnRocywgeWVhcnMsIGhvdXJzCn0pOwo="},{"name":"Github Image Viewer","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://github.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469597358125,"data":{}},"enabled":true,"position":21,"file_url":"https://github.com/jerone/UserScripts/raw/master/Github_Image_Viewer/Github_Image_Viewer.user.js","uuid":"02502075-cadf-4364-95f7-6b72da62bf20","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgIEdpdGh1Yl9JbWFnZV9WaWV3ZXJAaHR0cHM6Ly9naXRodWIuY29tL2plcm9uZS9Vc2VyU2NyaXB0cwovLyBAbmFtZSAgICAgICAgR2l0aHViIEltYWdlIFZpZXdlcgovLyBAbmFtZXNwYWNlICAgaHR0cHM6Ly9naXRodWIuY29tL2plcm9uZS9Vc2VyU2NyaXB0cwovLyBAZGVzY3JpcHRpb24gUHJldmlldyBpbWFnZXMgZnJvbSB3aXRoaW4gdGhlIGxpc3RpbmcuCi8vIEBhdXRob3IgICAgICBqZXJvbmUKLy8gQGNvcHlyaWdodCAgIDIwMTQrLCBqZXJvbmUgKGh0dHA6Ly9qZXJvZW52YW53YXJtZXJkYW0ubmwpCi8vIEBsaWNlbnNlICAgICBHTlUgR1BMdjMKLy8gQGhvbWVwYWdlICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9qZXJvbmUvVXNlclNjcmlwdHMvdHJlZS9tYXN0ZXIvR2l0aHViX0ltYWdlX1ZpZXdlcgovLyBAaG9tZXBhZ2VVUkwgaHR0cHM6Ly9naXRodWIuY29tL2plcm9uZS9Vc2VyU2NyaXB0cy90cmVlL21hc3Rlci9HaXRodWJfSW1hZ2VfVmlld2VyCi8vIEBkb3dubG9hZFVSTCBodHRwczovL2dpdGh1Yi5jb20vamVyb25lL1VzZXJTY3JpcHRzL3Jhdy9tYXN0ZXIvR2l0aHViX0ltYWdlX1ZpZXdlci9HaXRodWJfSW1hZ2VfVmlld2VyLnVzZXIuanMKLy8gQHVwZGF0ZVVSTCAgIGh0dHBzOi8vZ2l0aHViLmNvbS9qZXJvbmUvVXNlclNjcmlwdHMvcmF3L21hc3Rlci9HaXRodWJfSW1hZ2VfVmlld2VyL0dpdGh1Yl9JbWFnZV9WaWV3ZXIudXNlci5qcwovLyBAc3VwcG9ydFVSTCAgaHR0cHM6Ly9naXRodWIuY29tL2plcm9uZS9Vc2VyU2NyaXB0cy9pc3N1ZXMKLy8gQGNvbnRyaWJ1dGlvblVSTCBodHRwczovL3d3dy5wYXlwYWwuY29tL2NnaS1iaW4vd2Vic2NyP2NtZD1fcy14Y2xpY2smaG9zdGVkX2J1dHRvbl9pZD1WQ1lNSFdRN1pNQktXCi8vIEB2ZXJzaW9uICAgICAwLjQuMAovLyBAZ3JhbnQgICAgICAgbm9uZQovLyBAcnVuLWF0ICAgICAgZG9jdW1lbnQtZW5kCi8vIEBpbmNsdWRlICAgICBodHRwczovL2dpdGh1Yi5jb20vKgovLyA9PS9Vc2VyU2NyaXB0PT0KCihmdW5jdGlvbigpIHsKCglTdHJpbmcuZm9ybWF0ID0gZnVuY3Rpb24oc3RyaW5nKSB7CgkJdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEsIGFyZ3VtZW50cy5sZW5ndGgpOwoJCXJldHVybiBzdHJpbmcucmVwbGFjZSgveyhcZCspfS9nLCBmdW5jdGlvbihtYXRjaCwgbnVtYmVyKSB7CgkJCXJldHVybiB0eXBlb2YgYXJnc1tudW1iZXJdICE9PSAidW5kZWZpbmVkIiA/IGFyZ3NbbnVtYmVyXSA6IG1hdGNoOwoJCX0pOwoJfTsKCglmdW5jdGlvbiBwcm94eShmbikgewoJCXJldHVybiBmdW5jdGlvbigpIHsKCQkJdmFyIHRoYXQgPSB0aGlzOwoJCQlyZXR1cm4gZnVuY3Rpb24oZSkgewoJCQkJdmFyIGFyZ3MgPSB0aGF0LnNsaWNlKDApOyAgLy8gY2xvbmU7CgkJCQlhcmdzLnVuc2hpZnQoZSk7ICAvLyBwcmVwZW5kIGV2ZW50OwoJCQkJZm4uYXBwbHkodGhpcywgYXJncyk7CgkJCX07CgkJfS5jYWxsKFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7Cgl9CgoJdmFyIEdpdGh1YkltYWdlVmlld2VyID0gewoJCV9mbG9hdGVyOiBudWxsLAoJCV9mbG9hdGVyVGl0bGU6IG51bGwsCgkJX2Zsb2F0ZXJJbWFnZTogbnVsbCwKCQlfZmxvYXRlck1ldGE6IG51bGwsCgoJCV9pbWFnZVVybDogbnVsbCwKCQlfbG9hZGVyU3JjOiAiaHR0cHM6Ly9hc3NldHMtY2RuLmdpdGh1Yi5jb20vaW1hZ2VzL3NwaW5uZXJzL29jdG9jYXQtc3Bpbm5lci0zMi5naWYiLAoJCV9pbWFnZVJlZ2V4OiAvLisoXC5qcGU/Z3xcLnBuZ3xcLmdpZnxcLmJtcHxcLmljb3xcLnRpZmY/KSQvaSwKCgkJSW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7CgkJCXZhciBmbG9hdGVyID0gR2l0aHViSW1hZ2VWaWV3ZXIuX2Zsb2F0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCQkJZmxvYXRlci5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CgkJCWZsb2F0ZXIuc3R5bGUudG9wID0gIjAiOwoJCQlmbG9hdGVyLnN0eWxlLmxlZnQgPSAiMCI7CgkJCWZsb2F0ZXIuc3R5bGUuekluZGV4ID0gIjk5OSI7CgkJCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZmxvYXRlcik7CgoJCQl2YXIgZmxvYXRlck1vdXNlQWxpZ24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCQkJZmxvYXRlck1vdXNlQWxpZ24uc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwoJCQlmbG9hdGVyTW91c2VBbGlnbi5zdHlsZS5ib3R0b20gPSAiNXB4IjsKCQkJZmxvYXRlck1vdXNlQWxpZ24uc3R5bGUubGVmdCA9ICI1cHgiOwoJCQlmbG9hdGVyTW91c2VBbGlnbi5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkICNiN2M3Y2YiOwoJCQlmbG9hdGVyTW91c2VBbGlnbi5zdHlsZS5ib3JkZXJSYWRpdXMgPSAiM3B4IjsKCQkJZmxvYXRlck1vdXNlQWxpZ24uc3R5bGUuZm9udFNpemUgPSAiMTFweCI7CgkJCWZsb2F0ZXIuYXBwZW5kQ2hpbGQoZmxvYXRlck1vdXNlQWxpZ24pOwoKCQkJdmFyIGZsb2F0ZXJUaXRsZSA9IEdpdGh1YkltYWdlVmlld2VyLl9mbG9hdGVyVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCQkJZmxvYXRlclRpdGxlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICIjZTZmMWY2IjsKCQkJZmxvYXRlclRpdGxlLnN0eWxlLmJvcmRlckJvdHRvbSA9ICIxcHggc29saWQgI2Q4ZTZlYyI7CgkJCWZsb2F0ZXJUaXRsZS5zdHlsZS5wYWRkaW5nID0gIjNweCA1cHgiOwoJCQlmbG9hdGVyTW91c2VBbGlnbi5hcHBlbmRDaGlsZChmbG9hdGVyVGl0bGUpOwoKCQkJdmFyIGZsb2F0ZXJDZW50ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCQkJZmxvYXRlckNlbnRlci5zdHlsZS5taW5XaWR0aCA9ICI0MHB4IjsKCQkJZmxvYXRlckNlbnRlci5zdHlsZS5taW5IZWlnaHQgPSAiNDBweCI7CgkJCWZsb2F0ZXJDZW50ZXIuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKCQkJZmxvYXRlckNlbnRlci5zdHlsZS5mbGV4RGlyZWN0aW9uID0gImNvbHVtbiI7CgkJCWZsb2F0ZXJDZW50ZXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIiNmOGY4ZjgiOwoJCQlmbG9hdGVyQ2VudGVyLnN0eWxlLnBhZGRpbmcgPSAiM3B4IjsKCQkJZmxvYXRlck1vdXNlQWxpZ24uYXBwZW5kQ2hpbGQoZmxvYXRlckNlbnRlcik7CgoJCQl2YXIgZmxvYXRlckltYWdlID0gR2l0aHViSW1hZ2VWaWV3ZXIuX2Zsb2F0ZXJJbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwoJCQlmbG9hdGVySW1hZ2Uuc2V0QXR0cmlidXRlKCJzcmMiLCBHaXRodWJJbWFnZVZpZXdlci5fbG9hZGVyU3JjKTsKCQkJZmxvYXRlckltYWdlLnN0eWxlLm1hcmdpbiA9ICJhdXRvIjsKCQkJZmxvYXRlckltYWdlLnN0eWxlLm1heFdpZHRoID0gZmxvYXRlckltYWdlLnN0eWxlLm1heEhlaWdodCA9ICIyMDBweCI7CgkJCWZsb2F0ZXJDZW50ZXIuYXBwZW5kQ2hpbGQoZmxvYXRlckltYWdlKTsKCgkJCXZhciBmbG9hdGVyTWV0YSA9IEdpdGh1YkltYWdlVmlld2VyLl9mbG9hdGVyTWV0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoJCQlmbG9hdGVyTWV0YS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAiI2Y4ZjhmOCI7CgkJCWZsb2F0ZXJNZXRhLnN0eWxlLnBhZGRpbmcgPSAiM3B4IjsKCQkJZmxvYXRlck1ldGEuc3R5bGUudGV4dEFsaWduID0gImNlbnRlciI7CgkJCWZsb2F0ZXJNZXRhLnN0eWxlLndoaXRlU3BhY2UgPSAibm93cmFwIjsKCQkJZmxvYXRlck1vdXNlQWxpZ24uYXBwZW5kQ2hpbGQoZmxvYXRlck1ldGEpOwoJCQlHaXRodWJJbWFnZVZpZXdlci5TZXRNZXRhKCk7CgoJCQlHaXRodWJJbWFnZVZpZXdlci5BdHRhY2goKTsKCQl9LAoKCQlBdHRhY2g6IGZ1bmN0aW9uKCkgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgianMtcmVwby1wamF4LWNvbnRhaW5lciIpLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGZ1bmN0aW9uKGUpIHsKCQkJCXZhciB0YXJnZXQgPSBlLnRhcmdldDsKCQkJCWlmICh0YXJnZXQuY2xhc3NMaXN0ICYmIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImpzLWRpcmVjdG9yeS1saW5rIikKCQkJCQkmJiBHaXRodWJJbWFnZVZpZXdlci5faW1hZ2VSZWdleC50ZXN0KHRhcmdldC5ocmVmKSkgewoKCQkJCQlpZiAodGFyZ2V0LmdldEF0dHJpYnV0ZSgidGl0bGUiKSkgewoJCQkJCQl0YXJnZXQuZGF0YXNldC50aXRsZSA9IHRhcmdldC5nZXRBdHRyaWJ1dGUoInRpdGxlIik7CgkJCQkJCXRhcmdldC5yZW1vdmVBdHRyaWJ1dGUoInRpdGxlIik7CgkJCQkJfQoKCQkJCQlpZiAoR2l0aHViSW1hZ2VWaWV3ZXIuX3Zpc2libGUpIHsKCQkJCQkJR2l0aHViSW1hZ2VWaWV3ZXIuU2hvdyhlLnBhZ2VYLCBlLnBhZ2VZKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlHaXRodWJJbWFnZVZpZXdlci5BZGRUaW1lcihwcm94eShmdW5jdGlvbigpIHsKCQkJCQkJCUdpdGh1YkltYWdlVmlld2VyLkNsZWFyVGltZXJzKCk7CgoJCQkJCQkJR2l0aHViSW1hZ2VWaWV3ZXIuU2hvdyhlLnBhZ2VYLCBlLnBhZ2VZKTsKCgkJCQkJCQl2YXIgaHJlZiA9IHRhcmdldC5ocmVmOwoJCQkJCQkJaWYgKEdpdGh1YkltYWdlVmlld2VyLl9pbWFnZVVybCAhPT0gaHJlZikgewoJCQkJCQkJCUdpdGh1YkltYWdlVmlld2VyLl9pbWFnZVVybCA9IGhyZWY7CgkJCQkJCQkJR2l0aHViSW1hZ2VWaWV3ZXIuU2V0SW1hZ2UoR2l0aHViSW1hZ2VWaWV3ZXIuX2ltYWdlVXJsKTsKCgkJCQkJCQkJR2l0aHViSW1hZ2VWaWV3ZXIuU2V0VGl0bGUodGFyZ2V0LmRhdGFzZXQudGl0bGUpOwoJCQkJCQkJfQoJCQkJCQl9KSk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlHaXRodWJJbWFnZVZpZXdlci5EaXNwb3NlKCk7CgkJCQl9CgkJCX0pOwoJCQlkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKSB7CgkJCQlHaXRodWJJbWFnZVZpZXdlci5EaXNwb3NlKCk7CgkJCX0pOwoJCQlkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51IiwgZnVuY3Rpb24oKSB7CgkJCQlHaXRodWJJbWFnZVZpZXdlci5EaXNwb3NlKCk7CgkJCX0pOwoJCQlkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBmdW5jdGlvbihlKSB7CgkJCQlpZiAoZS5rZXlDb2RlID09PSAyNykgewoJCQkJCUdpdGh1YkltYWdlVmlld2VyLkRpc3Bvc2UoKTsKCQkJCX0KCQkJfSk7CgkJfSwKCgkJX3Zpc2libGU6IGZhbHNlLAoJCVNob3c6IGZ1bmN0aW9uKHgsIHkpIHsKCQkJR2l0aHViSW1hZ2VWaWV3ZXIuX3Zpc2libGUgPSB0cnVlOwoJCQlHaXRodWJJbWFnZVZpZXdlci5fZmxvYXRlci5zdHlsZS5sZWZ0ID0geCArICJweCI7CgkJCUdpdGh1YkltYWdlVmlld2VyLl9mbG9hdGVyLnN0eWxlLnRvcCA9IHkgKyAicHgiOwoJCX0sCgkJSGlkZTogZnVuY3Rpb24oKSB7CgkJCUdpdGh1YkltYWdlVmlld2VyLl92aXNpYmxlID0gZmFsc2U7CgkJCUdpdGh1YkltYWdlVmlld2VyLl9mbG9hdGVyLnN0eWxlLmxlZnQgPSAiLTEwMDBweCI7CgkJCUdpdGh1YkltYWdlVmlld2VyLl9mbG9hdGVyLnN0eWxlLnRvcCA9ICItMTAwMHB4IjsKCQl9LAoKCQlEaXNwb3NlOiBmdW5jdGlvbigpIHsKCQkJR2l0aHViSW1hZ2VWaWV3ZXIuQ2xlYXJUaW1lcnMoKTsKCgkJCUdpdGh1YkltYWdlVmlld2VyLkhpZGUoKTsKCgkJCUdpdGh1YkltYWdlVmlld2VyLl9pbWFnZVVybCA9IEdpdGh1YkltYWdlVmlld2VyLl9sb2FkZXJTcmM7CgkJCUdpdGh1YkltYWdlVmlld2VyLlNldEltYWdlKEdpdGh1YkltYWdlVmlld2VyLl9pbWFnZVVybCk7CgoJCQlHaXRodWJJbWFnZVZpZXdlci5TZXRUaXRsZSgiTG9hZGluZy4uLiIpOwoJCX0sCgoJCV90aW1lcnM6IFtdLAoJCV90aW1lb3V0OiA3MDAsCgkJQWRkVGltZXI6IGZ1bmN0aW9uKGZuKSB7CgkJCUdpdGh1YkltYWdlVmlld2VyLl90aW1lcnMucHVzaCh3aW5kb3cuc2V0VGltZW91dChmbiwgR2l0aHViSW1hZ2VWaWV3ZXIuX3RpbWVvdXQpKTsKCQl9LAoJCUNsZWFyVGltZXJzOiBmdW5jdGlvbigpIHsKCQkJQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChHaXRodWJJbWFnZVZpZXdlci5fdGltZXJzLCBmdW5jdGlvbih0aW1lcikgewoJCQkJd2luZG93LmNsZWFyVGltZW91dCh0aW1lcik7CgkJCX0pOwoJCX0sCgoJCVNldFRpdGxlOiBmdW5jdGlvbih0ZXh0KSB7CgkJCUdpdGh1YkltYWdlVmlld2VyLl9mbG9hdGVyVGl0bGUudGV4dENvbnRlbnQgPSB0ZXh0OwoJCX0sCgoJCVNldEltYWdlOiBmdW5jdGlvbihzcmMpIHsKCQkJc3JjID0gc3JjLnJlcGxhY2UoIi9ibG9iLyIsICIvcmF3LyIpOwoJCQlpZiAoc3JjICE9PSBHaXRodWJJbWFnZVZpZXdlci5fbG9hZGVyU3JjKSB7CgkJCQl2YXIgdGVtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwoJCQkJdGVtcC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CgkJCQl0ZW1wLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBmdW5jdGlvbigpIHsKCQkJCQlHaXRodWJJbWFnZVZpZXdlci5TZXRNZXRhKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKCQkJCQl0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGVtcCk7CgkJCQl9KTsKCQkJCXRlbXAuc2V0QXR0cmlidXRlKCJzcmMiLCBzcmMpOwoJCQkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZW1wKTsKCQkJfSBlbHNlIHsKCQkJCUdpdGh1YkltYWdlVmlld2VyLlNldE1ldGEoKTsKCQkJfQoKCQkJR2l0aHViSW1hZ2VWaWV3ZXIuX2Zsb2F0ZXJJbWFnZS5zZXRBdHRyaWJ1dGUoInNyYyIsIHNyYyk7CgkJfSwKCgkJU2V0TWV0YTogZnVuY3Rpb24odywgaCkgewoJCQlpZiAoIXcgJiYgIWgpIHsKCQkJCUdpdGh1YkltYWdlVmlld2VyLl9mbG9hdGVyTWV0YS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoJCQl9IGVsc2UgewoJCQkJR2l0aHViSW1hZ2VWaWV3ZXIuX2Zsb2F0ZXJNZXRhLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoJCQkJR2l0aHViSW1hZ2VWaWV3ZXIuX2Zsb2F0ZXJNZXRhLmlubmVySFRNTCA9IFN0cmluZy5mb3JtYXQoIjxzdHJvbmc+Vzo8L3N0cm9uZz4gezB9cHggfCA8c3Ryb25nPkg6PC9zdHJvbmc+IHsxfXB4IiwgdywgaCk7CgkJCX0KCQl9Cgl9OwoKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgianMtcmVwby1wamF4LWNvbnRhaW5lciIpKSB7CgkJR2l0aHViSW1hZ2VWaWV3ZXIuSW5pdGlhbGl6ZSgpOwoJfQoKfSkoKTsK"},{"name":"GBookDown - Download Google Books","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://books.google.*/books*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469607164379,"data":{}},"enabled":false,"position":22,"file_url":"https://greasyfork.org/scripts/17113-gbookdown-download-google-books/code/GBookDown%20-%20Download%20Google%20Books.user.js","uuid":"e821fb56-7f28-4fc1-b456-03ec242ef654","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBHQm9va0Rvd24gLSBEb3dubG9hZCBHb29nbGUgQm9va3MKLy8gQGRlc2NyaXB0aW9uICBTYXZlcyBhbGwgYXZhaWxhYmxlIFByZXZpZXcgcGFnZXMgZnJvbSBhIEdvb2dsZSBCb29rIGFzIFBOR3MKLy8gQGF1dGhvciAgICAgICBuaWtpc2J5Ci8vIEBuYW1lc3BhY2UgICAgbmlraXNieQovLyBAaW5jbHVkZSAgICAgIGh0dHBzOi8vYm9va3MuZ29vZ2xlLiovYm9va3MqCi8vIEB2ZXJzaW9uICAgICAgMS4xCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzEuMTIuMC9qcXVlcnkubWluLmpzCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvanN6aXAvMi41LjAvanN6aXAubWluLmpzCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvRmlsZVNhdmVyLmpzLzIwMTQtMTEtMjkvRmlsZVNhdmVyLm1pbi5qcwovLyBAZ3JhbnQgICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vID09L1VzZXJTY3JpcHQ9PQoKdGhpcy4kID0gdGhpcy5qUXVlcnkgPSBqUXVlcnkubm9Db25mbGljdCh0cnVlKTsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGNzcyA9IFsKICAgICcjc2F2ZVBORyB7JywKICAgICcgICAgcG9zaXRpb246IGZpeGVkOycsCiAgICAnICAgIHBhZGRpbmc6IDdweDsnLAogICAgJyAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRjhFRUIxOycsCiAgICAnICAgIGJvcmRlcjogMnB4IHNvbGlkICMzMzM7JywKICAgICcgICAgYm9yZGVyLXJhZGl1czogNnB4OycsCiAgICAnICAgIHotaW5kZXg6IDk5OTk7JywKICAgICcgICAgZm9udC1zaXplOiAxOHB4OycsCiAgICAnICAgIHJpZ2h0OiAzMHB4OycsCiAgICAnICAgIGJvdHRvbTogMjBweDsnLAogICAgJyAgICBjb2xvcjogIzAwMDsnLCAgICAKICAgICcgICAgd2lkdGg6IDY1MHB4OycsICAgICAgCiAgICAnICAgIHRleHQtYWxpZ246IGNlbnRlcjsnLCAgICAgICAKICAgICcgICAgYm94LXNoYWRvdzogMCAxcHggNHB4IHJnYmEoMCwgMCwgMCwgMC41KSwgMCAwIDE1cHggcmdiYSgwLCAwLCAwLCAwLjMpOycsCiAgICAnfScsCiAgICAnI3NhdmVQTkcgYnV0dG9uIHsnLCAgCiAgICAnICAgIGZvbnQtc2l6ZTogMThweDsnLCAKICAgICcgICAgd2lkdGg6IDEwMHB4OycsCiAgICAnICAgIGN1cnNvcjogcG9pbnRlcjsnLCAgICAKICAgICd9JywgICAgCiAgICAnI3NhdmVQTkcgaW5wdXQgeycsICAgIAogICAgJyAgICB3aWR0aDogNjBweDsnLCAgCiAgICAnICAgIGZvbnQtc2l6ZTogMThweDsnLCAgICAKICAgICcgICAgdGV4dC1hbGlnbjogY2VudGVyOycsICAgICAgICAKICAgICd9JyAgICAgCiAgXS5qb2luKCdcbicpOwogIGlmICh0eXBlb2YgR01fYWRkU3R5bGUgIT0gJ3VuZGVmaW5lZCcpIHsKICAgIEdNX2FkZFN0eWxlKGNzcyk7CiAgfSBlbHNlIGlmICh0eXBlb2YgUFJPX2FkZFN0eWxlICE9ICd1bmRlZmluZWQnKSB7CiAgICBQUk9fYWRkU3R5bGUoY3NzKTsKICB9IGVsc2UgaWYgKHR5cGVvZiBhZGRTdHlsZSAhPSAndW5kZWZpbmVkJykgewogICAgYWRkU3R5bGUoY3NzKTsKICB9IGVsc2UgewogICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgbm9kZS50eXBlID0gJ3RleHQvY3NzJzsKICAgIG5vZGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY3NzKSk7CiAgICB2YXIgaGVhZHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpOwogICAgaWYgKGhlYWRzLmxlbmd0aCA+IDApIHsKICAgICAgaGVhZHNbMF0uYXBwZW5kQ2hpbGQobm9kZSk7CiAgICB9IGVsc2UgewogICAgICAvLyBubyBoZWFkIHlldCwgc3RpY2sgaXQgd2hlcmVldmVyCiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTsKICAgIH0KICB9Cn0pICgpOwoKdmFyIGh0bWwgPSAnPGRpdiBpZD0ic2F2ZVBORyI+JyArIAogICAgJzxzcGFuPlRoZXJlIGFyZSBtYXggPC9zcGFuPiAnICsgCiAgICAnPGlucHV0IHR5cGU9InRleHQiIGlkPSJ0b3RhbCIgdmFsdWU9Ii0tLSIgcmVhZG9ubHk+ICcgKyAKICAgICc8c3Bhbj5wYWdlcyBhdmFpbGFibGUuIEkgYWxyZWFkeSBoYXZlIDwvc3Bhbj4gJyArIAogICAgJzxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iY291bnQiIHZhbHVlPSIwIj4gJyArIAogICAgJzxzcGFuPi48L3NwYW4+ICcgKwogICAgJzxidXR0b24+U3RhcnQ8L2J1dHRvbj4nICsKICAgICc8L2Rpdj4nOwoKJCgnYm9keScpLnByZXBlbmQoaHRtbCk7CgokKCcjY291bnQnKS5zZWxlY3QoKTsKCnZhciB0aXRsZSwgaWQsIHppcGZpbGUsIHppcG5hbWU7CnZhciB6aXBmbGFnID0gZmFsc2U7CnZhciBuZXh0ID0gdHJ1ZTsKdmFyIHppcCA9IG5ldyBKU1ppcCgpOwp2YXIgcGlkcyA9IFtdOwoKJCgnI3NhdmVQTkcgYnV0dG9uJykuY2xpY2soZnVuY3Rpb24oKXsKICBkb1RoZU1hZ2ljKCk7Cn0pCgokKCIjY291bnQiKS5rZXl1cChmdW5jdGlvbihldmVudCl7CiAgICBpZihldmVudC5rZXlDb2RlID09IDEzKXsKICAgICAgICAkKCIjc2F2ZVBORyBidXR0b24iKS5jbGljaygpOwogICAgfQp9KTsKCmZ1bmN0aW9uIGFkZElNRyh1cmwsIG5hbWUsIGNvdW50KSB7CiAgdmFyIGZpbGVuYW1lID0gbmFtZSArICcucG5nJzsKICBHTV94bWxodHRwUmVxdWVzdCh7CiAgICBtZXRob2Q6ICdHRVQnLAogICAgc3luY2hyb25vdXM6IHRydWUsCiAgICB1cmw6IHVybCwKICAgIG92ZXJyaWRlTWltZVR5cGU6ICdpbWFnZS9wbmc7IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQnLAogICAgb25sb2FkOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgJCgnI3NhdmVQTkcgYnV0dG9uJykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKS50ZXh0KCdXb3JraW5n4oCmJyk7CiAgICAgICQoJyNjb3VudCcpLnZhbChjb3VudCk7CiAgICAgICQoJyNjb3VudCcpLmNzcygnZm9udC13ZWlnaHQnLCAnbm9ybWFsJykuY3NzKCd0ZXh0LWRlY29yYXRpb24nLCAnbm9uZScpOwogICAgICB6aXAuZmlsZShmaWxlbmFtZSwgcmVzcG9uc2UucmVzcG9uc2VUZXh0LCB7CiAgICAgICAgYmluYXJ5OiB0cnVlCiAgICAgIH0pOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBzYXZlWmlwKGNvdW50LCBudW1iZXIpIHsKICB6aXBuYW1lID0gdGl0bGUgKyAnXycgKyBpZCArICdfJyArIAogICAgcGFkKGNvdW50LCBudW1iZXIudG9TdHJpbmcoKS5sZW5ndGgpICsgCiAgICAnXycgKyBudW1iZXIgKyAnLnppcCc7CiAgemlwZmlsZSA9IHppcC5nZW5lcmF0ZSh7CiAgICB0eXBlOiAnYmxvYicKICB9KTsKICAkKCcjc2F2ZVBORyBidXR0b24nKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKS50ZXh0KCdTdGFydCcpOwogIHNhdmVBcyh6aXBmaWxlLCB6aXBuYW1lKTsKfQoKZnVuY3Rpb24gcGFkKG51bSwgc2l6ZSkgewogICAgdmFyIHMgPSAiMDAwMDAwMDAwIiArIG51bTsKICAgIHJldHVybiBzLnN1YnN0cihzLmxlbmd0aC1zaXplKTsKfQoKZnVuY3Rpb24gZG9UaGVNYWdpYygpIHsKICAkKCcjc2F2ZVBORyBidXR0b24nKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpOwogIHZhciBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgdmFyIGRvbWFpbiA9IGhyZWYuc3BsaXQoJy8nKSBbMl07CiAgCiAgaWQgPSBocmVmLm1hdGNoKC9pZD0oW14mXSspLykgWzFdOwogIHRpdGxlID0gJCgndGl0bGUnKS50ZXh0KCkuc3BsaXQoJyAtICcpWzBdLnJlcGxhY2UoL1xzKy9nLCdfJyk7CiAgCiAgdmFyIHBpZCA9ICdQUDEnOwogIHZhciBjb3VudCA9IHBhcnNlSW50KCQoJyNjb3VudCcpLnZhbCgpKTsKICAKICB2YXIgdXJsID0gJ2h0dHBzOi8vJyArIGRvbWFpbiArICcvYm9va3M/aWQ9JyArIGlkICsgJyZscGc9JyArIHBpZCArICcmcGc9JyArIHBpZCArICcmanNjbWQ9Y2xpY2szJzsKICAKICAkLmFqYXgoewogICAgZGF0YVR5cGU6ICdqc29uJywKICAgIGFzeW5jOiBmYWxzZSwKICAgIHVybDogdXJsLAogIH0pLmRvbmUoZnVuY3Rpb24gKGRhdGEpIHsKICAgIHBpZHMgPSAkLm1hcChkYXRhLnBhZ2UsIGZ1bmN0aW9uICh2YWwsIGkpIHsKICAgICAgaWYgKGkgPiAzKSB7CiAgICAgICAgcmV0dXJuIHZhbC5waWQ7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIAogIHZhciBudW1iZXIgPSBwaWRzLmxlbmd0aDsKICAkKCcjdG90YWwnKS52YWwobnVtYmVyKTsKICAKICBpZiAoY291bnQgPj0gbnVtYmVyKSB7CiAgICBhbGVydCgnV3JvbmcgbnVtYmVyIG9mIHBhZ2VzLiBUaGVyZSBhcmUgb25seSAnICsgbnVtYmVyICsgJyBhdmFpbGFibGUuJyk7CiAgICAkKCcjc2F2ZVBORyBidXR0b24nKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTsKICB9IGVsc2UgewogICAgdmFyIGkgPSBjb3VudDsKCiAgICB2YXIgdGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CgogICAgICBpZiAoaSA9PSBudW1iZXIpIHsKICAgICAgICBjbGVhckludGVydmFsKHRpbWVyKTsKICAgICAgICBhbGVydCgnRG93bmxvYWRlZCBldmVyeSBhdmFpbGFibGUgcGFnZSBvdXQgb2YgJysgbnVtYmVyICsgJyB0b3RhbC4gU2F2aW5n4oCmJyk7CiAgICAgICAgc2F2ZVppcChpLCBudW1iZXIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAgICAgCgogICAgICB2YXIgdXJsID0gJ2h0dHBzOi8vJyArIGRvbWFpbiArICcvYm9va3M/aWQ9JyArIGlkICsgJyZscGc9JyArIHBpZHNbaV0gKyAnJnBnPScgKyBwaWRzW2ldICsgJyZqc2NtZD1jbGljazMnOwoKICAgICAgJC5hamF4KHsKICAgICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICB1cmw6IHVybCwKICAgICAgfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIGlmIChkYXRhLnBhZ2VbMF0uaGFzT3duUHJvcGVydHkoJ3NyYycpIHx8IGRhdGEucGFnZVswXS5mbGFncyA9PSA4KSB7CiAgICAgICAgICB2YXIgdXJsID0gZGF0YS5wYWdlWzBdLnNyYyArICcmdz0xNjAwJzsKICAgICAgICAgIHZhciBuYW1lID0gcGFkKChpKzEpLCBudW1iZXIudG9TdHJpbmcoKS5sZW5ndGgpICsgJ18nICsgcGlkc1tpXTsKICAgICAgICAgIAogICAgICAgICAgaWYgKGRhdGEucGFnZVswXS5mbGFncyA9PSA4KSB7CiAgICAgICAgICAgICQoJyNjb3VudCcpLnZhbChpICsgMSk7CiAgICAgICAgICAgICQoJyNjb3VudCcpLmNzcygnZm9udC13ZWlnaHQnLCAnYm9sZCcpLmNzcygndGV4dC1kZWNvcmF0aW9uJywgJ2xpbmUtdGhyb3VnaCcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWRkSU1HKHVybCwgbmFtZSwgKGkgKyAxKSk7ICAgICAgICAKICAgICAgICAgIH0KICAgICAgICAgIGkrKzsKICAgICAgICAgIAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVyKTsKICAgICAgICAgIGFsZXJ0KCdDYW5cJ3QgZG93bmxvYWQgbW9yZS5cbicgKyAKICAgICAgICAgICAgICAgICdTYXZpbmcgJyArIGkgKyAnIG91dCBvZiAnICsgbnVtYmVyICsgJyBwYWdlc+KAplxuJyArIAogICAgICAgICAgICAgICAgJ0NoYW5nZSB5b3VyIElQIGFuZCBjb250aW51ZSEnKTsKICAgICAgICAgIHNhdmVaaXAoaSwgbnVtYmVyKTsKICAgICAgICB9CiAgICAgIH0pOyAKICAgIH0sIDQwMCk7ICAgIAogIH0KfQ=="},{"name":"Github color preview","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["https://*.github.com/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469649440849,"data":{}},"enabled":true,"position":23,"file_url":"https://greasyfork.org/scripts/4034-github-color-preview/code/Github%20color%20preview.user.js","uuid":"e1e327b9-7b6b-45ac-97d1-bf870b13481c","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBHaXRodWIgY29sb3IgcHJldmlldwovLyBAYXV0aG9yICAgICAgIEFmemFsIE5hamFtCi8vIEBuYW1lc3BhY2UgICAgaHR0cDovL2FmemFsbi5jb20vCi8vIEB2ZXJzaW9uICAgICAgMS4wCi8vIEBkZXNjcmlwdGlvbiAgQWRkcyBjb2xvdXIgdG8gZ2l0aHViIGd1dHRlciBpZiB0aGUgbGluZSBjb250YWlucyBhIGhleCBjb2xvciBjb2RlCi8vIEBtYXRjaCAgICAgICAgaHR0cHM6Ly8qLmdpdGh1Yi5jb20vKgovLyBAY29weXJpZ2h0ICAgIDIwMTQrLCBBZnphbCBOYWphbQovLyA9PS9Vc2VyU2NyaXB0PT0KCnJvd3MgPSAkKCcuZmlsZSA+IC5ibG9iLXdyYXBwZXIgPiB0YWJsZSA+IHRib2R5ID4gdHInKTsKR01fYWRkU3R5bGUgKCAiLmJsb2ItbGluZS1udW0geyB3aWR0aDo2JSAhaW1wb3J0YW50IH0iICk7CnJvd3MuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHsKICAgIGxpbmVOdW0gPSAkKHRoaXMpLmZpbmQoJy5ibG9iLWxpbmUtbnVtJyk7CiAgICBsaW5lVGV4dCA9ICQodGhpcykuZmluZCgnLmJsb2ItbGluZS1jb2RlJykudGV4dCgpOwogICAgdmFyIHBhdHQgPSAvIyhbMC05QS1GXXsyfSk/KFswLTlBLUZdezJ9KShbMC05QS1GXXsyfSkoWzAtOUEtRl17Mn0pL2k7CiAgICB2YXIgY29sb3JzID0gcGF0dC5leGVjKGxpbmVUZXh0KTsKICAgIGlmIChjb2xvcnMgIT0gbnVsbCkgewovLyAgICAgICAgR01fbG9nKGNvbG9ycyk7CiAgICAgICAgaWYgKGNvbG9yc1sxXSkgewogICAgICAgICAgdmFyIG9wYWNpdHkgPSBwYXJzZUludChjb2xvcnNbMV0sIDE2KS8yNTU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG9wYWNpdHkgPSAxOwogICAgICAgIH0KICAgICAgICB2YXIgciA9IHBhcnNlSW50KGNvbG9yc1syXSwgMTYpOwogICAgICAgIHZhciBnID0gcGFyc2VJbnQoY29sb3JzWzNdLCAxNik7CiAgICAgICAgdmFyIGIgPSBwYXJzZUludChjb2xvcnNbNF0sIDE2KTsKICAgICAgICB2YXIgY29sb3JkaXYgPSAiPGRpdiBzdHlsZT1cImZsb2F0OmxlZnQ7IGRpc3BsYXk6aW5saW5lOyBiYWNrZ3JvdW5kOiByZ2IoIiArIHIgKyAiLCIgKyBnICsgIiwiICsgYiArICIpOyBvcGFjaXR5OiAiICsgb3BhY2l0eSArICI7IGhlaWdodDogMTRweDsgd2lkdGg6IDhweFwiPjwvZGl2PiI7CiAgICAgICAgbGluZU51bS5hcHBlbmQoY29sb3JkaXYpOwogICAgfQp9KTsK"},{"name":"GitHub Collapse Markdown","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://github.com/*","https://gist.github.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"ghcm-collapsed":"bfalse"},"ts":1469696391765},"enabled":false,"position":24,"file_url":"https://greasyfork.org/scripts/20974-github-collapse-markdown/code/GitHub%20Collapse%20Markdown.user.js","uuid":"08b4c967-e942-4631-b4a2-0acf540fda86","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBHaXRIdWIgQ29sbGFwc2UgTWFya2Rvd24KLy8gQHZlcnNpb24gICAgICAxLjAuMQovLyBAZGVzY3JpcHRpb24gIEEgdXNlcnNjcmlwdCB0aGF0IGNvbGxhcHNlcyBtYXJrZG93biBoZWFkZXJzCi8vIEBsaWNlbnNlICAgICAgaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzQuMC8KLy8gQG5hbWVzcGFjZSAgICBodHRwczovL2dpdGh1Yi5jb20vTW90dGllCi8vIEBpbmNsdWRlICAgICAgaHR0cHM6Ly9naXRodWIuY29tLyoKLy8gQGluY2x1ZGUgICAgICBodHRwczovL2dpc3QuZ2l0aHViLmNvbS8qCi8vIEBydW4tYXQgICAgICAgZG9jdW1lbnQtaWRsZQovLyBAZ3JhbnQgICAgICAgIEdNX2FkZFN0eWxlCi8vIEBncmFudCAgICAgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICBHTV9zZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQKLy8gQGF1dGhvciAgICAgICBSb2IgR2Fycmlzb24KLy8gPT0vVXNlclNjcmlwdD09Ci8qIGdsb2JhbCBHTV9hZGRTdHlsZSwgR01fZ2V0VmFsdWUsIEdNX3NldFZhbHVlLCBHTV9yZWdpc3Rlck1lbnVDb21tYW5kICovCi8qIGpzaGludCBlc25leHQ6dHJ1ZSwgdW51c2VkOnRydWUgKi8KKCgpID0+IHsKICAidXNlIHN0cmljdCI7CgogIGxldCBzdGFydENvbGxhcHNlZCA9IEdNX2dldFZhbHVlKCJnaGNtLWNvbGxhcHNlZCIsIGZhbHNlKSwKICAgIC8vIHBhbGV0dGUgZ2VuZXJhdGVkIGJ5IGh0dHA6Ly90b29scy5tZWRpYWxhYi5zY2llbmNlcy1wby5mci9pd2FudGh1ZS8gKGNvbG9yYmxpbmQgZnJpZW5kbHksIHNvZnQpCiAgICBkZWZhdWx0Q29sb3JzID0gWyIjNjc3OGQwIiwgIiNhYzljM2QiLCAiI2I5NGE3MyIsICIjNTZhZTZjIiwgIiM5NzUwYTEiLCAiI2JhNTQzZCJdLAogICAgY29sb3JzID0gR01fZ2V0VmFsdWUoImdoY20tY29sb3JzIiwgZGVmYXVsdENvbG9ycyksCgogICAgaGVhZGVycyA9ICJIMSBIMiBIMyBINCBINSBINiIuc3BsaXQoIiAiKSwKICAgIC8vIG1hcmtkb3duIHdyYXBwZXIgY2xhc3MgbmFtZQogICAgbWFya2Rvd24gPSAibWFya2Rvd24tYm9keSIsCiAgICBjb2xsYXBzZWQgPSAiZ2hjbS1jb2xsYXBzZWQiLAoKICAgIGFycm93Q29sb3JzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKCiAgR01fYWRkU3R5bGUoYAogICAgLiR7bWFya2Rvd259IGgxLCAuJHttYXJrZG93bn0gaDIsIC4ke21hcmtkb3dufSBoMywgLiR7bWFya2Rvd259IGg0LAogICAgLiR7bWFya2Rvd259IGg1LCAuJHttYXJrZG93bn0gaDYgewogICAgICBwb3NpdGlvbjpyZWxhdGl2ZTsKICAgICAgcGFkZGluZy1yaWdodDouOGVtOwogICAgICBjdXJzb3I6cG9pbnRlcjsKICAgIH0KICAgIC4ke21hcmtkb3dufSBoMTphZnRlciwgLiR7bWFya2Rvd259IGgyOmFmdGVyLCAuJHttYXJrZG93bn0gaDM6YWZ0ZXIsCiAgICAuJHttYXJrZG93bn0gaDQ6YWZ0ZXIsIC4ke21hcmtkb3dufSBoNTphZnRlciwgLiR7bWFya2Rvd259IGg2OmFmdGVyIHsKICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgIHBvc2l0aW9uOmFic29sdXRlOwogICAgICByaWdodDowOwogICAgICB0b3A6Y2FsYyg1MCUgLSAuNWVtKTsKICAgICAgZm9udC1zaXplOi44ZW07CiAgICAgIGNvbnRlbnQ6Ilx1MjViYyI7CiAgICB9CiAgICAuJHttYXJrZG93bn0gLiR7Y29sbGFwc2VkfTphZnRlciB7CiAgICAgIGNvbnRlbnQ6Ilx1MjVDNCI7CiAgICB9CiAgICAvKiBjbGlja2luZyBvbiBoZWFkZXIgbGluayB3b24ndCBwYXNzIHN2ZyBhcyB0aGUgZXZlbnQudGFyZ2V0ICovCiAgICAub2N0aWNvbi1saW5rIHsKICAgICAgcG9pbnRlci1ldmVudHM6bm9uZTsKICAgIH0KICAgIC5naGNtLWhpZGRlbiB7CiAgICAgIGRpc3BsYXk6bm9uZSAhaW1wb3J0YW50OwogICAgfQogIGApOwoKICBmdW5jdGlvbiBhZGRDb2xvcnMoKSB7CiAgICBhcnJvd0NvbG9ycy50ZXh0Q29udGVudCA9IGAKICAgICAgLiR7bWFya2Rvd259IGgxOmFmdGVyIHsgY29sb3I6JHtjb2xvcnNbMF19IH0KICAgICAgLiR7bWFya2Rvd259IGgyOmFmdGVyIHsgY29sb3I6JHtjb2xvcnNbMV19IH0KICAgICAgLiR7bWFya2Rvd259IGgzOmFmdGVyIHsgY29sb3I6JHtjb2xvcnNbMl19IH0KICAgICAgLiR7bWFya2Rvd259IGg0OmFmdGVyIHsgY29sb3I6JHtjb2xvcnNbM119IH0KICAgICAgLiR7bWFya2Rvd259IGg1OmFmdGVyIHsgY29sb3I6JHtjb2xvcnNbNF19IH0KICAgICAgLiR7bWFya2Rvd259IGg2OmFmdGVyIHsgY29sb3I6JHtjb2xvcnNbNV19IH0KICAgIGA7CiAgfQoKICBmdW5jdGlvbiB0b2dnbGUoZWwsIHNoaWZ0ZWQpIHsKICAgIGlmIChlbCkgewogICAgICBlbC5jbGFzc0xpc3QudG9nZ2xlKGNvbGxhcHNlZCk7CiAgICAgIGxldCBlbHMsCiAgICAgICAgbmFtZSA9IGVsLm5vZGVOYW1lIHx8ICIiLAogICAgICAgIGxldmVsID0gcGFyc2VJbnQobmFtZS5yZXBsYWNlKC9bXlxkXS8sICIiKSwgMTApLAogICAgICAgIGlzQ29sbGFwc2VkID0gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNvbGxhcHNlZCk7CiAgICAgIGlmIChzaGlmdGVkKSB7CiAgICAgICAgLy8gY29sbGFwc2UgYWxsIHNhbWUgbGV2ZWwgYW5jaG9ycwogICAgICAgIGVscyA9ICQkKGAuJHttYXJrZG93bn0gJHtuYW1lfWApOwogICAgICAgIGZvciAoZWwgb2YgZWxzKSB7CiAgICAgICAgICBuZXh0SGVhZGVyKGVsLCBsZXZlbCwgaXNDb2xsYXBzZWQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBuZXh0SGVhZGVyKGVsLCBsZXZlbCwgaXNDb2xsYXBzZWQpOwogICAgICB9CiAgICAgIHJlbW92ZVNlbGVjdGlvbigpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gbmV4dEhlYWRlcihlbCwgbGV2ZWwsIGlzQ29sbGFwc2VkKSB7CiAgICBlbC5jbGFzc0xpc3RbaXNDb2xsYXBzZWQgPyAiYWRkIiA6ICJyZW1vdmUiXShjb2xsYXBzZWQpOwogICAgbGV0IHNlbGVjdG9yID0gaGVhZGVycy5zbGljZSgwLCBsZXZlbCkuam9pbigiLCIpLAogICAgICBlbHMgPSBbXTsKICAgIGVsID0gZWwubmV4dEVsZW1lbnRTaWJsaW5nOwogICAgd2hpbGUgKGVsICYmICFlbC5tYXRjaGVzKHNlbGVjdG9yKSkgewogICAgICBlbHNbZWxzLmxlbmd0aF0gPSBlbDsKICAgICAgZWwgPSBlbC5uZXh0RWxlbWVudFNpYmxpbmc7CiAgICB9CiAgICBpZiAoZWxzLmxlbmd0aCkgewogICAgICBpZiAoaXNDb2xsYXBzZWQpIHsKICAgICAgICBhZGRDbGFzcyhlbHMsICJnaGNtLWhpZGRlbiIpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlbW92ZUNsYXNzKGVscywgY29sbGFwc2VkICsgIiBnaGNtLWhpZGRlbiIpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBzaG93IHNpYmxpbmdzIG9mIGhhc2ggdGFyZ2V0CiAgZnVuY3Rpb24gc2libGluZ3ModGFyZ2V0KSB7CiAgICBsZXQgbGV2ZWwgPSBwYXJzZUludCgodGFyZ2V0Lm5vZGVOYW1lIHx8ICIiKS5yZXBsYWNlKC9bXlxkXS8sICIiKSwgMTApLAogICAgICBlbCA9IHRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmcsCiAgICAgIHNlbGVjdG9yID0gaGVhZGVycy5zbGljZSgwLCBsZXZlbCAtIDEpLmpvaW4oIiwiKSwKICAgICAgZWxzID0gW3RhcmdldF07CiAgICB3aGlsZSAoZWwgJiYgIWVsLm1hdGNoZXMoc2VsZWN0b3IpKSB7CiAgICAgIGVsc1tlbHMubGVuZ3RoXSA9IGVsOwogICAgICBlbCA9IGVsLm5leHRFbGVtZW50U2libGluZzsKICAgIH0KICAgIGVsID0gdGFyZ2V0LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7CiAgICB3aGlsZSAoZWwgJiYgIWVsLm1hdGNoZXMoc2VsZWN0b3IpKSB7CiAgICAgIGVsc1tlbHMubGVuZ3RoXSA9IGVsOwogICAgICBlbCA9IGVsLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7CiAgICB9CiAgICBpZiAoZWxzLmxlbmd0aCkgewogICAgICBlbHMgPSBlbHMuZmlsdGVyKGVsID0+IHsKICAgICAgICByZXR1cm4gZWwubm9kZU5hbWUgPT09IHRhcmdldC5ub2RlTmFtZTsKICAgICAgfSk7CiAgICAgIHJlbW92ZUNsYXNzKGVscywgImdoY20taGlkZGVuIik7CiAgICB9CiAgICBuZXh0SGVhZGVyKHRhcmdldCwgbGV2ZWwsIGZhbHNlKTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZVNlbGVjdGlvbigpIHsKICAgIC8vIHJlbW92ZSB0ZXh0IHNlbGVjdGlvbiAtIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzMxNzEzNDgvMTQ1MzQ2CiAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbiA/IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSA6IGRvY3VtZW50LnNlbGVjdGlvbjsKICAgIGlmIChzZWwpIHsKICAgICAgaWYgKHNlbC5yZW1vdmVBbGxSYW5nZXMpIHsKICAgICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7CiAgICAgIH0gZWxzZSBpZiAoc2VsLmVtcHR5KSB7CiAgICAgICAgc2VsLmVtcHR5KCk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFkZEJpbmRpbmcoKSB7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV2ZW50ID0+IHsKICAgICAgbGV0IHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImFuY2hvciIpIHx8IHRhcmdldC5ub2RlTmFtZSA9PT0gIkEiIHx8CiAgICAgICAgdGFyZ2V0Lm5vZGVOYW1lID09PSJJTUciKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIGNoZWNrIGlmIGVsZW1lbnQgaXMgaW5zaWRlIGEgaGVhZGVyCiAgICAgIHRhcmdldCA9IGNsb3Nlc3QoZXZlbnQudGFyZ2V0LCBoZWFkZXJzLmpvaW4oIiwiKSk7CiAgICAgIGlmICh0YXJnZXQgJiYgaGVhZGVycy5pbmRleE9mKHRhcmdldC5ub2RlTmFtZSB8fCAiIikgPiAtMSkgewogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgaGVhZGVyIGlzIGluc2lkZSBvZiBtYXJrZG93bgogICAgICAgIGlmIChjbG9zZXN0KHRhcmdldCwgYC4ke21hcmtkb3dufWApKSB7CiAgICAgICAgICB0b2dnbGUodGFyZ2V0LCBldmVudC5zaGlmdEtleSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGNoZWNrSGFzaCgpIHsKICAgIGxldCBlbCwgZWxzLCBtZCwgdG1wLAogICAgICBtZHMgPSAkJChgLiR7bWFya2Rvd259YCk7CiAgICBmb3IgKG1kIG9mIG1kcykgewogICAgICBlbHMgPSAkJChoZWFkZXJzLmpvaW4oIiwiKSwgbWQpOwogICAgICBpZiAoZWxzLmxlbmd0aCA+IDEpIHsKICAgICAgICBmb3IgKGVsIG9mIGVscykgewogICAgICAgICAgaWYgKGVsICYmICFlbC5jbGFzc0xpc3QuY29udGFpbnMoY29sbGFwc2VkKSkgewogICAgICAgICAgICB0b2dnbGUoZWwsIHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLy8gb3BlbiB1cAogICAgdG1wID0gKHdpbmRvdy5sb2NhdGlvbi5oYXNoIHx8ICIiKS5yZXBsYWNlKC8jLywgIiIpOwogICAgaWYgKHRtcCkgewogICAgICBlbHMgPSAkKGAjdXNlci1jb250ZW50LSR7dG1wfWApOwogICAgICBpZiAoZWxzICYmIGVscy5jbGFzc0xpc3QuY29udGFpbnMoImFuY2hvciIpKSB7CiAgICAgICAgZWwgPSBlbHMucGFyZW50Tm9kZTsKICAgICAgICBpZiAoZWwubWF0Y2hlcyhoZWFkZXJzLmpvaW4oIiwiKSkpIHsKICAgICAgICAgIHNpYmxpbmdzKGVsKTsKICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSBlbC5vZmZzZXRUb3A7CiAgICAgICAgICAvLyBzZXQgc2Nyb2xsVG9wIGEgc2Vjb25kIHRpbWUsIGluIGNhc2Ugb2YgYnJvd3NlciBsYWcKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gZWwub2Zmc2V0VG9wOwogICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGNoZWNrQ29sb3JzKCkgewogICAgaWYgKCFjb2xvcnMgfHwgY29sb3JzLmxlbmd0aCAhPT0gNikgewogICAgICBjb2xvcnMgPSBbXS5jb25jYXQoZGVmYXVsdENvbG9ycyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0KCkgewogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiaGVhZCIpLmFwcGVuZENoaWxkKGFycm93Q29sb3JzKTsKICAgIGNoZWNrQ29sb3JzKCk7CiAgICBhZGRDb2xvcnMoKTsKICAgIGFkZEJpbmRpbmcoKTsKICAgIGlmIChzdGFydENvbGxhcHNlZCkgewogICAgICBjaGVja0hhc2goKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uICQoc2VsZWN0b3IsIGVsKSB7CiAgICByZXR1cm4gKGVsIHx8IGRvY3VtZW50KS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICB9CiAgZnVuY3Rpb24gJCQoc2VsZWN0b3JzLCBlbCkgewogICAgcmV0dXJuIEFycmF5LmZyb20oKGVsIHx8IGRvY3VtZW50KS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycykpOwogIH0KICBmdW5jdGlvbiBhZGRDbGFzcyhlbHMsIG5hbWUpIHsKICAgIGZvciAobGV0IGVsIG9mIGVscykgewogICAgICBlbC5jbGFzc0xpc3QuYWRkKG5hbWUpOwogICAgfQogIH0KICBmdW5jdGlvbiByZW1vdmVDbGFzcyhlbHMsIG5hbWUpIHsKICAgIG5hbWUgPSAobmFtZSB8fCAiIikuc3BsaXQoIiAiKTsKICAgIGZvciAobGV0IGVsIG9mIGVscykgewogICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKC4uLm5hbWUpOwogICAgfQogIH0KICBmdW5jdGlvbiBjbG9zZXN0KGVsLCBzZWxlY3RvcikgewogICAgd2hpbGUgKGVsICYmIGVsLm5vZGVOYW1lICE9PSAiQk9EWSIgJiYgIWVsLm1hdGNoZXMoc2VsZWN0b3IpKSB7CiAgICAgIGVsID0gZWwucGFyZW50Tm9kZTsKICAgIH0KICAgIHJldHVybiBlbCAmJiBlbC5tYXRjaGVzKHNlbGVjdG9yKSA/IGVsIDogbnVsbDsKICB9CgogIC8vIEFkZCBHTSBvcHRpb25zCiAgR01fcmVnaXN0ZXJNZW51Q29tbWFuZCgiU2V0IGNvbGxhcHNlIG1hcmtkb3duIHN0YXRlIiwgKCkgPT4gewogICAgbGV0IHZhbCA9IHByb21wdCgiSW5pdGlhbGx5IGNvbGxhcHNlIGhlYWRlcnM6IiwgIXN0YXJ0Q29sbGFwc2VkKTsKICAgIGlmICh2YWwgIT09IG51bGwpIHsKICAgICAgc3RhcnRDb2xsYXBzZWQgPSAvXnQvLnRlc3QodmFsKTsKICAgICAgR01fc2V0VmFsdWUoImdoY20tY29sbGFwc2VkIiwgc3RhcnRDb2xsYXBzZWQpOwogICAgICBjb25zb2xlLmxvZyhgR2l0SHViIENvbGxhcHNlIE1hcmtkb3duOiBIZWFkZXJzIHdpbGwgJHtzdGFydENvbGxhcHNlZCA/ICJiZSIgOiAibm90IGJlIn0gaW5pdGlhbGx5IGNvbGxhcHNlZGApOwogICAgfQogIH0pOwogIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQoIlNldCBjb2xsYXBzZSBtYXJrZG93biBjb2xvcnMiLCAoKSA9PiB7CiAgICBsZXQgdmFsID0gcHJvbXB0KCJTZXQgaGVhZGVyIGFycm93IGNvbG9yczoiLCBKU09OLnN0cmluZ2lmeShjb2xvcnMpKTsKICAgIGlmICh2YWwgIT09IG51bGwpIHsKICAgICAgLy8gYWxsb3cgcGFzdGluZyBpbiBhIEpTT04gZm9ybWF0CiAgICAgIHRyeSB7CiAgICAgICAgdmFsID0gSlNPTi5wYXJzZSh2YWwpOwogICAgICAgIGlmICh2YWwgJiYgdmFsLmxlbmd0aCA9PT0gNikgewogICAgICAgICAgY29sb3JzID0gdmFsOwogICAgICAgICAgR01fc2V0VmFsdWUoImdoY20tY29sb3JzIiwgY29sb3JzKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCJHaXRIdWIgQ29sbGFwc2UgTWFya2Rvd246IGNvbG9ycyBzZXQgdG8iLCBjb2xvcnMpOwogICAgICAgICAgYWRkQ29sb3JzKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkdpdEh1YiBDb2xsYXBzZSBNYXJrZG93bjogaW52YWxpZCBjb2xvciBkZWZpbml0aW9uICg2IGNvbG9ycykiLCB2YWwpOwogICAgICAgICAgLy8gcmVzZXQgY29sb3JzIHRvIGRlZmF1bHQgKGluIGNhc2UgY29sb3JzIHZhcmlhYmxlIGlzIGNvcnJ1cHRlZCkKICAgICAgICAgIGNoZWNrQ29sb3JzKCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkdpdEh1YiBDb2xsYXBzZSBNYXJrZG93bjogaW52YWxpZCBKU09OIik7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgaW5pdCgpOwoKfSkoKTsK"},{"name":"GitHub Sort Content","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://github.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469650752047,"data":{}},"enabled":true,"position":25,"file_url":"https://greasyfork.org/scripts/21373-github-sort-content/code/GitHub%20Sort%20Content.user.js","uuid":"2578488a-d2c0-4c6b-9c52-0c2223938b94","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgR2l0SHViIFNvcnQgQ29udGVudAovLyBAdmVyc2lvbiAgICAgICAxLjAuNwovLyBAZGVzY3JpcHRpb24gICBBIHVzZXJzY3JpcHQgdGhhdCBtYWtlcyBzb21lIGxpc3RzICYgbWFya2Rvd24gdGFibGVzIHNvcnRhYmxlCi8vIEBsaWNlbnNlICAgICAgIGh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS80LjAvCi8vIEBuYW1lc3BhY2UgICAgIGh0dHA6Ly9naXRodWIuY29tL01vdHRpZQovLyBAaW5jbHVkZSAgICAgICBodHRwczovL2dpdGh1Yi5jb20vKgovLyBAZ3JhbnQgICAgICAgICBHTV9hZGRTdHlsZQovLyBAcmVxdWlyZSAgICAgICBodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy90aW55c29ydC8yLjMuNi90aW55c29ydC5taW4uanMKLy8gQHJ1bi1hdCAgICAgICAgZG9jdW1lbnQtaWRsZQovLyBAYXV0aG9yICAgICAgICBSb2IgR2Fycmlzb24KLy8gPT0vVXNlclNjcmlwdD09Ci8qIGdsb2JhbCBHTV9hZGRTdHlsZSwgdGlueXNvcnQgKi8KLyoganNoaW50IGVzbmV4dDp0cnVlLCB1bnVzZWQ6dHJ1ZSAqLwooKCkgPT4gewoJInVzZSBzdHJpY3QiOwoJLyogZXhhbXBsZSBwYWdlczoKCXRhYmxlcyAtIGh0dHBzOi8vZ2l0aHViLmNvbS9Nb3R0aWUvR2l0SHViLXVzZXJzY3JpcHRzCglDb250cmlidXRlIHJlcG9zICYgWW91ciBSZXBvcyAtIGh0dHBzOi8vZ2l0aHViLmNvbS8KCW9yZ2FuaXphdGlvbiByZXBvcyAtIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkKCW9yZ2FuaXphdGlvbiBtZW1iZXJzIC0gaHR0cHM6Ly9naXRodWIuY29tL29yZ3MvanF1ZXJ5L3Blb3BsZQoJcGlubmVkICYgbm8gcGlubmVkIHJlcG9zIC0gaHR0cHM6Ly9naXRodWIuY29tL2FkZHlvc21hbmkKCXJlcG9zIC0gaHR0cHM6Ly9naXRodWIuY29tL2FkZHlvc21hbmk/dGFiPXJlcG9zaXRvcmllcwoJc3RhcnMgLSBodHRwczovL2dpdGh1Yi5jb20vc3RhcnMKCXdhdGNoaW5nIC0gaHR0cHM6Ly9naXRodWIuY29tL3dhdGNoaW5nCgkqLwoJY29uc3Qgc29ydHMgPSBbImFzYyIsICJkZXNjIl0sCgkJaWNvbnMgPSB7CgkJCXdoaXRlOiB7CgkJCQl1bnNvcnRlZDogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJeE5pSWdhR1ZwWjJoMFBTSXhOaUkrUEhCaGRHZ2daRDBpVFRFMUlEZ2dNU0E0SURnZ01IcE5NVFVnT1NBeElEa2dPQ0F4Tm5vaUlITjBlV3hsUFNKbWFXeHNPaU5rWkdRN2IzQmhZMmwwZVRvd0xqSWlMejQ4TDNOMlp6ND0iLAoJCQkJYXNjOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l4TmlJZ2FHVnBaMmgwUFNJeE5pSStQSEJoZEdnZ1pEMGlUVEUxSURnZ01TQTRJRGdnTUhvaUlITjBlV3hsUFNKbWFXeHNPaU5rWkdRaUx6NDhjR0YwYUNCa1BTSk5NVFVnT1NBeElEa2dPQ0F4Tm5vaUlITjBlV3hsUFNKbWFXeHNPaU5rWkdRN2IzQmhZMmwwZVRvd0xqSWlMejQ4TDNOMlp6ND0iLAoJCQkJZGVzYzogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJeE5pSWdhR1ZwWjJoMFBTSXhOaUkrUEhCaGRHZ2daRDBpVFRFMUlEZ2dNU0E0SURnZ01Ib2lJSE4wZVd4bFBTSm1hV3hzT2lOa1pHUTdiM0JoWTJsMGVUb3dMaklpTHo0OGNHRjBhQ0JrUFNKTk1UVWdPU0F4SURrZ09DQXhObm9pSUhOMGVXeGxQU0ptYVd4c09pTmtaR1FpTHo0OEwzTjJaejQ9IgoJCQl9LAoJCQlibGFjazogewoJCQkJdW5zb3J0ZWQ6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhOaUlnYUdWcFoyaDBQU0l4TmlJK1BIQmhkR2dnWkQwaVRURTFJRGdnTVNBNElEZ2dNSHBOTVRVZ09TQXhJRGtnT0NBeE5ub2lJSE4wZVd4bFBTSm1hV3hzT2lNeU1qSTdiM0JoWTJsMGVUb3dMaklpTHo0OEwzTjJaejQ9IiwKCQkJCWFzYzogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJeE5pSWdhR1ZwWjJoMFBTSXhOaUkrUEhCaGRHZ2daRDBpVFRFMUlEZ2dNU0E0SURnZ01Ib2lJSE4wZVd4bFBTSm1hV3hzT2lNeU1qSWlMejQ4Y0dGMGFDQmtQU0pOTVRVZ09TQXhJRGtnT0NBeE5ub2lJSE4wZVd4bFBTSm1hV3hzT2lNeU1qSTdiM0JoWTJsMGVUb3dMaklpTHo0OEwzTjJaejQ9IiwKCQkJCWRlc2M6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhOaUlnYUdWcFoyaDBQU0l4TmlJK1BIQmhkR2dnWkQwaVRURTFJRGdnTVNBNElEZ2dNSG9pSUhOMGVXeGxQU0ptYVd4c09pTXlNakk3YjNCaFkybDBlVG93TGpJaUx6NDhjR0YwYUNCa1BTSk5NVFVnT1NBeElEa2dPQ0F4Tm5vaUlITjBlV3hsUFNKbWFXeHNPaU15TWpJaUx6NDhMM04yWno0PSIKCQkJfQoJCX0sCgkJLy8gdG9vbGJhcnMgLSB0YXJnZXQgZm9yIHNvcnQgYXJyb3dzCgkJcmVnZXhCYXJzID0gL1xiKGZpbHRlci1iYXJ8b3JnLXRvb2xiYXJ8c29ydC1iYXJ8dGFibmF2LXRhYnMpXGIvOwoKCWZ1bmN0aW9uIGluaXRTb3J0VGFibGUoZWwpIHsKCQlyZW1vdmVTZWxlY3Rpb24oKTsKCQljb25zdCBkaXIgPSBlbC5jbGFzc0xpc3QuY29udGFpbnMoc29ydHNbMF0pID8gc29ydHNbMV0gOiBzb3J0c1swXSwKCQkJdGFibGUgPSBjbG9zZXN0KGVsLCAidGFibGUiKTsKCQl0aW55c29ydCgkJCgidGJvZHkgdHIiLCB0YWJsZSksIHsKCQkJb3JkZXI6IGRpciwKCQkJbmF0dXJhbDogdHJ1ZSwKCQkJc2VsZWN0b3I6IGB0ZDpudGgtY2hpbGQoJHtlbC5jZWxsSW5kZXggKyAxfSlgCgkJfSk7CgkJJCQoInRoIiwgdGFibGUpLmZvckVhY2goZWxtID0+IHsKCQkJZWxtLmNsYXNzTGlzdC5yZW1vdmUoLi4uc29ydHMpOwoJCX0pOwoJCWVsLmNsYXNzTGlzdC5hZGQoZGlyKTsKCX0KCglmdW5jdGlvbiBpbml0U29ydFVsKGFycm93cywgbGlzdCwgc2VsZWN0b3IpIHsKCQlpZiAobGlzdCAmJiBsaXN0LmNoaWxkcmVuKSB7CgkJCXJlbW92ZVNlbGVjdGlvbigpOwoJCQljb25zdCBkaXIgPSBhcnJvd3MuY2xhc3NMaXN0LmNvbnRhaW5zKHNvcnRzWzBdKSA/IHNvcnRzWzFdIDogc29ydHNbMF0sCgkJCQlvcHRpb25zID0ge29yZGVyOiBkaXIsIG5hdHVyYWw6IHRydWV9OwoJCQlpZiAoc2VsZWN0b3IpIHsKCQkJCW9wdGlvbnMuc2VsZWN0b3IgPSBzZWxlY3RvcjsKCQkJfQoJCQkvLyB1c2luZyBjaGlsZHJlbiBiZWNhdXNlIHRoZSBiaWcgcmVwbyBjb250YWlucyBVTCA+IERJVgoJCQl0aW55c29ydChsaXN0LmNoaWxkcmVuLCBvcHRpb25zKTsKCQkJYXJyb3dzLmNsYXNzTGlzdC5yZW1vdmUoLi4uc29ydHMpOwoJCQlhcnJvd3MuY2xhc3NMaXN0LmFkZChkaXIpOwoJCX0KCX0KCglmdW5jdGlvbiBuZWVkRGFya1RoZW1lKCkgewoJCWxldCBicmlnaHRlc3QgPSAwLAoJCQkvLyBjb2xvciB3aWxsIGJlICJyZ2IoIywgIywgIykiIG9yICJyZ2JhKCMsICMsICMsICMpIgoJCQljb2xvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHkpLmJhY2tncm91bmRDb2xvcjsKCQljb25zdCByZ2IgPSAoY29sb3IgfHwgIiIpLnJlcGxhY2UoL1xzL2csICIiKS5tYXRjaCgvXnJnYmE/XCgoXGQrKSwoXGQrKSwoXGQrKS9pKTsKCQlpZiAocmdiKSB7CgkJCWNvbG9yID0gcmdiLnNsaWNlKDEpOyAvLyByZW1vdmUgInJnYi4uIiBwYXJ0IGZyb20gbWF0Y2gKCQkJY29sb3IuZm9yRWFjaChjID0+IHsKCQkJCS8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE1Nzk0Nzg0LzE0NTM0NgoJCQkJYnJpZ2h0ZXN0ID0gTWF0aC5tYXgoYnJpZ2h0ZXN0LCBwYXJzZUludChjLCAxMCkpOwoJCQl9KTsKCQkJLy8gcmV0dXJuIHRydWUgaWYgd2UgaGF2ZSBhIGRhcmsgYmFja2dyb3VuZAoJCQlyZXR1cm4gYnJpZ2h0ZXN0IDwgMTI4OwoJCX0KCQkvLyBmYWxsYmFjayB0byBicmlnaHQgYmFja2dyb3VuZAoJCXJldHVybiBmYWxzZTsKCX0KCglmdW5jdGlvbiAkKHN0ciwgZWwpIHsKCQlyZXR1cm4gKGVsIHx8IGRvY3VtZW50KS5xdWVyeVNlbGVjdG9yKHN0cik7Cgl9CglmdW5jdGlvbiAkJChzdHIsIGVsKSB7CgkJcmV0dXJuIEFycmF5LmZyb20oKGVsIHx8IGRvY3VtZW50KS5xdWVyeVNlbGVjdG9yQWxsKHN0cikpOwoJfQoJZnVuY3Rpb24gY2xvc2VzdChlbCwgc2VsZWN0b3IpIHsKCQl3aGlsZSAoZWwgJiYgZWwubm9kZU5hbWUgIT09ICJCT0RZIiAmJiAhZWwubWF0Y2hlcyhzZWxlY3RvcikpIHsKCQkJZWwgPSBlbC5wYXJlbnROb2RlOwoJCX0KCQlyZXR1cm4gZWwgJiYgZWwubWF0Y2hlcyhzZWxlY3RvcikgPyBlbCA6IG51bGw7Cgl9CglmdW5jdGlvbiByZW1vdmVTZWxlY3Rpb24oKSB7CgkJLy8gcmVtb3ZlIHRleHQgc2VsZWN0aW9uIC0gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzE3MTM0OC8xNDUzNDYKCQljb25zdCBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uID8gd2luZG93LmdldFNlbGVjdGlvbigpIDogZG9jdW1lbnQuc2VsZWN0aW9uOwoJCWlmIChzZWwpIHsKCQkJaWYgKHNlbC5yZW1vdmVBbGxSYW5nZXMpIHsKCQkJCXNlbC5yZW1vdmVBbGxSYW5nZXMoKTsKCQkJfSBlbHNlIGlmIChzZWwuZW1wdHkpIHsKCQkJCXNlbC5lbXB0eSgpOwoJCQl9CgkJfQoJfQoKCWZ1bmN0aW9uIGluaXQoKSB7CgkJY29uc3Qgc3R5bGVzID0gbmVlZERhcmtUaGVtZSgpID8gaWNvbnMud2hpdGUgOiBpY29ucy5ibGFjazsKCgkJR01fYWRkU3R5bGUoYAoJCS8qIHVuc29ydGVkIGljb24gKi8KCQkubWFya2Rvd24tYm9keSB0YWJsZSB0aGVhZCB0aCB7CgkJCWN1cnNvcjpwb2ludGVyOwoJCQlwYWRkaW5nLXJpZ2h0OjIycHggIWltcG9ydGFudDsKCQkJYmFja2dyb3VuZDp1cmwoJHtzdHlsZXMudW5zb3J0ZWR9KSBuby1yZXBlYXQgY2FsYygxMDAlIC0gNXB4KSBjZW50ZXIgIWltcG9ydGFudDsKCQl9CgkJZGl2LmpzLXBpbm5lZC1yZXBvcy1yZW9yZGVyLWNvbnRhaW5lciA+IGgzLCAuZGFzaGJvYXJkLXNpZGViYXIgLmJveGVkLWdyb3VwID4gaDMsCgkJZGl2LmZpbHRlci1yZXBvcywgZGl2LmpzLXJlcG8tZmlsdGVyIC5maWx0ZXItYmFyLCAub3JnLXRvb2xiYXIsIC5zb3J0LWJhciwKCQloMiArIC50YWJuYXYgPiAudGFibmF2LXRhYnMsIC5zdWJzY3JpcHRpb25zLWNvbnRlbnQgLmJveGVkLWdyb3VwID4gaDMgewoJCQljdXJzb3I6cG9pbnRlcjsKCQkJcGFkZGluZy1yaWdodDoxMHB4OwoJCQliYWNrZ3JvdW5kLWltYWdlOnVybCgke3N0eWxlcy51bnNvcnRlZH0pICFpbXBvcnRhbnQ7CgkJCWJhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdCAhaW1wb3J0YW50OwoJCQliYWNrZ3JvdW5kLXBvc2l0aW9uOmNhbGMoMTAwJSAtIDVweCkgY2VudGVyICFpbXBvcnRhbnQ7CgkJfQoJCS8qIGh0dHBzOi8vZ2l0aHViLmNvbS8gLT4geW91ciByZXBvc2l0b3JpZXMgKi8KCQkuZGFzaGJvYXJkLXNpZGViYXIgLnVzZXItcmVwb3MgaDMgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAxNzVweCAxMHB4ICFpbXBvcnRhbnQ7IH0KCQkvKiBodHRwczovL2dpdGh1Yi5jb20vOnVzZXI/dGFiPXJlcG9zaXRvcmllcyAqLwoJCWRpdi5qcy1yZXBvLWZpbHRlciAuZmlsdGVyLWJhciB7IGJhY2tncm91bmQtcG9zaXRpb246MzM4cHggMTBweCAhaW1wb3J0YW50OyB9CgkJLyogaHR0cHM6Ly9naXRodWIuY29tLzpvcmdhbml6YXRpb24gKi8KCQkub3JnLXRvb2xiYXIgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOmNhbGMoMTAwJSAtIDVweCkgMTBweCAhaW1wb3J0YW50OyB9CgkJLyogaHR0cHM6Ly9naXRodWIuY29tL3N0YXJzICovCgkJLnNvcnQtYmFyIHsgYmFja2dyb3VuZC1wb3NpdGlvbjo1MjVweCAxMHB4ICFpbXBvcnRhbnQ7IH0KCQkvKiBodHRwczovL2dpdGh1Yi5jb20vd2F0Y2hpbmcgKi8KCQkuc3Vic2NyaXB0aW9ucy1jb250ZW50IC5ib3hlZC1ncm91cCA+IGgzIHsKCQkJIGJhY2tncm91bmQtcG9zaXRpb246MTUwcHggMTBweCAhaW1wb3J0YW50OwoJCX0KCQkvKiBhc2MvZGVjIGljb25zICovCgkJdGFibGUgdGhlYWQgdGguYXNjLCBkaXYuYm94ZWQtZ3JvdXAgaDMuYXNjLAoJCWRpdi5qcy1yZXBvLWZpbHRlci5hc2MsIGRpdi5maWx0ZXItYmFyLmFzYywKCQkub3JnLXRvb2xiYXIuYXNjLCAuc29ydC1iYXIuYXNjLCBoMiArIC50YWJuYXYgPiAudGFibmF2LXRhYnMuYXNjLAoJCS5zdWJzY3JpcHRpb25zLWNvbnRlbnQgLmJveGVkLWdyb3VwID4gaDMuYXNjIHsKCQkJYmFja2dyb3VuZC1pbWFnZTp1cmwoJHtzdHlsZXMuYXNjfSkgIWltcG9ydGFudDsKCQkJYmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0ICFpbXBvcnRhbnQ7CgkJfQoJCXRhYmxlIHRoZWFkIHRoLmRlc2MsIGRpdi5ib3hlZC1ncm91cCBoMy5kZXNjLAoJCWRpdi5qcy1yZXBvLWZpbHRlci5kZXNjLCBkaXYuZmlsdGVyLWJhci5kZXNjLAoJCS5vcmctdG9vbGJhci5kZXNjLCAuc29ydC1iYXIuZGVzYywgaDIgKyAudGFibmF2ID4gLnRhYm5hdi10YWJzLmRlc2MsCgkJLnN1YnNjcmlwdGlvbnMtY29udGVudCAuYm94ZWQtZ3JvdXAgPiBoMy5kZXNjIHsKCQkJYmFja2dyb3VuZC1pbWFnZTp1cmwoJHtzdHlsZXMuZGVzY30pICFpbXBvcnRhbnQ7CgkJCWJhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdCAhaW1wb3J0YW50OwoJCX0KCQkvKiByZW1vdmUgc29ydCBhcnJvd3MgKi8KCQkucG9wdWxhci1yZXBvcyArIGRpdi5ib3hlZC1ncm91cCBoMyB7CgkJCWJhY2tncm91bmQtaW1hZ2U6bm9uZSAhaW1wb3J0YW50OwoJCQljdXJzb3I6ZGVmYXVsdDsKCQl9CgkJLyogUmVtb3ZlIG1hcmdpbiB0aGF0IG92ZXJsYXBzIHNvcnQgYXJyb3cgLSBodHRwczovL2dpdGh1Yi5jb20vOnVzZXI/dGFiPXJlcG9zaXRvcmllcyAqLwoJCS5maWx0ZXItYmFyIGxpOmxhc3QtY2hpbGQgeyBtYXJnaW4tbGVmdDogMCAhaW1wb3J0YW50OyB9CgkJLyogbW92ZSAiQ3VzdG9taXplIHlvdXIgcGlubmVkLi4uIiAtIGh0dHBzOi8vZ2l0aHViLmNvbS86c2VsZiAqLwoJCS5waW5uZWQtcmVwb3Mtc2V0dGluZy1saW5rIHsgbWFyZ2luLXJpZ2h0OjE0cHg7IH0KCQlgKTsKCgkJZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV2ZW50ID0+IHsKCQkJbGV0IGVsOwoJCQljb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQsCgkJCQluYW1lID0gdGFyZ2V0Lm5vZGVOYW1lOwoJCQlpZiAodGFyZ2V0ICYmIHRhcmdldC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQkvLyBub2RlcyB0aHxoMyAtIGZvcm0gZm9yIHN0YXJzIHBhZ2UKCQkJCW5hbWUgPT09ICJIMyIgfHwgbmFtZSA9PT0gIlRIIiB8fCBuYW1lID09PSAiRk9STSIgfHwKCQkJCS8vIG1pbmktcmVwbyAmIGh0dHBzOi8vZ2l0aHViLmNvbS86dXNlcj90YWI9cmVwb3NpdG9yaWVzIChmaWx0ZXItYmFyKQoJCQkJLy8gaHR0cHM6Ly9naXRodWIuY29tLzpvcmdhbml6YXRpb24gZmlsdGVyIGJhciAob3JnLXRvb2xiYXIpCgkJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vc3RhcnMgKHNvcnQtYmFyKQoJCQkJcmVnZXhCYXJzLnRlc3QodGFyZ2V0LmNsYXNzTmFtZSkKCQkJKSkgewoJCQkJLy8gZG9uJ3Qgc29ydCB0YWJsZXMgbm90IGluc2lkZSBvZiBtYXJrZG93bgoJCQkJaWYgKG5hbWUgPT09ICJUSCIgJiYgY2xvc2VzdCh0YXJnZXQsICIubWFya2Rvd24tYm9keSIpKSB7CgkJCQkJcmV0dXJuIGluaXRTb3J0VGFibGUodGFyZ2V0KTsKCQkJCX0KCgkJCQkvLyBmb2xsb3dpbmcKCQkJCWVsID0gJCgib2wuZm9sbG93LWxpc3QiLCBjbG9zZXN0KHRhcmdldCwgIi5jb250YWluZXIiKSk7CgkJCQlpZiAoZWwpIHsKCQkJCQlyZXR1cm4gaW5pdFNvcnRVbCh0YXJnZXQsIGVsLCAiLmZvbGxvdy1saXN0LW5hbWUgYSIpOwoJCQkJfQoKCQkJCS8vIG9yZ2FuaXphdGlvbiBwZW9wbGUgLSBodHRwczovL2dpdGh1Yi5jb20vb3Jncy86b3JnYW5pemF0aW9uL3Blb3BsZQoJCQkJZWwgPSAkKCJ1bC5tZW1iZXItbGlzdGluZyIsIHRhcmdldC5wYXJlbnROb2RlKTsKCQkJCWlmIChlbCkgewoJCQkJCXJldHVybiBpbml0U29ydFVsKHRhcmdldCwgZWwsICIubWVtYmVyLWxpbmsiKTsKCQkJCX0KCgkJCQkvLyBiaWcgcmVwbyBsaXN0IC0gaHR0cHM6Ly9naXRodWIuY29tLzp1c2VyP3RhYj1yZXBvc2l0b3JpZXMKCQkJCS8vIHN0YXJzIC0gaHR0cHM6Ly9naXRodWIuY29tL3N0YXJzCgkJCQllbCA9IGNsb3Nlc3QodGFyZ2V0LCAiLnNvcnQtYmFyLCAuZmlsdGVyLWJhciwgLm9yZy10b29sYmFyIik7CgkJCQlpZiAoZWwgJiYgJCgiLnJlcG8tbGlzdCIsIGVsLnBhcmVudE5vZGUpKSB7CgkJCQkJcmV0dXJuIGluaXRTb3J0VWwoZWwsICQoIi5yZXBvLWxpc3QiLCBlbC5wYXJlbnROb2RlKSwgIi5yZXBvLWxpc3QtbmFtZSBhIik7CgkJCQl9CgoJCQkJLy8gaHR0cHM6Ly9naXRodWIuY29tL3dhdGNoaW5nCgkJCQllbCA9IGNsb3Nlc3QodGFyZ2V0LCAiLnN1YnNjcmlwdGlvbnMtY29udGVudCIpOwoJCQkJaWYgKGVsICYmICQoIi5yZXBvLWxpc3QiLCBlbCkpIHsKCQkJCQlyZXR1cm4gaW5pdFNvcnRVbCh0YXJnZXQsICQoIi5yZXBvLWxpc3QiLCBlbCksICJsaSBhIik7CgkJCQl9CgoJCQkJLy8gbWluaS1yZXBvIGxpc3RpbmdzIHdpdGggJiB3aXRob3V0IGZpbHRlciAtIGh0dHBzOi8vZ2l0aHViLmNvbS8KCQkJCS8vIGFuZCBwaW5uZWQgcmVwbyBsaXN0cwoJCQkJZWwgPSBjbG9zZXN0KHRhcmdldCwgIi5ib3hlZC1ncm91cCIpOwoJCQkJLy8gcHJldmVudCBjbGlja2luZyBvbiB0aGUgSDMgaGVhZGVyIG9mIGZpbHRlcmVkIHJlcG9zCgkJCQlpZiAoZWwgJiYgbmFtZSA9PT0gIkgzIiAmJiAoCgkJCQllbC5jbGFzc0xpc3QuY29udGFpbnMoImpzLXJlcG8tZmlsdGVyIikgfHwKCQkJCWVsLmNsYXNzTGlzdC5jb250YWlucygianMtcGlubmVkLXJlcG9zLXJlb3JkZXItY29udGFpbmVyIikKCQkJCSkpIHsKCQkJCQlyZXR1cm4gaW5pdFNvcnRVbCh0YXJnZXQsICQoIi5taW5pLXJlcG8tbGlzdCIsIGVsKSk7CgkJCQl9CgkJCX0KCQl9KTsKCX0KCglpbml0KCk7Cn0pKCk7Cg=="},{"name":"Key buildings for input box(ESCAPE)","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1470000551657,"data":{}},"enabled":false,"position":26,"uuid":"ab8f1143-a6bf-4e1c-a274-ba7845b9569e","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBLZXkgYnVpbGRpbmdzIGZvciBpbnB1dCBib3goRVNDQVBFKQovLyBAbmFtZXNwYWNlICAgIGh0dHA6Ly90YW1wZXJtb25rZXkubmV0LwovLyBAdmVyc2lvbiAgICAgIDAuMQovLyBAZGVzY3JpcHRpb24gIHRyeSB0byB0YWtlIG92ZXIgdGhlIHdvcmxkIQovLyBAYXV0aG9yICAgICAgIFlvdQovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09Cgp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7CiAgICBpZiAoZS5rZXlDb2RlID09IDEzKQogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJpbnB1dCNjVmltLWNvbW1hbmQtYmFyLWlucHV0IikudmFsdWUgPSAib3BlbiBodHRwczovL3d3dy5nb29nbGUuY29tL3NlYXJjaD9zaXRlPWltZ2hwJnRibT1pc2NoJnNvdXJjZT1ocCZxPWFwcGxlIjsKICB9LCB0cnVlKTs="},{"name":"Markdown toolbar for GreasyFork and UserStyles.org","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://greasyfork.org/*forum/discussion/*","https://greasyfork.org/*forum/post/discussion*","https://greasyfork.org/*forum/vanilla/post/editdiscussion/*","https://greasyfork.org/*forum/post/editdiscussion/*","https://greasyfork.org/*scripts/*/versions/new*","https://greasyfork.org/*script_versions/new*","https://greasyfork.org/*forum/messages/*","https://greasyfork.org/*forum/profile/*/*","https://greasyfork.org/*forum/profile","https://forum.userstyles.org/discussion/*","https://forum.userstyles.org/post/discussion*","https://forum.userstyles.org/messages/*","https://forum.userstyles.org/messages/add*","https://forum.userstyles.org/vanilla/post/editdiscussion/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469647102771,"data":{}},"enabled":false,"position":27,"file_url":"https://greasyfork.org/scripts/6779-markdown-toolbar-for-greasyfork-and-userstyles-org/code/Markdown%20toolbar%20for%20GreasyFork%20and%20UserStylesorg.user.js","uuid":"5cc82063-5f1b-4e7d-90b9-b4dfbed31aa5","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgICAgIE1hcmtkb3duIHRvb2xiYXIgZm9yIEdyZWFzeUZvcmsgYW5kIFVzZXJTdHlsZXMub3JnCi8vIEBuYW1lOnJ1ICAgICAgICAgICBNYXJrZG93bi3RgtGD0LvQsdCw0YAg0LTQu9GPIEdyZWFzeUZvcmsg0LggVXNlclN0eWxlcy5vcmcKLy8gQG5hbWU6emgtQ04gICAgICAgIEdyZWFzeUZvcmsrVXNlclN0eWxlcy5vcmcgbWFya2Rvd24KLy8gQGF1dGhvciAgICAgICAgICAgIHdPeHhPbQovLyBAY29udHJpYnV0b3IgICAgICAgSml4dW5Nb2UKLy8gQGxpY2Vuc2UgICAgICAgICAgIE1JVCBMaWNlbnNlCi8vIEBkZXNjcmlwdGlvbiAgICAgICBTZWxlY3QgTUFSS0RPV04gZm9ybWF0IGJ5IGRlZmF1bHQsIGFkZCBoZWxwIGxpbmtzLCBhZGQgdG9vbGJhciBmb3JtYXR0aW5nIGJ1dHRvbnMgZm9yIG1hcmtkb3duCi8vIEBkZXNjcmlwdGlvbjpydSAgICDQktC60LvRjtGH0LDQtdGCINGE0L7RgNC80LDRgiBNQVJLRE9XTiDQv9C+INGD0LzQvtC70YfQsNC90LjRjiwg0LTQvtCx0LDQstC70Y/QtdGCINGB0L/RgNCw0LLQvtGH0L3Ri9C1INGB0YHRi9C70LrQuCDQv9C+INGE0L7RgNC80LDRgtCw0LwsINC00L7QsdCw0LLQu9GP0LXRgiDQv9Cw0L3QtdC70Ywg0LrQvdC+0L/QvtC6INGE0L7RgNC80LDRgtC40YDQvtCy0LDQvdC40Y8gbWFya2Rvd24KLy8gQGRlc2NyaXB0aW9uOnpoLUNOIOWcqOiuuuWdm+m7mOiupOS9v+eUqCBNYXJrZG93biDmoLzlvI/vvIzmt7vliqDmoLzlvI/luK7liqnpk77mjqXlj4ogTWFya2Rvd24g5bel5YW35qCPCi8vIEBpY29uICAgICAgICAgICAgICBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vZGN1cnRpcy9tYXJrZG93bi1tYXJrL21hc3Rlci9wbmcvNjZ4NDAtc29saWQucG5nCi8vIEBuYW1lc3BhY2UgICAgICAgICB3T3h4T20uc2NyaXB0cwovLyBAdmVyc2lvbiAgICAgICAgICAgMS40LjMKLy8gQGluY2x1ZGUgICAgICAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvKmZvcnVtL2Rpc2N1c3Npb24vKgovLyBAaW5jbHVkZSAgICAgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy8qZm9ydW0vcG9zdC9kaXNjdXNzaW9uKgovLyBAaW5jbHVkZSAgICAgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy8qZm9ydW0vdmFuaWxsYS9wb3N0L2VkaXRkaXNjdXNzaW9uLyoKLy8gQGluY2x1ZGUgICAgICAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvKmZvcnVtL3Bvc3QvZWRpdGRpc2N1c3Npb24vKgovLyBAaW5jbHVkZSAgICAgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy8qc2NyaXB0cy8qL3ZlcnNpb25zL25ldyoKLy8gQGluY2x1ZGUgICAgICAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvKnNjcmlwdF92ZXJzaW9ucy9uZXcqCi8vIEBpbmNsdWRlICAgICAgICAgICBodHRwczovL2dyZWFzeWZvcmsub3JnLypmb3J1bS9tZXNzYWdlcy8qCi8vIEBpbmNsdWRlICAgICAgICAgICBodHRwczovL2dyZWFzeWZvcmsub3JnLypmb3J1bS9wcm9maWxlLyovKgovLyBAaW5jbHVkZSAgICAgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy8qZm9ydW0vcHJvZmlsZQovLyBAaW5jbHVkZSAgICAgICAgICAgaHR0cHM6Ly9mb3J1bS51c2Vyc3R5bGVzLm9yZy9kaXNjdXNzaW9uLyoKLy8gQGluY2x1ZGUgICAgICAgICAgIGh0dHBzOi8vZm9ydW0udXNlcnN0eWxlcy5vcmcvcG9zdC9kaXNjdXNzaW9uKgovLyBAaW5jbHVkZSAgICAgICAgICAgaHR0cHM6Ly9mb3J1bS51c2Vyc3R5bGVzLm9yZy9tZXNzYWdlcy8qCi8vIEBpbmNsdWRlICAgICAgICAgICBodHRwczovL2ZvcnVtLnVzZXJzdHlsZXMub3JnL21lc3NhZ2VzL2FkZCoKLy8gQGluY2x1ZGUgICAgICAgICAgIGh0dHBzOi8vZm9ydW0udXNlcnN0eWxlcy5vcmcvdmFuaWxsYS9wb3N0L2VkaXRkaXNjdXNzaW9uLyoKLy8gQHJ1bi1hdCAgICAgICAgICAgIGRvY3VtZW50LXN0YXJ0Ci8vIEBncmFudCAgICAgICAgICAgICBHTV9hZGRTdHlsZQovLyA9PS9Vc2VyU2NyaXB0PT0KCnZhciBpbkZvcnVtID0gbG9jYXRpb24uaHJlZi5pbmRleE9mKCcvZm9ydW0nKSA+IDA7Cgp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICBpZiAoaW5Gb3J1bSkKICAgIGFkZEZlYXR1cmVzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsW2Zvcj0iRm9ybV9Gb3JtYXQyIl0nKSB8fCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdsYWJlbFtmb3I9IkZvcm1fRm9ybWF0MSJdJykpOwogIGVsc2UKICAgIGlmIChubiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3ZhbHVlPSJtYXJrZG93biJdJykpCiAgICAgIGZvciAodmFyIG4sIGk9MDsgKGk8bm4ubGVuZ3RoKSAmJiAobj1ubltpXSk7IGkrKykgewogICAgICAgIGlmIChsb2NhdGlvbi5ocmVmLmluZGV4T2YoJy9zY3JpcHRfdmVyc2lvbnMvJykpCiAgICAgICAgICBuLmNsaWNrKCk7IC8vIHBvc3RpbmcgYSBuZXcgc2NyaXB0CiAgICAgICAgYWRkRmVhdHVyZXMobi5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpKTsKICAgICAgfQoKICBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpewogICAgZm9yICh2YXIgaT0wLCBtbD1tdXRhdGlvbnMubGVuZ3RoLCBtOyAoaTxtbCkgJiYgKG09bXV0YXRpb25zW2ldKTsgaSsrKQogICAgICBmb3IgKHZhciBqPTAsIG5vZGVzPW0uYWRkZWROb2Rlcywgbmw9bm9kZXMubGVuZ3RoLCBuOyAoajxubCkgJiYgKG49bm9kZXNbal0pOyBqKyspCiAgICAgICAgaWYgKG4ubm9kZVR5cGUgPT0gMSkKICAgICAgICAgIGlmIChpbkZvcnVtKSB7CiAgICAgICAgICAgIGlmICgobi5sb2NhbE5hbWUgPT0gJ2xhYmVsJyAmJiBuLmZvci5tYXRjaCgvRm9ybV9Gb3JtYXRcZC8pKQogICAgICAgICAgICB8fCAobiA9IG4ucXVlcnlTZWxlY3RvcignbGFiZWxbZm9yPSJGb3JtX0Zvcm1hdDIiXScpIHx8IG4ucXVlcnlTZWxlY3RvcignbGFiZWxbZm9yPSJGb3JtX0Zvcm1hdDEiXScpKSkKICAgICAgICAgICAgICByZXR1cm4gYWRkRmVhdHVyZXMobik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoKChuLmxvY2FsTmFtZSA9PSAnaW5wdXQnKSAmJiAobi52YWx1ZSA9PSAnbWFya2Rvd24nKSkKICAgICAgICAgICAgfHwgKG4gPSBuLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3ZhbHVlPSJtYXJrZG93biJdJykpKSB7CiAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhyZWYuaW5kZXhPZignL3NjcmlwdF92ZXJzaW9ucy8nKSkKICAgICAgICAgICAgICAgIG4uY2xpY2soKTsKICAgICAgICAgICAgICByZXR1cm4gYWRkRmVhdHVyZXMobi5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogIH0pLm9ic2VydmUoZG9jdW1lbnQsIHtzdWJ0cmVlOnRydWUsIGNoaWxkTGlzdDp0cnVlfSk7Cn0pOwoKZnVuY3Rpb24gYWRkRmVhdHVyZXMobikgewogIGlmICghbikKICAgIHJldHVybjsKICAKICBpZiAoaW5Gb3J1bSkgewoKICAgIGZvciAodmFyIGZvcm09bjsgKGZvcm0gPSBmb3JtLnBhcmVudE5vZGUpICYmIChmb3JtLmxvY2FsTmFtZSAhPSAnZm9ybScpOyApIHt9CiAgICBpZiAoZm9ybS5hY3Rpb24uaW5kZXhPZignL2VkaXRjb21tZW50LycpIDwgMCkKICAgICAgbi5jbGljaygpOwogICAgbi5wYXJlbnROb2RlLnRleHRBcmVhTm9kZSA9IGZvcm0ucXVlcnlTZWxlY3RvcigndGV4dGFyZWEuVGV4dEJveCwgdGV4dGFyZWEucHJldmlld2FibGUnKTsKICAgIC8vIGFkZCBmb3JtYXR0aW5nIGhlbHAgdG9vbHRpcHMKICAgIG4ucHJldmlvdXNFbGVtZW50U2libGluZy5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsCiAgICAgICAgICAgJyAoPGEgaHJlZj0iL2hlbHAvYWxsb3dlZC1tYXJrdXAiIHRhcmdldD0iX2JsYW5rIiB0aXRsZT0iJysKICAgICAgICAgICAnKiAobmFtZSwgdGl0bGUpLCBhIChocmVmKSwgYWJiciwgYiwgYmxvY2txdW90ZSAoY2l0ZSksIGJyLCBjZW50ZXIsIGNpdGUsIGNvZGUsIGRkLCBkZWwsIGRmbiwgZGl2LCBkbCwgZHQsIGVtLCAnKwogICAgICAgICAgICdoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBociwgaSwgaW5zLCBpbWcgKGFsdCwgaGVpZ2h0LCBzcmMgKGh0dHBzKSwgd2lkdGgpLCBrYmQsIGxpLCBtYXJrLCBvbCwgcCwgcHJlLCBxIChjaXRlKSwgJysKICAgICAgICAgICAncnAsIHJ0LCBydWJ5LCBzLCBzYW1wLCBzbWFsbCwgc3Bhbiwgc3RyaWtlLCBzdHJvbmcsIHR0LCB0YWJsZSwgdGJvZHksIHRmb290LCB0aGVhZCwgdGQsIHRoLCB0ciwgc3ViLCBzdXAsICcrCiAgICAgICAgICAgJ3RpbWUgKGRhdGV0aW1lLCBwdWJkYXRlKSwgdSwgdWwsIHZhciI+PzwvYT4pJyk7CiAgICBuLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywKICAgICAgICAgICAnICg8YSBocmVmPSJodHRwOi8vd3d3LmRhcmtjb2RpbmcubmV0L3NvZnR3YXJlL21hcmtkb3duLXF1aWNrLXJlZmVyZW5jZS8iIHRhcmdldD0iX2JsYW5rIj4/PC9hPiknKTsKICAgIGlmIChsb2NhdGlvbi5ocmVmLmluZGV4T2YoJy9mb3J1bS9tZXNzYWdlcy8nKSA+IC0xKQogICAgICBHTV9hZGRTdHlsZSgnI0NvbnZlcnNhdGlvbkZvcm0gbGFiZWwgeyBkaXNwbGF5OmlubGluZS1ibG9jazsgbWFyZ2luLXJpZ2h0OjJleCB9XAogICAgICAgICAgICAgICAgICAgI0NvbnZlcnNhdGlvbkZvcm0gLlRleHRCb3ggeyBtYXJnaW4tdG9wOjAgfScpOwogIH0gZWxzZSB7CgogICAgZm9yICh2YXIgd3JhcHBlcj1uOyB3cmFwcGVyID0gd3JhcHBlci5wYXJlbnROb2RlOyApCiAgICAgIGlmICh0ID0gd3JhcHBlci5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYVtpZCo9ImFkZGl0aW9uYWwtaW5mbyJdJykpIHsKICAgICAgICBuLnBhcmVudE5vZGUudGV4dEFyZWFOb2RlID0gdDsKICAgICAgICBicmVhazsKICAgICAgfQogICAgR01fYWRkU3R5bGUoJ1wKICAgICAgLkJ1dHRvbiB7XAogICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1wKICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjtcCiAgICAgICAgICBtYXJnaW46IDBweDtcCiAgICAgICAgICBmb250LXNpemU6IDEycHg7XAogICAgICAgICAgbGluZS1oZWlnaHQ6IDE7XAogICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XAogICAgICAgICAgcGFkZGluZzogNHB4IDZweDtcCiAgICAgICAgICBiYWNrZ3JvdW5kOiAtbW96LWxpbmVhci1ncmFkaWVudChjZW50ZXIgYm90dG9tICwgI0NDQyAwJSwgI0ZBRkFGQSAxMDAlKSByZXBlYXQgc2Nyb2xsIDAlIDAlICNGOEY4Rjg7XAogICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgIzk5OTtcCiAgICAgICAgICBib3JkZXItcmFkaXVzOiAycHg7XAogICAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcCiAgICAgICAgICB0ZXh0LXNoYWRvdzogMHB4IDFweCAwcHggI0ZGRjtcCiAgICAgICAgICBib3gtc2hhZG93OiAwcHggMXB4IDBweCAjRkZGIGluc2V0LCAwcHggLTFweCAycHggI0JCQiBpbnNldDtcCiAgICAgICAgICBjb2xvcjogIzMzMzt9Jyk7CiAgfQoKICAvLyBhZGQgYnV0dG9ucwogIGJ0bk1ha2UobiwgJzxiPicrX18oJ0InKSsnPC9iPicsIF9fKCdCb2xkJyksICcqKicpOwogIGJ0bk1ha2UobiwgJzxpPicrX18oJ0knKSsnPC9pPicsIF9fKCdJdGFsaWMnKSwgJyonKTsKICBidG5NYWtlKG4sICc8dT4nK19fKCdVJykrJzwvdT4nLCBfXygnVW5kZXJsaW5lJyksICc8dT4nLCc8L3U+Jyk7CiAgYnRuTWFrZShuLCAnPHM+JytfXygnUycpKyc8L3M+JywgX18oJ1N0cmlrZXRocm91Z2gnKSwgJzxzPicsJzwvcz4nKTsKICBidG5NYWtlKG4sICcmbHQ7YnImZ3Q7JywgX18oJ0ZvcmNlIGxpbmUgYnJlYWsnKSwgJzxicj4nLCcnLCB0cnVlKTsKICBidG5NYWtlKG4sICctLS0nLCBfXygnSG9yaXpvbnRhbCBsaW5lJyksICdcblxuLS0tXG5cbicsICcnLCB0cnVlKTsKICBidG5NYWtlKG4sIF9fKCdVUkwnKSwgX18oJ0FkZCBVUkwgdG8gc2VsZWN0ZWQgdGV4dCcpLCAKICAgICAgICAgIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdHJ5IHtlZFdyYXBJblRhZygnWycsICddKCcrcHJvbXB0KF9fKCdVUkwnKSsnOicpKycpJywgZWRJbml0KGUudGFyZ2V0KSl9CiAgICAgICAgICAgIGNhdGNoKGUpIHt9OwogICAgICAgICAgfSk7CiAgYnRuTWFrZShuLCBfXygnSW1hZ2UgKGh0dHBzKScpLCBfXygnQ29udmVydCBzZWxlY3RlZCBodHRwczovL3VybCB0byBpbmxpbmUgaW1hZ2UnKSwgJyFbJytfXygnaW1hZ2UnKSsnXSgnLCAnKScpOwogIGlmIChpbkZvcnVtKQogICAgYnRuTWFrZShuLCBfXygnVGFibGUnKSwgX18oJ0luc2VydCB0YWJsZSB0ZW1wbGF0ZScpLCBfXygnXG58IGhlYWQxIHwgaGVhZDIgfFxufC0tLS0tLS18LS0tLS0tLXxcbnwgY2VsbDEgfCBjZWxsMiB8XG58IGNlbGwzIHwgY2VsbDQgfFxuJyksICcnLCB0cnVlKTsKICBidG5NYWtlKG4sIF9fKCdDb2RlJyksIF9fKCdBcHBseSBDT0RFIG1hcmtkb3duIHRvIHNlbGVjdGVkIHRleHQnKSwKICAgICAgICAgIGZ1bmN0aW9uKGUpewogICAgICAgICAgICB2YXIgZWQgPSBlZEluaXQoZS50YXJnZXQpOwogICAgICAgICAgICBpZiAoZWQuc2VsLmluZGV4T2YoJ1xuJykgPCAwKQogICAgICAgICAgICAgIGVkV3JhcEluVGFnKCdgJywgJ2AnLCBlZCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICBlZFdyYXBJblRhZygoKGVkLnNlbDE9PTApIHx8IChlZC50ZXh0LmNoYXJBdChlZC5zZWwxLTEpID09ICdcbicpID8gJycgOiAnXG4nKSArICdgYGAnICsgKGVkLnNlbC5jaGFyQXQoMCkgPT0gJ1xuJyA/ICcnIDogJ1xuJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgKGVkLnNlbC5zdWJzdHIoLTEpID09ICdcbicgPyAnJyA6ICdcbicpICsgJ2BgYCcgKyAoZWQudGV4dC5zdWJzdHIoZWQuc2VsMiwxKSA9PSAnXG4nID8gJycgOiAnXG4nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBlZCk7CiAgICAgICAgICB9KTsKfQoKZnVuY3Rpb24gYnRuTWFrZShhZnRlck5vZGUsIGxhYmVsLCB0aXRsZSwgdGFnMV9vcl9jYiwgdGFnMiwgbm9XcmFwKSB7CiAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgYS5jbGFzc05hbWUgPSAnQnV0dG9uJzsKICBhLmlubmVySFRNTCA9IGxhYmVsOwogIGEudGl0bGUgPSB0aXRsZTsKICBpZiAoaW5Gb3J1bSkKICAgIGEuc3R5bGUuc2V0UHJvcGVydHkoJ2Zsb2F0JywncmlnaHQnKTsKICBhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywKICAgICAgICAgICAgdHlwZW9mKHRhZzFfb3JfY2IpID09ICdmdW5jdGlvbicKICAgICAgICAgICAgICAgICAgICAgPyB0YWcxX29yX2NiCiAgICAgICAgICAgICAgICAgICAgIDogbm9XcmFwID8gZnVuY3Rpb24oZSl7ZWRJbnNlcnRUZXh0KHRhZzFfb3JfY2IsIGVkSW5pdChlLnRhcmdldCkpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKGUpe2VkV3JhcEluVGFnKHRhZzFfb3JfY2IsIHRhZzIsIGVkSW5pdChlLnRhcmdldCkpfSk7CiAgdmFyIG5wYXJlbnQgPSBhZnRlck5vZGUucGFyZW50Tm9kZTsKICBhLnRleHRBcmVhTm9kZSA9IG5wYXJlbnQudGV4dEFyZWFOb2RlOwogIGluRm9ydW0gPyBucGFyZW50Lmluc2VydEJlZm9yZShhLCBucGFyZW50LmZpcnN0RWxlbWVudENoaWxkKSA6IG5wYXJlbnQuYXBwZW5kQ2hpbGQoYSk7Cn0KCmZ1bmN0aW9uIGVkSW5pdChidG4pIHsKICB2YXIgZWQgPSB7bm9kZTogYnRuLnRleHRBcmVhTm9kZSB8fCBidG4ucGFyZW50Tm9kZS50ZXh0QXJlYU5vZGV9CiAgZWQuc2VsMSA9IGVkLm5vZGUuc2VsZWN0aW9uU3RhcnQ7CiAgZWQuc2VsMiA9IGVkLm5vZGUuc2VsZWN0aW9uRW5kLAogIGVkLnRleHQgPSBlZC5ub2RlLnZhbHVlOwogIGVkLnNlbCA9IGVkLnRleHQuc3Vic3RyaW5nKGVkLnNlbDEsIGVkLnNlbDIpOwogIHJldHVybiBlZDsKfQoKZnVuY3Rpb24gZWRXcmFwSW5UYWcodGFnMSwgdGFnMiwgZWQpIHsKICBlZC5ub2RlLnZhbHVlID0gZWQudGV4dC5zdWJzdHIoMCwgZWQuc2VsMSkgKyB0YWcxICsgZWQuc2VsICsgKHRhZzI/dGFnMjp0YWcxKSArIGVkLnRleHQuc3Vic3RyKGVkLnNlbDIpOwogIGVkLm5vZGUuc2V0U2VsZWN0aW9uUmFuZ2UoZWQuc2VsMSArIHRhZzEubGVuZ3RoLCBlZC5zZWwxICsgdGFnMS5sZW5ndGggKyBlZC5zZWwubGVuZ3RoKTsKICBlZC5ub2RlLmZvY3VzKCk7Cn0KCmZ1bmN0aW9uIGVkSW5zZXJ0VGV4dCh0ZXh0LCBlZCkgewogIGVkLm5vZGUudmFsdWUgPSBlZC50ZXh0LnN1YnN0cigwLCBlZC5zZWwyKSArIHRleHQgKyBlZC50ZXh0LnN1YnN0cihlZC5zZWwyKTsKICBlZC5ub2RlLnNldFNlbGVjdGlvblJhbmdlKGVkLnNlbDIgKyB0ZXh0Lmxlbmd0aCwgZWQuc2VsMiArIHRleHQubGVuZ3RoKTsKICBlZC5ub2RlLmZvY3VzKCk7Cn0KCnZhciBfXyA9IChmdW5jdGlvbiAobCwgbGFuZ3MpIHsKICAgIHZhciBsYW5nID0gbGFuZ3NbbF0gfHwgbGFuZ3NbbC5yZXBsYWNlKC8tLisvLCAnJyldOwogICAgcmV0dXJuIGxhbmcgPyBmdW5jdGlvbiAodGV4dCkgeyByZXR1cm4gbGFuZ1t0ZXh0XSB8fCB0ZXh0OyB9CiAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uICh0ZXh0KSB7IHJldHVybiB0ZXh0OyB9IC8vIE5vIG1hdGNoaW5nIGxhbmd1YWdlLCBmYWxsYmFjayB0byBlbmdsaXNoCn0pKGxvY2F0aW9uLnBhdGhuYW1lLm1hdGNoKC9eXC8oLis/KVwvLylbMV0sIHsKICAvLyBDYW4gYmUgZnVsbCBuYW1lLCBvciBqdXN0IHRoZSBiZWdpbm5pbmcgcGFydC4KICAnemgtQ04nOiB7CiAgICAnQm9sZCc6ICfnspfkvZMnLAogICAgJ0l0YWxpYyc6ICfmlpzkvZMnLAogICAgJ1VuZGVybGluZSc6ICfkuIvliJLnur8nLAogICAgJ1N0cmlrZXRocm91Z2gnOiAn5Yig6Zmk57q/JywKICAgICdGb3JjZSBsaW5lIGJyZWFrJzogJ+W8uuWItuaNouihjCcsCiAgICAnSG9yaXpvbnRhbCBsaW5lJzogJ+awtOW5s+WIhuWJsue6vycsCiAgICAnVVJMJzogJ+mTvuaOpScsCiAgICAnQWRkIFVSTCB0byBzZWxlY3RlZCB0ZXh0JzogJ+S4uuaJgOmAieaWh+Wtl+a3u+WKoOmTvuaOpScsCiAgICAnSW1hZ2UgKGh0dHBzKSc6ICflm77niYcgKGh0dHBzKScsCiAgICAnQ29udmVydCBzZWxlY3RlZCBodHRwczovL3VybCB0byBpbmxpbmUgaW1hZ2UnOiAn5bCG5omA6YCJ5Zyw5Z2A6L2s5o2i5Li66KGM5YaF5Zu+54mHJywKICAgICdpbWFnZSc6ICflm77niYfmj4/ov7AnLCAvLyBEZWZhdWx0IGltYWdlIGFsdCB2YWx1ZQogICAgJ1RhYmxlJzogJ+ihqOagvCcsCiAgICAnSW5zZXJ0IHRhYmxlIHRlbXBsYXRlJzogJ+aPkuWFpeihqOagvOaooeadvycsCiAgICAnQ29kZSc6ICfku6PnoIEnLAogICAgJ0FwcGx5IENPREUgbWFya2Rvd24gdG8gc2VsZWN0ZWQgdGV4dCc6ICflsIbpgInkuK3ku6PnoIHlm7TotbfmnaUnLAoKICAgICdcbnwgaGVhZDEgfCBoZWFkMiB8XG58LS0tLS0tLXwtLS0tLS0tfFxufCBjZWxsMSB8IGNlbGwyIHxcbnwgY2VsbDMgfCBjZWxsNCB8XG4nOgogICAgJ1xufCDooajlpLQgMSB8IOihqOWktCAyIHxcbnwtLS0tLS0tfC0tLS0tLS18XG58IOihqOagvCAxIHwg6KGo5qC8IDIgfFxufCDooajmoLwgMyB8IOihqOagvCA0IHxcbicKICB9LAogICdydSc6IHsKICAgICdCJzogJ9CWJywKICAgICdJJzogJ9CaJywKICAgICdVJzogJ9CnJywKICAgICdTJzogJ9CfJywKICAgICdCb2xkJzogJ9CW0LjRgNC90YvQuScsCiAgICAnSXRhbGljJzogJ9Ca0YPRgNGB0LjQsicsCiAgICAnVW5kZXJsaW5lJzogJ9Cf0L7QtNGH0LXRgNC60L3Rg9GC0YvQuScsCiAgICAnU3RyaWtldGhyb3VnaCc6ICfQn9C10YDQtdGH0LXRgNC60L3Rg9GC0YvQuScsCiAgICAnRm9yY2UgbGluZSBicmVhayc6ICfQndC+0LLQsNGPINGB0YLRgNC+0LrQsCcsCiAgICAnSG9yaXpvbnRhbCBsaW5lJzogJ9CT0L7RgNC40LfQvtC90YLQsNC70YzQvdCw0Y8g0LvQuNC90LjRjycsCiAgICAnVVJMJzogJ9GB0YHRi9C70LrQsCcsCiAgICAnQWRkIFVSTCB0byBzZWxlY3RlZCB0ZXh0JzogJ9CU0L7QsdCw0LLQuNGC0Ywg0YHRgdGL0LvQutGDINC6INCy0YvQtNC10LvQtdC90L3QvtC80YMg0YLQtdC60YHRgtGDJywKICAgICdJbWFnZSAoaHR0cHMpJzogJ9Ca0LDRgNGC0LjQvdC60LAgKGh0dHBzKScsCiAgICAnQ29udmVydCBzZWxlY3RlZCBodHRwczovL3VybCB0byBpbmxpbmUgaW1hZ2UnOiAn0J/RgNC10L7QsdGA0LDQt9C+0LLQsNGC0Ywg0LLRi9C00LXQu9C10L3QvdGL0LkgaHR0cHM6Ly8g0LDQtNGA0LXRgSDQsiDQutCw0YDRgtC40L3QutGDJywKICAgICdpbWFnZSc6ICfQutCw0YDRgtC40L3QutCwJywgLy8gRGVmYXVsdCBpbWFnZSBhbHQgdmFsdWUKICAgICdUYWJsZSc6ICfQotCw0LHQu9C40YbQsCcsCiAgICAnSW5zZXJ0IHRhYmxlIHRlbXBsYXRlJzogJ9CS0YHRgtCw0LLQuNGC0Ywg0YjQsNCx0LvQvtC9INGC0LDQsdC70LjRhtGLJywKICAgICdDb2RlJzogJ9Ca0L7QtCcsCiAgICAnQXBwbHkgQ09ERSBtYXJrZG93biB0byBzZWxlY3RlZCB0ZXh0JzogJ9Cf0L7QvNC10YLQuNGC0Ywg0LLRi9C00LXQu9C10L3QvdGL0Lkg0YTRgNCw0LPQvNC10L3RgiDQutCw0Log0L/RgNC+0LPRgNCw0LzQvNC90YvQuSDQutC+0LQnLAoKICAgICdcbnwgaGVhZDEgfCBoZWFkMiB8XG58LS0tLS0tLXwtLS0tLS0tfFxufCBjZWxsMSB8IGNlbGwyIHxcbnwgY2VsbDMgfCBjZWxsNCB8XG4nOgogICAgJ1xufCDQt9Cw0LPQvtC70L7QstC+0LoxIHwg0LfQsNCz0L7Qu9C+0LLQvtC6MiB8XG58LS0tLS0tLXwtLS0tLS0tfFxufCDRj9GH0LXQudC60LAxIHwg0Y/Rh9C10LnQutCwMiB8XG58INGP0YfQtdC50LrQsDMgfCDRj9GH0LXQudC60LA0IHxcbicKICB9LAogICdmcic6IHsKICAgICdCJzogJ0cnLAogICAgJ0knOiAnSScsCiAgICAnVSc6ICdTJywKICAgICdTJzogJ0InLAogICAgJ0JvbGQnOiAnR3JhcycsCiAgICAnSXRhbGljJzogJ0l0YWxpcXVlJywKICAgICdVbmRlcmxpbmUnOiAnU291bGlnbsOpJywKICAgICdTdHJpa2V0aHJvdWdoJzogJ0JhcnLDqScsCiAgICAnRm9yY2UgbGluZSBicmVhayc6ICdGb3JjZXIgbGUgc2F1dCBkZSBsaWduZScsCiAgICAnSG9yaXpvbnRhbCBsaW5lJzogJ0xpZ25lIGhvcml6b250YWxlJywKICAgICdVUkwnOiAnVVJMJywKICAgICdBZGQgVVJMIHRvIHNlbGVjdGVkIHRleHQnOiAnQWpvdXRlciBVUkwgYXUgdGV4dGUgc8OpbGVjdGlvbm7DqScsCiAgICAnSW1hZ2UgKGh0dHBzKSc6ICdJbWFnZSAoaHR0cHMpJywKICAgICdDb252ZXJ0IHNlbGVjdGVkIGh0dHBzOi8vdXJsIHRvIGlubGluZSBpbWFnZSc6ICdDb252ZXJ0aXIgaHR0cHM6Ly91cmwgc8OpbGVjdGlvbm7DqXMgZW4gaW1hZ2VzJywKICAgICdpbWFnZSc6ICdpbWFnZScsIC8vIERlZmF1bHQgaW1hZ2UgYWx0IHZhbHVlCiAgICAnVGFibGUnOiAnVGFibGVhdScsCiAgICAnSW5zZXJ0IHRhYmxlIHRlbXBsYXRlJzogJ0luc8OpcmVyIHVuIG1vZMOobGUgZGUgdGFibGUnLAogICAgJ0NvZGUnOiAnQ29kZScsCiAgICAnQXBwbHkgQ09ERSBtYXJrZG93biB0byBzZWxlY3RlZCB0ZXh0JzogJ0FwcGxpcXVlciBDT0RFIG1hcmtkb3duIGF1IHRleHRlIHPDqWxlY3Rpb25uw6knLAoKICAgICdcbnwgaGVhZDEgfCBoZWFkMiB8XG58LS0tLS0tLXwtLS0tLS0tfFxufCBjZWxsMSB8IGNlbGwyIHxcbnwgY2VsbDMgfCBjZWxsNCB8XG4nOgogICAgJ1xufCBFbi10w6p0ZSAxIHwgRW4tdMOqdGUgMiB8XG58LS0tLS0tLXwtLS0tLS0tfFxufCBjZWxsdWxlIDEgfCBjZWxsdWxlIDIgfFxufCBjZWxsdWxlIDMgfCBjZWxsdWxlIDQgfFxuJwogIH0KfSk7"},{"name":"Better Styling for Chrome Extension: Quick Tabs","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://*","http://*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1470515788848,"data":{}},"enabled":false,"position":28,"uuid":"c579cc31-9b02-41e4-b74e-e6a46c55bc66","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgQmV0dGVyIFN0eWxpbmcgZm9yIENocm9tZSBFeHRlbnNpb246IFF1aWNrIFRhYnMKLy8gQG5hbWVzcGFjZSAgICAgaHR0cDovL3VzZXJzdHlsZXMub3JnCi8vIEBkZXNjcmlwdGlvbgkgIFNQRUNJQUwgSU5TVEFMTEFUSU9OIElOU1RSVUNUSU9OUyAtIERPIE5PVCBJTlNUQUxMIFdJVEggU1RZTElTSAovLyBAYXV0aG9yICAgICAgICBCdW5ueXNsaXBwZXJzCi8vIEBob21lcGFnZSAgICAgIGh0dHBzOi8vdXNlcnN0eWxlcy5vcmcvc3R5bGVzLzk5OTM4Ci8vIEBpbmNsdWRlICAgICAgIGh0dHBzOi8vKgovLyBAaW5jbHVkZSAgICAgICBodHRwOi8vKgovLyBAZ3JhbnQgICAgICAgICBHTV9hZGRTdHlsZQovLyBAcnVuLWF0ICAgICAgICBkb2N1bWVudC1zdGFydAovLyBAdmVyc2lvbiAgICAgICAwLjIwMTYwMzI1MTAwNzE0Ci8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24oKSB7dmFyIGNzcyA9IFsKCSIvKnYyLjEgVXBkYXRlZCAzLjI1LjE2Ki8iLAoJIiIsCgkiYm9keSB7IiwKCSJtYXgtaGVpZ2h0OiA2MDBweDsiLAoJIndpZHRoOjc1MHB4OyIsCgkifSIsCgkiIiwKCSJkaXYge2JveC1zaXppbmc6Ym9yZGVyLWJveH0iLAoJIiIsCgkiIiwKCSIucXNfd3JhcHBlciB7IiwKCSJmbG9hdDpsZWZ0OyIsCgkid2lkdGg6MTAwJTsiLAoJIm1hcmdpbjowIDAgNHB4IDA7IiwKCSJwYWRkaW5nLWxlZnQ6IDEwcHg7IiwKCSJ9IiwKCSIiLAoJIi5xc19pbnB1dCB7IiwKCSJtYXJnaW46IDRweCAwIDAgMHB4OyIsCgkiaGVpZ2h0OjMycHg7IiwKCSJ3aWR0aDo5NyU7IiwKCSJib3JkZXItcmFkaXVzOiA1cHg7IiwKCSJkaXNwbGF5OiBibG9jazsiLAoJImZsb2F0OiBsZWZ0OyIsCgkiYmFja2dyb3VuZC1jb2xvcjogcmdiKDIxNSwgMjM1LCAxMzkpOyIsCgkiYm9yZGVyOiAxcHggc29saWQgcmdiKDE1MywgMTUzLCAxNTMpOyIsCgkifSIsCgkiIiwKCSIudGFiLCAuYm9va21hcmssIGRpdi5zZXBhcmF0b3IuYmlnIHsiLAoJImJvcmRlcjogMXB4IHNvbGlkICNEMkNDQ0M7IiwKCSJwYWRkaW5nOiA1cHg7IiwKCSIvKiBwYWRkaW5nLWJvdHRvbTogNXB4OyAqLyIsCgkiYm9yZGVyLXJhZGl1czogNXB4OyIsCgkibWFyZ2luLWJvdHRvbTogM3B4OyIsCgkibWFyZ2luLXJpZ2h0OiAyJTsiLAoJImJveC1zaGFkb3c6IDJweCAycHggNXB4ICNhYWE7IiwKCSJ3aWR0aDogMzElOyIsCgkiZmxvYXQ6bGVmdDsiLAoJImRpc3BsYXk6aW5saW5lOyIsCgkiLypjb2xvcjogcmdiKDMyLDYxLDExNik7Ki8iLAoJImNsZWFyOm5vbmU7IiwKCSJjb2xvcjogcmdiKDI5LCAxMDEsIDE1OCk7IiwKCSJmb250LXdlaWdodDogNTAwOyIsCgkiYmFja2dyb3VuZC1pbWFnZTogLW1vei1saW5lYXItZ3JhZGllbnQodG9wLCAgcmdiYSgwLDAsMCwwKSAwJSwgcmdiYSgxMjIsMTIyLDEyMiwwLjE4KSA5OSUsIHJnYmEoMTIyLDEyMiwxMjIsMC4xOCkgMTAwJSk7IiwKCSJiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWdyYWRpZW50KGxpbmVhciwgbGVmdCB0b3AsIGxlZnQgYm90dG9tLCBjb2xvci1zdG9wKDAlLHJnYmEoMCwwLDAsMCkpLCBjb2xvci1zdG9wKDk5JSxyZ2JhKDEyMiwxMjIsMTIyLDAuMTgpKSwgY29sb3Itc3RvcCgxMDAlLHJnYmEoMTIyLDEyMiwxMjIsMC4xOCkpKTsiLAoJImJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KHRvcCwgIHJnYmEoMCwwLDAsMCkgMCUscmdiYSgxMjIsMTIyLDEyMiwwLjE4KSA5OSUscmdiYSgxMjIsMTIyLDEyMiwwLjE4KSAxMDAlKTsiLAoJImJhY2tncm91bmQtaW1hZ2U6IC1vLWxpbmVhci1ncmFkaWVudCh0b3AsICByZ2JhKDAsMCwwLDApIDAlLHJnYmEoMTIyLDEyMiwxMjIsMC4xOCkgOTklLHJnYmEoMTIyLDEyMiwxMjIsMC4xOCkgMTAwJSk7IiwKCSJiYWNrZ3JvdW5kLWltYWdlOiAtbXMtbGluZWFyLWdyYWRpZW50KHRvcCwgIHJnYmEoMCwwLDAsMCkgMCUscmdiYSgxMjIsMTIyLDEyMiwwLjE4KSA5OSUscmdiYSgxMjIsMTIyLDEyMiwwLjE4KSAxMDAlKTsiLAoJImJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sICByZ2JhKDAsMCwwLDApIDAlLHJnYmEoMTIyLDEyMiwxMjIsMC4xOCkgOTklLHJnYmEoMTIyLDEyMiwxMjIsMC4xOCkgMTAwJSk7IiwKCSJvdmVyZmxvdzogaGlkZGVuOyIsCgkiaGVpZ2h0OiAzLjVlbTsiLAoJIn0iLAoJIiIsCgkiLyoiLAoJImRpdi50YWJpbWFnZSB7IiwKCSJmbG9hdDogbGVmdDsiLAoJIn0iLAoJIiAqLyIsCgkiIiwKCSJkaXYudGFiaW1hZ2UgaW1nIHsiLAoJInZlcnRpY2FsLWFsaWduOiBtaWRkbGU7IiwKCSJwYWRkaW5nOiA0cHg7IiwKCSJwYWRkaW5nLWxlZnQ6IDA7IiwKCSJ9IiwKCSIiLAoJImRpdi5jb250ZW50IHsiLAoJIm1hcmdpbjogNHB4IDA7IiwKCSJwYWRkaW5nOjA7IiwKCSJwYWRkaW5nLWxlZnQ6IDEwcHg7IiwKCSJmbG9hdDogbGVmdDsiLAoJImhlaWdodDo2MDBweDsiLAoJIndpZHRoOjEwMCU7IiwKCSJ9IiwKCSIiLAoJIi5oaWdobGlnaHQgeyIsCgkidGV4dC1kZWNvcmF0aW9uOiBub25lOyIsCgkiYm9yZGVyLWJvdHRvbS13aWR0aDoxcHg7IiwKCSJib3JkZXItYm90dG9tLXN0eWxlOmRvdHRlZDsiLAoJIn0iLAoJIiIsCgkiLndpdGhmb2N1cyB7IiwKCSJiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDI1NSwxNDYsMTAsLjcpOyIsCgkiLypmb250LXdlaWdodDogNDAwOyovIiwKCSIiLAoJIn0iLAoJIiIsCgkiZGl2LmNsb3NlZCB7IiwKCSJiYWNrZ3JvdW5kLWltYWdlOiBub25lOyIsCgkiLyogYmFja2dyb3VuZC1jb2xvcjogI2RmZGZkZjsgKi8iLAoJIm9wYWNpdHk6IC42OyIsCgkiY29sb3I6ICM1NTU7IiwKCSJ9IiwKCSIiLAoJImRpdi5jbG9zZWQud2l0aGZvY3VzIHtiYWNrZ3JvdW5kLWNvbG9yOnJnYmEoMjU1LDE0NiwxMCwuNCk7IiwKCSJ9IiwKCSIiLAoJImRpdi5jbG9zZWQud2l0aGZvY3VzIGRpdi50aXRsZSB7IiwKCSJiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsiLAoJIn0iLAoJIiIsCgkiZGl2LnVybCB7IiwKCSJjb2xvcjogIzc3NzsiLAoJIiAgd2lkdGg6IDcxJTsiLAoJIiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7IiwKCSIgIHdoaXRlLXNwYWNlOiBub3dyYXA7IiwKCSIgIG92ZXJmbG93OiBoaWRkZW47IiwKCSJ9IiwKCSIiLAoJImRpdi5jbG9zZSB7IiwKCSJmbG9hdDogcmlnaHQ7IiwKCSJkaXNwbGF5OiBpbmxpbmU7IiwKCSJvcGFjaXR5OiAuNTsiLAoJImJvcmRlcjogMXB4IHNvbGlkICM5OTkxOTE7IiwKCSJiYWNrZ3JvdW5kLWNvbG9yOiAjRjFFRUEwOyIsCgkiYm9yZGVyLXJhZGl1czogM3B4OyIsCgkidG9wOiAwICFpbXBvcnRhbnQ7IiwKCSJyaWdodDogMCAhaW1wb3J0YW50OyIsCgkifSIsCgkiIiwKCSJkaXYud2l0aGZvY3VzLm9wZW4gZGl2LmNsb3NlIHsiLAoJInRvcDogMCAhaW1wb3J0YW50OyIsCgkicmlnaHQ6IDAgIWltcG9ydGFudDsiLAoJIn0iLAoJImRpdi5jbG9zZTpob3ZlciB7b3BhY2l0eToxO2JhY2tncm91bmQtY29sb3I6IHJnYigyMzUsIDE5LCAxOSkgIWltcG9ydGFudDt9IiwKCSIiLAoJIi50aXRsZSB7b3ZlcmZsb3c6IGhpZGRlbjsgd2lkdGg6IDcxJTt9IiwKCSIiLAoJImRpdi5zZXBhcmF0b3IuYmlnIHsiLAoJIiAgY29sb3I6ICMyMTIxMjE7IiwKCSIgICAgaGVpZ2h0OiAyZW07IiwKCSJmb250LXNpemU6MTJweDsiLAoJIiAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDE5OCwgMjEyLCAyNTUpOyIsCgkicGFkZGluZzowOyIsCgkid2lkdGg6OTclIiwKCSJ9IiwKCSIiLAoJImRpdi5zZXBhcmF0b3IuYmlnOmJlZm9yZSwgZGl2LnNlcGFyYXRvci5iaWc6YWZ0ZXIgeyIsCgkiICBjb250ZW50OiBcIuKWvFwiOyIsCgkifSIsCgkiIiwKCSIiLAoJImRpdi5zZXBhcmF0b3IuYmlnIHNwYW4geyIsCgkiICAiLAoJIiAgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOyIsCgkiICAiLAoJIn0iLAoJIiIsCgkiIC53aXRoZm9jdXMgZGl2LnRpdGxlLCBkaXYuY2xvc2VkLndpdGhmb2N1cyBkaXYudGl0bGUsIC53aXRoZm9jdXMgZGl2LnVybCB7IiwKCSIgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OyIsCgkiICBjb2xvcjogaW5oZXJpdDsiLAoJIn0iLAoJIiIsCgkiIiwKCSIiLAoJImRpdi50YWJpbWFnZSBpbWcgeyIsCgkiYmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsiLAoJIn0iLAoJIi5ib29rbWFyayBkaXYge2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7fSIsCgkiLmJvb2ttYXJrIHsiLAoJIiAgYmFja2dyb3VuZC1jb2xvcjogcmdiKDIzMCwgMjQwLCAxOTApOyIsCgkiICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjA3KTsiLAoJIn0iLAoJIiIsCgkiLndpdGhmb2N1cyB7IiwKCSIgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAxNDYsIDEwLCAwLjcpICFpbXBvcnRhbnQ7IiwKCSIgIGNvbG9yOiM3Nzc7IiwKCSJ9IiwKCSIiLAoJIi8qIGkgcmVhbGx5IHdhbnQgdGhpcyB0byBiZSBnbG9iYWwgKi8iCl0uam9pbigiXG4iKTsKaWYgKHR5cGVvZiBHTV9hZGRTdHlsZSAhPSAidW5kZWZpbmVkIikgewoJR01fYWRkU3R5bGUoY3NzKTsKfSBlbHNlIGlmICh0eXBlb2YgUFJPX2FkZFN0eWxlICE9ICJ1bmRlZmluZWQiKSB7CglQUk9fYWRkU3R5bGUoY3NzKTsKfSBlbHNlIGlmICh0eXBlb2YgYWRkU3R5bGUgIT0gInVuZGVmaW5lZCIpIHsKCWFkZFN0eWxlKGNzcyk7Cn0gZWxzZSB7Cgl2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7Cglub2RlLnR5cGUgPSAidGV4dC9jc3MiOwoJbm9kZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3MpKTsKCXZhciBoZWFkcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIik7CglpZiAoaGVhZHMubGVuZ3RoID4gMCkgewoJCWhlYWRzWzBdLmFwcGVuZENoaWxkKG5vZGUpOyAKCX0gZWxzZSB7CgkJLy8gbm8gaGVhZCB5ZXQsIHN0aWNrIGl0IHdoZXJlZXZlcgoJCWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTsKCX0KfQp9KSgpOwo="},{"name":"Focus input text field on Esc","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1469646891387,"data":{}},"enabled":false,"position":29,"file_url":"https://greasyfork.org/scripts/9525-focus-input-text-field-on-esc/code/Focus%20input%20text%20field%20on%20Esc.user.js","uuid":"3bea198d-a20c-48eb-874a-6c73abd5eed5","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgRm9jdXMgaW5wdXQgdGV4dCBmaWVsZCBvbiBFc2MKLy8gQGRlc2NyaXB0aW9uICAgRm9jdXMgdGhlIGZpcnN0IHZpc2libGUgaW5wdXQgdGV4dCBmaWVsZCB3aGVuIHlvdSBwcmVzcyBFc2Mga2V5LCBvciByZXN0b3JlIHRoZSBwcmV2aW91c2x5IGZvY3VzZWQgZWxlbWVudCBvbiBzZWNvbmQgcHJlc3MKLy8gQHZlcnNpb24gICAgICAgMS4wLjQKLy8gQGluY2x1ZGUgICAgICAgKgovLyBAYXV0aG9yICAgICAgICB3T3h4T20KLy8gQG5hbWVzcGFjZSAgICAgd094eE9tLnNjcmlwdHMKLy8gQGxpY2Vuc2UgICAgICAgTUlUIExpY2Vuc2UKLy8gQHJ1bi1hdCAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gPT0vVXNlclNjcmlwdD09Cgp2YXIgVEVYVF9GSUVMRCA9ICcgc2VhcmNoIHRleHQgbnVtYmVyIHVybCAnOwp2YXIgcHJldmlvdXNFbGVtZW50Owp2YXIgZmlyc3Q7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkgewoJaWYgKGUua2V5Q29kZSAhPSAyNyB8fCBlLmFsdEtleSB8fCBlLmN0cmxLZXkgfHwgZS5zaGlmdEtleSB8fCBlLm1ldGFLZXkpCgkJcmV0dXJuOwoJLy8gZmluZCB0ZXh0IGlucHV0cyBpbnNpZGUgdmlzaWJsZSBET00gY29udGFpbmVycwoJdmFyIGlucHV0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbnB1dCcpOwoJZm9yICh2YXIgaT0wLCBpbnB1dCwgaWw9aW5wdXRzLmxlbmd0aDsgaTxpbCAmJiAoaW5wdXQ9aW5wdXRzW2ldKTsgaSsrKSB7CgkJdmFyIHByaW9yaXR5ID0gVEVYVF9GSUVMRC5pbmRleE9mKCcgJytpbnB1dC50eXBlKycgJyk7CgkJaWYgKHByaW9yaXR5ID49IDApIHsKCQkJdmFyIG49aW5wdXQsIHN0eWxlOwoJCQl3aGlsZSAobiAmJiBuLnN0eWxlICYmIChzdHlsZT1nZXRDb21wdXRlZFN0eWxlKG4pKSAmJiBzdHlsZS5kaXNwbGF5IT0nbm9uZScgJiYgc3R5bGUudmlzaWJpbGl0eSE9J2hpZGRlbicpCgkJCQluID0gbi5wYXJlbnROb2RlOwoJCQlpZiAoIW4gfHwgIW4uc3R5bGUpIHsKCQkJCWlmICghZmlyc3QgLy8gc2V0IHRoZSBmaXJzdCBPUiBpZiBpdCdzIGVtcHR5LCB0cnkgdG8gc2VsZWN0IGFuIGlkZW50aWNhbGx5IG5hbWVkIGlucHV0IGZpZWxkIHdpdGggc29tZSB0ZXh0IChoYXBwZW5zIG9uIHNvbWUgc2l0ZXMpCgkJCQkJCXx8IChpbnB1dC52YWx1ZSAmJiBpbnB1dC5uYW1lID09IGZpcnN0Lm5hbWUgJiYgKCFpbnB1dC5mb3JtICYmICFmaXJzdC5mb3JtIHx8IGlucHV0LmZvcm0uYWN0aW9uID09IGZpcnN0LmZvcm0uYWN0aW9uKSkpIHsKCQkJCQlmaXJzdCA9IGlucHV0OwoJCQkJCWlmIChmaXJzdC52YWx1ZSkKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJaWYgKGZpcnN0KSB7CgkJaWYgKGZpcnN0ICE9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsKCQkJLy8gc3dpdGNoIHRvIHRoZSBmb3VuZCBpbnB1dCBmaWVsZAoJCQlwcmV2aW91c0VsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50OwoJCQlvbmtleXVwKGZ1bmN0aW9uKCl7CgkJCQlmaXJzdC5mb2N1cygpOwoJCQkJZmlyc3Quc2VsZWN0KCk7CgkJCX0pOwoJCX0gZWxzZSBpZiAocHJldmlvdXNFbGVtZW50KSB7CgkJCS8vIHJlc3RvcmUgZm9jdXMgdG8gdGhlIGVsZW1lbnQgZnJvbSB3aGljaCB3ZSBqdW1wZWQgdG8gYW4gaW5wdXQgZmllbGQgcHJldmlvdXNseQoJCQlvbmtleXVwKGZ1bmN0aW9uKCl7CgkJCQlkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTsgLy8gaW4gY2FzZSBkb2N1bWVudC5ib2R5IChwYWdlICJiYWNrZ3JvdW5kIikgd2FzIHByZXZpb3VzbHkgc2VsZWN0ZWQKCQkJCXByZXZpb3VzRWxlbWVudC5mb2N1cygpOwoJCQl9KTsKCQl9Cgl9CgoJLy8gZm9jdXNpbmcgc2hvdWxkIGJlIGRvbmUgYXQga2V5LXVwIHRvIHByZXZlbnQgdGhlIEVzYy1rZXlkb3duIGJlaW5nIGFsc28gY2hhaW4taGFuZGxlZCBieSB0aGUganVzdCBmb2N1c2VkIGVsZW1lbnQKCWZ1bmN0aW9uIG9ua2V5dXAoY2IpIHsKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uIGtleXVwKGUpIHsKCQkJaWYgKGUua2V5Q29kZSA9PSAyNykgewoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBrZXl1cCk7CgkJCQljYihlKTsKCQkJfQoJCX0pOwoJfQp9KTsK"},{"name":"HabraGoogle","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http://*habrahabr.ru/*","https://*habrahabr.ru/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1470897453851,"data":{}},"enabled":false,"position":30,"file_url":"http://linux.ria.ua/HabraGoogle/download/habragoogle.user.js","uuid":"18a1be30-99ae-4bfb-8881-046dad2a668d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgIEhhYnJhR29vZ2xlCi8vIEBuYW1lc3BhY2UgICAgICBodHRwOi8vbGludXgucmlhLnVhCi8vIEBkZXNjcmlwdGlvbiAgICBHb29nbGUgU2VhcmNoIGZvciBIYWJyYUhhYnIucnUKLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly8qaGFicmFoYWJyLnJ1LyoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vKmhhYnJhaGFici5ydS8qCi8vIEBzb3VyY2UgICAgICAgICBodHRwOi8vbGludXgucmlhLnVhL2hhYnJhZ29vZ2xlLwovLyBAdmVyc2lvbiAgICAgICAgMC4xCi8vID09L1VzZXJTY3JpcHQ9PQoKdmFyIGhnQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKaGdCdXR0b24uc2V0QXR0cmlidXRlKCd0eXBlJywgJ2J1dHRvbicpOwpoZ0J1dHRvbi5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZ3NlYXJjaCcpOwpoZ0J1dHRvbi5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgJ0hhYnJhR29vZ2xlID4nKTsKaGdCdXR0b24uc2V0QXR0cmlidXRlKCdzdHlsZScsICdtYXJnaW4tcmlnaHQ6MTJweCcpOwpoZ0J1dHRvbi5zZXRBdHRyaWJ1dGUoJ29uQ2xpY2snLCAiZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuZ29vZ2xlLnJ1L3NlYXJjaD9obD1ydSZxPScgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoX2ZpZWxkJykudmFsdWUgKyAnK3NpdGUlM0FoYWJyYWhhYnIucnUnIik7Cgp2YXIgaGdDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVudV90YWInKS5wYXJlbnROb2RlLnBhcmVudE5vZGU7CmhnQ29udGFpbmVyLmFwcGVuZENoaWxkKGhnQnV0dG9uKTs="},{"name":"_Amazon Search, alter results","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["https://www.amazon.com/s/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1471404751062,"data":{}},"enabled":false,"position":31,"uuid":"b952abf0-edbb-49f2-9035-f97825b97ddf","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgIF9BbWF6b24gU2VhcmNoLCBhbHRlciByZXN1bHRzCi8vIEBpbmNsdWRlICBodHRwczovL3d3dy5hbWF6b24uY29tL3MvKgovLy8vIEByZXF1aXJlICBodHRwOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvanF1ZXJ5LzEuNy4yL2pxdWVyeS5taW4uanMKLy8vLyBAcmVxdWlyZSAgaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vcmF3LzI2MjU4OTEvd2FpdEZvcktleUVsZW1lbnRzLmpzCi8vIEBncmFudCAgICBHTV9hZGRTdHlsZQovLyA9PS9Vc2VyU2NyaXB0PT0KLyotIFRoZSBAZ3JhbnQgZGlyZWN0aXZlIGlzIG5lZWRlZCB0byB3b3JrIGFyb3VuZCBhIGRlc2lnbiBjaGFuZ2UKICAgIGludHJvZHVjZWQgaW4gR00gMS4wLiAgIEl0IHJlc3RvcmVzIHRoZSBzYW5kYm94LgoqLwoKLy9mdW5jdGlvbiBhZGRDdXN0b21TZWFyY2hSZXN1bHQgKGpOb2RlKSB7CiAgICAvLyoqKioqIFlPVVIgQ09ERSBIRVJFICoqKioqCiAgICAvL2FsZXJ0KCdpdCB3b3JrcycpOwogLy8gICAgICAgICAgICAgICBqTm9kZS5wcmVwZW5kICgKICAvLyAgICAgICAgICAgICAgJzxkaXYgaWQ9InJlc3VsdF8wMDAiIGNsYXNzPSJmc3RSb3ciPkJ1eSBteSBzdHVmZiwgaW5zdGVhZCE8L2Rpdj4nCiAgIC8vICAgICAgICAgKTsKCi8vfQoKLy93YWl0Rm9yS2V5RWxlbWVudHMgKCIjYmNLd1RleHQiLCBhZGRDdXN0b21TZWFyY2hSZXN1bHQpOwoKdmFyIG11dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzLXJlc3VsdC1jb3VudCcpOwp2YXIgdGV4dE5vZGUgPSBtdXQuZmlyc3RDaGlsZDsKbXV0LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNoYXJhY3RlckRhdGFNb2RpZmllZCcsIGZ1bmN0aW9uKCkgeyBhbGVydCgnaGknKTsgfSwgZmFsc2UpOwoKCgoKCgoKCgo="},{"name":"EXAMPLES","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["*://*/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1471493570822,"data":{}},"enabled":false,"position":32,"uuid":"73513279-554c-4741-b33a-6aa5a4992f5d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBFWEFNUExFUwovLyBAbmFtZXNwYWNlICAgIGNocmlzdGlhbnZ1ZXJpbmdzCi8vIEB2ZXJzaW9uICAgICAgMC4xCi8vIEBkZXNjcmlwdGlvbiAgTG9hZCBsb2NhbCBKYXZhU2NyaXB0IGFuZCBDU1MKLy8gQGF1dGhvciAgICAgICBDaHJpc3RpYW4gVnVlcmluZ3MKLy8gQG1hdGNoICAgICAgICAqOi8vKi8qCi8vIEByZXF1aXJlICAgICAgZmlsZTovLy9Vc2Vycy9jaHJpc3RpYW4vUHJvamVjdHMvc2lzLWN1c3RvbS9kaXN0L3Npc19jcy5qcwovLyBAcmVzb3VyY2UgICAgIHNpc19jcyBmaWxlOi8vL1VzZXJzL2NocmlzdGlhbi9Qcm9qZWN0cy9zaXMtY3VzdG9tL2Rpc3Qvc2lzX2NzLmNzcwovLyBAZ3JhbnQgICAgICAgIEdNX2FkZFN0eWxlCi8vIEBncmFudCAgICAgICAgR01fZ2V0UmVzb3VyY2VUZXh0Ci8vID09L1VzZXJTY3JpcHQ9PQoKdmFyIHNpc19jcyA9IEdNX2dldFJlc291cmNlVGV4dCgic2lzX2NzIik7CkdNX2FkZFN0eWxlKHNpc19jcyk7CgoKCgovLyAxLiDQodC+0LfQtNCw0ZHQvCDQvdC+0LLRi9C5INC+0LHRitC10LrRgiBYTUxIdHRwUmVxdWVzdAp2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CgovLyAyLiDQmtC+0L3RhNC40LPRg9GA0LjRgNGD0LXQvCDQtdCz0L46IEdFVC3Qt9Cw0L/RgNC+0YEg0L3QsCBVUkwgJ3Bob25lcy5qc29uJwp4aHIub3BlbignR0VUJywgJ3Bob25lcy5qc29uJywgZmFsc2UpOwoKLy8gMy4g0J7RgtGB0YvQu9Cw0LXQvCDQt9Cw0L/RgNC+0YEKeGhyLnNlbmQoKTsKCi8vIDQuINCV0YHQu9C4INC60L7QtCDQvtGC0LLQtdGC0LAg0YHQtdGA0LLQtdGA0LAg0L3QtSAyMDAsINGC0L4g0Y3RgtC+INC+0YjQuNCx0LrQsAppZiAoeGhyLnN0YXR1cyAhPSAyMDApIHsKICAvLyDQvtCx0YDQsNCx0L7RgtCw0YLRjCDQvtGI0LjQsdC60YMKICBhbGVydCggeGhyLnN0YXR1cyArICc6ICcgKyB4aHIuc3RhdHVzVGV4dCApOyAvLyDQv9GA0LjQvNC10YAg0LLRi9Cy0L7QtNCwOiA0MDQ6IE5vdCBGb3VuZAp9IGVsc2UgewogIC8vINCy0YvQstC10YHRgtC4INGA0LXQt9GD0LvRjNGC0LDRggogIGFsZXJ0KCB4aHIucmVzcG9uc2VUZXh0ICk7IC8vIHJlc3BvbnNlVGV4dCAtLSDRgtC10LrRgdGCINC+0YLQstC10YLQsC4KfQ=="},{"name":"HTML5 Video Keyboard Shortcuts","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1472239522962,"data":{}},"enabled":false,"position":33,"uuid":"96acec16-2230-45a0-94b0-78ca89f940dc","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBIVE1MNSBWaWRlbyBLZXlib2FyZCBTaG9ydGN1dHMKLy8gQG5hbWVzcGFjZSAgICBodHRwOi8vdGFtcGVybW9ua2V5Lm5ldC8KLy8gQHZlcnNpb24gICAgICAyLjAuMQovLyBAZGVzY3JpcHRpb24gIEFkZCBrZXlib2FyZCBzdXBwb3J0IHRvIENocm9tZSdzIG5hdGl2ZSBIVE1MNSB2aWRlbyBwbGF5ZXIuXAovL2h0dHBzOi8vY2hyb21lLmdvb2dsZS5jb20vd2Vic3RvcmUvZGV0YWlsL2h0bWw1LXZpZGVvLWtleWJvYXJkLXNob3IvbGxobWFjaWdnbmlibmJkb2tpZG1iaWxrbGNlYW9iYWUKLy9UaGlzIGV4dGVuc2lvbiBhZGRzIGFuIGV4dGVuc2l2ZSBsaXN0IG9mIGtleWJvYXJkIGNvbnRyb2xzIHRvIGltcHJvdmUgeW91ciB2aWV3aW5nIGV4cGVyaWVuY2UuIFRoZSBzaG9ydGN1dHMgYXJlIG9ubHkgYWN0aXZlIG9uIHZpZGVvcyB3aXRoIHRoZSBkZWZhdWx0IGNvbnRyb2xzIGVuYWJsZWQsIHNvIGRvbid0IHdvcnJ5IGFib3V0IHRoZW0gbWVzc2luZyB1cCBZb3VUdWJlIG9yIG90aGVyIGFkdmFuY2VkIHZpZGVvIHBsYXllcnMuIFRvIGVuYWJsZSBjb250cm9scyAoYW5kIGtleWJvYXJkIHNob3J0Y3V0cykgb24gdmlkZW9zIHRoYXQgZG9uJ3QgaGF2ZSB0aGVtLCBqdXN0IHJpZ2h0LWNsaWNrIHRoZSB2aWRlbyBpbiBxdWVzdGlvbiBhbmQgc2VsZWN0ICJTaG93IGNvbnRyb2xzIi4KLy9Ob3RlIHRoYXQgdGhpcyBleHRlbnNpb24gaXMgb25seSBtZWFudCB0byBhZmZlY3QgQ2hyb21lJ3MgbmF0aXZlIEhUTUw1IHZpZGVvIHBsYXllciEKLy8gRlVMTCBMSVNUIE9GIFNIT1JUQ1VUUzoKCi8vfCBLZXlzICAgICAgICAgICAgICB8IEVmZmVjdHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKLy98IC0tLS0tLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gfAovL3wgQ2xpY2sgICAgICAgICAgICAgfCBTZWxlY3QgdmlkZW8sIFBsYXkvUGF1c2Ugc2VsZWN0ZWQgdmlkZW8gICB8Ci8vfCBTcGFjZSAvIEsgICAgICAgICB8IFBsYXkvUGF1c2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKLy98IExlZnQgQXJyb3cgLyBKICAgIHwgU2tpcCBiYWNrIDUgc2Vjb25kcyAoMTAgaG9sZGluZyBzaGlmdCkgICAgfAovL3wgUmlnaHQgQXJyb3cgLyBMICAgfCBTa2lwIGZvcndhcmQgNSBzZWNvbmRzICgxMCBob2xkaW5nIHNoaWZ0KSB8Ci8vfCBDb21tYSAoLCkgICAgICAgICB8IFNraXAgYmFjayAxLzYwdGggb2YgYSBzZWNvbmQgICAgICAgICAgICAgIHwKLy98IFBlcmlvZCAoLikgICAgICAgIHwgU2tpcCBmb3J3YXJkIDEvNjB0aCBvZiBhIHNlY29uZCAgICAgICAgICAgfAovL3wgSG9tZSAvIDAgICAgICAgICAgfCBTa2lwIHRvIGJlZ2lubmluZyAgICAgICAgICAgICAgICAgICAgICAgICB8Ci8vfCBFbmQgICAgICAgICAgICAgICB8IFNraXAgdG8gZW5kICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKLy98IDEgLSA5ICAgICAgICAgICAgIHwgU2tpcCB0byBYJSAoMTAlLCAyMCUsIDMwJSwgLi4uIDkwJSkgICAgICAgfAovL3wgVXAgQXJyb3cgICAgICAgICAgfCBJbmNyZWFzZSB2b2x1bWUgICAgICAgICAgICAgICAgICAgICAgICAgICB8Ci8vfCBEb3duIEFycm93ICAgICAgICB8IERlY3JlYXNlIHZvbHVtZSAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKLy98IE0gICAgICAgICAgICAgICAgIHwgVG9nZ2xlIG11dGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAovL3wgUiAgICAgICAgICAgICAgICAgfCBSZWxvYWQgdmlkZW8gc291cmNlICAgICAgICAgICAgICAgICAgICAgICB8Ci8vfCBMZXNzIFRoYW4gKDwpICAgICB8IFNsb3cgZG93biB2aWRlbyBwbGF5YmFjayAgICAgICAgICAgICAgICAgIHwKLy98IEdyZWF0ZXIgVGhhbiAoPikgIHwgU3BlZWQgdXAgdmlkZW8gcGxheWJhY2sgICAgICAgICAgICAgICAgICAgfAovL3wgUXVlc3Rpb24gTWFyayAoPykgfCBSZXR1cm4gdG8gZGVmYXVsdCBwbGF5YmFjayBzcGVlZCAgICAgICAgICB8Ci8vfCBGICAgICAgICAgICAgICAgICB8IFRvZ2dsZSBmdWxsc2NyZWVuICAgICAgICAgICAgICAgICAgICAgICAgIHwKLy8gQGF1dGhvciAgICAgICBZb3UKLy8gQGluY2x1ZGUgICAgICAqCi8vIEBncmFudCAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCiJ1c2Ugc3RyaWN0IjsKCmNvbnN0IHZpZGVvQ2xhc3MgPSAiY2hyb21lLWJldHRlci1IVE1MNS12aWRlbyI7CmNvbnN0IGRpcmVjdFZpZGVvQ2xhc3MgPSAiRElSRUNULWNocm9tZS1iZXR0ZXItSFRNTDUtdmlkZW8iOwoKLy8vLyBCRUdJTiBTSE9SVENVVCBGVU5DVElPTlMgLy8vLwoKZnVuY3Rpb24gdG9nZ2xlUGxheSh2KXsKCWlmKHYucGF1c2VkKQoJCXYucGxheSgpOwoJZWxzZQoJCXYucGF1c2UoKTsKfQoKZnVuY3Rpb24gdG9TdGFydCh2KXsKCXYuY3VycmVudFRpbWUgPSAwOwp9CgpmdW5jdGlvbiB0b0VuZCh2KXsKCXYuY3VycmVudFRpbWUgPSB2LmR1cmF0aW9uOwp9CgpmdW5jdGlvbiBza2lwTGVmdCh2LGUpewoJaWYoZS5zaGlmdEtleSkKCQl2LmN1cnJlbnRUaW1lIC09IDEwOwoJZWxzZQoJCXYuY3VycmVudFRpbWUgLT0gNTsKfQoKZnVuY3Rpb24gc2tpcFJpZ2h0KHYsZSl7CglpZihlLnNoaWZ0S2V5KQoJCXYuY3VycmVudFRpbWUgKz0gMTA7CgllbHNlCgkJdi5jdXJyZW50VGltZSArPSA1Owp9CgpmdW5jdGlvbiBpbmNyZWFzZVZvbCh2KXsKCWlmKHYudm9sdW1lIDw9IDAuOSkgdi52b2x1bWUgKz0gMC4xOwoJZWxzZSB2LnZvbHVtZSA9IDE7Cn0KCmZ1bmN0aW9uIGRlY3JlYXNlVm9sKHYpewoJaWYodi52b2x1bWUgPj0gMC4xKSB2LnZvbHVtZSAtPSAwLjE7CgllbHNlIHYudm9sdW1lID0gMDsKfQoKZnVuY3Rpb24gdG9nZ2xlTXV0ZSh2KXsKCXYubXV0ZWQgPSAhdi5tdXRlZDsKfQoKZnVuY3Rpb24gdG9nZ2xlRlModil7CglpZihkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCkKCQlkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbigpOwoJZWxzZQoJCXYud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4oRWxlbWVudC5BTExPV19LRVlCT0FSRF9JTlBVVCk7Cn0KCmZ1bmN0aW9uIHJlbG9hZFZpZGVvKHYpewoJY29uc3QgY3VyclRpbWUgPSB2LmN1cnJlbnRUaW1lOwoJdi5sb2FkKCk7Cgl2LmN1cnJlbnRUaW1lID0gY3VyclRpbWU7Cn0KCmZ1bmN0aW9uIHNsb3dPclByZXZGcmFtZSh2LGUpewoJaWYoZS5zaGlmdEtleSkgLy8gTGVzcy1UaGFuCgkJdi5wbGF5YmFja1JhdGUgLT0gMC4xNTsKCS8vZWxzZSAvLyBDb21tYQoJCS8vdi5jdXJyZW50VGltZSAtPSAxLzYwOwp9CgpmdW5jdGlvbiBmYXN0T3JOZXh0RnJhbWUodixlKXsKCWlmKGUuc2hpZnRLZXkpIC8vIEdyZWF0ZXItVGhhbgoJCXYucGxheWJhY2tSYXRlICs9IDAuMTU7CgkvL2Vsc2UgLy8gUGVyaW9kCgkJLy92LmN1cnJlbnRUaW1lICs9IDEvNjA7Cn0KCmZ1bmN0aW9uIG5vcm1hbFNwZWVkKHYsZSl7CglpZihlLnNoaWZ0S2V5KSAvLyA/CgkJdi5wbGF5YmFja1JhdGUgPSB2LmRlZmF1bHRQbGF5YmFja1JhdGU7Cn0KCmZ1bmN0aW9uIHRvUGVyY2VudGFnZSh2LGUpewoJdi5jdXJyZW50VGltZSA9IHYuZHVyYXRpb24gKiAoZS5rZXlDb2RlIC0gNDgpIC8gMTAuMDsKfQoKLy8vLyBFTkQgU0hPUlRDVVQgRlVOQ1RJT05TIC8vLy8KCmNvbnN0IGtleUZ1bmNzID0gewoJIDMyOiB0b2dnbGVQbGF5LAkJLy8gU3BhY2UKCSA3NTogdG9nZ2xlUGxheSwJCS8vIEsKCSAzNTogdG9FbmQsCQkvLyBFbmQKCSA0ODogdG9TdGFydCwJCS8vIDAKCSAzNjogdG9TdGFydCwJCS8vIEhvbWUKCSAzNzogc2tpcExlZnQsCQkvLyBMZWZ0IGFycm93CgkgNzQ6IHNraXBMZWZ0LAkJLy8gSgoJIDM5OiBza2lwUmlnaHQsCQkvLyBSaWdodCBhcnJvdwoJIDc2OiBza2lwUmlnaHQsCQkvLyBMCgkgMzg6IGluY3JlYXNlVm9sLAkvLyBVcCBhcnJvdwoJIDQwOiBkZWNyZWFzZVZvbCwJLy8gRG93biBhcnJvdwoJIDc3OiB0b2dnbGVNdXRlLAkJLy8gTQoJIDcwOiB0b2dnbGVGUywJCS8vIEYKCS8vIDgyOiByZWxvYWRWaWRlbywJLy8gUgoJMTg4OiBzbG93T3JQcmV2RnJhbWUsCS8vIENvbW1hIG9yIExlc3MtVGhhbgoJMTkwOiBmYXN0T3JOZXh0RnJhbWUsCS8vIFBlcmlvZCBvciBHcmVhdGVyLVRoYW4KCS8vMTkxOiBub3JtYWxTcGVlZCwJLy8gRm9yd2FyZCBzbGFzaCBvciA/CgkgNDk6IHRvUGVyY2VudGFnZSwJLy8gMQoJIDUwOiB0b1BlcmNlbnRhZ2UsCS8vIDIKCSA1MTogdG9QZXJjZW50YWdlLAkvLyAzCgkgNTI6IHRvUGVyY2VudGFnZSwJLy8gNAoJIDUzOiB0b1BlcmNlbnRhZ2UsCS8vIDUKCSA1NDogdG9QZXJjZW50YWdlLAkvLyA2CgkgNTU6IHRvUGVyY2VudGFnZSwJLy8gNwoJIDU2OiB0b1BlcmNlbnRhZ2UsCS8vIDgKCSA1NzogdG9QZXJjZW50YWdlLAkvLyA5Cn07CgpmdW5jdGlvbiBwcm9jZXNzQWxsVmlkZW9zKCl7CglpZihkb2N1bWVudC5ib2R5LmNoaWxkcmVuLmxlbmd0aCA9PSAxICAvLyBIYW5kbGUgZGlyZWN0IHZpZGVvIGFjY2VzcwoJJiYgZG9jdW1lbnQuYm9keS5maXJzdEVsZW1lbnRDaGlsZC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlZJREVPIgoJJiYgZG9jdW1lbnQuYm9keS5maXJzdEVsZW1lbnRDaGlsZC5oYXNBdHRyaWJ1dGUoImNvbnRyb2xzIikpewoJCXJlZ2lzdGVyRGlyZWN0VmlkZW8oKTsKCX1lbHNlewoJCWNvbnN0IHZpZGVvcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ2aWRlbyIpOwoJCWZvcihsZXQgaSA9IDA7IGkgPCB2aWRlb3MubGVuZ3RoOyArK2kpewoJCQlpZih2aWRlb3NbaV0uaGFzQXR0cmlidXRlKCJjb250cm9scyIpKQoJCQkJcmVnaXN0ZXJWaWRlbyh2aWRlb3NbaV0pOwoJCX0KCX0KCQoJY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtcnMpewoJCWZvcihsZXQgaSA9IDA7IGkgPCBtcnMubGVuZ3RoOyArK2kpewoJCQlpZihtcnNbaV0udHlwZSA9PSAiYXR0cmlidXRlcyIgJiYgbXJzW2ldLmF0dHJpYnV0ZU5hbWUgPT0gImNvbnRyb2xzIil7CgkJCQljb25zdCB0ID0gbXJzW2ldLnRhcmdldDsKCQkJCWlmKCF0Lmhhc0F0dHJpYnV0ZSgiY29udHJvbHMiKSl7CgkJCQkJaWYodC5jbGFzc0xpc3QuY29udGFpbnMoZGlyZWN0VmlkZW9DbGFzcykpewoJCQkJCQl1bnJlZ2lzdGVyRGlyZWN0VmlkZW8oKTsKCQkJCQl9ZWxzZSBpZih0LmNsYXNzTGlzdC5jb250YWlucyh2aWRlb0NsYXNzKSl7CgkJCQkJCXVucmVnaXN0ZXJWaWRlbyh0KTsKCQkJCQl9CgkJCQl9ZWxzZSBpZih0LnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PSAiVklERU8iKXsKCQkJCQlpZihkb2N1bWVudC5ib2R5LmNoaWxkcmVuLmxlbmd0aCA9PSAxCgkJCQkJJiYgZG9jdW1lbnQuYm9keS5maXJzdEVsZW1lbnRDaGlsZCA9PSB0KXsKCQkJCQkJcmVnaXN0ZXJEaXJlY3RWaWRlbygpOwoJCQkJCX1lbHNlewoJCQkJCQlyZWdpc3RlclZpZGVvKHQpOwoJCQkJCQl0LmZvY3VzKCk7CgkJCQkJfQoJCQkJfQoJCQl9ZWxzZXsKCQkJCS8vIEhhbmRsZSBkaXJlY3QgdmlkZW8gYWNjZXNzCgkJCQlpZihkb2N1bWVudC5ib2R5LmNoaWxkcmVuLmxlbmd0aCAhPSAxCgkJCQl8fCAhZG9jdW1lbnQuYm9keS5maXJzdEVsZW1lbnRDaGlsZC5jbGFzc0xpc3QuY29udGFpbnMoZGlyZWN0VmlkZW9DbGFzcykKCQkJCXx8ICFkb2N1bWVudC5ib2R5LmZpcnN0RWxlbWVudENoaWxkLmhhc0F0dHJpYnV0ZSgiY29udHJvbHMiKSl7CgkJCQkJdW5yZWdpc3RlckRpcmVjdFZpZGVvKCk7CgkJCQl9CgkJCQlpZihkb2N1bWVudC5ib2R5LmNoaWxkcmVuLmxlbmd0aCA9PSAxCgkJCQkmJiBkb2N1bWVudC5ib2R5LmZpcnN0RWxlbWVudENoaWxkLnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PSAiVklERU8iCgkJCQkmJiBkb2N1bWVudC5ib2R5LmZpcnN0RWxlbWVudENoaWxkLmhhc0F0dHJpYnV0ZSgiY29udHJvbHMiKSl7CgkJCQkJcmVnaXN0ZXJEaXJlY3RWaWRlbygpOwoJCQkJfQoJCQkJaWYobXJzW2ldLmFkZGVkTm9kZXMpewoJCQkJCWZvcihsZXQgaiA9IDA7IGogPCBtcnNbaV0uYWRkZWROb2Rlcy5sZW5ndGg7ICsrail7CgkJCQkJCWNvbnN0IGFuID0gbXJzW2ldLmFkZGVkTm9kZXNbal07CgkJCQkJCWlmKGFuLnRhZ05hbWUgJiYgYW4udGFnTmFtZS50b1VwcGVyQ2FzZSgpID09ICJWSURFTyIpewoJCQkJCQkJaWYoIWFuLmNsYXNzTGlzdC5jb250YWlucyh2aWRlb0NsYXNzKQoJCQkJCQkJJiYgYW4uaGFzQXR0cmlidXRlKCJjb250cm9scyIpKQoJCQkJCQkJCXJlZ2lzdGVyVmlkZW8oYW4pOwoJCQkJCQl9ZWxzZSBpZihhbi5nZXRFbGVtZW50c0J5VGFnTmFtZSl7CgkJCQkJCQljb25zdCBjbiA9IGFuLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJWSURFTyIpOwoJCQkJCQkJZm9yKGxldCBrPTA7azxjbi5sZW5ndGg7KytrKXsKCQkJCQkJCQlpZighY25ba10uY2xhc3NMaXN0LmNvbnRhaW5zKHZpZGVvQ2xhc3MpCgkJCQkJCQkJJiYgY25ba10uaGFzQXR0cmlidXRlKCJjb250cm9scyIpKQoJCQkJCQkJCQlyZWdpc3RlclZpZGVvKGNuW2tdKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0pOwoJb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHsKCQljaGlsZExpc3Q6IHRydWUsCgkJYXR0cmlidXRlczogdHJ1ZSwKCQlhdHRyaWJ1dGVGaWx0ZXI6IFsiY29udHJvbHMiXSwKCQlzdWJ0cmVlOiB0cnVlCgl9KTsKfQoKZnVuY3Rpb24gcmVnaXN0ZXJEaXJlY3RWaWRlbygpewoJY29uc3QgdmlkcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodmlkZW9DbGFzcyk7Cglmb3IobGV0IGkgPSAwOyBpIDwgdmlkcy5sZW5ndGg7ICsraSl7CgkJdW5yZWdpc3RlclZpZGVvKHZpZHNbaV0pOwoJfQoJZG9jdW1lbnQuYm9keS5maXJzdEVsZW1lbnRDaGlsZC5jbGFzc0xpc3QuYWRkKGRpcmVjdFZpZGVvQ2xhc3MpOwoJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkaXJlY3RIYW5kbGVDbGljayk7Cglkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZGlyZWN0SGFuZGxlS2V5RG93bik7Cglkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlwcmVzcyIsIGhhbmRsZUtleVVwKTsKCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgaGFuZGxlS2V5VXApOwp9CgpmdW5jdGlvbiB1bnJlZ2lzdGVyRGlyZWN0VmlkZW8oKXsKCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZGlyZWN0SGFuZGxlQ2xpY2spOwoJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGRpcmVjdEhhbmRsZUtleURvd24pOwoJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigia2V5cHJlc3MiLCBoYW5kbGVLZXlVcCk7Cglkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXl1cCIsIGhhbmRsZUtleVVwKTsKCWNvbnN0IHZpZHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGRpcmVjdFZpZGVvQ2xhc3MpOwoJZm9yKGxldCBpID0gMDsgaSA8IHZpZHMubGVuZ3RoOyArK2kpewoJCXJlZ2lzdGVyVmlkZW8odmlkc1tpXSk7CgkJdmlkc1tpXS5mb2N1cygpOwoJCXZpZHNbaV0uY2xhc3NMaXN0LnJlbW92ZShkaXJlY3RWaWRlb0NsYXNzKTsKCX0KfQoKZnVuY3Rpb24gcmVnaXN0ZXJWaWRlbyh2KXsKCXYuY2xhc3NMaXN0LmFkZCh2aWRlb0NsYXNzKTsKCXYuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVDbGljayk7Cgl2LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBoYW5kbGVLZXlEb3duKTsKCXYuYWRkRXZlbnRMaXN0ZW5lcigia2V5cHJlc3MiLCBoYW5kbGVLZXlVcCk7Cgl2LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgaGFuZGxlS2V5VXApOwoJdi5hZGRFdmVudExpc3RlbmVyKCJ3ZWJraXRmdWxsc2NyZWVuY2hhbmdlIiwgaGFuZGxlRnVsbHNjcmVlbik7Cn0KCmZ1bmN0aW9uIHVucmVnaXN0ZXJWaWRlbyh2KXsKCXYuY2xhc3NMaXN0LnJlbW92ZSh2aWRlb0NsYXNzKTsKCXYucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVDbGljayk7Cgl2LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBoYW5kbGVLZXlEb3duKTsKCXYucmVtb3ZlRXZlbnRMaXN0ZW5lcigia2V5cHJlc3MiLCBoYW5kbGVLZXlVcCk7Cgl2LnJlbW92ZUV2ZW50TGlzdGVuZXIoImtleXVwIiwgaGFuZGxlS2V5VXApOwoJdi5yZW1vdmVFdmVudExpc3RlbmVyKCJ3ZWJraXRmdWxsc2NyZWVuY2hhbmdlIiwgaGFuZGxlRnVsbHNjcmVlbik7Cn0KCmZ1bmN0aW9uIGRpcmVjdEhhbmRsZUNsaWNrKGUpewoJY29uc3QgdiA9IHRoaXMuYm9keS5maXJzdEVsZW1lbnRDaGlsZDsKCXRvZ2dsZVBsYXkodik7Cn0KCmZ1bmN0aW9uIGRpcmVjdEhhbmRsZUtleURvd24oZSl7CglyZXR1cm4gaGFuZGxlS2V5RG93bihlLCB0aGlzLmJvZHkuZmlyc3RFbGVtZW50Q2hpbGQpOwp9CgpmdW5jdGlvbiBoYW5kbGVDbGljayhlKXsKCWlmKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IHRoaXMpewoJCXRvZ2dsZVBsYXkodGhpcyk7CgkJcmV0dXJuIHRydWU7Cgl9ZWxzZXsKCQl0aGlzLmZvY3VzKCk7CgkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJcmV0dXJuIGZhbHNlOwoJfQp9CgpmdW5jdGlvbiBoYW5kbGVLZXlEb3duKGUsIHYpewoJaWYodiA9PT0gdW5kZWZpbmVkKQoJCXYgPSB0aGlzOwoJY29uc3QgZnVuYyA9IGtleUZ1bmNzW2Uua2V5Q29kZV07CglpZihmdW5jICE9PSB1bmRlZmluZWQpewoJCWZ1bmModixlKTsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQlyZXR1cm4gZmFsc2U7Cgl9CglyZXR1cm4gdHJ1ZTsgLy8gRG8gbm90IHByZXZlbnQgZGVmYXVsdCBpZiBubyBVSSBhY3RpdmF0ZWQKfQoKZnVuY3Rpb24gaGFuZGxlS2V5VXAoZSl7CglpZihrZXlGdW5jc1tlLmtleUNvZGVdICE9PSB1bmRlZmluZWQpewoJCWUucHJldmVudERlZmF1bHQoKTsKCQllLnN0b3BQcm9wYWdhdGlvbigpOwoJCXJldHVybiBmYWxzZTsKCX0KCXJldHVybiB0cnVlOyAvLyBEbyBub3QgcHJldmVudCBkZWZhdWx0IGlmIG5vIFVJIGFjdGl2YXRlZAp9CgpmdW5jdGlvbiBoYW5kbGVGdWxsc2NyZWVuKCl7CglpZihkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudD09PXRoaXMpCgkJdGhpcy5mb2N1cygpOwp9CgppZihkb2N1bWVudC5yZWFkeVN0YXRlICE9PSAibG9hZGluZyIpCglwcm9jZXNzQWxsVmlkZW9zKCk7CmVsc2UKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgcHJvY2Vzc0FsbFZpZGVvcyk7Cg=="},{"name":"Wikipedia goes 3 columns","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":["http://*.wikipedia.org/wiki/Main_Page"],"orig_includes":["http://*.wikipedia.org/*","https://*.wikipedia.org/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1472253840081,"data":{}},"enabled":false,"position":34,"file_url":"https://openuserjs.org/install/sepich/Wikipedia_goes_3_columns.user.js","uuid":"e73c0366-8d4f-4dc7-bfbd-5c5a14c64b2a","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIFdpa2lwZWRpYSBnb2VzIDMgY29sdW1ucwovLyBAZGVzY3JpcHRpb24gRGlzcGxheSB3aWtpcGVkaWEgYXJ0aWNsZSB0ZXh0IGluIDMgY29sdW1ucyBmb3Igd2lkZXNjcmVlbiBkaXNwbGF5cwovLyBAbmFtZXNwYWNlICAgc2VwYS5zcGIucnUKLy8gQHZlcnNpb24gICAgIDIwMTQuMDkuMDUKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLndpa2lwZWRpYS5vcmcvKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly8qLndpa2lwZWRpYS5vcmcvKgovLyBAZXhjbHVkZSAgICAgaHR0cDovLyoud2lraXBlZGlhLm9yZy93aWtpL01haW5fUGFnZQovLyBAaWNvbiAgICAgICAgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvZmF2aWNvbi5pY28KLy8gQGdyYW50ICAgICAgIEdNX2dldFJlc291cmNlVGV4dAovLyBAdXBkYXRlVVJMICAgaHR0cHM6Ly9vcGVudXNlcmpzLm9yZy9pbnN0YWxsL3NlcGljaC9XaWtpcGVkaWFfZ29lc18zX2NvbHVtbnMudXNlci5qcwovLyBAcmVxdWlyZSAgICAgaHR0cDovL2NvZGUuanF1ZXJ5LmNvbS9qcXVlcnktbGF0ZXN0Lm1pbi5qcwovLyBAYXV0aG9yICAgICAgaUBzZXBhLnNwYi5ydQovLyA9PS9Vc2VyU2NyaXB0PT0KCi8vaGVyZWRvYyBqcyB3cmFwcGVyIDspCmZ1bmN0aW9uIGhlcmVEb2MoZikgewogIHJldHVybiBmLnRvU3RyaW5nKCkuCiAgICAgIHJlcGxhY2UoL15bXlwvXStcL1wqIT8vLCAnJykuCiAgICAgIHJlcGxhY2UoL1wqXC9bXlwvXSskLywgJycpOwp9CgovL2Nzcwp2YXIgY3NzID0gaGVyZURvYyhmdW5jdGlvbigpIHsvKiEKLmQtY29sIHsKICAtbW96LWNvbHVtbi1jb3VudDogMzsKICAtbW96LWNvbHVtbi1nYXA6IDMwcHg7CiAgY29sdW1uLWNvdW50OiAzOwogIGNvbHVtbi1nYXA6IDMwcHg7CiAgdGV4dC1hbGlnbjoganVzdGlmeTsKfQoKdGFibGUjdG9jIHsKICBiYWNrZ3JvdW5kOiBpbmhlcml0OwogIGJvcmRlcjogMCBub25lOwogIGZvbnQtc2l6ZTogMTJweDsKICBwYWRkaW5nOiAwOwp9CiN0b2MsIC50b2MsIC5tdy13YXJuaW5nIHsgYm9yZGVyOiBub25lOyBmb250LXNpemU6IDgwJTsgfQp0YWJsZS5pbmZvYm94LCB0YWJsZS52ZXJ0aWNhbC1uYXZib3ggewogIGJvcmRlcjogMCBub25lICFpbXBvcnRhbnQ7CiAgZmxvYXQ6IG5vbmU7CiAgZm9udC1zaXplOiAxMXB4ICFpbXBvcnRhbnQ7CiAgbWFyZ2luOiAwOwogIHBhZGRpbmc6IDAgIWltcG9ydGFudDsKICB3aWR0aDogaW5oZXJpdCAhaW1wb3J0YW50OwogIGJhY2tncm91bmQ6IGluaGVyaXQ7CiAgdGV4dC1hbGlnbjogbGVmdDsKfQoKI3RvY3RpdGxlIGgyIHsKICBwb3NpdGlvbjogaW5oZXJpdDsKICB0ZXh0LWFsaWduOiBsZWZ0ICFpbXBvcnRhbnQ7Cn0KI3RvY3RpdGxlIHsKICB0ZXh0LWFsaWduOiBsZWZ0ICFpbXBvcnRhbnQ7Cn0KYm9keS5tZWRpYXdpa2kgdGFibGUubWJveC1zbWFsbC1sZWZ0LCB0YWJsZS5hbWJveCB7IG1hcmdpbjogMDsgd2lkdGg6IGluaGVyaXQ7IH0KYm9keS5tZWRpYXdpa2kgdGFibGUubWJveC1zbWFsbCB7IHdpZHRoOiBpbmhlcml0OyBtYXJnaW46IDRweCAwOyBmbG9hdDogbm9uZTsgY2xlYXI6IG5vbmU7fQpodG1sIC50aHVtYmltYWdlIHsgYm9yZGVyOiBub25lO30KZGl2LnRyaWdodCwgZGl2LnRsZWZ0ICB7IG1hcmdpbjogMDt9CmRpdi50cmlnaHQsIGRpdi50bGVmdCwgZGl2LmZsb2F0cmlnaHQsIGRpdi5mbG9hdGxlZnQsIHRhYmxlLmZsb2F0cmlnaHQsIHRhYmxlLmZsb2F0bGVmdCB7IGZsb2F0OiBub25lOyBjbGVhcjogbm9uZTsgfQpkaXYjbXctcGFuZWwge3dpZHRoOiAxNmVtOyBvdmVyZmxvdzogYXV0bzsgcGFkZGluZy10b3A6IDIwMHB4OyB0b3A6IDA7fQojcC1sb2dvIHtsZWZ0OiAzLjVlbTsgdG9wOjA7fQojbGVmdC1uYXZpZ2F0aW9uIHttYXJnaW4tbGVmdDogMTdlbTt9CiNtdy1oZWFkLWJhc2Uge21hcmdpbi1sZWZ0OiAxN2VtO30KZGl2I2NvbnRlbnQge21hcmdpbi1sZWZ0OiAxN2VtO30KZGl2Lm13LWNvZGUsIHByZSB7b3ZlcmZsb3c6IGF1dG87fQpkaXYjZm9vdGVyIHttYXJnaW4tbGVmdDogMTZlbTt9CgojcC1uYXZpZ2F0aW9uLCAjcC1pbnRlcmFjdGlvbiwgI3AtdGIsICNwLWNvbGwtcHJpbnRfZXhwb3J0LCAjcC1wYXJ0aWNpcGF0aW9uLCAjc2l0ZU5vdGljZSB7ZGlzcGxheTogbm9uZTt9CiovfSk7IAoKLy9hcHBseSBjdXN0b20gQ1NTCnZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKcy50eXBlID0gJ3RleHQvY3NzJzsKcy5pbm5lckhUTUwgPSBjc3M7CmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZChzKTsKCi8vbW92ZSB0YWJsZXMgdG8gbGVmdAokKCIjbXctcGFuZWwiKS5hcHBlbmQoJCgiI3RvYyIpKTsKJCgiI213LXBhbmVsIikuYXBwZW5kKCQoInRhYmxlLnZlcnRpY2FsLW5hdmJveCIpKTsKJCgiI213LXBhbmVsIikuYXBwZW5kKCQoInRhYmxlLmluZm9ib3giKSk7CiQoIiNtdy1wYW5lbCIpLmFwcGVuZCgkKCJ0YWJsZS5tZXRhZGF0YS5tYm94LXNtYWxsIikpOwoKLy93cmFwIGNvbnRlbnRzIHRvIGQtY29sLCBzcGxpdCBieSBIMgp2YXIgbj0kKCIjbXctY29udGVudC10ZXh0IikuY2hpbGRyZW4oKTsKJCgiI213LWNvbnRlbnQtdGV4dCIpLnByZXBlbmQoIjxkaXYgY2xhc3M9J2QtY29sJy8+Iik7ICAgCnZhciBkPSQoImRpdi5kLWNvbCIpLmxhc3QoKTsKZm9yKHZhciBpPTA7IGk8bi5sZW5ndGgtMTsgaSsrKXsKICBpZiggbltpXS5ub2RlTmFtZT09IlRBQkxFIiAmJiAoJChuW2ldKS5oYXNDbGFzcygid2lraXRhYmxlIikgfHwgJChuW2ldKS5oYXNDbGFzcygibmF2Ym94IikpICl7CiAgICAkKG5baV0pLmFmdGVyKCI8ZGl2IGNsYXNzPSdkLWNvbCcvPiIpOwogICAgZD0kKCJkaXYuZC1jb2wiKS5sYXN0KCk7CiAgICBjb250aW51ZTsKICB9CiAgZWxzZSBpZihuW2ldLm5vZGVOYW1lIT0iSDIiKSB7CiAgICAkKGQpLmFwcGVuZChuW2ldKTsKICB9CiAgZWxzZSB7CiAgICAkKG5baV0pLmFmdGVyKCI8ZGl2IGNsYXNzPSdkLWNvbCcvPiIpOwogICAgZD0kKCJkaXYuZC1jb2wiKS5sYXN0KCk7CiAgfQp9CgovL3JlbW92ZSB3aWR0aC9oZWlnaHQgZnJvbSBpbWFnZXMKJCgnaW1nJykucmVtb3ZlQXR0cignd2lkdGgnKS5yZW1vdmVBdHRyKCdoZWlnaHQnKTsKJCgnZGl2LnRodW1iaW5uZXInKS5yZW1vdmVBdHRyKCdzdHlsZScpOwokKCdkaXYubm9yZXNpemUnKS5yZW1vdmVBdHRyKCdzdHlsZScpOwokKCd0YWJsZS53aWtpdGFibGUnKS5yZW1vdmVBdHRyKCdzdHlsZScpOwp2YXIgdz0kKCB3aW5kb3cgKS53aWR0aCgpOwokKCdkaXYudGh1bWIgLnRodW1iaW1hZ2UsIGRpdi5ub3Jlc2l6ZSBpbWcsIGRpdi5mbG9hdG5vbmUgaW1nLCBkaXYuZC1jb2wgaW1nLCBkaXYuZC1jb2wgcHJlLCBkaXYuZC1jb2wgLm13LWNvZGUnKS5jc3MoJ21heC13aWR0aCcsJ2NhbGMoICgnK3crJ3B4IC0gMTdlbSAtIDEyMHB4KS8zIC0gMzBweCApJyk7CgovL2NvbGxhcHNlIGxhbmd1YWdlcwokKCcjcC1sYW5nJykucmVtb3ZlQ2xhc3MoJ2V4cGFuZGVkJykuYWRkQ2xhc3MoJ2NvbGxhcHNlZCcpOwokKCcjcC1sYW5nIGRpdi5ib2R5JykuY3NzKCdkaXNwbGF5Jywnbm9uZScpOwo="},{"name":"New Userscript","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["*"],"orig_matches":["http://*/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1472254615128,"data":{}},"enabled":false,"position":35,"uuid":"88690a40-5620-4883-bc2f-828bc7a6aeaa","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZXcgVXNlcnNjcmlwdAovLyBAbmFtZXNwYWNlICAgIGh0dHA6Ly90YW1wZXJtb25rZXkubmV0LwovLyBAdmVyc2lvbiAgICAgIDAuMQovLyBAZGVzY3JpcHRpb24gIHRyeSB0byB0YWtlIG92ZXIgdGhlIHdvcmxkIQovLyBAYXV0aG9yICAgICAgIFlvdQovLyBAbWF0Y2ggICAgICAgIGh0dHA6Ly8qLyoKLy8gQGluY2x1ZGUgICAgICAqCi8vIEByZXNvdXJjZSAgICAgc3BlZWRWaWRlbyBmaWxlOi8vZTpcR09PR0xFXGluamVjdC5jc3MKLy8gQGdyYW50IEdNX2FkZFN0eWxlCi8vIEBncmFudCAgICBHTV9nZXRSZXNvdXJjZVRleHQKLy8gPT0vVXNlclNjcmlwdD09Cgp2YXIgc29yY2VTdHlsZSA9IEdNX2dldFJlc291cmNlVGV4dCgic3BlZWRWaWRlbyIpOwpHTV9hZGRTdHlsZShzb3JjZVN0eWxlKTsKY2hyb21lLmV4dGVuc2lvbi5zZW5kTWVzc2FnZSh7fSwgZnVuY3Rpb24ocmVzcG9uc2UpIHsKICB2YXIgdGMgPSB7CiAgICBzZXR0aW5nczogewogICAgICBzcGVlZDogMS4wLCAgICAgICAgICAgLy8gZGVmYXVsdCAxeAogICAgICBzcGVlZFN0ZXA6IDAuMSwgICAgICAgLy8gZGVmYXVsdCAwLjF4CiAgICAgIHJld2luZFRpbWU6IDEwLCAgICAgICAvLyBkZWZhdWx0IDEwcwogICAgICBhZHZhbmNlVGltZTogMTAsICAgICAgLy8gZGVmYXVsdCAxMHMKICAgICAgcmVzZXRLZXlDb2RlOiAgODIsICAgIC8vIGRlZmF1bHQ6IFIKICAgICAgc2xvd2VyS2V5Q29kZTogODMsICAgIC8vIGRlZmF1bHQ6IFMKICAgICAgZmFzdGVyS2V5Q29kZTogNjgsICAgIC8vIGRlZmF1bHQ6IEQKICAgICAgcmV3aW5kS2V5Q29kZTogOTAsICAgIC8vIGRlZmF1bHQ6IFoKICAgICAgYWR2YW5jZUtleUNvZGU6IDg4LCAgIC8vIGRlZmF1bHQ6IFgKICAgICAgZGlzcGxheUtleUNvZGU6IDg2LCAgIC8vIGRlZmF1bHQ6IFYKICAgICAgcmVtZW1iZXJTcGVlZDogZmFsc2UsIC8vIGRlZmF1bHQ6IGZhbHNlCiAgICAgIGJsYWNrbGlzdDogYAogICAgICAgIHd3dy5pbnN0YWdyYW0uY29tCiAgICAgICAgdHdpdHRlci5jb20KICAgICAgICB2aW5lLmNvCiAgICAgICAgaW1ndXIuY29tCiAgICAgIGAucmVwbGFjZSgvXlxzK3xccyskL2dtLCcnKQogICAgfQogIH07CgogIGNocm9tZS5zdG9yYWdlLnN5bmMuZ2V0KHRjLnNldHRpbmdzLCBmdW5jdGlvbihzdG9yYWdlKSB7CiAgICB0Yy5zZXR0aW5ncy5zcGVlZCA9IE51bWJlcihzdG9yYWdlLnNwZWVkKTsKICAgIHRjLnNldHRpbmdzLnNwZWVkU3RlcCA9IE51bWJlcihzdG9yYWdlLnNwZWVkU3RlcCk7CiAgICB0Yy5zZXR0aW5ncy5yZXdpbmRUaW1lID0gTnVtYmVyKHN0b3JhZ2UucmV3aW5kVGltZSk7CiAgICB0Yy5zZXR0aW5ncy5hZHZhbmNlVGltZSA9IE51bWJlcihzdG9yYWdlLmFkdmFuY2VUaW1lKTsKICAgIHRjLnNldHRpbmdzLnJlc2V0S2V5Q29kZSA9IE51bWJlcihzdG9yYWdlLnJlc2V0S2V5Q29kZSk7CiAgICB0Yy5zZXR0aW5ncy5yZXdpbmRLZXlDb2RlID0gTnVtYmVyKHN0b3JhZ2UucmV3aW5kS2V5Q29kZSk7CiAgICB0Yy5zZXR0aW5ncy5zbG93ZXJLZXlDb2RlID0gTnVtYmVyKHN0b3JhZ2Uuc2xvd2VyS2V5Q29kZSk7CiAgICB0Yy5zZXR0aW5ncy5mYXN0ZXJLZXlDb2RlID0gTnVtYmVyKHN0b3JhZ2UuZmFzdGVyS2V5Q29kZSk7CiAgICB0Yy5zZXR0aW5ncy5kaXNwbGF5S2V5Q29kZSA9IE51bWJlcihzdG9yYWdlLmRpc3BsYXlLZXlDb2RlKTsKICAgIHRjLnNldHRpbmdzLmFkdmFuY2VLZXlDb2RlID0gTnVtYmVyKHN0b3JhZ2UuYWR2YW5jZUtleUNvZGUpOwogICAgdGMuc2V0dGluZ3MucmVtZW1iZXJTcGVlZCA9IEJvb2xlYW4oc3RvcmFnZS5yZW1lbWJlclNwZWVkKTsKICAgIHRjLnNldHRpbmdzLmJsYWNrbGlzdCA9IFN0cmluZyhzdG9yYWdlLmJsYWNrbGlzdCk7CgogICAgaW5pdGlhbGl6ZVdoZW5SZWFkeShkb2N1bWVudCk7CiAgfSk7CgogIHZhciBmb3JFYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2g7CgogIGZ1bmN0aW9uIGRlZmluZVZpZGVvQ29udHJvbGxlcigpIHsKICAgIHRjLnZpZGVvQ29udHJvbGxlciA9IGZ1bmN0aW9uKHRhcmdldCwgcGFyZW50KSB7CiAgICAgIHRoaXMudmlkZW8gPSB0YXJnZXQ7CiAgICAgIHRoaXMucGFyZW50ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQgfHwgcGFyZW50OwogICAgICB0aGlzLmRvY3VtZW50ID0gdGFyZ2V0Lm93bmVyRG9jdW1lbnQ7CiAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7CiAgICAgIGlmICghdGMuc2V0dGluZ3MucmVtZW1iZXJTcGVlZCkgewogICAgICAgIHRjLnNldHRpbmdzLnNwZWVkID0gMS4wOwogICAgICB9CiAgICAgIHRoaXMuaW5pdGlhbGl6ZUNvbnRyb2xzKCk7CgogICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcigncGxheScsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgdGFyZ2V0LnBsYXliYWNrUmF0ZSA9IHRjLnNldHRpbmdzLnNwZWVkOwogICAgICB9KTsKCiAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdyYXRlY2hhbmdlJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICBpZiAodGFyZ2V0LnJlYWR5U3RhdGUgPT09IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHNwZWVkID0gdGhpcy5nZXRTcGVlZCgpOwogICAgICAgIHRoaXMuc3BlZWRJbmRpY2F0b3IudGV4dENvbnRlbnQgPSBzcGVlZDsKICAgICAgICB0Yy5zZXR0aW5ncy5zcGVlZCA9IHNwZWVkOwogICAgICAgIGNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHsnc3BlZWQnOiBzcGVlZH0pOwogICAgICB9LmJpbmQodGhpcykpOwoKICAgICAgdGFyZ2V0LnBsYXliYWNrUmF0ZSA9IHRjLnNldHRpbmdzLnNwZWVkOwogICAgfTsKCiAgICB0Yy52aWRlb0NvbnRyb2xsZXIucHJvdG90eXBlLmdldFNwZWVkID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHRoaXMudmlkZW8ucGxheWJhY2tSYXRlKS50b0ZpeGVkKDIpOwogICAgfQoKICAgIHRjLnZpZGVvQ29udHJvbGxlci5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzKTsKICAgIH0KCiAgICB0Yy52aWRlb0NvbnRyb2xsZXIucHJvdG90eXBlLmluaXRpYWxpemVDb250cm9scyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgZG9jdW1lbnQgPSB0aGlzLmRvY3VtZW50OwogICAgICB2YXIgc3BlZWQgPSBwYXJzZUZsb2F0KHRjLnNldHRpbmdzLnNwZWVkKS50b0ZpeGVkKDIpLAogICAgICAgIHRvcCA9IE1hdGgubWF4KHRoaXMudmlkZW8ub2Zmc2V0VG9wLCAwKSArICJweCIsCiAgICAgICAgbGVmdCA9IE1hdGgubWF4KHRoaXMudmlkZW8ub2Zmc2V0TGVmdCwgMCkgKyAicHgiOwoKICAgICAgdmFyIHByZXZlbnQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIH0KCiAgICAgIHZhciB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgndnNjLWNvbnRyb2xsZXInKTsKICAgICAgd3JhcHBlci5kYXRhc2V0Wyd2c2NpZCddID0gdGhpcy5pZDsKICAgICAgd3JhcHBlci5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIHByZXZlbnQsIHRydWUpOwogICAgICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHByZXZlbnQsIHRydWUpOwogICAgICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcHJldmVudCwgdHJ1ZSk7CgogICAgICB2YXIgc2hhZG93ID0gd3JhcHBlci5jcmVhdGVTaGFkb3dSb290KCk7CiAgICAgIHZhciBzaGFkb3dUZW1wbGF0ZSA9IGAKICAgICAgICA8c3R5bGU+CiAgICAgICAgICBAaW1wb3J0ICIke2Nocm9tZS5leHRlbnNpb24uZ2V0VVJMKCdzaGFkb3cuY3NzJyl9IjsKICAgICAgICA8L3N0eWxlPgoKICAgICAgICA8ZGl2IGlkPSJjb250cm9sbGVyIiBzdHlsZT0idG9wOiR7dG9wfTsgbGVmdDoke2xlZnR9Ij4KICAgICAgICAgIDxzcGFuIGRhdGEtYWN0aW9uPSJkcmFnIiBjbGFzcz0iZHJhZ2dhYmxlIj4ke3NwZWVkfTwvc3Bhbj4KICAgICAgICAgIDxzcGFuIGlkPSJjb250cm9scyI+CiAgICAgICAgICAgIDxidXR0b24gZGF0YS1hY3Rpb249InJld2luZCIgY2xhc3M9InJ3Ij7CqzwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGRhdGEtYWN0aW9uPSJzbG93ZXIiPi08L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWFjdGlvbj0iZmFzdGVyIj4rPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gZGF0YS1hY3Rpb249ImFkdmFuY2UiIGNsYXNzPSJydyI+wrs8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWFjdGlvbj0iY2xvc2UiIGNsYXNzPSJoaWRlQnV0dG9uIj54PC9idXR0b24+CiAgICAgICAgICA8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgIGA7CiAgICAgIHNoYWRvdy5pbm5lckhUTUwgPSBzaGFkb3dUZW1wbGF0ZTsKICAgICAgc2hhZG93LnF1ZXJ5U2VsZWN0b3IoJy5kcmFnZ2FibGUnKS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoZSkgPT4gewogICAgICAgIHJ1bkFjdGlvbihlLnRhcmdldC5kYXRhc2V0WydhY3Rpb24nXSwgZG9jdW1lbnQpOwogICAgICB9KTsKCiAgICAgIGZvckVhY2guY2FsbChzaGFkb3cucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyksIGZ1bmN0aW9uKGJ1dHRvbikgewogICAgICAgIGJ1dHRvbi5vbmNsaWNrID0gKGUpID0+IHsKICAgICAgICAgIHJ1bkFjdGlvbihlLnRhcmdldC5kYXRhc2V0WydhY3Rpb24nXSwgZG9jdW1lbnQpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB0aGlzLnNwZWVkSW5kaWNhdG9yID0gc2hhZG93LnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTsKICAgICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh3cmFwcGVyKTsKCiAgICAgIC8vIE5vdGU6IHdoZW4gdHJpZ2dlcmVkIHZpYSBhIE11dGF0aW9uUmVjb3JkLCBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlCiAgICAgIC8vIHRhcmdldCBpcyBub3QgdGhlIGltbWVkaWF0ZSBwYXJlbnQuIFRoaXMgYXBwZW5kcyB0aGUgY29udHJvbGxlciBhcwogICAgICAvLyB0aGUgZmlyc3QgZWxlbWVudCBvZiB0aGUgdGFyZ2V0LCB3aGljaCBtYXkgbm90IGJlIHRoZSBwYXJlbnQuCiAgICAgIHRoaXMucGFyZW50Lmluc2VydEJlZm9yZShmcmFnbWVudCwgdGhpcy5wYXJlbnQuZmlyc3RDaGlsZCk7CiAgICAgIHRoaXMudmlkZW8uY2xhc3NMaXN0LmFkZCgndnNjLWluaXRpYWxpemVkJyk7CiAgICAgIHRoaXMudmlkZW8uZGF0YXNldFsndnNjaWQnXSA9IHRoaXMuaWQ7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0aWFsaXplV2hlblJlYWR5KGRvY3VtZW50KSB7CiAgICBlc2NhcGVTdHJpbmdSZWdFeHAubWF0Y2hPcGVyYXRvcnNSZSA9IC9bfFxce30oKVtcXV4kKyo/Ll0vZzsKICAgIGZ1bmN0aW9uIGVzY2FwZVN0cmluZ1JlZ0V4cChzdHIpIHsKICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKGVzY2FwZVN0cmluZ1JlZ0V4cC5tYXRjaE9wZXJhdG9yc1JlLCAnXFwkJicpOwogICAgfQoKICAgIHZhciBibGFja2xpc3RlZCA9IGZhbHNlOwogICAgdGMuc2V0dGluZ3MuYmxhY2tsaXN0LnNwbGl0KCJcbiIpLmZvckVhY2gobWF0Y2ggPT4gewogICAgICBtYXRjaCA9IG1hdGNoLnJlcGxhY2UoL15ccyt8XHMrJC9nLCcnKQogICAgICBpZiAobWF0Y2gubGVuZ3RoID09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciByZWdleHAgPSBuZXcgUmVnRXhwKGVzY2FwZVN0cmluZ1JlZ0V4cChtYXRjaCkpOwogICAgICBpZiAocmVnZXhwLnRlc3QobG9jYXRpb24uaHJlZikpIHsKICAgICAgICBibGFja2xpc3RlZCA9IHRydWU7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9KQoKICAgIGlmIChibGFja2xpc3RlZCkKICAgICAgcmV0dXJuOwoKICAgIHZhciByZWFkeVN0YXRlQ2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICBpZiAoZG9jdW1lbnQgJiYgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykgewogICAgICAgIGNsZWFySW50ZXJ2YWwocmVhZHlTdGF0ZUNoZWNrSW50ZXJ2YWwpOwogICAgICAgIGluaXRpYWxpemVOb3coZG9jdW1lbnQpOwogICAgICB9CiAgICB9LCAxMCk7CiAgfQoKICBmdW5jdGlvbiBpbml0aWFsaXplTm93KGRvY3VtZW50KSB7CiAgICAgIGlmIChkb2N1bWVudCA9PT0gd2luZG93LmRvY3VtZW50KSB7CiAgICAgICAgZGVmaW5lVmlkZW9Db250cm9sbGVyKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7CiAgICAgICAgbGluay5ocmVmID0gY2hyb21lLmV4dGVuc2lvbi5nZXRVUkwoJ2luamVjdC5jc3MnKTsKICAgICAgICBsaW5rLnR5cGUgPSAndGV4dC9jc3MnOwogICAgICAgIGxpbmsucmVsID0gJ3N0eWxlc2hlZXQnOwogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgIH0KCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbihldmVudCkgewogICAgICAgIHZhciBrZXlDb2RlID0gZXZlbnQua2V5Q29kZTsKCiAgICAgICAgLy8gSWdub3JlIGlmIGZvbGxvd2luZyBtb2RpZmllciBpcyBhY3RpdmUuCiAgICAgICAgaWYgKGV2ZW50LmdldE1vZGlmaWVyU3RhdGUoIkFsdCIpCiAgICAgICAgICAgIHx8IGV2ZW50LmdldE1vZGlmaWVyU3RhdGUoIkNvbnRyb2wiKQogICAgICAgICAgICB8fCBldmVudC5nZXRNb2RpZmllclN0YXRlKCJGbiIpCiAgICAgICAgICAgIHx8IGV2ZW50LmdldE1vZGlmaWVyU3RhdGUoIk1ldGEiKQogICAgICAgICAgICB8fCBldmVudC5nZXRNb2RpZmllclN0YXRlKCJIeXBlciIpCiAgICAgICAgICAgIHx8IGV2ZW50LmdldE1vZGlmaWVyU3RhdGUoIk9TIikpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIElnbm9yZSBrZXlkb3duIGV2ZW50IGlmIHR5cGluZyBpbiBhbiBpbnB1dCBib3gKICAgICAgICBpZiAoKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQubm9kZU5hbWUgPT09ICdJTlBVVCcKICAgICAgICAgICAgICAmJiBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmdldEF0dHJpYnV0ZSgndHlwZScpID09PSAndGV4dCcpCiAgICAgICAgICAgIHx8IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuaXNDb250ZW50RWRpdGFibGUpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChrZXlDb2RlID09IHRjLnNldHRpbmdzLnJld2luZEtleUNvZGUpIHsKICAgICAgICAgIHJ1bkFjdGlvbigncmV3aW5kJywgZG9jdW1lbnQsIHRydWUpCiAgICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID09IHRjLnNldHRpbmdzLmFkdmFuY2VLZXlDb2RlKSB7CiAgICAgICAgICBydW5BY3Rpb24oJ2FkdmFuY2UnLCBkb2N1bWVudCwgdHJ1ZSkKICAgICAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT0gdGMuc2V0dGluZ3MuZmFzdGVyS2V5Q29kZSkgewogICAgICAgICAgcnVuQWN0aW9uKCdmYXN0ZXInLCBkb2N1bWVudCwgdHJ1ZSkKICAgICAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT0gdGMuc2V0dGluZ3Muc2xvd2VyS2V5Q29kZSkgewogICAgICAgICAgcnVuQWN0aW9uKCdzbG93ZXInLCBkb2N1bWVudCwgdHJ1ZSkKICAgICAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT0gdGMuc2V0dGluZ3MucmVzZXRLZXlDb2RlKSB7CiAgICAgICAgICBydW5BY3Rpb24oJ3Jlc2V0JywgZG9jdW1lbnQsIHRydWUpCiAgICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID09IHRjLnNldHRpbmdzLmRpc3BsYXlLZXlDb2RlKSB7CiAgICAgICAgICBydW5BY3Rpb24oJ2Rpc3BsYXknLCBkb2N1bWVudCwgdHJ1ZSkKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwgdHJ1ZSk7CgogICAgICBmdW5jdGlvbiBjaGVja0ZvclZpZGVvKG5vZGUsIHBhcmVudCwgYWRkZWQpIHsKICAgICAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gJ1ZJREVPJykgewogICAgICAgICAgaWYgKGFkZGVkKSB7CiAgICAgICAgICAgIGlmICghbm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ3ZzYy1pbml0aWFsaXplZCcpKSB7CiAgICAgICAgICAgICAgbmV3IHRjLnZpZGVvQ29udHJvbGxlcihub2RlLCBwYXJlbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobm9kZS5jbGFzc0xpc3QuY29udGFpbnMoJ3ZzYy1pbml0aWFsaXplZCcpKSB7CiAgICAgICAgICAgICAgbGV0IGlkID0gbm9kZS5kYXRhc2V0Wyd2c2NpZCddOwogICAgICAgICAgICAgIGxldCBjdHJsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W2RhdGEtdnNjaWQ9IiR7aWR9Il1gKQogICAgICAgICAgICAgIGlmIChjdHJsKSB7CiAgICAgICAgICAgICAgICBub2RlLmNsYXNzTGlzdC5yZW1vdmUoJ3ZzYy1pbml0aWFsaXplZCcpOwogICAgICAgICAgICAgICAgY3RybC5yZW1vdmUoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5vZGUuY2hpbGRyZW4gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2hlY2tGb3JWaWRlbyhub2RlLmNoaWxkcmVuW2ldLAogICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuY2hpbGRyZW5baV0ucGFyZW50Tm9kZSB8fCBwYXJlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHsKICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtdXRhdGlvbikgewogICAgICAgICAgZm9yRWFjaC5jYWxsKG11dGF0aW9uLmFkZGVkTm9kZXMsIGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBub2RlID09PSAiZnVuY3Rpb24iKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgY2hlY2tGb3JWaWRlbyhub2RlLCBub2RlLnBhcmVudE5vZGUgfHwgbXV0YXRpb24udGFyZ2V0LCB0cnVlKTsKICAgICAgICAgIH0pCiAgICAgICAgICBmb3JFYWNoLmNhbGwobXV0YXRpb24ucmVtb3ZlZE5vZGVzLCBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZSA9PT0gImZ1bmN0aW9uIikKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGNoZWNrRm9yVmlkZW8obm9kZSwgbm9kZS5wYXJlbnROb2RlIHx8IG11dGF0aW9uLnRhcmdldCwgZmFsc2UpOwogICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIG9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQsIHsgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOwoKICAgICAgdmFyIHZpZGVvVGFncyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd2aWRlbycpOwogICAgICBmb3JFYWNoLmNhbGwodmlkZW9UYWdzLCBmdW5jdGlvbih2aWRlbykgewogICAgICAgIG5ldyB0Yy52aWRlb0NvbnRyb2xsZXIodmlkZW8pOwogICAgICB9KTsKCiAgICAgIHZhciBmcmFtZVRhZ3MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaWZyYW1lJyk7CiAgICAgIGZvckVhY2guY2FsbChmcmFtZVRhZ3MsIGZ1bmN0aW9uKGZyYW1lKSB7CiAgICAgICAgLy8gSWdub3JlIGZyYW1lcyB3ZSBkb24ndCBoYXZlIHBlcm1pc3Npb24gdG8gYWNjZXNzIChkaWZmZXJlbnQgb3JpZ2luKS4KICAgICAgICB0cnkgeyB2YXIgY2hpbGREb2N1bWVudCA9IGZyYW1lLmNvbnRlbnREb2N1bWVudCB9IGNhdGNoIChlKSB7IHJldHVybiB9CiAgICAgICAgaW5pdGlhbGl6ZVdoZW5SZWFkeShjaGlsZERvY3VtZW50KTsKICAgICAgfSk7CiAgfQoKICBmdW5jdGlvbiBydW5BY3Rpb24oYWN0aW9uLCBkb2N1bWVudCwga2V5Ym9hcmQpIHsKICAgIHZhciB2aWRlb1RhZ3MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndmlkZW8nKTsKICAgIHZpZGVvVGFncy5mb3JFYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2g7CgogICAgdmlkZW9UYWdzLmZvckVhY2goZnVuY3Rpb24odikgewogICAgICB2YXIgaWQgPSB2LmRhdGFzZXRbJ3ZzY2lkJ107CiAgICAgIHZhciBjb250cm9sbGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W2RhdGEtdnNjaWQ9IiR7aWR9Il1gKTsKCiAgICAgIGlmIChrZXlib2FyZCkKICAgICAgICBzaG93Q29udHJvbGxlcihjb250cm9sbGVyKTsKCiAgICAgIGlmICghdi5jbGFzc0xpc3QuY29udGFpbnMoJ3ZzYy1jYW5jZWxsZWQnKSkgewogICAgICAgIGlmIChhY3Rpb24gPT09ICdyZXdpbmQnKSB7CiAgICAgICAgICB2LmN1cnJlbnRUaW1lIC09IHRjLnNldHRpbmdzLnJld2luZFRpbWU7CiAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdhZHZhbmNlJykgewogICAgICAgICAgdi5jdXJyZW50VGltZSArPSB0Yy5zZXR0aW5ncy5hZHZhbmNlVGltZTsKICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2Zhc3RlcicpIHsKICAgICAgICAgIC8vIE1heGltdW0gcGxheWJhY2sgc3BlZWQgaW4gQ2hyb21lIGlzIHNldCB0byAxNjoKICAgICAgICAgIC8vIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vY29kZXNlYXJjaCNjaHJvbWl1bS9zcmMvbWVkaWEvYmxpbmsvd2VibWVkaWFwbGF5ZXJfaW1wbC5jYyZsPTY0CiAgICAgICAgICB2YXIgcyA9IE1hdGgubWluKHYucGxheWJhY2tSYXRlICsgdGMuc2V0dGluZ3Muc3BlZWRTdGVwLCAxNik7CiAgICAgICAgICB2LnBsYXliYWNrUmF0ZSA9IE51bWJlcihzLnRvRml4ZWQoMikpOwogICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnc2xvd2VyJykgewogICAgICAgICAgLy8gQXVkaW8gcGxheWJhY2sgaXMgY3V0IGF0IDAuMDU6CiAgICAgICAgICAvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2NvZGVzZWFyY2gjY2hyb21pdW0vc3JjL21lZGlhL2ZpbHRlcnMvYXVkaW9fcmVuZGVyZXJfYWxnb3JpdGhtLmNjJmw9NDkKICAgICAgICAgIHZhciBzID0gTWF0aC5tYXgodi5wbGF5YmFja1JhdGUgLSB0Yy5zZXR0aW5ncy5zcGVlZFN0ZXAsIDApOwogICAgICAgICAgdi5wbGF5YmFja1JhdGUgPSBOdW1iZXIocy50b0ZpeGVkKDIpKTsKICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ3Jlc2V0JykgewogICAgICAgICAgdi5wbGF5YmFja1JhdGUgPSAxLjA7CiAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdjbG9zZScpIHsKICAgICAgICAgIHYuY2xhc3NMaXN0LmFkZCgndnNjLWNhbmNlbGxlZCcpOwogICAgICAgICAgY29udHJvbGxlci5yZW1vdmUoKTsKICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2Rpc3BsYXknKSB7CiAgICAgICAgICBjb250cm9sbGVyLmNsYXNzTGlzdC5hZGQoJ3ZzYy1tYW51YWwnKTsKICAgICAgICAgIGNvbnRyb2xsZXIuY2xhc3NMaXN0LnRvZ2dsZSgndnNjLWhpZGRlbicpOwogICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAnZHJhZycpIHsKICAgICAgICAgIGhhbmRsZURyYWcodiwgY29udHJvbGxlcik7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9CgogZnVuY3Rpb24gaGFuZGxlRHJhZyh2aWRlbywgY29udHJvbGxlcikgewogICAgY29uc3QgcGFyZW50RWxlbWVudCA9IGNvbnRyb2xsZXIucGFyZW50RWxlbWVudCwKICAgICAgYm91bmRSZWN0ID0gcGFyZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwKICAgICAgc2hhZG93Q29udHJvbGxlciA9IGNvbnRyb2xsZXIuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKCcjY29udHJvbGxlcicpLAogICAgICBkcmFnID0gc2hhZG93Q29udHJvbGxlci5xdWVyeVNlbGVjdG9yKCcuZHJhZ2dhYmxlJyksCiAgICAgIG9mZnNldExlZnQgPSBib3VuZFJlY3QubGVmdCArIGRyYWcub2Zmc2V0TGVmdCArIGRyYWcub2Zmc2V0V2lkdGgsCiAgICAgIG9mZnNldFRvcCA9IGJvdW5kUmVjdC50b3AgKyBkcmFnLm9mZnNldFRvcCArIGRyYWcub2Zmc2V0SGVpZ2h0OwoKICAgIHZpZGVvLmNsYXNzTGlzdC5hZGQoJ3Zjcy1kcmFnZ2luZycpOwogICAgc2hhZG93Q29udHJvbGxlci5jbGFzc0xpc3QuYWRkKCdkcmFnZ2luZycpOwoKICAgIGNvbnN0IHN0YXJ0RHJhZ2dpbmcgPSAoZSkgPT4gewogICAgICBsZXQgbmV3TGVmdCA9IE1hdGgubWF4KDAsIGUuY2xpZW50WCAtIG9mZnNldExlZnQpOwogICAgICBsZXQgbmV3VG9wID0gTWF0aC5tYXgoMCwgZS5jbGllbnRZIC0gb2Zmc2V0VG9wKTsKCiAgICAgIHNoYWRvd0NvbnRyb2xsZXIuc3R5bGUubGVmdCA9IG5ld0xlZnQgKyAncHgnOwogICAgICBzaGFkb3dDb250cm9sbGVyLnN0eWxlLnRvcCA9IG5ld1RvcCArICdweCc7CiAgICB9CgogICAgY29uc3Qgc3RvcERyYWdnaW5nID0gKCkgPT4gewogICAgICBwYXJlbnRFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHN0YXJ0RHJhZ2dpbmcpOwogICAgICBwYXJlbnRFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBzdG9wRHJhZ2dpbmcpOwogICAgICBwYXJlbnRFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBzdG9wRHJhZ2dpbmcpOwoKICAgICAgc2hhZG93Q29udHJvbGxlci5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpOwogICAgICB2aWRlby5jbGFzc0xpc3QucmVtb3ZlKCd2Y3MtZHJhZ2dpbmcnKTsKICAgIH0KCiAgICBwYXJlbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLHN0b3BEcmFnZ2luZyk7CiAgICBwYXJlbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLHN0b3BEcmFnZ2luZyk7CiAgICBwYXJlbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHN0YXJ0RHJhZ2dpbmcpOwogIH0KCiAgdmFyIHRpbWVyOwogIHZhciBhbmltYXRpb24gPSBmYWxzZTsKICBmdW5jdGlvbiBzaG93Q29udHJvbGxlcihjb250cm9sbGVyKSB7CiAgICBjb250cm9sbGVyLmNsYXNzTGlzdC5hZGQoJ3Zjcy1zaG93Jyk7CgogICAgaWYgKGFuaW1hdGlvbikKICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKCiAgICBhbmltYXRpb24gPSB0cnVlOwogICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICBjb250cm9sbGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Zjcy1zaG93Jyk7CiAgICAgIGFuaW1hdGlvbiA9IGZhbHNlOwogICAgfSwgMjAwMCk7CiAgfQp9KTsK"},{"name":"hhFiller","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http://hh.ru/*","https://hh.ru/*","http://career.ru/*","https://moikrug.ru/*","http://itmozg.ru/*","http://www.superjob.ru/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1472334129971,"data":{}},"enabled":false,"position":36,"file_url":"https://greasyfork.org/scripts/10338-hhfiller/code/hhFiller.user.js","uuid":"fb37e825-73c9-4a28-bec2-1f5d307a78b6","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGlkICAgICAgICAgICAgIGhoRmlsbGVyCi8vIEBuYW1lICAgICAgICAgICBoaEZpbGxlcgovLyBAbmFtZTpydSAgICAgICAgaGhGaWxsZXIKLy8gQHZlcnNpb24gICAgICAgIDkuMjAxNi41LjMxCi8vIEBuYW1lc3BhY2UgICAgICBnaXRodWIuaW8vc3BtYnQKLy8gQGF1dGhvciAgICAgICAgIHNwbWJ0Ci8vIEBkZXNjcmlwdGlvbiAgICBGaWxsIHJlc3BvbnNlIHBvc3QgZm9yIHZhY2F0aW9uIGluIGhoLnJ1IGJ5IHRlbXBsYXRlCi8vIEBkZXNjcmlwdGlvbjpydSDQl9Cw0L/QvtC70L3QuNGC0Ywg0L7RgtC60LvQuNC6INC90LAg0LLQsNC60LDQvdGB0LjRjiDQvdCwIGhoLnJ1fGNhcmVlcnxtb2lrcnVnfGl0bW96Z3xzdXBlcmpvYiDRgSDQv9C+0LzQvtGJ0YzRjiDRiNCw0LHQu9C+0L3QsAovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL2hoLnJ1LyoKLy8gQGluY2x1ZGUgICAgICAgIGh0dHBzOi8vaGgucnUvKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL2NhcmVlci5ydS8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwczovL21vaWtydWcucnUvKgovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL2l0bW96Zy5ydS8qCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3LnN1cGVyam9iLnJ1LyoKLy8gQHJ1bi1hdCAgICAgICAgIGRvY3VtZW50LWVuZAovLyBAdXBkYXRlIDggaHR0cHMtaGgucnU7Ci8vIEB1cGRhdGUgNyBpdG1vemcucnUsc3VwZXJqb2IucnUgYWRkZWQ7Ci8vIEB1cGRhdGUgNSBzYXZlIHNlbGVjdGlvbiB0aHJvdyAidGVzdHMgcGFnZSI7IGNsZWFuIGJhbm5lcnM7Ci8vIEBncmFudCAgICAgICAgICBub25lCi8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24od2luLCB1LCBub0NvbnNvbGUsIGxldHRlclRtcGwsIGFkZFRtcGwpewppZih3aW4gIT0gdG9wKSByZXR1cm47IC8v0L3QtSDQstGL0L/QvtC70L3Rj9GC0Ywg0LIg0YTRgNC10LnQvNC1Cgp2YXIgc2l0ZSA9ICh7J2hoLnJ1JzonaGgnLCAnY2FyZWVyLnJ1JzonaGgnLCAnbW9pa3J1Zy5ydSc6J21vaWtydWcnLCAnaXRtb3pnLnJ1JzonaXRtb3pnJywgJ3d3dy5zdXBlcmpvYi5ydSc6J3N1cGVyam9iJ30pW2xvY2F0aW9uLmhvc3RdOyAvL9GB0LDQudGCLCDQvtC/0YDQtdC00LXQu9GP0Y7RidC40Lkg0YHQv9C+0YHQvtCxINC4INC/0YDQsNCy0LjQu9CwINC/0YPQsdC70LjQutCw0YbQuNC4Cgp2YXIgJGUgPSBmdW5jdGlvbihnKXsgLy89PT3RgdC+0LfQtNCw0YLRjCDQuNC70Lgg0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINC40LzQtdGO0YnQuNC50YHRjyDRjdC70LXQvNC10L3RgiBET009PT0KLy9nPXtlbCxibGNrLGVsQSxjbCxodCxjcyxhdCxvbixhcFQscHJULGJlZixhZnR9CglpZih0eXBlb2YgZy5lbCA9PSdmdW5jdGlvbicpIGcuZWwgPSBnLmVsLmFwcGx5KGcsIGcuZWxBKTsKCWlmKCFnLmVsICYmIGcuZWwgIT09dW5kZWZpbmVkICYmIGcuZWwgIT0nJykgcmV0dXJuIGcuZWw7IC8vbnVsbHwwfGZhbHNlCgl2YXIgbyA9IGcuZWwgPSBnLmVsIHx8J0RJVic7CglvID0gZy5lbCA9IHR5cGVvZiBvID09J3N0cmluZyc/IC9cVy8udGVzdChvKSA/ICRxKG8sIGcuYmxjaykgOiB3aW4uZG9jdW1lbnQuY3JlYXRlRWxlbWVudChvKSA6IG87CglpZihvKXsgLy/QstGL0L/QvtC70L3Rj9GC0YwsINC10YHQu9C4INGB0YPRidC10YHRgtCy0YPQtdGCIGVsCgkJaWYoZy5jbCkKCQkJby5jbGFzc05hbWUgPSBnLmNsOwoJCWlmKGcuY3MpCgkJCSR4KG8uc3R5bGUsIGcuY3MpOwoJCWlmKGcuaHQgfHwgZy5hdCl7CgkJCXZhciBhdCA9IGcuYXQgfHx7fTsgaWYoZy5odCkgYXQuaW5uZXJIVE1MID0gZy5odDt9CgkJaWYoYXQpCgkJCWZvcih2YXIgaSBpbiBhdCl7CgkJCQlpZihpPT0naW5uZXJIVE1MJykgb1tpXSA9IGF0W2ldOwoJCQkJZWxzZSBvLnNldEF0dHJpYnV0ZShpLCBhdFtpXSk7fQoJCWlmKGcub24pCgkJCWZvcih2YXIgaSBpbiBnLm9uKSBpZihnLm9uW2ldKQoJCQkJby5hZGRFdmVudExpc3RlbmVyKGksIGcub25baV0sITEpOwoJCWcuYXBUICYmIGcuYXBULmFwcGVuZENoaWxkKG8pOwoJCWcucHJUICYmIChnLnByVC5maXJzdENoaWxkCgkJCT8gZy5wclQuaW5zZXJ0QmVmb3JlKG8sIGcucHJULmZpcnN0Q2hpbGQpCgkJCTogZy5wclQuYXBwZW5kQ2hpbGQobykgKTsKCQlnLmJlZiAmJiBnLmJlZi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShvLCBnLmJlZik7CgkJZy5hZnQgJiYgKGcuYWZ0Lm5leHRTaWJsaW5nCgkJCT8gZy5hZnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobywgZy5hZnQubmV4dFNpYmxpbmcpCgkJCTogZy5hZnQucGFyZW50Tm9kZS5hcHBlbmRDaGlsZChvKSApOwoJfQoJcmV0dXJuIG87Cn0KLCRxID0gZnVuY3Rpb24ocSwgZil7IHJldHVybiAoZnx8d2luLmRvY3VtZW50KS5xdWVyeVNlbGVjdG9yKHEpO30KLCR4ID0gZnVuY3Rpb24oZWwsIGgpe2lmKGgpIGZvcih2YXIgaSBpbiBoKSBlbFtpXSA9IGhbaV07IHJldHVybiBlbDt9IC8vPT09ZXh0ZW5kPT09CiwkcUEgPSBmdW5jdGlvbihxLCBmKXsgcmV0dXJuIChmfHx3aW4uZG9jdW1lbnQpLnF1ZXJ5U2VsZWN0b3JBbGwocSk7fQosd2NsID0gZnVuY3Rpb24oYSl7IGEgPSBhIT09dW5kZWZpbmVkID8gYSA6Jyc7IC8v0LLRi9Cy0L7QtCDQsiDQutC+0L3RgdC+0LvRjCAo0LTQu9GPINGC0LXRgdGC0L7QsiksINGBINC+0YLQutC70Y7Rh9C10L3QuNC10Lwg0L/QviBub0NvbnNvbGUgPT0xCglpZih3aW4uY29uc29sZSAmJiAhbm9Db25zb2xlKQoJCXdpbi5jb25zb2xlLmxvZy5hcHBseSh3aW4uY29uc29sZSwgdGhpcyBpbnN0YW5jZW9mIFN0cmluZwoJCQk/IFsiJz09IisgdGhpcyArIiciXS5jb25jYXQoW10uc2xpY2UuY2FsbChhcmd1bWVudHMpKQoJCQk6IGFyZ3VtZW50cyk7Cn0KCS8qKiDQv9C10YDQuNC+0LTQuNGH0LXRgdC60LDRjyDQv9GA0L7QstC10YDQutCwINGD0YHQu9C+0LLQuNGPINGBINGD0LLQtdC70LjRh9C10L3QuNC10Lwg0LjQvdGC0LXRgNCy0LDQu9CwCgkgKiBAY29uc3RydWN0b3IKCSAqIEBwYXJhbXtOdW1iZXJ9IHQgc3RhcnQgcGVyaW9kIG9mIGNoZWNrCgkgKiBAcGFyYW17TnVtYmVyfSBpIG51bWJlciBvZiBjaGVja3MKCSAqIEBwYXJhbXtOdW1iZXJ9IG0gbXVsdGlwbGllciBvZiBwZXJpb2QgaW5jcmVtZW50CgkgKiBAcGFyYW17RnVuY3Rpb259IGNoZWNrIGV2ZW50IGNvbmRpdGlvbgoJICogQHBhcmFte0Z1bmN0aW9ufSBvY2N1ciBldmVudCBoYW5kbGVyCgkgKi8KLFRvdXQgPSBmdW5jdGlvbihoKXsKCXZhciB0aCA9IHRoaXM7CgkoZnVuY3Rpb24oKXsKCQlpZigoaC5kYXQgPSBoLmNoZWNrKCkgKSkgLy93YWl0IG9mIHBvc2l0aXZlIHJlc3VsdCwgdGhlbiBvY2NjdXJlbnNlCgkJCWgub2NjdXIgJiYgaC5vY2N1cigpOwoJCWVsc2UgaWYoaC5pLS0gPjApIC8vbmV4dCBzbG93ZXIgc3RlcAoJCQl0aC53dyA9IHdpbi5zZXRUaW1lb3V0KGFyZ3VtZW50cy5jYWxsZWUsIChoLnQgKj0gaC5tKSApOwoJfSkoKTsKfQoscmVzdUggPTE4MCAvL9Cy0YvRgdC+0YLQsCDRgdC/0LjRgdC60LAg0YDQtdC30Y7QvNC1IChoaCkKLGhoTGVuTGFzdCA9MCAvL9GH0LjRgdC70L4g0LLRgdC10YUg0LrQvtC/0LjQuSDQv9C+0LvRjyDQstCy0L7QtNCwICjRgdC/0LXRhtC40YTQuNGH0L3QviDQtNC70Y8gaGgpCixzZWxNb2QgPScnLCBzZWxNb2RQcmV2ID0gc2VsTW9kCixzZWxDb3B5ID0gZnVuY3Rpb24oKXsgLy/QstGL0LTQtdC70LXQvdC90YvQuSDRgtC10LrRgdGCCgl2YXIgc2VsID0nJzsKCWlmKHNlbCA9IHdpbi5nZXRTZWxlY3Rpb24oKSArJycpewoJCXNlbCA9IChzZWwgKydcclxuJykucmVwbGFjZSgvWzsuLF1ccysoXHI/XG4pL2csJ1xyXG4nKQoJCQkucmVwbGFjZSgvKFteXHJcbl0pKFxyP1xuKS9nLCckMSA9PdC00LA7JDInKQoJCQkucmVwbGFjZSgvKFxyP1tcbjpdKVxzKz090LTQsDsvZywnJDEnKTsKCX07CglyZXR1cm4gc2VsOwp9LCBzZWxDLCBzZWxTOwpTdHJpbmcucHJvdG90eXBlLndjbCA9IHdjbDsgLy8o0LTQu9GPINCy0YvQstC+0LTQsCDQsiDQutC+0L3RgdC+0LvRjCkKCi8vINC/0L4g0L3QsNC20LDRgtC40Y4g0LrQvdC+0L/QutC4INC+0YLQstC10YLQsCDQvdCwINCy0LDQutCw0L3RgdC40Y4gLSDRgdC60L7Qv9C40YDQvtCy0LDRgtGMINCy0YvQtNC10LvQtdC90L3Ri9C5INGC0LXQutGB0YIgKNGBINC+0LHRgNCw0LHQvtGC0LrQvtC5KToKJGUoe2VsOicuSEgtVmFjYW5jeVJlc3BvbnNlUG9wdXAtTWFpbkJ1dHRvbicsIG9uOnttb3VzZWRvd246IHNlbEMgPSBmdW5jdGlvbihldil7CglzZWxNb2QgPSBzZWxDb3B5KCk7IC8vJ3NlbE1vZCcud2NsKHNlbE1vZCkKfX19KTsKJGUoe2VsOicuSEgtVmFjYW5jeVJlc3BvbnNlUG9wdXAtTGluaycsIG9uOnttb3VzZWRvd246IHNlbEN9fSk7CmlmKHNpdGUgPT0nbW9pa3J1ZycpIC8v0L/RgNC10LTQu9Cw0LPQsNGC0Ywg0L/QvtC00LzQtdC90YMg0L7RgtCy0LXRgtC+0LIg0L/RgNC4INC60LDQttC00L7QvCDQstGL0LTQtdC70LXQvdC40Lgg0YLQtdC60YHRgtCwCgkkZSh7ZWw6Jy5qb2Jfc2hvd19kZXNjcmlwdGlvbicsIG9uOnttb3VzZXVwOiBmdW5jdGlvbihldil7CgkJdmFyIHRhID0gJHEoJyN2YWNhbmN5X3Jlc3BvbnNlX2JvZHknKTsKCQlpZigoc2VsTW9kID0gc2VsQ29weSgpKSAmJiB0YSAmJiB3aW4uY29uZmlybSgKCQkJCSfQntCx0L3QvtCy0LjRgtGMINC+0LHQu9Cw0YHRgtGMINC+0YLQstC10YLQvtCyINC90LAg0YLRgNC10LHQvtCy0LDQvdC40Y8g0L3QvtCy0YvQvCDQstGL0LTQtdC70LXQvdC90YvQvCDRgtC10LrRgdGC0L7QvD9cbijQktGB0LUg0LjQt9C80LXQvdC10L3QuNGPINCyINGB0YLQsNGA0L7QvCDRgtC10LrRgdGC0LUg0L/RgNC+0L/QsNC00YPRgi4pJykpewoJCQlpZighUmVnRXhwKGFkZFRtcGwpLnRlc3QodGEudmFsdWUpKQoJCQkJdGEudmFsdWUgPSB0YS52YWx1ZSArIGFkZFRtcGw7CgkJCXRhLnZhbHVlID0gdGEudmFsdWUucmVwbGFjZShSZWdFeHAoJygnK2FkZFRtcGwucmVwbGFjZSgvXHIvZywnXFxccj8nKS5yZXBsYWNlKC9cbi9nLCdcXFxuJykgKycpKFtcXHNcXFNdKiknKSwnJDEnKSArIHNlbE1vZDsKCQkJd2luLnNldFRpbWVvdXQoZnVuY3Rpb24oKXt0YS5zdHlsZS5oZWlnaHQgPSB0YS5zY3JvbGxIZWlnaHQgKydweCc7fSwwKTsKCQkJdGEuc3R5bGUubWF4SGVpZ2h0ID0nbm9uZSc7CgkJfQoJfX19KTsKaWYoc2l0ZSA9PSdzdXBlcmpvYicpIC8v0L/RgNC10LTQu9Cw0LPQsNGC0Ywg0L/QvtC00LzQtdC90YMg0L7RgtCy0LXRgtC+0LIg0L/RgNC4INC60LDQttC00L7QvCDQstGL0LTQtdC70LXQvdC40Lgg0YLQtdC60YHRgtCwCgkkZSh7ZWw6Jy5WYWNhbmN5Vmlld19kZXRhaWxzJywgb246e21vdXNldXA6IGZ1bmN0aW9uKGV2KXsKCQl2YXIgdGEgPSAkcSgnLlZhY2FuY3lWaWV3X2JvZHkgLlZhY2FuY3lTZW5kUmVzdW1lQnV0dG9uX3BvcHVwIC5WYWNhbmN5U2VuZFJlc3VtZUJ1dHRvbl9tZXNzYWdlX3RleHRhcmVhJyk7CgkJaWYoKHNlbE1vZCA9IHNlbENvcHkoKSkgJiYgdGEgJiYgd2luLmNvbmZpcm0oCgkJCQkn0J7QsdC90L7QstC40YLRjCDQvtCx0LvQsNGB0YLRjCDQvtGC0LLQtdGC0L7QsiDQvdCwINGC0YDQtdCx0L7QstCw0L3QuNGPINC90L7QstGL0Lwg0LLRi9C00LXQu9C10L3QvdGL0Lwg0YLQtdC60YHRgtC+0Lw/XG4o0JLRgdC1INC40LfQvNC10L3QtdC90LjRjyDQsiDRgdGC0LDRgNC+0Lwg0YLQtdC60YHRgtC1INC/0YDQvtC/0LDQtNGD0YIuKScpKXsKCQkJaWYoIVJlZ0V4cChhZGRUbXBsKS50ZXN0KHRhLnZhbHVlKSkKCQkJCXRhLnZhbHVlID0gdGEudmFsdWUgKyBhZGRUbXBsOwoJCQl0YS52YWx1ZSA9IHRhLnZhbHVlLnJlcGxhY2UoUmVnRXhwKCcoJythZGRUbXBsLnJlcGxhY2UoL1xyL2csJ1xcXHI/JykucmVwbGFjZSgvXG4vZywnXFxcbicpICsnKShbXFxzXFxTXSopJyksJyQxJykgKyBzZWxNb2Q7CgkJCXdpbi5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dGEuc3R5bGUuaGVpZ2h0ID0gdGEuc2Nyb2xsSGVpZ2h0ICsncHgnO30sMCk7CgkJCXRhLnN0eWxlLm1heEhlaWdodCA9J25vbmUnOwoJCX0KCX19fSk7CmlmKC9eaGgkfGl0bW96Zy8udGVzdChzaXRlKSl7IC8v0YHQvtGF0YDQsNC90Y/RgtGMINCy0YvQtNC10LvQtdC90L3QvtC1CgkkZSh7ZWw6Jy5iLXZhY2FuY3ktZGVzYy5nLXVzZXItY29udGVudCcsIG9uOnttb3VzZXVwOiBzZWxTID0gZnVuY3Rpb24oZXYpewoJCWlmKHNlbE1vZCA9IHNlbENvcHkoKSkgLy/RgdC+0YXRgNCw0L3QuNGC0Ywg0L3QtdC/0YPRgdGC0L7QtSDQstGL0LTQtdC70LXQvdC40LUg0L3QsCDRgdC70YPRh9Cw0Lkg0L/QtdGA0LXRhdC+0LTQsCDRh9C10YDQtdC3ICLRgtC10YHRgtC+0LLRg9GOINGB0YLRgNCw0L3QuNGG0YMiCgkJCWxvY2FsU3RvcmFnZS5sYXN0U2VsID0gc2VsTW9kOyAvLyAuLi7QuNC70Lgg0L/RgNC+0YHRgtC+INC90LAg0L3QvtCy0YPRjiDRgdGC0YDQsNC90LjRhtGDINC00LvRjyBpdG16b2cKCX19fSk7CgkkZSh7ZWw6Jy5yZXNwb25kLmJ1dHRvbi5tdC0zMCcsIG9uOnttb3VzZXVwOiBzZWxTfX0pOwp9CmlmKCFsb2NhbFN0b3JhZ2UudG1wbCAmJiAvXtCj0LJcLiDRgdC+0LjRgdC60LDRgtC10LvRjC8udGVzdChsZXR0ZXJUbXBsKSl7IC8v0L3QsNGH0LDQu9GM0L3QvtC1INC30LDQv9C+0LvQvdC10L3QuNC1INGI0LDQsdC70L7QvdCwCgkvL9C00LjQsNC70L7QsyDRgdC+0YXRgNCw0L3QtdC90LjRjyDQsiBsb2NhbFN0b3JhZ2Ug0YjQsNCx0LvQvtC90LAg0L/QuNGB0YzQvNCwCgkvL3djbCgndGFUbXBsQmFjaycpCgkkZSh7ZWw6ICRxKCcudGFUbXBsQmFjaycpfHwwIC8vLdGH0YLQvtCx0Ysg0YHQvtC30LTQsNGC0Ywg0L3QtSDQsdC+0LvQtdC1IDEg0YDQsNC30LAKCQksY2w6J3RhVG1wbEJhY2snCgkJLGNzOntwb3NpdGlvbjonZml4ZWQnLCB6SW5kZXg6IDk5OTkxLCB3aWR0aDonMTAwJScsIGhlaWdodDonMTAwJScsIHRvcDogMCwgYmFja2dyb3VuZDoncmdiYSg0OCw0OCw0OCwwLjQpJ30KCQksYXBUOiB3aW4uZG9jdW1lbnQuYm9keQoJfSk7CgkkZSh7ZWw6ICRxKCcudGFUbXBsT3ZlcicpfHwwCgkJLGNsOid0YVRtcGxPdmVyJwoJCSxjczp7cG9zaXRpb246J2ZpeGVkJywgekluZGV4OiA5OTk5Miwgd2lkdGg6Jzk4JScsIGhlaWdodDonODAlJywgbWFyZ2luOicwIDElJywgdG9wOicxMnB4J30KCQksaHQ6JzxkaXYgc3R5bGU9IndpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyB0ZXh0LWFsaWduOiBsZWZ0OyBiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsMC41KSI+JwoJCQkrJzxkaXYgc3R5bGU9ImRpc3BsYXk6IGlubGluZS1ibG9jazsgcGFkZGluZzogMCAyMHB4OyBib3JkZXItYm90dG9tOiAycHggZG90dGVkICMwMDA7IGZvbnQtc2l6ZToxNnB4OyBiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsMC41KTsgY29sb3I6IzMzMyI+JwoJCQkJKyfQodC+0L7QsdGJ0LXQvdC40LUg0L7RgiDRgdC60YDQuNC/0YLQsCA8YSBocmVmPSJodHRwczovL2dyZWFzeWZvcmsub3JnL2VuL3NjcmlwdHMvMTAzMzgtaGhmaWxsZXIiIHRhcmdldD1fYmxhbms+PGI+aGhmaWxsZXIudXNlci5qczwvYj48L2E+PC9kaXY+JwoJCQkrJzxkaXYgc3R5bGU9InBhZGRpbmc6IDRweCAwOyB0ZXh0LWFsaWduOiBjZW50ZXI7IGZvbnQtc2l6ZToyNHB4OyBiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsMC41KTsgY29sb3I6Izc3NyI+JysgbGV0dGVyVG1wbCArJzwvZGl2PicKCQkJKyc8dGV4dGFyZWEgY2xhc3M9InRhVG1wbCIgc3R5bGU9IndpZHRoOjgwJTsgaGVpZ2h0OjgwJTsgbWFyZ2luOiAxMHB4IDEwJTsiPjwvdGV4dGFyZWE+PGJyPicKCQkJKyc8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOiBjZW50ZXIiPicKCQkJCSsnPGJ1dHRvbiBvbmNsaWNrPSJ2YXIgZCA9IGRvY3VtZW50LCB0YVMgPSBkLnF1ZXJ5U2VsZWN0b3JBbGwoXCcudGFUbXBsXCcpLCB0YSA9IHRhU1t0YVMubGVuZ3RoIC0xXTsnCgkJCQkJKyd0YSAmJiAobG9jYWxTdG9yYWdlLnRtcGwgPSB0YS52YWx1ZSk7IGQucXVlcnlTZWxlY3RvcihcJy50YVRtcGxCYWNrXCcpLnN0eWxlLmRpc3BsYXkgJwoJCQkJCSsnPSBkLnF1ZXJ5U2VsZWN0b3IoXCcudGFUbXBsT3ZlclwnKS5zdHlsZS5kaXNwbGF5ID1cJ25vbmVcJzsiIHN0eWxlPSJmb250LXNpemU6IDI0cHgiPtCh0L7RhdGA0LDQvdC40YLRjDwvYnV0dG9uPjwvZGl2PicKCQkJKyc8ZGl2IHN0eWxlPSJ3aWR0aDo3OSU7IG1hcmdpbjogMTBweCAxMCU7IHBhZGRpbmc6IDEwcHg7IGZvbnQtc2l6ZToxNnB4OyBiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsMC41KTsgY29sb3I6IzMzMyI+0K3RgtC+0YIg0YLQtdC60YHRgiDQsdGD0LTQtdGCINC/0L7Rj9Cy0LvRj9GC0YzRgdGPINCyINC/0L7Qu9C1INC+0YLQstC10YLQsCcKCQkJCQkrICgoe2hoOicg0L/QviDQutC90L7Qv9C60LUgItCe0YLQutC70LjQutC90YPRgtGM0YHRjyDQvdCwINCy0LDQutCw0L3RgdC40Y4iJyxtb2lrcnVnOicnfSlbc2l0ZV18fCcnKSArJy48YnI+JwoJCQkJKyc8YSBocmVmPSJodHRwOi8vaGFicmFoYWJyLnJ1L3Bvc3QvMjU5ODgxLyIgdGFyZ2V0PV9ibGFuaz7Qn9C+0LTRgNC+0LHQvdC+0YHRgtC4PC9hPiA8aT4o0YHRgtCw0YLRjNGPINC+INGB0LrRgNC40L/RgtC1KTwvaT4uPGJyPicKCQkJCSsn0KfRgtC+0LHRiyDQt9Cw0L/QuNGB0LDRgtGMINC00YDRg9Cz0L7QuSDRiNCw0LHQu9C+0L0sINGB0L7RgtGA0LjRgtC1INC/0YDQtdC20L3QuNC5INC60L7QvNCw0L3QtNC+0LkgImxvY2FsU3RvcmFnZS50bXBsPVwnXCciINCyINC60L7QvdGB0L7Qu9C4Ljxicj4nCgkJCQkrJ9Cn0YLQvtCx0YsgPGk+0L7RgtC60LDQt9Cw0YLRjNGB0Y88L2k+INC+0YIg0LjRgdC/0L7Qu9GM0LfQvtCy0LDQvdC40Y8g0YjQsNCx0LvQvtC90LAsINC+0YLQutC70Y7Rh9C40YLQtSDRgdC60YDQuNC/0YIgaGhGaWxsZXIg0LIg0L3QsNGB0YLRgNC+0LnQutCw0YUg0LHRgNCw0YPQt9C10YDQsC48L2Rpdj4nCgkJKyc8L2Rpdj4nCgkJLGFwVDogd2luLmRvY3VtZW50LmJvZHkKCX0pOwp9CnZhciBmaWxsVGFyZWEgPSBmdW5jdGlvbigpewoJaWYoIXNlbE1vZCl7CgkJc2VsTW9kID0gbG9jYWxTdG9yYWdlLmxhc3RTZWw7CgkJc2VsTW9kICYmIChsb2NhbFN0b3JhZ2UubGFzdFNlbCA9JycpOwoJfQoJcmV0dXJuIChsb2NhbFN0b3JhZ2UudG1wbCB8fCBsZXR0ZXJUbXBsKS5yZXBsYWNlKC9cbj8kLywnXG4nKSArIChzZWxNb2QgJiYgKGFkZFRtcGwgKyBzZWxNb2QpfHwnJyk7Cn07Cgp2YXIgdGFDaGFuZ2VkID0wOwpuZXcgVG91dCh7dDo2MjAsIGk6MmU2LCBtOiAxIC8v0L/QtdGA0LjQvtC00LjRh9C10YHQutCw0Y8g0L/RgNC+0LLQtdGA0LrQsCDQvdCw0LvQuNGH0LjRjyDQv9C+0LvRjyDQstCy0L7QtNCwINC90LAg0YHRgtGA0LDQvdC40YbQtQoJLGNoZWNrOiAoewoJCWhoOiBmdW5jdGlvbigpewoJCQl2YXIgdEFyZWFzID0gJHFBKCcudmFjYW5jeS1yZXNwb25zZS1wb3B1cCAuYmxva28tdGV4dGFyZWEnKQoJCQkJLHRMYXN0OwoJCQlpZih0QXJlYXMubGVuZ3RoICYmICghKHRMYXN0ID0gdEFyZWFzW3RBcmVhcy5sZW5ndGggLTFdKS52YWx1ZQoJCQkJCXx8IGhoTGVuTGFzdCA8IHRBcmVhcy5sZW5ndGggJiYgc2VsTW9kUHJldiAhPSBzZWxNb2QpICl7IC8v0LXRgdC70Lgg0L/Rg9GB0YLQvtC1INC/0L7Qu9C1INCy0LLQvtC00LAgLSDQt9Cw0L/QvtC70L3QuNGC0Ywg0YjQsNCx0LvQvtC90L7QvAoJCQkJaWYoIXRMYXN0LnZhbHVlKQoJCQkJCXRMYXN0LnZhbHVlID0gZmlsbFRhcmVhKCk7CgkJCQlpZihzZWxNb2RQcmV2ICE9IHNlbE1vZCl7CgkJCQkJaWYoIVJlZ0V4cChhZGRUbXBsKS50ZXN0KHRMYXN0LnZhbHVlKSkKCQkJCQkJdExhc3QudmFsdWUgPSB0TGFzdC52YWx1ZSArIGFkZFRtcGwgOwoJCQkJCXRMYXN0LnZhbHVlID0gdExhc3QudmFsdWUucmVwbGFjZShSZWdFeHAoJygnK2FkZFRtcGwucmVwbGFjZSgvXHIvZywnXFxccj8nKS5yZXBsYWNlKC9cbi9nLCdcXFxuJykgKycpKFtcXHNcXFNdKiknKSxzZWxNb2QgPyckMSc6JycpICsgc2VsTW9kOwoJCQkJfQoJCQkJaGhMZW5MYXN0ID0gdEFyZWFzLmxlbmd0aDsKCQkJCXNlbE1vZFByZXYgPSBzZWxNb2Q7CgkJCX0KCQkJJGUoe2VsOiB0TGFzdCwgY3M6e2hlaWdodDogTWF0aC5tYXgoNDAwLCB3aW4uaW5uZXJIZWlnaHQgLSAyMjAgLy/RgNCw0YHRgtGP0L3Rg9GC0Ywg0L/QvtC70LUg0LLQstC+0LTQsCDQtNC70Y8g0YPQtNC+0LHRgdGC0LLQsAoJCQkJLSAocmVzdUggPSAoJHEoJy52YWNhbmN5LXJlc3BvbnNlLXBvcHVwX19yZXN1bWVzJyl8fHt9KS5vZmZzZXRIZWlnaHR8fHJlc3VIKSkgKydweCd9fSk7CgkJCXZhciBlbFRhID0gJHFBKCcuYmxva28tdG9nZ2xlX19leHBhbmRhYmxlJyk7CgkJCSRlKHtlbDogZWxUYS5sZW5ndGggJiYgZWxUYVtlbFRhLmxlbmd0aCAtMV0sIGNzOntkaXNwbGF5OidibG9jayd9fSk7IC8v0L/QvtC60LDQt9Cw0YLRjCDRgdCy0ZHRgNC90YPRgtC+0LUg0L/QvtC70LUg0LLQstC+0LTQsAoJCQkkZSh7ZWw6ICcucG9wdXAuZy1hbmltLWZhZGUuZy1hbmltLWZhZGVfaW4nLCBjczp7dG9wOjB9fSk7CgkJCXJldHVybiAwOwoJCX0KCQksbW9pa3J1ZzogZnVuY3Rpb24oKXsKCQkJdmFyIHRhID0gJHEoJyN2YWNhbmN5X3Jlc3BvbnNlX2JvZHknKTsKCQkJaWYodGEgJiYgIXRhLnZhbHVlKXsKCQkJCXRhLnZhbHVlID0gZmlsbFRhcmVhKCk7CgkJCQl3aW4uc2V0VGltZW91dChmdW5jdGlvbigpe3RhLnN0eWxlLmhlaWdodCA9IHRhLnNjcm9sbEhlaWdodCArJ3B4Jzt9LDApOyAvL9C/0L7QtNC/0YDQsNCy0LjRgtGMINCy0YvRgdC+0YLRgyDQv9C+0LvRjwoJCQkJdGEuc3R5bGUubWF4SGVpZ2h0ID0nbm9uZSc7CgkJCX0KCQkJcmV0dXJuIDA7CgkJfQkKCQksc3VwZXJqb2I6IGZ1bmN0aW9uKCl7CgkJCXZhciB0YSA9ICRxKCcuVmFjYW5jeVZpZXdfYm9keSAuVmFjYW5jeVNlbmRSZXN1bWVCdXR0b25fcG9wdXAgLlZhY2FuY3lTZW5kUmVzdW1lQnV0dG9uX21lc3NhZ2VfdGV4dGFyZWEnKQoJCQkJLHR4dCA9ICgkcSgnLlZhY2FuY3lTZW5kUmVzdW1lQ29udGFjdHNfdHh0IHNwYW4nKXx8e30pLmlubmVySFRNTHx8Jyc7CgkJCWlmKHRhICYmICF0YUNoYW5nZWQpewoJCQkJdGEudmFsdWUgPSBmaWxsVGFyZWEoKS5yZXBsYWNlKC8o0JfQtNGA0LDQstGB0YLQstGD0LnRgtC1KSghKS8sJyQxLCAnKyB0eHQgKyckMicpOwoJCQkJd2luLnNldFRpbWVvdXQoZnVuY3Rpb24oKXt0YS5zdHlsZS5oZWlnaHQgPSB0YS5zY3JvbGxIZWlnaHQgKydweCc7IHRhQ2hhbmdlZCA9IDE7fSw5MDApOyAvL9C/0L7QtNC/0YDQsNCy0LjRgtGMINCy0YvRgdC+0YLRgyDQv9C+0LvRjwoJCQkJdGEuc3R5bGUubWF4SGVpZ2h0ID0nbm9uZSc7CgkJCX0KCQkJcmV0dXJuIDA7CgkJfQoJCSxpdG1vemc6IGZ1bmN0aW9uKCl7CgkJCXZhciB0YSA9ICRxKCcjYXBwbHlGb3JtICN0ZXh0Jyk7CgkJCWlmKHRhICYmICF0YS52YWx1ZSl7CgkJCQl0YS52YWx1ZSA9IGZpbGxUYXJlYSgpOwoJCQkJd2luLnNldFRpbWVvdXQoZnVuY3Rpb24oKXt0YS5zdHlsZS5oZWlnaHQgPSB0YS5zY3JvbGxIZWlnaHQgKydweCc7fSwwKTsgLy/Qv9C+0LTQv9GA0LDQstC40YLRjCDQstGL0YHQvtGC0YMg0L/QvtC70Y8KCQkJCXRhLnN0eWxlLm1heEhlaWdodCA9J25vbmUnOwoJCQl9CgkJCSgkcUEoJyNyZXN1bWUgb3B0aW9uJyl8fFt7fSx7fV0pWzFdLnNlbGVjdGVkID0xOyAvL9Cy0YvQsdGA0LDRgtGMINC/0LXRgNCy0L7QtSDRgNC10LfRjtC80LUg0L/QviDRgdC/0LjRgdC60YMKCQkJcmV0dXJuIDA7CgkJfQp9KVtzaXRlXX0pOwooZnVuY3Rpb24oY3NzKXsgLy9hZGRSdWxlcwoJaWYodHlwZW9mIEdNX2FkZFN0eWxlICE9dSkgR01fYWRkU3R5bGUoY3NzKTsgLy9GeCxDaHIgKG9sZCkKCWVsc2UgaWYodHlwZW9mIGFkZFN0eWxlICE9dSkgYWRkU3R5bGUoY3NzKTsKCWVsc2UgLy9PcCBhbmQgYWxsCgkJJGUoe2VsOidzdHlsZScsIGFwVDogJHEoJ2hlYWQnKSB9KS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3MpKTsgLy/QvdC1INC/0YDQvtGF0L7QtNC40YIg0LIg0J7Qv9C10YDQtSDRh9C10YDQtdC3ICRlCn0pCignLnNlYXJjaC1yZXN1bHQtaXRlbV9fbGFiZWw6bm90KC5nLWhpZGRlbikgKy5zZWFyY2gtcmVzdWx0LWRlc2NyaXB0aW9ue2JhY2tncm91bmQtY29sb3I6I2VlZX0nCisnLnNlYXJjaC1yZXN1bHQtaXRlbV9fbGFiZWw6bm90KC5nLWhpZGRlbikgKy5zZWFyY2gtcmVzdWx0LWRlc2NyaXB0aW9uIC5zZWFyY2gtcmVzdWx0LWRlc2NyaXB0aW9uX19pdGVtX3ByaW1hcnl7bWFyZ2luLWJvdHRvbTotNnB4OyBwYWRkaW5nLWJvdHRvbTogNnB4O30nCisnZGl2W2NsYXNzKj0iYmFubmVyLXBsYWNlIl0sIGRpdltpZCo9Im10X290Il0sIC5iLW1haW5iYW5uZXJ7ZGlzcGxheTpub25lfScKKycuVmFjYW5jeVZpZXdfYm9keSAuVmFjYW5jeVNlbmRSZXN1bWVCdXR0b25fcG9wdXB7ZGlzcGxheTpibG9jayFpbXBvcnRhbnR9JworJy5WYWNhbmN5Vmlld19ib2R5IC5WYWNhbmN5U2VuZFJlc3VtZUJ1dHRvbl9tZXNzYWdlLCAuVmFjYW5jeVZpZXdfYm9keSAuVmFjYW5jeVNlbmRSZXN1bWVCdXR0b25fbWVzc2FnZV90ZXh0YXJlYV9iZ3toZWlnaHQ6YXV0bzt9Jyk7Cgp9KSh0b3AsJ3VuZGVmaW5lZCcsJycKCS8v0JLQvNC10YHRgtC+INGN0YLQvtC5INGB0YLRgNC+0LrQuCDQvNC+0LbQvdC+INCy0YHRgtCw0LLQuNGC0Ywg0YHQstC+0Lkg0YjQsNCx0LvQvtC9INC/0LjRgdGM0LzQsC4KCS8v0JXQs9C+INC20LUg0LzQvtC20L3QviDRgdC+0YXRgNCw0L3QuNGC0Ywg0LIgbG9jYWxTdG9yYWdlINCyINC00LjQsNC70L7Qs9C1INC/0L4g0LfQsNC/0YDQvtGB0YMg0YHQutGA0LjQv9GC0LAuCgkvLyjQmNGB0L/QvtC70YzQt9GD0LnRgtC1ICJcbiIg0LTQu9GPINC/0LXRgNC10LLQvtC00LAg0YLQtdC60YHRgtCwINC90LAg0L3QvtCy0YPRjiDRgdGC0YDQvtC60YMuKQoJLCfQo9CyLiDRgdC+0LjRgdC60LDRgtC10LvRjCEg0J/QvtC20LDQu9GD0LnRgdGC0LAsINC30LDQv9C+0LvQvdC40YLQtSDRjdGC0L4g0L/QvtC70LUg0YjQsNCx0LvQvtC90L7QvCDQvtGC0LLQtdGC0LAg0L3QsCDQstCw0LrQsNC90YHQuNGOLCDRgSDRg9GH0ZHRgtC+0Lwg0LLQsNGI0LjRhSDQuNC90LTQuNCy0LjQtNGD0LDQu9GM0L3Ri9GFINC60LDRh9C10YHRgtCyLicsCic9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cCtCe0YLQstC10YLRiyDQv9C+INCy0LDQutCw0L3RgdC40Lg6XHJcbicpOwo="},{"name":"Google youtube search link","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["/https?:\\/\\/(www\\.)?google\\.(com|(?:com?\\.)?\\w\\w)\\/.*/"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1472418533178,"data":{}},"enabled":false,"position":37,"file_url":"https://greasyfork.org/scripts/7784-google-youtube-search-link/code/Google%20youtube%20search%20link.user.js","uuid":"dd8113d8-d64c-488b-9302-f75cdf23218d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgR29vZ2xlIHlvdXR1YmUgc2VhcmNoIGxpbmsKLy8gQGluY2x1ZGUgICAgICAgL2h0dHBzPzpcL1wvKHd3d1wuKT9nb29nbGVcLihjb218KD86Y29tP1wuKT9cd1x3KVwvLiovCi8vIEBkZXNjcmlwdGlvbiAgIEFkZHMgYSBZb3V0dWJlIHNlYXJjaCBsaW5rOiBXZWIsIEltYWdlcywgVmlkZW9zLCBZb3V0dWJlLCBOZXdzLCBNYXBzLCBTaG9wcGluZywgLi4uCi8vIEB2ZXJzaW9uICAgICAgIDEuMS4xCi8vIEBhdXRob3IgICAgICAgIHdPeHhPbQovLyBAbmFtZXNwYWNlICAgICB3T3h4T20uc2NyaXB0cwovLyBAbGljZW5zZSAgICAgICBNSVQgTGljZW5zZQovLyBAZ3JhbnQgICAgICAgICBub25lCi8vIEBydW4tYXQgICAgICAgIGRvY3VtZW50LXN0YXJ0Ci8vIEByZXF1aXJlICAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8xMjIyOC9jb2RlL3NldE11dGF0aW9uSGFuZGxlci5qcwovLyA9PS9Vc2VyU2NyaXB0PT0KCnZhciByZWFycmFuZ2VJbWFnZXNWaWRlb3NZb3V0dWJlID0gdHJ1ZTsgLy8gYWx3YXlzIHB1dCAoaWYgcHJlc2VudCEpICJJbWFnZXMiIHRvIDJuZCBwbGFjZSwgIlZpZGVvcyIgdG8gM3JkIHBsYWNlLCAiWW91dHViZSIgdG8gNHRoIHBsYWNlCgp2YXIgc3RhdGUgPSAwOwpzZXRNdXRhdGlvbkhhbmRsZXIoZG9jdW1lbnQsICcjaGR0YiAuaGR0Yi1taXRlbSBhJywgZnVuY3Rpb24obm9kZXMpIHsKICB2YXIgeW91dHViZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdfX1lPVVRVQkVfU0VBUkNIX18nKTsKICBpZiAoc3RhdGUgPiAxMCkKICAgIHJldHVybjsKCiAgdmFyIG1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGR0Yi1tc2InKTsKICB2YXIgcGxhY2UgPSAnYmVmb3JlZW5kJywgbm9kZSA9IG1lbnUsIGFjdGl2ZU1lbnVJdGVtLCBpbWFnZXMsIHZpZGVvczsKICAKICBpZiAocmVhcnJhbmdlSW1hZ2VzVmlkZW9zWW91dHViZSkgewogICAgdmFyIHJ4SW1hZ2UgPSAvWyY/IztdKHRibT1pc2NofHRicz1zYml8dGJzPXNpbWcpLzsKICAgIHZhciByeFZpZGVvID0gL1smPyM7XSh0Ym09dmlkKS87CiAgICBbXS5mb3JFYWNoLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2hkdGIgLmhkdGItbWl0ZW0nKSwgZnVuY3Rpb24obikgewogICAgICBpZiAobi5jbGFzc0xpc3QuY29udGFpbnMoJ2hkdGItbXNlbCcpKSB7IGFjdGl2ZU1lbnVJdGVtID0gbjsgcmV0dXJuOyB9CiAgICAgIGlmIChuLmlubmVySFRNTC5tYXRjaChyeEltYWdlKSkgeyBpbWFnZXMgPSBuOyByZXR1cm47IH0KICAgICAgaWYgKG4uaW5uZXJIVE1MLm1hdGNoKHJ4VmlkZW8pKSB7IHZpZGVvcyA9IG47IHJldHVybjsgfQogICAgfSk7CiAgICBpbWFnZXMgPSAhaW1hZ2VzICYmIGxvY2F0aW9uLmhyZWYubWF0Y2gocnhJbWFnZSkgPyBhY3RpdmVNZW51SXRlbSA6IGltYWdlczsKICAgIHZpZGVvcyA9ICF2aWRlb3MgJiYgbG9jYXRpb24uaHJlZi5tYXRjaChyeFZpZGVvKSA/IGFjdGl2ZU1lbnVJdGVtIDogdmlkZW9zOwoKICAgIGlmIChpbWFnZXMgJiYgaW1hZ2VzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgIT0gbWVudS5maXJzdEVsZW1lbnRDaGlsZCkKICAgICAgbWVudS5pbnNlcnRCZWZvcmUoaW1hZ2VzLCBtZW51LmZpcnN0RWxlbWVudENoaWxkLm5leHRFbGVtZW50U2libGluZyk7CgogICAgaWYgKHZpZGVvcykgewogICAgICBpZiAodmlkZW9zLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgIT0gKGltYWdlcyB8fCBtZW51LmZpcnN0RWxlbWVudENoaWxkKSkKICAgICAgICBtZW51Lmluc2VydEJlZm9yZSh2aWRlb3MsIChpbWFnZXMgfHwgbWVudS5maXJzdEVsZW1lbnRDaGlsZCkubmV4dEVsZW1lbnRTaWJsaW5nKTsKICAgICAgbm9kZSA9IHZpZGVvczsKICAgICAgcGxhY2UgPSAnYWZ0ZXJlbmQnOwogICAgfQoKICAgIGlmICh5b3V0dWJlKSB7CgkgIG5vZGUgPSB2aWRlb3MgfHwgaW1hZ2VzIHx8IG1lbnUubGFzdEVsZW1lbnRDaGlsZDsKCSAgaWYgKHlvdXR1YmUucHJldmlvdXNFbGVtZW50U2libGluZyAhPSBub2RlKQoJCXlvdXR1YmUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoeW91dHViZSwgbm9kZS5uZXh0RWxlbWVudFNpYmxpbmcpOwogICAgfQogIH0KCiAgaWYgKCF5b3V0dWJlKSB7CiAgICB2YXIgcSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzZWFyY2hmb3JtIGlucHV0W2Rpcl0nKTsKICAgIGlmIChxKSBxID0gZW5jb2RlVVJJQ29tcG9uZW50KHEudmFsdWUpOwogICAgZWxzZSBpZiAocSA9IGxvY2F0aW9uLmhyZWYubWF0Y2goL14uKz8oPzpbI1wvJj9dKD86cXxxdWVyeSkpPSguKz8pKD86fCYuK3xcfC4rKSQvKSkKICAgICAgcSA9IHFbMV07CiAgICBlbHNlIHEgPSAnJzsKICAgIG5vZGUuaW5zZXJ0QWRqYWNlbnRIVE1MKHBsYWNlLAogICAgICAnPGRpdiBjbGFzcz0iaGR0Yi1taXRlbSBoZHRiLWltYiIgaWQ9Il9fWU9VVFVCRV9TRUFSQ0hfXyI+XAogICAgICAgICA8YSBjbGFzcz0icSBxcyIgaHJlZj0iaHR0cHM6Ly93d3cueW91dHViZS5jb20vcmVzdWx0cz9zZWFyY2hfcXVlcnk9JyArIHEgKyAnIj5Zb3V0dWJlPC9hPlwKICAgICAgPC9kaXY+Jyk7CiAgfQogIHN0YXRlKys7CiAgLyoKICBjb25zb2xlLmxvZyhbc3RhdGUsCiAgICAgICAgICAgICAgIGltYWdlcywgaW1hZ2VzICYmIGltYWdlcy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nID09IG1lbnUuZmlyc3RFbGVtZW50Q2hpbGQsCiAgICAgICAgICAgICAgIHZpZGVvcywgdmlkZW9zICYmIHZpZGVvcy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nID09IGltYWdlcywKICAgICAgICAgICAgICAgeW91dHViZSwgeW91dHViZSAmJiB5b3V0dWJlLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgPT0gdmlkZW9zIHx8IGltYWdlc10pCiAgKi8KfSk7Cg=="}],"settings":{"action_menu_columns":"2","action_menu_scripts_hide_disabled":false,"action_menu_scripts_sort":"position","appearance_badge_color":"#ff0000","appearance_badges":"running","autoReload":true,"configMode":100,"connect_mode":"casual","debug":false,"editor_autoLint":true,"editor_autoLintMaxLen":"50000","editor_autoSave":false,"editor_easySave":true,"editor_electricChars":true,"editor_enabled":true,"editor_fontSize":"110","editor_highlightTrailingWhitespace":true,"editor_indentUnit":"4","editor_indentWithTabs":"spaces","editor_keyMap":"vim","editor_lineWrapping":true,"editor_tabMode":"indent","editor_theme":"monokai","enabled":true,"notification_silentScriptUpdate":false,"scriptUpdateCheckDisabled":false,"scriptUpdateCheckPeriod":604800000,"scriptUpdateHideNotificationAfter":3600000,"script_blacklist_server":[{"rules":["/https?:\\/\\/userscripts\\.org\\/scripts\\/(source|version)/(102614).*\\.user\\.js/"],"severity":"2"},{"name":"SaveFrom.net helper","reason":"Shows advertisements","rules":["/https?:\\/\\/sf-addon\\.com\\/.*\\/.*\\.user\\.js/","/https?:\\/\\/.*\\.sf-helper\\.com\\/.*\\.user\\.js/"],"severity":"3"}],"showFixedSrc":false}}