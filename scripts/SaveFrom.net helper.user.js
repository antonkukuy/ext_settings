// ==UserScript==
// @name        SaveFrom.net helper
// @namespace   http://savefrom.net/
// @version     6.65.2
// @date        2016-09-12
// @author      Magicbit, Inc
// @description Youtube Downloader: all in one script to get Vimeo, Facebook, Dailymotion videos for free
// @homepage    http://savefrom.net/user.php?helper=userjs
// @icon        http://sf-helper.com/img/icon_16.png
// @icon64      http://sf-helper.com/img/icon_64.png
// @updateURL   https://download.sf-helper.com/chrome/helper.meta.js
// @downloadURL https://download.sf-helper.com/chrome/helper.user.js
// @include     http://*
// @include     https://*
// @exclude     *://google.*/*
// @exclude     *://*.google.*/*
// @exclude     *://acidtests.org/*
// @exclude     *://*.acidtests.org/*
// @run-at      document-end
// @grant       GM_listValues
// @grant       GM_setValue
// @grant       GM_getValue
// @grant       GM_deleteValue
// @grant       GM_xmlhttpRequest
// @grant       GM_info
// @grant       GM_openInTab
// @grant       GM_registerMenuCommand
// @grant       GM_unregisterMenuCommand
// @grant       GM_notification
// @grant       GM_download
// @connect     vk.com
// @connect     vk.me
// @connect     vk-cdn.net
// @connect     youtube.com
// @connect     youtube-nocookie.com
// @connect     ytimg.com
// @connect     googlevideo.com
// @connect     video.google.com
// @connect     google-analytics.com
// @connect     dailymotion.com
// @connect     vimeo.com
// @connect     vimeocdn.com
// @connect     odnoklassniki.ru
// @connect     ok.ru
// @connect     cdn-ok.com
// @connect     mycdn.me
// @connect     pladform.ru
// @connect     clipyou.ru
// @connect     soundcloud.com
// @connect     sndcdn.com
// @connect     mail.ru
// @connect     cdninstagram.com
// @connect     fbcdn.net
// @connect     facebook.com
// @connect     sf-helper.com
// @connect     aviasales.ru
// @connect     travelpayouts.com
// @connect     skyscanner.net
// @connect     hotellook.com
// @connect     savefrom.net
// @connect     self
// @connect     *
// ==/UserScript==

(function() {
  if (typeof JSON === 'undefined') {
    if (window.JSON) {
      JSON = window.JSON;
    } else
    if (document.defaultView && document.defaultView.JSON) {
      JSON = document.defaultView.JSON;
    }
  }

  if (typeof GM_getValue === 'undefined' ||
    typeof GM_setValue === 'undefined' ||
    typeof GM_xmlhttpRequest === 'undefined' ||
    typeof JSON === 'undefined') {
    return console.error('GM API is not ready!');
  }

  var _moduleName = null;

  var _menu;
  var _options;
  var _modules = {};
  var _languageList = {};

  try {
    window.sessionStorage['savefrom-helper-userjs'] = '1';
  } catch (e) {}
  /////////////////////////////////////////////////
  // MENU
  _menu = {
    activeDataAttr: 'data-sfh-active',
    id: 'sfh--ujs-menu',
    tooltipId: 'sfh--ujs-menu-tooltip',
    enabled: true,
    active: false,
    hover: false,
    move: false,
    title: '',
    shakeTimer: 0,
    shakeInterval: 10000,

    menu: null,
    icon: null,

    initMenu: null,

    style: {
      menu: {
        initial: {
          background: '#fff',
          borderStyle: 'solid',
          borderWidth: '2px 0 2px 2px',
          borderRadius: '5px 0 0 5px',
          display: 'none',
          boxSizing: 'content-box',
          font: '13px/18px Arial,Helvetica,sans-serif',
          width: 'auto',
          height: 'auto',
          padding: 0,
          margin: 0,
          overflow: 'visible',
          position: 'fixed',
          top: '50px',
          right: '0',
          textAlign: 'left',
          WebkitTransition: 'all 0.2s',
          transition: 'all 0.2s',
          zIndex: 99999
        },

        enabled: {
          borderColor: '#8dc50b'
        },

        disabled: {
          borderColor: '#d0d0d0'
        },

        tag: {
          display: 'block',
          width: '10px',
          height: '20px',
          overflow: 'hidden',
          opacity: 0.5
        },

        tagHover: {
          width: '20px',
          opacity: 0.8
        },

        active: {
          width: 'auto',
          height: 'auto',
          overflow: 'visible',
          opacity: 0.9
        }
      },

      icon: {
        initial: {
          display: 'inline-block',
          boxSizing: 'content-box',
          backgroundPosition: '50% 50%',
          backgroundRepeat: 'no-repeat',
          width: '16px',
          height: '16px',
          margin: 0,
          padding: '2px',
          overflow: 'hidden',
          verticalAlign: 'middle',
          cursor: 'pointer'
        },

        enabled: {
          backgroundImage: 'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABqUlEQVQ4jY2SzStEURiHf2bMl+w0SrHRZKPY+RtkYyeRspPFsEEZItLM3DCRjxofw0wyK0k+ClNGhBiEmIiwsrChZqvj/sZcznDJ4um8532f9+3ccy5isRg0Qre2V67hxyzxnfkHm5AdDcib6SvLC9e5e5v4TujuY4Dm6A4YPc684xq8sb6Fbq1CZkbNyU7aACVqdPhP8usGouZT7qcuLInpuFnITJ6bE6zRocuezwEdS/B2LuO+ewXJY44dmZ795yYhM6LmWKNDlz1pn+D0o6J5FjeMfbvGx9ETg5BhjjU6dHXvQMMdMcZ9BxAy7k1DXM/F0J6tYSxm9wbOHJ65y9Lh4FnJvLKZfa3sQKSh5lijQ5c97EX7GnJ61nHYF4Egni0klG3jk7bXYI41bc8e9iaP0RhArmsR+92rEP+BLnvSL3ESea1h7LoWVOEP6NDVvcTaQRQ4ZxBtCUPowRqdX/9EUtOFwoZxbDTNQsgwx9qPV9B7mqoOFNX3Y61xAoIwZk73GfWSySFtKK7uxSph/Jv3FQAZKgYVk0q2ir2sEuWEcSpnSjkZWt87G7sZgVx6JvgAAAAASUVORK5CYII=)'
        },

        disabled: {
          backgroundImage: 'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAiNJREFUeNqMkj+oUlEcx7/nHu/V7lMTxaghqIgoWpIQisCmhjfloDS9QQgMHkpTODc2hS45OQRB6GCLb2hqiAIJpzB6UUhDkqi34/17rtfTonI1ifeDs/zO5/eB8/0dwhjDqjRN+xOLxU4bhiGwVUIIhMNhsmJW/YAfsm1bAIDnedgl8DM7BYZhjAHAdd0FpVTy383n84Wf2RD0er3L8Xj8tq7rDAAcx7EopXtbAgsAdF1ng8HgYDKZfEilUt8CADCbzR7quv5AkqQLAGBZlhUMBjcEjuOsBDcYY0+FEK8BVCQAyGQylel0eqhp2vHynSbnHP5j27a5DPp4Op0eZjKZCgAQ/xZW1e12++Fw+Kq/p+v6l3Q6fW2bDfT7/aKiKBdDoZBQFEX1PC9JCJE45xsgIUQaDoevKKUjzrlp2zbhnP8gnU4nIcvyEaU0vQQNSZJmnued9QsopcPFYhERQuwtV911XXefMMbQbDbPJJPJN7Is38IJynXdj6PR6H4+n/+9zqDdbp9TVbWpKMqd/w1zzt+bppnPZrO//gmx0WicTyQSL0Oh0N1dw7ZtvxuPxweFQuHnOpvtLdTr9UuxWOyFqqr3/H3TNN9qmvaoWCx+3wh31xprtdqVaDT6PBKJ7C8/2hFj7HGpVPq6ze4UAEC1Wr0uy/KzZWhPyuXy513cWhCNRgkAAoACCAI4lcvlbgJAq9X6BMAC4ADwAAjGmACAvwMAXX8khNE72VIAAAAASUVORK5CYII=)'
        },

        tag: {
          padding: '2px'
        },
        active: {
          padding: '5px'
        }
      },

      title: {
        display: 'inline-block',
        font: 'bold 13px/18px Arial,Helvetica,sans-serif',
        lineHeight: '26px',
        margin: 0,
        padding: 0,
        textAlign: 'left',
        verticalAlign: 'middle',
        cursor: 'pointer'
      }
    },

    setTitle: function(title, version) {
      this.title = title;
      if (version)
        this.title += ' ' + version;
    },

    hide: function() {
      if (!this.menu || !document.body)
        return;
      this.menu.parentNode.removeChild(this.menu);
      this.menu = null;
      this.icon = null;
    },

    create: function() {
      if (this.menu || !document.body)
        return;

      this.moduleName = _moduleName;

      var _this = this;

      var menu = document.createElement('div');

      menu.addEventListener('mouseover', function() {
        if (!_this.active) {
          _this.hover = true;
          _this.setElementsStyle('tagHover');
        }
      });

      menu.addEventListener('mouseout', function() {
        if (!_this.active) {
          _this.hover = false;
          _this.setElementsStyle('tag');
        }
      });

      var icon = document.createElement('div');
      icon.title = this.title;

      icon.addEventListener('click', function(event) {
        if (_this.move) {
          return;
        }
        event.preventDefault();
        event.stopPropagation();

        if (event.button === 0) {
          _this.toggleMenuItems();
        } else if (event.button == 2) {
          _this.remove();
        }

        return false;
      }, false);

      icon.addEventListener('contextmenu', function(event) {
        if (_this.move) {
          return;
        }
        event.preventDefault();
        event.stopPropagation();
        _this.remove();
        return false;
      }, false);

      this.icon = menu.appendChild(icon);
      this.menu = document.body.appendChild(menu);

      var iconTopPos = parseInt(_menu.style.menu.initial.top);
      if (iconTopPos < 0) {
        iconTopPos = 0;
      } else
      if (this.moduleName === 'youtube' && iconTopPos < 92) {
        iconTopPos = 92;
      } else
      if (iconTopPos + 24 > parseInt(window.innerHeight)) {
        iconTopPos = parseInt(window.innerHeight) - parseInt(_menu.style.menu.tag.height) - 4;
      }

      _menu.style.menu.initial.top = iconTopPos + 'px';

      this.setElementsStyle('initial');
      this.setEnabled(1);
      this.showTag();
      this.enableMove();
    },

    enableMove: function() {
      var isStart = false;
      var _this = this;
      var icon = _this.icon;
      var menu = _this.menu;
      var startTimer = undefined;
      var sT = (parseInt(menu.style.height) / 2) || 0;
      var noSelectStyle = mono.create('style', {
        text: 'body {-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;user-select: none;}'
      });

      var rbIcon = function() {
        _this.move = false;
        menu.style.position = _this.style.menu.initial.position;
        menu.style.WebkitTransition = _this.style.menu.initial.WebkitTransition;
        menu.style.transition = _this.style.menu.initial.transition;
        menu.style.borderStyle = _this.style.menu.initial.borderStyle;

        if (noSelectStyle.parentNode) {
          noSelectStyle.parentNode.removeChild(noSelectStyle);
        }
      };

      var initIcon = function(e) {
        e.stopPropagation();
        e.preventDefault();

        _menu.hideMenuItems();

        _this.hover = true;
        _this.setElementsStyle('tagHover');

        _this.move = true;
        menu.style.position = 'fixed';
        var eX = e.y || e.clientY;
        menu.style.top = (eX - sT) + 'px';
        menu.style.WebkitTransition = 'initial';
        menu.style.transition = 'initial';
        menu.style.borderStyle = 'dotted';

        document.body.appendChild(noSelectStyle);
      };

      var onMouseMove = function(e) {
        var eX = e.y || e.clientY;
        var topValue = eX - sT;
        if (_this.moduleName === 'youtube' && topValue < 50) {
          topValue = 50;
        } else
        if (topValue < 0) {
          topValue = 0;
        }
        menu.style.top = _this.style.menu.initial.top = topValue + 'px';
      };

      var onStartTimer = function(e) {
        isStart = true;
        initIcon(e);
        document.body.addEventListener('mousemove', onMouseMove);
      };

      menu.addEventListener('dragstart', function(e) {
        e.preventDefault();
      });
      menu.addEventListener('mousedown', function(e) {
        if (e.target !== _this.icon) {
          return;
        }
        isStart = false;
        startTimer = setTimeout(onStartTimer.bind(null, e), 500);
        var ml = function() {
          clearTimeout(startTimer);
          mono.off(menu, 'mouseleave', ml);
        };
        mono.on(menu, 'mouseleave', ml);
        document.body.addEventListener('mouseup', function mu() {
          clearTimeout(startTimer);
          document.body.removeEventListener('mouseup', mu);
          mono.off(menu, 'mouseleave', ml);
          if (isStart) {
            setTimeout(rbIcon, 100);
            document.body.removeEventListener('mousemove', onMouseMove);
            mono.storage.set({
              gmIconTop: parseInt(_this.style.menu.initial.top)
            });
          }
        });
      });
    },

    setStyle: function(element, style) {
      if (this[element] && this.style[element] && this.style[element][style])
        SaveFrom_Utils.setStyle(this[element], this.style[element][style]);
    },

    setElementsStyle: function(style) {
      if (!style)
        return;

      var elements = ['menu', 'icon'];

      for (var i = 0; i < elements.length; i++)
        this.setStyle(elements[i], style);
    },

    setEnabled: function(enabled) {
      this.enabled = enabled;
      this.setElementsStyle(this.enabled ? 'enabled' : 'disabled');
    },

    showTag: function() {
      this.setElementsStyle('tag');
    },

    toggleMenuItems: function() {
      return _menu.active ? _menu.hideMenuItems() : _menu.showMenuItems();
    },

    remove: function() {
      if (_menu.menu)
        _menu.menu.parentNode.removeChild(_menu.menu);

      // _menu.removeTooltip();
    },

    menuHTML: 'PHN0eWxlIHR5cGU9InRleHQvY3NzIj4KLnNmLW1lbnUtY29udGFpbmVyIHsKICAgIHdpZHRoOiA0ODJweDsKICAgIGZvbnQ6IDEycHgvMTdweCBUYWhvbWEsIEhlbHZldGljYSwgT3BlblNhbnMsIHNhbnMtc2VyaWY7CiAgICBjb2xvcjogIzAwMDsKICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgICBtYXJnaW46IDA7CiAgICBib3gtc2l6aW5nOiBpbmhlcml0OwogICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgIGZsZXgtZGlyZWN0aW9uOiBpbml0aWFsOwp9Ci5zZi1tZW51LWNvbnRhaW5lci5sb2FkaW5nID4gKiB7CiAgICB2aXNpYmlsaXR5OiBoaWRkZW47Cn0KLnNmLW1lbnUtY29udGFpbmVyID4gKiB7CiAgICBib3gtc2l6aW5nOiBpbmhlcml0OwogICAgZmxleC1kaXJlY3Rpb246IGluaXRpYWw7Cn0KLnNmLW1lbnUtY29udGFpbmVyIHAgewogICAgZm9udC1zaXplOiAxMnB4Owp9Ci5zZi1tZW51LWNvbnRhaW5lciBkaXYuc2YtbWVudS1saXN0LAouc2YtbWVudS1jb250YWluZXIgZGl2LnNmLW1lbnUtZGVzYyB7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOwogICAgZmxvYXQ6IGxlZnQ7Cn0KLnNmLW1lbnUtY29udGFpbmVyIGRpdi5zZi1tZW51LWRlc2MgewogICAgd2lkdGg6IDE2NnB4OwogICAgcGFkZGluZzogMjBweCAzMHB4OwogICAgcGFkZGluZy1ib3R0b206IDM2cHg7CiAgICBjb2xvcjogIzZhNmE2YTsKfQouc2YtbWVudS1jb250YWluZXIgZGl2LnNmLW1lbnUtZGVzYyBhIHsKICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgIGNvbG9yOiAjNEE5MEUyOwp9Ci5zZi1tZW51LWNvbnRhaW5lciBkaXYuc2YtbWVudS1kZXNjIGE6bm90KC5zb2NpYWwtYnRuKTpob3ZlciB7CiAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsKfQouc2YtbWVudS1jb250YWluZXIgLnNmLW1lbnUtZGVzYyAuaWNvbiB7CiAgICB3aWR0aDogNzRweDsKICAgIGhlaWdodDogNzRweDsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIGJhY2tncm91bmQtc2l6ZTogNzRweDsKICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7CiAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXI7CiAgICBwYWRkaW5nOiAwOwogICAgbWFyZ2luOiAwOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1kZXNjIC52ZXJzaW9uIHsKICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICBmbG9hdDogcmlnaHQ7CiAgICBtYXJnaW4tcmlnaHQ6IC0zMHB4OwogICAgd2lkdGg6IDExMHB4Owp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1kZXNjIC52ZXJzaW9uID4gc3BhbiwKLnNmLW1lbnUtY29udGFpbmVyIC5zZi1tZW51LWRlc2MgLnZlcnNpb24gPiBhIHsKICAgIGRpc3BsYXk6IGJsb2NrOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1kZXNjIC5pY29uIHBhdGggewogICAgZmlsbDogI2NjY2NjYyAhaW1wb3J0YW50Owp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1kZXNjIC50aXRsZSB7CiAgICBmb250LXNpemU6IDIwcHg7CiAgICBsaW5lLWhlaWdodDogMS4yOwogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICAgIG1hcmdpbi10b3A6IDE0cHg7CiAgICBtYXJnaW4tYm90dG9tOiAxNnB4Owp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1kZXNjIC5tb3JlIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIGJvdHRvbTogNDBweDsKfQouc2YtbWVudS1jb250YWluZXIgLnNmLW1lbnUtbGlzdCB7CiAgICBoZWlnaHQ6IDM0OHB4OwogICAgd2lkdGg6IDI0M3B4OwogICAgZm9udC1zaXplOiAxNHB4OwogICAgcGFkZGluZzogMTRweCA2cHg7CiAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICNEOEQ4RDg7Cn0KLnNmLW1lbnUtY29udGFpbmVyIC5zZi1tZW51LWxpc3QgLnNlcGFyYXRvciB7CiAgICBib3JkZXItdG9wOiAxcHggc29saWQgI0Q4RDhEODsKICAgIG1hcmdpbi10b3A6IDEwcHg7CiAgICBtYXJnaW4tYm90dG9tOiA5cHg7CiAgICBtYXJnaW4tbGVmdDogNTlweDsKfQouc2YtbWVudS1jb250YWluZXIgLnNmLW1lbnUtbGlzdCAuaXRlbSB7CiAgICBoZWlnaHQ6IDQwcHg7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7CiAgICBtYXJnaW4tdG9wOiAtMnB4OwogICAgbWFyZ2luLWJvdHRvbTogLTJweDsKICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICBkaXNwbGF5OiBibG9jazsKfQoKLnNmLW1lbnUtY29udGFpbmVyIC5zZi1tZW51LWxpc3QgLml0ZW0gLmljb24gewogICAgbWFyZ2luOiAwOwogICAgbWFyZ2luLWxlZnQ6IDE4cHg7CiAgICB3aWR0aDogMjRweDsKICAgIGhlaWdodDogMjRweDsKICAgIG1hcmdpbi1ib3R0b206IDhweDsKICAgIG1hcmdpbi10b3A6IDhweDsKICAgIGZsb2F0OiBsZWZ0OwogICAgZGlzcGxheTogYmxvY2s7CiAgICBwYWRkaW5nOiAwOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1saXN0IC5pdGVtIC5sYWJlbCB7CiAgICBwYWRkaW5nLWxlZnQ6IDE4cHg7CiAgICBwYWRkaW5nLXJpZ2h0OiAxOHB4OwogICAgbGluZS1oZWlnaHQ6IDQwcHg7CiAgICBmb250LXNpemU6IDE0cHg7CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgd2lkdGg6IDE2NXB4OwogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICBvdmVyZmxvdzogaGlkZGVuOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1saXN0IC5pdGVtIC5sYWJlbC5kYmwgewogICAgbGluZS1oZWlnaHQ6IG5vcm1hbDsKICAgIHBhZGRpbmctdG9wOiAycHg7CiAgICB3aGl0ZS1zcGFjZTogbm9ybWFsOwogICAgaGVpZ2h0OiA0MHB4Owp9Ci5zZi1tZW51LWNvbnRhaW5lci5uby1wb2xsIC5zZi1tZW51LWxpc3QgZGl2W2RhdGEtYWN0aW9uPSJvcGVuUG9sbCJdIHsKICAgIGRpc3BsYXk6IG5vbmU7Cn0KLnNmLW1lbnUtY29udGFpbmVyLm5vLXBvbGwgLnNmLW1lbnUtbGlzdCAuaXRlbSAuaWNvbiB7CiAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgbWFyZ2luLXRvcDogMTBweDsKfQouc2YtbWVudS1jb250YWluZXIubm8tcG9sbCAuc2YtbWVudS1saXN0IC5pdGVtIHsKICAgIGhlaWdodDogNDRweDsKfQouc2YtbWVudS1jb250YWluZXIubm8tcG9sbCAuc2YtbWVudS1saXN0IC5pdGVtIC5sYWJlbCB7CiAgICBsaW5lLWhlaWdodDogNDRweDsKfQoKLnNmLW1lbnUtY29udGFpbmVyIC5zZi1tZW51LWxpc3QgLml0ZW06aG92ZXIgewogICAgYmFja2dyb3VuZC1jb2xvcjogIzU5N0E5RTsKICAgIGNvbG9yOiAjZmZmOwp9Cgouc2YtbWVudS1jb250YWluZXIgLnNmLW1lbnUtbGlzdCAuaXRlbS5pbmFjdGl2ZSB7CiAgICBvcGFjaXR5OiAwLjU7CiAgICBjdXJzb3I6IGRlZmF1bHQ7Cn0KLnNmLW1lbnUtY29udGFpbmVyIC5zZi1tZW51LWxpc3QgLml0ZW0uaW5hY3RpdmUgLmljb24gcGF0aCB7CiAgICBmaWxsOiAjYzJjMmMyICFpbXBvcnRhbnQ7Cn0KLnNmLW1lbnUtY29udGFpbmVyIC5zZi1tZW51LWxpc3QgLml0ZW0uaW5hY3RpdmU6aG92ZXIgewogICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICAgIGNvbG9yOiAjMDAwOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1saXN0IC5pY29uW2RhdGEtdHlwZT0ic2hvd0Fib3V0UGFnZSJdIHsKICAgIHZpc2liaWxpdHk6IGhpZGRlbjsKfQoKLnNmLW1lbnUtY29udGFpbmVyIC5zZi1tZW51LWxpc3QgLnNCdG4gewogICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtbWVudS1saXN0IC5zQnRuOmhvdmVyIHsKICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKfQoKLnNmLW1lbnUtY29udGFpbmVyIC5zb2NpYWwtYmxvY2sgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgYm90dG9tOiAyMHB4OwogICAgaGVpZ2h0OiAxNnB4OwogICAgY3Vyc29yOiBkZWZhdWx0OwogICAgZmxleC1kaXJlY3Rpb246IGluaXRpYWw7Cn0KLnNmLW1lbnUtY29udGFpbmVyIC5zb2NpYWwtYnRuIHsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIHdpZHRoOiAxNnB4OwogICAgaGVpZ2h0OiAxNnB4OwogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogY2VudGVyOwogICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICAgIGZsb2F0OiBpbml0aWFsOwogICAgbWFyZ2luOiBpbml0aWFsOwogICAgcGFkZGluZzogaW5pdGlhbDsKICAgIGxpc3Qtc3R5bGU6IGluaXRpYWw7Cn0KLnNmLW1lbnUtY29udGFpbmVyIC5zb2NpYWwtYnRuOmhvdmVyIHsKICAgIG9wYWNpdHk6IDAuODsKfQouc2YtbWVudS1jb250YWluZXIgLnNvY2lhbC1idG4udmsgewogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBWUFBQUFmOC85aEFBQUFBWE5TUjBJQXJzNGM2UUFBQUFSblFVMUJBQUN4and2OFlRVUFBQUFKY0VoWmN3QUFEc01BQUE3REFjZHZxR1FBQUFBWWRFVllkRk52Wm5SM1lYSmxBSEJoYVc1MExtNWxkQ0EwTGpBdU00em1sMUFBQUFHV1NVUkJWRGhQblpEYks4TmhHTWZmZjBiR1dwSlNTaTJITWt4Q2JvVGsxTWdoaHd0aVkydE5JU0p6YUJlYWFFNjVXRUpJc2h2YWhTS1RjbTdNS1VVT2wxKy81KzJudlc5eXNYM3JVOC96OVBsZXZDOHp1WDM2eG1uL1FiUGJqMGlnRG5WWjVZUXZWREN3ZzJ6SFZrUlFoN29zMTc2QkxOdDZWRkNYWlpxOUVDa2Izb1pyTS9DSHVzazl5ZnVGcFhVc1E2VE50WXYvMGp1M0w3a0UwN2Q1SU5MaTNGUjFZR3pKaDg2SlZieC9mdlBkZjNZbnVRUkxiWEpEcEhsMGpjdVV4bUV2VWt4VENGdzk4SDFsOTFoeUNaWmljaWxTbUlZaEw1Y3BwOWRQT0wxNTVuUHc4UlhwOVU3SkpWaHkxVGhFNnZ0WGVJRVN1THpIL3ZFbDNqNisrTDd0UDVkY2dpV1ZqMERFNUZqa01xWEdPZ05ka1JXdEF3dnFCU2p0OFVnK1N5d1poRWl0M2FPcTREUGRiRlBoZjZtMXowcytTeWp1ZzBpTmRWWlZnWk1MNVFsSFYrb0czSVplb0N1MFNUN1RGZHFWWTVocWkxdlY1YXp2SFNLendpRzVCTlBtV3lFU1oreEdURWJUSDJLejJoR2ZaNUZjZ21seXVvUHhSZ3VpZ2JwTWF6UWJOSWJPa0NhblN6bEVnTkxSR3MyR0h6YWttbW9NdmxxZ0FBQUFBRWxGVGtTdVFtQ0MpOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc29jaWFsLWJ0bi5vayB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQUFYTlNSMElBcnM0YzZRQUFBQVJuUVUxQkFBQ3hqd3Y4WVFVQUFBQUpjRWhaY3dBQURzTUFBQTdEQWNkdnFHUUFBQUFZZEVWWWRGTnZablIzWVhKbEFIQmhhVzUwTG01bGRDQTBMakF1TTR6bWwxQUFBQUlMU1VSQlZEaFBsZEZQYU5OUUhBZndkeGRhcXhOQlZLUU84YUlnZUJKbDRHa01CTmx3eUk1ZU54QkJ5UmhUaDRpWEhSUmN4ZGxOSnFOT1VRWkQzY1NwUGFUZ3hsQTJVSnpTMmtNbmJaT3VhYkw4YlpwOHpZdFYzNXVuL2VCRHlJL3Y5NUZIaUpYcGJITVd6eTg2U3ozWWtxQkR1OFFVenhTdDk4ZGh6Ui8reS83UUJVOUt3M2VxOEkwQzNOd29yTGRIdVF6dDBDNnhYaCtCTlJjc211eDNwK0JaRXVqNFhpTjgwbkh6S1M0WENyckVuRGtFbHYxNU9DeG9oUXhXVTIzNDhmSUN2TG9KditIQWVuT2F5MUxFZk40S2xyNDZGUjVRRm9lZ1BqMklTaW9PdTVvTGQvcDhONWVsaVBrNERwYWNGc0t3cStSZ2kzMm9MOSttZDRGcktsQ2VCUGZlbENmR3hINndTdmNQUU11TDRTSHNGRjVkaHZad0g1ZWxpSkhjQzVZNWVRejVCeWV4Tm5jVnRhK3pxSHlhUWpiVkEzbmlCSXp4T0plbGlKN1lBNWFuRnVBWk1yU0ZFWlJtTGtLYUZXQjlld0VFZjhSWnVzdGxLYkp4WnpkWXlzcDA4NlA1Y2ZWMVZLWjd1U3hGTm9aM2daVzkxb0x2aVE3VWE4Vm1GVmovK0F4ZmhscFJ2Tm5DWlNtaTNkcUp6WXlGWkxQNmV4cWFCSDJ5Njc4Y1JiUWJPOEN5TTRtdzVOazZzdmU2VVU2UGh1Kys2OEFZNitDeUZGR3Zid2VybGhtSFUvMko3TWc1bEFaaXlGMkpRaElmd2RWa0tNbXpYSllpeXVDMk5YVXdpait5bHlKWTZZdWlKUEM3NWQ0b3l2My9kaFR0RWxtSXRhdjlrYUk2RU1HV0JCMVppTFgvQXU0QThzbkMvaXp5QUFBQUFFbEZUa1N1UW1DQyk7Cn0KLnNmLW1lbnUtY29udGFpbmVyIC5zb2NpYWwtYnRuLmZiIHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJBQUFBQVFDQVlBQUFBZjgvOWhBQUFBQVhOU1IwSUFyczRjNlFBQUFBUm5RVTFCQUFDeGp3djhZUVVBQUFBSmNFaFpjd0FBRHNNQUFBN0RBY2R2cUdRQUFBQVlkRVZZZEZOdlpuUjNZWEpsQUhCaGFXNTBMbTVsZENBMExqQXVNNHptbDFBQUFBRkpTVVJCVkRoUGxZdkJLNE54R01lZmY4Vm1DVW5UZXR0WXZhV3RKcG1KbW1Kb09BbEhCMXN5UzNJUTBmWW1qRjVwMjhFT2xLeTBtVloyMkdrWE54ZFpVUTdLY2I2OFAvMVc5dmErYi92VTUvSjhuaThGb28vaVhLUmNtbytXMFl6S1J0bVNmN1ZZZFMzazRaeTlhMHBsbzJ4SkRHYlJOMzJyNitCaURqZkZWenc5ZjliMUx1ZWhiTWt4ZVFValM1VTNOT0pieXJKR3d2Z2w5TFJQWkZDcmZiUFIrOGNYdGc0TFdEL0lRWnpKc0U2MnNSVDBGUHhwTmxaSVhsZGdIVDZCMVplQWJUVEpPdldNeURDU2M1UXVxeHAxRHgxRFN6MDh3UlQ3b2E0QkNWcnE0UTdJN0ljNjNmdlEwdEliWW5Ja3VWQy9kYmoyMkErMTkrL0FTSTUwWGtSam96WnhHMFp5NHZLRHFwSEZ1UWtqT2ZHemUxV2pWc2NHak9URVR2T3FSbVloL0dLMnIwRlBUaXlSKzk5K3QyUVN3cDRXVzZocUVrTFFjaVZ5d2ZSTzdkWnZmNXV3NXdkZU4zRHIzMDdSV0FBQUFBQkpSVTVFcmtKZ2dnPT0pOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc29jaWFsLWJ0bi50dyB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQUFYTlNSMElBcnM0YzZRQUFBQVJuUVUxQkFBQ3hqd3Y4WVFVQUFBQUpjRWhaY3dBQURzTUFBQTdEQWNkdnFHUUFBQUFZZEVWWWRGTnZablIzWVhKbEFIQmhhVzUwTG01bGRDQTBMakF1TTR6bWwxQUFBQUhLU1VSQlZEaFBuZERQU3hSaEhBYnc5eStaWFRXWE1JbVFoQVRKazJRR0NSNjdDT0dsYnAzczR0bTdxV2lKYm1WSkVrWWVERG9zKzROS3d4UXEvSUhGYnUxdXF6SXo2T3pPdnUvTzdzN1QrMzNkMGNXV1lQM0NCOTZaOTNubUhWNTJaMU4wRFd3N3F3TTdEdW9pTzlSbC9kOTQ1dnFHUVB1WFFsMm9RMTEyN1hNQlYxZlBoN3FzN2FNQTZWNHJvR1BsZUYydFQ1NFVNY3RJY2hlenFSSUd2eGR3Vi9MMjJaVW9CNWxLT05qTWx0SDVRYWhuMGliOXpwZHhkcWJqcHhsMk9jUkJodFl0dFhrZ1hJeklTK3FLQ2R6K0pOUzc2akZGQ2IwaFUzVUlhMzJmQitrTEgrS0FGeXN4d0pFSFovaS9wMi9vSEpmZVdhcERXTXR5SHVUQldyNFMrZis4amRzcTcyRVhsMnlRd0dzZEw3YVBVSExkU3JUMjNJOGFLdTloZ1RjNWVBWkRSaVZXZTNaTWdjQXIvU1JQV1BOQ0RwNExMdzA4ak96alQrNzBMcndwbGwzY1dreWZaRDJzYVQ0TGNtUFp4cjBZeC9oWEd6bTZ3YXBKWngzMEx5YlJPR2VxYkRYV05DY1gwczBsQzgrM09INVpSWmk4aEpUbElKeXdNU3ovcU9WeEhJMUJRK1hPWWczUExCRC9yQUhmWkFyYTJFOW9vN3ZRSHYyQU5wR0EvOGtlR3A0ZXFVd3RUSnM1VFBtRDhnUG5RRjJtQmZVZTM3U1Y4YzFZcUl2c2FFRzk1eS9FQ3lOMFVvVXZjUUFBQUFCSlJVNUVya0pnZ2c9PSk7Cn0KLnNmLW1lbnUtY29udGFpbmVyIC5zb2NpYWwtYnRuLmxqIHsKICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJBQUFBQVFDQVlBQUFBZjgvOWhBQUFBQVhOU1IwSUFyczRjNlFBQUFBUm5RVTFCQUFDeGp3djhZUVVBQUFBSmNFaFpjd0FBRHNNQUFBN0RBY2R2cUdRQUFBQVlkRVZZZEZOdlpuUjNZWEpsQUhCaGFXNTBMbTVsZENBMExqQXVNNHptbDFBQUFBRjRTVVJCVkRoUFkvai8vejhEZzBHWUtJdHUrbEltL2JRL2JBWVovNW4wMDdjemFTUktnT1FJWVFhUVFxREcyeDVleGYvN2ttdi9UMGlwL2Uvc1ZmNmZTU2ZqQmpHR01BQTFiL1FFYWdacExFM3YrMitYdS81L1VNT2UveDdaTTRreUJHVEFINUROWmVtOS95MXpOLzAvZXVVbFVQei8veXQzWC94WEN1d2phQWdEazA3YXp4NmdBUTY1YS85djJILzEvL3NQSC8vWEx6cjMzNzEyLy8vOFJmZisrOVZ1eG1zSUE0dE94bnc3OTlMLzd1V2IvNTg1YytaLzlzU0QvMTBxZC8yZmNlTDMvNWtuLzRJeFBrTVlHRFhEZUlDaGZzdzRyT1gvaktXYi8xc1g3UGh2a2J2NWYwajdJYUlNQVJNd1F4VDlPLzg3bEFGZFVIMFNiRWhveDJHQ2hzQk5naHNTT0JWc0FGNUQ5REwyWWhoQWlpRU9lVXYvcytobEFMV2dHUURDWUVOMDBnK2pHK0pZdXZXL1Nmb2FPTVpwQUFoak13U2s2ZitGS1hDTTF3QVFSamVFWkFOQUdHUUlpM2JHSERtL2lTZ0dUT3hxQWhzQWlnMnNHdEV4U0RFMkRNcTFXRFVRd2lDYm1YUXpkakZxeHFvQUFKVFdkRXFyNStjUUFBQUFBRWxGVGtTdVFtQ0MpOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc29jaWFsLWJ0bi5tYWlscnUgewogICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQkFBQUFBUUNBWUFBQUFmOC85aEFBQUFBWE5TUjBJQXJzNGM2UUFBQUFSblFVMUJBQUN4and2OFlRVUFBQUFKY0VoWmN3QUFEc01BQUE3REFjZHZxR1FBQUFBWWRFVllkRk52Wm5SM1lYSmxBSEJoYVc1MExtNWxkQ0EwTGpBdU00em1sMUFBQUFLSVNVUkJWRGhQbGRKYlNKTmhIQWJ3OS92bVlVVGlSWFFYaGpobjNkaHlibFB4TExtWkU2WW9PemdkVTVmVGVaalp0Q25aWVV2U1padFVXT25JZVNxanNpQUl1aWdMNllCWFhVVFFUVGVXZUZOMHdLaWJwL2Q5WFpKMTVjVVB0di83UFAvMys5aUl3cjlZb0R5ejlFcnBmNDV0b1IzV0pYTHZrOVdFbG9lUU5EellGdFpoWFNKdHVBK0piV0VMalhzRXdXRWpYbzZuNDhXMUF3Z01tWkhaR2Z3dng3cEVZcDNISHp0dDA3Z1ZLc0d2bXdUUHh0SXhlTnFBRVY4RjNvVDM4dGxNc0JRNzZtYzM4d3lSbUtiQnhKc244ZWl5R2l1UlJDanFqaUhWZWdLbUxpZEtYTjJRR2dMUU5yZmcwNHlJaGRFOHhKaW5lSWNoWW5VWVRFTlBNNzlGWnVwRms4ZUI5UnNFYnlmMjhJV3Z4MlZZQ0diRDNtSGhtUXAzTis4d1JEU01nVm0rSWtQa2JBNFU5bjRlS3JZM1FUemtRNXp1Rks3Njh2a3NyYllmZHdNWnVITStpM2NZSXVwRFlOYm5DR3d1RTRaUEhzYmlhQnJFc2lFK0YvVkJKRlY1OEcyV1FHN3BnN2RIajdXcHVPaFppQzdRMFNEMWxRYnNiU1lNOXBWdUxJak9tZVNhNC9oT0w1QWJQZkI1dGZnNEtkMDhJK3d4bWNlaFZOd2V6b0M4c2hVLzZlT1dOVFh5ZVVMNUFPYlBxZmdyN0t0MlkrbWlESFArREg3R0VMRjRBSXlodnBxSDhpeU5LSyt0d2xva0J1OG1kbU0xRW8rbm95bjRjRjJLZXdFRnorUWJyYnpERUxIQUMwYkk3VVo0NENDL3ZjNVJpZjFsVm1oTlZkQVlqTmhWNkVCZlp5SGVoeFBSMVZvRUljL0RPd3dSYyttWEtFSGRDdi9SYlB5Z1ArSG5hZnBub2pjdlgwckNseG1DRkswZFF1WVJDRm50bTNtR0NEbGQyRUxsUkhLUkVZN0dFb1I2VmJqUW8wS05SWXY0M1BhdHVTZ2lxTnRXaEt3T3V2a3ZtamErU0ZBNk5yRFAvMllZMmlXeEdxZE95SFN0Q21vWEhXd0Q3Y1JxbkxyZldFUVBDdzZaK1djQUFBQUFTVVZPUks1Q1lJST0pOwp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc29jaWFsLWJ0bi5ncCB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQUFYTlNSMElBcnM0YzZRQUFBQVJuUVUxQkFBQ3hqd3Y4WVFVQUFBQUpjRWhaY3dBQURzTUFBQTdEQWNkdnFHUUFBQUFZZEVWWWRGTnZablIzWVhKbEFIQmhhVzUwTG01bGRDQTBMakF1TTR6bWwxQUFBQUlmU1VSQlZEaFBsZEwvU3hOaEhBZnc1NCtScVkwY2syQ1U3T1pNMmJtK0xLTmlFU2hOeW9heG9nVEp2b0FXVkFZSkJVWDlFQlJSRW9xbFk0cWExa3JkcFd6T3VWVzJsbHZMVTJ1ck9YVm0yYnU3Qjd4MnlRb2ZlQjNQNS8zdytmRGNjV1R5U3BVdWN0WEdDYkJPbk5oTFFnMEgrWWthRTk3WURPc2k5b2k5NU8zcC9aaCsybzUzVGNmdzhmRWRMSCtOUVZ5cDZVK0llMXlJdE42RXY3cEVrcHJscFgzQVZncnlZeUdKd0kwejhCelNZOWpDWU1DMkM0dXh6NWpubytDT2JzZUlrSTFWRlVuRVBMMG0zNU56ZUZXaGhhZXlrSElMRGVOM3I5RmJ6THpvbHZKVnlhbUlyQ2JMODNNWUVRYWtjMW1OZEVBaS9CNys4NGZwUHRNaTRtUDhnaFd1QTFza25HVXJQWnh5T2ZIU3JFSGJEclVrRVE3SmFqb2c3bk5qMEx3WkEvczBsTCt4RmorWGx1Q3NLWmV5Vllsd1VGYVR3Y1k2cE9KZkVITVBZZlNVQmI3NmFzeHl6OUZ6b2dLOXBudzRkMitTK2ZaaFFsWVR1ekVQOTR1VjZDeG5FYmhlVDY4KzFIQWNYZHRVNk4rcFh1TmhpVkpXazE2akNxS3Uwang0bTg3UkFUSGhsZnJMTkRUL0g5SmpWTU43OWdpQ3R5OWhzcU1adjFaVzZKQms4RFdlN1dYUWJkajRUMlF4R3NhbzhORmEySHpjWXhTNFZhaEVYNTBWS2VGbldvaUUwRmRXZ003aURSa1JSK1VlUE5BcTBLSFBoYU1vRjNaQnN6WWJyV1lEdlkzdjRrbWFaMEllRldSRjdicHMvSzFGR0RyakhZYm5jdTJhc3oreW9zVEJxdGgyUnNFTGtNNnV5NkgvL1JNVEk4dlQ4RzM2SFBZM1dGS2lBZmdSNTg4QUFBQUFTVVZPUks1Q1lJST0pOwp9Cgouc2YtbWVudS1jb250YWluZXIgLnNmLWNoZWNrYm94IHsKICAgIGZsb2F0OiBsZWZ0OwogICAgZGlzcGxheTogYmxvY2s7CgogICAgcGFkZGluZy10b3A6IDEycHg7CiAgICBwYWRkaW5nLWxlZnQ6IDE2cHg7CiAgICBwYWRkaW5nLWJvdHRvbTogMTJweDsKCiAgICAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOwogICAgLW1vei11c2VyLXNlbGVjdDogbm9uZTsKICAgIHVzZXItc2VsZWN0OiBub25lOwp9Cgouc2YtbWVudS1jb250YWluZXIubm8tcG9sbCAuc2YtY2hlY2tib3ggewogICAgcGFkZGluZy10b3A6IDE0cHg7Cn0KCi5zZi1tZW51LWNvbnRhaW5lciAuc2YtY2hlY2tib3ggPiBpIHsKICAgIHdpZHRoOiAyNHB4OwogICAgaGVpZ2h0OiAxNHB4OwogICAgZGlzcGxheTogYmxvY2s7CiAgICBwYWRkaW5nOiAwOwoKICAgIGJvcmRlci13aWR0aDogMXB4OwogICAgYm9yZGVyLXN0eWxlOiBzb2xpZDsKICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKCiAgICBib3JkZXItY29sb3I6ICM3OEM0MzU7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNzhDNDM1Owp9Ci5zZi1tZW51LWNvbnRhaW5lciAuc2YtY2hlY2tib3ggPiBpID4gaSB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgICBib3JkZXItd2lkdGg6IDFweDsKICAgIGJvcmRlci1zdHlsZTogc29saWQ7CiAgICBib3JkZXItcmFkaXVzOiA4cHg7CgogICAgaGVpZ2h0OiAxMnB4OwogICAgd2lkdGg6IDEycHg7CiAgICBib3JkZXItY29sb3I6ICM3OEM0MzU7CiAgICBtYXJnaW4tbGVmdDogMTBweDsKfQouc2YtbWVudS1jb250YWluZXIgLnNmLWNoZWNrYm94LnNmLXRyYW5zaXRpb24gPiBpID4gaSB7CiAgICB0cmFuc2l0aW9uOiBtYXJnaW4tbGVmdCAwLjJzOwogICAgLW8tdHJhbnNpdGlvbjogbm9uZTsKfQouc2YtbWVudS1jb250YWluZXIgLmluYWN0aXZlIC5zZi1jaGVja2JveDpub3QoLmVuYWJsZUZvcmNlKSA+IGksCi5zZi1tZW51LWNvbnRhaW5lciAuc2YtY2hlY2tib3guZGlzYWJsZWQgPiBpIHsKICAgIGJvcmRlci1jb2xvcjogI0JFM0YyRTsKICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7Cn0KLnNmLW1lbnUtY29udGFpbmVyIC5pbmFjdGl2ZSAuc2YtY2hlY2tib3g6bm90KC5lbmFibGVGb3JjZSkgPiBpID4gaSwKLnNmLW1lbnUtY29udGFpbmVyIC5zZi1jaGVja2JveC5kaXNhYmxlZCA+IGkgPiBpIHsKICAgIGhlaWdodDogMTRweDsKICAgIHdpZHRoOiAxNHB4OwogICAgYm9yZGVyLWNvbG9yOiAjQkUzRjJFOwogICAgbWFyZ2luOiAtMXB4Owp9Cjwvc3R5bGU+CjxkaXYgY2xhc3M9InNmLW1lbnUtZGVzYyI+CiAgICAgICAgPGRpdiBjbGFzcz0iaWNvbi1ib2R5Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaWNvbiI+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InZlcnNpb24iPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InRpdGxlIj48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJkZXNjIj48L2Rpdj4KICAgICAgICA8YSBocmVmPSIjIiBjbGFzcz0ibW9yZSIgdGFyZ2V0PSJfYmxhbmsiIGRhdGEtaTE4bj0icmVhZE1vcmUiPkxlYXJuIE1vcmU8L2E+CiAgICAgICAgPGRpdiBjbGFzcz0ic29jaWFsLWJsb2NrIj4KICAgICAgICAgICAgPGEgaHJlZj0iIyIgY2xhc3M9InNvY2lhbC1idG4gdmsiIHRhcmdldD0iX2JsYW5rIj48L2E+CiAgICAgICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJzb2NpYWwtYnRuIGZiIiB0YXJnZXQ9Il9ibGFuayI+PC9hPgogICAgICAgICAgICA8YSBocmVmPSIjIiBjbGFzcz0ic29jaWFsLWJ0biBvayIgdGFyZ2V0PSJfYmxhbmsiPjwvYT4KICAgICAgICAgICAgPGEgaHJlZj0iIyIgY2xhc3M9InNvY2lhbC1idG4gdHciIHRhcmdldD0iX2JsYW5rIj48L2E+CiAgICAgICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJzb2NpYWwtYnRuIG1haWxydSIgdGFyZ2V0PSJfYmxhbmsiPjwvYT4KICAgICAgICAgICAgPGEgaHJlZj0iIyIgY2xhc3M9InNvY2lhbC1idG4gbGoiIHRhcmdldD0iX2JsYW5rIj48L2E+CiAgICAgICAgICAgIDxhIGhyZWY9IiMiIGNsYXNzPSJzb2NpYWwtYnRuIGdwIiB0YXJnZXQ9Il9ibGFuayI+PC9hPgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJzZi1tZW51LWxpc3QiPgogICAgICAgIDxkaXYgY2xhc3M9Iml0ZW0gYm9va21hcmtsZXQiIGRhdGEtYWN0aW9uPSJkb3dubG9hZEZyb21DdXJyZW50UGFnZSI+CiAgICAgICAgICAgIDxzdmcgY2xhc3M9Imljb24iIGRhdGEtdHlwZT0iZG93bmxvYWRGcm9tQ3VycmVudFBhZ2UiIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjAgMCAyNCAyMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0zLDcuNjk2ODE0MzUgTDMsMTUuMzgwMTA4NyBDMywxNi4yMzIyNjY1IDMuNjgzNDk2NTksMTYuOTIzMDc2OSA0LjQ5MzA5NjM1LDE2LjkyMzA3NjkgTDE2LjUwNjkwMzYsMTYuOTIzMDc2OSBDMTcuMzMwMDk2MiwxNi45MjMwNzY5IDE3Ljk5NzY5NDMsMTYuMjUxNzM0NCAxNy45OTk5OTQsMTUuMzg0NjE1NCBMMTkuNSwxNS4zODQ2MTU0IEwxOS41LDEzLjg0NjE1MzggTDIxLDEzLjg0NjE1MzggTDIxLDE2LjkzNTM1ODQgQzIxLDE4LjYxNTExMzYgMTkuNjUyOTE5NywyMCAxNy45OTEyMTIsMjAgTDMuMDA4Nzg3OTksMjAgQzEuMzQ1NTkwMTksMjAgMCwxOC42Mjc5MTMyIDAsMTYuOTM1MzU4NCBMMCw2LjE0MTU2NDY0IEMwLDQuNDYxODA5NDkgMS4zNDcwODAyNywzLjA3NjkyMzA4IDMuMDA4Nzg3OTksMy4wNzY5MjMwOCBMOSwzLjA3NjkyMzA4IEw5LDQuNjE1Mzg0NjIgTDcuNSw0LjYxNTM4NDYyIEw3LjUsNi4xNTM4NDYxNSBMNC40OTMwOTYzNSw2LjE1Mzg0NjE1IEMzLjY2ODQ4MjAxLDYuMTUzODQ2MTUgMyw2LjgyNzUwOTc3IDMsNy42OTY4MTQzNSBaIE0xNi41LDQuNjMzODg5NzUgTDE2LjUsMCBMMjQsNi45MjMwNzY5MiBMMTYuNSwxMy44NDYxNTM4IEwxNi41LDkuMjQ1OTA5NzkgQzExLjM5NDM4NTMsOS40NTI3MTk4NCA3LjIxOTEzMDgyLDExLjc1NTUzNTYgNi4yMjUwNDA3MywxNC43NjkyMzA4IEM2LjA3NzQ2ODA3LDE0LjIyMjQyOTMgNiwxMy42NTY0ODA3IDYsMTMuMDc2OTIzMSBDNiw4LjU5MzI5NjE2IDEwLjYzNjQ4MTIsNC45MjQxNjQ3OSAxNi41LDQuNjMzODg5NzUgWiIgaWQ9IlNoYXJlIiBmaWxsPSIjMDAwMDAwIj48L3BhdGg+CiAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0ibGFiZWwiIGRhdGEtaTE4bj0iZG93bmxvYWRGcm9tQ3VycmVudFBhZ2UiPkdvIHRvIFNhdmVGcm9tLm5ldDwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJib29rbWFya2xldCBzZXBhcmF0b3IiPjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Iml0ZW0gbW9kdWxlIHZrIG9kbm9rbGFzc25pa2kgZmFjZWJvb2sgbG0geW91dHViZSBkYWlseW1vdGlvbiBpbnN0YWdyYW0gcnV0dWJlIiBkYXRhLWFjdGlvbj0idXBkYXRlTGlua3MiPgogICAgICAgICAgICA8c3ZnIGNsYXNzPSJpY29uIiBkYXRhLXR5cGU9InVwZGF0ZUxpbmtzIiB3aWR0aD0iMjJweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjIgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjEuMjMwNzY5MiwxMy43MTQyODU3IEMyMS4yMzA3NjkyLDE5LjM5NDkyOTEgMTYuNDc4MDk5OSwyNCAxMC42MTUzODQ2LDI0IEM0Ljc1MjY2OTI5LDI0IDAsMTkuMzk0OTI5MSAwLDEzLjcxNDI4NTcgQzAsOC4wMzM2NDIyOSA0Ljc1MjY2OTI5LDMuNDI4NTcxNDMgMTAuNjE1Mzg0NiwzLjQyODU3MTQzIEwxMC42MTUzODQ2LDYuODU3MTQyODYgQzYuNzA2OTA3NzMsNi44NTcxNDI4NiAzLjUzODQ2MTU0LDkuOTI3MTkwMSAzLjUzODQ2MTU0LDEzLjcxNDI4NTcgQzMuNTM4NDYxNTQsMTcuNTAxMzgxMyA2LjcwNjkwNzczLDIwLjU3MTQyODYgMTAuNjE1Mzg0NiwyMC41NzE0Mjg2IEMxNC41MjM4NjE1LDIwLjU3MTQyODYgMTcuNjkyMzA3NywxNy41MDEzODEzIDE3LjY5MjMwNzcsMTMuNzE0Mjg1NyBMMjEuMjMwNzY5MiwxMy43MTQyODU3IEwyMS4yMzA3NjkyLDEzLjcxNDI4NTcgWiBNMTAuNjE1Mzg0NiwxMC4yODU3MTQzIEwxMC42MTUzODQ2LDAgTDE5LjQ2MTUzODUsNS4xNDI4NTcxNCBMMTAuNjE1Mzg0NiwxMC4yODU3MTQzIFoiIGlkPSJSZWZyZXNoIiBmaWxsPSIjMDAwMDAwIj48L3BhdGg+CiAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0ibGFiZWwiIGRhdGEtaTE4bj0idXBkYXRlTGlua3MiPlJlZnJlc2ggbGlua3M8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSBtb2R1bGUgdmsgb2Rub2tsYXNzbmlraSBtYWlscnUiIGRhdGEtYWN0aW9uPSJkb3dubG9hZE1QM0ZpbGVzIj4KICAgICAgICAgICAgPHN2ZyBjbGFzcz0iaWNvbiIgZGF0YS10eXBlPSJkb3dubG9hZE1QM0ZpbGVzIiB3aWR0aD0iMjFweCIgaGVpZ2h0PSIyNHB4IiB2aWV3Qm94PSIwIDAgMjEgMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjEsMi43NjkyMzA3NyBMMjEsMTcuNjQ4NzI4OCBDMjEsMTcuNjQ4NzI4OCAyMSwxNy42NDg3Mjg4IDIxLDE3LjY0ODcyODggTDIxLDE4LjQ2MTUzODUgTDIwLjkwNjg3MjksMTguNDYxNTM4NSBDMjAuNzIzNTk1LDE5LjI3MTIyNDkgMjAuMjcxNjAxMywyMC4wODY1NzkxIDE5LjU2NjkyOTYsMjAuNzY4MDE5OCBDMTcuOTIwMzUzNywyMi4zNjAzMTMgMTUuNTE3Njg5NiwyMi42MTg0NzQ3IDE0LjIwMDQyODksMjEuMzQ0NjQwMiBDMTIuODgzMTY4MiwyMC4wNzA4MDU2IDEzLjE1MDEzMDksMTcuNzQ3MzUwMyAxNC43OTY3MDY4LDE2LjE1NTA1NzEgQzE2LjA2MDI1MTYsMTQuOTMzMTY3NiAxNy43NjkwMzI0LDE0LjQ5NjkwNTEgMTkuMDkwOTA5MSwxNC45MzU2ODE2IEwxOS4wOTA5MDkxLDE0LjkzNTY4MTYgTDE5LjA5MDkwOTEsNC4xNTM4NDYxNSBMNy42MzYzNjM2NCw2LjkyMzA3NjkyIEw3LjYzNjM2MzY0LDE5LjQ5NDg4MjYgQzcuNjM2MzYzNjQsMTkuNDk0ODgyNiA3LjYzNjM2MzY0LDE5LjQ5NDg4MjYgNy42MzYzNjM2NCwxOS40OTQ4ODI2IEw3LjYzNjM2MzY0LDIwLjMwNzY5MjMgTDcuNTQzMjM2NSwyMC4zMDc2OTIzIEM3LjM1OTk1ODU5LDIxLjExNzM3ODggNi45MDc5NjQ5MywyMS45MzI3MzI5IDYuMjAzMjkzMjMsMjIuNjE0MTczNyBDNC41NTY3MTczMiwyNC4yMDY0NjY5IDIuMTU0MDUzMjgsMjQuNDY0NjI4NiAwLjgzNjc5MjU1MiwyMy4xOTA3OTQgQy0wLjQ4MDQ2ODE3MywyMS45MTY5NTk1IC0wLjIxMzUwNTUwMSwxOS41OTM1MDQxIDEuNDMzMDcwNDEsMTguMDAxMjEwOSBDMi42OTY2MTUyMywxNi43NzkzMjE0IDQuNDA1Mzk2MDEsMTYuMzQzMDU5IDUuNzI3MjcyNzMsMTYuNzgxODM1NCBMNS43MjcyNzI3MywxNi43ODE4MzU0IEw1LjcyNzI3MjczLDYuNDYxNTM4NDYgTDUuNzI3MjcyNzMsMy42OTIzMDc2OSBMMjEsMCBMMjEsMi43NjkyMzA3NyBaIiBpZD0iTXVzaWMtMiIgZmlsbD0iIzAwMDAwMCI+PC9wYXRoPgogICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImxhYmVsIiBkYXRhLWkxOG49ImRvd25sb2FkTVAzRmlsZXMiPkRvd25sb2FkIGF1ZGlvIGZpbGVzPC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Iml0ZW0gbW9kdWxlIHZrIG9kbm9rbGFzc25pa2kgcGxZb3V0dWJlIG1haWxydSIgZGF0YS1hY3Rpb249ImRvd25sb2FkUGxheWxpc3QiPgogICAgICAgICAgICA8c3ZnIGNsYXNzPSJpY29uIiBkYXRhLXR5cGU9ImRvd25sb2FkUGxheWxpc3QiIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjE4cHgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0wLDAgTDAsMy42IEwzLjQyODU3MTQzLDMuNiBMMy40Mjg1NzE0MywwIEwwLDAgWiBNMCw3LjIgTDAsMTAuOCBMMy40Mjg1NzE0MywxMC44IEwzLjQyODU3MTQzLDcuMiBMMCw3LjIgWiBNNS4xNDI4NTcxNCwwIEw1LjE0Mjg1NzE0LDMuNiBMMjQsMy42IEwyNCwwIEw1LjE0Mjg1NzE0LDAgWiBNNS4xNDI4NTcxNCw3LjIgTDUuMTQyODU3MTQsMTAuOCBMMjAuNTcxNDI4NiwxMC44IEwyMC41NzE0Mjg2LDcuMiBMNS4xNDI4NTcxNCw3LjIgWiBNMCwxNC40IEwwLDE4IEwzLjQyODU3MTQzLDE4IEwzLjQyODU3MTQzLDE0LjQgTDAsMTQuNCBaIE01LjE0Mjg1NzE0LDE0LjQgTDUuMTQyODU3MTQsMTggTDIyLjI4NTcxNDMsMTggTDIyLjI4NTcxNDMsMTQuNCBMNS4xNDI4NTcxNCwxNC40IFoiIGlkPSJCdWxsZXQtTGlzdCIgZmlsbD0iIzAwMDAwMCI+PC9wYXRoPgogICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImxhYmVsIiBkYXRhLWkxOG49ImRvd25sb2FkUGxheWxpc3QiPkRvd25sb2FkIGEgcGxheWxpc3Q8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSBtb2R1bGUgdmsiIGRhdGEtYWN0aW9uPSJkb3dubG9hZFBob3RvcyI+CiAgICAgICAgICAgIDxzdmcgY2xhc3M9Imljb24iIGRhdGEtdHlwZT0iZG93bmxvYWRQaG90b3MiIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjE4cHgiIHZpZXdCb3g9IjAgMCAyNCAxOCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xOS41LDMgTDIxLjAwODkwOTYsMyBDMjIuNjU4MjI5NCwzIDI0LDQuMzQyODg3MTggMjQsNS45OTk0MjI0OCBMMjQsMTUuMDAwNTc3NSBDMjQsMTYuNjU1NjQ5MyAyMi42NjA4NDMyLDE4IDIxLjAwODkwOTYsMTggTDIuOTkxMDkwNDIsMTggQzEuMzQxNzcwNjMsMTggMCwxNi42NTcxMTI4IDAsMTUuMDAwNTc3NSBMMCw1Ljk5OTQyMjQ4IEMwLDQuMzQ0MzUwNzMgMS4zMzkxNTY3OSwzIDIuOTkxMDkwNDIsMyBMNy41LDMgQzcuNSwxLjM0NjUxNzEyIDguODQxODcwNjcsMCAxMC40OTcxNTIsMCBMMTYuNTAyODQ4LDAgQzE4LjE1ODM3NzIsMCAxOS41LDEuMzQzMTQ1NzUgMTkuNSwzIEwxOS41LDMgWiBNMTMuNSwxNi41IEMxNi44MTM3MDg3LDE2LjUgMTkuNSwxMy44MTM3MDg3IDE5LjUsMTAuNSBDMTkuNSw3LjE4NjI5MTM0IDE2LjgxMzcwODcsNC41IDEzLjUsNC41IEMxMC4xODYyOTEzLDQuNSA3LjUsNy4xODYyOTEzNCA3LjUsMTAuNSBDNy41LDEzLjgxMzcwODcgMTAuMTg2MjkxMywxNi41IDEzLjUsMTYuNSBaIE0xMy41LDE1IEMxNS45ODUyODE1LDE1IDE4LDEyLjk4NTI4MTUgMTgsMTAuNSBDMTgsOC4wMTQ3MTg1IDE1Ljk4NTI4MTUsNiAxMy41LDYgQzExLjAxNDcxODUsNiA5LDguMDE0NzE4NSA5LDEwLjUgQzksMTIuOTg1MjgxNSAxMS4wMTQ3MTg1LDE1IDEzLjUsMTUgWiIgaWQ9IkNhbWVyYS0yIiBmaWxsPSIjMDAwMDAwIj48L3BhdGg+CiAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0ibGFiZWwiIGRhdGEtaTE4bj0iZG93bmxvYWRQaG90b3MiPkRvd25sb2FkIHBpY3R1cmVzPC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im1vZHVsZSB2ayBvZG5va2xhc3NuaWtpIGZhY2Vib29rIGxtIHNlcGFyYXRvciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSIgZGF0YS1hY3Rpb249InJlcG9ydEJ1ZyI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Imljb24iPjwvZGl2PjxzcGFuIGNsYXNzPSJsYWJlbCIgZGF0YS1pMThuPSJyZXBvcnRCdWciPlJlcG9ydCBhIGJ1Zzwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJpdGVtIiBkYXRhLWFjdGlvbj0ic2hvd09wdGlvbnMiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJpY29uIj48L2Rpdj48c3BhbiBjbGFzcz0ibGFiZWwiIGRhdGEtaTE4bj0ic2hvd09wdGlvbnMiPk9wdGlvbnM8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSIgZGF0YS1hY3Rpb249Im9wZW5Qb2xsIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaWNvbiI+PC9kaXY+PHNwYW4gY2xhc3M9ImxhYmVsIiBkYXRhLWkxOG49Im9wZW5Qb2xsIj5CZWNvbWUgYmV0dGVyPC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Iml0ZW0gZW5hYmxlTW9kdWxlIiBkYXRhLWFjdGlvbj0iZW5hYmxlTW9kdWxlIj4KICAgICAgICAgICAgPGkgY2xhc3M9InNmLWNoZWNrYm94Ij48aT48aT48L2k+PC9pPjwvaT4KICAgICAgICAgICAgPHNwYW4gaWQ9ImRpc2FibGVNb2R1bGUiIGNsYXNzPSJsYWJlbCIgZGF0YS1pMThuPSJkaXNhYmxlTW9kdWxlIj5EaXNhYmxlIG1vZHVsZTwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBub25lOyIgZGF0YS1hY3Rpb249InNob3dBYm91dFBhZ2UiPgogICAgICAgICAgICA8c3ZnIGNsYXNzPSJpY29uIiBkYXRhLXR5cGU9InNob3dBYm91dFBhZ2UiIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48cGF0aCBkPSJtMy4wOSwuNzE5YzAsLjg1MSAwLDEuNzExIDAsMi41NjEtLjY3LDAtMS4zNCwwLTIuMDEsMCAxLjA3LDEuMDcgMi4xNSwyLjE1IDMuMjIsMy4yMiAwLTEuOTMgMC0zLjg1IDAtNS43ODEtLjQyLDAtLjgzLDAtMS4yNSwwem0xLjkxLDBjLjA0LDIuMDkxIC4wNCw0LjE5MSAuMDQsNi4yODEtMS42NywwLTMuMzMsMC01LDAgMi42NywyLjc3IDUuMzMsNS41IDgsOC4zIDIuNy0yLjggNS4zLTUuNTMgOC04LjMtMS43LDAtMy4zLDAtNSwwIDAtMi4wOSAwLTQuMTkgMC02LjI4MS0yLDAtNCwwLTYsMHptNi43LDBjMCwxLjkzMSAwLDMuODUxIDAsNS43ODEgMS4xLTEuMDcgMi4xLTIuMTUgMy4yLTMuMjItLjcsMC0xLjMsMC0yLDAgMC0uODUgMC0xLjcxIDAtMi41NjEtLjQsMC0uOCwwLTEuMiwweiIvPjwvc3ZnPgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+',

    getMenu: function() {
      var code = atob(this.menuHTML);
      var menu = document.createElement('div');
      menu.classList.add('sf-menu-container');
      menu.setAttribute(this.activeDataAttr, '1');
      menu.style.marginTop = '-24px';
      menu.style.width = 'auto';
      menu.style.minWidth = '482px';
      menu.innerHTML = code;
      return menu;
    },

    showMenuItems: function() {
      if (this.active)
        return;

      this.menu.style.top = this.style.menu.initial.top;

      this.removeActiveItems();

      var menu = this.getMenu();
      if (menu) {
        this.menu.appendChild(menu);
        _menu.initMenu(this.menu);
      }

      this.active = true;
      this.setElementsStyle('active');

      document.addEventListener('click', this.onDocumentClick, false);
      document.addEventListener('keydown', this.onDocumentKeyDown, false);

      var menuHeight = this.menu.clientHeight;
      var menuTop = parseInt(this.menu.style.top);
      var winHeight = window.innerHeight;
      if (menuTop + menuHeight > winHeight) {
        this.menu.style.top = (winHeight - menuHeight - 4) + 'px'
      } else
      if (menuTop < 0) {
        this.menu.style.top = '0px';
      }
    },

    hideMenuItems: function() {
      this.menu.style.top = this.style.menu.initial.top;

      // this.removeTooltip();
      this.removeActiveItems();
      document.removeEventListener('click', this.onDocumentClick, false);
      document.removeEventListener('keydown', this.onDocumentKeyDown, false);

      this.active = false;
      this.showTag();
    },

    onDocumentClick: function(event) {
      var node = event.target;
      if (node != _menu.menu && !SaveFrom_Utils.isParent(node, _menu.menu)) {
        _menu.hideMenuItems();
      }
    },

    onDocumentKeyDown: function(event) {
      if (event.keyCode == 27) {
        _menu.hideMenuItems();
      }
    },

    removeActiveItems: function() {
      var e = null;
      while (e = this.menu.querySelector('div[' + this.activeDataAttr + ']')) {
        e.parentNode.removeChild(e);
      }
    }
  };
  /////////////////////////////////////////////////
  // OPTIONS
  _options = {
    classPrefix: 'sfh--',
    dataAttr: 'data-sfh-option',
    html: 'PHN0eWxlIHR5cGU9InRleHQvY3NzIj4KLnNmaC0tb3B0aW9ucyB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwogICAgYm9yZGVyOiBub25lOwogICAgZm9udDogMTNweC8xIEFyaWFsLCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWY7CiAgICB3aWR0aDogNTgwcHg7CiAgICBtYXJnaW46IDA7CiAgICBwYWRkaW5nOiA5cHg7CiAgICB0ZXh0LWFsaWduOiBsZWZ0Cn0KCi5zZmgtLW9wdGlvbnMgLnNmaC0tdGl0bGUgewogICAgZm9udC1zaXplOiAxLjNlbTsKICAgIG1hcmdpbjogMCAwIDEuM2VtIDAKfQoKLnNmaC0tb3B0aW9ucyBmb3JtIHsKICAgIG1hcmdpbjogMDsKICAgIHBhZGRpbmc6IDAKfQoKLnNmaC0tb3B0aW9ucyBpbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKICAgIG1pbi13aWR0aDogMTJweDsKICAgIG1pbi1oZWlnaHQ6IDEycHgKfQoKLnNmaC0tb3B0aW9ucyBsYWJlbCB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIG1hcmdpbjogLjJlbSAwOwogICAgcGFkZGluZzogMDsKICAgIHRleHQtYWxpZ246IGxlZnQ7CiAgICBmb250LXNpemU6IDEzcHg7CiAgICBmbG9hdDogbm9uZTsKfQoKLnNmaC0tb3B0aW9ucyAuc2ZoLS1pbmxpbmUtY29udGVudCBsYWJlbCB7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICBtYXJnaW4tbGVmdDogMTBweAp9Cgouc2ZoLS1vcHRpb25zIC5zZmgtLWZsZWZ0IHsKICAgIGZsb2F0OiBsZWZ0Cn0KCi5zZmgtLW9wdGlvbnMgLnNmaC0tZmwtY29sdW1uIHsKICAgIGZsb2F0OiBsZWZ0OwogICAgbWFyZ2luLXJpZ2h0OiAyMHB4Cn0KCi5zZmgtLW9wdGlvbnMgLnNmaC0tY2xlYXIgewogICAgY2xlYXI6IGJvdGg7CiAgICBoZWlnaHQ6IDA7CiAgICBmb250LXNpemU6IDA7CiAgICBsaW5lLWhlaWdodDogMAp9Cgouc2ZoLS1vcHRpb25zIC5zZmgtLWJsb2NrIHsKICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGZlMWU4OwogICAgcGFkZGluZzogMS41ZW0gMCAwIDA7CiAgICBtYXJnaW46IDEuNWVtIDAgMCAwOwogICAgbWluLXdpZHRoOiAxNjBweAp9Cgouc2ZoLS1vcHRpb25zIC5zZmgtLWJsb2NrLXRpdGxlIHsKICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgbWFyZ2luLWJvdHRvbTogLjVlbQp9Cgouc2ZoLS1vcHRpb25zIC5zZmgtLW1vZHVsZSB7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIG1hcmdpbi10b3A6IDFlbQp9Cgouc2ZoLS1vcHRpb25zIC5zZmgtLW1vZHVsZTpmaXJzdC1jaGlsZCB7CiAgICBtYXJnaW4tdG9wOiAwCn0KCi5zZmgtLW9wdGlvbnMgLnNmaC0tbW9kdWxlX29wdGlvbnMgewogICAgZm9udC1zaXplOiAuOWVtOwogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICAgIG1hcmdpbi1sZWZ0OiAyZW0KfQoKPC9zdHlsZT4KPGRpdiBjbGFzcz0ic2ZoLS1vcHRpb25zIj4KICA8ZGl2IGNsYXNzPSJzZmgtLXRpdGxlIiBkYXRhLWkxOG49Im9wdGlvbnNUaXRsZSI+U2F2ZUZyb20ubmV0IEhlbHBlciAtIFByZWZlcmVuY2VzPC9kaXY+CgogIDxmb3JtPgogICAgPGRpdiBjbGFzcz0ic2ZoLS1ibG9jayI+CiAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGRhdGEtc2ZoLW9wdGlvbj0iYnV0dG9uIiBjaGVja2VkPSIxIj4mbmJzcDs8c3BhbiBkYXRhLWkxOG49InNob3dCdXR0b24iPlNob3cgZXh0ZW5zaW9uIGJ1dHRvbjwvc3Bhbj48L2xhYmVsPgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ic2ZoLS1ibG9jayI+CiAgICAgIDxkaXYgZGF0YS1pMThuPSJvcHRpb25zSGFuZGxlTGlua3MiIGNsYXNzPSJzZmgtLWJsb2NrLXRpdGxlIj5IYW5kbGUgbGlua3M8L2Rpdj4KICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1zZmgtb3B0aW9uPSJsbUZpbGVIb3N0aW5nIiBjaGVja2VkPSIxIj4mbmJzcDs8c3BhbiBkYXRhLWkxOG49Im9wdGlvbnNGaWxlSG9zdGluZ3MiPlRvIGZpbGVob3N0aW5nczwvc3Bhbj48L2xhYmVsPgogICAgICA8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249ImxtTWVkaWFIb3N0aW5nIiBjaGVja2VkPSIxIj4mbmJzcDs8c3BhbiBkYXRhLWkxOG49Im9wdGlvbnNNZWRpYUhvc3RpbmdzIj5UbyBtZWRpYWhvc3RpbmdzPC9zcGFuPjwvbGFiZWw+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJzZmgtLWJsb2NrIj4KICAgICAgPGRpdiBkYXRhLWkxOG49Im9wdGlvbnNNb2R1bGVzIiBjbGFzcz0ic2ZoLS1ibG9jay10aXRsZSI+TW9kdWxlczwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJzZmgtLXlvdXR1YmVfYm94IiBjbGFzcz0ic2ZoLS1tb2R1bGUiPjxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGRhdGEtc2ZoLW9wdGlvbj0ibW9kdWxlWW91dHViZSIgY2hlY2tlZD0iMSI+Jm5ic3A7PHNwYW4gZGF0YS1pMThuPSJvcHRpb25zWW91dHViZSI+WW91VHViZTwvc3Bhbj48L2xhYmVsPgogICAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlX29wdGlvbnMiPgogICAgICAgICAgPGRpdiBjbGFzcz0ic2ZoLS1mbC1jb2x1bW4iPjxzcGFuIGRhdGEtaTE4bj0ib3B0aW9uc1lUSGlkZUxpbmtzIj5IaWRlIGxpbmtzPC9zcGFuPjo8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InNmaC0tZmxlZnQgc2ZoLS1pbmxpbmUtY29udGVudCI+CiAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGRhdGEtc2ZoLW9wdGlvbj0ieXRIaWRlRkxWIiBjaGVja2VkPSIwIj4mbmJzcDtGTFY8L2xhYmVsPgogICAgICAgICAgICA8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Inl0SGlkZU1QNCIgY2hlY2tlZD0iMCI+Jm5ic3A7TVA0PC9sYWJlbD4KICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1zZmgtb3B0aW9uPSJ5dEhpZGVXZWJNIiBjaGVja2VkPSIxIj4mbmJzcDtXZWJNPC9sYWJlbD4KICAgICAgICAgICAgPGJyPgogICAgICAgICAgICA8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Inl0SGlkZTNHUCIgY2hlY2tlZD0iMSI+Jm5ic3A7M0dQPC9sYWJlbD4KICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1zZmgtb3B0aW9uPSJ5dEhpZGUzRCIgY2hlY2tlZD0iMSI+Jm5ic3A7M0Q8L2xhYmVsPgogICAgICAgICAgICA8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Inl0SGlkZU1QNE5vQXVkaW8iIGNoZWNrZWQ9IjEiPiZuYnNwO01QNCZuYnNwOyhubyZuYnNwO2F1ZGlvKTwvbGFiZWw+CiAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGRhdGEtc2ZoLW9wdGlvbj0ieXRIaWRlQXVkaW9fTVA0IiBjaGVja2VkPSIxIj4mbmJzcDtBdWRpbzwvbGFiZWw+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InNmaC0tY2xlYXIiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlIj48bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Im1vZHVsZURhaWx5bW90aW9uIiBjaGVja2VkPSIxIj4mbmJzcDs8c3BhbiBkYXRhLWkxOG49Im9wdGlvbnNEYWlseW1vdGlvbiI+RGFpbHltb3Rpb248L3NwYW4+PC9sYWJlbD48L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlIj48bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Im1vZHVsZVZpbWVvIiBjaGVja2VkPSIxIj4mbmJzcDs8c3BhbiBkYXRhLWkxOG49Im9wdGlvbnNWaW1lbyI+VmltZW88L3NwYW4+PC9sYWJlbD48L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlIj48bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Im1vZHVsZUZhY2Vib29rIiBjaGVja2VkPSIxIj4mbmJzcDs8c3BhbiBkYXRhLWkxOG49Im9wdGlvbnNGYWNlYm9vayI+RmFjZWJvb2s8L3NwYW4+PC9sYWJlbD48L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlIj48bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Im1vZHVsZVNvdW5kY2xvdWQiIGNoZWNrZWQ9IjEiPiZuYnNwOzxzcGFuIGRhdGEtaTE4bj0ib3B0aW9uc1NvdW5kY2xvdWQiPlNvdW5kQ2xvdWQ8L3NwYW4+PC9sYWJlbD48L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlIj48bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Im1vZHVsZVZrb250YWt0ZSIgY2hlY2tlZD0iMSI+Jm5ic3A7PHNwYW4gZGF0YS1pMThuPSJvcHRpb25zVmtvbnRha3RlIj5WSzwvc3Bhbj48L2xhYmVsPgogICAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlX29wdGlvbnMiPjxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGRhdGEtc2ZoLW9wdGlvbj0idmtTaG93Qml0cmF0ZSIgY2hlY2tlZD0iMCI+Jm5ic3A7PHNwYW4gZGF0YS1pMThuPSJvcHRpb25zQml0cmF0ZSI+U2hvdyBiaXRyYXRlIGluc3RhbnRseTwvc3Bhbj48L2xhYmVsPjwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlIj48bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Im1vZHVsZU9kbm9rbGFzc25pa2kiIGNoZWNrZWQ9IjEiPiZuYnNwOzxzcGFuIGRhdGEtaTE4bj0ib3B0aW9uc09kbm9rbGFzc25pa2kiPk9kbm9rbGFzc25pa2k8L3NwYW4+PC9sYWJlbD48L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InNmaC0tbW9kdWxlIj48bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249Im1vZHVsZU1haWxydSIgY2hlY2tlZD0iMSI+Jm5ic3A7PHNwYW4gZGF0YS1pMThuPSJvcHRpb25zTWFpbHJ1Ij5NYWlsLnJ1PC9zcGFuPjwvbGFiZWw+PC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJzZmgtLW1vZHVsZSI+PGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1zZmgtb3B0aW9uPSJtb2R1bGVJbnN0YWdyYW0iIGNoZWNrZWQ9IjEiPiZuYnNwOzxzcGFuIGRhdGEtaTE4bj0ib3B0aW9uc0luc3RhZ3JhbSI+SW5zdGFncmFtPC9zcGFuPjwvbGFiZWw+PC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJzZmgtLW1vZHVsZSI+PGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1zZmgtb3B0aW9uPSJtb2R1bGVSdXR1YmUiIGNoZWNrZWQ9IjEiPiZuYnNwOzxzcGFuIGRhdGEtaTE4bj0ib3B0aW9uc1J1dHViZSI+UnV0dWJlPC9zcGFuPjwvbGFiZWw+PC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9InNmaC0tYmxvY2sgYmxvY2tVbW15SW5mbyI+CiAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGRhdGEtc2ZoLW9wdGlvbj0ic2hvd1VtbXlJbmZvIiBjaGVja2VkPSIxIj4mbmJzcDs8c3BhbiBkYXRhLWkxOG49Im9wdGlvbnNTaG93VW1teUluZm8iPlNob3cgVW1teSBpbmZvIHBvcHVwPC9zcGFuPjwvbGFiZWw+CiAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGRhdGEtc2ZoLW9wdGlvbj0ic2hvd1VtbXlCdG4iIGNoZWNrZWQ9IjEiPiZuYnNwOzxzcGFuIGRhdGEtaTE4bj0ib3B0aW9uc1Nob3dVbW15QnRuIj5TaG93IHRoZSBVbW15IGJ1dHRvbjwvc3Bhbj48L2xhYmVsPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJzZmgtLWJsb2NrIGJsb2NrR21OYXRpdmVEb3dubG9hZCIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4KICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1zZmgtb3B0aW9uPSJnbU5hdGl2ZURvd25sb2FkIiBjaGVja2VkPSIwIj4mbmJzcDs8c3BhbiBkYXRhLWkxOG49Im9wdGlvbnNHbU5hdGl2ZURvd25sb2FkIj5BZHZhbmNlZCBkb3dubG9hZCBtb2RlPC9zcGFuPjwvbGFiZWw+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9InNmaC0tYmxvY2sgYmxvY2tTb3ZldG5pa0VuYWJsZWQiPgogICAgICA8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLXNmaC1vcHRpb249InNvdmV0bmlrRW5hYmxlZCIgY2hlY2tlZD0iMSI+Jm5ic3A7PHNwYW4gZGF0YS1pMThuPSJvcHRpb25zU292ZXRuaWtFbmFibGVkIj5FbmFibGUgc292ZXRuaWs8L3NwYW4+PC9sYWJlbD4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ic2ZoLS1ibG9jayBibG9ja0F2aWFCYXJFbmFibGVkIj4KICAgICAgPGxhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1zZmgtb3B0aW9uPSJhdmlhQmFyRW5hYmxlZCIgY2hlY2tlZD0iMSI+Jm5ic3A7PHNwYW4gZGF0YS1pMThuPSJvcHRpb25zQXZpYUJhckVuYWJsZWQiPkVuYWJsZSBhdmlhQmFyPC9zcGFuPjwvbGFiZWw+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9InNmaC0tY2xlYXIiPjwvZGl2PgogIDwvZm9ybT4KPC9kaXY+',

    translate: function(parent) {
      parent = parent || document;
      var e_list = parent.querySelectorAll('*[data-i18n]');
      for (var i = 0, len = e_list.length; i < len; i++) {
        var el = e_list[i];
        el.textContent = engine.language[el.dataset.i18n];
      }
    },

    onCbChange: function(event) {
      var el = event.target;
      var key = el.getAttribute(_options.dataAttr);
      mono.sendMessage({
        action: 'updateOption',
        key: key,
        value: el.checked ? 1 : 0
      });
    },

    createStatBlock: function(parent) {
      var id = 'blockStatEnabled';
      var node = parent.querySelector(id);
      if (!node) {
        var block = mono.create('div', {
          class: ['sfh--block', id],
          append: [
            mono.create('label', {
              append: [
                mono.create('input', {
                  type: 'checkbox',
                  data: {
                    sfhOption: 'statEnabled'
                  },
                  checked: true
                }),
                String.fromCharCode(160),
                mono.create('span', {
                  text: 'Web Statistic Tracker'
                })
              ]
            })
          ]
        });
        var clearBlock = parent.querySelector('form > .sfh--clear');
        clearBlock.parentNode.insertBefore(block, clearBlock);
      }
    },

    init: function(preference) {
      var parent = document.querySelector('.sfh--options');

      if (!parent) {
        return;
      }

      if (!preference.hasSovetnik && !preference.hasDP) {
        var sovBlock = parent.querySelector('.blockSovetnikEnabled');
        if (sovBlock) {
          sovBlock.style.display = 'none';
        }
      }

      if (!preference.hasAviaBar) {
        var aviaBlock = parent.querySelector('.blockAviaBarEnabled');
        if (aviaBlock) {
          aviaBlock.style.display = 'none';
        }
      }

      if (!preference.showUmmyItem) {
        var ummyBlock = parent.querySelector('.blockUmmyInfo');
        if (ummyBlock) {
          ummyBlock.style.display = 'none';
        }
      }

      if (preference.hasSwStat || preference.hasFsStat) {
        _options.createStatBlock(parent);
      }

      _options.translate(parent);

      var c = parent.querySelectorAll('form input[type="checkbox"]');
      for (var i = 0; i < c.length; i++) {
        var el = c[i];
        var name = el.getAttribute(_options.dataAttr);
        if (name && preference[name] !== undefined) {
          el.checked = preference[name] !== 0;
          el.addEventListener('change', _options.onCbChange, false);
        }
      }

      if (typeof GM_download !== 'undefined') {
        var blockGmNativeDownload = parent.querySelector('.blockGmNativeDownload');
        if (blockGmNativeDownload) {
          blockGmNativeDownload.style.display = 'block';
        }
      }
    },

    hideBlock: function(name, hide) {
      var node = document.querySelector('.' + _options.classPrefix + name);
      if (node)
        node.style.display = hide ? 'none' : '';
    },

    show: function() {
      var height = document.body.clientHeight || 0;
      if (height > 600) {
        height = 600;
      }
      SaveFrom_Utils.popupDiv(function(cnt) {
        var _atob = mono.isTM ? window.atob : atob;
        cnt.innerHTML = _atob(_options.html);
      }, null, 640, height);

      mono.initGlobal(function(resp) {
        _options.init(mono.global.preference);
      });
    }
  };

  _languageList.de = "%7B%0A%20%22extName%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helfer%22%7D,%0A%20%22extDescription%22:%20%7B%22message%22:%20%22Laden%20Sie%20von%20YouTube,%20Facebook,%20VK.com%20und%20mehr%20als%2040%20anderen%20Seiten%20mit%20einem%20Klick%20herunter.%22%7D,%0A%0A%20%22extNameLite%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helfer%20Lite%22%7D,%0A%20%22extDescriptionLite%22:%20%7B%22message%22:%20%22Herunterladen%20von%20Facebook,%20VK.com%20und%20mehr%20als%2040%20weiteren%20Seiten%20mit%20einem%20Klick%20herunter.%22%7D,%0A%0A%20%22lang%22:%20%7B%22message%22:%20%22de%22%7D,%0A%0A%20%22titleDefault%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helfer%22%7D,%0A%20%22titleDesabled%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helfer%20deaktiviert%22%7D,%0A%0A%20%22menuEnable%22:%20%7B%22message%22:%20%22Aktivieren%22%7D,%0A%20%22menuDisable%22:%20%7B%22message%22:%20%22Deaktivieren%22%7D,%0A%0A%20%22showButton%22:%20%7B%22message%22:%20%22Erweiterungs%20Knopf%20anzeigen%22%7D,%0A%0A%20%22copy%22:%20%7B%22message%22:%20%22Kopie%22%7D,%0A%20%22download%22:%20%7B%22message%22:%20%22Herunterladen%22%7D,%0A%20%22downloadTitle%22:%20%7B%22message%22:%20%22Klicken%20Sie%20den%20Link%20w%C3%A4hrend%20Sie%20die%20Alt/Einstellung%20oder%20Ctrl/Strg%20Taste%20dr%C3%BCcken%20zum%20Herunterladen%20der%20Dateien.%22%7D,%0A%20%22noLinksFound%22:%20%7B%22message%22:%20%22Keine%20Links%20wurden%20gefunden%22%7D,%0A%20%22more%22:%20%7B%22message%22:%20%22Mehr%22%7D,%0A%20%22close%22:%20%7B%22message%22:%20%22Schlie%C3%9Fen%22%7D,%0A%20%22kbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22withoutAudio%22:%20%7B%22message%22:%20%22without%20audio%22%7D,%0A%20%22size%22:%20%7B%22message%22:%20%22gr%C3%B6%C3%9Fe%22%7D,%0A%0A%20%22subtitles%22:%20%7B%22message%22:%20%22Untertitel%22%7D,%0A%20%22playlist%22:%20%7B%22message%22:%20%22Wiedergabliste%22%7D,%0A%20%22filelist%22:%20%7B%22message%22:%20%22List%20of%20files%22%7D,%0A%20%22downloadWholePlaylist%22:%20%7B%22message%22:%20%22Die%20komplette%20Wiedergabliste%20herunterladen%22%7D,%0A%0A%20%22getFileSizeTitle%22:%20%7B%22message%22:%20%22Dateigr%C3%B6%C3%9Fe%20bestimmen%22%20%7D,%0A%20%22getFileSizeFailTitle%22:%20%7B%22message%22:%20%22Fehler%20bei%20bestimmung%20der%20Dateigr%C3%B6%C3%9Fe.%20Bitte%20versuchen%20Sie%20es%20erneut.%22%7D,%0A%0A%20%22lmButtonTitle%22:%20%7B%22message%22:%20%22Holen%20Sie%20sich%20einen%20direkten%20Link.%22%7D,%0A%0A%20%22downloadFromCurrentPage%22:%20%7B%22message%22:%20%22Zu%20SaveFrom.net%22%7D,%0A%20%22updateLinks%22:%20%7B%22message%22:%20%22Links%20aktualisieren%22%7D,%0A%20%22updateLinksNotification%22:%20%7B%22message%22:%20%22Links%20aktualisiert%22%7D,%0A%20%22downloadMP3Files%22:%20%7B%22message%22:%20%22Download%20Audiodateien%22%7D,%0A%20%22downloadPlaylist%22:%20%7B%22message%22:%20%22Download%20Playlist%22%7D,%0A%20%22downloadPhotos%22:%20%7B%22message%22:%20%22Download%20Bilder%22%7D,%0A%20%22installFullVersion%22:%20%7B%22message%22:%20%22Install%20full%20version%22%7D,%0A%20%22disable%22:%20%7B%22message%22:%20%22Deaktivieren%22%7D,%0A%20%22showOptions%22:%20%7B%22message%22:%20%22Einstellungen%22%7D,%0A%20%22reportBug%22:%20%7B%22message%22:%20%22Fehler%20melden%22%7D,%0A%20%22openPoll%22:%20%7B%22message%22:%20%22Become%20better%22%7D,%0A%20%22disableModule%22:%20%7B%22message%22:%20%22Auf%20dieser%20Webseite%20deaktivieren%22%7D,%0A%20%22enableModule%22:%20%7B%22message%22:%20%22Auf%20dieser%20Webseite%20aktivieren%22%7D,%0A%20%22enableDisableModule%22:%20%7B%22message%22:%20%22Ein/Aus%20auf%20dieser%20Webseite%22%7D,%0A%20%22showHideButton%22:%20%7B%22message%22:%20%22Erweitern%20Ein-/Ausblenden%22%7D,%0A%20%22updateTo%22:%20%7B%22message%22:%20%22Update%20auf%20%25d%22%7D,%0A%0A%20%22aboutPage%22:%20%7B%22message%22:%20%22%C3%9Cber%22%7D,%0A%20%22aboutTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helfer%22%7D,%0A%20%22aboutVersion%22:%20%7B%22message%22:%20%22Version%22%7D,%0A%20%22aboutDescription%22:%20%7B%22message%22:%20%22Hilft%20den%20Nutzern%20direkte%20Links%20zu%20Herunterladen%20von%20mehr%20als%2040%20Webseiten,%20inklusive%20Dailymotion.com,%20YouTube.com,%20VK.com%20und%20weiteren%20zu%20bekommen.%22%7D,%0A%20%22aboutDescriptionLite%22:%20%7B%22message%22:%20%22Hilft%20den%20Nutzern%20direkte%20Links%20zu%20Herunterladen%20von%20mehr%20als%2040%20Webseiten,%20inklusive%20Dailymotion.com,%20VK.com%20und%20weiteren%20zu%20bekommen.%22%7D,%0A%20%22aboutSupported%22:%20%7B%22message%22:%20%22Unterst%C3%BCtzte%20Ressourcen%22%7D,%0A%20%22homePage%22:%20%7B%22message%22:%20%22Homepage%22%7D,%0A%0A%20%22optionsTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helfer%20-%20Einstellungen%22%7D,%0A%20%22optionsHandleLinks%22:%20%7B%22message%22:%20%22Links%20handhaben%22%7D,%0A%20%22optionsFileHostings%22:%20%7B%22message%22:%20%22Zu%20Dateihoster%22%7D,%0A%20%22optionsMediaHostings%22:%20%7B%22message%22:%20%22Zu%20Medienhoster%22%7D,%0A%20%22optionsModules%22:%20%7B%22message%22:%20%22Module%22%7D,%0A%20%22optionsYoutube%22:%20%7B%22message%22:%20%22YouTube%22%7D,%0A%20%22optionsYTHideLinks%22:%20%7B%22message%22:%20%22Links%20ausblenden%22%7D,%0A%20%22optionsDailymotion%22:%20%7B%22message%22:%20%22Dailymotion%22%7D,%0A%20%22optionsVimeo%22:%20%7B%22message%22:%20%22Vimeo%22%7D,%0A%20%22optionsFacebook%22:%20%7B%22message%22:%20%22Facebook%22%7D,%0A%20%22optionsSoundcloud%22:%20%7B%22message%22:%20%22SoundCloud%22%7D,%0A%20%22optionsVkontakte%22:%20%7B%22message%22:%20%22VK%22%7D,%0A%20%22optionsOdnoklassniki%22:%20%7B%22message%22:%20%22Odnoklassniki%22%7D,%0A%20%22optionsMailru%22:%20%7B%22message%22:%20%22Moy%20Mir%22%7D,%0A%20%22optionsInstagram%22:%20%7B%22message%22:%20%22Instagram%22%7D,%0A%20%22optionsRutube%22:%20%7B%22message%22:%20%22Rutube%22%7D,%0A%20%22optionsBitrate%22:%20%7B%22message%22:%20%22Bitrate%20sofort%20zeigen%22%7D,%0A%20%22optionsSovetnikEnabled%22:%20%7B%22message%22:%20%22Advisor%22%7D,%0A%20%22optionsShowUmmyInfo%22:%20%7B%22message%22:%20%22Tipps%20f%C3%BCr%20UVD%20einblenden%22%7D,%0A%20%22optionsGmNativeDownload%22:%20%7B%22message%22:%20%22Erweiterter%20Download-Modus%22%7D,%0A%20%22optionsShowUmmyBtn%22:%20%7B%22message%22:%20%22Schaltfl%C3%A4che%20Ummy%20anzeigen%22%7D,%0A%20%22optionsShowMp3Btn%22:%20%7B%22message%22:%20%22Schaltfl%C3%A4che%20mp3%20anzeigen%22%7D,%0A%20%22optionsAviaBarEnabled%22:%20%7B%22message%22:%20%22Cheap%20Flights%20Advisor%22%7D,%0A%0A%20%22menuDownloadFromCurrentPage%22:%20%7B%22message%22:%20%22Laden%20Sie%20die%20Dateien%20mit%20SaveFrom.net%20von%20der%20aktuellen%20Seite%22%7D,%0A%20%22menuUpdateLinks%22:%20%7B%22message%22:%20%22Hier%20klicken,%20wenn%20die%20Download-Taste%20nicht%20erscheint%22%7D,%0A%20%22menuDownloadMP3Files%22:%20%7B%22message%22:%20%22Alle%20auf%20dieser%20Seite%20gefundenen%20Audiodateien%20herunterladen%22%7D,%0A%20%22menuDownloadPlaylist%22:%20%7B%22message%22:%20%22Playliste%20mit%20den%20Links%20zu%20den%20Audiodateien%20generieren%20und%20downloaden%22%7D,%0A%20%22menuDownloadPhotos%22:%20%7B%22message%22:%20%22Alle%20auf%20der%20aktuellen%20Seite%20gefundenen%20Bilder%20herunterladen%22%7D,%0A%20%22menuReportBug%22:%20%7B%22message%22:%20%22Schreiben%20Sie%20uns,%20wenn%20Probleme%20auftreten%22%7D,%0A%20%22menuShowOptions%22:%20%7B%22message%22:%20%22AN/AUS%20unterst%C3%BCtzte%20Ressourcen%20und%20Helperoptionen%22%7D,%0A%20%22menuEnableExtension%22:%20%7B%22message%22:%20%22%22%7D,%0A%20%22menuOpenPoll%22:%20%7B%22message%22:%20%22%22%7D,%0A%0A%20%22quality%22:%20%7B%22message%22:%20%22Qualit%C3%A4t%22%7D,%0A%20%22qualityNote%22:%20%7B%22message%22:%20%22Wenn%20es%20nicht%20um%20Qualit%C3%A4t%20geht,%20wird%20das%20n%C3%A4chste%20verf%C3%BCgbare%20Video%20heruntergeladen.%22%7D,%0A%20%22filelistTitle%22:%20%7B%22message%22:%20%22Die%20Liste%20der%20gefundenen%20dateien%22%7D,%0A%20%22filelistInstruction%22:%20%7B%22message%22:%20%22%5B'Zum%20Herunterladen%20aller%20datien%20kopieren%20Sie%20die%20liste%20der%20Links%20in%20Ihren%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'Download%20Manager'%7D%7D,'.%20Wenn%20Sie%20noch%20keinen%20Download%20Manager%20haben%20we%20empfehlen%20wir%20Ihnen%20die%20Installation%20des%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22playlistTitle%22:%20%7B%22message%22:%20%22Wiedergabliste%22%7D,%0A%20%22playlistInstruction%22:%20%7B%22message%22:%20%22Zur%20Wiedergabe%20Ihrer%20gespeicherten%20Wiedergabliste%20kann%20es%20nun%20mit%20einem%20Musik-Player%20ge%C3%B6ffnet%20werden.%22%7D,%0A%0A%20%22ummySfTitle%22:%20%7B%22message%22:%20%22HD%20oder%20MP3%22%7D,%0A%20%22ummyMenuItem%22:%20%7B%22message%22%20:%20%22%5B%7Bspan:%7B%7D%7D,'%20mithilfe%20von%20Ummy%20herunterladen'%5D%22%7D,%0A%20%22ummyMenuInfo%22:%20%7B%22message%22:%20%22%5B%7Bp:%7Btext:'Schnell%20und%20einfach%20HD%20Videos%20und%20MP3%20%C3%BCber%20Ummy%20Video%20Downloader%20herunterladen!'%7D%7D,%7Bp:%7Bclass:'center',append:%5B%7Ba:%7Bclass:'green-btn-2%20arrow',href:'%7Burl%7D',target:'_blank',text:'Jetzt%20installieren'%7D%7D%5D%7D%7D,%7Bp:%7Bappend:%5B'Nach%20der%20Installation%20startet%20jederzeit%20ein%20Download,%20wenn%20Sie%20auf%20',%7Bimg:%7Bsrc:'#'%7D%7D,'%20klicken'%5D%7D%7D%5D%22%7D,%0A%20%22warningPopupTitle%22:%20%7B%22message%22:%20%22%C3%9Cberpr%C3%BCfen%20Sie%20die%20Browsereinstellungen%22%7D,%0A%20%22warningPopupDesc%22:%20%7B%22message%22:%20%22Die%20Option%20%5C%22Jedes%20Mal%20nachfragen,%20wo%20eine%20Datei%20gespeichert%20werden%20soll%5C%22%20muss%20deaktiviert%20sein.%22%7D,%0A%20%22readMore%22:%20%7B%22message%22:%20%22Mehr%22%7D,%0A%20%22noWarning%22:%20%7B%22message%22:%20%22Nicht%20benachrichtigen%22%7D,%0A%20%22cancel%22:%20%7B%22message%22:%20%22Abbrechen%22%7D,%0A%20%22continue%22:%20%7B%22message%22:%20%22Fortsetzen%22%7D,%0A%20%22beforeDownloadPopupWarn%22:%20%7B%22message%22:%20%22Achtung!%20Der%20Download%20kann%20nicht%20abgebrochen%20oder%20angehalten%20werden.%22%7D,%0A%0A%20%22vkInfo%22:%20%7B%22message%22:%20%22Info%22%7D,%0A%20%22vkInfoTitle%22:%20%7B%22message%22:%20%22Dateigr%C3%B6%C3%9Fe%20und%20Bitrate%22%7D,%0A%20%22vkMp3LinksNotFound%22:%20%7B%22message%22:%20%22Links%20zu%20MP3%20Dateien%20wurden%20nicht%20gefunden%22%7D,%0A%20%22vkPhotoLinksNotFound%22:%20%7B%22message%22:%20%22Photos%20are%20not%20found%22%7D,%0A%20%22vkDownloadPhotoAlbum%22:%20%7B%22message%22:%20%22Album%20herunterladen%22%7D,%0A%20%22vkDownloadAllPhotoAlbums%22:%20%7B%22message%22:%20%22Alle%20Alben%20herunterladen%22%7D,%0A%20%22vkFoundPhotos%22:%20%7B%22message%22:%20%22Gefundene%20Fotos%22%7D,%0A%20%22vkNotAvailablePhotos%22:%20%7B%22message%22:%20%22%25d%20Foto(s)%20vor%C3%BCbergehend%20nicht%20verf%C3%BCgbar%22%7D,%0A%20%22vkFoundLinks%22:%20%7B%22message%22:%20%22Gefundene%20Links%22%7D,%0A%20%22vkFoundOf%22:%20%7B%22message%22:%20%22von%22%7D,%0A%20%22vkShowAs%22:%20%7B%22message%22:%20%22Zeigen%20als%22%7D,%0A%20%22vkListOfLinks%22:%20%7B%22message%22:%20%22Liste%20der%20Links%22%7D,%0A%20%22vkListOfLinksInstruction%22:%20%7B%22message%22:%20%22%5B'Um%20alle%20Fotos%20herunterzuladen,%20kopieren%20Sie%20die%20Links%20aus%20der%20Liste%20und%20f%C3%BCgen%20Sie%20diese%20in%20Ihren%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'Download%20Manager'%7D%7D,'%20ein.%20Wenn%20Sie%20noch%20keinen%20Download%20Manager%20haben%20we%20empfehlen%20wir%20Ihnen%20die%20Installation%20des%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22vkTableOfThumbnails%22:%20%7B%22message%22:%20%22Tabelle%20der%20Thumbnails%22%7D,%0A%20%22vkListOfPhotos%22:%20%7B%22message%22:%20%22Liste%20der%20Fotos%22%7D,%0A%20%22vkListOfPhotosInstruction%22:%20%7B%22message%22:%20%22Klicken%20Sie%20auf%20ein%20Foto%20um%20es%20herunterzuladen.%22%7D,%0A%20%22vkKbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22vkFileSizeByte%22:%20%7B%22message%22:%20%22B%22%7D,%0A%20%22vkFileSizeKByte%22:%20%7B%22message%22:%20%22kB%22%7D,%0A%20%22vkFileSizeMByte%22:%20%7B%22message%22:%20%22MB%22%7D,%0A%20%22vkFileSizeGByte%22:%20%7B%22message%22:%20%22GB%22%7D,%0A%20%22vkFileSizeTByte%22:%20%7B%22message%22:%20%22TB%22%7D,%0A%20%22vkDownloadFromYoutube%22:%20%7B%22message%22:%20%22%5B'Herunterladen:%20%C3%96ffnen%20Sie%20',%7Ba:%7Bhref:'%7Burl%7D',text:'die%20Video%20Seite'%7D%7D,'%20und%20dr%C3%BCcken%20Sie%20den%20%5C%22Herunterladen%5C%22%20Knopf%20%C3%BCber%20dem%20Video-Spieler'%5D%22%7D,%0A%20%22vkFoundFiles%22:%20%7B%22message%22:%20%22Dateien%20gefunden:%20%25d%22%7D,%0A%0A%20%22shareIn%22:%20%7B%22message%22:%20%22In%20%25w%20teilen%22%7D,%0A%20%22socialDesc%22:%20%7B%22message%22:%20%22Der%20SaveFrom.net%20Helper%20erm%C3%B6glicht%20es%20Ihnen%20Dateien%20YouTube.com,%20Facebook.com,%20VK.com%20und%20mehr%20als%2040%20andere%20Seiten%20mit%20einem%20Klick%20herunterzuladen%22%7D,%0A%0A%20%22tutorialS1Title%22:%20%7B%22message%22:%20%22Gute%20Nachrichten!%22%7D,%0A%20%22tutorialS1Main%22:%20%7B%22message%22:%20%22%5B'SaveFrom.net%20Helper%20',%7Bimg:%20%7Bsrc:%20'#logo'%7D%7D,'%20wurde%20erfolgreich%20installiert.%20Jetzt%20kannst%20due%20jedes%20Video%20mit%20einem%20Klick%20von%20YouTube%20herunterladen'%5D%22%7D,%0A%20%22tutorialS1Arrow%22:%20%7B%22message%22:%20%22%5B'Wie%20das%20geht?',%7Bbr:%7B%7D%7D,'Hier%20erf%C3%A4hrst%20du%20es'%5D%22%7D,%0A%20%22tutorialS2Main%22:%20%7B%22message%22:%20%22W%C3%A4hle%20das%20Format%20des%20Videos,%20das%20du%20herunterladen%20m%C3%B6chtest%20und%20klicken%20auf%20%5C%22Herunterladen%5C%22%22%7D,%0A%20%22tutorialS3History%22:%20%7B%22message%22:%20%22Historie%22%7D,%0A%20%22tutorialS3Main%22:%20%7B%22message%22:%20%22%5B'Du%20m%C3%B6chtest%20ein%20Video%20aus%20Historie%20herunterladen?%20Klicken%20einfach%20in%20der%20Vorschau%20des%20zuletzt%20gesehenen%20Videos%20auf%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D%5D%22%7D,%0A%20%22tutorialS4Main%22:%20%7B%22message%22:%20%22%5B'Du%20musst%20dir%20das%20Video%20nicht%20ansehen%20%E2%80%94%20klicke%20einfach%20auf%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20',%20w%C3%A4hle%20die%20Qualit%C3%A4t%20und%20lade%20es%20herunter.%20Ganz%20einfach,%20oder?'%5D%22%7D,%0A%20%22tutorialS5Title%22:%20%7B%22message%22:%20%22Viel%20Spa%C3%9F%20mit%20SaveFrom.net%20Helper!%22%7D,%0A%20%22tutorialS5Main%22:%20%7B%22message%22:%20%22%5B'Noch%20Fragen?%20Vorschl%C3%A4ge?%20Willkommen%20auf%20unserer%20',%20%7Ba:%20%7Btext:%20'Support-Seite',%20href:%20'#support'%7D%7D%20,'.%20Schlie%C3%9Fe%20dich%20uns%20bei%20',%20%7Ba:%20%7Btext:%20'Facebook',%20href:%20'#fb'%7D%7D%20,'%20an'%5D%22%7D,%0A%0A%20%22tutorialTooltipText%22:%20%7B%22message%22:%20%22%5B'Klicken%20Sie%20zum%20',%7Bb:%20%7Btext:%20'Download'%7D%7D,',%20einfach%20auf%20die%20Schaltfl%C3%A4che'%5D%22%7D,%0A%0A%20%22ummyTooltipConfirm%22:%20%7B%22message%22:%20%22%5B'Hatten%20Sie%20',%7Bimg:%7B%7D%7D,'%20Ummy%20Video%20Downloader%20bereits%20zuvor%20installiert?'%5D%22%7D,%0A%20%22yes%22:%20%7B%22message%22:%20%22Ja%22%7D,%0A%20%22no%22:%20%7B%22message%22:%20%22Nein%22%7D,%0A%20%22tooltipHide%22:%20%7B%22message%22:%20%22Diese%20Meldung%20nicht%20wieder%20anzeigen%22%7D%0A%7D";
  _languageList.en = "%7B%0A%20%22extName%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%22%7D,%0A%20%22extDescription%22:%20%7B%22message%22:%20%22Download%20YouTube,%20Facebook,%20VK.com%20and%2040+%20sites%20in%20one%20click.%22%7D,%0A%0A%20%22extNameLite%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%20lite%22%7D,%0A%20%22extDescriptionLite%22:%20%7B%22message%22:%20%22Download%20Facebook,%20VK.com%20and%2040+%20sites%20in%20one%20click.%22%7D,%0A%0A%20%22lang%22:%20%7B%22message%22:%20%22en%22%7D,%0A%0A%20%22titleDefault%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%22%7D,%0A%20%22titleDesabled%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%20disabled%22%7D,%0A%0A%20%22menuEnable%22:%20%7B%22message%22:%20%22Enable%22%7D,%0A%20%22menuDisable%22:%20%7B%22message%22:%20%22Disable%22%7D,%0A%0A%20%22showButton%22:%20%7B%22message%22:%20%22Show%20extension%20button%22%7D,%0A%0A%20%22copy%22:%20%7B%22message%22:%20%22Copy%22%7D,%0A%20%22download%22:%20%7B%22message%22:%20%22Download%22%7D,%0A%20%22downloadTitle%22:%20%7B%22message%22:%20%22Click%20the%20link%20while%20holding%20Alt/Option%20or%20Ctrl%20key%20to%20download%20the%20file.%22%7D,%0A%20%22noLinksFound%22:%20%7B%22message%22:%20%22No%20links%20were%20found%22%7D,%0A%20%22more%22:%20%7B%22message%22:%20%22More%22%7D,%0A%20%22close%22:%20%7B%22message%22:%20%22Close%22%7D,%0A%20%22kbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22withoutAudio%22:%20%7B%22message%22:%20%22without%20audio%22%7D,%0A%20%22size%22:%20%7B%22message%22:%20%22size%22%7D,%0A%0A%20%22subtitles%22:%20%7B%22message%22:%20%22Subtitles%22%7D,%0A%20%22playlist%22:%20%7B%22message%22:%20%22Playlist%22%7D,%0A%20%22filelist%22:%20%7B%22message%22:%20%22List%20of%20files%22%7D,%0A%20%22downloadWholePlaylist%22:%20%7B%22message%22:%20%22Download%20the%20whole%20playlist%22%7D,%0A%0A%20%22getFileSizeTitle%22:%20%7B%22message%22:%20%22Get%20file%20size%22%20%7D,%0A%20%22getFileSizeFailTitle%22:%20%7B%22message%22:%20%22Unable%20to%20get%20the%20file%20size.%20Please%20try%20again.%22%7D,%0A%0A%20%22lmButtonTitle%22:%20%7B%22message%22:%20%22Get%20a%20direct%20link%22%7D,%0A%0A%20%22downloadFromCurrentPage%22:%20%7B%22message%22:%20%22Go%20to%20SaveFrom.net%22%7D,%0A%20%22updateLinks%22:%20%7B%22message%22:%20%22Refresh%20links%22%7D,%0A%20%22updateLinksNotification%22:%20%7B%22message%22:%20%22Links%20updated%22%7D,%0A%20%22downloadMP3Files%22:%20%7B%22message%22:%20%22Download%20audio%20files%22%7D,%0A%20%22downloadPlaylist%22:%20%7B%22message%22:%20%22Download%20a%20playlist%22%7D,%0A%20%22downloadPhotos%22:%20%7B%22message%22:%20%22Download%20pictures%22%7D,%0A%20%22installFullVersion%22:%20%7B%22message%22:%20%22Install%20full%20version%22%7D,%0A%20%22disable%22:%20%7B%22message%22:%20%22Disable%22%7D,%0A%20%22showOptions%22:%20%7B%22message%22:%20%22Settings%22%7D,%0A%20%22reportBug%22:%20%7B%22message%22:%20%22Report%20a%20bug%22%7D,%0A%20%22openPoll%22:%20%7B%22message%22:%20%22Become%20better%22%7D,%0A%20%22disableModule%22:%20%7B%22message%22:%20%22Disable%20on%20this%20website%22%7D,%0A%20%22enableModule%22:%20%7B%22message%22:%20%22Enable%20on%20this%20website%22%7D,%0A%20%22enableDisableModule%22:%20%7B%22message%22:%20%22Turn%20On/Off%20on%20this%20website%22%7D,%0A%20%22showHideButton%22:%20%7B%22message%22:%20%22Show/hide%20extension%20button%22%7D,%0A%20%22updateTo%22:%20%7B%22message%22:%20%22Update%20to%20%25d%22%7D,%0A%0A%20%22aboutPage%22:%20%7B%22message%22:%20%22About%22%7D,%0A%20%22aboutTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%22%7D,%0A%20%22aboutVersion%22:%20%7B%22message%22:%20%22Version%22%7D,%0A%20%22aboutDescription%22:%20%7B%22message%22:%20%22Helps%20users%20to%20get%20direct%20links%20to%20download%20from%20more%20than%2040%20websites,%20including%20Dailymotion.com,%20YouTube.com,%20VK.com%20and%20others.%22%7D,%0A%20%22aboutDescriptionLite%22:%20%7B%22message%22:%20%22Helps%20users%20to%20get%20direct%20links%20to%20download%20from%20more%20than%2040%20websites,%20including%20Dailymotion.com,%20VK.com%20and%20others.%22%7D,%0A%20%22aboutSupported%22:%20%7B%22message%22:%20%22Supported%20resources%22%7D,%0A%20%22homePage%22:%20%7B%22message%22:%20%22Home%20page%22%7D,%0A%0A%20%22optionsTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%20-%20Preferences%22%7D,%0A%20%22optionsHandleLinks%22:%20%7B%22message%22:%20%22Handle%20links%22%7D,%0A%20%22optionsFileHostings%22:%20%7B%22message%22:%20%22To%20filehostings%22%7D,%0A%20%22optionsMediaHostings%22:%20%7B%22message%22:%20%22To%20mediahostings%22%7D,%0A%20%22optionsModules%22:%20%7B%22message%22:%20%22Modules%22%7D,%0A%20%22optionsYoutube%22:%20%7B%22message%22:%20%22YouTube%22%7D,%0A%20%22optionsYTHideLinks%22:%20%7B%22message%22:%20%22Hide%20links%22%7D,%0A%20%22optionsDailymotion%22:%20%7B%22message%22:%20%22Dailymotion%22%7D,%0A%20%22optionsVimeo%22:%20%7B%22message%22:%20%22Vimeo%22%7D,%0A%20%22optionsFacebook%22:%20%7B%22message%22:%20%22Facebook%22%7D,%0A%20%22optionsSoundcloud%22:%20%7B%22message%22:%20%22SoundCloud%22%7D,%0A%20%22optionsVkontakte%22:%20%7B%22message%22:%20%22VK%22%7D,%0A%20%22optionsOdnoklassniki%22:%20%7B%22message%22:%20%22Odnoklassniki%22%7D,%0A%20%22optionsMailru%22:%20%7B%22message%22:%20%22Moy%20Mir%22%7D,%0A%20%22optionsInstagram%22:%20%7B%22message%22:%20%22Instagram%22%7D,%0A%20%22optionsRutube%22:%20%7B%22message%22:%20%22Rutube%22%7D,%0A%20%22optionsBitrate%22:%20%7B%22message%22:%20%22Show%20bitrate%20instantly%22%7D,%0A%20%22optionsSovetnikEnabled%22:%20%7B%22message%22:%20%22Advisor%22%7D,%0A%20%22optionsShowUmmyInfo%22:%20%7B%22message%22:%20%22Show%20tips%20for%20Ummy%20Video%20Downloader%22%7D,%0A%20%22optionsGmNativeDownload%22:%20%7B%22message%22:%20%22Advanced%20download%20mode%22%7D,%0A%20%22optionsShowUmmyBtn%22:%20%7B%22message%22:%20%22Show%20the%20Ummy%20button%22%7D,%0A%20%22optionsShowMp3Btn%22:%20%7B%22message%22:%20%22Show%20the%20mp3%20button%22%7D,%0A%20%22optionsAviaBarEnabled%22:%20%7B%22message%22:%20%22Cheap%20Flights%20Advisor%22%7D,%0A%0A%20%22menuDownloadFromCurrentPage%22:%20%7B%22message%22:%20%22Download%20files%20from%20the%20current%20page%20using%20SaveFrom.net%22%7D,%0A%20%22menuUpdateLinks%22:%20%7B%22message%22:%20%22Press%20if%20Download%20button%20doesn't%20appear%22%7D,%0A%20%22menuDownloadMP3Files%22:%20%7B%22message%22:%20%22Download%20all%20audio%20files%20found%20on%20the%20current%20page%22%7D,%0A%20%22menuDownloadPlaylist%22:%20%7B%22message%22:%20%22Generates%20and%20downloads%20the%20playlist%20consisting%20of%20links%20to%20audio%20files%22%7D,%0A%20%22menuDownloadPhotos%22:%20%7B%22message%22:%20%22Download%20all%20pictures%20found%20on%20the%20current%20page%22%7D,%0A%20%22menuReportBug%22:%20%7B%22message%22:%20%22Let%20us%20know%20if%20you%20have%20any%20problems%22%7D,%0A%20%22menuShowOptions%22:%20%7B%22message%22:%20%22ON/OFF%20supported%20resources%20and%20Helper%20options%22%7D,%0A%20%22menuEnableExtension%22:%20%7B%22message%22:%20%22%22%7D,%0A%20%22menuOpenPoll%22:%20%7B%22message%22:%20%22We%20work%20hard%20to%20become%20better.%20Please,%20give%20us%20a%20hand!%22%7D,%0A%0A%20%22quality%22:%20%7B%22message%22:%20%22Quality%22%7D,%0A%20%22qualityNote%22:%20%7B%22message%22:%20%22The%20best%20available%20video%20will%20be%20downloaded%20If%20there%20is%20no%20chosen%20quality.%22%7D,%0A%20%22filelistTitle%22:%20%7B%22message%22:%20%22The%20list%20of%20the%20found%20files%22%7D,%0A%20%22filelistInstruction%22:%20%7B%22message%22:%20%22%5B'To%20download%20all%20files%20copy%20the%20list%20of%20links%20and%20paste%20it%20into%20the%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'download%20manager'%7D%7D,'.%20If%20you%20do%20not%20have%20a%20download%20manager%20installed%20we%20recommend%20installing%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22playlistTitle%22:%20%7B%22message%22:%20%22Playlist%22%7D,%0A%20%22playlistInstruction%22:%20%7B%22message%22:%20%22To%20playback%20the%20saved%20playlist%20it%20may%20be%20now%20opened%20in%20the%20music%20player.%22%7D,%0A%0A%20%22ummySfTitle%22:%20%7B%22message%22:%20%22HD%20or%20MP3%22%7D,%0A%20%22ummyMenuItem%22:%20%7B%22message%22%20:%20%22%5B%7Bspan:%7B%7D%7D,'%20via%20Ummy'%5D%22%7D,%0A%20%22ummyMenuInfo%22:%20%7B%22message%22:%20%22%5B%7Bp:%7Btext:'Fast%20and%20easy%20download%20HD%20videos%20and%20MP3%20via%20Ummy%20Video%20Downloader!'%7D%7D,%7Bp:%7Bclass:'center',append:%5B%7Ba:%7Bclass:'green-btn-2%20arrow',href:'%7Burl%7D',target:'_blank',text:'Install%20Now'%7D%7D%5D%7D%7D,%7Bp:%7Bappend:%5B'When%20installed,%20a%20download%20will%20start%20anytime%20you%20click%20on%20',%7Bimg:%7Bsrc:'#'%7D%7D%5D%7D%7D%5D%22%7D,%0A%20%22warningPopupTitle%22:%20%7B%22message%22:%20%22Check%20browser%20settings%22%7D,%0A%20%22warningPopupDesc%22:%20%7B%22message%22:%20%22The%20option%20%5C%22Always%20ask%20me%20where%20to%20save%20files%5C%22%20must%20be%20turned%20off.%22%7D,%0A%20%22readMore%22:%20%7B%22message%22:%20%22More%22%7D,%0A%20%22noWarning%22:%20%7B%22message%22:%20%22Don't%20notify%22%7D,%0A%20%22cancel%22:%20%7B%22message%22:%20%22Cancel%22%7D,%0A%20%22continue%22:%20%7B%22message%22:%20%22Continue%22%7D,%0A%20%22beforeDownloadPopupWarn%22:%20%7B%22message%22:%20%22Warning!%20Downloading%20cannot%20be%20canceled%20or%20suspended.%22%7D,%0A%0A%20%22vkInfo%22:%20%7B%22message%22:%20%22Info%22%7D,%0A%20%22vkInfoTitle%22:%20%7B%22message%22:%20%22File%20size%20and%20bitrate%22%7D,%0A%20%22vkMp3LinksNotFound%22:%20%7B%22message%22:%20%22Links%20to%20MP3%20files%20are%20not%20found%22%7D,%0A%20%22vkPhotoLinksNotFound%22:%20%7B%22message%22:%20%22Photos%20are%20not%20found%22%7D,%0A%20%22vkDownloadPhotoAlbum%22:%20%7B%22message%22:%20%22Download%20album%22%7D,%0A%20%22vkDownloadAllPhotoAlbums%22:%20%7B%22message%22:%20%22Download%20all%20albums%22%7D,%0A%20%22vkFoundPhotos%22:%20%7B%22message%22:%20%22Found%20photos%22%7D,%0A%20%22vkNotAvailablePhotos%22:%20%7B%22message%22:%20%22%25d%20photos%20are%20temporarily%20unavailable%22%7D,%0A%20%22vkFoundLinks%22:%20%7B%22message%22:%20%22Found%20links%22%7D,%0A%20%22vkFoundOf%22:%20%7B%22message%22:%20%22of%22%7D,%0A%20%22vkShowAs%22:%20%7B%22message%22:%20%22Show%20as%22%7D,%0A%20%22vkListOfLinks%22:%20%7B%22message%22:%20%22List%20of%20links%22%7D,%0A%20%22vkListOfLinksInstruction%22:%20%7B%22message%22:%20%22%5B'To%20download%20all%20photos%20copy%20the%20list%20of%20links%20and%20paste%20it%20into%20the%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'download%20manager'%7D%7D,'.%20If%20you%20do%20not%20have%20a%20download%20manager%20installed%20we%20recommend%20installing%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22vkTableOfThumbnails%22:%20%7B%22message%22:%20%22Table%20of%20thumbnails%22%7D,%0A%20%22vkListOfPhotos%22:%20%7B%22message%22:%20%22List%20of%20photos%22%7D,%0A%20%22vkListOfPhotosInstruction%22:%20%7B%22message%22:%20%22Click%20on%20the%20photo%20to%20download%20it.%22%7D,%0A%20%22vkKbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22vkFileSizeByte%22:%20%7B%22message%22:%20%22B%22%7D,%0A%20%22vkFileSizeKByte%22:%20%7B%22message%22:%20%22kB%22%7D,%0A%20%22vkFileSizeMByte%22:%20%7B%22message%22:%20%22MB%22%7D,%0A%20%22vkFileSizeGByte%22:%20%7B%22message%22:%20%22GB%22%7D,%0A%20%22vkFileSizeTByte%22:%20%7B%22message%22:%20%22TB%22%7D,%0A%20%22vkDownloadFromYoutube%22:%20%7B%22message%22:%20%22%5B'Download:%20open%20',%7Ba:%7Bhref:'%7Burl%7D',text:'the%20video%20page'%7D%7D,'%20and%20press%20the%20%5C%22Download%5C%22%20button%20above%20the%20player'%5D%22%7D,%0A%20%22vkFoundFiles%22:%20%7B%22message%22:%20%22Files%20found:%20%25d%22%7D,%0A%0A%20%22shareIn%22:%20%7B%22message%22:%20%22Share%20on%20%25w%22%7D,%0A%20%22socialDesc%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%20enables%20you%20to%20download%20files%20from%20YouTube.com,%20Facebook.com,%20VK.com%20and%20more%20than%2040%20other%20just%20in%20one%20click%20for%20free%22%7D,%0A%0A%20%22tutorialS1Title%22:%20%7B%22message%22:%20%22Good%20news!%22%7D,%0A%20%22tutorialS1Main%22:%20%7B%22message%22:%20%22%5B'SaveFrom.net%20Helper%20',%7Bimg:%20%7Bsrc:%20'#logo'%7D%7D,'%20has%20been%20successfully%20installed%20and%20now%20you%20can%20download%20any%20video%20from%20YouTube%20in%20one%20click'%5D%22%7D,%0A%20%22tutorialS1Arrow%22:%20%7B%22message%22:%20%22%5B'Want%20to%20know%20how?',%7Bbr:%7B%7D%7D,'Click%20here'%5D%22%7D,%0A%20%22tutorialS2Main%22:%20%7B%22message%22:%20%22To%20download%20a%20video%20choose%20a%20format%20and%20click%20the%20%5C%22Download%5C%22%20button%22%7D,%0A%20%22tutorialS3History%22:%20%7B%22message%22:%20%22History%22%7D,%0A%20%22tutorialS3Main%22:%20%7B%22message%22:%20%22%5B'Do%20you%20want%20to%20download%20a%20video%20from%20History?',%7Bbr:%7B%7D%7D,'Just%20click%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,'%20on%20the%20preview%20of%20the%20previously%20watched%20video'%5D%22%7D,%0A%20%22tutorialS4Main%22:%20%7B%22message%22:%20%22%5B'No%20need%20to%20watch%20a%20video%20%E2%80%94%20just%20click%20on%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,',%20choose%20the%20quality,%20and%20download.%20Quite%20easy,%20isn%E2%80%99t%20it?'%5D%22%7D,%0A%20%22tutorialS5Title%22:%20%7B%22message%22:%20%22Enjoy%20SaveFrom.net%20Helper!%22%7D,%0A%20%22tutorialS5Main%22:%20%7B%22message%22:%20%22%5B'Still%20have%20questions?%20Want%20to%20share%20your%20ideas?%20Welcome%20to%20',%7Ba:%20%7Btext:%20'our%20support%20page',%20href:%20'#support'%7D%7D,'%20or%20join%20us%20on%20',%20%7Ba:%20%7Btext:%20'Facebook',%20href:%20'#fb'%7D%7D%5D%22%7D,%0A%0A%20%22tutorialTooltipText%22:%20%7B%22message%22:%20%22%5B'Just%20click%20the%20button%20to%20',%7Bb:%20%7Btext:%20'download'%7D%7D%5D%22%7D,%0A%0A%20%22ummyTooltipConfirm%22:%20%7B%22message%22:%20%22%5B'Have%20you%20already%20installed',%7Bbr:%7B%7D%7D,%7Bimg:%7B%7D%7D,'%20Ummy%20Video%20Downloader%20earlier?'%5D%22%7D,%0A%20%22yes%22:%20%7B%22message%22:%20%22Yes%22%7D,%0A%20%22no%22:%20%7B%22message%22:%20%22No%22%7D,%0A%20%22tooltipHide%22:%20%7B%22message%22:%20%22Do%20not%20show%20this%20message%20again%22%7D%0A%7D";
  _languageList.es = "%7B%0A%20%22extName%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%22%7D,%0A%20%22extDescription%22:%20%7B%22message%22:%20%22Descargas%20desde%20YouTube,%20Facebook,%20VK.com%20y%2040+%20sitios%20en%20un%20s%C3%B3lo%20clic.%22%7D,%0A%0A%20%22extNameLite%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%20lite%22%7D,%0A%20%22extDescriptionLite%22:%20%7B%22message%22:%20%22Descargas%20desde%20Facebook,%20VK.com%20y%2040+%20sitios%20en%20un%20s%C3%B3lo%20clic.%22%7D,%0A%0A%20%22lang%22:%20%7B%22message%22:%20%22es%22%7D,%0A%0A%20%22titleDefault%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%22%7D,%0A%20%22titleDesabled%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%20deshabilitado%22%7D,%0A%0A%20%22menuEnable%22:%20%7B%22message%22:%20%22Habilitar%22%7D,%0A%20%22menuDisable%22:%20%7B%22message%22:%20%22Deshabilitar%22%7D,%0A%0A%20%22showButton%22:%20%7B%22message%22:%20%22Mostrar%20bot%C3%B3n%20de%20extensi%C3%B3n%22%7D,%0A%0A%20%22copy%22:%20%7B%22message%22:%20%22Copiar%22%7D,%0A%20%22download%22:%20%7B%22message%22:%20%22Descargar%22%7D,%0A%20%22downloadTitle%22:%20%7B%22message%22:%20%22Haga%20clic%20en%20el%20enlace%20mientras%20presiona%20la%20tecla%20Alt/Opci%C3%B3n%20o%20Ctrl%20para%20descargar%20el%20archivo.%22%7D,%0A%20%22noLinksFound%22:%20%7B%22message%22:%20%22No%20se%20han%20encontrado%20enlaces%22%7D,%0A%20%22more%22:%20%7B%22message%22:%20%22M%C3%A1s%22%7D,%0A%20%22close%22:%20%7B%22message%22:%20%22Cerrar%22%7D,%0A%20%22kbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22withoutAudio%22:%20%7B%22message%22:%20%22sin%20audio%22%7D,%0A%20%22size%22:%20%7B%22message%22:%20%22tama%C3%B1o%22%7D,%0A%0A%20%22subtitles%22:%20%7B%22message%22:%20%22Subt%C3%ADtulos%22%7D,%0A%20%22playlist%22:%20%7B%22message%22:%20%22Lista%20de%20reproducci%C3%B3n%22%7D,%0A%20%22filelist%22:%20%7B%22message%22:%20%22Lista%20de%20archivos%22%7D,%0A%20%22downloadWholePlaylist%22:%20%7B%22message%22:%20%22Descargar%20toda%20la%20lista%20de%20reproducci%C3%B3n%22%7D,%0A%0A%20%22getFileSizeTitle%22:%20%7B%22message%22:%20%22Obtener%20tama%C3%B1o%20de%20archivo%22%20%7D,%0A%20%22getFileSizeFailTitle%22:%20%7B%22message%22:%20%22No%20se%20pudo%20obtener%20el%20tama%C3%B1o%20del%20archivo.%20Por%20favor,%20int%C3%A9ntelo%20de%20nuevo.%22%7D,%0A%0A%20%22lmButtonTitle%22:%20%7B%22message%22:%20%22Obtener%20un%20enlace%20directo%22%7D,%0A%0A%20%22downloadFromCurrentPage%22:%20%7B%22message%22:%20%22Ir%20a%20SaveFrom.net%22%7D,%0A%20%22updateLinks%22:%20%7B%22message%22:%20%22Actualizar%20enlaces%22%7D,%0A%20%22updateLinksNotification%22:%20%7B%22message%22:%20%22Enlaces%20actualizados%22%7D,%0A%20%22downloadMP3Files%22:%20%7B%22message%22:%20%22Descargar%20archivos%20de%20audio%22%7D,%0A%20%22downloadPlaylist%22:%20%7B%22message%22:%20%22Descargar%20una%20lista%20de%20reproducci%C3%B3n%22%7D,%0A%20%22downloadPhotos%22:%20%7B%22message%22:%20%22Descargar%20im%C3%A1genes%22%7D,%0A%20%22installFullVersion%22:%20%7B%22message%22:%20%22Instalar%20la%20versi%C3%B3n%20completa%22%7D,%0A%20%22disable%22:%20%7B%22message%22:%20%22Deshabilitar%22%7D,%0A%20%22showOptions%22:%20%7B%22message%22:%20%22Ajustes%22%7D,%0A%20%22reportBug%22:%20%7B%22message%22:%20%22Informar%20sobre%20un%20problema%22%7D,%0A%20%22openPoll%22:%20%7B%22message%22:%20%22Mejorar%22%7D,%0A%20%22disableModule%22:%20%7B%22message%22:%20%22Desactivar%20en%20este%20sitio%20web%22%7D,%0A%20%22enableModule%22:%20%7B%22message%22:%20%22Activar%20en%20este%20sitio%20web%22%7D,%0A%20%22enableDisableModule%22:%20%7B%22message%22:%20%22Activ./Desactiv.%20en%20esta%20web%22%7D,%0A%20%22showHideButton%22:%20%7B%22message%22:%20%22Mostrar/ocultar%20bot%C3%B3n%20extens%22%7D,%0A%20%22updateTo%22:%20%7B%22message%22:%20%22Actualizar%20a%20la%20%25d%22%7D,%0A%0A%20%22aboutPage%22:%20%7B%22message%22:%20%22Acerca%20de%22%7D,%0A%20%22aboutTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%22%7D,%0A%20%22aboutVersion%22:%20%7B%22message%22:%20%22Versi%C3%B3n%22%7D,%0A%20%22aboutDescription%22:%20%7B%22message%22:%20%22Ayuda%20a%20los%20usuarios%20a%20obtener%20enlaces%20directos%20para%20descargar%20desde%20m%C3%A1s%20de%2040%20sitios%20web,%20incluidos%20Dailymotion.com,%20YouTube.com,%20VK.com%20y%20otros.%22%7D,%0A%20%22aboutDescriptionLite%22:%20%7B%22message%22:%20%22Ayuda%20a%20los%20usuarios%20a%20obtener%20enlaces%20directos%20para%20descargar%20desde%20m%C3%A1s%20de%2040%20sitios%20web,%20incluidos%20Dailymotion.com,%20VK.com%20y%20otros.%22%7D,%0A%20%22aboutSupported%22:%20%7B%22message%22:%20%22Recursos%20admitidos%22%7D,%0A%20%22homePage%22:%20%7B%22message%22:%20%22P%C3%A1gina%20de%20inicio%22%7D,%0A%0A%20%22optionsTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%20-%20Preferencias%22%7D,%0A%20%22optionsHandleLinks%22:%20%7B%22message%22:%20%22Manejar%20enlaces%22%7D,%0A%20%22optionsFileHostings%22:%20%7B%22message%22:%20%22A%20servidores%20de%20archivos%22%7D,%0A%20%22optionsMediaHostings%22:%20%7B%22message%22:%20%22A%20servidores%20multimedia%22%7D,%0A%20%22optionsModules%22:%20%7B%22message%22:%20%22M%C3%B3dulos%22%7D,%0A%20%22optionsYoutube%22:%20%7B%22message%22:%20%22YouTube%22%7D,%0A%20%22optionsYTHideLinks%22:%20%7B%22message%22:%20%22Ocultar%20enlaces%22%7D,%0A%20%22optionsDailymotion%22:%20%7B%22message%22:%20%22Dailymotion%22%7D,%0A%20%22optionsVimeo%22:%20%7B%22message%22:%20%22Vimeo%22%7D,%0A%20%22optionsFacebook%22:%20%7B%22message%22:%20%22Facebook%22%7D,%0A%20%22optionsSoundcloud%22:%20%7B%22message%22:%20%22SoundCloud%22%7D,%0A%20%22optionsVkontakte%22:%20%7B%22message%22:%20%22VK%22%7D,%0A%20%22optionsOdnoklassniki%22:%20%7B%22message%22:%20%22Odnoklassniki%22%7D,%0A%20%22optionsMailru%22:%20%7B%22message%22:%20%22Moy%20Mir%22%7D,%0A%20%22optionsInstagram%22:%20%7B%22message%22:%20%22Instagram%22%7D,%0A%20%22optionsRutube%22:%20%7B%22message%22:%20%22Rutube%22%7D,%0A%20%22optionsBitrate%22:%20%7B%22message%22:%20%22Mostrar%20velocidad%20de%20bits%20instant%C3%A1neamente%22%7D,%0A%20%22optionsSovetnikEnabled%22:%20%7B%22message%22:%20%22Consejero%22%7D,%0A%20%22optionsShowUmmyInfo%22:%20%7B%22message%22:%20%22Muestra%20consejos%20para%20Ummy%20Video%20Downloader%22%7D,%0A%20%22optionsGmNativeDownload%22:%20%7B%22message%22:%20%22M%C3%B3udlo%20de%20descarga%20avanzada%22%7D,%0A%20%22optionsShowUmmyBtn%22:%20%7B%22message%22:%20%22Mostrar%20el%20bot%C3%B3n%20Ummy%22%7D,%0A%20%22optionsShowMp3Btn%22:%20%7B%22message%22:%20%22Mostrar%20el%20bot%C3%B3n%20mp3%22%7D,%0A%20%22optionsAviaBarEnabled%22:%20%7B%22message%22:%20%22Cheap%20Flights%20Advisor%22%7D,%0A%0A%20%22menuDownloadFromCurrentPage%22:%20%7B%22message%22:%20%22Descargar%20archivos%20de%20la%20p%C3%A1gina%20actual%20usando%20SaveFrom.net%22%7D,%0A%20%22menuUpdateLinks%22:%20%7B%22message%22:%20%22Pulse%20si%20no%20aparece%20el%20bot%C3%B3n%20Descargar%22%7D,%0A%20%22menuDownloadMP3Files%22:%20%7B%22message%22:%20%22Descargar%20todos%20los%20archivos%20de%20audio%20de%20la%20p%C3%A1gina%20actual%22%7D,%0A%20%22menuDownloadPlaylist%22:%20%7B%22message%22:%20%22Genera%20y%20descarga%20la%20lista%20de%20reproducci%C3%B3n%20que%20consiste%20en%20enlaces%20a%20archivos%20de%20audio%22%7D,%0A%20%22menuDownloadPhotos%22:%20%7B%22message%22:%20%22Descargar%20todas%20las%20im%C3%A1genes%20encontradas%20en%20la%20p%C3%A1gina%20actual%22%7D,%0A%20%22menuReportBug%22:%20%7B%22message%22:%20%22H%C3%A1ganos%20saber%20si%20tiene%20alg%C3%BAn%20problema%22%7D,%0A%20%22menuShowOptions%22:%20%7B%22message%22:%20%22ACTIVAR/DESACTIVAR%20recursos%20admitidos%20y%20opciones%20del%20Helper%22%7D,%0A%20%22menuEnableExtension%22:%20%7B%22message%22:%20%22%22%7D,%0A%20%22menuOpenPoll%22:%20%7B%22message%22:%20%22Trabajamos%20duro%20para%20mejorar.%20%C2%A1%C3%89chenos%20una%20mano!%22%7D,%0A%0A%20%22quality%22:%20%7B%22message%22:%20%22Calidad%22%7D,%0A%20%22qualityNote%22:%20%7B%22message%22:%20%22Si%20no%20se%20elige%20ninguna%20calidad,%20se%20descargar%C3%A1%20el%20mejor%20v%C3%ADdeo%20disponible.%22%7D,%0A%20%22filelistTitle%22:%20%7B%22message%22:%20%22La%20lista%20de%20los%20archivos%20encontrados%22%7D,%0A%20%22filelistInstruction%22:%20%7B%22message%22:%20%22%5B'Para%20descargar%20todos%20los%20archivos,%20copie%20la%20lista%20de%20enlaces%20y%20p%C3%A9guela%20en%20el%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'gestor%20de%20descargas'%7D%7D,'.%20Si%20no%20tiene%20instalado%20un%20gestor%20de%20descargas,%20le%20recomendamos%20que%20instale%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22playlistTitle%22:%20%7B%22message%22:%20%22Lista%20de%20reproducci%C3%B3n%22%7D,%0A%20%22playlistInstruction%22:%20%7B%22message%22:%20%22Para%20reproducir%20la%20lista%20de%20reproducci%C3%B3n%20guardada,%20puede%20abrirla%20ahora%20en%20el%20reproductor%20de%20m%C3%BAsica.%22%7D,%0A%0A%20%22ummySfTitle%22:%20%7B%22message%22:%20%22HD%20o%20MP3%22%7D,%0A%20%22ummyMenuItem%22:%20%7B%22message%22%20:%20%22%5B%7Bspan:%7B%7D%7D,'%20via%20Ummy'%5D%22%7D,%0A%20%22ummyMenuInfo%22:%20%7B%22message%22:%20%22%5B%7Bp:%7Btext:'Instale%20Ummy%20Video%20Downloader%20y%20descargue%20sus%20v%C3%ADdeos%20favoritos%20en%20HD%20o%20MP3.'%7D%7D,%7Bp:%7Bclass:'center',append:%5B%7Ba:%7Bclass:'green-btn-2%20arrow',href:'%7Burl%7D',target:'_blank',text:'Descargar'%7D%7D%5D%7D%7D,%7Bp:%7Bappend:%5B'Despu%C3%A9s%20de%20la%20instalaci%C3%B3n,%20se%20iniciar%C3%A1%20una%20descarga%20autom%C3%A1ticamente%20siempre%20que%20haga%20clic%20en%20',%7Bimg:%7Bsrc:'#'%7D%7D%5D%7D%7D%5D%22%7D,%0A%20%22warningPopupTitle%22:%20%7B%22message%22:%20%22Compruebe%20la%20configuraci%C3%B3n%20de%20su%20navegador%22%7D,%0A%20%22warningPopupDesc%22:%20%7B%22message%22:%20%22La%20opci%C3%B3n%20%5C%22Preguntarme%20siempre%20d%C3%B3nde%20guardar%20los%20archivos%5C%22%20debe%20estar%20desactivada.%22%7D,%0A%20%22readMore%22:%20%7B%22message%22:%20%22M%C3%A1s%22%7D,%0A%20%22noWarning%22:%20%7B%22message%22:%20%22No%20notificar%22%7D,%0A%20%22cancel%22:%20%7B%22message%22:%20%22Cancelar%22%7D,%0A%20%22continue%22:%20%7B%22message%22:%20%22Continuar%22%7D,%0A%20%22beforeDownloadPopupWarn%22:%20%7B%22message%22:%20%22%C2%A1Advertencia!%20La%20descarga%20no%20se%20puede%20cancelar%20o%20suspender.%22%7D,%0A%0A%20%22vkInfo%22:%20%7B%22message%22:%20%22Informaci%C3%B3n%22%7D,%0A%20%22vkInfoTitle%22:%20%7B%22message%22:%20%22Tama%C3%B1o%20de%20archivo%20y%20velocidad%20de%20bits%22%7D,%0A%20%22vkMp3LinksNotFound%22:%20%7B%22message%22:%20%22No%20se%20han%20encontrado%20enlaces%20a%20archivos%20MP3%22%7D,%0A%20%22vkPhotoLinksNotFound%22:%20%7B%22message%22:%20%22No%20se%20han%20encontrado%20im%C3%A1genes%22%7D,%0A%20%22vkDownloadPhotoAlbum%22:%20%7B%22message%22:%20%22Descargar%20%C3%A1lbum%22%7D,%0A%20%22vkDownloadAllPhotoAlbums%22:%20%7B%22message%22:%20%22Descargar%20todos%20los%20%C3%A1lbums%22%7D,%0A%20%22vkFoundPhotos%22:%20%7B%22message%22:%20%22Im%C3%A1genes%20encontradas%22%7D,%0A%20%22vkNotAvailablePhotos%22:%20%7B%22message%22:%20%22%25d%20im%C3%A1genes%20est%C3%A1n%20temporalmente%20no%20disponibles%22%7D,%0A%20%22vkFoundLinks%22:%20%7B%22message%22:%20%22Enlaces%20encontrados%22%7D,%0A%20%22vkFoundOf%22:%20%7B%22message%22:%20%22de%22%7D,%0A%20%22vkShowAs%22:%20%7B%22message%22:%20%22Mostrar%20como%22%7D,%0A%20%22vkListOfLinks%22:%20%7B%22message%22:%20%22Lista%20de%20enlaces%22%7D,%0A%20%22vkListOfLinksInstruction%22:%20%7B%22message%22:%20%22%5B'Para%20descargar%20todas%20las%20im%C3%A1genes,%20copie%20la%20lista%20de%20enlaces%20y%20p%C3%A9guela%20en%20el%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'gestor%20de%20descargas'%7D%7D,'.%20Si%20no%20tiene%20instalado%20un%20gestor%20de%20descargas,%20le%20recomendamos%20que%20instale%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22vkTableOfThumbnails%22:%20%7B%22message%22:%20%22Tabla%20de%20miniaturas%22%7D,%0A%20%22vkListOfPhotos%22:%20%7B%22message%22:%20%22Lista%20de%20im%C3%A1genes%22%7D,%0A%20%22vkListOfPhotosInstruction%22:%20%7B%22message%22:%20%22Haga%20clic%20en%20la%20imagen%20para%20descargarla.%22%7D,%0A%20%22vkKbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22vkFileSizeByte%22:%20%7B%22message%22:%20%22B%22%7D,%0A%20%22vkFileSizeKByte%22:%20%7B%22message%22:%20%22kB%22%7D,%0A%20%22vkFileSizeMByte%22:%20%7B%22message%22:%20%22MB%22%7D,%0A%20%22vkFileSizeGByte%22:%20%7B%22message%22:%20%22GB%22%7D,%0A%20%22vkFileSizeTByte%22:%20%7B%22message%22:%20%22TB%22%7D,%0A%20%22vkDownloadFromYoutube%22:%20%7B%22message%22:%20%22%5B'Descargar:%20abra%20',%7Ba:%7Bhref:'%7Burl%7D',text:'la%20p%C3%A1gina%20del%20v%C3%ADdeo'%7D%7D,'%20y%20pulse%20el%20bot%C3%B3n%20%5C%22Descargar%5C%22%20sobre%20el%20reproductor'%5D%22%7D,%0A%20%22vkFoundFiles%22:%20%7B%22message%22:%20%22Archivos%20encontrados:%20%25d%22%7D,%0A%0A%20%22shareIn%22:%20%7B%22message%22:%20%22Compartir%20en%20%25w%22%7D,%0A%20%22socialDesc%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%20le%20permite%20descargar%20archivos%20desde%20YouTube.com,%20Facebook.com,%20VK.com%20y%20m%C3%A1s%20de%2040%20sitios%20distintos%20con%20tan%20s%C3%B3lo%20un%20clic%20y%20gratis%22%7D,%0A%0A%20%22tutorialS1Title%22:%20%7B%22message%22:%20%22%C2%A1Excelentes%20noticias!%22%7D,%0A%20%22tutorialS1Main%22:%20%7B%22message%22:%20%22%5B'SaveFrom.net%20Helper%20',%7Bimg:%20%7Bsrc:%20'#logo'%7D%7D,%20'%20se%20instal%C3%B3%20con%20%C3%A9xito%20y%20ahora%20puedes%20descargar%20cualquier%20video%20de%20YouTube%20con%20un%20solo%20clic'%5D%22%7D,%0A%20%22tutorialS1Arrow%22:%20%7B%22message%22:%20%22%5B'%C2%BFQuieres%20saber%20c%C3%B3mo?',%20%7Bbr:%7B%7D%7D,%20'Haz%20clic%20aqu%C3%AD'%5D%22%7D,%0A%20%22tutorialS2Main%22:%20%7B%22message%22:%20%22Para%20descargar%20un%20video,%20elige%20el%20formato%20y%20haz%20clic%20en%20el%20bot%C3%B3n%20%5C%22Descargar%5C%22%22%7D,%0A%20%22tutorialS3History%22:%20%7B%22message%22:%20%22Historial%22%7D,%0A%20%22tutorialS3Main%22:%20%7B%22message%22:%20%22%5B'%C2%BFDeseas%20descargar%20un%20video%20del%20Historial?',%20%7Bbr:%7B%7D%7D,%20'Simplemente%20haz%20clic%20en%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20'%20en%20la%20vista%20previa%20del%20video%20visto%20anteriormente.'%5D%22%7D,%0A%20%22tutorialS4Main%22:%20%7B%22message%22:%20%22%5B'No%20es%20necesario%20mirar%20un%20video:%20simplemente%20haz%20clic%20en%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20',%20elige%20la%20calidad%20y%20desc%C3%A1rgalo.%20F%C3%A1cil,%20%C2%BFverdad?'%5D%22%7D,%0A%20%22tutorialS5Title%22:%20%7B%22message%22:%20%22%C2%A1Disfruta%20de%20SaveForm.net%20Helper!%22%7D,%0A%20%22tutorialS5Main%22:%20%7B%22message%22:%20%22%5B'%C2%BFTodav%C3%ADa%20tienes%20preguntas?%20%C2%BFQuieres%20compartir%20tus%20ideas?%20Puedes%20ir%20a%20nuestra%20',%7Ba:%20%7Btext:%20'p%C3%A1gina%20de%20soporte',%20href:%20'#support'%7D%7D,'%20o%20unirte%20a%20nosotros%20en%20',%20%7Ba:%20%7Btext:%20'Facebook',%20href:%20'#fb'%7D%7D%5D%22%7D,%0A%0A%20%22tutorialTooltipText%22:%20%7B%22message%22:%20%22%5B'Simplemente%20haz%20clic%20en%20el%20bot%C3%B3n%20para%20',%7Bb:%20%7Btext:%20'descargar'%7D%7D%5D%22%7D,%0A%0A%20%22ummyTooltipConfirm%22:%20%7B%22message%22:%20%22%5B'%C2%BFYa%20has%20instalado',%7Bbr:%7B%7D%7D,%7Bimg:%7B%7D%7D,'%20Ummy%20Video%20Downloader%20antes?'%5D%22%7D,%0A%20%22yes%22:%20%7B%22message%22:%20%22S%C3%AD%22%7D,%0A%20%22no%22:%20%7B%22message%22:%20%22No%22%7D,%0A%20%22tooltipHide%22:%20%7B%22message%22:%20%22No%20mostrar%20de%20nuevo%20este%20mensaje%22%7D%0A%7D";
  _languageList.fr = "%7B%0A%20%22extName%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%22%7D,%0A%20%22extDescription%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9chargez%20YouTube,%20Facebook,%20VK.com%20et%2040+%20sites%20en%20un%20seul%20clic.%22%7D,%0A%0A%20%22extNameLite%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%20lite%22%7D,%0A%20%22extDescriptionLite%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9chargez%20Facebook,%20VK.com%20et%2040+%20sites%20en%20un%20seul%20clic.%22%7D,%0A%0A%20%22lang%22:%20%7B%22message%22:%20%22fr%22%7D,%0A%0A%20%22titleDefault%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%22%7D,%0A%20%22titleDesabled%22:%20%7B%22message%22:%20%22Assistant%20SaveFrom.net%20d%C3%A9sactiv%C3%A9%22%7D,%0A%0A%20%22menuEnable%22:%20%7B%22message%22:%20%22Activer%22%7D,%0A%20%22menuDisable%22:%20%7B%22message%22:%20%22D%C3%A9sactiver%22%7D,%0A%0A%20%22showButton%22:%20%7B%22message%22:%20%22Afficher%20le%20bouton%20d'extension%22%7D,%0A%0A%20%22copy%22:%20%7B%22message%22:%20%22Copier%22%7D,%0A%20%22download%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%22%7D,%0A%20%22downloadTitle%22:%20%7B%22message%22:%20%22Cliquer%20sur%20le%20lien%20tout%20en%20maintenant%20la%20touche%20Alt/Option%20ou%20Ctrl%20pour%20t%C3%A9l%C3%A9charger%20le%20fichier.%22%7D,%0A%20%22noLinksFound%22:%20%7B%22message%22:%20%22Aucun%20lien%20n'a%20%C3%A9t%C3%A9%20trouv%C3%A9%22%7D,%0A%20%22more%22:%20%7B%22message%22:%20%22Plus%22%7D,%0A%20%22close%22:%20%7B%22message%22:%20%22Fermer%22%7D,%0A%20%22kbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22withoutAudio%22:%20%7B%22message%22:%20%22sans%20audio%22%7D,%0A%20%22size%22:%20%7B%22message%22:%20%22taille%22%7D,%0A%0A%20%22subtitles%22:%20%7B%22message%22:%20%22Sous-titres%22%7D,%0A%20%22playlist%22:%20%7B%22message%22:%20%22Playlist%22%7D,%0A%20%22filelist%22:%20%7B%22message%22:%20%22Liste%20de%20fichiers%22%7D,%0A%20%22downloadWholePlaylist%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%20toute%20la%20playlist%22%7D,%0A%0A%20%22getFileSizeTitle%22:%20%7B%22message%22:%20%22Obtenir%20la%20taille%20du%20fichier%22%20%7D,%0A%20%22getFileSizeFailTitle%22:%20%7B%22message%22:%20%22Impossible%20d'obtenir%20la%20taille%20du%20fichier.%20Veuillez%20r%C3%A9essayer.%22%7D,%0A%0A%20%22lmButtonTitle%22:%20%7B%22message%22:%20%22Obtenir%20un%20lien%20direct%22%7D,%0A%0A%20%22downloadFromCurrentPage%22:%20%7B%22message%22:%20%22Aller%20%C3%A0%20SaveFrom.net%22%7D,%0A%20%22updateLinks%22:%20%7B%22message%22:%20%22Rafra%C3%AEchir%20les%20liens%22%7D,%0A%20%22updateLinksNotification%22:%20%7B%22message%22:%20%22Liens%20mis%20%C3%A0%20jour%22%7D,%0A%20%22downloadMP3Files%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%20les%20fichiers%20audio%22%7D,%0A%20%22downloadPlaylist%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%20une%20playlist%22%7D,%0A%20%22downloadPhotos%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%20les%20images%22%7D,%0A%20%22installFullVersion%22:%20%7B%22message%22:%20%22Installer%20la%20version%20compl%C3%A8te%22%7D,%0A%20%22disable%22:%20%7B%22message%22:%20%22D%C3%A9sactiver%22%7D,%0A%20%22showOptions%22:%20%7B%22message%22:%20%22Param%C3%A8tres%22%7D,%0A%20%22reportBug%22:%20%7B%22message%22:%20%22Signaler%20un%20bug%22%7D,%0A%20%22openPoll%22:%20%7B%22message%22:%20%22Am%C3%A9liorer%22%7D,%0A%20%22disableModule%22:%20%7B%22message%22:%20%22D%C3%A9sactiver%20sur%20ce%20site%22%7D,%0A%20%22enableModule%22:%20%7B%22message%22:%20%22Activer%20sur%20ce%20site%22%7D,%0A%20%22enableDisableModule%22:%20%7B%22message%22:%20%22Activer%20On/Off%20sur%20ce%20site%20web%22%7D,%0A%20%22showHideButton%22:%20%7B%22message%22:%20%22Afficher/masquer%20le%20bouton%20d'extension%22%7D,%0A%20%22updateTo%22:%20%7B%22message%22:%20%22Passer%20%C3%A0%20la%20version%20%25d%22%7D,%0A%0A%20%22aboutPage%22:%20%7B%22message%22:%20%22%C3%80%20propos%22%7D,%0A%20%22aboutTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%22%7D,%0A%20%22aboutVersion%22:%20%7B%22message%22:%20%22Version%22%7D,%0A%20%22aboutDescription%22:%20%7B%22message%22:%20%22Aide%20les%20utilisateurs%20%C3%A0%20obtenir%20des%20liens%20directs%20pour%20t%C3%A9l%C3%A9charger%20depuis%20plus%20de%2040%20sites%20web,%20y%20compris%20Dailymotion.com,%20YouTube.com,%20VK.com%20et%20d'autres.%22%7D,%0A%20%22aboutDescriptionLite%22:%20%7B%22message%22:%20%22Aide%20les%20utilisateurs%20%C3%A0%20obtenir%20des%20liens%20directs%20pour%20t%C3%A9l%C3%A9charger%20depuis%20plus%20de%2040%20sites%20web,%20y%20compris%20Dailymotion.com,%20VK.com%20et%20d'autres.%22%7D,%0A%20%22aboutSupported%22:%20%7B%22message%22:%20%22Ressources%20prises%20en%20charge%22%7D,%0A%20%22homePage%22:%20%7B%22message%22:%20%22Page%20d'accueil%22%7D,%0A%0A%20%22optionsTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper%20-%20Pr%C3%A9f%C3%A9rences%22%7D,%0A%20%22optionsHandleLinks%22:%20%7B%22message%22:%20%22manipuler%20les%20liens%22%7D,%0A%20%22optionsFileHostings%22:%20%7B%22message%22:%20%22Vers%20l'h%C3%A9bergement%20de%20fichiers%22%7D,%0A%20%22optionsMediaHostings%22:%20%7B%22message%22:%20%22Vers%20l'h%C3%A9bergement%20de%20m%C3%A9dias%22%7D,%0A%20%22optionsModules%22:%20%7B%22message%22:%20%22Modules%22%7D,%0A%20%22optionsYoutube%22:%20%7B%22message%22:%20%22YouTube%22%7D,%0A%20%22optionsYTHideLinks%22:%20%7B%22message%22:%20%22Masquer%20les%20liens%22%7D,%0A%20%22optionsDailymotion%22:%20%7B%22message%22:%20%22Dailymotion%22%7D,%0A%20%22optionsVimeo%22:%20%7B%22message%22:%20%22Vimeo%22%7D,%0A%20%22optionsFacebook%22:%20%7B%22message%22:%20%22Facebook%22%7D,%0A%20%22optionsSoundcloud%22:%20%7B%22message%22:%20%22SoundCloud%22%7D,%0A%20%22optionsVkontakte%22:%20%7B%22message%22:%20%22VK%22%7D,%0A%20%22optionsOdnoklassniki%22:%20%7B%22message%22:%20%22Odnoklassniki%22%7D,%0A%20%22optionsMailru%22:%20%7B%22message%22:%20%22Moy%20Mir%22%7D,%0A%20%22optionsInstagram%22:%20%7B%22message%22:%20%22Instagram%22%7D,%0A%20%22optionsRutube%22:%20%7B%22message%22:%20%22Rutube%22%7D,%0A%20%22optionsBitrate%22:%20%7B%22message%22:%20%22Afficher%20instantan%C3%A9ment%20le%20bitrate%22%7D,%0A%20%22optionsSovetnikEnabled%22:%20%7B%22message%22:%20%22Advisor%22%7D,%0A%20%22optionsShowUmmyInfo%22:%20%7B%22message%22:%20%22Afficher%20les%20astuces%20pour%20Ummy%20Video%20Downloader%22%7D,%0A%20%22optionsGmNativeDownload%22:%20%7B%22message%22:%20%22Mode%20de%20t%C3%A9l%C3%A9chargement%20avanc%C3%A9%22%7D,%0A%20%22optionsShowUmmyBtn%22:%20%7B%22message%22:%20%22Montrer%20le%20bouton%20Ummy%22%7D,%0A%20%22optionsShowMp3Btn%22:%20%7B%22message%22:%20%22Montrer%20le%20bouton%20mp3%22%7D,%0A%20%22optionsAviaBarEnabled%22:%20%7B%22message%22:%20%22Cheap%20Flights%20Advisor%22%7D,%0A%0A%20%22menuDownloadFromCurrentPage%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9chargement%20des%20fichiers%20depuis%20la%20page%20actuelle%20en%20utilisant%20SaveFrom.net%22%7D,%0A%20%22menuUpdateLinks%22:%20%7B%22message%22:%20%22Appuyez%20si%20le%20bouton%20T%C3%A9l%C3%A9charger%20n'appara%C3%AEt%20pas%22%7D,%0A%20%22menuDownloadMP3Files%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%20tous%20les%20fichiers%20audio%20trouv%C3%A9s%20sur%20la%20page%20actuelle%22%7D,%0A%20%22menuDownloadPlaylist%22:%20%7B%22message%22:%20%22G%C3%A9n%C3%A8re%20et%20t%C3%A9l%C3%A9charge%20la%20playlist%20consistant%20en%20liens%20vers%20les%20fichiers%20audio%22%7D,%0A%20%22menuDownloadPhotos%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%20toutes%20les%20images%20trouv%C3%A9es%20sur%20la%20page%20actuelle%22%7D,%0A%20%22menuReportBug%22:%20%7B%22message%22:%20%22Pr%C3%A9venez-nous%20si%20vous%20avez%20des%20probl%C3%A8mes%22%7D,%0A%20%22menuShowOptions%22:%20%7B%22message%22:%20%22ON/OFF%20ressources%20prises%20en%20charge%20et%20options%20Helper%22%7D,%0A%20%22menuEnableExtension%22:%20%7B%22message%22:%20%22%22%7D,%0A%20%22menuOpenPoll%22:%20%7B%22message%22:%20%22Nous%20faisons%20tout%20pour%20nous%20am%C3%A9liorer.%20N'h%C3%A9sitez%20pas%20%C3%A0%20nous%20aider%20!%22%7D,%0A%0A%20%22quality%22:%20%7B%22message%22:%20%22Qualit%C3%A9%22%7D,%0A%20%22qualityNote%22:%20%7B%22message%22:%20%22La%20meilleure%20vid%C3%A9o%20disponible%20sera%20t%C3%A9l%C3%A9charg%C3%A9e%20s'il%20n'y%20a%20pas%20de%20qualit%C3%A9%20choisie.%22%7D,%0A%20%22filelistTitle%22:%20%7B%22message%22:%20%22La%20liste%20des%20fichiers%20trouv%C3%A9s%22%7D,%0A%20%22filelistInstruction%22:%20%7B%22message%22:%20%22%5B'Pour%20t%C3%A9l%C3%A9charger%20tous%20les%20fichiers%20copiez%20la%20liste%20des%20liens%20et%20collez-la%20dans%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'download%20manager'%7D%7D,'.%20Si%20vous%20n%5C%5C'avez%20pas%20install%C3%A9%20de%20gestionnaire%20de%20t%C3%A9l%C3%A9chargement,%20nous%20vous%20recommandons%20d%5C%5C'installer%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22playlistTitle%22:%20%7B%22message%22:%20%22Playlist%22%7D,%0A%20%22playlistInstruction%22:%20%7B%22message%22:%20%22Pour%20lire%20la%20playlist%20sauvegard%C3%A9e,%20ouvrez-la%20dans%20le%20lecteur%20musical.%22%7D,%0A%0A%20%22ummySfTitle%22:%20%7B%22message%22:%20%22HD%20ou%20MP3%22%7D,%0A%20%22ummyMenuItem%22:%20%7B%22message%22%20:%20%22%5B%7Bspan:%7B%7D%7D,'%20via%20Ummy'%5D%22%7D,%0A%20%22ummyMenuInfo%22:%20%7B%22message%22:%20%22%5B%7Bp:%7Btext:'Installez%20Ummy%20Video%20Downloader%20et%20t%C3%A9l%C3%A9chargez%20vos%20vid%C3%A9os%20favorites%20en%20HD%20ou%20MP3.'%7D%7D,%7Bp:%7Bclass:'center',append:%5B%7Ba:%7Bclass:'green-btn-2%20arrow',href:'%7Burl%7D',target:'_blank',text:'Download'%7D%7D%5D%7D%7D,%7Bp:%7Bappend:%5B'Apr%C3%A8s%20l%5C%5C'installation,%20un%20t%C3%A9l%C3%A9chargement%20d%C3%A9marrera%20automatiquement%20d%C3%A8s%20que%20vous%20cliquez%20sur%20',%7Bimg:%7Bsrc:'#'%7D%7D%5D%7D%7D%5D%22%7D,%0A%20%22warningPopupTitle%22:%20%7B%22message%22:%20%22V%C3%A9rifier%20les%20param%C3%A8tres%20du%20navigateur%22%7D,%0A%20%22warningPopupDesc%22:%20%7B%22message%22:%20%22L'option%20%5C%22Toujours%20me%20demander%20o%C3%B9%20sauvegarder%20les%20fichiers%5C%22%20doit%20%C3%AAtre%20d%C3%A9sactiv%C3%A9e.%22%7D,%0A%20%22readMore%22:%20%7B%22message%22:%20%22Plus%22%7D,%0A%20%22noWarning%22:%20%7B%22message%22:%20%22ne%20pas%20notifier'%22%7D,%0A%20%22cancel%22:%20%7B%22message%22:%20%22Annuler%22%7D,%0A%20%22continue%22:%20%7B%22message%22:%20%22Continuer%22%7D,%0A%20%22beforeDownloadPopupWarn%22:%20%7B%22message%22:%20%22Attention!%20Le%20t%C3%A9l%C3%A9chargement%20ne%20peut%20pas%20%C3%AAtre%20annul%C3%A9%20ou%20suspendu.%22%7D,%0A%0A%20%22vkInfo%22:%20%7B%22message%22:%20%22Info%22%7D,%0A%20%22vkInfoTitle%22:%20%7B%22message%22:%20%22Taille%20de%20fichier%20et%20bitrate%22%7D,%0A%20%22vkMp3LinksNotFound%22:%20%7B%22message%22:%20%22Les%20liens%20vers%20les%20fichiers%20MP3%20sont%20introuvables%22%7D,%0A%20%22vkPhotoLinksNotFound%22:%20%7B%22message%22:%20%22Photos%20introuvables%22%7D,%0A%20%22vkDownloadPhotoAlbum%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%20l'album%22%7D,%0A%20%22vkDownloadAllPhotoAlbums%22:%20%7B%22message%22:%20%22T%C3%A9l%C3%A9charger%20tous%20les%20albums%22%7D,%0A%20%22vkFoundPhotos%22:%20%7B%22message%22:%20%22Photos%20trouv%C3%A9es%22%7D,%0A%20%22vkNotAvailablePhotos%22:%20%7B%22message%22:%20%22%25d%20photos%20sont%20temporairement%20indisponibles%22%7D,%0A%20%22vkFoundLinks%22:%20%7B%22message%22:%20%22Liens%20trouv%C3%A9s%22%7D,%0A%20%22vkFoundOf%22:%20%7B%22message%22:%20%22de%22%7D,%0A%20%22vkShowAs%22:%20%7B%22message%22:%20%22Afficher%20comme%22%7D,%0A%20%22vkListOfLinks%22:%20%7B%22message%22:%20%22Liste%20des%20liens%22%7D,%0A%20%22vkListOfLinksInstruction%22:%20%7B%22message%22:%20%22%5B'Pour%20t%C3%A9l%C3%A9charger%20toutes%20les%20photos%20copiez%20la%20liste%20des%20liens%20et%20collez-la%20dans%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'download%20manager'%7D%7D,'.%20Si%20vous%20n%5C%5C'avez%20pas%20install%C3%A9%20de%20gestionnaire%20de%20t%C3%A9l%C3%A9chargement%20nous%20vous%20recommandons%20d%5C%5C'installer%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22vkTableOfThumbnails%22:%20%7B%22message%22:%20%22Tableau%20des%20vignettes%22%7D,%0A%20%22vkListOfPhotos%22:%20%7B%22message%22:%20%22Liste%20des%20photos%22%7D,%0A%20%22vkListOfPhotosInstruction%22:%20%7B%22message%22:%20%22Cliquez%20sur%20la%20photo%20pour%20la%20t%C3%A9l%C3%A9charger.%22%7D,%0A%20%22vkKbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22vkFileSizeByte%22:%20%7B%22message%22:%20%22O%22%7D,%0A%20%22vkFileSizeKByte%22:%20%7B%22message%22:%20%22ko%22%7D,%0A%20%22vkFileSizeMByte%22:%20%7B%22message%22:%20%22Mo%22%7D,%0A%20%22vkFileSizeGByte%22:%20%7B%22message%22:%20%22Go%22%7D,%0A%20%22vkFileSizeTByte%22:%20%7B%22message%22:%20%22To%22%7D,%0A%20%22vkDownloadFromYoutube%22:%20%7B%22message%22:%20%22%5B'Download:%20open%20',%7Ba:%7Bhref:'%7Burl%7D',text:'the%20video%20page'%7D%7D,'%20et%20appuyez%20sur%20le%20bouton%20%5C%22T%C3%A9l%C3%A9charger%5C%22%20au-dessus%20du%20lecteur'%5D%22%7D,%0A%20%22vkFoundFiles%22:%20%7B%22message%22:%20%22Fichiers%20trouv%C3%A9s%20:%20%25d%22%7D,%0A%0A%20%22shareIn%22:%20%7B%22message%22:%20%22Partager%20sur%20%25w%22%7D,%0A%20%22socialDesc%22:%20%7B%22message%22:%20%22SaveFrom.net%20helper%20vous%20permet%20de%20t%C3%A9l%C3%A9charger%20des%20fichiers%20de%20YouTube.com,%20Facebook.com,%20VK.com%20et%20plus%20de%2040%20autres%20gratuitement%20et%20en%20un%20seul%20clic%22%7D,%0A%0A%20%22tutorialS1Title%22:%20%7B%22message%22:%20%22Bonnes%20nouvelles%20!%22%7D,%0A%20%22tutorialS1Main%22:%20%7B%22message%22:%20%22%5B'SaveFrom.net%20Helper%20',%7Bimg:%20%7Bsrc:%20'#logo'%7D%7D,%20'%20a%20%C3%A9t%C3%A9%20install%C3%A9%20avec%20succ%C3%A8s%20et%20maintenant%20vous%20pouvez%20t%C3%A9l%C3%A9charger%20les%20vid%C3%A9os%20de%20YouTube%20en%20un%20clic'%5D%22%7D,%0A%20%22tutorialS1Arrow%22:%20%7B%22message%22:%20%22%5B'Vous%20voulez%20savoir%20comment%20?%20Cliquez%20ici'%5D%22%7D,%0A%20%22tutorialS2Main%22:%20%7B%22message%22:%20%22Pour%20t%C3%A9l%C3%A9charger%20une%20vid%C3%A9o,%20choisissez%20un%20format%20et%20cliquez%20sur%20le%20bouton%20%5C%22T%C3%A9l%C3%A9charger%5C%22%22%7D,%0A%20%22tutorialS3History%22:%20%7B%22message%22:%20%22Historique%22%7D,%0A%20%22tutorialS3Main%22:%20%7B%22message%22:%20%22%5B'Voulez-vous%20t%C3%A9l%C3%A9charger%20une%20vid%C3%A9o%20depuis%20l%E2%80%99historique%20?',%20%7Bbr:%7B%7D%7D,%20'Il%20suffit%20de%20cliquer%20sur%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20'%20situ%C3%A9e%20sur%20l%5C%5C'aper%C3%A7u%20de%20la%20vid%C3%A9o%20pr%C3%A9c%C3%A9demment%20regard%C3%A9e'%5D%22%7D,%0A%20%22tutorialS4Main%22:%20%7B%22message%22:%20%22%5B'Pas%20besoin%20de%20regarder%20une%20vid%C3%A9o%20%E2%80%94%20il%20suffit%20de%20cliquer%20sur%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20',%20faites%20le%20choix%20de%20la%20qualit%C3%A9,%20et%20t%C3%A9l%C3%A9charger.%20Facile,%20est-ce%20pas%20?'%5D%22%7D,%0A%20%22tutorialS5Title%22:%20%7B%22message%22:%20%22Profitez%20de%20SaveFrom.net%20Helper%20!%22%7D,%0A%20%22tutorialS5Main%22:%20%7B%22message%22:%20%22%5B'Vous%20avez%20encore%20des%20questions%20?%20Vous%20voulez%20partager%20vos%20id%C3%A9es%20?%20Bienvenue%20sur%20notre%20page%20',%7Ba:%20%7Btext:%20'de%20d%E2%80%99Aide',%20href:%20'#support'%7D%7D,'%20ou%20rejoignez-nous%20sur%20',%20%7Ba:%20%7Btext:%20'Facebook',%20href:%20'#fb'%7D%7D%5D%22%7D,%0A%0A%20%22tutorialTooltipText%22:%20%7B%22message%22:%20%22%5B'Il%20suffit%20de%20cliquer%20sur%20le%20bouton%20pour%20',%7Bb:%20%7Btext:%20't%C3%A9l%C3%A9charger'%7D%7D%5D%22%7D,%0A%0A%20%22ummyTooltipConfirm%22:%20%7B%22message%22:%20%22%5B'Avez-vous%20d%C3%A9j%C3%A0%20install%C3%A9',%7Bbr:%7B%7D%7D,%7Bimg:%7B%7D%7D,'%20Ummy%20Video%20Downloader%20avant%20?'%5D%22%7D,%0A%20%22yes%22:%20%7B%22message%22:%20%22Oui%22%7D,%0A%20%22no%22:%20%7B%22message%22:%20%22Non%22%7D,%0A%20%22tooltipHide%22:%20%7B%22message%22:%20%22Ne%20plus%20afficher%20ce%20message%22%7D%0A%7D";
  _languageList.id = "%7B%0A%20%22extName%22:%20%7B%22message%22:%20%22Bantuan%20SaveFrom.net%22%7D,%0A%20%22extDescription%22:%20%7B%22message%22:%20%22Unduh%20YouTube,%20Facebook,%20VK.com,%20dan%2040+%20situs%20dengan%20satu%20klik.%22%7D,%0A%0A%20%22extNameLite%22:%20%7B%22message%22:%20%22Bantuan%20SaveFrom.net%20lite%22%7D,%0A%20%22extDescriptionLite%22:%20%7B%22message%22:%20%22Unduh%20Facebook,%20VK.com,%20dan%2040+%20situs%20dengan%20satu%20klik.%22%7D,%0A%0A%20%22lang%22:%20%7B%22message%22:%20%22id%22%7D,%0A%0A%20%22titleDefault%22:%20%7B%22message%22:%20%22Bantuan%20SaveFrom.net%22%7D,%0A%20%22titleDesabled%22:%20%7B%22message%22:%20%22Bantuan%20SaveFrom.net%20nonaktif%22%7D,%0A%0A%20%22menuEnable%22:%20%7B%22message%22:%20%22Aktifkan%22%7D,%0A%20%22menuDisable%22:%20%7B%22message%22:%20%22Nonaktifkan%22%7D,%0A%0A%20%22showButton%22:%20%7B%22message%22:%20%22Tampilkan%20tombol%20ekstensi%22%7D,%0A%0A%20%22copy%22:%20%7B%22message%22:%20%22Salin%22%7D,%0A%20%22download%22:%20%7B%22message%22:%20%22Unduh%22%7D,%0A%20%22downloadTitle%22:%20%7B%22message%22:%20%22Klik%20tautan%20sambil%20menahan%20tombol%20Alt/Option%20atau%20Ctrl%20untuk%20mengunduh%20file.%22%7D,%0A%20%22noLinksFound%22:%20%7B%22message%22:%20%22Tautan%20tidak%20ditemukan%22%7D,%0A%20%22more%22:%20%7B%22message%22:%20%22Lainnya%22%7D,%0A%20%22close%22:%20%7B%22message%22:%20%22Tutup%22%7D,%0A%20%22kbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22withoutAudio%22:%20%7B%22message%22:%20%22tanpa%20audio%22%7D,%0A%20%22size%22:%20%7B%22message%22:%20%22ukuran%22%7D,%0A%0A%20%22subtitles%22:%20%7B%22message%22:%20%22Subtitel%22%7D,%0A%20%22playlist%22:%20%7B%22message%22:%20%22Daftar%20putar%22%7D,%0A%20%22filelist%22:%20%7B%22message%22:%20%22Daftar%20file%22%7D,%0A%20%22downloadWholePlaylist%22:%20%7B%22message%22:%20%22Unduh%20seluruh%20daftar%20putar%22%7D,%0A%0A%20%22getFileSizeTitle%22:%20%7B%22message%22:%20%22Dapatkan%20ukuran%20file%22%20%7D,%0A%20%22getFileSizeFailTitle%22:%20%7B%22message%22:%20%22Gagal%20mendapatkan%20ukuran%20file.%20Mohon%20coba%20lagi.%22%7D,%0A%0A%20%22lmButtonTitle%22:%20%7B%22message%22:%20%22Dapatkan%20tautan%20langsung%22%7D,%0A%0A%20%22downloadFromCurrentPage%22:%20%7B%22message%22:%20%22Buka%20SaveFrom.net%22%7D,%0A%20%22updateLinks%22:%20%7B%22message%22:%20%22Segarkan%20tautan%22%7D,%0A%20%22updateLinksNotification%22:%20%7B%22message%22:%20%22Tautan%20diperbarui%22%7D,%0A%20%22downloadMP3Files%22:%20%7B%22message%22:%20%22Unduh%20file%20audio%22%7D,%0A%20%22downloadPlaylist%22:%20%7B%22message%22:%20%22Unduh%20daftar%20putar%22%7D,%0A%20%22downloadPhotos%22:%20%7B%22message%22:%20%22Unduh%20gambar%22%7D,%0A%20%22installFullVersion%22:%20%7B%22message%22:%20%22Pasang%20versi%20lengkap%22%7D,%0A%20%22disable%22:%20%7B%22message%22:%20%22Nonaktifkan%22%7D,%0A%20%22showOptions%22:%20%7B%22message%22:%20%22Setelan%22%7D,%0A%20%22reportBug%22:%20%7B%22message%22:%20%22Laporkan%20bug%22%7D,%0A%20%22openPoll%22:%20%7B%22message%22:%20%22Jadikan%20lebih%20baik%22%7D,%0A%20%22disableModule%22:%20%7B%22message%22:%20%22Nonaktifkan%20di%20situs%20web%20ini%22%7D,%0A%20%22enableModule%22:%20%7B%22message%22:%20%22Aktifkan%20di%20situs%20web%20ini%22%7D,%0A%20%22enableDisableModule%22:%20%7B%22message%22:%20%22Nyalakan/Matikan%20di%20situs%20ini%22%7D,%0A%20%22showHideButton%22:%20%7B%22message%22:%20%22Tampilkan/tutup%20tbl%20ekstensi%22%7D,%0A%20%22updateTo%22:%20%7B%22message%22:%20%22Perbarui%20ke%20%25d%22%7D,%0A%0A%20%22aboutPage%22:%20%7B%22message%22:%20%22Tentang%22%7D,%0A%20%22aboutTitle%22:%20%7B%22message%22:%20%22Bantuan%20SaveFrom.net%22%7D,%0A%20%22aboutVersion%22:%20%7B%22message%22:%20%22Versi%22%7D,%0A%20%22aboutDescription%22:%20%7B%22message%22:%20%22Membantu%20pengguna%20mendapatkan%20tautan%20langsung%20dari%2040+%20situs%20web,%20termasuk%20Dailymotion.com,%20YouTube.com,%20VK.com%20dan%20lain-lain.%22%7D,%0A%20%22aboutDescriptionLite%22:%20%7B%22message%22:%20%22Membantu%20pengguna%20mendapatkan%20tautan%20langsung%20untuk%20mengunduh%20dari%2040+%20situs%20web,%20termasuk%20Dailymotion.com,%20VK.com%20dan%20lain-lain.%22%7D,%0A%20%22aboutSupported%22:%20%7B%22message%22:%20%22Sumber%20daya%20yang%20didukung%22%7D,%0A%20%22homePage%22:%20%7B%22message%22:%20%22Laman%20beranda%22%7D,%0A%0A%20%22optionsTitle%22:%20%7B%22message%22:%20%22Bantuan%20SaveFrom.net%20-%20Preferensi%22%7D,%0A%20%22optionsHandleLinks%22:%20%7B%22message%22:%20%22Tangani%20tautan%22%7D,%0A%20%22optionsFileHostings%22:%20%7B%22message%22:%20%22Ke%20filehosting%22%7D,%0A%20%22optionsMediaHostings%22:%20%7B%22message%22:%20%22Ke%20mediahosting%22%7D,%0A%20%22optionsModules%22:%20%7B%22message%22:%20%22Modul%22%7D,%0A%20%22optionsYoutube%22:%20%7B%22message%22:%20%22YouTube%22%7D,%0A%20%22optionsYTHideLinks%22:%20%7B%22message%22:%20%22Sembunyikan%20tautan%22%7D,%0A%20%22optionsDailymotion%22:%20%7B%22message%22:%20%22Dailymotion%22%7D,%0A%20%22optionsVimeo%22:%20%7B%22message%22:%20%22Vimeo%22%7D,%0A%20%22optionsFacebook%22:%20%7B%22message%22:%20%22Facebook%22%7D,%0A%20%22optionsSoundcloud%22:%20%7B%22message%22:%20%22SoundCloud%22%7D,%0A%20%22optionsVkontakte%22:%20%7B%22message%22:%20%22VK%22%7D,%0A%20%22optionsOdnoklassniki%22:%20%7B%22message%22:%20%22Odnoklassniki%22%7D,%0A%20%22optionsMailru%22:%20%7B%22message%22:%20%22Moy%20Mir%22%7D,%0A%20%22optionsInstagram%22:%20%7B%22message%22:%20%22Instagram%22%7D,%0A%20%22optionsRutube%22:%20%7B%22message%22:%20%22Rutube%22%7D,%0A%20%22optionsBitrate%22:%20%7B%22message%22:%20%22Langsung%20tampilkan%20bitrate%22%7D,%0A%20%22optionsSovetnikEnabled%22:%20%7B%22message%22:%20%22Penasihat%22%7D,%0A%20%22optionsShowUmmyInfo%22:%20%7B%22message%22:%20%22Tampilkan%20tips%20untuk%20Ummy%20Video%20Downloader%22%7D,%0A%20%22optionsGmNativeDownload%22:%20%7B%22message%22:%20%22Mode%20unduh%20lanjutan%22%7D,%0A%20%22optionsShowUmmyBtn%22:%20%7B%22message%22:%20%22Perlihatkan%20tombol%20Ummy%22%7D,%0A%20%22optionsShowMp3Btn%22:%20%7B%22message%22:%20%22Perlihatkan%20tombol%20mp3%22%7D,%0A%20%22optionsAviaBarEnabled%22:%20%7B%22message%22:%20%22Cheap%20Flights%20Advisor%22%7D,%0A%0A%20%22menuDownloadFromCurrentPage%22:%20%7B%22message%22:%20%22Unduh%20file%20dari%20laman%20saat%20ini%20dengan%20SaveFrom.net%22%7D,%0A%20%22menuUpdateLinks%22:%20%7B%22message%22:%20%22Tekan%20jika%20tombol%20Unduh%20tidak%20muncul%22%7D,%0A%20%22menuDownloadMP3Files%22:%20%7B%22message%22:%20%22Unduh%20semua%20file%20audio%20yang%20ada%20di%20laman%20saat%20ini%22%7D,%0A%20%22menuDownloadPlaylist%22:%20%7B%22message%22:%20%22Buat%20dan%20unduh%20daftar%20putar%20berisi%20tautan%20ke%20file%20audio%22%7D,%0A%20%22menuDownloadPhotos%22:%20%7B%22message%22:%20%22Unduh%20semua%20gambar%20yang%20ada%20di%20laman%20saat%20ini%22%7D,%0A%20%22menuReportBug%22:%20%7B%22message%22:%20%22Beri%20tahu%20kami%20jika%20Anda%20mengalami%20masalah%22%7D,%0A%20%22menuShowOptions%22:%20%7B%22message%22:%20%22AKTIFKAN/NONAKTIFKAN%20sumber%20daya%20yang%20didukung%20dan%20opsi%20Bantuan%22%7D,%0A%20%22menuEnableExtension%22:%20%7B%22message%22:%20%22%22%7D,%0A%20%22menuOpenPoll%22:%20%7B%22message%22:%20%22Kami%20bekerja%20keras%20untuk%20jadi%20lebih%20baik.%20Tolong,%20bantu%20kami!%22%7D,%0A%0A%20%22quality%22:%20%7B%22message%22:%20%22Kualitas%22%7D,%0A%20%22qualityNote%22:%20%7B%22message%22:%20%22Video%20terbaik%20yang%20tersedia%20akan%20diunduh%20jika%20tidak%20ada%20kualitas%20yang%20dipilih.%22%7D,%0A%20%22filelistTitle%22:%20%7B%22message%22:%20%22Daftar%20file%20yang%20ditemukan%22%7D,%0A%20%22filelistInstruction%22:%20%7B%22message%22:%20%22%5B'Untuk%20mengunduh%20semua%20file,%20salin%20daftar%20tautan%20dan%20tempelkan%20ke%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'pengelola%20unduhan'%7D%7D,'.%20Jika%20Anda%20tidak%20memiliki%20pengelola%20unduhan,%20kami%20menyarankan%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22playlistTitle%22:%20%7B%22message%22:%20%22Daftar%20putar%22%7D,%0A%20%22playlistInstruction%22:%20%7B%22message%22:%20%22Untuk%20memutar%20daftar%20putar%20yang%20disimpan,%20sekarang%20bisa%20dibuka%20di%20pemutar%20musik.%22%7D,%0A%0A%20%22ummySfTitle%22:%20%7B%22message%22:%20%22HD%20atau%20MP3%22%7D,%0A%20%22ummyMenuItem%22:%20%7B%22message%22%20:%20%22%5B%7Bspan:%7B%7D%7D,'%20via%20Ummy'%5D%22%7D,%0A%20%22ummyMenuInfo%22:%20%7B%22message%22:%20%22%5B%7Bp:%7Btext:'Pasang%20Ummy%20Video%20Downloader%20%20dan%20unduh%20video%20favorit%20Anda%20dalam%20format%20HD%20atau%20MP3.'%7D%7D,%7Bp:%7Bclass:'center',append:%5B%7Ba:%7Bclass:'green-btn-2%20arrow',href:'%7Burl%7D',target:'_blank',text:'Unduh'%7D%7D%5D%7D%7D,%7Bp:%7Bappend:%5B'Setelah%20pemasangan,%20unduhan%20akan%20otomatis%20dimulai%20setiap%20kali%20Anda%20mengeklik%20',%7Bimg:%7Bsrc:'#'%7D%7D%5D%7D%7D%5D%22%7D,%0A%20%22warningPopupTitle%22:%20%7B%22message%22:%20%22Periksa%20setelan%20browser%22%7D,%0A%20%22warningPopupDesc%22:%20%7B%22message%22:%20%22Opsi%20%5C%22Selalu%20tanya%20saya%20di%20mana%20menyimpan%20file%5C%22%20harus%20dinonaktifkan.%22%7D,%0A%20%22readMore%22:%20%7B%22message%22:%20%22Lainnya%22%7D,%0A%20%22noWarning%22:%20%7B%22message%22:%20%22Jangan%20beri%20tahu%22%7D,%0A%20%22cancel%22:%20%7B%22message%22:%20%22Batal%22%7D,%0A%20%22continue%22:%20%7B%22message%22:%20%22Lanjutkan%22%7D,%0A%20%22beforeDownloadPopupWarn%22:%20%7B%22message%22:%20%22Perhatian!%20Pengunduhan%20tidak%20dapat%20dibatalkan%20atau%20ditunda.%22%7D,%0A%0A%20%22vkInfo%22:%20%7B%22message%22:%20%22Info%22%7D,%0A%20%22vkInfoTitle%22:%20%7B%22message%22:%20%22Ukuran%20file%20dan%20bitrate%22%7D,%0A%20%22vkMp3LinksNotFound%22:%20%7B%22message%22:%20%22Tautan%20atau%20file%20MP3%20tidak%20ditemukan%22%7D,%0A%20%22vkPhotoLinksNotFound%22:%20%7B%22message%22:%20%22Foto%20tidak%20ditemukan%22%7D,%0A%20%22vkDownloadPhotoAlbum%22:%20%7B%22message%22:%20%22Unduh%20album%22%7D,%0A%20%22vkDownloadAllPhotoAlbums%22:%20%7B%22message%22:%20%22Unduh%20semua%20album%22%7D,%0A%20%22vkFoundPhotos%22:%20%7B%22message%22:%20%22Foto%20ditemukan%22%7D,%0A%20%22vkNotAvailablePhotos%22:%20%7B%22message%22:%20%22%25d%20foto%20sementara%20ini%20tidak%20tersedia%22%7D,%0A%20%22vkFoundLinks%22:%20%7B%22message%22:%20%22Tautan%20ditemukan%22%7D,%0A%20%22vkFoundOf%22:%20%7B%22message%22:%20%22dari%22%7D,%0A%20%22vkShowAs%22:%20%7B%22message%22:%20%22Tampilkan%20sebagai%22%7D,%0A%20%22vkListOfLinks%22:%20%7B%22message%22:%20%22Daftar%20tautan%22%7D,%0A%20%22vkListOfLinksInstruction%22:%20%7B%22message%22:%20%22%5B'Untuk%20mengunduh%20semua%20foto,%20salin%20daftar%20tautan%20dan%20tempelkan%20ke%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'pengelola%20unduhan'%7D%7D,'.%20Jika%20Anda%20tidak%20memiliki%20pengelola%20unduhan,%20kami%20menyarankan%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'.'%5D%22%7D,%0A%20%22vkTableOfThumbnails%22:%20%7B%22message%22:%20%22Tabel%20gambar%20mini%22%7D,%0A%20%22vkListOfPhotos%22:%20%7B%22message%22:%20%22Daftar%20foto%22%7D,%0A%20%22vkListOfPhotosInstruction%22:%20%7B%22message%22:%20%22Klik%20foto%20untuk%20mengunduhnya.%22%7D,%0A%20%22vkKbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22vkFileSizeByte%22:%20%7B%22message%22:%20%22B%22%7D,%0A%20%22vkFileSizeKByte%22:%20%7B%22message%22:%20%22kB%22%7D,%0A%20%22vkFileSizeMByte%22:%20%7B%22message%22:%20%22MB%22%7D,%0A%20%22vkFileSizeGByte%22:%20%7B%22message%22:%20%22GB%22%7D,%0A%20%22vkFileSizeTByte%22:%20%7B%22message%22:%20%22TB%22%7D,%0A%20%22vkDownloadFromYoutube%22:%20%7B%22message%22:%20%22%5B'Mengunduh:%20buka%20',%7Ba:%7Bhref:'%7Burl%7D',text:'laman%20video'%7D%7D,'%20dan%20tekan%20tombol%20%5C%22Unduh%5C%22%20di%20atas%20pemutar'%5D%22%7D,%0A%20%22vkFoundFiles%22:%20%7B%22message%22:%20%22File%20ditemukan:%20%25d%22%7D,%0A%0A%20%22shareIn%22:%20%7B%22message%22:%20%22Bagikan%20di%20%25w%22%7D,%0A%20%22socialDesc%22:%20%7B%22message%22:%20%22Dengan%20bantuan%20SaveFrom.net,%20Anda%20dapat%20mengunduh%20file%20dari%20YouTube.com,%20Facebook.com,%20VK.com,%20dan%20lebih%20dari%2040%20lainnya%20hanya%20dengan%20satu%20klik%20gratis%22%7D,%0A%0A%20%22tutorialS1Title%22:%20%7B%22message%22:%20%22Berita%20bagus!%22%7D,%0A%20%22tutorialS1Main%22:%20%7B%22message%22:%20%22%5B'SaveFrom.net%20Helper%20',%7Bimg:%20%7Bsrc:%20'#logo'%7D%7D,'%20telah%20berhasil%20diinstal%20dan%20kini%20Anda%20dapat%20mengunduh%20video%20apa%20pun%20dari%20YouTube%20dengan%20satu%20klik'%5D%22%7D,%0A%20%22tutorialS1Arrow%22:%20%7B%22message%22:%20%22%5B'Anda%20ingin%20tahu%20caranya?',%20%7Bbr:%7B%7D%7D,%20'Klik%20di%20sini'%5D%22%7D,%0A%20%22tutorialS2Main%22:%20%7B%22message%22:%20%22Untuk%20mengunduh%20video,%20pilih%20suatu%20format%20dan%20klik%20tombol%20%5C%22Unduh%5C%22%22%7D,%0A%20%22tutorialS3History%22:%20%7B%22message%22:%20%22Riwayat%22%7D,%0A%20%22tutorialS3Main%22:%20%7B%22message%22:%20%22%5B'Apakah%20Anda%20ingin%20mengunduh%20video%20dari%20Riwayat?',%20%7Bbr:%7B%7D%7D,%20'Cukup%20klik%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20'%20pada%20pratinjau%20video%20yang%20telah%20ditonton%20sebelumnya'%5D%22%7D,%0A%20%22tutorialS4Main%22:%20%7B%22message%22:%20%22%5B'Tidak%20perlu%20menonton%20video%20%E2%80%94%20cukup%20klik%20pada%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20',%20pilih%20mutunya,%20dan%20unduh.%20Cukup%20mudah,%20ya?'%5D%22%7D,%0A%20%22tutorialS5Title%22:%20%7B%22message%22:%20%22Nikmati%20SaveFrom.net%20Helper!%22%7D,%0A%20%22tutorialS5Main%22:%20%7B%22message%22:%20%22%5B'Masih%20punya%20pertanyaan?%20Ingin%20berbagi%20ide?%20Selamat%20datang%20di%20',%20%7Ba:%20%7Btext:%20'halaman%20dukungan',%20href:%20'#support'%7D%7D,'%20kami%20atau%20bergabunglah%20dengan%20kami%20di%20',%20%7Ba:%20%7Btext:%20'Facebook',%20href:%20'#fb'%7D%7D%5D%22%7D,%0A%0A%20%22tutorialTooltipText%22:%20%7B%22message%22:%20%22%5B'Cukup%20klik%20tombol%20untuk%20',%7Bb:%20%7Btext:%20'mengunduh'%7D%7D%5D%22%7D,%0A%0A%20%22ummyTooltipConfirm%22:%20%7B%22message%22:%20%22%5B'Apakah%20Anda%20sudah%20menginstal',%7Bbr:%7B%7D%7D,%7Bimg:%7B%7D%7D,'%20Ummy%20Video%20Downloader%20sebelumnya?'%5D%22%7D,%0A%20%22yes%22:%20%7B%22message%22:%20%22Ya%22%7D,%0A%20%22no%22:%20%7B%22message%22:%20%22Tidak%22%7D,%0A%20%22tooltipHide%22:%20%7B%22message%22:%20%22Jangan%20perlihatkan%20pesan%20ini%20lagi%22%7D%0A%7D";
  _languageList.ru = "%7B%0A%20%22extName%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%22%7D,%0A%20%22extDescription%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%B9%D1%82%D0%B5%20%D1%81%20%D0%92%D0%BA%D0%BE%D0%BD%D1%82%D0%B0%D0%BA%D1%82%D0%B5,%20YouTube,%20%D0%9E%D0%B4%D0%BD%D0%BE%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%BD%D0%B8%D0%BA%D0%B8%20%D0%B8%20%D0%B5%D1%89%D0%B5%2040%20%D1%81%D0%B0%D0%B9%D1%82%D0%BE%D0%B2%20%D0%B7%D0%B0%201%20%D0%BA%D0%BB%D0%B8%D0%BA.%22%7D,%0A%0A%20%22extNameLite%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%20lite%22%7D,%0A%20%22extDescriptionLite%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%B9%D1%82%D0%B5%20%D1%81%20%D0%92%D0%BA%D0%BE%D0%BD%D1%82%D0%B0%D0%BA%D1%82%D0%B5,%20%D0%9E%D0%B4%D0%BD%D0%BE%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%BD%D0%B8%D0%BA%D0%B8%20%D0%B8%20%D0%B5%D1%89%D0%B5%2040%20%D1%81%D0%B0%D0%B9%D1%82%D0%BE%D0%B2%20%D0%B7%D0%B0%201%20%D0%BA%D0%BB%D0%B8%D0%BA.%22%7D,%0A%0A%20%22lang%22:%20%7B%22message%22:%20%22ru%22%7D,%0A%0A%20%22titleDefault%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%22%7D,%0A%20%22titleDesabled%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%20%D0%B2%D1%8B%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%22%7D,%0A%0A%20%22menuEnable%22:%20%7B%22message%22:%20%22%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C%22%7D,%0A%20%22menuDisable%22:%20%7B%22message%22:%20%22%D0%92%D1%8B%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C%22%7D,%0A%0A%20%22showButton%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7%D1%8B%D0%B2%D0%B0%D1%82%D1%8C%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20%D1%80%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D1%8F%22%7D,%0A%0A%20%22copy%22:%20%7B%22message%22:%20%22%D0%9A%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D1%82%D1%8C%22%7D,%0A%20%22download%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%22%7D,%0A%20%22downloadTitle%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D0%B6%D0%BC%D0%B8%D1%82%D0%B5%20%D0%BD%D0%B0%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D1%83,%20%D1%83%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D0%B2%D0%B0%D1%8F%20%D0%BA%D0%BB%D0%B0%D0%B2%D0%B8%D1%88%D1%83%20Alt%20%D0%B8%D0%BB%D0%B8%20Ctrl,%20%D1%87%D1%82%D0%BE%D0%B1%D1%8B%20%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B8%D1%82%D1%8C%20%D1%84%D0%B0%D0%B9%D0%BB.%22%7D,%0A%20%22noLinksFound%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D1%83%D0%B4%D0%B0%D0%BB%D0%BE%D1%81%D1%8C%20%D0%BD%D0%B0%D0%B9%D1%82%D0%B8%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%22%7D,%0A%20%22more%22:%20%7B%22message%22:%20%22%D0%95%D1%89%D1%91%22%7D,%0A%20%22close%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%BA%D1%80%D1%8B%D1%82%D1%8C%22%7D,%0A%20%22kbps%22:%20%7B%22message%22:%20%22%D0%BA%D0%B1/%D1%81%22%7D,%0A%20%22withoutAudio%22:%20%7B%22message%22:%20%22%D0%B1%D0%B5%D0%B7%20%D0%B0%D1%83%D0%B4%D0%B8%D0%BE%22%7D,%0A%20%22size%22:%20%7B%22message%22:%20%22%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%22%7D,%0A%0A%20%22subtitles%22:%20%7B%22message%22:%20%22%D0%A1%D1%83%D0%B1%D1%82%D0%B8%D1%82%D1%80%D1%8B%22%7D,%0A%20%22playlist%22:%20%7B%22message%22:%20%22%D0%9F%D0%BB%D0%B5%D0%B9%D0%BB%D0%B8%D1%81%D1%82%22%7D,%0A%20%22filelist%22:%20%7B%22message%22:%20%22%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%22%7D,%0A%20%22downloadWholePlaylist%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B2%D0%B5%D1%81%D1%8C%20%D0%BF%D0%BB%D0%B5%D0%B9%D0%BB%D0%B8%D1%81%D1%82%22%7D,%0A%0A%20%22getFileSizeTitle%22:%20%7B%22message%22:%20%22%D0%9E%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B8%D1%82%D1%8C%20%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%20%D1%84%D0%B0%D0%B9%D0%BB%D0%B0%22%20%7D,%0A%20%22getFileSizeFailTitle%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D1%83%D0%B4%D0%B0%D0%BB%D0%BE%D1%81%D1%8C%20%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B8%D1%82%D1%8C%20%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%20%D1%84%D0%B0%D0%B9%D0%BB%D0%B0.%20%D0%9F%D0%BE%D0%BF%D1%80%D0%BE%D0%B1%D1%83%D0%B9%D1%82%D0%B5%20%D0%BF%D0%BE%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D1%82%D1%8C%20%D0%BF%D0%BE%D0%BF%D1%8B%D1%82%D0%BA%D1%83.%22%7D,%0A%0A%20%22lmButtonTitle%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B8%20%D0%BF%D1%80%D1%8F%D0%BC%D1%83%D1%8E%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D1%83%22%7D,%0A%0A%20%22downloadFromCurrentPage%22:%20%7B%22message%22:%20%22%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8%20%D0%BD%D0%B0%20SaveFrom.net%22%7D,%0A%20%22updateLinks%22:%20%7B%22message%22:%20%22%D0%9E%D0%B1%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%22%7D,%0A%20%22updateLinksNotification%22:%20%7B%22message%22:%20%22%D0%A1%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%20%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D1%8B%22%7D,%0A%20%22downloadMP3Files%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B0%D1%83%D0%B4%D0%B8%D0%BE%20%D1%84%D0%B0%D0%B9%D0%BB%D1%8B%22%7D,%0A%20%22downloadPlaylist%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%BF%D0%BB%D0%B5%D0%B9%D0%BB%D0%B8%D1%81%D1%82%22%7D,%0A%20%22downloadPhotos%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%B8%22%7D,%0A%20%22installFullVersion%22:%20%7B%22message%22:%20%22%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C%20%D0%BF%D0%BE%D0%BB%D0%BD%D1%83%D1%8E%20%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8E%22%7D,%0A%20%22disable%22:%20%7B%22message%22:%20%22%D0%92%D1%8B%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C%22%7D,%0A%20%22showOptions%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8%22%7D,%0A%20%22reportBug%22:%20%7B%22message%22:%20%22%D0%A1%D0%BE%D0%BE%D0%B1%D1%89%D0%B8%D1%82%D1%8C%20%D0%BE%D0%B1%20%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B5%22%7D,%0A%20%22openPoll%22:%20%7B%22message%22:%20%22%D0%A1%D1%82%D0%B0%D1%82%D1%8C%20%D0%BB%D1%83%D1%87%D1%88%D0%B5%22%7D,%0A%20%22disableModule%22:%20%7B%22message%22:%20%22%D0%9E%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C%20%D0%BD%D0%B0%20%D1%8D%D1%82%D0%BE%D0%BC%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%22%7D,%0A%20%22enableModule%22:%20%7B%22message%22:%20%22%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C%20%D0%BD%D0%B0%20%D1%8D%D1%82%D0%BE%D0%BC%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%22%7D,%0A%20%22enableDisableModule%22:%20%7B%22message%22:%20%22%D0%92%D0%BA%D0%BB/%D0%92%D1%8B%D0%BA%D0%BB%20%D0%BD%D0%B0%20%D1%8D%D1%82%D0%BE%D0%BC%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%22%7D,%0A%20%22showHideButton%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7./%D1%81%D0%BA%D1%80.%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20%D1%80%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D1%8F%22%7D,%0A%20%22updateTo%22:%20%7B%22message%22:%20%22%D0%9E%D0%B1%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C%20%D0%B4%D0%BE%20%25d%22%7D,%0A%0A%20%22aboutPage%22:%20%7B%22message%22:%20%22%D0%9E%20%D1%80%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D0%B8%22%7D,%0A%20%22aboutTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%22%7D,%0A%20%22aboutVersion%22:%20%7B%22message%22:%20%22%D0%92%D0%B5%D1%80%D1%81%D0%B8%D1%8F%22%7D,%0A%20%22aboutDescription%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%B7%D0%B2%D0%BE%D0%BB%D1%8F%D0%B5%D1%82%20%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B0%D1%82%D1%8C%20%D0%BF%D1%80%D1%8F%D0%BC%D1%8B%D0%B5%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%20%D0%B4%D0%BB%D1%8F%20%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D1%81%20%D0%B1%D0%BE%D0%BB%D0%B5%D0%B5%20%D1%87%D0%B5%D0%BC%2040%20%D1%81%D0%B0%D0%B9%D1%82%D0%BE%D0%B2,%20%D1%81%D1%80%D0%B5%D0%B4%D0%B8%20%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D1%85%20%20VK.com,%20YouTube.com%20%D0%B8%20%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%B5.%22%7D,%0A%20%22aboutDescriptionLite%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%B7%D0%B2%D0%BE%D0%BB%D1%8F%D0%B5%D1%82%20%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B0%D1%82%D1%8C%20%D0%BF%D1%80%D1%8F%D0%BC%D1%8B%D0%B5%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%20%D0%B4%D0%BB%D1%8F%20%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D1%81%20%D0%B1%D0%BE%D0%BB%D0%B5%D0%B5%20%D1%87%D0%B5%D0%BC%2040%20%D1%81%D0%B0%D0%B9%D1%82%D0%BE%D0%B2,%20%D1%81%D1%80%D0%B5%D0%B4%D0%B8%20%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D1%85%20%20VK.com,%20Vimeo%20%D0%B8%20%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%B5.%22%7D,%0A%20%22aboutSupported%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D0%B2%D0%B0%D0%B5%D0%BC%D1%8B%D0%B5%20%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D1%8B%22%7D,%0A%20%22homePage%22:%20%7B%22message%22:%20%22%D0%94%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D1%8F%D1%8F%20%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0%22%7D,%0A%0A%20%22optionsTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%20-%20%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8%22%7D,%0A%20%22optionsHandleLinks%22:%20%7B%22message%22:%20%22%D0%9E%D0%B1%D1%80%D0%B0%D0%B1%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D1%82%D1%8C%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%22%7D,%0A%20%22optionsFileHostings%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%BE%D0%B1%D0%BC%D0%B5%D0%BD%D0%BD%D0%B8%D0%BA%D0%B8%22%7D,%0A%20%22optionsMediaHostings%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%20%D0%BC%D0%B5%D0%B4%D0%B8%D0%B0%D1%85%D0%BE%D1%81%D1%82%D0%B8%D0%BD%D0%B3%D0%B8%22%7D,%0A%20%22optionsModules%22:%20%7B%22message%22:%20%22%D0%9C%D0%BE%D0%B4%D1%83%D0%BB%D0%B8%22%7D,%0A%20%22optionsYoutube%22:%20%7B%22message%22:%20%22YouTube%22%7D,%0A%20%22optionsYTHideLinks%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D1%80%D1%8B%D0%B2%D0%B0%D1%82%D1%8C%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%22%7D,%0A%20%22optionsDailymotion%22:%20%7B%22message%22:%20%22Dailymotion%22%7D,%0A%20%22optionsVimeo%22:%20%7B%22message%22:%20%22Vimeo%22%7D,%0A%20%22optionsFacebook%22:%20%7B%22message%22:%20%22Facebook%22%7D,%0A%20%22optionsSoundcloud%22:%20%7B%22message%22:%20%22SoundCloud%22%7D,%0A%20%22optionsVkontakte%22:%20%7B%22message%22:%20%22%D0%92%D0%BA%D0%BE%D0%BD%D1%82%D0%B0%D0%BA%D1%82%D0%B5%22%7D,%0A%20%22optionsOdnoklassniki%22:%20%7B%22message%22:%20%22%D0%9E%D0%B4%D0%BD%D0%BE%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%BD%D0%B8%D0%BA%D0%B8%22%7D,%0A%20%22optionsMailru%22:%20%7B%22message%22:%20%22%D0%9C%D0%BE%D0%B9%20%D0%BC%D0%B8%D1%80%22%7D,%0A%20%22optionsInstagram%22:%20%7B%22message%22:%20%22Instagram%22%7D,%0A%20%22optionsRutube%22:%20%7B%22message%22:%20%22Rutube%22%7D,%0A%20%22optionsBitrate%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7%D1%8B%D0%B2%D0%B0%D1%82%D1%8C%20%D0%B1%D0%B8%D1%82%D1%80%D0%B5%D0%B9%D1%82%20%D1%81%D1%80%D0%B0%D0%B7%D1%83%22%7D,%0A%20%22optionsSovetnikEnabled%22:%20%7B%22message%22:%20%22%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D0%BD%D0%B8%D0%BA%22%7D,%0A%20%22optionsShowUmmyInfo%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7%D1%8B%D0%B2%D0%B0%D1%82%D1%8C%20%D0%BF%D0%BE%D0%B4%D1%81%D0%BA%D0%B0%D0%B7%D0%BA%D0%B8%20%D0%B4%D0%BB%D1%8F%20Ummy%20Video%20Downloader%22%7D,%0A%20%22optionsGmNativeDownload%22:%20%7B%22message%22:%20%22%D0%A0%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9%20%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%20%D0%B7%D0%B0%D0%BA%D0%B0%D1%87%D0%BA%D0%B8%22%7D,%0A%20%22optionsShowUmmyBtn%22:%20%7B%22message%22:%20%22%D0%9E%D1%82%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B0%D1%82%D1%8C%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20Ummy%22%7D,%0A%20%22optionsShowMp3Btn%22:%20%7B%22message%22:%20%22%D0%9E%D1%82%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B0%D1%82%D1%8C%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20mp3%22%7D,%0A%20%22optionsAviaBarEnabled%22:%20%7B%22message%22:%20%22%D0%A1%D0%BE%D0%B2%D0%B5%D1%82%D0%BD%D0%B8%D0%BA%20%D0%94%D0%B5%D1%88%D0%B5%D0%B2%D1%8B%D1%85%20%D0%90%D0%B2%D0%B8%D0%B0%D0%B1%D0%B8%D0%BB%D0%B5%D1%82%D0%BE%D0%B2%22%7D,%0A%0A%20%22menuDownloadFromCurrentPage%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D1%84%D0%B0%D0%B9%D0%BB%D1%8B%20%D1%81%20%D1%82%D0%B5%D0%BA%D1%83%D1%89%D0%B5%D0%B9%20%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D1%8B%20%D1%81%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20SaveFrom.net%22%7D,%0A%20%22menuUpdateLinks%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D0%B6%D0%BC%D0%B8%D1%82%D0%B5,%20%D0%B5%D1%81%D0%BB%D0%B8%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B0%20%D0%B4%D0%BB%D1%8F%20%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20%D0%BD%D0%B5%20%D0%BF%D0%BE%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%D1%81%D1%8F%22%7D,%0A%20%22menuDownloadMP3Files%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B2%D1%81%D0%B5%20%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5%20%D0%BD%D0%B0%20%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B5%20%D0%B0%D1%83%D0%B4%D0%B8%D0%BE%D1%84%D0%B0%D0%B9%D0%BB%D1%8B%22%7D,%0A%20%22menuDownloadPlaylist%22:%20%7B%22message%22:%20%22%D0%A4%D0%BE%D1%80%D0%BC%D0%B8%D1%80%D1%83%D0%B5%D1%82%20%D0%B8%20%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%B5%D1%82%20%D0%BF%D0%BB%D0%B5%D0%B9%D0%BB%D0%B8%D1%81%D1%82%20%D1%81%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B0%D0%BC%D0%B8%20%D0%BD%D0%B0%20%D0%B0%D1%83%D0%B4%D0%B8%D0%BE%D1%84%D0%B0%D0%B9%D0%BB%D1%8B%22%7D,%0A%20%22menuDownloadPhotos%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B2%D1%81%D0%B5%20%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5%20%D0%BD%D0%B0%20%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B5%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%B8%22%7D,%0A%20%22menuReportBug%22:%20%7B%22message%22:%20%22%D0%94%D0%B0%D0%B9%D1%82%D0%B5%20%D0%BD%D0%B0%D0%BC%20%D0%B7%D0%BD%D0%B0%D1%82%D1%8C,%20%D0%B5%D1%81%D0%BB%D0%B8%20%D0%B2%D0%BE%D0%B7%D0%BD%D0%B8%D0%BA%D0%BB%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D1%8B%22%7D,%0A%20%22menuShowOptions%22:%20%7B%22message%22:%20%22%D0%92%D0%BA%D0%BB./%D0%BE%D1%82%D0%BA%D0%BB.%20%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D0%B2%D0%B0%D0%B5%D0%BC%D1%8B%D0%B5%20%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D1%8B%20%D0%B8%20%D0%B2%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%D0%B0%22%7D,%0A%20%22menuEnableExtension%22:%20%7B%22message%22:%20%22%22%7D,%0A%20%22menuOpenPoll%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%B6%D0%B0%D0%BB%D1%83%D0%B9%D1%81%D1%82%D0%B0,%20%D0%BE%D1%86%D0%B5%D0%BD%D0%B8%D1%82%D0%B5%20%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE%20%D1%80%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D1%8F%20%5C%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%5C%22%22%7D,%0A%0A%20%22quality%22:%20%7B%22message%22:%20%22%D0%9A%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE%22%7D,%0A%20%22qualityNote%22:%20%7B%22message%22:%20%22%D0%95%D1%81%D0%BB%D0%B8%20%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%20%D0%B2%20%D0%BD%D1%83%D0%B6%D0%BD%D0%BE%D0%BC%20%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%B5%20%D0%BD%D0%B5%D1%82,%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D0%B5%D1%82%D1%81%D1%8F%20%D0%BB%D1%83%D1%87%D1%88%D0%B5%D0%B5%20%D0%B8%D0%B7%20%D0%B2%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%D0%B3%D0%BE.%22%7D,%0A%20%22filelistTitle%22:%20%7B%22message%22:%20%22%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BD%D1%8B%D1%85%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%22%7D,%0A%20%22filelistInstruction%22:%20%7B%22message%22:%20%22%5B'%D0%A7%D1%82%D0%BE%D0%B1%D1%8B%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B2%D1%81%D0%B5%20%D1%84%D0%B0%D0%B9%D0%BB%D1%8B,%20%D1%81%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D1%83%D0%B9%D1%82%D0%B5%20%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D1%81%D1%81%D1%8B%D0%BB%D0%BE%D0%BA%20%D0%B8%20%D0%B2%D1%81%D1%82%D0%B0%D0%B2%D1%8C%D1%82%D0%B5%20%D0%B5%D0%B3%D0%BE%20%D0%B2%20',%7Ba:%7Bhref:'http://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D0%BA',text:'%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%20%D0%B7%D0%B0%D0%BA%D0%B0%D1%87%D0%B5%D0%BA'%7D%7D,'.%20%D0%95%D1%81%D0%BB%D0%B8%20%D1%83%20%D0%B2%D0%B0%D1%81%20%D0%BD%D0%B5%20%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%20%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%20%D0%B7%D0%B0%D0%BA%D0%B0%D1%87%D0%B5%D0%BA,%20%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D1%83%D0%B5%D0%BC%20%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C%20',%7Ba:%7Bhref:'http://www.westbyte.com/dm/',text:'Download%20Master'%7D%7D,'.'%5D%22%7D,%0A%20%22playlistTitle%22:%20%7B%22message%22:%20%22%D0%9F%D0%BB%D0%B5%D0%B9%D0%BB%D0%B8%D1%81%D1%82%22%7D,%0A%20%22playlistInstruction%22:%20%7B%22message%22:%20%22%D0%A1%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9%20%D0%BF%D0%BB%D0%B5%D0%B9%D0%BB%D0%B8%D1%81%D1%82%20%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%20%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8C%20%D0%B2%20%D0%BF%D0%BB%D0%B5%D0%B5%D1%80%D0%B5%20%D0%B4%D0%BB%D1%8F%20%20%D0%B2%D0%BE%D1%81%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F.%22%7D,%0A%0A%20%22ummySfTitle%22:%20%7B%22message%22:%20%22HD%20%D0%B8%D0%BB%D0%B8%20MP3%22%7D,%0A%20%22ummyMenuItem%22:%20%7B%22message%22%20:%20%22%5B%7Bspan:%7B%7D%7D,'%20%D1%81%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E%20Ummy'%5D%22%7D,%0A%20%22ummyMenuInfo%22:%20%7B%22message%22:%20%22%5B%7Bp:%7Bappend:%5B'%D0%A1%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%B9%D1%82%D0%B5%20HD%20%D0%B8%20MP3%20%D1%81%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E%20%D0%B1%D0%B5%D1%81%D0%BF%D0%BB%D0%B0%D1%82%D0%BD%D0%BE%D0%B9%20%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%8B',%20%7Bbr:%7B%7D%7D,%20'Ummy%20Video%20Downloader!'%5D%7D%7D,%7Bp:%7Bclass:'center',append:%5B%7Ba:%7Bclass:'green-btn-2%20arrow',href:'%7Burl%7D',target:'_blank',text:'%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C'%7D%7D%5D%7D%7D,%7Bp:%7Bappend:%5B'%D0%9F%D0%BE%D1%81%D0%BB%D0%B5%20%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8%20%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%B1%D1%83%D0%B4%D0%B5%D1%82%20%D0%BD%D0%B0%D1%87%D0%B8%D0%BD%D0%B0%D1%82%D1%8C%D1%81%D1%8F%20%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8',%20%7Bbr:%7B%7D%7D,%20'%D0%BF%D1%80%D0%B8%20%D0%BA%D0%BB%D0%B8%D0%BA%D0%B5%20%D0%BD%D0%B0%20',%7Bimg:%7Bsrc:'#'%7D%7D%5D%7D%7D%5D%22%7D,%0A%20%22warningPopupTitle%22:%20%7B%22message%22:%20%22%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D1%8C%D1%82%D0%B5%20%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8%20%D0%B1%D1%80%D0%B0%D1%83%D0%B7%D0%B5%D1%80%D0%B0%22%7D,%0A%20%22warningPopupDesc%22:%20%7B%22message%22:%20%22%D0%92%D1%8B%D0%B1%D0%BE%D1%80%20%D0%BF%D0%B0%D0%BF%D0%BA%D0%B8%20%D0%BF%D1%80%D0%B8%20%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B8%20%D0%B4%D0%BE%D0%BB%D0%B6%D0%B5%D0%BD%20%D0%B1%D1%8B%D1%82%D1%8C%20%D0%BE%D1%82%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD.%22%7D,%0A%20%22readMore%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%B4%D1%80%D0%BE%D0%B1%D0%BD%D0%B5%D0%B5...%22%7D,%0A%20%22noWarning%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D0%BF%D1%80%D0%B5%D0%B4%D1%83%D0%BF%D1%80%D0%B5%D0%B6%D0%B4%D0%B0%D1%82%D1%8C%22%7D,%0A%20%22cancel%22:%20%7B%22message%22:%20%22%D0%9E%D1%82%D0%BC%D0%B5%D0%BD%D0%B0%22%7D,%0A%20%22continue%22:%20%7B%22message%22:%20%22%D0%9F%D1%80%D0%BE%D0%B4%D0%BE%D0%BB%D0%B6%D0%B8%D1%82%D1%8C%22%7D,%0A%20%22beforeDownloadPopupWarn%22:%20%7B%22message%22:%20%22%D0%92%D0%BD%D0%B8%D0%BC%D0%B0%D0%BD%D0%B8%D0%B5:%20%D0%BE%D1%82%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C%20%D0%B8%D0%BB%D0%B8%20%D0%BF%D1%80%D0%B8%D0%BE%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C%20%D0%B7%D0%B0%D0%BA%D0%B0%D1%87%D0%BA%D1%83%20%D0%B1%D1%83%D0%B4%D0%B5%D1%82%20%D0%BD%D0%B5%D0%B2%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE.%22%7D,%0A%0A%20%22vkInfo%22:%20%7B%22message%22:%20%22%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B%22%7D,%0A%20%22vkInfoTitle%22:%20%7B%22message%22:%20%22%D0%A0%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%20%D1%84%D0%B0%D0%B9%D0%BB%D0%B0%20%D0%B8%20%D0%B1%D0%B8%D1%82%D1%80%D0%B5%D0%B9%D1%82%22%7D,%0A%20%22vkMp3LinksNotFound%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D1%8B%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%20%D0%BD%D0%B0%20MP3%20%D1%84%D0%B0%D0%B9%D0%BB%D1%8B%22%7D,%0A%20%22vkPhotoLinksNotFound%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D1%8B%20%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8%20%D0%BD%D0%B0%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%B8%22%7D,%0A%20%22vkDownloadPhotoAlbum%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B0%D0%BB%D1%8C%D0%B1%D0%BE%D0%BC%22%7D,%0A%20%22vkDownloadAllPhotoAlbums%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B2%D1%81%D0%B5%20%D0%B0%D0%BB%D1%8C%D0%B1%D0%BE%D0%BC%D1%8B%22%7D,%0A%20%22vkFoundPhotos%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BE%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%B9%22%7D,%0A%20%22vkNotAvailablePhotos%22:%20%7B%22message%22:%20%22%25d%20%D1%84%D0%BE%D1%82%D0%BE%20%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D0%BE%20%D0%BD%D0%B5%20%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D0%BE%22%7D,%0A%20%22vkFoundLinks%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BE%20%D1%81%D1%81%D1%8B%D0%BB%D0%BE%D0%BA%22%7D,%0A%20%22vkFoundOf%22:%20%7B%22message%22:%20%22%D0%B8%D0%B7%22%7D,%0A%20%22vkShowAs%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7%D0%B0%D1%82%D1%8C%20%D0%BA%D0%B0%D0%BA%22%7D,%0A%20%22vkListOfLinks%22:%20%7B%22message%22:%20%22%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D1%81%D1%81%D1%8B%D0%BB%D0%BE%D0%BA%22%7D,%0A%20%22vkListOfLinksInstruction%22:%20%7B%22message%22:%20%22%5B'%D0%A7%D1%82%D0%BE%D0%B1%D1%8B%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B2%D1%81%D0%B5%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%B8,%20%D1%81%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D1%83%D0%B9%D1%82%D0%B5%20%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D1%81%D1%81%D1%8B%D0%BB%D0%BE%D0%BA%20%D0%B8%20%D0%B2%D1%81%D1%82%D0%B0%D0%B2%D1%8C%D1%82%D0%B5%20%D0%B5%D0%B3%D0%BE%20%D0%B2%20',%7Ba:%7Bhref:'http://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D0%BA',text:'%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%20%D0%B7%D0%B0%D0%BA%D0%B0%D1%87%D0%B5%D0%BA'%7D%7D,'.%20%D0%95%D1%81%D0%BB%D0%B8%20%D1%83%20%D0%B2%D0%B0%D1%81%20%D0%BD%D0%B5%20%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%20%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%20%D0%B7%D0%B0%D0%BA%D0%B0%D1%87%D0%B5%D0%BA,%20%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D1%83%D0%B5%D0%BC%20%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C%20',%7Ba:%7Bhref:'http://www.westbyte.com/dm/',text:'Download%20Master'%7D%7D,'.'%5D%22%7D,%0A%20%22vkTableOfThumbnails%22:%20%7B%22message%22:%20%22%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%83%20%D1%8D%D1%81%D0%BA%D0%B8%D0%B7%D0%BE%D0%B2%22%7D,%0A%20%22vkListOfPhotos%22:%20%7B%22message%22:%20%22%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%B9%22%7D,%0A%20%22vkListOfPhotosInstruction%22:%20%7B%22message%22:%20%22%D0%A7%D1%82%D0%BE%D0%B1%D1%8B%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8E,%20%D1%89%D0%B5%D0%BB%D0%BA%D0%BD%D0%B8%D1%82%D0%B5%20%D0%BD%D0%B0%20%D0%BD%D0%B5%D0%B9%20%D0%BB%D0%B5%D0%B2%D0%BE%D0%B9%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D0%BE%D0%B9%20%D0%BC%D1%8B%D1%88%D0%B8.%22%7D,%0A%20%22vkKbps%22:%20%7B%22message%22:%20%22%D0%BA%D0%B1/%D1%81%22%7D,%0A%20%22vkFileSizeByte%22:%20%7B%22message%22:%20%22%D0%91%22%7D,%0A%20%22vkFileSizeKByte%22:%20%7B%22message%22:%20%22%D0%BA%D0%91%22%7D,%0A%20%22vkFileSizeMByte%22:%20%7B%22message%22:%20%22%D0%9C%D0%91%22%7D,%0A%20%22vkFileSizeGByte%22:%20%7B%22message%22:%20%22%D0%93%D0%91%22%7D,%0A%20%22vkFileSizeTByte%22:%20%7B%22message%22:%20%22%D0%A2%D0%91%22%7D,%0A%20%22vkDownloadFromYoutube%22:%20%7B%22message%22:%20%22%5B'%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C:%20%D0%BE%D1%82%D0%BA%D1%80%D0%BE%D0%B9%D1%82%D0%B5%20',%7Ba:%7Bhref:'%7Burl%7D',text:'%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D1%83%20%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%20%D1%80%D0%BE%D0%BB%D0%B8%D0%BA%D0%B0'%7D%7D,'%20%D0%B8%20%D0%BD%D0%B0%D0%B6%D0%BC%D0%B8%D1%82%D0%B5%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20%5C%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%5C%22%20%D0%BD%D0%B0%D0%B4%20%D0%BF%D0%BB%D0%B5%D0%B5%D1%80%D0%BE%D0%BC'%5D%22%7D,%0A%20%22vkFoundFiles%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BE%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2:%20%25d%22%7D,%0A%0A%20%22shareIn%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8%D1%82%D1%8C%D1%81%D1%8F%20%D0%B2%20%25w%22%7D,%0A%20%22socialDesc%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%20%D0%BF%D0%BE%D0%BC%D0%BE%D0%B3%D0%B0%D0%B5%D1%82%20%D0%B1%D0%B5%D1%81%D0%BF%D0%BB%D0%B0%D1%82%D0%BD%D0%BE%20%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D1%82%D1%8C%20%D1%81%20VK.com,%20YouTube.com,%20Odnoklassniki.ru%20%D0%B8%20%D0%B1%D0%BE%D0%BB%D0%B5%D0%B5%2040%20%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D1%85%20%D1%81%D0%B0%D0%B9%D1%82%D0%BE%D0%B2%20%D0%B2%201%20%D0%BA%D0%BB%D0%B8%D0%BA%22%7D,%0A%0A%20%22tutorialS1Title%22:%20%7B%22message%22:%20%22%D0%A5%D0%BE%D1%80%D0%BE%D1%88%D0%B8%D0%B5%20%D0%BD%D0%BE%D0%B2%D0%BE%D1%81%D1%82%D0%B8!%22%7D,%0A%20%22tutorialS1Main%22:%20%7B%22message%22:%20%22%5B'%D0%A3%20%D1%82%D0%B5%D0%B1%D1%8F%20%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%20SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA%20',%7Bimg:%20%7Bsrc:%20'#logo'%7D%7D,',%20%D0%B8%20%D1%82%D0%B5%D0%BF%D0%B5%D1%80%D1%8C%20%D1%82%D1%8B%20%D0%BC%D0%BE%D0%B6%D0%B5%D1%88%D1%8C%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%BB%D1%8E%D0%B1%D0%BE%D0%B5%20%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE%20%D1%81%20YouTube%20%D0%B2%20%D0%BE%D0%B4%D0%B8%D0%BD%20%D0%BA%D0%BB%D0%B8%D0%BA'%5D%22%7D,%0A%20%22tutorialS1Arrow%22:%20%7B%22message%22:%20%22%5B'%D0%A5%D0%BE%D1%87%D0%B5%D1%88%D1%8C%20%D1%83%D0%B7%D0%BD%D0%B0%D1%82%D1%8C%20%D0%BA%D0%B0%D0%BA?',%7Bbr:%7B%7D%7D,'%D0%9D%D0%B0%D0%B6%D0%BC%D0%B8%20%D0%B7%D0%B4%D0%B5%D1%81%D1%8C'%5D%22%7D,%0A%20%22tutorialS2Main%22:%20%7B%22message%22:%20%22%D0%A7%D1%82%D0%BE%D0%B1%D1%8B%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE,%20%D0%B2%D1%8B%D0%B1%D0%B5%D1%80%D0%B8%20%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%20%D0%B8%20%D0%BD%D0%B0%D0%B6%D0%BC%D0%B8%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20%5C%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%5C%22%22%7D,%0A%20%22tutorialS3History%22:%20%7B%22message%22:%20%22%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5%22%7D,%0A%20%22tutorialS3Main%22:%20%7B%22message%22:%20%22%5B'%D0%A5%D0%BE%D1%87%D0%B5%D1%88%D1%8C%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C%20%D1%83%D0%B6%D0%B5%20%D0%BF%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%D0%B5%D0%BD%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE?',%7Bbr:%7B%7D%7D,'%D0%9D%D0%B0%D0%B6%D0%B8%D0%BC%D0%B0%D0%B9%20%D0%BD%D0%B0%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,'%20%D0%BD%D0%B0%20%D0%BF%D1%80%D0%B5%D0%B2%D1%8C%D1%8E%20%D0%B2%20%D0%9F%D1%80%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%D0%B5%D0%BD%D0%BD%D1%8B%D1%85%20%D0%B2%D0%B8%D0%B4%D0%B5%D0%BE'%5D%22%7D,%0A%20%22tutorialS4Main%22:%20%7B%22message%22:%20%22%5B'%D0%92%D0%B8%D0%B4%D0%B5%D0%BE%20%D0%BD%D0%B5%20%D0%BE%D0%B1%D1%8F%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%20%D0%BF%D1%80%D0%BE%D1%81%D0%BC%D0%B0%D1%82%D1%80%D0%B8%D0%B2%D0%B0%D1%82%D1%8C%20%E2%80%94',%7Bbr:%7B%7D%7D,'%D0%BD%D0%B0%D0%B6%D0%B8%D0%BC%D0%B0%D0%B9%20%D0%BD%D0%B0%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,',%20%D0%B2%D1%8B%D0%B1%D0%B8%D1%80%D0%B0%D0%B9%20%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%20%D0%B8%20%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%B9.%20%D0%AD%D1%82%D0%BE%20%D1%83%D0%B4%D0%BE%D0%B1%D0%BD%D0%BE!'%5D%22%7D,%0A%20%22tutorialS5Title%22:%20%7B%22message%22:%20%22%D0%9F%D1%80%D0%B8%D1%8F%D1%82%D0%BD%D0%BE%D0%B9%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B!%22%7D,%0A%20%22tutorialS5Main%22:%20%7B%22message%22:%20%22%5B'%D0%9E%D1%81%D1%82%D0%B0%D0%BB%D0%B8%D1%81%D1%8C%20%D0%B2%D0%BE%D0%BF%D1%80%D0%BE%D1%81%D1%8B?%20%D0%95%D1%81%D1%82%D1%8C%20%D0%BF%D1%80%D0%B5%D0%B4%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F?%20%D0%97%D0%B0%D0%B3%D0%BB%D1%8F%D0%BD%D0%B8%D1%82%D0%B5%20%D0%BD%D0%B0%20',%20%7Ba:%20%7Btext:%20'%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D1%83%20%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D0%B8',%20href:%20'#support'%7D%7D,'%20%D0%B8%D0%BB%D0%B8%20%D0%B2%D1%81%D1%82%D1%83%D0%BF%D0%B0%D0%B9%D1%82%D0%B5%20%D0%B2%20%D0%BD%D0%B0%D1%88%D0%B5%20',%20%7Ba:%20%7Btext:%20'%D0%92%D0%9A-%D1%81%D0%BE%D0%B1%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%BE',%20href:%20'#vk'%7D%7D%5D%22%7D,%0A%0A%20%22tutorialTooltipText%22:%20%7B%22message%22:%20%22%5B'%D0%A7%D1%82%D0%BE%D0%B1%D1%8B%20',%7Bb:%20%7Btext:%20'%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D1%8C'%7D%7D,',%20%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%20%D0%BA%D0%BB%D0%B8%D0%BA%D0%BD%D0%B8%D1%82%D0%B5%20%D0%BF%D0%BE%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D0%B5'%5D%22%7D,%0A%0A%20%22ummyTooltipConfirm%22:%20%7B%22message%22:%20%22%5B'%D0%92%D1%8B%20%D1%83%D0%B6%D0%B5%20%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D0%BB%D0%B8',%7Bbr:%7B%7D%7D,%7Bimg:%7B%7D%7D,'%20Ummy%20Video%20Downloader?'%5D%22%7D,%0A%20%22yes%22:%20%7B%22message%22:%20%22%D0%94%D0%B0%22%7D,%0A%20%22no%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%D1%82%22%7D,%0A%20%22tooltipHide%22:%20%7B%22message%22:%20%22%D0%91%D0%BE%D0%BB%D1%8C%D1%88%D0%B5%20%D0%BD%D0%B5%20%D0%BF%D0%BE%D0%BA%D0%B0%D0%B7%D1%8B%D0%B2%D0%B0%D1%82%D1%8C%20%D1%8D%D1%82%D0%BE%20%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D0%B5%22%7D%0A%7D";
  _languageList.tr = "%7B%0A%20%22extName%22:%20%7B%22message%22:%20%22SaveFrom.net%20asistan%22%7D,%0A%20%22extDescription%22:%20%7B%22message%22:%20%22Sadece%20bir%20t%C4%B1klama%20ile%20YouTube,%20Facebook,%20VK.com%20ve%2040'dan%20fazla%20siteden%20dosya%20indirin.%22%7D,%0A%0A%20%22extNameLite%22:%20%7B%22message%22:%20%22SaveFrom.net%20asistan%20lite%22%7D,%0A%20%22extDescriptionLite%22:%20%7B%22message%22:%20%22Sadece%20bir%20t%C4%B1klama%20ile%20Facebook,%20VK.com%20ve%2040'dan%20fazla%20siteden%20dosya%20indirin%22%7D,%0A%0A%20%22lang%22:%20%7B%22message%22:%20%22tr%22%7D,%0A%0A%20%22titleDefault%22:%20%7B%22message%22:%20%22SaveFrom.net%20asistan%22%7D,%0A%20%22titleDesabled%22:%20%7B%22message%22:%20%22SaveFrom.net%20asistan%20devre%20d%C4%B1%C5%9F%C4%B1%22%7D,%0A%0A%20%22menuEnable%22:%20%7B%22message%22:%20%22Etkin%22%7D,%0A%20%22menuDisable%22:%20%7B%22message%22:%20%22Devre%20d%C4%B1%C5%9F%C4%B1%22%7D,%0A%0A%20%22showButton%22:%20%7B%22message%22:%20%22Eklenti%20d%C3%BC%C4%9Fmesini%20g%C3%B6ster%22%7D,%0A%0A%20%22copy%22:%20%7B%22message%22:%20%22Kopyala%22%7D,%0A%20%22download%22:%20%7B%22message%22:%20%22%C4%B0ndir%22%7D,%0A%20%22downloadTitle%22:%20%7B%22message%22:%20%22Dosyay%C4%B1%20indirmek%20i%C3%A7in%20Alt/Option%20veya%20Ctrl%20tu%C5%9Funa%20bas%C4%B1l%C4%B1%20tutarak%20ba%C4%9Flant%C4%B1y%C4%B1%20t%C4%B1klay%C4%B1n.%22%7D,%0A%20%22noLinksFound%22:%20%7B%22message%22:%20%22Hi%C3%A7bir%20ba%C4%9Flant%C4%B1%20bulunamad%C4%B1%22%7D,%0A%20%22more%22:%20%7B%22message%22:%20%22Daha%20fazla%22%7D,%0A%20%22close%22:%20%7B%22message%22:%20%22Kapat%22%7D,%0A%20%22kbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22withoutAudio%22:%20%7B%22message%22:%20%22without%20audio%22%7D,%0A%20%22size%22:%20%7B%22message%22:%20%22boyut%22%7D,%0A%0A%20%22subtitles%22:%20%7B%22message%22:%20%22Alt%20yaz%C4%B1%22%7D,%0A%20%22playlist%22:%20%7B%22message%22:%20%22%C3%87alma%20listesi%22%7D,%0A%20%22filelist%22:%20%7B%22message%22:%20%22Dosya%20listesi%22%7D,%0A%20%22downloadWholePlaylist%22:%20%7B%22message%22:%20%22T%C3%BCm%20%C3%A7alma%20listesini%20indir%22%7D,%0A%0A%20%22getFileSizeTitle%22:%20%7B%22message%22:%20%22Dosya%20boyutunu%20al%22%20%7D,%0A%20%22getFileSizeFailTitle%22:%20%7B%22message%22:%20%22Dosya%20boyutu%20al%C4%B1namad%C4%B1.%20L%C3%BCtfen%20tekrar%20deneyiniz.%22%7D,%0A%0A%20%22lmButtonTitle%22:%20%7B%22message%22:%20%22Do%C4%9Frudan%20ba%C4%9Flant%C4%B1%20al%22%7D,%0A%0A%20%22downloadFromCurrentPage%22:%20%7B%22message%22:%20%22SaveFrom.net'e%20git%22%7D,%0A%20%22updateLinks%22:%20%7B%22message%22:%20%22Ba%C4%9Flant%C4%B1lar%C4%B1%20yenile%22%7D,%0A%20%22updateLinksNotification%22:%20%7B%22message%22:%20%22Ba%C4%9Flant%C4%B1lar%20g%C3%BCncellendi%22%7D,%0A%20%22downloadMP3Files%22:%20%7B%22message%22:%20%22Ses%20dosyalar%C4%B1n%C4%B1%20indir%22%7D,%0A%20%22downloadPlaylist%22:%20%7B%22message%22:%20%22%C3%87alma%20listesini%20indir%22%7D,%0A%20%22downloadPhotos%22:%20%7B%22message%22:%20%22Resimleri%20indir%22%7D,%0A%20%22installFullVersion%22:%20%7B%22message%22:%20%22Tam%20versiyonu%20kur%22%7D,%0A%20%22disable%22:%20%7B%22message%22:%20%22Devre%20d%C4%B1%C5%9F%C4%B1%22%7D,%0A%20%22showOptions%22:%20%7B%22message%22:%20%22Ayarlar%22%7D,%0A%20%22reportBug%22:%20%7B%22message%22:%20%22Hata%20bildir%22%7D,%0A%20%22openPoll%22:%20%7B%22message%22:%20%22Become%20better%22%7D,%0A%20%22disableModule%22:%20%7B%22message%22:%20%22Bu%20web%20sitesinde%20devre%20d%C4%B1%C5%9F%C4%B1%20b%C4%B1rak%22%7D,%0A%20%22enableModule%22:%20%7B%22message%22:%20%22Bu%20web%20sitesinde%20etkinle%C5%9Ftir%22%7D,%0A%20%22enableDisableModule%22:%20%7B%22message%22:%20%22Bu%20sitede%20etkin/devre%20d%C4%B1%C5%9F%C4%B1%22%7D,%0A%20%22showHideButton%22:%20%7B%22message%22:%20%22Eklenti%20butonunu%20g%C3%B6ster/gizle%22%7D,%0A%20%22updateTo%22:%20%7B%22message%22:%20%22%25d%20s%C3%BCr%C3%BCm%C3%BCne%20g%C3%BCncelle%22%7D,%0A%0A%20%22aboutPage%22:%20%7B%22message%22:%20%22Hakk%C4%B1nda%22%7D,%0A%20%22aboutTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Asistan%22%7D,%0A%20%22aboutVersion%22:%20%7B%22message%22:%20%22Versiyon%22%7D,%0A%20%22aboutDescription%22:%20%7B%22message%22:%20%22Kullan%C4%B1c%C4%B1lar%C4%B1n,%20Dailymotion.com,%20YouTube.com,%20VK.com%20ve%20di%C4%9Ferleri%20de%20dahil%20olmak%20%C3%BCzere%2040'dan%20fazla%20web%20sitesinden%20dosya%20indirmek%20i%C3%A7in%20do%C4%9Frudan%20ba%C4%9Flant%C4%B1lar%20almalar%C4%B1n%C4%B1%20sa%C4%9Flar.%22%7D,%0A%20%22aboutDescriptionLite%22:%20%7B%22message%22:%20%22Kullan%C4%B1c%C4%B1lar%C4%B1n,%20Dailymotion.com,%20VK.com%20ve%20di%C4%9Ferleri%20de%20dahil%20olmak%20%C3%BCzere%2040'dan%20fazla%20web%20sitesinden%20dosya%20indirmek%20i%C3%A7in%20do%C4%9Frudan%20ba%C4%9Flant%C4%B1lar%20almalar%C4%B1n%C4%B1%20sa%C4%9Flar.%22%7D,%0A%20%22aboutSupported%22:%20%7B%22message%22:%20%22Desteklenen%20kaynaklar%22%7D,%0A%20%22homePage%22:%20%7B%22message%22:%20%22Ana%20Sayfa%22%7D,%0A%0A%20%22optionsTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20Asistan%20-%20Tercihler%22%7D,%0A%20%22optionsHandleLinks%22:%20%7B%22message%22:%20%22Linkleri%20ta%C5%9F%C4%B1%22%7D,%0A%20%22optionsFileHostings%22:%20%7B%22message%22:%20%22Dosya%20payla%C5%9F%C4%B1ma%22%7D,%0A%20%22optionsMediaHostings%22:%20%7B%22message%22:%20%22Medya%20payla%C5%9F%C4%B1ma%22%7D,%0A%20%22optionsModules%22:%20%7B%22message%22:%20%22Mod%C3%BCller%22%7D,%0A%20%22optionsYoutube%22:%20%7B%22message%22:%20%22YouTube%22%7D,%0A%20%22optionsYTHideLinks%22:%20%7B%22message%22:%20%22Ba%C4%9Flant%C4%B1lar%C4%B1%20gizle%22%7D,%0A%20%22optionsDailymotion%22:%20%7B%22message%22:%20%22Dailymotion%22%7D,%0A%20%22optionsVimeo%22:%20%7B%22message%22:%20%22Vimeo%22%7D,%0A%20%22optionsFacebook%22:%20%7B%22message%22:%20%22Facebook%22%7D,%0A%20%22optionsSoundcloud%22:%20%7B%22message%22:%20%22SoundCloud%22%7D,%0A%20%22optionsVkontakte%22:%20%7B%22message%22:%20%22VK%22%7D,%0A%20%22optionsOdnoklassniki%22:%20%7B%22message%22:%20%22Odnoklassniki%22%7D,%0A%20%22optionsMailru%22:%20%7B%22message%22:%20%22Moy%20Mir%22%7D,%0A%20%22optionsInstagram%22:%20%7B%22message%22:%20%22Instagram%22%7D,%0A%20%22optionsRutube%22:%20%7B%22message%22:%20%22Rutube%22%7D,%0A%20%22optionsBitrate%22:%20%7B%22message%22:%20%22Bit%20h%C4%B1z%C4%B1n%C4%B1%20anl%C4%B1k%20olarak%20g%C3%B6ster%22%7D,%0A%20%22optionsSovetnikEnabled%22:%20%7B%22message%22:%20%22Advisor%22%7D,%0A%20%22optionsShowUmmyInfo%22:%20%7B%22message%22:%20%22UVD%20i%C3%A7in%20ipu%C3%A7lar%C4%B1n%C4%B1%20g%C3%B6ster%22%7D,%0A%20%22optionsGmNativeDownload%22:%20%7B%22message%22:%20%22Geli%C5%9Fmi%C5%9F%20indirme%20modu%22%7D,%0A%20%22optionsShowUmmyBtn%22:%20%7B%22message%22:%20%22Ummy%20d%C3%BC%C4%9Fmesini%20g%C3%B6ster%22%7D,%0A%20%22optionsShowMp3Btn%22:%20%7B%22message%22:%20%22Mp3%20d%C3%BC%C4%9Fmesini%20g%C3%B6ster%22%7D,%0A%20%22optionsAviaBarEnabled%22:%20%7B%22message%22:%20%22Cheap%20Flights%20Advisor%22%7D,%0A%0A%20%22menuDownloadFromCurrentPage%22:%20%7B%22message%22:%20%22SaveFrom.net'i%20kullanarak%20ge%C3%A7erli%20sayfadan%20dosya%20indirin%22%7D,%0A%20%22menuUpdateLinks%22:%20%7B%22message%22:%20%22Download%20d%C3%BC%C4%9Fmesi%20g%C3%B6r%C3%BCnm%C3%BCyorsa%20t%C4%B1klay%C4%B1n%22%7D,%0A%20%22menuDownloadMP3Files%22:%20%7B%22message%22:%20%22Ge%C3%A7erli%20sayfada%20bulunan%20t%C3%BCm%20ses%20dosyalar%C4%B1n%C4%B1%20indirin%22%7D,%0A%20%22menuDownloadPlaylist%22:%20%7B%22message%22:%20%22Ses%20dosyalar%C4%B1ndan%20olu%C5%9Fan%20bir%20%C3%A7alma%20listesi%20olu%C5%9Fturur%20ve%20indirir%22%7D,%0A%20%22menuDownloadPhotos%22:%20%7B%22message%22:%20%22Ge%C3%A7erli%20sayfada%20bulunan%20t%C3%BCm%20resimleri%20indirin%22%7D,%0A%20%22menuReportBug%22:%20%7B%22message%22:%20%22Herhangi%20bir%20sorun%20olmas%C4%B1%20durumunda%20bize%20bildirin%22%7D,%0A%20%22menuShowOptions%22:%20%7B%22message%22:%20%22Desteklenen%20kaynaklar%C4%B1%20ve%20Helper%20se%C3%A7eneklerini%20A%C3%87/KAPAT%22%7D,%0A%20%22menuEnableExtension%22:%20%7B%22message%22:%20%22%22%7D,%0A%20%22menuOpenPoll%22:%20%7B%22message%22:%20%22%22%7D,%0A%0A%20%22quality%22:%20%7B%22message%22:%20%22Kalite%22%7D,%0A%20%22qualityNote%22:%20%7B%22message%22:%20%22Herhangi%20bir%20se%C3%A7ilebilir%20kalitenin%20olmamas%C4%B1%20durumunda%20mevcut%20olan%20en%20iyi%20video%20indirilecektir.%22%7D,%0A%20%22filelistTitle%22:%20%7B%22message%22:%20%22Bulunan%20dosyalar%C4%B1n%C4%B1%20listesi%22%7D,%0A%20%22filelistInstruction%22:%20%7B%22message%22:%20%22%5B'T%C3%BCm%20dosyalar%C4%B1n%C4%B1%20indirmek%20i%C3%A7in%20ba%C4%9Flant%C4%B1%20listesini%20kopyalay%C4%B1n%20ve%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'indirme%20y%C3%B6neticisine'%7D%7D,'%20yap%C4%B1%C5%9Ft%C4%B1r%C4%B1n.%20Kurulu%20bir%20indirme%20y%C3%B6neticiniz%20yoksa%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'%20y%C3%BCklemenizi%20tavsiye%20ederiz.'%5D%22%7D,%0A%20%22playlistTitle%22:%20%7B%22message%22:%20%22%C3%87alma%20Listesi%22%7D,%0A%20%22playlistInstruction%22:%20%7B%22message%22:%20%22Art%C4%B1k%20kaydedilen%20%C3%A7alma%20listenizi%20y%C3%BCr%C3%BCtmek%20i%C3%A7in%20m%C3%BCzik%20%C3%A7alar%C4%B1n%C4%B1zda%20a%C3%A7abilirsiniz.%22%7D,%0A%0A%20%22ummySfTitle%22:%20%7B%22message%22:%20%22HD%20veya%20MP3%22%7D,%0A%20%22ummyMenuItem%22:%20%7B%22message%22%20:%20%22%5B'Ummy%20ile%20',%7Bspan:%7B%7D%7D%5D%22%7D,%0A%20%22ummyMenuInfo%22:%20%7B%22message%22:%20%22%5B%7Bp:%7Btext:'Ummy%20Video%20%C4%B0ndirici%5C%5C'yi%20y%C3%BCkleyin%20ve%20en%20sevdi%C4%9Finiz%20HD%20videolar%C4%B1%20ya%20da%20MP3%5C%5C'leri%20hemen%20indirin.'%7D%7D,%7Bp:%7Bclass:'center',append:%5B%7Ba:%7Bclass:'green-btn-2%20arrow',href:'%7Burl%7D',target:'_blank',text:'%C4%B0ndir'%7D%7D%5D%7D%7D,%7Bp:%7Bappend:%5B'Kurulumdan%20sonra%20',%7Bimg:%7Bsrc:'#'%7D%7D,'%20simgesine%20t%C4%B1klayarak%20dosya%20indirme%20i%C5%9Flemini%20otomatik%20olarak%20ba%C5%9Flatabilirsiniz.'%5D%7D%7D%5D%22%7D,%0A%20%22warningPopupTitle%22:%20%7B%22message%22:%20%22Taray%C4%B1c%C4%B1%20ayarlar%C4%B1n%C4%B1%20kontrol%20edin%22%7D,%0A%20%22warningPopupDesc%22:%20%7B%22message%22:%20%22%5C%22Dosyalar%C4%B1n%20nereye%20kaydedilece%C4%9Fini%20her%20seferinde%20sor%5C%22%20se%C3%A7ene%C4%9Fi%20kapal%C4%B1%20olmal%C4%B1d%C4%B1r.%22%7D,%0A%20%22readMore%22:%20%7B%22message%22:%20%22Daha%20fazla%22%7D,%0A%20%22noWarning%22:%20%7B%22message%22:%20%22Bildirme%22%7D,%0A%20%22cancel%22:%20%7B%22message%22:%20%22%C4%B0ptal%22%7D,%0A%20%22continue%22:%20%7B%22message%22:%20%22Devam%22%7D,%0A%20%22beforeDownloadPopupWarn%22:%20%7B%22message%22:%20%22Uyar%C4%B1!%20%C4%B0ndirme%20i%C5%9Flemi%20iptal%20edilemez%20ya%20da%20ertelenemez.%22%7D,%0A%0A%20%22vkInfo%22:%20%7B%22message%22:%20%22Bilgi%22%7D,%0A%20%22vkInfoTitle%22:%20%7B%22message%22:%20%22Dosya%20boyutu%20ve%20bit%20h%C4%B1z%C4%B1%22%7D,%0A%20%22vkMp3LinksNotFound%22:%20%7B%22message%22:%20%22MP3%20dosyalar%C4%B1%20i%C3%A7in%20ba%C4%9Flant%C4%B1lar%20bulunam%C4%B1yor%22%7D,%0A%20%22vkPhotoLinksNotFound%22:%20%7B%22message%22:%20%22Foto%C4%9Fraflar%20bulunamad%C4%B1%22%7D,%0A%20%22vkDownloadPhotoAlbum%22:%20%7B%22message%22:%20%22Alb%C3%BCm%C3%BC%20indir%22%7D,%0A%20%22vkDownloadAllPhotoAlbums%22:%20%7B%22message%22:%20%22T%C3%BCm%20alb%C3%BCmleri%20indir%22%7D,%0A%20%22vkFoundPhotos%22:%20%7B%22message%22:%20%22Bulunan%20foto%C4%9Fraflar%22%7D,%0A%20%22vkNotAvailablePhotos%22:%20%7B%22message%22:%20%22%25d%20resim%20ge%C3%A7ici%20olarak%20kullan%C4%B1lam%C4%B1yor%22%7D,%0A%20%22vkFoundLinks%22:%20%7B%22message%22:%20%22Bulunan%20ba%C4%9Flant%C4%B1lar%22%7D,%0A%20%22vkFoundOf%22:%20%7B%22message%22:%20%22den%22%7D,%0A%20%22vkShowAs%22:%20%7B%22message%22:%20%22Olarak%20g%C3%B6ster%22%7D,%0A%20%22vkListOfLinks%22:%20%7B%22message%22:%20%22Ba%C4%9Flant%C4%B1%20listesi%22%7D,%0A%20%22vkListOfLinksInstruction%22:%20%7B%22message%22:%20%22%5B'T%C3%BCm%20foto%C4%9Fraflar%C4%B1%20indirmek%20i%C3%A7in%20ba%C4%9Flant%C4%B1%20listesini%20kopyalay%C4%B1n%20ve%20',%7Ba:%7Bhref:'http://en.wikipedia.org/wiki/Download_manager',text:'indirme%20y%C3%B6neticisine'%7D%7D,'%20yap%C4%B1%C5%9Ft%C4%B1r%C4%B1n.%20Kurulu%20bir%20indirme%20y%C3%B6neticiniz%20yoksa%20',%7Ba:%7Bhref:'http://www.freedownloadmanager.org/',text:'Free%20Download%20Manager'%7D%7D,'%20y%C3%BCklemenizi%20tavsiye%20ederiz.'%5D%22%7D,%0A%20%22vkTableOfThumbnails%22:%20%7B%22message%22:%20%22K%C3%BC%C3%A7%C3%BCkk%20resimler%20tablosu%22%7D,%0A%20%22vkListOfPhotos%22:%20%7B%22message%22:%20%22Foto%C4%9Fraf%20listesi%22%7D,%0A%20%22vkListOfPhotosInstruction%22:%20%7B%22message%22:%20%22%C4%B0ndirmek%20i%C3%A7in%20foto%C4%9Fraf%C4%B1n%20%C3%BCzerine%20t%C4%B1klay%C4%B1n.%22%7D,%0A%20%22vkKbps%22:%20%7B%22message%22:%20%22kbps%22%7D,%0A%20%22vkFileSizeByte%22:%20%7B%22message%22:%20%22B%22%7D,%0A%20%22vkFileSizeKByte%22:%20%7B%22message%22:%20%22kB%22%7D,%0A%20%22vkFileSizeMByte%22:%20%7B%22message%22:%20%22MB%22%7D,%0A%20%22vkFileSizeGByte%22:%20%7B%22message%22:%20%22GB%22%7D,%0A%20%22vkFileSizeTByte%22:%20%7B%22message%22:%20%22TB%22%7D,%0A%20%22vkDownloadFromYoutube%22:%20%7B%22message%22:%20%22%5B'%C4%B0ndirme:%20',%7Ba:%7Bhref:'%7Burl%7D',text:'video%20sayfas%C4%B1n%C4%B1'%7D%7D,'%20a%C3%A7%C4%B1n%20ve%20oynat%C4%B1c%C4%B1%20%C3%BCzerindeki%20%5C%22%C4%B0ndir%5C%22%20d%C3%BCmesine%20bas%C4%B1n'%5D%22%7D,%0A%20%22vkFoundFiles%22:%20%7B%22message%22:%20%22Bulunan%20dosyalar:%20%25d%22%7D,%0A%0A%20%22shareIn%22:%20%7B%22message%22:%20%22%25w%20%C3%BCzerinden%20payla%C5%9F%22%7D,%0A%20%22socialDesc%22:%20%7B%22message%22:%20%22SaveFrom.net%20Helper,%20sadece%20bir%20t%C4%B1klama%20ile%20YouTube.com,%20Facebook.com,%20VK.com%20ve%2040'dan%20fazla%20siteden%20%C3%BCcretsiz%20olarak%20dosya%20indirmenizi%20sa%C4%9Flar.%22%7D,%0A%0A%20%22tutorialS1Title%22:%20%7B%22message%22:%20%22Size%20harika%20bir%20haberimiz%20var!%22%7D,%0A%20%22tutorialS1Main%22:%20%7B%22message%22:%20%22%5B'SaveFrom.net%20Helper%20',%7Bimg:%20%7Bsrc:%20'#logo'%7D%7D,%20'%20ba%C5%9Far%C4%B1yla%20kuruldu.%20Art%C4%B1k%20tek%20bir%20t%C4%B1klama%20ile%20YouTube%5C%5C'dan%20istedi%C4%9Finiz%20videoyu%20indirebilirsiniz'%5D%22%7D,%0A%20%22tutorialS1Arrow%22:%20%7B%22message%22:%20%22%5B'Nas%C4%B1l%20oldu%C4%9Funu%20%C3%B6%C4%9Frenmek%20ister%20misiniz?%20Buraya%20t%C4%B1klay%C4%B1n'%5D%22%7D,%0A%20%22tutorialS2Main%22:%20%7B%22message%22:%20%22Sadece%20indirmek%20istedi%C4%9Finiz%20videonun%20format%C4%B1n%C4%B1%20se%C3%A7in%20ve%20%5C%22%C4%B0ndir%5C%22%20butonuna%20t%C4%B1klay%C4%B1n%22%7D,%0A%20%22tutorialS3History%22:%20%7B%22message%22:%20%22Ge%C3%A7mi%C5%9F%22%7D,%0A%20%22tutorialS3Main%22:%20%7B%22message%22:%20%22%5B'Web%20ge%C3%A7mi%C5%9Finizdeki%20videolar%C4%B1%20indirmek%20ister%20misiniz?',%20%7Bbr:%7B%7D%7D,%20'%20Sadece%20daha%20%C3%B6nce%20izledi%C4%9Finiz%20bir%20videonun%20%C3%B6nizlemesi%20%C3%BCzerindeki%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20'%20simgesine%20t%C4%B1klay%C4%B1n'%5D%22%7D,%0A%20%22tutorialS4Main%22:%20%7B%22message%22:%20%22%5B'Videolar%C4%B1%20izlemenize%20gerek%20yok%20%E2%80%94%20sadece%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20'%20simgesine%20t%C4%B1klay%C4%B1n,%20kalite%20de%C4%9Ferini%20se%C3%A7in%20ve%20an%C4%B1nda%20indirin.%20Olduk%C3%A7a%20kolay,%20de%C4%9Fil%20mi?'%5D%22%7D,%0A%20%22tutorialS5Title%22:%20%7B%22message%22:%20%22Hemen%20SaveFrom.net%20Helper'in%20keyfini%20%C3%A7%C4%B1karmaya%20ba%C5%9Flay%C4%B1n!%22%7D,%0A%20%22tutorialS5Main%22:%20%7B%22message%22:%20%22%5B'Hala%20kafan%C4%B1za%20tak%C4%B1lan%20sorular%20m%C4%B1%20var?%20D%C3%BC%C5%9F%C3%BCncelerinizi%20payla%C5%9Fmak%20m%C4%B1%20istiyorsunuz?%20',%7Ba:%20%7Btext:%20'Destek%20sayfam%C4%B1z%C4%B1',%20href:%20'#support'%7D%7D,'%20ziyaret%20edin%20veya%20',%7Ba:%20%7Btext:%20'Facebook',%20href:%20'#fb'%7D%7D,'%20toplulu%C4%9Fumuza%20kat%C4%B1l%C4%B1n'%5D%22%7D,%0A%0A%20%22tutorialTooltipText%22:%20%7B%22message%22:%20%22%5B%7Bb:%20%7Btext:%20'%C4%B0ndirmek'%7D%7D,%20'%20i%C3%A7in%20sadece%20butona%20t%C4%B1klay%C4%B1n'%5D%22%7D,%0A%0A%20%22ummyTooltipConfirm%22:%20%7B%22message%22:%20%22%5B%7Bimg:%7B%7D%7D,'%20Ummy%20Video%20Downloader%20program%C4%B1n%C4%B1%20daha%20%C3%B6nce%20y%C3%BCklediniz%20mi?'%5D%22%7D,%0A%20%22yes%22:%20%7B%22message%22:%20%22Evet%22%7D,%0A%20%22no%22:%20%7B%22message%22:%20%22Hay%C4%B1r%22%7D,%0A%20%22tooltipHide%22:%20%7B%22message%22:%20%22Bu%20mesaj%C4%B1%20tekrar%20g%C3%B6sterme%22%7D%0A%7D";
  _languageList.uk = "%7B%0A%20%22extName%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%22%7D,%0A%20%22extDescription%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D1%83%D0%B9%D1%82%D0%B5%20%D0%B7%20%C2%AB%D0%92%D0%9A%D0%BE%D0%BD%D1%82%D0%B0%D0%BA%D1%82%D0%B5%C2%BB,%20YouTube,%20Facebook%20%D1%96%20%D1%89%D0%B5%2040%20%D1%81%D0%B0%D0%B9%D1%82%D1%96%D0%B2%20%D0%B7%D0%B0%201%20%D0%BA%D0%BB%D1%96%D0%BA.%22%7D,%0A%0A%20%22extNameLite%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%20lite%22%7D,%0A%20%22extDescriptionLite%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D1%83%D0%B9%D1%82%D0%B5%20%D0%B7%20%C2%AB%D0%92%D0%9A%D0%BE%D0%BD%D1%82%D0%B0%D0%BA%D1%82%D0%B5%C2%BB,%20YouTube,%20Facebook%20%D1%96%20%D1%89%D0%B5%2040%20%D1%81%D0%B0%D0%B9%D1%82%D1%96%D0%B2%20%D0%B7%D0%B0%201%20%D0%BA%D0%BB%D1%96%D0%BA.%22%7D,%0A%0A%20%22lang%22:%20%7B%22message%22:%20%22uk%22%7D,%0A%0A%20%22titleDefault%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%22%7D,%0A%20%22titleDesabled%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%20%D0%B2%D0%B8%D0%BC%D0%BA%D0%BD%D0%B5%D0%BD%D0%B8%D0%B9%22%7D,%0A%0A%20%22menuEnable%22:%20%7B%22message%22:%20%22%D0%A3%D0%B2%D1%96%D0%BC%D0%BA%D0%BD%D1%83%D1%82%D0%B8%22%7D,%0A%20%22menuDisable%22:%20%7B%22message%22:%20%22%D0%92%D0%B8%D0%BC%D0%BA%D0%BD%D1%83%D1%82%D0%B8%22%7D,%0A%0A%20%22showButton%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7%D1%83%D0%B2%D0%B0%D1%82%D0%B8%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20%D1%80%D0%BE%D0%B7%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%BD%D1%8F%22%7D,%0A%0A%20%22copy%22:%20%7B%22message%22:%20%22%D0%9A%D0%BE%D0%BF%D1%96%D1%8E%D0%B2%D0%B0%D1%82%D0%B8%22%7D,%0A%20%22download%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%22%7D,%0A%20%22downloadTitle%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D1%82%D0%B8%D1%81%D0%BD%D1%96%D1%82%D1%8C%20%D0%BD%D0%B0%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F,%20%D1%83%D1%82%D1%80%D0%B8%D0%BC%D1%83%D1%8E%D1%87%D0%B8%20%D0%BA%D0%BB%D0%B0%D0%B2%D1%96%D1%88%D1%83%20Alt%20%D1%87%D0%B8%20Ctrl,%20%D1%89%D0%BE%D0%B1%20%D0%B7%D0%B1%D0%B5%D1%80%D0%B5%D0%B3%D1%82%D0%B8%20%D1%84%D0%B0%D0%B9%D0%BB.%22%7D,%0A%20%22noLinksFound%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D0%B2%D0%B4%D0%B0%D0%BB%D0%BE%D1%81%D1%8F%20%D0%B7%D0%BD%D0%B0%D0%B9%D1%82%D0%B8%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22more%22:%20%7B%22message%22:%20%22%D0%A9%D0%B5%22%7D,%0A%20%22close%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%BA%D1%80%D0%B8%D1%82%D0%B8%22%7D,%0A%20%22kbps%22:%20%7B%22message%22:%20%22%D0%BA%D0%B1/%D1%81%22%7D,%0A%20%22withoutAudio%22:%20%7B%22message%22:%20%22%D0%B1%D0%B5%D0%B7%20%D0%B0%D1%83%D0%B4%D1%96%D0%BE%22%7D,%0A%20%22size%22:%20%7B%22message%22:%20%22%D1%80%D0%BE%D0%B7%D0%BC%D1%96%D1%80%22%7D,%0A%0A%20%22subtitles%22:%20%7B%22message%22:%20%22%D0%A1%D1%83%D0%B1%D1%82%D0%B8%D1%82%D1%80%D0%B8%22%7D,%0A%20%22playlist%22:%20%7B%22message%22:%20%22%D0%9F%D0%BB%D0%B5%D0%B9%D0%BB%D1%96%D1%81%D1%82%22%7D,%0A%20%22filelist%22:%20%7B%22message%22:%20%22%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D1%84%D0%B0%D0%B9%D0%BB%D1%96%D0%B2%22%7D,%0A%20%22downloadWholePlaylist%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D0%B2%D0%B5%D1%81%D1%8C%20%D0%BF%D0%BB%D0%B5%D0%B9%D0%BB%D1%96%D1%81%D1%82%22%7D,%0A%0A%20%22getFileSizeTitle%22:%20%7B%22message%22:%20%22%D0%92%D0%B8%D0%B7%D0%BD%D0%B0%D1%87%D0%B8%D1%82%D0%B8%20%D1%80%D0%BE%D0%B7%D0%BC%D1%96%D1%80%20%D1%84%D0%B0%D0%B9%D0%BB%D1%83%22%20%7D,%0A%20%22getFileSizeFailTitle%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D0%B2%D0%B4%D0%B0%D0%BB%D0%BE%D1%81%D1%8F%20%D0%B2%D0%B8%D0%B7%D0%BD%D0%B0%D1%87%D0%B8%D1%82%D0%B8%20%D1%80%D0%BE%D0%B7%D0%BC%D1%96%D1%80%20%D1%84%D0%B0%D0%B9%D0%BB%D1%83.%20%D0%A1%D0%BF%D1%80%D0%BE%D0%B1%D1%83%D0%B9%D1%82%D0%B5%20%D1%89%D0%B5%20%D1%80%D0%B0%D0%B7.%22%7D,%0A%0A%20%22lmButtonTitle%22:%20%7B%22message%22:%20%22%D0%9E%D1%82%D1%80%D0%B8%D0%BC%D0%B0%D0%B9%20%D0%BF%D1%80%D1%8F%D0%BC%D0%B5%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%0A%20%22downloadFromCurrentPage%22:%20%7B%22message%22:%20%22%D0%9F%D0%B5%D1%80%D0%B5%D0%B9%D1%82%D0%B8%20%D0%BD%D0%B0%20SaveFrom.net%22%7D,%0A%20%22updateLinks%22:%20%7B%22message%22:%20%22%D0%92%D1%96%D0%B4%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D0%B8%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22updateLinksNotification%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%20%D0%BE%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D1%96%22%7D,%0A%20%22downloadMP3Files%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D0%B8%20%D0%B0%D1%83%D0%B4%D1%96%D0%BE%20%D1%84%D0%B0%D0%B9%D0%BB%D0%B8%22%7D,%0A%20%22downloadPlaylist%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D0%B8%20%D0%BF%D0%BB%D0%B5%D0%B9%D0%BB%D0%B8%D1%81%D1%82%22%7D,%0A%20%22downloadPhotos%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D0%B8%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D1%96%D1%97%22%7D,%0A%20%22installFullVersion%22:%20%7B%22message%22:%20%22%D0%92%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D0%B8%20%D0%BF%D0%BE%D0%B2%D0%BD%D1%83%20%D0%B2%D0%B5%D1%80%D1%81%D1%96%D1%8E%22%7D,%0A%20%22disable%22:%20%7B%22message%22:%20%22%D0%92%D0%B8%D0%BC%D0%BA%D0%BD%D1%83%D1%82%D0%B8%22%7D,%0A%20%22showOptions%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D0%BB%D0%B0%D1%88%D1%82%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22reportBug%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%B2%D1%96%D0%B4%D0%BE%D0%BC%D0%B8%D1%82%D0%B8%20%D0%BF%D1%80%D0%BE%20%D0%BF%D0%BE%D0%BC%D0%B8%D0%BB%D0%BA%D1%83%22%7D,%0A%20%22openPoll%22:%20%7B%22message%22:%20%22%D0%A1%D1%82%D0%B0%D1%82%D0%B8%20%D0%BA%D1%80%D0%B0%D1%89%D0%B5%22%7D,%0A%20%22disableModule%22:%20%7B%22message%22:%20%22%D0%92%D0%B8%D0%BC%D0%BA%D0%BD%D1%83%D1%82%D0%B8%20%D0%BD%D0%B0%20%D1%86%D1%8C%D0%BE%D0%BC%D1%83%20%D1%81%D0%B0%D0%B9%D1%82%D1%96%22%7D,%0A%20%22enableModule%22:%20%7B%22message%22:%20%22%D0%A3%D0%B2%D1%96%D0%BC%D0%BA%D0%BD%D1%83%D1%82%D0%B8%20%D0%BD%D0%B0%20%D1%86%D1%8C%D0%BE%D0%BC%D1%83%20%D1%81%D0%B0%D0%B9%D1%82%D1%96%22%7D,%0A%20%22enableDisableModule%22:%20%7B%22message%22:%20%22%D0%92%D0%BA%D0%BB./%D0%B2%D0%B8%D0%BC%D0%BA.%20%D0%BD%D0%B0%20%D1%86%D1%8C%D0%BE%D0%BC%D1%83%20%D1%81%D0%B0%D0%B9%D1%82%D1%96%22%7D,%0A%20%22showHideButton%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7./%D1%81%D0%BA%D1%80.%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20%D1%80%D0%BE%D0%B7%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22updateTo%22:%20%7B%22message%22:%20%22%D0%9E%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D0%B8%20%D0%B4%D0%BE%20%25d%22%7D,%0A%0A%20%22aboutPage%22:%20%7B%22message%22:%20%22%D0%9F%D1%80%D0%BE%20%D1%80%D0%BE%D0%B7%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22aboutTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%22%7D,%0A%20%22aboutVersion%22:%20%7B%22message%22:%20%22%D0%92%D0%B5%D1%80%D1%81%D1%96%D1%8F%22%7D,%0A%20%22aboutDescription%22:%20%7B%22message%22:%20%22%D0%94%D0%BE%D0%B7%D0%B2%D0%BE%D0%BB%D1%8F%D1%94%20%D0%BE%D1%82%D1%80%D0%B8%D0%BC%D1%83%D0%B2%D0%B0%D1%82%D0%B8%20%D0%BF%D1%80%D1%8F%D0%BC%D1%96%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%20%D0%B4%D0%BB%D1%8F%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B5%D0%BD%D0%BD%D1%8F%20%D0%B7%20%D0%BF%D0%BE%D0%BD%D0%B0%D0%B4%2040%20%D1%81%D0%B0%D0%B9%D1%82%D1%96%D0%B2,%20%D1%81%D0%B5%D1%80%D0%B5%D0%B4%20%D1%8F%D0%BA%D0%B8%D1%85%20VK.com,%20YouTube.com%20%D1%82%D0%B0%20%D1%96%D0%BD%D1%88%D1%96.%22%7D,%0A%20%22aboutDescriptionLite%22:%20%7B%22message%22:%20%22%D0%94%D0%BE%D0%B7%D0%B2%D0%BE%D0%BB%D1%8F%D1%94%20%D0%BE%D1%82%D1%80%D0%B8%D0%BC%D1%83%D0%B2%D0%B0%D1%82%D0%B8%20%D0%BF%D1%80%D1%8F%D0%BC%D1%96%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%20%D0%B4%D0%BB%D1%8F%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B5%D0%BD%D0%BD%D1%8F%20%D0%B7%20%D0%BF%D0%BE%D0%BD%D0%B0%D0%B4%2040%20%D1%81%D0%B0%D0%B9%D1%82%D1%96%D0%B2,%20%D1%81%D0%B5%D1%80%D0%B5%D0%B4%20%D1%8F%D0%BA%D0%B8%D1%85%20VK.com%20%D1%82%D0%B0%20%D1%96%D0%BD%D1%88%D1%96.%22%7D,%0A%20%22aboutSupported%22:%20%7B%22message%22:%20%22%D0%A0%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B8,%20%D1%8F%D0%BA%D1%96%20%D0%BF%D1%96%D0%B4%D1%82%D1%80%D0%B8%D0%BC%D1%83%D1%8E%D1%82%D1%8C%D1%81%D1%8F%22%7D,%0A%20%22homePage%22:%20%7B%22message%22:%20%22%D0%94%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D1%8F%20%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B0%22%7D,%0A%0A%20%22optionsTitle%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%20-%20%D0%9D%D0%B0%D0%BB%D0%B0%D1%88%D1%82%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22optionsHandleLinks%22:%20%7B%22message%22:%20%22%D0%9E%D0%B1%D1%80%D0%BE%D0%B1%D0%BB%D1%8F%D1%82%D0%B8%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22optionsFileHostings%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%BE%D0%B1%D0%BC%D1%96%D0%BD%D0%BD%D0%B8%D0%BA%D0%B8%22%7D,%0A%20%22optionsMediaHostings%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%20%D0%BC%D0%B5%D0%B4%D1%96%D0%B0%D1%85%D0%BE%D1%81%D1%82%D0%B8%D0%BD%D0%B3%D0%B8%22%7D,%0A%20%22optionsModules%22:%20%7B%22message%22:%20%22%D0%9C%D0%BE%D0%B4%D1%83%D0%BB%D1%96%22%7D,%0A%20%22optionsYoutube%22:%20%7B%22message%22:%20%22YouTube%22%7D,%0A%20%22optionsYTHideLinks%22:%20%7B%22message%22:%20%22%D0%A1%D1%85%D0%BE%D0%B2%D0%B0%D1%82%D0%B8%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22optionsDailymotion%22:%20%7B%22message%22:%20%22Dailymotion%22%7D,%0A%20%22optionsVimeo%22:%20%7B%22message%22:%20%22Vimeo%22%7D,%0A%20%22optionsFacebook%22:%20%7B%22message%22:%20%22Facebook%22%7D,%0A%20%22optionsSoundcloud%22:%20%7B%22message%22:%20%22SoundCloud%22%7D,%0A%20%22optionsVkontakte%22:%20%7B%22message%22:%20%22%D0%92%D0%9A%D0%BE%D0%BD%D1%82%D0%B0%D0%BA%D1%82%D0%B5%22%7D,%0A%20%22optionsOdnoklassniki%22:%20%7B%22message%22:%20%22%D0%9E%D0%B4%D0%BD%D0%BE%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D0%BD%D0%B8%D0%BA%D0%B8%22%7D,%0A%20%22optionsMailru%22:%20%7B%22message%22:%20%22%D0%9C%D0%BE%D0%B9%20%D0%BC%D0%B8%D1%80%22%7D,%0A%20%22optionsInstagram%22:%20%7B%22message%22:%20%22Instagram%22%7D,%0A%20%22optionsRutube%22:%20%7B%22message%22:%20%22Rutube%22%7D,%0A%20%22optionsBitrate%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7%D1%83%D0%B2%D0%B0%D1%82%D0%B8%20%D0%B1%D1%96%D1%82%D1%80%D0%B5%D0%B9%D1%82%20%D0%BE%D0%B4%D1%80%D0%B0%D0%B7%D1%83%22%7D,%0A%20%22optionsSovetnikEnabled%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D1%80%D0%B0%D0%B4%D0%BD%D0%B8%D0%BA%22%7D,%0A%20%22optionsShowUmmyInfo%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7%D1%83%D0%B2%D0%B0%D1%82%D0%B8%20%D0%BF%D1%96%D0%B4%D0%BA%D0%B0%D0%B7%D0%BA%D0%B8%20%D0%B4%D0%BB%D1%8F%20Ummy%20Video%20Downloader%22%7D,%0A%20%22optionsGmNativeDownload%22:%20%7B%22message%22:%20%22%D0%A0%D0%BE%D0%B7%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D0%B9%20%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%20%D0%B7%D0%B0%D0%BA%D0%B0%D1%87%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22optionsShowUmmyBtn%22:%20%7B%22message%22:%20%22%D0%92%D1%96%D0%B4%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B0%D1%82%D0%B8%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20Ummy%22%7D,%0A%20%22optionsShowMp3Btn%22:%20%7B%22message%22:%20%22%D0%92%D1%96%D0%B4%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B0%D1%82%D0%B8%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20mp3%22%7D,%0A%20%22optionsAviaBarEnabled%22:%20%7B%22message%22:%20%22Cheap%20Flights%20Advisor%22%7D,%0A%0A%20%22menuDownloadFromCurrentPage%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D1%84%D0%B0%D0%B9%D0%BB%D0%B8%20%D0%B7%20%D0%BF%D0%BE%D1%82%D0%BE%D1%87%D0%BD%D0%BE%D1%97%20%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D0%B8%20%D0%B7%D0%B0%20%D0%B4%D0%BE%D0%BF%D0%BE%D0%BC%D0%BE%D0%B3%D0%BE%D1%8E%20%D1%81%D0%B5%D1%80%D0%B2%D1%96%D1%81%D1%83%20SaveFrom.net%22%7D,%0A%20%22menuUpdateLinks%22:%20%7B%22message%22:%20%22%D0%9D%D0%B0%D1%82%D0%B8%D1%81%D0%BD%D1%96%D1%82%D1%8C,%20%D1%8F%D0%BA%D1%89%D0%BE%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%20%D0%B4%D0%BB%D1%8F%20%D1%81%D0%BA%D0%B0%D1%87%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%8F%20%D0%BD%D0%B5%20%D0%B7'%D1%8F%D0%B2%D0%BB%D1%8F%D1%94%D1%82%D1%8C%D1%81%D1%8F%22%7D,%0A%20%22menuDownloadMP3Files%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D0%B2%D1%81%D1%96%20%D0%B7%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D1%96%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D1%86%D1%96%20%D0%B0%D1%83%D0%B4%D1%96%D0%BE%D1%84%D0%B0%D0%B9%D0%BB%D0%B8%22%7D,%0A%20%22menuDownloadPlaylist%22:%20%7B%22message%22:%20%22%D0%A4%D0%BE%D1%80%D0%BC%D1%83%D1%94%20%D1%82%D0%B0%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D1%83%D1%94%20%D0%BF%D0%BB%D0%B5%D0%B9%D0%BB%D0%B8%D1%81%D1%82%20%D0%B7%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D0%BD%D1%8F%D0%BC%D0%B8%20%D0%BD%D0%B0%20%D0%B0%D1%83%D0%B4%D1%96%D0%BE%D1%84%D0%B0%D0%B9%D0%BB%D0%B8%22%7D,%0A%20%22menuDownloadPhotos%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D0%B2%D1%81%D1%96%20%D0%B7%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D1%96%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D1%86%D1%96%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D1%96%D1%97%22%7D,%0A%20%22menuReportBug%22:%20%7B%22message%22:%20%22%D0%94%D0%B0%D0%B9%D1%82%D0%B5%20%D0%BD%D0%B0%D0%BC%20%D0%B7%D0%BD%D0%B0%D1%82%D0%B8,%20%D1%8F%D0%BA%D1%89%D0%BE%20%D0%B2%D0%B8%D0%BD%D0%B8%D0%BA%D0%BB%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B8%22%7D,%0A%20%22menuShowOptions%22:%20%7B%22message%22:%20%22%D0%92%D0%BA%D0%BB.%20/%20%D0%92%D0%B8%D0%BC%D0%BA.%20%D0%BF%D1%96%D0%B4%D1%82%D1%80%D0%B8%D0%BC%D1%83%D0%B2%D0%B0%D0%BD%D1%96%20%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B8%20%D1%96%20%D0%BC%D0%BE%D0%B6%D0%BB%D0%B8%D0%B2%D0%BE%D1%81%D1%82%D1%96%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%D0%B0%22%7D,%0A%20%22menuEnableExtension%22:%20%7B%22message%22:%20%22%22%7D,%0A%20%22menuOpenPoll%22:%20%7B%22message%22:%20%22%D0%91%D1%83%D0%B4%D1%8C%20%D0%BB%D0%B0%D1%81%D0%BA%D0%B0,%20%D0%BE%D1%86%D1%96%D0%BD%D1%96%D1%82%D1%8C%20%D1%8F%D0%BA%D1%96%D1%81%D1%82%D1%8C%20%D1%80%D0%BE%D0%B7%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%BD%D1%8F%20%5C%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%5C%22%22%7D,%0A%0A%20%22quality%22:%20%7B%22message%22:%20%22%D0%AF%D0%BA%D1%96%D1%81%D1%82%D1%8C%22%7D,%0A%20%22qualityNote%22:%20%7B%22message%22:%20%22%D0%AF%D0%BA%D1%89%D0%BE%20%D0%B2%D1%96%D0%B4%D0%B5%D0%BE%20%D0%B2%20%D0%BF%D0%BE%D1%82%D1%80%D1%96%D0%B1%D0%BD%D1%96%D0%B9%20%D1%8F%D0%BA%D0%BE%D1%81%D1%82%D1%96%20%D0%BD%D0%B5%D0%BC%D0%B0%D1%94,%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%94%D1%82%D1%8C%D1%81%D1%8F%20%D0%BD%D0%B0%D0%B9%D0%BA%D1%80%D0%B0%D1%89%D0%B5%20%D0%B7%20%D0%BC%D0%BE%D0%B6%D0%BB%D0%B8%D0%B2%D0%BE%D0%B3%D0%BE.%22%7D,%0A%20%22filelistTitle%22:%20%7B%22message%22:%20%22%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D0%B7%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%B8%D1%85%20%D1%84%D0%B0%D0%B9%D0%BB%D1%96%D0%B2%22%7D,%0A%20%22filelistInstruction%22:%20%7B%22message%22:%20%22%5B'%D0%A9%D0%BE%D0%B1%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D1%83%D1%81%D1%96%20%D1%84%D0%B0%D0%B9%D0%BB%D0%B8,%20%D1%81%D0%BA%D0%BE%D0%BF%D1%96%D1%8E%D0%B9%D1%82%D0%B5%20%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D1%8C%20%D1%96%20%D0%B2%D1%81%D1%82%D0%B0%D0%B2%D1%82%D0%B5%20%D0%B9%D0%BE%D0%B3%D0%BE%20%D1%83%20',%7Ba:%7Bhref:'http://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D0%BA',text:'%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B5%D0%BD%D1%8C'%7D%7D,'.%20%D0%AF%D0%BA%D1%89%D0%BE%20%D1%83%20%D0%B2%D0%B0%D1%81%20%D0%BD%D0%B5%20%D0%B2%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B9%20%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B5%D0%BD%D1%8C,%20%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D1%83%D1%94%D0%BC%D0%BE%20%D0%B2%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D0%B8%20',%7Ba:%7Bhref:'http://www.westbyte.com/dm/',text:'Download%20Master'%7D%7D,'.'%5D%22%7D,%0A%20%22playlistTitle%22:%20%7B%22message%22:%20%22%D0%9F%D0%BB%D0%B5%D0%B9%D0%BB%D1%96%D1%81%D1%82%22%7D,%0A%20%22playlistInstruction%22:%20%7B%22message%22:%20%22%D0%97%D0%B1%D0%B5%D1%80%D0%B5%D0%B6%D0%B5%D0%BD%D0%B8%D0%B9%20%D0%BF%D0%BB%D0%B5%D0%B9%D0%BB%D1%96%D1%81%D1%82%20%D0%BC%D0%BE%D0%B6%D0%BD%D0%B0%20%D0%B2%D1%96%D0%B4%D0%BA%D1%80%D0%B8%D1%82%D0%B8%20%D1%83%20%D0%BF%D0%BB%D0%B5%D1%94%D1%80%D1%96%20%D0%B4%D0%BB%D1%8F%20%D0%B2%D1%96%D0%B4%D1%82%D0%B2%D0%BE%D1%80%D0%B5%D0%BD%D0%BD%D1%8F.%22%7D,%0A%0A%20%22ummySfTitle%22:%20%7B%22message%22:%20%22HD%20%D0%B0%D0%B1%D0%BE%20MP3%22%7D,%0A%20%22ummyMenuItem%22:%20%7B%22message%22%20:%20%22%5B%7Bspan:%7B%7D%7D,'%20%D0%B7%20%D0%B4%D0%BE%D0%BC%D0%BE%D0%BC%D0%BE%D0%B3%D0%BE%D1%8E%20Ummy'%5D%22%7D,%0A%20%22ummyMenuInfo%22:%20%7B%22message%22:%20%22%5B%7Bp:%7Btext:'%D0%92%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D1%96%D1%82%D1%8C%20%D0%B1%D0%B5%D0%B7%D0%BA%D0%BE%D1%88%D1%82%D0%BE%D0%B2%D0%BD%D0%B8%D0%B9%20Ummy%20Video%20Downloader%20%D1%96%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D1%83%D0%B9%D1%82%D0%B5%20%D1%81%D0%B2%D0%BE%D1%97%20%D1%83%D0%BB%D1%8E%D0%B1%D0%BB%D0%B5%D0%BD%D1%96%20%D0%B2%D1%96%D0%B4%D0%B5%D0%BE%20%D0%B2%20HD%20%D0%B0%D0%B1%D0%BE%20%D0%B2%20MP3.'%7D%7D,%7Bp:%7Bclass:'center',append:%5B%7Ba:%7Bclass:'green-btn-2%20arrow',href:'%7Burl%7D',target:'_blank',text:'%D0%A1%D0%9A%D0%90%D0%A7%D0%90%D0%A2%D0%98'%7D%7D%5D%7D%7D,%7Bp:%7Bappend:%5B'%D0%9F%D1%96%D1%81%D0%BB%D1%8F%20%D0%B2%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%BD%D1%8F%20%D0%BF%D1%80%D0%B8%20%D0%BA%D0%BB%D1%96%D1%86%D1%96%20%D0%BD%D0%B0%20',%7Bimg:%7Bsrc:'#'%7D%7D,'%20%D0%B7%D0%B0%D0%BA%D0%B0%D1%87%D0%BA%D0%B0%20%D0%B1%D1%83%D0%B4%D0%B5%20%D0%BF%D0%BE%D1%87%D0%B8%D0%BD%D0%B0%D1%82%D0%B8%D1%81%D1%8F%20%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%BD%D0%BE.'%5D%7D%7D%5D%22%7D,%0A%20%22warningPopupTitle%22:%20%7B%22message%22:%20%22%D0%9F%D0%B5%D1%80%D0%B5%D0%B2%D1%96%D1%80%D1%82%D0%B5%20%D0%BD%D0%B0%D0%BB%D0%B0%D1%88%D1%82%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%8F%20%D0%B1%D1%80%D0%B0%D1%83%D0%B7%D0%B5%D1%80%D0%B0%22%7D,%0A%20%22warningPopupDesc%22:%20%7B%22message%22:%20%22%D0%92%D0%B8%D0%B1%D1%96%D1%80%20%D0%BF%D0%B0%D0%BF%D0%BA%D0%B8%20%D0%BF%D1%80%D0%B8%20%D1%81%D0%BA%D0%B0%D1%87%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%96%20%D0%BF%D0%BE%D0%B2%D0%B8%D0%BD%D0%B5%D0%BD%20%D0%B1%D1%83%D1%82%D0%B8%20%D0%B2%D1%96%D0%B4%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B9.%22%7D,%0A%20%22readMore%22:%20%7B%22message%22:%20%22%D0%94%D0%B5%D1%82%D0%B0%D0%BB%D1%8C%D0%BD%D1%96%D1%88%D0%B5...%22%7D,%0A%20%22noWarning%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D0%BF%D0%BE%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B6%D0%B0%D1%82%D0%B8%22%7D,%0A%20%22cancel%22:%20%7B%22message%22:%20%22%D0%A1%D0%BA%D0%B0%D1%81%D1%83%D0%B2%D0%B0%D0%BD%D0%BD%D1%8F%22%7D,%0A%20%22continue%22:%20%7B%22message%22:%20%22%D0%9F%D1%80%D0%BE%D0%B4%D0%BE%D0%B2%D0%B6%D0%B8%D1%82%D0%B8%22%7D,%0A%20%22beforeDownloadPopupWarn%22:%20%7B%22message%22:%20%22%D0%A3%D0%B2%D0%B0%D0%B3%D0%B0:%20%D1%81%D0%BA%D0%B0%D1%81%D1%83%D0%B2%D0%B0%D1%82%D0%B8%20%D0%B0%D0%B1%D0%BE%20%D0%BF%D1%80%D0%B8%D0%B7%D1%83%D0%BF%D0%B8%D0%BD%D0%B8%D1%82%D0%B8%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B5%D0%BD%D0%BD%D1%8F%20%D0%B1%D1%83%D0%B4%D0%B5%20%D0%BD%D0%B5%D0%BC%D0%BE%D0%B6%D0%BB%D0%B8%D0%B2%D0%BE.%22%7D,%0A%0A%20%22vkInfo%22:%20%7B%22message%22:%20%22%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%B8%22%7D,%0A%20%22vkInfoTitle%22:%20%7B%22message%22:%20%22%D0%A0%D0%BE%D0%B7%D0%BC%D1%96%D1%80%20%D1%84%D0%B0%D0%B9%D0%BB%D1%83%20%D1%96%20%D0%B1%D1%96%D1%82%D1%80%D0%B5%D0%B9%D1%82%22%7D,%0A%20%22vkMp3LinksNotFound%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D0%B7%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BE%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D1%8C%20%D0%BD%D0%B0%20MP3-%D1%84%D0%B0%D0%B9%D0%BB%D0%B8%22%7D,%0A%20%22vkPhotoLinksNotFound%22:%20%7B%22message%22:%20%22%D0%9D%D0%B5%20%D0%B7%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BE%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D1%8C%20%D0%BD%D0%B0%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D1%96%D1%97%22%7D,%0A%20%22vkDownloadPhotoAlbum%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D0%B0%D0%BB%D1%8C%D0%B1%D0%BE%D0%BC%22%7D,%0A%20%22vkDownloadAllPhotoAlbums%22:%20%7B%22message%22:%20%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D1%83%D1%81%D1%96%20%D0%B0%D0%BB%D1%8C%D0%B1%D0%BE%D0%BC%D0%B8%22%7D,%0A%20%22vkFoundPhotos%22:%20%7B%22message%22:%20%22%D0%97%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BE%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D1%96%D0%B9%22%7D,%0A%20%22vkNotAvailablePhotos%22:%20%7B%22message%22:%20%22%25d%20%D1%84%D0%BE%D1%82%D0%BE%20%D1%82%D0%B8%D0%BC%D1%87%D0%B0%D1%81%D0%BE%D0%B2%D0%BE%20%D0%BD%D0%B5%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D0%BE%22%7D,%0A%20%22vkFoundLinks%22:%20%7B%22message%22:%20%22%D0%97%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BE%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D1%8C%22%7D,%0A%20%22vkFoundOf%22:%20%7B%22message%22:%20%22%D0%B7%22%7D,%0A%20%22vkShowAs%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%BA%D0%B0%D0%B7%D0%B0%D1%82%D0%B8%20%D1%8F%D0%BA%22%7D,%0A%20%22vkListOfLinks%22:%20%7B%22message%22:%20%22%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D1%8C%22%7D,%0A%20%22vkListOfLinksInstruction%22:%20%7B%22message%22:%20%22%5B'%D0%A9%D0%BE%D0%B1%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D1%83%D1%81%D1%96%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D1%96%D1%97,%20%D1%81%D0%BA%D0%BE%D0%BF%D1%96%D1%8E%D0%B9%D1%82%D0%B5%20%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D0%BF%D0%BE%D1%81%D0%B8%D0%BB%D0%B0%D0%BD%D1%8C%20%D1%96%20%D0%B2%D1%81%D1%82%D0%B0%D0%B2%D1%82%D0%B5%20%D0%B9%D0%BE%D0%B3%D0%BE%20%D1%83%20',%7Ba:%7Bhref:'http://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80_%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D0%BA',text:'%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B5%D0%BD%D1%8C'%7D%7D,'.%20%D0%AF%D0%BA%D1%89%D0%BE%20%D1%83%20%D0%B2%D0%B0%D1%81%20%D0%BD%D0%B5%20%D0%B2%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B9%20%D0%BC%D0%B5%D0%BD%D0%B5%D0%B4%D0%B6%D0%B5%D1%80%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B5%D0%BD%D1%8C,%20%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D1%83%D1%94%D0%BC%D0%BE%20%D0%B2%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D0%B8%20',%7Ba:%7Bhref:'http://www.westbyte.com/dm/',text:'Download%20Master'%7D%7D,'.'%5D%22%7D,%0A%20%22vkTableOfThumbnails%22:%20%7B%22message%22:%20%22%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8E%20%D0%B5%D1%81%D0%BA%D1%96%D0%B7%D1%96%D0%B2%22%7D,%0A%20%22vkListOfPhotos%22:%20%7B%22message%22:%20%22%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D1%96%D0%B9%22%7D,%0A%20%22vkListOfPhotosInstruction%22:%20%7B%22message%22:%20%22%D0%A9%D0%BE%D0%B1%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D1%96%D1%8E,%20%D0%BD%D0%B0%D1%82%D0%B8%D1%81%D0%BD%D1%96%D1%82%D1%8C%20%D0%BD%D0%B0%20%D0%BD%D0%B5%D1%97%20%D0%BB%D1%96%D0%B2%D0%BE%D1%8E%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D0%BE%D1%8E%20%D0%BC%D0%B8%D1%88%D1%96.%22%7D,%0A%20%22vkKbps%22:%20%7B%22message%22:%20%22%D0%BA%D0%B1/%D1%81%22%7D,%0A%20%22vkFileSizeByte%22:%20%7B%22message%22:%20%22%D0%91%22%7D,%0A%20%22vkFileSizeKByte%22:%20%7B%22message%22:%20%22%D0%BA%D0%91%22%7D,%0A%20%22vkFileSizeMByte%22:%20%7B%22message%22:%20%22%D0%9C%D0%91%22%7D,%0A%20%22vkFileSizeGByte%22:%20%7B%22message%22:%20%22%D0%93%D0%91%22%7D,%0A%20%22vkFileSizeTByte%22:%20%7B%22message%22:%20%22%D0%A2%D0%91%22%7D,%0A%20%22vkDownloadFromYoutube%22:%20%7B%22message%22:%20%22%5B'%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8:%20%D0%B2%D1%96%D0%B4%D0%BA%D1%80%D0%B8%D0%B9%D1%82%D0%B5%20',%7Ba:%7Bhref:'%7Burl%7D',text:'%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D1%83%20%D0%B2%D1%96%D0%B4%D0%B5%D0%BE-%D1%80%D0%BE%D0%BB%D0%B8%D0%BA%D0%B0'%7D%7D,'%20%D1%96%20%D0%BD%D0%B0%D1%82%D0%B8%D1%81%D0%BD%D1%96%D1%82%D1%8C%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20%5C%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%5C%22%20%D0%BD%D0%B0%D0%B4%20%D0%BF%D0%BB%D0%B5%D1%94%D1%80%D0%BE%D0%BC'%5D%22%7D,%0A%20%22vkFoundFiles%22:%20%7B%22message%22:%20%22%D0%97%D0%BD%D0%B0%D0%B9%D0%B4%D0%B5%D0%BD%D0%BE%20%D1%84%D0%B0%D0%B9%D0%BB%D1%96%D0%B2:%20%25d%22%7D,%0A%0A%20%22shareIn%22:%20%7B%22message%22:%20%22%D0%9F%D0%BE%D0%B4%D1%96%D0%BB%D0%B8%D1%82%D0%B8%D1%81%D1%8F%20%D0%B2%20%25w%22%7D,%0A%20%22socialDesc%22:%20%7B%22message%22:%20%22SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%20%D0%B4%D0%B0%D1%94%20%D0%B2%D0%B0%D0%BC%20%D0%BC%D0%BE%D0%B6%D0%BB%D0%B8%D0%B2%D1%96%D1%81%D1%82%D1%8C%20%D0%B1%D0%B5%D0%B7%D0%BA%D0%BE%D1%88%D1%82%D0%BE%D0%B2%D0%BD%D0%BE%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D1%83%D0%B2%D0%B0%D1%82%D0%B8%20%D1%84%D0%B0%D0%B9%D0%BB%D0%B8%20%D0%B7%20YouTube.com,%20Facebook.com,%20VK.com%20%D1%82%D0%B0%20%D0%B1%D1%96%D0%BB%D1%8C%D1%88%D0%B5%2040%20%D1%96%D0%BD%D1%88%D0%B8%D1%85%20%D1%81%D0%B0%D0%B9%D1%82%D1%96%D0%B2%20%D0%BB%D0%B8%D1%88%D0%B5%20%D0%BE%D0%B4%D0%BD%D0%B8%D0%BC%20%D0%BA%D0%BB%D1%96%D0%BA%D0%BE%D0%BC%22%7D,%0A%0A%20%22tutorialS1Title%22:%20%7B%22message%22:%20%22%D0%94%D0%BE%D0%B1%D1%80%D1%96%20%D0%BD%D0%BE%D0%B2%D0%B8%D0%BD%D0%B8!%22%7D,%0A%20%22tutorialS1Main%22:%20%7B%22message%22:%20%22%5B'%D0%A3%20%D1%82%D0%B5%D0%B1%D0%B5%20%D0%B2%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B9%20SaveFrom.net%20%D0%BF%D0%BE%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%BA%20',%7Bimg:%20%7Bsrc:%20'#logo'%7D%7D,%20',%20%D1%96%20%D1%82%D0%B5%D0%BF%D0%B5%D1%80%20%D1%82%D0%B8%20%D0%BC%D0%BE%D0%B6%D0%B5%D1%88%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D0%B1%D1%83%D0%B4%D1%8C-%D1%8F%D0%BA%D0%B5%20%D0%B2%D1%96%D0%B4%D0%B5%D0%BE%20%D0%B7%20YouTube%20%D0%B2%20%D0%BE%D0%B4%D0%B8%D0%BD%20%D0%BA%D0%BB%D1%96%D0%BA'%5D%22%7D,%0A%20%22tutorialS1Arrow%22:%20%7B%22message%22:%20%22%5B'%D0%9F%D1%80%D0%B0%D0%B3%D0%BD%D0%B5%D1%88%20%D0%B4%D0%BE%D0%B2%D1%96%D0%B4%D0%B0%D1%82%D0%B8%D1%81%D1%8F%20%D1%8F%D0%BA?',%20%7Bbr:%7B%7D%7D,%20'%D0%9D%D0%B0%D1%82%D0%B8%D1%81%D0%BD%D0%B8%20%D1%82%D1%83%D1%82'%5D%22%7D,%0A%20%22tutorialS2Main%22:%20%7B%22message%22:%20%22%D0%A9%D0%BE%D0%B1%20%D0%B7%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%20%D0%B2%D1%96%D0%B4%D0%B5%D0%BE,%20%D0%BE%D0%B1%D0%B5%D1%80%D1%96%D1%82%D1%8C%20%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%20%D1%96%20%D0%BD%D0%B0%D1%82%D0%B8%D1%81%D0%BD%D0%B8%20%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D1%83%20%5C%22%D0%97%D0%B0%D0%B2%D0%B0%D0%BD%D1%82%D0%B0%D0%B6%D0%B8%D1%82%D0%B8%5C%22%22%7D,%0A%20%22tutorialS3History%22:%20%7B%22message%22:%20%22%D0%9F%D0%B5%D1%80%D0%B5%D0%B3%D0%BB%D1%8F%D0%BD%D1%83%D1%82%D1%96%22%7D,%0A%20%22tutorialS3Main%22:%20%7B%22message%22:%20%22%5B'%D0%A5%D0%BE%D1%87%D0%B5%D1%88%20%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D0%B8%20%D0%B2%D0%B6%D0%B5%20%D0%BF%D0%B5%D1%80%D0%B5%D0%B3%D0%BB%D1%8F%D0%BD%D1%83%D1%82%D0%B5%20%D0%B2%D1%96%D0%B4%D0%B5%D0%BE?',%20%7Bbr:%7B%7D%7D,%20'%D0%9D%D0%B0%D1%82%D0%B8%D1%81%D0%BA%D0%B0%D0%B9%20%D0%BD%D0%B0%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20'%20%D0%BD%D0%B0%20%D0%BF%D1%80%D0%B5%D0%B2%D1%8C%D1%8E%20%D0%B2%20%D0%BF%D0%B5%D1%80%D0%B5%D0%B3%D0%BB%D1%8F%D0%BD%D1%83%D1%82%D0%B8%D1%85%20%D0%B2%D1%96%D0%B4%D0%B5%D0%BE'%5D%22%7D,%0A%20%22tutorialS4Main%22:%20%7B%22message%22:%20%22%5B'%D0%92%D1%96%D0%B4%D0%B5%D0%BE%20%D0%BD%D0%B5%20%D0%BE%D0%B1%D0%BE%D0%B2%5C%5C'%D1%8F%D0%B7%D0%BA%D0%BE%D0%B2%D0%BE%20%D0%BF%D0%B5%D1%80%D0%B5%D0%B3%D0%BB%D1%8F%D0%B4%D0%B0%D1%82%D0%B8%20%E2%80%94',%20%7Bbr:%7B%7D%7D,%20'%D0%BD%D0%B0%D1%82%D0%B8%D1%81%D0%BA%D0%B0%D0%B9%20%D0%BD%D0%B0%20',%20%7Bimg:%20%7Bsrc:%20'#arrow'%7D%7D,%20',%20%D0%BE%D0%B1%D0%B8%D1%80%D0%B0%D0%B9%20%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%20%D1%96%20%D1%81%D0%BA%D0%B0%D1%87%D1%83%D0%B9.%20%D0%A6%D0%B5%20%D0%B7%D1%80%D1%83%D1%87%D0%BD%D0%BE!'%5D%22%7D,%0A%20%22tutorialS5Title%22:%20%7B%22message%22:%20%22%D0%9F%D1%80%D0%B8%D1%94%D0%BC%D0%BD%D0%BE%D1%97%20%D1%80%D0%BE%D0%B1%D0%BE%D1%82%D0%B8!%22%7D,%0A%20%22tutorialS5Main%22:%20%7B%22message%22:%20%22%5B'%D0%97%D0%B0%D0%BB%D0%B8%D1%88%D0%B8%D0%BB%D0%B8%D1%81%D1%8F%20%D0%BF%D0%B8%D1%82%D0%B0%D0%BD%D0%BD%D1%8F?%20%D0%84%20%D0%BF%D1%80%D0%BE%D0%BF%D0%BE%D0%B7%D0%B8%D1%86%D1%96%D1%97?%20%D0%97%D0%B0%D0%B3%D0%BB%D1%8F%D0%BD%D1%8C%D1%82%D0%B5%20%D0%BD%D0%B0%20',%7Ba:%20%7Btext:%20'%D1%81%D1%82%D0%BE%D1%80%D1%96%D0%BD%D0%BA%D1%83%20%D0%BF%D1%96%D0%B4%D1%82%D1%80%D0%B8%D0%BC%D0%BA%D0%B8',%20href:%20'#support'%7D%7D,'%20%D0%B0%D0%B1%D0%BE%20%D0%B2%D1%81%D1%82%D1%83%D0%BF%D0%B0%D0%B9%D1%82%D0%B5%20%D0%B4%D0%BE%20%D0%BD%D0%B0%D1%88%D0%BE%D1%97%20',%20%7Ba:%20%7Btext:%20'%D0%92%D0%9A-%D1%81%D0%BF%D1%96%D0%BB%D1%8C%D0%BD%D0%BE%D1%82%D0%B8',%20href:%20'#vk'%7D%7D%5D%22%7D,%0A%0A%20%22tutorialTooltipText%22:%20%7B%22message%22:%20%22%5B'%D0%A9%D0%BE%D0%B1%20',%7Bb:%20%7Btext:%20'%D1%81%D0%BA%D0%B0%D1%87%D0%B0%D1%82%D0%B8'%7D%7D,',%20%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%20%D0%BA%D0%BB%D1%96%D0%BA%D0%BD%D1%96%D1%82%D1%8C%20%D0%BF%D0%BE%20%D0%BA%D0%BD%D0%BE%D0%BF%D1%86%D1%96'%5D%22%7D,%0A%0A%20%22ummyTooltipConfirm%22:%20%7B%22message%22:%20%22%5B'%D0%92%D0%B8%20%D0%B2%D0%B6%D0%B5%20%D0%B2%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D0%BB%D0%B8',%7Bbr:%7B%7D%7D,%7Bimg:%7B%7D%7D,'%20Ummy%20Video%20Downloader?'%5D%22%7D,%0A%20%22yes%22:%20%7B%22message%22:%20%22%D0%A2%D0%B0%D0%BA%22%7D,%0A%20%22no%22:%20%7B%22message%22:%20%22%D0%9D%D1%96%22%7D,%0A%20%22tooltipHide%22:%20%7B%22message%22:%20%22%D0%91%D1%96%D0%BB%D1%8C%D1%88%D0%B5%20%D0%BD%D0%B5%20%D0%BF%D0%BE%D0%BA%D0%B0%D0%B7%D1%83%D0%B2%D0%B0%D1%82%D0%B8%20%D1%86%D0%B5%20%D0%BF%D0%BE%D0%B2%D1%96%D0%B4%D0%BE%D0%BC%D0%BB%D0%B5%D0%BD%D0%BD%D1%8F%22%7D%0A%7D";
  var mono = (typeof mono !== 'undefined') ? mono : undefined;

  (function(base, factory) {
    "use strict";
    if (mono && mono.isLoaded) {
      return;
    }

    var _mono = mono;
    var fn = function(addon) {
      return factory(_mono, addon);
    };

    if (typeof window !== "undefined") {
      mono = base(fn);
      return;
    }

  }(
    function base(factory) {
      if (['interactive', 'complete'].indexOf(document.readyState) !== -1) {
        return factory();
      }

      if (typeof GM_getValue !== 'undefined') {
        return factory();
      }

      var base = {
        isLoaded: true,
        onReadyStack: [],
        onReady: function() {
          base.onReadyStack.push([this, arguments]);
        },
        loadModuleStack: [],
        loadModule: function() {
          base.loadModuleStack.push([this, arguments]);
        }
      };

      var onLoad = function() {
        document.removeEventListener('DOMContentLoaded', onLoad, false);
        window.removeEventListener('load', onLoad, false);

        mono = factory();

        var item;
        while (item = base.onReadyStack.shift()) {
          mono.onReady.apply(item[0], item[1]);
        }

        while (item = base.loadModuleStack.shift()) {
          mono.loadModule.apply(item[0], item[1]);
        }
      };

      document.addEventListener('DOMContentLoaded', onLoad, false);
      window.addEventListener('load', onLoad, false);

      return base;
    },
    function initMono(_mono, _addon) {

      var browserApi = function() {
        "use strict";
        var emptyFn = function() {};

        var cloneObj = function(msg) {
          var obj = null;
          try {
            obj = JSON.parse(JSON.stringify({
              w: msg
            })).w;
          } catch (e) {
            console.error('CloneObj error!', e);
          }

          return obj;
        };

        /**
         * @param {Function} fn
         * @returns {Function}
         */
        var onceFn = function(fn) {
          return function(msg) {
            if (fn) {
              fn(msg);
              fn = null;
            }
          };
        };

        /**
         * @param {Function} fn
         * @returns {Function}
         */
        var cloneResponse = function(fn) {
          return function(response) {
            fn(cloneObj(response));
          };
        };

        var msgTools = {
          listenerBgList: [],
          listenerList: []
        };

        var api = {
          isGM: true,
          /**
           * @param {*} msg
           * @param {Function} [responseCallback]
           */
          sendMessageToActiveTab: function(msg, responseCallback) {
            var responseFn = !responseCallback ? emptyFn : onceFn(cloneResponse(responseCallback));

            msgTools.listenerList.forEach(function(fn) {
              setTimeout(function() {
                fn(cloneObj(msg), responseFn);
              }, 0);
            });
          },
          /**
           * @param {*} msg
           * @param {Function} [responseCallback]
           */
          sendMessage: function(msg, responseCallback) {
            var responseFn = !responseCallback ? emptyFn : onceFn(cloneResponse(responseCallback));

            var cloneMsg = cloneObj(msg);
            msgTools.listenerBgList.forEach(function(fn) {
              setTimeout(function() {
                fn(cloneMsg, responseFn);
              }, 0);
            });
          },
          onMessage: {
            /**
             * @param {Function} callback
             * @param {Object} [details]
             * @param {Boolean} [details.isBg]
             */
            addListener: function(callback, details) {
              details = details || {};
              var listenerList = null;
              if (details.isBg) {
                listenerList = msgTools.listenerBgList;
              } else {
                listenerList = msgTools.listenerList;
              }

              if (listenerList.indexOf(callback) === -1) {
                listenerList.push(callback);
              }
            },
            /**
             * @param {Function} callback
             * @param {Object} [details]
             * @param {Boolean} [details.isBg]
             */
            removeListener: function(callback, details) {
              details = details || {};
              var listenerList = null;
              if (details.isBg) {
                listenerList = msgTools.listenerBgList;
              } else {
                listenerList = msgTools.listenerList;
              }

              var pos = listenerList.indexOf(callback);
              if (pos !== -1) {
                listenerList.splice(pos, 1);
              }
            }
          }
        };

        if (window.chrome) {
          api.isTM = true;
        } else
        if (/Maxthon\//.test(navigator.userAgent)) {
          api.isVM = true;
        } else {
          api.isGmOnly = true;
        }

        var initGmStorage = function() {
          var readOldItem = function(value) {
            var result = undefined;
            if (value !== undefined && value !== null && value !== 'undefined' && value !== 'isMonoEmptyValue') {
              if (typeof value !== 'object') {
                result = value;
              } else {
                try {
                  result = JSON.parse(JSON.stringify(value));
                } catch (e) {
                  console.error('GM old storage item read error!', e, value);
                }
              }
            }
            return result;
          };

          var jsonRe = /^{(?:"w":.+|)}$/;
          var readItem = function(value) {
            if (value !== 'MonoEmptyValue' && !jsonRe.test(value)) {
              return readOldItem(value);
            }

            var result = undefined;
            if (typeof value === 'string' && value !== 'MonoEmptyValue') {
              try {
                result = JSON.parse(value).w;
              } catch (e) {
                console.error('GM Storage item read error!', e, value);
              }
            }
            return result;
          };

          var writeItem = function(value) {
            return JSON.stringify({
              w: value
            });
          };

          return {
            /**
             * @param {String|[String]|Object|null|undefined} [keys]
             * @param {Function} callback
             */
            get: function(keys, callback) {
              var items = {};
              var defaultItems = {};

              var _keys = [];
              if (keys === undefined || keys === null) {
                _keys = GM_listValues();
              } else
              if (Array.isArray(keys)) {
                _keys = keys;
              } else
              if (typeof keys === 'object') {
                _keys = Object.keys(keys);
                defaultItems = keys;
              } else {
                _keys = [keys];
              }

              _keys.forEach(function(key) {
                var value = readItem(GM_getValue(key, 'MonoEmptyValue'));
                if (value === undefined) {
                  value = defaultItems[key];
                }
                if (value !== undefined) {
                  items[key] = value;
                }
              });

              setTimeout(function() {
                callback(items);
              }, 0);
            },
            /**
             * @param {Object} items
             * @param {Function} [callback]
             */
            set: function(items, callback) {
              Object.keys(items).forEach(function(key) {
                if (items[key] !== undefined) {
                  GM_setValue(key, writeItem(items[key]));
                }
              });

              callback && setTimeout(function() {
                callback();
              }, 0);
            },
            /**
             * @param {String|[String]} [keys]
             * @param {Function} [callback]
             */
            remove: function(keys, callback) {
              var _keys = [];
              if (Array.isArray(keys)) {
                _keys = keys;
              } else {
                _keys = [keys];
              }

              _keys.forEach(function(key) {
                GM_deleteValue(key);
              });

              callback && setTimeout(function() {
                callback();
              }, 0);
            },
            /**
             * @param {Function} [callback]
             */
            clear: function(callback) {
              this.remove(GM_listValues(), callback);
            }
          };
        };

        api.storage = initGmStorage();

        var _navigator = null;
        /**
         * @returns {{language: String, platform: String, userAgent: String}}
         */
        api.getNavigator = function() {
          if (_navigator) {
            return _navigator;
          }

          _navigator = {};
          ['language', 'platform', 'userAgent'].forEach(function(key) {
            _navigator[key] = navigator[key] || '';
          });

          return _navigator;
        };

        (function checkCompatibility() {
          var ua = api.getNavigator().userAgent;
          var m = /Chrome\/(\d+)/.exec(ua);
          if (m) {
            var version = parseInt(m[1]);
            api.isChromeVersion = version;
            if (version < 31) {
              api.noMouseEnter = true;
            }
          }
        })();

        /**
         * @param {string} url
         * @param {boolean} [active]
         */
        api.openTab = function(url, active) {
          active = (active === undefined) ? true : !!active;
          if (typeof GM_openInTab !== 'undefined') {
            return GM_openInTab(url, {
              active: active,
              insert: true
            });
          }
        };

        /**
         * @param {Function} cb
         */
        api.getActiveTabUrl = function(cb) {
          cb(location.href);
        };

        /**
         * @param {Function} cb
         * @param {number} [delay]
         * @returns {number}
         */
        api.setTimeout = function(cb, delay) {
          return setTimeout(cb, delay);
        };

        /**
         * @param {number} timeout
         */
        api.clearTimeout = function(timeout) {
          return clearTimeout(timeout);
        };

        /**
         * @returns {string}
         */
        api.getVersion = function() {
          var version = 'GM_unknown';
          if (typeof GM_info !== 'undefined' && GM_info.script && GM_info.script.version) {
            version = GM_info.script.version;
          }
          return version;
        };

        /**
         * @param {String} locale
         * @param {Function} cb
         */
        api.getLanguage = function(locale, cb) {
          var convert = function(messages) {
            var language = {};
            for (var key in messages) {
              if (messages.hasOwnProperty(key)) {
                language[key] = messages[key].message;
              }
            }
            return language;
          };

          try {
            cb(null, convert(JSON.parse(decodeURI(_languageList[locale]))));
          } catch (e) {
            cb(e);
          }
        };

        api.getLoadedLocale = function() {
          return '';
        };

        return {
          api: api
        };
      };

      var mono = browserApi(_addon).api;
      mono.isLoaded = true;
      mono.onReady = function(cb) {
        return cb();
      };

      //> utils

      /**
       * @param {string} head
       * @returns {Object}
       */
      mono.parseXhrHeader = function(head) {
        head = head.split(/\r?\n/);
        var headers = {};
        head.forEach(function(line) {
          "use strict";
          var sep = line.indexOf(':');
          if (sep === -1) {
            return;
          }
          var key = line.substr(0, sep).trim().toLowerCase();
          var value = line.substr(sep + 1).trim();
          headers[key] = value;
        });
        return headers;
      };

      /**
       * @typedef {Object|string} requestDetails
       * @property {string} url
       * @property {string} [method] GET|POST
       * @property {string} [type] GET|POST
       * @property {string} [data]
       * @property {boolean} [cache]
       * @property {Object} [headers]
       * @property {string} [contentType]
       * @property {boolean} [json]
       * @property {boolean} [xml]
       * @property {number} [timeout]
       * @property {string} [mimeType]
       * @property {boolean} [withCredentials]
       * @property {boolean} [localXHR]
       */
      /**
       * @callback requestResponse
       * @param {string|null} err
       * @param {Object} res
       * @param {string|Object|Array} data
       */
      /**
       * @param {requestDetails} obj
       * @param {requestResponse} [origCb]
       * @returns {{abort: function}}
       */
      mono.request = function(obj, origCb) {
        "use strict";
        var result = {};
        var cb = function(e, body) {
          cb = null;
          if (request.timeoutTimer) {
            mono.clearTimeout(request.timeoutTimer);
          }

          var err = null;
          if (e) {
            err = String(e.message || e) || 'ERROR';
          }
          origCb && origCb(err, getResponse(body), body);
        };

        var getResponse = function(body) {
          var response = {};

          response.statusCode = xhr.status;
          response.statusText = xhr.statusText;

          var headers = null;
          var allHeaders = xhr.getAllResponseHeaders();
          if (typeof allHeaders === 'string') {
            headers = mono.parseXhrHeader(allHeaders);
          }
          response.headers = headers || {};

          response.body = body;

          return response;
        };

        if (typeof obj !== 'object') {
          obj = {
            url: obj
          };
        }

        var url = obj.url;

        var method = obj.method || obj.type || 'GET';
        method = method.toUpperCase();

        var data = obj.data;
        if (typeof data !== "string") {
          data = mono.param(data);
        }

        if (data && method === 'GET') {
          url += (/\?/.test(url) ? '&' : '?') + data;
          data = undefined;
        }

        if (obj.cache === false && ['GET', 'HEAD'].indexOf(method) !== -1) {
          url += (/\?/.test(url) ? '&' : '?') + '_=' + Date.now();
        }

        obj.headers = obj.headers || {};

        if (data) {
          obj.headers["Content-Type"] = obj.contentType || obj.headers["Content-Type"] || 'application/x-www-form-urlencoded; charset=UTF-8';
        }

        var request = {};
        request.url = url;
        request.method = method;

        data && (request.data = data);
        obj.json && (request.json = true);
        obj.xml && (request.xml = true);
        obj.timeout && (request.timeout = obj.timeout);
        obj.mimeType && (request.mimeType = obj.mimeType);
        obj.withCredentials && (request.withCredentials = true);
        Object.keys(obj.headers).length && (request.headers = obj.headers);

        if (request.timeout > 0) {
          request.timeoutTimer = mono.setTimeout(function() {
            cb && cb(new Error('ETIMEDOUT'));
            xhr.abort();
          }, request.timeout);
        }

        var xhrSuccessStatus = {
          0: 200,
          1223: 204
        };

        var xhr = mono.request.getTransport(obj.localXHR);
        xhr.open(request.method, request.url, true);

        if (mono.isModule && request.xml) {
          request.mimeType = 'text/xml';
        }
        if (request.mimeType) {
          xhr.overrideMimeType(request.mimeType);
        }
        if (request.withCredentials) {
          xhr.withCredentials = true;
        }
        for (var key in request.headers) {
          xhr.setRequestHeader(key, request.headers[key]);
        }

        var readyCallback = xhr.onload = function() {
          var status = xhrSuccessStatus[xhr.status] || xhr.status;
          try {
            if (status >= 200 && status < 300 || status === 304) {
              var body = xhr.responseText;
              if (request.json) {
                body = JSON.parse(body);
              } else
              if (request.xml) {
                if (mono.isModule) {
                  body = xhr.responseXML;
                } else {
                  body = (new DOMParser()).parseFromString(body, "text/xml");
                }
              } else
              if (typeof body !== 'string') {
                console.error('Response is not string!', body);
                throw new Error('Response is not string!');
              }
              return cb && cb(null, body);
            }
            throw new Error(xhr.status + ' ' + xhr.statusText);
          } catch (e) {
            return cb && cb(e);
          }
        };

        var errorCallback = xhr.onerror = function() {
          cb && cb(new Error(xhr.status + ' ' + xhr.statusText));
        };

        var stateChange = null;
        if (xhr.onabort !== undefined) {
          xhr.onabort = errorCallback;
        } else {
          stateChange = function() {
            if (xhr.readyState === 4) {
              cb && mono.setTimeout(function() {
                return errorCallback();
              });
            }
          };
        }

        if (mono.isSafari && mono.badXhrHeadRedirect && request.method === 'HEAD') {
          stateChange = (function(cb) {
            if (xhr.readyState > 1) {
              // Safari 5 on HEAD 302 redirect fix
              mono.setTimeout(function() {
                xhr.abort();
              });
              return readyCallback();
            }

            return cb && cb();
          }).bind(null, stateChange);
        }

        if (mono.isOpera && mono.badXhrRedirect) {
          stateChange = (function(cb) {
            if (xhr.readyState > 1 && (xhr.status === 302 || xhr.status === 0)) {
              // Opera 12 XHR redirect
              if (!obj._redirectCount) {
                obj._redirectCount = 0;
              }
              var location = xhr.getResponseHeader('Location');
              if (location && obj._redirectCount < 5) {
                obj._redirectCount++;
                var redirectObj = mono.extend({}, obj);
                redirectObj.url = location;

                cb = null;
                xhr.abort();
                var redirectRequest = mono.request(redirectObj, origCb);
                mono.extend(result, redirectRequest);
                return;
              }
            }

            return cb && cb();
          }).bind(null, stateChange);
        }

        if (stateChange) {
          xhr.onreadystatechange = stateChange;
        }

        try {
          xhr.send(request.data || null);
        } catch (e) {
          mono.setTimeout(function() {
            cb && cb(e);
          });
        }

        result.abort = function() {
          cb = null;
          xhr.abort();
        };

        return result;
      };

      mono.request.getTransport = function(localXHR) {
        if (mono.isModule) {
          return new(require('sdk/net/xhr').XMLHttpRequest)();
        }

        if (mono.isGM && !localXHR) {
          return new mono.request.gmTransport();
        }

        return new XMLHttpRequest();
      };

      mono.request.gmTransport = function() {
        "use strict";
        var _this = this;
        var gmXhr = null;

        var sync = function(type, gmResponse) {
          _this.readyState = gmResponse.readyState;
          _this.status = gmResponse.status;
          _this.statusText = gmResponse.statusText;
          if (typeof gmResponse.response === 'string') {
            _this.responseText = gmResponse.response;
          }
          if (gmResponse.responseText) {
            _this.responseText = gmResponse.responseText;
          }
          _this._responseHeaders = gmResponse.responseHeaders;

          _this.onreadystatechange && _this.onreadystatechange();

          _this[type] && _this[type]();
        };

        var gmDetails = {
          headers: {},
          responseType: 'text',
          onload: sync.bind(null, 'onload'),
          onerror: sync.bind(null, 'onerror'),
          onabort: sync.bind(null, 'onabort'),
          ontimeout: sync.bind(null, 'ontimeout')
        };

        this._responseHeaders = '';
        this.readyState = 0;
        this.status = 0;
        this.statusText = '';
        this.responseText = '';
        this.response = '';
        this.responseType = '';
        this.responseURL = '';
        this.open = function(method, url) {
          gmDetails.method = method;
          gmDetails.url = url;
        };
        this.overrideMimeType = function(mimeType) {
          gmDetails.overrideMimeType = mimeType;
        };
        this.setRequestHeader = function(key, value) {
          gmDetails.headers[key] = value;
        };
        this.getResponseHeader = function(name) {
          if (!this._responseHeaders) {
            return null;
          }

          name = name.toLowerCase();
          if (!this.headers) {
            this.headers = mono.parseXhrHeader(this._responseHeaders);
          }
          if (!this.headers.hasOwnProperty(name)) {
            return null;
          }
          return this.headers[name];
        };
        this.getAllResponseHeaders = function() {
          return this._responseHeaders;
        };
        this.abort = function() {
          gmXhr && gmXhr.abort();
        };
        this.send = function(data) {
          gmDetails.data = data;
          gmXhr = GM_xmlhttpRequest(gmDetails);
        };
        this.onabort = null;
        this.onerror = null;
        this.onload = null;
        this.onreadystatechange = null;
        this.ontimeout = null;
      };

      mono.extend = function() {
        var obj = arguments[0];
        for (var i = 1, len = arguments.length; i < len; i++) {
          var item = arguments[i];
          for (var key in item) {
            if (item[key] !== undefined) {
              obj[key] = item[key];
            }
          }
        }
        return obj;
      };

      mono.extendPos = function() {
        var obj = arguments[0];
        for (var i = 1, len = arguments.length; i < len; i++) {
          var item = arguments[i];
          for (var key in item) {
            if (item[key] !== undefined) {
              delete obj[key];
              obj[key] = item[key];
            }
          }
        }
        return obj;
      };

      mono.param = function(obj) {
        if (typeof obj === 'string') {
          return obj;
        }
        var itemsList = [];
        for (var key in obj) {
          if (!obj.hasOwnProperty(key)) {
            continue;
          }
          if (obj[key] === undefined || obj[key] === null) {
            obj[key] = '';
          }
          itemsList.push(encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]));
        }
        return itemsList.join('&');
      };

      mono.capitalize = function(word) {
        "use strict";
        return word.charAt(0).toUpperCase() + word.substr(1);
      };

      /**
       * @param {string|Element|DocumentFragment} tagName
       * @param {Object} obj
       * @returns {Element|DocumentFragment}
       */
      mono.create = function(tagName, obj) {
        "use strict";
        var el;
        var func;
        if (typeof tagName !== 'object') {
          el = document.createElement(tagName);
        } else {
          el = tagName;
        }
        for (var attr in obj) {
          var value = obj[attr];
          if (func = mono.create.hook[attr]) {
            func(el, value);
            continue;
          }
          el[attr] = value;
        }
        return el;
      };
      mono.create.hook = {
        text: function(el, value) {
          "use strict";
          el.textContent = value;
        },
        data: function(el, value) {
          "use strict";
          for (var item in value) {
            el.dataset[item] = value[item];
          }
        },
        class: function(el, value) {
          "use strict";
          if (Array.isArray(value)) {
            for (var i = 0, len = value.length; i < len; i++) {
              el.classList.add(value[i]);
            }
          } else {
            el.setAttribute('class', value);
          }
        },
        style: function(el, value) {
          "use strict";
          if (typeof value === 'object') {
            for (var item in value) {
              var key = item;
              if (key === 'float') {
                key = 'cssFloat';
              }
              var _value = value[item];
              if (Array.isArray(_value)) {
                for (var i = 0, len = _value.length; i < len; i++) {
                  el.style[key] = _value[i];
                }
              } else {
                el.style[key] = _value;
              }
            }
          } else {
            el.setAttribute('style', value);
          }
        },
        append: function(el, value) {
          "use strict";
          if (!Array.isArray(value)) {
            value = [value];
          }
          for (var i = 0, len = value.length; i < len; i++) {
            var node = value[i];
            if (!node && node !== 0) {
              continue;
            }
            if (typeof node !== 'object') {
              node = document.createTextNode(node);
            }
            el.appendChild(node);
          }
        },
        on: function(el, eventList) {
          "use strict";
          if (typeof eventList[0] !== 'object') {
            eventList = [eventList];
          }
          for (var i = 0, len = eventList.length; i < len; i++) {
            var args = eventList[i];
            if (!Array.isArray(args)) {
              continue;
            }
            mono.on.apply(mono, [el].concat(args));
          }
        },
        one: function(el, eventList) {
          "use strict";
          if (typeof eventList[0] !== 'object') {
            eventList = [eventList];
          }
          for (var i = 0, len = eventList.length; i < len; i++) {
            var args = eventList[i];
            if (!Array.isArray(args)) {
              continue;
            }
            mono.one.apply(mono, [el].concat(args));
          }
        },
        onCreate: function(el, value) {
          "use strict";
          value.call(el, el);
        }
      };

      mono.parseTemplate = function(list, details) {
        details = details || {};

        if (typeof list === "string") {
          if (list[0] !== '[') {
            return document.createTextNode(list);
          }
          try {
            list = list.replace(/"/g, '\\u0022').replace(/\\'/g, '\\u0027').replace(/'/g, '"').replace(/([{,])\s*([a-zA-Z0-9]+):/g, '$1"$2":');
            list = JSON.parse(list);
          } catch (e) {
            return document.createTextNode(list);
          }
        }
        if (!Array.isArray(list)) {
          return document.createTextNode(list);
        }
        var fragment = details.fragment || document.createDocumentFragment();
        for (var i = 0, len = list.length; i < len; i++) {
          var item = list[i];
          if (typeof item === 'object') {
            for (var tagName in item) {
              var el = item[tagName];
              var append = el.append;
              delete el.append;
              var dEl;
              fragment.appendChild(dEl = mono.create(tagName, el));
              if (append !== undefined) {
                mono.parseTemplate(append, {
                  fragment: dEl
                });
              }
            }
          } else {
            fragment.appendChild(document.createTextNode(item));
          }
        }
        return fragment;
      };

      mono.trigger = function(el, type, data) {
        if (data === undefined) {
          data = {};
        }
        if (data.bubbles === undefined) {
          data.bubbles = false;
        }
        if (data.cancelable === undefined) {
          data.cancelable = false;
        }
        var event = new CustomEvent(type, data);
        el.dispatchEvent(event);
      };

      mono.urlPatternToStrRe = function(value) {
        "use strict";
        if (value === '<all_urls>') {
          return '^https?:\\/\\/.+$';
        }

        var m = value.match(/(\*|http|https|file|ftp):\/\/([^\/]+)(?:\/(.*))?/);
        if (!m) {
          throw new Error("Invalid url-pattern");
        }

        var scheme = m[1];
        if (scheme === '*') {
          scheme = 'https?';
        }

        var host = m[2];
        if (host === '*') {
          host = '.+';
        } else {
          host = mono.escapeRegex(host);
          host = host.replace(/^\\\*\\\./, '(?:[^\/]+\\.)?');
          host = host.replace(/\\\.\\\*$/g, '\\.[a-z\\.]{2,}');
        }

        var pattern = ['^', scheme, ':\\/\\/', host];

        var path = m[3];
        if (!path) {
          pattern.push('$');
        } else
        if (path === '*') {
          path = '(?:|\/.*)';
          pattern.push(path);
          pattern.push('$');
        } else
        if (path) {
          path = '\/' + path;
          path = mono.escapeRegex(path);
          path = path.replace(/\\\*/g, '.*');
          pattern.push(path);
          pattern.push('$');
        }

        return pattern.join('');
      };

      mono.isIframe = function() {
        if (mono.isFF) {
          return window.parent !== window;
        }
        return window.top !== window.self;
      };

      mono.userJsCheck = function() {
        "use strict";
        if (mono.isGM) {
          return;
        }

        if (!mono.hasPageScript()) {
          return;
        }

        try {
          if (window.sessionStorage['savefrom-helper-userjs'] === '1') {
            mono.sendMessage({
              action: 'userjsDetected'
            });
          }
        } catch (e) {}
      };

      mono.hasPageScript = function() {
        "use strict";
        var moduleLoadedList = mono.loadModule.moduleLoadedList;
        return moduleLoadedList.some(function(moduleName) {
          if (['sovetnik', 'dealply', 'aviaBar', 'fsStat', 'swStat'].indexOf(moduleName) === -1) {
            return true;
          }
        });
      };

      mono.setExtensionSession = function() {
        "use strict";
        try {
          if (!mono.hasPageScript()) {
            delete window.sessionStorage['savefrom-helper-extension'];
          } else {
            window.sessionStorage['savefrom-helper-extension'] = '1';
          }
        } catch (e) {}
      };

      mono.loadModule = (function() {
        var moduleNameList = [];
        var moduleList = [];
        var loadedModuleList = [];

        var moduleLoad = function(data) {
          var hasActiveModule = false;

          var item, availFn, isAvailable, moduleName, fn;
          while (item = moduleList.shift()) {
            moduleName = item[0];
            fn = item[1];
            availFn = item[2];

            isAvailable = !availFn;
            try {
              !isAvailable && (isAvailable = availFn(data));
            } catch (e) {
              mono.error('Module available error!', e);
            }

            if (isAvailable) {
              loadedModuleList.push(moduleName);
              hasActiveModule = true;
              try {
                mono.debug('run module', moduleName, data);
                fn(moduleName, data);
              } catch (e) {
                mono.error('Module error!', e);
              }
            } else {
              mono.debug('unavailable', moduleName, data);
            }
          }

          if (hasActiveModule && !mono.isGM) {
            mono.setExtensionSession();
            mono.userJsCheck();
          }
        };

        var requestData = function() {
          "use strict";
          var limit = 20;

          var onceResponse = mono.onceFn(function(data) {
            getData = null;

            mono.global.language = data.getLanguage;
            mono.global.preference = data.getPreference;

            return moduleLoad(data);
          });

          var getData = function() {
            setTimeout(function() {
              limit--;
              if (limit < 0 || mono.isGM) {
                getData = null;
              }
              getData && getData();
            }, 250);

            mono.sendMessage(['getPreference', 'getLanguage'], onceResponse);
          };
          getData();
        };

        var loader = function(moduleName, cb, isAsyncAvailable, syncIsAvailable) {
          if (moduleNameList.indexOf(moduleName) === -1) {
            moduleNameList.push(moduleName);

            var isAvailable = !syncIsAvailable;
            try {
              !isAvailable && (isAvailable = syncIsAvailable());
            } catch (e) {
              mono.error('Module available error!', e);
            }

            if (isAvailable) {
              moduleList.push(arguments);
              if (moduleList.length === 1) {
                requestData();
              }
            } else {
              mono.debug('sync unavailable', moduleName);
            }
          } else {
            mono.debug('Module exists', moduleName);
          }
        };

        loader.moduleLoadedList = loadedModuleList;
        loader.moduleList = moduleList;

        return loader;
      })();

      mono.contains = function() {
        var rnative = /^[^{]+\{\s*\[native \w/;
        if (rnative.test(document.compareDocumentPosition) || rnative.test(document.contains)) {
          mono.contains = function(a, b) {
            // from Sizzle
            var adown = a.nodeType === 9 ? a.documentElement : a,
              bup = b && b.parentNode;
            return a === bup || !!(bup && bup.nodeType === 1 && (
              adown.contains ?
              adown.contains(bup) :
              a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16
            ));
          };
        } else {
          mono.contains = function(a, b) {
            if (b) {
              while (b = b.parentNode) {
                if (b === a) {
                  return true;
                }
              }
            }
            return false;
          };
        }
        return mono.contains.apply(this, arguments);
      };
      (function() {
        "use strict";
        var getTwoElParent = function(a, b, parentList) {
          parentList.unshift(b);
          while (b = b.parentNode) {
            if (mono.contains(b, a)) {
              return b;
            }
            parentList.unshift(b);
          }
          return null;
        };
        var wrapEvent = function(origType, fixType, origEvent, capture) {
          return !capture ? function(event) {
            var related = event.relatedTarget;
            var target = this;
            if (!related || (related !== target && !mono.contains(target, related))) {
              origEvent.call(this, {
                type: origType,
                target: target,
                preventDefault: event.preventDefault,
                stopPropagation: event.stopPropagation
              });
            }
          } : function(event) {
            var related = event.relatedTarget;
            var target = event.target;
            var parentList = [];
            if (!related || mono.contains(related, target) || (related = getTwoElParent(related, target, parentList))) {
              if (parentList.length === 0) {
                while (target !== related) {
                  parentList.unshift(target);
                  target = target.parentNode;
                }
              }
              while (target = parentList.shift()) {
                origEvent.call(this, {
                  type: origType,
                  target: target,
                  preventDefault: event.preventDefault,
                  stopPropagation: event.stopPropagation
                });
              }
            }
          };
        };

        var functionMap = {
          key: 'fixEvent-',
          eventId: 0,
          replaceList: {},
          bindCount: {}
        };

        /**
         * @param {Node} el
         * @param {String} type
         * @param {Function} onEvent
         * @param {Boolean} [capture]
         */
        mono.on = function(el, type, onEvent, capture) {
          if (mono.noMouseEnter && ['mouseenter', 'mouseleave'].indexOf(type) !== -1) {
            var cacheEventKey = functionMap.key;
            var origEvent = onEvent;
            var origType = type;
            var origCapture = capture;

            if (type === 'mouseenter') {
              type = 'mouseover';
            } else
            if (type === 'mouseleave') {
              type = 'mouseout';
            }
            cacheEventKey += type;
            if (capture) {
              cacheEventKey += '-1';
              capture = false;
            }

            var eventId = origEvent[cacheEventKey];
            if (eventId === undefined) {
              eventId = functionMap.eventId++;
              origEvent[cacheEventKey] = eventId;

              onEvent = wrapEvent(origType, type, origEvent, origCapture);

              functionMap.replaceList[eventId] = onEvent;

              if (functionMap.bindCount[eventId] === undefined) {
                functionMap.bindCount[eventId] = 0;
              }
            } else {
              onEvent = functionMap.replaceList[eventId];
            }

            functionMap.bindCount[eventId]++;
          }

          el.addEventListener(type, onEvent, capture);
        };

        /**
         * @param {Node} el
         * @param {String} type
         * @param {Function} onEvent
         * @param {Boolean} [capture]
         */
        mono.off = function(el, type, onEvent, capture) {
          if (mono.noMouseEnter && ['mouseenter', 'mouseleave'].indexOf(type) !== -1) {
            var cacheEventKey = functionMap.key;
            if (type === 'mouseenter') {
              type = 'mouseover';
            } else
            if (type === 'mouseleave') {
              type = 'mouseout';
            }
            cacheEventKey += type;
            if (capture) {
              cacheEventKey += '-1';
              capture = false;
            }

            var eventId = onEvent[cacheEventKey];
            if (eventId !== undefined) {
              var origEvent = onEvent;
              onEvent = functionMap.replaceList[eventId];
              functionMap.bindCount[eventId]--;

              if (functionMap.bindCount[eventId] === 0) {
                delete origEvent[cacheEventKey];
                delete functionMap.replaceList[eventId];
                delete functionMap.bindCount[eventId];
              }
            }
          }

          el.removeEventListener(type, onEvent, capture);
        };

        /**
         * @param {Node} el
         * @param {String} type
         * @param {Function} onEvent
         * @param {Boolean} [capture]
         */
        mono.one = function(el, type, onEvent, capture) {
          var fnName = ['oneFn', type, !!capture].join('_');
          var fn = onEvent[fnName];
          if (!fn) {
            onEvent[fnName] = fn = function(e) {
              mono.off(this, type, fn, capture);
              onEvent.apply(this, arguments);
            }
          }
          mono.on(el, type, fn, capture);
          fnName = null;
          el = null;
        };
      }());

      mono.global = {};

      mono.initGlobal = function(cb) {
        if (!mono.isGM && mono.global.language && mono.global.preference) {
          return cb({
            getLanguage: mono.global.language,
            getPreference: mono.global.preference
          });
        }
        mono.sendMessage(['getLanguage', 'getPreference'], function(response) {
          mono.global.language = response.getLanguage;
          mono.global.preference = response.getPreference;
          cb(response);
        });
      };

      mono.getParentByClass = function(el, classList) {
        if (!Array.isArray(classList)) {
          classList = [classList];
        }

        for (var parent = el; parent; parent = parent.parentNode) {
          if (parent.nodeType !== 1) {
            return null;
          }
          for (var i = 0, className; className = classList[i]; i++) {
            if (parent.classList.contains(className)) {
              return parent;
            }
          }
        }

        return null;
      };

      /**
       * @param {string} url
       * @param {Object} [details]
       * @param {boolean} [details.params] Input params only [false]
       * @param {string} [details.sep] Separator [&]
       * @param {boolean} [details.noDecode] Disable decode keys [false]
       * @returns {{}}
       */
      mono.parseUrl = function(url, details) {
        details = details || {};
        var query = null;
        if (!details.params && /\?/.test(url)) {
          query = url.match(/[^\?]+\?(.+)/)[1];
        } else {
          query = url;
        }
        var separator = details.sep || '&';
        var dblParamList = query.split(separator);
        var params = {};
        for (var i = 0, len = dblParamList.length; i < len; i++) {
          var item = dblParamList[i];
          var keyValue = item.split('=');
          var key = keyValue[0];
          var value = keyValue[1] || '';
          if (!details.noDecode) {
            try {
              key = decodeURIComponent(key);
            } catch (err) {
              key = unescape(key);
            }
            try {
              params[key] = decodeURIComponent(value);
            } catch (err) {
              params[key] = unescape(value);
            }
          } else {
            params[key] = value;
          }
        }
        return params;
      };

      mono.throttle = function(fn, threshhold, scope) {
        threshhold = threshhold || 250;
        var last;
        var deferTimer;
        return function() {
          var context = scope || this;

          var now = Date.now();
          var args = arguments;
          if (last && now < last + threshhold) {
            // hold on to it
            mono.clearTimeout(deferTimer);
            deferTimer = mono.setTimeout(function() {
              last = now;
              fn.apply(context, args);
            }, threshhold);
          } else {
            last = now;
            fn.apply(context, args);
          }
        };
      };

      mono.debounce = function(fn, delay) {
        var timer = null;
        return function() {
          var context = this,
            args = arguments;
          mono.clearTimeout(timer);
          timer = mono.setTimeout(function() {
            fn.apply(context, args);
          }, delay);
        };
      };

      mono.getDomain = function(url, strip) {
        if (typeof url !== 'string') {
          return null;
        }

        var m = url.match(/:\/\/(?:[^\/?#]*@)?([^:\/?#]+)/);
        m = m && m[1];
        if (m) {
          if (strip) {
            m = m.replace(/^www\./, '');
          }
          return m;
        }
      };

      // legacy

      mono.getQueryString = function(query, key_prefix, key_suffix) {
        if (!query || typeof(query) != 'object')
          return '';

        if (key_prefix === undefined)
          key_prefix = '';

        if (key_suffix === undefined)
          key_suffix = '';

        var str = '';
        for (var key in query) {
          if (str.length)
            str += '&';

          if (query[key] instanceof Object) {
            if (!key_prefix)
              key_prefix = '';

            if (!key_suffix)
              key_suffix = '';

            str += mono.getQueryString(query[key], key_prefix + key + "[", "]" + key_suffix);
          } else
            str += key_prefix + escape(key) + key_suffix + '=' + escape(query[key]);
        }

        return str;
      };

      /**
       * @param {string} text
       * @returns {string}
       */
      mono.decodeUnicodeEscapeSequence = function(text) {
        try {
          return JSON.parse(JSON.stringify(text)
            .replace(mono.decodeUnicodeEscapeSequence.re, '$1'));
        } catch (e) {
          return text;
        }
      };
      mono.decodeUnicodeEscapeSequence.re = /\\(\\u[0-9a-f]{4})/g;

      mono.fileName = {
        maxLength: 80,

        rtrim: /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,

        illegalRe: /[\/\?<>\\:\*\|"]/g,

        controlRe: /[\x00-\x1f\x80-\x9f]/g,

        reservedRe: /^\.+/,

        trim: function(text) {
          return text.replace(this.rtrim, '');
        },

        partsRe: /^(.+)\.([a-z0-9]{1,4})$/i,

        getParts: function(name) {
          return name.match(this.partsRe);
        },

        specialChars: ('nbsp,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2' +
          ',sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,Agrave,Aacute,Acirc,Atilde,Auml' +
          ',Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml' +
          ',times,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil' +
          ',egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,divide,oslash' +
          ',ugrave,uacute,ucirc,uuml,yacute,thorn,yuml').split(','),
        specialCharsList: [
          ['amp', 'quot', 'lt', 'gt'],
          [38, 34, 60, 62]
        ],

        specialCharsRe: /&([^;]{2,6});/g,

        /**
         * @param {string} text
         * @returns {string}
         */
        decodeSpecialChars: function(text) {
          var _this = this;
          return text.replace(this.specialCharsRe, function(text, word) {
            var code = null;
            if (word[0] === '#') {
              code = parseInt(word.substr(1));
              if (isNaN(code)) {
                return '';
              }
              return String.fromCharCode(code);
            }

            var pos = _this.specialCharsList[0].indexOf(word);
            if (pos !== -1) {
              code = _this.specialCharsList[1][pos];
              return String.fromCharCode(code);
            }

            pos = _this.specialChars.indexOf(word);
            if (pos !== -1) {
              code = pos + 160;
              return String.fromCharCode(code);
            }

            return '';
          });
        },

        rnRe: /\r?\n/g,

        re1: /[\*\?"]/g,

        re2: /</g,

        re3: />/g,

        spaceRe: /[\s\t\uFEFF\xA0]+/g,

        dblRe: /(\.|!|\?|_|,|\-|:|\+){2,}/g,

        re4: /[\.,:;\/\-_\+=']$/g,

        /**
         * @param {string} name
         * @returns {string}
         */
        modify: function(name) {
          if (!name) {
            return '';
          }

          name = mono.decodeUnicodeEscapeSequence(name);

          try {
            name = decodeURIComponent(name);
          } catch (err) {
            name = unescape(name);
          }

          name = this.decodeSpecialChars(name);

          name = name.replace(this.rnRe, ' ');

          name = this.trim(name);

          name = name.replace(this.re1, '')
            .replace(this.re2, '(')
            .replace(this.re3, ')')
            .replace(this.spaceRe, ' ')
            .replace(this.dblRe, '$1')
            .replace(this.illegalRe, '_')
            .replace(this.controlRe, '')
            .replace(this.reservedRe, '')
            .replace(this.re4, '');

          if (name.length <= this.maxLength) {
            return name;
          }

          var parts = this.getParts(name);
          if (parts && parts.length == 3) {
            parts[1] = parts[1].substr(0, this.maxLength);
            return parts[1] + '.' + parts[2];
          }

          return name;
        }
      };
      /**
       * @param {number} min
       * @param {number} max
       * @returns {number}
       */
      mono.getRandomInt = function(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
      };
      /**
       * @param {string} dataName
       * @returns {string}
       */
      mono.dataAttr2Selector = function(dataName) {
        return 'data-' + dataName.replace(/[A-Z]/g, function(lit) {
          return '-' + lit.toLowerCase();
        });
      };
      /**
       * @param {Object} obj
       * @returns {boolean}
       */
      mono.isEmptyObject = function(obj) {
        for (var item in obj) {
          return false;
        }
        return true;
      };

      /**
       * @param {function} cb
       */
      mono.asyncCall = function(cb) {
        "use strict";
        mono.setTimeout(function() {
          cb();
        }, 0);
      };

      /**
       * @param {Function} cb
       * @param {Object} [scope]
       * @returns {Function}
       */
      mono.asyncFn = function(cb, scope) {
        return function() {
          var context = scope || this;
          var args = arguments;
          mono.setTimeout(function() {
            cb.apply(context, args);
          }, 0);
        };
      };

      /**
       * @param {Function} cb
       * @param {Object} [scope]
       * @returns {Function}
       */
      mono.onceFn = function(cb, scope) {
        return function() {
          if (cb) {
            var context = scope || this;
            cb.apply(context, arguments);
            cb = null;
          }
        };
      };

      /**
       * @param {Function} fn
       * @param {Number} [timeout]
       * @param {Function} alwaysCb
       * @param {Object} [scope]
       * @param {Function} [onTimeout]
       */
      mono.safeFn = function(fn, timeout, alwaysCb, scope, onTimeout) {
        if (typeof timeout === 'function') {
          onTimeout = scope;
          scope = alwaysCb;
          alwaysCb = timeout;
          timeout = 3000;
        }
        if (typeof scope === 'function') {
          onTimeout = scope;
          scope = null;
        }
        var timeoutId = null;
        var onceCb = mono.onceFn(function() {
          mono.clearTimeout(timeoutId);
          alwaysCb.apply(this, arguments);
        });

        return function() {
          var context = scope || this;
          var args = [].slice.call(arguments);

          var pos = args.indexOf(alwaysCb);
          if (pos !== -1) {
            args.splice(pos, 1, onceCb);
          }

          mono.setTimeout(function() {
            timeoutId = mono.setTimeout(function() {
              onceCb();
              onTimeout && onTimeout();
            }, timeout);
            fn.apply(context, args);
          }, 0);
        };
      };

      /**
       * @param {string} html
       * @param {RegExp|RegExp[]} match
       * @returns {string[]}
       */
      mono.getPageScript = function(html, match) {
        "use strict";
        if (match && !Array.isArray(match)) {
          match = [match];
        }
        var scriptList = [];
        html.replace(/<script(?:|\s[^>]+[^\/])>/g, function(text, offset) {
          offset += text.length;
          var endPos = html.indexOf('<\/script>', offset);
          if (endPos !== -1) {
            var content = html.substr(offset, endPos - offset);
            if (match) {
              match.every(function(r) {
                return r.test(content);
              }) && scriptList.push(content);
            } else {
              scriptList.push(content);
            }
          }
        });
        return scriptList;
      };

      /**
       * @param {string} html
       * @param {RegExp|RegExp[]} match
       * @returns {Object[]}
       */
      mono.findJson = function(html, match) {
        "use strict";
        if (match && !Array.isArray(match)) {
          match = [match];
        }
        var rawJson = [];
        var obj = {
          '{': 0,
          '[': 0
        };
        var map = {
          '}': '{',
          ']': '['
        };
        var jsonSymbols = /[{}\]\[":0-9.,-]/;
        var whiteSpace = /[\r\n\s\t]/;
        var jsonText = '';
        for (var i = 0, symbol; symbol = html[i]; i++) {
          if (symbol === '"') {
            var end = i;
            while (end !== -1 && (end === i || html[end - 1] === '\\')) {
              end = html.indexOf('"', end + 1);
            }
            if (end === -1) {
              end = html.length - 1;
            }
            jsonText += html.substr(i, end - i + 1);
            i = end;
            continue;
          }

          if (!jsonSymbols.test(symbol)) {
            if (symbol === 't' && html.substr(i, 4) === 'true') {
              jsonText += 'true';
              i += 3;
            } else
            if (symbol === 'f' && html.substr(i, 5) === 'false') {
              jsonText += 'false';
              i += 4;
            } else
            if (symbol === 'n' && html.substr(i, 4) === 'null') {
              jsonText += 'null';
              i += 3;
            } else
            if (!whiteSpace.test(symbol)) {
              obj['{'] = 0;
              obj['['] = 0;
              jsonText = '';
            }
            continue;
          }

          jsonText += symbol;

          if (symbol === '{' || symbol === '[') {
            if (!obj['{'] && !obj['[']) {
              jsonText = symbol;
            }
            obj[symbol]++;
          } else
          if (symbol === '}' || symbol === ']') {
            obj[map[symbol]]--;
            if (!obj['{'] && !obj['[']) {
              rawJson.push(jsonText);
            }
          }
        }
        var jsonList = [];
        for (var i = 0, item; item = rawJson[i]; i++) {
          if (item === '{}' || item === '[]') {
            continue;
          }
          try {
            if (match) {
              match.every(function(r) {
                return r.test(item);
              }) && jsonList.push(JSON.parse(item));
            } else {
              jsonList.push(JSON.parse(item));
            }
          } catch (e) {
            // console.log('bad json', item);
          }
        }
        return jsonList;
      };

      mono.findJsonString = function(html, match) {
        "use strict";
        if (match && !Array.isArray(match)) {
          match = [match];
        }

        var rawString = [];
        var lastPos = -1;
        var pos = -1;
        do {
          pos = html.indexOf('"', pos + 1);
          if (pos !== -1) {
            if (html[pos - 1] === '\\') {
              continue;
            }
            if (lastPos !== -1) {
              rawString.push(html.substr(lastPos, pos + 1 - lastPos));
              lastPos = -1;
            } else {
              lastPos = pos;
            }
          } else {
            lastPos = pos;
          }
        } while (pos !== -1);

        var stringList = [];
        for (var i = 0, item; item = rawString[i]; i++) {
          if (item === '""') {
            continue;
          }
          try {
            if (match) {
              match.every(function(r) {
                return r.test(item);
              }) && stringList.push(JSON.parse(item));
            } else {
              stringList.push(JSON.parse(item));
            }
          } catch (e) {
            // console.log('bad json', item);
          }
        }
        return stringList;
      };

      /**
       * @param {Object|Array} cssStyleObj
       * @param {string|Array} [parentSelector]
       * @returns {string}
       */
      mono.style2Text = function(cssStyleObj, parentSelector) {
        "use strict";
        var list = [];

        if (!Array.isArray(cssStyleObj)) {
          cssStyleObj = [cssStyleObj];
        }

        if (parentSelector && !Array.isArray(parentSelector)) {
          parentSelector = [parentSelector];
        }

        var styleToText = function(selectorArr, styleObj) {
          "use strict";
          var content = [];

          for (var item in styleObj) {
            var value = styleObj[item];

            if (item === 'cssFloat') {
              item = 'float';
            }

            var key = item.replace(/([A-Z])/g, function(text, letter) {
              return '-' + letter.toLowerCase();
            });

            content.push(key + ':' + value);
          }

          if (!content.length) {
            return '';
          } else {
            return [selectorArr.join(','), '{', content.join(';'), '}'].join('');
          }
        };

        var inheritSelector = function(section, selector) {
          if (!Array.isArray(selector)) {
            selector = [selector];
          }

          if (parentSelector) {
            var _selector = [];
            var join = (section.join || section.join === '') ? section.join : ' ';
            parentSelector.forEach(function(parentSelector) {
              selector.forEach(function(selector) {
                _selector.push(parentSelector + join + selector);
              });
            });
            selector = _selector;
          }

          return selector;
        };

        cssStyleObj.forEach(function(section) {
          var inhSelector = null;
          var media = section.media;
          var selector = section.selector;
          var style = section.style;
          var append = section.append;

          if (media && append) {
            list.push([media, '{', mono.style2Text(append, parentSelector), '}'].join(''));
          } else
          if (!selector && !style) {
            for (var key in section) {
              if (['append', 'join'].indexOf(key) !== -1) {
                continue;
              }
              selector = key;
              style = section[key];

              append = style.append;
              if (append) {
                delete style.append;
              }

              inhSelector = inheritSelector(section, selector);
              list.push(styleToText(inhSelector, style));

              if (append) {
                list.push(mono.style2Text(append, inhSelector));
              }
            }
          } else {
            inhSelector = inheritSelector(section, selector);
            list.push(styleToText(inhSelector, style));

            if (append) {
              list.push(mono.style2Text(append, inhSelector));
            }
          }
        });

        return list.join('');
      };

      mono.styleReset = {
        animation: "none 0s ease 0s 1 normal none running",
        backfaceVisibility: "visible",
        background: "transparent none repeat 0 0 / auto auto padding-box border-box scroll",
        border: "medium none currentColor",
        borderCollapse: "separate",
        borderImage: "none",
        borderRadius: "0",
        borderSpacing: "0",
        bottom: "auto",
        boxShadow: "none",
        boxSizing: "content-box",
        captionSide: "top",
        clear: "none",
        clip: "auto",
        color: "inherit",
        columns: "auto",
        columnCount: "auto",
        columnFill: "balance",
        columnGap: "normal",
        columnRule: "medium none currentColor",
        columnSpan: "1",
        columnWidth: "auto",
        content: "normal",
        counterIncrement: "none",
        counterReset: "none",
        cursor: "auto",
        direction: "ltr",
        display: "inline",
        emptyCells: "show",
        float: "none",
        font: "normal normal normal normal medium/normal inherit",
        height: "auto",
        hyphens: "none",
        left: "auto",
        letterSpacing: "normal",
        listStyle: "disc outside none",
        margin: "0",
        maxHeight: "none",
        maxWidth: "none",
        minHeight: "0",
        minWidth: "0",
        opacity: "1",
        orphans: "0",
        outline: "medium none invert",
        overflow: "visible",
        overflowX: "visible",
        overflowY: "visible",
        padding: "0",
        pageBreakAfter: "auto",
        pageBreakBefore: "auto",
        pageBreakInside: "auto",
        perspective: "none",
        perspectiveOrigin: "50% 50%",
        position: "static",
        right: "auto",
        tabSize: "8",
        tableLayout: "auto",
        textAlign: "inherit",
        textAlignLast: "auto",
        textDecoration: "none solid currentColor",
        textIndent: "0",
        textShadow: "none",
        textTransform: "none",
        top: "auto",
        transform: "none",
        transformOrigin: "50% 50% 0",
        transformStyle: "flat",
        transition: "none 0s ease 0s",
        unicodeBidi: "normal",
        verticalAlign: "baseline",
        visibility: "visible",
        whiteSpace: "normal",
        widows: "0",
        width: "auto",
        wordSpacing: "normal",
        zIndex: "auto",
        all: "initial"
      };

      /**
       * @param {string} host
       * @param {Array} hostList
       * @returns {boolean}
       */
      mono.matchHost = function(host, hostList) {
        "use strict";
        var dotPos;
        while ((dotPos = host.indexOf('.')) !== -1) {
          if (hostList.indexOf(host) !== -1) {
            return true;
          }
          host = host.substr(dotPos + 1);
        }

        return false;
      };

      /**
       * @param {string} key
       * @param {Function} callback
       */
      mono.storage.getExpire = function(key, callback) {
        "use strict";
        var prefix = mono.storage.getExpire.prefix;
        var now = parseInt(Date.now() / 1000);
        var expireKey = key + prefix;
        return mono.storage.get([key, expireKey], function(storage) {
          var isExpire = storage[expireKey] === undefined || storage[expireKey] < now;
          var _storage = {};
          _storage[key] = storage[key];
          return callback(_storage, isExpire);
        });
      };

      mono.storage.getExpire.prefix = '_expire_';

      /**
       * @param {Object} storage
       * @param {number} time
       * @param {function} [callback]
       */
      mono.storage.setExpire = function(storage, time, callback) {
        "use strict";
        var prefix = mono.storage.getExpire.prefix;
        var now = parseInt(Date.now() / 1000);
        var setObj = {};
        for (var key in storage) {
          setObj[key] = storage[key];
          setObj[key + prefix] = now + time;
        }
        return mono.storage.set(setObj, function() {
          return callback && callback();
        });
      };

      mono.onRemoveClassName = 'sf-notify-on-remove';
      /**
       * @param {Element} node
       * @param {Function} event
       */
      mono.onRemoveEvent = function(node, event) {
        "use strict";
        node.classList.add(mono.onRemoveClassName);
        node.addEventListener('sf-removed', event);
      };
      /**
       * @param {Element} node
       */
      mono.onRemoveListener = function(node) {
        "use strict";
        mono.trigger(node, 'sf-removed');
      };
      /**
       * @param {Element} node
       * @param {Function} event
       */
      mono.offRemoveEvent = function(node, event) {
        "use strict";
        node.removeEventListener('sf-removed', event);
      };

      /**
       * @param {Node|Element} node
       * @param {string} selector
       * @returns {boolean}
       */
      mono.matches = function(node, selector) {
        "use strict";
        var el = document.createElement('div');
        if (typeof el.matches === 'function') {
          mono.matches = function(node, selector) {
            return node.matches(selector);
          };
        } else
        if (typeof el.matchesSelector === 'function') {
          mono.matches = function(node, selector) {
            return node.matchesSelector(selector);
          };
        } else
        if (typeof el.webkitMatchesSelector === 'function') {
          mono.matches = function(node, selector) {
            return node.webkitMatchesSelector(selector);
          };
        } else
        if (typeof el.mozMatchesSelector === 'function') {
          mono.matches = function(node, selector) {
            return node.mozMatchesSelector(selector);
          };
        } else
        if (typeof el.oMatchesSelector === 'function') {
          mono.matches = function(node, selector) {
            return node.oMatchesSelector(selector);
          };
        } else
        if (typeof el.msMatchesSelector === 'function') {
          mono.matches = function(node, selector) {
            return node.msMatchesSelector(selector);
          };
        } else {
          mono.matches = function(node, selector) {
            return false;
          };
        }
        el = null;

        return mono.matches.call(this, node, selector);
      };

      /**
       * @param {Element} node
       * @param {string} selector
       * @returns {Node|null}
       */
      mono.getParent = function(node, selector) {
        if (!node || node.nodeType !== 1) {
          return null;
        }

        if (mono.matches(node, selector)) {
          return node;
        }

        if (!mono.matches(node, selector + ' ' + node.tagName)) {
          return null;
        }

        node = node.parentNode;
        for (var parent = node; parent; parent = parent.parentNode) {
          if (parent.nodeType !== 1) {
            return null;
          }

          if (mono.matches(parent, selector)) {
            return parent;
          }
        }

        return null;
      };

      /**
       * @param {string} value
       * @returns {string}
       */
      mono.escapeRegex = function(value) {
        "use strict";
        return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&");
      };

      /**
       * @param {function} callback
       * @constructor
       */
      mono.AsyncList = function(callback) {
        var wait = 0;
        var ready = 0;
        var fired = false;
        this.ready = function(err) {
          if (fired) {
            return;
          }

          if (err) {
            fired = true;
            return callback(err);
          }

          ready++;
          if (wait === ready) {
            fired = true;
            return callback();
          }
        };
        this.wait = function() {
          wait++;
        };
      };

      /**
       * @param {*} msg
       * @param {string} [hook]
       * @returns {Promise}
       */
      mono.sendMessagePromise = function(msg, hook) {
        "use strict";
        return new mono.Promise(function(resolve, reject) {
          try {
            mono.sendMessage(msg, resolve, hook);
          } catch (e) {
            reject(e);
          }
        });
      };

      /**
       * @param {String|[String]|Object|null|undefined} keys
       * @returns {Promise}
       */
      mono.storage.getPromise = function(keys) {
        "use strict";
        return new mono.Promise(function(resolve, reject) {
          try {
            mono.storage.get(keys, resolve);
          } catch (e) {
            reject(e);
          }
        });
      };

      /**
       * @param {Object} items
       * @returns {Promise}
       */
      mono.storage.setPromise = function(items) {
        "use strict";
        return new mono.Promise(function(resolve, reject) {
          try {
            mono.storage.set(items, resolve);
          } catch (e) {
            reject(e);
          }
        });
      };

      /**
       * @param {String|[String]} keys
       * @returns {Promise}
       */
      mono.storage.removePromise = function(keys) {
        "use strict";
        return new mono.Promise(function(resolve, reject) {
          try {
            mono.storage.remove(keys, resolve);
          } catch (e) {
            reject(e);
          }
        });
      };

      /**
       * @returns {Promise}
       */
      mono.storage.clearPromise = function() {
        "use strict";
        return new mono.Promise(function(resolve, reject) {
          try {
            mono.storage.clear(resolve);
          } catch (e) {
            reject(e);
          }
        });
      };

      /**
       * @param {requestDetails} obj
       * @returns {Promise}
       */
      mono.requestPromise = function(obj) {
        "use strict";
        return new mono.Promise(function(resolve, reject) {
          var always = function(err, resp, data) {
            if (err) {
              reject(err);
            } else {
              resolve(resp, data);
            }
          };

          try {
            mono.request(obj, always);
          } catch (e) {
            reject(e);
          }
        });
      };

      /**
       * @returns {Number}
       */
      mono.getTime = function() {
        return parseInt(Date.now() / 1000);
      };

      mono.debug = function() {
        if (mono.debugMode) {
          var args = [].slice.call(arguments);
          args.unshift('sf');
          if (mono.isEdge) {
            console.log.apply(console, args);
          } else
          if (mono.isFF) {
            console.error.apply(console, args);
          } else {
            console.trace.apply(console, args);
          }
        }
      };

      mono.error = function() {
        var args = [].slice.call(arguments);
        args.unshift('sf');
        console.error.apply(console, arguments);
      };

      _mono && (function(tmpMono) {
        "use strict";
        _mono = null;
        var args, list = tmpMono.loadModuleStack;
        if (list) {
          while (args = list.shift()) {
            // async
            mono.asyncFn(mono.loadModule).apply(mono, args);
          }
        }
      })(_mono);
      //<utils

      if (typeof Promise === 'function' &&
        typeof Promise.resolve === 'function' &&
        typeof Promise.reject === 'function'
      ) {
        mono.Promise = Promise;
      } else
      if (mono.isModule) {
        mono.Promise = require('sdk/core/promise').Promise;
      }

      !mono.Promise && (function() {
        // Use polyfill for setImmediate for performance gains
        var asap = (typeof setImmediate === 'function' && setImmediate) ||
          function(fn) {
            mono.setTimeout(fn, 0);
          };

        /**
         @license
         Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
         This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
         The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
         The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
         Code distributed by Google as part of the polymer project is also
         subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
         */
        // @url https://github.com/PolymerLabs/promise-polyfill
        // @version 1.0.0
        function MakePromise(asap) {
          function Promise(fn) {
            if (typeof this !== 'object' || typeof fn !== 'function') throw new TypeError();
            this._state = null;
            this._value = null;
            this._deferreds = []

            doResolve(fn, resolve.bind(this), reject.bind(this));
          }

          function handle(deferred) {
            var me = this;
            if (this._state === null) {
              this._deferreds.push(deferred);
              return
            }
            asap(function() {
              var cb = me._state ? deferred.onFulfilled : deferred.onRejected
              if (typeof cb !== 'function') {
                (me._state ? deferred.resolve : deferred.reject)(me._value);
                return;
              }
              var ret;
              try {
                ret = cb(me._value);
              } catch (e) {
                deferred.reject(e);
                return;
              }
              deferred.resolve(ret);
            })
          }

          function resolve(newValue) {
            try { //Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure
              if (newValue === this) throw new TypeError();
              if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {
                var then = newValue.then;
                if (typeof then === 'function') {
                  doResolve(then.bind(newValue), resolve.bind(this), reject.bind(this));
                  return;
                }
              }
              this._state = true;
              this._value = newValue;
              finale.call(this);
            } catch (e) {
              reject.call(this, e);
            }
          }

          function reject(newValue) {
            this._state = false;
            this._value = newValue;
            finale.call(this);
          }

          function finale() {
            for (var i = 0, len = this._deferreds.length; i < len; i++) {
              handle.call(this, this._deferreds[i]);
            }
            this._deferreds = null;
          }

          /**
           * Take a potentially misbehaving resolver function and make sure
           * onFulfilled and onRejected are only called once.
           *
           * Makes no guarantees about asynchrony.
           */
          function doResolve(fn, onFulfilled, onRejected) {
            var done = false;
            try {
              fn(function(value) {
                if (done) return;
                done = true;
                onFulfilled(value);
              }, function(reason) {
                if (done) return;
                done = true;
                onRejected(reason);
              })
            } catch (ex) {
              if (done) return;
              done = true;
              onRejected(ex);
            }
          }

          Promise.prototype['catch'] = function(onRejected) {
            return this.then(null, onRejected);
          };

          Promise.prototype.then = function(onFulfilled, onRejected) {
            var me = this;
            return new Promise(function(resolve, reject) {
              handle.call(me, {
                onFulfilled: onFulfilled,
                onRejected: onRejected,
                resolve: resolve,
                reject: reject
              });
            })
          };

          Promise.resolve = function(value) {
            if (value && typeof value === 'object' && value.constructor === Promise) {
              return value;
            }

            return new Promise(function(resolve) {
              resolve(value);
            });
          };

          Promise.reject = function(value) {
            return new Promise(function(resolve, reject) {
              reject(value);
            });
          };


          return Promise;
        }

        mono.Promise = MakePromise(asap);
      })(mono);

      (function(Promise) {
        Promise.all = Promise.all || function() {
          var args = Array.prototype.slice.call(arguments.length === 1 && Array.isArray(arguments[0]) ? arguments[0] : arguments);

          return new Promise(function(resolve, reject) {
            if (args.length === 0) return resolve([]);
            var remaining = args.length;

            function res(i, val) {
              try {
                if (val && (typeof val === 'object' || typeof val === 'function')) {
                  var then = val.then;
                  if (typeof then === 'function') {
                    then.call(val, function(val) {
                      res(i, val)
                    }, reject);
                    return;
                  }
                }
                args[i] = val;
                if (--remaining === 0) {
                  resolve(args);
                }
              } catch (ex) {
                reject(ex);
              }
            }
            for (var i = 0; i < args.length; i++) {
              res(i, args[i]);
            }
          });
        };

        Promise.race = Promise.race || function(values) {
          return new Promise(function(resolve, reject) {
            for (var i = 0, len = values.length; i < len; i++) {
              values[i].then(resolve, reject);
            }
          });
        };
      })(mono.Promise);
      //@insert

      return mono;
    }
  ));

  typeof window === 'undefined' && (function() {
    mono = require('./../data/js/mono.js');
  })();

  var engine = {};

  engine.varCache = {
    // helper name
    helperName: '',
    // extension version
    currentVersion: '',
    langList: ['en', 'de', 'ru', 'tr', 'uk', 'es', 'fr', 'id'],
    meta: {},
    isFirstrun: false,
    isUpgrade: false,
    uuid: ''
  };

  engine.extra = {};

  engine.defaultPreferences = {
    version: '0',
    button: 1,
    lmFileHosting: 1,
    lmMediaHosting: 1,
    moduleYoutube: 1,
    moduleDailymotion: 1,
    moduleVimeo: 1,
    moduleFacebook: 1,
    moduleSoundcloud: 1,
    moduleVkontakte: 1,
    moduleOdnoklassniki: 1,
    moduleMailru: 1,
    moduleInstagram: 1,
    moduleRutube: 1,
    moduleShowDownloadInfo: 1,
    ytHideFLV: 0,
    ytHideMP4: 0,
    ytHideWebM: 1,
    ytHide3GP: 1,
    ytHide3D: 1,
    ytHideMP4NoAudio: 1,
    ytHideAudio_MP4: 1,
    vkShowBitrate: 0,
    sovetnikEnabled: 1,
    showUmmyInfo: 1,
    showUmmyBtn: 1,
    gmNativeDownload: 0,
    expIndex: 0,
    advPreShow: 0,
    showTutorial: 0,
    showUmmyLanding: 0,
    aviaBarEnabled: 1,
    statEnabled: 1,
    showMp3Btn: 1
  };

  engine.preferences = {
    sfHelperName: '',
    country: '',
    hasSovetnik: undefined,
    hasDP: undefined,
    hasAviaBar: undefined,
    cohortIndex: undefined,
    downloads: undefined,
    ummyDetected: undefined,
    showUmmyItem: undefined
  };

  engine.preferenceMap = {
    youtube: 'moduleYoutube',
    dailymotion: 'moduleDailymotion',
    vimeo: 'moduleVimeo',
    facebook: 'moduleFacebook',
    soundcloud: 'moduleSoundcloud',
    vk: 'moduleVkontakte',
    odnoklassniki: 'moduleOdnoklassniki',
    mailru: 'moduleMailru',
    instagram: 'moduleInstagram',
    rutube: 'moduleRutube'
  };

  engine.modules = {};
  engine.utils = {};

  engine.loader = (function() {
    var DEBUG = false;
    var waitList = [];
    var readyList = [];
    var run = function() {
      waitList.slice(0).forEach(function(obj) {
        var isReady = obj.nameList.every(function(name) {
          return readyList.indexOf(name) !== -1;
        });
        if (isReady) {
          var pos = waitList.indexOf(obj);
          if (pos !== -1) {
            waitList.splice(pos, 1);
            try {
              DEBUG && console.debug('Loader run', obj.nameList);
              obj.fn();
            } catch (e) {
              mono.error('Run error!', e);
            }
          }
        }
      });
    };
    /**
     * @param {String} name
     */
    var ready = function(name) {
      DEBUG && console.trace('Loader ready', name);
      readyList.push(name);
      run();
    };
    /**
     * @param {String|String[]} nameList
     * @param {Function} fn
     */
    var when = function(nameList, fn) {
      DEBUG && console.trace('Loader when', nameList);
      if (!Array.isArray(nameList)) {
        nameList = [nameList];
      }
      waitList.push({
        nameList: nameList,
        fn: fn
      });
      run();
    };

    return {
      waitList: waitList,
      readyList: readyList,
      ready: ready,
      when: when
    }
  })();

  engine.events = (function() {
    var DEBUG = false;
    var listeners = {};
    var slice = [].slice;
    /**
     * @param {string} event
     * @param {...*} params
     */
    var emit = function(event, params) {
      var args = slice.call(arguments).slice(1);
      var arr = listeners[event] || [];
      arr.slice(0).forEach(function(callback) {
        try {
          DEBUG && console.debug('Events emit', event);
          callback.apply(null, args);
        } catch (e) {
          mono.error('Emit error!', e);
        }
      });
    };
    /**
     * @param {string} event
     * @param {Function} callback
     */
    var on = function(event, callback) {
      var arr = listeners[event];
      if (!listeners[event]) {
        arr = listeners[event] = [];
      }
      var pos = arr.indexOf(callback);
      if (pos === -1) {
        DEBUG && console.trace('Events on', event);
        arr.push(callback);
      }
    };
    /**
     * @param {string} event
     * @param {Function} callback
     */
    var off = function(event, callback) {
      var arr = listeners[event] || [];
      var pos = arr.indexOf(callback);
      if (pos !== -1) {
        DEBUG && console.trace('Events off', event);
        arr.splice(pos, 1);
      }
    };
    /**
     * @param {string} event
     * @param {Function} callback
     */
    var once = function(event, callback) {
      DEBUG && console.trace('Events once', event);
      var _callback = function() {
        off(event, callback);
        callback.apply(null, arguments);
      };
      on(event, _callback);
    };

    return {
      listeners: listeners,
      emit: emit,
      on: on,
      off: off,
      once: once
    }
  })();

  engine.getHelperName = function() {
    "use strict";
    var getBrowserName = function() {
      var browser = '';
      var userAgent = mono.getNavigator().userAgent;
      if (userAgent.indexOf('YaBrowser\/') !== -1) {
        browser = 'yabrowser';
      } else
      if (userAgent.indexOf('Maxthon\/') !== -1) {
        browser = 'maxthon';
      } else
      if (userAgent.indexOf('OPR\/') !== -1) {
        browser = 'opera-chromium';
      } else
      if (userAgent.indexOf('Opera\/') !== -1) {
        browser = 'opera';
      } else
      if (userAgent.indexOf('Firefox\/') !== -1) {
        browser = 'firefox';
      } else
      if (userAgent.indexOf('Chrome\/') !== -1) {
        browser = 'chrome';
      } else
      if (userAgent.indexOf('Safari\/') !== -1) {
        browser = 'safari';
      }
      return browser;
    };

    var browser = 'unknown';
    if (mono.isChrome) {
      browser = getBrowserName() || 'chrome';
      if (/sandbox.html#bg/.test(location.href)) {
        browser = 'chameleon';
      }
      if (engine.chromeNoStore) {
        browser += '-sf';
      }
    } else
    if (mono.isFF) {
      browser = 'firefox';
      if (!engine.varCache.ffButton) {
        browser += '-mobile';
      }
      if (engine.ffNoStore) {
        browser += '-sf';
      }
    } else
    if (mono.isSafari) {
      browser = 'safari';
    } else
    if (mono.isOpera) {
      browser = 'opera';
    } else
    if (mono.isGM) {
      browser = getBrowserName() || browser;
      browser = 'userjs-' + browser;
    } else
    if (mono.isEdge) {
      browser = 'edge';
    }

    return browser;
  };

  engine.getSfHelperName = function() {
    var name = engine.varCache.helperName;
    if (/^firefox/.test(name)) {
      name = name.replace('firefox', 'ff');
    }
    return name;
  };

  engine.dblTrackCheck = function(cb) {
    "use strict";
    var DEBUG = false;
    if (!mono.isGM) {
      return cb();
    }

    if (mono.isIframe()) {
      DEBUG && mono.debug('dblTrack inside frame disabled!');
      return;
    }

    mono.storage.get('dblTrack', function(storage) {
      var now = Date.now();
      if (typeof storage.dblTrack !== 'string') {
        storage.dblTrack = '';
      }

      var dataList = storage.dblTrack.split(',');
      if (dataList[1] > now) {
        DEBUG && mono.debug('dblTrack is not expired!');
        return;
      }

      var uuid = engine.generateUuid();
      var expire = now + 60000;
      mono.storage.set({
        dblTrack: uuid + ',' + expire
      });

      setTimeout(function() {
        mono.storage.get('dblTrack', function(storage) {
          if (typeof storage.dblTrack === 'string') {
            var dataList = storage.dblTrack.split(',');
            if (dataList[0] === uuid) {
              DEBUG && mono.debug('dblTrack callback');
              cb();
            } else {
              DEBUG && mono.debug('dblTrack uuid is change');
            }
          }
        });
      }, 5000);
    });
  };

  engine.getUuid = function() {
    "use strict";
    var varCache = engine.varCache;
    if (varCache.uuid) {
      return varCache.uuid;
    }

    var uuid = engine.generateUuid();
    varCache.uuid = uuid;
    mono.storage.set({
      uuid: uuid
    });
    return uuid;
  };

  engine.generateUuid = function() {
    "use strict";
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      var r = Math.random() * 16 | 0,
        v = c == 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  };

  engine.sovetnikIsAvailable = function() {
    "use strict";
    if (!mono.isFF && !mono.isChrome && !mono.isGM && !mono.isOpera) {
      return false;
    }
    if (mono.isFF && !engine.varCache.ffButton) {
      return false;
    }
    if (mono.isChrome && mono.isChromeMobile) {
      return false;
    }
    return true;
  };

  /**
   * @returns {string}
   */
  engine.getNavLanguage = function() {
    var language = '';
    var navLanguage = mono.getNavigator().language;
    if (/^\w{2}-|^\w{2}$/.test(navLanguage)) {
      language = navLanguage;
    }
    return language;
  };

  engine.loadLanguage = function(cb) {
    "use strict";
    var language = engine.language;
    var varCache = engine.varCache;
    var langList = varCache.langList;
    var defaultLocale = langList[0];
    var locale = mono.getLoadedLocale();
    if (!locale) {
      var navLanguage = engine.getNavLanguage().substr(0, 2).toLowerCase();
      if (langList.indexOf(navLanguage) !== -1) {
        locale = navLanguage;
      } else {
        locale = defaultLocale;
      }
    }

    (function getLanguage(locale, cb) {
      mono.getLanguage(locale, function(err, _language) {
        if (err) {
          if (locale !== defaultLocale) {
            getLanguage(defaultLocale, cb);
          } else {
            cb();
          }
        } else {
          mono.extend(language, _language);
          cb();
        }
      });
    })(locale, cb);
  };

  engine.language = {};
  engine.operaShowButton = (function() {
    var button = null;
    return function(enabled) {
      "use strict";
      if (button !== null) {
        opera.contexts.toolbar.removeItem(button);
        button = null;
      }
      if (enabled) {
        button = opera.contexts.toolbar.createItem({
          title: 'SaveFrom.net helper',
          icon: "img/icon_18.png",
          popup: {
            href: "popup.html",
            width: 482,
            height: 404
          }
        });
        opera.contexts.toolbar.addItem(button);
      }
    };
  })();

  engine.gmShowButton = function(enabled) {
    if (enabled) {
      _menu.setTitle(engine.language.extName, engine.varCache.currentVersion);
      mono.storage.get('gmIconTop', function(storage) {
        if (storage.gmIconTop === 0 || storage.gmIconTop) {
          _menu.style.menu.initial.top = storage.gmIconTop + 'px';
        }
        _menu.create(1);
      });
    } else {
      _menu.hide();
    }
  };

  engine.tabListener = (function() {
    "use strict";
    var isListen = false;
    var preferences = engine.preferences;
    var extendJsList = {};
    var excludeList = [
      "*://*.google.*/*",
      "*://*.acidtests.org/*",

      "*://*.savefrom.net/*",
      "*://*.youtube.com/*",
      "*://*.vimeo.com/*",
      "*://*.dailymotion.*/*",
      "*://*.vk.com/*",
      "*://*.vkontakte.ru/*",
      "*://*.odnoklassniki.ru/*",
      "*://my.mail.ru/*",
      "*://*.ok.ru/*",
      "*://*.soundcloud.com/*",
      "*://*.facebook.com/*",
      "*://*.instagram.com/*",
      "*://*.rutube.ru/*"
    ];
    var matchCache = null;
    var checkBlackList = function(url) {
      return matchCache.test(url);
    };
    var listener = function(tab) {
      var url = tab.url;
      var inBlackList = checkBlackList(url);
      var scripts = [];

      var addLm = preferences.lmFileHosting || preferences.lmMediaHosting;
      var addSovetnik = preferences.hasSovetnik && preferences.sovetnikEnabled;

      if (mono.isChrome || mono.isEdge) {
        addSovetnik = addSovetnik && window.sovetnik;
      } else
      if (mono.isFF) {
        addSovetnik = addSovetnik && engine.ffSovetnik && engine.ffSovetnik.api.isReady;
      }

      if (!inBlackList) {
        if (addLm) {
          scripts.push('includes/components.js');
          scripts.push('includes/link_modifier.js');
        }
        if (addSovetnik) {
          if (mono.isChrome || mono.isEdge) {
            scripts.push('includes/sovetnik-sf.js');
          } else
          if (mono.isFF) {
            if (!engine.ffSovetnik.isDenyURL(tab.url)) {
              engine.ffSovetnik.api.onTabReady(tab);
            }
          }
        }
      }

      var empty = true;
      for (var key in extendJsList) {
        empty = false;
        var item = extendJsList[key];
        if (!inBlackList || item.noBlackList) {
          var scriptList = item.getScriptList(url);
          for (var i = 0, path; path = scriptList[i]; i++) {
            if (scripts.indexOf(path) === -1) {
              scripts.push(path);
            }
          }
        }
      }

      if (!addLm && !addSovetnik && empty) {
        removeListener();
      } else
      if (scripts.length) {
        scripts.unshift('js/mono.js');

        mono.debug('Inject', url, scripts);

        var worker = mono.executeScripts(tab, {
          files: scripts
        });

        if (mono.isFF) {
          engine.varCache.monoLib.addPage(worker);
        }
      }
    };
    var removeListener = function() {
      mono.tabsRemoveListener(listener);
      isListen = false;
      mono.debug('tabListener', isListen);
    };
    var addListener = function() {
      if (!isListen) {
        mono.tabsAddListener(listener);
        isListen = true;
        mono.debug('tabListener', isListen);
      }
    };
    var buildMatchCache = function() {
      if (!matchCache) {
        matchCache = excludeList.map(function(pattern) {
          return mono.urlPatternToStrRe(pattern);
        }).join('|');
        matchCache = new RegExp(matchCache);
      }
    };
    var enable = function() {
      if (mono.isChrome || mono.isFF || mono.isEdge) {
        buildMatchCache();
        addListener();
      }
    };
    var disable = function() {
      if (mono.isChrome || mono.isFF || mono.isEdge) {
        removeListener();
      }
    };
    var injectLmInActiveTab = function() {
      var scripts = [
        'js/mono.js',
        'includes/components.js',
        'includes/link_modifier.js'
      ];

      mono.getActiveTab(function(tab) {
        if (tab && /^http/.test(tab.url) && !checkBlackList(tab.url)) {
          var worker = mono.executeScripts(tab, {
            files: scripts
          });

          if (mono.isFF) {
            engine.varCache.monoLib.addPage(worker);
          }
        }
      });
    };
    return {
      extendJsList: extendJsList,
      excludeList: excludeList,
      enable: enable,
      disable: disable,
      injectLmInActiveTab: injectLmInActiveTab
    }
  })();

  engine.cohort = (function() {
    var store = {};
    var save = function() {
      mono.storage.set({
        cohort: store
      });
    };
    var setStore = function(value) {
      value && mono.extend(store, value);
    };
    var isAllow = function(index) {
      var result = false;
      if (index === 1) {
        result = mono.isGM || engine.preferences.sfHelperName === 'ff-sf' || mono.isSafari || mono.isOpera || mono.isChrome;
      }
      return result;
    };
    var setIndex = function(index) {
      engine.preferences.cohortIndex = index;
      mono.debug('Cohort', index);
    };
    var run = function() {
      if (store.index && isAllow(store.index)) {
        setIndex(store.index);
      }
    };
    var firstRun = function() {
      /*store.index = parseInt('cohort index');

      if (this.isAllow(store.index)) {
        save();
        setIndex(store.index);
      }*/
    };
    var sendData = function(params) {
      var uuid = engine.getUuid();
      var tidList = {
        1: 'UA-7055055-8',
        2: null,
        3: null,
        4: null
      };

      var defaultParams = {
        v: 1,
        ul: mono.getNavigator().language,
        tid: tidList[store.index],
        cid: uuid
      };

      for (var key in defaultParams) {
        if (!params.hasOwnProperty(key)) {
          params[key] = defaultParams[key];
        }
      }

      if (!params.tid) {
        return;
      }

      mono.debug('Cohort track', params);

      return mono.request({
        url: 'https://www.google-analytics.com/collect',
        type: 'POST',
        data: mono.param(params)
      });
    };
    var track = function(params) {
      if (engine.trackValidate(params)) {
        sendData(params);
      } else {
        mono.error('Invalid track params!', params);
      }
    };
    return {
      setStore: setStore,
      firstRun: firstRun,
      run: run,
      track: track
    }
  })();

  engine.getCountry = function() {
    "use strict";
    var preferences = engine.preferences;
    var varCache = engine.varCache;

    var getCountryFromLanguage = function(callback) {
      var lang2country = {
        be: 'by',
        kk: 'kz',
        ru: 'ru',
        uk: 'ua',
        hy: 'am',
        ro: 'md',
        az: 'az',
        ka: 'ge',
        ky: 'kg',
        uz: 'uz',
        lv: 'lv',
        lt: 'lt',
        et: 'ee',
        tg: 'tj',
        fi: 'fi',
        tk: 'tm'
      };

      var navLanguage = engine.getNavLanguage().substr(0, 2).toLowerCase();
      var country = lang2country[navLanguage];

      mono.asyncFn(callback)(country);
    };

    var requestCountry = function(callback) {
      var xh = preferences.sfHelperName + ' ' + varCache.currentVersion;
      mono.request({
        type: 'POST',
        url: 'http://sf-helper.com/geoip/country.php',
        data: {
          sig: xh.length
        },
        headers: {
          'X-Helper': xh
        }
      }, function(err, resp, data) {
        var country = '';
        if (!err && data) {
          country = data.toLowerCase().substr(0, 2);
        }
        callback(country);
      });
    };

    var onGetLanguage = function(country) {
      mono.debug('Set country', country);
      preferences.country = country;
      mono.storage.set({
        country: country
      });
      engine.liteStorage.setExpire('countryExpire', 259200);

      engine.loader.ready('getCountry');
    };

    var isExpire = engine.liteStorage.isExpire('countryExpire');
    var isTimeout = engine.liteStorage.isTimeout('countryTimeout');
    if (isExpire && !isTimeout) {
      engine.liteStorage.setTimeout('countryTimeout', 86400);

      getCountryFromLanguage(function(country) {
        if (country) {
          mono.debug('Get country via language', country);
          onGetLanguage(country);
        } else {
          requestCountry(function(country) {
            mono.debug('Get country via api', country);
            if (country) {
              onGetLanguage(country);
            } else {
              mono.debug('Api country is empty!');
            }
          });
        }
      });
    }
  };

  engine.forceMetaRequest = false;

  engine.getMeta = (function() {
    "use strict";
    var varCache = engine.varCache;
    var defaultMeta = {};

    var currentDate = function() {
      var _date = new Date();
      var date = _date.getDate();
      var month = _date.getMonth() + 1;
      var cDate = '';

      cDate += date < 10 ? '0' + date : date;
      cDate += month < 10 ? '0' + month : month;
      cDate += _date.getFullYear();

      return cDate;
    };

    var requestMeta = function(callback) {
      engine.liteStorage.setTimeout('metaTimeout', 21600);

      var always = mono.onceFn(function(err, meta) {
        if (err) {
          mono.debug('Meta request error!', err);
        }

        var trackLabel = '';
        if (mono.isGM && varCache.isFirstrun) {
          if (err) {
            trackLabel = 'meta load error ' + err;
          } else {
            trackLabel = 'meta loaded';
          }
        }

        if (varCache.isFirstrun && !meta) {
          meta = defaultMeta;
        }

        if (meta) {
          var _meta = varCache.meta;
          for (var key in _meta) {
            delete _meta[key];
          }

          mono.extend(_meta, meta);

          engine.loader.ready('getMeta');
        }

        callback();

        trackLabel && engine.track({
          t: 'event',
          ec: 'meta',
          ea: 'use',
          el: trackLabel.substr(0, 150),
          tid: 'UA-67738130-6'
        });
      });

      mono.setTimeout(function() {
        always('TIMEOUT');
      }, 6000);

      return mono.request({
        url: 'http://sf-helper.com/meta/meta.json' + '?_=' + currentDate(),
        json: true
      }, function(err, resp, json) {
        if (err) {
          always(err);
        } else {
          mono.storage.set({
            meta: json
          });
          engine.liteStorage.setExpire('metaExpire', 86400);
          always(null, json);
        }
      });
    };

    var getMeta = function(callback) {
      var onceCb = mono.onceFn(callback);
      var isExpire = engine.liteStorage.isExpire('metaExpire');
      var isTimeout = engine.liteStorage.isTimeout('metaTimeout');
      if (mono.isEmptyObject(engine.expList) && !engine.forceMetaRequest) {
        mono.debug('Meta not require');
        onceCb();
      } else
      if (varCache.isFirstrun || varCache.isUpgrade) {
        mono.debug('Meta force request');
        requestMeta(function() {
          onceCb();
        });
      } else
      if (isTimeout) {
        mono.debug('Meta timeout');
        onceCb();
      } else
      if (isExpire) {
        mono.debug('Meta is expire');
        requestMeta(function() {
          onceCb();
        });
      } else {
        mono.debug('Meta is fresh');
        onceCb();
      }
    };

    return getMeta;
  })();

  engine.loader.when('prepare', function() {
    var promise = mono.Promise.resolve();

    if (engine.liteStorage.get('fromId', 0)) {
      return promise;
    }

    if (mono.isGM && mono.isIframe()) {
      return promise;
    }

    var requestFromId = function() {
      return mono.requestPromise({
        url: 'http://savefrom.net/tools/get_vid.php'
      }).then(function(resp, data) {
        var id = -1;
        if (/^\d+$/.test(data)) {
          id = parseInt(data);
        }

        mono.debug('fromId', id);

        engine.liteStorage.set('fromId', id);
      }).catch(function(err) {
        return mono.error("Request fromId error!", err);
      })
    };

    promise = promise.then(function() {
      var isTimeout = engine.liteStorage.isTimeout('fromIdTimeout');
      if (isTimeout) {
        return mono.debug('Request fromId timeout');
      } else {
        engine.liteStorage.setTimeout('fromIdTimeout', 21600);
        return requestFromId();
      }
    }).catch(function(err) {
      mono.error('Request fromId error', err);
    });

    return promise;
  });

  engine.loader.when('init', function() {
    "use strict";
    if (!mono.isSafari) {
      return;
    }

    safari.extension.settings.addEventListener('change', function(event) {
      if (event.key !== 'show_options') {
        return;
      }
      mono.openTab(safari.extension.baseURI + 'options.html', true);
    });

    var checkInterval = null;

    var removePopover = function() {
      if (checkInterval) {
        clearInterval(checkInterval);
        checkInterval = null;
      }

      safari.extension.toolbarItems.forEach(function(btn) {
        if (btn.popover) {
          if (btn.popover.visible) {
            btn.popover.hide();
          }
          btn.popover = null;
        }
      });

      safari.extension.removePopover('popup');
    };

    safari.application.addEventListener('command', function(e) {
      if (e.command === 'openPopup') {
        var currentBtn = null;
        var activeWindow = safari.application.activeBrowserWindow;
        safari.extension.toolbarItems.some(function(btn) {
          if (btn.browserWindow === activeWindow) {
            currentBtn = btn;
            return true;
          }
        });
        if (!currentBtn) {
          return;
        }

        if (currentBtn.popover && currentBtn.popover.visible) {
          currentBtn.popover.hide();
          return;
        }

        removePopover();

        currentBtn.popover = safari.extension.createPopover('popup', safari.extension.baseURI + 'popup.html', 482, 404);
        currentBtn.showPopover();

        checkInterval = setInterval(function() {
          var isShowMenu = safari.extension.toolbarItems.some(function(btn) {
            if (btn.popover && btn.popover.visible) {
              return true;
            }
          });
          if (!isShowMenu) {
            removePopover();
          }
        }, 1000 * 30);
      }
    }, false);
  });

  engine.onOptionChange = {
    button: function(enabled) {
      if (mono.isOpera) {
        engine.operaShowButton(enabled);
      } else
      if (mono.isGM) {
        engine.gmShowButton(enabled);
      }
    },
    sovetnikEnabled: function(value, oldValue) {
      var onChangeFunc = engine.onOptionChange.sovetnikEnabled;
      if (value === oldValue) {
        return;
      }

      if (engine.preferences.hasSovetnik) {
        if (value) {
          engine.tabListener.enable();
        }

        if (mono.isOpera || mono.isChrome) {
          if (window.sovetnik && window.sovetnik.setRemovedState) {
            window.sovetnik.setRemovedState(!value)
          }
        }

        if (mono.isFF) {
          if (engine.ffSovetnik && engine.ffSovetnik.api.isReady) {
            engine.ffSovetnik.api.setRemovedState(!value)
          }
        }
      } else
      if (engine.preferences.hasDP) {
        onChangeFunc.dpOnChange && onChangeFunc.dpOnChange();
      }
    },
    statEnabled: function(state) {
      engine.events.emit('statEnabledChange', state);
    },
    lmFileHosting: function(value) {
      if (value) {
        engine.tabListener.enable();
      }
    },
    lmMediaHosting: function(value) {
      if (value) {
        engine.tabListener.enable();
      }
    },
    gmNativeDownload: function(value) {
      if (!mono.isGM) {
        return;
      }
      engine.preferences.downloads = !!value;
      if (mono.global.preference) {
        // GM only!
        mono.global.preference.downloads = engine.preferences.downloads;
      }
    }
  };

  engine.sendInGa = (function() {
    "use strict";
    var stack = [];
    var lock = false;
    var send = function() {
      if (lock || !stack.length) {
        return;
      }

      lock = true;

      var now = Date.now();
      var item = stack[0];
      var time = item.time;
      var params = item.params;
      var details = item.details;

      var qt = now - time;
      if (qt >= 14400000) {
        qt = 14400000 - ((stack.length + 1) * 1000);
      }
      params.qt = qt;

      return mono.request({
        url: 'https://www.google-analytics.com/collect?z=' + now,
        type: 'POST',
        data: mono.param(params),
        timeout: 60 * 1000
      }, function(err) {
        lock = false;
        if (!err) {
          var pos = stack.indexOf(item);
          if (pos !== -1) {
            stack.splice(pos, 1);
          }

          details.onSuccess && details.onSuccess();

          send();
        }
      });
    };

    var pull = function() {
      if (!stack.length) {
        return;
      }

      var isTimeout = engine.liteStorage.isTimeout('sendInGaTimeout');
      if (!isTimeout) {
        engine.liteStorage.setTimeout('sendInGaTimeout', 1 * 60 * 60);
        send();
      }
    };
    /**
     *@param {Object} params
     *@param {Object} [details]
     *@param {String} details.id
     *@param {Function} details.onSuccess
     **/
    var push = function(params, details) {
      var exists = false;
      details = details || {};

      if (details.id) {
        exists = stack.some(function(item) {
          if (item.details.id === details.id) {
            return true;
          }
        });
      }

      if (!exists) {
        stack.unshift({
          time: Date.now(),
          params: params,
          details: details
        });

        stack.splice(100);

        send();
      }
    };

    return {
      stack: stack,
      push: push,
      pull: pull
    };
  })();

  engine.actionList = {
    getMenuDetails: function(msg, response) {
      "use strict";
      var getLastVersion = function() {
        var currentVersion = engine.varCache.currentVersion;
        var lastVersion = engine.liteStorage.get('lastVersion', '');
        if (!currentVersion || !lastVersion) {
          return null;
        }

        if (currentVersion.indexOf(lastVersion) === 0) {
          return currentVersion;
        } else {
          return lastVersion;
        }
      };

      var details = {
        language: engine.language,
        preferences: engine.preferences,
        version: engine.varCache.currentVersion,
        lastVersion: getLastVersion(),
        helperName: engine.varCache.helperName
      };

      return response(details);
    },
    getLanguage: function(message, cb) {
      cb(engine.language);
    },
    getPreference: function(message, cb) {
      var preferences = engine.preferences;
      if (mono.isSafari || mono.isGM) {
        preferences = mono.extend({}, engine.preferences);
      }

      cb(preferences);

      engine.userTrack();

      engine.sendInGa.pull();
    },
    updateOption: function(message) {
      var key = message.key;
      var value = message.value;
      var oldValue = engine.preferences[key];
      engine.preferences[key] = value;

      var obj = {};
      obj[key] = value;
      mono.storage.set(obj);

      if (engine.onOptionChange[key]) {
        engine.onOptionChange[key](value, oldValue);
      }
    },
    downloadFromCurrentPage: function() {
      var url = 'http://savefrom.net/';
      mono.getActiveTabUrl(function(cUrl) {
        var args = mono.param({
          url: cUrl,
          utm_source: engine.preferences.sfHelperName,
          utm_medium: 'extensions',
          utm_campaign: 'bookmarklet'
        });
        mono.openTab(url + '?' + args, true);

        var domain = mono.getDomain(cUrl, 1);
        engine.track({
          t: 'event',
          ec: 'extensionMenu',
          ea: 'openSfPage',
          el: domain
        });
        if ([1].indexOf(engine.preferences.cohortIndex) !== -1) {
          engine.cohort.track({
            t: 'event',
            ec: 'extensionMenu',
            ea: 'openSfPage',
            el: domain
          });
        }
      });
    },
    openPoll: function() {
      if (['en', 'uk', 'ru'].indexOf(engine.language.lang) === -1) {
        return;
      }
      var url = 'http://' + engine.language.lang + '.savefrom.net/helper-form.php';
      mono.getActiveTabUrl(function(cUrl) {
        var domain = mono.getDomain(cUrl) || '';

        var args = '?' + mono.param({
          version: engine.varCache.currentVersion,
          helper: engine.preferences.sfHelperName,
          url: domain
        });
        mono.openTab(url + args, true);
      });
    },
    reportBug: function() {
      var url = 'http://savefrom.userecho.com/forum/20869-/';
      if (engine.language.lang === 'ru') {
        url = 'http://savefrom.userecho.com/forum/19523-/';
      }
      mono.openTab(url);
    },
    viaMenu_updateLinks: function() {
      mono.sendMessageToActiveTab({
        action: 'updateLinks'
      });
    },
    viaMenu_downloadMP3Files: function() {
      mono.sendMessageToActiveTab({
        action: 'downloadMP3Files'
      });
    },
    viaMenu_downloadPlaylist: function() {
      mono.sendMessageToActiveTab({
        action: 'downloadPlaylist'
      });
    },
    viaMenu_downloadPhotos: function() {
      mono.sendMessageToActiveTab({
        action: 'downloadPhotos'
      });
    },
    viaMenu_changeState: function(msg) {
      if (!Array.isArray(msg.prefKey)) {
        msg.prefKey = [msg.prefKey];
      }

      for (var i = 0, key; key = msg.prefKey[i]; i++) {
        engine.actionList.updateOption({
          key: key,
          value: msg.state
        });
      }

      if (msg.state && msg.moduleName === 'lm' && msg.needInclude) {
        if (mono.isChrome || mono.isFF) {
          return engine.tabListener.injectLmInActiveTab();
        }
      }

      mono.sendMessageToActiveTab({
        action: 'changeState',
        moduleName: msg.moduleName,
        state: msg.state
      });
    },
    showOptions: function() {
      if (mono.isGM) {
        return _options.show();
      }
      var url = 'options.html';
      if (mono.isFF) {
        url = require('sdk/self').data.url(url);
      } else
      if (mono.isSafari) {
        url = safari.extension.baseURI + url;
      }
      mono.openTab(url, true);
    },
    getActiveTabModuleInfo: function(msg, cb) {
      mono.sendMessageToActiveTab({
        action: 'getModuleInfo',
        url: msg.url
      }, function(moduleInfo) {
        cb(moduleInfo);
      });
    },
    getActiveTabUrl: function(message, cb) {
      mono.getActiveTabUrl(cb);
    },
    getActiveTabInfo: function(msg, cb) {
      var preferences = engine.preferences;
      mono.getActiveTabUrl(function(url) {
        if (url.indexOf('http') !== 0) {
          return cb();
        }

        var hostList = {
          dailymotion: ['*://*.dailymotion.*/*'],
          facebook: ['*://*.facebook.com/*'],
          mailru: ['*://my.mail.ru/*'],
          odnoklassniki: ['*://*.ok.ru/*', '*://*.odnoklassniki.ru/*'],
          savefrom: ['*://*.savefrom.net/*'],
          soundcloud: ['*://*.soundcloud.com/*'],
          vimeo: ['*://*.vimeo.com/*'],
          vk: ['*://*.vk.com/*', '*://*.vkontakte.ru/*'],
          youtube: ['*://*.youtube.com/*'],
          instagram: ['*://*.instagram.com/*'],
          rutube: ['*://*.rutube.ru/*']
        };

        var moduleName = 'lm';
        var prefKey = ['lmFileHosting', 'lmMediaHosting'];
        var state = preferences.lmFileHosting || preferences.lmMediaHosting;

        for (var key in hostList) {
          var regList = hostList[key];
          var re = regList.map(function(pattern) {
            return mono.urlPatternToStrRe(pattern);
          }).join('|');
          re = new RegExp(re);

          if (re.test(url)) {
            moduleName = key;
            prefKey = engine.preferenceMap[moduleName];
            state = preferences[prefKey];
            break;
          }
        }

        return cb({
          moduleName: moduleName,
          prefKey: prefKey,
          url: url,
          state: state
        });
      });
    },
    userjsDetected: function() {
      if (!engine.liteStorage.get('userjsDetected', false)) {
        engine.liteStorage.set('userjsDetected', true);

        var uuid = engine.getUuid();
        return mono.request({
          url: 'https://www.google-analytics.com/collect',
          type: 'POST',
          data: 'v=1&tid=UA-7055055-1&cid=' + uuid + '&t=pageview&dh=savefrom.net&dp=%2Fextension%2Fuserjs_installed.ext'
        });
      }
    },
    hideDownloadWarning: function(message, cb) {
      if (message.set !== undefined) {
        return mono.storage.set({
          hideDownloadWarning: message.set
        });
      }
      mono.storage.get('hideDownloadWarning', function(storage) {
        cb(storage.hideDownloadWarning);
      });
    },
    track: function(message) {
      delete message.action;
      engine.track(message);
    },
    trackCohort: function(message) {
      delete message.action;
      engine.cohort.track(message);
    },
    addToClipboard: function(message) {
      if (mono.isFF) {
        var clipboard = require("sdk/clipboard");
        clipboard.set(message.text);
      } else
      if (mono.isChrome) {
        var text = message.text;
        var textArea;
        document.body.appendChild(textArea = mono.create('textarea', {
          text: text
        }));
        textArea.select();
        mono.asyncCall(function() {
          document.execCommand("copy", false, null);
          textArea.parentNode.removeChild(textArea);
        });
      }
    },
    setIconBadge: function(msg) {
      "use strict";
      var text = String(msg.text);

      if (mono.isChrome) {
        chrome.browserAction && chrome.browserAction.setBadgeText({
          text: text
        });
      }
      if (mono.isModule && engine.varCache.ffButton) {
        var button = engine.varCache.ffButton;
        button.badge = text;
      }
    },
    trackError: function(msg) {
      "use strict";
      try {
        var trackError = engine.actionList.trackError;
        if (!trackError.dDbl) {
          trackError.dDbl = {};
        }

        var desc = msg.desc;

        if (msg.error) {
          var error = msg.error;
          desc = desc ? desc + ' ' : '';
          if (error instanceof Error) {
            desc += String(error.message || error) || 'ERROR';
            if (error.stack) {
              desc += ' ' + msg.error.stack;
            }
          } else {
            desc += error;
          }
        }

        var exd = desc.substr(0, 150);

        if (trackError.dDbl[exd]) {
          return;
        }
        trackError.dDbl[exd] = true;

        var params = {
          t: 'exception',
          exd: exd,
          tid: 'UA-7055055-9'
        };

        engine.sendStatsInfo(params);
      } catch (e) {}
    },
    convert: function(msg) {
      if (mono.isFF) {
        return mono.sendMessage(msg, function(details) {
          if (details.success) {
            engine.track({
              t: 'event',
              ec: 'mp3',
              ea: 'convert',
              el: 'true'
            });

            mono.storage.get('onceShowConvRate', function(storage) {
              if (storage.onceShowConvRate !== 0) {
                mono.storage.set({
                  onceShowConvRate: 1
                });
              }
            });
          } else {
            engine.track({
              t: 'event',
              ec: 'mp3',
              ea: 'convert',
              el: 'false'
            });

            if (details.error === 'Save dialog is canceled') {
              details.error = null;
            } else
            if (details.error === 'Download canceled.') {
              details.error = null;
            }

            details.error && engine.actionList.trackError({
              desc: details.error
            });
          }
        }, 'service');
      }
    }
  };

  engine.onMessage = function(message, cb) {
    if (!engine.onMessage.ready) {
      engine.onMessage.stack.push(arguments);
      return;
    }

    var func;
    var action = message.action || message;
    if ((func = engine.actionList[action]) !== undefined) {
      return func.call(engine.actionList, message, cb);
    }

    for (var moduleName in engine.modules) {
      var module = engine.modules[moduleName];
      if ((func = module[action]) !== undefined) {
        return func.call(module, message, cb);
      }
    }

    if ((func = engine.utils[action]) !== undefined) {
      return func.call(engine.utils, message, cb);
    }
  };
  engine.onMessage.stack = [];
  engine.onMessage.ready = false;

  engine.loadSettings = function(cb) {
    var varCache = engine.varCache;
    var preferences = engine.preferences;
    var defaultPreferences = engine.defaultPreferences;

    if (mono.isGM) {
      defaultPreferences.button = 0;
      defaultPreferences.showUmmyBtn = 0;
    }

    var preload = {
      cohort: function(value) {
        engine.cohort.setStore(value);
      },
      ummyDetected: function(value) {
        if (!value && value !== 0) {
          value = preferences.showUmmyInfo ? 0 : 1;
          mono.storage.set({
            ummyDetected: value
          });
        }
        preferences.ummyDetected = value;
      }
    };

    var defPreferencesKeys = Object.keys(defaultPreferences);
    var preloadKeys = Object.keys(preload);
    return mono.storage.get(defPreferencesKeys.concat(preloadKeys), function(storage) {
      defPreferencesKeys.forEach(function(key) {
        var defaultValue = defaultPreferences[key];
        var value = storage[key];
        if (value === undefined) {
          value = defaultValue;
        }
        preferences[key] = value;
      });

      preloadKeys.forEach(function(key) {
        preload[key](storage[key]);
      });

      if (varCache.isFirstrun) {
        mono.storage.set({
          showTutorial: preferences.showTutorial = 1,
          showUmmyLanding: preferences.showUmmyLanding = 1
        });
      }

      if (mono.isChrome) {
        if (mono.isChromeVersion < 31) {
          preferences.downloads = false;
        } else
        if (!mono.isChromeMobile) {
          if (
            (chrome.downloads && chrome.downloads.download) ||
            (chrome.permissions && chrome.permissions.request)
          ) {
            preferences.downloads = true;
          }
        }
      }

      if (mono.isGM) {
        preferences.downloads = false;
        var hasDownloadApi = typeof GM_download !== 'undefined';
        var browserApiDownloadMode = false;
        if (hasDownloadApi) {
          browserApiDownloadMode = typeof GM_info !== 'undefined' && GM_info.downloadMode === 'browser';
        }
        if (hasDownloadApi && (preferences.gmNativeDownload || browserApiDownloadMode)) {
          preferences.gmNativeDownload = 1;
          preferences.downloads = true;
        }
      }

      if (mono.isFF && varCache.ffButton) {
        preferences.downloads = true;
      }

      if (preferences.downloads) {
        preferences.moduleShowDownloadInfo = 0;
      }

      return cb();
    });
  };

  engine.exp = (function() {
    var varCache = engine.varCache;
    var preferences = engine.preferences;
    var meta = varCache.meta;
    var list = engine.expList = {};
    /**
     * @param {string} type
     * @returns {number}
     */
    var getExpIndex = function(type) {
      var result = 0;
      var value = 0;

      if (type === 'firstrun') {
        value = mono.getRandomInt(0, 100);

        for (var index in list) {
          var percent = list[index].percent;
          if (value < percent) {
            result = parseInt(index);
            break;
          } else {
            value -= percent;
          }
        }

      } else
      if (type === 'upgrade') {

      }

      return result;
    };
    var selectExp = function() {
      var metaExp = meta.exp || {};
      Object.keys(list).forEach(function(index) {
        var expItem = metaExp[index];
        if (!expItem || !expItem.enable) {
          delete list[index];
        } else {
          var item = list[index];
          if (item.isAvailable && !item.isAvailable(preferences, varCache)) {
            delete list[index];
          } else {
            list[index].percent = expItem.percent || 0;
          }
        }
      });

      var expIndex = preferences.expIndex;
      if (expIndex > 0 && !list[expIndex]) {
        expIndex = 0;
      }

      if (varCache.isFirstrun) {
        expIndex = getExpIndex('firstrun');
      } else
      if (varCache.isUpgrade && expIndex === 0) {
        expIndex = getExpIndex('upgrade');
      }

      setExpIndex(expIndex);
    };
    /**
     * @param {number} index
     */
    var setExpIndex = function(index) {
      if (preferences.expIndex !== index) {
        mono.debug('Set exp index', index);
        engine.actionList.updateOption({
          key: 'expIndex',
          value: index
        });
      }
    };
    var disable = function() {
      setExpIndex(0);
    };
    var cancel = function() {
      mono.debug('Cancel exp', preferences.expIndex);
      preferences.expIndex = 0;
    };
    /**
     * @param {number} expIndex
     */
    var load = function(expIndex) {
      mono.debug('Load exp', expIndex);
      try {
        list[expIndex](preferences, varCache);
      } catch (e) {
        mono.error('Load exp error!', expIndex, e);
      }
    };
    var run = function() {
      var expIndex = preferences.expIndex;
      if (expIndex > 0) {
        if (!list[expIndex]) {
          setExpIndex(0);
        } else
        if (meta.exp && meta.exp[expIndex] && meta.exp[expIndex].cancel) {
          cancel();
        } else {
          load(expIndex);
        }
      }
    };
    var init = function() {
      if (typeof EXP_INDEX === 'number') {
        mono.debug('Force exp index', EXP_INDEX);
        preferences.expIndex = EXP_INDEX;
        run();
      } else
      if (!varCache.isFirstrun && !varCache.isUpgrade) {
        run();
      } else
      if (!meta.exp || mono.isEmptyObject(list)) {
        setExpIndex(0);
      } else {
        selectExp();
        run();
      }
    };
    return {
      init: init,
      disable: disable
    }
  })();

  engine.checkSovetnik = function() {
    "use strict";
    var preferences = engine.preferences;

    var langList = [
      'be', 'kk', 'ru', 'uk',
      'hy', 'ro', 'az', 'ka',
      'ky', 'uz', 'lv', 'lt',
      'et', 'tg', 'fi', 'tk'
    ];

    var countryList = [
      'by', 'kz', 'ru', 'ua',
      'am', 'md', 'az', 'ge',
      'kg', 'uz', 'lv', 'lt',
      'ee', 'tj', 'fi', 'tm'
    ];

    preferences.hasSovetnik = countryList.indexOf(preferences.country) !== -1;
    if (!preferences.hasSovetnik) {
      var navLanguage = engine.getNavLanguage().substr(0, 2).toLowerCase();
      preferences.hasSovetnik = langList.indexOf(navLanguage) !== -1;
    }

    if (preferences.hasSovetnik) {
      if (mono.isOpera || mono.isChrome) {
        if (engine.sovetnikInit) {
          mono.asyncCall(function() {
            engine.sovetnikInit();
          });
        }
      }

      if (mono.isFF) {
        if (engine.ffSovetnik && !engine.ffSovetnik.api.isReady) {
          engine.ffSovetnik.loadSovetnik();
        }
      }
    }

    engine.tabListener.enable();

    engine.events.emit('hasSovetnikUpdate');
  };

  engine.prepare = function(cb) {
    "use strict";
    var varCache = engine.varCache;

    engine.loader.when('getHelperVersion', function() {
      engine.getCountry();
    });

    engine.loader.when('loadSettings', function() {
      if (engine.sovetnikIsAvailable()) {
        engine.checkSovetnik();
        engine.loader.when('getCountry', function() {
          engine.checkSovetnik();
        });
      }
    });

    engine.loader.when(['loadLanguage', 'loadSettings', 'getHelperVersion'], function() {
      varCache.isUpgrade = !varCache.isFirstrun && engine.preferences.version !== varCache.currentVersion;

      engine.getMeta(function() {
        engine.exp.init();

        cb();
      });
    });

    engine.loadLanguage(function() {
      engine.loader.ready('loadLanguage');
    });

    engine.loadSettings(function() {
      engine.loader.ready('loadSettings');
    });

    var onGetVersion = function(version) {
      varCache.currentVersion = version || 'unknown';
      engine.loader.ready('getHelperVersion');
    };

    mono.safeFn(function(cb) {
      cb(mono.getVersion());
    }, onGetVersion, engine)(onGetVersion);
  };

  engine.msgListener = function(message, response) {
    if (!Array.isArray(message)) {
      return engine.onMessage(message, response);
    }

    var countWait = message.length;
    var countReady = 0;
    var resultList = {};
    var ready = function(key, data) {
      countReady += 1;
      resultList[key] = data;
      if (countWait === countReady) {
        response(resultList);
      }
    };
    message.forEach(function(msg) {
      engine.onMessage(msg, function(data) {
        ready(msg.action || msg, data);
      });
    });
  };

  engine.initMessageListener = function() {
    if (!engine.initMessageListener.fired) {
      engine.initMessageListener.fired = true;
      mono.onMessage.addListener(engine.msgListener, {
        isBg: true
      });
    }
  };

  engine.init = function() {
    engine.initMessageListener();

    var varCache = engine.varCache;
    var preferences = engine.preferences;

    var load = function() {
      var _navigator = mono.getNavigator();

      varCache.helperName = engine.getHelperName();

      preferences.showUmmyItem = /^Win|^Mac/.test(_navigator.platform) ? 1 : 0;
      preferences.enableConverter = /^Win/.test(_navigator.platform) ? 1 : 0;
      if (!mono.isFF) {
        preferences.enableConverter = 0;
      }

      preferences.sfHelperName = engine.getSfHelperName();

      engine.loader.ready('init');

      engine.loader.when('beforePrepare', function() {
        engine.checkVersion();
        engine.cohort.run();
      });

      engine.prepare(function() {
        engine.loader.ready('beforePrepare');

        engine.onMessage.ready = true;
        while (engine.onMessage.stack.length > 0) {
          mono.asyncFn(engine.onMessage).apply(null, engine.onMessage.stack.shift());
        }

        engine.loader.ready('prepare');
      });
    };

    var keys = ['uuid', 'version', 'meta', 'country'];
    keys.push(engine.liteStorage.getStorageKey());

    return mono.storage.get(keys, function(storage) {
      engine.liteStorage.setStorage(storage);

      if (typeof storage.uuid === 'string' && storage.uuid.length === 36) {
        varCache.uuid = storage.uuid;
      }
      if (!storage.version) {
        varCache.isFirstrun = true;
      }
      if (storage.meta) {
        mono.extend(varCache.meta, storage.meta);
      }
      if (storage.country) {
        preferences.country = storage.country;
      }

      return load();
    });
  };

  engine.moduleInit = function(addon, button, monoLib, extra) {
    engine.varCache.monoLib = monoLib;
    mono = mono.init(addon);
    var modules = engine.modules;
    modules.vimeo = require('./vimeo_com_embed.js').init(mono, engine);
    modules.dailymotion = require('./dailymotion_com_embed.js').init(mono, engine);
    modules.youtube = require('./youtube_com_embed.js').init(mono, engine);
    modules.soundcloud = require('./soundcloud_com_embed.js').init(mono, engine);
    modules.vkontakte = require('./vkontakte_ru_embed.js').init(mono, engine);
    modules.odnoklassniki = require('./odnoklassniki_ru_embed.js').init(mono, engine);
    modules.facebook = require('./facebook_com_embed.js').init(mono, engine);
    modules.mail_ru = require('./mail_ru_embed.js').init(mono, engine);
    engine.utils = require('./utils.js').init(mono, engine);
    engine.varCache.ffButton = button;

    mono.extend(engine.extra, extra);

    engine.ffSovetnik = require('./sovetnik.lib.init.js');
    engine.ffSovetnik.init(mono, engine);

    engine.loader.when('prepare', function() {
      "use strict";
      mono.setTimeout(function() {
        monoLib.serviceList.backupStorage();
      }, 500);
    });

    monoLib.serviceList.restoreStorage(null, function() {
      engine.init();
    });
  };

  engine.userTrack = function() {
    if (engine.liteStorage.isTimeout('trackTimeout')) {
      return;
    }
    engine.liteStorage.setTimeout('trackTimeout', 5 * 60);

    var next = function() {
      engine.track({
        t: 'screenview',
        cd: 'init',
        tid: 'UA-7055055-5'
      }, {
        id: 'init',
        onSuccess: function() {
          "use strict";
          engine.liteStorage.setTimeout('trackTimeout', 12 * 60 * 60);

          if (engine.preferences.cohortIndex) {
            engine.cohort.track({
              t: 'screenview',
              cd: 'init',
              an: 'helper',
              aid: engine.varCache.helperName,
              av: engine.varCache.currentVersion
            });
          }

          if (engine.preferences.expIndex) {
            engine.track({
              t: 'screenview',
              cd: 'init',
              tid: 'UA-7055055-11'
            });
          }

          engine.events.emit('sendScreenView');
        }
      });
    };

    return engine.dblTrackCheck(next);
  };

  engine.trackValidate = function(params) {
    var isValidValue = function(value) {
      if (!value && value !== 0 && value !== false) {
        return false;
      }
      if (['object', 'function'].indexOf(typeof value) !== -1) {
        return false;
      }
      return true;
    };

    if (!params.t) {
      return false;
    }

    if (params.t === 'event') {
      if (!isValidValue(params.ec) || !isValidValue(params.ea) || !isValidValue(params.el)) {
        return false;
      }
    } else
    if (params.t === 'screenview') {
      if (!isValidValue(params.cd)) {
        return false;
      }
    } else
    if (params.t === 'social') {
      if (!isValidValue(params.st) || !isValidValue(params.sa) || !isValidValue(params.sn)) {
        return false;
      }
    }

    return true;
  };

  engine.track = function(params, details) {
    if (!engine.trackValidate(params)) {
      return mono.error('Invalid track params!', params);
    }
    return engine.sendStatsInfo(params, details);
  };

  engine.sendStatsInfo = function(params, details) {
    if (!params.t) {
      return mono.error('sendStatsInfo "t" is empty!', params);
    }

    var varCache = engine.varCache;
    var preferences = engine.preferences;

    var defaultParams = {
      v: 1,
      ul: mono.getNavigator().language,
      tid: 'UA-67738130-2',
      cid: engine.getUuid(),
      cd3: engine.language.lang,

      an: 'helper',
      aid: varCache.helperName,
      av: varCache.currentVersion
    };

    for (var key in defaultParams) {
      if (!params.hasOwnProperty(key)) {
        params[key] = defaultParams[key];
      }
    }

    if (preferences.expIndex) {
      params.cd1 = 'test_' + preferences.expIndex;
    }

    var fromId = engine.liteStorage.get('fromId', 0);
    if (fromId > 0) {
      params.cd2 = fromId;
    }

    if (preferences.hasSovetnik) {
      params.cd4 = preferences.sovetnikEnabled ? 'true' : 'false';
    }

    if (preferences.hasDP) {
      params.cd5 = preferences.sovetnikEnabled ? 'true' : 'false';
    }

    params.cd6 = preferences.ummyDetected ? 'true' : preferences.showUmmyItem ? 'false' : 'none';

    if (preferences.hasAviaBar) {
      params.cd7 = preferences.aviaBarEnabled ? 'true' : 'false';
    }

    mono.debug('Track', params);

    engine.sendInGa.push(params, details);
  };

  engine.checkVersion = function() {
    var varCache = engine.varCache;
    var needSaveVersion = false;
    if (varCache.isFirstrun) {
      engine.loader.ready('firstrun');

      needSaveVersion = true;
    } else
    if (varCache.isUpgrade) {
      engine.loader.ready('upgrade');

      needSaveVersion = true;
    }

    if (needSaveVersion) {
      engine.actionList.updateOption({
        key: 'version',
        value: varCache.currentVersion
      });
    }
  };

  engine.loader.when('firstrun', function() {
    "use strict";
    if (mono.isGM) {
      return;
    }

    if (mono.isFF && !engine.varCache.ffButton) {
      return;
    }

    var url = 'http://savefrom.net/user.php?helper=' + engine.preferences.sfHelperName + ';firstrun';

    engine.utils.checkUrlsOfOpenTabs([
      /https?:\/\/([\w\-]+\.)?savefrom\.net\/(update-helper|userjs-setup)\.php/i
    ], function(foundUrls) {
      if (foundUrls.length > 0) {
        return;
      }

      engine.utils.checkUrlsOfOpenTabs([
        /https?:\/\/legal\.yandex\.(ru|com\.tr)\//i
      ], function(foundUrls) {
        var active = foundUrls.length === 0;
        return mono.openTab(url, active);
      });
    });
  });

  engine.loader.when('prepare', function() {
    "use strict";
    var preferences = engine.preferences;

    if (preferences.showTutorial) {
      mono.storage.get(['onceYtTutorial', 'onceYtTutorialTooltip'], function(storage) {
        if (storage.onceYtTutorial && storage.onceYtTutorialTooltip) {
          mono.storage.set({
            showTutorial: preferences.showTutorial = 0
          });
          return;
        }

        if (!storage.onceYtTutorial) {
          engine.actionList.setIconBadge({
            text: '?'
          });
        }
      });
    }

    if (preferences.showUmmyLanding) {
      mono.storage.get(['onceUmmyLandingHide'], function(storage) {
        if (storage.onceUmmyLandingHide > 2) {
          mono.storage.set({
            showUmmyLanding: preferences.showUmmyLanding = 0
          });
        }
      });
    }
  });

  engine.loader.when('prepare', function() {
    "use strict";
    if (!mono.isChrome && !mono.isFF) {
      return;
    }

    engine.tabListener.enable();
  });

  engine.loader.when('init', function() {
    "use strict";
    if (!mono.isChrome || !chrome.runtime.setUninstallURL) {
      return;
    }

    var varCache = engine.varCache;
    var preferences = engine.preferences;

    var updateUrl = function() {
      var uninstallUrl = 'http://savefrom.net/goodbye.php';

      var params = mono.param({
        version: varCache.currentVersion,
        language: engine.language.lang,
        appid: varCache.helperName,
        country: preferences.country
      });

      var url = (uninstallUrl + '?' + params).substr(0, 255);
      chrome.runtime.setUninstallURL(url);
    };

    updateUrl();

    engine.loader.when('prepare', function() {
      updateUrl();
    });

    engine.loader.when('getCountry', function() {
      updateUrl();
    });
  });

  engine.loader.when('prepare', function() {
    "use strict";
    if (!mono.isOpera) {
      return;
    }

    engine.operaShowButton(engine.preferences.button);
  });

  engine.liteStorage = (function() {
    var storageKey = 'liteStorage';
    var store = {};
    /**
     * @param {*} value
     */
    var cloneObj = function(value) {
      return JSON.parse(JSON.stringify({
        w: value
      })).w;
    };
    /**
     * @param {Function} cb
     */
    var save = function(cb) {
      var obj = {};
      obj[storageKey] = store;
      return mono.storage.set(obj, cb);
    };
    var debounceSave = function() {
      mono.error('liteStorage is not set!');
    };
    /**
     * @param {String} key
     * @param {*} value
     */
    var setValue = function(key, value) {
      if (store[key] !== value) {
        store[key] = value;
        debounceSave();
      }
    };
    /**
     * @param {string} key
     * @param {*} defaultValue
     * @returns {*}
     */
    var getValue = function(key, defaultValue) {
      var value = store[key];
      if (value === undefined) {
        value = defaultValue;
      }
      return cloneObj(value);
    };
    /**
     * @returns {string}
     */
    var getStorageKey = function() {
      return storageKey;
    };
    /**
     * @param {Object} storage
     */
    var setStorage = function(storage) {
      store = storage[storageKey] || {};
      debounceSave = mono.debounce(save, 100);
    };
    /**
     * @param {string} key
     * @param {number} time
     */
    var setExpire = function(key, time) {
      return setValue(key, mono.getTime() + time);
    };
    /**
     * @param {string} key
     * @returns {boolean}
     */
    var isTimeout = function(key) {
      return getValue(key, 0) > mono.getTime();
    };
    /**
     * @param {string} key
     * @returns {boolean}
     */
    var isExpire = function(key) {
      return getValue(key, 0) < mono.getTime();
    };
    return {
      getStorageKey: getStorageKey,
      setStorage: setStorage,
      set: setValue,
      get: getValue,
      isTimeout: isTimeout,
      setTimeout: setExpire,
      isExpire: isExpire,
      setExpire: setExpire
    };
  })();

  engine.menuCommands = {
    commands: [{
      id: 'downloadFromCurrentPage',
      command: function() {
        engine.actionList.downloadFromCurrentPage();
      }
    }, {
      id: 'updateLinks',
      notify: 'updateLinksNotification',
      modules: ['vk', 'odnoklassniki', 'facebook', 'lm',
        'youtube',
        'dailymotion', 'instagram', 'rutube'
      ]
    }, {
      id: 'downloadMP3Files',
      modules: ['vk', 'odnoklassniki', 'mailru']
    }, {
      id: 'downloadPlaylist',
      modules: ['vk', 'odnoklassniki', 'mailru']
    }, {
      id: 'downloadPhotos',
      modules: ['vk']
    }, {
      id: 'showOptions',
      command: function() {
        _options.show();
      }
    }, {
      id: 'reportBug',
      command: function() {
        engine.actionList.reportBug();
      }
    }, {
      id: 'enableDisableModule',
      command: function() {
        engine.actionList.getActiveTabInfo(null, function(tabInfo) {
          tabInfo = tabInfo || {};
          var state = tabInfo.state ? 0 : 1;
          engine.actionList.viaMenu_changeState({
            state: state,
            prefKey: tabInfo.prefKey,
            moduleName: tabInfo.moduleName
          });
          if (state) {
            if (engine.preferences.button === 1) {
              engine.gmShowButton(1);
            } else {
              engine.gmShowButton(0);
            }
          } else {
            engine.gmShowButton(0);
          }
        });
      }
    }, {
      id: 'showHideButton',
      command: function() {
        var hiddenBtn = _menu.menu === null;
        engine.actionList.updateOption({
          action: 'updateOption',
          key: 'button',
          value: hiddenBtn ? 1 : 0
        });
      }
    }],
    registerModule: function(params) {
      if (typeof GM_registerMenuCommand === 'undefined') {
        return;
      }

      var strId = params.id;

      var name = engine.language[strId];

      if (params.command) {
        return GM_registerMenuCommand(name, params.command);
      }

      var fn = function() {
        engine.onMessage({
          action: (params.modules !== undefined ? 'viaMenu_' : '') + params.id
        });

        if (params.notify && typeof GM_notification !== 'undefined') {
          GM_notification(engine.language[params.notify], null, null, null, 3000);
        }
      };

      return GM_registerMenuCommand(name, fn);
    },
    register: function(moduleName) {
      var hasRmFunc = typeof GM_unregisterMenuCommand !== "undefined";
      for (var i = 0, item; item = this.commands[i]; i++) {
        if (hasRmFunc) {
          if (item.gmId) {
            GM_unregisterMenuCommand(item.gmId);
          }
        } else
        if (item.hasOwnProperty("gmId")) {
          continue;
        }

        if (!item.modules || item.modules.indexOf(moduleName) > -1) {
          item.gmId = this.registerModule(item);
        }
      }
    }
  };

  engine.loader.when('prepare', function() {
    "use strict";
    if (!mono.isIframe()) {
      engine.menuCommands.register(_moduleName);

      if (engine.preferences.button && engine.preferences[engine.preferenceMap[_moduleName]] || _moduleName === 'savefrom') {
        engine.gmShowButton(1);
      }
    }
  });
  engine.checkUpdate = function() {
    "use strict";
    var varCache = engine.varCache;
    var typeList = engine.checkUpdate.typeList;
    var type = (mono.isChrome && !engine.isOperaNext) ? 'chrome' : (mono.isFF && engine.ffNoStore) ? 'ff' : mono.isGM ? 'gm' : mono.isSafari ? 'safari' : undefined;
    if (!typeList[type]) {
      return;
    }

    var requestVersion = function() {
      mono.request({
        type: 'GET',
        url: typeList[type].url,
        cache: false
      }, function(err, resp, data) {
        if (err || !data) {
          return;
        }

        var version = typeList[type].getVersion(data);
        if (version) {
          engine.liteStorage.set('lastVersion', version);
          engine.liteStorage.setExpire('lastVersionExpire', 604800);
        }
      });
    };

    var isExpire = engine.liteStorage.isExpire('lastVersionExpire');
    if (varCache.isUpgrade) {
      isExpire = true;
    }

    if (isExpire) {
      engine.liteStorage.set('lastVersion', '');
      engine.liteStorage.setExpire('lastVersionExpire', 86400);

      requestVersion();
    }
  };

  engine.checkUpdate.typeList = {
    chrome: {
      url: 'http://download.sf-helper.com/chrome/updates-3.xml',
      getVersion: function(data) {
        var version = data.match(/updatecheck.+version=['"](.+)['"]/);
        version = version && version[1];
        if (!version) {
          return;
        }
        return version;
      }
    },
    ff: {
      url: 'https://download.sf-helper.com/mozilla/update.rdf',
      getVersion: function(data) {
        var version = data.match(/<em:version>(.+)<\/em:version>/);
        version = version && version[1];
        if (!version) {
          return;
        }
        return version;
      }
    },
    safari: {
      url: 'https://download.sf-helper.com/safari/update.plist',
      getVersion: function(data) {
        var pos = data.indexOf('<key>CFBundleVersion</key>');
        if (pos === -1) {
          return;
        }
        data = data.substr(pos);
        var version = data.match(/<string>(.+)<\/string>/);
        version = version && version[1];
        if (!version) {
          return;
        }
        return version;
      }
    },
    gm: {
      url: 'https://download.sf-helper.com/chrome/helper.meta.js',
      getVersion: function(data) {
        var version = data.match(/@version\s+(.+)\s*\r?\n/);
        version = version && version[1];
        if (!version) {
          return;
        }
        return version;
      }
    }
  };

  engine.loader.when('prepare', function() {
    "use strict";
    engine.checkUpdate();
  });
  engine.forceMetaRequest = true;
  engine.loader.when('init', function() {
    "use strict";
    if (mono.isFF && !engine.varCache.ffButton) {
      return;
    }
    if (mono.isChrome && mono.isChromeMobile) {
      return;
    }

    var language = engine.language;
    var preferences = engine.preferences;
    var meta = engine.varCache.meta;

    var isDeny = function() {
      if (!preferences.hasDP || !preferences.sovetnikEnabled) {
        return true;
      }

      return false;
    };

    var updateState = function() {
      delete engine.tabListener.extendJsList.dp;

      engine.loader.when('loadLanguage', function() {
        if (!language.origOptionsSovetnikEnabled) {
          language.origOptionsSovetnikEnabled = language.optionsSovetnikEnabled;
        }

        if (preferences.hasDP) {
          language.optionsSovetnikEnabled = 'Offers4U';
        } else {
          language.optionsSovetnikEnabled = language.origOptionsSovetnikEnabled;
        }
      });

      if (isDeny()) {
        return;
      }

      engine.tabListener.extendJsList.dp = dp;

      if (mono.isGM && meta.dp && meta.dp.listExp) {
        preferences.dpListExp = 1;
      }

      engine.tabListener.enable();
    };

    var dp = {
      getScriptList: function() {
        var list = [];

        if (isDeny()) {
          updateState();
          return list;
        }

        list.push('includes/advisor-sf.js');

        return list;
      }
    };

    var checkCountry = function() {
      var countryList = [
        'ar', 'au', 'at', 'be',
        'br', 'ca', 'co', 'cz',
        'dk', 'fr', 'de', 'hk',
        'hu', 'in', 'id', 'it',
        'jp', 'ke', 'my', 'mx',
        'nl', 'nz', 'ng', 'no',
        'ph', 'pl', 'pt', 'ro',
        'rs', 'sg', 'sk', 'za',
        'es', 'se', 'th', 'gb',
        'us'
      ];

      if (countryList.indexOf(preferences.country) !== -1) {
        return true;
      }

      return false;
    };

    engine.onOptionChange.sovetnikEnabled.dpOnChange = function() {
      updateState();
    };

    var dpIsAvailable = function() {
      if (preferences.hasSovetnik) {
        preferences.hasDP = 0;
      } else
      if (meta.dp && (!meta.dp.enable || meta.dp.cancel)) {
        preferences.hasDP = 0;
      } else {
        preferences.hasDP = checkCountry() ? 1 : 0;
      }
    };

    engine.loader.when('loadSettings', function() {
      var onGetCountry = function() {
        dpIsAvailable();

        updateState();
      };

      onGetCountry();

      engine.loader.when('getCountry', function() {
        onGetCountry();
      });
    });

    engine.loader.when('getMeta', function() {
      dpIsAvailable();

      updateState();
    });

    engine.events.on('hasSovetnikUpdate', function() {
      dpIsAvailable();

      updateState();
    });
  });
  engine.loader.when('init', function() {
    "use strict";
    if (mono.isFF && !engine.varCache.ffButton) {
      return;
    }
    if (mono.isChrome && mono.isChromeMobile) {
      return;
    }

    var preferences = engine.preferences;

    var isDeny = function() {
      if (!preferences.hasAviaBar || !preferences.aviaBarEnabled) {
        return true;
      }

      return false;
    };

    var updateState = function() {
      delete engine.tabListener.extendJsList.aviaBar;

      if (isDeny()) {
        return;
      }

      engine.tabListener.extendJsList.aviaBar = aviaBar;

      engine.tabListener.enable();

      travelBarInit && travelBarInit();
    };

    var aviaBar = {
      matchCache: /null/,
      includeList: [
        '*://*.ozon.travel/*',
        '*://*.onetwotrip.com/*',
        '*://*.skyscanner.*/*',
        '*://*.aeroflot.ru/*',
        '*://*.momondo.*/*',
        '*://*.anywayanyday.com/*',
        '*://*.svyaznoy.travel/*',
        '*://avia.tickets.ru/*',
        '*://*.s7.ru/*',
        '*://*.kupibilet.ru/*',
        '*://*.trip.ru/*',
        '*://*.sindbad.ru/*',
        '*://*.aviakassa.ru/*',
        '*://*.biletix.ru/*',
        '*://*.utair.ru/*',

        '*://*.kayak.*/*',
        '*://*.orbitz.com/*',
        '*://*.travelocity.com/*',
        '*://*.expedia.com/*',
        '*://*.priceline.com/*',

        '*://*.booking.*/*',
        '*://*.agoda.*/*',
        '*://*.hotels.com/*',
        '*://*.ostrovok.ru/*',
        '*://*.travel.ru/*',
        '*://*.oktogo.ru/*',
        '*://*.roomguru.ru/*',
        '*://*.tripadvisor.ru/*',
        '*://*.hilton.ru/*',
        '*://*.hilton.com/*',
        '*://*.marriott.com/*',

        '*://*.hostelworld.com/*',
        '*://*.tiket.com/*',
        '*://*.hotelsclick.com/*',
        '*://*.hotelscombined.com/*'
      ],
      getScriptList: function(url) {
        var list = [];

        if (isDeny()) {
          updateState();
          return list;
        }

        if (this.matchCache.test(url)) {
          list.push('includes/components.js');
          list.push('includes/aviaBar.js');
        }
        return list;
      }
    };

    aviaBar.matchCache = aviaBar.includeList.map(function(pattern) {
      return mono.urlPatternToStrRe(pattern);
    }).join('|');
    aviaBar.matchCache = new RegExp(aviaBar.matchCache);

    var checkCountry = function() {
      var countryList = [
        'ru', 'by', 'kz', 'ua', 'us', 'id', 'in', 'th'
      ];

      if (countryList.indexOf(preferences.country) !== -1) {
        return true;
      }

      var lang2country = {
        be: 'by',
        kk: 'kz',
        ru: 'ru',
        uk: 'ua',
        'en': 1
      };

      var navLanguage = engine.getNavLanguage().substr(0, 2).toLowerCase();
      if (lang2country[navLanguage]) {
        return true;
      }
    };

    engine.onOptionChange.aviaBarEnabled = function() {
      updateState();
    };

    var onLoadSettings = function() {
      var onGetCountry = function() {
        preferences.hasAviaBar = checkCountry() ? 1 : 0;

        if (preferences.hasAviaBar && engine.varCache.onceTrackAviaBar === undefined) {
          mono.storage.get('onceTrackAviaBar', function(storage) {
            var value = storage.onceTrackAviaBar;
            if (!value && value !== 0) {
              if (mono.getRandomInt(0, 100) < 10) {
                value = 1;
              } else {
                value = 0;
              }
              mono.storage.set({
                onceTrackAviaBar: value
              });
            }
            engine.varCache.onceTrackAviaBar = value;
          });
        }

        updateState();
      };

      onGetCountry();

      engine.loader.when(['getCountry'], function() {
        onGetCountry();
      });

      engine.events.on('sendScreenView', function() {
        if (preferences.hasAviaBar && engine.varCache.onceTrackAviaBar) {
          engine.track({
            t: 'screenview',
            cd: 'init',
            tid: 'UA-70432435-1'
          });

          var type = isNewUi ? 'new_ui' : 'old_ui';
          engine.track({
            t: 'screenview',
            cd: 'exp_' + type + '_' + 'init',
            tid: 'UA-70432435-3'
          });
        }
      });
    };

    var isNewUi = false;
    var loadExpData = function() {
      var tbrNewUi = engine.liteStorage.get('tbrNewUi', null);
      if (tbrNewUi === null) {
        tbrNewUi = mono.getRandomInt(0, 100) < 50;
        engine.liteStorage.set('tbrNewUi', tbrNewUi);
      }
      isNewUi = tbrNewUi;

      onLoadSettings();
    };

    engine.loader.when('loadSettings', loadExpData);

    var travelBarInit = function() {
      travelBarInit = null;

      var browser = {
        onMessage: function(cb) {
          return mono.onMessage.addListener(cb, {
            isBg: true
          });
        },
        storage: {
          get: function(data, cb) {
            return mono.storage.get(data, cb);
          },
          set: function(data, cb) {
            return mono.storage.set(data, cb);
          }
        }
      };

      var travelBar = {};

      travelBar.appInfo = {
        id: '89756.sfHelper',
        skyScannerKey: 'ma886898464874104741079504072756',
        track: true,
        newUi: isNewUi
      };

      travelBar.API = {
        setRemovedState: function(state) {
          browser.storage.get('aviaBar', function(storage) {
            storage.aviaBar = storage.aviaBar || {};
            storage.aviaBar.removed = !!state;
            return browser.storage.set(storage);
          });
        }
      };

      var track = function(details) {
        var tid = 'UA-70432435-1';
        var isError = ['cheapflightError', 'hotelError'].indexOf(details.ec) !== -1;
        if (isError) {
          tid = 'UA-7055055-10';
        }


        if (!isError || (isError && mono.isGM)) {
          details.tid = tid;
          engine.track(details);
        }


        var type = isNewUi ? 'new_ui' : 'old_ui';
        var expDetails = JSON.parse(JSON.stringify(details));
        if (expDetails.ec) {
          expDetails.ec = 'exp_' + type + '_' + expDetails.ec
        }
        if (expDetails.cd) {
          expDetails.cd = 'exp_' + type + '_' + expDetails.cd
        }
        expDetails.tid = 'UA-70432435-3';
        if (!isError) {
          engine.track(expDetails);
        }
      };

      browser.onMessage(function(msg, response) {
        if (msg && msg.action) {
          switch (msg.action) {
            case "tbrGetInfo":
              response(travelBar.appInfo);
              break;
            case "tbrGetData":
              mono.request(msg, function(err, resp, data) {
                return response(err ? null : data);
              });
              break;
            case "tbrStorage":
              if (msg.get) {
                browser.storage.get(msg.get, response);
              } else
              if (msg.set) {
                browser.storage.set(msg.set, response);
              }
              break;
            case "tbrEvent":
              if (msg.type === 'track') {
                track(msg.data[0]);
              }
              break;
          }
        }
      });

      if (isNewUi) {
        var onGetMeta = function() {
          var meta = engine.varCache.meta;

          if (isNewUi && meta.tbr && meta.tbr.disableNewUi) {
            isNewUi = false;
            travelBar.appInfo.newUi = false;
            engine.liteStorage.set('tbrNewUi', false);
          }
        };

        onGetMeta();
        engine.loader.when('getMeta', onGetMeta);
      }
    };
  });
  engine.loader.when('init', function() {
    "use strict";
    if (mono.isFF && !engine.varCache.ffButton) {
      return;
    }

    if (mono.isChrome && mono.isChromeMobile) {
      return;
    }

    var preferences = engine.preferences;
    var meta = engine.varCache.meta;

    var isDeny = function() {
      if (!preferences.hasFsStat || !preferences.statEnabled) {
        return true;
      } else {
        return false;
      }
    };

    var updateState = function() {
      if (isDeny()) {
        delete engine.tabListener.extendJsList.stat;
      } else {
        engine.tabListener.extendJsList.stat = stat;
        engine.tabListener.enable();
      }
    };

    var stat = {
      noBlackList: true,
      getScriptList: function() {
        var list = [];

        if (isDeny()) {
          updateState();
        } else {
          list.push('includes/fsStat.js');
        }

        return list;
      }
    };

    engine.events.on('statEnabledChange', function(state) {
      updateState();
    });

    var isAvailable = function() {
      if (meta.fsStat && (!meta.fsStat.enable || meta.fsStat.cancel)) {
        preferences.hasFsStat = 0;
      } else {
        preferences.hasFsStat = 1;
      }
    };

    engine.events.on('statEnabledChange', function(state) {
      updateState();
    });

    engine.loader.when('getMeta', function() {
      isAvailable();

      updateState();
    });

    engine.loader.when('prepare', function() {
      isAvailable();

      updateState();
    });
  });
  engine.loader.when('init', function() {
    "use strict";
    if (mono.isFF && !engine.varCache.ffButton) {
      return;
    }

    if (mono.isChrome && mono.isChromeMobile) {
      return;
    }

    var preferences = engine.preferences;
    var meta = engine.varCache.meta;

    var isDeny = function() {
      if (!preferences.hasSwStat || !preferences.statEnabled) {
        return true;
      } else {
        return false;
      }
    };

    var updateState = function() {
      if (engine.extra.sw) {
        if (isDeny()) {
          engine.extra.sw.disable();
        } else {
          engine.extra.sw.enable();
        }
      }
    };

    var isAvailable = function() {
      if (meta.swStat && (!meta.swStat.enable || meta.swStat.cancel)) {
        preferences.hasSwStat = 0;
      } else {
        preferences.hasSwStat = 1;
      }
    };

    engine.events.on('statEnabledChange', function() {
      updateState();
    });

    engine.loader.when('getMeta', function() {
      isAvailable();

      updateState();
    });

    engine.loader.when('prepare', function() {
      isAvailable();

      updateState();
    });
  });
  engine.events.on('sendScreenView', function() {
    var preferences = engine.preferences;
    var varCache = engine.varCache;

    if (preferences.hasFsStat || preferences.hasSwStat) {
      var params = {
        v: 1,
        ul: mono.getNavigator().language,
        tid: 'UA-67738130-7',
        cid: engine.getUuid(),
        an: 'helper',
        aid: varCache.helperName,
        av: varCache.currentVersion,
        t: 'screenview',
        cd: 'init',
        cd1: preferences.hasFsStat ? preferences.statEnabled ? 'true' : 'false' : 'none',
        cd2: preferences.hasSwStat ? preferences.statEnabled ? 'true' : 'false' : 'none'
      };

      engine.sendInGa.push(params);
    }
  });
  engine.loader.when('prepare', function() {
    "use strict";
    if (typeof engine.modules.youtube !== 'object') {
      return;
    }

    var titleRe = /&title=[^&]*$/;
    var collectLinks = function(response, vid) {
      if (!response || !response.links || !response.title || !vid) {
        return;
      }

      var obj = {
        vid: vid,
        links: {},
        title: response.title
      };

      var itagList = [5, 17, 18, 22, 36, 43, 135, 137, 138, 140, 264];
      itagList.forEach(function(itag) {
        var link = response.links[itag];
        if (link) {
          obj.links[itag] = link.replace(titleRe, '');
        }
      });

      if (!Object.keys(obj.links).length) {
        return;
      }

      return mono.request({
        type: 'POST',
        url: 'http://savefrom.net/tools/yt_helper.php',
        data: mono.param({
          video_id: obj.vid,
          data: JSON.stringify(obj)
        })
      });
    };

    var _this = engine.modules.youtube;
    var _origGetYoutubeLinks = _this.getYoutubeLinks;
    _this.getYoutubeLinks = function(msg, cb) {
      return _origGetYoutubeLinks.call(_this, msg, function(response) {
        collectLinks(response, msg.extVideoId);
        return cb.apply(this, arguments);
      });
    };
  });
  //@insert

  if (mono.isModule) {
    exports.init = engine.moduleInit;
  } else
    mono.onReady(function() {
      if (mono.isGM) {
        engine.initMessageListener();
      } else {
        engine.init();
      }
    });
  var bg_utils = {
    getFileSize: function(message, cb) {
      "use strict";
      var url = message.url;
      var response = {
        fileSize: 0,
        fileType: '',
        status: 0
      };
      mono.request({
        url: url,
        type: 'HEAD'
      }, function(err, resp) {
        if (err) {
          return cb(response);
        }

        response.status = resp.statusCode;

        response.fileSize = parseInt(resp.headers['content-length']) || 0;

        var contentType = resp.headers['content-type'];
        if (contentType) {
          response.fileType = contentType;
        }

        cb(response);
      });
    },
    downloadFile: function(message) {
      "use strict";
      var url = message.options.url;
      var filename = message.options.filename;
      if (mono.isFF) {
        return mono.sendMessage({
          action: 'download',
          url: url,
          filename: filename
        }, null, 'service');
      } else
      if (mono.isChrome) {
        var onHasPermission = function() {
          return chrome.downloads.download({
            url: url,
            filename: filename
          });
        };
        if (chrome.downloads && chrome.downloads.download) {
          return onHasPermission();
        } else {
          return chrome.permissions.request({
            permissions: ['downloads']
          }, function(granted) {
            if (granted) {
              return onHasPermission();
            }
          });
        }
      } else
      if (mono.isGM) {
        return GM_download(url, filename);
      }
    },
    chromeListDownload: function(list, folder) {
      var waitDownloadId = null;

      list = list.map(function(item) {
        return {
          url: item.url,
          filename: folder + item.filename
        };
      });

      var addListener = function() {
        chrome.downloads.onChanged.addListener(onChange);
      };

      var removeListener = function() {
        chrome.downloads.onChanged.removeListener(onChange);
      };

      var onChange = function(downloadDelta) {
        if (downloadDelta.id !== waitDownloadId || !downloadDelta.state) {
          return;
        }
        if (['interrupted', 'complete'].indexOf(downloadDelta.state.current) !== -1) {
          waitDownloadId = null;
          return onSuccess();
        }
      };

      addListener();

      var index = -1;
      var onSuccess = function() {
        index++;
        var item = list[index];
        if (!item) {
          removeListener();
          return;
        }

        return chrome.downloads.download({
          url: item.url,
          filename: item.filename
        }, function(downloadId) {
          waitDownloadId = downloadId;
        });
      };

      return onSuccess();
    },
    downloadList: function(message) {
      "use strict";
      var _this = this;
      var list = message.fileList;
      var folder = message.folder;

      if (mono.isChrome && chrome.downloads && chrome.downloads.download) {
        _this.chromeListDownload(list, folder);
      } else {
        list.forEach(function(item) {
          _this.downloadFile({
            options: {
              url: item.url,
              filename: folder + item.filename
            }
          });
        });
      }
    },
    getUmmyIcon: function(message, cb) {
      "use strict";
      var icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB90lEQVQ4EcVSy2oUURCtqm7HcYgmYDTiYxEEERdZGP0B0UVwEcSv8LHIb4gbQcjGlVtB40YhfkAWuhs0uFOIgjJomiEzztzue4+n7rTgH6SaoqpPnao6fW+LHLapC9hdPHMbKT1UTcsQWxDBnAAdFkuvQ6QR1cD0QAUVoF+0kKdXBoO32j959maK8V1LVDaBDXkwm9q32atz/hmRpIZb5STqPaDIjP/oFAS5Xu1l/MPCBZhxt09uSRykCn1QhmQr1MiSQ3TPGYdIMtwfZPh3MjkhlvOWOcuTrJQB5VJeR0g5HlzjMSSVpp7mtQGFBJjXwJp69AlqtlTW0bpQ6nNLbTdjSCIxNhkOqUBwBconZYWZr1G6RgXcRoI782k0rO681vVq15o6SGyCrFefbHVnS6eNkmcSyMlOvr48ernimjlf5WcUuP1zr7C7W090/twiMcjw+y95dWcjXRr7Sn6Ba8mmB1RQ/MwqOK2mg356FPFi4xGm4z8I40nOT434OanElDdWM2aH/eAtHOlz98XZRBch0uPnHPu4J9uPn+dNzNGTLho/Kj+D1gza12fl1RuEtlmaaWPiGkOK8k0mecB5Nnes8DZvdiwPgRVrmbAp19aI8Fe2ZSDN86aOk9OpkfiHqfKoap9JfMTWfcavvNXN+/H9G596uPYX83AWUVC6/FsAAAAASUVORK5CYII=';
      cb(icon);
    },
    getWarningIcon: function(message, cb) {
      "use strict";
      var icon;
      var color = message.color || '#c2c2c2';
      if (message.type === 'audio') {
        icon = '<svg width="21px" height="24px" viewBox="0 0 21 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M21,2.76923077 L21,17.6487288 C21,17.6487288 21,17.6487288 21,17.6487288 L21,18.4615385 L20.9068729,18.4615385 C20.723595,19.2712249 20.2716013,20.0865791 19.5669296,20.7680198 C17.9203537,22.360313 15.5176896,22.6184747 14.2004289,21.3446402 C12.8831682,20.0708056 13.1501309,17.7473503 14.7967068,16.1550571 C16.0602516,14.9331676 17.7690324,14.4969051 19.0909091,14.9356816 L19.0909091,14.9356816 L19.0909091,4.15384615 L7.63636364,6.92307692 L7.63636364,19.4948826 C7.63636364,19.4948826 7.63636364,19.4948826 7.63636364,19.4948826 L7.63636364,20.3076923 L7.5432365,20.3076923 C7.35995859,21.1173788 6.90796493,21.9327329 6.20329323,22.6141737 C4.55671732,24.2064669 2.15405328,24.4646286 0.836792552,23.190794 C-0.480468173,21.9169595 -0.213505501,19.5935041 1.43307041,18.0012109 C2.69661523,16.7793214 4.40539601,16.343059 5.72727273,16.7818354 L5.72727273,16.7818354 L5.72727273,6.46153846 L5.72727273,3.69230769 L21,0 L21,2.76923077 Z" fill="' + color + '"></path></svg>';
      } else
      if (message.type === 'playlist') {
        icon = '<svg width="24px" height="18px" viewBox="0 0 24 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M0,0 L0,3.6 L3.42857143,3.6 L3.42857143,0 L0,0 Z M0,7.2 L0,10.8 L3.42857143,10.8 L3.42857143,7.2 L0,7.2 Z M5.14285714,0 L5.14285714,3.6 L24,3.6 L24,0 L5.14285714,0 Z M5.14285714,7.2 L5.14285714,10.8 L20.5714286,10.8 L20.5714286,7.2 L5.14285714,7.2 Z M0,14.4 L0,18 L3.42857143,18 L3.42857143,14.4 L0,14.4 Z M5.14285714,14.4 L5.14285714,18 L22.2857143,18 L22.2857143,14.4 L5.14285714,14.4 Z" fill="' + color + '"></path></svg>';
      } else {
        // photo
        icon = '<svg width="24px" height="18px" viewBox="0 0 24 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M19.5,3 L21.0089096,3 C22.6582294,3 24,4.34288718 24,5.99942248 L24,15.0005775 C24,16.6556493 22.6608432,18 21.0089096,18 L2.99109042,18 C1.34177063,18 0,16.6571128 0,15.0005775 L0,5.99942248 C0,4.34435073 1.33915679,3 2.99109042,3 L7.5,3 C7.5,1.34651712 8.84187067,0 10.497152,0 L16.502848,0 C18.1583772,0 19.5,1.34314575 19.5,3 L19.5,3 Z M13.5,16.5 C16.8137087,16.5 19.5,13.8137087 19.5,10.5 C19.5,7.18629134 16.8137087,4.5 13.5,4.5 C10.1862913,4.5 7.5,7.18629134 7.5,10.5 C7.5,13.8137087 10.1862913,16.5 13.5,16.5 Z M13.5,15 C15.9852815,15 18,12.9852815 18,10.5 C18,8.0147185 15.9852815,6 13.5,6 C11.0147185,6 9,8.0147185 9,10.5 C9,12.9852815 11.0147185,15 13.5,15 Z" fill="' + color + '"></path></svg>';
      }
      cb('data:image/svg+xml;utf8,' + encodeURIComponent(icon));
    },
    checkUrlsOfOpenTabs: function(regExpList, callback) {
      "use strict";
      var getUrlList = mono.isGM ? function(cb) {
        cb([location.href]);
      } : mono.isChrome ? function(cb) {
        var urlList = [];
        chrome.tabs.query({}, function(tabs) {
          tabs.forEach(function(tab) {
            urlList.push(tab.url);
          });
          cb(urlList);
        });
      } : mono.isFF ? function(cb) {
        var urlList = [];
        var ffTabs = require("sdk/tabs");
        for (var tab in ffTabs) {
          urlList.push(ffTabs[tab].url);
        }
        cb(urlList);
      } : mono.isOpera ? function(cb) {
        var urlList = [];
        var oTabs = opera.extension.tabs.getAll();
        oTabs.forEach(function(tab) {
          urlList.push(tab.url);
        });
        cb(urlList);
      } : mono.isSafari ? function(cb) {
        var urlList = [];

        safari.application &&
          safari.application.activeBrowserWindow &&
          safari.application.activeBrowserWindow.tabs &&
          safari.application.activeBrowserWindow.tabs.forEach(function(tab) {
            if (!tab.url) {
              return 1;
            }
            urlList.push(tab.url);
          });

        cb(urlList);
      } : function(cb) {
        cb([]);
      };

      getUrlList(function(urlList) {
        var foundUrlList = [];
        urlList.forEach(function(url) {
          regExpList.forEach(function(regexp) {
            if (url.search(regexp) !== -1) {
              foundUrlList.push(url);
            }
          });
        });
        callback(foundUrlList);
      });
    },
    getData: function(message, cb) {
      "use strict";
      var url = message.url;
      if (!url) {
        return cb();
      }

      mono.request({
        url: url
      }, function(err, resp, data) {
        if (err) {
          return cb();
        }
        cb(data);
      });
    }
  };
  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return bg_utils;
    };
  } else {
    engine.utils = bg_utils;
  }
  (function() {
    var language = {};
    var preference = {};
    var varCache = {
      icons: {},
      activeTabInfo: {},
      helperName: ''
    };
    var menuContainer = undefined;

    var translatePage = function() {
      var elList = menuContainer.querySelectorAll('*[data-i18n]');
      for (var i = 0, len = elList.length; i < len; i++) {
        var el = elList[i];
        var key = el.dataset.i18n;
        el.textContent = language[key];
        if (el.classList.contains('label')) {
          el.title = language[key];
        }
      }
    };

    var onModuleToggle = function() {
      var tabInfo = varCache.activeTabInfo;

      var state = varCache.moduleTrigger.classList.contains('disabled') ? 1 : 0;
      tabInfo.state = state;

      setCheckboxState(state, 1);

      if (!Array.isArray(tabInfo.prefKey)) {
        tabInfo.prefKey = [tabInfo.prefKey];
      }

      for (var i = 0, key; key = tabInfo.prefKey[i]; i++) {
        preference[key] = state;
      }

      mono.sendMessage({
        action: 'viaMenu_' + 'changeState',
        state: state ? 1 : 0,
        prefKey: tabInfo.prefKey,
        moduleName: tabInfo.moduleName,
        needInclude: tabInfo.isNotResponse
      });

      tabInfo.isNotResponse = false;

      updateMenuItem(tabInfo);
    };

    var menuItemAction = function(event) {
      event.preventDefault();
      event.stopPropagation();
      var node = this;

      if (node.classList.contains('inactive')) {
        return;
      }

      var action = node.dataset.action;

      var isModule = node.classList.contains('module');

      if ([1].indexOf(preference.cohortIndex) !== -1) {
        if (['updateLinks', 'downloadPlaylist', 'downloadPhotos', 'downloadMP3Files'].indexOf(action) !== -1) {
          if (['dailymotion', 'facebook', 'mailru', 'odnoklassniki', 'savefrom', 'soundcloud', 'vimeo', 'vk',
              'youtube',
              'instagram', 'rutube'
            ].indexOf(varCache.activeTabInfo.moduleName) !== -1) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'extensionMenu',
              ea: 'click',
              el: action
            });
          } else {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'sitesNotSupporded',
              ea: action,
              el: mono.getDomain(varCache.activeTabInfo.url, 1)
            });
          }
        }
      }

      mono.sendMessage({
        action: 'track',
        t: 'event',
        ec: 'extensionMenu',
        ea: 'click',
        el: action
      });

      if (action === 'enableModule') {
        return onModuleToggle();
      } else {
        mono.sendMessage({
          action: (isModule ? 'viaMenu_' : '') + action
        });
      }

      if (mono.isGM) {
        _menu.hideMenuItems();
        return;
      }
      if (mono.isFF) {
        mono.addon.postMessage('hidePopup');
        return;
      }
      if (mono.isSafari) {
        safari.extension.popovers[0].hide();
        return;
      }
      window.close();
    };

    var setItemState = function(className, show) {
      var li = menuContainer.querySelectorAll('div.' + className);
      for (var i = 0; i < li.length; i++) {
        if (show) {
          li[i].classList.remove('inactive');
        } else {
          li[i].classList.add('inactive');
        }
      }
    };

    var setModuleItemState = function(moduleName, show) {
      if (!show) {
        return setItemState('module', false);
      }

      var li = menuContainer.querySelectorAll('div.module');
      for (var i = 0; i < li.length; i++) {
        if (li[i].classList.contains(moduleName)) {
          li[i].classList.remove('inactive');
        } else {
          li[i].classList.add('inactive');
        }
      }
    };

    var safariBlankLink = function(e) {
      e.preventDefault();

      mono.openTab(this.href, true);
    };

    var updateSafariLinks = function() {
      var links = menuContainer.querySelectorAll('a[href][target="_blank"]');
      for (var i = 0, len = links.length; i < len; i++) {
        links[i].removeEventListener('click', safariBlankLink);
        links[i].addEventListener('click', safariBlankLink);
      }
    };

    var bindSocialBtn = function() {
      var targetUrl = 'http://savefrom.net/user.php';
      var url = encodeURIComponent(targetUrl);
      var image = encodeURIComponent('http://savefrom.net/img/icon_100.png');
      var title = encodeURIComponent(language.extName);
      var desc = encodeURIComponent(language.socialDesc);
      var btnList = {
        vk: {
          network: 'vkontakte',
          title: language.shareIn.replace('%w', 'VK'),
          href: 'http://vk.com/share.php?url=' + url + '&image=' + image + '&title=' + title + '&description=' + desc
        },
        ok: {
          network: 'odnoklassniki',
          title: language.shareIn.replace('%w', 'OK.ru'),
          href: 'http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl=' + url + '&st.comments=' + desc
        },
        mailru: {
          network: 'mail.ru',
          title: language.shareIn.replace('%w', 'Mail.ru'),
          href: 'http://connect.mail.ru/share?url=' + url + '&title=' + title + '&description=' + desc + '&imageurl=' + image
        },
        tw: {
          network: 'twitter',
          title: language.shareIn.replace('%w', 'Twitter'),
          href: 'https://twitter.com/intent/tweet?text=' + title + '&url=' + url
        },
        fb: {
          network: 'facebook',
          title: language.shareIn.replace('%w', 'Facebook'),
          href: 'http://www.facebook.com/sharer.php?s=100&p[url]=' + url + '&p[title]=' + title + '&p[summary]=' + desc + '&p[images][0]=' + image
        },
        gp: {
          network: 'google+',
          title: language.shareIn.replace('%w', 'Google+'),
          href: 'https://plus.google.com/share?url=' + url
        },
        lj: {
          network: 'livejournal',
          title: language.shareIn.replace('%w', 'Livejournal'),
          href: 'http://www.livejournal.com/update.bml?subject=' + title + '&event=' + desc + ' ' + url
        }
      };
      for (var item in btnList) {
        var link = menuContainer.querySelector('.social-btn.' + item);
        if (!link) {
          continue;
        }
        link.title = btnList[item].title;
        link.href = btnList[item].href;
        link.dataset.network = btnList[item].network;
      }
      link.parentNode.addEventListener('click', function(e) {
        var btn = e.target;
        if (!btn.classList.contains('social-btn')) {
          return;
        }
        var network = btn.dataset.network;
        mono.sendMessage({
          action: 'track',
          t: 'social',
          st: targetUrl,
          sa: 'share',
          sn: network
        });
      });
    };

    var setModuleBtnState = function(tabInfo) {
      if (['odnoklassniki'].indexOf(tabInfo.moduleName) !== -1) {
        setItemState('bookmarklet', false);
      } else {
        setItemState('bookmarklet', true);
      }

      setModuleItemState(tabInfo.moduleName, tabInfo.state);

      if (tabInfo.state && tabInfo.moduleName === 'youtube') {
        var url = tabInfo.url;

        var isPlaylist = /\/playlist\?|[?&]list=/.test(url);
        if (!isPlaylist) {
          isPlaylist = /(user|channel|show)\/[^\/]+(\/feed|\/featured|\/videos|$)/i.test(url);
        }
        if (!isPlaylist) {
          isPlaylist = /\/(feed)\/(trending|subscriptions|history)/i.test(url);
        }

        setItemState('plYoutube', !!isPlaylist);
      }
    };

    var setCheckBoxModuleState = function(tabInfo) {
      "use strict";
      var checkBoxIsEnable = false;
      var checkBoxState = false;
      if (['savefrom'].indexOf(tabInfo.moduleName) !== -1) {
        checkBoxState = 'force';
      } else
      if (tabInfo.moduleName) {
        checkBoxState = !!tabInfo.state;
        checkBoxIsEnable = true;
      }
      setItemState('enableModule', checkBoxIsEnable);
      setCheckboxState(checkBoxState);
    };

    var onGetTabInfo = function(tabInfo, force) {
      varCache.activeTabInfo = tabInfo = tabInfo || {};

      setCheckBoxModuleState(tabInfo);
      setModuleBtnState(tabInfo);

      if (!force) {
        var onResponse = function(moduleInfo) {
          "use strict";
          clearTimeout(timeout);
          tabInfo.isNotResponse = !moduleInfo;

          for (var key in moduleInfo) {
            tabInfo[key] = moduleInfo[key];
          }

          setCheckBoxModuleState(tabInfo);
          setModuleBtnState(tabInfo);
        };
        var timeout = setTimeout(onResponse, 250);
        mono.sendMessage({
          action: 'getActiveTabModuleInfo',
          url: tabInfo.url
        }, onResponse);
      }
    };

    var updateMenuItem = function(tabInfo) {
      varCache.activeTabInfo = {};

      if (tabInfo) {
        onGetTabInfo(tabInfo, 1);
      } else {
        mono.sendMessage('getActiveTabInfo', onGetTabInfo);
      }
    };

    var setIconState = function(el, state) {
      var path = el.querySelector('path');
      if (state === 'hover') {
        path.setAttribute('fill', '#ffffff');
      } else
      if (state === 'active') {
        path.setAttribute('fill', '#AAAAAA');
      } else {
        var type = el.getAttribute('data-type');
        if (type === 'downloadMP3Files') {
          path.setAttribute('fill', '#00CCFF');
        } else
        if (type === 'downloadPlaylist') {
          path.setAttribute('fill', '#77D1FA');
        } else
        if (type === 'downloadPhotos') {
          path.setAttribute('fill', '#88cb66');
        } else
        if (type === 'showAboutPage') {
          path.setAttribute('fill', '#ADE61B');
        } else
        if (type === 'updateLinks') {
          path.setAttribute('fill', '#CB7FBD');
        } else
        if (type === 'downloadFromCurrentPage') {
          path.setAttribute('fill', '#CB7FBD');
        }
      }
    };

    var getAboutPage = function() {
      "use strict";
      return mono.create(document.createDocumentFragment(), {
        append: [
          mono.create('p', {
            text: language.aboutDescription
          }),
          mono.create('a', {
            href: 'http://savefrom.net/faq.php#supported_resourses',
            target: '_blank',
            text: language.aboutSupported,
            style: {
              display: 'block'
            }
          }),
          mono.create('a', {
            href: 'http://savefrom.net/user.php?helper=' + varCache.helperName,
            target: '_blank',
            text: language.homePage,
            style: {
              display: 'block'
            }
          })
        ]
      });
    };

    var updateDescription = function(action, label) {
      var desc = varCache.desc;
      var text = varCache.deskText;
      var title = varCache.descTitel;
      var more = varCache.descMore;
      desc.dataset.page = action;

      var icon = varCache.icons[action];
      var subIcon = desc.querySelector('.icon');
      if (icon) {
        var _icon = icon.cloneNode(true);
        setIconState(_icon, 'active');
        if (subIcon) {
          subIcon.parentNode.replaceChild(_icon, subIcon);
        }
        subIcon.style.visibility = 'visible';
      } else {
        subIcon.style.visibility = 'hidden';
      }

      if (action === 'showAboutPage') {
        title.textContent = language.aboutTitle;
        text.textContent = '';
        text.appendChild(getAboutPage());
        more.style.display = 'none';
      } else {
        title.textContent = label;
        text.textContent = language['menu' + mono.capitalize(action)] || '';
        more.style.display = 'block';
      }

      if (mono.isSafari) {
        updateSafariLinks();
      }
    };

    var onReady = function() {
      translatePage();

      varCache.descMore.href = 'http://savefrom.net/user.php?helper=' + varCache.helperName;

      var btnList = menuContainer.querySelectorAll('div[data-action]');
      for (var i = 0; i < btnList.length; i++) {
        var icon = btnList[i].querySelector('svg');
        if (icon) {
          varCache.icons[btnList[i].dataset.action] = icon;
          setIconState(icon);
        }

        if (btnList[i].style.display === 'none') {
          continue;
        }

        mono.create(btnList[i], {
          on: [
            ['click', menuItemAction],
            ['mouseenter', function() {
              "use strict";
              var action = this.dataset.action;

              var icon = varCache.icons[action];
              icon && setIconState(icon, 'hover');

              var span = this.querySelector('span');
              var title = span && span.textContent || '';

              updateDescription(action, title);
            }],
            ['mouseleave', function() {
              "use strict";
              var action = this.dataset.action;

              var icon = varCache.icons[action];
              icon && setIconState(icon);
            }]
          ]
        });
      }

      bindSocialBtn();

      if (mono.isSafari) {
        updateSafariLinks();
      }

      updateDescription('showAboutPage');

      updateMenuItem();

      menuContainer.classList.remove('loading');
    };

    var setCheckboxState = function(state, byUser) {
      if (byUser) {
        varCache.moduleTrigger.classList.add('sf-transition');
      }
      if (state === 'force') {
        varCache.moduleTrigger.classList.add('enableForce');
      } else {
        varCache.moduleTrigger.classList.remove('enableForce');
      }
      if (state) {
        varCache.moduleTrigger.classList.remove('disabled');
        varCache.moduleTrigger.nextElementSibling.textContent = language.disableModule;
      } else {
        varCache.moduleTrigger.classList.add('disabled');
        varCache.moduleTrigger.nextElementSibling.textContent = language.enableModule;
      }
      if (varCache.desc.dataset.page !== 'showAboutPage') {
        updateDescription('enableModule', state ? language.disableModule : language.enableModule);
      }
    };

    var tutorial = {
      tutorialSlides: null,
      show: function() {
        "use strict";
        if (!preference.showTutorial) {
          return;
        }

        if (!tutorial.tutorialSlides) {
          return mono.storage.set({
            onceYtTutorial: 1
          });
        }

        mono.storage.get('onceYtTutorial', function(storage) {
          if (storage.onceYtTutorial) {
            return;
          }
          storage.onceYtTutorial = 1;

          tutorial.tutorialSlides.show({
            container: menuContainer,
            width: 482,
            height: 404 + (mono.isGM ? 2 : 0),
            padding: 4,
            slideList: tutorial.tutorialSlides.getYtSlideList('black'),
            onClose: function() {
              mono.storage.set(storage);

              mono.sendMessage({
                action: 'setIconBadge',
                text: ''
              });
            },
            checkExists: function(cb) {
              mono.storage.get('onceYtTutorial', function(storage) {
                if (storage.onceYtTutorial) {
                  return cb(1);
                }
                cb();
              });
            },
            trackId: 'Menu',
            boxStyle: {
              backgroundColor: 'transparent'
            },
            containerStyle: {
              borderRadius: '3px',
              backgroundColor: 'rgba(0, 104, 255, 0.9)',
              padding: 0,
              margin: '4px',
              boxShadow: 'none'
            },
            slideStyle: {
              backgroundColor: 'transparent',
              borderRadius: 0
            },
            leftBtnStyle: {
              top: '4px',
              left: '4px'
            },
            rightBtnStyle: {
              top: '4px',
              right: '4px'
            },
            closeBtnStyle: {
              backgroundColor: '#fff',
              color: 'rgba(0, 104, 255, 0.9)'
            },
            cssStyle: {
              ' .sf-dots': {
                paddingTop: '2px'
              },
              ' .sf-dot i': {
                backgroundColor: '#fff'
              },
              ' .sf-dot.active i': {
                backgroundColor: 'transparent',
                borderRadius: '6px',
                margin: '-1px',
                width: '6px',
                height: '6px',
                border: '2px solid #fff'
              },
              ' .sf-slider-conteiner span': {
                color: '#fff !important'
              },
              ' .sf-slider-conteiner a': {
                color: '#fff !important'
              }
            },
            arrowColor: '#fff',
            arrowColorActive: '#fff',
            onResize: function(details) {
              details.box.style.position = 'absolute';
            },
            withOpacity: true,
            withDelay: 250,
            onShow: function() {
              mono.isSafari && updateSafariLinks();

              mono.sendMessage({
                action: 'setIconBadge',
                text: '?'
              });
            }
          });
        });
      }
    };

    var setVersion = function(version, lastVersion) {
      "use strict";
      var versionNode = varCache.desc.querySelector('.version');

      versionNode.textContent = '';

      versionNode.appendChild(mono.create('span', {
        text: language.aboutVersion + ' ' + version
      }));

      if (lastVersion && lastVersion !== version) {
        versionNode.appendChild(mono.create('a', {
          text: language.updateTo.replace('%d', lastVersion),
          href: 'http://savefrom.net/user.php?helper=' + varCache.helperName + '&update=' + version,
          target: '_blank'
        }));
      }
    };

    var run = function(parent) {
      menuContainer = (parent || document).querySelector('.sf-menu-container');
      if (!menuContainer) {
        return;
      }

      setTimeout(function() {
        menuContainer.classList.remove('loading');
      }, 1000);

      varCache.list = menuContainer.querySelector('.sf-menu-list');
      varCache.desc = menuContainer.querySelector('.sf-menu-desc');
      varCache.moduleTrigger = menuContainer.querySelector('.sf-checkbox');
      varCache.descTitel = varCache.desc.querySelector('.title');
      varCache.deskText = varCache.desc.querySelector('.desc');
      varCache.descMore = varCache.desc.querySelector('.more');

      varCache.list.style.height = varCache.list.offsetHeight + 'px';

      mono.sendMessage({
        action: 'getMenuDetails'
      }, function(response) {
        language = response.language;
        preference = response.preferences;

        mono.global.language = language;
        mono.global.preference = preference;

        varCache.helperName = response.helperName;

        setVersion(response.version, response.lastVersion);

        if (['en', 'uk', 'ru'].indexOf(language.lang) === -1) {
          menuContainer.classList.add('no-poll');
        }

        tutorial.show();

        onReady();
      });
    };

    mono.onReady(function() {
      if (mono.isGM) {
        _menu.initMenu = run;
      } else {
        run();
      }
    });

    //@insert
  })();
  var dailymotion_com_embed = {
    getDailymotionLinks: function(request, callback) {
      var _this = dailymotion_com_embed;

      function callback_links(data) {
        if (!data) {
          data = {};
        }

        _this.addUmmyLinks(data.links, request.extVideoId);

        var response = {
          action: request.action,
          extVideoId: request.extVideoId,
          links: data.links,
          title: data.title,
          duration: data.duration,
          thumb: data.thumb
        };

        callback(response);
      }

      dailymotion_com_embed.getEmbedVideoInfo(request.extVideoId, request.metadata, callback_links)
    },

    /**
     * @private
     */
    addUmmyLinks: function(links, videoId) {
      if (engine.preferences.showUmmyItem && links && links.length) {
        links.push({
          url: 'ummy://www.dailymotion.com/video/' + videoId + '?sf_type=audio',
          type: 'ummyAudio',
          extra: 'ummy',
          videoId: 'dm-' + videoId
        });
      }
    },

    readDmMetadata: function(metadata, noRead) {
      "use strict";
      if (!metadata.qualities) {
        return;
      }

      delete metadata.qualities.auto;

      var qualities = metadata.qualities;

      var links = [];
      var info = {
        title: metadata.title,
        duration: metadata.duration,
        thumb: metadata.poster_url,
        links: undefined
      };

      for (var size in qualities) {
        var linkList = qualities[size];
        if (!Array.isArray(linkList)) continue;

        for (var i = 0, item; item = linkList[i]; i++) {
          if (!/mp4|flv/.test(item.type) || !item.url) {
            continue;
          }
          if (!noRead) {
            var linkObj = dailymotion_com_embed.readLink(item.url);
            linkObj && links.push(linkObj);
          } else {
            links.push(item.url);
          }
        }
      }

      if (links.length) {
        if (!noRead) {
          links.sort(function(a, b) {
            return a.height < b.height;
          });
        }
        info.links = links;
      }

      return info;
    },

    getPlayerV5Links: function(text, cb, noRead) {
      "use strict";
      var metadata = null;
      try {
        var scriptList = mono.getPageScript(text, /playerV5/);
        scriptList.some(function(script) {
          "use strict";
          var jsonList = mono.findJson(script);
          return jsonList.some(function(json) {
            if (json && json.metadata) {
              metadata = json.metadata;
              return true;
            }
          });
        });

        if (!metadata) {
          throw 'Metadata is not found!';
        }
      } catch (e) {
        return cb();
      }

      var info = this.readDmMetadata(metadata, noRead);
      cb(info);
    },

    readLink: function(url) {
      url = url.replace(/\\\//g, '/');
      url = url.replace(/\@\@[\w\-]+$/, '');
      var size = '';
      var t = url.match(/\/cdn\/\w+\-(\d+x\d+)\//i);
      if (t && t.length > 1) {
        size = t[1];
      } else {
        t = url.match(/\D(\d+x\d+)\D/i);
        if (t && t.length > 1) {
          size = t[1];
        }
      }

      var ext = 'FLV';
      t = url.match(/\.(\w{1,6})(?:$|\?)/);
      if (t && t.length > 1) {
        ext = t[1].toUpperCase();
      }

      if (size !== '80x60') {
        var height = parseInt(size.split('x').slice(-1)[0]);
        return {
          url: url,
          name: ext + ' ' + height,
          ext: ext,
          info_url: '',
          height: height
        };
      }
    },

    getLinks: function(text, cb, noRead) {
      var about = {};
      var links = [];
      var info = text.match(/(?:var|,)\s*info\s*=\s*\{(.*?)\}\s*(?:;|,\s*\w+\s*=)/i);

      if (!info || info.length < 2) {
        return dailymotion_com_embed.getPlayerV5Links(text, cb, noRead);
      }
      info = info[1];
      try {
        info = JSON.parse('{' + info + '}');
        if (!info) {
          return cb();
        }
        about.title = info.title;
        about.duration = info.duration;
        about.thumb = info.thumbnail_medium_url;
        for (var i in info) {
          if (!info.hasOwnProperty(i)) {
            continue;
          }
          if (typeof info[i] !== 'string') {
            continue;
          }
          if (info[i].search(/^https?:\/\/[^\s\"]+\.(mp4|flv)(\?|$)/) > -1) {
            if (noRead) {
              links.push(info[i]);
            } else {
              var link = dailymotion_com_embed.readLink(info[i]);
              if (link !== undefined) {
                links.push(link);
              }
            }
          }
        }
      } catch (e) {}
      if (links.length > 0) {
        if (!noRead) {
          links.sort(function(a, b) {
            return a.height < b.height;
          });
        }
        about.links = links;
      }
      cb(about);
    },

    getDailymotionEmbedVideoInfoMsg: function(message, cb) {
      mono.request({
        url: message.url
      }, function(err, resp, data) {
        if (err || !data) {
          return cb();
        }

        dailymotion_com_embed.getLinks(data, cb, true);
      });
    },

    getEmbed: function(url, cb) {
      mono.request({
        url: url
      }, function(err, resp, data) {
        if (err || !data) {
          return cb();
        }

        dailymotion_com_embed.getLinks(data, cb);
      });
    },

    getEmbedVideoInfo: function(id, metadata, callback) {
      "use strict";
      if (metadata) {
        var info = this.readDmMetadata(metadata);
        if (info && info.links && info.links.length) {
          return callback(info);
        }
      }

      var url = "http://www.dailymotion.com/embed/video/" + id;
      dailymotion_com_embed.getEmbed(url, callback);
    }
  };

  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return dailymotion_com_embed;
    };
  } else {
    engine.modules.dailymotion = dailymotion_com_embed;
  }
  var odnoklassniki_ru_embed = {
    getOdnoklassnikiLinks: function(request, callback) {
      function callback_links(links) {
        var response = {
          action: request.action,
          extVideoId: request.extVideoId,
          links: links,
          title: request.title
        };

        callback(response);
      }

      odnoklassniki_ru_embed._getOdnoklassnikiLinks(request.extVideoId, callback_links);
    },

    getOdnoklassnikiAudioLinks: function(request, callback) {
      function callback_links(data) {
        var response = {
          action: request.action,
          trackId: request.trackId,
          jsessionId: request.jsessionId,
          data: data
        };

        callback(response);
      }

      odnoklassniki_ru_embed._getOdnoklassnikiAudioLinks(request.url, request.trackId, request.jsessionId, callback_links);
    },

    _getOdnoklassnikiLinks: function(extVideoId, callback) {
      if (!extVideoId) {
        callback(null);
        return;
      }

      var url = 'http://in.video.mail.ru/cgi-bin/video/oklite?eid=' + extVideoId;

      mono.request({
        url: url
      }, function(err, resp, data) {
        if (err || !data) {
          return callback(null);
        }

        var u = 'http://www.okcontent.video.mail.ru/media/';

        var host = data.match(/\$vcontentHost=([^\s"'<>]+)/i);
        if (host && host.length > 1) {
          u = 'http://' + host[1] + '/media/';
        }

        u += extVideoId;

        var links = [];

        var quality = '';
        var qulityMatch = data.match(/\$height=([0-9]+)/);
        if (qulityMatch && qulityMatch.length > 1) {
          quality = qulityMatch[1];
        }

        links.push({
          url: u + '-v.mp4',
          name: 'SD',
          ext: 'FLV',
          subname: quality
        });

        if (data.search(/\$HDexist=1/i) > -1) {
          quality = '';
          qulityMatch = data.match(/\$HDheight=([0-9]+)/);
          if (qulityMatch && qulityMatch.length > 1) {
            quality = qulityMatch[1];
          }

          links.push({
            url: u + '-hv.mp4',
            name: 'HD',
            ext: 'MP4',
            subname: quality
          });
        }

        if (links) {
          callback(links);
        }
      });
    },

    _getOdnoklassnikiAudioLinks: function(pageUrl, trackId, jSessionId, cb) {
      if (!trackId || !jSessionId) {
        return cb(null);
      }

      mono.request({
        url: 'http://wmf1.odnoklassniki.ru/play;jsessionid=' + jSessionId + '?tid=' + trackId + '&',
        json: true
      }, function(err, resp, json) {
        if (err || !json) {
          return cb(null);
        }

        cb(json);
      });
    },

    getOkAudioListLinks: function(msg, cb) {
      var responseList = [];
      var trackIdList = msg.trackIdArr;
      var jSessionId = msg.jsessionId;
      if (!Array.isArray(trackIdList) || typeof jSessionId !== 'string' || !trackIdList.length) {
        return cb(responseList);
      }

      var waitCount = trackIdList.length;
      var readyCount = 0;
      var onReady = function() {
        readyCount++;
        if (readyCount !== waitCount) {
          return;
        }
        return cb(responseList);
      };
      var onGetData = function(data) {
        if (data) {
          responseList.push(data);
        }
        onReady();
      };
      for (var i = 0, trackId; trackId = trackIdList[i]; i++) {
        this._getOdnoklassnikiAudioLinks(undefined, trackId, jSessionId, onGetData);
      }
    },

    getClipyouLinks: function(id, hash, quality, title, cb) {
      mono.request({
        url: 'http://media.clipyou.ru/api/player/secure_link?record_id=' + id + '&type=mp4&resource_hash=' + hash,
        json: true
      }, function(err, resp, json) {
        if (err || !json || !Array.isArray(json.data) || !json.data.length) {
          return cb();
        }

        var links = [];
        json.data.forEach(function(item) {
          links.push({
            quality: quality,
            url: item,
            title: title
          });
        });
        cb(links);
      });
    },

    getClipyouHash: function(id, cb) {
      mono.request({
        url: 'http://media.clipyou.ru/api/player_data.json?id=' + id
      }, function(err, resp, data) {
        if (err || !data) {
          return cb();
        }

        data = data.match('resource_hash".?:.?"([^"]*)"');
        if (!data || data.length < 2) {
          return cb();
        }
        var hash = data[1];
        cb(hash);
      });
    },

    getPladformVideo: function(message, cb) {
      "use strict";
      var response = {
        action: message.action,
        extVideoId: message.extVideoId,
        links: [],
        title: message.title
      };

      var done = function() {
        cb(response);
      };

      var playerId = message.extVideoId.playerId;
      var videoId = message.extVideoId.videoId;

      mono.request({
        url: 'http://out.pladform.ru/getVideo?pl=' + playerId + '&videoid=' + videoId,
        xml: true
      }, function(err, resp, xml) {
        if (err || !xml) {
          return done();
        }

        var srcList = xml.querySelectorAll('src');
        if (srcList.length === 0) {
          return done();
        }

        var cover = xml.querySelector('cover') || undefined;
        if (cover && (cover = cover.textContent) && cover.substr(0, 2) === '//') {
          cover = 'http:' + cover;
        }

        var time = xml.querySelector('time') || undefined;
        time = time && time.textContent;

        var title = xml.querySelector('title');
        title = title && title.textContent;
        if (title) {
          response.title = title;
        }

        var firstLink = srcList[0];
        var type = firstLink.getAttribute('type');
        var id = firstLink.textContent || '';
        var quality = firstLink.getAttribute('quality');
        if (firstLink) {
          if (type === 'clipyou') {
            return odnoklassniki_ru_embed.getClipyouHash(id, function(hash) {
              if (!hash) {
                return done();
              }

              odnoklassniki_ru_embed.getClipyouLinks(id, hash, quality, title, function(links) {
                response.links = links;

                done();
              });
            });
          } else
          if (type === 'rutube') {
            var externalEmbed = xml.querySelector('external_embed');
            externalEmbed = externalEmbed && externalEmbed.textContent;
            if (externalEmbed) {
              response.action = 'getRutubeLinks';
              response.links = [externalEmbed];
            }

            return done();
          }
        }

        var qualityList = ['ld', 'sd'];
        var sizeList = ['360', '720'];

        for (var i = 0, src; src = srcList[i]; i++) {
          id = src.textContent || '';
          quality = src.getAttribute('quality');

          if (/^\d+p$/.test(quality)) {
            quality = quality.match(/^(\d+)p$/)[1];
          }

          var qIndex = qualityList.indexOf(quality);
          if (qIndex !== -1) {
            quality = sizeList[qIndex];
          }

          type = src.getAttribute('type');

          if (type === 'video') {
            response.links.push({
              url: id,
              quality: quality,
              title: title,
              cover: cover,
              duration: time
            });
          }
        }

        return done();
      });
    },

    getOkMetadata: function(message, cb) {
      var url = message.url;
      if (!url) {
        return cb();
      }
      mono.request({
        url: url,
        json: true
      }, function(err, resp, json) {
        if (err || !json) {
          return cb();
        }

        cb(json);
      });
    },

    getOkViaMobile: function(message, cb) {
      "use strict";
      var metadata = message.metadata;
      var params = {
        'st.cmd': 'movieLayer',
        'st.mvId': message.mvId
      };
      var url = 'http://m.ok.ru/dk?' + mono.param(params);

      var response = {
        action: message.action,
        links: null,
        title: metadata.movie.title
      };

      mono.request({
        url: url
      }, function(err, resp, data) {
        if (err || !data) {
          return cb();
        }

        var r = new RegExp('href="([^"]+st\\.cmd=moviePlaybackRedirect[^"]+st\\.mvid=' + message.mvId + '[^"]+)"');
        var moviePlaybackRedirect = data.match(r);
        moviePlaybackRedirect = moviePlaybackRedirect && moviePlaybackRedirect[1];
        if (!moviePlaybackRedirect) {
          return cb();
        }

        moviePlaybackRedirect = mono.fileName.decodeSpecialChars(moviePlaybackRedirect);

        response.links = [{
          url: moviePlaybackRedirect
        }];

        if (!/st.mq=\d+/.test(moviePlaybackRedirect)) {
          return cb(response);
        }

        var videos = metadata.videos;
        if (!videos || !videos.length) {
          return cb(response);
        }

        videos.forEach(function(item) {
          if (!item.url) {
            return;
          }

          var params = mono.parseUrl(item.url);
          if (!params.type) {
            return;
          }

          item.url = moviePlaybackRedirect.replace(/(st.mq=)\d+/, '$1' + params.type);
        });

        response.links = videos;

        cb(response);
      });
    },

    okDirectOrMobile: function(message, cb) {
      "use strict";
      var metadata = message.metadata;
      var url = null;
      metadata.videos && metadata.videos.some(function(item) {
        if (item.url) {
          url = item.url;
          return true;
        }
      });

      var onAbort = function() {
        message.action = 'getOkViaMobile';
        odnoklassniki_ru_embed.getOkViaMobile(message, cb);
      };

      if (!url) {
        return onAbort();
      }

      mono.request({
        url: url,
        type: 'HEAD'
      }, function(err) {
        if (err) {
          return onAbort();
        }

        message.action = 'getOkViaMobileNoWrap';
        message.links = metadata.videos;
        return cb(message);
      });
    }
  };

  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return odnoklassniki_ru_embed;
    };
  } else {
    engine.modules.odnoklassniki = odnoklassniki_ru_embed;
  }
  var soundcloud_com_embed = {
    getSoundcloudTrackInfo: function(request, callback) {
      function callback_links(data, isValid) {
        var response = {
          action: request.action,
          trackUrl: request.trackUrl,
          client_id: request.client_id,
          data: data,
          checkLinks: isValid
        };

        callback(response);
      }

      soundcloud_com_embed._getSoundcloudTrackInfo(request.trackUrl, request.client_id, callback_links);
    },

    _getSoundcloudTrackInfo: function(trackUrl, client_id, callback) {
      if (!trackUrl || !client_id) {
        callback(null);
        return;
      }

      var url = 'http://api.soundcloud.com/resolve.json?url=' + trackUrl +
        '&client_id=' + client_id;

      mono.request({
        url: url,
        headers: {
          Referer: url
        },
        json: true
      }, function(err, resp, json) {
        if (err || !json) {
          return callback();
        }

        soundcloud_com_embed.checkSoundcloudLinks(json, client_id, callback);
      });
    },

    checkSoundcloudLinks: function(data, client_id, cb) {
      if (!data) {
        return cb();
      }
      var info = data;

      if (info.kind !== 'track' && info.tracks && info.tracks.length === 1) {
        info = info.tracks[0];
      }

      if (info.kind === 'track' && info.stream_url) {
        soundcloud_com_embed.validateSoundcloudTrackUrl(info.stream_url, client_id, function(isValid) {
          cb(data, isValid);
        });
        return;
      }

      if (info.tracks && info.tracks[0]) {
        soundcloud_com_embed.validateSoundcloudTrackUrl(info.tracks[0].stream_url, client_id, function(isValid) {
          cb(data, isValid);
        });
        return;
      }

      return cb(data);
    },

    validateSoundcloudTrackUrl: function(url, client_id, cb) {
      url += (url.indexOf('?') === -1) ? '?' : '&';
      url += 'client_id=' + client_id;
      mono.request({
        url: url,
        type: 'HEAD'
      }, function(err) {
        cb(!err);
      });
    }
  };

  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return soundcloud_com_embed;
    };
  } else {
    engine.modules.soundcloud = soundcloud_com_embed;
  }
  var vimeo_com_embed = {
    getVimeoLinks: function(request, callback) {
      "use strict";

      function callback_links(links, title, thumb) {
        var response = {
          action: request.action,
          extVideoId: request.extVideoId,
          links: links,
          title: title,
          thumb: thumb
        };

        callback(response);
      }

      vimeo_com_embed._getVimeoLinks(request.extVideoId, request.url, callback_links);
    },
    _getVimeoLinks: function(videoId, url, callback) {
      "use strict";
      vimeo_com_embed.getVimeoNoEmbedLinks(videoId, url, function(links, title, thumb) {
        if (links) {
          return callback(links, title, thumb);
        }

        vimeo_com_embed.getVimeoEmbedLinks(videoId, callback);
      });
    },
    getVimeoEmbedLinks: function(videoId, callback) {
      "use strict";
      var abort = function() {
        return callback(null, '', '');
      };

      if (!videoId) {
        return abort();
      }

      mono.request({
        url: 'https://player.vimeo.com/video/' + videoId
      }, function(err, resp, data) {
        if (err || !data) {
          return abort();
        }

        var jsonList = mono.findJson(data, [/"files":/]);
        var config = null;
        jsonList.some(function(obj) {
          "use strict";
          if (!obj.video || !obj.request || !obj.request.files) {
            return;
          }

          config = obj;
          return true;
        });

        data = vimeo_com_embed.getLinksFromConfig(config);
        if (data) {
          return callback(data.links, data.title, data.thumb);
        }

        return abort();
      });
    },
    getVimeoConfig: function(url, cb) {
      "use strict";
      var abort = function() {
        return cb(null, '', '');
      };

      mono.request({
        url: url
      }, function(err, resp, data) {
        if (err || !data) {
          return abort();
        }

        data = vimeo_com_embed.getVimeoDataFromConfig(data);
        if (data) {
          return cb(data.links, data.title, data.thumb);
        }

        return abort();
      });
    },
    getClipPageConfig: function(data, cb) {
      "use strict";
      var abort = function() {
        return cb(null, '', '');
      };

      var configUrl = null;
      var scriptList = mono.getPageScript(data, /['"]config_url['"]\s*:\s*/);
      scriptList.some(function(script) {
        var configList = mono.findJson(script, /['"]config_url['"]\s*:\s*/);
        return configList.some(function(config) {
          if (config.player) {
            configUrl = config.player.config_url;
            if (configUrl) {
              return true;
            }
          }
        });
      });

      if (configUrl) {
        return vimeo_com_embed.getVimeoConfig(configUrl, cb);
      }

      return abort();
    },
    getVimeoNoEmbedLinks: function(videoId, url, cb) {
      "use strict";
      var abort = function() {
        return cb(null, '', '');
      };

      if (videoId && url && !/vimeo\.com\/[^\/]+\/review\/\d+/i.test(url)) {
        url = null;
      }

      mono.request({
        url: url || 'https://vimeo.com/' + videoId
      }, function(err, resp, data) {
        if (err || !data) {
          return abort();
        }

        var configUrl = data.match(/data-config-url=["']([^\s"'<>]+)/i);
        configUrl = configUrl && configUrl[1].replace(/&amp;/ig, '&');

        if (configUrl) {
          return vimeo_com_embed.getVimeoConfig(configUrl, cb);
        } else {
          return vimeo_com_embed.getClipPageConfig(data, cb);
        }
      });
    },
    getVimeoLinksFromConfig: function(msg, response) {
      "use strict";
      var data = vimeo_com_embed.getLinksFromConfig(msg.config);
      if (data) {
        return response(data);
      }

      return response(null);
    },
    getLinksFromConfig: function(config) {
      "use strict";
      if (!config || !config.video || !config.request || !config.request.files) {
        return null;
      }

      var video = config.video;
      var files = config.request.files;

      var data = {};

      data.title = video.title || '';

      var maxSize = null;
      for (var size in video.thumbs) {
        if (maxSize === null || maxSize < size) {
          maxSize = size;
          data.thumb = video.thumbs[size];
        }
      }

      data.links = [];

      for (var type in files) {
        if (!Array.isArray(files[type])) {
          continue;
        }
        files[type].forEach(function(item) {
          if (!item || !item.url || !item.mime) {
            return;
          }

          var ext = item.mime.split('/')[1];
          if (!ext) {
            ext = item.url.match(/\.(\w{2,4})(?:\?|#|$)/i);
            ext = ext && ext[1] || 'mp4';
          }

          var extUp = ext.toUpperCase();

          var height = item.quality;
          if (/^\d+p$/.test(height)) {
            height = height.replace(/p$/, '');
          }

          var extQuality = extUp + ' ' + height;

          data.links.push({
            url: item.url,
            name: extQuality,
            height: height,
            type: extUp,
            format: extUp,
            ext: ext
          });
        });
      }

      if (!data.links.length) {
        data = null;
      }

      return data;
    },
    getVimeoDataFromConfig: function(config) {
      "use strict";
      config = config.replace(/(\{|,)\s*(\w+)\s*:/ig, '$1"$2":').
      replace(/(:\s+)\'/g, '$1"').replace(/\'([,\]\}])/g, '"$1');

      try {
        config = JSON.parse(config);
      } catch (err) {
        return null;
      }

      return this.getLinksFromConfig(config);
    }
  };

  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return vimeo_com_embed;
    };
  } else {
    engine.modules.vimeo = vimeo_com_embed;
  }
  var vkontakte_ru_embed = {
    getVKLinks: function(request, callback) {
      function callback_links(vid, links, title, duration, thumb, data, embed) {
        if (embed) {
          embed.origRequest = request;
          engine.onMessage(embed, callback);
          return;
        }

        var response = {
          action: request.action,
          extVideoId: vid ? vid : request.extVideoId,
          links: links,
          title: title,
          duration: duration,
          thumb: thumb,
          data: data,
          checkLinks: null
        };

        if (request.checkLinks && links && links.length > 0) {
          vkontakte_ru_embed.checkVkLinks(links, function(checkUrl, isValid) {
            response.checkLinks = isValid;
            callback(response);
          });
          return;
        }

        callback(response);
      }

      vkontakte_ru_embed._getVKLinks(request.extVideoId, callback_links);
    },

    preparePladformLinks: function(pladformLinks) {
      var links;
      var obj = {
        links: links = []
      };
      pladformLinks.forEach(function(item) {
        obj.title = item.title;
        obj.duration = item.duration;
        obj.thumb = item.cover;

        var ext = item.url.match(/[\w]+\.(mp4|flv)(?:\?|$)/i);
        if (!ext) {
          ext = 'flv';
        } else {
          ext = ext[1];
        }
        links.push({
          url: item.url,
          name: ext.toUpperCase(),
          subname: item.quality.toUpperCase(),
          type: ext.toLowerCase()
        });
      });
      return obj;
    },

    _getVKLinks: function(videoId, callback) {
      var _this = this;
      var links = [],
        title = videoId,
        data = null,
        embed = null,
        thumb = '',
        duration = '';

      var vid = videoId;

      var m = null;
      var oid = null;
      var id = null;

      var re = /^video(-?\d+)_(\d+)/i;

      if (!re.test(vid)) {
        var oidRe = /(?:^|&)oid=(-?\d+)/i;
        var idRe = /(?:^|&)id=(-?\d+)/i;

        m = vid.match(oidRe);
        oid = m && parseInt(m[1]);

        m = vid.match(idRe);
        id = m && parseInt(m[1]);

        vid = '';
        if (oid && id) {
          vid = 'video' + oid + '_' + id;
        }
      } else {
        m = vid.match(re);
        oid = parseInt(m[1]);
        id = parseInt(m[2]);
      }

      if (!vid) {
        return callback(vid, links, title);
      }

      title = vid;

      return mono.request({
        url: 'https://vk.com/' + vid
      }, function(err, resp, response) {
        if (err || !response) {
          return callback(vid, links, title, duration, thumb, data, embed);
        }

        var varsJson = null;
        mono.findJsonString(response, /vars\s*=\s*/).some(function(str) {
          return mono.findJson(str, [/"vid":/, /"oid":/, /"md_title":/]).some(function(obj) {
            if (obj.vid === id && obj.oid === oid) {
              varsJson = obj;
              return true;
            }
          });
        });

        if (varsJson) {
          var videoInfo = vkontakte_ru_embed.getVkLinksFromJson(varsJson);

          links = videoInfo.links;
          title = videoInfo.title;
          thumb = videoInfo.thumb;
          duration = videoInfo.duration;

          return callback(vid, links, title, duration, thumb, varsJson, embed);
        }

        var async = false;
        mono.findJsonString(response, /video_box_wrap/).some(function(str) {
          var m = null;
          var frameBody = /<iframe([^>]+)>/i.exec(str);
          if (frameBody) {
            frameBody = frameBody[1];
            m = /youtube.com\\?\/embed\\?\/([\w\-]+)/i.exec(frameBody);
            if (m) {
              embed = {
                action: 'getYoutubeLinks',
                extVideoId: m[1]
              };
              return true;
            }
            m = /vimeo.com\\?\/video\\?\/(\d+)/i.exec(frameBody);
            if (m) {
              embed = {
                action: 'getVimeoLinks',
                extVideoId: m[1]
              };
              return true;
            }
            m = /src="([^"]*pladform\.ru[^"]+)"/i.exec(frameBody);
            if (m) {
              async = true;
              var params = mono.parseUrl(m[1]);
              engine.modules.odnoklassniki.getPladformVideo({
                extVideoId: {
                  playerId: params.pl,
                  videoId: params.videoid
                }
              }, function(response) {
                if (response && response.action === 'getRutubeLinks') {
                  response.links = null;
                }

                var pladformLinks = response && response.links;
                if (!Array.isArray(pladformLinks)) {
                  return callback(vid, links, title, duration, thumb, data, embed);
                }

                var videoInfo = vkontakte_ru_embed.preparePladformLinks(pladformLinks);

                return callback(vid, videoInfo.links, videoInfo.title, videoInfo.duration, videoInfo.thumb, data, embed);
              });
              return true;
            }
          }
          var sourceBody = /<source([^>]+)>/i.exec(str);
          if (sourceBody) {
            sourceBody = sourceBody[1];
            m = /src="([^"]*cdninstagram\.com[^"]+mp4)"/i.exec(sourceBody);
            if (m) {
              links.push({
                url: m[1],
                subname: 'SD',
                name: 'MP4',
                type: 'mp4'
              });
              return true;
            }
          }
          if (/var\sopts\s*=\s*/.test(str)) {
            m = /url:\s*'(?:[^']+)dailymotion.com\/(?:swf\/)?video\/([\w\d]+)/.exec(str);
            if (m) {
              embed = {
                action: 'getDailymotionLinks',
                extVideoId: m[1]
              };
              return true;
            }
          }
        });

        return !async && callback(vid, links, title, duration, thumb, data, embed);
      });
    },

    checkVkLinks: function(links, callback) {
      var checkUrl = '';

      if (links && links.length > 0) {
        if (links[0].type == 'mp4')
          checkUrl = links[0].url;
        else if (links.length > 1)
          checkUrl = links[1].url;
        else
          checkUrl = links[0].url;
      }

      if (checkUrl) {
        mono.request({
          url: checkUrl,
          type: 'HEAD'
        }, function(err, resp) {
          callback(checkUrl, !err);
        });
        return;
      }

      callback();
    },

    getVkLinksFromJsonMsg: function(msg, response) {
      var info = this.getVkLinksFromJson(msg.json);
      return response(info);
    },

    getVkLinksFromJson: function(json) {
      var links = [];
      var vid = json.vid;
      var title = json.md_title || json.vid;
      var thumb = '';

      if (json.thumb) {
        thumb = json.thumb;
      } else
      if (json.jpg) {
        thumb = json.jpg;
      }

      var type = 'flv';
      if (json.no_flv === 1) {
        type = 'mp4';
      }

      var videoUrlRegExp = /url([0-9]+)/;
      Object.keys(json).forEach(function(key) {
        var quality = null;
        if (key === 'extra_data' && json.extra === "52") {
          quality = json.hd ? 'HD' : 'SD';
          links.push({
            url: json.extra_data,
            subname: quality,
            name: type.toUpperCase(),
            type: type
          });
        } else {
          quality = key.match(videoUrlRegExp);
          quality = quality && quality[1];
          if (quality !== null) {
            var url = json[key];

            links.push({
              url: url,
              subname: quality,
              name: type.toUpperCase(),
              type: type
            });
          }
        }
      });

      var duration = json.duration;

      return {
        action: 'getVKLinks',
        extVideoId: vid,
        links: links,
        title: title,
        duration: duration,
        thumb: thumb,
        data: json,
        checkLinks: null
      };
    },

    getVkLinksFromData: function(request, cb) {
      var response = request.data;

      var varsJson = null;
      mono.findJson(response, [/"vid":/, /"oid":/, /"md_title":/]).some(function(obj) {
        varsJson = obj;
        return true;
      });

      if (!varsJson) {
        return cb();
      }

      var info = vkontakte_ru_embed.getVkLinksFromJson(varsJson);

      return cb(info);
    }
  };
  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return vkontakte_ru_embed;
    };
  } else {
    engine.modules.vkontakte = vkontakte_ru_embed;
  }
  var youtube_com_embed = {
    /**
     * @private
     */
    lastSts: ["17050", [
      ["swap", 19],
      ["reverse", null],
      ["splice", 1],
      ["reverse", null],
      ["splice", 1],
      ["swap", 7],
      ["reverse", null],
      ["swap", 38],
      ["splice", 3]
    ]],
    /**
     * @type {Object}
     * @property {Number} sts
     * @property {string} url
     * @property {Array} actList
     * @property {boolean} trust
     * @property {boolean} invalid
     * @private
     */
    currentSts: undefined,
    /**
     * @private
     */
    isTrackError: {},
    getYoutubeLinks: function(request, callback) {
      function callback_links(links, title, subtitles, duration) {
        youtube_com_embed.addUmmyLinks(links, request.extVideoId);
        youtube_com_embed.addConverterLinks(links, title);

        var response = {
          action: request.action,
          extVideoId: request.extVideoId,
          links: links,
          title: title,
          subtitles: subtitles,
          duration: duration,
          checkLinks: null
        };

        if (request.checkLinks && links) {
          return youtube_com_embed.checkYoutubeLinks(links, function(checkUrl, isValid) {
            response.checkLinks = isValid;
            return callback(response);
          });
        }

        return callback(response);
      }

      return youtube_com_embed.prepareLastSts(function() {
        return youtube_com_embed.__getYoutubeLinks(request.url, request.extVideoId, request.checkSubtitles, callback_links, request.noDash);
      });
    },

    /**
     * @private
     */
    prepareDechiper: function(testItem, currentSts, cb) {
      "use strict";
      var _this = this;
      var sigUrl = currentSts.url.match(/\/(?:[^\/]+)?player-([^\/]+)\//);
      sigUrl = sigUrl && sigUrl[1];
      if (!sigUrl) {
        sigUrl = 'unknownPlayerName';
      }
      this.ytHtml5SigDecipher.dechip({
        sts: currentSts.sts,
        url: currentSts.url
      }, function(actList, sts, trust) {
        if (!actList) {
          if (!_this.isTrackError[sigUrl]) {
            _this.isTrackError[sigUrl] = 1;
            sigUrl && currentSts.sts && engine.track({
              t: 'event',
              ec: 'youtube',
              ea: 'pError',
              el: currentSts.sts + ' ' + sigUrl
            });
          }
          currentSts.invalid = true;
          return cb();
        }

        currentSts.actList = actList;
        currentSts.trust = !!trust;

        if (!currentSts.sts && sts) {
          currentSts.sts = sts;
        }

        if (!trust) {
          var url = testItem.url;
          var signature = youtube_com_embed.ytRunActList(currentSts.actList, testItem.s);
          if (testItem.getUrl) {
            url = testItem.getUrl(signature);
          } else {
            url += '&signature=' + signature;
          }

          _this.ytHtml5SigDecipher.checkActList(currentSts.sts, currentSts.actList, url, function(r) {
            if (r) {
              currentSts.trust = true;
            } else {
              currentSts.invalid = true;
            }
            cb();
          });
        } else {
          cb();
        }
      });
    },

    /**
     * @private
     */
    needDechiper: function(config) {
      "use strict";
      var needDechiper = false;
      ['url_encoded_fmt_stream_map', 'adaptive_fmts', 'fmt_url_map'].some(function(key) {
        var item = config[key];
        if (!item) {
          return 0;
        }

        item.some(function(item) {
          if (item.s && item.url) {
            needDechiper = item;
            return 1;
          }
        });

        if (needDechiper) {
          return 1;
        }
      });

      if (!needDechiper && config.dashmpd) {
        var s = config.dashmpd.match(youtube_com_embed.dashMpdSigR);
        if (s) {
          needDechiper = {
            s: s[2],
            url: config.dashmpd.replace(s[1], ''),
            getUrl: function(url, s, signature) {
              return url.replace(s[1], '/signature/' + signature);
            }.bind(null, config.dashmpd, s)
          };
        }
      }

      return needDechiper;
    },

    /**
     * @private
     */
    videoInfoToObj: function(data, isObj) {
      "use strict";
      var decodeParams = function(data) {
        ['url_encoded_fmt_stream_map', 'adaptive_fmts', 'fmt_url_map'].forEach(function(key) {
          if (data[key]) {
            data[key] = data[key].split(',').map(function(item) {
              return dataStrToObj(item);
            });
          }
        });
      };
      var dataStrToObj = function(data) {
        data = mono.parseUrl(data, {
          params: true
        });
        decodeParams(data);
        return data;
      };

      var config = data;
      if (isObj) {
        decodeParams(config);
      } else {
        config = dataStrToObj(data);
      }
      return config;
    },

    /**
     * @private
     */
    expCurrentSts: function() {
      "use strict";
      var now = parseInt(Date.now() / 1000);

      if (this.currentSts === undefined) {
        return;
      }

      if (!this.currentSts.expire) {
        this.currentSts.expire = now + 21600;
      } else
      if (this.currentSts.expire < now) {
        this.currentSts = undefined;
      }
    },

    /**
     * @private
     */
    getYtConfig: function(videoId, eurl, cb, index, useDefaultSts) {
      "use strict";
      var _this = this;
      if (!index) {
        index = 0;
      }

      var stateMap = {
        0: 'ncInfo',
        1: 'ncInfo',
        2: 'info',
        3: 'info',
        4: 'jsonPage',
        5: 'page'
      };
      var state = stateMap[index];

      this.expCurrentSts();

      if (useDefaultSts) {
        this.currentSts = {
          sts: parseInt(this.lastSts[0]),
          actList: this.lastSts[1]
        };
        this.expCurrentSts();
      } else
      if (this.currentSts === undefined) {
        return this.getCurrentSts(function(obj) {
          _this.currentSts = obj || {
            sts: parseInt(_this.lastSts[0]),
            actList: _this.lastSts[1],
            trust: true
          };
          _this.expCurrentSts();
          _this.getYtConfig(videoId, eurl, cb, index, useDefaultSts);
        });
      }

      var currentSts = JSON.parse(JSON.stringify(this.currentSts));

      var url, params;
      if (['ncInfo', 'info'].indexOf(state) !== -1) {
        var domain = null;
        if (state === 'ncInfo') {
          domain = 'www.youtube-nocookie.com';
        } else {
          domain = 'www.youtube.com';
        }

        var el = null;
        if ([0, 2].indexOf(index) !== -1) {
          el = 'detailpage';
        } else {
          el = 'info';
        }

        params = {
          video_id: videoId,
          eurl: eurl,
          el: el,
          sts: currentSts.sts
        };
        url = 'https://' + domain + '/get_video_info?' + mono.param(params);
      } else
      if (state === 'jsonPage') {
        url = 'https://www.youtube.com/watch?' + mono.param({
          v: videoId,
          spf: 'navigate'
        });
      } else
      if (state === 'page') {
        url = 'https://www.youtube.com/watch?' + mono.param({
          v: videoId
        });
      } else {
        return cb();
      }

      var abort = function() {
        _this.getYtConfig(videoId, eurl, cb, ++index, useDefaultSts);
      };

      return mono.request({
        url: url
      }, function(err, resp, data) {
        if (err || !data) {
          return abort();
        }

        var jsonList = undefined;
        var config;
        if (['ncInfo', 'info'].indexOf(state) !== -1) {
          config = _this.videoInfoToObj(data);

          if (state === 'ncInfo') {
            if (config.requires_purchase === '1' ||
              config.url_encoded_fmt_stream_map === '' ||
              config.fmt_url_map === '' ||
              config.adaptive_fmts === '' ||
              config.errorcode > 0) {
              return abort();
            }
          }
        } else
        if (state === 'jsonPage') {
          try {
            data = JSON.parse(data);
            data.some(function(item) {
              if (item.data && (jsonList = item.data.swfcfg)) {
                return true;
              }
            });
            if (!jsonList) {
              return abort();
            }
          } catch (e) {
            return abort();
          }
        } else {
          var script = mono.getPageScript(data, /ytplayer\.config\s+=\s+/);
          if (!script.length) {
            return abort();
          }
          script = script[0];

          jsonList = mono.findJson(script, [/"video_id":/]);
          if (!jsonList.length) {
            return abort();
          }
          jsonList = jsonList[0];
        }
        if (['jsonPage', 'page'].indexOf(state) !== -1) {
          if (!jsonList.args || typeof jsonList.args !== 'object') {
            return abort();
          }

          if (jsonList.assets && jsonList.assets.js) {
            currentSts = {
              sts: jsonList.sts,
              url: jsonList.assets.js
            };
          }

          config = _this.videoInfoToObj(jsonList.args, 1);
        }

        var testItem;
        if (!currentSts.actList && (testItem = _this.needDechiper(config))) {
          _this.prepareDechiper(testItem, currentSts, function() {
            if (currentSts.invalid) {
              if (state !== 'page') {
                return abort();
              }

              if (state === 'page' && !useDefaultSts) {
                useDefaultSts = 1;
                index = -1;
                return abort();
              }
            }

            cb(config, currentSts);
          });
        } else {
          cb(config, currentSts);
        }
      });
    },

    /**
     * @private
     */
    readFmt: function(links, meta, fmt, currentSts, titleParam) {
      "use strict";
      fmt.forEach(function(item) {
        if (item.stream) {
          meta.hasStream = 1;
          return;
        }

        if (!item.url) {
          return;
        }

        var url = item.url;
        if (!/(\?|&)s(ig(nature)?)?=/i.test(url)) {
          if (item.sig) {
            url += '&signature=' + item.sig;
          } else
          if (item.signature) {
            url += '&signature=' + item.signature;
          } else
          if (item.s) {
            if (currentSts.invalid) {
              console.error('Sts is invalid!', currentSts);
              return;
            }
            if (!currentSts.actList) {
              console.error('Sts actList is not found!', currentSts);
              return;
            }
            url += '&signature=' + youtube_com_embed.ytRunActList(currentSts.actList, item.s);
          }
        }

        if (item.itag && !/(\?|&)itag=/i.test(url)) {
          url += '&itag=' + item.itag;
        }

        url = url.replace(/(\?|&)sig=/i, '$1signature=').replace(/\\u0026/ig, '&');

        var itag = url.match(/(?:\?|&)itag=(\d+)/i);
        itag = itag && itag[1];
        if (!itag) {
          return;
        }

        if (!meta[itag]) {
          meta[itag] = {};
        }

        if (item.fps) {
          meta[itag].fps = item.fps;
        }

        if (item.size && /^\d+x\d+$/.test(item.size)) {
          var wh = item.size.split('x');
          meta[itag].quality = youtube_com_embed.getDashQuality(wh[0], wh[1]);
        }

        if (item.bitrate) {
          meta[itag].bitrate = parseInt(item.bitrate);
        }

        if (item.type) {
          meta[itag].type = item.type;
          var codecs = item.type.match(/codecs="([^"]+)"/);
          if (codecs) {
            meta[itag].codecs = codecs[1];
          }
        }

        if (item.projection_type) {
          meta[itag].projectionType = parseInt(item.projection_type);
        }

        if (!links[itag]) {
          links[itag] = url + titleParam;
        }
      });
    },

    /**
     * @private
     */
    onGetConfig: function(videoId, checkSubtitles, cb, noDash, config, currentSts) {
      "use strict";
      var _this = this;
      var links = null,
        title = '',
        subtitles = null,
        duration = '',
        dashUrl = null;

      if (!config) {
        return cb(links, title, subtitles, duration);
      }

      cb = function(cb) {
        var wait = 1;
        var ready = 0;

        var onReady = function() {
          ready++;
          if (ready !== wait) {
            return;
          }
          cb(links, title, subtitles, duration);
        };

        if (checkSubtitles) {
          wait++;
          _this.getYoutubeSubtitles({
            extVideoId: videoId
          }, function(subs) {
            subtitles = subs || null;
            onReady();
          });
        }

        if (!noDash && dashUrl) {
          wait++;
          if (!links) {
            links = {};
          }
          _this.getYouTubeDashLinks(links, dashUrl, function() {
            var len = Object.keys(links).length;
            if (links.meta && !links.meta.hasStream) {
              len--;
            }
            if (!len) {
              links = null;
            }
            onReady();
          }, !currentSts.invalid && currentSts.actList && function(actList, s) {
            return youtube_com_embed.ytRunActList(actList, s);
          }.bind(this, currentSts.actList));
        }

        onReady();
      }.bind(this, cb);

      var titleParam = '';
      title = config.title || '';
      duration = config.length_seconds || '';
      dashUrl = config.dashmpd || '';

      if (title) {
        title = title.replace(/\+/g, ' ');
        titleParam = '&title=' + encodeURIComponent(mono.fileName.modify(title));
      }

      var fmtMap = config.fmt_url_map || config.url_encoded_fmt_stream_map || [];
      var adaptiveFmts = config.adaptive_fmts || [];

      var meta = {};

      if (config.livestream || config.live_playback) {
        meta.hasStream = 1;
      }

      links = {};
      fmtMap && this.readFmt(links, meta, fmtMap, currentSts, titleParam);
      adaptiveFmts && this.readFmt(links, meta, adaptiveFmts, currentSts, titleParam);

      if (Object.keys(links).length === 0 && !meta.hasStream) {
        links = null;
      } else {
        links.meta = meta;
      }

      cb();
    },

    /**
     * @private
     */
    __getYoutubeLinks: function(eurl, videoId, checkSubtitles, cb, noDash) {
      "use strict";
      var _this = this;
      if (!eurl) {
        eurl = 'https://www.youtube.com/watch?v=' + videoId;
      }

      this.getYtConfig(videoId, eurl, function(config, currentSts) {
        _this.onGetConfig(videoId, checkSubtitles, cb, noDash, config, currentSts);
      });
    },

    /**
     * @private
     */
    addUmmyLinks: function(links, videoId) {
      if (!links || (links.meta && links.meta.hasStream)) {
        return;
      }

      if (engine.preferences.showUmmyItem) {
        var meta = links.meta;
        if (!meta) {
          meta = links.meta = {};
        }
        meta.videoId = videoId;

        links['ummy'] = 'ummy://www.youtube.com/watch?v=' + videoId;
        links['ummyAudio'] = 'ummy://www.youtube.com/watch?v=' + videoId + '&sf_type=audio';
      }
    },

    addConverterLinks: function(links, title) {
      if (!links) {
        return;
      }

      if (!engine.preferences.enableConverter) {
        return;
      }

      var audioRe = /audio\/([^;]+)/;
      var videoRe = /video\/([^;]+)/;
      var qualityRe = /(\d+)K/;
      var audioLinks = [];
      var videoLinks = [];

      var meta = links.meta;
      if (!meta) {
        meta = links.meta = {};
      }

      var maxVideoQuality = 0;
      Object.keys(links).forEach(function(itag) {
        if (itag === 'meta') {
          return;
        }
        var info = meta[itag];
        if (!info || !info.bitrate) {
          return;
        }

        var ext = null;
        if (audioRe.test(info.type)) {
          ext = info.type.match(audioRe)[1];
          audioLinks.push({
            itag: itag,
            url: links[itag],
            bitrate: parseInt(info.bitrate),
            ext: ext,
            codecs: info.codecs
          });
        } else
        if (videoRe.test(info.type) && info.quality && info.projectionType) {
          // avc only
          if (!/avc/.test(info.codecs)) {
            return;
          }

          ext = info.type.match(videoRe)[1];

          var quality = info.quality;
          if (qualityRe.test(quality)) {
            quality = quality.match(qualityRe)[1] * 1000;
          } else {
            quality = parseInt(quality);
          }

          if (maxVideoQuality < quality) {
            maxVideoQuality = quality;
          }

          videoLinks.push({
            itag: itag,
            url: links[itag],
            bitrate: parseInt(info.bitrate),
            ext: ext,
            codecs: info.codecs,
            quality: quality
          });
        }
      });

      if (!audioLinks.length) {
        return;
      }

      audioLinks.sort(function(a, b) {
        return a.bitrate > b.bitrate ? -1 : 1;
      });

      var extra = meta.extra;
      if (!extra) {
        extra = meta.extra = [];
      }

      extra.push({
        format: 'MP3',
        itag: audioLinks[0].itag,
        extra: 'converter',
        request: {
          action: 'convert',
          audioUrl: audioLinks[0].url,
          audioCodecs: audioLinks[0].codecs,
          filename: mono.fileName.modify(title) + '.mp3',
          metadata: {
            title: title
          }
        }
      });

      videoLinks = videoLinks.filter(function(item) {
        return item.quality >= maxVideoQuality;
      });

      if (videoLinks.length) {
        videoLinks.some(function(a, b) {
          return a.bitrate > b.bitrate ? -1 : 1;
        });

        extra.push({
          format: 'MP4',
          itag: videoLinks[0].itag,
          extra: 'converter',
          fps: videoLinks[0].fps,
          request: {
            action: 'convert',
            preload: true,
            audioUrl: audioLinks[0].url,
            audioCodecs: audioLinks[0].codecs,
            videoUrl: videoLinks[0].url,
            videoCodecs: videoLinks[0].codecs,
            filename: mono.fileName.modify(title) + '.mp4',
            metadata: {
              title: title
            }
          }
        });
      }
    },

    /**
     * @private
     */
    checkYoutubeLinks: function(links, callback) {
      var checkItags = ['18', '34', '35'],
        checkUrl = '';
      for (var i = 0; i < checkItags.length; i++) {
        if (links[checkItags[i]]) {
          checkUrl = links[checkItags[i]];
          break;
        }
      }

      if (checkUrl) {
        mono.request({
          type: 'HEAD',
          url: checkUrl
        }, function(err, resp) {
          callback(checkUrl, !err);
        });
        return;
      }

      callback();
    },

    /**
     * @private
     */
    convertVtt2Srt: function(item, cb) {
      "use strict";
      mono.request({
        url: item.url
      }, function(err, resp, body) {
        if (err || !body) {
          console.error('Request error!', err);
          return cb();
        }

        var re = /(\d{2}:\d{2}:\d{2})\.(\d{3})/g;
        var validateRe = /^\d{2}:\d{2}:\d{2}\.\d{3}/;
        var arr = body.split('\n\n');

        if (!validateRe.test(arr[0])) {
          arr.shift();
        }

        if (!validateRe.test(arr[arr.length - 1])) {
          arr.pop();
        }

        var hasSkip = false;
        var srt = arr.filter(function(item) {
          var r = validateRe.test(item);
          if (!r) {
            hasSkip = true;
          }
          return r;
        }).map(function(item, index) {
          item = item.replace(re, "$1,$2");
          return (index + 1) + '\n' + item;
        });
        srt = srt.join('\n\n');

        if (hasSkip) {
          return cb();
        }

        item.srt = srt;
        item.preprocess = 'srt2url';
        cb();
      });
    },

    /**
     * @private
     */
    getYoutubeSubtitles: function(message, cb) {
      var _this = this;
      var videoId = message.extVideoId;
      var baseUrl = 'http://video.google.com/timedtext';
      mono.request({
        url: baseUrl + '?hl=' + engine.language.lang + '&v=' + videoId + '&type=list&tlangs=1',
        xml: true
      }, function(err, resp, xml) {
        if (err || !xml) {
          return cb();
        }

        var track = xml.querySelectorAll('track');
        var target = xml.querySelectorAll('target');
        var list = [];
        var trackList = {};
        var targetList = {};
        var origTrack = undefined;
        var langCode, param;
        for (var i = 0, item; item = track[i]; i++) {
          langCode = item.getAttribute('lang_code');
          param = {
            lang: langCode,
            v: videoId,
            fmt: 'vtt',
            name: item.getAttribute('name') || undefined
          };
          trackList[langCode] = {
            lang: item.getAttribute('lang_translated'),
            langCode: langCode,
            url: baseUrl + '?' + mono.param(param),
            name: param.name
          };
          list.push(trackList[langCode]);
          if (!origTrack && item.getAttribute('cantran')) {
            origTrack = param;
          }
        }

        if (origTrack) {
          for (i = 0, item; item = target[i]; i++) {
            langCode = item.getAttribute('lang_code');
            param = {
              lang: origTrack.lang,
              v: videoId,
              tlang: langCode,
              fmt: 'vtt',
              name: origTrack.name
            };
            targetList[langCode] = {
              lang: item.getAttribute('lang_translated'),
              langCode: langCode,
              url: baseUrl + '?' + mono.param(param),
              isAuto: true
            };
          }
        }

        langCode = mono.getNavigator().language.toLowerCase();
        if (langCode.indexOf('zh-hant') === 0) {
          langCode = 'zh-Hant';
        } else
        if (langCode.indexOf('zh-hans') === 0) {
          langCode = 'zh-Hans';
        }
        var localeList = [langCode];
        if (localeList[0] === 'uk') {
          localeList.push('ru');
        }
        for (var i = 0, item; item = localeList[i]; i++) {
          if (!trackList[item] && targetList[item]) {
            list.push(targetList[item]);
          }
        }

        var waitCount = 0;
        var readyCount = 0;
        var onReady = function() {
          "use strict";
          readyCount++;
          if (waitCount !== readyCount) {
            return;
          }
          return cb(list);
        };
        waitCount++;
        list.forEach(function(item) {
          "use strict";
          waitCount++;
          _this.convertVtt2Srt(item, onReady);
        });
        onReady();
      });
    },

    /**
     * @private
     */
    dashMpdSigR: /(\/s\/([^\/]+))/,

    /**
     * @private
     */
    getYouTubeDashLinks: function(links, dashmpd, cb, dechiper) {
      if (!dashmpd || dashmpd.indexOf('yt_live_broadcast') !== -1) {
        return cb();
      }

      var s = dashmpd.match(youtube_com_embed.dashMpdSigR);
      if (s) {
        if (!dechiper) {
          return cb();
        }

        var signature = dechiper(s[2]);
        dashmpd = dashmpd.replace(s[1], '/signature/' + signature);
      }

      dashmpd = dashmpd.replace('/sig/', '/signature/');

      mono.request({
        url: dashmpd,
        xml: true
      }, function(err, resp, xml) {
        if (err || !xml) {
          return cb();
        }

        youtube_com_embed.parseDash(xml, links, cb);
      });
    },

    /**
     * @private
     */
    getDashQuality: function(a, b) {
      var qualityList = {
        144: 144,
        240: 240,
        360: 360,
        480: 480,
        720: 720,
        1080: 1080,
        1440: 1440,
        '4K': 2160,
        '5K': 2880,
        '8K': 4320
      };

      var quality;
      var g = Math.max(a, b);
      a = Math.min(a, b);
      for (var qualityName in qualityList) {
        var value = qualityList[qualityName];
        if (g >= Math.floor(16 * value / 9) || a >= value) {
          quality = qualityName;
        } else {
          return quality;
        }
      }
      return quality;
    },

    /**
     * @private
     */
    parseDash: function(xml, links, cb) {
      "use strict";
      var elList = xml.querySelectorAll('Representation');
      if (!links) {
        links = {};
      }

      var meta = links.meta = links.meta || {};

      for (var i = 0, el; el = elList[i]; i++) {
        var itag = el.getAttribute('id');

        if (!meta[itag]) {
          meta[itag] = {};
        }

        var frameRate = el.getAttribute('frameRate');
        if (frameRate) {
          meta[itag].fps = frameRate;
        }

        var width = el.getAttribute('width');
        var height = el.getAttribute('height');

        if (width && height) {
          meta[itag].quality = youtube_com_embed.getDashQuality(width, height);
        }

        if (links[itag] !== undefined) {
          continue;
        }

        var baseUrlNode = el.querySelector('BaseURL');
        if (!baseUrlNode) {
          delete meta[itag];
          continue;
        }
        var url = baseUrlNode.textContent;

        var codecs = el.getAttribute('codecs');
        if (codecs) {
          meta[itag].codecs = codecs;
          var type = url.match(/mime=([^&]+)/);
          type = type && type[1];
          if (type) {
            meta[itag].type = type;
          }
        }

        var segmentUrlNode = baseUrlNode.parentNode.querySelector('SegmentURL');
        var segmentUrl = segmentUrlNode && segmentUrlNode.getAttribute('media');
        if (segmentUrl && segmentUrl.indexOf('sq/') === 0) {
          delete meta[itag];
          continue;
        }

        links[itag] = url;
      }
      cb(links);
    },

    getYoutubeIdListFromPlaylist: function(request, cb) {
      youtube_com_embed.getIdListFromList(request.baseUrl || 'https://www.youtube.com', request.listId, cb);
    },

    /**
     * @private
     */
    getIdListFromList: (function() {
      var getNextPage = function(baseUrl, url, pageList, cb) {
        if (!pageList) {
          pageList = [];
        }
        mono.request({
          url: baseUrl + url,
          json: true
        }, function(err, resp, data) {
          if (err || !data) {
            return cb(pageList);
          }

          pageList.push(data.content_html);
          var nextPageUrl = getNextPageUrl(data.load_more_widget_html);
          if (nextPageUrl === undefined) {
            return cb(pageList);
          }
          getNextPage(baseUrl, nextPageUrl, pageList, cb);
        });
      };
      var getTitleFromPage = function(data) {
        var title = data.match(/<h1[^>]+>([^<]+)<\/h1>/);
        if (!title) {
          return undefined;
        }
        return title[1].replace(/\r?\n/g, " ").trim();
      };
      var getNextPageUrl = function(data) {
        if (!data) {
          return undefined;
        }
        var nextUrl = data.match(/data-uix-load-more-href="([^"]+)"/);
        if (nextUrl) {
          nextUrl = nextUrl[1];
        }
        return nextUrl || undefined;
      };
      var readLinksFromPages = function(listId, pageList, cb) {
        var title = getTitleFromPage(pageList[0]);
        var idObj = {};
        var idList = [];
        var pattern = /href="\/watch\?([^"]+)"/g;
        var maxIndex = 0;
        for (var i = 0, len = pageList.length; i < len; i++) {
          var content = pageList[i];
          content.replace(pattern, function(string, args) {
            var url = mono.parseUrl(args, {
              params: true,
              sep: '&amp;'
            });
            if (url.list !== listId) {
              return;
            }
            url.index = parseInt(url.index);
            idObj[url.index] = url.v;
            if (url.index > maxIndex) {
              maxIndex = url.index;
            }
          });
        }
        for (i = 0; i <= maxIndex; i++) {
          if (idObj[i] === undefined) {
            continue;
          }
          if (idList.indexOf(idObj[i]) === -1) {
            idList.push(idObj[i]);
          }
        }
        cb({
          idList: idList,
          title: title
        });
      };
      var getNewClientData = function(data) {
        var params = {};
        var m = data.match(/"params":(\[[^\]]+"client\.version"[^\]]+\])/);
        if (m) {
          try {
            var json = JSON.parse(m[1]);
            json.forEach(function(item) {
              if (item.key && item.value) {
                params[item.key] = item.value;
              }
            });
          } catch (e) {}
        }
        return params;
      };
      var getNewTitle = function(data) {
        var title = 'unknown';
        var playlistMetadataRenderer = data.match(/"playlistMetadataRenderer":({[^}]+})/);
        if (playlistMetadataRenderer) {
          try {
            playlistMetadataRenderer = JSON.parse(playlistMetadataRenderer);
            if (playlistMetadataRenderer.title) {
              title = playlistMetadataRenderer.title;
            }
          } catch (e) {}
        }
        return title;
      };
      var getNewNextPageUrl = function(data) {
        var path = null;
        var m = data.match(/"nextContinuationData":({[^}]+})/);
        if (m) {
          try {
            var nextContinuationData = JSON.parse(m[1]);
            path = '/browse_ajax?' + mono.param({
              ctoken: nextContinuationData.continuation,
              itct: nextContinuationData.clickTrackingParams
            });
          } catch (e) {}
        }
        return path;
      };
      var getNewVideoList = function(data, idList) {
        var pos = data.indexOf('{"playlistVideoListRenderer":{');
        if (pos !== -1) {
          data = data.substr(pos);
          mono.findJson(data).forEach(function(obj) {
            var playlistVideoListRenderer = obj.playlistVideoListRenderer;
            var contents = playlistVideoListRenderer && playlistVideoListRenderer.contents;
            if (Array.isArray(contents)) {
              contents.forEach(function(item) {
                var playlistVideoRenderer = item.playlistVideoRenderer;
                var videoId = playlistVideoRenderer && playlistVideoRenderer.videoId;
                if (videoId) {
                  idList.push(videoId);
                }
              });
            }
          });
        }
      };
      var getNewNextPage = function(baseUrl, path, clientData, dataList, cb) {
        mono.request({
          url: baseUrl + path,
          headers: {
            'X-YouTube-Client-Name': '1',
            'X-YouTube-Client-Version': clientData['client.version']
          },
          json: true
        }, function(err, resp, data) {
          if (err) {
            mono.error('YT next page request error!', err);
            return cb();
          }

          var dataStr = JSON.stringify(data);
          var nextPageUrl = getNewNextPageUrl(dataStr);
          getNewVideoList(dataStr, dataList);

          if (nextPageUrl) {
            getNewNextPage(baseUrl, nextPageUrl, clientData, dataList, cb);
          } else {
            cb();
          }
        });
      };
      return function getLinksFromList(baseUrl, listId, cb) {
        mono.request({
          url: baseUrl + '/playlist?list=' + listId
        }, function(err, resp, data) {
          if (err) {
            return cb();
          }

          var nextPageUrl = null;
          if (data.match(/"playlistVideoListRenderer"/)) {
            var clientData = getNewClientData(data);
            var title = getNewTitle(data);
            var idList = [];

            getNewVideoList(data, idList);

            nextPageUrl = getNewNextPageUrl(data);
            if (!nextPageUrl) {
              cb({
                idList: idList,
                title: title
              });
            } else {
              getNewNextPage(baseUrl, nextPageUrl, clientData, idList, function() {
                cb({
                  idList: idList,
                  title: title
                });
              });
            }
          } else {
            nextPageUrl = getNextPageUrl(data);
            if (!nextPageUrl) {
              readLinksFromPages(listId, [data], cb);
            } else {
              getNextPage(baseUrl, nextPageUrl, [data], function(pageList) {
                readLinksFromPages(listId, pageList, cb);
              });
            }
          }
        });
      };
    })(),

    getYoutubeLinksFromConfig: function(message, cb) {
      "use strict";
      var _this = this;
      var abort = function() {
        youtube_com_embed.getYoutubeLinks(message, cb);
      };

      cb = function(cb, obj) {
        if (obj && obj.links) {
          youtube_com_embed.addUmmyLinks(obj.links, message.extVideoId);
          youtube_com_embed.addConverterLinks(obj.links, obj.title);
        }
        cb(obj);
      }.bind(this, cb);

      return this.prepareLastSts(function() {
        var jsonList = message.config;
        if (!jsonList ||
          !jsonList.args ||
          jsonList.args.video_id !== message.extVideoId ||
          !jsonList.assets ||
          !jsonList.assets.js ||
          !(jsonList.args.url_encoded_fmt_stream_map || jsonList.args.adaptive_fmts || jsonList.args.fmt_url_map)
        ) {
          return abort();
        }

        var config = _this.videoInfoToObj(jsonList.args, 1);
        var currentSts = {
          sts: jsonList.sts,
          url: jsonList.assets.js
        };

        _this.expCurrentSts();

        if (_this.currentSts === undefined) {
          if (currentSts.sts) {
            _this.currentSts = JSON.parse(JSON.stringify(currentSts));
            _this.expCurrentSts();
          }
        } else
        if (_this.currentSts.url === currentSts.url || _this.currentSts.sts === currentSts.sts) {
          currentSts = JSON.parse(JSON.stringify(_this.currentSts));
        }

        var onCurrentStsReady = function() {
          var onGetLinks = function(links, title, subtitles, duration) {
            cb({
              links: links,
              title: title,
              isQuick: 1
            });
          };
          _this.onGetConfig(
            message.extVideoId,
            message.checkSubtitles,
            onGetLinks,
            message.noDash,
            config,
            currentSts
          );
        };

        var testItem;
        if (!currentSts.actList && (testItem = _this.needDechiper(config))) {
          _this.prepareDechiper(testItem, currentSts, function() {
            if (currentSts.invalid) {
              return abort();
            }

            onCurrentStsReady();
          });
        } else {
          onCurrentStsReady();
        }
      });
    },

    /**
     * @private
     */
    ytRunActList: function(list, a) {
      var actionList = {
        slice: function(a, b) {
          a.slice(b)
        },
        splice: function(a, b) {
          a.splice(0, b)
        },
        reverse: function(a) {
          a.reverse()
        },
        swap: function(a, b) {
          var c = a[0];
          a[0] = a[b % a.length];
          a[b] = c
        }
      };
      a = a.split("");
      for (var i = 0, item; item = list[i]; i++) {
        actionList[item[0]](a, item[1]);
      }
      return a.join("");
    },

    /**
     * @private
     */
    ytHtml5SigDecipher: {
      readObfFunc: function(func, data) {
        var vList = func.match(/\[(\w+)\]/g);
        if (!vList) {
          return;
        }
        for (var i = 0, v; v = vList[i]; i++) {
          var vv = data.match(new RegExp('[, ]{1}' + v.slice(1, -1) + '="(\\w+)"'));
          if (vv) {
            func = func.replace(v, '.' + vv[1]);
          }
        }
        var arr = func.split(';');
        var actList = [];
        for (var i = 0, item; item = arr[i]; i++) {
          if (item.indexOf('.split(') !== -1 || item.indexOf('.join(') !== -1) {
            continue;
          }
          if (item.indexOf('reverse') !== -1) {
            actList.push(['reverse', null]);
            continue;
          }
          var m = item.match(/splice\((\d+)\)/);
          if (m) {
            m = parseInt(m[1]);
            if (isNaN(m)) return;
            actList.push(['splice', m]);
            continue;
          }
          var m = item.match(/slice\((\d+)\)/);
          if (m) {
            m = parseInt(m[1]);
            if (isNaN(m)) return;
            actList.push(['slice', m]);
            continue;
          }
          var m = item.match(/\[(\d+)%\w+\.length/);
          if (m) {
            m = parseInt(m[1]);
            if (isNaN(m)) return;
            actList.push(['swap', m]);
          }
        }
        return actList;
      },
      getChip: function(data, cb) {
        var sts = data.match(/,sts:(\d+)/);
        sts = sts && sts[1];

        var actList = [];
        var funcName = data.match(/\.sig\|\|([$_a-zA-Z0-9]+)\(/);
        if (!funcName) {
          return cb();
        }
        funcName = funcName[1];
        funcName = funcName.replace(/\$/g, '\\$');
        var func = data.match(new RegExp("((?:function " + funcName + "|(?:var |,|;\n)" + funcName + "=function)\\(([\\w$]+)\\){[^}]*})[;,]"));
        if (!func) {
          return cb();
        }
        var vName = func[2];
        func = func[1];
        var regexp = new RegExp("[\\w$]+\\.[\\w$]+\\(" + vName + "[^)]*\\)", 'g');
        var sFuncList = func.match(regexp);
        if (!sFuncList) {
          actList = this.readObfFunc(func, data);
          if (actList && actList.length > 0) {
            return cb(actList, sts);
          }
          return cb();
        }
        var objName = '';
        var objElList = [];
        for (var i = 0, item; item = sFuncList[i]; i++) {
          var m = item.match(/([\w$]+)\.([\w$]+)\([\w$]+,?([\w$]+)?\)/);
          if (m) {
            objName = m[1];
            objElList.push({
              name: m[2],
              arg: parseInt(m[3])
            });
          }
        }
        var sPos = data.indexOf('var ' + objName + '={');
        if (sPos === -1) {
          sPos = data.indexOf(',' + objName + '={');
        }
        if (sPos === -1) {
          sPos = data.indexOf(objName + '={');
        }
        var place = data.substr(sPos, 300);
        for (i = 0, item; item = objElList[i]; i++) {
          var vName = item.name;
          regexp = new RegExp(vName + ":(function\\([$\\w,]+\\){[^}]+})");
          var sF = place.match(regexp);
          if (!sF) {
            return cb();
          }
          sF = sF[1];
          if (sF.indexOf('splice') !== -1) {
            if (isNaN(item.arg)) {
              return cb();
            }
            actList.push(['splice', item.arg]);
          } else
          if (sF.indexOf('slice') !== -1) {
            if (isNaN(item.arg)) {
              return cb();
            }
            actList.push(['slice', item.arg]);
          } else
          if (sF.indexOf('reverse') !== -1) {
            item.arg = null;
            actList.push(['reverse', item.arg]);
          } else {
            if (isNaN(item.arg)) {
              return cb();
            }
            actList.push(['swap', item.arg]);
          }
        }
        cb(actList, sts);
      },
      getPlayer: function(message, cb) {
        var _this = this;
        if (message.url.substr(0, 2) === '//') {
          message.url = 'https:' + message.url;
        }

        return mono.request({
          url: message.url
        }, function(err, resp, data) {
          if (err || !data) {
            return cb();
          }

          return _this.getChip(data, cb);
        });
      },
      checkActList: function(sts, actList, url, cb) {
        var _this = this;
        return mono.request({
          type: 'HEAD',
          url: url
        }, function(err) {
          if (err) {
            return cb(0);
          }

          _this.addDechipList(sts, actList);
          return cb(1);
        });
      },
      storage: null,
      getDechipList: function(cb) {
        var _this = this;
        if (_this.storage) {
          return cb(_this.storage);
        }

        return mono.storage.get('ytDechipList', function(storage) {
          var stsObj = _this.storage = storage.ytDechipList || {};
          return cb(stsObj);
        });
      },
      addDechipList: function(sts, actList) {
        var _this = this;
        if (!sts) {
          return;
        }

        var lastSts = youtube_com_embed.lastSts;
        lastSts[0] = sts;
        lastSts[1] = actList;

        _this.storage[sts] = actList;

        Object.keys(_this.storage).sort(function(a, b) {
          return a < b ? 1 : -1
        }).slice(3).forEach(function(key) {
          delete _this.storage[key];
        });

        return mono.storage.set({
          ytDechipList: _this.storage
        });
      },
      /**
       * @param {{sts: Number, url: String}} message
       * @param {Function} cb
       */
      dechip: function(message, cb) {
        var _this = this;
        return _this.getDechipList(function(stsObj) {
          if (message.sts) {
            var actList = stsObj[message.sts];
            if (actList) {
              return cb(actList, parseInt(message.sts), 1);
            }
          }

          return _this.getPlayer(message, function(actList, sts) {
            if (actList && actList.length > 0) {
              return cb(actList, parseInt(sts));
            } else {
              return cb();
            }
          });
        });
      }
    },

    /**
     * @private
     */
    prepareLastSts: function(cb) {
      var _this = this;
      if (_this.prepareLastSts.ready) {
        return cb();
      }
      _this.prepareLastSts.ready = true;

      return mono.storage.get('ytDechipList', function(storage) {
        var stsObj = storage.ytDechipList = storage.ytDechipList || {};
        _this.ytHtml5SigDecipher.storage = stsObj;

        var lastSts = _this.lastSts;
        stsObj[lastSts[0]] = lastSts[1];

        var keys = Object.keys(stsObj).sort(function(a, b) {
          return a < b ? 1 : -1
        });

        if (lastSts[0] < keys[0]) {
          lastSts[0] = keys[0];
          lastSts[1] = stsObj[keys[0]];
        }

        return cb();
      });
    },

    /**
     * @private
     */
    getSignatureFromHtml: function(data, cb) {
      "use strict";
      var script = mono.getPageScript(data, /ytplayer\.config\s+=\s+/);
      if (!script.length) {
        return cb();
      }
      script = script[0];

      var jsonList = mono.findJson(script, [/"assets":/, /"sts":\d+/]);
      if (!jsonList.length) {
        return cb();
      }
      jsonList = jsonList[0];

      if (!jsonList.sts || !jsonList.assets || !jsonList.assets.js) {
        return cb();
      }

      return cb({
        sts: parseInt(jsonList.sts),
        url: jsonList.assets.js
      });
    },

    /**
     * @private
     */
    getCurrentSts: function(cb) {
      "use strict";
      var _this = this;
      return mono.request({
        url: 'https://www.youtube.com/'
      }, function(err, resp, data) {
        if (err || !data) {
          return cb();
        }

        _this.getSignatureFromHtml(data, cb);
      });
    }
  };

  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return youtube_com_embed;
    };
  } else {
    engine.modules.youtube = youtube_com_embed;
  }
  var facebook_com_embed = {
    getFacebookLinks: function(request, callback) {
      var callback_links = function(links, title, thumb, duration) {
        var response = {
          action: request.action,
          extVideoId: request.extVideoId,
          links: links || null,
          title: title || '',
          thumb: thumb || '',
          duration: duration || ''
        };

        callback(response);
      };

      facebook_com_embed._getFacebookLinks(request.extVideoId, callback_links);
    },

    _getFacebookLinks: function(videoId, cb) {
      mono.request({
        type: 'GET',
        url: 'https://www.facebook.com/video.php?v=' + videoId
      }, function(err, resp, data) {
        if (err || !data) {
          return cb();
        }

        facebook_com_embed.getLinksFromData(data, videoId, cb);
      });
    },
    getLinksFromData: function(data, videoId, cb) {
      "use strict";
      var match = data.match(/\["params","([^"]*)"\]/im);
      var mTitle = data.match(/<h2[^>]*>([^<]*)<\/h2>/im);
      if (!mTitle) {
        mTitle = ['', ''];
      }
      if (!match) {
        return this.getLinksFromData2(data, videoId, cb);
      }
      var videoData = null;
      try {
        videoData = JSON.parse(decodeURIComponent(JSON.parse('"' + match[1] + '"'))).video_data;
        if (videoData.progressive) {
          videoData = videoData.progressive;
        }
        if (!videoData) {
          return cb();
        }
      } catch (e) {
        return cb();
      }

      var thumb = null;
      var duration = null;

      var links = [];
      var typeMap = {
        sd_src: 'SD',
        hd_src: 'HD'
      };
      if (!Array.isArray(videoData)) {
        videoData = [videoData];
      }
      for (var i = 0, item; item = videoData[i]; i++) {
        ['sd_src', 'hd_src'].forEach(function(type) {
          if (item.thumbnail_src) {
            thumb = item.thumbnail_src;
          }

          if (item.video_duration) {
            duration = item.video_duration;
          }

          if (!item[type]) {
            return;
          }

          var ext = facebook_com_embed.getFileExtension(item[type], 'mp4');
          links.push({
            url: item[type],
            name: typeMap[type],
            type: ext,
            ext: ext.toUpperCase()
          });
        });
      }

      cb(links, mTitle[1], thumb, duration);
    },

    getLinksFromData2: function(data, videoId, cb) {
      "use strict";
      var title = data.match(/<h2[^>]*>([^<]*)<\/h2>/im);
      title = title && title[1];

      data = data.match(/"videoData":\[([^\]]+)\]/);
      data = data && data[1];

      if (!data) {
        return cb();
      }

      var jsonList = mono.findJson(data, [/"(sd|hd)_src":/, new RegExp(videoId)]);
      if (!jsonList || !jsonList.length) {
        return cb();
      }

      var params = jsonList[0];

      if (String(params.video_id) !== String(videoId)) {
        return cb();
      }

      var links = [];

      var ext;
      if (params.sd_src) {
        ext = facebook_com_embed.getFileExtension(params.sd_src, 'mp4');
        links.push({
          url: params.sd_src,
          name: 'SD',
          type: ext,
          ext: ext.toUpperCase()
        });
      }
      if (params.hd_src) {
        ext = facebook_com_embed.getFileExtension(params.hd_src, 'mp4');
        links.push({
          url: params.hd_src,
          name: 'HD',
          type: ext,
          ext: ext.toUpperCase()
        });
      }

      return cb(links, title, params.thumbnail_src, params.video_duration);
    },

    getFileExtension: function(str, def) {
      var ext = str.match(/\.([a-z0-9]{3,4})(\?|$)/i);
      if (ext) {
        ext = ext[1];
        return ext.toLowerCase();
      }

      return (def ? def : '');
    },

    getFacebookPhotoUrl: function(message, cb) {
      if (!message.fbid) {
        return cb();
      }
      mono.request({
        url: 'https://www.facebook.com/photo.php?fbid=' + message.fbid
      }, function(err, resp, data) {
        if (err || !data) {
          return cb();
        }

        var m = data.match(/<a[^>]+fbPhotosPhotoActionsItem[^>]+href="([^">]+dl=1)"[^>]+>/i);
        if (m) {
          var url = m[1];
          url = url.replace(/&amp;/g, '&');
          return cb(url);
        }

        return cb();
      });
    }
  };

  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return facebook_com_embed;
    };
  } else {
    engine.modules.facebook = facebook_com_embed;
  }
  var mail_ru_embed = {
    getMailruLinks: function(request, callback) {
      function callback_links(links, title, thumb, vid, duration) {
        var response = {
          action: request.action,
          extVideoId: vid || request.extVideoId,
          links: links,
          title: title,
          thumb: thumb,
          duration: duration
        };

        callback(response);
      }

      mail_ru_embed._getMailruLinks(request.extVideoId, callback_links);
    },
    _getMailruLinks: function(pathname, callback) {
      "use strict";
      var metadataUrl, vPath = pathname;
      var videoId = pathname.match(/\/([^\/]+)\/([^\/]+)\/video\/(.+).html/);
      if (!videoId) {
        videoId = pathname.match(/embed\/([^\/]+)\/([^\/]+)\/(.+).html/);
      }
      if (videoId) {
        metadataUrl = 'http://api.video.mail.ru/videos/' + videoId[1] + '/' + videoId[2] + '/' + videoId[3] + '.json';
        vPath = videoId[1] + '/' + videoId[2] + '/video/' + videoId[3] + '.html';
      }
      if (metadataUrl) {
        return mail_ru_embed.onGetMailruMetadataUrl(metadataUrl, vPath, callback);
      }
      mono.request({
        url: 'http://my.mail.ru/' + pathname
      }, function(err, resp, data) {
        if (err || !data) {
          return callback();
        }

        var jsonRe = /"metaUrl":/;
        var pageConfig = null;
        mono.getPageScript(data, jsonRe).some(function(script) {
          return mono.findJson(script, jsonRe).some(function(json) {
            if (json.metaUrl) {
              pageConfig = json;
              return true;
            }
          });
        });

        if (pageConfig) {
          metadataUrl = pageConfig.metaUrl;
          mail_ru_embed.onGetMailruMetadataUrl(metadataUrl, vPath, callback);
          return;
        }

        data = data.match(/<meta\s+content="[^"]+(videoapi\.my\.mail[^&]+)&[^"]+"[^>]+\/>/);
        if (!data) {
          return callback();
        }
        data = decodeURIComponent(data[1]);
        var vid = data.substr(data.lastIndexOf('/') + 1);
        metadataUrl = 'http://videoapi.my.mail.ru/videos/' + vid + '.json';
        mail_ru_embed.onGetMailruMetadataUrl(metadataUrl, vPath, callback);
      });
    },
    onGetMailruMetadataUrl: function(metadataUrl, vPath, callback) {
      mail_ru_embed.getMailruMetadata(metadataUrl, function(data) {
        if (!data || typeof data === 'string') {
          return callback();
        }
        mail_ru_embed.readMailruMetadata(data, function(_links, title, thumb, duration) {
          callback(mail_ru_embed.prepMailruLinks(_links), title, thumb, vPath, duration);
        });
      });
    },
    prepMailruLinks: function(_links) {
      if (!_links) {
        return;
      }
      var links = [];
      for (var i = 0, link; link = _links[i]; i++) {
        var url = link.url;
        var format = 'FLV';
        if (url.indexOf('.mp4') !== -1) {
          format = 'MP4';
        }
        if (url.indexOf('.mov') !== -1) {
          format = 'MOV';
        }
        if (url.indexOf('.mpg') !== -1) {
          format = 'MPG';
        }
        if (!link.quality) {
          link.quality = '-?-';
        }
        var quality = link.quality.toUpperCase();

        var qList = ['1080P', '720P', '480P', '360P', '272P'];
        var tList = ['1080', '720', '480', '360', '272'];

        var qPos = qList.indexOf(quality);
        if (qPos !== -1) {
          quality = tList[qPos];
        }

        var ext = format.toLowerCase();
        links.push({
          url: url,
          subname: quality,
          name: format,
          ext: ext
        });
      }
      links.sort(function(a, b) {
        if (a.subname === 'HD') {
          return 1;
        }
        return a.subname > b.subname;
      });
      return links;
    },
    getMailruMetadata: function(url, cb) {
      if (!url) {
        return cb();
      }
      mono.request({
        url: url,
        json: true
      }, function(err, resp, json) {
        if (err || !json) {
          return cb();
        }

        cb(json);
      });
    },
    readMailruMetadata: function(metadata, cb) {
      var links = [],
        title;
      /**
       * @namespace metadata.provider Object
       * @namespace metadata.movie Object
       * @namespace metadata.videos Object
       * @namespace metadata.meta Object
       * @namespace metadata.meta.poster Object
       */
      var duration = undefined;
      var thumb = undefined;
      if (metadata.meta) {
        thumb = metadata.meta.poster;
        duration = metadata.meta.duration;
      }
      if (metadata.provider === 'UPLOADED') {
        title = metadata.movie ? metadata.movie.title : undefined;
        if (!metadata.videos) {
          return cb();
        }
        metadata.videos.forEach(function(item) {
          links.push({
            quality: item.name,
            url: item.url,
            title: title
          });
        });
      } else
      if (metadata.provider === 'ugc') {
        title = metadata.meta ? metadata.meta.title : undefined;
        if (!metadata.videos) {
          return cb();
        }
        metadata.videos.forEach(function(item) {
          links.push({
            quality: item.key,
            url: item.url,
            title: title
          });
        });
      } else
      if (metadata.provider === 'pladform') {
        title = metadata.meta ? metadata.meta.title : undefined;
        var okEmbed = engine.modules.odnoklassniki;
        okEmbed.getPladformVideo({
          extVideoId: {
            playerId: metadata.meta.playerId,
            videoId: metadata.meta.videoId
          }
        }, function(response) {
          if (!response) {
            return cb();
          }

          if (response.action === 'getRutubeLinks') {
            response.links = null;
          }

          var links = response.links;
          if (!links) {
            return cb();
          }
          links.forEach(function(item) {
            if (item.title === undefined) {
              item.title = title
            }
          });
          cb(links, title, thumb, duration);
        });
        return;
      }
      if (links.length === 0) {
        return cb();
      }
      return cb(links, title, thumb, duration);
    }
  };

  if (typeof window === 'undefined') {
    exports.init = function(_mono, _engine) {
      mono = _mono;
      engine = _engine;
      return mail_ru_embed;
    };
  } else {
    engine.modules.mail_ru = mail_ru_embed;
  }
  var SaveFrom_Utils = {
    downloadParam: 'sfh--download',

    setStyle: function(node, style) {
      if (!node || !style)
        return;

      for (var i in style)
        node.style[i] = style[i];
    },


    getStyle: function(node, property) {
      return node && window.getComputedStyle && window.getComputedStyle(node, null).getPropertyValue(property);
    },

    addStyleRules: function(selector, rules, className) {
      var style = className ? document.querySelector('#savefrom-styles.' + className) : document.getElementById('savefrom-styles');
      if (!style) {
        style = document.createElement('style');
        style.id = 'savefrom-styles';
        if (className) {
          style.classList.add(className);
        }
        // maybe need for safari
        //style.appendChild(document.createTextNode(""));
        var s = document.querySelector('head style');
        if (s)
        // allow to override our styles
          s.parentNode.insertBefore(style, s);
        else
          document.querySelector('head').appendChild(style);
      }

      if (typeof(rules) == 'object') {
        var r = [];
        for (var i in rules)
          r.push(i + ':' + rules[i]);

        rules = r.join(';');
      }

      style.textContent += selector + '{' + rules + '}';
    },

    getPosition: function(node, parent) {
      var box = node.getBoundingClientRect();

      if (parent) {
        var parent_pos = parent.getBoundingClientRect();
        return {
          top: Math.round(box.top - parent_pos.top),
          left: Math.round(box.left - parent_pos.left),
          width: box.width,
          height: box.height
        }
      }
      return {
        top: Math.round(box.top + window.pageYOffset),
        left: Math.round(box.left + window.pageXOffset),
        width: box.width,
        height: box.height
      }
    },

    getSize: function(node) {
      return {
        width: node.offsetWidth,
        height: node.offsetHeight
      };
    },

    getMatchFirst: function(str, re) {
      var m = str.match(re);
      if (m && m.length > 1)
        return m[1];

      return '';
    },

    getElementByIds: function(ids) {
      for (var i = 0; i < ids.length; i++) {
        var node = document.getElementById(ids[i]);
        if (node)
          return node;
      }

      return null;
    },

    getParentByClass: function(node, name) {
      if (!node || name == '') {
        return false;
      }

      var parent;
      if (typeof name === 'object' && name.length > 0) {
        for (parent = node; parent; parent = parent.parentNode) {
          if (parent.nodeType !== 1) {
            return null;
          }
          for (var i = 0; i < name.length; i++) {
            if (parent.classList.contains(name[i])) {
              return parent;
            }
          }
        }
      } else {
        for (parent = node; parent; parent = parent.parentNode) {
          if (parent.nodeType !== 1) {
            return null;
          }
          if (parent.classList.contains(name)) {
            return parent;
          }
        }
      }

      return null;
    },

    getParentByTagName: function(node, tagName) {
      if (!node || !tagName) {
        return false;
      }

      for (var parent = node; parent; parent = parent.parentNode) {
        if (parent.nodeType !== 1) {
          return null;
        }

        if (parent.tagName === tagName) {
          return parent;
        }
      }

      return null;
    },

    getParentById: function(node, id) {
      for (var parent = node; parent; parent = parent.parentNode) {
        if (parent.nodeType !== 1) {
          return null;
        }

        if (parent.id === id) {
          return parent;
        }
      }

      return null;
    },

    hasChildrenTagName: function(node, tagName) {
      for (var i = 0, item; item = node.childNodes[i]; i++) {
        if (item.nodeType !== 1) {
          continue;
        }
        if (item.tagName === tagName) {
          return true;
        }
      }
      return false;
    },

    isParent: function(node, testParent) {
      if (!testParent || [1, 9, 11].indexOf(testParent.nodeType) === -1) {
        return false;
      }

      return testParent.contains(node);
    },


    emptyNode: function(node) {
      while (node.firstChild)
        node.removeChild(node.firstChild);
    },

    download: function(filename, url, requestOptions, callback) {
      if (!url)
        return false;

      filename = filename || this.getFileName(url);
      if (!filename)
        return false;

      if (!mono.global.preference.downloads) {
        return false;
      }

      var params = requestOptions || {};
      params.url = url;
      params.filename = filename;

      var request = {
        action: 'downloadFile',
        options: params
      };

      callback = callback || undefined;

      mono.sendMessage(request, callback);
      return true;
    },

    downloadList: {
      showDownloadWarningPopup: function(onContinue, type) {
        var template = SaveFrom_Utils.playlist.getInfoPopupTemplate();

        mono.sendMessage({
          action: 'getWarningIcon',
          type: type
        }, function(icon) {
          template.icon.style.backgroundImage = 'url(' + icon + ')';
        });

        mono.create(template.textContainer, {
          append: [
            mono.create('p', {
              text: mono.global.language.warningPopupTitle,
              style: {
                color: '#0D0D0D',
                fontSize: '20px',
                marginBottom: '11px',
                marginTop: '13px'
              }
            }),
            mono.create('p', {
              text: mono.global.language.warningPopupDesc + ' ',
              style: {
                color: '#868686',
                fontSize: '14px',
                marginBottom: '13px',
                lineHeight: '24px',
                marginTop: '0px'
              },
              append: mono.create('a', {
                href: (mono.global.language.lang === 'ru' || mono.global.language.lang === 'uk') ? 'http://vk.com/page-55689929_49003549' : 'http://vk.com/page-55689929_49004259',
                text: mono.global.language.readMore,
                target: '_blank',
                style: {
                  color: '#4A90E2'
                }
              })
            }),
            mono.create('p', {
              style: {
                marginBottom: '13px'
              },
              append: [
                mono.create('label', {
                  style: {
                    color: '#868686',
                    cursor: 'pointer',
                    fontSize: '14px',
                    lineHeight: '19px'
                  },
                  append: [
                    mono.create('input', {
                      type: 'checkbox',
                      style: {
                        cssFloat: 'left',
                        marginLeft: '0px'
                      },
                      on: ['click', function() {
                        mono.sendMessage({
                          action: 'hideDownloadWarning',
                          set: this.checked ? 1 : 0
                        });
                      }]
                    }),
                    mono.global.language.noWarning
                  ]
                })
              ]
            })
          ]
        });

        var cancelBtn = undefined;
        var continueBtn = undefined;
        mono.create(template.buttonContainer, {
          append: [
            cancelBtn = mono.create('button', {
              text: mono.global.language.cancel,
              style: {
                height: '27px',
                width: '118px',
                backgroundColor: '#ffffff',
                border: '1px solid #9e9e9e',
                margin: '12px',
                marginBottom: '11px',
                marginRight: '4px',
                borderRadius: '5px',
                fontSize: '14px',
                cursor: 'pointer'
              }
            }),
            continueBtn = mono.create('button', {
              text: mono.global.language.continue,
              style: {
                height: '27px',
                width: '118px',
                backgroundColor: '#ffffff',
                border: '1px solid #9e9e9e',
                margin: '12px',
                marginBottom: '11px',
                marginRight: '8px',
                borderRadius: '5px',
                fontSize: '14px',
                cursor: 'pointer'
              }
            })
          ]
        });

        cancelBtn.addEventListener('click', function(e) {
          var popup = template.body.parentNode;
          mono.trigger(popup.lastChild, 'click');
        });

        continueBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();

          onContinue();
          mono.trigger(cancelBtn, 'click');
        });

        SaveFrom_Utils.popupDiv(template.body, 'dl_warning_box_popup');
      },
      startChromeDownloadList: function(options) {
        var folderName = options.folderName;
        var linkList = options.list;


        if (folderName) {
          folderName += '/';
        }

        return mono.sendMessage({
          action: 'downloadList',
          fileList: linkList,
          folder: folderName
        });
      },
      startOldChromeDownloadList: function(options, hideDialog) {
        var folderName = options.folderName;
        var linkList = options.list;
        var dataType = options.type;

        if (folderName) {
          folderName += '/';
        }

        var itemIndex = 0;
        var pause = false;
        var timeout = 500;

        var focusEl = document.body;

        focusEl.focus();

        if (!hideDialog) {
          focusEl.onblur = function() {
            pause = true;
          };
        }

        var nextOneFile = function() {
          var item = linkList[itemIndex];
          itemIndex++;

          if (item === undefined) {
            return;
          }

          if (mono.global.preference.downloads) {
            SaveFrom_Utils.download(folderName + item.filename, item.url);
          } else {
            mono.trigger(mono.create('a', {
              download: item.filename,
              href: item.url,
              on: ['click', function(e) {
                SaveFrom_Utils.downloadOnClick(e);
              }]
            }), 'click', {
              cancelable: true
            });
          }

          if (pause) {
            SaveFrom_Utils.downloadList.showDownloadWarningPopup(function() {
              pause = false;
              focusEl.focus();
              nextOneFile();
            }, dataType);
          } else {
            if (itemIndex > 5 && timeout) {
              timeout = undefined;
              focusEl.onblur = undefined;
              pause = false;
              if (mono.global.preference.downloads) {
                mono.sendMessage({
                  action: 'downloadList',
                  fileList: linkList.slice(itemIndex),
                  folder: folderName
                });
                return;
              }
            }

            setTimeout(function() {
              nextOneFile();
            }, timeout);
          }
        };

        nextOneFile();
      },
      startFfDownloadList: function(linkList, folderName) {
        mono.sendMessage({
          action: 'downloadList',
          fileList: linkList,
          folder: folderName
        }, null, 'service');
      },
      startDownload: function(options) {
        options.list.forEach(function(item) {
          item.filename = mono.fileName.modify(item.filename);
        });

        options.folderName = mono.fileName.modify(options.folderName);

        if (mono.isFF) {
          return SaveFrom_Utils.downloadList.startFfDownloadList(options.list, options.folderName);
        } else
        if (mono.isChrome && mono.global.preference.downloads) {
          return SaveFrom_Utils.downloadList.startChromeDownloadList(options);
        } else
        if (mono.isGM || mono.isSafari) {
          return mono.sendMessage({
            action: 'hideDownloadWarning'
          }, function(state) {
            SaveFrom_Utils.downloadList.startOldChromeDownloadList(options, state);
          });
        }
      },
      showBeforeDownloadPopup: function(list, options) {
        options.list = list;
        var type = options.type;
        var folderName = options.folderName;
        var onContinue = options.onContinue || SaveFrom_Utils.downloadList.startDownload;
        var onShowList = options.onShowList || SaveFrom_Utils.playlist.popupFilelist;
        var count = options.count || list.length;
        var template = SaveFrom_Utils.playlist.getInfoPopupTemplate();

        mono.sendMessage({
          action: 'getWarningIcon',
          color: '#00CCFF',
          type: type
        }, function(icon) {
          template.icon.style.backgroundImage = 'url(' + icon + ')';
        });

        var showListLink = [];
        if (onShowList) {
          showListLink = [' (', mono.create('a', {
            href: '#',
            text: mono.global.language.vkListOfLinks.toLowerCase()
          }), ')'];
          showListLink[1].addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            onShowList(options.list);
            mono.trigger(cancelBtn, 'click');
          });
        }

        mono.create(template.textContainer, {
          append: [
            mono.create('p', {
              text: folderName || mono.global.language.playlistTitle,
              style: {
                color: '#0D0D0D',
                fontSize: '20px',
                marginBottom: '11px',
                marginTop: '13px'
              }
            }),
            mono.create('p', {
              text: mono.global.language.vkFoundFiles.replace('%d', count),
              style: {
                color: '#868686',
                fontSize: '14px',
                marginBottom: '13px',
                lineHeight: '24px',
                marginTop: '0px'
              },
              append: showListLink
            }),
            mono.create('p', {
              text: mono.global.language.beforeDownloadPopupWarn,
              style: {
                color: '#868686',
                fontSize: '14px',
                marginBottom: '13px',
                lineHeight: '24px',
                marginTop: '0px'
              }
            })
          ]
        });

        var cancelBtn = undefined;
        var dlBtn = undefined;
        mono.create(template.buttonContainer, {
          append: [
            cancelBtn = mono.create('button', {
              text: mono.global.language.cancel,
              style: {
                height: '27px',
                width: '118px',
                backgroundColor: '#ffffff',
                border: '1px solid #9e9e9e',
                margin: '12px',
                marginBottom: '11px',
                marginRight: '4px',
                borderRadius: '5px',
                fontSize: '14px',
                cursor: 'pointer'
              }
            }),
            dlBtn = mono.create('button', {
              text: mono.global.language.continue,
              style: {
                height: '27px',
                width: '118px',
                backgroundColor: '#ffffff',
                border: '1px solid #9e9e9e',
                margin: '12px',
                marginBottom: '11px',
                marginRight: '8px',
                borderRadius: '5px',
                fontSize: '14px',
                cursor: 'pointer'
              }
            })
          ]
        });

        cancelBtn.addEventListener('click', function(e) {
          var popup = template.body.parentNode;
          mono.trigger(popup.lastChild, 'click');
        });

        dlBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();

          onContinue(options);
          mono.trigger(cancelBtn, 'click');
        });

        SaveFrom_Utils.popupDiv(template.body, 'dl_confirm_box_popup');
      }
    },

    downloadLink: function(a, callback) {
      if (!a.href)
        return false;

      var filename = a.getAttribute('download');

      return this.download(filename, a.href, null, callback);
    },

    safariDlLink: function(e) {
      "use strict";
      if (e.button || e.ctrlKey || e.altKey || e.shitfKey) {
        return;
      }

      var me = null;

      var legacy = function(e) {
        var me = document.createEvent('MouseEvents');
        me.initMouseEvent('click', true, e.cancelable, window, 0,
          e.screenX, e.screenY, e.clientX, e.clientY,
          false, true, false, e.metaKey, e.button, e.relatedTarget);
        return me;
      };

      try {
        if (typeof MouseEvent !== 'function') {
          throw 'legacy';
        }
        me = new MouseEvent('click', {
          bubbles: true,
          cancelable: e.cancelable,
          screenX: e.screenX,
          screenY: e.screenY,
          clientX: e.clientX,
          clientY: e.clientY,
          ctrlKey: false,
          altKey: true,
          shiftKey: false,
          metaKey: e.metaKey,
          button: e.button,
          relatedTarget: e.relatedTarget
        });
      } catch (err) {
        me = legacy(e);
      }

      e.preventDefault();
      e.stopPropagation();

      this.dispatchEvent(me);
    },

    downloadOnClick: function(event, callback, options) {
      options = options || {};
      var _this = SaveFrom_Utils;

      var node = options.el || event.target;
      if (node.tagName !== 'A') {
        node = mono.getParent(node, 'A');
      }

      if (!node) {
        return;
      }

      if (mono.isSafari) {
        return _this.safariDlLink.call(node, event);
      }

      if (!mono.global.preference.downloads) {
        return;
      }

      if (mono.isGM && /^blob:|^data:/.test(node.href)) {
        return;
      }

      if (event.button === 2) {
        return;
      }

      event.preventDefault();
      event.stopPropagation();

      _this.downloadLink(node, callback);
    },

    getQueryString: function(query, key_prefix, key_suffix) {
      if (!query || typeof(query) != 'object')
        return '';

      if (key_prefix === undefined)
        key_prefix = '';

      if (key_suffix === undefined)
        key_suffix = '';

      var str = '';
      for (var key in query) {
        if (str.length)
          str += '&';

        if (query[key] instanceof Object) {
          if (!key_prefix)
            key_prefix = '';

          if (!key_suffix)
            key_suffix = '';

          str += SaveFrom_Utils.getQueryString(query[key], key_prefix + key + "[", "]" + key_suffix);
        } else
          str += key_prefix + escape(key) + key_suffix + '=' + escape(query[key]);
      }

      return str;
    },

    md5: function(str) {
      // http://kevin.vanzonneveld.net
      // +   original by: Webtoolkit.info (http://www.webtoolkit.info/)
      // + namespaced by: Michael White (http://getsprink.com)
      // +    tweaked by: Jack
      // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
      // +      input by: Brett Zamir (http://brett-zamir.me)
      // +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
      // -    depends on: utf8_encode
      // *     example 1: md5('Kevin van Zonneveld');
      // *     returns 1: '6e658d4bfcb59cc13f96c14450ac40b9'
      var xl;

      var rotateLeft = function(lValue, iShiftBits) {
        return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits));
      };

      var addUnsigned = function(lX, lY) {
        var lX4, lY4, lX8, lY8, lResult;
        lX8 = (lX & 0x80000000);
        lY8 = (lY & 0x80000000);
        lX4 = (lX & 0x40000000);
        lY4 = (lY & 0x40000000);
        lResult = (lX & 0x3FFFFFFF) + (lY & 0x3FFFFFFF);
        if (lX4 & lY4) {
          return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
        }
        if (lX4 | lY4) {
          if (lResult & 0x40000000) {
            return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
          } else {
            return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
          }
        } else {
          return (lResult ^ lX8 ^ lY8);
        }
      };

      var _F = function(x, y, z) {
        return (x & y) | ((~x) & z);
      };
      var _G = function(x, y, z) {
        return (x & z) | (y & (~z));
      };
      var _H = function(x, y, z) {
        return (x ^ y ^ z);
      };
      var _I = function(x, y, z) {
        return (y ^ (x | (~z)));
      };

      var _FF = function(a, b, c, d, x, s, ac) {
        a = addUnsigned(a, addUnsigned(addUnsigned(_F(b, c, d), x), ac));
        return addUnsigned(rotateLeft(a, s), b);
      };

      var _GG = function(a, b, c, d, x, s, ac) {
        a = addUnsigned(a, addUnsigned(addUnsigned(_G(b, c, d), x), ac));
        return addUnsigned(rotateLeft(a, s), b);
      };

      var _HH = function(a, b, c, d, x, s, ac) {
        a = addUnsigned(a, addUnsigned(addUnsigned(_H(b, c, d), x), ac));
        return addUnsigned(rotateLeft(a, s), b);
      };

      var _II = function(a, b, c, d, x, s, ac) {
        a = addUnsigned(a, addUnsigned(addUnsigned(_I(b, c, d), x), ac));
        return addUnsigned(rotateLeft(a, s), b);
      };

      var convertToWordArray = function(str) {
        var lWordCount;
        var lMessageLength = str.length;
        var lNumberOfWords_temp1 = lMessageLength + 8;
        var lNumberOfWords_temp2 = (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;
        var lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;
        var lWordArray = new Array(lNumberOfWords - 1);
        var lBytePosition = 0;
        var lByteCount = 0;
        while (lByteCount < lMessageLength) {
          lWordCount = (lByteCount - (lByteCount % 4)) / 4;
          lBytePosition = (lByteCount % 4) * 8;
          lWordArray[lWordCount] = (lWordArray[lWordCount] | (str.charCodeAt(lByteCount) << lBytePosition));
          lByteCount++;
        }
        lWordCount = (lByteCount - (lByteCount % 4)) / 4;
        lBytePosition = (lByteCount % 4) * 8;
        lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
        lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
        lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;
        return lWordArray;
      };

      var wordToHex = function(lValue) {
        var wordToHexValue = "",
          wordToHexValue_temp = "",
          lByte, lCount;
        for (lCount = 0; lCount <= 3; lCount++) {
          lByte = (lValue >>> (lCount * 8)) & 255;
          wordToHexValue_temp = "0" + lByte.toString(16);
          wordToHexValue = wordToHexValue + wordToHexValue_temp.substr(wordToHexValue_temp.length - 2, 2);
        }
        return wordToHexValue;
      };

      var x = [],
        k, AA, BB, CC, DD, a, b, c, d, S11 = 7,
        S12 = 12,
        S13 = 17,
        S14 = 22,
        S21 = 5,
        S22 = 9,
        S23 = 14,
        S24 = 20,
        S31 = 4,
        S32 = 11,
        S33 = 16,
        S34 = 23,
        S41 = 6,
        S42 = 10,
        S43 = 15,
        S44 = 21;

      //str = this.utf8_encode(str);
      x = convertToWordArray(str);
      a = 0x67452301;
      b = 0xEFCDAB89;
      c = 0x98BADCFE;
      d = 0x10325476;

      xl = x.length;
      for (k = 0; k < xl; k += 16) {
        AA = a;
        BB = b;
        CC = c;
        DD = d;
        a = _FF(a, b, c, d, x[k + 0], S11, 0xD76AA478);
        d = _FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
        c = _FF(c, d, a, b, x[k + 2], S13, 0x242070DB);
        b = _FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
        a = _FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
        d = _FF(d, a, b, c, x[k + 5], S12, 0x4787C62A);
        c = _FF(c, d, a, b, x[k + 6], S13, 0xA8304613);
        b = _FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
        a = _FF(a, b, c, d, x[k + 8], S11, 0x698098D8);
        d = _FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
        c = _FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
        b = _FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
        a = _FF(a, b, c, d, x[k + 12], S11, 0x6B901122);
        d = _FF(d, a, b, c, x[k + 13], S12, 0xFD987193);
        c = _FF(c, d, a, b, x[k + 14], S13, 0xA679438E);
        b = _FF(b, c, d, a, x[k + 15], S14, 0x49B40821);
        a = _GG(a, b, c, d, x[k + 1], S21, 0xF61E2562);
        d = _GG(d, a, b, c, x[k + 6], S22, 0xC040B340);
        c = _GG(c, d, a, b, x[k + 11], S23, 0x265E5A51);
        b = _GG(b, c, d, a, x[k + 0], S24, 0xE9B6C7AA);
        a = _GG(a, b, c, d, x[k + 5], S21, 0xD62F105D);
        d = _GG(d, a, b, c, x[k + 10], S22, 0x2441453);
        c = _GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
        b = _GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
        a = _GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
        d = _GG(d, a, b, c, x[k + 14], S22, 0xC33707D6);
        c = _GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
        b = _GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
        a = _GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
        d = _GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
        c = _GG(c, d, a, b, x[k + 7], S23, 0x676F02D9);
        b = _GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
        a = _HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
        d = _HH(d, a, b, c, x[k + 8], S32, 0x8771F681);
        c = _HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
        b = _HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
        a = _HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
        d = _HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
        c = _HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
        b = _HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
        a = _HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
        d = _HH(d, a, b, c, x[k + 0], S32, 0xEAA127FA);
        c = _HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
        b = _HH(b, c, d, a, x[k + 6], S34, 0x4881D05);
        a = _HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
        d = _HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
        c = _HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
        b = _HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
        a = _II(a, b, c, d, x[k + 0], S41, 0xF4292244);
        d = _II(d, a, b, c, x[k + 7], S42, 0x432AFF97);
        c = _II(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
        b = _II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
        a = _II(a, b, c, d, x[k + 12], S41, 0x655B59C3);
        d = _II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
        c = _II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
        b = _II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
        a = _II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
        d = _II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
        c = _II(c, d, a, b, x[k + 6], S43, 0xA3014314);
        b = _II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
        a = _II(a, b, c, d, x[k + 4], S41, 0xF7537E82);
        d = _II(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
        c = _II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
        b = _II(b, c, d, a, x[k + 9], S44, 0xEB86D391);
        a = addUnsigned(a, AA);
        b = addUnsigned(b, BB);
        c = addUnsigned(c, CC);
        d = addUnsigned(d, DD);
      }

      var temp = wordToHex(a) + wordToHex(b) + wordToHex(c) + wordToHex(d);

      return temp.toLowerCase();
    },


    decodeUnicodeEscapeSequence: function(text) {
      return text.replace(/\\u([0-9a-f]{4})/g, function(s, m) {
        m = parseInt(m, 16);
        if (!isNaN(m)) {
          return String.fromCharCode(m);
        }
      });
    },


    getFileExtension: function(str, def) {
      var ext = this.getMatchFirst(str, /\.([a-z0-9]{3,4})(\?|$)/i);
      if (ext)
        return ext.toLowerCase();

      return (def ? def : '');
    },


    getFileName: function(url) {
      var filename = this.getMatchFirst(url, /\/([^\?#\/]+\.[a-z\d]{2,6})(?:\?|#|$)/i);
      if (!filename)
        return filename;

      return mono.fileName.modify(filename);
    },


    getTopLevelDomain: function(domain) {
      if (!domain)
        return '';

      if (!domain.match(/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}/))
        return domain;

      var a = domain.split('.');
      var l = a.length;

      if (l == 2)
        return domain;

      return (a[l - 2] + '.' + a[l - 1]);
    },


    dateToObj: function(ts, leadingZero) {
      var d = (ts === null || ts === undefined) ? new Date() : new Date(ts);

      if (leadingZero === undefined)
        leadingZero = true;

      var res = {
        year: d.getFullYear(),
        month: (d.getMonth() + 1),
        day: d.getDate(),
        hour: d.getHours(),
        min: d.getMinutes(),
        sec: d.getSeconds()
      };

      if (leadingZero) {
        for (var i in res) {
          if (res[i].toString().length == 1)
            res[i] = '0' + res[i];
        }
      }

      return res;
    },


    utf8Encode: function(str) {
      str = str.replace(/\r\n/g, "\n");
      var res = "";

      for (var n = 0; n < str.length; n++) {
        var c = str.charCodeAt(n);

        if (c < 128)
          res += String.fromCharCode(c);
        else if ((c > 127) && (c < 2048)) {
          res += String.fromCharCode((c >> 6) | 192);
          res += String.fromCharCode((c & 63) | 128);
        } else {
          res += String.fromCharCode((c >> 12) | 224);
          res += String.fromCharCode(((c >> 6) & 63) | 128);
          res += String.fromCharCode((c & 63) | 128);
        }

      }

      return res;
    },

    sizeHuman: function(size, round) {
      if (round == undefined || round == null)
        round = 2;

      var s = size,
        count = 0,
        sign = '',
        unite_spec = [
          mono.global.language.vkFileSizeByte,
          mono.global.language.vkFileSizeKByte,
          mono.global.language.vkFileSizeMByte,
          mono.global.language.vkFileSizeGByte,
          mono.global.language.vkFileSizeTByte
        ];

      if (s < 0) {
        sign = '-';
        s = Math.abs(s);
      }

      while (s >= 1000) {
        count++;
        s /= 1024;
      }

      if (round >= 0) {
        var m = round * 10;
        s = Math.round(s * m) / m;
      }

      if (count < unite_spec.length)
        return sign + s + ' ' + unite_spec[count];

      return size;
    },

    secondsToDuration: function(seconds) {
      if (!seconds || isNaN(seconds))
        return '';

      function zfill(time) {
        if (time < 10)
          return '0' + time;

        return time.toString();
      }

      var hours = Math.floor(seconds / 3600);
      seconds %= 3600;

      var minutes = Math.floor(seconds / 60);
      seconds %= 60;

      if (hours > 0)
        return hours + ":" + zfill(minutes) + ":" + zfill(seconds);

      return minutes + ":" + zfill(seconds);
    },

    svg: {
      icon: {
        download: 'M 4,0 4,8 0,8 8,16 16,8 12,8 12,0 4,0 z',
        info: 'M 8,1.55 C 11.6,1.55 14.4,4.44 14.4,8 14.4,11.6 11.6,14.4 8,14.4 4.44,14.4 1.55,11.6 1.55,8 1.55,4.44 4.44,1.55 8,1.55 M 8,0 C 3.58,0 0,3.58 0,8 0,12.4 3.58,16 8,16 12.4,16 16,12.4 16,8 16,3.58 12.4,0 8,0 L 8,0 z M 9.16,12.3 H 6.92 V 7.01 H 9.16 V 12.3 z M 8.04,5.91 C 7.36,5.91 6.81,5.36 6.81,4.68 6.81,4 7.36,3.45 8.04,3.45 8.72,3.45 9.27,4 9.27,4.68 9.27,5.36 8.72,5.91 8.04,5.91 z',
        noSound: 'M 11.4,5.05 13,6.65 14.6,5.05 16,6.35 14.4,7.95 16,9.55 14.6,11 13,9.35 11.4,11 10,9.55 11.6,7.95 10,6.35 z M 8,1.75 8,14.3 4,10.5 l -4,0 0,-4.75 4,0 z'
      },

      cache: {},

      getSrc: function(icon, color) {
        if (!this.icon[icon])
          return '';

        if (!this.cache[icon])
          this.cache[icon] = {};

        if (!this.cache[icon][color]) {
          this.cache[icon][color] = btoa(
            '<?xml version="1.0" encoding="UTF-8"?>' +
            '<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16" viewBox="0 0 16 16" id="svg2" xml:space="preserve">' +
            '<path d="' + this.icon[icon] + '" fill="' + color + '" /></svg>'
          );
        }

        if (this.cache[icon][color])
          return 'data:image/svg+xml;base64,' + this.cache[icon][color];

        return '';
      },

      getSvg: function(icon, color, width, height) {
        var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        var svgNS = svg.namespaceURI;
        svg.setAttribute('width', width || '16');
        svg.setAttribute('height', height || '16');
        svg.setAttribute('viewBox', '0 0 16 16');

        var path = document.createElementNS(svgNS, 'path');
        svg.appendChild(path);
        path.setAttribute('d', this.icon[icon]);

        if (color) {
          path.setAttribute('fill', color);
        }

        return svg;
      }
    },

    appendDownloadInfo: function(parent, color, boxStyle, btnStyle) {
      if (!color)
        color = '#a0a0a0';

      var info = document.createElement('span');
      info.appendChild(document.createTextNode(mono.global.language.downloadTitle));
      this.setStyle(info, {
        display: 'inline-block',
        position: 'relative',
        border: '1px solid ' + color,
        borderRadius: '5px',
        fontSize: '13px',
        lineHeight: '17px',
        padding: '2px 19px 2px 5px',
        marginTop: '5px',
        opacity: 0.9
      });

      if (boxStyle)
        this.setStyle(info, boxStyle);

      var close = document.createElement('span');
      close.textContent = String.fromCharCode(215);
      this.setStyle(close, {
        color: color,
        width: '14px',
        height: '14px',
        fontSize: '14px',
        fontWeight: 'bold',
        lineHeight: '14px',
        position: 'absolute',
        top: 0,
        right: 0,
        overflow: 'hidden',
        cursor: 'pointer'
      });

      if (btnStyle)
        this.setStyle(close, btnStyle);

      close.addEventListener('click', function() {
        info.parentNode.removeChild(info);
        mono.sendMessage({
          action: 'updateOption',
          key: 'moduleShowDownloadInfo',
          value: 0
        });
      }, false);

      info.appendChild(close);
      parent.appendChild(info);
    },

    appendFileSizeIcon: function(link, iconStyle, textStyle, error, noBrackets, container) {
      var language = mono.global.language;
      iconStyle = iconStyle || {};
      textStyle = textStyle || {};

      var iconColor = '#333333';
      if (error) {
        iconColor = '#ff0000';
      } else
      if (iconStyle.color) {
        iconColor = iconStyle.color;
      }

      var defIconStyle = {
        width: '14px',
        height: '14px',
        marginLeft: '3px',
        verticalAlign: 'middle',
        position: 'relative',
        top: '-1px',
        cursor: 'pointer'
      };
      mono.extend(defIconStyle, iconStyle);

      var defTextStyle = {
        fontSize: '75%',
        fontWeight: 'normal',
        marginLeft: '3px',
        whiteSpace: 'nowrap'
      };
      mono.extend(defTextStyle, textStyle);

      var fsBtn = mono.create('img', {
        src: SaveFrom_Utils.svg.getSrc('info', iconColor),
        title: error ? language.getFileSizeFailTitle : language.getFileSizeTitle,
        style: defIconStyle
      });

      var _this = this;

      if (container) {
        container.appendChild(fsBtn);
      } else
      if (link.nextSibling) {
        link.parentNode.insertBefore(fsBtn, link.nextSibling);
      } else {
        link.parentNode.appendChild(fsBtn);
      }

      fsBtn.addEventListener("click", function(event) {
        event.preventDefault();
        event.stopPropagation();

        var node = mono.create('span', {
          text: '...',
          style: defTextStyle
        });

        fsBtn.parentNode.replaceChild(node, fsBtn);

        return mono.sendMessage({
          action: 'getFileSize',
          url: link.href
        }, function(response) {
          if (response.fileSize > 0) {
            var fileType = response.fileType || '';
            var size = _this.sizeHuman(response.fileSize, 2);
            var bitrate = '';
            if (/^audio\//i.test(fileType)) {
              var seconds = link.getAttribute('data-savefrom-helper-duration');
              seconds = seconds && parseInt(seconds);
              if (seconds > 0) {
                bitrate = Math.floor((response.fileSize / seconds) / 125);
                bitrate += ' ' + mono.global.language.kbps;
              }
            }
            var text = '';

            if (bitrate) {
              text = size + ' ~ ' + bitrate;
            } else {
              text = size;
            }

            if (!noBrackets) {
              text = '(' + text + ')';
            }

            node.textContent = text;
            node.title = fileType;
          } else {
            var errBtn = _this.appendFileSizeIcon(link, iconStyle, textStyle, true, noBrackets, document.createDocumentFragment());
            node.parentNode.replaceChild(errBtn, node);
          }
        });
      }, false);

      return fsBtn;
    },

    appendNoSoundIcon: function(link, iconStyle) {
      iconStyle = iconStyle || {};

      var noSoundIconColor = '#ff0000';
      if (iconStyle.color) {
        noSoundIconColor = iconStyle.color;
      }

      var defIconStyle = {
        width: '14px',
        height: '14px',
        marginLeft: '3px',
        verticalAlign: 'middle',
        position: 'relative',
        top: '-1px',
        cursor: 'pointer'
      };
      mono.extend(defIconStyle, iconStyle);

      var icon = mono.create('img', {
        src: SaveFrom_Utils.svg.getSrc('noSound', noSoundIconColor),
        title: mono.global.language.withoutAudio,
        style: defIconStyle
      });

      if (link.nextSibling) {
        link.parentNode.insertBefore(icon, link.nextSibling);
      } else
      if (link.parentNode) {
        link.parentNode.appendChild(icon);
      } else {
        link.appendChild(icon);
      }
    },

    video: {
      dataAttr: 'data-savefrom-video-visible',
      yt: {
        inited: false,

        show3D: false,
        showMP4NoAudio: false,

        showFormat: {
          'FLV': true,
          'MP4': true,
          'WebM': false,
          '3GP': false,
          'Audio AAC': false,
          'Audio Vorbis': false,
          'Audio Opus': false
        },

        format: {
          'FLV': {
            '5': {
              quality: '240'
            },
            '6': {
              quality: '270'
            },
            '34': {
              quality: '360'
            },
            '35': {
              quality: '480'
            }
          },

          'MP4': {
            '18': {
              quality: '360'
            },
            '22': {
              quality: '720'
            },
            '37': {
              quality: '1080'
            },
            '38': {
              quality: '8K'
            },
            '59': {
              quality: '480'
            },
            '78': {
              quality: '480'
            },
            '82': {
              quality: '360',
              '3d': true
            },
            '83': {
              quality: '240',
              '3d': true
            },
            '84': {
              quality: '720',
              '3d': true
            },
            '85': {
              quality: '1080',
              '3d': true
            },
            '160': {
              quality: '144',
              noAudio: true
            },
            '133': {
              quality: '240',
              noAudio: true
            },
            '134': {
              quality: '360',
              noAudio: true
            },
            '135': {
              quality: '480',
              noAudio: true
            },
            '136': {
              quality: '720',
              noAudio: true
            },
            '137': {
              quality: '1080',
              noAudio: true
            },
            '264': {
              quality: '1440',
              noAudio: true
            },
            '138': {
              quality: '8K',
              noAudio: true
            },
            '298': {
              quality: '720',
              noAudio: true,
              sFps: true
            },
            '299': {
              quality: '1080',
              noAudio: true,
              sFps: true
            },
            '266': {
              quality: '4K',
              noAudio: true
            }
          },

          'WebM': {
            '43': {
              quality: '360'
            },
            '44': {
              quality: '480'
            },
            '45': {
              quality: '720'
            },
            '46': {
              quality: '1080'
            },
            '167': {
              quality: '360',
              noAudio: true
            },
            '168': {
              quality: '480',
              noAudio: true
            },
            '169': {
              quality: '720',
              noAudio: true
            },
            '170': {
              quality: '1080',
              noAudio: true
            },
            '218': {
              quality: '480',
              noAudio: true
            },
            '219': {
              quality: '480',
              noAudio: true
            },
            '242': {
              quality: '240',
              noAudio: true
            },
            '243': {
              quality: '360',
              noAudio: true
            },
            '244': {
              quality: '480',
              noAudio: true
            },
            '245': {
              quality: '480',
              noAudio: true
            },
            '246': {
              quality: '480',
              noAudio: true
            },
            '247': {
              quality: '720',
              noAudio: true
            },
            '248': {
              quality: '1080',
              noAudio: true
            },
            '271': {
              quality: '1440',
              noAudio: true
            },
            '272': {
              quality: '8K',
              noAudio: true
            },
            '278': {
              quality: '144',
              noAudio: true
            },
            '100': {
              quality: '360',
              '3d': true
            },
            '101': {
              quality: '480',
              '3d': true
            },
            '102': {
              quality: '720',
              '3d': true
            },
            '302': {
              quality: '720',
              noAudio: true,
              sFps: true
            },
            '303': {
              quality: '1080',
              noAudio: true,
              sFps: true
            },
            '308': {
              quality: '1440',
              noAudio: true,
              sFps: true
            },
            '313': {
              quality: '4K',
              noAudio: true
            },
            '315': {
              quality: '4K',
              noAudio: true,
              sFps: true
            }
          },

          '3GP': {
            '17': {
              quality: '144'
            },
            '36': {
              quality: '240'
            }
          },

          'Audio AAC': {
            '139': {
              quality: '48',
              ext: 'aac',
              noVideo: true
            },
            '140': {
              quality: '128',
              ext: 'aac',
              noVideo: true
            },
            '141': {
              quality: '256',
              ext: 'aac',
              noVideo: true
            },
            '256': {
              quality: '192',
              ext: 'aac',
              noVideo: true
            },
            '258': {
              quality: '384',
              ext: 'aac',
              noVideo: true
            }
          },

          'Audio Vorbis': {
            '171': {
              quality: '128',
              ext: 'webm',
              noVideo: true
            },
            '172': {
              quality: '192',
              ext: 'webm',
              noVideo: true
            }
          },

          'Audio Opus': {
            '249': {
              quality: '48',
              ext: 'opus',
              noVideo: true
            },
            '250': {
              quality: '128',
              ext: 'opus',
              noVideo: true
            },
            '251': {
              quality: '256',
              ext: 'opus',
              noVideo: true
            }
          }
        },


        init: function() {
          if (SaveFrom_Utils.video.yt.inited) {
            return;
          }

          ['Audio AAC', 'Audio Vorbis', 'Audio Opus'].forEach(function(item) {
            var formatType = SaveFrom_Utils.video.yt.format[item];
            for (var qualityValue in formatType) {
              formatType[qualityValue].quality += ' ' + mono.global.language.kbps;
            }
          });

          SaveFrom_Utils.video.yt.show3D = mono.global.preference.ytHide3D == '0';
          SaveFrom_Utils.video.yt.showMP4NoAudio = mono.global.preference.ytHideMP4NoAudio == '0';

          var show = false;
          var showAudio = false;
          for (var i in SaveFrom_Utils.video.yt.showFormat) {
            var prefName = 'ytHide' + i.replace(' ', '_');
            if (prefName === 'ytHideAudio_AAC') {
              prefName = 'ytHideAudio_MP4';
            }
            var value = mono.global.preference[prefName] == '0';
            if (i === 'Audio AAC') {
              showAudio = value;
            }
            SaveFrom_Utils.video.yt.showFormat[i] = value;
            if (value) {
              show = true;
            }
          }

          SaveFrom_Utils.video.yt.showFormat['Audio Vorbis'] = showAudio;
          SaveFrom_Utils.video.yt.showFormat['Audio Opus'] = showAudio;

          if (!show) {
            SaveFrom_Utils.video.yt.showFormat.FLV = true;
          }

          SaveFrom_Utils.video.yt.inited = true;
        },


        show: function(links, parent, showDownloadInfo, style, videoTitle) {
          style = style || {};

          var content = document.createElement('div');
          SaveFrom_Utils.setStyle(content, {
            display: 'inline-block',
            margin: '0 auto'
          });
          parent.appendChild(content);

          var box = document.createElement('div');
          SaveFrom_Utils.setStyle(box, {
            display: 'inline-block',
            padding: '0 90px 0 0',
            position: 'relative'
          });
          content.appendChild(box);

          var tbl = document.createElement('table');
          SaveFrom_Utils.setStyle(tbl, {
            emptyCells: 'show',
            borderCollapse: 'collapse',
            margin: '0 auto',
            padding: '0',
            width: 'auto'
          });
          box.appendChild(tbl);

          var hidden = false;

          for (var i in SaveFrom_Utils.video.yt.format) {
            if (SaveFrom_Utils.video.yt.append(links, i,
                SaveFrom_Utils.video.yt.format[i], tbl, style, videoTitle)) {
              hidden = true;
            }
          }

          for (var i in links) {
            if (i === 'ummy' || i === 'ummyAudio' || i === 'meta') {
              continue;
            }
            if (SaveFrom_Utils.video.yt.append(links, '', null, tbl, style, videoTitle)) {
              hidden = true;
            }

            break;
          }

          if (!tbl.firstChild) {
            parent.textContent = mono.global.language.noLinksFound;
            return;
          }

          if (!hidden)
            return;

          var more = document.createElement('span');
          more.textContent = mono.global.language.more + ' ' + String.fromCharCode(187);
          SaveFrom_Utils.setStyle(more, {
            color: '#555',
            border: '1px solid #a0a0a0',
            borderRadius: '3px',
            display: 'block',
            fontFamily: 'Arial',
            fontSize: '15px',
            lineHeight: '17px',
            padding: '1px 5px',
            position: 'absolute',
            bottom: '3px',
            right: '0',
            cursor: 'pointer'
          });

          if (style.btn && typeof(style.btn) == 'object')
            SaveFrom_Utils.setStyle(more, style.btn);

          box.appendChild(more);

          more.addEventListener('click', function(event) {
            event.preventDefault();
            event.stopPropagation();

            var e = parent.querySelectorAll('*[' + SaveFrom_Utils.video.dataAttr + ']');
            for (var i = 0; i < e.length; i++) {
              var visible = e[i].getAttribute(SaveFrom_Utils.video.dataAttr);
              var display = 'none',
                symbol = String.fromCharCode(187);
              if (visible == '0') {
                visible = '1';
                display = '';
                symbol = String.fromCharCode(171);
              } else
                visible = '0';

              e[i].style.display = display;
              e[i].setAttribute(SaveFrom_Utils.video.dataAttr, visible);
              this.textContent = mono.global.language.more + ' ' + symbol;
            }

            return false;
          }, false);


          if (showDownloadInfo === 1) {
            var color = '#a0a0a0',
              a = tbl.querySelector('td a');

            content.appendChild(document.createElement('br'));
            SaveFrom_Utils.appendDownloadInfo(content, color, null, {
              width: '16px',
              height: '16px',
              fontSize: '16px',
              lineHeight: '16px'
            });
          }
        },


        append: function(links, title, format, parent, style, videoTitle) {
          var hidden = false;

          var aStyle = {
            whiteSpace: 'nowrap'
          };

          var sStyle = {
            fontSize: '75%',
            fontWeight: 'normal',
            marginLeft: '3px',
            whiteSpace: 'nowrap'
          };

          var tr = document.createElement('tr');

          var td = document.createElement('td');
          td.appendChild(document.createTextNode(title ? title : '???'));

          if (!title || !SaveFrom_Utils.video.yt.showFormat[title]) {
            tr.setAttribute(SaveFrom_Utils.video.dataAttr, '0');
            tr.style.display = 'none';
            hidden = true;
          }

          SaveFrom_Utils.setStyle(td, {
            border: 'none',
            padding: '3px 15px 3px 0',
            textAlign: 'left',
            verticalAlign: 'middle'
          });

          tr.appendChild(td);

          td = document.createElement('td');
          SaveFrom_Utils.setStyle(td, {
            border: 'none',
            padding: '3px 0',
            textAlign: 'left',
            verticalAlign: 'middle',
            lineHeight: '17px'
          });
          tr.appendChild(td);

          var meta = links.meta || {};

          var sep = false;
          if (format) {
            for (var i in format) {
              if (links[i]) {
                var quality = format[i].quality;
                if (sep) {
                  td.lastChild.style.marginRight = '15px';
                  td.appendChild(document.createTextNode(' '));
                }

                var span = document.createElement('span');
                span.style.whiteSpace = 'nowrap';

                var a = document.createElement('a');
                a.href = links[i];
                a.title = mono.global.language.downloadTitle;

                if (meta[i]) {
                  if (meta[i].quality) {
                    quality = meta[i].quality;
                  }

                  if (format[i].sFps) {
                    quality += ' ' + (meta[i].fps || 60);
                  }
                }

                if (format[i]['3d']) {
                  a.textContent = '3D';
                } else {
                  a.textContent = quality;
                }
                if (videoTitle) {
                  var ext = format[i]['ext'];
                  if (!ext)
                    ext = title.toLowerCase();

                  a.setAttribute('download', mono.fileName.modify(videoTitle + '.' + ext));

                  if (format[i].noVideo || format[i].noAudio) {
                    a.addEventListener('click', function(event) {
                      SaveFrom_Utils.downloadOnClick(event);
                    }, false);
                  }
                }
                SaveFrom_Utils.setStyle(a, aStyle);
                if (style.link && typeof(style.link) == 'object')
                  SaveFrom_Utils.setStyle(a, style.link);

                span.appendChild(a);
                SaveFrom_Utils.appendFileSizeIcon(a, style.fsIcon, style.fsText);

                if (format[i]['3d']) {
                  if (!SaveFrom_Utils.video.yt.show3D) {
                    hidden = true;
                    span.setAttribute(SaveFrom_Utils.video.dataAttr, '0');
                    span.style.display = 'none';
                  }

                  var s = document.createElement('span');
                  s.textContent = quality;
                  SaveFrom_Utils.setStyle(s, sStyle);
                  if (style.text && typeof(style.text) == 'object')
                    SaveFrom_Utils.setStyle(s, style.text);

                  a.appendChild(s);
                }

                if (format[i]['noAudio']) {
                  if (!SaveFrom_Utils.video.yt.showMP4NoAudio) {
                    hidden = true;
                    span.setAttribute(SaveFrom_Utils.video.dataAttr, '0');
                    span.style.display = 'none';
                  }

                  SaveFrom_Utils.appendNoSoundIcon(a, style ? style.noSoundIcon : false);
                }

                td.appendChild(span);

                sep = true;

                delete links[i];
              }
            }
          } else {
            for (var i in links) {
              if (sep) {
                td.lastChild.style.marginRight = '15px';
                td.appendChild(document.createTextNode(' '));
              }

              var span = document.createElement('span');
              span.style.whiteSpace = 'nowrap';

              var a = document.createElement('a');
              a.href = links[i];
              a.title = mono.global.language.downloadTitle;
              a.textContent = i;
              SaveFrom_Utils.setStyle(a, aStyle);
              if (style.link && typeof(style.link) == 'object')
                SaveFrom_Utils.setStyle(a, style.link);

              span.appendChild(a);
              SaveFrom_Utils.appendFileSizeIcon(a, style.fsIcon, style.fsText);
              td.appendChild(span);

              sep = true;

              delete links[i];
            }
          }

          if (sep === false) {
            return;
          }
          parent.appendChild(tr);

          return hidden;
        }
      }
    }, // video


    playlist: {
      btnStyle: {
        display: 'block',
        fontWeight: 'bold',
        border: 'none',
        textDecoration: 'underline'
      },


      getFilelistHtml: function(links) {
        if (!links || links.length == 0)
          return;

        var rows = 0;
        var list = '';

        for (var i = 0; i < links.length; i++) {
          if (links[i].url) {
            list += links[i].url + '\r\n';
            rows++;
          }
        }

        if (list) {
          if (rows < 5) {
            rows = 5;
          } else
          if (rows > 14) {
            rows = 14;
          }

          return mono.create(document.createDocumentFragment(), {
            append: [
              mono.create('p', {
                text: mono.global.language.filelistTitle,
                style: {
                  color: '#0D0D0D',
                  fontSize: '20px',
                  marginBottom: '11px',
                  marginTop: '5px'
                }
              }),
              mono.create('p', {
                style: {
                  marginBottom: '11px'
                },
                append: mono.parseTemplate(mono.global.language.filelistInstruction)
              }),
              mono.create('p', {
                text: mono.global.language.vkFoundFiles.replace('%d', links.length),
                style: {
                  color: '#000',
                  marginBottom: '11px'
                },
                append: mono.create('a', {
                  text: mono.global.language.playlist,
                  href: '#',
                  class: 'sf__playlist',
                  style: {
                    display: 'none',
                    cssFloat: 'right'
                  }
                })
              }),
              mono.create('textarea', {
                text: list,
                rows: rows,
                cols: 60,
                style: {
                  width: '100%',
                  whiteSpace: (mono.isFF || mono.isGmOnly) ? 'normal' : 'nowrap'
                }
              }),
              (!mono.isChrome && !mono.isFF) ? undefined : mono.create('button', {
                text: mono.global.language.copy,
                style: {
                  height: '27px',
                  backgroundColor: '#ffffff',
                  border: '1px solid #9e9e9e',
                  marginTop: '6px',
                  paddingLeft: '10px',
                  paddingRight: '10px',
                  borderRadius: '5px',
                  fontSize: '14px',
                  cursor: 'pointer',
                  cssFloat: 'right'
                },
                on: ['click', function(e) {
                  var _this = this;
                  _this.disabled = true;
                  mono.sendMessage({
                    action: 'addToClipboard',
                    text: list
                  });
                  setTimeout(function() {
                    _this.disabled = false;
                  }, 1000);
                }],
                append: mono.create('style', {
                  text: mono.style2Text({
                    '#savefrom_popup_box': {
                      append: {
                        'button:hover:not(:disabled)': {
                          backgroundColor: '#597A9E !important',
                          borderColor: '#597A9E !important',
                          color: '#fff'
                        },
                        'button:active': {
                          opacity: 0.9
                        }
                      }
                    }
                  })
                })
              })
            ]
          });
        }
      },


      popupFilelist: function(links, title, playlist, id) {
        var content = SaveFrom_Utils.playlist.getFilelistHtml(links);
        if (!content)
          return;

        var popup = SaveFrom_Utils.popupDiv(content, id);
        if (playlist) {
          var a = popup.querySelector('a.sf__playlist');
          if (a) {
            a.addEventListener('click', function(event) {
              setTimeout(function() {
                SaveFrom_Utils.playlist.popupPlaylist(links, title, true, id);
              }, 100);
              event.preventDefault();
              return false;
            }, false);

            SaveFrom_Utils.setStyle(a, SaveFrom_Utils.playlist.btnStyle);
          }
        }
      },

      getInfoPopupTemplate: function() {
        var popupContainer = mono.create('div', {
          class: 'sf-infoPopupTemplate',
          style: {
            width: '400px',
            minHeight: '40px'
          }
        });

        var mediaIcon = mono.create('div', {
          style: {
            backgroundSize: '48px',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center top',
            display: 'inline-block',
            width: '60px',
            height: '60px',
            cssFloat: 'left',
            marginTop: '16px',
            marginRight: '10px'
          }
        });

        var textContent = mono.create('div', {
          style: {
            display: 'inline-block',
            width: '330px'
          }
        });

        var buttonWrap = mono.create('div', {
          style: {
            textAlign: 'right'
          },
          append: mono.create('style', {
            text: mono.style2Text({
              '.sf-infoPopupTemplate': {
                append: [{
                  'a.sf-button': {
                    padding: '1px 6px',
                    display: 'inline-block',
                    textAlign: 'center',
                    height: '23px',
                    lineHeight: '23px',
                    textDecoration: 'none'
                  }
                }, {
                  selector: ['button:hover', 'a.sf-button:hover'],
                  style: {
                    backgroundColor: '#597A9E !important',
                    borderColor: '#597A9E !important',
                    color: '#fff'
                  }
                }]
              }
            })
          })
        });

        popupContainer.appendChild(mediaIcon);
        popupContainer.appendChild(textContent);
        popupContainer.appendChild(buttonWrap);
        return {
          icon: mediaIcon,
          buttonContainer: buttonWrap,
          textContainer: textContent,
          body: popupContainer
        }
      },

      getM3U: function(links) {
        var text = '#EXTM3U\r\n';

        for (var i = 0; i < links.length; i++) {
          if (!links[i].duration)
            links[i].duration = '-1';

          if (links[i].title || links[i].duration) {
            text += '#EXTINF:' + links[i].duration + ',' +
              links[i].title + '\r\n';
          }

          text += links[i].url + '\r\n';
        }

        return text;
      },


      getPlaylistHtml: function(links, fileTitle) {
        if (!links || links.length == 0)
          return;

        var links_len = links.length;

        var d = SaveFrom_Utils.dateToObj();
        var dateStr = d.year + '-' + d.month + '-' + d.day + ' ' +
          d.hour + '-' + d.min;

        // M3U
        var m3uList = SaveFrom_Utils.playlist.getM3U(links);
        m3uList = m3uList.replace(/\r\n/g, '\n');

        var m3uUrl;
        if (typeof URL !== 'undefined' && typeof Blob !== "undefined" && !mono.isSafari) {
          var m3uBlob = new Blob([m3uList], {
            encoding: "UTF-8",
            type: 'audio/x-mpegurl'
          });
          m3uUrl = URL.createObjectURL(m3uBlob);
        } else {
          var m3uUTF8 = SaveFrom_Utils.utf8Encode(m3uList);
          m3uUrl = 'data:audio/x-mpegurl;charset=utf-8;base64,' + encodeURIComponent(btoa(m3uUTF8))
        }

        var template = SaveFrom_Utils.playlist.getInfoPopupTemplate();

        mono.sendMessage({
          action: 'getWarningIcon',
          color: '#00CCFF',
          type: 'playlist'
        }, function(icon) {
          template.icon.style.backgroundImage = 'url(' + icon + ')';
        });

        mono.create(template.textContainer, {
          append: [
            mono.create('p', {
              text: fileTitle || mono.global.language.playlistTitle,
              style: {
                color: '#0D0D0D',
                fontSize: '20px',
                marginBottom: '11px',
                marginTop: '13px'
              }
            }),
            mono.create('p', {
              text: mono.global.language.playlistInstruction,
              style: {
                color: '#868686',
                fontSize: '14px',
                marginBottom: '13px',
                lineHeight: '24px',
                marginTop: '0px'
              }
            }),
            mono.create('a', {
              text: mono.global.language.filelist + ' (' + links_len + ')',
              href: '#',
              class: 'sf__playlist',
              style: {
                display: 'none',
                fontSize: '14px',
                marginBottom: '13px',
                lineHeight: '24px',
                marginTop: '0px'
              }
            })
          ]
        });

        if (!fileTitle) {
          fileTitle = 'playlist';
        }
        fileTitle += ' ' + dateStr;

        mono.create(template.buttonContainer, {
          append: [
            mono.create('a', {
              text: mono.global.language.download,
              href: m3uUrl,
              download: mono.fileName.modify(fileTitle + '.m3u'),
              class: 'sf-button',
              style: {
                width: '118px',
                backgroundColor: '#ffffff',
                border: '1px solid #9e9e9e',
                margin: '12px',
                marginBottom: '11px',
                marginRight: '8px',
                borderRadius: '5px',
                fontSize: '14px',
                cursor: 'pointer'
              }
            })
          ]
        });

        return template.body;
      },


      popupPlaylist: function(links, title, filelist, id) {
        var content = SaveFrom_Utils.playlist.getPlaylistHtml(links, title);
        if (!content)
          return;

        var popup = SaveFrom_Utils.popupDiv(content, id);
        if (filelist) {
          var a = popup.querySelector('a.sf__playlist');
          if (a) {
            a.addEventListener('click', function(event) {
              setTimeout(function() {
                SaveFrom_Utils.playlist.popupFilelist(links, title, true, id);
              }, 100);
              event.preventDefault();
              return false;
            }, false);

            a.style.display = 'inline';
            a = null;
          }
        }
        var dl_links = popup.querySelectorAll('a[download]');
        for (var i = 0, el; el = dl_links[i]; i++) {
          el.addEventListener('click', SaveFrom_Utils.downloadOnClick, false);
        }
      }
    },

    popupCloseBtn: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAWUlEQVQ4y2NgGHHAH4j1sYjrQ+WIAvFA/B+I36MZpg8V+w9VQ9Al/5EwzDBkQ2AYr8uwaXiPQ0yfkKuwGUayIYQMI8kQqhlEFa9RLbCpFv1US5BUzSLDBAAARN9OlWGGF8kAAAAASUVORK5CYII=',

    popupDiv: function(content, id, maxWidth, maxHeight, onClose) {
      if (!id) {
        id = 'savefrom_popup_box';
      }

      if (!maxWidth)
        maxWidth = 580;

      if (!maxHeight)
        maxHeight = 520;

      var popupBody = document.getElementById(id);
      if (popupBody) {
        popupBody.parentNode.removeChild(popupBody);
      }

      popupBody = mono.create('div', {
        id: id,
        style: {
          zIndex: '9999',
          display: 'block',
          cssFloat: 'none',
          position: 'fixed',
          margin: '0',
          padding: '0',
          visibility: 'hidden',
          color: '#000',
          background: '#fff',
          border: '3px solid #c0cad5',
          borderRadius: '7px',
          overflow: 'auto'
        }
      });


      var cnt = mono.create('div', {
        style: {
          display: 'block',
          cssFloat: 'none',
          position: 'relative',
          overflow: 'auto',
          margin: '0',
          padding: '10px 15px'
        }
      });

      if (typeof content === 'function') {
        content(cnt);
      } else {
        cnt.appendChild(content);
      }

      var btn = mono.create('img', {
        src: SaveFrom_Utils.popupCloseBtn,
        alt: 'x',
        width: 18,
        height: 18,
        style: {
          position: 'absolute',
          top: '10px',
          right: '15px',
          opacity: '0.5',
          cursor: 'pointer'
        },
        on: [
          ['mouseenter', function() {
            "use strict";
            this.style.opacity = '0.9';
          }],
          ['mouseleave', function() {
            "use strict";
            this.style.opacity = '0.5';
          }],
          ['click', function() {
            "use strict";
            if (popupBody.parentNode) {
              popupBody.parentNode.removeChild(popupBody);
            }
            if (onClose) {
              onClose();
            }
            return false;
          }]
        ]
      });

      cnt.appendChild(btn);
      popupBody.appendChild(cnt);
      document.body.appendChild(popupBody);

      if (popupBody.offsetWidth > maxWidth) {
        popupBody.style.width = maxWidth + 'px';
      }

      if (popupBody.offsetHeight > maxHeight) {
        popupBody.style.height = maxHeight + 'px';
        popupBody.style.width = (maxWidth + 20) + 'px';
      }

      setTimeout(function() {
        var l = Math.floor((window.innerWidth - popupBody.offsetWidth) / 2.0);
        var t = Math.floor((window.innerHeight - popupBody.offsetHeight) / 2.0);
        if (t < 0) {
          t = 0;
        }
        if (location.host.indexOf('youtu') !== -1 && t < 50) {
          t = 50;
          popupBody.style.height = (popupBody.offsetHeight - t - 10) + 'px';
        }
        if (l < 0) {
          l = 0;
        }
        SaveFrom_Utils.setStyle(popupBody, {
          top: t + 'px',
          left: l + 'px',
          visibility: 'visible'
        });
      });

      var onDocClose = function(event) {
        var node = event.target;
        if (node !== popupBody && !SaveFrom_Utils.isParent(node, popupBody)) {
          if (popupBody.parentNode) {
            popupBody.parentNode.removeChild(popupBody);
          }
          document.removeEventListener('click', onDocClose, false);
          if (onClose) {
            onClose();
          }
        }
      };

      setTimeout(function() {
        document.addEventListener('click', onDocClose, false);
      }, 100);

      popupBody.addEventListener('close', function() {
        if (popupBody.parentNode) {
          popupBody.parentNode.removeChild(popupBody);
        }
        document.removeEventListener('click', onDocClose, false);
        if (onClose) {
          onClose();
        }
      });

      popupBody.addEventListener('kill', function() {
        if (popupBody.parentNode) {
          popupBody.parentNode.removeChild(popupBody);
        }
        document.removeEventListener('click', onDocClose, false);
      });

      return popupBody;
    },

    popupDiv2: function(_details) {
      "use strict";
      var details = {
        id: 'savefrom_popup_box',
        containerStyle: null,
        bodyStyle: null,
        content: null,
        container: null,
        body: null
      };

      details._onClose = function() {
        document.removeEventListener('click', details._onClose);

        if (container.parentNode) {
          container.parentNode.removeChild(container);
        }

        details.onClose && details.onClose();
      };

      mono.extend(details, _details);

      var container = details.container = mono.create('div', {
        id: details.id,
        style: {
          zIndex: 9999,
          display: 'block',
          position: 'fixed',
          background: '#fff',
          border: '3px solid #c0cad5',
          borderRadius: '7px'
        },
        append: [
          mono.create('style', {
            text: mono.style2Text({
              selector: '#' + details.id,
              style: mono.styleReset
            })
          })
        ],
        on: [
          ['click', function(e) {
            e.stopPropagation();
          }]
        ]
      });

      var closeBtn = mono.create('img', {
        src: SaveFrom_Utils.popupCloseBtn,
        alt: 'x',
        width: 18,
        height: 18,
        style: {
          position: 'absolute',
          top: '10px',
          right: '15px',
          opacity: '0.5',
          cursor: 'pointer'
        },
        on: [
          ['mouseenter', function() {
            "use strict";
            this.style.opacity = '0.9';
          }],
          ['mouseleave', function() {
            "use strict";
            this.style.opacity = '0.5';
          }],
          ['click', details._onClose]
        ]
      });

      container.appendChild(closeBtn);

      var body = details.body = mono.create('div', {
        style: mono.extendPos({
          display: 'block',
          position: 'relative',
          padding: '10px 15px',
          overflow: 'auto'
        }, details.bodyStyle)
      });

      if (typeof details.content === 'function') {
        details.content(body);
      } else {
        body.appendChild(details.content);
      }

      container.appendChild(body);

      document.body.appendChild(container);
      document.addEventListener('click', details._onClose);

      return details;
    },

    // row - used for hide tooltip on mouseout
    // because node can dissaper from DOM before mouseout raised
    showTooltip: function(node, text, row, style) {
      if (!node)
        return;

      var tooltip = document.querySelector('.savefrom-tooltip');
      if (!tooltip) {
        tooltip = document.createElement('div');
        tooltip.className = 'savefrom-tooltip';
        SaveFrom_Utils.setStyle(tooltip, {
          'position': 'absolute',
          'opacity': 0,
          'zIndex': -1
        });
        if (style) {
          SaveFrom_Utils.setStyle(tooltip, style);
        }
      }

      tooltip.textContent = text;

      if (tooltip.lastNode && tooltip.lastNode === node) {
        fixPosition();
        return;
      }

      if (tooltip.lastNode) {
        mono.off(tooltip.lastNode, 'mouseleave', hide);
        mono.off(tooltip.lastNode, 'mousemove', fixPosition);
        tooltip.lastRow && mono.off(tooltip.lastRow, 'mouseleave', hide);
      }

      tooltip.lastNode = node;
      row && (tooltip.lastRow = row);

      mono.on(node, 'mouseleave', hide);
      mono.on(node, 'mousemove', fixPosition, false);
      row && mono.on(row, 'mouseleave', hide);

      document.body.appendChild(tooltip);
      fixPosition();

      function fixPosition(e) {
        if (e !== undefined) {
          e.stopPropagation();
        }
        var p = SaveFrom_Utils.getPosition(node),
          s = SaveFrom_Utils.getSize(tooltip);

        if (p.top == 0 && p.left == 0)
          return;

        p.top = p.top - s.height - 10;
        p.left = p.left - s.width / 2 + SaveFrom_Utils.getSize(node).width / 2;

        p.left = Math.min(p.left, document.body.clientWidth + document.body.scrollLeft - s.width);
        if (p.top < document.body.scrollTop)
          p.top = p.top + s.height + SaveFrom_Utils.getSize(node).height + 20;

        p.top += 'px';
        p.left += 'px';

        // show
        p.zIndex = 9999;
        p.opacity = 1;

        SaveFrom_Utils.setStyle(tooltip, p);
      }

      function hide() {
        if (tooltip.parentNode)
          document.body.removeChild(tooltip);

        tooltip.lastNode = null;
        tooltip.lastRow = null;
        SaveFrom_Utils.setStyle(tooltip, {
          zIndex: -1,
          opacity: 0
        });
        mono.off(node, 'mouseleave', hide);
        mono.off(node, 'mousemove', fixPosition);
        row && mono.off(row, 'mouseleave', hide);
      }
    },

    embedDownloader: {
      dataAttr: 'data-savefrom-get-links',
      dataIdAttr: 'data-savefrom-container-id',
      containerClass: 'savefrom-links-container',
      linkClass: 'savefrom-link',
      panel: null,
      lastLink: null,
      style: null,

      hostings: {
        'youtube': {
          re: [
            /^https?:\/\/(?:[a-z]+\.)?youtube\.com\/(?:#!?\/)?watch\?.*v=([\w\-]+)/i,
            /^https?:\/\/(?:[a-z0-9]+\.)?youtube\.com\/(?:embed|v)\/([\w\-]+)/i,
            /^https?:\/\/(?:[a-z]+\.)?youtu\.be\/([\w\-]+)/i
          ],
          action: 'getYoutubeLinks',
          prepareLinks: function(links) {
            var ret = [];
            var sfUtilsYt = SaveFrom_Utils.video.yt;
            var format = sfUtilsYt.format;

            var meta = links.meta || {};

            for (var formatName in format) {
              for (var iTag in format[formatName]) {
                var metaTag = meta[iTag] || {};
                if (links[iTag]) {
                  var type = formatName;
                  if (format[formatName][iTag].ext) {
                    type = format[formatName][iTag].ext;
                  }

                  var quality = format[formatName][iTag].quality;
                  if (metaTag.quality) {
                    quality = metaTag.quality;
                  }

                  if (format[formatName][iTag].sFps) {
                    quality += ' ' + (metaTag.fps || 60);
                  }

                  if (format[formatName][iTag]['3d']) {
                    quality += ' (3d)';
                  }

                  ret.push({
                    name: formatName + ' ' + quality,
                    type: type,
                    url: links[iTag],
                    noSound: format[formatName][iTag].noAudio
                  });
                }
              }
            }

            return ret;
          }
        },
        'vimeo': {
          re: [
            /^https?:\/\/(?:[\w\-]+\.)?vimeo\.com\/(?:\w+\#)?(\d+)/i,
            /^https?:\/\/player\.vimeo\.com\/video\/(\d+)/i,
            /^https?:\/\/(?:[\w\-]+\.)?vimeo\.com\/channels\/(?:[^\/]+)\/(\d+)$/i,
            /^https?:\/\/vimeo\.com\/(?:.+)clip_id=(\d+)/i
          ],
          action: 'getVimeoLinks',
          prepareLinks: function(links) {
            return links.map(function(link) {
              var ext = link.ext;
              if (!ext) {
                ext = 'MP4';
                if (link.url.search(/\.flv($|\?)/i) != -1)
                  ext = 'FLV';
              }

              link.name = link.name ? link.name : ext;
              link.type = link.type ? link.type : ext;
              link.ext = ext;

              return link;
            });
          }
        },

        'vk': {
          re: [
            /^https?:\/\/(?:[\w\-]+\.)?(?:vk\.com|vkontakte\.ru)\/(?:[^\/]+\/)*(?:[\w\-\.]+\?.*z=)?(video-?\d+_-?\d+\?list=[0-9a-z]+|video-?\d+_-?\d+)/i,
            /^https?:\/\/(?:[\w\-]+\.)?(?:vk\.com|vkontakte\.ru)\/video_ext\.php\?(.+)/i
          ],
          action: 'getVKLinks'
        },

        'dailymotion': {
          re: [
            /^http:\/\/(?:www\.)?dai\.ly\/([a-z0-9]+)_?/i,
            /^https?:\/\/(?:[\w]+\.)?dailymotion\.com(?:\/embed|\/swf)?\/video\/([a-z0-9]+)_?/i
          ],
          action: 'getDailymotionLinks'
        },

        'facebook': {
          re: [
            /^https?:\/\/(?:[\w]+\.)?facebook\.com(?:\/video)?\/video.php.*[?&]{1}v=([0-9]+).*/i,
            /^https?:\/\/(?:[\w]+\.)?facebook\.com\/.+\/videos(?:\/\w[^\/]+)?\/(\d+)/i
          ],
          action: 'getFacebookLinks'
        }
      },


      init: function(style) {
        this.style = style;

        if (this.panel) {
          SaveFrom_Utils.popupMenu.removePanel();
        }

        this.panel = null;
        this.lastLink = null;

        var links = document.querySelectorAll('a[' + this.dataAttr + ']'),
          i, l = links.length;

        for (i = 0; i < l; i++) {
          if (['savefrom.net', 'sf-addon.com'].indexOf(
              SaveFrom_Utils.getTopLevelDomain(links[i].hostname)) > -1) {
            links[i].removeEventListener('click', this.onClick, false);
            links[i].addEventListener('click', this.onClick, false);
          }
        }

        // hide menu on click outside them
        // process dinamically added links
        if (document.body) {
          document.body.removeEventListener('click', this.onBodyClick, true);
          document.body.addEventListener('click', this.onBodyClick, true);
        }
      },


      checkUrl: function(url) {
        for (var hosting in this.hostings) {
          var params = this.hostings[hosting];

          for (var i = 0, len = params.re.length; i < len; i++) {
            var match = url.match(params.re[i]);
            if (match) {
              return {
                hosting: hosting,
                action: params.action,
                extVideoId: match[1]
              };
            }
          }
        }

        return null;
      },

      reMapHosting: function(action) {
        var map = {
          'getYoutubeLinks': 'youtube',
          'getVimeoLinks': 'vimeo',
          'getDailymotionLinks': 'dailymotion',
          'getFacebookLinks': 'facebook',
          'getVKLinks': 'vk'
        };

        return map[action];
      },


      onClick: function(event, a) {
        var _this = SaveFrom_Utils.embedDownloader;

        if (!a) {
          a = event.target;
          while (a.parentNode) {
            if (a.nodeName === 'A')
              break;
            a = a.parentNode;
          }

          if (!a)
            return;
        }

        var href = a.getAttribute('data-savefrom-get-links');
        if (!href)
          return;

        if (event.button !== 0 || event.ctrlKey || event.shiftKey)
          return;

        if (_this.lastLink === a && _this.panel && _this.panel.style.display != 'none') {
          _this.lastLink = null;
          _this.panel.style.display = 'none';

          event.preventDefault();
          event.stopPropagation();
          return;
        }

        _this.lastLink = a;
        var data = _this.checkUrl(href);
        if (!data)
          return;

        event.preventDefault();
        event.stopPropagation();

        var request = {
          action: data.action,
          extVideoId: data.extVideoId
        };

        _this.showLinks(mono.global.language.download + ' ...', null, a);

        mono.sendMessage(request, function(response) {
          var hosting = data.hosting;

          if (response.action != request.action) {
            hosting = _this.reMapHosting(response.action);
          }

          if (response.links)
            _this.showLinks(response.links, response.title, a, hosting, true);
          else
            _this.showLinks(mono.global.language.noLinksFound, null, a, undefined, true);
        });

        return false;
      },


      onBodyClick: function(event) {
        var _this = SaveFrom_Utils.embedDownloader;

        var node = event.target;

        if (!_this.panel || _this.panel.style.display == 'none') {
          if (node.tagName !== 'A' && mono.matches(node, 'A ' + node.tagName)) {
            while (node.parentNode) {
              if (node.tagName === 'A') {
                break;
              }
              node = node.parentNode;
            }
          }

          if (node.nodeName !== 'A') {
            return;
          }

          // dinamic links
          if (node.hasAttribute(_this.dataAttr) && ['savefrom.net', 'sf-addon.com'].indexOf(SaveFrom_Utils.getTopLevelDomain(node.hostname)) > -1) {
            return _this.onClick(event, node);
          }

          return;
        }

        if (_this.panel === node || _this.panel.contains(node)) {
          return;
        }

        _this.lastLink = null;
        _this.panel.style.display = 'none';

        event.preventDefault();
        event.stopPropagation();
      },

      hidePanel: function() {
        if (this.panel) {
          this.panel.style.display = 'none';
        }
      },

      createMenu: function(links, title, a, hname, update) {
        var menuLinks = mono.global.language.noLinksFound;
        if (typeof links === 'string') {
          menuLinks = links;
        } else
        if (SaveFrom_Utils.popupMenu.prepareLinks[hname] !== undefined && links) {
          menuLinks = SaveFrom_Utils.popupMenu.prepareLinks[hname](links, title);
        }
        var options = {
          links: menuLinks,
          button: a,
          popupId: undefined,
          showFileSize: true,
          containerClass: this.containerClass,
          linkClass: this.linkClass,
          style: {
            popup: (this.style) ? this.style.container : undefined,
            item: (this.style) ? this.style.link : undefined
          },
          isUpdate: update
        };
        if (update && this.panel) {
          SaveFrom_Utils.popupMenu.update(this.panel, options)
        } else {
          this.panel = SaveFrom_Utils.popupMenu.create(options);
        }
      },

      showLinks: function(links, title, a, hname, update) {
        var panel, id = a.getAttribute(this.dataIdAttr);
        if (id)
          panel = document.getElementById(id);

        if (!panel) {
          this.createMenu(links, title, a, hname, update);

          return;
        } else if (this.panel) {
          this.panel.style.display = 'none';
        }

        if (typeof(links) == 'string') {
          panel.textContent = links;
        } else if (!links || links.length == 0) {
          panel.textContent = mono.global.language.noLinksFound;
        } else {
          // append links
          if (hname && this.hostings[hname] && this.hostings[hname].prepareLinks)
            links = this.hostings[hname].prepareLinks(links);

          panel.textContent = '';

          for (var i = 0; i < links.length; i++) {
            if (links[i].url && links[i].name) {
              var a = document.createElement('a');
              a.href = links[i].url;
              a.title = mono.global.language.downloadTitle;
              a.appendChild(document.createTextNode(links[i].name));
              var span = document.createElement('span');
              span.className = this.linkClass;

              span.appendChild(a);
              panel.appendChild(span);

              SaveFrom_Utils.appendFileSizeIcon(a);
              if (links[i].noSound)
                SaveFrom_Utils.appendNoSoundIcon(a);

              if (title && !links[i].noTitle && links[i].type) {
                a.setAttribute('download', mono.fileName.modify(
                  title + '.' + links[i].type.toLowerCase()));

                a.addEventListener('click', SaveFrom_Utils.downloadOnClick, false);
              }
            }
          }
        }
      }
    },
    createUmmyInfo: function(details, targetNode) {
      "use strict";
      details = details || {};
      var params = mono.extend({
        vid: 111,
        utm_source: 'savefrom-helper',
        utm_medium: 'youtube-helper'
      }, details.params);

      if (!params.utm_campaign) {
        if (details.itemType === 'hd') {
          params.utm_campaign = 'youtube-helper-hd';
        } else
        if (details.itemType === 'mp3') {
          params.utm_campaign = 'youtube-helper-mp3';
        }
      }

      var ummyUrl = 'http://videodownloader.ummy.net/?' + mono.param(params);
      if (/^Mac/.test(navigator.platform) && /^yt-/.test(params.video)) {
        ummyUrl = 'http://videodownloader.ummy.net/save-from-youtube.html?' + mono.param({
          vid: params.vid,
          video: params.video,
          utm_source: 'savefrom-helper',
          utm_medium: 'youtube-helper',
          utm_campaign: 'ummy',
          utm_content: 'ummy_integration_h'
        });
      }


      var themeShadowArrowDirStyle, themeArrowDirStyle, themeInfoPopup, themeLinkColor;

      var shadowArrowDirStyle, arrowDirStyle, containerDirArrow;
      if (details.posLeft) {
        shadowArrowDirStyle = {
          border: '8px solid transparent',
          borderLeft: '10px solid rgb(192, 187, 187)',
          borderRight: 0,
          top: '8px',
          right: '11px'
        };

        arrowDirStyle = mono.extend({}, shadowArrowDirStyle, {
          right: '12px',
          borderLeft: '10px solid #fff'
        });

        containerDirArrow = {
          right: '21px'
        };

        if (details.darkTheme) {
          themeShadowArrowDirStyle = {
            borderLeftColor: 'rgba(255, 255, 255, 0.4)'
          };

          themeArrowDirStyle = {
            borderLeftColor: 'rgba(28,28,28, 0.6)'
          };
        }
      } else {
        shadowArrowDirStyle = {
          border: '8px solid transparent',
          borderRight: '10px solid rgb(192, 187, 187)',
          borderLeft: 0,
          top: '8px',
          left: '11px'
        };

        arrowDirStyle = mono.extend({}, shadowArrowDirStyle, {
          left: '12px',
          borderRight: '10px solid #fff'
        });

        containerDirArrow = {
          left: '21px'
        };

        if (details.darkTheme) {
          themeShadowArrowDirStyle = {
            borderRightColor: '#fff'
          };

          themeArrowDirStyle = {
            borderRightColor: '#000'
          };
        }
      }

      if (details.darkTheme) {
        themeLinkColor = {
          'a': {
            color: '#eee'
          }
        };
      } else {
        themeLinkColor = {};
      }

      if (details.darkTheme) {
        themeInfoPopup = {
          backgroundColor: 'rgba(28,28,28,0.8)',
          border: '1px solid rgba(255, 255, 255, 0.4)',
          color: '#fff'
        };
      } else {
        themeInfoPopup = {
          backgroundColor: '#fff',
          border: '1px solid #ccc'
        };
      }


      var arrow = mono.create(document.createDocumentFragment(), {
        append: [
          mono.create('span', {
            style: mono.extend({
              display: 'inline-block',
              width: 0,
              position: 'absolute'
            }, shadowArrowDirStyle, themeShadowArrowDirStyle)
          }),
          mono.create('span', {
            style: mono.extend({
              display: 'inline-block',
              width: 0,
              position: 'absolute',
              zIndex: 1
            }, arrowDirStyle, themeArrowDirStyle)
          })
        ]
      });

      var showUmmyInfoNode = null;
      var info = null;
      var infoContainer = mono.create('div', {
        class: 'sf-ummy-info-popup-container',
        style: {
          position: 'absolute',
          zIndex: 9999
        },
        append: [
          arrow,
          info = mono.create('div', {
            class: 'sf-ummy-info-popup',
            style: mono.extend({
              position: 'relative',
              backgroundColor: '#fff',
              border: '1px solid #ccc',
              padding: '6px 5px',
              textAlign: 'center',
              maxWidth: '240px',
              lineHeight: '16px',
              fontSize: '12px',
              fontFamily: 'arial, sans-serif',
              cursor: 'default'
            }, containerDirArrow, themeInfoPopup),
            append: [
              mono.parseTemplate(mono.global.language.ummyMenuInfo.replace(
                '{url}', ummyUrl
              )),
              mono.create('label', {
                style: {
                  verticalAlign: 'middle',
                  display: 'block'
                },
                append: [
                  showUmmyInfoNode = mono.create('input', {
                    type: 'checkbox',
                    name: 'showUmmyInfo',
                    style: {
                      verticalAlign: 'middle'
                    }
                  }),
                  mono.global.language.tooltipHide
                ]
              }),
              mono.create('style', {
                text: mono.style2Text({
                  '.sf-ummy-info-popup': {
                    append: mono.extend({
                      '> p': {
                        margin: '0 0 .8em 0'
                      },
                      '> p.center': {
                        textAlign: 'center'
                      },
                      '> p > .green-btn-2.arrow': {
                        color: '#fff',
                        background: '#84bd07',
                        borderRadius: '5px',
                        display: 'inline-block',
                        position: 'relative',
                        lineHeight: 1,
                        padding: '8px 34px 8px 10px',
                        textDecoration: 'none',
                        fontSize: '12px'
                      },
                      '> p > .green-btn-2.arrow:hover': {
                        color: '#fff',
                        opacity: 0.8
                      },
                      '> p > .green-btn-2.arrow:after': {
                        background: 'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAYAAAAmL5yKAAAAjklEQVQoke3RsRGCQBCF4YuJsQDoQMpjKMImtAjth9xMEj4DF4c5QDH3n7lk773b3XsJNzTpR9DglrwYcUG9w1iHdoTpgYkBJ5QrxkPcDXNDQm/JHR2KOF3UcvoUgnZL8KFBi2I+Yrk2YsZjsaIsBVQ4i08KxqhVu1OYBLji+E/hzTKFlV13pfAVGynkPAFtrlNTMRczMgAAAABJRU5ErkJggg==) 0 0 no-repeat',
                        content: '""',
                        display: 'block',
                        position: 'absolute',
                        width: '16px',
                        height: '14px',
                        top: '50%',
                        right: '10px',
                        marginTop: '-7px'
                      },
                      'input': {
                        display: 'inline-block'
                      }
                    }, themeLinkColor)
                  }
                })
              })
            ]
          })
        ],
        on: [
          ['mouseclick', function(e) {
            e.stopPropagation();
          }],
          ['mousedown', function(e) {
            e.stopPropagation();
          }]
        ]
      });

      mono.sendMessage({
        action: 'getUmmyIcon'
      }, function(dataImg) {
        var icon = info.querySelector('img');
        if (!icon) {
          return;
        }
        icon.src = dataImg;
        icon.style.verticalAlign = 'text-bottom';
      });

      showUmmyInfoNode.checked = !mono.global.preference.showUmmyInfo;
      showUmmyInfoNode.addEventListener('change', function(e) {
        e.preventDefault();
        e.stopPropagation();

        if (this.checked) {
          mono.trigger(targetNode, 'sfRmInfoPopup');
          mono.global.preference.showUmmyInfo = 0;
        } else {
          mono.trigger(targetNode, 'sfAddInfoPopup');
          mono.global.preference.showUmmyInfo = 1;
        }

        mono.sendMessage({
          action: 'updateOption',
          key: 'showUmmyInfo',
          value: mono.global.preference.showUmmyInfo
        });
      });

      details.onCreateUmmyInfo && details.onCreateUmmyInfo(infoContainer);

      return infoContainer;
    },
    bindUmmyInfo: function(container, details) {
      "use strict";
      details = details || {};
      // menu
      if (!details.noUmmy && !mono.global.preference.showUmmyInfo) {
        return;
      }
      if (details.widthLimit && document.documentElement.offsetWidth < details.widthLimit) {
        return;
      }

      details.leftOffset = details.leftOffset || 21;

      var infoPopup = null;
      var infoPopupShowTimer = null;
      var positionTop = null;

      var popupArrowTop = 8;
      var popupArrow = null;
      var popupArrowShadow = null;

      var killTimer = null;
      var killTimerUpdate = function() {
        clearTimeout(killTimer);
        killTimer = setTimeout(function() {
          if (infoPopup && infoPopup.parentNode) {
            if (infoPopup.style.display !== 'none') {
              return killTimerUpdate();
            }
            infoPopup.parentNode.removeChild(infoPopup);
          }
        }, 30 * 1000);
      };

      var fixPosition = function() {
        setTimeout(function() {
          var windowHeight = window.innerHeight;
          var infoHeight = infoPopup.clientHeight;
          var scrollY = window.scrollY;
          if (infoHeight + positionTop > windowHeight + scrollY) {
            var newPositionTop = windowHeight - infoHeight + scrollY;
            if (newPositionTop < 0) {
              return;
            }

            if (positionTop === newPositionTop) {
              return;
            }

            infoPopup.style.top = newPositionTop + 'px';

            var raz = 8 - (windowHeight - (infoHeight + positionTop) + scrollY);
            if (popupArrowTop !== raz) {
              popupArrowTop = raz;
              popupArrow.style.top = popupArrowTop + 'px';
              popupArrowShadow.style.top = popupArrowTop + 'px';
            }
          } else {
            if (popupArrowTop !== 8) {
              popupArrowTop = 8;
              popupArrow.style.top = popupArrowTop + 'px';
              popupArrowShadow.style.top = popupArrowTop + 'px';
            }
          }
        });
      };

      var onMouseLeave = function() {
        clearTimeout(infoPopupShowTimer);
        infoPopupShowTimer = setTimeout(function() {
          infoPopup && (infoPopup.style.display = 'none');
        }, 50);
      };

      var updateLeftPos = function(el) {
        var position = SaveFrom_Utils.getPosition(el);
        if (details.posLeft) {
          infoPopup.style.right = (document.documentElement.clientWidth - position.left - details.leftOffset) + 'px';
        } else {
          var size = SaveFrom_Utils.getSize(el);
          infoPopup.style.left = (size.width + position.left - details.leftOffset) + 'px';
        }
      };

      var onMouseEnter = function() {
        if (!details.noUmmy && !mono.global.preference.showUmmyInfo) {
          return;
        }

        clearTimeout(infoPopupShowTimer);

        var position = SaveFrom_Utils.getPosition(container);

        if (!infoPopup) {
          if (details.expUmmyInfo) {
            infoPopup = details.expUmmyInfo(details.createUmmyInfoDetails, container);
          } else {
            infoPopup = SaveFrom_Utils.createUmmyInfo(details.createUmmyInfoDetails, container);
          }

          popupArrow = infoPopup.firstChild;
          popupArrowShadow = popupArrow.nextElementSibling;

          positionTop = position.top - 4;

          mono.on(infoPopup, 'mouseenter', function() {
            clearTimeout(infoPopupShowTimer);
          });

          mono.on(infoPopup, 'mouseleave', onMouseLeave);
        } else {
          positionTop = position.top - 4;
        }

        infoPopup.style.top = positionTop + 'px';

        if (infoPopup.dataset.hide === '1') {
          return;
        }

        updateLeftPos(container);

        if (!infoPopup.parentNode) {
          infoPopup.style.display = 'none';
          (details.container || document.body).appendChild(infoPopup);
        }

        if (infoPopup.style.display !== 'block') {
          infoPopup.style.display = 'block';
          mono.trigger(infoPopup, 'sfShowInfoPopup');
        }

        fixPosition();

        killTimerUpdate();
      };

      mono.on(container, 'mouseenter', onMouseEnter);
      mono.on(container, 'mouseleave', onMouseLeave);

      mono.on(container, 'sfRmInfoPopup', function() {
        mono.off(container, 'mouseenter', onMouseEnter);
      });

      mono.on(container, 'sfAddInfoPopup', function() {
        mono.on(container, 'mouseenter', onMouseEnter);
      });
    },

    popupMenu: {
      popupId: 'sf_popupMenu',
      popup: undefined,
      popupStyle: undefined,
      dataArrtVisible: 'data-isVisible',
      extStyleCache: undefined,
      ummyIcon: null,

      badgeQualityList: ['8K', '4K', '2160', '1440', '1080', '720', 'ummy'],
      createBadge: function(qulity, options) {
        var _this = this;
        options = options || {};
        var style = {
          display: 'inline-block',
          lineHeight: '18px',
          width: '19px',
          height: '17px',
          color: '#fff',
          fontSize: '12px',
          borderRadius: '2px',
          verticalAlign: 'middle',
          textAlign: 'center',
          paddingRight: '2px',
          fontWeight: 'bold',
          marginLeft: '3px'
        };
        for (var key in options.containerStyle) {
          style[key] = options.containerStyle[key];
        }

        var container = mono.create('div', {
          style: style
        });

        if (qulity === '1080' || qulity === '2160' || qulity === '1440' || qulity === '720') {
          container.textContent = 'HD';
          container.style.backgroundColor = '#505050';
          container.style.paddingRight = '1px';
        } else
        if (qulity === '8K' || qulity === '4K') {
          container.textContent = 'HD';
          container.style.paddingRight = '1px';
          container.style.backgroundColor = 'rgb(247, 180, 6)';
        } else
        if (qulity === 'mp3' || qulity === 'MP3') {
          container.textContent = 'MP3';
          container.style.width = '26px';
          container.style.paddingRight = '1px';
          container.style.backgroundColor = '#505050';
        } else
        if (qulity === 'ummy') {
          if (this.ummyIcon) {
            container.style.background = 'url(' + this.ummyIcon + ') center center no-repeat';
          } else {
            mono.sendMessage({
              action: 'getUmmyIcon'
            }, function(dataImg) {
              container.style.background = 'url(' + (_this.ummyIcon = dataImg) + ') center center no-repeat';
            });
          }
        }
        return container;
      },

      getTitleNode: function(link) {
        "use strict";
        var _this = SaveFrom_Utils.popupMenu;

        var titleContainer = mono.create('span', {
          style: {
            cssFloat: 'left'
          }
        });

        if (link.extra === 'converter') {
          var badge = document.createDocumentFragment();
          if (['MP3', '8K', '4K', '1440', '1080', '720'].indexOf(link.format) !== -1) {
            badge.appendChild(_this.createBadge(link.format, {
              containerStyle: {
                marginLeft: 0
              }
            }));
          } else {
            badge.appendChild(document.createTextNode(link.format));
          }
          mono.create(titleContainer, {
            append: [badge, ' ', link.quality]
          });
          badge = null;
        } else
        if (link.quality === 'ummy') {
          // ummy hook
          var badge = document.createDocumentFragment();
          if (link.uQuality !== null) {
            if (['8K', '4K', '1440', '1080', '720'].indexOf(link.uQuality) !== -1) {
              badge.appendChild(document.createTextNode(link.uQuality));
            } else {
              badge.appendChild(_this.createBadge(link.uQuality, {
                containerStyle: {
                  marginLeft: 0
                }
              }));
            }
          }
          mono.create(titleContainer, {
            append: [badge, ' ', 'Ummy']
          });
          badge = null;
        } else
        if (link.itemText) {
          titleContainer.textContent = link.itemText;
        } else {
          var titleQuality = link.quality ? ' ' + link.quality : '';
          var titleFormat = link.format ? link.format : '???';
          var title3D = link['3d'] ? '3D ' : '';
          var titleFps = '';
          if (link.sFps) {
            titleFps += ' ' + (link.fps || 60);
          }
          titleContainer.textContent = title3D + titleFormat + titleQuality + titleFps;
        }

        if (_this.badgeQualityList.indexOf(String(link.quality)) !== -1) {
          titleContainer.appendChild(_this.createBadge(String(link.quality)));
        }

        return titleContainer;
      },

      createPopupItem: function(listItem, options) {
        var _this = SaveFrom_Utils.popupMenu;

        var href;
        if (typeof listItem === 'string') {
          href = listItem;
        } else {
          href = listItem.href;
        }

        if (href === '-') {
          var line = mono.create('div', {
            style: {
              display: 'block',
              margin: '1px 0',
              borderTop: '1px solid rgb(214, 214, 214)'
            }
          });
          return {
            el: line
          };
        }

        var itemContainer = document.createElement((href === '-text-') ? 'div' : 'a');
        if (options.linkClass) {
          itemContainer.classList.add(options.linkClass);
        }
        var itemContainerStyle = {
          display: 'block',
          padding: '0 5px',
          textDecoration: 'none',
          whiteSpace: 'nowrap',
          overflow: 'hidden'
        };
        if (listItem.isHidden) {
          itemContainer.setAttribute(_this.dataArrtVisible, '0');
          itemContainerStyle.display = 'none';
        }
        SaveFrom_Utils.setStyle(itemContainer, itemContainerStyle);

        if (href === '-text-') {
          itemContainer.style.lineHeight = '22px';
          return {
            el: itemContainer
          };
        }

        itemContainer.href = href;

        if (href === '#') {
          return {
            el: itemContainer
          };
        }

        if (mono.isGM || mono.isOpera || mono.isSafari) {
          if (listItem.quality !== 'ummy' && !listItem.extra) {
            itemContainer.title = mono.global.language.downloadTitle;
          }
        }

        if (listItem.forceDownload) {
          var filename = '';
          if (listItem.title) {
            var ext = listItem.ext;
            if (!ext) {
              ext = listItem.format.toLowerCase();
            }
            filename = listItem.title + '.' + ext;
          }
          itemContainer.setAttribute('download', mono.fileName.modify(filename));
          itemContainer.addEventListener('click', function(event) {
            SaveFrom_Utils.downloadOnClick(event, null, {
              el: this
            });
          }, false);
        }

        var onItemClickList = [];
        if (listItem.func) {
          if (Array.isArray(listItem.func)) {
            onItemClickList.push.apply(onItemClickList, listItem.func);
          } else {
            onItemClickList.push(listItem.func);
          }
        }
        if (options.onItemClick && onItemClickList.indexOf(options.onItemClick) === -1) {
          onItemClickList.push(options.onItemClick);
        }

        if (onItemClickList.length) {
          itemContainer.addEventListener('click', function(e) {
            var _this = this;
            onItemClickList.forEach(function(cb) {
              "use strict";
              return cb.call(_this, e, listItem);
            });
          }, false);
        }

        if (listItem.isBlank) {
          itemContainer.setAttribute('target', '_blank');
        }

        itemContainer.appendChild(_this.getTitleNode(listItem));

        var infoConteiner = mono.create('span', {
          style: {
            cssFloat: 'right',
            lineHeight: '22px',
            height: '22px'
          }
        });
        var sizeIconStyle = {
          top: '5px',
          verticalAlign: 'top'
        };
        for (var key in options.sizeIconStyle) {
          sizeIconStyle[key] = options.sizeIconStyle[key];
        }
        var sizeIconTextStyle = {
          marginLeft: 0
        };

        if (listItem.noAudio) {
          SaveFrom_Utils.appendNoSoundIcon(infoConteiner, sizeIconStyle);
        }

        var sizeIconNode = null;
        if (!listItem.noSize) {
          infoConteiner.addEventListener('click', function onClick(e) {
            if (infoConteiner.firstChild.tagName === 'IMG') {
              e.preventDefault();
              e.stopPropagation();
              mono.trigger(infoConteiner.firstChild, 'click', {
                cancelable: true
              });
            }
            this.removeEventListener('click', onClick);
          });
          sizeIconNode = SaveFrom_Utils.appendFileSizeIcon(itemContainer, sizeIconStyle, sizeIconTextStyle, undefined, true, infoConteiner, listItem);
        }

        itemContainer.appendChild(infoConteiner);

        if (listItem.quality === 'ummy') {
          var bInfoDetails = mono.extend({}, options.bindUmmyInfoDetails);
          var cInfoDetails = bInfoDetails.createUmmyInfoDetails = mono.extend({
            itemType: listItem.uIsAudio ? 'mp3' : 'hd'
          }, bInfoDetails.createUmmyInfoDetails);
          cInfoDetails.params = mono.extend({
            video: listItem.videoId,
            vid: listItem.vid
          }, cInfoDetails.params);
          SaveFrom_Utils.bindUmmyInfo(itemContainer, bInfoDetails);
        }

        return {
          el: itemContainer,
          sizeIcon: sizeIconNode,
          prop: listItem
        };
      },

      sortMenuItems: function(list, options) {
        if (options === undefined) {
          options = {};
        }
        var formatPriority = ['ummy', 'Audio Opus', 'Audio Vorbis', 'Audio AAC', '3GP', 'WebM', 'FLV', 'MP4'];
        var strQuality = {
          Mobile: 280,
          LD: 280,
          SD: 360,
          HD: 720,
          ummy: 1
        };
        if (options.strQualityExtend) {
          mono.extend(strQuality, options.strQualityExtend);
        }
        var sizePriority = {};
        var bitratePriority = [];
        var defList = [];
        var audioList = [];
        var subtitleList = [];
        var mute60List = [];
        var muteList = [];
        var _3dList = [];
        var unkList = [];

        list.forEach(function(item) {
          var prop = item.prop;
          if (options.noProp) {
            prop = item;
          }
          var sortOptions = prop.sort || {};
          if (!prop.format) {
            unkList.push(item);
            return 1;
          }
          if (prop.isOther) {
            unkList.push(item);
          } else
          if (prop.isSubtitle) {
            subtitleList.push(item);
          } else
          if (prop.noVideo) {
            bitratePriority[prop.quality] = parseInt(prop.quality);
            audioList.push(item);
          } else {
            var size = sortOptions.size || strQuality[prop.quality] || -1;
            if (size === -1) {
              if (String(prop.quality).substr(-1) === 'K') {
                size = parseInt(prop.quality) * 1000;
              } else {
                size = parseInt(prop.quality);
              }
            }
            if (options.maxSize && size > options.maxSize) {
              return 1;
            }
            if (options.minSize && size < options.minSize) {
              return 1;
            }
            sizePriority[prop.quality] = size;
            if (prop.noAudio) {
              if (prop.sFps) {
                mute60List.push(item);
              } else {
                muteList.push(item);
              }
            } else
            if (prop['3d']) {
              _3dList.push(item);
            } else {
              defList.push(item);
            }
          }
        });
        var sizeCompare = function(a, b) {
          return sizePriority[a.quality] > sizePriority[b.quality] ? -1 : sizePriority[a.quality] === sizePriority[b.quality] ? 0 : 1;
        };
        var bitrateCompare = function(a, b) {
          return bitratePriority[a.quality] > bitratePriority[b.quality] ? -1 : (bitratePriority[a.quality] === bitratePriority[b.quality]) ? 0 : 1;
        };
        var formatCompare = function(a, b) {
          if (a.noVideo && b.noVideo) {
            return bitrateCompare(a, b);
          }
          if (a.noVideo) {
            return 1;
          }
          if (b.noVideo) {
            return -1;
          }
          return formatPriority.indexOf(a.format) > formatPriority.indexOf(b.format) ? -1 : formatPriority.indexOf(a.format) === formatPriority.indexOf(b.format) ? 0 : 1;
        };

        var compare = function(aa, bb) {
          var a = aa.prop;
          var b = bb.prop;
          if (options.noProp) {
            a = aa;
            b = bb;
          }

          var size = sizeCompare(a, b);
          if (size !== 0) {
            return size;
          }
          return formatCompare(a, b);
        };
        defList.sort(compare);
        _3dList.sort(compare);
        audioList.sort(compare);
        mute60List.sort(compare);
        muteList.sort(compare);

        var resList = null;
        if (options.typeList) {
          resList = [];
          if (options.typeList.indexOf('video') !== -1) {
            resList = resList.concat(defList);
          }
          if (options.typeList.indexOf('3d') !== -1) {
            resList = resList.concat(_3dList);
          }
          if (options.typeList.indexOf('audio') !== -1) {
            resList = resList.concat(audioList);
          }
          if (options.typeList.indexOf('mute') !== -1) {
            resList = resList.concat(muteList);
          }
          if (options.typeList.indexOf('mute60') !== -1) {
            resList = resList.concat(mute60List);
          }
          if (options.typeList.indexOf('subtitles') !== -1) {
            resList = resList.concat(subtitleList);
          }
          if (options.typeList.indexOf('other') !== -1) {
            resList = resList.concat(unkList);
          }
        } else {
          resList = defList.concat(_3dList, audioList, subtitleList, mute60List, muteList, unkList);
        }
        if (options.groupCompare) {
          resList.sort(compare);
        }
        return resList;
      },

      removePanel: function() {
        if (this.popup.parentNode !== null) {
          this.popup.parentNode.removeChild(this.popup);
        }
        if (this.popupStyle !== undefined && this.popupStyle.parentNode !== null) {
          this.popupStyle.parentNode.removeChild(this.popupStyle);
        }
        this.popup = undefined;
        this.popupStyle = undefined;
      },

      getHiddenList: function(hiddenList, options) {
        "use strict";
        var _this = this;
        var content = document.createDocumentFragment();
        var scrollListItemCount = 8;
        if (hiddenList.length < scrollListItemCount) {
          mono.create(content, {
            append: hiddenList
          });
        } else {
          var scrollContainer = mono.create('div', {
            style: {
              maxHeight: (scrollListItemCount * 24) + 'px',
              overflowY: 'scroll',
              display: 'none'
            },
            on: [
              ['wheel', function(e) {
                if (e.wheelDeltaY > 0 && this.scrollTop === 0) {
                  e.preventDefault();
                } else
                if (e.wheelDeltaY < 0 && this.scrollHeight - (this.offsetHeight + this.scrollTop) <= 0) {
                  e.preventDefault();
                }
              }],
              (function() {
                var hasTopShadow = false;
                return ['scroll', function() {
                  if (this.scrollTop !== 0) {
                    if (hasTopShadow) {
                      return;
                    }
                    hasTopShadow = true;
                    this.style.boxShadow = 'rgba(0, 0, 0, 0.40) -2px 1px 2px 0px inset';
                  } else {
                    if (!hasTopShadow) {
                      return;
                    }
                    hasTopShadow = false;
                    this.style.boxShadow = '';
                  }
                }];
              })()
            ],
            append: hiddenList
          });
          scrollContainer.setAttribute(_this.dataArrtVisible, '0');

          content.appendChild(scrollContainer);
        }

        var separator = _this.createPopupItem('-', options).el;
        content.appendChild(separator);

        var moreItem = _this.createPopupItem('#', options).el;
        mono.create(moreItem, {
          text: mono.global.language.more + ' ' + String.fromCharCode(187), //171 //160 - space
          data: {
            visible: '0'
          },
          on: ['click', function(e) {
            e.preventDefault();
            var state = this.dataset.visible;
            var symbol;
            if (state > 0) {
              state--;
              symbol = 187;
            } else {
              state++;
              symbol = 171;
            }
            this.textContent = mono.global.language.more + ' ' + String.fromCharCode(symbol);
            this.dataset.visible = state;
            var itemList = this.parentNode.querySelectorAll('*[' + _this.dataArrtVisible + ']');
            for (var i = 0, item; item = itemList[i]; i++) {
              if (state === 1) {
                item.style.display = 'block';
              } else {
                item.style.display = 'none';
              }
              item.setAttribute(_this.dataArrtVisible, state);
            }
          }]
        });
        content.appendChild(moreItem);

        if (options.visibleCount === 0) {
          mono.trigger(moreItem, 'click', {
            cancelable: true
          });
        }

        return content;
      },

      getContent: function(options) {
        "use strict";
        var _this = this;
        var links = options.links;

        var content = document.createDocumentFragment();

        var sizeIconList = [];

        if (typeof(links) === 'string') {
          var loadingItem = _this.createPopupItem('-text-', options).el;
          loadingItem.textContent = links;
          content.appendChild(loadingItem);
        } else
        if (links.length === 0) {
          var emptyItem = _this.createPopupItem('-text-', options).el;
          emptyItem.textContent = mono.global.language.noLinksFound;
          content.appendChild(emptyItem);
        } else {
          var items = [];
          links.forEach(function(link) {
            items.push(_this.createPopupItem(link, options));
          });

          items = _this.sortMenuItems(items, options.sortDetails);

          var hiddenList = [];

          items.forEach(function(item) {
            if (item.prop.isHidden) {
              hiddenList.push(item.el);
              return 1;
            }

            content.appendChild(item.el);

            if (options.showFileSize && item.sizeIcon) {
              sizeIconList.push(item.sizeIcon);
            }
          });

          options.visibleCount = items.length - hiddenList.length;

          if (hiddenList.length > 0) {
            if (options.getHiddenListFunc) {
              content.appendChild(options.getHiddenListFunc(hiddenList, options));
            } else {
              content.appendChild(_this.getHiddenList(hiddenList, options));
            }
          }
        }

        return {
          sizeIconList: sizeIconList,
          content: content
        };
      },

      create: function(options) {
        var button = options.button;
        var _this = SaveFrom_Utils.popupMenu;

        options.linkClass = options.linkClass || 'sf-menu-item';

        options.offsetRight = options.offsetRight || 0;
        options.offsetTop = options.offsetTop || 0;

        options.parent = options.parent || document.body;

        if (options.isUpdate && (_this.popup === undefined || _this.popup.style.display === 'none')) {
          return;
        }

        if (_this.popup) {
          _this.removePanel();
        }

        var popupContainer = _this.popup = document.createElement('div');
        var containerSelector = '#' + _this.popupId;
        if (options.popupId) {
          containerSelector = '#' + options.popupId;
          popupContainer.id = options.popupId;
        } else
        if (options.containerClass) {
          containerSelector = '.' + options.containerClass;
          popupContainer.classList.add(options.containerClass);
        } else {
          popupContainer.id = _this.popupId;
        }

        var popupContainerStyle = {
          display: 'block',
          position: 'absolute',
          minHeight: '24px',
          cursor: 'default',
          textAlign: 'left',
          whiteSpace: 'nowrap',
          fontFamily: 'arial, sans-serif'
        };
        if (options.extStyle) {
          delete popupContainerStyle.display;
        }

        var pos = SaveFrom_Utils.getPosition(button, options.parent),
          size = SaveFrom_Utils.getSize(button);

        popupContainerStyle.top = (pos.top + options.offsetTop + size.height) + 'px';
        popupContainerStyle.left = (pos.left + options.offsetRight) + 'px';
        SaveFrom_Utils.setStyle(popupContainer, popupContainerStyle);

        var popupCustomContainerStyle = {
          'background-color': '#fff',
          'z-index': '9999',
          'box-shadow': '0 2px 10px 0 rgba(0,0,0,0.2)',
          border: '1px solid #ccc',
          'border-radius': '3px',
          'font-size': '12px',
          'font-weight': 'bold',
          'min-width': '190px'
        };

        if (options.style && options.style.popup) {
          for (var key in options.style.popup) {
            var value = options.style.popup[key];
            popupCustomContainerStyle[key] = value;
          }
        }

        SaveFrom_Utils.addStyleRules(containerSelector, popupCustomContainerStyle);

        var itemCustomStyle = {
          'line-height': '24px',
          color: '#3D3D3D'
        };

        if (options.style && options.style.item) {
          for (var key in options.style.item) {
            var value = options.style.item[key];
            itemCustomStyle[key] = value;
          }
        }

        SaveFrom_Utils.addStyleRules(containerSelector + ' .' + options.linkClass, itemCustomStyle);

        var stopPropagationFunc = function(e) {
          e.stopPropagation()
        };
        mono.create(popupContainer, {
          on: [
            ['click', stopPropagationFunc],
            ['mouseover', stopPropagationFunc],
            ['mouseup', stopPropagationFunc],
            ['mousedown', stopPropagationFunc],
            ['mouseout', stopPropagationFunc]
          ]
        });

        while (popupContainer.firstChild !== null) {
          popupContainer.removeChild(popupContainer.firstChild);
        }

        var menuContent = _this.getContent.call(_this, options);
        var sizeIconList = menuContent.sizeIconList;
        menuContent = menuContent.content;
        popupContainer.appendChild(menuContent);


        var hoverBgColor = '#2F8AFF';
        var hoverTextColor = '#fff';
        if (options.style && options.style.hover) {
          hoverBgColor = options.style.hover.backgroundColor || hoverBgColor;
          hoverTextColor = options.style.hover.color || hoverTextColor;
        }
        var styleEl = _this.popupStyle = document.createElement('style');
        styleEl.textContent = mono.style2Text({
          selector: containerSelector,
          append: {
            'a:hover': {
              backgroundColor: hoverBgColor,
              color: hoverTextColor
            },
            '> a:first-child': {
              borderTopLeftRadius: '3px',
              borderTopRightRadius: '3px'
            },
            '> a:last-child': {
              borderBottomLeftRadius: '3px',
              borderBottomRightRadius: '3px'
            }
          }
        });

        options.parent.appendChild(styleEl);
        options.parent.appendChild(popupContainer);
        if (options.extStyle) {
          if (SaveFrom_Utils.popupMenu.extStyleCache !== undefined && SaveFrom_Utils.popupMenu.extStyleCache.parentNode !== null) {
            SaveFrom_Utils.popupMenu.extStyleCache.parentNode.removeChild(SaveFrom_Utils.popupMenu.extStyleCache);
          }

          var extElClassName = 'sf-extElStyle_' + containerSelector.substr(1);
          var extBodyClassName = 'sf-extBodyStyle_' + containerSelector.substr(1);
          var extBodyStyle = document.querySelector('style.' + extBodyClassName);
          if (extBodyStyle === null) {
            document.body.appendChild(mono.create('style', {
              class: extBodyClassName,
              text: mono.style2Text({
                selector: containerSelector,
                style: {
                  display: 'none'
                }
              })
            }));
          }
          SaveFrom_Utils.popupMenu.extStyleCache = options.extStyle.appendChild(mono.create('style', {
            class: extElClassName,
            text: mono.style2Text({
              selector: 'body ' + containerSelector,
              style: {
                display: 'block'
              }
            })
          }));
        }

        setTimeout(function() {
          sizeIconList.forEach(function(icon) {
            mono.trigger(icon, 'click', {
              bubbles: false,
              cancelable: true
            });
          });
        });

        return popupContainer;
      },

      update: function(popupContainer, options) {
        var _this = SaveFrom_Utils.popupMenu;

        while (popupContainer.firstChild !== null) {
          popupContainer.removeChild(popupContainer.firstChild);
        }

        var menuContent = _this.getContent.call(_this, options);
        var sizeIconList = menuContent.sizeIconList;
        menuContent = menuContent.content;
        popupContainer.appendChild(menuContent);

        setTimeout(function() {
          sizeIconList.forEach(function(icon) {
            mono.trigger(icon, 'click', {
              bubbles: false,
              cancelable: true
            });
          });
        });
      },

      preprocessItem: {
        srt2url: function(item, popupLink) {
          "use strict";
          var srt = item.srt;
          var blobUrl = null;

          if (typeof URL !== 'undefined' && typeof Blob !== "undefined" && !mono.isSafari) {
            var blob = new Blob([srt], {
              encoding: "UTF-8",
              type: 'text/plain'
            });
            blobUrl = URL.createObjectURL(blob);
          } else {
            var srtUTF8 = SaveFrom_Utils.utf8Encode(srt);
            blobUrl = 'data:text/plain;charset=utf-8;base64,' + encodeURIComponent(btoa(srtUTF8))
          }

          popupLink.ext = 'srt';
          popupLink.format = 'SRT';
          popupLink.href = blobUrl;
          popupLink.noSize = true;
          if (mono.isOpera || mono.isFF) {
            popupLink.forceDownload = false;
          }
        }
      },

      prepareLinks: {
        youtube: function(links, title, subtitles, details) {
          details = details || {};
          subtitles = subtitles || [];
          links = mono.extend({}, links);
          var sfUtilsYt = SaveFrom_Utils.video.yt;
          sfUtilsYt.init();

          var menuLinks = [];
          var popupLink = null;
          var meta = links.meta || {};

          Object.keys(sfUtilsYt.format).forEach(function(format) {
            var formatObj = sfUtilsYt.format[format];
            return Object.keys(formatObj).forEach(function(itag) {
              var url = links[itag];
              if (!url) {
                return;
              }

              var isHidden = false;

              if (!sfUtilsYt.showFormat[format]) {
                isHidden = true;
              }

              var prop = formatObj[itag];

              if (prop['3d'] && !sfUtilsYt.show3D) {
                isHidden = true;
              }

              if (prop.noAudio && !sfUtilsYt.showMP4NoAudio) {
                isHidden = true;
              }

              popupLink = {
                href: url,
                isHidden: isHidden,
                title: title,
                format: format,
                itag: itag
              };

              mono.extend(popupLink, prop);

              var metaTag = meta[itag];
              if (metaTag) {
                if (metaTag.quality) {
                  popupLink.quality = metaTag.quality;
                }

                if (metaTag.fps) {
                  popupLink.fps = metaTag.fps;
                }
              }

              if (prop.noVideo || prop.noAudio) {
                popupLink.forceDownload = true;
              }

              menuLinks.push(popupLink);
              delete links[itag];
            });
          });


          (links.ummy || links.ummyAudio) && (function() {
            var qualityBadge = null;
            var qualityIndex = -1;
            var badgeQualityList = SaveFrom_Utils.popupMenu.badgeQualityList;
            menuLinks.forEach(function(popupLink) {
              var qIndex = badgeQualityList.indexOf(popupLink.quality);
              if (qIndex !== -1 && (qualityIndex === -1 || qIndex < qualityIndex)) {
                qualityIndex = qIndex;
              }
            });
            if (qualityIndex !== -1) {
              qualityBadge = badgeQualityList[qualityIndex];
            }

            var videoId = meta.videoId;
            videoId && ['ummy', 'ummyAudio'].forEach(function(itag) {
              var url = links[itag];
              if (!url) {
                return;
              }

              popupLink = {
                href: url,
                quality: 'ummy',
                noSize: true,
                format: 'ummy',
                videoId: 'yt-' + videoId
              };

              if (itag === 'ummy') {
                popupLink.itag = 'ummy';
                popupLink.uQuality = qualityBadge;
              } else
              if (itag === 'ummyAudio') {
                popupLink.itag = 'ummyAudio';
                popupLink.uQuality = 'mp3';
                popupLink.uIsAudio = true;
              }

              if (details.ummyVid) {
                popupLink.vid = details.ummyVid;
              }

              menuLinks.push(popupLink);
              delete links[itag];
            });
          })();

          Object.keys(links).forEach(function(itag) {
            if (itag === 'meta') {
              return;
            }

            popupLink = {
              href: links[itag],
              isHidden: true,
              title: title,
              quality: itag,
              itag: itag,
              forceDownload: true
            };

            menuLinks.push(popupLink);
            delete links[itag];
          });

          subtitles.forEach(function(item) {
            "use strict";
            popupLink = {
              href: item.url,
              isHidden: true,
              quality: 'SRT' + (item.isAuto ? 'A' : ''),
              itemText: mono.global.language.subtitles + ' (' + item.lang + ')',
              title: title + '-' + item.langCode,
              ext: 'vtt',
              format: 'VTT',
              isSubtitle: true,
              langCode: item.langCode,
              forceDownload: true
            };

            if (item.preprocess === 'srt2url') {
              SaveFrom_Utils.popupMenu.preprocessItem.srt2url(item, popupLink);
            }

            menuLinks.push(popupLink);
          });

          meta.extra && meta.extra.forEach(function(item) {
            popupLink = {
              href: '#' + item.extra,
              noSize: true,
              isHidden: false
            };

            mono.extend(popupLink, item);

            if (item.itag) {
              Object.keys(sfUtilsYt.format).some(function(format) {
                var formatObj = sfUtilsYt.format[format];
                var prop = formatObj[item.itag];
                if (prop) {
                  mono.extend(popupLink, prop);
                  return true;
                }
              });
            }

            if (item.request) {
              popupLink.func = function(e) {
                e.preventDefault();
                return mono.sendMessage(item.request);
              };
            }

            popupLink.noAudio = false;

            menuLinks.push(popupLink);
          });

          return menuLinks;
        },
        vimeo: function(links, title) {
          var menuLinks = [];
          var popupLink;
          links.forEach(function(link) {
            var ext = link.ext;
            if (!ext) {
              ext = 'mp4';
              if (link.url.search(/\.flv($|\?)/i) != -1) {
                ext = 'flv';
              }
            }
            var quality = link.height || '';
            var format = link.type;
            popupLink = {
              href: link.url,
              title: title,
              ext: ext,
              format: format,
              quality: quality,
              forceDownload: true
            };
            menuLinks.push(popupLink);
          });
          return menuLinks;
        },
        vk: function(links, title) {
          var menuLinks = [];
          var popupLink;
          links.forEach(function(link) {
            var ext = link.name || link.ext;
            var format = ext && ext.toUpperCase() || '';
            var quality = link.subname || '';
            popupLink = {
              href: link.url,
              title: title,
              ext: ext,
              format: format,
              quality: quality,
              forceDownload: true
            };
            menuLinks.push(popupLink);
          });
          return menuLinks;
        },
        dailymotion: function(links, title) {
          var menuLinks = [];

          links.forEach(function(link) {
            var popupLink = null;
            if (link.extra === 'ummy') {
              popupLink = {
                href: link.url,
                quality: 'ummy',
                noSize: true,
                format: 'ummy',
                videoId: link.videoId,
                sort: {
                  size: 480
                }
              };

              if (link.type === 'ummyAudio') {
                popupLink.uQuality = 'mp3';
                popupLink.uIsAudio = true;
              }
            } else {
              popupLink = {
                href: link.url,
                title: title,
                ext: link.ext,
                format: link.ext,
                quality: link.height || '',
                forceDownload: true
              };

              if (mono.isOpera) {
                popupLink.noSize = true;
              }
            }

            menuLinks.push(popupLink);
          });

          return menuLinks;
        },
        facebook: function(links, title) {
          var menuLinks = [];
          var popupLink;
          links.forEach(function(link) {
            var ext = link.ext;
            var format = (ext) ? ext.toUpperCase() : '';
            var quality = link.name;
            popupLink = {
              href: link.url,
              title: title,
              ext: ext,
              format: format,
              quality: quality,
              forceDownload: true
            };
            menuLinks.push(popupLink);
          });
          return menuLinks;
        },
        rutube: function(href) {
          "use strict";
          if (Array.isArray(href)) {
            href = href[0];
          }
          if (typeof href !== 'string') {
            return;
          }
          var links = [];

          var videoId = href.match(/\/embed\/(\d+)/);
          videoId = videoId && videoId[1] || undefined;

          if (!videoId) {
            videoId = href.match(/\/video\/([0-9a-z]+)/);
            videoId = videoId && videoId[1] || undefined;
          }

          if (/\/\/video\./.test(href)) {
            href = href.replace(/\/\/video\./, '//');
            if (!videoId) {
              videoId = href.match(/\/(\d+)$/);
              videoId = videoId && videoId[1] || undefined;
            }
          }

          if (videoId) {
            videoId = 'rt-' + videoId;
          }

          var ummyUrl = href.replace(/^.*(\/\/.*)$/, 'ummy:$1');

          var videoLink = {
            href: ummyUrl,
            quality: 'ummy',
            noSize: true,
            format: 'ummy',
            itag: 'ummy',
            uQuality: '720',
            vid: 114,
            videoId: videoId
          };

          var sep = '?';
          if (ummyUrl.indexOf(sep) !== -1) {
            sep = '&';
          }
          ummyUrl += sep + 'sf_type=audio';

          var audioLink = {
            href: ummyUrl,
            quality: 'ummy',
            noSize: true,
            format: 'ummy',
            itag: 'ummyAudio',
            uQuality: 'mp3',
            uIsAudio: true,
            vid: 114,
            videoId: videoId
          };

          links.push(videoLink);
          links.push(audioLink);

          return links;
        },
        mailru: function(links, title) {
          var menuLinks = [];
          var popupLink;
          links.forEach(function(link) {
            var ext = link.ext;
            var format = link.name;
            var quality = link.subname;
            popupLink = {
              href: link.url,
              title: title,
              ext: ext,
              format: format,
              quality: quality,
              forceDownload: true
            };
            menuLinks.push(popupLink);
          });
          return menuLinks;
        }
      },

      /**
       * @param {Node|Element} target
       * @param {String|Array} links
       * @param {String} id
       * @param {Object} [_details]
       * @returns {{isShow: boolean, el: Node|Element, hide: Function, update: Function}}
       */
      quickInsert: function(target, links, id, _details) {
        _details = _details || {};
        var result = {};

        var hideMenu = function(e) {
          if (e && (e.target === target || target.contains(e.target))) {
            return;
          }

          if (!result.isShow) {
            return;
          }

          menu.style.display = 'none';
          mono.off(document, 'mousedown', hideMenu);
          result.isShow = false;
          _details.onHide && _details.onHide(menu);
        };

        var options = {
          links: links,
          button: target,
          popupId: id,
          showFileSize: true
            /*
             parent: args.parent,
             extStyle: args.extStyle,
             offsetRight: args.offsetRight,
             offsetTop: args.offsetTop,
             onItemClick: args.onItemClick
             */
        };

        mono.extend(options, _details);

        var menu = SaveFrom_Utils.popupMenu.create(options);

        _details.onShow && _details.onShow(menu);

        mono.off(document, 'mousedown', hideMenu);
        mono.on(document, 'mousedown', hideMenu);

        return mono.extend(result, {
          button: target,
          isShow: true,
          el: menu,
          hide: hideMenu,
          update: function(links) {
            options.links = links;
            SaveFrom_Utils.popupMenu.update(menu, options)
          }
        });
      }
    },

    frameMenu: {
      getBtn: function(details) {
        "use strict";
        var containerStyle = {
          verticalAlign: 'middle',
          position: 'absolute',
          zIndex: 999,
          fontFamily: 'arial, sans-serif'
        };

        for (var key in details.containerStyle) {
          containerStyle[key] = details.containerStyle[key];
        }

        var quickBtnStyle = details.quickBtnStyleObj || {
          display: 'inline-block',
          fontSize: 'inherit',
          height: '22px',
          border: '1px solid rgba(255, 255, 255, 0.4)',
          borderRadius: '3px',
          borderTopRightRadius: 0,
          borderBottomRightRadius: 0,
          paddingRight: 0,
          paddingLeft: '28px',
          cursor: 'pointer',
          verticalAlign: 'middle',
          position: 'relative',
          lineHeight: '22px',
          textDecoration: 'none',
          zIndex: 1,
          color: '#fff'
        };

        if (details.singleBtn && !details.quickBtnStyleObj) {
          delete quickBtnStyle.borderTopRightRadius;
          delete quickBtnStyle.borderBottomRightRadius;
        }

        var selectBtnStyle = {
          position: 'relative',
          display: 'inline-block',
          fontSize: 'inherit',
          height: '24px',
          padding: 0,
          paddingRight: '21px',
          border: '1px solid rgba(255, 255, 255, 0.4)',
          borderLeft: 0,
          borderRadius: '3px',
          borderTopLeftRadius: '0',
          borderBottomLeftRadius: '0',
          cursor: 'pointer',
          color: '#fff',
          zIndex: 0,
          verticalAlign: 'middle',
          marginLeft: 0
        };

        for (var key in details.selectBtnStyle) {
          selectBtnStyle[key] = details.selectBtnStyle[key];
        }

        var quickBtnIcon = details.quickBtnIcon || mono.create('i', {
          style: {
            position: 'absolute',
            display: 'inline-block',
            left: '6px',
            top: '3px',
            backgroundImage: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#ffffff') + ')',
            backgroundSize: '12px',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center',
            width: '16px',
            height: '16px'
          }
        });

        var selectBtnIcon = details.selectBtnIcon || mono.create('i', {
          style: {
            position: 'absolute',
            display: 'inline-block',
            top: '9px',
            right: '6px',
            border: '5px solid #FFF',
            borderBottomColor: 'transparent',
            borderLeftColor: 'transparent',
            borderRightColor: 'transparent'
          }
        });

        var quickBtn;

        var btnContainer = mono.create('div', {
          id: details.btnId,
          style: containerStyle,
          on: details.on,
          append: [
            quickBtn = mono.create('a', {
              class: 'sf-quick-btn',
              style: quickBtnStyle,
              href: '#',
              append: [
                quickBtnIcon
              ]
            }),
            mono.create('style', {
              text: mono.style2Text({
                selector: '#' + details.btnId,
                style: details.nodeCssStyle || {
                  opacity: 0.8,
                  display: 'none'
                },
                append: [{
                  'button::-moz-focus-inner': {
                    padding: 0,
                    margin: 0
                  },
                  '.sf-quick-btn': details.quickBtnCssStyle || {
                    backgroundColor: 'rgba(28,28,28,0.1)'
                  },
                  '.sf-select-btn': {
                    backgroundColor: 'rgba(28,28,28,0.1)'
                  }
                }, {
                  selector: [':hover', '.sf-over'],
                  join: '',
                  style: {
                    opacity: 1
                  },
                  append: {
                    '.sf-quick-btn': details.quickBtnOverCssStyle || {
                      backgroundColor: 'rgba(0, 163, 80, 0.5)'
                    },
                    '.sf-select-btn': {
                      backgroundColor: 'rgba(60, 60, 60, 0.5)'
                    }
                  }
                }, {
                  join: '',
                  '.sf-over': {
                    append: {
                      '.sf-select-btn': {
                        backgroundColor: 'rgba(28,28,28,0.8)'
                      }
                    }
                  },
                  '.sf-show': {
                    display: 'block'
                  }
                }]
              })
            })
          ]
        });

        var selectBtn = null;
        var setQuality = null;
        if (!details.singleBtn) {
          setQuality = function(text) {
            var node = typeof text === 'object' ? text : document.createTextNode(text);
            var first = selectBtn.firstChild;
            if (first === selectBtnIcon) {
              selectBtn.insertBefore(node, first);
            } else {
              selectBtn.replaceChild(node, first);
            }
          };
          selectBtn = mono.create('button', {
            class: 'sf-select-btn',
            style: selectBtnStyle,
            on: details.onSelectBtn,
            append: [
              selectBtnIcon
            ]
          });
          btnContainer.appendChild(selectBtn);
        }

        return {
          node: btnContainer,
          setQuality: setQuality,
          setLoadingState: function() {
            setQuality(mono.create('img', {
              src: SaveFrom_Utils.svg.getSrc('info', '#ffffff'),
              style: {
                width: '14px',
                height: '14px',
                marginLeft: '6px',
                verticalAlign: 'middle',
                top: '-1px',
                position: 'relative'
              }
            }));
          },
          selectBtn: selectBtn,
          quickBtn: quickBtn
        };
      },

      getHiddenList: function(hiddenList, options) {
        "use strict";
        var popupMenu = SaveFrom_Utils.popupMenu;
        var moreBtn = popupMenu.createPopupItem('-text-', options).el;
        mono.create(moreBtn, {
          text: mono.global.language.more + ' ' + String.fromCharCode(187),
          style: {
            cursor: 'pointer'
          },
          on: ['click', function() {
            var content = this.parentNode;
            var itemList = content.querySelectorAll('*[' + popupMenu.dataArrtVisible + ']');
            for (var i = 0, item; item = itemList[i]; i++) {
              item.style.display = 'block';
              item.setAttribute(popupMenu.dataArrtVisible, 1);
            }
            this.parentNode.removeChild(this);
            /*content.replaceChild(mono.create('i', {
              class: 'sf-separator'
            }), this);*/
          }]
        });

        var content = document.createDocumentFragment();
        content.appendChild(moreBtn);

        mono.create(content, {
          append: hiddenList
        });

        if (options.visibleCount === 0) {
          mono.trigger(moreBtn, 'click', {
            cancelable: true
          });
        }

        return content;
      },

      getMenuContainer: function(options) {
        "use strict";
        var popupMenu = SaveFrom_Utils.popupMenu;
        var button = options.button;
        var popupId = options.popupId;

        var container = mono.create('div', {
          style: {
            position: 'absolute',
            minHeight: '24px',
            cursor: 'default',
            textAlign: 'left',
            whiteSpace: 'nowrap',
            overflow: 'auto'
          }
        });

        if (popupId[0] === '#') {
          container.id = popupId.substr(1);
        } else {
          container.classList.add(popupId);
        }

        var menuContent = popupMenu.getContent(options);
        container.appendChild(menuContent.content);

        setTimeout(function() {
          menuContent.sizeIconList.forEach(function(icon) {
            mono.trigger(icon, 'click', {
              bubbles: false,
              cancelable: true
            });
          });
        });

        var pos = SaveFrom_Utils.getPosition(button, options.parent);
        var size = SaveFrom_Utils.getSize(button);

        var stopPropagationFunc = function(e) {
          e.stopPropagation()
        };

        var topOffset = pos.top + size.height;
        var menuStyle = {
          top: topOffset + 'px',
          maxHeight: (document.body.offsetHeight - topOffset - 40) + 'px'
        };

        if (options.leftMenuPos) {
          menuStyle.left = pos.left + 'px';
        } else {
          menuStyle.right = (document.body.offsetWidth - pos.left - size.width) + 'px';
        }

        mono.create(container, {
          style: menuStyle,
          on: [
            ['click', stopPropagationFunc],
            ['mouseover', stopPropagationFunc],
            ['mouseup', stopPropagationFunc],
            ['mousedown', stopPropagationFunc],
            ['mouseout', stopPropagationFunc],
            ['wheel', function(e) {
              if (e.wheelDeltaY > 0 && this.scrollTop === 0) {
                e.preventDefault();
              } else
              if (e.wheelDeltaY < 0 && this.scrollHeight - (this.offsetHeight + this.scrollTop) <= 0) {
                e.preventDefault();
              }
            }]
          ],
          append: [
            mono.create('style', {
              text: mono.style2Text({
                selector: (popupId[0] === '#' ? '' : '.') + popupId,
                style: {
                  display: 'none',
                  fontFamily: 'arial, sans-serif',

                  backgroundColor: 'rgba(28,28,28,0.8)',
                  zIndex: 9999,
                  borderRadius: '4px',
                  fontSize: '12px',
                  fontWeight: 'bold',
                  minWidth: '190px',
                  color: '#fff'
                },
                append: [{
                  join: '',
                  '.sf-show': {
                    display: 'block'
                  },
                  '::-webkit-scrollbar-track': {
                    backgroundColor: '#424242'
                  },
                  '::-webkit-scrollbar': {
                    width: '10px',
                    backgroundColor: '#424242'
                  },
                  '::-webkit-scrollbar-thumb': {
                    backgroundColor: '#8e8e8e'
                  }
                }, {
                  '.sf-menu-item': {
                    lineHeight: '24px',
                    color: '#fff'
                  },
                  '.sf-menu-item:hover': {
                    backgroundColor: '#1c1c1c'
                  }
                }]
              })
            })
          ]
        });

        return container;
      },
      getMenu: function(target, links, id, _options) {
        "use strict";
        var options = {
          links: links,
          button: target,
          popupId: id || '#sf-frame-menu',
          showFileSize: true,
          sizeIconStyle: {
            color: '#fff'
          },
          linkClass: 'sf-menu-item',
          bindUmmyInfoDetails: {
            posLeft: true,
            widthLimit: 480,
            container: _options.container,
            createUmmyInfoDetails: {
              posLeft: true,
              darkTheme: true
            }
          },
          getHiddenListFunc: this.getHiddenList.bind(this)
        };

        for (var key in _options) {
          options[key] = _options[key];
        }

        var menu = this.getMenuContainer(options);

        (options.container || document.body).appendChild(menu);

        var hideMenu = function() {
          if (menu.parentNode) {
            menu.parentNode.removeChild(menu);
          }
          out.isShow = false;
          options.onHide && options.onHide();
        };

        options.onShow && options.onShow(menu);

        mono.off(document, 'mousedown', hideMenu);
        mono.on(document, 'mousedown', hideMenu);

        var out = {
          isShow: true,
          el: menu,
          hide: hideMenu,
          update: function(links) {
            var popupMenu = SaveFrom_Utils.popupMenu;
            var style = menu.lastChild;
            menu.textContent = '';

            options.links = links;
            var menuContent = popupMenu.getContent(options);

            setTimeout(function() {
              menuContent.sizeIconList.forEach(function(icon) {
                mono.trigger(icon, 'click', {
                  bubbles: false,
                  cancelable: true
                });
              });
            });

            menu.appendChild(menuContent.content);
            menu.appendChild(style);
          }
        };

        return out;
      }
    },

    mobileLightBox: {
      id: 'sf-lightbox',
      clear: function() {
        var el = document.getElementById(SaveFrom_Utils.mobileLightBox.id);
        if (el === null) {
          return;
        }
        el.parentNode.removeChild(el);
      },
      getTitle: function(item) {
        var title = [];

        title.push(item.format || '???');
        if (item.quality) {
          var quality = item.quality;

          if (item.sFps) {
            quality += ' ' + (item.fps || 60);
          }

          title.push(quality);
        }
        if (item['3d']) {
          title.push('3D');
        }
        if (item.noAudio) {
          title.push(mono.global.language.withoutAudio);
        }

        return title.join(' ');
      },
      createItem: function(listItem) {
        var mobileLightBox = SaveFrom_Utils.mobileLightBox;

        var button = mono.create('a', {
          style: {
            display: 'block',
            marginBottom: '6px',
            border: 'solid 1px #d3d3d3',
            lineHeight: '36px',
            minHeight: '36px',
            background: '#f8f8f8',
            verticalAlign: 'middle',
            fontSize: '15px',
            textAlign: 'center',
            color: '#333',
            borderRadius: '2px',
            overflow: 'hidden'
          }
        });

        if (typeof listItem === 'string') {
          button.textContent = listItem;
          return button;
        } else {
          button.href = listItem.href;
          button.download = listItem.title;
          button.textContent = mobileLightBox.getTitle(listItem);
        }

        if (listItem.isHidden) {
          button.classList.add('isOptional');
          button.style.display = 'none';
        }

        var sizeIconStyle = {
          verticalAlign: 'middle',
          cssFloat: 'right',
          lineHeight: '36px',
          minHeight: '36px',
          paddingRight: '15px',
          width: '18px'
        };
        var sizeIconTextStyle = {
          cssFloat: 'right',
          paddingRight: '5px'
        };
        SaveFrom_Utils.appendFileSizeIcon(button, sizeIconStyle, sizeIconTextStyle, undefined, true, button);

        return button;
      },
      getItems: function(itemList) {
        var mobileLightBox = SaveFrom_Utils.mobileLightBox;

        if (typeof itemList === 'string') {
          return {
            list: [mobileLightBox.createItem(itemList)],
            hiddenCount: 0
          };
        }

        var list = [];
        for (var i = 0, item; item = itemList[i]; i++) {
          if (item.quality === 'ummy') {
            continue;
          }
          if (item.extra) {
            continue;
          }
          list.push({
            el: mobileLightBox.createItem(item),
            prop: item
          });
        }
        list = SaveFrom_Utils.popupMenu.sortMenuItems(list);
        var elList = [];
        var hiddenElList = [];
        for (i = 0, item; item = list[i]; i++) {
          if (item.prop.isHidden) {
            hiddenElList.push(item.el);
          } else {
            elList.push(item.el);
          }
        }
        return {
          list: elList.concat(hiddenElList),
          hiddenCount: hiddenElList.length
        };
      },
      show: function(itemList) {
        var mobileLightBox = SaveFrom_Utils.mobileLightBox;

        var topOffset = window.pageYOffset;
        var winHeight = window.innerHeight;
        var mTop = parseInt(winHeight / 100 * 15);
        var btnBox = undefined;
        var moreBtn;

        var getBtnBoxSize = function(hasMore) {
          "use strict";
          var i = hasMore ? 2 : 1;
          return winHeight - 46 * i - mTop * 2;
        };

        var setMoreBtnState = function(itemObj) {
          "use strict";
          if (itemObj.hiddenCount > 0) {
            btnBox.style.height = getBtnBoxSize(1) + 'px';
            moreBtn.style.display = 'block';
          } else {
            moreBtn.style.display = 'none';
            btnBox.style.height = getBtnBoxSize(0) + 'px';
          }
        };

        var exLb = document.getElementById(mobileLightBox.id);
        if (exLb !== null) {
          exLb.parentNode.removeChild(exLb);
        }


        var lbWidth = window.innerWidth;
        if (lbWidth <= 250) {
          lbWidth = '90%';
        } else {
          lbWidth = '70%';
        }

        if (!itemList || itemList.length === 0) {
          itemList = mono.global.language.noLinksFound;
        }

        var itemObj = mobileLightBox.getItems(itemList);

        var lightbox = mono.create('div', {
          id: mobileLightBox.id,
          style: {
            position: 'absolute',
            top: 0,
            left: 0,
            width: '100%',
            zIndex: 9000,
            height: document.body.scrollHeight + 'px',
            background: 'rgba(0,0,0,0.85)',
            textAlign: 'center'
          },
          on: [
            ['click', function(e) {
              e.preventDefault();
              close();
            }]
          ],
          append: mono.create('div', {
            style: {
              display: 'inline-block',
              width: lbWidth,
              backgroundColor: '#eee',
              height: (winHeight - mTop * 2) + 'px',
              marginTop: (mTop + topOffset) + 'px',
              borderRadius: '4px',
              padding: '8px',
              position: 'relative'
            },
            append: [
              btnBox = mono.create('div', {
                style: {
                  overflowY: 'auto',
                  marginBottom: '6px'
                },
                append: itemObj.list,
                on: ['touchmove', function(e) {
                  e.stopPropagation();
                }]
              }),
              moreBtn = mono.create(mobileLightBox.createItem(mono.global.language.more + ' ' + String.fromCharCode(187)), {
                href: '#',
                on: ['click', function(e) {
                  e.preventDefault();
                  var state = 'none';
                  var elList = this.parentNode.querySelectorAll('.isOptional');
                  if (this.dataset.state !== 'open') {
                    this.dataset.state = 'open';
                    this.textContent = mono.global.language.more + ' ' + String.fromCharCode(171);
                    state = 'block';
                  } else {
                    this.dataset.state = 'close';
                    this.textContent = mono.global.language.more + ' ' + String.fromCharCode(187);
                  }
                  for (var i = 0, el; el = elList[i]; i++) {
                    el.style.display = state;
                  }
                }]
              }),
              mono.create(mobileLightBox.createItem(mono.global.language.close), {
                on: ['click', function(e) {
                  e.preventDefault();
                  close();
                }]
              })
            ],
            on: ['click', function(e) {
              e.stopPropagation();
            }]
          })
        });

        setMoreBtnState(itemObj);

        document.body.appendChild(lightbox);

        var topPos = document.body.scrollTop;

        var result = {};

        var close = function() {
          if (!result.isShow) {
            return;
          }

          document.body.scrollTop = topPos;
          result.hide();
        };

        return mono.extend(result, {
          isShow: true,
          el: lightbox,
          hide: function() {
            lightbox.parentNode && lightbox.parentNode.removeChild(lightbox);
            result.isShow = false;
          },
          close: close,
          update: function(itemList) {
            if (lightbox.parentNode === null) {
              return;
            }

            if (!itemList || itemList.length === 0) {
              itemList = mono.global.language.noLinksFound;
            }

            btnBox.textContent = '';
            var itemObj = mobileLightBox.getItems(itemList);

            mono.create(btnBox, {
              append: itemObj.list
            });

            setMoreBtnState(itemObj);
          }
        });
      }
    },

    /**
     * @param {Object} details
     * @param {Array} [details.args]
     * @param {number} [details.timeout]
     * @param {function} details.func
     * @param {function} details.cb
     */
    bridge: function(details) {
      "use strict";
      details.args = details.args || [];
      if (details.timeout === undefined) {
        details.timeout = 300;
      }
      var scriptId = 'sf-bridge-' + parseInt(Math.random() * 1000) + '-' + Date.now();

      var listener = function(e) {
        window.removeEventListener('sf-bridge-' + scriptId, listener);
        var data;
        if (!e.detail) {
          data = undefined;
        } else {
          data = JSON.parse(e.detail);
        }
        details.cb(data);
      };

      window.addEventListener('sf-bridge-' + scriptId, listener);

      var wrapFunc = '(' + (function(func, args, scriptId, timeout) {
        /* fix */
        var node = document.getElementById(scriptId);
        if (node) {
          node.parentNode.removeChild(node);
        }

        var fired = false;
        var done = function(data) {
          if (fired) {
            return;
          }
          fired = true;

          var event = new CustomEvent('sf-bridge-' + scriptId, {
            detail: JSON.stringify(data)
          });
          window.dispatchEvent(event);
        };

        timeout && setTimeout(function() {
          done();
        }, timeout);

        args.push(done);

        func.apply(null, args);
      }).toString() + ')(' + [
        details.func.toString(),
        JSON.stringify(details.args),
        JSON.stringify(scriptId),
        parseInt(details.timeout)
      ].join(',') + ');';

      if (mono.isSafari) {
        var safariFix = function() {
          if (typeof CustomEvent === 'undefined') {
            CustomEvent = function(event, params) {
              params = params || {
                bubbles: false,
                cancelable: false
              };
              var evt = document.createEvent('CustomEvent');
              evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
              return evt;
            };
            CustomEvent.prototype = window.Event.prototype;
          }
        };
        wrapFunc = wrapFunc.replace('/* fix */', '(' + safariFix.toString() + ')();');
      } else
      if (mono.isOpera) {
        wrapFunc = wrapFunc.replace('/* fix */', 'var CustomEvent = window.CustomEvent;');
      }

      var script = mono.create('script', {
        id: scriptId,
        text: wrapFunc
      });
      document.body.appendChild(script);
    }
  };

  SaveFrom_Utils.TutorialTooltip = function(details) {
    "use strict";
    var _this = this;
    this.details = {
      btnTopOffset: -3,
      btnLeftOffset: 0
    };

    mono.extend(this.details, details);

    this.onResize = this.onResize.bind(this);
    this.onResizeDebouce = mono.debounce(this.onResize, 250);
    this.onClose = this.onClose.bind(this);

    this.target = details.target;

    if (this.target.dataset.sfHasTooltip === '1') {
      return;
    }
    this.target.dataset.sfHasTooltip = '1';


    this.tooltipNode = this.getNode();


    this.target.addEventListener('mouseup', this.onClose);

    this.target.addEventListener('sf-removed', function() {
      _this.onClose && _this.onClose(1);
    });

    window.addEventListener('resize', this.onResizeDebouce);

    this.onResize();

    (details.parent || document.body).appendChild(this.tooltipNode);
  };

  SaveFrom_Utils.TutorialTooltip.prototype.getNode = function() {
    "use strict";
    var _this = this;
    var language = mono.global.language;

    var zIndex = (function() {
      var zIndex = 1000;
      var top = document.getElementById('masthead-positioner');
      var styleList = top && window.getComputedStyle(top, null);
      if (styleList) {
        zIndex = parseInt(styleList.getPropertyValue('z-index')) + 1;
      }
      return zIndex;
    })();

    var box = mono.create('div', {
      class: 'sf-tooltip',
      on: ['mouseup', function(e) {
        e.stopPropagation();
      }],
      append: [
        mono.create('span', {
          style: {
            display: 'inline-block',
            border: '8px solid transparent',
            borderRight: '10px solid #4D4D4D',
            borderLeft: 0,
            width: 0,
            top: '8px',
            left: '0px',
            position: 'absolute'
          }
        }),
        mono.create('span', {
          style: {
            display: 'inline-block',
            backgroundColor: '#4D4D4D',
            marginLeft: '10px',
            padding: '10px 10px',
            maxWidth: '220px',
            minWidth: '220px',
            lineHeight: '16px',
            fontSize: '14px',
            fontFamily: 'font-family: arial, sans-serif',
            color: '#fff'
          },
          append: [
            mono.create('p', {
              style: {
                margin: 0
              },
              append: mono.parseTemplate(language.tutorialTooltipText)
            }),
            mono.create('a', {
              class: 'sf-button',
              text: 'OK',
              style: {
                display: 'inline-block',
                textAlign: 'center',
                textDecoration: 'none',
                padding: '0 10px',
                cssFloat: 'right',

                marginTop: '5px',
                lineHeight: '20px',
                borderRadius: '3px',
                fontSize: '12px',
                color: '#fff',
                fontWeight: 'bolder',
                backgroundColor: '#167AC6',
                cursor: 'pointer'
              },
              on: ['click', function(e) {
                e.preventDefault();
                _this.onClose && _this.onClose();
              }]
            }),
            mono.create('style', {
              text: mono.style2Text({
                '.sf-tooltip': {
                  position: 'absolute',
                  zIndex: zIndex + 2,
                  append: {
                    '.sf-button:hover': {
                      backgroundColor: '#126db3 !important'
                    },
                    '.sf-button:active': {
                      opacity: 0.9
                    }
                  }
                }
              })
            })
          ]
        })
      ]
    });

    return box;
  };

  SaveFrom_Utils.TutorialTooltip.prototype.onClose = function(force) {
    "use strict";
    if (force && force.type === 'mouseup') {
      force = null;
    }

    if (this.tooltipNode) {
      this.tooltipNode.parentNode && this.tooltipNode.parentNode.removeChild(this.tooltipNode);
      this.tooltipNode = null;
    }

    window.removeEventListener('resize', this.onResizeDebouce);
    this.target.removeEventListener('mouseup', this.onClose);

    this.onClose = null;
    if (!force) {
      this.details.onClose && this.details.onClose();
    }
  };

  SaveFrom_Utils.TutorialTooltip.prototype.onResize = function() {
    "use strict";
    var btn = this.target;
    if (!btn.offsetParent || !btn.parentNode) {
      return this.onClose && this.onClose(1);
    }

    var btnPos = SaveFrom_Utils.getPosition(btn, this.details.parent);
    var top = btnPos.top + this.details.btnTopOffset;
    var left = btnPos.left + btnPos.width + this.details.btnLeftOffset;
    this.tooltipNode.style.top = top + 'px';
    this.tooltipNode.style.left = left + 'px';
  };

  SaveFrom_Utils.mutationWatcher = {
    getMutationObserver: function() {
      "use strict";
      var MutationObserverCtor = null;
      if (typeof MutationObserver !== 'undefined') {
        MutationObserverCtor = MutationObserver;
      } else
      if (typeof WebKitMutationObserver !== 'undefined') {
        MutationObserverCtor = WebKitMutationObserver;
      } else
      if (typeof MozMutationObserver !== 'undefined') {
        MutationObserverCtor = MozMutationObserver;
      } else
      if (typeof JsMutationObserver !== 'undefined') {
        MutationObserverCtor = JsMutationObserver;
      }
      return MutationObserverCtor;
    },
    isAvailable: function() {
      "use strict";
      return !!this.getMutationObserver();
    },
    disconnect: function(details) {
      "use strict";
      details.observer.disconnect();
    },
    connect: function(details) {
      "use strict";
      details.observer.observe(details.target, details.config);
    },
    joinMutations: function(mutations) {
      "use strict";
      var jMutations = [];
      var targetList = [];

      var jObj = {},
        obj, hasNodes;
      var mutation, i, node, tIndex;
      while (mutation = mutations.shift()) {
        tIndex = targetList.indexOf(mutation.target);

        if (tIndex === -1) {
          tIndex = targetList.push(mutation.target) - 1;
          jObj[tIndex] = {
            target: mutation.target,
            added: [],
            removed: []
          };
        }

        obj = jObj[tIndex];
        hasNodes = undefined;

        for (i = 0; node = mutation.addedNodes[i]; i++) {
          if (node.nodeType !== 1) {
            continue;
          }

          obj.added.push(node);
          hasNodes = true;
        }

        for (i = 0; node = mutation.removedNodes[i]; i++) {
          if (node.nodeType !== 1) {
            continue;
          }

          obj.removed.push(node);
          hasNodes = true;
        }

        if (hasNodes !== undefined && obj.inList === undefined) {
          obj.inList = true;
          jMutations.push(obj);
        }
      }

      return jMutations;
    },
    isMatched: null,
    prepareMatched: function() {
      "use strict";
      if (this.isMatched) {
        return;
      }

      var el = document.createElement('div');

      if (typeof el.matches === 'function') {
        this.isMatched = function(node, selector) {
          return node.matches(selector);
        };
      } else
      if (typeof el.matchesSelector === 'function') {
        this.isMatched = function(node, selector) {
          return node.matchesSelector(selector);
        };
      } else
      if (typeof el.webkitMatchesSelector === 'function') {
        this.isMatched = function(node, selector) {
          return node.webkitMatchesSelector(selector);
        };
      } else
      if (typeof el.mozMatchesSelector === 'function') {
        this.isMatched = function(node, selector) {
          return node.mozMatchesSelector(selector);
        };
      } else
      if (typeof el.oMatchesSelector === 'function') {
        this.isMatched = function(node, selector) {
          return node.oMatchesSelector(selector);
        };
      } else
      if (typeof el.msMatchesSelector === 'function') {
        this.isMatched = function(node, selector) {
          return node.msMatchesSelector(selector);
        };
      }

      el = null;
    },
    match: function(details, summaryList, mutation) {
      "use strict";
      var _this = this;
      var node, i, query, n;
      var queries = details.queries;
      var hasChanges = false;
      ['added', 'removed'].forEach(function(type) {
        var nodeList = mutation[type];
        for (n = 0; node = nodeList[n]; n++) {
          for (i = 0; query = queries[i]; i++) {
            if (query.is !== undefined && query.is !== type) {
              continue;
            }
            var nodeArr = summaryList[i][type];
            if (_this.isMatched(node, query.css) === true) {
              nodeArr.push(node);
            } else {
              nodeArr.push.apply(nodeArr, node.querySelectorAll(query.css));
            }

            if (hasChanges === false) {
              hasChanges = nodeArr[0] !== undefined;
            }
          }
        }
      });

      return hasChanges;
    },
    filterTarget: function(queries, node) {
      "use strict";
      var i, query;
      for (i = 0; query = queries[i]; i++) {
        if (this.isMatched(node, query.css) === true) {
          return true;
        }
      }
      return false;
    },
    run: function(_details) {
      "use strict";
      var _this = this;
      var details = {
        config: {
          childList: true,
          subtree: true
        },
        target: document.body,
        filterTarget: []
      };
      mono.extend(details, _details);

      details._disconnect = this.disconnect.bind(this, details);
      details._connect = this.connect.bind(this, details);
      details._match = this.match.bind(this, details);

      var _summaryList = [];
      for (var i = 0; i < details.queries.length; i++) {
        _summaryList.push({
          added: [],
          removed: []
        });
      }
      _summaryList = JSON.stringify(_summaryList);

      this.prepareMatched();

      var mObserver = this.getMutationObserver();
      details.observer = new mObserver(function(mutations) {
        // console.time('o');
        var jMutations = _this.joinMutations(mutations);
        if (jMutations.length === 0) {
          // console.timeEnd('o');
          return;
        }

        var hasChanges = false;
        var mutation;
        var summaryList = JSON.parse(_summaryList);
        while (mutation = jMutations.shift()) {
          // console.log('mutation', mutation);
          if (_this.filterTarget(details.filterTarget, mutation.target) === false) {
            if (details._match(summaryList, mutation) === true) {
              hasChanges = true;
            }
          }
        }

        hasChanges === true && details.callback(summaryList);
        // console.timeEnd('o');
      });

      details.start = function() {
        details._disconnect();
        details._connect();

        var hasChanges = false;
        var summaryList = JSON.parse(_summaryList);

        var mutation = {
          added: [details.target],
          removed: []
        };
        if (details._match(summaryList, mutation)) {
          hasChanges = true;
        }

        hasChanges === true && details.callback(summaryList);
      };

      details.stop = function() {
        details._disconnect();
      };

      details.start();

      return details;
    }
  };

  SaveFrom_Utils.mutationAttrWatcher = {
    isAvailable: function() {
      "use strict";
      return !!SaveFrom_Utils.mutationWatcher.getMutationObserver();
    },
    disconnect: function(details) {
      "use strict";
      details.observer.disconnect();
    },
    connect: function(details) {
      "use strict";
      details.observer.observe(details.target, details.config);
    },
    run: function(_details) {
      "use strict";
      var _this = this;

      var details = {
        config: {
          attributes: true,
          childList: false,
          attributeOldValue: true
        },
        target: document.body
      };

      mono.extend(details, _details);

      if (!Array.isArray(details.attr)) {
        details.attr = [details.attr];
      }

      details.config.attributeFilter = details.attr;

      details._disconnect = this.disconnect.bind(this, details);
      details._connect = this.connect.bind(this, details);

      var _summaryList = [];
      for (var i = 0; i < details.attr.length; i++) {
        _summaryList.push({});
      }
      _summaryList = JSON.stringify(_summaryList);

      var mObserver = SaveFrom_Utils.mutationWatcher.getMutationObserver();
      details.observer = new mObserver(function(mutations) {
        var hasChanges = false;
        var mutation;
        var summaryList = JSON.parse(_summaryList);
        while (mutation = mutations.shift()) {
          // console.log('mutation', mutation);
          var index = details.attr.indexOf(mutation.attributeName);
          if (index === -1) {
            continue;
          }

          var value = mutation.target.getAttribute(mutation.attributeName);
          if (value === mutation.oldValue) {
            continue;
          }

          summaryList[index] = {
            value: value,
            oldValue: mutation.oldValue
          };

          hasChanges = true;
        }

        hasChanges === true && details.callback(summaryList);
      });

      details.start = function() {
        details._disconnect();
        details._connect();

        var hasChanges = false;
        var summaryList = JSON.parse(_summaryList);

        for (var i = 0, attributeName; attributeName = details.attr[i]; i++) {
          var value = details.target.getAttribute(attributeName);
          if (value === null) {
            continue;
          }
          summaryList[i] = {
            value: value,
            oldValue: null
          };

          hasChanges = true;
        }

        hasChanges === true && details.callback(summaryList);
      };

      details.stop = function() {
        details._disconnect();
      };

      details.start();

      return details;
    }
  };
  /**
   * @license
   * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
   * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
   * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
   * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
   * Code distributed by Google as part of the polymer project is also
   * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
   */
  // @url https://github.com/webcomponents/webcomponentsjs
  // @version 0.7.15
  var WeakMap = (typeof WeakMap !== 'undefined') ? WeakMap : undefined;
  if (typeof WeakMap === "undefined") {
    (function() {
      var defineProperty = Object.defineProperty;
      var counter = Date.now() % 1e9;
      WeakMap = function() {
        this.name = "__st" + (Math.random() * 1e9 >>> 0) + (counter++ + "__");
      };
      WeakMap.prototype = {
        set: function(key, value) {
          var entry = key[this.name];
          if (entry && entry[0] === key) entry[1] = value;
          else defineProperty(key, this.name, {
            value: [key, value],
            writable: true
          });
          return this;
        },
        get: function(key) {
          var entry;
          return (entry = key[this.name]) && entry[0] === key ? entry[1] : undefined;
        },
        "delete": function(key) {
          var entry = key[this.name];
          if (!entry || entry[0] !== key) return false;
          entry[0] = entry[1] = undefined;
          return true;
        },
        has: function(key) {
          var entry = key[this.name];
          if (!entry) return false;
          return entry[0] === key;
        }
      };
    })();
  }

  var JsMutationObserver = (typeof JsMutationObserver !== 'undefined') ? JsMutationObserver : undefined;
  (function() {
    if (typeof JsMutationObserver !== 'undefined') {
      return;
    }
    var registrationsTable = new WeakMap();
    var setImmediate;
    if (typeof navigator !== 'undefined' && /Trident|Edge/.test(navigator.userAgent)) {
      setImmediate = setTimeout;
    } else if (window.setImmediate) {
      setImmediate = window.setImmediate;
    } else {
      var setImmediateQueue = [];
      var sentinel = String(Math.random());
      window.addEventListener("message", function(e) {
        if (e.data === sentinel) {
          var queue = setImmediateQueue;
          setImmediateQueue = [];
          queue.forEach(function(func) {
            func();
          });
        }
      });
      setImmediate = function(func) {
        setImmediateQueue.push(func);
        window.postMessage(sentinel, "*");
      };
    }
    var isScheduled = false;
    var scheduledObservers = [];

    function scheduleCallback(observer) {
      scheduledObservers.push(observer);
      if (!isScheduled) {
        isScheduled = true;
        setImmediate(dispatchCallbacks);
      }
    }

    function wrapIfNeeded(node) {
      return window.ShadowDOMPolyfill && window.ShadowDOMPolyfill.wrapIfNeeded(node) || node;
    }

    function dispatchCallbacks() {
      isScheduled = false;
      var observers = scheduledObservers;
      scheduledObservers = [];
      observers.sort(function(o1, o2) {
        return o1.uid_ - o2.uid_;
      });
      var anyNonEmpty = false;
      observers.forEach(function(observer) {
        var queue = observer.takeRecords();
        removeTransientObserversFor(observer);
        if (queue.length) {
          observer.callback_(queue, observer);
          anyNonEmpty = true;
        }
      });
      if (anyNonEmpty) dispatchCallbacks();
    }

    function removeTransientObserversFor(observer) {
      observer.nodes_.forEach(function(node) {
        var registrations = registrationsTable.get(node);
        if (!registrations) return;
        registrations.forEach(function(registration) {
          if (registration.observer === observer) registration.removeTransientObservers();
        });
      });
    }

    function forEachAncestorAndObserverEnqueueRecord(target, callback) {
      for (var node = target; node; node = node.parentNode) {
        var registrations = registrationsTable.get(node);
        if (registrations) {
          for (var j = 0; j < registrations.length; j++) {
            var registration = registrations[j];
            var options = registration.options;
            if (node !== target && !options.subtree) continue;
            var record = callback(options);
            if (record) registration.enqueue(record);
          }
        }
      }
    }
    var uidCounter = 0;
    JsMutationObserver = function(callback) {
      this.callback_ = callback;
      this.nodes_ = [];
      this.records_ = [];
      this.uid_ = ++uidCounter;
    };
    JsMutationObserver.prototype = {
      observe: function(target, options) {
        target = wrapIfNeeded(target);
        if (!options.childList && !options.attributes && !options.characterData || options.attributeOldValue && !options.attributes || options.attributeFilter && options.attributeFilter.length && !options.attributes || options.characterDataOldValue && !options.characterData) {
          throw new SyntaxError();
        }
        var registrations = registrationsTable.get(target);
        if (!registrations) registrationsTable.set(target, registrations = []);
        var registration;
        for (var i = 0; i < registrations.length; i++) {
          if (registrations[i].observer === this) {
            registration = registrations[i];
            registration.removeListeners();
            registration.options = options;
            break;
          }
        }
        if (!registration) {
          registration = new Registration(this, target, options);
          registrations.push(registration);
          this.nodes_.push(target);
        }
        registration.addListeners();
      },
      disconnect: function() {
        this.nodes_.forEach(function(node) {
          var registrations = registrationsTable.get(node);
          for (var i = 0; i < registrations.length; i++) {
            var registration = registrations[i];
            if (registration.observer === this) {
              registration.removeListeners();
              registrations.splice(i, 1);
              break;
            }
          }
        }, this);
        this.records_ = [];
      },
      takeRecords: function() {
        var copyOfRecords = this.records_;
        this.records_ = [];
        return copyOfRecords;
      }
    };

    function MutationRecord(type, target) {
      this.type = type;
      this.target = target;
      this.addedNodes = [];
      this.removedNodes = [];
      this.previousSibling = null;
      this.nextSibling = null;
      this.attributeName = null;
      this.attributeNamespace = null;
      this.oldValue = null;
    }

    function copyMutationRecord(original) {
      var record = new MutationRecord(original.type, original.target);
      record.addedNodes = original.addedNodes.slice();
      record.removedNodes = original.removedNodes.slice();
      record.previousSibling = original.previousSibling;
      record.nextSibling = original.nextSibling;
      record.attributeName = original.attributeName;
      record.attributeNamespace = original.attributeNamespace;
      record.oldValue = original.oldValue;
      return record;
    }
    var currentRecord, recordWithOldValue;

    function getRecord(type, target) {
      return currentRecord = new MutationRecord(type, target);
    }

    function getRecordWithOldValue(oldValue) {
      if (recordWithOldValue) return recordWithOldValue;
      recordWithOldValue = copyMutationRecord(currentRecord);
      recordWithOldValue.oldValue = oldValue;
      return recordWithOldValue;
    }

    function clearRecords() {
      currentRecord = recordWithOldValue = undefined;
    }

    function recordRepresentsCurrentMutation(record) {
      return record === recordWithOldValue || record === currentRecord;
    }

    function selectRecord(lastRecord, newRecord) {
      if (lastRecord === newRecord) return lastRecord;
      if (recordWithOldValue && recordRepresentsCurrentMutation(lastRecord)) return recordWithOldValue;
      return null;
    }

    function Registration(observer, target, options) {
      this.observer = observer;
      this.target = target;
      this.options = options;
      this.transientObservedNodes = [];
    }
    Registration.prototype = {
      enqueue: function(record) {
        var records = this.observer.records_;
        var length = records.length;
        if (records.length > 0) {
          var lastRecord = records[length - 1];
          var recordToReplaceLast = selectRecord(lastRecord, record);
          if (recordToReplaceLast) {
            records[length - 1] = recordToReplaceLast;
            return;
          }
        } else {
          scheduleCallback(this.observer);
        }
        records[length] = record;
      },
      addListeners: function() {
        this.addListeners_(this.target);
      },
      addListeners_: function(node) {
        var options = this.options;
        if (options.attributes) node.addEventListener("DOMAttrModified", this, true);
        if (options.characterData) node.addEventListener("DOMCharacterDataModified", this, true);
        if (options.childList) node.addEventListener("DOMNodeInserted", this, true);
        if (options.childList || options.subtree) node.addEventListener("DOMNodeRemoved", this, true);
      },
      removeListeners: function() {
        this.removeListeners_(this.target);
      },
      removeListeners_: function(node) {
        var options = this.options;
        if (options.attributes) node.removeEventListener("DOMAttrModified", this, true);
        if (options.characterData) node.removeEventListener("DOMCharacterDataModified", this, true);
        if (options.childList) node.removeEventListener("DOMNodeInserted", this, true);
        if (options.childList || options.subtree) node.removeEventListener("DOMNodeRemoved", this, true);
      },
      addTransientObserver: function(node) {
        if (node === this.target) return;
        this.addListeners_(node);
        this.transientObservedNodes.push(node);
        var registrations = registrationsTable.get(node);
        if (!registrations) registrationsTable.set(node, registrations = []);
        registrations.push(this);
      },
      removeTransientObservers: function() {
        var transientObservedNodes = this.transientObservedNodes;
        this.transientObservedNodes = [];
        transientObservedNodes.forEach(function(node) {
          this.removeListeners_(node);
          var registrations = registrationsTable.get(node);
          for (var i = 0; i < registrations.length; i++) {
            if (registrations[i] === this) {
              registrations.splice(i, 1);
              break;
            }
          }
        }, this);
      },
      handleEvent: function(e) {
        e.stopImmediatePropagation();
        switch (e.type) {
          case "DOMAttrModified":
            var name = e.attrName;
            var namespace = e.relatedNode.namespaceURI;
            var target = e.target;
            var record = new getRecord("attributes", target);
            record.attributeName = name;
            record.attributeNamespace = namespace;
            var oldValue = e.attrChange === MutationEvent.ADDITION ? null : e.prevValue;
            forEachAncestorAndObserverEnqueueRecord(target, function(options) {
              if (!options.attributes) return;
              if (options.attributeFilter && options.attributeFilter.length && options.attributeFilter.indexOf(name) === -1 && options.attributeFilter.indexOf(namespace) === -1) {
                return;
              }
              if (options.attributeOldValue) return getRecordWithOldValue(oldValue);
              return record;
            });
            break;

          case "DOMCharacterDataModified":
            var target = e.target;
            var record = getRecord("characterData", target);
            var oldValue = e.prevValue;
            forEachAncestorAndObserverEnqueueRecord(target, function(options) {
              if (!options.characterData) return;
              if (options.characterDataOldValue) return getRecordWithOldValue(oldValue);
              return record;
            });
            break;

          case "DOMNodeRemoved":
            this.addTransientObserver(e.target);

          case "DOMNodeInserted":
            var changedNode = e.target;
            var addedNodes, removedNodes;
            if (e.type === "DOMNodeInserted") {
              addedNodes = [changedNode];
              removedNodes = [];
            } else {
              addedNodes = [];
              removedNodes = [changedNode];
            }
            var previousSibling = changedNode.previousSibling;
            var nextSibling = changedNode.nextSibling;
            var record = getRecord("childList", e.target.parentNode);
            record.addedNodes = addedNodes;
            record.removedNodes = removedNodes;
            record.previousSibling = previousSibling;
            record.nextSibling = nextSibling;
            forEachAncestorAndObserverEnqueueRecord(e.relatedNode, function(options) {
              if (!options.childList) return;
              return record;
            });
        }
        clearRecords();
      }
    };
  })();
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('dailymotion', function(moduleName, initData) {
    "use strict";

    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleDailymotion ? 1 : 0;

    var iframe = mono.isIframe() && /\/embed\/([\w\-]+)/i.test(document.location.href);

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return dailymotion.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'updateLinks') {
        dailymotion.updateLinks();
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        dailymotion.run();
      });
    }

    var dailymotion = {
      contextMenu: null,
      linkCache: {},
      embed: null,
      title: '',
      styleIndex: 0,
      btnId: 'sf__download_btn',
      result: null,
      popupIsShow: false,

      run: function() {
        moduleState = 1;
        if (iframe) {
          dailymotion.appendIframeButtons();
          return;
        }

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          return dailymotion.mutationMode.enable();
        }
      },
      changeState: function(state) {
        if (iframe) return;
        moduleState = state;
        dailymotion.rmBtn();
        dailymotion.mutationMode.stop();
        if (state) {
          dailymotion.run();
        }
      },

      hideMenu: function() {
        if (dailymotion.contextMenu && dailymotion.contextMenu.isShow) {
          dailymotion.contextMenu.hide();
          dailymotion.contextMenu = null;
        }
      },

      updateLinks: function() {
        dailymotion.changeState(0);
        dailymotion.changeState(1);
      },

      appendIframeButtons: function() {
        var _this = this;
        var btnObj = SaveFrom_Utils.frameMenu.getBtn({
          quickBtnStyleObj: {
            display: 'inline-block',
            cursor: 'pointer',
            position: 'relative',
            padding: '9px 10px'
          },
          quickBtnCssStyle: {
            backgroundColor: 'rgba(0,0,0,.75)'
          },
          singleBtn: true,
          btnId: _this.btnId,
          containerStyle: {
            right: '50px',
            top: '10px'
          },
          quickBtnIcon: mono.create(SaveFrom_Utils.svg.getSvg('download', '#ffffff'), {
            style: {
              display: 'inline-block',
              width: '16px',
              height: '16px',
              verticalAlign: 'middle'
            }
          }),
          on: [
            ['click', function(e) {
              e.preventDefault();
              e.stopPropagation();

              if (_this.contextMenu && _this.contextMenu.isShow) {
                _this.hideMenu();
                return;
              }

              var id = _this.getIdFromUrl();
              var links = language.download + ' ...';
              var fromCache = _this.linkCache[id];
              if (fromCache) {
                links = SaveFrom_Utils.popupMenu.prepareLinks.dailymotion(fromCache.links, fromCache.title);
              }

              var menu = _this.contextMenu = SaveFrom_Utils.frameMenu.getMenu(this, links, 'sf-frame-menu', {
                container: btnObj.container,
                onShow: function() {
                  btnObj.node.classList.add('sf-over');
                },
                onHide: function() {
                  _this.contextMenu = null;
                  btnObj.node.classList.remove('sf-over');
                }
              });

              if (!fromCache) {
                mono.sendMessage({
                  action: 'getDailymotionLinks',
                  extVideoId: id,
                  metadata: _this.getMetadata(id)
                }, function(response) {
                  var menuLinks = language.noLinksFound;
                  if (response.links) {
                    _this.linkCache[id] = response;
                    menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.dailymotion(response.links, response.title);
                  }
                  menu.update(menuLinks);
                });
              }
            }],
            ['mousedown', function(e) {
              e.stopPropagation();
              if (e.button === 2) {
                mono.off(document.body, 'mousemove', onMouseMove);

                _this.hideMenu();

                if (btnObj.container.parentNode) {
                  btnObj.container.parentNode.removeChild(btnObj.container);
                }
              }
            }]
          ]
        });

        btnObj.quickBtn.title = language.download;

        btnObj.container = mono.create('div', {
          class: 'sf-btn-ctr',
          append: btnObj.node
        });

        mono.on(btnObj.container, 'mouseenter', function() {
          btnObj.lockHide = true;
        });

        mono.on(btnObj.container, 'mouseleave', function() {
          btnObj.lockHide = false;
        });

        var hideTimeout = null;
        var hasClassName = false;
        var timeoutFn = function() {
          if (!btnObj.lockHide) {
            btnObj.container.classList.add('sf-hide-ui');
            hasClassName = true;
          }
        };
        var onMouseMove = function() {
          if (hasClassName) {
            btnObj.container.classList.remove('sf-hide-ui');
            hasClassName = false;
          }

          clearTimeout(hideTimeout);
          hideTimeout = setTimeout(timeoutFn, 3 * 1000);
        };
        mono.on(document.body, 'mousemove', onMouseMove);

        btnObj.node.appendChild(mono.create('style', {
          text: mono.style2Text([{
            selector: [
              'body:hover .sf-btn-ctr:not(.sf-hide-ui) #' + _this.btnId,
              'body:hover .sf-btn-ctr:not(.sf-hide-ui) .sf-frame-menu'
            ],
            style: {
              display: 'block'
            }
          }])
        }));

        document.body.appendChild(btnObj.container);
      },

      getIdFromUrl: function(url) {
        url = url || location.href;
        var videoId = url.match(/\/embed\/video\/([a-z0-9]+)/);
        videoId = videoId && videoId[1];
        return videoId;
      },

      getVideoId: function(details) {
        if (details.styleIndex === 4 || details.styleIndex === 3) {
          // playlist
          var playerV5Frame = document.querySelector('.pl_videos_listwithplayer #player_container #playerv5-iframe');
          if (!playerV5Frame) {
            // channel
            playerV5Frame = document.querySelector('.featured-video .player iframe');
          }
          if (playerV5Frame) {
            var src = playerV5Frame.getAttribute('src') || '';
            var videoId = this.getIdFromUrl(src);
            if (videoId) {
              return videoId;
            }
          }
        }

        var playerNode = document.querySelector('#player embed');
        if (playerNode) {
          var falshvars = playerNode.getAttribute('flashvars');
          if (falshvars) {
            var params = mono.parseUrl(falshvars, {
              params: true
            });
            if (params.config) {
              try {
                params = JSON.parse(params.config);
                return params.metadata.id;
              } catch (e) {}
            }
          }
        }

        // video page
        var playerTitleLink = document.querySelector('#player a.dmp_StartView-logo');
        if (playerTitleLink) {
          var request = SaveFrom_Utils.embedDownloader.checkUrl(playerTitleLink.href);
          if (request) {
            return request.extVideoId;
          }
        }

        return null;
      },

      getMetadata: function(id) {
        "use strict";
        var metadata = null;
        var scriptList = mono.getPageScript(document.body.innerHTML, /playerV5/);
        scriptList.some(function(script) {
          var jsonList = mono.findJson(script);
          return jsonList.some(function(json) {
            if (json && json.metadata && json.metadata.id === id) {
              metadata = json.metadata;
              return true;
            }
          });
        });
        return metadata;
      },

      appendBtn: function(details) {
        var _this = this;
        var btnContainer = details.btnContainer;

        if (!btnContainer) {
          return;
        }

        var styleIndex = details.styleIndex;

        var oldBtn = btnContainer.querySelector('#' + dailymotion.btnId);

        var customStyle = {};

        if (styleIndex === 4) {
          mono.extend(customStyle, {
            display: 'inline-block',
            height: '25px',
            backgroundPosition: 'center',
            backgroundRepeat: 'no-repeat',
            backgroundSize: '12px',
            backgroundImage: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#808080') + ')'
          });

          if (styleIndex === 4) {
            mono.extend(customStyle, {
              marginLeft: '6px',
              height: '22px'
            });
          }
        }

        if (styleIndex === 5) {
          mono.extend(customStyle, {
            padding: '0 5px',
            cssFloat: 'left',
            marginLeft: '10px'
          });
        }

        var tagName = 'a';

        if (styleIndex === 5) {
          tagName = 'button';
        }

        var classList = [];

        if (styleIndex === 4) {
          classList.push('btn');
        }

        if (styleIndex === 5) {
          classList.push('button');
        }

        var buttonNode = mono.create(tagName, {
          id: dailymotion.btnId,
          href: '#',
          class: classList,
          title: language.download,
          style: customStyle,
          on: ['click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            if (dailymotion.contextMenu && dailymotion.contextMenu.isShow) {
              dailymotion.hideMenu();
              return;
            }

            var id = dailymotion.getVideoId(details);

            var links = language.download + ' ...';
            var fromCache = dailymotion.linkCache[id];
            if (fromCache) {
              links = SaveFrom_Utils.popupMenu.prepareLinks.dailymotion(fromCache.links, fromCache.title);
            }

            var menu = dailymotion.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, links, 'sf-popupMenu');

            if (fromCache) {
              return;
            }

            var metadata = _this.getMetadata(id);

            mono.sendMessage({
              action: 'getDailymotionLinks',
              extVideoId: id,
              metadata: metadata
            }, function(response) {
              if (response.links) {
                dailymotion.linkCache[id] = response;
                var menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.dailymotion(response.links, response.title);
                menu.update(menuLinks);
                return;
              }
              menu.update(language.noLinksFound);
            });

            if ([1].indexOf(preference.cohortIndex) !== -1) {
              if (styleIndex === 4) {
                mono.sendMessage({
                  action: 'trackCohort',
                  t: 'event',
                  ec: 'dailymotion',
                  ea: 'click',
                  el: 'video-playlist'
                });
              } else
              if (styleIndex === 5) {
                mono.sendMessage({
                  action: 'trackCohort',
                  t: 'event',
                  ec: 'dailymotion',
                  ea: 'click',
                  el: 'video-single'
                });
              } else
              if (styleIndex === 3) {
                mono.sendMessage({
                  action: 'trackCohort',
                  t: 'event',
                  ec: 'dailymotion',
                  ea: 'click',
                  el: 'video-chennal'
                });
              }
            }
          }]
        });

        if (styleIndex === 3) {
          buttonNode.textContent = language.download;
          buttonNode = mono.create('span', {
            class: 'sf-wrapper',
            append: [
              ' • ',
              buttonNode
            ]
          })
        }

        if (styleIndex === 5) {
          mono.create(buttonNode, {
            append: [
              mono.create('img', {
                title: language.download,
                src: SaveFrom_Utils.svg.getSrc('download', '#808080'),
                style: {
                  width: '12px',
                  height: '12px',
                  verticalAlign: 'middle',
                  opacity: '0.9'
                }
              }),
              ' ',
              language.download
            ]
          });
        }

        if (mono.isOpera && styleIndex === 4) {
          buttonNode.appendChild(mono.create('img', {
            src: SaveFrom_Utils.svg.getSrc('download', '#808080'),
            style: {
              width: '12px',
              height: '12px',
              marginBottom: '4px'
            }
          }));
        }

        if (oldBtn && oldBtn.parentNode) {
          oldBtn.parentNode.replaceChild(buttonNode, oldBtn);
          oldBtn = null;
        } else {
          btnContainer.appendChild(buttonNode);
        }

        return buttonNode;
      },

      rmBtn: function() {
        var btnList = document.querySelectorAll(['#' + dailymotion.btnId, '.sf-wrapper']);
        for (var i = 0, item; item = btnList[i]; i++) {
          item.parentNode.removeChild(item);
        }
        dailymotion.result = null;
        dailymotion.popupIsShow = false;
      },

      getEmbedVideoInfo: function(callback) {
        if (!location.pathname) {
          return callback();
        }

        var url = location.pathname;
        if (!iframe) {
          url = "/embed" + url;
        }
        url = location.protocol + '//' + location.host + url;
        mono.sendMessage({
          action: 'getDailymotionEmbedVideoInfoMsg',
          url: url
        }, function(data) {
          if (data === undefined) {
            return callback();
          }
          dailymotion.title = data.title;
          data = data.links;
          callback(data);
        });
      },
      mutationMode: {
        observer: null,
        stop: function() {
          if (this.observer) {
            this.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        enable: function() {
          if (this.observer) {
            return this.observer.start();
          }

          this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node;

              summary = summaryList[0];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                dailymotion.appendBtn({
                  btnContainer: node.parentNode,
                  styleIndex: 5
                });
              }

              summary = summaryList[1];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                dailymotion.appendBtn({
                  btnContainer: node,
                  styleIndex: 4
                });
              }

              summary = summaryList[2];
              for (n = 0; node = summary.added[n]; n++) {
                var parent = node.parentNode;
                if (parent.dataset.sfSkip > 0) {
                  continue;
                }
                parent.dataset.sfSkip = '1';

                dailymotion.appendBtn({
                  btnContainer: node,
                  styleIndex: 3
                });
              }
            },
            queries: [{
              css: '.fluid-container .pl_video_infos .row .sd_user_subscribe',
              is: 'added'
            }, {
              css: '.pl_videos_listwithplayer .pl_videos_listswitcher'
            }, {
              css: '.channel-featured-videos .meta-info h2+div'
            }]
          });
        }
      }
    };
  }, null, function syncIsActive() {
    "use strict";
    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.dailymotion.*/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (mono.isIframe()) {
      if (!/\/embed\/([\w\-]+)/i.test(document.location.href)) {
        return false;
      }

      try {
        if (location.hostname === window.parent.location.hostname) {
          return false;
        }
      } catch (e) {}
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('facebook', function(moduleName, initData) {
    "use strict";

    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleFacebook ? 1 : 0;

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return fb.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'updateLinks') {
        fb.changeState(0);
        fb.changeState(1);
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        fb.run();
      });
    }

    var fb = {
      contextMenu: null,
      className: 'savefrom_fb_download',
      isMutation: false,
      run: function() {
        moduleState = 1;

        videoFeed.addStyle();
        photo.injectStyle();

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          this.isMutation = true;
          this.initEmbedDownloader();
          this.mutationMode.enable();
          return;
        }
      },

      changeState: function(state) {
        fb.hideMenu();
        moduleState = state;
        externalMedia.disable();
        photo.rmCurrentPhotoBtn();
        photo.rmDataAttrs();
        videoFeed.rmBtn();
        video.rmBtn();
        fb.mutationMode.stop();
        if (state) {
          fb.run();
        }
      },

      initEmbedDownloader: function() {
        SaveFrom_Utils.addStyleRules('.' + SaveFrom_Utils.embedDownloader.linkClass + ' img', {
          opacity: '.5'
        });

        SaveFrom_Utils.embedDownloader.init();
      },

      mutationMode: {
        observer: null,
        stop: function() {
          if (this.observer) {
            this.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        wrapVideoGetLinks: function(player) {
          switch (player.tagName) {
            case 'EMBED':
              video.getLinksFromEmbed(player, function(links) {
                video.appendLinks(links);
              });
              break;
            case 'VIDEO':
              video.getLinksFromVideo(player, function(links) {
                video.appendLinks(links);
              });
              break;
          }
        },
        wrapVideoFeedOnLinkHover: function() {
          if (!moduleState) {
            return;
          }
          videoFeed.onLinkHover.apply(this, arguments);
        },
        wrapPhotoOnHover: function(context) {
          if (!moduleState) {
            return;
          }
          var node = this.querySelector('img.spotlight');
          if (node) {
            photo.addCurrentDlBtn(node, this);
          }
        },
        wrapExternalMediaMouseEnter: function() {
          if (!moduleState) {
            return;
          }
          var link = this;
          var attr = link.dataset[externalMedia.linkDataAttr];

          if (attr) {
            clearTimeout(externalMedia.timer);
            return;
          }

          if (externalMedia.handle(link)) {
            if (externalMedia.lastLink && externalMedia.lastLink !== link) {
              externalMedia.removeBtn(externalMedia.lastLink);
            }

            SaveFrom_Utils.embedDownloader.hidePanel();
            externalMedia.lastLink = link;
          } else {
            mono.off(this, 'mouseenter', fb.mutationMode.wrapExternalMediaMouseEnter);
            mono.off(this, 'mouseleave', fb.mutationMode.wrapExternalMediaMouseLeave);
          }
        },
        wrapExternalMediaMouseLeave: function() {
          if (!moduleState) {
            return;
          }
          var link = this;
          var attr = link.dataset[externalMedia.linkDataAttr];

          if (attr) {
            clearTimeout(externalMedia.timer);
            externalMedia.timer = setTimeout(function() {
              externalMedia.removeBtn(link);
            }, 1500);
          }
        },
        wrapExternalMedia: function(node) {
          mono.on(node, 'mouseenter', fb.mutationMode.wrapExternalMediaMouseEnter);
          mono.on(node, 'mouseleave', fb.mutationMode.wrapExternalMediaMouseLeave);
        },
        enable: function() {
          if (this.observer) {
            return this.observer.start();
          }

          var _this = this;

          this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node;

              for (i = 0; i < 2; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  var isInsert = false;

                  if (mono.matches(node, '#fbxPhotoContentContainer .videoStage ' + node.tagName)) {
                    isInsert = true;
                  }

                  if (isInsert) {
                    _this.wrapVideoGetLinks(node);
                  } else {
                    mono.one(node, 'mouseover', _this.wrapVideoFeedOnLinkHover);
                  }
                }
              }

              summary = summaryList[2];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.getAttribute('aria-describedby') !== 'fbPhotosSnowliftCaption') {
                  continue;
                }
                fb.hideMenu();

                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                var container = SaveFrom_Utils.getParentByClass(node, 'stage');
                mono.one(container, 'mouseover', _this.wrapPhotoOnHover);
              }

              summary = summaryList[3];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.sfSkip > 0) {
                  continue;
                }
                node.sfSkip = '1';

                _this.wrapExternalMedia(node);
              }

              summary = summaryList[4];
              for (n = 0; node = summary.removed[n]; n++) {
                mono.onRemoveListener(node);
              }

            },
            queries: [{
              css: 'embed',
              is: 'added'
            }, {
              css: 'video',
              is: 'added'
            }, {
              css: '.stage img.spotlight',
              is: 'added'
            }, {
              css: 'a',
              is: 'added'
            }, {
              css: '.' + mono.onRemoveClassName,
              is: 'removed'
            }]
          });
        }
      },
      hideMenu: function() {
        if (fb.contextMenu) {
          fb.contextMenu.hide();
          fb.contextMenu = null;
        }
      }
    };

    var externalMedia = {
      linkDataAttr: 'savefromEd',
      timer: 0,
      lastLink: null,

      re: [
        /https?:\/\/(?:[a-z]+\.)?youtube\.com\/(?:#!?\/)?watch\?[^\s\"\'\<\>]*v=([\w\-]+)/i,
        /https?:\/\/(?:[a-z0-9]+\.)?youtube\.com\/(?:embed|v)\/([\w\-]+)/i,
        /https?:\/\/(?:[a-z]+\.)?youtu\.be\/([\w\-]+)/i,
        /https?:\/\/(?:[\w\-]+\.)?vimeo\.com\/(\d+)(?:\?|$)/i
      ],

      thumbnail: {
        youtube: {
          re: [/ytimg\.com(?:\/|%2F)vi(?:\/|%2F)([\w\-]+)(?:\/|%2F)/i],
          url: 'http://www.youtube.com/watch?v={vid}'
        }
      },

      disable: function() {
        var panel = SaveFrom_Utils.embedDownloader.panel;
        if (panel) {
          panel.style.display = 'none';
        }
      },

      removeBtn: function(link) {
        if (!link || typeof(link) != 'object')
          return;

        var btn = link.querySelector('.' + fb.className);
        if (btn) {
          btn.parentNode.removeAttribute(mono.dataAttr2Selector(externalMedia.linkDataAttr));
          btn.parentNode.removeChild(btn);
        }

        link.removeAttribute(mono.dataAttr2Selector(externalMedia.linkDataAttr));

        if (link == this.lastLink)
          this.lastLink = null;
      },


      checkUrl: function(url, retry) {
        if (!retry && url.search(/https?:\/\/([\w\-]+\.)?facebook\.com\/l\.php/i) > -1) {
          return this.checkUrl(decodeURIComponent(url), true);
        }

        for (var i = 0, l = this.re.length; i < l; i++) {
          var m = url.match(this.re[i]);
          if (m && m.length > 0)
            return m[0];
        }
      },


      handle: function(link) {
        var img = link.querySelector('img');
        if (img) {
          var parent = img.parentNode;
          if (img.src && SaveFrom_Utils.getStyle(parent, 'position') == 'relative') {
            var ajaxify = link.getAttribute('ajaxify');

            if (ajaxify && ajaxify.search(/\/flash\/expand_inline/i) > -1) {
              var url = this.getThumbnailUrl(img.src);
              if (url) {
                return this.createButton(url, parent, link, {
                  display: 'block',
                  position: 'absolute',
                  bottom: '3px',
                  right: '3px',
                  zIndex: 9999,
                  margin: 0,
                  width: '16px',
                  height: '16px'
                }, {
                  display: 'block'
                });
              }
            } else if (this.checkUrl(link.href)) {
              return this.createButton(link.href, parent, link, {
                display: 'block',
                position: 'absolute',
                bottom: '3px',
                right: '3px',
                zIndex: 9999,
                margin: 0,
                width: '16px',
                height: '16px'
              }, {
                display: 'block'
              });
            }
          }

          return false;
        }

        return this.createButton(link.href, link, link);
      },


      getThumbnailUrl: function(url) {
        for (var i in this.thumbnail) {
          for (var j = 0; j < this.thumbnail[i].re.length; j++) {
            var vid = SaveFrom_Utils.getMatchFirst(url, this.thumbnail[i].re[j]);
            if (vid)
              return this.thumbnail[i].url.replace(/\{vid\}/ig, vid);
          }
        }

        return '';
      },


      createButton: function(url, parent, link, styleParent, styleIcon) {
        url = this.checkUrl(url);
        if (!url)
          return false;

        var btn = document.createElement('a');
        btn.className = fb.className;
        btn.href = 'http://savefrom.net/?url=' + encodeURIComponent(url);
        btn.setAttribute(SaveFrom_Utils.embedDownloader.dataAttr, url);
        btn.title = language.download;

        btn.addEventListener('mousedown', function() {
          if ([1].indexOf(preference.cohortIndex) !== -1) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'facebook',
              ea: 'click',
              el: 'video-feed'
            });
          }
        });

        SaveFrom_Utils.setStyle(btn, {
          marginLeft: '7px',
          verticalAlign: 'middle'
        });

        if (styleParent)
          SaveFrom_Utils.setStyle(btn, styleParent);

        var icon = document.createElement('img');
        icon.className = 'icon';
        icon.src = SaveFrom_Utils.svg.getSrc('download', '#a2db16');
        SaveFrom_Utils.setStyle(icon, {
          display: 'inline-block',
          width: '16px',
          height: '16px',
          verticalAlign: 'middle',
          //opacity: '0.9',
          cursor: 'pointer'
        });

        if (styleIcon)
          SaveFrom_Utils.setStyle(icon, styleIcon);

        btn.appendChild(icon);

        link.dataset[this.linkDataAttr] = 1;
        parent.appendChild(btn);

        return true;
      }
    };


    var video = {
      getLinksFromEmbed: function(embed, cb) {
        if (!embed) {
          return cb(null);
        }

        var fv = embed.getAttribute('flashvars');
        if (fv === null) {
          return cb(null);
        }

        var params = mono.parseUrl(fv).params;
        if (!params) {
          return cb(null);
        }

        var videoData = null;
        try {
          videoData = JSON.parse(params).video_data;
        } catch (e) {}

        if (!videoData) {
          return cb(null);
        }

        if (videoData.progressive) {
          videoData = videoData.progressive;
        }

        var links = {};
        var typeMap = {
          sd_src: 'SD',
          hd_src: 'HD'
        };
        if (!Array.isArray(videoData)) {
          videoData = [videoData];
        }
        for (var i = 0, item; item = videoData[i]; i++) {
          ['sd_src', 'hd_src'].forEach(function(type) {
            if (!item[type]) {
              return;
            }

            links[item[type]] = typeMap[type];
          });
        }

        return cb(links);
      },

      requestVideoLinks: function(videoid, cb) {
        "use strict";
        mono.sendMessage({
          action: 'getFacebookLinks',
          extVideoId: videoid
        }, function(response) {
          if (!response) {
            cb();
          } else {
            cb(response.links, response.title);
          }
        });
      },

      getLinksFromVideo: function(video, cb) {
        "use strict";
        if (!video) {
          return cb(null);
        }

        var links = {};

        var url = document.URL;
        var id;
        SaveFrom_Utils.embedDownloader.hostings.facebook.re.some(function(reg) {
          var _id;
          if (_id = url.match(reg)) {
            id = _id && _id[1];
            return true;
          }
        });
        if (!id) {
          var parent = mono.getParentByClass(video, 'userContentWrapper');
          parent = parent && parent.querySelectorAll('a.profileLink, a[rel="theater"]');
          if (parent && parent.length > 0) {
            parent = [].slice.call(parent);
            parent.some(function(item) {
              item = (item.href || '').match(/\/videos\/(\d+)/);
              item = item && item[1];
              if (item) {
                id = item;
                return true;
              }
            });
          }
        }
        id && (links.id = id);

        if (video.src && /^https?:/.test(video.src)) {
          var ext = SaveFrom_Utils.getFileExtension(video.src, 'mp4');
          links[video.src] = ext.toUpperCase();
        }

        var src = video.querySelectorAll('source');
        if (src && src.length > 0) {
          for (var i = 0; i < src.length; i++) {
            var ext = SaveFrom_Utils.getFileExtension(src[i].src, 'mp4');
            links[src[i].src] = ext.toUpperCase();
          }
        }

        return cb(links);
      },


      getFileName: function(url) {
        var name = SaveFrom_Utils.getFileName(url);
        if (name)
          return name;

        var d = SaveFrom_Utils.dateToObj();
        var dateStr = d.year + '-' + d.month + '-' + d.day + '_' +
          d.hour + '-' + d.min;

        return 'facebook_' + dateStr + '.' +
          SaveFrom_Utils.getFileExtension(url, 'mp4');
      },

      prepareLinks: function(links, _title) {
        var menuLinks = [];
        for (var url in links) {
          var title = this.getFileName(url);
          var extPos = title.lastIndexOf('.');
          var ext = title.substr(extPos + 1);
          title = _title || title.substr(0, extPos);
          var format = ext.toUpperCase();

          var quality = links[url];
          var popupLink = {
            href: url,
            title: title,
            format: format,
            quality: quality,
            forceDownload: true
          };
          menuLinks.push(popupLink);
        }
        if (menuLinks.length === 0) {
          menuLinks = language.noLinksFound;
        }
        return menuLinks;
      },

      appendLinks: function(links) {
        if (!links) {
          return;
        }

        var box = document.getElementById('fbPhotoPageMediaInfo');

        if (box === null) {
          return;
        }

        var title = document.querySelector('h2.uiHeaderTitle');
        if (title) {
          title = title.textContent;
        }

        if (!box || box.querySelector('.' + fb.className)) {
          return;
        }

        var panel = document.createElement('div');
        panel.className = fb.className;

        var button = mono.create('div', {
          title: language.download,
          style: {
            display: 'inline-block',
            width: '16px',
            height: '16px',
            backgroundImage: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#a2db16') + ')',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center center',
            verticalAlign: 'middle',
            cursor: 'pointer'
          }
        });

        panel.appendChild(button);


        var popupMenuLinks = null;

        button.addEventListener('click', function() {
          if (fb.contextMenu && fb.contextMenu.isShow) {
            fb.hideMenu();
            return;
          }

          var menu = fb.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, language.download + ' ...', fb.className + '_popup');

          if (popupMenuLinks) {
            menu.update(popupMenuLinks);
          } else
          if (links.id) {
            var id = links.id;
            delete links.id;
            video.requestVideoLinks(id, function(_links, title) {
              if (_links) {
                popupMenuLinks = SaveFrom_Utils.popupMenu.prepareLinks.facebook(_links, title);
              } else {
                popupMenuLinks = video.prepareLinks(links);
              }
              menu.update(popupMenuLinks);
            });
          } else {
            popupMenuLinks = video.prepareLinks(links, title);
            menu.update(popupMenuLinks);
          }

          if ([1].indexOf(preference.cohortIndex) !== -1) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'facebook',
              ea: 'click',
              el: 'video-single'
            });
          }
        });

        box.appendChild(panel);

        box = null;
        panel = null;
        button = null;
      },
      rmBtn: function() {
        var btnList = document.querySelectorAll('.' + fb.className);
        for (var i = 0, item; item = btnList[i]; i++) {
          item.parentNode.removeChild(item);
        }
      }
    };

    var photo = {
      style: null,
      getFilenameFromUrl: function(url) {
        return SaveFrom_Utils.getMatchFirst(url, /\/([^\/]+\.[a-z0-9]{3,4})(?:\?|$)/i);
      },
      getPhotoId: function() {
        var params = mono.parseUrl(location.href);
        return params.fbid;
      },
      onGetPhotoUrl: function(url, container, onGetUrl) {
        if (!url) {
          var img = container.querySelector('img.spotlight') || container.querySelector('img.fbPhotoImage');
          if (!img) {
            return onGetUrl();
          }
          url = img.src;
        }
        if (!url) {
          return onGetUrl();
        }

        if (url.indexOf('dl=1') === -1) {
          if (url.indexOf('?') === -1) {
            url += '?dl=1'
          } else {
            url += '&dl=1'
          }
        }
        onGetUrl(url);
      },
      rmCurrentPhotoBtn: function(insertContainer) {
        var exBtn = undefined;
        var imgList = document.querySelectorAll('.sf-dl-current-photo-btn');
        for (var i = 0, imgItem; imgItem = imgList[i]; i++) {
          if (!insertContainer || !insertContainer.contains(imgItem)) {
            imgItem.parentNode.removeChild(imgItem);
          } else {
            exBtn = imgItem;
          }
        }
        return exBtn;
      },
      injectStyle: function() {
        if (this.style) {
          if (!this.style.parentNode) {
            document.head.appendChild(this.style);
          }
          return;
        }

        this.style = mono.create('style', {
          text: mono.style2Text({
            'div > .sf-dl-current-photo-btn': {
              display: 'none',
              border: '1px solid #F8F8F8',
              width: '20px',
              height: '20px',
              padding: 0,
              position: 'absolute',
              background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#777777') + ') center no-repeat #F8F8F8',
              backgroundSize: '12px',
              top: '20px',
              left: '20px',
              zIndex: 100,
              cursor: 'pointer'
            },
            'div > .sf-dl-current-photo-btn:hover': {
              background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#00B75A') + ') center no-repeat #F8F8F8',
              backgroundSize: '12px'
            },
            'div > .sf-dl-current-photo-btn:active': {
              outline: 0,
              boxShadow: 'inset 0 3px 5px rgba(0, 0, 0, 0.125)'
            },
            'body:not(.fullScreen) div:hover > .sf-dl-current-photo-btn': {
              display: 'block'
            }
          })
        });

        document.head.appendChild(this.style);
      },
      addDlCurrentPhotoBtn: function(container) {
        var exBtn = this.rmCurrentPhotoBtn(container);
        if (exBtn) {
          return;
        }
        var _this = this;

        container.appendChild(mono.create('a', {
          class: 'sf-dl-current-photo-btn',
          href: '#',
          title: language.download,
          on: ['click', function(e) {
            e.stopPropagation();
            e.preventDefault();

            if (fb.contextMenu && fb.contextMenu.isShow) {
              fb.hideMenu();
              return;
            }

            var onKeyDown = function(e) {
              if (e.keyCode === 18 || e.keyCode === 17) return;
              menu.hide();
              document.removeEventListener('keydown', onKeyDown);
            };

            var menu = fb.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, language.download + ' ...', "photoDlMenu", {
              parent: container,
              onShow: function() {
                if (fb.isMutation) {
                  return;
                }
                document.addEventListener('keydown', onKeyDown);
              },
              onHide: function() {
                if (fb.isMutation) {
                  return;
                }
                document.removeEventListener('keydown', onKeyDown);
              }
            });

            var onGetUrl = function(link) {
              if (!link) {
                return menu.update(language.noLinksFound);
              }
              var photoFileName = mono.fileName.modify(photo.getFilenameFromUrl(link));
              var dotPos = photoFileName.lastIndexOf('.');
              var photoExt = photoFileName.substr(dotPos + 1);
              var photoTitle = photoFileName.substr(0, dotPos);
              menu.update([{
                href: link,
                title: photoTitle,
                quality: language.download,
                format: ' ',
                ext: photoExt,
                isBlank: true,
                func: function() {
                  menu.hide();
                }
              }]);
            };

            var fbid = photo.getPhotoId();
            if (!fbid) {
              return photo.onGetPhotoUrl(undefined, container, onGetUrl);
            }
            mono.sendMessage({
              action: 'getFacebookPhotoUrl',
              fbid: fbid
            }, function(url) {
              photo.onGetPhotoUrl(url, container, onGetUrl);
            });
          }]
        }));
      },
      addCurrentDlBtn: function(img, container) {
        if (container.dataset.sfSkip > 0) {
          return;
        }
        container.dataset.sfSkip = '1';

        var url = img.src;
        if (!url) {
          return;
        }

        this.addDlCurrentPhotoBtn(container);
      },
      rmDataAttrs: function() {
        var dataAttr = mono.dataAttr2Selector('sfSkip');
        var dataAttrList = document.querySelectorAll('*[' + dataAttr + ']');
        for (var i = 0, item; item = dataAttrList[i]; i++) {
          item.removeAttribute(dataAttr);
        }
      }
    };

    var videoFeed = {
      style: null,
      addStyle: function() {
        if (this.style) {
          if (!this.style.parentNode) {
            document.head.appendChild(this.style);
          }
          return;
        }

        this.style = mono.create('style', {
          class: 'sfFeedStyle',
          text: mono.style2Text([{
            selector: '.' + fb.className + '-feed' + '.sf-feed',
            style: {
              display: 'none',
              width: '20px',
              height: '20px',
              padding: 0,
              position: 'absolute',
              background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#a2db16') + ') center no-repeat transparent',
              backgroundSize: '16px',
              top: '5px',
              left: '5px',
              zIndex: 1,
              cursor: 'pointer'
            }
          }, {
            selector: 'body:not(.fullScreen) div:hover > .' + fb.className + '-feed' + '.sf-feed',
            style: {
              display: 'block'
            }
          }, {
            selector: '.' + fb.className + '-feed' + '.sf-feed:active',
            style: {
              outline: 0
            }
          }])
        });

        document.head.appendChild(this.style);
      },
      onDlBtnClick: function(e) {
        e.preventDefault();
        e.stopPropagation();

        if (fb.contextMenu && fb.contextMenu.isShow) {
          fb.hideMenu();
          return;
        }

        try {
          var links = JSON.parse(this.dataset.sfDlLinks);
        } catch (e) {
          return;
        }

        var menu = fb.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, language.download + ' ...', fb.className + '_popup');

        if (links.id) {
          var id = links.id;
          delete links.id;
          video.requestVideoLinks(id, function(_links, title) {
            var popupMenuLinks;
            if (_links) {
              popupMenuLinks = SaveFrom_Utils.popupMenu.prepareLinks.facebook(_links, title);
            } else {
              popupMenuLinks = video.prepareLinks(links);
            }
            menu.update(popupMenuLinks);
          });
        } else {
          var popupMenuLinks = video.prepareLinks(links);
          menu.update(popupMenuLinks);
        }

        if ([1].indexOf(preference.cohortIndex) !== -1) {
          mono.sendMessage({
            action: 'trackCohort',
            t: 'event',
            ec: 'facebook',
            ea: 'click',
            el: 'video-feed'
          });
        }
      },
      addDownloadBtn: function(container, links) {
        container.appendChild(mono.create('a', {
          data: {
            sfDlLinks: JSON.stringify(links)
          },
          title: language.download,
          class: [fb.className + '-feed', 'sf-feed'],
          href: '#',
          on: ['click', videoFeed.onDlBtnClick]
        }));
      },
      onLinkHover: function() {
        var _this = this;
        if (this.dataset.hasSfFeedBtn > 1) {
          return;
        }
        this.dataset.hasSfFeedBtn = '1';

        var onReady = function(links) {
          "use strict";
          if (!links) {
            return;
          }

          if (mono.matches(_this, '.uiStreamStory ' + _this.tagName) ||
            mono.matches(_this, '.fbPhotoSnowliftContainer ' + _this.tagName)
          ) {
            videoFeed.addDownloadBtn(_this.parentNode, links);
            return;
          }

          var timeLineMainColumn = document.getElementById('pagelet_timeline_main_column') ||
            document.getElementById('stream_pagelet') ||
            document.getElementById('mainContainer');

          if (timeLineMainColumn && timeLineMainColumn.contains(_this)) {
            videoFeed.addDownloadBtn(_this.parentNode, links);
            return;
          }
        };

        var videoEl = this;
        if (videoEl.tagName === 'VIDEO') {
          videoEl = videoEl.querySelector('embed') || this;
        }

        if (videoEl.tagName === 'EMBED') {
          video.getLinksFromEmbed(videoEl, onReady);
        } else
        if (videoEl.tagName === 'VIDEO') {
          video.getLinksFromVideo(videoEl, onReady);
        }
      },
      rmBtn: function() {
        var dataAttr = mono.dataAttr2Selector('hasSfFeedBtn');
        var dataAttrList = document.querySelectorAll('*[' + dataAttr + ']');
        for (var i = 0, item; item = dataAttrList[i]; i++) {
          item.removeAttribute(dataAttr);
        }
        var btnList = document.querySelectorAll('.' + fb.className + '-feed');
        for (var i = 0, item; item = btnList[i]; i++) {
          item.parentNode.removeChild(item);
        }
      }
    };
  }, null, function syncIsActive() {
    "use strict";
    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.facebook.com/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (mono.isIframe()) {
      return false;
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('lm', function(moduleName, initData) {
    "use strict";
    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = (preference.lmFileHosting || preference.lmMediaHosting) ? 1 : 0;

    if (preference.showUmmyInfo) {
      mono.asyncCall(function() {
        checkUmmyPage();
      });
    }

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return lm.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'updateLinks') {
        lm.savefromLinkCount = -1;
        lm.run();
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        lm.run();
      });
    }

    var checkUmmyPage = function() {
      if (typeof location === 'undefined') return;

      var url = location.href;
      if (url.indexOf("videodownloader.ummy.net") === -1) {
        return;
      }
      if (url.match(/pozdravlyaem|congratulations|tebrikler/) !== null) {
        mono.sendMessage({
          action: 'updateOption',
          key: 'showUmmyInfo',
          value: 0
        });
        mono.sendMessage({
          action: 'updateOption',
          key: 'ummyDetected',
          value: 1
        });
      }
    };

    var lm = {
      htmlAfter: '',

      linkText: '',

      linkStyle: {
        'border': 'none',
        'textDecoration': 'none',
        'padding': '0',
        'position': 'relative'
      },

      imgStyle: {
        'border': 'none',
        'width': 'auto',
        'height': 'auto'
      },

      buttonSrc: 'data:image/gif;base64,R0lGODlhEAAQAOZ3APf39+Xl5fT09OPj4/Hx8evr6/3+/u7u7uDh4OPi497e3t7e3/z8/P79/X3GbuXl5ubl5eHg4WzFUfb39+Pj4lzGOV7LOPz7+/n6+vn5+ZTLj9/e387Ozt7f3/7+/vv7/ISbePn5+m/JV1nRKXmVbkCnKVrSLDqsCuDh4d/e3uDn3/z7/H6TdVeaV1uSW+bn5v39/eXm5eXm5kyHP/f39pzGmVy7J3yRd9/f3mLEKkXCHJbka2TVM5vaZn6Wdfn6+YG/c/r5+ZO/jeLi41aHTIeageLn4f39/vr6+kzNG2PVM5i+lomdf2CXYKHVmtzo2YXNeDqsBebl5uHh4HDKWN3g3kKqEH6WeZHTXIPKdnSPbv79/pfmbE7PHpe1l4O8dTO5DODg4VDLIlKUUtzo2J7SmEWsLlG4NJbFjkrJHP7+/VK5Nfz8+zmnC3KKa+Hg4OHh4Y63j/3+/eDg4Ojo6P///8DAwP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAHcALAAAAAAQABAAAAfWgHd2g4SFhYJzdYqLjIpzgx5bBgYwHg1Hk2oNDXKDFwwfDF5NLmMtcStsn4MhGT8YS04aGmU1QRhIGYMTADQAQlAODlloAMYTgwICRmRfVBISIkBPKsqDBAREZmcVFhYVayUz2IMHB1dWOmImI2lgUVrmgwUFLzdtXTxKSSduMfSD6Aik48MGlx05SAykM0gKhAAPAhTB0oNFABkPHg5KMIBCxzlMQFQZMGBIggSDpsCJgGDOmzkIUCAIM2dOhEEcNijQuQDHgg4KOqRYwMGOIENIB90JBAA7',

      sfref: '&utm_source={sfHelperName}&utm_medium=extensions&utm_campaign=link_modifier',

      pageUrl: 'http://savefrom.net/',
      anchorAttribute: 'savefrom_lm',
      anchorAttributeLink: 'savefrom_lm_is_link',
      anchorIndexAttribute: 'savefrom_lm_index',

      linkRegExp: null,

      savefromLinkCount: 0,

      re: {
        filehosting: {
          'rapidshare.com': [/^https?:\/\/([\w\-]+\.)?rapidshare\.com\/\#\!download\|\d+\|\d+\|[^\s\"\|]+\|\d+/i, /^https?:\/\/(rs\d+\.|www\.)?rapidshare\.com\/files\/\d+\/.+/i],
          'filefactory.com': [/^http:\/\/(www\.)?filefactory\.com\/file\/[a-z0-9]+\/?/i],
          'sendspace.com': [/^http:\/\/(www\.)?sendspace\.com\/file\/\w+/i]
        },

        mediahosting: {
          'youtube.com': [
            /^https?:\/\/([a-z]+\.)?youtube\.com\/(#!?\/)?watch\?.*v=/i,
            /^https?:\/\/([a-z0-9]+\.)?youtube\.com\/(embed|v)\/[\w\-]+/i
          ],
          'youtu.be': [/^https?:\/\/([a-z]+\.)?youtu\.be\/[\w\-]+/i],
          'google.com': [/^http:\/\/video\.google\.com\/videoplay\?.*docid=/i],
          'metacafe.com': [/^http:\/\/(www\.)?metacafe\.com\/watch\/\d+\/[^\/]+\/?/i],
          'break.com': [/^http:\/\/(www\.)?break\.com\/(index|movies\w*|(\w+\-)+\w+)\/.+\.html$/i, /^http:\/\/view\.break\.com\/\d+/i],
          'vimeo.com': [/^http:\/\/([\w\-]+\.)?vimeo\.com\/\d+$/i],
          'sevenload.com': [/^http:\/\/([\w\-]+\.)?sevenload\.com\/videos\/[-\w\+\/=]+/i, /^http:\/\/([\w\-]+\.)?sevenload\.com\/shows\/.+/i],
          'facebook.com': [/^https?:\/\/(?:www\.)facebook\.com\/([^\/]+\/)*video\.php\?([^&]+&)*v=\d+/i],
          //'rutube.ru': [/^http:\/\/rutube\.ru\/tracks\/\d+\.html\?.*v=[a-f0-9]+/i],
          'mail.ru': [/^http:\/\/([a-z0-9_-]+\.)?video\.mail\.ru\/(.+\/)+\d+\.html/i, /^http:\/\/r\.mail\.ru\/\w+\/video\.mail\.ru\/(.+\/)+\d+\.html/i],
          'yandex.ru': [/^http:\/\/video\.yandex\.ru\/users\/[-\w,!\+]+\/view\/[-\w,!\+]+\/?/i],
          'rambler.ru': [/^http:\/\/vision\.rambler\.ru\/users\/[^\/\s]+\/\d+\/[-\w_\+!]+\/?/i],
          'smotri.com': [/^http:\/\/([a-z0-9_-]+\.)?smotri\.com\/video\/view\/\?.*id=v[0-9a-f]/i],
          'tvigle.ru': [/^http:\/\/(www\.)?tvigle\.ru\/channel\/\d+\?.*vid_id=\d+/i, /^http:\/\/(www\.)tvigle\.ru\/prg\/\d+\/\d+/i],
          'intv.ru': [/^http:\/\/(www\.)?intv\.ru\/(view|quickdl)\/\?.*film_id=\w+/i, /^http:\/\/(www\.)?intv\.ru\/v\/\w+/i],
          'yasee.ru': [/^http:\/\/([a-z0-9_-]+\.)?yasee\.ru\/video\/view\/\?.*id=v[0-9a-f]/i],
          'narod.tv': [/^http:\/\/(?:www\.)?narod\.tv\/\?.*vid=/i],
          'vkadre.ru': [/^http:\/\/(www\.)?vkadre\.ru\/videos\/\d+/i],
          'myvi.ru': [
            /^http:\/\/(www\.)?myvi\.ru\/([a-z][a-z]\/)?videodetail\.aspx\?.*video=/i,
            /^http:\/\/(www|kino|anime)\.myvi\.ru\/watch\/[\w\-]+/i
          ],
          '1tv.ru': [/^http:\/\/(www\.)?1tv\.ru(\:\d+)?\/newsvideo\/\d+/i, /^http:\/\/(www\.)?1tv\.ru(\:\d+)?\/news\/\w+\d+/i],
          'ntv.ru': [/^http:\/\/news\.ntv\.ru\/(\w+\/)?\d+\/video\/?/i],
          'vesti.ru': [/^http:\/\/(www\.)?vesti\.ru\/videos\?.*vid=\d+/i],
          'bibigon.ru': [/^http:\/\/(www\.)?bibigon\.ru\/videow\.html\?id=\d+/i, /^http:\/\/(www\.)?bibigon\.ru\/video\.html\?vid=\d+/i],
          'mreporter.ru': [/^http:\/\/(www\.)?mreporter\.ru\/reportermessages\!viewreport\.do[^\?]*\?.*reportid=\d+/i],
          'autoplustv.ru': [/^http:\/\/(www\.)?autoplustv\.ru\/494\/\?id=\d+/i],
          'russia.ru': [/^http:\/\/([\w\-]+\.)?russia\.ru\/video\/?/i],
          'amik.ru': [/^http:\/\/(www\.)?amik\.ru\/video\/vid\d+\.html/i, /^http:\/\/(www\.)?amik\.ru\/video\/vcid\d+\.html/i],
          'life.ru': [/^http:\/\/([\w+\-]+\.)?life\.ru\/video\/\d+/i]
        }
      },


      parseHref: function(href, search) {
        var res = [];
        res.push(href);

        var i = href.toLowerCase().indexOf('http://', 7);
        if (i > 7) {
          res.push(href.substring(i));
        } else if (search) {
          var h = search.match(/http%3a(%2f%2f|\/\/)[^\s\&\"\<\>]+/i);
          if (h && h.length > 0) {
            res.push(decodeURIComponent(h[0]));
          } else {
            var s = '';
            try {
              s = decodeURIComponent(search);
            } catch (err) {}

            if (s) {
              // facebook
              h = s.match(/((?:aHR0cDovL|aHR0cHM6Ly)[a-z0-9+\/=]+)/i);
              if (h && h.length > 1) {
                try {
                  h = atob(h[1]);
                } catch (e) {
                  h = '';
                }
                if (h.search(/^https?:\/\//i) != -1)
                  res.push(decodeURIComponent(h));
              }
            }
          }
        }

        return res;
      },


      href: function(a) {
        return a.getAttribute('href') || '';
      },


      getElementIndex: function(e) {
        var html = e.innerHTML;
        if (!html || html == ' ')
          return 1;

        var bg = e.style.backgroundImage;
        if (bg && bg != 'none')
          return 1;

        var c = e.getElementsByTagName('*');
        for (var i = 0; i < c.length; i++) {
          if (c[i].tagName == 'IMG')
            return 2;
          else {
            bg = c[i].style.backgroundImage;
            if (bg && bg != 'none')
              return 1;
          }
        }

        return 0;
      },


      run: function() {
        SaveFrom_Utils.embedDownloader.init();

        lm.sfref = lm.sfref.replace('{sfHelperName}', preference.sfHelperName);

        var prefFileHosting = !!preference.lmFileHosting;
        var prefMediaHosting = !!preference.lmMediaHosting;

        moduleState = 1;

        lm.linkRegExp = {};
        if (prefFileHosting) {
          for (var i in lm.re.filehosting)
            lm.linkRegExp[i] = lm.re.filehosting[i];
        }

        if (prefMediaHosting) {
          for (var i in lm.re.mediahosting)
            lm.linkRegExp[i] = lm.re.mediahosting[i];
        }


        var a = document.getElementsByTagName('a');
        if (lm.savefromLinkCount != a.length) {
          lm.savefromLinkCount = a.length;

          var found = {},
            lastHref = '';

          for (var i = 0, len = a.length; i < len; i++) {
            var href = handleAnchor(a[i]);
            if (href) {
              var index = 0;
              var attr = a[i].getAttribute(lm.anchorIndexAttribute);
              if (attr === 0 || attr)
                index = parseInt(attr);
              else {
                index = lm.getElementIndex(a[i]);
                a[i].setAttribute(lm.anchorIndexAttribute, index);
              }

              if (found[href]) {
                if (index < found[href].index) {
                  found[href].elements = [a[i]];
                  found[href].index = index;
                  lastHref = href;
                } else if (index == found[href].index && href != lastHref) {
                  found[href].elements.push(a[i]);
                  lastHref = href;
                }
              } else {
                found[href] = {
                  index: index,
                  elements: [a[i]]
                };

                lastHref = href;
              }
            }
          }

          var count = 0;
          for (var i in found) {
            for (var j = 0, len = found[i].elements.length; j < len; j++) {
              var e = found[i].elements[j];
              count++;
              if (!e.getAttribute(lm.anchorAttribute))
                modifyLink(e, i);
            }
          }
        }



        function checkLink(link, domain) {
          if (!link)
            return false;

          if (link == window.location.href)
            return false;

          domain = SaveFrom_Utils.getTopLevelDomain(domain);
          if (!domain || !lm.linkRegExp[domain])
            return false;

          for (var i = 0; i < lm.linkRegExp[domain].length; i++) {
            if (link.search(lm.linkRegExp[domain][i]) != -1)
              return true;
          }

          return false;
        }


        function handleAnchor(obj) {
          var href = obj.href;
          if (typeof href === 'string' && href.search(/^https?:\/\/([\w\-]+\.)?savefrom\.net\//i) == -1) {
            var hrefArray = lm.parseHref(href, obj.search);

            if (hrefArray.length > 0) {
              if (lm.href(obj).indexOf('#') != 0 && checkLink(hrefArray[0], obj.hostname)) {
                return hrefArray[0];
              } else if (hrefArray.length > 1) {
                for (var j = 1; j < hrefArray.length; j++) {
                  var aTemp = document.createElement('a');
                  aTemp.href = hrefArray[j];
                  if (lm.href(aTemp).indexOf('#') != 0 && checkLink(hrefArray[j], aTemp.hostname)) {
                    return hrefArray[j];
                  }
                }
              }
            }
          }

          return '';
        }

        function modifyLink(obj, link) {
          if (!obj)
            return;

          obj.setAttribute(lm.anchorAttribute, '1');

          var box = document.createElement('span');
          box.setAttribute('style', 'padding: 0; margin: 0; margin-left: 5px;');
          box.addEventListener('click', function(e) {
            e.stopPropagation();
          });

          var parent = obj.parentNode;
          if (!parent)
            return;

          try {
            link = encodeURIComponent(link);
          } catch (err) {
            return;
          }

          var href = lm.pageUrl + '?url=' + link;
          if (lm.sfref)
            href += lm.sfref;

          // add button
          var a = document.createElement('a');
          a.href = href;
          a.target = '_blank';
          a.title = language.lmButtonTitle;

          a.style.backgroundImage = 'url(' + lm.buttonSrc + ')';
          a.style.backgroundRepeat = 'no-repeat';
          a.style.width = '16px';
          a.style.height = '16px';
          a.style.display = 'inline-block';

          a.addEventListener('click', function() {
            if ([1].indexOf(preference.cohortIndex) !== -1) {
              mono.sendMessage({
                action: 'trackCohort',
                t: 'event',
                ec: 'mediahost',
                ea: 'from',
                el: mono.getDomain(location.href, 1)
              });
            }
          });

          for (var i in lm.linkStyle)
            a.style[i] = lm.linkStyle[i];

          if (obj.style.zIndex) {
            a.style.zIndex = obj.style.zIndex;
          }

          a.setAttribute(lm.anchorAttribute, '1');
          a.setAttribute(lm.anchorAttributeLink, '1');
          if (lm.linkText) {
            a.textContent = lm.linkText;
          }

          box.appendChild(a);

          if (lm.htmlAfter)
            box.textContent += lm.htmlAfter;


          if (obj.nextSibling)
            parent.insertBefore(box, obj.nextSibling);
          else
            parent.appendChild(box);
        }
      },
      changeState: function(state) {
        preference.lmFileHosting = state;
        preference.lmMediaHosting = state;
        moduleState = state;
        var btnList = document.querySelectorAll('a[' + lm.anchorAttributeLink + ']');
        for (var i = 0, item; item = btnList[i]; i++) {
          item = item.parentNode;
          item.parentNode.removeChild(item);
        }
        var dataAttrList = document.querySelectorAll(['*[' + lm.anchorAttribute + ']', '*[' + lm.anchorIndexAttribute + ']']);
        for (i = 0, item; item = dataAttrList[i]; i++) {
          item.removeAttribute(lm.anchorAttribute);
          item.removeAttribute(lm.anchorIndexAttribute);
        }
        lm.savefromLinkCount = -1;

        if (state) {
          lm.run();
        }
      }
    };
  }, null, function syncIsActive() {
    "use strict";
    if (document.contentType && document.contentType !== 'text/html') {
      return false;
    }

    if (mono.isIframe()) {
      return false;
    }

    if (mono.isSafari || mono.isFF || mono.isGM) {
      var excludeList = [
        'ftp://*',
        'file://*',
        '*://*.google.*/*',
        '*://*.acidtests.org/*',

        '*://*.savefrom.net/*',
        '*://*.youtube.com/*',
        '*://*.vimeo.com/*',
        '*://*.dailymotion.*/*',
        '*://*.vk.com/*',
        '*://*.vkontakte.ru/*',
        '*://*.odnoklassniki.ru/*',
        '*://*.ok.ru/*',
        '*://my.mail.ru/*',
        '*://*.soundcloud.com/*',
        '*://*.facebook.com/*',
        '*://*.instagram.com/*',
        '*://*.rutube.ru/*'
      ];

      var reStr = excludeList.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    return true;
  });

  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('odnoklassniki', function(moduleName, initData) {
    "use strict";

    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleOdnoklassniki ? 1 : 0;
    var allowDownloadMode = mono.isSafari || mono.isChrome || mono.isFF || (mono.isGM && mono.isTM);

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return odnoklassniki.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'updateLinks') {
        updateLinks();
      }
      if (message.action === 'downloadMP3Files') {
        if (allowDownloadMode) {
          audio.downloadMP3Files();
        } else {
          audio.showListOfAudioFiles(false);
        }
      }
      if (message.action === 'downloadPlaylist') {
        audio.showListOfAudioFiles(true);
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        odnoklassniki.run();
      });
    }

    var odnoklassniki = {
      linkCache: {},
      contextMenu: null,
      videoToken: null,
      run: function() {
        moduleState = 1;

        audio.getJsSessionId();
        videoFeed.injectStyle();
        photo.injectStyle();

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          return odnoklassniki.mutationMode.enable();
        }
      },
      changeState: function(state) {
        moduleState = state;
        video.rmBtn();
        audio.disable();
        photo.rmCurrentPhotoBtn();
        videoFeed.disable();
        videoFeed.rmBtn();
        odnoklassniki.hideMenu();
        odnoklassniki.mutationMode.stop();
        odnoklassniki.clearCache();
        if (state) {
          odnoklassniki.run();
        }
      },
      hideMenu: function() {
        if (odnoklassniki.contextMenu) {
          odnoklassniki.contextMenu.hide();
          odnoklassniki.contextMenu = null;
        }
      },
      clearCache: function() {
        var linkCache = odnoklassniki.linkCache;
        for (var key in linkCache) {
          delete linkCache[key];
        }
      },
      mutationMode: {
        observer: null,
        stop: function() {
          if (this.observer) {
            this.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        wrapOnPhotoOver: function() {
          if (!moduleState) {
            return;
          }

          photo.addCurrentDlBtn(this);
        },
        wrapVideoFeedOnImgOver: function() {
          if (!moduleState) {
            return;
          }

          videoFeed.onImgOver.call(this);
        },
        wrapAudioOnMouseOver: function() {
          if (!moduleState) {
            return;
          }

          audio.onMouseOver.apply(this, arguments);
        },
        wrapAudioOnMouseOut: function() {
          if (!moduleState) {
            return;
          }

          audio.onMouseOut.apply(this, arguments);
        },
        enable: function() {
          if (this.observer) {
            return this.observer.start();
          }

          var _this = this;

          this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node;

              for (i = 0; i < 2; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  if (node.sfSkip > 0) {
                    continue;
                  }
                  node.sfSkip = '1';

                  mono.on(node, 'mouseenter', _this.wrapAudioOnMouseOver);
                  mono.on(node, 'mouseleave', _this.wrapAudioOnMouseOut);
                }
              }

              if (!mono.isSafari && !mono.isOpera) {
                summary = summaryList[2];
                for (n = 0; node = summary.added[n]; n++) {
                  if (node.dataset.sfSkip > 0) {
                    continue;
                  }
                  node.dataset.sfSkip = '1';

                  mono.one(node, 'mouseover', _this.wrapOnPhotoOver);
                }
              }

              summary = summaryList[3];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                var parent = mono.getParent(node, '.vp_video');
                if (!parent) {
                  return;
                }

                var info = video.getPlayerOptions(node);
                if (info) {
                  video.appendLinkUnderVideo(parent.parentNode, info);
                }
              }

              summary = summaryList[4];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                node = mono.getParentByClass(node, 'vid-card_cnt');
                if (node.dataset.sfSkip) {
                  return;
                }

                mono.one(node, 'mouseover', _this.wrapVideoFeedOnImgOver);
              }

              for (i = 5; i < 8; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  if (node.dataset.sfSkip > 0) {
                    continue;
                  }
                  node.dataset.sfSkip = '1';

                  mono.one(node, 'mouseover', _this.wrapVideoFeedOnImgOver);
                }
              }

              summary = summaryList[8];
              for (n = 0; node = summary.removed[n]; n++) {
                mono.onRemoveListener(node);
              }

              summary = summaryList[9];
              for (n = 0; node = summary.added[n]; n++) {
                node.addEventListener('click', videoFeed.onBtnClick);
              }
            },
            queries: [{
              css: '.track.js-track',
              is: 'added'
            }, {
              css: '.mus-tr_i',
              is: 'added'
            }, {
              css: '#photo-layer_photo',
              is: 'added'
            }, {
              css: '.vp_video .vid-card_cnt',
              is: 'added'
            }, {
              css: '.vid-card_cnt .vid-card_cnt_w img',
              is: 'added'
            }, {
              css: '.d_comment_text_w img',
              is: 'added'
            }, {
              css: '.video-card .video-card_img-w img',
              is: 'added'
            }, {
              css: '.vid-card_cnt img',
              is: 'added'
            }, {
              css: '.' + mono.onRemoveClassName,
              is: 'removed'
            }, {
              css: '.sf-video-feed-bind-on-insert',
              is: 'added'
            }]
          });
        }
      }
    };

    var downloadLinkClassName = 'savefrom_ok_download';

    var updateLinks = function() {
      odnoklassniki.clearCache();
      removeDownloadLinks();
      audio.getJsSessionId();
      video.catchPopup();
    };

    var createTextLink = function(href, text, blank) {
      if (blank == undefined)
        blank = true;

      var a = document.createElement('a');
      a.href = href;
      a.className = downloadLinkClassName;
      a.textContent = text;

      if (blank)
        a.setAttribute('target', '_blank');

      return a;
    };

    var removeDownloadLinks = function() {
      var selector = '.' + downloadLinkClassName;

      var e = document.querySelectorAll(selector);
      for (var i = e.length - 1; i >= 0; i--)
        e[i].parentNode.removeChild(e[i]);
    };

    ///////////////////////////////////////////////////////////////////
    //  AUDIO

    var audio = {
      downloadIdPrefix: 'savefrom_ok_audio_download_',
      infoIdPrefix: 'savefrom_ok_audio_info_',
      lastRow: null,
      lastRowCandidate: null,
      timer: 0,
      jsessionId: '',
      scriptNode: null,
      cache: {},
      ajaxTimer: {},


      showRowElements: function(row, show, force) {
        if (!row)
          return;

        var node = row.querySelectorAll('div.' + downloadLinkClassName);

        if (show && (!node || node.length == 0)) {
          if (!audio.showRowLinks(row))
            return;

          node = row.querySelectorAll('div.' + downloadLinkClassName);
        }

        if (node && node.length > 0) {
          var d = show ? '' : 'none';
          for (var i = 0; i < node.length; i++) {
            node[i].style.display = d;
          }
        }
      },


      getNodeTrackId: function(node) {
        var query = node.getAttribute('data-query');
        if (query) {
          try {
            query = JSON.parse(query);
            if (query && query.trackId) {
              return query.trackId;
            }
          } catch (e) {
            return null;
          }
        }

        var span = node.querySelector('span.track_play[onclick]');
        if (span) {
          var onClick = span.getAttribute('onclick') || '';
          var trackId = onClick.match(/playMediatopic\(['"]?(\d+)['"]?/);
          return trackId && trackId[1];
        }

        return null;
      },


      getTrackId: function(parent) {
        if (!parent)
          return null;

        var trackId = audio.getNodeTrackId(parent);
        if (trackId) {
          var links = {};
          links[trackId] = parent;
          return links;
        }

        var id = parent.id;
        if (id) {
          var hashPos = id.indexOf('#');
          if (hashPos !== -1) {
            id = id.substr(hashPos + 1);
          }
          trackId = SaveFrom_Utils.getMatchFirst(id, /^\w+_(\d+)$/i);
          if (!trackId) {
            if (id.indexOf('GROUP_FEED') !== -1) {
              trackId = id.substr(id.lastIndexOf('_') + 1);
            }
          }
          if (trackId) {
            var links = {};
            links[trackId] = parent;
            return links;
          }
        }

        return null;
      },


      showRowLinks: function(row) {
        var links = audio.getTrackId(row);
        for (var i in links) {
          if (audio.handleRow(i, links[i]))
            return true;
        }

        return false;
      },

      disable: function() {
        audio.lastRowCandidate = null;
        audio.lastRow = null;
        var dlBtn = document.querySelectorAll('.' + downloadLinkClassName);
        for (var i = 0, item; item = dlBtn[i]; i++) {
          item.parentNode.removeChild(item);
        }
      },

      getJsSessionId: function() {
        "use strict";
        var url = location.protocol + '//' + location.host + '/web-api/music/conf';
        mono.request({
          type: 'POST',
          url: url,
          data: '_',
          json: true,
          localXHR: true
        }, function(err, resp, data) {
          if (err || !data || !data.sid) {
            console.error('Get jsSessionId error!', err);
            return;
          }

          audio.jsessionId = data.sid;
        });
      },


      getLink: function(trackId) {
        if (!trackId || !audio.jsessionId)
          return;

        audio.ajaxTimer[trackId] = window.setTimeout(function() {
          delete audio.ajaxTimer[trackId];
          audio.deleteLink(trackId);
        }, 30000);

        mono.sendMessage({
          action: 'getOdnoklassnikiAudioLinks',
          url: location.href,
          trackId: trackId,
          jsessionId: audio.jsessionId
        }, function(response) {
          audio.setLink(response.trackId, response.data);
        });
      },


      onMouseOver: function(event) {
        if (!audio.jsessionId) {
          return;
        }

        var node = event.target;

        if (node.nodeType !== 1) {
          return;
        }

        if (!node.classList.contains('track') &&
          !node.classList.contains('mus-tr_i')
        ) {
          return;
        }

        var row = node;
        if (row) {
          audio.lastRowCandidate = row;
          window.clearTimeout(audio.timer);

          if (audio.lastRow == row)
            return;

          audio.timer = window.setTimeout(function() {
            audio.showRowElements(audio.lastRow, false);
            audio.lastRow = row;
            audio.lastRowCandidate = null;
            audio.showRowElements(audio.lastRow, true);
          }, 250);
        }
      },


      onMouseOut: function(event) {
        if (!audio.lastRow && !audio.lastRowCandidate) {
          return;
        }

        var node = event.target;
        if (SaveFrom_Utils.isParent(node, audio.lastRow) ||
          SaveFrom_Utils.isParent(node, audio.lastRowCandidate)) {
          window.clearTimeout(audio.timer);
          audio.timer = window.setTimeout(function() {
            audio.showRowElements(audio.lastRow, false);
            audio.lastRow = null;
            audio.lastRowCandidate = null;
          }, 1000);
        }
        node = null;
      },


      handleRow: function(trackId, row) {
        if (!trackId || !row)
          return false;

        var parent = row;
        parent.style.position = 'relative';

        var duration = row.querySelector('.m_c_duration, .m_portal_duration');

        var box = document.createElement('div');
        box.className = downloadLinkClassName;

        var right = 40;
        var mmpcw = document.getElementById('mmpcw');
        if (mmpcw && mmpcw.contains(row)) {
          right = 65;
        }

        SaveFrom_Utils.setStyle(box, {
          color: '#fff',
          background: '#46aa19',
          border: '1px solid #337d12',
          borderRadius: '3px',
          padding: '1px 5px',
          position: 'absolute',
          right: right + 'px',
          top: '50%',
          lineHeight: '15px',
          fontSize: '12px',
          opacity: 0,
          zIndex: 9999,
          cursor: 'pointer'
        });

        box.addEventListener('click', audio.onBoxClick, false);

        var title = audio.getTitle(trackId, row);

        var link1 = createTextLink('#', '...');
        link1.id = audio.downloadIdPrefix + trackId;
        link1.title = language.downloadTitle;
        if (duration) {
          link1.setAttribute('data-savefrom-helper-duration',
            audio.secondsFromDurationNode(duration));
        }

        if (title) {
          title += '.mp3';
          link1.setAttribute('download', mono.fileName.modify(title));
        }

        SaveFrom_Utils.setStyle(link1, {
          color: '#fff',
          fontWeight: 'normal'
        });

        link1.addEventListener('click', audio.onDownloadLinkClick, false);

        box.appendChild(link1);
        parent.appendChild(box);

        if (audio.cache[trackId])
          audio.setLinkFromCache(trackId, link1);
        else
          audio.getLink(trackId);

        box.style.marginTop = '-' + (box.offsetHeight / 2) + 'px';
        box.style.opacity = '1';

        var close = document.createElement('span');
        close.textContent = String.fromCharCode(215);
        close.title = language.close;
        SaveFrom_Utils.setStyle(close, {
          color: '#fff',
          fontFamily: 'Tahoma,Helvetica,sans-serif',
          fontSize: '15px',
          marginLeft: '7px',
          opacity: '.7',
          cursor: 'pointer'
        });
        close.addEventListener('click', audio.onCloseBtnClick, false);
        box.appendChild(close);

        return true;
      },


      onBoxClick: function(event) {
        event.preventDefault();
        event.stopPropagation();

        var a = this.querySelector('a.' + downloadLinkClassName);
        if (a) {
          mono.trigger(a, 'click', {
            cancelable: true
          });
          return false;
        }

        this.style.display = 'none';
        return false;
      },


      onDownloadLinkClick: function(event) {
        if (event.button == 2)
          return false;

        event.stopPropagation();

        if (this.href == '#') {
          event.preventDefault();
          return false;
        }

        SaveFrom_Utils.downloadOnClick(event);

        if ([1].indexOf(preference.cohortIndex) !== -1) {
          var mmpcw = document.getElementById('mmpcw');
          if (!mmpcw || !mmpcw.contains(this)) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'ok',
              ea: 'click',
              el: 'music-feed'
            });
          } else {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'ok',
              ea: 'click',
              el: 'music-list'
            });
          }
        }
        return false;
      },


      onCloseBtnClick: function(event) {
        if (event.button == 2)
          return true;

        event.preventDefault();
        event.stopPropagation();

        var parent = mono.getParent(this, '.' + downloadLinkClassName);
        if (parent)
          parent.style.display = 'none';

        return false;
      },


      deleteLink: function(trackId, node) {
        if (!node && trackId)
          node = document.getElementById(audio.downloadIdPrefix + trackId);

        if (!node)
          return;

        var box = node.parentNode;
        if (!box) {
          return;
        }
        box.parentNode.removeChild(box);
      },


      getHash: function(src, magic) {
        if (!magic)
          magic = [4, 3, 5, 6, 1, 2, 8, 7, 2, 9, 3, 5, 7, 1, 4, 8, 8, 3, 4, 3, 1, 7, 3, 5, 9, 8, 1, 4, 3, 7, 2, 8];

        var a = [];
        for (var i = 0; i < src.length; i++) {
          a.push(parseInt('0x0' + src.charAt(i)));
        }

        src = a;

        var res = [];
        src = src.slice(0);
        src[32] = src[31];
        var sum = 0;
        var i = 32;
        while (i-- > 0)
          sum += src[i];

        for (var x = 0; x < 32; x++)
          res[x] = Math.abs(sum - src[x + 1] * src[x] * magic[x]);

        return res.join('');
      },


      setLinkFromCache: function(trackId, node) {
        if (!audio.cache[trackId])
          return false;

        if (!node)
          node = document.getElementById(audio.downloadIdPrefix + trackId);

        if (!node)
          return;

        node.href = audio.cache[trackId].url;
        node.textContent = '';
        if (audio.cache[trackId].downloadAttr)
          node.setAttribute('download', audio.cache[trackId].downloadAttr);

        var icon = mono.create(SaveFrom_Utils.svg.getSvg('download', '#ffffff'), {
          style: {
            display: 'inline-block',
            width: '16px',
            height: '16px',
            verticalAlign: 'middle',
            opacity: '0.9'
          }
        });
        node.appendChild(icon);

        var info = document.createTextNode(audio.cache[trackId].info);

        if (node.nextSibling)
          node.parentNode.insertBefore(info, node.nextSibling);
        else
          node.parentNode.appendChild(info);

        return true;
      },


      setLink: function(trackId, data, clientHash) {
        if (!trackId)
          return;

        window.clearTimeout(audio.ajaxTimer[trackId]);

        var node = document.getElementById(audio.downloadIdPrefix + trackId);
        if (!node)
          return;

        if (audio.setLinkFromCache(trackId, node))
          return;

        if (!data || !data.play) {
          audio.deleteLink(trackId, node);
          node.textContent = '?';
          return;
        }

        if (clientHash === undefined) {
          var md5 = data.play.match(/(?:\?|&)md5=([\da-f]{32})/i);
          if (md5 && md5.length > 1) {
            md5 = md5[1];
            try {
              md5 = SaveFrom_Utils.md5(md5 + 'secret');
              audio.setLink(trackId, data, audio.getHash(md5));
              return;
            } catch (err) {}
          }

          audio.deleteLink(trackId, node);
          return;
        }

        var size = SaveFrom_Utils.getMatchFirst(data.play, /(?:\?|&)size=(\d+)/i);
        if (!size)
          return;

        audio.cache[trackId] = {};
        audio.cache[trackId].url = data.play + (clientHash ? '&clientHash=' + clientHash : '');

        var info = ' (' + SaveFrom_Utils.sizeHuman(size, 2);

        var duration = node.getAttribute('data-savefrom-helper-duration');
        if (data.track) {
          if (data.track.duration)
            duration = data.track.duration;

          if (data.track.ensemble && data.track.name) {
            var title = data.track.ensemble + ' - ' + data.track.name;
            audio.cache[trackId].title = title;
            audio.cache[trackId].downloadAttr = mono.fileName.modify(title + '.mp3');
          }
        }

        if (size && duration) {
          duration = parseInt(duration);
          if (isNaN(duration)) {
            delete audio.cache[trackId];
            return;
          }

          var bitrate = Math.floor((size / duration) / 125) + ' ' + language.kbps;
          info += ' ~ ' + bitrate;
        }

        info += ')';
        audio.cache[trackId].info = info;

        audio.setLinkFromCache(trackId, node);
      },


      getTitle: function(id, row) {
        if (!id || !row)
          return '';

        var name = '';

        var performer = row.querySelector('.m_c_artist, .mus-tr_artist, .m_portal_c_artist');
        var title = row.querySelector('.m_track_source, .mus-tr_song, .m_portla_track_name');

        if (performer) {
          performer = performer.textContent;
          if (performer)
            name += performer.trim();
        }

        if (title) {
          title = title.textContent;
          if (title) {
            if (name)
              name += ' - ';

            name += title.trim();
          }
        }

        if (name)
          return name.replace(/\<a\s+[^\>]+\>/ig, '').replace(/\<\/a\>/ig, '');

        return '';
      },


      secondsFromDurationNode: function(node) {
        if (!node)
          return 0;

        var text = node.textContent;
        if (!text)
          return 0;

        var m = text.match(/^(?:\s*(\d+)\s*\:)?\s*(\d+)\s*\:\s*(\d+)/);
        if (m && m.length > 3) {
          if (!m[1])
            m[1] = 0;

          return parseInt(m[1]) * 3600 + parseInt(m[2]) * 60 + parseInt(m[3]);
        }

        return 0;
      },

      getPlaylistName: function(container) {
        if (container === document) return;

        var title = container.querySelector('.mus_h2_tx');
        if (!title) return;
        return mono.fileName.modify(title.textContent) || undefined;
      },

      elIsHidden: function isHidden(el) {
        return (el.offsetParent === null)
      },

      getLayer: function() {
        var layer = document.getElementById('mmpcw');
        if (!layer) {
          return;
        }
        if (layer.classList.contains('__hidden')) {
          return;
        }
        layer = layer.querySelector('div.m_c_s[aria-hidden="false"]');
        if (!layer || audio.elIsHidden(layer)) {
          return;
        }
        return layer;
      },

      getPopup: function(title, type, onClose) {
        var template = SaveFrom_Utils.playlist.getInfoPopupTemplate();

        var progressEl;
        mono.create(template.textContainer, {
          append: [!title ? undefined : mono.create('p', {
              text: title,
              style: {
                color: '#0D0D0D',
                fontSize: '20px',
                marginBottom: '11px',
                marginTop: '13px'
              }
            }),
            progressEl = mono.create('p', {
              text: '',
              style: {
                color: '#868686',
                fontSize: '14px',
                lineHeight: '24px'
              }
            })
          ]
        });

        var popupEl = SaveFrom_Utils.popupDiv(template.body, 'sf_progress_popup', undefined, undefined, onClose);

        var setState = function(state) {
          if (setState.state === state) {
            return;
          }
          setState.state = state;

          template.buttonContainer.style.display = 'none';
          progressEl.style.display = 'none';
          mono.sendMessage({
            action: 'getWarningIcon',
            type: type,
            color: '#77D1FA'
          }, function(icon) {
            template.icon.style.backgroundImage = 'url(' + icon + ')';
          });
          if (state === 'progress') {
            progressEl.style.display = 'block';
          }
          if (state === 'error') {
            mono.sendMessage({
              action: 'getWarningIcon',
              type: type,
              color: '#AAAAAA'
            }, function(icon) {
              template.icon.style.backgroundImage = 'url(' + icon + ')';
            });
            progressEl.style.display = 'block';
          }
        };

        return {
          onPrepare: function(text) {
            setState('progress');
            progressEl.textContent = text;
          },
          onProgress: function(count, max) {
            progressEl.textContent = language.vkFoundFiles.replace('%d', count) + ' ' + language.vkFoundOf + ' ' + max;
          },
          onReady: function() {
            mono.trigger(popupEl, 'kill');
          },
          onError: function(text) {
            setState('error');
            progressEl.textContent = text;
          }
        }
      },

      getAudioLinksViaAPI: function(trackIdList, onProgress, cb) {
        var abort = false;
        var trackList = [];
        var len = trackIdList.length;
        var next = function() {
          if (abort) {
            return;
          }
          var trackIdArr = trackIdList.splice(0, 10);
          if (trackIdArr.length === 0) {
            return cb(trackList);
          }

          mono.sendMessage({
            action: 'getOkAudioListLinks',
            trackIdArr: trackIdArr,
            jsessionId: audio.jsessionId
          }, function(responseList) {
            if (Array.isArray(responseList)) {
              for (var i = 0, item; item = responseList[i]; i++) {
                if (typeof item.play !== 'string' || typeof item.track !== 'object') continue;

                var url = item.play;
                var md5 = url.match(/(?:\?|&)md5=([\da-f]{32})/i);
                if (!md5) continue;

                var title;
                if (item.track.name) {
                  title = item.track.name;
                }
                if (item.track.ensemble) {
                  title = item.track.ensemble + (title ? ' - ' + title : '');
                }
                if (!title) {
                  title = 'noname';
                }

                md5 = md5[1];
                try {
                  md5 = SaveFrom_Utils.md5(md5 + 'secret');
                  var hash = audio.getHash(md5);

                  url += '&clientHash=' + hash;

                  trackList.push({
                    url: url,
                    duration: item.track.duration || 0,
                    title: title,
                    filename: mono.fileName.modify(title) + '.mp3'
                  });
                } catch (err) {}
              }
            }
            onProgress(len - trackIdList.length, len);
            next();
          });
        };
        next();

        return {
          abort: function() {
            abort = true;
          }
        }
      },

      getAudioListLinksPopup: function(trackIdList, title, cb) {
        var process;
        var popup = this.getPopup(title, 'audio', function onClose() {
          if (process) {
            process.abort();
          }
        });
        var _cb = function(links) {
          if (links.length === 0) {
            popup.onError(language.vkMp3LinksNotFound);
            return;
          }
          popup.onReady();

          cb(links);
        };

        popup.onPrepare(language.download + ' ...');

        process = this.getAudioLinksViaAPI(trackIdList, popup.onProgress, _cb);
      },

      getAudioLinks: function(container, title, cb) {
        var rowList = container.querySelectorAll(['.m_portal_track', '.m_c_tr', '.mus-tr_i']);
        var trackIdList = [];
        for (var i = 0, row; row = rowList[i]; i++) {
          var trackIdObj = audio.getTrackId(row);
          for (var trackId in trackIdObj) {
            trackIdList.push(trackId);
          }
        }
        this.getAudioListLinksPopup(trackIdList, title, cb);
      },

      downloadMP3Files: function() {
        var container = audio.getLayer() || document;
        var title = audio.getPlaylistName(container);
        audio.getAudioLinks(container, title, function(trackList) {
          SaveFrom_Utils.downloadList.showBeforeDownloadPopup(trackList, {
            type: 'audio',
            folderName: title
          });
        });
      },

      showListOfAudioFiles: function(showPlaylist) {
        var container = audio.getLayer() || document;
        var title = audio.getPlaylistName(container);
        audio.getAudioLinks(container, title, function(trackList) {
          if (trackList.length) {
            if (showPlaylist) {
              SaveFrom_Utils.playlist.popupPlaylist(trackList, title, true);
            } else {
              SaveFrom_Utils.playlist.popupFilelist(trackList);
            }
            return;
          }

          alert(language.vkMp3LinksNotFound);
        });
      }
    };

    //  /AUDIO
    ///////////////////////////////////////////////////////////////////



    ///////////////////////////////////////////////////////////////////
    //  VIDEO

    var video = {
      requestMobileToken: function(response, cb) {
        var host = null;
        response.links.some(function(item) {
          var hostname = item.url.match(/\/\/([^/]+)/);
          hostname = hostname && hostname[1];
          if (hostname) {
            host = hostname;
            return true;
          }
        });
        SaveFrom_Utils.bridge({
          timeout: 3000,
          args: [host],
          func: function(host, cb) {
            var cookie = document.cookie;
            var vdsig = cookie && cookie.match(/vdsig=([^;]+);/);
            vdsig = vdsig && vdsig[1];
            if (vdsig) {
              return cb({
                vtkn: vdsig
              });
            }

            host = host || 'vd4.mycdn.me';
            var xhr = new XMLHttpRequest();
            xhr.open('POST', location.protocol + '//' + host + '/usr_login', true);
            xhr.withCredentials = true;
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhr.onreadystatechange = function() {
              if (xhr.readyState === 4 && xhr.status === 200) {
                var data = null;
                try {
                  data = JSON.parse(xhr.responseText);
                } catch (e) {}

                return cb(data);
              }
            };
            xhr.send();
          },
          cb: function(data) {
            if (!data || !data.vtkn) {
              return cb();
            }

            if (data.ttl) {
              data.expire = Date.now() + data.ttl * 1000;
              odnoklassniki.videoToken = data;
            }

            response.vtkn = data.vtkn;

            cb(response);
          }
        });
      },
      getMobileToken: function(response, cb) {
        if (response.vtkn) {
          return cb(response);
        }

        var videoToken = odnoklassniki.videoToken;
        if (videoToken && videoToken.expire > Date.now()) {
          response.vtkn = videoToken.vtkn;
          return cb(response);
        }

        return video.requestMobileToken(response, cb);
      },
      wrapMobileLinks: function(response, cb) {
        video.getMobileToken(response, function(response) {
          if (!response || !response.vtkn) {
            return cb();
          }

          response.action = 'getOkViaMobileWrapped';
          response.links.forEach(function(link) {
            var sep = !/\?/.test(link.url) ? '?' : '&';
            link.url += sep + 'vdsig=' + response.vtkn;
          });
          cb(response);
        });
      },
      prepareResponse: function(response, cb) {
        var abort = function() {
          cb(language.noLinksFound);
        };
        if (!response || !response.links) {
          return abort();
        }

        if (!preference.showUmmyItem && response.action === 'getRutubeLinks') {
          return abort();
        }

        if (response.action === 'getOkViaMobile') {
          return video.wrapMobileLinks(response, function(response) {
            if (!response) {
              return abort();
            }

            video.prepareResponse(response, cb);
          });
        }

        var prepareLinkType = null;
        if (response.action === 'getYoutubeLinks') {
          prepareLinkType = 'youtube';
        } else
        if (response.action === 'getVimeoLinks') {
          prepareLinkType = 'vimeo';
        } else
        if (response.action === 'getDailymotionLinks') {
          prepareLinkType = 'dailymotion';
        } else
        if (response.action === 'getRutubeLinks') {
          prepareLinkType = 'rutube';
        }

        var menuLinks = null;

        if (prepareLinkType) {
          menuLinks = SaveFrom_Utils.popupMenu.prepareLinks[prepareLinkType](response.links, response.title);
        } else {
          menuLinks = videoFeed.prepareLinks(response.links, response.title);
        }

        return cb(menuLinks);
      },

      matchOpenGraph: function(metadata) {
        if (!metadata || !metadata.movie || !metadata.movie.contentId) {
          return;
        }

        var url = metadata.movie.contentId;

        if (url.indexOf('rutube.') !== -1 && preference.showUmmyItem) {
          return {
            action: 'getRutubeLinks',
            links: [url]
          }
        }

        if (url.indexOf('pladform') !== -1) {
          var urlArgs = mono.parseUrl(url);
          return {
            action: 'getPladformVideo',
            extVideoId: {
              playerId: urlArgs.pl,
              videoId: urlArgs.videoid
            }
          };
        }

        var request = SaveFrom_Utils.embedDownloader.checkUrl(url);
        if (request) {
          return request;
        }

        var poster = metadata.movie.poster;
        if (poster) {
          var ytId = poster.match(/ytimg\.com\/vi\/([^\/]+)\//);
          ytId = ytId && ytId[1];
          if (ytId) {
            return {
              action: 'getYoutubeLinks',
              extVideoId: ytId
            }
          }
        }
      },

      switchMetadataProvider: function(metadata) {
        "use strict";
        if (!metadata || !metadata.provider || !metadata.movie) {
          return;
        }

        switch (metadata.provider) {
          case 'USER_YOUTUBE':
            if (metadata.movie.contentId) {
              return {
                request: {
                  action: 'getYoutubeLinks',
                  extVideoId: metadata.movie.contentId
                }
              };
            }
            break;
          case 'OPEN_GRAPH':
            var request = this.matchOpenGraph(metadata);
            if (request) {
              return {
                request: request
              }
            }
            break;
          case 'LIVE_TV_ODKL':
          case 'UPLOADED_ODKL':
          case 'UPLOADED':
          case 'PARTNER':
          case 'YKL':
            if (metadata.videos && metadata.movie.title) {
              return {
                request: {
                  action: 'wrapMobileLinks',
                  title: metadata.movie.title,
                  links: metadata.videos
                }
              };
            }

            /* via mobile
             return {
             request: {
             action: 'okDirectOrMobile',
             mvId: metadata.movie.id,
             metadata: metadata,
             title: metadata.movie.title,
             links: null
             }
             };
             */

            /* odirect only
             if (metadata.videos && metadata.movie.title) {
             return {
             links: videoFeed.prepareLinks(metadata.videos, metadata.movie.title)
             };
             }*/
            break;
        }
      },

      getPlayerMetadata: function(movieId, sid, cb, withSid) {
        var params = {
          cmd: 'videoPlayerMetadata',
          mid: movieId,
          rnd: Date.now()
        };

        if (withSid) {
          params.mtId = sid;
        }

        mono.request({
          url: location.protocol + '//' + location.host + '/dk?' + mono.param(params),
          json: true,
          localXHR: true
        }, function(err, resp, metadata) {
          if (err) {
            if (!withSid && sid) {
              video.getPlayerMetadata(movieId, sid, cb, 1);
              return;
            }

            return cb();
          }

          return cb(metadata);
        });
      },

      getEmbed: function(contentId, cb) {
        var params = mono.parseUrl(contentId);
        if (!params.id || !params.sig) {
          return cb();
        }

        var url = 'http://cdn-ok.com/video/get/?' + mono.param({
          id: params.id,
          format: 1,
          sig: params.sig,
          sig2: 'oldRotator'
        });

        mono.sendMessage({
          action: 'getData',
          url: url
        }, function(data) {
          if (!data) {
            return cb();
          }

          var jsonList = mono.findJson(data, [/"sourceType":/, /"sourceId":/]);

          var isFound = jsonList.some(function(json) {
            if (json.sourceType === 'youtube' && json.sourceId) {
              cb({
                request: {
                  action: 'getYoutubeLinks',
                  extVideoId: json.sourceId
                }
              });
              return true;
            }
          });

          if (!isFound) {
            return cb();
          }
        });
      },

      readMetadata: function(metadata, cb, skipPlayerMeta) {
        if (metadata.movie) {
          if (/cdn-ok\.com\/embed/.test(metadata.movie.contentId)) {
            return this.getEmbed(metadata.movie.contentId, function(info) {
              if (!info || !info.request) {
                return cb();
              }

              mono.sendMessage(info.request, function(response) {
                video.prepareResponse(response, cb);
              });
            });
          }
        }

        if (!skipPlayerMeta && metadata.movie && metadata.movie.movieId) {
          var sid = metadata.movie.link && mono.parseUrl(metadata.movie.link, {
            sep: '&amp;'
          })['st.vpl.sid'];
          return this.getPlayerMetadata(metadata.movie.movieId, sid, function(_metadata) {
            video.readMetadata(_metadata || metadata, cb, 1);
          });
        }

        var info = this.switchMetadataProvider(metadata);
        if (!info) {
          return cb();
        }

        if (info.links) {
          return cb(info.links);
        }

        if (info.request) {
          if (info.request.action === 'getRutubeLinks') {
            video.prepareResponse(info.request, cb);
          } else
          if (info.request.action === 'wrapMobileLinks') {
            video.wrapMobileLinks(info.request, function(response) {
              video.prepareResponse(response, function(menuLinks) {
                cb(menuLinks, 1);
              });
            });
          } else {
            mono.sendMessage(info.request, function(response) {
              video.prepareResponse(response, cb);
            });
          }
        } else {
          cb();
        }
      },

      loadLinks: function(info, menu) {
        var linkCache = odnoklassniki.linkCache;
        var cacheKey = JSON.stringify(info);
        var cache = linkCache[cacheKey];
        if (cache) {
          return menu.update(cache);
        }

        var onGetMeta = function(metadata, skipPlayerMeta) {
          var onFail = function() {
            menu.update(language.noLinksFound);
          };

          if (!metadata) {
            return onFail();
          }

          video.readMetadata(metadata, function(menuLinks, noCache) {
            if (!menuLinks) {
              return onFail();
            }

            if (Array.isArray(menuLinks) && !menuLinks.length) {
              noCache = 1;
            }

            if (!noCache) {
              linkCache[cacheKey] = menuLinks;
            }

            menu.update(menuLinks);
          }, skipPlayerMeta);
        };

        if (info.metadata) {
          onGetMeta(info.metadata);
        } else
        if (info.request) {
          if (info.request.action === 'getOkMetadata') {
            mono.sendMessage(info.request, onGetMeta);
          } else
          if (info.request.action === 'getPlayerMetadata') {
            this.getPlayerMetadata(info.request.extVideoId, info.request.sid, function(metadata) {
              onGetMeta(metadata, 1);
            });
          } else
          if (info.request.action === 'getRutubeLinks') {
            video.prepareResponse(info.request, function(menuLinks) {
              menu.update(menuLinks);
            });
          } else {
            mono.sendMessage(info.request, function(response) {
              video.prepareResponse(response, function(menuLinks) {
                menu.update(menuLinks);
              });
            });
          }
        } else {
          menu.update(language.noLinksFound);
        }
      },

      appendLinkUnderVideo: function(container, info) {
        "use strict";
        var insertContainer = container.querySelector('.vp-layer-info_cnt');
        if (!insertContainer) {
          return;
        }

        var exButton = insertContainer.querySelector('.' + downloadLinkClassName);

        var button = mono.create('span', {
          className: downloadLinkClassName,
          style: {
            marginLeft: '12px'
          },
          on: [
            ['click', function(e) {
              e.stopPropagation();
            }],
            ['mousedown', function(e) {
              e.stopPropagation();
            }],
            ['keydown', function(e) {
              e.stopPropagation();
            }]
          ],
          append: [
            mono.create('a', {
              href: '#',
              text: language.download,
              on: ['click', function(e) {
                e.preventDefault();

                mono.onRemoveEvent(button, odnoklassniki.hideMenu);

                if (odnoklassniki.contextMenu && odnoklassniki.contextMenu.isShow) {
                  if (odnoklassniki.contextMenu.button !== this) {
                    odnoklassniki.hideMenu();
                  } else {
                    odnoklassniki.hideMenu();
                    return;
                  }
                }

                var menu = odnoklassniki.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, language.download + '...', 'sf-single-video-menu', {
                  parent: container
                });

                if ([1].indexOf(preference.cohortIndex) !== -1) {
                  mono.sendMessage({
                    action: 'trackCohort',
                    t: 'event',
                    ec: 'ok',
                    ea: 'click',
                    el: 'video-under'
                  });
                }

                video.loadLinks(info, menu);
              }]
            })
          ]
        });

        if (exButton && exButton.parentNode) {
          exButton.parentNode.replaceChild(button, exButton);
          exButton = null;
        } else {
          insertContainer.appendChild(button);
        }
      },

      getPlayerOptions: function(node) {
        var optionsNode = mono.getParent(node, '[data-player-element-id][data-options]');

        var options = optionsNode && optionsNode.dataset.options;

        if (!options) {
          return;
        }

        try {
          options = JSON.parse(options);
        } catch (e) {}

        var flashvars = options.flashvars;

        if (!flashvars) {
          return;
        }

        if (flashvars.metadata) {
          var metadata = null;

          try {
            metadata = JSON.parse(flashvars.metadata);
          } catch (e) {}

          if (metadata) {
            return {
              metadata: metadata
            }
          }
        }

        if (flashvars.metadataUrl) {
          return {
            request: {
              action: 'getOkMetadata',
              url: decodeURIComponent(flashvars.metadataUrl)
            }
          }
        }

        var url = options.url;
        if (url) {
          var request = SaveFrom_Utils.embedDownloader.checkUrl(url);
          if (request) {
            return {
              request: request
            }
          }

          if (url.indexOf('rutube.') !== -1) {
            return {
              request: {
                action: 'getRutubeLinks',
                links: [url]
              }
            }
          }
        }
      },

      catchPopup: function() {
        "use strict";
        var videoContainer = null;
        this.lastWaitEl && this.lastWaitEl.abort();

        this.lastWaitEl = this.waitEl(function() {
          videoContainer = document.querySelector('.vp_video .vid-card_cnt');
          if (!videoContainer) {
            return;
          }

          return videoContainer;
        }, function() {
          var parent = mono.getParent(videoContainer, '.vp_video');
          if (!parent) {
            return;
          }

          var info = video.getPlayerOptions(videoContainer);
          if (info) {
            video.appendLinkUnderVideo(parent.parentNode, info);
          }
        });
      },

      rmBtn: function() {
        var dlBtn = document.querySelectorAll('.' + downloadLinkClassName);
        for (var i = 0, item; item = dlBtn[i]; i++) {
          item.parentNode.removeChild(item);
        }
      },

      lastWaitEl: null,
      waitEl: function(func, cb, options) {
        var out;
        var capsule = mono.extend({
          abort: function() {
            clearInterval(capsule.timeout);
            capsule.isAborted = true;
          }
        }, {
          delay: 500,
          repeat: 12,
          isAborted: false,
          timeout: null
        }, options);

        if (out = func()) {
          cb(out);
          return capsule;
        }

        (function wait() {
          capsule.repeat--;
          capsule.timeout = setTimeout(function() {
            if (capsule.isAborted) {
              return;
            }

            if (out = func()) {
              return cb(out);
            }

            if (!capsule.isAborted && capsule.repeat) {
              wait();
            }
          }, capsule.delay);
        })();

        return capsule;
      }
    };

    var videoFeed = {
      btnClassName: 'sf-feed-dl-btn',
      style: undefined,
      thumbClassName: 'vid-card_img',
      prepareLinks: function(links, title) {
        if (!links || !links.length) {
          return language.noLinksFound;
        }

        if (typeof links === 'string') {
          return links;
        }

        title = title || '';

        var menuLinks = [];
        var popupLink;
        var quality;
        var format;
        var url;
        for (var i = 0, len = links.length; i < len; i++) {
          var link = links[i];
          if (typeof(link) === 'object' && link.url) {
            url = link.url;
            var ext = link.ext;

            if (!ext) {
              ext = 'MP4';
              if (link.url.indexOf('.mp4') !== -1) {
                ext = 'MP4';
              }
              if (url.indexOf('.flv') !== -1) {
                ext = 'FLV';
              }
              if (link.url.indexOf('.mov') !== -1) {
                ext = 'MOV';
              }
              if (link.url.indexOf('.mpg') !== -1) {
                ext = 'MPG';
              }
            }

            ext = ext.toLowerCase();
            format = ext.toUpperCase();
            quality = link.subname || link.quality || link.name || ext;
          } else {
            url = link;
            ext = 'MP4';
            if (url.indexOf('.mp4') !== -1) {
              ext = 'MP4';
            }
            if (url.indexOf('.flv') !== -1) {
              ext = 'FLV';
            }
            if (url.indexOf('.mov') !== -1) {
              ext = 'MOV';
            }
            if (url.indexOf('.mpg') !== -1) {
              ext = 'MPG';
            }

            ext = ext.toLowerCase();
            format = ext.toUpperCase();

            quality = ext;
            var qualityMath = SaveFrom_Utils.getMatchFirst(links[i], /\.(\d+)\.mp4/i);
            if (qualityMath) {
              quality = qualityMath;
            }
          }

          var trueName = [144, 240, 360, 480, 720, 1080, 1440, '4K'];
          var origName = ['mobile', 'lowest', 'low', 'sd', 'hd', 'full', 'quad', 'ultra'];
          var pos = origName.indexOf(quality);
          if (pos !== -1) {
            quality = trueName[pos];
          }

          popupLink = {
            href: url,
            title: link.title ? link.title : title,
            ext: ext,
            format: format,
            quality: quality,
            forceDownload: true
          };
          menuLinks.push(popupLink);
        }
        return menuLinks;
      },
      getPosterData: function(node) {
        var infoNode = mono.getParent(node, '[hrefattrs]');

        var info = infoNode && infoNode.getAttribute('hrefattrs');

        if (!info) {
          return;
        }

        var params = mono.parseUrl(info, {
          params: true
        });

        var sid = params['st.vpl.sid'];
        var vid = params['st.vpl.id'];
        if (!vid) {
          var vidNode = mono.getParent(node, '[data-id]');
          vid = vidNode && vidNode.dataset.id;

          if (vid && vid[0] === 'c') {
            return;
          }
        }

        if (vid && vid.substr(0, 3) === 'OK_') {
          vid = SaveFrom_Utils.getMatchFirst(vid, /OK_\d+_(\d+)/);
        }

        if (!vid) {
          return;
        }

        return {
          request: {
            sid: sid,
            action: 'getPlayerMetadata',
            extVideoId: vid
          }
        };
      },
      onBtnClick: function(e) {
        e.preventDefault();
        e.stopPropagation();

        var info = JSON.parse(this.dataset.sfContext);
        mono.onRemoveEvent(this, odnoklassniki.hideMenu);

        if (odnoklassniki.contextMenu && odnoklassniki.contextMenu.isShow) {
          if (odnoklassniki.contextMenu.button !== this) {
            odnoklassniki.hideMenu();
          } else {
            odnoklassniki.hideMenu();
            return;
          }
        }

        if ([1].indexOf(preference.cohortIndex) !== -1) {
          if (info.isChat) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'ok',
              ea: 'click',
              el: 'video-message'
            });
          } else {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'ok',
              ea: 'click',
              el: 'video-feed-on-video'
            });
          }
        }

        // post in popup
        var menuParent = document.querySelector('#mtLayer.__active #mtLayerMain > div');
        if (!menuParent) {
          // video gaallery
          menuParent = document.getElementById('vv_content');
        }
        if (!menuParent) {
          // pm msgs
          menuParent = document.getElementById('__messagesList__');
          if (menuParent && !menuParent.offsetParent) {
            menuParent = null;
          }
        }
        if (!menuParent && mono.matches(this, '#mainContent ' + this.tagName)) {
          menuParent = mono.getParent(this, '#mainContent');
        }
        var menu = odnoklassniki.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, language.download + ' ...', 'sf-popupMenu', {
          parent: menuParent || undefined
        });

        video.loadLinks(info, menu);
      },
      onImgOver: function(e) {
        var _this = this;
        var isChat = mono.matches(this, '.mdialog_chat_window .d_comment_text_w ' + this.tagName);

        var container = null;
        if (isChat) {
          container = mono.getParentByClass(this, 'd_comment_text_w');
        } else
        if (mono.matches(this, '.video-card > .video-card_img-w ' + this.tagName)) {
          container = mono.getParentByClass(this, 'video-card_img-w');
        } else
        if (this.classList.contains('vid-card_cnt')) {
          container = this;
        } else
        if (mono.matches(this, '.vid-card_cnt ' + this.tagName)) {
          container = mono.getParentByClass(this, 'vid-card_cnt');
        }

        if (!container) {
          return;
        }

        if (container.getElementsByClassName(videoFeed.btnClassName).length) {
          return;
        }

        var isVideoVitrina = mono.matches(this, '.vid-card_img__link ' + this.tagName);

        var btnData = video.getPlayerOptions(this);
        if (!btnData) {
          btnData = videoFeed.getPosterData(this);
        }
        if (!btnData) {
          return;
        }

        btnData.isChat = isChat;

        var customStyle = {};

        if (isChat) {
          mono.extend(customStyle, {
            left: '15px',
            top: '15px'
          });
        }

        if (isVideoVitrina) {
          mono.extend(customStyle, {
            backgroundColor: '#454648',
            borderColor: 'rgb(53, 53, 53)'
          });
        }

        var btn = mono.create('i', {
          class: [videoFeed.btnClassName, 'sf-video-feed-bind-on-insert'],
          style: customStyle,
          data: {
            sfContext: JSON.stringify(btnData)
          },
          title: language.download
        });

        btn.appendChild(mono.create(SaveFrom_Utils.svg.getSvg('download'), {
          style: {
            width: '12px',
            height: '12px',
            margin: '4px'
          }
        }));

        container.appendChild(btn);
      },
      injectStyle: function() {
        if (this.style) {
          if (!this.style.parentNode) {
            document.head.appendChild(this.style);
          }
          return;
        }

        this.style = mono.create('style', {
          text: mono.style2Text({
            'div > .sf-feed-dl-btn': {
              display: 'none',
              border: '1px solid #F8F8F8',
              width: '20px',
              height: '20px',
              padding: 0,
              position: 'absolute',
              top: '5px',
              left: '5px',
              zIndex: 1,
              cursor: 'pointer',
              backgroundColor: '#F8F8F8'
            },
            'div > .sf-feed-dl-btn svg path': {
              fill: '#eb722e'
            },
            'div > .sf-feed-dl-btn:hover svg path': {
              fill: '#00B75A'
            },
            'div > .sf-feed-dl-btn:active': {
              outline: 0,
              boxShadow: 'inset 0 3px 5px rgba(0, 0, 0, 0.125)'
            },
            'div:hover > .sf-feed-dl-btn': {
              display: 'block'
            }
          })
        });

        document.head.appendChild(this.style);
      },
      disable: function() {
        if (this.style) {
          this.style.parentNode && this.style.parentNode.removeChild(this.style);
        }
      },
      rmBtn: function() {
        var btnList = document.querySelectorAll('.sf-feed-dl-btn');
        for (var i = 0, item; item = btnList[i]; i++) {
          item.parentNode.removeChild(item);
        }
        var dataAttr = mono.dataAttr2Selector('sfSkip2');
        var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
        for (i = 0, item; item = dataAttrList[i]; i++) {
          item.removeAttribute(dataAttr);
        }
      }
    };

    //  /VIDEO
    ///////////////////////////////////////////////////////////////////


    //  PHOTO
    ///////////////////////////////////////////////////////////////////

    var photo = {
      style: null,
      rmCurrentPhotoBtn: function(insertContainer) {
        var exBtn = undefined;
        var imgList = document.querySelectorAll('.sf-dl-current-photo-btn');
        for (var i = 0, imgItem; imgItem = imgList[i]; i++) {
          if (!insertContainer || !insertContainer.contains(imgItem)) {
            imgItem.parentNode.removeChild(imgItem);
          } else {
            exBtn = imgItem;
          }
        }
        return exBtn;
      },
      addDlCurrentPhotoBtn: function(container) {
        var exBtn = this.rmCurrentPhotoBtn(container);
        if (exBtn) {
          return;
        }

        var _this = odnoklassniki;

        container.appendChild(mono.create('a', {
          class: 'sf-dl-current-photo-btn',
          href: '#',
          title: language.download,
          on: ['click', function(e) {
            e.stopPropagation();
            e.preventDefault();

            if (_this.contextMenu && _this.contextMenu.isShow && _this.contextMenu.button === this) {
              if (_this.contextMenu.button !== this) {
                _this.hideMenu();
              } else {
                _this.hideMenu();
                return;
              }
            }

            var onKeyDown = function(e) {
              if (e.keyCode === 18 || e.keyCode === 17) return;
              menu.hide();
              document.removeEventListener('keydown', onKeyDown);
            };

            var menu = _this.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, language.download + ' ...', "photoDlMenu", {
              parent: container,
              onShow: function() {
                document.addEventListener('keydown', onKeyDown);
              },
              onHide: function() {
                document.removeEventListener('keydown', onKeyDown);
              }
            });

            var linkList = [];

            var img = container.querySelector('img.photo-layer_img');
            if (img) {
              var url = img.dataset.fsSrc || img.dataset.nfsSrc || img.src;
              if (url) {
                linkList.push({
                  href: url,
                  title: 'photo_' + parseInt(Date.now() / 1000),
                  quality: language.download,
                  format: ' ',
                  ext: 'jpg',
                  forceDownload: true,
                  isBlank: true,
                  func: function() {
                    menu.hide();
                  }
                });
              }
            }

            if (!img) {
              img = container.querySelector('div.gif[data-gifsrc]');
            }

            if (img) {
              var map = {
                webmsrc: 'webm',
                mp4src: 'mp4',
                gifsrc: 'gif'
              };
              Object.keys(map).forEach(function(type) {
                var url = img.dataset[type];
                if (!url) {
                  return;
                }

                var ext = map[type];

                linkList.push({
                  href: url,
                  title: 'gif_' + parseInt(Date.now() / 1000),
                  quality: language.download,
                  format: ext.toUpperCase(),
                  ext: ext,
                  forceDownload: true,
                  isBlank: true,
                  func: function() {
                    menu.hide();
                  }
                });
              });
            }

            if (linkList.length === 0) {
              menu.update(language.noLinksFound);
              return;
            }

            menu.update(linkList);
          }],
          append: [
            mono.create(SaveFrom_Utils.svg.getSvg('download'), {
              style: {
                width: '12px',
                height: '12px',
                margin: '4px'
              }
            })
          ]
        }));
      },
      injectStyle: function() {
        if (photo.style) {
          if (!photo.style.parentNode) {
            document.head.appendChild(photo.style);
          }
          return;
        }

        photo.style = mono.create('style', {
          text: mono.style2Text({
            'div > .sf-dl-current-photo-btn': {
              display: 'none',
              border: '1px solid #F8F8F8',
              width: '20px',
              height: '20px',
              padding: 0,
              position: 'absolute',
              backgroundColor: '#F8F8F8',
              top: '73px',
              left: '90px',
              zIndex: 100,
              cursor: 'pointer'
            },
            'div > .sf-dl-current-photo-btn svg path': {
              fill: '#eb722e'
            },
            'div > .sf-dl-current-photo-btn:hover svg path': {
              fill: '#00B75A'
            },
            'div > .sf-dl-current-photo-btn:active': {
              outline: 0,
              boxShadow: 'inset 0 3px 5px rgba(0, 0, 0, 0.125)'
            },
            'div:hover > .sf-dl-current-photo-btn': {
              display: 'block'
            }
          })
        });

        document.head.appendChild(photo.style);
      },
      addCurrentDlBtn: function(container) {
        if (container.dataset.sfSkip2 === '1') {
          return;
        }
        container.dataset.sfSkip2 = '1';

        var img = container.querySelector('img.photo-layer_img');
        if (img) {
          var url = img.dataset.fsSrc || img.dataset.nfsSrc || img.src;
          if (!url) {
            img = null;
          }
        }

        if (!img) {
          img = container.querySelector('div.gif[data-gifsrc]');
        }

        if (!img) {
          return;
        }

        this.addDlCurrentPhotoBtn(container);
      }
    };

    //  /PHOTO
    //////////////////////////////////////////////////////////////////
  }, null, function syncIsActive() {
    "use strict";
    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.ok.ru/*',
        '*://*.odnoklassniki.ru/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (mono.isIframe()) {
      return false;
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('mailru', function(moduleName, initData) {
    "use strict";

    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleMailru ? 1 : 0;

    var allowDownloadMode = mono.isSafari || mono.isChrome || mono.isFF || (mono.isGM && mono.isTM);

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return mailru.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'downloadMP3Files') {
        if (allowDownloadMode) {
          audio.downloadMP3Files();
        } else {
          audio.showListOfAudioFiles(false);
        }
      }
      if (message.action === 'downloadPlaylist') {
        audio.showListOfAudioFiles(true);
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        mailru.run();
      });
    }

    var mailru = {
      contextMenu: null,
      run: function() {
        moduleState = 1;

        audio.injectStyle();
        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          this.mutationMode.enable();
        }
      },
      changeState: function(state) {
        moduleState = state;
        audio.rmBtn();
        video.rmBtn();
        this.mutationMode.stop();
        this.hideMenu();
        if (state) {
          this.run();
        }
      },
      hideMenu: function() {
        if (mailru.contextMenu) {
          mailru.contextMenu.hide();
          mailru.contextMenu = null;
        }
      },
      mutationMode: {
        observer: null,
        stop: function() {
          if (this.observer) {
            this.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        wrapAudioOnMouseOver: function() {
          if (!moduleState) {
            return;
          }

          if (this.dataset.sfSkip > 0) {
            return;
          }
          this.dataset.sfSkip = '1';

          var context = JSON.parse(this.dataset.sfContext);
          audio.onTrackOver(this, context.type);
        },
        enable: function() {
          if (this.observer) {
            return this.observer.start();
          }

          this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node, context;

              summary = summaryList[0];
              for (n = 0; node = summary.added[n]; n++) {
                context = {};
                context.type = 0;
                node.dataset.sfContext = JSON.stringify(context);
                mono.one(node, 'mouseover', mailru.mutationMode.wrapAudioOnMouseOver);
              }

              summary = summaryList[1];
              for (n = 0; node = summary.added[n]; n++) {
                context = {};
                context.type = 1;
                node.dataset.sfContext = JSON.stringify(context);
                mono.one(node, 'mouseover', mailru.mutationMode.wrapAudioOnMouseOver);
              }

              var videoInfo, parent, info;

              for (i = 2; i < 4; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  if (node.dataset.sfSkip > 0) {
                    continue;
                  }
                  node.dataset.sfSkip = '1';

                  videoInfo = video.getVideoId(node);
                  if (!videoInfo) {
                    continue;
                  }

                  parent = mono.getParentByClass(node, 'b-video__left');
                  if (!parent) {
                    continue;
                  }

                  info = parent.querySelector('.b-video__info-time');
                  if (!info) {
                    continue;
                  }

                  video.insertBtnInPopup(videoInfo, info);
                }
              }

              for (i = 4; i < 6; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  if (node.dataset.sfSkip > 0) {
                    continue;
                  }
                  node.dataset.sfSkip = '1';

                  videoInfo = video.getVideoId(node);
                  if (!videoInfo) {
                    continue;
                  }

                  parent = mono.getParentByClass(node, 'sp-video__item-page');
                  if (!parent) {
                    continue;
                  }

                  info = parent.querySelector('.sp-video__item-page__info__additional');
                  if (!info) {
                    continue;
                  }

                  video.insertBtnInPage(videoInfo, info, 1);
                }
              }

              for (i = 6; i < 8; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  if (node.dataset.sfSkip > 0) {
                    continue;
                  }
                  node.dataset.sfSkip = '1';

                  parent = mono.getParentByClass(node, 'sp-video__item-page-new__video-content');
                  info = parent && parent.querySelector('.sp-video__item-page-new__info__additional');
                  videoInfo = parent && video.getVideoContentVideoId(parent);
                  if (!info || !videoInfo) {
                    continue;
                  }

                  video.insertBtnInPage(videoInfo, info, 2);
                }
              }

              summary = summaryList[0];
              for (n = 0; node = summary.removed[n]; n++) {
                mono.onRemoveListener(node);
              }
            },
            queries: [{
              css: '.jp__track',
              is: 'added'
            }, {
              css: '.song-item',
              is: 'added'
            }, {
              css: '.b-video__left .b-video__container object',
              is: 'added'
            }, {
              css: '.b-video__left .b-video__container video',
              is: 'added'
            }, {
              css: '.sp-video__item-page .sp-video__item-page__video-wrapper object',
              is: 'added'
            }, {
              css: '.sp-video__item-page .sp-video__item-page__video-wrapper video',
              is: 'added'
            }, {
              css: '.sp-video__item-page-new .sp-video__item-page-new__video-content video',
              is: 'added'
            }, {
              css: '.sp-video__item-page-new .sp-video__item-page-new__video-content object',
              is: 'added'
            }, {
              css: '.' + mono.onRemoveClassName,
              is: 'removed'
            }]
          });
        }
      }
    };

    var tooltip = {
      tooltip: undefined,
      updatePos: function(button, options) {
        var btnPosition = SaveFrom_Utils.getPosition(button);
        var size = SaveFrom_Utils.getSize(this.tooltip);

        this.tooltip.style.top = (btnPosition.top + options.top - size.height) + 'px';

        var left = btnPosition.left + parseInt(options.width / 2) - parseInt(size.width / 2);
        var pageWidth = document.body.clientWidth + document.body.scrollLeft;
        if (pageWidth < left + size.width) {
          left = pageWidth - size.width;
        }
        this.tooltip.style.left = left + 'px';
      },
      show: function(button, options) {
        var _this = this;
        if (this.tooltip !== undefined) {
          this.hide();
        } else {
          this.tooltip = mono.create('div', {
            class: 'sf-tooltip',
            style: mono.extend({
              position: 'absolute',
              display: 'none',
              zIndex: 9999,
              opacity: 0,
              transition: 'opacity 0.2s',
              whiteSpace: 'nowrap',
              fontSize: '12px',
              color: '#111',
              fontFamily: 'arial, verdana, sans-serif, Lucida Sans'
            }, options.style),
            on: ['mouseenter', function(e) {
              _this.hide();
            }]
          });
          document.body.appendChild(this.tooltip);
        }
        this.tooltip.style.display = 'block';

        setTimeout(function() {
          _this.updatePos(button, options);
          _this.tooltip.style.opacity = 1;
        });

        return this.tooltip;
      },
      hide: function() {
        this.tooltip.style.opacity = 0;
        this.tooltip.style.display = 'none';
      }
    };

    var getFolderName = function() {
      var folderName = document.title;
      var sep = folderName.indexOf('-');
      if (sep !== -1) {
        folderName = folderName.substr(0, sep - 1);
      }

      return mono.fileName.modify(folderName);
    };

    var audio = {
      className: 'sf-audio-panel',
      lastRow: null,
      style: undefined,
      secondsFromDuration: function(time) {
        var minSec = time.split(':').map(function(item) {
          return parseInt(item);
        });
        return minSec[0] * 60 + minSec[1];
      },
      getTitle: function(row) {
        var title = row.querySelector('.jp__track-fullname');
        var artist = row.querySelector('.jp__track-performer');
        if (artist === null) {
          artist = row.querySelector('.jp__track-name-text');
          if (artist !== null) {
            artist = artist.querySelector('a:not(.jp__track-fullname)');
            if (artist !== null) {
              var tmp = title;
              title = artist;
              artist = tmp;
            }
          }
        }
        if (artist !== null) {
          artist = artist.textContent.trim();
          if (!artist) {
            artist = 'noname';
          }
        } else {
          artist = '';
        }
        if (artist) {
          artist = artist + ' - ';
        } else {
          artist = '';
        }
        if (title === null) {
          return;
        }
        title = title.textContent;
        var fullName = artist + title;
        fullName = fullName.replace(/[\r\n\t\s]+/img, ' ').replace(/\s+/g, ' ').trim();
        return fullName;
      },
      getTitle2: function(row) {
        var title = row.querySelector('.title');
        var name = row.querySelector('.name');
        var author = row.querySelector('.author');
        if (name) {
          name = name.textContent;
          if (!name.length) {
            name = 'noname';
          }
        }
        if (author) {
          author = author.textContent;
        }
        var fullName = '';
        if (name && author) {
          fullName = author + ' - ' + name;
        } else {
          fullName = title.textContent;
        }
        fullName = fullName.replace(/[\r\n\t\s]+/img, ' ').replace(/\s+/g, ' ').trim();
        return fullName;
      },
      getMp3UrlList: function(cb) {
        var type = 1;
        var rowList = document.querySelectorAll('.song-item');
        if (rowList.length === 0) {
          rowList = document.querySelectorAll('.jp__track');
          type = 0;
        }
        var waitCount = rowList.length;
        var readyCount = 0;
        var urlList = [];
        var dblList = {};
        var isReady = function() {
          if (waitCount === readyCount) {
            cb(urlList);
          }
        };
        if (waitCount === readyCount) {
          return isReady();
        }
        for (var i = 0, row; row = rowList[i]; i++) {
          audio.getUrl(row, type, function(url) {
            readyCount++;
            if (!url) {
              return isReady();
            }
            if (dblList[url]) {
              return isReady();
            }
            dblList[url] = 1;

            var durationNode;
            var fullTitle;
            if (type === 0) {
              durationNode = row.querySelector('.jp__track-duration-total');
              fullTitle = audio.getTitle(row);
              if (!fullTitle) {
                return isReady();
              }
            } else {
              durationNode = row.querySelector('.time');
              fullTitle = audio.getTitle2(row);
              if (!fullTitle) {
                return isReady();
              }
            }
            var filename = mono.fileName.modify(fullTitle) + '.mp3';
            var duration = durationNode && audio.secondsFromDuration(durationNode.textContent);
            urlList.push({
              url: url,
              filename: filename,
              title: fullTitle,
              duration: duration
            });
            isReady();
          });
        }
      },
      showListOfAudioFiles: function(isPlaylist) {
        audio.getMp3UrlList(function(list) {
          if (list.length === 0) {
            return;
          }
          if (isPlaylist) {
            SaveFrom_Utils.playlist.popupPlaylist(list, getFolderName(), true);
          } else {
            SaveFrom_Utils.playlist.popupFilelist(list);
          }
        });
      },
      downloadMP3Files: function() {
        audio.getMp3UrlList(function(list) {
          if (list.length === 0) {
            return;
          }
          SaveFrom_Utils.downloadList.showBeforeDownloadPopup(list, {
            type: 'audio',
            folderName: getFolderName()
          });
        });
      },
      onDlBtnOver: function(e) {
        if (mono.isOpera || mono.isSafari) {
          return;
        }
        var duration = this.dataset.duration;
        if (e.type === 'mouseenter') {
          var _this = this;
          var options = undefined;
          var ttp = tooltip.show(_this, options = {
            top: -14,
            width: 16,
            style: {
              backgroundColor: '#fff',
              border: '1px solid #ccc',
              color: 'rgb(48, 48, 48)'
            }
          });

          if (_this.dataset.bitrate) {
            ttp.style.padding = '2px 5px 3px';
            ttp.textContent = ' (' + _this.dataset.size + ' ~ ' + _this.dataset.bitrate + ')';
            return;
          }

          if (_this.dataset.size) {
            ttp.style.padding = '2px 5px 3px';
            ttp.textContent = ' (' + _this.dataset.size + ')';
            return;
          }

          ttp.style.padding = '2px 2px 0 2px';
          ttp.textContent = '';
          ttp.appendChild(mono.create('img', {
            src: '//my9.imgsmail.ru/r/my/preloader_circle_16.gif',
            height: 16,
            width: 16
          }));

          mono.sendMessage({
            action: 'getFileSize',
            url: _this.href
          }, function(response) {
            ttp.style.padding = '2px 5px 3px';
            if (!response.fileSize) {
              ttp.textContent = language.getFileSizeFailTitle;
              tooltip.updatePos(_this, options);
              return;
            }
            var size = SaveFrom_Utils.sizeHuman(response.fileSize, 2);

            if (duration) {
              var bitrate = Math.floor((response.fileSize / duration) / 125) + ' ' + language.kbps;

              _this.dataset.bitrate = bitrate;
              _this.dataset.size = size;

              ttp.textContent = ' (' + size + ' ~ ' + bitrate + ')';
            } else {
              _this.dataset.size = size;

              ttp.textContent = ' (' + size + ')';
            }

            tooltip.updatePos(_this, options);
          });
          return;
        }
        // mouseleave
        tooltip.hide();
      },
      getUrlViaBridge: function(row, cb) {
        if (audio.getUrlViaBridge.index === undefined) {
          audio.getUrlViaBridge.index = 0;
        }

        var className = 'sf-bridge-item-' + audio.getUrlViaBridge.index;
        audio.getUrlViaBridge.index++;
        row.classList.add(className);

        SaveFrom_Utils.bridge({
          args: [{
            className: className
          }],
          func: function(data, cb) {
            var className = data.className;
            var el = document.getElementsByClassName(className)[0];
            el.classList.remove(className);

            var $data = jQuery(el).data();
            if ($data && $data.item) {
              cb($data.item.url);
            }
          },
          cb: function(data) {
            cb(data);
          },
          timeout: 300
        });
      },
      getUrl: function(row, rowType, cb) {
        var url = row.dataset.url;
        if (url) {
          return cb(url);
        }
        if (rowType === 0) {
          var urlLink = row.querySelector('a.jp__track-fullname-link');
          if (urlLink === null) {
            return cb();
          }
          urlLink = urlLink.href;
          var params = mono.parseUrl(urlLink);
          if (!params.file || !params.uid) {
            return audio.getUrlViaBridge(row, function(url) {
              if (url) {
                row.dataset.url = url;
              }
              cb(url);
            });
          }
          return cb('http://music.my.mail.ru/file/' + params.file + '.mp3?u=' + encodeURIComponent(params.uid));
        } else
        if (rowType === 1) {
          if (row.dataset.file) {
            return cb('http://music.my.mail.ru/file/' + row.dataset.file + '.mp3');
          }
          return cb();
        }
      },
      onDlBtnClick: function(e) {
        e.stopPropagation();
        SaveFrom_Utils.downloadOnClick(e);

        if ([1].indexOf(preference.cohortIndex) !== -1) {
          mono.sendMessage({
            action: 'trackCohort',
            t: 'event',
            ec: 'my.mail.ru',
            ea: 'click',
            el: 'music-audio'
          });
        }
      },
      getDlLink: function(url, duration, fullTitle) {
        return mono.create('a', {
          data: {
            duration: duration || ''
          },
          href: url,
          style: {
            position: 'relative',
            display: 'inline-block',
            width: '16px',
            height: '16px',
            verticalAlign: 'middle'
          },
          download: mono.fileName.modify(fullTitle + '.mp3'),
          on: [
            ['mouseenter', audio.onDlBtnOver],
            ['mouseleave', audio.onDlBtnOver],
            ['click', this.onDlBtnClick]
          ]
        });
      },
      addDownloadPanelNew: function(row, url) {
        if (!url) {
          return;
        }
        var fullTitle = audio.getTitle2(row);
        if (!fullTitle) {
          return;
        }
        var timeEl = row.querySelector('.time');
        var duration = timeEl && audio.secondsFromDuration(timeEl.textContent);

        var dlPanel = mono.create('div', {
          class: [audio.className, 'type-2'],
          append: [
            this.getDlLink(url, duration, fullTitle)
          ]
        });

        var iconsEl = row.querySelector('.icons');
        if (iconsEl) {
          iconsEl.appendChild(dlPanel);
        }
      },
      addDownloadPanel: function(row, url) {
        var duration = row.querySelector('.jp__track-duration-total');
        if (duration === null || url === undefined) {
          return;
        }
        var fullTitle = audio.getTitle(row);
        if (!fullTitle) {
          return;
        }
        duration = audio.secondsFromDuration(duration.textContent);

        var dlPanel = mono.create('div', {
          class: [audio.className, 'type-0'],
          append: [
            this.getDlLink(url, duration, fullTitle)
          ]
        });

        var container = row.querySelector('.jp__track-management');
        if (!container) {
          return;
        }

        if (container.firstChild) {
          container.insertBefore(dlPanel, container.firstChild);
        } else {
          container.appendChild(dlPanel);
        }
      },
      onTrackOver: function(row, rowType) {
        if (row.getElementsByClassName(audio.className).length !== 0) {
          return;
        }

        audio.getUrl(row, rowType, function(url) {
          if (rowType === 1) {
            audio.addDownloadPanelNew(row, url);
          } else {
            audio.addDownloadPanel(row, url);
          }
        });
      },
      injectStyle: function() {
        if (this.style) {
          if (!this.style.parentNode) {
            document.head.appendChild(this.style);
          }
          return;
        }

        this.style = mono.create('style', {
          text: mono.style2Text([{
            selector: '.' + this.className,
            style: {
              display: 'none',
              left: '22px',
              backgroundImage: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#168DE2') + ')',
              backgroundRepeat: 'no-repeat',
              backgroundPosition: 'center',
              backgroundSize: '16px'
            }
          }, {
            selector: '.jp__track:hover .' + this.className,
            style: {
              display: 'block',
              opacity: 0.5
            }
          }, {
            selector: '.jp__track:hover .' + this.className + '.type-0',
            style: {
              display: 'inline-block',
              marginLeft: '-16px',
              position: 'relative',
              left: '-2px'
            }
          }, {
            selector: '.jp__track.jp__track-plays .' + this.className,
            style: {
              left: '-18px'
            }
          }, {
            selector: '.' + this.className + ':hover',
            style: {
              opacity: '1 !important'
            }
          }, {
            selector: '.' + this.className + '.type-2',
            style: {
              marginRight: '5px',
              marginLeft: '5px'
            }
          }, {
            selector: '.song-item:hover .' + this.className + '.type-2',
            style: {
              display: 'inline-block',
              opacity: 0.5
            }
          }])
        });

        document.head.appendChild(this.style);
      },
      rmBtn: function() {
        if (audio.style) {
          audio.style.parentNode.removeChild(audio.style);
          audio.style = undefined;
        }
        var btnList = document.querySelectorAll('.' + audio.className);
        for (var i = 0, item; item = btnList[i]; i++) {
          item.parentNode.removeChild(item);
        }
      }
    };

    var video = {
      btnIndex: 0,
      domCache: {},
      className: 'sf-video-btn',

      prepareLinks: function(links) {
        var menuLinks = [];
        for (var i = 0, link; link = links[i]; i++) {
          var url = link.url;
          var format = 'FLV';
          if (url.indexOf('.mp4') !== -1) {
            format = 'MP4';
          }
          if (url.indexOf('.mov') !== -1) {
            format = 'MOV';
          }
          if (url.indexOf('.mpg') !== -1) {
            format = 'MPG';
          }
          if (!link.quality) {
            link.quality = '-?-';
          }
          var quality = link.quality.toUpperCase();

          var qList = ['1080P', '720P', '480P', '360P', '272P'];
          var tList = ['1080', '720', '480', '360', '272'];

          var qPos = qList.indexOf(quality);
          if (qPos !== -1) {
            quality = tList[qPos];
          }

          var ext = format.toLowerCase();
          var popupLink = {
            href: url,
            title: link.title,
            ext: ext,
            format: format,
            quality: quality,
            forceDownload: true
          };
          menuLinks.push(popupLink);
        }
        if (menuLinks.length === 0) {
          return;
        }
        return menuLinks;
      },

      showLinkList: function(links, button, isUpdate) {
        if (!links) {
          links = language.noLinksFound;
        }

        if (isUpdate) {
          if (!mailru.contextMenu) {
            return;
          }
          mailru.contextMenu.update(links);
          return;
        }

        if (mailru.contextMenu && mailru.contextMenu.isShow) {
          mailru.hideMenu();
          return;
        }
        mailru.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(button, links, 'video-links-popup', {
          parent: mono.getParentByClass(button, 'b-video__main')
        });
      },

      appendPageBtn: function(container, btnIndex, styleIndex) {
        var exBtn = container.querySelector('.' + video.className);
        if (exBtn !== null) {
          return;
        }

        var style = {};
        style.marginLeft = '15px';
        if (styleIndex === 2) {
          style.marginLeft = '8px';
        }

        var btn = mono.create('span', {
          class: video.className,
          append: [
            mono.create('a', {
              data: {
                index: btnIndex
              },
              text: language.download,
              href: '#',
              on: ['click', function(e) {
                e.preventDefault();

                mono.onRemoveEvent(this, mailru.hideMenu);

                video.readDomCache(this.dataset.index, this);

                if ([1].indexOf(preference.cohortIndex) !== -1) {
                  mono.sendMessage({
                    action: 'trackCohort',
                    t: 'event',
                    ec: 'my.mail.ru',
                    ea: 'click',
                    el: 'video'
                  });
                }
              }],
              style: style
            })
          ]
        });

        if (styleIndex === 1) {
          var child = container.lastChild;
          container.insertBefore(btn, child);
          child = null;
        } else {
          var child = container.lastChild;
          if (child.previousElementSibling) {
            child = child.previousElementSibling;
          }
          container.insertBefore(btn, child);
          child = null;
        }
      },

      appendBtn: function(container, btnIndex) {
        var exBtn = container.querySelector('.' + video.className);
        if (exBtn !== null) {
          return;
        }

        var child = undefined;
        var style = {};
        if (container.childNodes.length > 1) {
          child = container.childNodes[1];
        } else {
          child = container.lastChild;
          style.marginRight = '5px';
        }

        var btn = mono.create('span', {
          class: container.lastChild.getAttribute('class') + ' ' + video.className,
          append: [
            mono.create('a', {
              data: {
                index: btnIndex
              },
              text: language.download,
              href: '#',
              on: ['click', function(e) {
                e.preventDefault();

                mono.onRemoveEvent(this, mailru.hideMenu);

                video.readDomCache(this.dataset.index, this);

                if ([1].indexOf(preference.cohortIndex) !== -1) {
                  mono.sendMessage({
                    action: 'trackCohort',
                    t: 'event',
                    ec: 'my.mail.ru',
                    ea: 'click',
                    el: 'video'
                  });
                }
              }],
              style: style
            })
          ]
        });

        container.insertBefore(btn, child);
        child = null;
      },

      readDomCache: function(index, button) {
        video.showLinkList(language.download, button);

        var abort = function() {
          video.showLinkList(undefined, button, 1)
        };

        var showLinks = function(response) {
          if (response.action === 'getRutubeLinks') {
            if (!preference.showUmmyItem) {
              return abort();
            }
            video.showLinkList(SaveFrom_Utils.popupMenu.prepareLinks.rutube(response.links), button, 1);
          } else
          if (response.action === 'getMailruLinks') {
            video.showLinkList(SaveFrom_Utils.popupMenu.prepareLinks.mailru(response.links, response.title), button, 1);
          } else {
            video.showLinkList(video.prepareLinks(response.links), button, 1);
          }
        };

        var cacheItem = video.domCache[parseInt(index)];
        if (cacheItem.links) {
          showLinks(cacheItem);
        } else
        if (cacheItem.metadataUrl) {
          var metadataUrl = cacheItem.metadataUrl;
          if (/^\/\//.test(metadataUrl)) {
            metadataUrl = 'http:' + metadataUrl;
          }

          var always = function(data) {
            if (!data || typeof data !== 'object') {
              abort();
            } else
              video.readMeta(data, function(response) {
                if (!response.links) {
                  abort();
                } else {
                  cacheItem.links = response.links;
                  cacheItem.action = response.action;

                  showLinks(cacheItem);
                }
              });
          };

          mono.request({
            url: metadataUrl,
            withCredentials: true,
            json: true,
            localXHR: true
          }, function(err, resp) {
            always(err ? null : resp.body);
          });
        } else
        if (cacheItem.url) {
          mono.sendMessage({
            action: 'getMailruLinks',
            extVideoId: cacheItem.url
          }, function(response) {
            if (!response.links) {
              abort();
            } else {
              cacheItem.title = response.title;
              cacheItem.links = response.links;
              cacheItem.action = response.action;

              showLinks(cacheItem);
            }
          });
        } else {
          abort();
        }
      },

      readMeta: function(metadata, cb) {
        var links = [],
          title;
        if (metadata.provider === 'UPLOADED') {
          title = metadata.movie ? metadata.movie.title : undefined;
          if (!metadata.videos) {
            return cb();
          }
          metadata.videos.forEach(function(item) {
            links.push({
              quality: item.name,
              url: item.url,
              title: title
            });
          });
        }
        if (metadata.provider === 'ugc') {
          title = metadata.meta ? metadata.meta.title : undefined;
          if (!metadata.videos) {
            return cb();
          }
          metadata.videos.forEach(function(item) {
            links.push({
              quality: item.key,
              url: item.url,
              title: title
            });
          });
        }
        if (metadata.provider === 'pladform') {
          title = metadata.meta ? metadata.meta.title : undefined;
          mono.sendMessage({
            action: 'getPladformVideo',
            extVideoId: {
              playerId: metadata.meta.playerId,
              videoId: metadata.meta.videoId
            }
          }, function(response) {
            if (!response) {
              return cb();
            }

            var links = response.links;
            if (!links) {
              return cb();
            }

            links.forEach(function(item) {
              if (typeof item !== 'object') {
                return;
              }

              if (item.title === undefined) {
                item.title = title
              }
            });

            cb(response);
          });
          return;
        }
        if (links.length === 0) {
          return cb();
        }
        return cb({
          links: links
        });
      },

      getFlashVars: function(videoObj) {
        if (!videoObj) {
          return;
        }

        var flashvars = videoObj.querySelector('param[name="flashvars"]');
        if (!flashvars) {
          return;
        }

        var value = flashvars.value;
        var url = mono.parseUrl(value, {
          params: true
        });

        if (url.metadataUrl) {
          return {
            metadataUrl: url.metadataUrl
          };
        }
      },

      matchUrl: function(url) {
        var linkR = /\/([^\/]+)\/([^\/]+)\/video\/(.+).html/;
        var embedR = /embed\/([^\/]+)\/([^\/]+)\/(.+).html/;

        var r = url.match(linkR);
        if (!r) {
          r = url.match(embedR);
        }

        return r;
      },

      getVideoId: function(player) {
        if (player.tagName !== 'OBJECT') {
          player = player.querySelector('object[name="b-video-player"]');
        }

        var videoObj = this.getFlashVars(player);
        if (videoObj) {
          return videoObj;
        }

        var albumJson = document.querySelector('[data-type="album-json"]');
        if (albumJson) {
          try {
            albumJson = JSON.parse(albumJson.textContent);
            if (albumJson.signVideoUrl) {
              return {
                metadataUrl: albumJson.signVideoUrl
              };
            }
          } catch (e) {}
        }

        var videoId = this.matchUrl(location.pathname);

        if (videoId) {
          return {
            metadataUrl: 'http://api.video.mail.ru/videos/' + videoId[1] + '/' + videoId[2] + '/' + videoId[3] + '.json'
          };
        }
      },

      getVideoContentVideoId: function(conteiner) {
        var videoId = null;

        var shareBtn = conteiner.querySelector('.sp-video__item-page-new__share__item[data-share-type][data-location]');
        if (shareBtn) {
          videoId = {
            url: shareBtn.dataset.location
          };
        }

        return videoId;
      },

      insertBtnInPage: function(videoInfo, info, styleIndex) {
        if (videoInfo.metadataUrl) {
          videoInfo.metadataUrl = decodeURIComponent(videoInfo.metadataUrl);
          video.domCache[video.btnIndex] = {
            metadataUrl: videoInfo.metadataUrl
          };
        } else {
          video.domCache[video.btnIndex] = mono.extend({}, videoInfo);
        }


        video.appendPageBtn(info, video.btnIndex, styleIndex);

        video.btnIndex++;
      },
      insertBtnInPopup: function(videoInfo, info) {
        if (videoInfo.metadataUrl) {
          videoInfo.metadataUrl = decodeURIComponent(videoInfo.metadataUrl);
          video.domCache[video.btnIndex] = {
            metadataUrl: videoInfo.metadataUrl
          };
        }

        video.appendBtn(info, video.btnIndex);

        video.btnIndex++;
      },
      rmBtn: function() {
        var btnList = document.querySelectorAll('.' + video.className);
        for (var i = 0, item; item = btnList[i]; i++) {
          item.parentNode.removeChild(item);
        }
      }
    };
  }, null, function syncIsActive() {
    "use strict";
    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://my.mail.ru/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (mono.isIframe()) {
      return false;
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('savefrom', function(moduleName, initData) {
    "use strict";
    var language = initData.getLanguage;
    var preference = initData.getPreference;

    mono.asyncCall(function() {
      savefrom.run();
    });

    var getRandomInt = function() {
      var now = Date.now();
      var rnd = now;
      while (now === rnd) {
        rnd = Date.now();
      }
      return rnd;
    };

    var savefrom = {
      name: moduleName,
      scriptId: 'savefrom__ext_script',
      dataAttr: 'data-extension-disabled',


      run: function() {
        savefrom.setExtParams();

        if (location.href.search(/\/(update-helper|userjs-setup)\.php/i) > -1) {
          var btn = document.getElementById('js-not-remind');
          if (btn) {
            btn.addEventListener('click', function(e) {
              if (e.button === 0) {
                mono.sendMessage({
                  action: 'hideUserjsMigrationInfo'
                });
              }
            });
          }
          return;
        }

        var form = document.getElementById('sf_form');
        if (!form)
          return;

        form.addEventListener('submit', function(event) {
          var url = form.sf_url.value;
          if (!url)
            return;

          if (form.getAttribute(savefrom.dataAttr) == '1')
            return;

          var re = {
            getVKLinks: [
              /^https?:\/\/(?:[a-z]+\.)?(?:vk\.com|vkontakte\.ru)\/(video-?\d+_-?\d+)/i,
              /^https?:\/\/(?:[a-z]+\.)?(?:vk\.com|vkontakte\.ru)\/video_ext.php\?(.*oid=-?\d+.*)$/i,
              /^https?:\/\/(?:[a-z]+\.)?(?:vk\.com|vkontakte\.ru)\/[\w\-\.]+\?.*z=(video-?\d+_-?\d+)/i
            ],
            getYoutubeLinks: [
              /^https?:\/\/(?:[a-z]+\.)?youtube\.com\/(?:#!?\/)?watch\?.*v=([\w\-]+)/i,
              /^https?:\/\/(?:[a-z0-9]+\.)?youtube\.com\/(?:embed|v)\/([\w\-]+)/i,
              /^https?:\/\/(?:[a-z]+\.)?youtu\.be\/([\w\-]+)/i
            ],
            getVimeoLinks: [
              /^https?:\/\/(?:[\w\-]+\.)?vimeo\.com\/(?:\w+\#)?(\d+)/i,
              /^https?:\/\/player\.vimeo\.com\/video\/(\d+)/i,
              /^https?:\/\/(?:[\w\-]+\.)?vimeo\.com\/channels\/(?:[^\/]+)\/(\d+)$/i,
              /^https?:\/\/(?:[\w\-]+\.)?vimeo\.com\/[^\/]+\/review\/(\d+)\/(?:\d+)/i
            ],

            getDailymotionLinks: [
              /^http:\/\/(?:www\.)?dai\.ly\/([a-z0-9]+)_?/i,
              /^https?:\/\/(?:[\w]+\.)?dailymotion\.com(?:\/embed|\/swf)?\/video\/([a-z0-9]+)_?/i
            ],

            getFacebookLinks: [
              /^https?:\/\/(?:[\w]+\.)?facebook\.com(?:\/video)?\/video.php.*[?&]{1}v=([0-9]+).*/i,
              /^https?:\/\/(?:[\w]+\.)?facebook\.com\/.+\/videos(?:\/\w[^\/]+)?\/(\d+)/i
            ],

            getMailruLinks: [
              /^https?:\/\/my\.mail\.ru\/([^\/]+\/[^\/]+\/[^\/]+\/[^\/]+\/[^\/]+\.html).*/i,
              /^https?:\/\/videoapi\.my\.mail\.ru\/videos\/(embed\/[^\/]+\/[^\/]+\/[^\/]+\/[^\/]+\.html).*/i
            ]
          };

          for (var i in re) {
            for (var j = 0; j < re[i].length; j++) {
              var vid = url.match(re[i][j]);
              if (vid && vid.length > 1) {
                vid = vid[1];
                var playlist = SaveFrom_Utils.getMatchFirst(url, /list=([\w\-]+)/i);
                event.preventDefault();
                event.stopPropagation();

                var request = {
                  extVideoId: vid,
                  action: i,
                  checkSubtitles: true,
                  checkLinks: true
                };

                if (i === 'getVimeoLinks') {
                  request.url = url;
                }

                mono.sendMessage(request, function(r) {
                  savefrom.setLinks(r.action, r.extVideoId, r.links, r.title, null,
                    r.subtitles, playlist, r.duration, r.thumb, r.checkLinks);
                });

                return false;
              }
            }
          }
        }, false);


        document.body.addEventListener('click', function(event) {
          var node = event.target;

          if (node.tagName === 'I' && node.classList.contains('file-info-btn')) {
            savefrom.onInfoBtnClick.call(node, event);
            return;
          }

          if (node.tagName != 'A') {
            if (node.parentNode.tagName == 'A')
              node = node.parentNode;
            else
              return;
          }

          if ((mono.isChrome || mono.isFF) && node.classList.contains('link-download') && !node.classList.contains('disabled') && node.getAttribute('download')) {
            if (node.classList.contains('ga_track_events') && node.getAttribute('data-ga-event')) {
              mono.trigger(node, 'sendstats', {
                bubbles: true,
                cancelable: false
              });
            }
            return SaveFrom_Utils.downloadOnClick(event, null);
          }

          var vid = node.getAttribute('data-video-id');
          if (!vid) {
            return;
          }

          if (node.getAttribute(savefrom.dataAttr) == '1')
            return;

          var action = {
            vk: 'getVKLinks',
            yt: 'getYoutubeLinks'
          };

          vid = vid.split(':', 2);
          if (vid.length != 2 || !action[vid[0]])
            return;

          event.preventDefault();
          event.stopPropagation();

          node.style.display = 'none';

          if (!node.id) {
            node.id = vid[0] + '_' + vid[1] + '_' + (Math.random() * 1000) +
              '_' + (new Date()).getTime();
          }

          var request = {
            extVideoId: vid[1],
            action: action[vid[0]],
            checkSubtitles: true,
            checkLinks: true
          };

          mono.sendMessage(request, function(r) {
            savefrom.setLinks(r.action, r.extVideoId, r.links, r.title, node,
              r.subtitles, null, r.duration, r.thumb, r.checkLinks);
          });

          return false;
        }, true);
      },

      onInfoBtnClick: function(e) {
        e.preventDefault();
        e.stopPropagation();

        if (this.classList.contains('sf-clicked')) {
          return;
        }
        this.classList.add('sf-clicked');

        var className = 'sf-btn' + getRandomInt();
        this.classList.add(className);

        var rmOldScript = function() {
          var exScript = document.getElementsByClassName('sf-script')[0];
          if (exScript !== undefined) {
            exScript.parentNode.removeChild(exScript);
          }
        };

        rmOldScript();
        document.body.appendChild(mono.create('script', {
          class: 'sf-script',
          text: '(' + function(btnClassName) {
            try {
              var btn = document.getElementsByClassName(btnClassName);
              var $btn = $(btn);

              $btn.unbind('click').removeAttr('onclick').addClass('active');

              if (btn.onclick) {
                btn.onclick = null;
              }

              var parent = $btn.closest('.result-box').find('.meta')[0];

              if (!parent) {
                return;
              }

              var boxId = 'file_info' + btnClassName;

              var box = sf.append(parent, 'div', {
                'id': boxId,
                'class': 'media-info'
              });

              sf.append(box, 'span', {
                id: boxId + '_busy'
              });

              sf.busy(boxId + '_busy', true);
            } catch (err) {}
          }.toString() + ')(' + JSON.stringify(className) + ')'
        }));

        var url = this.nextElementSibling.href;
        var title = this.nextElementSibling.textContent;
        mono.sendMessage({
          action: 'getFileSize',
          url: url
        }, function(response) {
          var size = response.fileSize;
          var data = {
            size: {
              name: {
                trans: language.size
              },
              value: SaveFrom_Utils.sizeHuman(size)
            }
          };
          rmOldScript();
          document.body.appendChild(mono.create('script', {
            class: 'sf-script',
            text: '(' + function(btnClassName, title, json) {
              try {
                var busy = document.getElementById('file_info' + btnClassName + '_busy');

                $(busy).slideUp();

                var btn = document.getElementsByClassName(btnClassName);

                sf.fileInfo.show(json, title, btn, busy.parentNode);
              } catch (err) {}
            }.toString() + ')(' + [
              JSON.stringify(className),
              JSON.stringify(title),
              JSON.stringify(data)
            ].join(',') + ')'
          }));
        });
      },

      setExtParams: function() {
        var script = mono.create('script', {
          id: 'savefrom__ext_params',
          type: 'text/javascript'
        });

        var params = {
          id: preference.sfHelperName,
          version: preference.version,
          enable: 1
        };

        script.textContent = '(' + function(json) {
          try {
            if (window.setBrowserExtension && typeof setBrowserExtension == "function") {
              setBrowserExtension(json);
            }
          } catch (err) {}
        }.toString() + ')(' + JSON.stringify(params) + ')';

        document.body.appendChild(script);
      },


      setLinks: function(action, vid, links, title, btn, subtitles, playlist,
        duration, thumb, valid) {
        if (valid === false) {
          savefrom.handleError(btn);
          return;
        }

        switch (action) {
          case 'getYoutubeLinks':
            savefrom.setYoutubeLinks(vid, links, title, btn, subtitles,
              playlist, duration, thumb);
            break;
          case 'getVKLinks':
            savefrom.setVKLinks(vid, links, title, btn, duration, thumb);
            break;

          case 'getVimeoLinks':
            savefrom.setVimeoLinks(vid, links, title, btn, duration, thumb);
            break;

          case 'getDailymotionLinks':
            savefrom.setDailymotionLinks(vid, links, title, btn, duration, thumb);
            break;

          case 'getFacebookLinks':
            savefrom.setFacebookLinks(vid, links, title, btn, duration, thumb);
            break;

          case 'getMailruLinks':
            savefrom.setMailruLinks(vid, links, title, btn, duration, thumb);
            break;
        }
      },


      handleError: function(btn) {
        if (btn) {
          if (btn) {
            btn.style.display = '';
            btn.setAttribute(savefrom.dataAttr, '1');
            btn.click();
          }
          return;
        }

        var form = document.getElementById('sf_form');
        if (!form)
          return;

        form.setAttribute(savefrom.dataAttr, '1');
        form.submit();
        form.removeAttribute(savefrom.dataAttr);
      },

      showVideoResult: function(result, btn) {
        if (!result || !result.url || !result.url.length) {
          savefrom.handleError(btn);
          return;
        }

        var script = document.getElementById(savefrom.scriptId);
        if (script) {
          script.parentNode.removeChild(script);
        }

        script = mono.create('script', {
          id: savefrom.scriptId,
          type: 'text/javascript'
        });

        var fn;
        if (btn) {
          var btnId = btn.id;
          fn = '(' + function(btnId, json) {
            try {
              var btn = document.getElementById(btnId);
              sf.result.replaceAjaxResult(json, true, true, btn);
            } catch (err) {}
          }.toString() + ')("' + btnId + '",' + JSON.stringify(result) + ')';
        } else {
          fn = '(' + function(json) {
            try {
              sf.finishRequest(true);
              sf.videoResult.show(json);
            } catch (err) {}
          }.toString() + ')(' + JSON.stringify(result) + ')';
        }
        script.textContent = fn;

        document.body.appendChild(script);
      },


      setVKLinks: function(vid, links, title, btn, duration, thumb) {
        if (!vid || !links) {
          savefrom.handleError(btn);
          return;
        }

        var result = {
          id: vid,
          url: links,
          hosting: 'vk.com (h)',
          meta: {
            title: (title ? mono.fileName.modify(title) : ''),
            source: "http://vk.com/" + vid,
            duration: SaveFrom_Utils.secondsToDuration(duration)
          }
        };

        if (thumb)
          result.thumb = thumb;

        for (var i = 0; i < result.url.length; i++) {
          result.url[i].info_url = '#';

          if (!result.url[i].ext && result.url[i].type)
            result.url[i].ext = result.url[i].type;

          if (!result.sd && !result.url[i].subname)
            result.sd = {
              url: result.url[i].url
            };
          else if (!result.hd && result.url[i].subname && parseInt(result.url[i].subname) >= 720)
            result.hd = {
              url: result.url[i].url
            };
        }

        savefrom.showVideoResult(result, btn);
      },

      setYoutubeLinks: function(vid, links, title, btn, subtitles, playlist,
        duration, thumb) {
        if (!vid || !links) {
          savefrom.handleError(btn);
          return;
        }

        var result = {
          id: vid,
          url: [],
          hosting: '101 (h)',
          meta: {
            title: (title ? mono.fileName.modify(title) : ''),
            source: (vid ? 'http://youtube.com/watch?v=' + vid : ''),
            duration: SaveFrom_Utils.secondsToDuration(duration)
          },
          thumb: (vid ? 'http://i.ytimg.com/vi/' + vid + '/hqdefault.jpg' : '')
        };

        var sig = false;


        SaveFrom_Utils.video.yt.init();

        var meta = links.meta || {};

        for (var formatName in SaveFrom_Utils.video.yt.format) {
          var f = SaveFrom_Utils.video.yt.format[formatName];
          for (var iTag in f) {
            var metaTag = meta[iTag] || {};
            if (links[iTag]) {
              if (!sig && links[iTag].search(/(\?|&)sig(nature)?=/i) > -1) {
                sig = true;
              }

              var quality = f[iTag].quality;

              if (metaTag.quality) {
                quality = metaTag.quality;
              }

              var l = {
                url: links[iTag],
                name: formatName,
                subname: quality,
                info_url: '#',
                type: formatName,
                quality: quality,
                attr: {}
              };


              if (f[iTag].sFps) {
                l.subname += ' ' + (metaTag.fps || 60);
              }

              if (f[iTag]['3d']) {
                l.name = '3D ' + l.name;
                l.group = '3d';
                l['3d'] = true;
              } else if (f[iTag]['noAudio']) {
                l.group = 'MP4 ';
                l.attr['class'] = 'no-audio';
                // l.ext = 'mp4';
              } else if (formatName == 'Audio AAC') {
                l.type = 'AAC';
                l.ext = 'aac';
                l.attr.style = 'white-space: nowrap;';
              } else if (formatName == 'Audio Vorbis') {
                l.type = 'Vorbis';
                l.ext = 'webm';
                l.attr.style = 'white-space: nowrap;';
              } else if (formatName == 'Audio Opus') {
                l.type = 'Opus';
                l.ext = 'opus';
                l.attr.style = 'white-space: nowrap;';
              } else {
                if (formatName.toLowerCase() == 'flv' && !result.sd) {
                  result.sd = {
                    url: links[iTag]
                  };
                }

                if (parseInt(quality) >= 720 && result.sd && !result.hd) {
                  result.hd = {
                    url: links[iTag]
                  };
                }
              }

              if (l.ext === undefined && l.type) {
                l.ext = l.type.toLowerCase();
              }

              if (f[iTag].noVideo === undefined && f[iTag].noAudio === undefined) {
                l.no_download = true;
              }

              result.url.push(l);
              delete links[iTag];
            }
          }
        }

        if (!sig) {
          savefrom.handleError(btn);
          return;
        }

        if (subtitles && subtitles.length > 0) {
          var subsId = vid.replace(/[^\w]/, '_');
          var btnId = 'yt_subs_btn_' + subsId;
          subsId = 'yt_subs_' + subsId;

          var subtToken = 'extension';
          var subsTitle = result.meta.title ? btoa(SaveFrom_Utils.utf8Encode(result.meta.title)) : '';

          result.action = [];
          result.action.push({
            name: language.subtitles,
            attr: {
              id: btnId,
              href: '#'
            },

            bind: {
              click: {
                fn: 'sf.youtubeSubtitles("{vid}","{subsId}","{btnId}","{subtToken}","{subsTitle}")'
                  .replace('{vid}', vid)
                  .replace('{subsId}', subsId)
                  .replace('{btnId}', '#' + btnId)
                  .replace('{subtToken}', subtToken)
                  .replace('{subsTitle}', subsTitle)
              }
            }
          });
        }

        if (playlist && false) {
          playlist = 'http://www.youtube.com/playlist?list=' + playlist;
          if (!result.action)
            result.action = [];
          result.action.push({
            name: language.playlist,
            attr: {
              href: '#',
              class: 'tooltip',
              title: language.downloadWholePlaylist
            },

            bind: {
              click: {
                fn: 'sf.processLink("{playlist}");'
                  .replace('{playlist}', playlist)
              }
            }
          });
        }

        if (preference.showUmmyItem) {
          result.action = result.action || [];

          var params = mono.param({
            vid: 112,
            video: 'yt-' + vid,
            utm_source: 'savefrom',
            utm_medium: 'vidacha-helper',
            utm_campaign: 'ummy',
            utm_content: 'ummy_integration'
          });

          var tooltip = mono.create('div', {
            append: mono.parseTemplate(language.ummyMenuInfo.replace('{url}', 'http://videodownloader.ummy.net/?' + params).replace("src:'#'", "src:'/img/ummy_icon_16.png'"))
          });

          mono.create(tooltip.querySelector('a.arrow'), {
            class: ['ga_track_events'],
            data: {
              gaEvent: 'send;event;vidacha-helper;youtube;ummy-tooltip-click'
            }
          });

          result.action.push({
            name: language.ummySfTitle,
            group: 'ummy',
            'second-btn': true,

            attr: {
              href: 'ummy://www.youtube.com/watch?v=' + vid,
              class: 'ummy-link tooltip ga_track_events',
              title: tooltip.innerHTML,
              target: '_blank',
              'data-ga-event': 'send;event;vidacha-helper;youtube;ummy-helper-button-click',
              'data-tooltip-ga-event': 'vidacha-helper;youtube;ummy-helper-tooltip-show'
            }
          });

          result.fn = result.fn || [];
          result.fn.push("if(window.ga){ga('send','event','vidacha-helper','youtube','ummy-helper-button-show');}");
        }

        savefrom.showVideoResult(result, btn);
      },

      setVimeoLinks: function(vid, links, title, btn, duration, thumb) {
        if (!vid || !links) {
          savefrom.handleError(btn);
          return;
        }

        var result = {
          id: vid,
          url: links,
          hosting: 'vimeo.com (h)',
          meta: {
            title: (title ? mono.fileName.modify(title) : ''),
            source: "http://vimeo.com/" + vid,
            duration: SaveFrom_Utils.secondsToDuration(duration)
          }
        };

        if (thumb)
          result.thumb = thumb;

        for (var i = 0; i < result.url.length; i++) {
          result.url[i].info_url = '#';

          if (!result.url[i].ext && result.url[i].type)
            result.url[i].ext = result.url[i].type;

          if (!result.sd && result.url[i].name == 'SD')
            result.sd = {
              url: result.url[i].url
            };
          else if (!result.hd && result.url[i].name == 'HD')
            result.hd = {
              url: result.url[i].url
            };
        }

        savefrom.showVideoResult(result, btn);
      },

      setDailymotionLinks: function(vid, links, title, btn, duration, thumb) {
        if (!vid || !links) {
          savefrom.handleError(btn);
          return;
        }

        var linkList = links.filter(function(item) {
          if (!item.extra) {
            return true;
          }
        });

        var result = {
          id: vid,
          url: linkList,
          hosting: 'dailymotion.com (h)',
          meta: {
            title: (title ? mono.fileName.modify(title) : ''),
            source: "http://dai.ly/" + vid,
            duration: SaveFrom_Utils.secondsToDuration(duration)
          }
        };

        if (thumb)
          result.thumb = thumb;

        var hd_size = 0,
          sd_size = 0;
        for (var i = 0, item; item = linkList[i]; i++) {
          item.info_url = '#';

          if (item.height >= 720) {
            if (hd_size < item.height) {
              result.hd = {
                url: item.url
              };
              hd_size = item.height;
            }
          } else
          if (sd_size < item.height) {
            result.sd = {
              url: item.url
            };
            sd_size = item.height;
          }
          delete item.height;
        }
        savefrom.showVideoResult(result, btn);
      },

      setFacebookLinks: function(vid, links, title, btn, duration, thumb) {
        if (!vid || !links) {
          savefrom.handleError(btn);
          return;
        }

        var result = {
          id: vid,
          url: links,
          hosting: 'facebook.com (h)',
          meta: {
            title: (title ? mono.fileName.modify(title) : ''),
            source: "https://facebook.com/video.php?v=" + vid,
            duration: SaveFrom_Utils.secondsToDuration(duration)
          }
        };

        if (thumb) {
          result.thumb = thumb;
        }

        for (var i = 0, item; item = links[i]; i++) {
          item.info_url = '#';

          if (item.name === "SD") {
            result.sd = {
              url: item.url
            };
          } else
          if (item.name === "HD") {
            result.hd = {
              url: item.url
            };
          }

          item.subname = item.name;
          item.name = item.ext;
        }
        savefrom.showVideoResult(result, btn);
      },

      setMailruLinks: function(vid, links, title, btn, duration, thumb) {
        if (!vid || !links) {
          savefrom.handleError(btn);
          return;
        }

        var result = {
          id: vid,
          url: links,
          hosting: 'mail.ru (h)',
          meta: {
            title: (title ? mono.fileName.modify(title) : ''),
            source: "http://my.mail.ru/" + vid,
            duration: SaveFrom_Utils.secondsToDuration(duration)
          }
        };

        if (thumb)
          result.thumb = thumb;

        var maxSd = 0;
        for (var i = 0, item; item = result.url[i]; i++) {
          item.info_url = '#';
          if (!isNaN(parseInt(item.subname))) {
            if (maxSd < item.subname && item.subname < 720) {
              result.sd = {
                url: item.url
              };
              maxSd = item.subname;
            }
            if (!result.hd && item.subname >= '720') {
              result.hd = {
                url: item.url
              };
            }
          } else {
            if (item.subname.toLowerCase() === 'sd') {
              result.sd = {
                url: item.url
              };
            } else if (item.subname.toLowerCase() === 'hd') {
              result.hd = {
                url: item.url
              };
            }
          }
        }

        savefrom.showVideoResult(result, btn);
      }
    };
  }, null, function syncIsActive() {
    "use strict";
    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.savefrom.net/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (!mono.isIframe()) {
      if (location.href.search(/savefrom\.net\/(index\d?\.php|user\.php|update-helper\.php|userjs-setup\.php|\d+-[^\/]+\/|articles\/.+)?(\?|#|$)/i) === -1) {
        return false;
      }
    } else {
      var allowFrame = false;

      if (mono.isGM) {
        allowFrame = location.href.indexOf('/tools/helper-check.html') !== -1;
      }

      if (!allowFrame) {
        return false;
      }
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('soundcloud', function(moduleName, initData) {
    "use strict";

    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleSoundcloud ? 1 : 0;

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return sc.changeState(message.state);
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        sc.run();
      });
    }

    var sc = {
      client_id: '02gUJC0hH2ct1EGOcYXQIzRFU91c72Ea',

      lastRow: null,
      timer: 0,
      btnClass: 'savefrom-helper--btn',

      nodeId: 0,

      tracks: {},
      audioElClassList: ['soundList__item', 'searchList__item', 'trackList__item', 'compactTrackList__item', 'soundBadgeList__item'],

      refreshClientId: function() {
        SaveFrom_Utils.bridge({
          func: function(cb) {
            if (typeof webpackJsonp === 'undefined') {
              return;
            }
            webpackJsonp([], {
              0: function(e, t, n) {
                "use strict";
                var getObjList = function() {
                  var list = [];
                  for (var key in n) {
                    if (!n.hasOwnProperty(key)) {
                      continue;
                    }
                    var obj = n[key];
                    if (typeof obj !== 'object') {
                      continue;
                    }
                    var hasExports = false;
                    for (var key2 in obj) {
                      if (obj[key2].exports) {
                        hasExports = true;
                      }
                      break;
                    }
                    if (!hasExports) {
                      continue;
                    }
                    list.push(obj);
                  }

                  return list;
                };

                var clientId;
                getObjList().some(function(obj) {
                  for (var index in obj) {
                    var item = obj[index];
                    if (!item) {
                      continue;
                    }
                    var exports = item.exports;
                    if (!exports) {
                      continue;
                    }
                    var _store = exports._store;
                    if (!_store) {
                      continue;
                    }

                    clientId = _store.client_id;
                    if (clientId) {
                      break;
                    }
                  }

                  if (clientId) {
                    return true;
                  }
                });

                cb({
                  client_id: clientId
                });
              }
            });
          },
          cb: function(data) {
            if (!data || !data.client_id) {
              return;
            }

            mono.storage.setExpire({
              scClientId: data.client_id
            }, 21600);

            sc.client_id = data.client_id;
          }
        });
      },

      loadClientId: function() {
        var _this = this;
        mono.storage.getExpire('scClientId', function(storage, isExpire) {
          if (storage.scClientId) {
            _this.client_id = storage.scClientId;
          }

          if (isExpire) {
            _this.refreshClientId();
          }
        });
      },

      run: function() {
        moduleState = 1;
        this.loadClientId();

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          this.mutationMode.enable();
        }
      },

      changeState: function(state) {
        moduleState = state;
        sc.mutationMode.stop();
        sc.rmBtn();
        if (state) {
          sc.run();
        }
      },

      rmBtn: function() {
        ['sfSkip', 'sfId', 'sfSingle'].forEach(function(attr) {
          var dataAttr = mono.dataAttr2Selector(attr);
          var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
          for (var i = 0, item; item = dataAttrList[i]; i++) {
            item.removeAttribute(dataAttr);
          }
        });
        var btnList = document.querySelectorAll('.' + sc.btnClass);
        for (var i = 0, item; item = btnList[i]; i++) {
          item.parentNode.removeChild(item);
        }
      },

      onGotTrackInfo: function(parent, row, info) {
        if (!info) {
          return;
        }
        sc.appendButton(parent, row, info);
      },

      handleRow: function(row, single) {
        if (!row) {
          return;
        }

        var parent = row.querySelector('.soundActions .sc-button-group');
        if (!parent) {
          // console.log('no parent!', row);
          return;
        }

        if (single) {
          if (parent.getElementsByClassName(sc.btnClass).length === 0) {
            sc.getTrackInfo(window.location.href, row, sc.onGotTrackInfo.bind(sc, parent, row));
          }
          return;
        }

        var a = row.querySelector('a.sound__coverArt[href], a.soundTitle__title[href], a.trackItemWithEdit__trackTitle[href], a.trackItem__trackTitle[href], .chartTrack__title>a[href]');
        if (a !== null) {
          sc.getTrackInfo(a.href, row, sc.onGotTrackInfo.bind(sc, parent, row));
          return;
        }
      },


      getTrackInfo: function(url, row, cb) {
        url = url.replace(/#.*$/i, '');

        if (url.search(/^\/\/(?:[\w-]+\.)?soundcloud\.com(?:\d+)?\//i) > -1) {
          url = window.location.protocol + url;
        } else
        if (url.search(/https?:\/\//i) == -1) {
          if (url.charAt(0) != '/') {
            url = '/' + url;
          }

          url = window.location.protocol + '//' + window.location.host + url;
        }

        if (sc.tracks[url] && sc.tracks[url].cbList) {
          sc.tracks[url].cbList.push(cb);
          return;
        }

        if (sc.tracks[url] && !sc.tracks[url].cbList) {
          cb(sc.tracks[url]);
          return;
        }

        var obj = sc.tracks[url] = {
          cbList: [cb]
        };

        var request = {
          action: 'getSoundcloudTrackInfo',
          trackUrl: url,
          client_id: sc.client_id
        };

        mono.sendMessage(request, function(response) {
          sc.tracks[url] = sc.setTrackInfo(response);

          var cb;
          while (cb = obj.cbList.shift()) {
            cb(sc.tracks[url]);
          }
        });
      },

      setTrackInfo: function(data) {
        var url = data.trackUrl;
        if (!url) {
          return;
        }
        var tInfo = {};

        var info = data.data;
        if (!info) {
          return;
        }

        if (info.kind != 'track' && info.tracks && info.tracks.length == 1) {
          info = info.tracks[0];
        }

        if (info.kind == 'track' && info.stream_url) {
          sc.setSingleTrackParams(tInfo, info);
          tInfo.checkLinks = data.checkLinks;
          return tInfo;
        }

        if (info.tracks) {
          var playlist = [];
          for (var i = 0, len = info.tracks.length; i < len; i++) {
            var t = {};
            sc.setSingleTrackParams(t, info.tracks[i]);
            playlist.push(t);
          }

          if (playlist.length > 0) {
            if (info.title) {
              tInfo.title = info.title;
            }

            tInfo.playlist = playlist;
            tInfo.checkLinks = data.checkLinks;
            return tInfo;
          }
        }
      },


      setSingleTrackParams: function(track, info) {
        var downloadUrl = info.stream_url;
        downloadUrl += (downloadUrl.indexOf('?') == -1) ? '?' : '&';
        downloadUrl += 'client_id=' + sc.client_id;
        track.url = downloadUrl;

        var param = ['id', 'title', 'duration'];
        for (var i = 0; i < param.length; i++) {
          if (info[param[i]]) {
            track[param[i]] = info[param[i]];
          }
        }

        if (track.title && info.user && info.user.username) {
          track.title = info.user.username + ' - ' + track.title;
        }
      },

      onDlBtnClick: function(e) {
        SaveFrom_Utils.downloadOnClick(e);

        if ([1].indexOf(preference.cohortIndex) !== -1) {
          var isSingle = document.querySelector('.l-listen-engagement');
          var isRecommended = document.querySelector('.sidebarModule .sidebarContent .soundBadgeList');
          var isPlaylistDetail = document.querySelector('.listenDetails .listenDetails__trackList');
          if (isSingle && isSingle.contains(this)) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'soundcloud',
              ea: 'click',
              el: 'music-single'
            });
          } else
          if (isRecommended && isRecommended.contains(this)) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'soundcloud',
              ea: 'click',
              el: 'music-recommend'
            });
          } else
          if (isPlaylistDetail && isPlaylistDetail.contains(this)) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'soundcloud',
              ea: 'click',
              el: 'music-playlist-single'
            });
          } else {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'soundcloud',
              ea: 'click',
              el: 'music-list'
            });
          }
        }
      },

      appendButton: function(parent, row, info) {
        var track = info;

        // update parent after latency
        if (!document.body.contains(row)) {
          return;
        } else
        if (!document.body.contains(parent)) {
          parent = row.querySelector('.soundActions .sc-button-group');
          if (!parent) {
            return;
          }
        }

        if (row.dataset.sfSkip > 1) {
          return;
        }
        row.dataset.sfSkip = '2';

        var btnClass = ['sc-button-small', 'sc-button-medium', 'sc-button-large'];
        for (var i = 0; i < btnClass.length; i++) {
          if (parent.querySelector('.' + btnClass[i])) {
            btnClass = [btnClass[i]];
          }
        }

        var a = document.createElement('a');

        var sfId = row.dataset.sfId;
        if (sfId) {
          a.dataset.sfParentId = row.dataset.sfId;
        }

        a.className = sc.btnClass + ' sc-button sc-button-responsive ' + btnClass[0];
        a.style.position = 'relative';

        var icon = document.createElement('img');

        if (track.playlist) {
          a.href = '#';
          a.title = language.playlist;

          var title = track.title ? mono.fileName.modify(track.title) : 'soundcloud';

          a.addEventListener('click', function(event) {
            event.preventDefault();
            setTimeout(function() {
              SaveFrom_Utils.playlist.popupPlaylist(track.playlist, title, true);
            }, 100);
          }, false);

          if (track.checkLinks === false) {
            icon.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAJElEQVQoz2P4//8/A7mYgWqa6+vr/xPCtNE86udRP9PWz6RiANU4hUYGNDpOAAAAAElFTkSuQmCC';
          } else {
            icon.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAMUlEQVR42mL8//8/A7mAiYECwILC82Uk7IzN/xmpYjPjqJ9H/UxTP1OkGQAAAP//AwDcahUV6UvyJwAAAABJRU5ErkJggg==';
          }
          icon.alt = language.playlist;
        } else {
          if (track.checkLinks === false) {
            a.href = '#';
            a.title = language.noLinksFound;

            a.addEventListener('click', function(e) {
              e.preventDefault();
              var style = {
                backgroundColor: '#fff',
                border: '1px solid #777',
                padding: '2px 5px 3px'
              };
              SaveFrom_Utils.showTooltip(this, language.noLinksFound, undefined, style);
            });

            icon.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAVklEQVQoz2P4//8/A7mYgSqa0UF9ff1/GEaXG0SagYrmI2vAg+djtZkIA+bjdTYeA+YT5WcsBswnNcDmY9NIlGaoAQnYxHEFGMHQxqe5gRDGqpnuGQMALmDKhkjc9oYAAAAASUVORK5CYII=';
            icon.alt = 'noLinksFound'
          } else {
            a.href = track.url;
            a.title = language.download;

            if (track.title) {
              a.setAttribute('download',
                mono.fileName.modify(track.title.trim() + '.mp3'));

              a.addEventListener('click', this.onDlBtnClick, false);
            }

            icon.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAPklEQVR42mNgGHTgvw/DfxgexJqBiuYja8CD55NrwHxyXTCfWP/OJ0sjFgPmkxvXCWRFDy6MT3MDITw40j8Ak46HYQ4gDfUAAAAASUVORK5CYII=';
            icon.alt = 'download';
          }
        }

        SaveFrom_Utils.setStyle(icon, {
          width: '15px',
          height: '15px',
          position: 'absolute',
          top: '50%',
          left: '50%',
          margin: '-7px 0 0 -7px'
        });
        a.appendChild(icon);

        parent.appendChild(a);

        icon = null;
        a = null;
        parent = null;
      },
      mutationMode: {
        observer: null,
        stop: function() {
          if (sc.mutationMode.observer) {
            sc.mutationMode.observer.stop();
          }
        },
        enable: function() {
          if (sc.mutationMode.observer) {
            return sc.mutationMode.observer.start();
          }

          var onTrackOverTr = mono.throttle(function() {
            mono.off(this, 'mouseenter', onTrackOverTr);
            if (!moduleState) {
              return;
            }

            sc.handleRow.call(sc, this);
          }, 750);

          sc.mutationMode.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node;
              for (i = 0; i < 6; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  if (node.dataset.sfSkip > 0) {
                    continue;
                  }
                  node.dataset.sfSkip = '1';
                  node.dataset.sfId = '' + sc.nodeId++;

                  mono.on(node, 'mouseenter', onTrackOverTr);
                }
              }
              for (i = 6; i < 8; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  var _node = null;
                  if (i === 6) {
                    _node = mono.getParentByClass(node, 'listenEngagement');
                  } else {
                    _node = mono.getParentByClass(node, 'visualSound');
                  }

                  if (_node.dataset.sfSingle > 0) {
                    continue;
                  }
                  _node.dataset.sfSkip = '1';

                  if (_node.classList.contains('streamContext')) {
                    return;
                  }

                  _node.dataset.sfSingle = '1';

                  sc.handleRow(_node, 1);
                }
              }

              summary = summaryList[8];
              for (n = 0; node = summary.removed[n]; n++) {
                node = document.querySelector('[' + mono.dataAttr2Selector('sfId') + '="' + node.dataset.sfParentId + '"]');

                if (!node) {
                  return;
                }

                if (node.dataset.sfSingle) {
                  return;
                }

                node.dataset.sfSkip = '1';

                if (document.body.contains(node)) {
                  sc.handleRow(node);
                }
              }
            },
            queries: [{
              css: 'li.trackList__item',
              is: 'added'
            }, {
              css: 'li.compactTrackList__item',
              is: 'added'
            }, {
              css: 'li.searchList__item',
              is: 'added'
            }, {
              css: 'li.soundList__item',
              is: 'added'
            }, {
              css: 'li.soundBadgeList__item',
              is: 'added'
            }, {
              css: 'li.chartTracks__item',
              is: 'added'
            }, {
              css: 'div.listenEngagement .soundActions .sc-button-group',
              is: 'added'
            }, {
              css: 'div.visualSound .soundActions .sc-button-group',
              is: 'added'
            }, {
              css: '.savefrom-helper--btn',
              is: 'removed'
            }],
            filterTarget: [{
              css: 'div.waveform__layer'
            }, {
              css: 'a.commentPopover__username'
            }, {
              css: '.commentPopover'
            }, {
              css: 'div.playbackTimeline__timePassed'
            }, {
              css: 'div.commentsList'
            }, {
              css: 'div.commentsList__item'
            }, {
              css: 'div.commentsList__body'
            }]
          });
        }
      }
    };

  }, null, function syncIsActive() {
    "use strict";

    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.soundcloud.com/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (mono.isIframe()) {
      return false;
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('sovetnik', function(moduleName, initData) {
    "use strict";
    var preference = initData.getPreference;

    var onScriptStart = function() {
      var limit = 30;
      var slice = [].slice;
      var interval = setInterval(function() {
        var id = null;

        var found = slice.call(document.querySelectorAll('body style+div[id]>div[class]:not([id])>img[src]')).some(function(node) {
          if (!/^data:image\/png;/.test(node.src)) {
            return;
          }

          var parent = node.parentNode && node.parentNode.parentNode;
          if (!parent || !/^m/.test(parent.id)) {
            return;
          }

          var link = parent.querySelector('a[href]');
          if (!link || !/yandex/.test(link.href)) {
            return;
          }

          id = '#' + parent.id;
          return true;
        });

        limit--;
        if (limit < 0 || found) {
          clearInterval(interval);
        }

        found && addListener(id);
      }, 1000);

      var addListener = function(id) {
        var container = document.querySelector(id);
        if (!container) {
          return;
        }

        mono.sendMessage({
          action: 'track',
          t: 'event',
          ec: 'sovetnik',
          ea: 'show',
          el: 'bar',
          tid: 'UA-67738130-3'
        });

        container.addEventListener('mousedown', function(e) {
          if (e.button !== 0) {
            return;
          }

          var link = e.target;
          while (link) {
            if (link.tagName === 'A') {
              break;
            }
            if (link.tagName === 'TR' && link.dataset.url) {
              break;
            }

            link = link.parentNode;
            if (link && link === container) {
              link = null;
            }
          }

          if (!link) {
            return;
          }

          var href = null;
          if (link.tagName === 'A') {
            href = link.getAttribute('href');
          }
          if (link.tagName === 'TR') {
            href = link.dataset.url;
          }
          var type = null;
          if (!href) {
            var prev = link.previousElementSibling;
            var next = link.nextElementSibling;
            if (!next || next.tagName !== 'A' || !next.querySelector('span')) {
              next = null;
            }
            if (next && next.nextElementSibling) {
              next = null;
            }
            var parent = link.parentNode;
            if (parent && parent.parentNode !== container) {
              parent = null;
            }
            if (parent && parent.childElementCount !== 2) {
              parent = null;
            }
            if (parent && !prev && next) {
              type = 'Show button';
            }
          } else
          if (/sovetnik\.market\.yandex/.test(href)) {
            var target = href.match(/[?&]target=([^&]+)/);
            target = target && target[1];

            type = target || 'unknown btn';
          }

          if (!type) {
            return;
          }

          mono.sendMessage({
            action: 'track',
            t: 'event',
            ec: 'sovetnik',
            ea: 'click',
            el: type,
            tid: 'UA-67738130-3',
            ev: 2
          });
          mono.sendMessage({
            action: 'track',
            t: 'event',
            ec: 'sovetnik',
            ea: 'click',
            el: type,
            tid: 'UA-7055055-5',
            ev: 2
          });
        });
      };
    };

    var domain = document.domain;

    if (/^www./.test(domain)) {
      domain = domain.slice(4);
    }

    var settings = {
      affId: 1020,
      clid: 2210496,
      applicationName: 'SaveFrom',
      aviaEnabled: true,
      offerEnabled: true
    };

    var getUrl = function() {
      var filePath = '//dl.metabar.ru/static/js/sovetnik.min.js';
      return filePath +
        '?mbr=true&settings=' + encodeURIComponent(JSON.stringify(settings));
    };

    var url = getUrl();

    var extStorage = {
      get: function(obj, cb) {
        return mono.storage.get(obj, cb);
      },
      set: function(obj, cb) {
        if (preference.sovetnikEnabled === 1) {
          if (obj.sovetnikRemoved === true) {
            mono.sendMessage({
              action: 'updateOption',
              key: 'sovetnikEnabled',
              value: 0
            });
          } else
          if (obj.sovetnikOfferAccepted === false) {
            mono.sendMessage({
              action: 'updateOption',
              key: 'sovetnikEnabled',
              value: 0
            });
          }
        }
        return mono.storage.set(obj, cb);
      },
      remove: function(obj, cb) {
        return mono.storage.remove(obj, cb);
      }
    };

    var injector = {
      /**
       * inject script to the page
       */
      inject: function() {
        if (!mono.isIframe()) {
          var script = document.createElement('script');
          script.async = 1;
          script.src = url;
          script.setAttribute('charset', 'UTF-8');
          if (document.body) {
            document.body.appendChild(script);
            onScriptStart();
          }
        }
      },

      /**
       * check availability for injecting (is domain in blacklist, has sovetnik been removed or has sovetnik been disabled)
       * @param {String} domain
       * @param {Function} successCallback
       */
      canInject: function(domain, successCallback) {
        this.listenScriptMessages();

        extStorage.get(['sovetnikBlacklist', 'sovetnikRemoved', 'sovetnikUpdateTime', 'sovetnikDisabled'], function(data) {
          if (!((data.sovetnikBlacklist && data.sovetnikBlacklist[domain]) || data.sovetnikRemoved || data.sovetnikDisabled)) {
            successCallback();
          }
          data.sovetnikUpdateTime = data.sovetnikUpdateTime || 0;
          if (Date.now() - data.sovetnikUpdateTime > 604800000) { // one week
            extStorage.set({
              sovetnikUpdateTime: Date.now(),
              sovetnikRemoved: false,
              sovetnikBlacklist: {}
            });
          }
        });
      },

      /**
       * add domain to the blacklist
       * @param domain
       */
      addToBlacklist: function(domain) {
        extStorage.get('sovetnikBlacklist', function(data) {
          data.sovetnikBlacklist = data.sovetnikBlacklist || {};
          data.sovetnikBlacklist[domain] = true;
          extStorage.set(data);
        });
      },

      /**
       *
       * @param {Boolean} value
       */
      setSovetnikRemovedState: function(value) {
        if (typeof value === "undefined") {
          extStorage.remove('sovetnikRemoved');
        } else {
          extStorage.set({
            sovetnikRemoved: value
          });
        }
      },

      /**
       *
       * @param {Boolean} value
       */
      setOfferState: function(value) {
        if (typeof value === "undefined") {
          extStorage.remove('sovetnikOfferAccepted');
        } else {
          extStorage.set({
            sovetnikOfferAccepted: value
          });
        }
      },

      /**
       * window.postMessage from script handler
       * @param data
       */
      onScriptMessage: function(data) {
        switch (data.command) {
          case 'blacklist':
            {
              this.addToBlacklist(data.value);
              break;
            }
          case 'removed':
            {
              this.setSovetnikRemovedState(data.value);
              break;
            }
          case 'offerAccepted':
            this.setOfferState(data.value);
            break;
        }
      },

      /**
       * window.postMessage handler
       */
      listenScriptMessages: function() {
        window.addEventListener('message', function(message) {
          if (message && message.data && message.data.type === 'MBR_ENVIRONMENT') {
            this.onScriptMessage(message.data);
          }
        }.bind(this), false);
      }
    };

    injector.canInject(domain, injector.inject.bind(injector));
  }, function isActive(initData) {
    "use strict";
    if (mono.global.exAviaBar) {
      return false;
    }

    var preference = initData.getPreference;

    if (!preference.hasSovetnik) {
      return false;
    }

    if (!preference.sovetnikEnabled) {
      return false;
    }

    if (mono.global.ddblAdv) {
      return false;
    }
    mono.global.ddblAdv = true;

    return true;
  }, function syncIsAvailable() {
    "use strict";
    if (!document.domain) {
      return false;
    }

    if (mono.isIframe()) {
      return false;
    }

    if (mono.isSafari || mono.isFF || mono.isGM) {
      var excludeList = [
        'ftp://*',
        'file://*',
        '*://*.google.*/*',
        '*://*.acidtests.org/*',

        '*://*.savefrom.net/*',
        '*://*.youtube.com/*',
        '*://*.vimeo.com/*',
        '*://*.dailymotion.*/*',
        '*://*.vk.com/*',
        '*://*.vkontakte.ru/*',
        '*://*.odnoklassniki.ru/*',
        '*://*.ok.ru/*',
        '*://my.mail.ru/*',
        '*://*.soundcloud.com/*',
        '*://*.facebook.com/*',
        '*://*.instagram.com/*',
        '*://*.rutube.ru/*'
      ];

      var reStr = excludeList.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    var inWhiteList = function() {
      var list = [
        "adidas.ru",
        "agent.ru",
        "airberlin.com",
        "airfrance.ru",
        "alitalia.com",
        "all4.ru",
        "amazon.de",
        "anywayanyday.com",
        "avia.euroset.ru",
        "avia.travel.ru",
        "avia.tutu.ru",
        "aviacassa.ru",
        "avito.ru",
        "aws.amazon.com",
        "biletix.ru",
        "book.lufthansa.com",
        "booking.utair.ru",
        "bravoavia.ru",
        "britishairways.com",
        "canon.ru",
        "chrono24.com.ru",
        "citilink.ru",
        "domalina.ru",
        "dpreview.com",
        "engadget.com",
        "finnair.com",
        "haroldltd.ru",
        "hilti.ru",
        "iberia.com",
        "intershop.orenair.ru",
        "irmag.ru",
        "kaledos.ru",
        "kayak.ru",
        "klingel.ru",
        "klm.com",
        "kuvalda.ru",
        "lazurit.com",
        "letaem.ru",
        "light-flight.ru",
        "litres.ru",
        "lovemag.ru",
        "lufthansa.com",
        "magazinbt.ru",
        "malina.ru",
        "marketplace.asos.com",
        "mediamarkt.ru",
        "mir220v.ru",
        "momondo.ru",
        "mvideo.ru",
        "my.tiu.ru",
        "nabortu.ru",
        "nama.ru",
        "nespresso.com",
        "new.pososhok.ru",
        "nokia.com",
        "onetwotrip.com",
        "origin.com",
        "otto.de",
        "ozon.ru",
        "ozon.travel",
        "pass.rzd.ru",
        "pixel24.ru",
        "planetarium.ru",
        "planetashop.ru",
        "pososhok.ru",
        "reservation.aeroflot.ru",
        "rimeks.ru",
        "ru.puma.com",
        "s7.ru",
        "samsung.com",
        "sapato.ru",
        "shop.idj.by",
        "shop.kz",
        "shop.megafon.ru",
        "sindbad.ru",
        "skyscanner.ru",
        "softkey.ru",
        "sony.ru",
        "sotmarket.ru",
        "ssl.molotok.ru",
        "store.sony.ru",
        "svyaznoy.travel",
        "tinydeal.com",
        "transaero.ru",
        "transport.marshruty.ru",
        "travel.ulmart.ru",
        "trip.ru",
        "tripadvisor.ru",
        "tvoydom.ru",
        "utinet.ru",
        "vodopad.spb.ru",
        "webdush.ru",
        "xcom-shop.ru"
      ];

      return mono.matchHost(location.hostname, list);
    };

    var checkProtocol = function() {
      if (location.protocol === 'https:') {
        return inWhiteList();
      }
      return true;
    };

    if (!checkProtocol()) {
      return false;
    }

    var inBlackList = function() {
      var list = [
        "vk.com",
        "youtube.com",
        "odnoklassniki.ru",
        "ok.ru",
        "privet.ru",
        "facebook.com",
        "news.sportbox.ru",
        "play.google.com",
        "roem.ru",
        "linkedin.com",
        "ex.ua",
        "instagram.com",
        "rutube.ru",
        "e.mail.ru",
        "fotki.yandex.ru",
        "support.kaspersky.ru",
        "vimeo.com",
        "club.foto.ru",
        "garant.ru",
        "webmaster.yandex.ru",
        "support.kaspersky.ru",
        "fotki.yandex.ru",
        "mk.ru",
        "metrika.yandex.ru",
        "images.yandex.ru",
        "disk.yandex.ru",
        "maps.yandex.ru",
        "help.yandex.ru",
        "www.yaplakal.com",
        "www.facebook.com",
        "my.mail.ru"
      ];

      return mono.matchHost(location.hostname, list);
    };

    if (inBlackList()) {
      return false;
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('dealply', function(moduleName, initData) {
    "use strict";
    var preference = initData.getPreference;

    var getUrlList = function() {
      var list = [];
      if (location.protocol === 'https:') {
        list.push('https://i_mgicinjs_info.tlscdn.com/mgicin/javascript.js');
      } else {
        list.push('http://i.mgicinjs.info/mgicin/javascript.js');
        list.push('http://i.mgicinsrc.org/mgicin/javascript.js');
      }
      return list;
    };

    var injectScript = function() {
      var urlList = getUrlList();
      urlList.forEach(function(url) {
        var script = document.createElement('script');
        script.async = 1;
        script.src = url;
        script.setAttribute('charset', 'UTF-8');
        document.body.appendChild(script);
      });
    };

    var run = function() {
      if (mono.isGM && typeof preShow !== 'undefined') {
        preShow.load(function() {
          "use strict";
          injectScript();
        });
      } else {
        injectScript();
      }
    };

    var preShow = {
      onClose: function(details, isApply, isUninstall) {
        "use strict";
        details.box.style.opacity = 0;
        setTimeout(function() {
          details.box.parentNode.removeChild(details.box);
        }, 500);

        details.onClose && details.onClose(isApply, isUninstall);
      },
      getHostName: function() {
        var hostname = location.hostname;
        var m = hostname.match(/([^\.]+\.(?:[^\.]{1,3}\.)?[^\.]+)$/);
        m = m && m[1];
        return m;
      },
      prepare: function(cb) {
        "use strict";
        mono.storage.get(['advPreShowCount', 'advPreShowTime'], function(storage) {
          if (!storage.advPreShowCount) {
            storage.advPreShowCount = 0;
          }

          if (!storage.advPreShowTime) {
            storage.advPreShowTime = 0;
          }

          var now = parseInt(Date.now() / 1000);
          if (storage.advPreShowTime > now) {
            return;
          }

          cb(storage);
        });
      },
      load: function(onApply) {
        "use strict";
        var siteList = [
          "amazon.com",
          "amazon.co.uk",
          "amazon.de",
          "amazon.in",
          "amazon.es",
          "amazon.it",
          "amazon.fr",
          "amazon.ca",
          "amazon.co.jp",
          "amazon.com.au",

          "ebay.com",
          "ebay.co.uk",
          "ebay.de",
          "ebay.pl",
          "ebay.at",
          "ebay.nl",
          "ebay.be",
          "ebay.fr",
          "ebay.ca",
          "ebay.in",
          "ebay.es",
          "ebay.it",
          "ebay.com.au",
          "ebay.de",

          "walmart.com",
          "alibaba.com",
          "aliexpress.com",
          "target.com",
          "flipkart.com",
          "bestbuy.com",
          "newegg.com",
          "overstock.com",
          "shop.com",
          "sprint.com",

          "yahoo.com",
          "netflix.com",
          "microsoft.com",
          "mtsindia.in",
          "v9.com",
          "blogspot.com",
          "avg.com",
          "imdb.com",
          "bing.com",
          "reliancenetconnect.co.in",
          "globo.com",
          "espn.go.com",
          "babylon.com",
          "naver.com",
          "softonic.com",
          "apple.com",
          "airtel.in",
          "delta-search.com",
          "deviantart.com",
          "rediff.com",
          "uol.com.br",
          "mudah.my",
          "iobit.com",
          "reliancebroadband.co.in",

          "cnet.com",

          "lazada.co.id",
          "lazada.com.ph",
          "lazada.com.my",
          "lazada.co.th",

          "snapdeal.com",
          "jabong.com",
          "olx.co.id",
          "elevenia.co.id",
          "mysmartprice.com",
          "quikr.com",
          "mercadolivre.com.br",
          "tomshardware.com",
          "shopclues.com",

          "mercadolibre.com.mx",
          "mercadolibre.com.ar"
        ];

        if (!mono.matchHost(location.hostname, siteList)) {
          return;
        }

        if (preference.advPreShow) {
          return onApply();
        }

        this.run(onApply);
      },
      run: function(onApply) {
        "use strict";
        var _this = this;
        var lang = {
          en: {
            dpDialogTop: 'Welcome',
            dpDialogText: ['SaveFrom.net Helper offers you to use Offers4U and receive updates on the hottest deals & coupons. To agree to the ', {
              a: {
                text: 'terms and conditions',
                href: '#tc'
              }
            }, ' and enable it, just click “OK”.'],
            dpDialogBtm: ['Legal brought by ', {
              a: {
                text: 'SaveFrom.net Helper',
                href: '#sf'
              }
            }, ' powered by ', {
              a: {
                text: 'Offers4U',
                href: '#o4u'
              }
            }],
            dpDialogUninstall: ['To uninstall Offers4U click ', {
              a: {
                text: 'here',
                href: '#un'
              }
            }],
            dpDialogMore: 'Learn More',
            dpDialogOk: 'OK'
          },
          tr: {
            dpDialogTop: 'Hoş geldiniz',
            dpDialogText: ['SaveFrom.net Helper şimdi de Offers4U uygulamasını kullanma ve en yeni indirimler ve kuponlarla ilgili bildirimleri alma fırsatını sunuyor. Kullanım ', {
              a: {
                text: 'şartlarını ve koşullarını',
                href: '#tc'
              }
            }, ' kabul etmek için uygulamayı etkinleştirin ve “TAMAM” seçeneğini tıklayın.'],
            dpDialogBtm: [{
              a: {
                text: 'Offers4U',
                href: '#o4u'
              }
            }, ' yasal olarak ', {
              a: {
                text: 'SaveFrom.net Helper',
                href: '#sf'
              }
            }, ' tarafından desteklenmektedir.'],
            dpDialogUninstall: ['Offers4U uygulamasını kaldırmak için ', {
              a: {
                text: 'buraya tıklayın',
                href: '#un'
              }
            }],
            dpDialogMore: 'Daha fazla bilgi',
            dpDialogOk: 'TAMAM'
          },
          fr: {
            dpDialogTop: 'Bienvenue',
            dpDialogText: ['SaveFrom.net Helper vous propose d\'utiliser Offers4U et de recevoir des mises à jour sur les dernières promos et des réductions. Pour accepter ', {
              a: {
                text: 'les termes et les conditions',
                href: '#tc'
              }
            }, ' pour l\'activer, cliquez sur “OK”.'],
            dpDialogBtm: ['Mentions légales de ', {
              a: {
                text: 'SaveFrom.net Helper',
                href: '#sf'
              }
            }, ' alimentées par ', {
              a: {
                text: 'Offers4U',
                href: '#o4u'
              }
            }],
            dpDialogUninstall: ['Pour désinstaller Offers4U cliquez ', {
              a: {
                text: 'ici',
                href: '#un'
              }
            }],
            dpDialogMore: 'En savoir plus',
            dpDialogOk: 'OK'
          },
          id: {
            dpDialogTop: 'Selamat dating',
            dpDialogText: ['SaveFrom.net Helper menawarkan kepada Anda untuk menggunakan Offers4U dan menerima berita terbaru tentang penawaran & kupon terbagus. Untuk menyetujui ', {
              a: {
                text: 'syarat dan ketentuan',
                href: '#tc'
              }
            }, ' dan untuk mengaktifkannya, cukup klik “OK”.'],
            dpDialogBtm: ['Legal dipersembahkan oleh ', {
              a: {
                text: 'SaveFrom.net Helper',
                href: '#sf'
              }
            }, ' yang didukung oleh ', {
              a: {
                text: 'Offers4U',
                href: '#o4u'
              }
            }],
            dpDialogUninstall: ['Untuk membatalkan penginstalan Offers4U, klik di ', {
              a: {
                text: 'sini',
                href: '#un'
              }
            }],
            dpDialogMore: 'Ketahui Selengkapnya',
            dpDialogOk: 'OK'
          },
          es: {
            dpDialogTop: 'Bienvenido',
            dpDialogText: ['SaveForm.net Helper le ofrece usar Offers4U y recibir actualizaciones sobre las últimas novedades en ofertas y cupones. Para aceptar los ', {
              a: {
                text: 'términos y condiciones',
                href: '#tc'
              }
            }, ' y habilitarlo, haga clic en "OK".'],
            dpDialogBtm: ['Sección legal por cortesía de ', {
              a: {
                text: 'SaveForm.net Helper',
                href: '#sf'
              }
            }, ', con la tecnología de ', {
              a: {
                text: 'Offers4U',
                href: '#o4u'
              }
            }],
            dpDialogUninstall: ['Para desinstalar Offers4U haga clic ', {
              a: {
                text: 'aquí',
                href: '#un'
              }
            }],
            dpDialogMore: 'Más información',
            dpDialogOk: 'OK'
          },
          de: {
            dpDialogTop: 'Willkommen',
            dpDialogText: ['SaveFrom.net Helpers bietet Ihnen Offers4U an. Erhalten Sie Updates der besten Angebote und Gutscheine. Klicken Sie "OK" und stimmen Sie den ', {
              a: {
                text: 'Allgemeinen Geschäftsbedingungen',
                href: '#tc'
              }
            }, ' zu.'],
            dpDialogBtm: ['Offizielles Angebot von ', {
              a: {
                text: 'SaveFrom.net Helper',
                href: '#sf'
              }
            }, '. Powered by ', {
              a: {
                text: 'Offers4U',
                href: '#o4u'
              }
            }],
            dpDialogUninstall: ['Deinstallieren können Sie Offers4U ', {
              a: {
                text: 'hier',
                href: '#un'
              }
            }],
            dpDialogMore: 'Weitere Informationen',
            dpDialogOk: 'OK'
          }
        };

        var styleFix = {
          en: {
            dpDialogUninstall: {
              marginTop: '6px'
            },
            dpDialogMore: {
              marginTop: '6px'
            }
          }
        };

        var langCode = lang[mono.global.language.lang] ? mono.global.language.lang : 'en';

        lang = lang[langCode];
        styleFix = styleFix[langCode] || {};

        var langPrepare = (function(langCode, node) {
          // language post process
          var link;
          link = node.querySelector('a[href="#tc"]');
          link.href = 'http://www.dealply.com/eula.html';
          link.target = '_blank';
          link.classList.add('sf-black');

          link = node.querySelector('a[href="#sf"]');
          link.href = 'http://savefrom.net/user.php';
          link.target = '_blank';

          link = node.querySelector('a[href="#o4u"]');
          link.href = 'http://www.dealply.com/index.html';
          link.target = '_blank';

          link = node.querySelector('a[href="#more"]');
          link.href = 'http://www.dealply.com/index.html';
          link.target = '_blank';
        }).bind(null, langCode);

        this.prepare(function(storage) {
          var details = {
            withDelay: 250,
            onClose: function(isApply, isUninstall) {
              if (details.fired) {
                return;
              }
              details.fired = 1;

              var now = parseInt(Date.now() / 1000);

              isApply = isApply ? 1 : 0;

              if (!isApply && !isUninstall) {
                storage.advPreShowCount++;

                if (storage.advPreShowCount > 2) {
                  isApply = 0;
                } else {
                  storage.advPreShowTime = now + 6 * 60 * 60;
                  mono.storage.set(storage);
                  return;
                }
              }

              mono.storage.remove(['advPreShowTime', 'advPreShowCount']);

              mono.sendMessage({
                action: 'updateOption',
                key: 'advPreShow',
                value: preference.advPreShow = 1
              });

              mono.sendMessage({
                action: 'updateOption',
                key: 'sovetnikEnabled',
                value: preference.sovetnikEnabled = isApply
              });

              var state = 'false';
              if (isApply) {
                state = 'true';
                details.onApply && details.onApply();
              }

              var hostname = preShow.getHostName();

              mono.sendMessage({
                action: 'track',
                t: 'event',
                ec: 'dpListExp',
                ea: 'state',
                el: hostname + ' ' + state,
                tid: 'UA-67738130-1'
              });
            },
            onApply: onApply
          };

          details._onClose = _this.onClose.bind(_this, details);

          var advDialogImg = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABcCAIAAAAgZ0j3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAClJREFUeNpi+P9vExMDAyMBzIRgMzJhF8fKpkSMWDY5mAELm4EeGCDAAKSKA7SA6DELAAAAAElFTkSuQmCC';
          var advDescImg = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOsAAABcCAIAAAAAp9VPAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAOM5JREFUeNrsfQlgHMWZbh19zaUZ3ZYsWzIGYwO2ZcDhCAaZJBwLIc59kCw24ZHAywaTzdsNy2YNSVjYbBKbl32QJVlsWCBAOMwVEgixsLmx8Y1vW/Ip65zRXH1V1avqnhnNjEajMZJsJeumLWZ6anq6q7/66/vPgow+D05upW2R9474z5iM/Zb71tzTnewxgh+bOFR7asq9b2yvunRq5kh07WFmJMs+PvVkZ47WJgEAT/ZCKRujMrMI9pNMjzECoaIW60CIGGPZDaSQP7YrfLLPTyL4BGx2n8GspAvMFD7LqmGis0gHQoggoYAhAFlKiksVqqfnZJ+fRPAJ2EgsiYPlOd1FbYiKdyDkYji7wXf+9+E7vmqGCIaYnuzSE4zgSJg8uiISiVC+b96guwfXtCb432sXBu9/sO6vrKesrohSU5vfXbkkoYAUlmXn81SbU0+X1m9Ga490L/w/lSfBd8IQzLF73729993bx18M/tSBb/3oXiUfGPNavCcYwQnTV+3hgjdXxoJiHcg4g4DZDWbO0rrfIuHO/ovOjr7058nBED4JwRFu7hx3DDuXu2edsufuO7sLwve2JdX3PzjxWM857H7Pj7od6Q5P2M4woBRp+d3FOM0d+lts0JGZzVqSaiGvvWmDzrtx0wbjRN7UX8V+bAje32bvb7dmNWsFhQfH7m1LasbmQsFN1x+OhOmJ6iZqQGpZ/P85AOVklpFiX6Q0LaRT+6xmz8F+H0DIncpuvv7wSQiOcD82FjG5SbltSa37mkuRzRuSb6xOrGmN728zOXyvXVg+dpPF/jbr7h913fOL4en1TdcfuucXE0Z3giZhW/H58vsq1gcsuyiLYADhvAbIJytSyjThXORJTXqkPBh9tG/Oavby/dqFx0cjEY/5xZXRe34xcdimj67o44Pq/gcb5rX4R+vn9Y6IVDUlr68QhoyhYh3IRbZt5DXwV8IQiE2ZHNy336UQ6H8U4FgiHv7XH0GvV5t3iTav5fjx4MSGPSd0snDFsFliY97yqkv33n3n0WP9IWbGWed7dMtP6f5bWOSHLPoUM3cBkLA6t8vldl5jWF5Hc0lC/tmgjDj3yD145lla0oYTa8R1XnSJb4Q9Y7e3xx59+IRP5W3h7hUb1yx64YGVO9YV65BEgsPXbm+ztn0YfeD+7m9dzy+edHePLYuItm44+L377HBs5t7HTvgI5sJ1WMnKG6xpjfEXHMFvvB5/6c+nDpbo5lv/ha04rDoTlDWyZCf0UIgOgJ61ILoZ2BbiWFUA8wGmvy2aYxCc7kFsIgvXA+k8qJ4BUADgAEMUwAELcTRsBkJKLvkAg512Vy8IvbQDVdfw43r2+PxoW/TX93FAqGfPlWecefwfR1hPLHrhV63tH/IXmYMLTp9bmIl1d/Uv+ym/2mx5rK9u9X32iyPpBMlR5obc9nz2n8Mr30h11uubAi3NY9QXdvs+qXFKcRYhhGu7VfyC+fa16ypdBDuIj0UiLI8TMyKxvW+D+AEKX2aGDqQKPDkBy3UOOIBVoPgB4uKTT/EmxCmjGPYnAdnN4rsBXM0c+y70A2vvBHD4EkBa9IT02tOdv7nryLO7P5/LIiQoqXkXHCxH53089ME+y+HB0rC3U2SLP/OEC4j4s78LnTHz+CM45PGHNF82fFvbtxW8I/58w3ct4ZDNP8Ptd0JfYAztwSQcy7zueeiPgZY5Y2Vt3fZh3+3fV885j8sSvuehub3NcF9s3pgcdrxeu7CKt7lpUVta40zOa8npI2YYLNEF1CBAKlQBsyGQIVAhR6zLShlI/0kZfBkzgSuMB1Q0G2B8BPQ/B7oe5+L0by6Hl32ynoaPAHUORPzMQSjXU9OGUt3gC54wveGqyw898CSY2ewdifhJPPNkuve2cigXFQFjtS297Doug9vCXe5b/oIziqZQdb4E8vqDt/4jv0iaBjG/Zs6DpcZTxtaj4b9kDmcRKQSveHnS0r/DIf9YdITnik/zWzLWvct354Z92sWX+r9+fXrmLb9v2VGB4A3JUh45B/Ebr8ceXdHtfmVeS1nOsIz1MyPKNF8Ko6mZXJhvYbbUh2BIhxsUWprkVaGnhpGDQCHAZhI6BGJPiR058FfLQGyqWlkD9PMBrGdSA8RedxBoDaGzm81ZzXSELEKecZa1bYv7GlfXOkMNxA2CEfMo0nESw5p/+TU3z3/4zsyRlTveX3zeVXnN+OXxXZ4x+hMFvuOObxahyTgU6P7P5zKttemN3uZpY6QNKLPPNjd9QCNhZ4Ra9u6d2rxPIh8fMPCTV4SuWlC+a4e+aUPiez8oyWPCQb+/3di8ITFthpd/PUf76T7Mtq/EWlkGQChkQtUG1EUwgpxOBAjzEkFkh/a3IQ9S+zycfkCVpMCOUrqxOJFhYF+HVLaH9b4Oki+C5BNAXwX0tRDvpeF+uwNc/a1TJzd5NA1z/cbctF7/8yuJF54x173PLAtXT4CyWorOaq5790DdtHcnzbjp7U0vrP/wvtZ1jVV17+87+OqW3XMaJ8kYHQc1rilUG9K8R+Phjph4dh5J/cqZFx03JZKP2jeLY3xD+eUZLuFtPm3G+hVjN6Dt9r3hu27PsCX/12/wXHFNdoMXV/ZxaJZ+wpsW7d3fZry0akbOr+xZR176Lg46I4EJuYUbY8ivMxulBLIFWJ3BKk1gDo1gBSSS8MB/n1Z3YV9wbheLDGtGSotvBdhHQXjNhIprEPQ1MavBeGevuc2mvSbti9JYwp2C1HPPV845Tz3n/CKnNAi88+5ll0H7XhycMnXqzZd+bPuhzhfXb77jc9dEdf37jzz6s699+bRa//EkFa3tW9vCnQtnzz9uv8hl8A3FMR5/d6u+vT3FXTp6QwsukSdUjpWHMFSBguXmundSilAk7PnEldkNpk33HNMJr15QEQnbc88P5DjYuvbCPa9CLegACzIEEJejMoE0PafzF34CispgGAQHDuDrbwzWn8Kmt0RBLPdTJyiNgxV6uMx3DMPp3xfaIVSiW33qhMOS7wAztsr1h5VZHZ7zurSLmDq7XJpUDSUf6e0jHZ3k8CFlxqyCt6YTfOEdP//5BXN8+3ZEp8358ZcurfAq02rLz2k69e8efvqm+c1Xzp49d8mPvzn/U5oEjptEbArVNE+YcjwNeVwCvVMc453LHj9w67LM25rFX5m0dPFYDywujEn3Uf7X97lrR905YrzzCH7vlyzYAEXcOgSYSU39ULM4l3V4KmJcBk8wIJfBVjHrCMRo3TZaVwHqJnCxzdKGDq7IMcAFH59Ioqj/MC6bZnF1g/ZAiJlrgocSsv4wQZ7bC2p0lsyV0+4OnaggZTKq+d2A9M5pCK/+2f33ffN/Ndjdn/zZQ6/e/U+SMAGmtrX7I0+8/f6/f/mTfQn61fsefOnvv4Uh+Sv2yQ2jSfhbzsl+W3ndVcfBESo1TuW7es6Fo+8TSuqwczvAnDAwBoXXgUHqIAYW0KtgQfyk/W2MnsP5XgzQfpCyu9kANbDEbnn7Sl/4gDe6F01oNj011pRPxQOnmazDGSAySCbpW6sryuJw7vWHhFGYZf1c+ve5Xkmt/YwiiApEEv+6dcMNl17ZWC7d+9qhvzm7WUIk+8rPnRx6bLV1MEIbgviHn12w9I9vff+K80e9J/c7BqLJTeqJRfDwTN/bfLrSlIpGmLT0Vv72o0l7Y9074bt+kPzDc3b7vhPlOuI6U+Tf/okleqGkZIzMHMMAudN8yvwLXXvZ0Oh10SbE5VHA4iAlXPlAqAP9u5QPnwr27Pb5y83mxRFvve0Jkc2P+s2wBB3jB5SAjdR7VkX/uNEGEoJFzk+5RO8afBcdUfbO7j2fPXsKZTgcid3yxasGt7nhk/OfW7eZv/j41Jot+w/s7EqOVh9y4N637MhFczacNWXtx+ds4Lr18X2I/MHVOrtfCAPHJze8RT3Qcm7PihdCC1pqFl87EmJgbdvEd2HTuPiywI1/f/zHa/Q/f8GgSpIHZUkVtjMm5DBELC1rWc7YPraZBgIPs6PSlod9DecQf51+6hV90gS640ggUAe9Vfb233pn/V0/OAxYDAQ066EX24MePgDgUKOEueY9oSHW5H205MmVd33pC/wK23qTteUVCr/+QQ9xem3gsTW9HOIIsp9f+9V///0f7vni5aPhEw1fNX9T5i3XMb722W1vrj9buGZK2FZs/NOC0y8IpeyYx6yzOV3hBVy/Blz8u7YauyRrS+CSc5Sm+qbld5Q2SsqKhzc41uyNx18ARx/4ubHuLTTlNJbsgkhJ004BEzhyWsQFcAXa+aSvagaBmomwyeELusHUeWb3Ls+EM2k8gs09EtQc4Zqk9ROBsBPaxaU8l8GRvLv4sCN+en1dXZnQBzcdODKhrHBvc9neUFHZFRdzS6UPhFT/1o7oyPtwXkv5tQsn5HIJnWPaCRYfNnaic9Hzy6b88vpl7z5/jL/Lhwf/0WkABHP5Vio+ePg90DJ36rO/wKHg0G24PK8CoAmA2QCcBoBvcBvSvnfAp9B1lHR1lvLTo7Vz+OqrXxG3nuzCdpIheaAvcCG+y9ixSWAvi+9E/T142pWsd59aOzMJwoCZnNAb0Vgi2kkbmsnB9/2g3CEpCLB+wPSi858bWE8O5N3I42++84k501dsfI2/7uqLnTu1aahbntXYtPXAUff11y8+/5E174xKT96/fMas5hwL3aYNsavmb3Sit4t98d73nndCKeK3vvIAx7F7C6XtrifIyMOu+2lJ8cFK00Sl2OdBB7s5vMMJW8kVUolYrht5E64+frl02rzL+e64lHtA6zM0gx0Rwuvsecr6MYlljvZycPQVX+003YowTfUHzwAsHXHlLyddbXbjHPre455TdKGZlTI6Umom7c48oLbw0Rd2bvngyO4f/3opf/uNWVd0R6N1QXUoul5d5v31qvcvndHAXzeE1D2HDnXGaI1/mLBplojZ7Xu4Gg29QxqSH3t21k2LtuUdvPvOtnuWnlbkzCt3vJ15ze9l0fO/uHP1o0sv+9aC04fV1xPOnrbDO/T3GGwRJWz9AHBFwZNtwACgO6+R73PXxZ952NqW8lFb2zdpF19x3BAsz0jFJJnbX88Bp+DBI+0DiDlecc9+ee4NiZ2vQVvuF35m95xJUDnJE+4EytSIxy/Fdkj+JhMkS6HVjkZpbnOeEeGPfMovr7uk8lKgpcNUYsaOwwdxVhppvvbi1Y709GY+ve7STz7z/vpvz88PHIs+8FN99R+yj6jnXBT41j8U6ZTJTZ6XVp19jJ6OTfwW8g7yIyEtcIy9b4EcGyeURinC+hAA2UGMvsGnlWecHbr9bLt9d/KPT/Euc6B8AoK7oRHO9FgqeAfDNF5yeO0x0Igg6HzLp3gJKLdJMhis1YGe/rYBtHJD7vYASMprYW+7139mSQh2xhYg9i4keondufqRWl9NrNPe4fmAf9Y8YerRaKymLFSkD4Oa5lU0myLJafKps079/qPrGTgP5sD3njz4crESuPEHo97tD218dfDBJRd/o6VxpNGOo+U35xylK1dtLOw8kxpPC9x4W8XSJ+QZczgbPgE2tURn5qG7fgNBIUZkYeaPHbavVcobBHFScbCiAYP4wEhQPSYkthgh3v7uQxRIpYocMVfYnVzv4wJsxcZXGr2n+oJazBRkjGtmCYOeMXlysZgWQBGCcTMVmK8gUKZ59/fpWartv+XBl2OXP52x6PaVO97Ku7uWxtl3XHLdKOTJOWYB14lwWhHqU8LW7dBfLYtImEPaRarrAzf+04mwf0Pz8HqPpNBs15owBrOPzCSgAsx9yLZJ3bmmuQfFw1FvhTXAqjliNf6pzBW7slqzZ48M4ojL4xIlPKSE2eHWtk1cVvn06r5gZ9p9DVVZrRCRtUPKYEVCFYEycX3pW7v0rNkr3193y2UXp3WDK6E3YK5bTbo6nOjHf+ViZSw6feWON8J6jhYU0vzPfunHozIJS+G7vptmP/PKbr17ZGdrc6Sv17HVjcccRkYYjHUAyZOWno4lFRZGEyxF3+KCMsC63/PVNCryRNLRGkgmGQhYLJ7VQiI2wSSKKydZXX6/3WlJAY7L4dHL3CuwDtxxyULK4N0vvHL7Nbdm9LZXt+7B0jDBmSF/WXvn0VmTUhrzrMaJf9qyIfMVzuv4Dr7+Xbt9F0fw2CnWD218Je8Ih6/DgEfHq5wmbOvWcG464lFIhZs1JSjGXxYuMaDZz7CcwUgqPhh8RCIhHBIqPLKHlTeIW44cJQBB4IMsNkCrIRTGB9tGar0wAPXuBzXncgZa8k9AUWdtR1e0OlCW3avRmDmxtrJ4J/f1R3ypIFKxVXplj6QlLOCVYa4Pf9qY9joXwIvP+0JQ9XPR2zzhVE6B+N/ROrnEBx9L27miD9xVftfDI+MSH2GKWbPg9HlDfXrfsn03Lx611ANmm9CMAl8wS11ibFDgASsZ0oKq9kqKolZPFaGxdoL4Q9AdGXkDWxyTmGn3R4+qNZpeCoKZe37Gm6IXPlj/qbPOzJ52TWZrUC4+EQe83t5IZGp1WYb3T62rf3XLts/MOet4PuJVf/t/x+7kUuj2+2KPLOMzCKqqy7LkHI+tLdyx6Pl/bW1fz364pmCD/W2JH9y6dXKT9+oFE0blF6mpA5qV/i7Cg6kIimBwSAwNY2cG/XtUf5kWmCosylj2eAIsE6eW1Z/INTBTRCKdkqPMDTtEUiQC2Fv514/29k2tzpG4siL39nPdo7rIKRqqqrvDvQBMHjhSWfm7t1o/M+cEJNWNFYKlxumh2391/H/4jtf/6973nnQJfmv7xpbGAuzlpkVCy3zpuaNXLxidQmzQjCM2kEzkuJML2yJgiUI4BNrWQdvuneIjQOdKoar4LREgn4U1RjF09UUG/JW0a48u4o9LFfIcqnr3ju0NlfVlqpwzGhnAopxKMRlsEerx+7PbzKivryuv+WsqUoGOvz2LC90pv/zCnasfzNVP85utae1Z0yrcIo+u2B8J26MTDU1NBzlogC0g+tGThUW2HIx1wvI6JqzsBEoyVbwWsLN4BBS+ZQxtJAmIl9dhj1cDCVqiy49fGyXhl996bVZTU36Eu2Wpw2UiRePxUCAncKLap5Z5fHGL/Q+tm1Zk5yDbtKG/hPCOjvkPf6ctfCSPTgxuedOiDzINXlzZMRoXieyuHTnSj7nJFOyjKXJCgHegygbvpFkIRLgujBUJaX4T2Fk8GgHbZAjZWBXWRa5WSaoHJGCpTA0C5NmxJtF2mtGbdztJXQ8GhkmWwQj5PPmG+YkVlTsOd37kbjzc1t+6ctdjy9aOn7ppI51QNm0I33/v7hdXHo6ErfuXn3vtwsYijZtCE5dcfMOdq3+TOdI8YdqC01vyLuPuOz7kJDjz9v5791y7sKmUizHbDhptB1P2waYGpakhh0S0r9ZyHQoiiAsXmNIZdU0URad7D+jZzLUpKk1MsgiXtYxYVPYKQuwENaR8O0YScSgJA6MBtACRNUoSGHvtQfKcpeSJlMqFBq6duq9Tp0fLXv8dmJXjvvJLnl6hglcU6Q2M5aDPn9e3XlU9HI6c3TixxOcbDevrWtt3bji67vX9/C9/K9xpyz89TqjISOMiLprzJ47gLOa6NhhSitPWOy658bmdqzd07HQs24Fnv/jvIa0sr82jD+3PftveFi/5OuHO+V8u/DiDgdP+41TEEZRl+mMDwcGDKcJwWxk4so1ZegJoFEaBpeNk0gk6zqVptqkyJAGZsCiQJhjTq5OimE8NgG5ouO74+d1agCaI256DUZUwVqOYVUoS1IK+tWBueIK142Xyle/g6oGOrQ9VHYxwUVpMXiQN3ad68u6lsar2jR1bS+zPF1ZsvHPRC3kHP71wNt/HiyY3QgR/7bqmTRs25Kpf709uapnVHCryreWfXjLn1yJYftU3ftUUKgD3e5bO/tpnB/yQ9y+fW+J1Kk2Tahbf0LnsN4UQXIZJgkEpx2qGHRYxBHhF8oWIH07FWkJXQPocl7kzbKmlBqoMhzYAZmPLlMXyAizLG4IBScrCIMxPpYEjveorO8trDKU2kZQtpiLb40G2FOg1lF7beyBeriDtV4cDb/Z4PF67QUlcUNeXbO+rL1M2nXmu9PKD07+0uEr1Y4dEV5b7y+IaKFYOAMQMPZaM++QcATGpImQRu8T+fPGhTXlHpjVPWLL8mnFkixjhXHDz4tNfeu7wmtbOzBHOJa6a3/rSqkuLgLh5wvQlF9/IsctfFGxw9YJJty058+47tzo/MY2/Lf2S6pf8fc+KJ0m4P++4PLGase50RluGy7Jc55tjC2YQcsVLdbrH2UWTuBCWdqK+d3uz2d8x8dwPOASqT+mrm+24zyWOYAbpIL1QBYmwRW1nqFSC5U833P7KJFDjmPA4gelPXvUJ5aqPlx/odmqkILtRM2Vk86khaaq7kt5dXXXCT1/XfW9/AkidvpX/clpZXUvtDJ9P271t93ll09SJvkqkVGk+aZBCyvi4MWm5ryzvEfsUxbJpwgZeaZhHf7gtzPlDjoE5pP3s2S+PK1PGKERXPvbsRWdNeTESNnNBvGrLvquDIWVoLvHt4qe97Y6ZmzdG9rfF71l6bIF8OBSctPTOtkW35ktWBUMrCfCADIYsHUJNshAs/MCMEmBH8OpnP6dH633Bw4GgPXHSqUZihql/rGtLcMczaydM31E+9QCAR/2VawON7bCaaZKu+KLYJ3L0B8xpGOgxS4wTwbZhR0wDKoGaUzmbidLwHk0KIKNKsV3SLWOqIcJ1TmfkmEB1wtiIAnxVHJJx29jQtWvDkc3Aq4AD8Sd6XgKd9WVScIIWmlvZ1OirbPCEmnzVHgmdFqyVKfJjj4ILBAQ3ltf0xXVvcJhsn8fvfTeXPDR/b+kVHMTFvxV/5j7vFd+A3sBfDIKDIZVL3JdWCv1pZnN5BrWRsM0/GsmZ719+3kfzsFQu/EpGn/M2n4VDYhrVmiroy1cyOcshx3WnVI5nlnGCH5Ho3u2VfT2T1r766Xj/BNvuq6mtvPSyuRDpajCm+fd6y7t6d0/t2NKs+Oj+Nxf4646GphyonLw1Ed1txw9KkyxxRtsR2wyYBvRVONw7xj48ZAMFKRygCFgUUD+pDwKbkAE/IBf/hdVHp9IEhyOWgeIFKkQBCUS5FunpN6L9yfDOvjbART0xBePxVnokFRIjhAJ/XnXw9GDdBVVTJ3mDlYrPJym1noABiMqGf/QvrEjxw5YF07+39Mr6ptCwPW9tez/xzP3mulWh25cfHxCPTnzwrOZKvo/6xQWHG+7FuMQd/5B3xO7eybUt4CnPpruO42sAxMLKpZK+nrKOHj+M13q9ti+4L5mI1U8hgYo2XTcwVwRtmzHbUxHx4IhYScNQwnsbOzdzMnGh4nvz4LtNtTO3Tzx3g1q3p6quGwZBeUUi5FhEaBTu70WcK6TUSEIVFQW8yCQDwXHpUJ3hvIGiritGCHECQ2VNuDdyiVDSiAGEEih8eP/bvyf2UiHeA/wIR7bq19iHPV86eOHlF55XC7ynBKp9sqpA/pGcC9/10bB+TsuUG5fM539L6XOWiEYf+GfR1e3bY4/8NHDjXccDwT0rnuAS66/DPWMZNt9lTZIL1b2jkTZGs9OHnHTglC0CDpgnMGo/GrQZH9wem0oKMBmjfr8XSxJjBm9sm1x4ut488Q8rFlbCWnkM0JiZoLFDdb3bZu194TMbjTdI1c65Ld2ss7/5Ex0hcNj2sYNRDxfwGRR6/djrwXxIDKwT6iy/4bpfhsrVE9cb0KQ9/cqDG6zrZxkXTgS9OsupOsEfrOreDVDkAQMhYEkzmYzGOT/59XtP/br/FYD9wuaG5XLFOzvUMKe8aUZZXUBRJnkr1h1o/8lzX77immPwP8ef+X+k61BaGL93fMITpLZF3+156ImGpT/hs+1fKHBN3T606+ietfsaptd3HuhtOrNB9XGZwmom50wLLLxXFMLLW9UCsZwpW7WTvf6Dnb6aimhPR8C2saIyjCSf38sEAgTJIAahRNCNbIhxAHGRWKYgUwl7QjqkkBwm+3bU7n3/NC1IW1tj5z7e2TGlM4kNhIx0bSvmUZBHYTblIhRlZgHEdTJWzKstPombVpVmffl00BBgMbMkH7Wr6jm0GIcUzGTb76OGxZFNiN6dNF+Ld7924H3AGTpWxZ2dqpUdTbwb/uX0UKmzq7565YDePONjxwfB4q6irW9umzOfQ5mEo4MzRR9dsZfva1o7Hdfu2GYU8x861q8kI/ahHZ2x3mTl5OppH5t6wTXnWAYNVobifWa028huaXdtRTLKZb15NJtLVLzvSDBpcC1djifKkCgLSLGEFFUmKQSLspqU5oezebgcNhNPtr8ZIXEP9lBoITVZWZWceGpvZU0YULju9zOefn46UGwps5onoZoi3HjC1sayH0kJcNRtGlLplafSchUk7WN75n5V6k6o/71Z2dEHyj0i25dDltNr2SMqxmrlQPYKqs1Af+zQ2u79pT8L3+e+M2DWPOdTxycLfYAE96z47eYpc8Irf5/ntePa2E2L3rxq/h8nlf/2rClPj6mH8LGH9vBf+cGt7+9PuTCG2S2d7t7YNnlGQ3VD1ZxPnIEw4hRi8pn1eza1T5ndsH39nkS/1bnsVyTcz/jWs0NUVM+ZbRlFWTnKErGi6pHegNdjJ5OeWH8llgmXlBgjiKHjpRNYYxZFblhmNsmmloJ9p1VfrkIfpZbJiEkITnNaRbWqGsLeUzrFel4UZwiLVwWKxM8Ms6gNE9PCsNH1XGRzTbAzLv7iYxR1nHf7ZaO5kvhlYNIh3dlccfR4I/QYiv14rlgkNabKhCozzivR1e/kQ/hHEheRpR6EIzgUGlT+sfHqBanwvP1tsTWtY5jcdtElEyJh875lH5415alS2u94f+8ZF06LhZO2NVBxQ1Ylza8mo9bZ88/64JE/Hvz+kp3zr6HRCCbxbHcGcIMrs3N9MdR1yOdVRSV60qsnQwgTkY2PkMwnXybMxFxeMpKNuDQqqOWVtPNrmz1IoZAlbd2wDZTuXiRkMo1oek4WP4OazCREaA5DgGjEi2sMR1ctq9pj/u1Mq8EPombRcSKv7T22EmH+rwtNjuMYeoNFW8pOLk+ZiO4TLiJpdBDs2J4K1Pq8f/nFGRvZYw/tHjsEz8wxaAzTON5nlNeUYwnv336wamJFTvDKKXWHd3fwj7xr34qf1pzYsHnftd/EdoLBrFIDjiKXA2koxCtlXJSbpuW3bY9Ymp5RScayLKWYA0ewTQcjDAlwk4gRISKYEunEsJmdATpiSJftsGa6q9RmxK0mufw3l5qPNYK5zDYJOBIHBhlGfsvaqo5t7FieoDzjfC6JHQpRpFnQEbpq1rIOxUr+JOKkVAR7m2cOlsEukbhtScqt8OLK9kjYGiMEz2upLxHBfObdvm533ak1xGaihHggJ85Q9sgH9h429h2QXn0pHnLqjhGTWf0wyyEH3Xz2HE2OmZZMRIYvs8ygTWQEOW6posgOglmKRpCiU7wo4A5NYlFR2DWDYKhLJCYQnOEHorKfIlGI8i0Obij8uNCRVV97z4GofWyhrb7P3aLN+0LRNoOJ+5Crtb78woEH/3NHqQj2t8wbqt3Ni8+a11Ln+ClMDuIxQjAfKpObAqUgON6nhyqDXFomIsmswqnpqEIJT2ysp1UTpq/5g2/WLHviFBzyAqI7K2xmJKBz91I2MYYWkV2vhpEIMsKlIRVWWwfBTCwx6xQLpEOKSDftjit/nEVkmSkAB2pCtvkOaVaHMyZhG8F8iYsgG0nu9Kjq+QpIdm/pPbalczl/wNWTjgXBzDlSoOXTT+z7yQ/XHT6UKBXBgUvmFWl699IL0kRi19gRCXecDIvgI/uONJ0pqiV0H+7rDxeIS2aIdXV0KU2NzXffWnfXnVJARtTOZ02YM4aMHUCAhiOYs10ubY1kmTPHcQBTr9cjcRnMhLAUGiGlRUUwIITqggRnVUaiMKqapkwwG7D7imqXsmt7yDGPwI/khhz1LZUEC+2Did7RfsokS2wQp+BTgYj7W2968x9veTuZJISw0lnErCJNZzVXPfbsZZwQr2k9wlW6MVPm6odFsG0QBhFWREK/rpuKViBVQdXUyupqUXizwqeffRH6/AWyL7cAAEsvQD8wi0PTRFztYkSyjIATsybae7ya8H654WkMgaER7OASEse9myHBLiJjisXPnA6Dc0YDhmU+iQ+I3AB7hymPIH16tDZ3uAKMjxr9Y/CgXROQCVIVwPMbfOeGNY89vIszN9tmplFsRXg09dnHnaKUgIsrZVAqyyC7xJQt+669ekHTffduGSMEX7vwdL4XR3BvR6SipjxFPIJlRsIowMb8fllSUjfJ0L5VT4GAj+XKNoaddZHdkAQx+QPThghZxPITswwiy1F7kKxglqYO4qGSIixC5HzwEWAzkuWp5oyYRTxGFjcQQWxAFgimlA0y0bMTDt+sq5G2Rg6OwYO2HewWJg+3fe+dxx7ayRz4cgG8c3u4WI5GaME105qads6/PNBycSmTF6eqjz17xf626NjNdPcvn795Q0+R8+/b2jbroplug3A4qieMAsYBjCzTVoTVBkw9qzpwSgXQ9+UKGZGfkVXjn0MTGhbCmNqmz7K8CAlTGgcUTod3cbFK+ZxmF7CmDUhQAA1GLGZnWATnvgTRPi0JsqqoEEqwJgV8smXbMM+aBsdF7GIqvEjR/nxoCytaynPR8//QFj6YedsWObjk4u8unP2F4UT8kGSJ61qCrTHRzZzGhfuMImCQnHUGZp+x/l2jrb10UE5uKhvT7ntp1TVDXYyRNCvrqz1lngGNjBXuC6/fl5rYEaxqqiK7DWGCzNLkRMxuxpglDBAwaQBFZsmo37ZULDkRkBBKkkshOHAlZjHiCOohHgvEEOsiOsPEabsHJ9u6RKOalXORhHm9kl/DhJh5wVXjgEFkOSxl366+fVHbKpOGDJRdsfGp7LchrWzB6ZePRMB9+7szH3toB0JQxFAxMGVqsMjZUpmenD8EWi4ZPwmoTlTaEOtxmCRUO2D9VTzeUG3V4GamYXV2ZvIZAek/UKAXxBowaRYKmU2gZXPg2clEGbEVKExpTJElVVO4yHRRTmybWDZCQ8tgBJN20qJWRgbzLjaxrUs2yDFEQBkzBfFfgHnAwZABOC6UOWf8ScCIHElEii/MmL1x6RvSgiN5+rOaq2fNqRLyVYILbzzzkaevOB65yqO2WItNWdxkhi38pXwa50pb1CCHIsY7u4z1+0A42b/rsNkVFg0c8VpeE/L4C9TJ7OuLOhTTfWvR2NFUuFa+5XUAzYRiyoT7mNhlnCNzocsPcY1Q82i248XgvUUsLjQpLLKAC4SmbaYQn/JVo7hiJWSSU8qHAY5gjG2Wi2AGABpXxbpEjJEdtor5llsacxZKuuVj3xw5DG6+ZXZllfabRz71g3+ZO2yu8viqbhZ9cS3c3cGlEwp4lWmN0Kmey/m88eEe0htNKjLX4DxBf/yN7VSTy5pqj+7t0BGYKMkEI6jKTJGQR+HyzRcKTJg0ITUnkyRL9kBVY/lgcWq5p5gw/xGJchkKZGIGuAB22aqiyrIquw45ThEoB6dNild4N4mdbc6VKAx7DFO2pXREhMsTFInKiA1S5BwWDMeNJucshXAo0QMqpxTlzGLj5OGW865vCk0a+a9+5RvTL7pkYsPk4WPkxxeC+URuH+ySERBRf4rlzPCOFiFiazAHKJQl/j6e0EUSmGGZm/YpHZFE3KYJq1/XFVlOJI3e/njtrGmIawBHY1rQSyUv7Xrd6xc2skKReSxljkXQosLoSyyvoZdBJ4KMS3GV0wiMLSGDxVUQ0+IIxnjIpXtEcpooeTLwXLnoFaY0TJAtDVBMCjSJyRjaZMg80/Gyyerje9743KS5Q33Oie/i827gorcp1DCKP9swuSRda3whmMREZA2TZWGA4n8xzjK+OkmZAKZiHJ2EXeTxRuXup7a9ccrUz/i8TgkG3aBx/cjqTR5Z7lq9mdNaS6+om/xC4ExkJ/ODbqHLg13YIJC0MAMWMSrNZBnCwpTGx4msckUOWukvEM5mbSZJQy15z8/IDGoOZDuLAQKFGpe3uhelmgJkGZl2Xtqwo4GPKxhr/t8fWidC/oeYeZ790n+dSHPfaJ1oTevBkZ+ERuLQmVahE/OdToQYUNBZ7sPVDaO+PPiF8+cKAyN1Sjnx54+R5NUsRYJlXtnrkX2qVGYBag0u7+cGKbDUuZGuYwqJZfht04ecqEsOP1mWheXBCQ52YtNokeBzUduaUksgGGUwbSPar5qD1koCXkUUQslzj7BxKYPj8e5+MwHG5TY6mtzdd7x7261rRkGNMwmwbCd5h+vqkqswFaGEhNgBxXtu03QJYSdfsoAuDZCNpPhgrZm5EjJVK1XE/RqOjUFPBIgtuzxY2EM5grOqmAiX8tAo4y0J45qelTFWIAYMiXBNLn/8MOrRcMF0d5iq1TN+mDCfCfUeMz7elP5R0+T2t/Xfd++GSNjY3xYdoZ3Y7o26yWci7EZVxHKbjl07U6ka5tMAaFPSn4i7r9POUGfqToltBJGBpahwNeTbIRhA6QAFgWFkWSIj3tTLgcjjFXMBRkjVZDe/yDVdQOHlgEPJSn7Bup3kxCBjDObaW8SjRxXDqVeZrR4BnwYRhoNEsxvZA9N3MB60Ez4FWf12coRQIV0HrG1vmute9lxxozzj46N1ddLIT3HTolc4fPmL++5df8/SS0ZyKnP7fizLqZASCX8k5YYNoFlYMbDI2OUymOHBsg656yGnXMrYsPjXJGoF0wsucx6OVFVhqfhHh0gQ1xdS+IokhAwraRITpd14MkER1YyqJiQox5kiIREUQfNPlUIuHGfmCGrt6D9yTvkxlyJniYjpoJZjlyM45ZNa93uO4MCNv3RC2EYBwSMaWC+u3JNhwPz1PUtbSvlWeOXK8HPPKY0DNb/Upqbg579Ee/tlBVNnsWPkIBgWcBMN60nKDiJHsqxLWGcUD+abLFPzD4m6rLrJceyzTD901DhCiKopXp9GbJKxjVJarNAl4pSFCmVPScduIwajikUxlWycba8QCPYWCIoYjzxYWP68K/e99bXGjx+j0N2f/OMDdvtmDt+8j/iR+KM/LFv80ImXwZs3dGbTiU0bumY1Vw9zY+Fw26JF/G/2wWmrVkHdRBYlGp9ZRSUSKEmZBeYhKHWRTeamz7sAFbG8SJKjkpxkbBDlRE4dnbSiyFFKGLBMj5H0YkeNo4Qofo+iKiSVB+SEB9tOlCUccvxYwg3D4EDoG4yqBsAUESkDfaG9YeBR2ODVPZkITYMpT+H4wbLqffXgen5j+FiWOsXVk/1f/0kGslwYu1BWz7lSu/irThqS2L5zw6v/8ZtPnTAE5xHfxx76cFbzMERiMHybli8PtLRYR3qAaUFN4U8YSRJSlHQkLmMl91u2R1aUMGVYUsMIJ0ieMdgJ2ckKDqaUqhzktuGxLc01RBDKOIWQZUzSOiIXqIwUiw/m7MUSSUiZ9oAi2q+ZzrpEMEsGC2etIvGhAQuyznFEgt3OQlKYJU1me6D8Ee0ZMz4+FPd94pFtFZXaj/5t3omxpk1uCuaSit3D84eVK7OP1CxeXLlwoXiufVHo0kcOERmLnbqU8xgeJmPZNRz4qbCihCHWs1Ky0tQXOSlGqaqUzCKIA4uY5YR4gGtKo0xRJSxhlhVHJfA5dIIGP51OjIzZATFkSETEVQ4agjJmKi48FuD4CYoYMHPLwIoniTlGP/Cb+zc99fiOE4PgeS3H4IYx29q4AM4+wrE7aenS1KedYTcahjn+W4EwlqnoAD/SIxUGB6HGQVLIGJxxZ/AX0KaclSJihgCVoKu0MSYLb8ZAFTOOaeFSHhJekFCStAyYDptw0uNoTM6N6XF1REjE0GCFRwKAdDzh16nKYESdZI0xOL/YwD/e0rryqV0nAMF5ROK2JeeXzh+8zc0Z+HJxa+0+mLI/MKdoQk6EC2SlYBjmLKQlhDcHEY4X1gGhY01LZdNA08K2rVhmIN1YSHNJ2KQHUjFFhtHQwcEc6xa1DWI4+b/i6rFIjzOTip1vy6NQxlSWAGWgkCbHABhXbjmHcjFrS0/b2CCYDxDRqQ/8x4YTg+CM6hYMqdcuPHOoZp3LlkVbWzNvlaYmrr05qdHOMzVMHNeBUxbKQTAUMTYpQLJjMUZkJzjwjrERTg4yBmeswG5QhFgqK2lS08BG0pcuiC0i0RRNziqHzUWzK4OH6EqIOAkWLuVUiDqUKIqpZkKxUN4MYFO/B3tUZBdKe05XxmLjBr9uITblz4c3jpmQFyA+2hHfsyt8AhA8c3YKwTffUmw90KP33jugpYZCU599NgNf4OpNNnUFrRN7jpGbhw4z8BleJkGWs4qWk3RsYSk22JAhWkKaTn0XY8QiwhBh6T6ESXoaQJqqZoLH3Cgjag0JLIywbuumbWG39DtgmKK4YjNk4zyNjTDh8FYRIQUWY4RwvLFg53okdWeiY6x+Ir298vt9JwLBzTUpBC8uVqp65r59TcuXO6l4gMOXU4iceTUSZ6aVjo1lWJHFawZGkrrLKEYoKUkJQFEhu2uamAiiyzU5xoif2H4utlMkWJY9HjVTIs3JeBHxwUMFB3OBbxDTYpnYdsZHSL9iCiYDch1ylPo0zphQQbNcupLQOOIQzrJl0o7YEToWMwNzE1/F3zWtB04YD+b8Ydh611xv4ziesX59oKUlX8nrCmeLT8QRPOAlLtnQ79qA061FxTMcl3CCUTkv/os5SccDCRqUa3KQWuXUThkiuHRUVcXjVQdMaQhR23ISNNAQMwC00xLbtQQT5CZ4wkG+Y+pRxTRTkAXB0tdjPJ6brHVGDkdtfdRPfON3mlNqBwOHD8U6jyaON4JdHlxch8ve8qRvSgZ3htOBDY5DTpWdZ8nSXuJSLyZdB9LJFadYUmJYjlOWt+CWo+7jtOmY44sgQiUjGSJOnR7XPiwKnUhShkWINE+RoGEXTKKAKVuETdP1tDFDlhuVVginXAaLwLTBHo2Bex1nvjksg0Rfe7Rr1E/845/Oe/KFz9RN9BMizIvvvX3keCPYhe8IY3pobwRmCurwZ5tbT5yVpsiltLh0fC3jMliJQinpuI/z/dNpBKcksW3Lpu5Pe9OE4QxLWOSsZUCGILEo34ewRQiXhc5p8sBZoSHZccXM0yMdlo/KfBjQgjMLc4xLEIw7MSySNdb27BmLU19w0cQX/vT5b/9dM7Hpqy/vOxEIvuOCEX2fUtIXYzIekEKOGscGa8QlmCJgSpt31s6SYhDYrMBtslRgaWrWp4ZQ40IoU4xVpB0DlIVgETnJZbBdmAc7/j+StPUMvGWhxlkxheQZg2kqrAdRVtC0LMwwELBxB2B+Par89tGtY3T6sqB60y1zHvzt35gm7epMHG8Ej3AjCYPFEhC7oWLCCuCkr9Fc0ZRVHm1o/DqAG4ivhSjhpE0UAArIVKIWrmKoJ3yWXu4aIhycUU1VZIwyCEYY2abNiQQqjGDIBbRu6yjdpZjCiGYmFSvPEMGcsB6fSL1jhXCC4Lhdt1tSPoweGtNfOH1Gxf3LL/P55L8wBNtdYRFZA92gXccbgHMrmbt+m5JkMMuymPHTJAf7t1I+DJTmJVjUDNaTXkC1TGA7P4/Xp2EsZc7n8mA2lEcDiag0iwzoeYihVHpc7vghqaAIOFR4BRyP4Wnulcm7453HYXbw/sUhmKtxGKRmTpFfhJGz3EOOIwOmHc7FF5gYQLCw5xqyGnFoaH5NBgay2ClkugWTyQClqih6lmIyUNOUnC+mQisLo0ukghDLFKV6BtbqiGpGXkyPe3IJM1lipLAMHscIVjyd4UPhcZZuNE5kcARmggoZhZIkGMUAFlM2A1aKjp6OY3MWD9Cx0l/YIYccTS59dsOU4rEKaktuESrhRcVQxLbnyUnKwBALDIlVAZjNRbRr+kUUmpiEVR0MhrxTk8LJsy/ERtxaS+MTwkgGyd6NvW0nETxoC/cDKTVfC2cYx55jasp9tsOp59ARwCk/nlg8AGJdwnHGcMG2WVUrmW5KRqIis5K9CLVUVI9XI8TORzAbqh+hDURseyamx5Ccou0UFZiMkZDBBXVTNwQBjddId35jHXr4JIJzu8Umdl/M5bkuhKAigULWfljUpuZaoDKWA0Y5iU1iOcZowXTKVN6++6WkLhGjLGOKdbIzxH92ttcXOtXbh7KJQGgzi9JU0VWnVhqJqSYYHAFsM68HelQ82KWctqWxcarJCTMPOpTsPYngXLnWn2AJ3V3nzGURSJGFnjWgQ7mAg8PLpVSFlBSCJSXOQZyfX5RCeybNU9guDF2zbTfDPmUMlmSEJdcQkUVeiJuDWvjRJi3DcUE7QQQUxkVMDycVg37dJkEf9mqSXQjBzuWnBuP4Q7AIdf+gd89JBOc+0J4ING0Gs0QpZxQwj7eWNKlmhaWJ0EhJ7heBaYMxxFwEp2LbOWnQzSAlXojsNFlgkmAyMDeAV1RWK7jAhes+iVvJgfXAKYoppi0TabAMpiDkw5o0ZOYJFPHF41SXA6rntYOb6HgyVo8DFsEpRFZashC3EhosgKBbtYENK4RdeIpvIBwF0CrEg9lA4ofTNhGvIpYn484QJFosWizWmxkYOqIEnrOy6yB48QOE2rptZBvaYooNYCGQMlbmE/6+QqYIZ8mvVNmecckiZO/R6IFxZY4YBywirg/UfBZzNKeBuEBoC4TDZ8tlKqk6ohUNEduePpFLCUTWZTRSTWwtZUpzNDnNo0oSzlmhQDATlht/PPARYdQWeE+V7eOvwq4pbbAZBEJNBunVe1ghTW68ejTEyJeAFe3W+08ieGAzD3VBnL1M4BD1R+HwAiJjinCQY2McK1iIV7QSy8Yxt1yabcNYtBxSKcv3wXw+D0oXm0qdnIpqPEPkOzkIBlYqWJu/hTQsotIKGNP43YmFaNNp/gVvdLya01Id0WfFTyI4LYCTBuuOADkrkVjk2eNs2ZTKpxhuYs21VIhFCGS1f0jDBXaqnAq6QHRD0ROBlEvbOSZK9YhCJyC39ARw6q4WzKoQxaYsRtzJBDFoYZqUrUJSTIBTkVjacscKThDpOP/xudFd/UdOIjiDYJPpBhgoscOQhJGzeFthfBZ0WMGUpHOiIpzYdU5EZENSYoUMEY5gRdRBMOQ6VzLhTSbKkZQmwYBijBVVZjR34TiWyiIZjCwurXVimrblIJjLd2EMTshiQaNBWpy4Ok0esOQVhDhC49Ie7D4nSXt67xsnEZze4rpY+DUjX6njkMuKyk3PqkK7Ye6K2UPIJpYOL3aMCQhhHUuJIdwZwmCbskUgFosFDL0MCUOEa0oDXM+SFYkymp01yt+RwsUFxXpHSUu3iIUdfGMG+zUzNjjBE6RyQzQ5Kwt78CMZvxzCuWhFe6Nnx/gxR/x/AQYA+sj6d53xnZgAAAAASUVORK5CYII=';

          details.box = mono.create('div', {
            class: 'sf-adv-container',
            style: {
              position: 'fixed',
              width: '100%',
              textAlign: 'right',
              display: 'block',
              zIndex: 9999999,
              bottom: 0
            },
            append: [
              details.dialog = mono.create('div', {
                class: 'sf-adv-dialog',
                style: {
                  display: 'inline-block',
                  width: '882px',
                  height: '92px',
                  backgroundColor: '#fff',
                  fontFamily: 'Arial',
                  lineHeight: 'normal',
                  textAlign: 'left',
                  position: 'absolute',
                  bottom: '20px',
                  right: '0px',
                  border: '1px solid #aaa',
                  borderRight: 0
                },
                on: ['click', function(e) {
                  e.stopPropagation();

                  var el = e.target;
                  if (el.tagName !== 'A') {
                    return;
                  }

                  if (el.href.indexOf('#un') !== -1) {
                    e.preventDefault();
                    details._onClose(0, 1);
                  } else
                  if (el.href.indexOf('#close') !== -1) {
                    e.preventDefault();
                    details._onClose();
                  } else
                  if (el.href.indexOf('#ok') !== -1) {
                    e.preventDefault();
                    details._onClose(1);
                  }
                }],
                append: [
                  mono.create('span', {
                    class: 'sf-adv-desc',
                    style: {
                      display: 'block',
                      paddingLeft: '230px',
                      paddingTop: '6px',
                      marginRight: '30px'
                    },
                    append: [
                      mono.create('p', {
                        style: {
                          fontSize: '16px'
                        },
                        append: [
                          mono.parseTemplate(lang.dpDialogText)
                        ]
                      }),
                      mono.create('p', {
                        style: mono.extend({
                          color: '#696969'
                        }, styleFix.dpDialogUninstall),
                        append: [
                          mono.parseTemplate(lang.dpDialogUninstall)
                        ]
                      }),
                      mono.create('p', {
                        style: mono.extend({}, styleFix.dpDialogMore),
                        append: [
                          mono.create('a', {
                            class: 'sf-more',
                            text: lang.dpDialogMore,
                            href: '#more'
                          })
                        ]
                      })
                    ]
                  }),
                  mono.create('a', {
                    class: 'sf-btn apply',
                    style: {
                      display: 'block',
                      position: 'absolute',
                      right: '28px',
                      bottom: '5px',
                      fontSize: '18px',
                      borderRadius: '4px',
                      padding: '5px 24px',
                      backgroundColor: '#87AF18',
                      color: '#fff',
                      textDecoration: 'none'
                    },
                    text: lang.dpDialogOk,
                    href: '#ok'
                  }),
                  mono.create('div', {
                    style: {
                      position: 'absolute',
                      height: '26px',
                      backgroundColor: '#87AF18',
                      right: 0,
                      top: '-28px',
                      borderTop: '1px solid #aaa',
                      paddingLeft: '2px',
                      paddingRight: '2px'
                    },
                    append: [
                      mono.create('span', {
                        text: lang.dpDialogTop,
                        style: {
                          fontSize: '17px',
                          fontWeight: 'bold',
                          color: '#fff',
                          lineHeight: '28px'
                        }
                      }),
                      mono.create('i', {
                        style: {
                          display: 'block',
                          position: 'absolute',
                          height: '0px',
                          width: '0px',
                          border: '0 solid transparent',
                          borderWidth: '26px 15px 0px 0px',
                          borderRightColor: '#87AF18',
                          top: '0',
                          left: '-15px'
                        }
                      })
                    ]
                  }),
                  mono.create('div', {
                    style: {
                      position: 'absolute',
                      height: '16px',
                      left: '-1px',
                      bottom: '-18px',
                      border: '1px solid #aaa',
                      borderRight: 0,
                      borderTop: 0,
                      backgroundColor: '#fff',
                      paddingLeft: '4px',
                      paddingRight: '4px',
                      lineHeight: '16px'
                    },
                    append: [
                      mono.create('span', {
                        class: 'sf-bottom-panel',
                        append: [
                          mono.parseTemplate(lang.dpDialogBtm)
                        ]
                      }),
                      mono.create('i', {
                        style: {
                          display: 'block',
                          position: 'absolute',
                          height: '0px',
                          width: '0px',
                          border: '0 solid transparent',
                          borderWidth: '0px 0px 18px 15px',
                          borderLeftColor: '#aaa',
                          top: '-1px',
                          right: '-15px'
                        }
                      }),
                      mono.create('i', {
                        style: {
                          display: 'block',
                          position: 'absolute',
                          height: '0px',
                          width: '0px',
                          border: '0 solid transparent',
                          borderWidth: '0px 0px 16px 13px',
                          borderLeftColor: '#fff',
                          top: 0,
                          right: '-13px'
                        }
                      })
                    ]
                  }),
                  mono.create('a', {
                    class: ['sf-btn', 'close'],
                    text: 'x',
                    href: '#close',
                    style: {
                      display: 'block',
                      position: 'absolute',
                      right: '2px',
                      top: '6px',
                      width: '18px',
                      height: '18px',
                      textAlign: 'center',
                      textDecoration: 'none',
                      color: '#7A7C7B',
                      fontWeight: 'bold',
                      fontSize: '14px',
                      lineHeight: '16px'
                    }
                  })
                ]
              }),
              mono.create('style', {
                text: mono.style2Text({
                  '.sf-adv-container': {
                    WebkitUserSelect: 'none',
                    MozUserSelect: 'none',
                    OUserSelect: 'none',
                    userSelect: 'none',
                    color: '#000',
                    lineHeight: 'normal',
                    append: {
                      div: {
                        boxSizing: 'content-box'
                      },
                      p: {
                        margin: 0,
                        lineHeight: 'normal'
                      },
                      '.sf-adv-dialog': {
                        backgroundImage: 'url(' + advDialogImg + ')',
                        backgroundRepeat: 'repeat-x',
                        backgroundPosition: 'top left',
                        fontSize: '12px'
                      },
                      '.sf-adv-desc': {
                        backgroundImage: 'url(' + advDescImg + ')',
                        backgroundRepeat: 'no-repeat',
                        backgroundPosition: 'top left',
                        height: '94px',
                        boxSizing: 'border-box'
                      },
                      'a': {
                        color: '#696969',
                        textDecoration: 'underline'
                      },
                      '.sf-black': {
                        color: '#000'
                      },
                      '.sf-more': {
                        fontSize: '14px',
                        color: '#3E3E3E'
                      },
                      '.sf-bottom-panel': {
                        color: '#696969'
                      },
                      '.sf-btn.apply:hover': {
                        opacity: '0.8'
                      },
                      '.sf-btn.apply:active': {
                        opacity: '0.9'
                      }
                    }
                  }
                })
              })
            ]
          });

          langPrepare(details.box);

          if (location.hostname.indexOf('sprint.com') !== -1) {
            details.dialog.style.right = '73px';
          }
          if (location.hostname.indexOf('newegg.com') !== -1) {
            details.dialog.style.right = '6px';
          }

          setTimeout(function() {
            details.box.style.transition = 'opacity 0.5s';
            details.box.style.opacity = 0;
            document.body.appendChild(details.box);
            setTimeout(function() {
              details.box.style.opacity = 1;
            }, 50);

            details.onShow && details.onShow();
          }, details.withDelay);
        });
      }
    };

    //@insert

    run();
  }, function isActive(initData) {
    "use strict";
    if (mono.global.exAviaBar) {
      return false;
    }

    var preference = initData.getPreference;

    if (!preference.hasDP) {
      return false;
    }

    if (!preference.sovetnikEnabled) {
      return false;
    }

    if (mono.global.ddblAdv) {
      return false;
    }
    mono.global.ddblAdv = true;

    return true;
  }, function syncIsAvailable() {
    "use strict";
    if (location.protocol === 'https:') {
      return false;
    }

    if (!document.body) {
      return false;
    }

    if (mono.isIframe()) {
      return false;
    }

    if (mono.isSafari || mono.isFF || mono.isGM) {
      var excludeList = [
        'ftp://*',
        'file://*',
        '*://*.google.*/*',
        '*://*.acidtests.org/*',

        '*://*.savefrom.net/*',
        '*://*.youtube.com/*',
        '*://*.vimeo.com/*',
        '*://*.dailymotion.*/*',
        '*://*.vk.com/*',
        '*://*.vkontakte.ru/*',
        '*://*.odnoklassniki.ru/*',
        '*://*.ok.ru/*',
        '*://my.mail.ru/*',
        '*://*.soundcloud.com/*',
        '*://*.facebook.com/*',
        '*://*.instagram.com/*',
        '*://*.rutube.ru/*'
      ];

      var reStr = excludeList.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    var inBlackList = function() {
      var list = [
        "vk.com",
        "youtube.com",
        "odnoklassniki.ru",
        "ok.ru",
        "privet.ru",
        "facebook.com",
        "news.sportbox.ru",
        "play.google.com",
        "roem.ru",
        "linkedin.com",
        "ex.ua",
        "instagram.com",
        "rutube.ru",
        "e.mail.ru",
        "fotki.yandex.ru",
        "support.kaspersky.ru",
        "vimeo.com",
        "club.foto.ru",
        "garant.ru",
        "webmaster.yandex.ru",
        "support.kaspersky.ru",
        "fotki.yandex.ru",
        "mk.ru",
        "metrika.yandex.ru",
        "images.yandex.ru",
        "disk.yandex.ru",
        "maps.yandex.ru",
        "help.yandex.ru",
        "www.yaplakal.com",
        "www.facebook.com",
        "my.mail.ru"
      ];

      return mono.matchHost(location.hostname, list);
    };

    if (inBlackList()) {
      return false;
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('dealplyFrame', function(moduleName, initData) {
    "use strict";
    var preference = initData.getPreference;

    if (!document.body.querySelector('.offers_ul')) {
      return;
    }

    mono.sendMessage({
      action: 'track',
      t: 'event',
      ec: 'dealply',
      ea: 'show',
      el: 'bar',
      tid: 'UA-67738130-3'
    });

    document.body.addEventListener('mousedown', function(e) {
      if (e.button !== 0) {
        return;
      }

      var link = e.target;

      var isLink = false;

      if (/goto/.test(link.id)) {
        isLink = true;
      }

      if (!isLink) {
        link = mono.getParent(link, 'A');

        if (!link) {
          return;
        }

        if (!link.classList.contains('cliackableArea')) {
          return;
        }

        isLink = true;
      }

      if (!isLink) {
        return;
      }

      var label = preference.country + ' link';
      mono.sendMessage({
        action: 'track',
        t: 'event',
        ec: 'dealply',
        ea: 'click',
        el: label,
        tid: 'UA-67738130-3'
      });
      mono.sendMessage({
        action: 'track',
        t: 'event',
        ec: 'dealply',
        ea: 'click',
        el: label,
        tid: 'UA-7055055-5'
      });
    });
  }, function isActive(initData) {
    "use strict";
    var preference = initData.getPreference;

    if (!preference.hasDP) {
      return false;
    }

    if (!preference.sovetnikEnabled) {
      return false;
    }

    if (!preference.country) {
      return;
    }

    return true;
  }, function syncIsAvailable() {
    "use strict";
    if (!document.body) {
      return false;
    }

    if (!mono.isIframe()) {
      return false;
    }

    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://f.mgicinjs.info/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('aviaBar', function(moduleName, initData) {
    "use strict";
    var language = initData.getLanguage;

    (function() {
      "use strict";
      var appInfo = {};
      var tbr = {};

      var main = tbr.main = {};

      tbr.emit = function(type) {
        if (appInfo[type]) {
          var args = [].slice.call(arguments);
          args.shift();
          browser.sendMessage({
            action: 'tbrEvent',
            type: type,
            data: args
          });
        }
      };

      tbr.error = function() {
        if (!appInfo.debug) return;
        var args = [].slice.call(arguments);
        args.unshift('tbr');
        console.error.apply(console, args);
      };

      tbr.log = function() {
        if (!appInfo.debug) return;
        var args = [].slice.call(arguments);
        args.unshift('tbr');
        console.trace.apply(console, args);
      };

      tbr.hostname = location.hostname;
      var browser = {
        storage: {
          get: function(data, cb) {
            return mono.storage.get(data, cb);
          },
          set: function(data, cb) {
            return mono.storage.set(data, cb);
          }
        },
        sendMessage: function(msg, cb) {
          return mono.sendMessage(msg, cb);
        },
        getUILanguage: function() {
          return language.lang;
        }
      };
      var monoUtils = mono;
      var components = SaveFrom_Utils;

      tbr.getData = function(details, cb) {
        details.action = 'tbrGetData';
        return browser.sendMessage(details, cb);
      };
      var getProfileName = function() {
        var hasTravelBar = function() {
          if (document.body.parentNode.dataset.travelBar) {
            return false;
          }
          document.body.parentNode.dataset.travelBar = '1';
          return true;
        };

        return hasTravelBar() && mono.global.aviaBarProfile;
      };
      tbr.profileName = getProfileName();

      if (!tbr.profileName) {
        return;
      }

      if (components.mutationWatcher.isAvailable()) {
        setTimeout(function() {
          return main.run();
        }, 0);
      }
      var getLanguage = function() {
        var langCode = (function() {
          var langCode = '';

          if (browser.getUILanguage) {
            langCode = browser.getUILanguage();
          }

          if (!langCode && typeof navigator === 'object') {
            langCode = navigator.language;
          }

          if (!langCode || typeof langCode !== 'string') {
            langCode = 'en';
          }

          return langCode.toLowerCase().substr(0, 2);
        })();

        var lang = {
          ru: {
            lang: 'ru',
            foundOneWay: 'Найден билет дешевле',
            foundTwoWay: 'Билеты дешевле',
            view: 'Посмотреть',
            origin: 'Туда:',
            destination: 'Обратно:',
            close: 'Закрыть',

            foundHotel: 'Найдена лучшая цена',
            aroundHotel: 'Рядом есть отель лучше',
            checkIn: 'Дата заезда:',
            checkOut: 'Дата отъезда:',

            inMonth: 'в %month%',
            calLabel: 'Выгодное предложение!'
          },
          en: {
            lang: 'en',
            foundOneWay: 'Found a better price',
            foundTwoWay: 'Better price',
            view: 'Learn more',
            origin: 'Depart:',
            destination: 'Return:',
            close: 'Close',

            foundHotel: 'Found a better price',
            aroundHotel: 'Found a better hotel around',
            checkIn: 'Check-in:',
            checkOut: 'Check-out:',

            inMonth: 'in %month%',
            calLabel: 'Get a better deal!'
          }
        };

        if (langCode === 'uk') {
          langCode = 'ru';
        }

        return lang[langCode] || lang.en;
      };
      tbr.language = getLanguage();

      monoUtils.extend(main, {
        storage: null,
        cache: {},
        profileList: null,
        errorMap: {
          LOW_PRICE_IS_NOT_FOUND: 10,
          REQUEST_ABORTED: 11,
          AIRPORTS_PARSE_ERROR: 20,
          AIRPORTS_BAD_RESPONSE: 21,
          CITIES_PARSE_ERROR: 30,
          CITIES_BAD_RESPONSE: 31,
          CCY_PARSE_ERROR: 40,
          CCY_EMPTY_RESPONSE: 41,
          CCY_NOT_SUPPORT: 42,
          AVIA_R1_PARSE_ERROR: 50,
          AVIA_R1_EMPTY_RESPONSE: 51,
          AVIA_R1_FAIL: 52,
          AVIA_R1_EMPTY_DATA: 53,
          AVIA_R3_PARSE_ERROR: 60,
          AVIA_R3_EMPTY_RESPONSE: 61,
          HOTEL_EMPTY_RESPONSE: 70,
          HOTEL_PARSE_ERROR: 72,
          AVIA_R4_PARSE_ERROR: 80,
          AVIA_R4_EMPTY_RESPONSE: 81,
          AVIA_R4_EMPTY_DATA: 82,
          AVIA_CAL_PARSE_ERROR: 90,
          AVIA_CAL_EMPTY_RESPONSE: 91,
          AVIA_CAL_EMPTY_DATA: 92,
          AVIA_CAL_DATE_PRICE_EMPTY: 93,
          AVIA_CAL_MONTH_PRICE_EMPTY: 94,
          AVIA_R5_PARSE_ERROR: 101,
          AVIA_R5_EMPTY_RESPONSE: 102,
          AVIA_R5_EMPTY_DATA: 103,
          SC_KEY_EMPTY: 104
        },
        /**
         * @param {string} hostname
         * @returns {boolean}
         */
        isAllow: function(hostname) {
          var blackList = main.storage.blackList;

          var blackListItem = null;
          blackList.some(function(item) {
            if (item.hostname === hostname) {
              blackListItem = item;
              return true;
            }
          });

          if (!blackListItem) {
            return true;
          }

          var now = parseInt(Date.now() / 1000);
          if (blackListItem.expire > now) {
            return false;
          }

          var pos = blackList.indexOf(blackListItem);
          blackList.splice(pos, 1);

          main.save();

          return true;
        },
        /**
         * @param {function} cb
         */
        load: function(cb) {
          var _this = this;
          return browser.sendMessage({
            action: 'tbrGetInfo'
          }, function(tbrInfo) {
            if (tbrInfo && typeof tbrInfo === 'object') {
              appInfo = tbrInfo;
            }

            return browser.storage.get('aviaBar', function(storage) {
              main.storage = storage.aviaBar || {};

              if (!Array.isArray(main.storage.blackList)) {
                main.storage.blackList = [];
              }

              return cb();
            });
          });
        },
        run: function() {
          var _this = this;
          return this.load(function() {
            if (!appInfo.id) {
              return;
            }

            if (main.storage.removed) {
              return;
            }

            if (!_this.isAllow(tbr.hostname)) {
              return;
            }

            if (appInfo.newUi) {
              main.bar = testB();
            } else {
              main.bar = testA();
            }

            var template = _this.profileList[tbr.profileName];
            if (!template) {
              tbr.error('Template is not found!', tbr.profileName);
              return;
            }

            var profileDetails = template.call(_this);

            return _this.initProfile(profileDetails);
          });
        },
        /**
         * @param {function} [cb]
         */
        save: function(cb) {
          return browser.storage.set({
            aviaBar: main.storage
          }, cb);
        }
      });
      var getAvia = function(tbr) {
        var main = tbr.main;

        return {
          /**
           * @typedef {Object} AviaInfo
           * @property {string} origin
           * @property {string} destination
           * @property {string} dateStart
           * @property {string} dateEnd
           * @property {string} currency
           * @property {number} price
           *
           * @property {boolean} barRequestData
           */
          /**
           * @param {AviaInfo} pageInfo
           */
          onGetData: function(pageInfo) {
            var _this = this;

            tbr.log('Info', pageInfo);

            if (pageInfo.barRequestData) {
              return;
            }
            pageInfo.barRequestData = true;

            var currentBar = main.bar.current;
            if (currentBar) {
              main.clearInfoObj(pageInfo);
            }

            var onAbort = function(event) {
              var eventName = 'discard';
              if (event === 'betterPrice') {
                eventName = event;
              }
              tbr.emit('track', {
                ec: 'cheapflight',
                ea: eventName,
                el: tbr.hostname,
                t: 'event'
              });

              var index = main.errorMap[event];
              if (index) {
                var label = [index, pageInfo.origin, pageInfo.destination, pageInfo.price, pageInfo.currency, pageInfo.dateStart, pageInfo.dateEnd || ''].join(';');
                tbr.emit('track', {
                  ec: 'cheapflightError',
                  ea: tbr.hostname,
                  el: label,
                  t: 'event'
                });
              }
            };

            tbr.emit('track', {
              ec: 'cheapflight',
              ea: 'requestData',
              el: tbr.hostname,
              cd: 'flightrequestdata',
              t: 'event'
            });

            tbr.emit('track', {
              cd: 'flightrequestdata',
              t: 'screenview'
            });

            main.bar.isAborted = false;
            this.requestData(pageInfo, function(err, data) {
              if (main.bar.isAborted) {
                currentBar && currentBar.close();
                tbr.log('Aborted!');
                onAbort('REQUEST_ABORTED');
                return;
              }

              if (err) {
                currentBar && currentBar.close();
                onAbort(err);
                return;
              }

              var lowerPrice = null;
              var needConverting = !main.currency.isSupportedCcy(pageInfo.currency);
              data.prices.data.forEach(function(item) {
                var value = null;
                if (needConverting) {
                  value = item.converted_value = main.convertCcy(item.value, pageInfo.currency);
                } else {
                  value = item.value;
                }

                if (!value) {
                  return;
                }

                if (lowerPrice === null || lowerPrice > value) {
                  lowerPrice = value;
                }
              });

              if (lowerPrice === null) {
                tbr.error('Low price is not found!', pageInfo.price);
                currentBar && currentBar.close();
                onAbort('LOW_PRICE_IS_NOT_FOUND');
                return;
              }

              tbr.emit('track', {
                ec: 'cheapflight',
                ea: 'responseData',
                el: tbr.hostname,
                cd: 'flightresponsedata',
                t: 'event'
              });

              tbr.emit('track', {
                cd: 'flightresponsedata',
                t: 'screenview'
              });

              main.bar.aviaBarSaveInHistory(pageInfo);

              if (lowerPrice > pageInfo.price) {
                tbr.log('Has lower price!', lowerPrice, pageInfo.price);
                if (!appInfo.debug) {
                  currentBar && currentBar.close();
                  onAbort('betterPrice');
                  return;
                }
              }

              var details = {};
              details.type = 'avia';
              details.prices = data.prices;
              details.pageInfo = pageInfo;

              main.bar.create(details);
            });
          },
          requestAirports: function(cb) {
            tbr.getData({
              url: 'http://api.travelpayouts.com/data/airports.json'
            }, function(responseText) {
              var response = null;
              try {
                response = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('AIRPORTS_PARSE_ERROR');
              }

              if (!Array.isArray(response)) {
                tbr.error('Response is not array!', responseText);
                return cb('AIRPORTS_BAD_RESPONSE');
              }

              response = response.filter(function(item) {
                return item.code && item.city_code;
              });

              cb(null, response);
            });
          },
          loadAirports: function(cb) {
            if (main.cache.airportMap) {
              return cb();
            }

            this.requestAirports(function(err, airportList) {
              if (err) {
                return cb(err);
              }

              var airportMap = main.cache.airportMap = {};
              airportList.forEach(function(item) {
                airportMap[item.code] = item;
              });

              return cb();
            });
          },
          requestCities: function(cb) {
            tbr.getData({
              url: 'http://api.travelpayouts.com/data/cities.json'
            }, function(responseText) {
              var response = null;
              try {
                response = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('CITIES_PARSE_ERROR');
              }

              if (!Array.isArray(response)) {
                tbr.error('Response is not array!', responseText);
                return cb('CITIES_BAD_RESPONSE');
              }

              response = response.filter(function(item) {
                return item.code && item.name;
              });

              cb(null, response);
            });
          },
          requestPrices: function(pageInfo, origCb) {
            var _this = this;
            var trackError = function(event) {
              var index = main.errorMap[event];
              if (index) {
                var label = [index, pageInfo.origin, pageInfo.destination, pageInfo.price, pageInfo.currency, pageInfo.dateStart, pageInfo.dateEnd || ''].join(';');
                tbr.emit('track', {
                  ec: 'cheapflightError',
                  ea: tbr.hostname,
                  el: label,
                  t: 'event'
                });
              }
            };

            var cbTryCal = function(err, data) {
              if (!err) {
                return origCb(err, data);
              }

              setTimeout(function() {
                trackError(err);
              }, 0);

              if (pageInfo.dateEnd) {
                return _this.requestCalPrices(pageInfo, origCb);
              }

              return _this.requestMonthPrices(pageInfo, function(err, data) {
                if (!err) {
                  return origCb(err, data);
                }

                _this.requestCalPrices(pageInfo, origCb);

                trackError(err);
              });
            };

            var cbTrySkyscanner = function(err, data) {
              if (!err) {
                return origCb(err, data);
              }

              setTimeout(function() {
                trackError(err);
              }, 0);

              return _this.requestSkyscannerPrice(pageInfo, cbTryCal);
            };

            if (!pageInfo.dateEnd) {
              return _this.requestPrices3(pageInfo, cbTrySkyscanner);
            }

            return _this.requestPrices1(pageInfo, cbTrySkyscanner);
          },
          requestMonthPrices: function(pageInfo, cb) {
            main.currency.setSupportedCcy('RUB');

            var data = {
              origin_iata: pageInfo.origin,
              destination_iata: pageInfo.destination,
              direct_date: pageInfo.dateStart,
              affiliate: true,
              adults: 1
            };

            tbr.getData({
              url: 'http://min-prices-go.aviasales.ru/month_minimal_price.json?' + monoUtils.param(data)
            }, function(responseText) {
              var data = null;
              try {
                data = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('AVIA_R4_PARSE_ERROR');
              }

              if (!data) {
                tbr.error('Response is empty!', responseText);
                return cb('AVIA_R4_EMPTY_RESPONSE');
              }

              if (!data.direct && !data.not_direct) {
                tbr.error('Eempty data!', data);
                return cb('AVIA_R4_EMPTY_DATA');
              }

              var value = data.direct || data.not_direct;
              if (data.direct && data.not_direct && data.direct > data.not_direct) {
                value = data.not_direct;
              }

              data = {
                origin: pageInfo.origin,
                destination: pageInfo.destination,
                value: value,
                depart_date: pageInfo.dateStart,
                return_date: pageInfo.dateEnd,
                monthPrice: true
              };

              var response = {
                data: [data]
              };

              return cb(null, response);
            });
          },
          requestCalPrices: function(pageInfo, cb) {
            main.currency.setSupportedCcy('RUB');

            var requestData = {
              origin: pageInfo.origin,
              destination: pageInfo.destination,
              depart_date: pageInfo.dateStart,
              one_way: !pageInfo.dateEnd
            };

            var getEndDate = function() {
              var startTime = (new Date(pageInfo.dateStart)).getTime();

              var endDate = startTime + 30 * 24 * 60 * 60 * 1000;

              var now = new Date(endDate);
              var year = now.getUTCFullYear();
              var month = now.getUTCMonth() + 1;
              if (month < 10) {
                month = '0' + month;
              }
              var date = now.getUTCDate();
              if (date < 10) {
                date = '0' + date;
              }

              return [year, month, date].join('-');
            };

            var getMonthPrice = function(priceList, cb) {
              var startDate = pageInfo.dateStart;
              var endDate = getEndDate();

              priceList = priceList.filter(function(item) {
                if (!item.value || !item.depart_date) {
                  return false;
                }

                if (pageInfo.dateEnd) {
                  return item.depart_date >= startDate && item.return_date < endDate;
                } else {
                  return item.depart_date >= startDate && item.depart_date < endDate;
                }
              });

              if (priceList.length === 0) {
                tbr.error('Cal month price is not found!');
                cb('AVIA_CAL_MONTH_PRICE_EMPTY');
                return;
              }

              var value = Math.round(priceList.reduce(function(previousValue, item) {
                return previousValue + item.value;
              }, 0) / priceList.length);

              var obj = {
                origin: pageInfo.origin,
                destination: pageInfo.destination,
                value: value,
                depart_date: pageInfo.dateStart,
                monthPrice: true
              };

              if (pageInfo.dateEnd) {
                obj.return_date = pageInfo.dateEnd;
              }

              return cb(null, {
                data: [obj]
              });
            };

            var getPrices = function(priceList, cb) {
              priceList = priceList.filter(function(item) {
                if (!item.value || !item.depart_date || !item.origin || !item.destination) {
                  return false;
                }

                if (pageInfo.dateEnd) {
                  return item.depart_date === pageInfo.dateStart && item.return_date === pageInfo.dateEnd;
                } else {
                  return item.depart_date === pageInfo.dateStart;
                }
              });

              if (priceList.length === 0) {
                tbr.error('Cal date price is not found!');
                cb('AVIA_CAL_DATE_PRICE_EMPTY');
                return;
              }

              var list = priceList.map(function(item) {
                var obj = {
                  destination: item.destination,
                  origin: item.origin,
                  value: item.value,
                  depart_date: item.depart_date
                };

                if (pageInfo.dateEnd) {
                  obj.return_date = item.return_date
                }

                return obj;
              });

              return cb(null, {
                data: list
              });
            };

            tbr.getData({
              url: 'http://min-prices.aviasales.ru/calendar_preload?' + monoUtils.param(requestData)
            }, function(responseText) {
              var response = null;
              try {
                response = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('AVIA_CAL_PARSE_ERROR');
              }

              if (!response) {
                tbr.error('Response is empty!', responseText);
                return cb('AVIA_CAL_EMPTY_RESPONSE');
              }

              var currentDepartDatePrices = response.current_depart_date_prices || [];
              if (currentDepartDatePrices.length === 0) {
                currentDepartDatePrices = null;
              }

              var priceList = currentDepartDatePrices || response.best_prices || [];
              if (priceList.length === 0) {
                tbr.error('Cal data is empty!', response);
                return cb('AVIA_CAL_EMPTY_DATA');
              }

              return getPrices(currentDepartDatePrices || [], function(err, data) {
                if (!err) {
                  return cb(err, data);
                }

                return getMonthPrice(priceList, function(err, data) {
                  return cb(err, data);
                });
              });
            });
          },
          requestPrices1: function(pageInfo, cb) {
            main.currency.setSupportedCcy(['USD', 'EUR', 'RUB']);

            var data = {
              origin: pageInfo.origin,
              destination: pageInfo.destination,
              currency: pageInfo.currency,
              depart_date: pageInfo.dateStart
            };

            if (pageInfo.dateEnd) {
              data.return_date = pageInfo.dateEnd;
            }

            if (!main.currency.isSupportedCcy(pageInfo.currency)) {
              data.currency = main.currency.defaultCcy;
            }

            data.token = 'd936b4f899d2e26969269dd587f90a67';

            tbr.getData({
              url: 'http://api.travelpayouts.com/v1/prices/cheap?' + monoUtils.param(data)
            }, function(responseText) {
              var response = null;
              try {
                response = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('AVIA_R1_PARSE_ERROR');
              }

              if (!response) {
                tbr.error('Response is empty!', response);
                cb('AVIA_R1_EMPTY_RESPONSE');
                return;
              }

              if (!response.success || !response.data) {
                tbr.error('API is not success!', response);
                cb('AVIA_R1_FAIL');
                return;
              }

              var _list = [];
              for (var cityCode in response.data) {
                var list = response.data[cityCode];
                for (var index in list) {
                  var item = list[index];
                  if (!item.price || !item.departure_at) {
                    continue;
                  }

                  var _item = {};
                  _item.destination = cityCode;
                  _item.origin = pageInfo.origin;
                  _item.value = item.price;
                  _item.depart_date = item.departure_at;
                  if (pageInfo.dateEnd) {
                    _item.return_date = item.return_at;
                  }
                  _list.push(_item);
                }
              }

              if (_list.length === 0) {
                tbr.error('API data is empty!', response);
                cb('AVIA_R1_EMPTY_DATA');
                return;
              }

              response.data = _list;

              cb(null, response);
            });
          },
          requestPrices3: function(pageInfo, cb) {
            main.currency.setSupportedCcy('RUB');

            var data = {
              origin: pageInfo.origin,
              destination: pageInfo.destination,
              depart_date: pageInfo.dateStart
            };

            if (pageInfo.dateEnd) {
              data.return_date = pageInfo.dateEnd;
            }

            tbr.getData({
              url: 'http://min-prices.aviasales.ru/day_price?' + monoUtils.param(data)
            }, function(responseText) {
              var data = null;
              try {
                data = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('AVIA_R3_PARSE_ERROR');
              }

              if (!data || !data.destination || !data.origin || !data.value || !data.depart_date) {
                tbr.error('Response is empty!', responseText);
                return cb('AVIA_R3_EMPTY_RESPONSE');
              }

              var response = {
                data: [data]
              };

              cb(null, response);
            });
          },
          skyscannerMarkets: {
            ru: 'ru',
            en: 'us'
          },
          requestSkyscannerPrice: function(pageInfo, cb) {
            if (!appInfo.skyScannerKey) {
              return cb('SC_KEY_EMPTY');
            }

            main.currency.setSupportedCcy(['USD', 'EUR', 'RUB', 'UAH', 'BYR', 'KZT']);

            var ccy = pageInfo.currency;
            if (!main.currency.isSupportedCcy(pageInfo.currency)) {
              ccy = main.currency.defaultCcy;
            }

            var apiKey = appInfo.skyScannerKey;

            var data = {
              apiKey: apiKey
            };

            var url = 'http://partners.api.skyscanner.net/apiservices/browsequotes/v1.0/{market}/{currency}/{locale}/{originPlace}/{destinationPlace}/{outboundPartialDate}/{inboundPartialDate}?';
            var market = 'us';
            var markets = this.skyscannerMarkets;
            if (markets[tbr.language.lang]) {
              market = markets[tbr.language.lang];
            }

            url = url.replace('{market}', market);
            url = url.replace('{currency}', ccy);
            url = url.replace('{locale}', tbr.language.lang);
            url = url.replace('{originPlace}', pageInfo.origin);
            url = url.replace('{destinationPlace}', pageInfo.destination);
            url = url.replace('{outboundPartialDate}', pageInfo.dateStart);
            url = url.replace('{inboundPartialDate}', pageInfo.dateEnd || '');

            var getReferralUrl = function(originPlace, destinationPlace) {
              var originPlaceId = originPlace.CityId || originPlace.IataCode;
              var destinationPlaceId = destinationPlace.CityId || destinationPlace.IataCode;
              var url = 'http://partners.api.skyscanner.net/apiservices/referral/v1.0/{market}/{currency}/{locale}/{originPlace}/{destinationPlace}/{outboundPartialDate}/{inboundPartialDate}';
              url = url.replace('{market}', market);
              url = url.replace('{currency}', ccy);
              url = url.replace('{locale}', tbr.language.lang);
              url = url.replace('{originPlace}', originPlaceId);
              url = url.replace('{destinationPlace}', destinationPlaceId);
              url = url.replace('{outboundPartialDate}', pageInfo.dateStart);
              url = url.replace('{inboundPartialDate}', pageInfo.dateEnd || '');
              url += '?' + monoUtils.param({
                apiKey: apiKey
              });
              return url;
            };

            /**
             * @typedef {Object} SkyscannerPlaceApi
             * @property {string} CityId
             * @property {string} CityName
             * @property {string} CountryName
             * @property {string} IataCode
             * @property {string} Name
             * @property {number} PlaceId
             * @property {string} SkyscannerCode
             * @property {string} Type
             */
            /**
             * @typedef {Object} SkyscannerQuotesBoundLegApi
             * @property {[number]} CarrierIds
             * @property {string} DepartureDate
             * @property {number} DestinationId
             * @property {number} OriginId
             */
            /**
             * @typedef {Object} SkyscannerQuotesApi
             * @property {SkyscannerQuotesBoundLegApi} OutboundLeg
             * @property {SkyscannerQuotesBoundLegApi} [InboundLeg]
             * @property {boolean} Direct
             * @property {string} QuoteDateTime
             * @property {number} QuoteId
             * @property {number} MinPrice
             */
            /**
             * @param {Object} response
             * @param {[SkyscannerPlaceApi]} response.Places
             * @param {[SkyscannerQuotesApi]} response.Quotes
             * @param {function} cb
             */
            var normalization = function(response, cb) {
              var data = [];

              var getPlaceCode = function(id) {
                var place = null;
                response.Places.some(function(item) {
                  if (item.PlaceId === id) {
                    place = item;
                    return true;
                  }
                });
                return place;
              };

              response.Quotes.forEach(function(item) {
                if (!item.OutboundLeg) {
                  tbr.error('OutboundLeg is not found!');
                  return;
                }

                if (pageInfo.dateEnd && !item.InboundLeg) {
                  return;
                }

                var destinationPlace = getPlaceCode(item.OutboundLeg.DestinationId);
                var originPlace = getPlaceCode(item.OutboundLeg.OriginId);

                var obj = {
                  destination: destinationPlace.IataCode,
                  origin: originPlace.IataCode,
                  value: item.MinPrice,
                  depart_date: item.OutboundLeg.DepartureDate,
                  vendor: 'skyscanner',
                  url: getReferralUrl(originPlace, destinationPlace)
                };

                if (item.InboundLeg) {
                  obj.return_date = item.InboundLeg.DepartureDate;
                }

                if (!obj.destination || !obj.origin) {
                  tbr.error('Place code error!', obj, item);
                  return;
                }

                data.push(obj);
              });

              if (data.length === 0) {
                tbr.error('API data is empty!', response);
                return cb('AVIA_R5_EMPTY_DATA');
              } else {
                return cb(null, {
                  data: data
                });
              }
            };

            return tbr.getData({
              url: url + monoUtils.param(data),
              headers: {
                'X-Forwarded-For': 'application/json'
              }
            }, function(responseText) {
              if (/<Quotes\s+\/>/.test(responseText)) {
                tbr.error('Response is empty XML!', responseText);
                return cb('AVIA_R5_EMPTY_DATA');
              }

              var data = null;
              try {
                data = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('AVIA_R5_PARSE_ERROR');
              }

              if (!data || !Array.isArray(data.Quotes) || !Array.isArray(data.Places)) {
                tbr.error('Response is empty!', responseText);
                return cb('AVIA_R5_EMPTY_RESPONSE');
              }

              return normalization(data, cb);
            });
          },
          /**
           * @typedef {Object} AviaApiPrice
           * @property {string} origin
           * @property {string} destination
           * @property {number} value
           * @property {string} depart_date
           * @property {string} [return_date]
           * @property {boolean} [monthPrice]
           */
          /**
           * @typedef {Object} AviaApi
           * @property {Object} prices
           * @property {AviaApiPrice[]} prices.data
           */
          /**
           * @callback AviaRequestCallback
           * @param {Error} err
           * @param {AviaApi} [data]
           */
          /**
           * @param {AviaInfo} pageInfo
           * @param {AviaRequestCallback} cb
           */
          requestData: function(pageInfo, cb) {
            var _this = this;
            var data = {};

            var async = new monoUtils.AsyncList(function(err) {
              if (err) {
                return cb(err);
              }

              return cb(null, data);
            });

            async.wait();

            this.requestPrices(pageInfo, function(err, prices) {
              if (err) {
                return async.ready(err);
              }

              data.prices = prices;

              if (!main.cache.cityMap) {
                async.wait();
                _this.requestCities(function(err, cityList) {
                  if (err) {
                    return async.ready(err);
                  }

                  var cityMap = main.cache.cityMap = {};
                  cityList.forEach(function(item) {
                    cityMap[item.code] = item;
                  });
                  async.ready();
                });
              }

              if (!main.currency.isSupportedCcy(pageInfo.currency)) {
                async.wait();

                var ccySupport = function() {
                  var ccyList = main.cache.ccyList;
                  if (ccyList[pageInfo.currency.toLowerCase()] === undefined) {
                    tbr.error('Currency is not support!', pageInfo.currency);
                    async.ready('CCY_NOT_SUPPORT');
                    return;
                  }

                  async.ready();
                };

                if (main.cache.ccyList) {
                  setTimeout(function() {
                    return ccySupport();
                  }, 0);
                } else {
                  async.wait();

                  main.currency.requestCcy(function(err, ccyList) {
                    if (err) {
                      async.ready(err);
                      return;
                    }

                    main.cache.ccyList = ccyList;
                    async.ready();

                    return ccySupport();
                  });
                }
              }

              async.wait();
              _this.loadAirports(function(err) {
                if (err) {
                  return async.ready(err);
                }

                async.ready();
              });

              async.ready();
            });
          },
          page: {
            getPrice: function(params, priceParams) {
              var price = null;
              if (priceParams.price) {
                price = priceParams.price;
              } else if (priceParams.minPriceOut && priceParams.minPriceIn) {
                price = priceParams.minPriceOut + priceParams.minPriceIn;
              } else if (priceParams.minPriceOut) {
                price = priceParams.minPriceOut;
              } else if (priceParams.minPriceIn) {
                price = priceParams.minPriceIn;
              }

              return price;
            },
            getData: function(params, priceParams) {
              var checkKeys = ['origin', 'destination', 'dateStart', 'currency', 'price'];

              var data = {
                origin: params.origin,
                destination: params.destination,
                dateStart: params.dateStart,
                dateEnd: params.dateEnd,
                currency: params.currency,
                price: this.getPrice(params, priceParams)
              };

              var r = checkKeys.every(function(key) {
                return !!data[key];
              });

              if (!r) {
                return null;
              }

              return data;
            },
            getPriceId: function(params) {
              var idKeys = ['origin', 'destination', 'dateStart', 'dateEnd', 'currency'];
              var id = [];

              var r = idKeys.every(function(key) {
                var value = params[key];
                id.push(value);
                if (key === 'dateEnd') {
                  return true;
                }
                return !!value;
              });

              if (!r) {
                return null;
              }

              return id.join(';');
            }
          }
        };
      };
      main.avia = getAvia(tbr);
      var getHotel = function(tbr) {
        var main = tbr.main;

        return {
          convertPrice: function(prices, currency) {
            prices.forEach(function(item) {
              item.converted_value = main.convertCcy(item.value, currency);
            });
          },
          getLowPrice: function(prices, isSuggest) {
            isSuggest = !!isSuggest;
            var value = null;
            prices.filter(function(item) {
              return isSuggest === !!item.isSuggest;
            }).forEach(function(item) {
              var _value = item.converted_value || item.value;
              if (value === null || _value < value) {
                value = _value;
              }
            });
            return value;
          },
          /**
           * @typedef {Object} HotelInfo
           * @property {string[]} query
           * @property {string} dateIn
           * @property {string} dateOut
           * @property {string} currency
           * @property {number} adults
           * @property {number} price
           *
           * @property {boolean} barRequestData
           */
          /**
           * @param {HotelInfo} pageInfo
           */
          onGetData: function(pageInfo) {
            var _this = this;

            tbr.log('Info', pageInfo);

            if (pageInfo.barRequestData) {
              return;
            }
            pageInfo.barRequestData = true;

            var currentBar = main.bar.current;
            if (currentBar) {
              main.clearInfoObj(pageInfo);
            }

            var onAbort = function(event) {
              var eventName = 'discard';
              if (event === 'betterPrice') {
                eventName = event;
              }
              tbr.emit('track', {
                ec: 'hotel',
                ea: eventName,
                el: tbr.hostname,
                t: 'event'
              });

              var index = main.errorMap[event];
              if (index) {
                var query = pageInfo.query[0];
                var label = [index, tbr.language.lang, pageInfo.dateIn, pageInfo.dateOut, pageInfo.adults, pageInfo.price, pageInfo.currency, query].join(';');
                tbr.emit('track', {
                  ec: 'hotelError',
                  ea: tbr.hostname,
                  el: label,
                  t: 'event'
                });
              }
            };

            tbr.emit('track', {
              ec: 'hotel',
              ea: 'requestData',
              el: tbr.hostname,
              cd: 'hotelrequestdata',
              t: 'event'
            });

            tbr.emit('track', {
              cd: 'hotelrequestdata',
              t: 'screenview'
            });

            main.bar.isAborted = false;
            this.requestHotelData(pageInfo, function(err, data) {
              if (main.bar.isAborted) {
                currentBar && currentBar.close();
                tbr.log('Aborted!');
                onAbort('REQUEST_ABORTED');
                return;
              }

              if (err) {
                currentBar && currentBar.close();
                onAbort(err);
                return;
              }

              if (!main.currency.isSupportedCcy(pageInfo.currency)) {
                _this.convertPrice(data.prices.data, pageInfo.currency);
              }

              tbr.emit('track', {
                ec: 'hotel',
                ea: 'responseData',
                el: tbr.hostname,
                cd: 'hotelresponsedata',
                t: 'event'
              });

              tbr.emit('track', {
                cd: 'hotelresponsedata',
                t: 'screenview'
              });


              var lowTargetPrice = _this.getLowPrice(data.prices.data);
              var isLowTargetPrice = lowTargetPrice && lowTargetPrice < pageInfo.price;

              var isLowSuggestPrice = false;
              if (!isLowTargetPrice) {
                var lowSuggestPrice = _this.getLowPrice(data.prices.data, true);
                isLowSuggestPrice = lowSuggestPrice && lowSuggestPrice < pageInfo.price;
                if (!isLowSuggestPrice) {
                  var maxSuggestPrice = pageInfo.price + (20 / 100 * pageInfo.price);
                  isLowSuggestPrice = lowSuggestPrice && lowSuggestPrice < maxSuggestPrice;
                }
              }

              if (!isLowTargetPrice && !isLowSuggestPrice) {
                tbr.log('Has low price!', lowTargetPrice, pageInfo.price);
                if (appInfo.debug) {
                  if (!lowTargetPrice) {
                    isLowSuggestPrice = true;
                  }
                } else {
                  currentBar && currentBar.close();
                  onAbort('betterPrice');
                  return;
                }
              }

              var details = {};
              details.type = 'hotel';
              details.showSuggestPrice = isLowSuggestPrice;
              details.prices = data.prices;
              details.pageInfo = pageInfo;

              main.bar.create(details);
            });
          },
          requestHotelPrices: function(pageInfo, cb) {
            var _this = this;
            var index = 0;

            var suggests = [];

            var _cb = function(err, response) {
              if (!err && response.hasTarget) {
                cb(err, response);
              } else {
                index++;

                var hasQuery = pageInfo.query[index];

                if (!err) {
                  suggests.push.apply(suggests, response.data);
                  if (hasQuery) {
                    err = true;
                  }
                }

                if (err && hasQuery) {
                  _this.requestHotelQueryPrices(pageInfo, index, _cb);
                } else {
                  cb(err, {
                    data: suggests
                  });
                }
              }
            };

            return this.requestHotelQueryPrices(pageInfo, index, _cb);
          },
          requestHotelQueryPrices: function(pageInfo, index, cb) {
            main.currency.setSupportedCcy('RUB');

            var data = {
              hotel_name: pageInfo.query[index],
              locale: tbr.language.lang,
              checkIn: pageInfo.dateIn,
              checkOut: pageInfo.dateOut,
              adults: pageInfo.adults
            };

            data.marker = appInfo.id;
            data.host = 'h2.savefrom.net';

            return tbr.getData({
              url: 'https://yasen.hotellook.com/tp/v2/check_hotel_price_by_name.json?' + monoUtils.param(data)
            }, function(responseText) {
              var data = null;
              try {
                /**
                 * @typedef {Object} HotelApiItem
                 * @property {string} name
                 * @property {string} deeplink
                 * @property {string} type
                 * @property {number} price
                 * @property {number} stars
                 * @property {number} rating
                 *
                 * @property {boolean} isSuggest
                 * @property {number} value
                 * @property {number} [converted_value]
                 */
                /**
                 * @type {Object}
                 * @property {HotelApiItem} [target]
                 * @property {[HotelApiItem]} suggests
                 */
                data = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('HOTEL_PARSE_ERROR');
              }

              if (!data) {
                tbr.error('Response is empty!', responseText);
                return cb('HOTEL_EMPTY_RESPONSE');
              }

              /**
               * @type {[HotelApiItem]}
               */
              var prices = [];

              var hasTarget = false;

              if (data.target) {
                hasTarget = true;
                prices.push(data.target);
              }

              data.suggests && data.suggests.forEach(function(suggest) {
                suggest.isSuggest = true;
                prices.push(suggest);
              });

              if (!prices.length) {
                tbr.error('Response is empty!', responseText);
                return cb('HOTEL_EMPTY_RESPONSE');
              }

              prices.forEach(function(item) {
                item.value = item.price;
              });

              return cb(null, {
                hasTarget: hasTarget,
                data: prices
              });
            });
          },
          /**
           * @typedef {Object} HotelApi
           * @property {[HotelApiItem]} prices
           */
          /**
           * @callback HotelRequestCallback
           * @param {Error} err
           * @param {HotelApi} [data]
           */
          /**
           * @param {HotelInfo} pageInfo
           * @param {HotelRequestCallback} cb
           */
          requestHotelData: function(pageInfo, cb) {
            var data = {};
            var async = new monoUtils.AsyncList(function(err) {
              if (err) {
                return cb(err);
              }

              return cb(null, data);
            });

            async.wait();
            return this.requestHotelPrices(pageInfo, function(err, prices) {
              if (err) {
                return async.ready(err);
              }

              data.prices = prices;

              if (!main.currency.isSupportedCcy(pageInfo.currency)) {
                async.wait();
                var ccySupport = function() {
                  var ccyList = main.cache.ccyList;
                  if (ccyList[pageInfo.currency.toLowerCase()] === undefined) {
                    tbr.error('Currency is not support!', pageInfo.currency);
                    async.ready('CCY_NOT_SUPPORT');
                    return;
                  }

                  async.ready();
                };

                if (main.cache.ccyList) {
                  setTimeout(function() {
                    ccySupport();
                  }, 0);
                } else {
                  async.wait();
                  main.currency.requestCcy(function(err, ccyList) {
                    if (err) {
                      async.ready(err);
                      return;
                    }

                    main.cache.ccyList = ccyList;
                    async.ready();

                    ccySupport();
                  });
                }
              }

              async.ready();
            });
          },
          page: {
            getPrice: function(params, priceParams) {
              var price = null;
              if (priceParams.price) {
                price = priceParams.price;
              } else if (priceParams.oneDayPrice && params.dayCount) {
                price = priceParams.oneDayPrice * params.dayCount;
              } else if (priceParams.oneDayPrice && params.dateIn && params.dateOut) {
                var dateIn = new Date(params.dateIn);
                var dateOut = new Date(params.dateOut);
                var dayCount = Math.round((dateOut.getTime() - dateIn.getTime()) / 24 / 60 / 60 / 1000);
                price = priceParams.oneDayPrice * dayCount;
              }

              return price;
            },
            getData: function(params, priceParams) {
              var checkKeys = ['query', 'dateIn', 'dateOut', 'currency', 'adults', 'price'];

              var data = {
                query: params.query,
                dateIn: params.dateIn,
                dateOut: params.dateOut,
                currency: params.currency,
                adults: params.adults,
                price: this.getPrice(params, priceParams)
              };

              var r = checkKeys.every(function(key) {
                return !!data[key];
              });

              if (!r) {
                return null;
              }

              return data;
            },
            getPriceId: function(params) {
              var idKeys = ['dateIn', 'dateOut', 'currency', 'adults'];
              var id = [];

              var r = idKeys.every(function(key) {
                var value = params[key];
                id.push(value);
                return !!value;
              });

              if (!r) {
                return null;
              }

              return id.join(';');
            }
          }
        };
      };
      main.hotel = getHotel(tbr);

      monoUtils.extend(main, {
        currency: {
          defaultCcy: 'RUB',
          supportedCcy: ['USD', 'EUR', 'RUB'],
          setSupportedCcy: function(ccy) {
            if (!Array.isArray(ccy)) {
              ccy = [ccy];
            }
            this.supportedCcy = ccy;
          },
          isSupportedCcy: function(value) {
            return this.supportedCcy.indexOf(value) !== -1;
          },
          requestCcy: function(cb) {
            tbr.getData({
              url: 'http://engine.aviasales.ru/currencies/all_currencies_rates'
            }, function(responseText) {
              var response = null;
              try {
                response = JSON.parse(responseText);
              } catch (e) {
                tbr.error('Parse error!', responseText);
                return cb('CCY_PARSE_ERROR');
              }

              if (!response) {
                tbr.error('Response is empty!', responseText);
                return cb('CCY_EMPTY_RESPONSE');
              }

              cb(null, response);
            });
          }
        }
      });

      var testA = function() {
        var getBarUi = function(tbr) {
          var main = tbr.main;

          return {
            getCloseBtn: function() {
              var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
              var svgNS = svg.namespaceURI;
              svg.setAttribute('width', '19.799');
              svg.setAttribute('height', '19.799');
              svg.setAttribute('viewBox', '0 0 19.7989899 19.7989899');

              var color = '#888161';
              var opacity = '.5';

              var path = document.createElementNS(svgNS, 'path');
              svg.appendChild(path);
              path.setAttribute('d', 'M8.092 9.9L5.146 6.952C4.544 6.35 4.45 5.45 4.95 4.95c.5-.5 1.4-.406 2.003.196L9.9 8.092l2.946-2.946c.61-.61 1.504-.695 2.003-.196.498.5.412 1.394-.197 2.003L11.707 9.9l2.946 2.946c.602.602.695 1.504.196 2.003-.5.498-1.402.405-2.004-.197L9.9 11.707l-2.947 2.946c-.61.61-1.504.695-2.003.196-.5-.5-.413-1.395.196-2.004L8.092 9.9z');
              path.setAttribute('fill', color);
              path.setAttribute('opacity', opacity);
              path.setAttribute('fill-rule', 'evenodd');

              return svg;
            },
            getTwoWayLines: function() {
              var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
              var svgNS = svg.namespaceURI;
              svg.setAttribute('width', '41px');
              svg.setAttribute('height', '24px');
              svg.setAttribute('viewBox', '0 0 41 24');

              var color = '#565656';

              var g = document.createElementNS(svgNS, 'g');
              svg.appendChild(g);
              g.setAttribute('stroke-linecap', 'square');
              g.setAttribute('stroke', color);
              g.setAttribute('stroke-width', '2');
              g.setAttribute('fill', 'none');
              g.setAttribute('fill-rule', 'evenodd');

              var path = document.createElementNS(svgNS, 'path');
              g.appendChild(path);
              path.setAttribute('d', 'M40.33 18H2.24M6 13L.724 18.1 6 23.2');

              path = document.createElementNS(svgNS, 'path');
              g.appendChild(path);
              path.setAttribute('d', 'M.67 5h38.09M35 0l5.276 5.1L35 10.2');

              return svg;
            },
            getOneWayLine: function() {
              var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
              var svgNS = svg.namespaceURI;
              svg.setAttribute('width', '105px');
              svg.setAttribute('height', '11px');
              svg.setAttribute('viewBox', '0 0 105 11');

              var color = '#565656';

              var g = document.createElementNS(svgNS, 'g');
              svg.appendChild(g);
              g.setAttribute('stroke-linecap', 'square');
              g.setAttribute('stroke', color);
              g.setAttribute('stroke-width', '2');
              g.setAttribute('fill', 'none');
              g.setAttribute('fill-rule', 'evenodd');

              var path = document.createElementNS(svgNS, 'path');
              g.appendChild(path);
              path.setAttribute('d', 'M.823 5H102.76M99 0l5.276 5.1L99 10.2');

              return svg;
            },
            getHotelBarItem: function(details) {
              var isSuggest = !!details.showSuggestPrice;
              var mainItem = null;
              details.prices.data.filter(function(item) {
                return isSuggest === !!item.isSuggest;
              }).forEach(function(item) {
                if (mainItem === null || mainItem.value > item.value) {
                  mainItem = item;
                }
              });
              return mainItem;
            },
            prepareHotelItem: function(pageInfo, item) {
              var obj = {
                name: item.name,
                value: item.converted_value || item.value,
                dateIn: pageInfo.dateIn,
                dateOut: pageInfo.dateOut,
                currency: pageInfo.currency,
                link: item.deeplink,
                isSuggest: !!item.isSuggest
              };
              return obj;
            },
            prepareAviaItem: function(pageInfo, item) {
              var obj = {
                origin: item.origin,
                destination: item.destination,
                value: item.converted_value || item.value,
                dateStart: item.depart_date,
                dateEnd: item.return_date,
                currency: pageInfo.currency,
                monthPrice: !!item.monthPrice,
                vendor: item.vendor || 'aviasales',
                url: item.url
              };

              return obj;
            },
            marginPage: function(details, barHeight) {
              var html = document.body.parentNode;
              main.pageStyle = main.pageStyle || {};

              if (barHeight) {
                var bar = details.barEl;
                main.pageStyle.marginTop = html.style.marginTop;
                main.pageStyle.transition = html.style.transition;

                html.style.transition = 'margin-top 0.2s';
                bar.style.transition = 'margin-top 0.2s';

                setTimeout(function() {
                  html.style.marginTop = barHeight + 'px';
                  html.style.setProperty && html.style.setProperty('margin-top', barHeight + 'px', 'important');
                  bar.style.marginTop = 0;
                }, 0);

                setTimeout(function() {
                  html.style.transition = main.pageStyle.transition;
                  bar.style.transition = '';
                }, 250);

                var onShow = main.currentProfile.onShow;
                onShow && onShow(barHeight);
              } else {
                html.style.marginTop = main.pageStyle.marginTop;

                var onHide = main.currentProfile.onHide;
                onHide && onHide();
              }
            },
            onReplace: function(oldDetails, details) {
              window.removeEventListener('resize', oldDetails.onResize);

              if (details.barEl) {
                details.barEl.style.marginTop = 0;
              }

              ['barEl', 'styleEl'].forEach(function(item) {
                var node = oldDetails[item];
                var newNode = details[item];
                var parent;
                if (node && (parent = node.parentNode)) {
                  parent.replaceChild(newNode, node);
                }
              });
            },
            onClose: function(details, byUser) {
              ['barEl', 'styleEl'].forEach(function(item) {
                var node = details[item];
                var parent;
                if (node && (parent = node.parentNode)) {
                  parent.removeChild(node);
                }
              });
              window.removeEventListener('resize', details.onResize);

              main.bar.marginPage(details);

              if (byUser) {
                main.stopObserver();

                var blackList = main.storage.blackList;
                var now = parseInt(Date.now() / 1000);
                blackList.push({
                  hostname: tbr.hostname,
                  expire: now + 5 * 60 * 60
                });

                main.save();
              }
            },
            getStyle: function(details) {
              var barColor = '#fcefb4';
              var defaultColor = '#333333';
              var labelColor = '#005f86';
              var priceColor = '#4b9f00';
              var viewBgColor = '#4b9f00';
              var viewOverBgColor = '#1F9600';
              var closeBtnOverOpacity = '1';

              return monoUtils.create('style', {
                text: monoUtils.style2Text([{
                  selector: '#' + details.rndId,
                  style: monoUtils.extendPos({}, monoUtils.styleReset, {
                    font: 'normal normal 14px Arial, sans-serif',
                    backgroundColor: barColor,
                    width: '100%',
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    marginTop: (-details.barHeight) + 'px',
                    boxShadow: '0 0 1px rgba(0, 0, 0, 0.5)',
                    fontWeight: 'normal',
                    display: 'block',
                    color: defaultColor
                  }),
                  append: {
                    '.sf-cell': {
                      display: 'table-cell',
                      verticalAlign: 'middle',
                      height: details.barHeight + 'px'
                    },
                    '.sf-center': {
                      textAlign: 'center'
                    },
                    '.sf-right': {
                      textAlign: 'right'
                    },
                    '.sf-close-btn': {
                      display: 'inline-block',
                      textDecoration: 'none',
                      width: '22px',
                      height: '22px'
                    },
                    '.sf-close-btn:hover path': {
                      opacity: closeBtnOverOpacity
                    },
                    '.sf-nowrap': {
                      whiteSpace: 'nowrap'
                    },
                    '.sf-label': {
                      color: labelColor
                    },
                    '.sf-point': {
                      fontSize: '18px'
                    },
                    '.sf-place': {
                      fontSize: 'inherit'
                    },
                    '.sf-price': {
                      color: priceColor,
                      fontSize: '26px',
                      fontWeight: 'bold'
                    },
                    '.sf-view-btn': {
                      fontSize: '14px',
                      backgroundColor: viewBgColor,
                      padding: '7px 18px',
                      color: '#fff',
                      display: 'inline-block',
                      borderRadius: '4px',
                      height: '32px',
                      boxSizing: 'border-box',
                      textDecoration: 'none',
                      whiteSpace: 'nowrap'
                    },
                    '.sf-view-btn:hover': {
                      backgroundColor: viewOverBgColor
                    }
                  }
                }])
              });
            },
            getFontSizeSandbox: function() {
              var sandbox = monoUtils.create('div', {
                style: monoUtils.extendPos({}, monoUtils.styleReset, {
                  font: 'normal normal 12px Arial, sans-serif',
                  position: 'absolute',
                  opacity: 0,
                  top: 0,
                  left: 0
                })
              });

              document.body.appendChild(sandbox);

              return {
                getNodeSize: function(node, cb) {
                  sandbox.appendChild(node);
                  return setTimeout(function() {
                    var clientWidth = window.getComputedStyle(node, null).getPropertyValue("width");
                    clientWidth = Math.ceil(parseFloat(clientWidth));
                    return cb(clientWidth);
                  }, 0);
                },
                remove: function() {
                  sandbox.parentNode.removeChild(sandbox);
                }
              }
            },
            calcBlockSize: function(blocks, cb) {
              var _this = this;
              var defaultStyle = {
                display: 'inline-block',
                whiteSpace: 'nowrap'
              };

              var sandbox = null;

              var ready = 0;
              var wait = 0;

              var onReady = function() {
                ready++;
                if (wait !== ready) {
                  return;
                }
                sandbox && sandbox.remove();

                Object.keys(blocks).forEach(function(key) {
                  var block = blocks[key];

                  var width = null;
                  if (!block.fontSizeWidth) {
                    width = block.width;
                  } else {
                    block.widthList = [];
                    var maxWidth = 999999;
                    var keys = Object.keys(block.fontSizeWidth);
                    keys.reverse().forEach(function(fontSize) {
                      var minWidth = (block.fontSizeWidth[fontSize] || block.width.default) + (block.width.plus || 0);
                      var obj = {
                        fontSize: parseFloat(fontSize),
                        minWidth: minWidth,
                        maxWidth: maxWidth
                      };
                      maxWidth = minWidth;
                      block.widthList.push(obj);
                    });
                    delete block.fontSizeWidth;
                    width = block.widthList[0].minWidth;
                    block.widthList.slice(-1)[0].minWidth = 0;
                    if (block.widthList.length === 1) {
                      block.width = width;
                      delete block.widthList;
                    }
                  }

                  block.node.style.width = width + 'px';
                });

                return cb();
              };

              wait++;
              Object.keys(blocks).forEach(function(key) {
                var block = blocks[key];
                if (!block.width || !block.width.strings) {
                  return;
                }

                if (!sandbox) {
                  sandbox = _this.getFontSizeSandbox();
                }

                if (!Array.isArray(block.width.fontSize)) {
                  block.width.fontSize = [block.width.fontSize];
                }

                block.fontSizeWidth = {};
                block.width.strings.forEach(function(text) {
                  block.width.fontSize.forEach(function(fontSize) {
                    wait++;
                    return sandbox.getNodeSize(monoUtils.create('span', {
                      text: text,
                      style: monoUtils.extend({}, defaultStyle, {
                        fontSize: fontSize + 'px'
                      }, block.width.fontStyle)
                    }), function(size) {
                      var cSize = block.fontSizeWidth[fontSize];
                      if (cSize === undefined || cSize < size) {
                        block.fontSizeWidth[fontSize] = size;
                      }
                      return onReady();
                    });
                  });
                });
              });

              onReady();
            },
            /**
             *
             * @param {{origin: String, destination: String, currency: String, price: Number, dateStart: String, dateEnd: String}} pageInfo
             */
            aviaBarSaveInHistory: function(pageInfo) {
              var originCity = main.getCityName(pageInfo.origin);
              var destinationCity = main.getCityName(pageInfo.destination);
              if (!originCity || !destinationCity) {
                return;
              }

              var data = {
                originCity: originCity,
                destinationCity: destinationCity,
                origin: pageInfo.origin,
                destination: pageInfo.destination,
                dateStart: pageInfo.dateStart,
                dateEnd: pageInfo.dateEnd,
                time: parseInt(Date.now() / 1000)
              };

              return tbr.emit('history', data);
            },
            aviaBarCreate: function(details, oldBar) {
              var prices = details.prices;
              var pageInfo = details.pageInfo;

              var mainItemIndex = main.getAviaBarItemIndex(prices.data);
              if (mainItemIndex === -1) {
                tbr.error('Bar item is not found!', details);
                return;
              }

              var isOneWay = !pageInfo.dateEnd;

              var mainItem = main.bar.prepareAviaItem(pageInfo, prices.data[mainItemIndex]);
              var isCalendar = !!mainItem.monthPrice;

              var trackByVendor = function(data) {
                var map = {
                  aviasales: 'as',
                  skyscanner: 'sc'
                };

                var prefix = map[mainItem.vendor];
                if (prefix) {
                  data.ec += '-' + prefix;
                  return tbr.emit('track', data);
                } else {
                  return tbr.error('Prefix is not found!', mainItem.vendor);
                }
              };

              var barUrl = null;
              if (mainItem.url) {
                barUrl = mainItem.url;
              } else {
                barUrl = 'http://hydra.aviasales.ru/searches/new' + '?' + monoUtils.param({
                  origin_iata: pageInfo.origin,
                  destination_iata: pageInfo.destination,
                  adults: 1,
                  children: 0,
                  infants: 0,
                  trip_class: 0,
                  depart_date: pageInfo.dateStart,
                  return_date: pageInfo.dateEnd,
                  marker: appInfo.id,
                  with_request: true
                });
              }

              var priceObj = main.getPrice(mainItem.currency, mainItem.value);

              var strings = {
                price: priceObj.string,
                pointA: main.getCityName(mainItem.origin),
                pointB: main.getCityName(mainItem.destination),
                view: tbr.language.view
              };

              if (!strings.pointA || !strings.pointB) {
                tbr.error('City name is not defined!', mainItem);
                return;
              }

              var blocks = {};

              blocks.closeBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell', 'sf-center'],
                  style: {
                    cursor: 'default'
                  }
                }),
                closeBtn: monoUtils.create('a', {
                  class: 'sf-close-btn',
                  href: '#close',
                  title: tbr.language.close,
                  append: [
                    main.bar.getCloseBtn()
                  ],
                  on: ['click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    details.close(1);

                    tbr.emit('track', {
                      ec: 'cheapflight',
                      ea: 'close',
                      el: tbr.hostname,
                      t: 'event'
                    });

                    trackByVendor({
                      ec: 'cheapflight',
                      ea: 'close',
                      el: tbr.hostname,
                      t: 'event'
                    });
                  }]
                }),
                width: 36,
                leftFixed: 1
              };
              blocks.closeBlock.node.appendChild(blocks.closeBlock.closeBtn);

              blocks.leftResizeBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell']
                }),
                width: 0
              };

              if (isCalendar) {
                strings.calLabel = tbr.language.calLabel;

                blocks.calLabel = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell', 'sf-label'],
                    text: strings.calLabel
                  }),
                  width: {
                    strings: [
                      strings.calLabel
                    ],
                    fontSize: 14,
                    default: 200
                  },
                  leftFixed: 1
                };
              } else if (isOneWay) {
                strings.foundOneWay = tbr.language.foundOneWay + ':';
                strings.dateStart = main.getDate(mainItem.dateStart);

                blocks.dateBlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell'],
                    append: [
                      monoUtils.create('div', {
                        class: ['sf-label'],
                        text: strings.foundOneWay
                      }),
                      monoUtils.create('div', {
                        class: ['sf-date'],
                        text: strings.dateStart
                      })
                    ]
                  }),
                  width: {
                    strings: [
                      strings.foundOneWay,
                      strings.dateStart
                    ],
                    fontSize: 14,
                    default: 200
                  },
                  leftFixed: 1
                };
              } else {
                strings.foundTwoWay = tbr.language.foundTwoWay + ':';

                blocks.dateFoundBlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell', 'sf-label', 'sf-right'],
                    text: strings.foundTwoWay
                  }),
                  width: {
                    strings: [
                      strings.foundTwoWay
                    ],
                    fontSize: 14,
                    default: 120
                  },
                  leftFixed: 1
                };

                strings.origin = tbr.language.origin + String.fromCharCode(160);
                strings.destination = tbr.language.destination + String.fromCharCode(160);

                blocks.dateLabesBlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell'],
                    append: [
                      monoUtils.create('div', {
                        class: ['sf-right'],
                        text: strings.origin
                      }),
                      monoUtils.create('div', {
                        class: ['sf-right'],
                        text: strings.destination
                      })
                    ]
                  }),
                  width: {
                    strings: [
                      strings.origin,
                      strings.destination
                    ],
                    fontSize: 14,
                    plus: 10,
                    default: 80
                  },
                  leftFixed: 1
                };

                strings.dateStart = main.getDate(mainItem.dateStart);
                strings.dateEnd = main.getDate(mainItem.dateEnd);

                blocks.dateBlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell'],
                    append: [
                      monoUtils.create('div', {
                        class: ['sf-nowrap'],
                        text: strings.dateStart
                      }),
                      monoUtils.create('div', {
                        class: ['sf-nowrap'],
                        text: strings.dateEnd
                      })
                    ]
                  }),
                  width: {
                    strings: [
                      strings.dateStart,
                      strings.dateEnd
                    ],
                    fontSize: 14,
                    default: 100
                  },
                  leftFixed: 1
                };
              }

              if (isCalendar) {
                strings.calMonth = main.getCalMonth(mainItem.dateStart);
                strings.calMonth = tbr.language.inMonth.replace('%month%', strings.calMonth);

                var inlineArrow = null;
                var plusWidth = 0;
                if (isOneWay) {
                  inlineArrow = main.bar.getOneWayLine();
                  plusWidth = 140;
                } else {
                  inlineArrow = main.bar.getTwoWayLines();
                  plusWidth = 75;
                }
                inlineArrow.style.display = 'block';

                blocks.calendarCanterBlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell', 'sf-center', 'sf-point'],
                    append: [
                      monoUtils.create('div', {
                        class: ['sf-place'],
                        append: [
                          strings.pointA,
                          ' ',
                          monoUtils.create('div', {
                            style: {
                              display: 'inline-block',
                              verticalAlign: 'middle'
                            },
                            append: inlineArrow
                          }),
                          ' ',
                          strings.pointB,
                          ' ',
                          strings.calMonth
                        ]
                      })
                    ]
                  }),
                  width: {
                    strings: [
                      strings.pointA + ' ' + strings.pointB + ' ' + strings.calMonth
                    ],
                    fontSize: [26, 22, 18],
                    plus: plusWidth
                  }
                };
              } else {
                blocks.pointABlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell', 'sf-right', 'sf-point'],
                    append: [
                      monoUtils.create('div', {
                        class: ['sf-place', 'sf-right'],
                        text: strings.pointA
                      })
                    ]
                  }),
                  width: {
                    strings: [
                      strings.pointA
                    ],
                    fontSize: [26, 22, 18]
                  }
                };

                if (isOneWay) {
                  blocks.arrowBlock = {
                    node: monoUtils.create('div', {
                      class: ['sf-cell', 'sf-center'],
                      append: [
                        main.bar.getOneWayLine()
                      ]
                    }),
                    width: 140
                  };
                } else {
                  blocks.arrowBlock = {
                    node: monoUtils.create('div', {
                      class: ['sf-cell', 'sf-center'],
                      append: [
                        main.bar.getTwoWayLines()
                      ]
                    }),
                    width: 75
                  };
                }

                blocks.pointBBlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell', 'sf-point'],
                    append: [
                      monoUtils.create('div', {
                        class: ['sf-place'],
                        text: strings.pointB
                      })
                    ]
                  }),
                  width: {
                    strings: [
                      strings.pointB
                    ],
                    fontSize: [26, 22, 18]
                  }
                };
              }

              blocks.priceBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell', 'sf-price', 'sf-center', 'sf-nowrap'],
                  append: main.getPriceNode(priceObj)
                }),
                width: {
                  strings: [
                    strings.price
                  ],
                  fontSize: 26,
                  fontStyle: {
                    fontWeight: 'bold'
                  },
                  default: 120
                },
                rightFixed: 1
              };

              var viewLink = null;
              blocks.viewBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell', 'sf-center'],
                  append: [
                    viewLink = monoUtils.create('a', {
                      class: 'sf-view-btn',
                      href: barUrl,
                      target: '_blank',
                      text: strings.view,
                      on: ['click', function(e) {
                        e.stopPropagation();

                        tbr.emit('track', {
                          cd: 'flightclick',
                          t: 'screenview'
                        });

                        tbr.emit('track', {
                          ec: 'cheapflight',
                          ea: 'click',
                          el: tbr.hostname,
                          cd: 'flightclick',
                          t: 'event'
                        });

                        if (!isCalendar) {
                          tbr.emit('track', {
                            cd: 'flight_betterprice_click',
                            t: 'screenview'
                          });

                          tbr.emit('track', {
                            ec: 'cheapflight',
                            ea: 'betterpriceclick',
                            el: tbr.hostname,
                            cd: 'flight_betterprice_click',
                            t: 'event'
                          });

                          trackByVendor({
                            ec: 'cheapflight',
                            ea: 'betterpriceclick',
                            el: tbr.hostname,
                            cd: 'flight_betterprice_click',
                            t: 'event'
                          });
                        } else {
                          tbr.emit('track', {
                            cd: 'flight_calendar_click',
                            t: 'screenview'
                          });

                          tbr.emit('track', {
                            ec: 'cheapflight',
                            ea: 'calendarclick',
                            el: tbr.hostname,
                            cd: 'flight_calendar_click',
                            t: 'event'
                          });
                        }
                      }]
                    })
                  ]
                }),
                width: 130,
                rightFixed: 1
              };

              blocks.rightResizeBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell']
                }),
                width: 0
              };

              var leftFixedBlocks = [];
              var rightFixedBlocks = [];

              var rndId = 's' + Math.random().toString(36).substring(7);
              var bar = details.barEl = monoUtils.create('div', {
                id: rndId,
                style: {
                  top: '-1px !important',
                  display: 'table !important',
                  opacity: '1 !important',
                  zIndex: 99999999,
                  cursor: 'pointer'
                },
                append: (function() {
                  var blockList = [];
                  for (var key in blocks) {
                    var block = blocks[key];
                    if (block.leftFixed) {
                      leftFixedBlocks.push(key);
                    }
                    if (block.rightFixed) {
                      rightFixedBlocks.push(key);
                    }
                    blockList.push(block.node);
                  }
                  return blockList;
                })(),
                on: ['click', function(e) {
                  e.stopPropagation();
                  e.preventDefault();

                  viewLink.dispatchEvent(new CustomEvent('click'));
                }]
              });

              var currentFontSizeObj = {};
              if (isCalendar) {
                details.onBlocksResize = function(width, leftBlocksSize, rightBlockSize) {
                  var type = 'calendarCanterBlock';
                  var blockWidth = parseInt(width - leftBlocksSize - rightBlockSize);

                  var needResize = false;
                  (function() {
                    var currentFontSize = currentFontSizeObj[type];
                    if (currentFontSize) {
                      if (blockWidth >= currentFontSize.minWidth && blockWidth < currentFontSize.maxWidth) {
                        return;
                      }
                    }

                    needResize = true;

                    var found = blocks[type].widthList.some(function(item) {
                      if (blockWidth >= item.minWidth && blockWidth < item.maxWidth) {
                        currentFontSizeObj[type] = item;
                        return true;
                      }
                    });

                    if (!found) {
                      currentFontSizeObj[type] = blocks[type].widthList.slice(-1)[0];
                    }
                  })();

                  if (needResize) {
                    var fontSize = currentFontSizeObj[type].fontSize;
                    blocks[type].node.style.fontSize = fontSize + 'px';
                  }

                  blocks[type].node.style.width = blockWidth + 'px';
                };
              } else {
                details.onBlocksResize = function(width, leftBlocksSize, rightBlockSize) {
                  var arrowBlockWidth = width / 2 - blocks.arrowBlock.width / 2;

                  var blockWidthObj = {
                    pointABlock: parseInt(arrowBlockWidth - leftBlocksSize),
                    pointBBlock: parseInt(arrowBlockWidth - rightBlockSize)
                  };

                  var needResize = false;
                  ['pointABlock', 'pointBBlock'].forEach(function(type) {
                    var blockWidth = blockWidthObj[type];

                    var currentFontSize = currentFontSizeObj[type];
                    if (currentFontSize) {
                      if (blockWidth >= currentFontSize.minWidth && blockWidth < currentFontSize.maxWidth) {
                        return;
                      }
                    }

                    needResize = true;

                    var found = blocks[type].widthList.some(function(item) {
                      if (blockWidth >= item.minWidth && blockWidth < item.maxWidth) {
                        currentFontSizeObj[type] = item;
                        return true;
                      }
                    });

                    if (!found) {
                      currentFontSizeObj[type] = blocks[type].widthList.slice(-1)[0];
                    }
                  });

                  if (needResize) {
                    var fontSize = Math.min(currentFontSizeObj.pointABlock.fontSize, currentFontSizeObj.pointBBlock.fontSize);
                    blocks.pointABlock.node.style.fontSize = fontSize + 'px';
                    blocks.pointBBlock.node.style.fontSize = fontSize + 'px';
                  }

                  blocks.pointABlock.node.style.width = blockWidthObj.pointABlock + 'px';
                  blocks.pointBBlock.node.style.width = blockWidthObj.pointBBlock + 'px';
                };
              }

              var barHeight = 46;
              return main.bar.calcBlockSize(blocks, function() {
                var style = details.styleEl = main.bar.getStyle({
                  rndId: rndId,
                  barHeight: barHeight
                });

                var leftBlocksSize = 0;
                leftFixedBlocks.forEach(function(key) {
                  leftBlocksSize += blocks[key].width;
                });

                var rightBlockSize = 0;
                rightFixedBlocks.forEach(function(key) {
                  rightBlockSize += blocks[key].width;
                });

                var lastBarWidth = 0;
                var currentWidthFix = 0;
                var barMaxWidth = 1200;

                var updateBarWidth = function() {
                  var width = document.documentElement.clientWidth;

                  var sizeFix = width - barMaxWidth;
                  if (sizeFix > 0) {
                    width = barMaxWidth;

                    var fixWidth = Math.floor(sizeFix / 2);
                    if (fixWidth !== currentWidthFix) {
                      currentWidthFix = fixWidth;
                      blocks.leftResizeBlock.node.style.width = fixWidth + 'px';
                      blocks.rightResizeBlock.node.style.width = fixWidth + 'px';
                    }
                  } else if (currentWidthFix !== 0) {
                    currentWidthFix = 0;
                    blocks.leftResizeBlock.node.style.width = 0;
                    blocks.rightResizeBlock.node.style.width = 0;
                  }

                  if (lastBarWidth === width) {
                    return;
                  }
                  lastBarWidth = width;

                  return details.onBlocksResize(width, leftBlocksSize, rightBlockSize);
                };

                details.onResize = updateBarWidth;
                window.addEventListener('resize', details.onResize);

                if (oldBar) {
                  oldBar.replace(details);
                  updateBarWidth();

                  tbr.emit('track', {
                    ec: 'cheapflight',
                    ea: 'update',
                    el: tbr.hostname,
                    t: 'event'
                  });

                  if (!isCalendar) {
                    trackByVendor({
                      ec: 'cheapflight',
                      ea: 'update',
                      el: tbr.hostname,
                      t: 'event'
                    });

                    tbr.emit('track', {
                      cd: 'flight_betterprice_update',
                      t: 'screenview'
                    });
                  } else {
                    tbr.emit('track', {
                      cd: 'flight_calendar_update',
                      t: 'screenview'
                    });
                  }
                } else {
                  main.bar.rndClassName(bar, style);
                  var ctr = monoUtils.create(document.createDocumentFragment(), {
                    append: [bar, style]
                  });

                  document.body.appendChild(ctr);

                  setTimeout(function() {
                    updateBarWidth();
                    main.bar.marginPage(details, barHeight);
                  }, 0);

                  tbr.emit('track', {
                    cd: 'flightshow',
                    t: 'screenview'
                  });

                  tbr.emit('track', {
                    ec: 'cheapflight',
                    ea: 'show',
                    el: tbr.hostname,
                    cd: 'flightshow',
                    t: 'event'
                  });

                  if (!isCalendar) {
                    trackByVendor({
                      ec: 'cheapflight',
                      ea: 'show',
                      el: tbr.hostname,
                      cd: 'flightshow',
                      t: 'event'
                    });

                    tbr.emit('track', {
                      cd: 'flight_betterprice_show',
                      t: 'screenview'
                    });
                  } else {
                    tbr.emit('track', {
                      cd: 'flight_calendar_show',
                      t: 'screenview'
                    });
                  }
                }

                if (isCalendar) {
                  tbr.emit('track', {
                    ec: 'cheapflight',
                    ea: 'calendarPrice',
                    el: tbr.hostname,
                    t: 'event'
                  });
                }
              });
            },
            hotelBarCreate: function(details, oldBar) {
              var pageInfo = details.pageInfo;

              var mainItem = main.bar.prepareHotelItem(pageInfo, main.bar.getHotelBarItem(details));
              var isSuggest = !!mainItem.isSuggest;

              var priceObj = main.getPrice(mainItem.currency, mainItem.value);

              var strings = {
                foundHotel: tbr.language.foundHotel + ':' + String.fromCharCode(160),
                aroundHotel: tbr.language.aroundHotel + ':' + String.fromCharCode(160),
                name: mainItem.name,
                checkIn: tbr.language.checkIn + String.fromCharCode(160),
                checkOut: tbr.language.checkOut + String.fromCharCode(160),
                dateIn: main.getDate(mainItem.dateIn),
                dateOut: main.getDate(mainItem.dateOut),
                price: priceObj.string
              };

              var blocks = {};
              blocks.closeBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell', 'sf-center'],
                  style: {
                    cursor: 'default'
                  }
                }),
                closeBtn: monoUtils.create('a', {
                  class: 'sf-close-btn',
                  href: '#close',
                  title: tbr.language.close,
                  append: [
                    main.bar.getCloseBtn()
                  ],
                  on: ['click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    details.close(1);

                    tbr.emit('track', {
                      ec: 'hotel',
                      ea: 'close',
                      el: tbr.hostname,
                      t: 'event'
                    });
                  }]
                }),
                width: 36,
                leftFixed: 1
              };
              blocks.closeBlock.node.appendChild(blocks.closeBlock.closeBtn);

              blocks.leftResizeBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell']
                }),
                width: 0
              };

              if (isSuggest) {
                blocks.dateFoundBlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell', 'sf-label', 'sf-right'],
                    text: strings.aroundHotel
                  }),
                  width: {
                    strings: [
                      strings.aroundHotel
                    ],
                    fontSize: 14,
                    default: 190
                  },
                  leftFixed: 1
                };
              } else {
                blocks.dateFoundBlock = {
                  node: monoUtils.create('div', {
                    class: ['sf-cell', 'sf-label', 'sf-right'],
                    text: strings.foundHotel
                  }),
                  width: {
                    strings: [
                      strings.foundHotel
                    ],
                    fontSize: 14,
                    default: 160
                  },
                  leftFixed: 1
                };
              }

              blocks.pointABlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell', 'sf-point'],
                  append: [
                    monoUtils.create('div', {
                      class: ['sf-place'],
                      text: strings.name
                    })
                  ]
                }),
                width: {
                  strings: [
                    strings.name
                  ],
                  fontSize: [26, 22, 18]
                }
              };

              blocks.dateLabesBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell'],
                  append: [
                    monoUtils.create('div', {
                      class: ['sf-right'],
                      text: strings.checkIn
                    }),
                    monoUtils.create('div', {
                      class: ['sf-right'],
                      text: strings.checkOut
                    })
                  ]
                }),
                width: {
                  strings: [
                    strings.checkIn,
                    strings.checkOut
                  ],
                  fontSize: 14,
                  default: 95
                },
                rightFixed: 1
              };

              blocks.dateBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell'],
                  append: [
                    monoUtils.create('div', {
                      class: ['sf-nowrap'],
                      text: strings.dateIn
                    }),
                    monoUtils.create('div', {
                      class: ['sf-nowrap'],
                      text: strings.dateOut
                    })
                  ]
                }),
                width: {
                  strings: [
                    strings.dateIn,
                    strings.dateOut
                  ],
                  fontSize: 14,
                  default: 100
                },
                rightFixed: 1
              };

              blocks.priceBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell', 'sf-price', 'sf-center', 'sf-nowrap'],
                  append: main.getPriceNode(priceObj)
                }),
                width: {
                  strings: [
                    strings.price
                  ],
                  fontSize: 26,
                  fontStyle: {
                    fontWeight: 'bold'
                  },
                  plus: 30,
                  default: 120
                },
                rightFixed: 1
              };

              var viewLink = null;
              blocks.viewBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell', 'sf-center'],
                  append: [
                    viewLink = monoUtils.create('a', {
                      class: 'sf-view-btn',
                      href: mainItem.link,
                      target: '_blank',
                      text: tbr.language.view,
                      on: ['click', function(e) {
                        e.stopPropagation();

                        tbr.emit('track', {
                          cd: 'hotelclick',
                          t: 'screenview'
                        });

                        tbr.emit('track', {
                          ec: 'hotel',
                          ea: 'click',
                          el: tbr.hostname,
                          cd: 'hotelclick',
                          t: 'event'
                        });

                        if (isSuggest) {
                          tbr.emit('track', {
                            cd: 'hotelNearbyClick',
                            t: 'screenview'
                          });

                          tbr.emit('track', {
                            ec: 'hotel',
                            ea: 'nearbyClick',
                            el: tbr.hostname,
                            cd: 'hotelNearbyClick',
                            t: 'event'
                          });
                        }
                      }]
                    })
                  ]
                }),
                width: 130,
                rightFixed: 1
              };

              blocks.rightResizeBlock = {
                node: monoUtils.create('div', {
                  class: ['sf-cell']
                }),
                width: 0
              };

              var leftFixedBlocks = [];
              var rightFixedBlocks = [];

              var rndId = 's' + Math.random().toString(36).substring(7);
              var bar = details.barEl = monoUtils.create('div', {
                id: rndId,
                style: {
                  top: '-1px !important',
                  display: 'table !important',
                  opacity: '1 !important',
                  zIndex: 99999999,
                  cursor: 'pointer'
                },
                append: (function() {
                  var blockList = [];
                  for (var key in blocks) {
                    var block = blocks[key];
                    if (block.leftFixed) {
                      leftFixedBlocks.push(key);
                    }
                    if (block.rightFixed) {
                      rightFixedBlocks.push(key);
                    }
                    blockList.push(block.node);
                  }
                  return blockList;
                })(),
                on: ['click', function(e) {
                  e.stopPropagation();
                  e.preventDefault();

                  viewLink.dispatchEvent(new CustomEvent('click'));
                }]
              });

              var currentFontSizeObj = {};
              details.onBlocksResize = function(width, leftBlocksSize, rightBlockSize) {
                var type = 'pointABlock';
                var blockWidth = parseInt(width - leftBlocksSize - rightBlockSize);

                var needResize = false;
                (function() {
                  var currentFontSize = currentFontSizeObj[type];
                  if (currentFontSize) {
                    if (blockWidth >= currentFontSize.minWidth && blockWidth < currentFontSize.maxWidth) {
                      return;
                    }
                  }

                  needResize = true;

                  var found = blocks[type].widthList.some(function(item) {
                    if (blockWidth >= item.minWidth && blockWidth < item.maxWidth) {
                      currentFontSizeObj[type] = item;
                      return true;
                    }
                  });

                  if (!found) {
                    currentFontSizeObj[type] = blocks[type].widthList.slice(-1)[0];
                  }
                })();

                if (needResize) {
                  var fontSize = currentFontSizeObj[type].fontSize;
                  blocks[type].node.style.fontSize = fontSize + 'px';
                }

                blocks[type].node.style.width = blockWidth + 'px';
              };

              var barHeight = 46;
              main.bar.calcBlockSize(blocks, function() {
                var style = details.styleEl = main.bar.getStyle({
                  rndId: rndId,
                  barHeight: barHeight
                });

                var leftBlocksSize = 0;
                leftFixedBlocks.forEach(function(key) {
                  leftBlocksSize += blocks[key].width;
                });

                var rightBlockSize = 0;
                rightFixedBlocks.forEach(function(key) {
                  rightBlockSize += blocks[key].width;
                });

                var lastBarWidth = 0;
                var currentWidthFix = 0;
                var barMaxWidth = 1200;

                var updateBarWidth = function() {
                  var width = document.documentElement.clientWidth;

                  var sizeFix = width - barMaxWidth;
                  if (sizeFix > 0) {
                    width = barMaxWidth;

                    var fixWidth = Math.floor(sizeFix / 2);
                    if (fixWidth !== currentWidthFix) {
                      currentWidthFix = fixWidth;
                      blocks.leftResizeBlock.node.style.width = fixWidth + 'px';
                      blocks.rightResizeBlock.node.style.width = fixWidth + 'px';
                    }
                  } else if (currentWidthFix !== 0) {
                    currentWidthFix = 0;
                    blocks.leftResizeBlock.node.style.width = 0;
                    blocks.rightResizeBlock.node.style.width = 0;
                  }

                  if (lastBarWidth === width) {
                    return;
                  }
                  lastBarWidth = width;

                  return details.onBlocksResize(width, leftBlocksSize, rightBlockSize);
                };

                details.onResize = updateBarWidth;
                window.addEventListener('resize', details.onResize);

                if (oldBar) {
                  oldBar.replace(details);
                  updateBarWidth();

                  tbr.emit('track', {
                    ec: 'hotel',
                    ea: 'update',
                    el: tbr.hostname,
                    t: 'event'
                  });

                  if (isSuggest) {
                    tbr.emit('track', {
                      cd: 'hotelNearbyUpdate',
                      t: 'screenview'
                    });

                    tbr.emit('track', {
                      ec: 'hotel',
                      ea: 'nearbyUpdate',
                      el: tbr.hostname,
                      cd: 'hotelNearbyUpdate',
                      t: 'event'
                    });
                  }
                } else {
                  main.bar.rndClassName(bar, style);
                  var ctr = monoUtils.create(document.createDocumentFragment(), {
                    append: [bar, style]
                  });

                  document.body.appendChild(ctr);

                  setTimeout(function() {
                    updateBarWidth();
                    main.bar.marginPage(details, barHeight);
                  }, 0);

                  tbr.emit('track', {
                    cd: 'hotelshow',
                    t: 'screenview'
                  });

                  tbr.emit('track', {
                    ec: 'hotel',
                    ea: 'show',
                    el: tbr.hostname,
                    cd: 'hotelshow',
                    t: 'event'
                  });

                  if (isSuggest) {
                    tbr.emit('track', {
                      cd: 'hotelNearbyShow',
                      t: 'screenview'
                    });

                    tbr.emit('track', {
                      ec: 'hotel',
                      ea: 'nearbyShow',
                      el: tbr.hostname,
                      cd: 'hotelNearbyShow',
                      t: 'event'
                    });
                  }
                }
              });
            },
            create: function(details) {
              var oldBar = main.bar.current;
              if (oldBar && oldBar.isClosed) {
                oldBar = null;
              }

              main.bar.current = details;

              details.isClosed = false;
              details.close = function(byUser) {
                if (details.isClosed) {
                  return;
                }
                details.isClosed = true;

                main.bar.onClose(details, byUser);
              };

              details.replace = function(newDetails) {
                main.bar.onReplace(details, newDetails);
              };

              if (details.type === 'hotel') {
                main.bar.hotelBarCreate(details, oldBar);
              } else {
                main.bar.aviaBarCreate(details, oldBar);
              }
            },
            rndClassName: function(bar, style) {
              var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
              var dDbl = {};

              var getRnd = function() {
                var limit = 10;
                var rnd = 't';
                do {
                  limit--;
                  for (var i = 0; i < 21; i++) {
                    rnd += possible.charAt(Math.floor(Math.random() * possible.length));
                  }
                } while (dDbl[rnd] && limit > 0);

                dDbl[rnd] = 1;

                return rnd;
              };

              var classMap = {};
              var slice = [].slice;
              slice.call(bar.querySelectorAll('[class]')).forEach(function(node) {
                slice.call(node.classList).forEach(function(className) {
                  if (!classMap[className]) {
                    classMap[className] = getRnd();
                  }
                  node.classList.remove(className);
                  var rnd = classMap[className];
                  node.classList.add(rnd);
                });
              });

              var styleText = style.textContent;
              Object.keys(classMap).forEach(function(origClassName) {
                var newClassName = classMap[origClassName];
                styleText = styleText.replace(new RegExp(origClassName, 'gi'), newClassName);
              });
              style.textContent = styleText;
            }
          }
        };
        return getBarUi(tbr);
      };

      var testB = function() {
        var getBarUi = function(tbr) {
          "use strict";

          var main = tbr.main;

          var origPageStyle = {};
          var marginPage = function(barObj, show) {
            var barHeight = 55;
            var barNode = barObj.body.node;
            var htmlNode = document.body.parentNode;
            if (show) {
              origPageStyle.marginTop = htmlNode.style.marginTop;
              origPageStyle.transition = htmlNode.style.transition;

              htmlNode.style.transition = 'margin-top 0.2s';
              barNode.style.transition = 'margin-top 0.2s';

              setTimeout(function() {
                htmlNode.style.marginTop = barHeight + 'px';
                barNode.style.marginTop = 0;

                if (htmlNode.style.setProperty) {
                  htmlNode.style.setProperty('margin-top', barHeight + 'px', 'important');
                }

                setTimeout(function() {
                  htmlNode.style.transition = origPageStyle.transition;
                  barNode.style.transition = '';
                }, 250);
              }, 0);

              var onShow = main.currentProfile.onShow;
              onShow && onShow(barHeight);
            } else {
              htmlNode.style.marginTop = origPageStyle.marginTop;

              var onHide = main.currentProfile.onHide;
              onHide && onHide();
            }
          };

          var rndClassName = function(barNode, styleNode) {
            var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            var dDbl = {};

            var getRnd = function() {
              var limit = 10;
              var rnd = 't';
              do {
                limit--;
                for (var i = 0; i < 21; i++) {
                  rnd += possible.charAt(Math.floor(Math.random() * possible.length));
                }
              } while (dDbl[rnd] && limit > 0);

              dDbl[rnd] = 1;

              return rnd;
            };

            var classMap = {};
            var slice = [].slice;
            slice.call(barNode.querySelectorAll('[class]')).forEach(function(node) {
              slice.call(node.classList).forEach(function(className) {
                if (!classMap[className]) {
                  classMap[className] = getRnd();
                }
                node.classList.remove(className);
                var rnd = classMap[className];
                node.classList.add(rnd);
              });
            });

            var styleText = styleNode.textContent;
            Object.keys(classMap).forEach(function(origClassName) {
              var newClassName = classMap[origClassName];
              styleText = styleText.replace(new RegExp(origClassName, 'gi'), newClassName);
            });
            styleNode.textContent = styleText;
          };

          var Bar = function(details) {
            this.hostname = tbr.hostname;
            this.type = details.type;
            this.details = details;
            this.isClosed = false;
            this.isRemoved = false;
            this.container = document.createDocumentFragment();

            this.styleCss = [];

            this.barContent = this.getBarContent();

            this.body = this.getBody();

            this.content = this.getContent();

            this.body.content.appendChild(this.content.node);

            this.style = this.getStyle();

            this.container.appendChild(this.body.node);
            this.container.appendChild(this.style.node);

            rndClassName(this.container, this.style.node);
          };

          Bar.prototype.trackByVendor = function(data) {
            var map = {
              aviasales: 'as',
              skyscanner: 'sc'
            };

            var vendor = this.barContent.vendor;
            var prefix = map[vendor];
            if (prefix) {
              data.ec += '-' + prefix;
              return tbr.emit('track', data);
            } else {
              return tbr.error('Prefix is not found!', vendor);
            }
          };

          Bar.prototype.getAviaBarContent = function() {
            var pageInfo = this.details.pageInfo;
            var prices = this.details.prices;

            var getAviaBarItemIndex = function(priceList) {
              var minDate = null;
              var minItem = null;

              priceList.forEach(function(item) {
                var m = /(\d{4}.\d{2}.\d{2})/.exec(item.depart_date);
                if (!m) {
                  return;
                }

                var date = m[1];

                if (minDate === null || minDate > date) {
                  minDate = date;
                  minItem = null;
                }

                if (date === minDate) {
                  if (minItem === null || item.value < minItem.value) {
                    minItem = item;
                  }
                }
              });

              var index = priceList.indexOf(minItem);

              tbr.log('Bar item', index, minItem);
              tbr.log('Result prices', priceList);

              return index;
            };

            var barItem = prices.data[getAviaBarItemIndex(prices.data)];
            if (!barItem) {
              tbr.error('Bar item is not found!', this.details);
              return null;
            }

            var isCalendar = !!barItem.monthPrice;
            var isOneWay = !pageInfo.dateEnd;

            var barUrl = barItem.url;
            if (!barUrl) {
              barUrl = 'http://hydra.aviasales.ru/searches/new' + '?' + monoUtils.param({
                origin_iata: pageInfo.origin,
                destination_iata: pageInfo.destination,
                adults: 1,
                children: 0,
                infants: 0,
                trip_class: 0,
                depart_date: pageInfo.dateStart,
                return_date: pageInfo.dateEnd,
                marker: appInfo.id,
                with_request: true
              });
            }

            var content = {
              value: barItem.converted_value || barItem.value,
              currency: pageInfo.currency,

              origin: barItem.origin,
              destination: barItem.destination,

              dateStart: barItem.depart_date,
              dateEnd: barItem.return_date,

              monthPrice: !!barItem.monthPrice,
              vendor: barItem.vendor || 'aviasales',
              url: barUrl,
              isCalendar: isCalendar,
              isOneWay: isOneWay
            };

            if (isCalendar) {
              content.barTitle = tbr.language.calLabel;
              content.dateStartText = tbr.language.inMonth.replace('%month%', main.getCalMonth(content.dateStart));
            } else if (isOneWay) {
              content.barTitle = tbr.language.foundOneWay;
              content.dateStartText = main.getDate(content.dateStart, true);
            } else {
              content.barTitle = tbr.language.foundTwoWay;
              content.dateStartText = main.getDate(content.dateStart, true);
              content.dateEndText = main.getDate(content.dateEnd, true);
            }

            content.originName = main.getCityName(content.origin);
            content.destinationName = main.getCityName(content.destination);

            return content;
          };

          Bar.prototype.getHotelBarContent = function() {
            var details = this.details;
            var pageInfo = details.pageInfo;
            var prices = details.prices;

            var getHotelBarItem = function(prices) {
              var mainItem = null;
              var isSuggest = !!details.showSuggestPrice;

              prices.data.filter(function(item) {
                return isSuggest === !!item.isSuggest;
              }).forEach(function(item) {
                if (mainItem === null || mainItem.value > item.value) {
                  mainItem = item;
                }
              });

              return mainItem;
            };

            var barItem = getHotelBarItem(prices);
            if (!barItem) {
              tbr.error('Bar item is not found!', details);
              return null;
            }

            var isSuggest = !!barItem.isSuggest;

            var content = {
              name: barItem.name,
              stars: barItem.stars,

              value: barItem.converted_value || barItem.value,
              currency: pageInfo.currency,

              dateIn: pageInfo.dateIn,
              dateOut: pageInfo.dateOut,

              url: barItem.deeplink,
              isSuggest: isSuggest
            };

            if (typeof content.stars !== 'number' || content.stars < 0 || content.stars > 5) {
              content.stars = 0;
            }

            if (isSuggest) {
              content.barTitle = tbr.language.aroundHotel;
            } else {
              content.barTitle = tbr.language.foundHotel;
            }

            content.dateInText = main.getDate(content.dateIn, true, true);
            content.dateOutText = main.getDate(content.dateOut, true);

            return content;
          };

          Bar.prototype.getBarContent = function() {
            if (this.type === 'avia') {
              return this.getAviaBarContent();
            } else if (this.type === 'hotel') {
              return this.getHotelBarContent();
            }
          };

          Bar.prototype.insertAviaBar = function() {
            var _this = this;
            var barContent = this.barContent;

            var content = document.createDocumentFragment();

            this.styleCss.push({
              '.tbr-cell': {
                display: 'inline-block'
              }
            }, {
              '.tbr-cell': {
                display: 'inline-flex'
              }
            });

            this.styleCss.push({
              '.tbr-title': {
                fontSize: '20px',
                fontWeight: 'bold',
                margin: 'auto 10px'
              }
            });

            content.appendChild(monoUtils.create('div', {
              class: ['tbr-cell', 'tbr-title'],
              style: {
                verticalAlign: 'middle'
              },
              text: barContent.barTitle
            }));

            var flightInfoCell = monoUtils.create('div', {
              class: ['tbr-cell'],
              style: {
                verticalAlign: 'middle',
                flex: 2,
                overflow: 'hidden'
              }
            });

            content.appendChild(flightInfoCell);

            this.styleCss.push({
              '.tbr-info': {
                height: '38px',
                border: '1px solid rgba(255,255,255,.3)',
                margin: 'auto 10px',
                borderRadius: '19px',
                padding: '0 15px'
              }
            });

            var flightInfoWrapper = monoUtils.create('div', {
              class: ['tbr-cell', 'tbr-info'],
              style: {
                overflow: 'hidden'
              }
            });

            flightInfoCell.appendChild(flightInfoWrapper);

            this.styleCss.push({
              '.tbr-point': {
                display: 'inline-block',
                verticalAlign: 'middle',
                margin: 'auto 0',
                textOverflow: 'ellipsis',
                color: '#fcea00',
                fontWeight: 'bold',
                fontSize: '14px'
              }
            });

            var getPoint = function(name) {
              return monoUtils.create('div', {
                class: ['tbr-point'],
                style: {
                  overflow: 'hidden'
                },
                title: name,
                text: name
              });
            };

            var flightWrapper = monoUtils.create('div', {
              class: ['tbr-cell'],
              style: {
                verticalAlign: 'middle',
                overflow: 'hidden',
                margin: 'auto 0'
              }
            });

            flightInfoWrapper.appendChild(flightWrapper);

            flightWrapper.appendChild(getPoint(barContent.originName));

            this.styleCss.push({
              '.tbr-way-icon': {
                display: 'inline-block',
                verticalAlign: 'middle',
                margin: 'auto 6px'
              }
            });

            if (barContent.isOneWay) {
              flightWrapper.appendChild(monoUtils.create('div', {
                class: ['tbr-way-icon'],
                append: this.getOneWaySvg()
              }));
            } else {
              flightWrapper.appendChild(monoUtils.create('div', {
                class: ['tbr-way-icon'],
                append: this.getTwoWaySvg()
              }));
            }

            flightWrapper.appendChild(getPoint(barContent.destinationName));

            this.styleCss.push({
              '.tbr-dates': {
                verticalAlign: 'middle',
                margin: 'auto 0 auto 10px',
                fontSize: '14px'
              }
            });

            var flightDates = monoUtils.create('div', {
              class: ['tbr-cell', 'tbr-dates']
            });

            flightInfoWrapper.appendChild(flightDates);

            var flightDatesText = [barContent.dateStartText];
            if (!barContent.isOneWay && !barContent.isCalendar) {
              flightDatesText.push(' — ');
              flightDatesText.push(barContent.dateEndText);
            }
            flightDates.appendChild(document.createTextNode(flightDatesText.join(' ')));

            this.styleCss.push({
              '.tbr-price': {
                verticalAlign: 'middle',
                fontSize: '20px',
                fontWeight: 'bold',
                margin: 'auto 10px',
                lineHeight: '23px'
              }
            });

            this.styleCss.push({
              '.tbr-price *': {
                fontWeight: 'inherit',
                fontSize: 'inherit',
                lineHeight: 'inherit'
              }
            });

            var priceObj = main.getPrice(barContent.currency, barContent.value);
            content.appendChild(monoUtils.create('div', {
              class: ['tbr-cell', 'tbr-price'],
              append: main.getPriceNode(priceObj)
            }));

            this.styleCss.push({
              '.tbr-more-btn': {
                verticalAlign: 'middle',
                fontSize: '16px',
                fontWeight: 'bold',
                color: '#000',
                margin: 'auto 10px',
                padding: '10px 25px',
                backgroundColor: '#fcea00',
                borderRadius: '19px',

                textDecoration: 'none'
              },
              '.tbr-more-btn:hover': {
                backgroundColor: '#fcf380',
                color: '#000'
              }
            });

            this.styleCss.push({
              '.tbr-more-btn': {
                color: '#000 !important',
                textDecoration: 'none !important'
              }
            });

            var moreBtn = null;

            content.appendChild(moreBtn = monoUtils.create('a', {
              class: ['tbr-cell', 'tbr-more-btn'],
              href: barContent.url,
              target: '_blank',
              text: tbr.language.view,
              on: ['click', function(e) {
                e.stopPropagation();

                _this.content.onClick();
              }]
            }));

            this.styleCss.push({
              media: '@media only screen and (max-width: 1150px)',
              append: [{
                '.tbr-content': {
                  maxWidth: '960px'
                },
                '.tbr-title': {
                  fontSize: '18px'
                }
              }]
            });

            this.styleCss.push({
              media: '@media only screen and (max-width: 1050px)',
              append: [{
                '.tbr-content': {
                  maxWidth: '810px'
                },
                '.tbr-close-btn': {
                  width: '24px'
                },
                '.tbr-right-padding': {
                  width: '24px'
                },
                '.tbr-title': {
                  fontSize: '14px',
                  marginLeft: '5px',
                  marginRight: '5px'
                },
                '.tbr-info': {
                  marginLeft: '5px',
                  marginRight: '5px',
                  paddingLeft: '5px',
                  paddingRight: '5px'
                },
                '.tbr-dates': {
                  marginLeft: '5px',
                  marginRight: '5px'
                },
                '.tbr-price': {
                  fontSize: '16px',
                  marginLeft: '5px',
                  marginRight: '5px'
                },
                '.tbr-more-btn': {
                  fontSize: '14px',
                  marginLeft: '5px',
                  marginRight: '5px',
                  paddingLeft: '10px',
                  paddingRight: '10px'
                }
              }]
            });

            this.styleCss.push({
              media: '@media only screen and (max-width: 850px)',
              append: [{
                '.tbr-content': {
                  maxWidth: '700px'
                }
              }]
            });

            var onAppend = function() {
              tbr.emit('track', {
                cd: 'flightshow',
                t: 'screenview'
              });

              tbr.emit('track', {
                ec: 'cheapflight',
                ea: 'show',
                el: _this.hostname,
                cd: 'flightshow',
                t: 'event'
              });

              if (barContent.isCalendar) {
                tbr.emit('track', {
                  cd: 'flight_calendar_show',
                  t: 'screenview'
                });
              } else {
                _this.trackByVendor({
                  ec: 'cheapflight',
                  ea: 'show',
                  el: _this.hostname,
                  cd: 'flightshow',
                  t: 'event'
                });

                tbr.emit('track', {
                  cd: 'flight_betterprice_show',
                  t: 'screenview'
                });
              }
            };

            var onReplace = function() {
              tbr.emit('track', {
                ec: 'cheapflight',
                ea: 'update',
                el: _this.hostname,
                t: 'event'
              });

              if (barContent.isCalendar) {
                tbr.emit('track', {
                  cd: 'flight_calendar_update',
                  t: 'screenview'
                });
              } else {
                _this.trackByVendor({
                  ec: 'cheapflight',
                  ea: 'update',
                  el: _this.hostname,
                  t: 'event'
                });

                tbr.emit('track', {
                  cd: 'flight_betterprice_update',
                  t: 'screenview'
                });
              }
            };

            var onShow = function() {
              if (barContent.isCalendar) {
                tbr.emit('track', {
                  ec: 'cheapflight',
                  ea: 'calendarPrice',
                  el: _this.hostname,
                  t: 'event'
                });
              }
            };

            var onClick = function() {
              tbr.emit('track', {
                cd: 'flightclick',
                t: 'screenview'
              });

              tbr.emit('track', {
                ec: 'cheapflight',
                ea: 'click',
                el: _this.hostname,
                cd: 'flightclick',
                t: 'event'
              });

              if (barContent.isCalendar) {
                tbr.emit('track', {
                  cd: 'flight_calendar_click',
                  t: 'screenview'
                });

                tbr.emit('track', {
                  ec: 'cheapflight',
                  ea: 'calendarclick',
                  el: _this.hostname,
                  cd: 'flight_calendar_click',
                  t: 'event'
                });
              } else {
                tbr.emit('track', {
                  cd: 'flight_betterprice_click',
                  t: 'screenview'
                });

                tbr.emit('track', {
                  ec: 'cheapflight',
                  ea: 'betterpriceclick',
                  el: _this.hostname,
                  cd: 'flight_betterprice_click',
                  t: 'event'
                });

                _this.trackByVendor({
                  ec: 'cheapflight',
                  ea: 'betterpriceclick',
                  el: _this.hostname,
                  cd: 'flight_betterprice_click',
                  t: 'event'
                });
              }
            };

            var onClose = function() {
              tbr.emit('track', {
                ec: 'cheapflight',
                ea: 'close',
                el: _this.hostname,
                t: 'event'
              });

              _this.trackByVendor({
                ec: 'cheapflight',
                ea: 'close',
                el: _this.hostname,
                t: 'event'
              });
            };

            return {
              node: content,
              moreBtn: moreBtn,
              onAppend: onAppend,
              onReplace: onReplace,
              onShow: onShow,
              onClick: onClick,
              onClose: onClose
            }
          };

          Bar.prototype.insertHotelBar = function() {
            var _this = this;
            var barContent = this.barContent;

            var content = document.createDocumentFragment();

            this.styleCss.push({
              '.tbr-cell': {
                display: 'inline-block'
              }
            }, {
              '.tbr-cell': {
                display: 'inline-flex'
              }
            });

            this.styleCss.push({
              '.tbr-title': {
                fontSize: '20px',
                fontWeight: 'bold',
                margin: 'auto 10px'
              }
            });

            content.appendChild(monoUtils.create('div', {
              class: ['tbr-cell', 'tbr-title'],
              style: {
                verticalAlign: 'middle'
              },
              text: barContent.barTitle
            }));

            var hotelInfoCell = monoUtils.create('div', {
              class: ['tbr-cell'],
              style: {
                verticalAlign: 'middle',
                flex: 2,
                overflow: 'hidden'
              }
            });
            content.appendChild(hotelInfoCell);

            this.styleCss.push({
              '.tbr-info': {
                height: '38px',
                border: '1px solid rgba(255,255,255,.3)',
                margin: 'auto 10px',
                borderRadius: '19px',
                padding: '0 15px',
                boxSizing: 'border-box'
              }
            });

            this.styleCss.push({
              '.tbr-hotel': {
                textOverflow: 'ellipsis',
                margin: 'auto',
                color: '#fcea00',
                fontWeight: 'bold',
                fontSize: '14px'
              }
            });


            var fullStarsBody = monoUtils.create('span', {
              class: ['tbr-stars-full']
            });

            var getStar = function(one) {
              var style = {
                width: '16px',
                height: '16px'
              };
              if (one) {
                style.verticalAlign = 'text-bottom';
              }
              return monoUtils.create(_this.getStarSvg(), {
                style: style
              });
            };

            var starText = '';
            for (var i = 0; i < barContent.stars; i++) {
              fullStarsBody.appendChild(getStar());
              starText += String.fromCharCode(9733);
            }

            if (starText) {
              starText = ' ' + starText;
            }

            var hotelInfoWrapper = monoUtils.create('div', {
              class: ['tbr-cell', 'tbr-info'],
              style: {
                overflow: 'hidden'
              },
              append: [
                monoUtils.create('span', {
                  class: ['tbr-hotel'],
                  style: {
                    overflow: 'hidden'
                  },
                  title: barContent.name + starText,
                  text: barContent.name
                })
              ]
            });

            hotelInfoCell.appendChild(hotelInfoWrapper);

            this.styleCss.push({
              '.tbr-stars-full': {
                display: 'inline-block',
                verticalAlign: 'middle',
                margin: 'auto 0'
              }
            });

            hotelInfoWrapper.appendChild(fullStarsBody);

            this.styleCss.push({
              '.tbr-stars-short': {
                display: 'none',
                verticalAlign: 'middle',
                margin: 'auto 0 auto 5px'
              }
            });

            if (barContent.stars > 0) {
              var shortStarsBody = monoUtils.create('span', {
                class: ['tbr-stars-short'],
                append: [
                  barContent.stars,
                  getStar(true)
                ]
              });

              hotelInfoWrapper.appendChild(shortStarsBody);
            }

            this.styleCss.push({
              '.tbr-dates': {
                verticalAlign: 'middle',
                margin: 'auto 0 auto 10px',
                fontSize: '14px'
              }
            });

            var bookingDates = monoUtils.create('div', {
              class: ['tbr-cell', 'tbr-dates'],
              text: [barContent.dateInText, '—', barContent.dateOutText].join(' ')
            });

            hotelInfoWrapper.appendChild(bookingDates);

            this.styleCss.push({
              '.tbr-price': {
                verticalAlign: 'middle',
                fontSize: '20px',
                fontWeight: 'bold',
                margin: 'auto 10px',
                lineHeight: '23px'
              }
            });

            this.styleCss.push({
              '.tbr-price *': {
                fontWeight: 'inherit',
                fontSize: 'inherit',
                lineHeight: 'inherit'
              }
            });

            var priceObj = main.getPrice(barContent.currency, barContent.value);
            content.appendChild(monoUtils.create('div', {
              class: ['tbr-cell', 'tbr-price'],
              append: main.getPriceNode(priceObj)
            }));

            this.styleCss.push({
              '.tbr-more-btn': {
                verticalAlign: 'middle',
                fontSize: '16px',
                fontWeight: 'bold',
                color: '#000',
                margin: 'auto 10px',
                padding: '10px 25px',
                backgroundColor: '#fcea00',
                borderRadius: '19px',

                textDecoration: 'none'
              },
              '.tbr-more-btn:hover': {
                backgroundColor: '#fcf380',
                color: '#000'
              }
            });

            this.styleCss.push({
              '.tbr-more-btn': {
                color: '#000 !important',
                textDecoration: 'none !important'
              }
            });

            var moreBtn = null;

            content.appendChild(moreBtn = monoUtils.create('a', {
              class: ['tbr-cell', 'tbr-more-btn'],
              href: barContent.url,
              target: '_blank',
              text: tbr.language.view,
              on: ['click', function(e) {
                e.stopPropagation();

                _this.content.onClick();
              }]
            }));

            this.styleCss.push({
              media: '@media only screen and (max-width: 1150px)',
              append: [{
                '.tbr-content': {
                  maxWidth: '960px'
                },
                '.tbr-title': {
                  fontSize: '18px'
                }
              }]
            });

            this.styleCss.push({
              media: '@media only screen and (max-width: 1050px)',
              append: [{
                '.tbr-content': {
                  maxWidth: '810px'
                },
                '.tbr-close-btn': {
                  width: '24px'
                },
                '.tbr-right-padding': {
                  width: '24px'
                },
                '.tbr-title': {
                  fontSize: '14px',
                  marginLeft: '5px',
                  marginRight: '5px'
                },
                '.tbr-info': {
                  marginLeft: '5px',
                  marginRight: '5px',
                  paddingLeft: '5px',
                  paddingRight: '5px'
                },
                '.tbr-dates': {
                  marginLeft: '5px',
                  marginRight: '5px'
                },
                '.tbr-price': {
                  fontSize: '16px',
                  marginLeft: '5px',
                  marginRight: '5px'
                },
                '.tbr-more-btn': {
                  fontSize: '14px',
                  marginLeft: '5px',
                  marginRight: '5px',
                  paddingLeft: '10px',
                  paddingRight: '10px'
                }
              }]
            });

            this.styleCss.push({
              media: '@media only screen and (max-width: 950px)',
              append: [{
                '.tbr-stars-short': {
                  display: 'inline-block'
                },
                '.tbr-stars-full': {
                  display: 'none'
                }
              }]
            });

            this.styleCss.push({
              media: '@media only screen and (max-width: 850px)',
              append: [{
                '.tbr-content': {
                  maxWidth: '700px'
                }
              }]
            });

            var onAppend = function() {
              tbr.emit('track', {
                cd: 'hotelshow',
                t: 'screenview'
              });

              tbr.emit('track', {
                ec: 'hotel',
                ea: 'show',
                el: _this.hostname,
                cd: 'hotelshow',
                t: 'event'
              });

              if (_this.barContent.isSuggest) {
                tbr.emit('track', {
                  cd: 'hotelNearbyShow',
                  t: 'screenview'
                });

                tbr.emit('track', {
                  ec: 'hotel',
                  ea: 'nearbyShow',
                  el: _this.hostname,
                  cd: 'hotelNearbyShow',
                  t: 'event'
                });
              }
            };

            var onReplace = function() {
              tbr.emit('track', {
                ec: 'hotel',
                ea: 'update',
                el: _this.hostname,
                t: 'event'
              });

              if (_this.barContent.isSuggest) {
                tbr.emit('track', {
                  cd: 'hotelNearbyUpdate',
                  t: 'screenview'
                });

                tbr.emit('track', {
                  ec: 'hotel',
                  ea: 'nearbyUpdate',
                  el: _this.hostname,
                  cd: 'hotelNearbyUpdate',
                  t: 'event'
                });
              }
            };

            var onShow = function() {

            };

            var onClick = function() {
              tbr.emit('track', {
                cd: 'hotelclick',
                t: 'screenview'
              });

              tbr.emit('track', {
                ec: 'hotel',
                ea: 'click',
                el: _this.hostname,
                cd: 'hotelclick',
                t: 'event'
              });

              if (_this.barContent.isSuggest) {
                tbr.emit('track', {
                  cd: 'hotelNearbyClick',
                  t: 'screenview'
                });

                tbr.emit('track', {
                  ec: 'hotel',
                  ea: 'nearbyClick',
                  el: _this.hostname,
                  cd: 'hotelNearbyClick',
                  t: 'event'
                });
              }
            };

            var onClose = function() {
              tbr.emit('track', {
                ec: 'hotel',
                ea: 'close',
                el: _this.hostname,
                t: 'event'
              });
            };

            return {
              node: content,
              moreBtn: moreBtn,
              onAppend: onAppend,
              onReplace: onReplace,
              onShow: onShow,
              onClick: onClick,
              onClose: onClose
            }
          };

          Bar.prototype.getContent = function() {
            if (this.type === 'hotel') {
              return this.insertHotelBar();
            } else if (this.type === 'avia') {
              return this.insertAviaBar();
            }
          };

          Bar.prototype.getStyle = function() {
            return {
              node: monoUtils.create('style', {
                text: monoUtils.style2Text(this.styleCss)
              })
            }
          };

          Bar.prototype.getCloseSvg = function() {
            var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            var svgNS = svg.namespaceURI;
            svg.setAttribute('width', '80');
            svg.setAttribute('height', '80');
            svg.setAttribute('viewBox', '0 0 80 80');

            var path = document.createElementNS(svgNS, 'path');
            svg.appendChild(path);
            path.setAttribute('fill', '#FCEA00');
            path.setAttribute('d', 'M56.971 52.729L44.243 40l12.728-12.728-4.242-4.243L40 35.757 27.272 23.029l-4.243 4.243L35.757 40 23.029 52.729l4.243 4.242L40 44.243l12.729 12.728z');

            return svg;
          };

          Bar.prototype.getOneWaySvg = function() {
            var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            var svgNS = svg.namespaceURI;
            svg.setAttribute('width', '24px');
            svg.setAttribute('height', '24px');
            svg.setAttribute('viewBox', '4 4 24 24');

            var path = document.createElementNS(svgNS, 'path');
            svg.appendChild(path);
            path.setAttribute('fill', '#D18685');
            path.setAttribute('d', 'M4.538 16.618h21.626l-4.48 4.463a.537.537 0 0 0 0 .761c.21.211.551.211.761 0l5.328-5.327a.543.543 0 0 0 0-.762l-5.328-5.327a.537.537 0 0 0-.761 0 .537.537 0 0 0 0 .761l4.48 4.354H4.538a.538.538 0 1 0 0 1.077z');

            return svg;
          };

          Bar.prototype.getTwoWaySvg = function() {
            var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            var svgNS = svg.namespaceURI;
            svg.setAttribute('width', '24px');
            svg.setAttribute('height', '24px');
            svg.setAttribute('viewBox', '4 4 24 24');

            var path = document.createElementNS(svgNS, 'path');
            svg.appendChild(path);
            path.setAttribute('fill', '#D18685');
            path.setAttribute('d', 'M27.391 10.382H5.764l4.481-4.463a.538.538 0 0 0-.761-.761l-5.328 5.328a.542.542 0 0 0 0 .761l5.328 5.328a.538.538 0 0 0 .761-.761L5.764 11.46H27.39a.539.539 0 0 0 .001-1.078zM4.538 21.618h21.626l-4.48 4.463a.537.537 0 0 0 0 .761c.21.211.551.211.761 0l5.328-5.327a.543.543 0 0 0 0-.762l-5.328-5.327a.537.537 0 0 0-.761 0 .537.537 0 0 0 0 .761l4.48 4.354H4.538a.538.538 0 1 0 0 1.077z');

            return svg;
          };

          Bar.prototype.getStarSvg = function() {
            var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            var svgNS = svg.namespaceURI;
            svg.setAttribute('width', '24');
            svg.setAttribute('height', '24');
            svg.setAttribute('viewBox', '0 0 24 24');

            var path = document.createElementNS(svgNS, 'path');
            svg.appendChild(path);
            path.setAttribute('fill', '#FCEA00');
            path.setAttribute('d', 'M9.362 9.158l-5.268.584c-.19.023-.358.15-.421.343s0 .394.14.521c1.566 1.429 3.919 3.569 3.919 3.569-.002 0-.646 3.113-1.074 5.19a.504.504 0 0 0 .196.506.494.494 0 0 0 .538.027c1.844-1.047 4.606-2.623 4.606-2.623l4.604 2.625c.168.092.379.09.541-.029a.5.5 0 0 0 .195-.505l-1.07-5.191s2.353-2.14 3.918-3.566a.499.499 0 0 0-.279-.865c-2.108-.236-5.27-.586-5.27-.586l-2.183-4.83a.499.499 0 1 0-.909 0l-2.183 4.83z');

            return svg;
          };

          Bar.prototype.getBody = function() {
            var barHeight = 55;
            var _this = this;

            this.styleCss.push({
              '.tbr-body': monoUtils.styleReset
            });

            this.styleCss.push({
              '.tbr-body': {
                backgroundColor: '#CC0001',
                color: '#FFF',
                cursor: 'pointer',
                marginTop: '-' + barHeight + 'px',
                display: 'table !important',
                opacity: '1 !important'
              },
              '.tbr-body:hover': {
                backgroundColor: '#b70001'
              }
            });

            this.styleCss.push({
              '.tbr-close-btn': {
                width: '45px',
                opacity: 1
              }
            });

            this.styleCss.push({
              '.tbr-close-btn:hover': {
                opacity: 0.5
              }
            });

            this.styleCss.push({
              '.tbr-right-padding': {
                width: '45px',
                opacity: 0.5
              }
            });

            this.styleCss.push({
              '.tbr-content': {
                maxWidth: '1100px'
              }
            });

            var content = null;
            var node = monoUtils.create('div', {
              class: ['tbr-body'],
              style: {
                position: 'fixed',
                top: 0,
                left: 0,
                fontWeight: 'normal',
                font: 'normal normal 14px Arial, sans-serif',

                display: 'table',
                width: '100%',
                height: '55px',
                lineHeight: 'normal',

                opacity: 1,
                zIndex: 99999999
              },
              on: ['click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                _this.content.moreBtn.dispatchEvent(new MouseEvent('click'));
              }],
              append: [
                monoUtils.create('div', {
                  style: {
                    display: 'table-cell',
                    verticalAlign: 'middle'
                  },
                  append: monoUtils.create('a', {
                    class: ['tbr-close-btn'],
                    href: '#close',
                    title: tbr.language.close,
                    style: {
                      display: 'block',
                      height: '45px',
                      textAlign: 'center',
                      cursor: 'pointer'
                    },
                    on: ['click', function(e) {
                      e.preventDefault();
                      e.stopPropagation();

                      _this.close(true);

                      _this.content.onClose();
                    }],
                    append: monoUtils.create(_this.getCloseSvg(), {
                      style: {
                        marginLeft: '4px',
                        marginTop: '10px',
                        width: '24px',
                        height: '24px'
                      }
                    })
                  })
                }),
                monoUtils.create('div', {
                  style: {
                    display: 'table-cell',
                    verticalAlign: 'middle',
                    textAlign: 'center'
                  },
                  append: monoUtils.create('div', {
                    class: ['tbr-content'],
                    style: {
                      display: 'inline-block',
                      width: '100%',
                      textAlign: 'left',
                      position: 'relative'
                    },
                    append: content = monoUtils.create('div', {
                      style: {
                        display: 'block',
                        whiteSpace: 'nowrap',
                        alignItems: 'center'
                      },
                      onCreate: function() {
                        this.style.display = 'flex';
                      }
                    })
                  })
                }),
                monoUtils.create('div', {
                  class: ['tbr-right-padding'],
                  style: {
                    display: 'table-cell',
                    verticalAlign: 'middle'
                  }
                })
              ]
            });
            return {
              node: node,
              content: content
            };
          };

          Bar.prototype.remove = function() {
            if (!this.isRemoved) {
              this.isRemoved = true;

              var parent = this.body.node.parentNode;
              if (parent) {
                parent.removeChild(this.body.node);
              }

              parent = this.style.node.parentNode;
              if (parent) {
                parent.removeChild(this.style.node);
              }
            }
          };

          Bar.prototype.replace = function(newBar) {
            this.isRemoved = true;
            this.isClosed = true;

            newBar.body.node.style.marginTop = 0;

            var parent = this.body.node.parentNode;
            if (parent) {
              parent.replaceChild(newBar.body.node, this.body.node);
            } else {
              document.body.appendChild(newBar.body.node);
            }

            parent = this.style.node.parentNode;
            if (parent) {
              parent.replaceChild(newBar.style.node, this.style.node);
            } else {
              document.body.appendChild(newBar.style.node);
            }
          };

          Bar.prototype.close = function(byUser) {
            if (!this.isClosed) {
              this.isClosed = true;
              this.remove();
              marginPage(this, false);
              if (byUser) {
                main.stopObserver();

                var blackList = main.storage.blackList;
                var now = parseInt(Date.now() / 1000);
                blackList.push({
                  hostname: tbr.hostname,
                  expire: now + 5 * 60 * 60
                });

                main.save();
              }
            }
          };

          return {
            current: null,
            create: function(details) {
              var previewBar = this.current;

              var bar = this.current = new Bar(details);

              var isReplace = false;
              if (previewBar && !previewBar.isClosed) {
                isReplace = true;
                previewBar.replace(bar);
              } else {
                marginPage(bar, true);
                document.body.appendChild(bar.container);
              }

              if (isReplace) {
                bar.content.onReplace();
              } else {
                bar.content.onAppend();
              }

              bar.content.onShow();
            },
            aviaBarSaveInHistory: function(pageInfo) {
              var originCity = main.getCityName(pageInfo.origin);
              var destinationCity = main.getCityName(pageInfo.destination);
              if (!originCity || !destinationCity) {
                return;
              }

              var data = {
                originCity: originCity,
                destinationCity: destinationCity,
                origin: pageInfo.origin,
                destination: pageInfo.destination,
                dateStart: pageInfo.dateStart,
                dateEnd: pageInfo.dateEnd,
                time: parseInt(Date.now() / 1000)
              };

              return tbr.emit('history', data);
            }
          };
        };
        return getBarUi(tbr);
      };

      monoUtils.extend(main, {
        cultureInfo: {
          ru: {
            weekdaysShort: 'Вс_Пн_Вт_Ср_Чт_Пт_Сб'.split('_'),
            months: 'января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря'.split('_'),
            monthsCal: 'январе_феврале_марте_апреле_мае_июне_июле_августе_сентябре_октябре_ноябре_декабре'.split('_'),
            dateFormat: 'D MMMM, ddd',
            dateFormatNoWeekdays: 'D MMMM',
            timeFormat: 'HH:mm'
          },
          en: {
            weekdaysShort: 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_'),
            months: 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_'),
            dateFormat: 'D MMMM, ddd',
            dateFormatNoWeekdays: 'D MMMM',
            timeFormat: 'h:mm A'
          },
          de: {
            weekdaysShort: 'So._Mo._Di._Mi._Do._Fr._Sa.'.split('_'),
            months: 'Jänner_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember'.split('_'),
            dateFormat: 'ddd, D. MMMM',
            dateFormatNoWeekdays: 'D. MMMM',
            timeFormat: 'HH:mm'
          }
        },
        ccyFormats: {
          USD: {
            symbol: "$",
            standard: "¤#,##0.00",
            details: {
              symbolRight: false,
              symbolSep: '',
              toFixed: 2,
              round: false,
              group: ',',
              decimal: '.'
            }
          },
          EUR: {
            symbol: "€",
            standard: "#,##0.00 ¤",
            details: {
              symbolRight: true,
              symbolSep: ' ',
              toFixed: 2,
              round: false,
              group: '.',
              decimal: ','
            }
          },
          RUB: {
            symbol: "₽",
            standard: "#,##0.00 ¤",
            details: {
              symbolRight: true,
              symbolSep: ' ',
              toFixed: 2,
              round: true,
              group: ' ',
              decimal: ','
            },
            getNode: function() {
              var link = document.querySelector('link.sf-price-font');
              if (!link) {
                link = monoUtils.create('link', {
                  class: 'sf-price-font',
                  href: 'https://fonts.googleapis.com/css?family=PT+Sans:bold',
                  rel: 'stylesheet',
                  type: 'text/css'
                });
                document.head.appendChild(link);
              }

              return monoUtils.create('span', {
                text: this.symbol,
                style: {
                  fontFamily: '"PT Sans", Arial, serif'
                }
              });
            }
          },
          BYR: {
            symbol: "р.",
            standard: "#,##0.00 ¤",
            details: {
              symbolRight: true,
              symbolSep: ' ',
              toFixed: 2,
              round: true,
              group: ' ',
              decimal: ','
            }
          },
          BYN: {
            symbol: "р.",
            standard: "#,##0.00 ¤",
            details: {
              symbolRight: true,
              symbolSep: ' ',
              toFixed: 2,
              round: true,
              group: ' ',
              decimal: ','
            }
          },
          KZT: {
            symbol: "T", //"₸",
            standard: "#,##0.00 ¤",
            details: {
              symbolRight: true,
              symbolSep: ' ',
              toFixed: 2,
              round: true,
              group: ' ',
              decimal: ','
            }
          },
          UAH: {
            symbol: "₴",
            standard: "#,##0.00 ¤",
            details: {
              symbolRight: true,
              symbolSep: ' ',
              toFixed: 2,
              round: true,
              group: ' ',
              decimal: ','
            }
          }
        },
        convertCcy: function(price, toCcy) {
          toCcy = toCcy.toLowerCase();
          var ccyList = main.cache.ccyList;
          var value = ccyList[toCcy];
          return price / value;
        },
        getCityName: function(cityCode) {
          var lang = tbr.language.lang;
          var city = main.cache.cityMap[cityCode];
          if (!city) {
            var airport = main.cache.airportMap[cityCode];
            if (airport) {
              cityCode = airport.city_code;
              city = main.cache.cityMap[cityCode];
            }
          }
          if (!city) {
            return null;
          }

          var localName = city.name_translations && city.name_translations[lang];
          return localName || city.name;
        },
        getDate: function(value, noWeekdays, isShort) {
          var time = new Date(value);
          var culture = main.cultureInfo[tbr.language.lang] || main.cultureInfo.en;
          var template = culture.dateFormat;
          if (noWeekdays) {
            template = culture.dateFormatNoWeekdays;
          }
          if (isShort) {
            template = 'D';
          }
          template = template.replace(/([a-zA-Z]+)/g, function(text, value) {
            switch (value) {
              case 'D':
                return time.getUTCDate();
              case 'MMMM':
                return culture.months[time.getUTCMonth()];
              case 'ddd':
                return culture.weekdaysShort[time.getUTCDay()];
            }
          });
          return template;
        },
        getCalMonth: function(value) {
          var time = new Date(value);
          var culture = main.cultureInfo[tbr.language.lang] || main.cultureInfo.en;
          return (culture.monthsCal || culture.months)[time.getUTCMonth()];
        },
        getPrice: function(ccy, value) {
          var cultureCcy = main.ccyFormats[ccy];

          if (!cultureCcy) {
            cultureCcy = {
              symbol: ccy,
              details: {
                symbolRight: true,
                symbolSep: ' ',
                toFixed: 2,
                round: false,
                group: ',',
                decimal: '.'
              }
            };
          }

          var details = cultureCcy.details;

          if (details.round) {
            value = Math.round(value);
          } else {
            value = value.toFixed(details.toFixed);
          }
          var splitValue = value.toString().split('.');

          var b = splitValue[1];
          var fixedValue = '';
          for (var i = 0; i < details.toFixed; i++) {
            fixedValue += '0';
          }
          if (b === fixedValue) {
            b = '';
          }

          var a = splitValue[0];

          a = a.split('').reverse().join('');
          a = a.replace(/(\d{3})/g, '$1,');
          a = a.split('').reverse().join('');
          if (a[0] === ',') {
            a = a.substr(1);
          }
          a = a.split(',');
          a = a.join(details.group);

          splitValue = [a];
          if (b) {
            splitValue.push(b);
          }
          var strValue = splitValue.join(details.decimal);

          var arr = [strValue];
          if (details.symbolRight) {
            if (details.symbolSep) {
              arr.push(details.symbolSep);
            }
            arr.push(cultureCcy.symbol);
          } else {
            if (details.symbolSep) {
              arr.unshift(details.symbolSep);
            }
            arr.unshift(cultureCcy.symbol);
          }
          var strValueSymbol = arr.join('');

          return {
            string: strValueSymbol,
            value: strValue,
            cultureCcy: cultureCcy
          };
        },
        getPriceNode: function(priceObj) {
          var cultureCcy = priceObj.cultureCcy;
          var details = cultureCcy.details;

          var getSymbol = function() {
            if (cultureCcy.getNode) {
              return cultureCcy.getNode();
            }

            return cultureCcy.symbol;
          };

          var symbolSep = details.symbolSep;
          if (symbolSep === ' ') {
            symbolSep = String.fromCharCode(160);
          }

          var arr = [priceObj.value];
          if (details.symbolRight) {
            if (symbolSep) {
              arr.push(symbolSep);
            }
            arr.push(getSymbol());
          } else {
            if (symbolSep) {
              arr.unshift(symbolSep);
            }
            arr.unshift(getSymbol());
          }

          return monoUtils.create(document.createDocumentFragment(), {
            append: arr
          });
        },
        getAviaBarItemIndex: function(priceList) {
          var minDate = null;
          var minItem = null;

          priceList.forEach(function(item) {
            var m = item.depart_date.match(/(\d{4}.\d{2}.\d{2})/);
            m = m && m[1];
            if (!m) {
              return;
            }
            var date = (new Date(m)).getTime();

            if (minDate === null || minDate > date) {
              minDate = date;
              minItem = null;
            }

            if (date !== minDate) {
              return;
            }

            if (minItem === null || item.value < minItem.value) {
              minItem = item;
            }
          });

          var index = priceList.indexOf(minItem);

          tbr.log('Bar item', index, minItem);
          tbr.log('Result prices', priceList);

          return index;
        }
      });

      monoUtils.extend(main, {
        profile: null,
        /**
         * @param profile
         * @constructor
         */
        Page: function(profile) {
          var _this = this;
          var type = null;
          var params = {};
          var priceObj = {};

          var getPriceObj = function(priceId) {
            var obj = priceObj[priceId];
            if (!obj) {
              priceObj[priceId] = obj = {};
            }
            return obj;
          };

          var removePrice = function() {
            for (var key in priceObj) {
              delete priceObj[key];
            }
          };

          var isEq = function(a, b) {
            if (Array.isArray(a) && b) {
              return JSON.stringify(a) === JSON.stringify(b);
            }

            return a === b;
          };

          var onFormChange = function() {
            if (!type) {
              return;
            }

            var priceId = main[type].page.getPriceId(params);

            var info = main.getInfoObj();
            delete info.barRequestData;

            removePrice();
            if (!priceId) {
              profile.matchPrice = false;
            } else {
              profile.matchPrice = true;
            }
          };

          var onPriceChange = monoUtils.debounce(function(priceParams) {
            var data = main[type].page.getData(params, priceParams);

            data && _this.setData(type, data);
          }, 50);


          this.setType = function(theType) {
            // tbr.log('Page setType', theType);

            type = theType;
          };

          this.set = function(key, value) {
            value = main.validate(key, value);

            var cValue = params[key];
            if (!isEq(value, cValue)) {
              params[key] = value;

              tbr.log('Page set', key, value);

              onFormChange();
            }
          };

          this.setPrice = function(key, value) {
            value = main.validate(key, value);

            if (!value) {
              return tbr.error('setPrice error, value is not valid', key, value);
            }

            if (!type) {
              return tbr.error('setPrice error, type is not found!', params);
            }

            var priceId = main[type].page.getPriceId(params);
            var data = getPriceObj(priceId);
            var cValue = data[key];
            if (value && cValue !== value) {
              if (!cValue || cValue > value) {
                data[key] = value;

                tbr.log('Page setPrice', key, value);

                onPriceChange(data);
              }
            }
          };

          this.clear = function() {
            tbr.log('Page clear');

            this.matchPrice = false;
            type = null;
            for (var key in params) {
              params[key] = null;
            }
          };
        },
        watchTemplateObj: {
          price: function(profile, summary, item) {
            var page = profile.page;
            if (!item.key) {
              item.key = 'price';
            }

            for (var n = 0, node; node = summary.added[n]; n++) {
              var price = main.preparePrice(node);
              page.setPrice(item.key, price);
            }
          },
          currency: function(profile, summary, item) {
            var page = profile.page;
            if (!item.key) {
              item.key = 'currency';
            }

            for (var n = 0, node; node = summary.added[n]; n++) {
              var text = node.textContent;
              var ccy = text && text.replace(/[\s\t]/g, '');
              if (item.currencyMap && item.currencyMap[ccy]) {
                ccy = item.currencyMap[ccy];
              }
              page.set(item.key, ccy);
            }
          }
        },
        /**
         * @param profile
         * @param watchObj
         * @constructor
         */
        Watcher: function(profile, watchObj) {
          var observer = null;

          var watch = function(profile, watchObj) {
            var queries = [];
            var keys = [];

            Object.keys(watchObj).forEach(function(key) {
              var query = watchObj[key].query;
              if (!Array.isArray(query)) {
                query = [query];
              }
              return query.forEach(function(query) {
                keys.push(key);
                queries.push(query);
              });
            });

            return components.mutationWatcher.run({
              callback: function(summaryList) {
                for (var i = 0, summary; summary = summaryList[i]; i++) {
                  if (summary.added.length === 0 && summary.removed.length === 0) {
                    continue;
                  }

                  var item = watchObj[keys[i]];

                  profile.summaryStack.push([item, summary]);
                }
              },
              queries: queries
            });
          };

          this.stop = function() {
            observer && observer.stop();
            observer = null;
          };

          this.start = function() {
            observer && observer.stop();
            observer = watch(profile, watchObj);
          };

          this.destroy = this.stop;
        },
        /**
         * @param profile
         * @constructor
         */
        SummaryStack: function(profile) {
          var stack = [];

          var templateObj = main.watchTemplateObj;

          var fnAsync = function(fn) {
            var args = [].slice.call(arguments);
            args.shift();

            return function(cb) {
              var isAsync = false;
              var self = {
                async: function() {
                  isAsync = true;
                  return function() {
                    return cb();
                  }
                }
              };

              fn.apply(self, args);

              if (!isAsync) {
                cb();
              }
            }
          };

          var next = function() {
            var stackItem = stack[0];
            if (!stackItem) {
              return;
            }

            var ready = function() {
              var pos = stack.indexOf(stackItem);
              if (pos !== -1) {
                stack.splice(pos, 1);
              }

              return next();
            };

            var item = stackItem[0];
            if (item.isPrice && !profile.matchPrice) {
              return ready();
            }

            var summary = stackItem[1];

            if (item.template) {
              ready = function(cb) {
                var template = templateObj[item.template];
                template && template(profile, summary, item);

                return cb();
              }.bind(null, ready);
            }

            if (item.cb) {
              ready = function(cb) {
                return fnAsync(item.cb, profile, summary)(function() {
                  return cb();
                });
              }.bind(null, ready);
            }

            return ready();
          };

          var checkStack = function() {
            var len = stack.length;

            if (len > 30) {
              stack.shift();
            }

            if (len !== 1) {
              return;
            }

            return next();
          };

          this.push = function(data) {
            stack.push(data);

            return checkStack();
          };
        },
        /**
         *
         * @param details
         * @constructor
         */
        Profile: function(details) {
          var profile = this;

          var key = null;
          var watchObj = {};
          for (key in details.formWatcher) {
            watchObj[key] = details.formWatcher[key];
          }
          for (key in details.priceWatcher) {
            watchObj[key] = details.priceWatcher[key];
            watchObj[key].isPrice = true;
          }

          this.matchPrice = false;
          this.summaryStack = new main.SummaryStack(profile);
          this.watcher = new main.Watcher(profile, watchObj);

          this.page = new main.Page(profile);
          this.page.setData = function(type, params) {
            params.type = type;

            var info = main.getInfoObj();
            for (var key in params) {
              info[key] = params[key];
            }

            main.onGetPageInfo(params);
          };

          var onProfileReady = function() {
            profile.watcher.start();
          };

          if (details.prepare) {
            details.prepare(function() {
              onProfileReady && onProfileReady();
            });
          } else {
            onProfileReady();
          }

          this.destroy = function() {
            onProfileReady = null;
            this.watcher && this.watcher.destroy();
          }
        },
        initProfile: function(details) {
          if (details.locationCheck && !details.locationCheck(location.href)) {
            tbr.error('Invalid location!', location.href);
            return;
          }

          this.currentProfile = details;

          if (this.profile) {
            this.profile.destroy();
          }

          this.profile = new this.Profile(details);
        },
        /**
         * @param {number} delay
         * @param {number} limit
         * @param {function} fn
         * @param {function} [cb]
         */
        waitResponse: function(delay, limit, fn, cb) {
          var waitResponse = this.waitResponse;
          return (function timer(retry) {
            tbr.log('waitResponse retry', retry);

            if (waitResponse.timer) {
              clearTimeout(waitResponse.timer);
            }

            if (retry < 0) {
              tbr.error('waitResponse response is empty!');
              cb && cb();
              return;
            }

            return fn(function(err) {
              if (!err) {
                tbr.log('waitResponse get response!');
                cb && cb();
                return;
              }

              waitResponse.timer = setTimeout(function() {
                waitResponse.timer = null;

                return timer(--retry);
              }, delay);
            });
          })(limit);
        }
      });

      monoUtils.extend(main, {
        currentProfile: null,
        infoList: {},
        closeCurrentBar: function() {
          var currentBar = main.bar.current;
          main.bar.isAborted = true;
          if (!currentBar || currentBar.isClosed) {
            return;
          }
          currentBar.close();
        },
        stopObserver: function() {
          this.profile && this.profile.destroy();
        },
        clearInfoObj: function(pageInfo) {
          for (var url in main.infoList) {
            if (main.infoList[url] !== pageInfo) {
              delete main.infoList[url];
            }
          }
        },
        getInfoObj: function() {
          var url = document.URL;
          var info = main.infoList[url];
          if (!info) {
            info = main.infoList[url] = {};
          }
          return info;
        },
        onGetPageInfo: function() {
          var pageInfo = this.getInfoObj();

          var obj = this[pageInfo.type];
          if (!obj) {
            return tbr.error('Type is not found!', pageInfo);
          }

          return obj.onGetData(pageInfo);
        },
        getParamsFromPage: function(varList, cb) {
          var isObjMode = false;
          if (typeof varList === 'object' && !Array.isArray(varList)) {
            isObjMode = Object.keys(varList);
            varList = isObjMode.map(function(key) {
              return varList[key];
            });
          }
          components.bridge({
            args: [varList],
            func: function(varList, cb) {
              var rList = [];
              varList.forEach(function(item) {
                var vars = item.split('.');
                var obj = window[vars.shift()];
                obj && vars.some(function(variable) {
                  if (typeof obj[variable] !== 'undefined') {
                    obj = obj[variable];
                  } else {
                    obj = null;
                    return true;
                  }
                });
                rList.push(obj);
              });
              cb(rList);
            },
            cb: function(_data) {
              var data = _data;
              if (isObjMode) {
                data = {};
                _data.forEach(function(item, index) {
                  data[isObjMode[index]] = item;
                });
              }
              return cb(data);
            }
          });
        },
        validatorMap: {
          origin: 'validateIataCode',
          destination: 'validateIataCode',

          dateStart: 'validateDate',
          dateEnd: 'validateDate',
          dateIn: 'validateDate',
          dateOut: 'validateDate',

          currency: 'validateCcy',
          adults: 'validateAdults',

          price: 'validatePrice',
          oneDayPrice: 'validatePrice',
          minPriceIn: 'validatePrice',
          minPriceOut: 'validatePrice',
          minPriceBoth: 'validatePrice',

          query: 'validateQuery',
          dayCount: 'validateNumber'
        },
        validate: function(key, value) {
          var validateFnName = this.validatorMap[key];

          if (validateFnName) {
            value = this[validateFnName](value);
          } else {
            tbr.error('validator is not found!', key, value);
          }

          return value;
        },
        validateIataCode: function(value) {
          if (/^[A-Z]{3}$/.test(value)) {
            return value.toUpperCase();
          }
          tbr.error('City validation error!', value);
          return null;
        },
        validateDate: function(value) {
          // yyyy-mm-dd
          if (/^\d{4}-\d{2}-\d{2}$/.test(value)) {
            return value;
          }
          // yyyy-mm
          if (/^\d{4}-\d{2}$/.test(value)) {
            return value;
          }
          tbr.error('Date validation error!', value);
          return null;
        },
        validateCcy: function(value) {
          if (/^[A-Z]{3}$/.test(value)) {
            return value;
          }
          tbr.error('Currency validation error!', value);
          return null;
        },
        validateNumber: function(value) {
          var int = parseInt(value);
          if (isNaN(int)) {
            tbr.error('Number validation error!', value);
            return null;
          }
          return int;
        },
        validateAdults: function(value) {
          var int = this.validateNumber(value);
          if (!int || int < 1) {
            tbr.error('Adults validation error!', value);
            return null;
          }
          return int;
        },
        validateQuery: function(value) {
          if (Array.isArray(value) && value.length) {
            return value;
          }
          tbr.error('Query validation error!', value);
          return null;
        },
        validatePrice: function(value) {
          if (!/^\d+(\.\d+)?$/.test(value)) {
            tbr.error('Price validation error!', value);
            return null;
          }

          return value;
        },
        preparePrice: function(node) {
          var value = node.textContent;
          if (!value) {
            tbr.log('Price is empty!', value);
            return null;
          }

          value = value.replace(',', '.');
          value = value.replace(/[^\d\.]/g, '');
          value = value.replace(/\.(\d{3,})/, "$1");
          var m = value.match(/(\d+)(\.\d+)?/);
          if (!m) {
            tbr.log('Price is empty 2!', value);
            return null;
          }
          value = m[1];
          if (m[2]) {
            value += m[2];
          }
          value = parseFloat(value);
          if (isNaN(value)) {
            tbr.log('Price is NaN!', value);
            return null;
          }
          return value;
        },
        reFormatDate: function(value, re, template) {
          if (re.test(value)) {
            if (typeof value === 'number') {
              value = value.toString();
            }
            var m = value.match(re);
            if (!m) {
              return null;
            }
            return template.replace(/\$(\d)/g, function(text, index) {
              return m[index];
            });
          }
          return null;
        }
      });
      var getProfileList = function(tbr) {
        var main = tbr.main;

        var profileList = {};

        profileList['*://*.skyscanner.*/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/transport\/flights\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#content-main',
                  is: 'added'
                },
                cb: function(profile, summary) {
                  var async = this.async();
                  var page = profile.page;

                  return main.getParamsFromPage({
                    origin: 'Skyscanner.ComponentContext.originIataCode',
                    destination: 'Skyscanner.ComponentContext.destinationIataCode',
                    dateStart: 'Skyscanner.ComponentContext.outboundDate',
                    dateEnd: 'Skyscanner.ComponentContext.inboundDate',
                    currency: 'Skyscanner.ComponentContext.currency'
                  }, function(dataObj) {
                    page.setType('avia');

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);
                    page.set('dateStart', dataObj.dateStart);
                    page.set('dateEnd', dataObj.dateEnd);
                    page.set('currency', dataObj.currency);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.card.result .mainquote-price',
                  is: 'added'
                },
                template: 'price'
              }
            }
          };

          return details;
        };


        profileList['*://*.momondo.*/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/flightsearch\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: [{
                  css: '#flight-list',
                  is: 'added'
                }, {
                  css: '.results',
                  is: 'removed'
                }],
                cb: function(profile, summary) {
                  var page = profile.page;

                  page.setType('avia');

                  var url = location.href;

                  var queryString = url.match(/#(.+)/) || url.match(/\?(.+)/);
                  queryString = queryString && queryString[1];
                  if (!queryString) {
                    page.clear();
                    return;
                  }

                  var params = monoUtils.parseUrl(queryString, {
                    params: 1
                  });

                  page.set('origin', params['SO0']);
                  page.set('destination', params['SD0']);

                  var dateStart = main.reFormatDate(params['SDP0'], /(\d{2})-(\d{2})-(\d{4})/, "$3-$2-$1");
                  page.set('dateStart', dateStart);

                  var dateEnd = main.reFormatDate(params['SDP1'], /(\d{2})-(\d{2})-(\d{4})/, "$3-$2-$1");
                  page.set('dateEnd', dateEnd);
                }
              },
              ccy: {
                query: {
                  css: '.ticketinfo .price .unit',
                  is: 'added'
                },
                template: 'currency'
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.ticketinfo .price .value',
                  is: 'added'
                },
                template: 'price'
              }
            },
            onShow: function(barHeight) {
              var header = document.querySelector('#mui-header');
              if (!header) {
                return;
              }
              header.style.marginTop = barHeight + 'px';
            },
            onHide: function() {
              var header = document.querySelector('#mui-header');
              if (!header) {
                return;
              }
              header.style.marginTop = 0;
            }
          };

          return details;
        };

        profileList['*://*.ozon.travel/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/flight\/search\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.content'
                },
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  return main.getParamsFromPage({
                    origin: 'a.data.SearchParams.CodeFrom1',
                    destination: 'a.data.SearchParams.CodeTo1',
                    dateStart: 'a.data.SearchParams.Date1',
                    dateEnd: 'a.data.SearchParams.Date2',
                    Date3: 'a.data.SearchParams.Date3',
                    CodeFrom2: 'a.data.SearchParams.CodeFrom2',
                    CodeTo2: 'a.data.SearchParams.CodeTo2'
                  }, function(dataObj) {
                    if (dataObj.Date3) {
                      tbr.error('More two params.');
                      page.clear();
                      async();
                      return;
                    }

                    if (dataObj.CodeFrom2 && (dataObj.origin !== dataObj.CodeTo2 || dataObj.destination !== dataObj.CodeFrom2)) {
                      tbr.error('More one way!', dataObj);
                      page.clear();
                      async();
                      return;
                    }

                    page.setType('avia');

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);
                    page.set('dateStart', dataObj.dateStart);
                    page.set('dateEnd', dataObj.dateEnd);

                    async();
                  });
                }
              },
              ccy: {
                query: {
                  css: '.tariffs .price',
                  is: 'added'
                },
                cb: function(profile, summary) {
                  var page = profile.page;

                  var ccy = document.querySelector('.currency-form .currency-filter input[name="Currency"]');
                  ccy = ccy && ccy.value;
                  if (ccy) {
                    ccy = ccy.replace(/[\s\t]/g, '');
                    page.set('currency', ccy);
                  }
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.tariffs .price',
                  is: 'added'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.onetwotrip.com/*'] = function() {
          var details = {
            formWatcher: {
              ctr: {
                query: [{
                  css: '#layout_results'
                }, {
                  css: '.loader'
                }],
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  return main.getParamsFromPage({
                    origin: 'xcnt_transport_from',
                    destination: 'xcnt_transport_to',
                    dateStart: 'xcnt_transport_depart_date',
                    dateEnd: 'xcnt_transport_return_date',
                    currency: 'tw.currency',
                    type: 'xcnt_transport_type'
                  }, function(dataObj) {
                    if (dataObj.type !== 'air') {
                      page.clear();
                      async();
                      return;
                    }

                    page.setType('avia');

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);

                    page.set('currency', dataObj.currency);

                    var dateStart = main.reFormatDate(dataObj.dateStart, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                    page.set('dateStart', dateStart);

                    var dateEnd = main.reFormatDate(dataObj.dateEnd, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                    page.set('dateEnd', dateEnd);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.price_button .money-formatted'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.kayak.*/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/flights\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#resbody'
                },
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  return main.getParamsFromPage({
                    origin: 'R9.globals.analytics.pixelContext.originCode',
                    destination: 'R9.globals.analytics.pixelContext.destinationCode',
                    dateStart: 'R9.globals.analytics.pixelContext.departureDate',
                    dateEnd: 'R9.globals.analytics.pixelContext.returnDate',
                    currency: 'R9.globals.analytics.pixelContext.site_currency',
                    tripType: 'R9.globals.analytics.pixelContext.roundTrip'
                  }, function(dataObj) {
                    page.setType('avia');

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);
                    page.set('currency', dataObj.currency);

                    var dateStart = main.reFormatDate(dataObj.dateStart, /(\d{4})-(\d{2})-(\d{2})/, "$1-$2-$3");
                    page.set('dateStart', dateStart);

                    var dateEnd = null;
                    if (dataObj.tripType) {
                      dateEnd = main.reFormatDate(dataObj.dateEnd, /(\d{4})-(\d{2})-(\d{2})/, "$1-$2-$3");
                    }
                    page.set('dateEnd', dateEnd);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.flightresult .results_price'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.travelocity.com/*'] = profileList['*://*.orbitz.com/*'] = profileList['*://*.expedia.com/*'] = function() {
          var getAvia = function() {
            return {
              locationCheck: function(url) {
                return /\/Flights-Search/.test(url);
              },
              formWatcher: {
                ctr: {
                  query: {
                    css: '#flightModuleList'
                  },
                  cb: function(profile) {
                    var async = this.async();
                    var page = profile.page;

                    return main.getParamsFromPage({
                      origin: 'IntentMediaProperties.flight_origin',
                      destination: 'IntentMediaProperties.flight_destination',
                      dateStart: 'IntentMediaProperties.travel_date_start',
                      dateEnd: 'IntentMediaProperties.travel_date_end',
                      currency: 'IntentMediaProperties.site_currency',
                      type: 'IntentMediaProperties.product_category',
                      tripType: 'IntentMediaProperties.trip_type'
                    }, function(dataObj) {
                      if (dataObj.type !== 'flights') {
                        page.clear();
                        async();
                        return;
                      }

                      page.setType('avia');

                      page.set('origin', dataObj.origin);
                      page.set('destination', dataObj.destination);
                      page.set('currency', dataObj.currency);

                      var dateStart = main.reFormatDate(dataObj.dateStart, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                      page.set('dateStart', dateStart);

                      var dateEnd = null;
                      if (dataObj.tripType === 'ROUND_TRIP') {
                        dateEnd = main.reFormatDate(dataObj.dateEnd, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                      }
                      page.set('dateEnd', dateEnd);

                      async();
                    });
                  }
                }
              },
              priceWatcher: {
                price: {
                  query: {
                    css: '#flightModuleList .offer-price .visuallyhidden'
                  },
                  template: 'price'
                }
              }
            };
          };

          var getHotel = function() {
            var requestBaseData = function(profile, cb) {
              var page = profile.page;

              return main.getParamsFromPage({
                city: 'IntentMediaProperties.hotel_city_name',
                name: 'IntentMediaProperties.hotel_supplier',
                adults: 'IntentMediaProperties.adults',
                rooms: 'IntentMediaProperties.hotel_rooms',
                dateIn: 'IntentMediaProperties.travel_date_start',
                dateOut: 'IntentMediaProperties.travel_date_end',
                currency: 'IntentMediaProperties.site_currency',
                pageId: 'IntentMediaProperties.page_id'
              }, function(dataObj) {
                if (dataObj.pageId === null) {
                  cb && cb(1);
                  return;
                }

                if (dataObj.pageId !== 'hotel.details' || dataObj.rooms > 1 || !dataObj.name) {
                  page.clear();
                  cb && cb(0);
                  return;
                }

                page.setType('hotel');

                var query = [dataObj.name];
                if (dataObj.city) {
                  query.unshift(dataObj.name + ' ' + dataObj.city);
                }
                page.set('query', query);

                page.set('adults', dataObj.adults);
                page.set('currency', dataObj.currency);

                var dateIn = main.reFormatDate(dataObj.dateIn, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                page.set('dateIn', dateIn);

                var dateOut = main.reFormatDate(dataObj.dateOut, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                page.set('dateOut', dateOut);

                cb && cb(0);
              });
            };

            return {
              locationCheck: function(url) {
                return /Hotel-Information/.test(url);
              },
              formWatcher: {
                ctr: {
                  query: [{
                    css: '.hotelInformation'
                  }],
                  cb: function(profile) {
                    var async = this.async();
                    return main.waitResponse(250, 20, function(cb) {
                      return requestBaseData(profile, cb);
                    }, function() {
                      return async();
                    });
                  }
                }
              },
              priceWatcher: {
                price: {
                  query: {
                    css: '#rooms-and-rates .room-price-info-wrapper .room-price'
                  },
                  template: 'price',
                  key: 'oneDayPrice'
                }
              }
            }
          };


          var details = null;

          if (/Hotel-Information/.test(location.href)) {
            details = getHotel();
          } else {
            details = getAvia();
          }

          return details;
        };

        profileList['*://*.priceline.com/*'] = function() {
          var getCityCode = function(airportCode) {
            var cityCode = airportCode;
            if (main.cache.airportMap) {
              var airportInfo = main.cache.airportMap[airportCode];
              if (airportInfo && airportInfo.city_code) {
                cityCode = airportInfo.city_code;
              } else {
                tbr.error('cityCode is not found!', airportCode);
              }
            }
            return cityCode;
          };

          var details = {
            locationCheck: function(url) {
              return /\/fly(\/#)?\/search\//.test(url);
            },
            prepare: function(cb) {
              main.avia.loadAirports(function() {
                return cb();
              });
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.fly-search-listings-container'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var url = location.href;
                  var m = url.match(/\/search\/([^-\/]+)-([^-\/]+)-([^-\/]+)\/(?:([^-\/]+)-([^-\/]+)-([^-\/]+)\/)?/);
                  if (!m) {
                    return;
                  }

                  page.setType('avia');

                  var origin = m[1].split(':')[0];
                  page.set('origin', getCityCode(origin));

                  var destination = m[2].split(':')[0];
                  page.set('destination', getCityCode(destination));

                  var dateStart = main.reFormatDate(m[3], /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                  page.set('dateStart', dateStart);

                  var dateEnd = main.reFormatDate(m[6], /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                  page.set('dateEnd', dateEnd);

                  var async = this.async();
                  main.getParamsFromPage({
                    currency: 'pclntms.dataDictionary.currencyCode'
                  }, function(dataObj) {
                    page.set('currency', dataObj.currency);

                    return async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.fly-itinerary .details .price'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.aeroflot.ru/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/webqtrip.html/.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.flight-list'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var dataArr = null;

                  var html = document.body.innerHTML;
                  var dataRe = /"itineraryAirportPairs":(\[[^\]]+])/;
                  monoUtils.getPageScript(html, dataRe).some(function(script) {
                    var m = script.match(dataRe);
                    m = m && m[1];
                    if (!m) {
                      return;
                    }

                    return monoUtils.findJson(m).some(function(arr) {
                      if (!Array.isArray(arr)) {
                        return;
                      }
                      if (arr.length > 2) {
                        tbr.error('More two way!');
                        return;
                      }
                      dataArr = arr;
                      return true;
                    });
                  });

                  if (!dataArr) {
                    tbr.error('Data is not found!');
                    return;
                  }

                  var originData = dataArr[0];

                  if (!originData) {
                    tbr.error('Origin data is not found!', dataArr);
                    return;
                  }

                  page.setType('avia');

                  page.set('origin', originData.departureCode);
                  page.set('destination', originData.arrivalCode);

                  var dateStart = main.reFormatDate(originData.date, /(\d{4})\/(\d{2})\/(\d{2})/, "$1-$2-$3");
                  page.set('dateStart', dateStart);

                  var dateEnd = null;
                  var destData = dataArr[1];
                  if (destData) {
                    dateEnd = main.reFormatDate(destData.date, /(\d{4})\/(\d{2})\/(\d{2})/, "$1-$2-$3");
                  }
                  page.set('dateEnd', dateEnd);

                  var ccy = /"currency":"([^"]{3})"/.exec(html);
                  ccy = ccy && ccy[1];
                  if (ccy) {
                    page.set('currency', ccy);
                  }
                }
              }
            },
            priceWatcher: {
              minPriceOut: {
                query: {
                  css: '#outbounds .flight-list .prices-all .prices-amount'
                },
                template: 'price',
                key: 'minPriceOut'
              },
              minPriceIn: {
                query: {
                  css: '#inbounds .flight-list .prices-all .prices-amount'
                },
                template: 'price',
                key: 'minPriceIn'
              },
              priceBoth: {
                query: {
                  css: '#both .flight-list .prices-all .prices-amount'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.anywayanyday.com/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/avia\/offers\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.offers-tickets-container'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var url = location.href;
                  var m = url.match(/\/avia\/offers\/(\d{2})(\d{2})(\w{3})(\w{3})(?:(\d{2})(\d{2})(\w{3})(\w{3}))?/);
                  if (!m) {
                    return;
                  }
                  m.shift();

                  page.setType('avia');

                  var isOneWay = !m[4];

                  if (!isOneWay && (m[2] !== m[7] || m[3] !== m[6])) {
                    tbr.error('More one way in URL!', m);
                    return;
                  }

                  var now = new Date();

                  var getFormatDate = function(month, date) {
                    var cYear = now.getUTCFullYear();
                    var cDate = now.getUTCDate();
                    var cMonth = now.getUTCMonth() + 1;
                    var intMonth = parseInt(month);
                    var intDate = parseInt(date);
                    if (cMonth > intMonth || (cMonth === intMonth && intDate < cDate)) {
                      cYear += 1;
                    }
                    return main.validateDate([cYear, month, date].join('-'));
                  };

                  page.set('origin', m[2]);
                  page.set('destination', m[3]);

                  var dateStart = getFormatDate(m[1], m[0]);
                  page.set('dateStart', dateStart);

                  var dateEnd = !isOneWay && getFormatDate(m[5], m[4]);
                  page.set('dateEnd', dateEnd);
                }
              },
              ccy: {
                query: {
                  css: '.header-sidebar-DropdownCurrency .b-menu-item-button-text'
                },
                template: 'currency'
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.offers-tickets-container .fareTickets .b-price'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.svyaznoy.travel/*'] = function() {
          var details = {
            formWatcher: {
              ctr: {
                query: [{
                  css: '#results'
                }, {
                  css: '.best-results-price'
                }],
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  main.getParamsFromPage({
                    origin: 'currentSearch.from_code',
                    destination: 'currentSearch.to_code',
                    dateStart: 'currentSearch.from_date',
                    dateEnd: 'currentSearch.to_date',
                    type: 'curDir'
                  }, function(dataObj) {
                    if (dataObj.type !== '/avia') {
                      page.clear();
                      async();
                      return;
                    }

                    page.setType('avia');

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);

                    var dateStart = main.reFormatDate(dataObj.dateStart, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                    page.set('dateStart', dateStart);

                    var dateEnd = main.reFormatDate(dataObj.dateEnd, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                    page.set('dateEnd', dateEnd);

                    if (document.querySelector('.sum_rub')) {
                      page.set('currency', 'RUB');
                    }

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.box-results-best .best-results-price'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://avia.tickets.ru/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/search\/results/.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.result_block'
                },
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  return main.getParamsFromPage({
                    origin: 'avia_form_search_params.from_code',
                    destination: 'avia_form_search_params.to_code',
                    dateStart: 'avia_form_search_params.departure_date',
                    dateEnd: 'avia_form_search_params.departure_date1',
                    fromCode1: 'avia_form_search_params.from_code1',
                    toCode1: 'avia_form_search_params.to_code1',
                    type: 'cur_domain_name'
                  }, function(dataObj) {
                    if (dataObj.type !== 'avia') {
                      tbr.error('Is not avia page!');
                      page.clear();
                      async();
                      return;
                    }

                    page.setType('avia');

                    if (dataObj.dateEnd && (dataObj.origin !== dataObj.toCode1 || dataObj.destination !== dataObj.fromCode1)) {
                      tbr.error('More one way', dataObj);
                      async();
                      return;
                    }

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);

                    var dateStart = main.reFormatDate(dataObj.dateStart, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                    page.set('dateStart', dateStart);

                    var dateEnd = main.reFormatDate(dataObj.dateEnd, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                    page.set('dateEnd', dateEnd);

                    async();
                  });
                }
              },
              ccy: {
                query: {
                  css: '.currency-change-block .nav-currency .iradio_minimal.checked + label'
                },
                template: 'currency',
                currencyMap: {
                  RUR: 'RUB'
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '#offers_table .item-block .price-block strong span:not(.hidden)'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.s7.ru/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/selectExactDateSearchFlights\.action/.test(url);
            },
            formWatcher: {
              ctr: {
                query: [{
                  css: '#expandSearchForm'
                }],
                cb: function(profile) {
                  var page = profile.page;

                  var origin = document.querySelector('#expandSearchForm input#departureLocationIataCode');
                  origin = origin && origin.value;

                  var destination = document.querySelector('#expandSearchForm input#arrivalLocationIataCode');
                  destination = destination && destination.value;

                  var dateStart = document.querySelector('#expandSearchForm input#departureDates');
                  dateStart = dateStart && dateStart.value;
                  if (dateStart) {
                    dateStart = main.reFormatDate(dateStart, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                  }

                  var dateEnd = document.querySelector('#expandSearchForm input[name="model.arrivalDate"]');
                  dateEnd = dateEnd && dateEnd.value;
                  if (dateEnd) {
                    dateEnd = main.reFormatDate(dateEnd, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                  }

                  var currency = document.querySelector('#expandSearchForm input[name="model.currencyType"]');
                  currency = currency && currency.value;

                  page.setType('avia');
                  page.set('origin', origin);
                  page.set('destination', destination);
                  page.set('dateStart', dateStart);
                  page.set('dateEnd', dateEnd);
                  page.set('currency', currency);
                }
              }
            },
            priceWatcher: {
              priceOut: {
                query: {
                  css: '#ibe_exact_outbound_flight_table .select-flights span[data-qa="amount"]'
                },
                template: 'price',
                key: 'minPriceOut'
              },
              travelWithPriceOut: {
                query: {
                  css: '#exact_outbound_flight_table .select-tariff span[data-qa="amount"]'
                },
                template: 'price',
                key: 'minPriceOut'
              },
              priceIn: {
                query: {
                  css: '#ibe_exact_inbound_flight_table .select-flights span[data-qa="amount"]'
                },
                template: 'price',
                key: 'minPriceIn'
              },
              travelWithPriceIn: {
                query: {
                  css: '#exact_inbound_flight_table .select-tariff span[data-qa="amount"]'
                },
                template: 'price',
                key: 'minPriceIn'
              }
            }
          };

          return details;
        };

        profileList['*://*.kupibilet.ru/*'] = function() {
          var details = {
            formWatcher: {
              ctr: {
                query: [{
                  css: '.results-list-wrap'
                }, {
                  css: '.preloader'
                }],
                cb: function(profile) {
                  var page = profile.page;

                  var url = location.href;
                  var m = url.match(/\/search\/(?:\w\d{3})(\d{2})(\w{3})(\w{3})(\w{3})(?:(\d{2})(\w{3})(\w{3})?)?/);

                  if (!m) {
                    return;
                  }
                  m.shift();

                  if (m[6]) {
                    tbr.error('More two way!', m);
                    return;
                  }

                  var isOneWay = !m[4];

                  var now = new Date();

                  var monthMap = {
                    'JAN': '01',
                    'FEB': '02',
                    'MAR': '03',
                    'APR': '04',
                    'MAY': '05',
                    'JUN': '06',
                    'JUL': '07',
                    'AUG': '08',
                    'SEP': '09',
                    'OCT': 10,
                    'NOV': 11,
                    'DEC': 12
                  };

                  var getFormatDate = function(month, date) {
                    month = monthMap[month];

                    if (!month) {
                      return null;
                    }

                    var cYear = now.getUTCFullYear();
                    var cDate = now.getUTCDate();
                    var cMonth = now.getUTCMonth() + 1;
                    var intMonth = parseInt(month);
                    var intDate = parseInt(date);
                    if (cMonth > intMonth || (cMonth === intMonth && intDate < cDate)) {
                      cYear += 1;
                    }
                    return main.validateDate([cYear, month, date].join('-'));
                  };

                  page.setType('avia');

                  page.set('origin', m[2]);
                  page.set('destination', m[3]);

                  var dateStart = getFormatDate(m[1], m[0]);
                  page.set('dateStart', dateStart);

                  var dateEnd = !isOneWay && getFormatDate(m[5], m[4]);
                  page.set('dateEnd', dateEnd);

                  if (document.querySelector('.fa-rub')) {
                    page.set('currency', 'RUB');
                  }
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: 'li.results-total div.results-total-sum > span > span',
                  is: 'added'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.trip.ru/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/flights\/searches\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#results-container'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var paramsEl = [].slice.call(document.querySelectorAll('#flights_view_type_tabs a'));
                  var url = null;
                  var re = /e_travel_flights_search/;
                  paramsEl.some(function(node) {
                    var hasParams = re.test(node.href);
                    if (hasParams) {
                      url = node.href;
                      return true;
                    }
                  });

                  if (!url) {
                    tbr.error('Search url is not found!');
                    return;
                  }

                  var params = monoUtils.parseUrl(url);

                  page.setType('avia');

                  var origin = params['e_travel_flights_search[from]'];
                  page.set('origin', origin);

                  var destination = params['e_travel_flights_search[to]'];
                  page.set('destination', destination);

                  var dateStart = params['e_travel_flights_search[departure]'];
                  page.set('dateStart', dateStart);

                  var dateEnd = params['e_travel_flights_search[return]'];
                  page.set('dateEnd', dateEnd);

                  var ccy = document.querySelector('#localization_selector_currency');
                  if (ccy && ccy.value) {
                    page.set('currency', ccy.value);
                  }
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.flights-product-details .price span > a'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.sindbad.ru/*'] = function() {
          var details = {
            formWatcher: {
              ctr: {
                query: [{
                  css: '.trips'
                }, {
                  css: '.wait_loop'
                }],
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  return main.getParamsFromPage({
                    origin: 'App.searchModel.attributes.request.src',
                    destination: 'App.searchModel.attributes.request.dst',
                    dateStart: 'App.searchModel.attributes.request.date_out',
                    dateEnd: 'App.searchModel.attributes.request.date_in'
                  }, function(dataObj) {
                    page.setType('avia');

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);
                    page.set('dateStart', dataObj.dateStart);
                    page.set('dateEnd', dataObj.dateEnd);

                    if (document.querySelector('.ruble')) {
                      page.set('currency', 'RUB');
                    }

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.trips .trip-worth .trip-worth__price',
                  is: 'added'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.aviakassa.ru/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/results\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: [{
                  css: '#resultList'
                }],
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  var formSwitch = document.querySelector('input[name="search[switch]"]');
                  formSwitch = formSwitch && formSwitch.value;

                  main.getParamsFromPage({
                    origin: 'APRT_DATA.searchTickets.codeFrom',
                    destination: 'APRT_DATA.searchTickets.codeDest',
                    dateStart: 'APRT_DATA.searchTickets.dateFrom',
                    dateEnd: 'APRT_DATA.searchTickets.dateTill',
                    type: 'APRT_DATA.searchTickets.type'
                  }, function(dataObj) {
                    if (dataObj.type !== 'avia') {
                      page.clear();
                      async();
                      return;
                    }

                    page.setType('avia');

                    if (formSwitch === 'mult') {
                      async();
                      return;
                    }

                    if (dataObj.dateStart === dataObj.dateEnd) {
                      if (formSwitch === 'ow') {
                        dataObj.dateEnd = null;
                      }
                    }

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);

                    var dateStart = main.reFormatDate(dataObj.dateStart, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                    page.set('dateStart', dateStart);

                    var dateEnd = main.reFormatDate(dataObj.dateEnd, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                    page.set('dateEnd', dateEnd);

                    async();
                  });
                }
              },
              ccy: {
                query: {
                  css: '.price'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var ccy = document.querySelector('.price');
                  if (ccy) {
                    if (/руб\./.test(ccy.textContent)) {
                      page.set('currency', 'RUB');
                    }
                  }
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '#resultList .flight-result .price'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.biletix.ru/*'] = function() {
          var details = {
            formWatcher: {
              ctr: {
                query: [{
                  css: '.flights'
                }, {
                  css: '.progress-ajax-border'
                }],
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  main.getParamsFromPage({
                    origin: 'xcnt_transport_from',
                    destination: 'xcnt_transport_to',
                    dateStart: 'xcnt_transport_depart_date',
                    dateEnd: 'xcnt_transport_return_date',
                    type: 'APRT_DATA.searchTickets.type'
                  }, function(dataObj) {
                    if (dataObj.type !== 'avia') {
                      page.clear();
                      async();
                      return;
                    }

                    page.setType('avia');

                    page.set('origin', dataObj.origin);
                    page.set('destination', dataObj.destination);

                    var dateStart = main.reFormatDate(dataObj.dateStart, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                    page.set('dateStart', dateStart);

                    var dateEnd = main.reFormatDate(dataObj.dateEnd, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                    page.set('dateEnd', dateEnd);

                    var ccy = document.querySelector('#currency_form .selected input[name="currency"]');
                    ccy = ccy && ccy.value;
                    if (ccy) {
                      if (ccy === 'RUR') {
                        ccy = 'RUB';
                      }
                      page.set('currency', ccy);
                    }

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.offers .offer .price .caption'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.utair.ru/*'] = function() {
          var details = {
            formWatcher: {
              ctr: {
                query: [{
                  css: '.directions_wrapper'
                }, {
                  css: '.progress-text'
                }],
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  page.setType('avia');

                  var origin = document.querySelector('.location.departure .code');
                  origin = origin && origin.textContent;
                  page.set('origin', origin);

                  var destination = document.querySelector('.location.arrival .code');
                  destination = destination && destination.textContent;
                  page.set('destination', destination);

                  var ccy = document.querySelector('input#matrix_currency[name="currency"]');
                  if (ccy) {
                    page.set('currency', ccy.value);
                  }

                  return main.getParamsFromPage({
                    dateStart: 'cfg_split_fares.selected_date_to',
                    dateEnd: 'cfg_split_fares.selected_date_back'
                  }, function(dataObj) {
                    var dateStart = main.reFormatDate(dataObj.dateStart, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                    page.set('dateStart', dateStart);

                    var dateEnd = main.reFormatDate(dataObj.dateEnd, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                    page.set('dateEnd', dateEnd);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              priceOut: {
                query: {
                  css: '.direction.direction-to .price'
                },
                template: 'price',
                key: 'minPriceOut'
              },
              priceIn: {
                query: {
                  css: '.direction.direction-back .price'
                },
                template: 'price',
                key: 'minPriceIn'
              }
            }
          };

          return details;
        };

        profileList['*://*.booking.*/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/hotel\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#hotelTmpl'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var hotelName = document.querySelector('#hp_hotel_name');
                  hotelName = hotelName && hotelName.textContent.trim();
                  if (!hotelName) {
                    return;
                  }

                  var async = this.async();
                  return main.getParamsFromPage({
                    city: 'utag_data.city_name',
                    country: 'utag_data.country_name',
                    dateIn: 'utag_data.date_in',
                    dateOut: 'utag_data.date_out',
                    currency: 'utag_data.currency',
                    adults: 'utag_data.adults'
                  }, function(dataObj) {
                    page.setType('hotel');

                    var query = [hotelName];
                    if (dataObj.city && dataObj.country) {
                      query.unshift(hotelName + ' ' + dataObj.city + ' ' + dataObj.country);
                    } else if (dataObj.city) {
                      query.unshift(hotelName + ' ' + dataObj.city);
                    } else if (dataObj.country) {
                      query.unshift(hotelName + ' ' + dataObj.country);
                    }

                    page.set('query', query);

                    page.set('dateIn', dataObj.dateIn);
                    page.set('dateOut', dataObj.dateOut);
                    page.set('currency', dataObj.currency);
                    page.set('adults', dataObj.adults);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.booking_summary .roomPrice strong'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.agoda.*/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/hotel\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#hotel-header'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var hotelName = document.querySelector('#hotelname');
                  hotelName && (hotelName = hotelName.textContent.trim());

                  var rooms = document.querySelector('div.occupancy-num.rooms');
                  rooms && (rooms = parseInt(rooms.textContent));

                  if (!hotelName || rooms != 1) {
                    return;
                  }

                  page.setType('hotel');

                  var dateIn = document.querySelector('input.checkin-input');
                  dateIn && (dateIn = dateIn.getAttribute('data-date'));
                  page.set('dateIn', dateIn);

                  var dateOut = document.querySelector('input.checkout-input');
                  dateOut && (dateOut = dateOut.getAttribute('data-date'));
                  page.set('dateOut', dateOut);

                  var adults = document.querySelector('div.occupancy-num.adults');
                  adults && (adults = parseInt(adults.textContent));
                  page.set('adults', adults);

                  var async = this.async();
                  return main.getParamsFromPage({
                    city: 'rtag_cityname'
                  }, function(dataObj) {

                    var enName = hotelName.match(/\((.+)\)$/);
                    enName = enName && enName[1];
                    if (enName) {
                      hotelName = hotelName.replace('(' + enName + ')', '');
                    }


                    var query = [hotelName];
                    if (enName) {
                      query.push(enName);
                    }
                    if (dataObj.city) {
                      if (enName) {
                        query.unshift(enName + ' ' + dataObj.city);
                      }
                      query.unshift(hotelName + ' ' + dataObj.city);
                    }

                    page.set('query', query);
                    async();
                  });
                }
              },
              ccy: {
                query: {
                  css: [
                    '#room-grid-table .price span.room-grouping-room-price',
                    '#room-grid-table .price-panel .sellprice'
                  ]
                },
                cb: function(profile) {
                  var page = profile.page;

                  var ccy = document.getElementById('currency');
                  ccy && (ccy = ccy.textContent);

                  page.set('currency', ccy);
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: [
                    '#room-grid-table .price span.room-grouping-room-price',
                    '#room-grid-table .price-panel .sellprice'
                  ]
                },
                template: 'price',
                key: 'oneDayPrice'
              }
            }
          };

          return details;
        };

        profileList['*://*.hotels.com/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/hotel\/|\/ho\d+\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#property-details'
                },
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  var name = document.querySelector('.vcard h1[itemprop="name"]');
                  name = name && name.textContent.trim();

                  main.getParamsFromPage({
                    dateIn: 'commonDataBlock.search.checkinDate',
                    dateOut: 'commonDataBlock.search.checkoutDate',
                    name: 'commonDataBlock.property.hotelName',
                    country: 'commonDataBlock.property.country',
                    city: 'commonDataBlock.property.city',
                    currency: 'commonDataBlock.property.featuredPrice.currency',
                    rooms: 'commonDataBlock.search.numRooms',
                    searchRooms: 'commonDataBlock.search.rooms'
                  }, function(dataObj) {
                    if (dataObj.rooms != 1 || !Array.isArray(dataObj.searchRooms) || dataObj.searchRooms.length !== 1 || !dataObj.searchRooms[0]) {
                      async();
                      return;
                    }

                    page.setType('hotel');

                    var query = [];
                    [dataObj.name, name].forEach(function(name, index) {
                      if (!name) {
                        return;
                      }

                      query.push(name);

                      var place = [dataObj.city, dataObj.country].filter(function(place) {
                        return !!place;
                      });
                      place = place.join(' ');

                      query.splice(index, 0, [name, place].join(' '));
                    });

                    page.set('query', query);

                    page.set('dateIn', dataObj.dateIn);
                    page.set('dateOut', dataObj.dateOut);
                    page.set('currency', dataObj.currency);

                    var adults = dataObj.searchRooms[0].numAdults;
                    page.set('adults', adults);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '#rooms-and-rates .current-price'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.ostrovok.ru/*'] = function() {
          var details = {
            formWatcher: {
              ctr: {
                query: {
                  css: [
                    '.rate-pricevalue',
                    '.hotel-metaroom-rate-pricevalue'
                  ]
                },
                cb: function(profile, summary) {
                  var page = profile.page;

                  var isRoom = /\/rooms\//.test(location.href);
                  var isHotel = /\/hotel\//.test(location.href);

                  if (!isRoom && !isHotel) {
                    page.clear();
                    return;
                  }

                  var async = this.async();
                  main.getParamsFromPage({
                    dateIn: 'qubit_event.page_checkin_date',
                    dateOut: 'qubit_event.page_checkout_date',
                    city: 'qubit_event.page_city',
                    country: 'qubit_event.page_country',
                    adults: 'qubit_event.page_adults',
                    currency: 'qubit_event.product_currency'
                  }, function(dataObj) {
                    page.setType('hotel');

                    var name = document.querySelector('h1.hotel-header-title');
                    name = name && name.textContent;

                    var query = [name];
                    if (dataObj.city && dataObj.country) {
                      query.unshift(name + ' ' + dataObj.city + ' ' + dataObj.country);
                    } else if (dataObj.city) {
                      query.unshift(name + ' ' + dataObj.city);
                    } else if (dataObj.country) {
                      query.unshift(name + ' ' + dataObj.country);
                    }
                    page.set('query', query);

                    page.set('adults', dataObj.adults);
                    page.set('currency', dataObj.currency);

                    var dateIn = main.reFormatDate(dataObj.dateIn, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                    page.set('dateIn', dateIn);

                    var dateOut = main.reFormatDate(dataObj.dateOut, /(\d{4})(\d{2})(\d{2})/, "$1-$2-$3");
                    page.set('dateOut', dateOut);

                    async();
                  });
                }
              },
              changePage: {
                query: {
                  css: 'h1.hotel-header-title',
                  is: 'removed'
                },
                cb: function(profile) {
                  var page = profile.page;

                  tbr.log('page change!');

                  main.closeCurrentBar();
                  page.clear();
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: [
                    '.rate-pricevalue',
                    '.hotel-metaroom-rate-pricevalue'
                  ]
                },
                cb: function(profile, summary) {
                  var page = profile.page;

                  var childNode = null;
                  var i = 0;
                  var price = null;
                  for (var n = 0, node; node = summary.added[n]; n++) {
                    i = 0;
                    while (childNode = node.childNodes[i]) {
                      i++;
                      if (childNode.nodeType === 3) {
                        var textContent = childNode.textContent.trim();
                        if (!textContent) {
                          continue;
                        }
                        price = main.preparePrice(childNode);
                        page.setPrice('price', price);
                      }
                    }
                  }
                }
              }
            }
          };

          return details;
        };

        profileList['*://*.travel.ru/*'] = function() {
          var getData = function(profile) {
            var page = profile.page;

            var ccy = document.querySelector('.switcher-city button');
            ccy = ccy && ccy.textContent;
            ccy = ccy && ccy.match(/([A-Z]{3})/);
            ccy = ccy && ccy[1];

            var name = document.querySelector('h1.b-hotel_title');
            name = name && name.textContent;
            name = name && name.trim();

            if (!ccy || !name) {
              return;
            }

            var url = location.href;
            var params = monoUtils.parseUrl(url);

            page.setType('hotel');

            var dateIn = main.reFormatDate(params.in, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
            page.set('dateIn', dateIn);

            var dateOut = main.reFormatDate(params.out, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
            page.set('dateOut', dateOut);

            var query = [name];
            var hotelName = document.querySelector('.breadcrumb > li.active > span[title]');
            hotelName = hotelName && hotelName.title;
            if (hotelName) {
              query.push(hotelName);
            }
            page.set('query', query);

            page.set('adults', params.occ);
            page.set('currency', ccy);
          };

          var details = {
            locationCheck: function(url) {
              return /\/hotel\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.b-av .b-av-rate_price_rub'
                },
                cb: function(profile) {
                  getData(profile);
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.b-av .b-av-rate_price_rub'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.oktogo.ru/*'] = function() {
          var getData = function(profile, cb) {
            var page = profile.page;

            return main.getParamsFromPage({
              name: 'APRT_DATA.currentProduct.name',
              dateIn: 'APRT_DATA.searchTickets.dateFrom',
              dateOut: 'APRT_DATA.searchTickets.dateTill',
              adults: 'APRT_DATA.searchTickets.count',
              currency: 'currency',
              type: 'APRT_DATA.searchTickets.type',
              country: 'APRT_DATA.searchTickets.country',
              city: 'APRT_DATA.searchTickets.dest'
            }, function(dataObj) {
              if (dataObj.type !== 'hotel' || !dataObj.name) {
                return cb(1);
              }

              page.setType('hotel');

              if (dataObj.name) {
                dataObj.name = dataObj.name.trim();
              }

              var query = [dataObj.name];
              if (dataObj.city && dataObj.country) {
                query.unshift(dataObj.name + ' ' + dataObj.city + ' ' + dataObj.country);
              } else if (dataObj.city) {
                query.unshift(dataObj.name + ' ' + dataObj.city);
              } else if (dataObj.country) {
                query.unshift(dataObj.name + ' ' + dataObj.country);
              }
              page.set('query', query);

              page.set('currency', dataObj.currency);

              var params = monoUtils.parseUrl(location.href);
              if (params.in && params.out) {
                var dateIn = main.reFormatDate(params.in, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                page.set('dateIn', dateIn);

                var dateOut = main.reFormatDate(params.out, /(\d{2})\.(\d{2})\.(\d{4})/, "$3-$2-$1");
                page.set('dateOut', dateOut);
              } else {
                page.set('dateIn', dataObj.dateIn);
                page.set('dateOut', dataObj.dateOut);
              }

              if (params.occ) {
                page.set('adults', params.occ);
              } else {
                page.set('adults', dataObj.adults);
              }

              cb();
            });
          };

          var details = {
            formWatcher: {
              ctr: {
                query: {
                  css: '.priceContainer *[data-price="period-price"] span.rub'
                },
                cb: function(profile) {
                  var async = this.async();
                  main.waitResponse(500, 20, function(cb) {
                    return getData(profile, cb);
                  }, function() {
                    return async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.priceContainer *[data-price="period-price"] span.rub'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.roomguru.ru/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/Hotel\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#ratesSearchResultsHolder'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var name = document.querySelector('h1.hc_htl_intro_name');
                  name = name && name.textContent.trim();
                  if (!name) {
                    return;
                  }

                  var params = monoUtils.parseUrl(location.href);
                  var adults = params.adults_1;

                  var place = params.destination;
                  place = place && place.match(/place:(.+)/);
                  place = place && place[1].trim();

                  var query = [name];
                  if (place) {
                    query.unshift(name + ' ' + place);
                  }

                  var async = this.async();

                  main.getParamsFromPage({
                    fields: 'HC.Common.fields',
                    gCurrencyCode: 'gCurrencyCode'
                  }, function(dataObj) {
                    var fields = dataObj.fields;
                    var ccy = dataObj.gCurrencyCode;

                    if (!fields || !ccy) {
                      async();
                      return;
                    }

                    page.setType('hotel');

                    page.set('query', query);
                    page.set('adults', adults);

                    page.set('dateIn', fields.checkin);
                    page.set('dateOut', fields.checkout);

                    page.set('currency', ccy);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '#hc_htl_pm_rates_content .hc_tbl_col2 #TotalLink'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.tripadvisor.ru/*'] = function() {
          var getData = function(profile, async) {
            var page = profile.page;

            var queryName = document.querySelector('h1.header');
            queryName = queryName && queryName.textContent.trim();

            var name = null;
            var altName = null;
            var nameNode = document.querySelector('h1.heading_name');
            if (nameNode) {
              nameNode = nameNode.cloneNode(true);
              var altHead = nameNode.querySelector('.altHead');
              if (altHead) {
                altName = altHead.textContent.trim();
                altHead.parentNode.removeChild(altHead);
              }
              name = nameNode.textContent.trim();
            }


            var tree = document.querySelector('.impressionTrackingTree');
            tree = tree && tree.innerHTML;

            if (!tree) {
              async();
              return;
            }

            var ccy = tree.match(/\\PC:([A-Z]{3})\\/);
            ccy = ccy && ccy[1];

            var dateIn = tree.match(/\\CI:(\d{4}-\d{2}-\d{2})\\/);
            dateIn = dateIn && dateIn[1];

            var dateOut = tree.match(/\\CO:(\d{4}-\d{2}-\d{2})\\/);
            dateOut = dateOut && dateOut[1];

            if (!name || !ccy || !dateIn || !dateOut) {
              async();
              return;
            }

            components.bridge({
              func: function(cb) {
                var obj = {
                  adultsCount: ta.retrieve('multiDP.adultsCount')
                };

                cb(obj);
              },
              cb: function(dataObj) {
                if (!dataObj || !dataObj.adultsCount) {
                  async();
                  return;
                }

                page.setType('hotel');

                page.set('dateIn', dateIn);
                page.set('dateOut', dateOut);
                page.set('currency', ccy);

                var query = [name];
                if (altName) {
                  query.push(altName);
                }
                if (queryName) {
                  query.unshift(queryName);
                }
                page.set('query', query);

                page.set('adults', dataObj.adultsCount);

                async();
              }
            });
          };

          var details = {
            formWatcher: {
              ctr: {
                query: {
                  css: '.viewDealChevrons .price'
                },
                cb: function(profile) {
                  var async = this.async();
                  getData(profile, async);
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.viewDealChevrons .price'
                },
                template: 'price',
                key: 'oneDayPrice'
              }
            }
          };

          return details;
        };

        profileList['*://*.hilton.com/*'] = profileList['*://*.hilton.ru/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/reservation\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#roomViewRegularView'
                },
                cb: function(profile) {
                  var page = profile.page;

                  var name = document.querySelector('h2.hotelNameNoLink');
                  name = name && name.textContent.trim();

                  var roomsAdults = document.querySelector('.sumOccupancy');
                  roomsAdults = roomsAdults && roomsAdults.textContent.trim();

                  var ccy = document.querySelector('select#changeCurrency');
                  ccy = ccy && ccy.value;

                  if (!name || !roomsAdults || !ccy) {
                    return;
                  }

                  var async = this.async();
                  main.getParamsFromPage({
                    dateInfo: 'digitalData.page.attributes.propertySearchDateInfo'
                  }, function(dataObj) {
                    if (!dataObj.dateInfo) {
                      async();
                      return;
                    }

                    page.setType('hotel');

                    var query = [name];
                    page.set('query', query);

                    roomsAdults = roomsAdults.match(/(\d+)/g);
                    if (roomsAdults[0] != '1') {
                      async();
                      return;
                    }
                    page.set('adults', roomsAdults[1]);

                    page.set('currency', ccy);

                    var searchDetails = dataObj.dateInfo.split(':');

                    var dateIn = searchDetails[1];
                    dateIn = main.reFormatDate(dateIn, /(\d{2})(\d{2})(\d{4})/, "$3-$1-$2");
                    page.set('dateIn', dateIn);

                    var dateOut = searchDetails[2];
                    dateOut = main.reFormatDate(dateOut, /(\d{2})(\d{2})(\d{4})/, "$3-$1-$2");
                    page.set('dateOut', dateOut);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.price .priceamount'
                },
                cb: function(profile, summary) {
                  var arr = [];
                  for (var n = 0, node; node = summary.added[n]; n++) {
                    node = node.cloneNode(true);
                    var del = node.querySelector('del');
                    if (del) {
                      del.parentNode.removeChild(del);
                    }
                    arr.push(node);
                  }
                  summary.added = arr;
                },
                template: 'price',
                key: 'oneDayPrice'
              }
            }
          };

          return details;
        };

        profileList['*://*.marriott.com/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/reservation\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.results-container'
                },
                cb: function(profile) {
                  var async = this.async();
                  var page = profile.page;

                  main.getParamsFromPage({
                    dataLayer: 'dataLayer'
                  }, function(dataObj) {
                    if (!dataObj.dataLayer) {
                      async();
                      return;
                    }

                    if (dataObj.dataLayer.numRooms > 1) {
                      async();
                      return;
                    }

                    page.setType('hotel');

                    var name = dataObj.dataLayer.prop_name;

                    var query = [name];
                    if (dataObj.dataLayer.prop_address_city) {
                      query.unshift(name + ' ' + dataObj.dataLayer.prop_address_city);
                    }
                    page.set('query', query);

                    var adults = dataObj.dataLayer.numGuestsPerRoom;
                    page.set('adults', adults);

                    var currency = null;

                    if (!currency) {
                      currency = document.querySelector('.m-pricing-block span.t-nightly');
                      currency = currency && currency.textContent;
                      currency = currency && currency.match(/([A-Z]{3})\//);
                      currency = currency && currency[1];
                    }

                    if (!currency) {
                      currency = document.head.innerHTML.match(/tm_currency_type\s*:\s*"(\w{3})"/);
                      currency = currency && currency[1];
                    }

                    if (!currency) {
                      currency = dataObj.dataLayer.prop_currency_type;
                    }
                    page.set('currency', currency);

                    var dateIn = dataObj.dataLayer.chckInDat;
                    dateIn = main.reFormatDate(dateIn, /(\d{2})\/(\d{2})\/(\d{4})/, "$3-$1-$2");
                    page.set('dateIn', dateIn);

                    var dateOut = dataObj.dataLayer.chckOutDate;
                    dateOut = main.reFormatDate(dateOut, /(\d{2})\/(\d{2})\/(\d{4})/, "$3-$1-$2");
                    page.set('dateOut', dateOut);

                    page.set('dayCount', dataObj.dataLayer.nmbNights);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.results-container .t-price'
                },
                template: 'price',
                key: 'oneDayPrice'
              }
            }
          };

          return details;
        };

        profileList['*://*.hostelworld.com/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/hosteldetails/.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.resultcolumn'
                },
                cb: function(profile) {
                  "use strict";
                  var page = profile.page;

                  var async = this.async();
                  return main.getParamsFromPage({
                    dataLayer: 'dataLayer',
                    currency: '$.currency.code'
                  }, function(dataObj) {
                    if (!Array.isArray(dataObj.dataLayer)) {
                      return async();
                    }

                    var query = [];
                    var name = null;

                    dataObj.dataLayer.forEach(function(obj) {
                      if (!obj || obj.gtmApplicationEnv !== 'production') {
                        return;
                      }

                      name = obj.gtmPropertyName;

                      var city = document.querySelector('input[name="city"]');
                      city = city && city.value;

                      var country = document.querySelector('input[name="country"]');
                      country = country && country.value;

                      if (city && country) {
                        query.push([name, city, country].join(' '));
                      } else if (city) {
                        query.push([name, city].join(' '));
                      } else if (country) {
                        query.push([name, country].join(' '));
                      }

                      query.push(name);

                      page.set('dateIn', obj.gtmArrivalDate);
                      page.set('dateOut', obj.gtmDepartureDate);
                      page.set('adults', obj.gtmTotalGuestCount);
                      page.set('dayCount', obj.gtmTotalGuestCount);
                    });

                    page.setType('hotel');

                    page.set('query', query);

                    page.set('currency', dataObj.currency);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.rooms tr > td > .averageprice.currency'
                },
                template: 'price',
                key: 'oneDayPrice'
              }
            }
          };

          return details;
        };

        profileList['*://*.tiket.com/*'] = function() {
          var getOutDate = function(dateIn, days) {
            var now = new Date(dateIn);
            var time = now.getTime();
            time += days * 24 * 60 * 60 * 1000;
            now = new Date(time);

            var year = now.getUTCFullYear();
            var month = now.getUTCMonth() + 1;
            if (month < 10) {
              month = '0' + month;
            }
            var date = now.getUTCDate();
            if (date < 10) {
              date = '0' + date;
            }
            return main.validateDate([year, month, date].join('-'));
          };

          var details = {
            locationCheck: function(url) {
              return /\/hotel\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '.pilih-kamar'
                },
                cb: function(profile) {
                  "use strict";
                  var page = profile.page;
                  page.setType('hotel');

                  var params = monoUtils.parseUrl(location.href);

                  if (params.room != 1) {
                    return;
                  }

                  var name = document.querySelector('.head h1');
                  name = name && name.textContent.trim();

                  var query = [name];

                  var address = document.querySelector('.head span[itemprop="address"]');
                  address = address && address.textContent.trim();

                  if (address) {
                    query.unshift(name + ' ' + address);
                  }

                  var place = document.title.match(/\(([^\)]+)\)/);
                  place = place && place[1].trim();
                  if (place) {
                    query.unshift(name + ' ' + place)
                  }

                  page.set('query', query);
                  page.set('dateIn', params.startdate);

                  page.set('dateOut', getOutDate(params.startdate, params.night));
                  page.set('adults', params.adult);

                  var ccy = document.querySelector('.money > a');
                  ccy = ccy && ccy.textContent.trim();
                  page.set('currency', ccy);
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.pilih-kamar .price > .currency'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.hotelsclick.com/*'] = function() {
          var roomTypeAdultMap = {
            DBC: 3,
            DBL: 2,
            EXTRA: 1,
            JRS: 2,
            QUD: 4,
            SGL: 1,
            STR: 2,
            TRC: 4,
            TRP: 3,
            TSU: 1,
            TWC: 3,
            TWN: 2
          };

          var details = {
            formWatcher: {
              ctr: {
                query: {
                  css: '.roomBooking'
                },
                cb: function(profile) {
                  "use strict";
                  var page = profile.page;

                  var params = monoUtils.parseUrl(location.href);
                  var roomType = null;
                  Object.keys(roomTypeAdultMap).some(function(type) {
                    if (params[type.toLowerCase()]) {
                      roomType = type;
                      return true;
                    }
                  });

                  var dateIn = params.from;
                  var dateOut = params.to;

                  var async = this.async();
                  return main.getParamsFromPage({
                    type: 'booking_rewrite',
                    rooms: 'current_room',
                    dateIn: 'global_fromdate',
                    dateOut: 'global_todate',
                    dayCount: 'global_nights',
                    roomType: 'nCode',
                    currency: 'currency'
                  }, function(dataObj) {
                    if (dataObj.type !== 'hotels') {
                      return async();
                    }

                    var adults = roomTypeAdultMap[dataObj.roomType || roomType];
                    if (!adults || dataObj.rooms != 1) {
                      return async();
                    }

                    page.setType('hotel');

                    var query = [];

                    var name = document.querySelector('h1.hotel');
                    name = name && name.textContent.trim();

                    query.push(name);

                    var hotelInfo = [].slice.call(document.querySelectorAll('.hotel_info strong')).slice(-1)[0];
                    hotelInfo = hotelInfo && hotelInfo.textContent.trim();
                    hotelInfo && query.unshift(name + ' ' + hotelInfo);

                    page.set('query', query);

                    page.set('dateIn', dataObj.dateIn || dateIn);
                    page.set('dateOut', dataObj.dateOut || dateOut);
                    page.set('adults', adults);
                    page.set('dayCount', dataObj.dayCount);
                    page.set('currency', dataObj.currency);

                    async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '.roomBooking .agreement-row div.total'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        profileList['*://*.hotelscombined.com/*'] = function() {
          var details = {
            locationCheck: function(url) {
              return /\/Hotel\//.test(url);
            },
            formWatcher: {
              ctr: {
                query: {
                  css: '#hc_htl_pm_rates_content'
                },
                cb: function(profile) {
                  "use strict";
                  var page = profile.page;
                  page.setType('hotel');

                  var params = monoUtils.parseUrl(location.href);

                  if (params.Rooms != 1) {
                    return;
                  }

                  var name = document.querySelector('h1.hc_htl_intro_name');
                  name = name && name.textContent.trim();

                  var query = [name];

                  var place = document.head.innerHTML.match(/HC\.Affiliate\.setCurrentPlaceName\('([^']+)'\)/);
                  place = place && place[1];
                  place && query.unshift(name + ' ' + place);

                  page.set('query', query);
                  page.set('dateIn', params.checkin);

                  page.set('dateOut', params.checkout);
                  page.set('adults', params.adults_1);

                  var async = this.async();
                  return main.getParamsFromPage({
                    currency: 'HC.gCurrencyCode'
                  }, function(dataObj) {

                    page.set('currency', dataObj.currency || params.currencyCode);

                    return async();
                  });
                }
              }
            },
            priceWatcher: {
              price: {
                query: {
                  css: '#hc_htl_pm_rates_content #TotalLink'
                },
                template: 'price'
              }
            }
          };

          return details;
        };

        return profileList;
      };
      main.profileList = getProfileList(tbr);
    })();
  }, function isAvailable(initData) {
    "use strict";
    var preference = initData.getPreference;

    if (!preference.hasAviaBar) {
      return false;
    }

    if (!preference.aviaBarEnabled) {
      return false;
    }

    return true;
  }, function syncIsAvailable() {
    "use strict";
    if (mono.isIframe()) {
      return false;
    }

    var list = [
      '*://*.ozon.travel/*',
      '*://*.onetwotrip.com/*',
      '*://*.skyscanner.*/*',
      '*://*.aeroflot.ru/*',
      '*://*.momondo.*/*',
      '*://*.anywayanyday.com/*',
      '*://*.svyaznoy.travel/*',
      '*://avia.tickets.ru/*',
      '*://*.s7.ru/*',
      '*://*.kupibilet.ru/*',
      '*://*.trip.ru/*',
      '*://*.sindbad.ru/*',
      '*://*.aviakassa.ru/*',
      '*://*.biletix.ru/*',
      '*://*.utair.ru/*',

      '*://*.kayak.*/*',
      '*://*.orbitz.com/*',
      '*://*.travelocity.com/*',
      '*://*.expedia.com/*',
      '*://*.priceline.com/*',

      '*://*.booking.*/*',
      '*://*.agoda.*/*',
      '*://*.hotels.com/*',
      '*://*.ostrovok.ru/*',
      '*://*.travel.ru/*',
      '*://*.oktogo.ru/*',
      '*://*.roomguru.ru/*',
      '*://*.tripadvisor.ru/*',
      '*://*.hilton.ru/*',
      '*://*.hilton.com/*',
      '*://*.marriott.com/*',

      '*://*.hostelworld.com/*',
      '*://*.tiket.com/*',
      '*://*.hotelsclick.com/*',
      '*://*.hotelscombined.com/*'
    ];

    for (var i = 0, item; item = list[i]; i++) {
      var re = new RegExp(mono.urlPatternToStrRe(item));
      if (re.test(location.protocol + '//' + location.hostname)) {
        mono.global.aviaBarProfile = item;
        mono.global.exAviaBar = true;
        return true;
      }
    }

    return false;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('vimeo', function(moduleName, initData) {
    "use strict";

    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleVimeo ? 1 : 0;
    var iframe = mono.isIframe();

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return vimeo.changeState(message.state);
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        vimeo.run();
      });
    }

    var vimeo = {
      panelId: 'savefrom__vimeo_links',
      btnBox: null,
      clipId: null,
      timer: null,
      btnPrefix: 'sd_ld_bnt_',
      popupIsShow: false,
      dlBtnClassName: 'sf-dl-btn',
      currentMenu: null,
      linkCache: {},

      run: function() {
        moduleState = 1;
        if (iframe) {
          vimeo.clipId = vimeo.getFrameClipId();
          if (vimeo.clipId) {
            return vimeo.appendIframeButtons();
          } else {
            iframe = false;
          }
        }

        this.videoFeed.injectStyle();

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          this.mutationMode.enable();
        }
      },

      changeState: function(state) {
        if (iframe) {
          return;
        }

        moduleState = state;

        vimeo.videoFeed.disable();

        vimeo.rmAllBtn();

        vimeo.mutationMode.stop();

        if (state) {
          vimeo.run();
        }
      },

      hideMenu: function() {
        if (vimeo.currentMenu) {
          vimeo.currentMenu.hide();
          vimeo.currentMenu = null;
        }
      },

      getFrameClipId: function() {
        var frameClipId = document.location.href.match(/player\.vimeo\.com\/video\/([\w\-]+)/i);
        frameClipId = frameClipId && frameClipId[1];
        if (frameClipId) {
          return frameClipId;
        }
      },

      getBrowserVideoData: function(container, id) {
        var btnParent = container.querySelector('.uploaded_on');
        if (!btnParent) {
          btnParent = container.querySelector('#info .meta .stats');
        }
        if (!btnParent) {
          return null;
        }
        if (id) {
          id = id.match(/([0-9]+)$/);
          id = id && id[1];
        }
        if (!id) {
          var firstLink = container.querySelector('a.js-title') || container.querySelector('a');
          if (!firstLink) {
            return;
          }
          var url = firstLink.getAttribute('href');
          if (!url) {
            return;
          }
          id = url.match(/\/([0-9]+)$/);
          id = id && id[1];
        }
        if (!id) {
          return;
        }
        return {
          id: id,
          parent: btnParent,
          style: 1
        };
      },

      getVideoId: function(container) {
        container = container || document;
        var id = null;
        var player;

        player = container.querySelector('.player[data-clip-id]');
        if (player) {
          return player.dataset.clipId;
        }

        player = container.querySelector('.player[data-fallback-url]');
        if (player) {
          var fallbackUrl = player.dataset.fallbackUrl || '';
          fallbackUrl = fallbackUrl.match(/video\/([0-9]+)\//);
          if (fallbackUrl) {
            return fallbackUrl[1];
          }
        }

        player = container.querySelector('div.player_wrapper > div.faux_player[data-clip_id]');
        if (player) {
          id = player.dataset.clip_id;
          if (id) {
            return id;
          }
        }
      },

      onBtnClick: function(videoData, e) {
        e.stopPropagation();
        e.preventDefault();
        var id = videoData.id;

        if (!id) {
          var container = null;
          if (videoData.playerContainer) {
            container = mono.getParent(videoData.parent, videoData.playerContainer);
          }
          id = vimeo.getVideoId(container);
        }

        if ([1].indexOf(preference.cohortIndex) !== -1) {
          var isBrowseContent = document.getElementById('browse_content');
          if (isBrowseContent && isBrowseContent.contains(this)) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'vimeo',
              ea: 'click',
              el: 'video-list'
            });
          } else {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'vimeo',
              ea: 'click',
              el: 'video-single'
            });
          }
          isBrowseContent = null;
        }

        if (vimeo.currentMenu && vimeo.currentMenu.isShow) {
          vimeo.hideMenu();
          return;
        }

        var fromCache = vimeo.linkCache[id];
        var links = language.download + ' ...';
        if (fromCache) {
          links = SaveFrom_Utils.popupMenu.prepareLinks.vimeo(fromCache.links, fromCache.title);
        }

        var details = {};
        if (videoData.style === 4) {
          details.offsetTop = 20;
        }

        var menu = vimeo.currentMenu = SaveFrom_Utils.popupMenu.quickInsert(this, links, 'sf-popupMenu', details);

        if (fromCache) {
          return;
        }

        mono.sendMessage({
          action: 'getVimeoLinks',
          extVideoId: id,
          url: location.href
        }, function(response) {
          if (response.links) {
            vimeo.linkCache[id] = response;
            var menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.vimeo(response.links, response.title);
            menu.update(menuLinks);
            return;
          }
          menu.update(language.noLinksFound);
        });
      },

      rmAllBtn: function() {
        ['sfSkip'].forEach(function(attr) {
          var dataAttr = mono.dataAttr2Selector(attr);
          var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
          for (var i = 0, item; item = dataAttrList[i]; i++) {
            item.removeAttribute(dataAttr);
          }
        });

        var btnList = document.querySelectorAll('.' + vimeo.dlBtnClassName);
        for (var i = 0, item; item = btnList[i]; i++) {
          if (item.dataset.sfType === '1' || item.dataset.sfType === '3') {
            item = item.parentNode;
          }
          item.parentNode.removeChild(item);
        }
        vimeo.videoFeed.rmBtn();

        vimeo.hideMenu();
      },

      appendBtn: function(videoData) {
        var box = videoData.parent;

        var exBtn = box.querySelector('.' + vimeo.dlBtnClassName);
        if (exBtn) {
          if (!exBtn.dataset.sfId) {
            return;
          }
          exBtn.parentNode.removeChild(exBtn);
          exBtn = null;
        }

        var btn;
        if (videoData.style === 1) {
          btn = mono.create('a', {
            text: language.download,
            class: [vimeo.dlBtnClassName, 'sf-style-1'],
            style: {
              display: 'inline'
            },
            data: {
              sfId: videoData.id,
              sfType: videoData.style
            },
            href: '#' + videoData.id
          });
        } else
        if (videoData.style === 2) {
          btn = mono.create('button', {
            text: language.download,
            class: [vimeo.dlBtnClassName, 'btn', 'iconify_down_b'],
            data: {
              sfId: videoData.id,
              sfType: videoData.style
            }
          });
        } else
        if (videoData.style === 3 || videoData.style === 5) {
          btn = mono.create('button', {
            class: [vimeo.dlBtnClassName, 'iris_btn', 'iris_btn-switch'],
            data: {
              sfId: videoData.id,
              sfType: videoData.style
            },
            append: [
              mono.create('span', {
                class: 'iris_btn-content',
                style: {
                  marginLeft: 0
                },
                text: language.download
              })
            ]
          });
        } else
        if (videoData.style === 4) {
          btn = mono.create('i', {
            class: [vimeo.dlBtnClassName, 'sf-style-4'],
            data: {
              sfId: videoData.id,
              sfType: videoData.style
            },
            style: {
              display: 'inline-block',
              border: '1px solid #F8F8F8',
              width: '20px',
              height: '20px',
              lineHeight: 0,
              cursor: 'pointer',
              marginLeft: '10px',
              verticalAlign: 'middle'
            },
            append: mono.create('style', {
              text: mono.style2Text([{
                selector: '.' + vimeo.dlBtnClassName + '.sf-style-4',
                style: {
                  background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#777777') + ') center no-repeat #F8F8F8',
                  backgroundSize: '12px'
                }
              }, {
                selector: '.' + vimeo.dlBtnClassName + '.sf-style-4:hover',
                style: {
                  background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#00B75A') + ') center no-repeat #F8F8F8',
                  backgroundSize: '12px'
                }
              }, {
                selector: '.' + vimeo.dlBtnClassName + '.sf-style-4:active',
                style: {
                  outline: 0,
                  boxShadow: 'inset 0 3px 5px rgba(0, 0, 0, 0.125)'
                }
              }])
            })
          });

          if (mono.isOpera) {
            btn.style.background = '#F8F8F8';
            btn.appendChild(mono.create('img', {
              src: SaveFrom_Utils.svg.getSrc('download', '#777777'),
              style: {
                width: '12px',
                height: '12px',
                margin: '4px',
                backgroundColor: '#F8F8F8'
              }
            }));
          }
        }

        btn.addEventListener('click', vimeo.onBtnClick.bind(btn, videoData));

        if (videoData.style === 1) {
          btn = mono.create('span', {
            append: [
              btn,
              ' | '
            ]
          });
        }

        if (videoData.style === 3) {
          btn = mono.create('div', {
            class: 'clip_info-user_actions',
            append: [
              btn
            ]
          });
        }

        if (videoData.style === 1 || videoData.style === 2) {
          var firstChild = box.firstChild;
          if (firstChild) {
            box.insertBefore(btn, firstChild);
          } else {
            box.appendChild(btn);
          }
        } else {
          box.appendChild(btn);
        }
      },

      playerStateChangeObserver: null,
      observeVideoUi: function(btnObj, node) {
        var playerMenu = node;
        if (playerMenu) {
          var hideBtnTimer = null;
          var controlsRe = /(\s|^)with-controls(\s|$)/;
          if (this.playerStateChangeObserver) {
            this.playerStateChangeObserver.stop();
          }
          this.playerStateChangeObserver = SaveFrom_Utils.mutationAttrWatcher.run({
            attr: 'class',
            target: playerMenu,
            callback: function(summaryList) {
              var summary = summaryList[0];
              var showBefore = !controlsRe.test(summary.oldValue);
              var showAfret = !controlsRe.test(summary.value);
              if (!showBefore && showAfret) {
                clearTimeout(hideBtnTimer);
                hideBtnTimer = setTimeout(function() {
                  if (!btnObj.lockHide) {
                    btnObj.container.classList.add('sf-hide-ui');
                  }
                }, 100);
              } else
              if (showBefore && !showAfret) {
                clearTimeout(hideBtnTimer);
                btnObj.container.classList.remove('sf-hide-ui');
              }
            }
          });
        }
      },

      appendIframeButtons: function() {
        var _this = this;
        var btnObj = SaveFrom_Utils.frameMenu.getBtn({
          quickBtnStyleObj: {
            display: 'inline-block',
            border: 0,
            borderRadius: '.3em',
            cursor: 'pointer',
            position: 'relative',
            padding: '6px 8px'
          },
          quickBtnCssStyle: {
            backgroundColor: 'rgba(23,35,34,.75)'
          },
          quickBtnOverCssStyle: {
            backgroundColor: 'rgb(0, 173, 239)'
          },
          nodeCssStyle: {
            display: 'none'
          },
          singleBtn: true,
          btnId: _this.panelId,
          containerStyle: {
            left: '10px',
            top: '10px'
          },
          quickBtnIcon: mono.create(SaveFrom_Utils.svg.getSvg('download', '#ffffff'), {
            style: {
              display: 'inline-block',
              width: '16px',
              height: '16px',
              verticalAlign: 'middle'
            }
          }),
          on: [
            ['click', function(e) {
              e.preventDefault();
              e.stopPropagation();

              if (_this.currentMenu && _this.currentMenu.isShow) {
                _this.hideMenu();
                return;
              }

              var id = _this.clipId;
              var fromCache = _this.linkCache[id];
              var links = language.download + ' ...';
              if (fromCache) {
                links = SaveFrom_Utils.popupMenu.prepareLinks.vimeo(fromCache.links, fromCache.title);
              }

              var menu = _this.currentMenu = SaveFrom_Utils.frameMenu.getMenu(this, links, 'sf-frame-menu', {
                leftMenuPos: true,
                container: btnObj.container,
                onShow: function() {
                  btnObj.node.classList.add('sf-over');
                },
                onHide: function() {
                  _this.currentMenu = null;
                  btnObj.node.classList.remove('sf-over');
                }
              });

              if (!fromCache) {
                _this.getLinksFromPage(function(links, title) {
                  var menuLinks = language.noLinksFound;
                  if (links) {
                    _this.linkCache[id] = {
                      links: links,
                      title: title
                    };
                    menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.vimeo(links, title);
                  }
                  menu.update(menuLinks);
                });
              }
            }],
            ['mousedown', function(e) {
              e.stopPropagation();
              if (e.button === 2) {
                if (observer) {
                  observer.stop();
                  observer = null;
                }

                _this.hideMenu();

                if (btnObj.container.parentNode) {
                  btnObj.container.parentNode.removeChild(btnObj.container);
                }
              }
            }]
          ]
        });

        btnObj.quickBtn.title = language.download;

        btnObj.container = mono.create('div', {
          class: 'sf-btn-ctr',
          append: btnObj.node
        });

        mono.on(btnObj.container, 'mouseenter', function() {
          btnObj.lockHide = true;
        });

        mono.on(btnObj.container, 'mouseleave', function() {
          btnObj.lockHide = false;
        });

        btnObj.node.appendChild(mono.create('style', {
          text: mono.style2Text([{
            selector: [
              'body:hover .sf-btn-ctr:not(.sf-hide-ui) #' + _this.panelId,
              'body:hover .sf-btn-ctr:not(.sf-hide-ui) .sf-frame-menu'
            ],
            style: {
              display: 'block'
            }
          }])
        }));

        document.body.appendChild(btnObj.container);


        var observer = SaveFrom_Utils.mutationWatcher.run({
          callback: function(summaryList) {
            var summary = summaryList[0];
            var node = summary.added[0];
            if (node) {
              _this.observeVideoUi(btnObj, node);
              setTimeout(function() {
                observer.stop();
                observer = null;
              }, 0);
            }
          },
          queries: [{
            css: '#player .captions[aria-live="assertive"]',
            is: 'added'
          }]
        });
      },

      getLinksFromPage: function(cb) {
        var reList = [
          /"video":{/,
          /"request":{/,
          /"files":/
        ];
        var scriptList = mono.getPageScript(document.body.innerHTML, reList);

        var config = null;
        scriptList.some(function(script) {
          var jsonList = mono.findJson(script, reList);
          return jsonList.some(function(json) {
            if (json.video && json.request && json.request.files) {
              config = json;
              return true;
            }
          });
        });
        var request = null;
        var links = null;
        var title = null;

        var onResponse = function(response) {
          if (response) {
            links = response.links || null;
            title = response.title || null;
          }

          return cb(links, title);
        };

        if (config) {
          request = {
            action: 'getVimeoLinksFromConfig',
            config: config
          };

          return mono.sendMessage(request, onResponse);
        } else {
          request = {
            action: 'getVimeoLinks',
            extVideoId: vimeo.clipId
          };

          return mono.sendMessage(request, onResponse);
        }
      },

      videoFeed: {
        btnClassName: 'sf-feed-dl-btn',
        style: null,
        onClick: function(e) {
          e.preventDefault();
          e.stopPropagation();

          var id = this.dataset.sfId;
          var isCouchMode = this.dataset.sfCouchMode > 0;

          if ([1].indexOf(preference.cohortIndex) !== -1) {
            var isBrozar = document.getElementById('brozar');
            var isBrowseContent = document.getElementById('browse_content');
            if (isCouchMode) {
              mono.sendMessage({
                action: 'trackCohort',
                t: 'event',
                ec: 'vimeo',
                ea: 'click',
                el: 'video-player'
              });
            } else
            if (isBrozar && isBrozar.contains(this)) {
              mono.sendMessage({
                action: 'trackCohort',
                t: 'event',
                ec: 'vimeo',
                ea: 'click',
                el: 'video-discover'
              });
            } else
            if (isBrowseContent && isBrowseContent.contains(this)) {
              mono.sendMessage({
                action: 'trackCohort',
                t: 'event',
                ec: 'vimeo',
                ea: 'click',
                el: 'video-list'
              });
            } else {
              mono.sendMessage({
                action: 'trackCohort',
                t: 'event',
                ec: 'vimeo',
                ea: 'click',
                el: 'video-other'
              });
            }
          }

          if (vimeo.currentMenu && vimeo.currentMenu.isShow) {
            vimeo.hideMenu();
            return;
          }

          var fromCache = vimeo.linkCache[id];
          var links = language.download + ' ...';
          if (fromCache) {
            links = SaveFrom_Utils.popupMenu.prepareLinks.vimeo(fromCache.links, fromCache.title);
          }

          var menu = vimeo.currentMenu = SaveFrom_Utils.popupMenu.quickInsert(this, links, 'sf-popupMenu');

          if (fromCache) {
            return;
          }

          var url = null;
          if (/"url"/.test(id)) {
            url = JSON.parse(id).url;
            id = null;
          }

          mono.sendMessage({
            action: 'getVimeoLinks',
            extVideoId: id,
            url: url
          }, function(response) {
            var menuLinks = null;
            if (response.links) {
              vimeo.linkCache[id] = response;
              menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.vimeo(response.links, response.title);
            } else {
              menuLinks = language.noLinksFound;
            }
            menu.update(menuLinks);
          });
        },
        getBtn: function(details) {
          var btn = mono.create('i', {
            class: details.classList,
            data: {
              sfId: details.id,
              sfCouchMode: details.isCouchMode ? 1 : 0
            },
            on: ['click', this.onClick]
          });

          if (mono.isOpera) {
            btn.style.background = '#F8F8F8';
            btn.appendChild(mono.create('img', {
              src: SaveFrom_Utils.svg.getSrc('download', '#777777'),
              style: {
                width: '12px',
                height: '12px',
                margin: '4px',
                backgroundColor: '#F8F8F8'
              }
            }));
          }

          return btn;
        },
        onImgOver2: function(e) {
          var link = this.parentNode;

          var parent;
          var id;

          if (link.tagName !== 'A') {
            return;
          }

          var href = link.getAttribute('href');
          if (!href) {
            return;
          }

          id = href.match(/^\/(\d+)$/);
          id = id && id[1];

          if (!id) {
            return;
          }

          parent = link.parentNode;
          if (!parent || !parent.classList.contains('contextclip-img')) {
            return;
          }

          if (parent.dataset.sfBtn > 0) {
            return;
          }
          parent.dataset.sfBtn = '1';

          var _this = vimeo.videoFeed;

          var classList = [_this.btnClassName, 'sf-type1-btn'];

          link.appendChild(vimeo.videoFeed.getBtn({
            id: id,
            classList: classList
          }));

          link = null;
          parent = null;
        },
        onImgOver: function(e) {
          var link = this.parentNode;

          var parent;
          var id;

          if (mono.matches(this, 'div.iris_video-vital') || mono.matches(this, 'li.clip_thumbnail')) {
            link = this.querySelector('.iris_thumbnail');
            parent = this;
            var linkNode = this.querySelector('a.iris_link-box');
            if (linkNode) {
              var url = linkNode.href;
              id = url.match(/\/([0-9]+)/);
              id = id && id[1];

              if (!id && url) {
                id = JSON.stringify({
                  'url': url
                });
              }
            }
          }

          if (!id && link.tagName == 'LI') {
            id = link.dataset.resultId;
            if (id && id.substr(0, 5) === 'clip_') {
              id = id.substr(5);
              parent = link;
              link = this.querySelector('.thumbnail_wrapper');
            } else {
              return;
            }
          }

          if (!id) {
            if (link.tagName !== 'A') {
              return;
            }
            id = link.dataset.clipId;

            parent = link.parentNode;
            if (!parent) {
              return;
            }
          }

          var isCouchMode = false;
          if (!id) {
            id = parent.id;
            isCouchMode = id.substr(0, 7) === 'item_id' && parent.classList.contains('clip');
            if (!isCouchMode && id.substr(0, 4) !== 'clip') {
              id = undefined;
            }
            if (!id && parent.tagName === 'ARTICLE' && parent.classList.contains('clip_item')) {
              id = link.getAttribute('href');
            }
            if (!id) {
              return;
            }

            id = id.match(/([0-9]+)$/);
            if (id) {
              id = id[1];
            }
          }

          var hasBtn = parent.dataset.sfBtn;
          if (hasBtn) {
            return;
          }
          parent.dataset.sfBtn = '1';

          var _this = vimeo.videoFeed;

          var classList = [_this.btnClassName];
          if (this.classList.contains('thumbnail_lg_wide')) {
            classList.push('sf-type1-btn');
          }

          if (this.classList.contains('clip_thumbnail') || this.classList.contains('iris_video-vital')) {
            classList.push('sf-type3-btn');
          }

          var ol = parent.parentNode;
          if (ol && ol.id === 'clips') {
            classList.push('sf-type1-btn');
            // classList.push('sf-type2-btn');
          }
          ol = null;

          if (isCouchMode) {
            classList.push('sf-type1-btn');
          }

          if (parent.classList.contains('promo_clip') && classList.length === 1) {
            classList.push('sf-type1-btn');
            // classList.push('sf-type2-btn');
          }

          link.appendChild(vimeo.videoFeed.getBtn({
            id: id,
            classList: classList,
            isCouchMode: isCouchMode
          }));

          link = null;
          parent = null;
        },
        injectStyle: function() {
          if (this.style) {
            !this.style.parentNode && document.head.appendChild(this.style);
            return;
          }

          this.style = mono.create('style', {
            text: mono.style2Text([{
              selector: [
                'a > .sf-feed-dl-btn',
                'a .sf-feed-dl-btn.sf-type3-btn'
              ],
              style: {
                display: 'none',
                border: '1px solid #F8F8F8',
                width: '20px',
                height: '20px',
                padding: 0,
                position: 'absolute',
                background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#777777') + ') center no-repeat #F8F8F8',
                backgroundSize: '12px',
                top: 'auto',
                left: 'auto',
                lineHeight: 0
              }
            }, {
              selector: [
                'a > .sf-feed-dl-btn.sf-type1-btn',
                'a > div > .sf-feed-dl-btn.sf-type3-btn'
              ],
              style: {
                top: 0
              }
            }, {
              selector: [
                'a > .sf-feed-dl-btn.sf-type2-btn'
              ],
              style: {
                opacity: 0.5
              }
            }, {
              selector: [
                'a > div > .sf-feed-dl-btn.sf-type3-btn'
              ],
              style: {
                zIndex: 10
              }
            }, {
              selector: [
                'a > .sf-feed-dl-btn:hover',
                'a > div > .sf-feed-dl-btn.sf-type3-btn:hover'
              ],
              style: {
                background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#00B75A') + ') center no-repeat #F8F8F8',
                backgroundSize: '12px'
              }
            }, {
              selector: [
                'a > .sf-feed-dl-btn.sf-type2-btn:hover'
              ],
              style: {
                opacity: 0.8
              }
            }, {
              selector: [
                'a > .sf-feed-dl-btn:active',
                'a > div > .sf-feed-dl-btn.sf-type3-btn:active'
              ],
              style: {
                outline: 0,
                boxShadow: 'inset 0 3px 5px rgba(0, 0, 0, 0.125)'
              }
            }, {
              selector: [
                'a:hover > .sf-feed-dl-btn',
                'a:hover > div > .sf-feed-dl-btn.sf-type3-btn'
              ],
              style: {
                display: 'block'
              }
            }])
          });

          document.head.appendChild(this.style);
        },
        disable: function() {
          if (this.style) {
            this.style.parentNode && this.style.parentNode.removeChild(this.style);
          }
        },
        rmBtn: function() {
          var btnList = document.querySelectorAll('.sf-feed-dl-btn');
          for (var i = 0, item; item = btnList[i]; i++) {
            item.parentNode.removeChild(item);
          }

          var dataAttr = mono.dataAttr2Selector('sfBtn');
          var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
          for (i = 0, item; item = dataAttrList[i]; i++) {
            item.removeAttribute(dataAttr);
          }
        }
      },
      mutationMode: {
        observer: null,
        stop: function() {
          if (this.observer) {
            this.observer.stop();
          }
        },
        wrapOnImgOver: function() {
          if (!moduleState) {
            return;
          }
          vimeo.videoFeed.onImgOver.apply(this, arguments);
        },
        wrapOnImgOver2: function() {
          if (!moduleState) {
            return;
          }
          vimeo.videoFeed.onImgOver2.apply(this, arguments);
        },
        enable: function() {
          if (this.observer) {
            return this.observer.start();
          }

          this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node, styleIndex, videoId;

              summary = summaryList[0];
              for (n = 0; node = summary.added[n]; n++) {
                vimeo.hideMenu();
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                styleIndex = 2;
                vimeo.appendBtn({
                  id: '',
                  parent: node,
                  style: styleIndex,
                  playerContainer: '#clip'
                });
              }

              summary = summaryList[1];
              for (n = 0; node = summary.added[n]; n++) {
                vimeo.hideMenu();
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                var stats = node.querySelector('.stats') || node.querySelector('.time');
                if (!stats) {
                  continue;
                }

                styleIndex = 1;
                vimeo.appendBtn({
                  id: '',
                  parent: stats,
                  style: styleIndex,
                  playerContainer: '#channel_clip_container'
                });
              }

              summary = summaryList[2];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                if (node.id.substr(0, 5) !== 'clip_') {
                  continue;
                }

                var videoData = vimeo.getBrowserVideoData(node, node.id);
                if (!videoData) {
                  continue;
                }

                vimeo.appendBtn(videoData);
              }

              summary = summaryList[3];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                mono.one(node, 'mouseover', vimeo.mutationMode.wrapOnImgOver);
              }

              summary = summaryList[4];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                var parent = mono.getParentByClass(node, 'clip_thumbnail');

                mono.one(parent, 'mouseover', vimeo.mutationMode.wrapOnImgOver);
              }

              summary = summaryList[5];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                var parent = mono.getParentByClass(node, 'iris_video-vital');

                mono.one(parent, 'mouseover', vimeo.mutationMode.wrapOnImgOver);
              }

              summary = summaryList[6];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                vimeo.hideMenu();

                var wrapper = mono.getParent(node, '.clip_info-wrapper');
                if (!wrapper) {
                  continue;
                }

                var clipInfoActions = wrapper.querySelector('.clip_info-actions');
                if (!clipInfoActions) {
                  continue;
                }

                styleIndex = 3;
                vimeo.appendBtn({
                  id: '',
                  parent: clipInfoActions,
                  style: styleIndex,
                  playerContainer: '.clip_main'
                });
              }

              summary = summaryList[7];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                vimeo.hideMenu();

                var wrapper = mono.getParent(node, '.clip_main-content');
                if (!wrapper) {
                  continue;
                }

                var clipInfoActions = wrapper.querySelector('.clip_info-bcf .clip_info-actions');
                if (!clipInfoActions) {
                  continue;
                }

                styleIndex = 5;
                vimeo.appendBtn({
                  id: '',
                  parent: clipInfoActions,
                  style: styleIndex,
                  playerContainer: '.clip_main'
                });
              }

              summary = summaryList[8];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                mono.one(node, 'mouseover', vimeo.mutationMode.wrapOnImgOver2);
              }

              summary = summaryList[9];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                styleIndex = 4;
                vimeo.appendBtn({
                  id: '',
                  parent: node,
                  style: styleIndex,
                  playerContainer: '.clip'
                });
              }
            },
            queries: [{
              css: '#clip #info #tools',
              is: 'added'
            }, {
              css: '#channel_clip_container #info .meta',
              is: 'added'
            }, {
              css: '#browse_content ol.browse_videos_videos > li',
              is: 'added'
            }, {
              css: 'img.thumbnail',
              is: 'added'
            }, {
              css: '.clip_thumbnail .iris_thumbnail img',
              is: 'added'
            }, {
              css: '.iris_video-vital .iris_thumbnail img',
              is: 'added'
            }, {
              css: '.clip_main .clip_info a.js-user_link.iris_link-header',
              is: 'added'
            }, {
              css: '.clip_main .clip_main-content div.iris_desc-content.description-content p',
              is: 'added'
            }, {
              css: '.contextclip-img img',
              is: 'added'
            }, {
              css: '.client_wrapper .clip header h1',
              is: 'added'
            }]
          });
        }
      }
    };

  }, null, function syncIsActive() {
    "use strict";

    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.vimeo.com/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('vk', function(moduleName, initData) {
    "use strict";

    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleVkontakte ? 1 : 0;
    var allowDownloadMode = mono.isSafari || mono.isChrome || mono.isFF || (mono.isGM && mono.isTM);

    var iframe = mono.isIframe();
    var videoExt = false;

    if (iframe) {
      if (/\/video_ext\.php\?.+/.test(location.href)) {
        videoExt = true;
      } else
      if (/\/widget_comments\.php\?.+/.test(location.href)) {
        iframe = false;
      } else {
        return;
      }
    }

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return vk.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'updateLinks') {
        updateLinks();
      }
      if (message.action === 'downloadMP3Files') {
        if (allowDownloadMode) {
          audio.downloadMP3Files();
        } else {
          audio.showListOfAudioFiles(false);
        }
      }
      if (message.action === 'downloadPlaylist') {
        audio.showListOfAudioFiles(true);
      }
      if (message.action === 'downloadPhotos') {
        photo.downloadPhoto();
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        vk.run();
      });
    }

    var vk = {
      contextMenu: null,
      isMutation: false,
      run: function() {
        moduleState = 1;

        if (/m\.vk\.com/.test(location.hostname)) {
          return mVk.run();
        }

        if (videoExt) {
          video.addFrameBtn();
          return;
        }

        photo.injectStyle();

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          vk.isMutation = true;
          audio.addCustomStyle();
          vk.mutationMode.enable();
        }
      },
      changeState: function(state) {
        if (iframe) {
          return;
        }
        moduleState = state;
        removeDownloadLinks();
        audio.hideLinks();

        videoFeed.off();

        vk.hideMenu();

        photo.rmCurrentPhotoBtn();

        audio.rmBitrate();

        photo.rmPhotoAlbumDlBtn();

        vk.mutationMode.stop();

        if (state) {
          vk.run();
        }
      },
      hideMenu: function() {
        if (vk.contextMenu) {
          vk.contextMenu.hide();
          vk.contextMenu = null;
        }
      },
      mutationMode: {
        observer: null,
        stop: function() {
          if (this.observer) {
            this.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        wrapNewAudioOnMouseOver: function() {
          if (!moduleState) {
            return;
          }
          audio.onNewMouseOver.apply(this, arguments);
        },
        wrapVideoFeedOnMouseOver: function() {
          if (!moduleState) {
            return;
          }
          videoFeed.onLinkHover.apply(this, arguments);
        },
        enable: function() {
          if (this.observer) {
            return this.observer.start();
          }

          this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node;

              summary = summaryList[0];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                mono.one(node, 'mouseover', vk.mutationMode.wrapVideoFeedOnMouseOver);
              }

              summary = summaryList[1];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                var layer = SaveFrom_Utils.getParentById(node, 'mv_box');
                var player = video.getPlayerNode(layer);

                if (player) {
                  video.getLinksFromPlayer(layer, player, video.newAppendButton.bind(video));
                }
              }

              summary = summaryList[2];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                photo.addNewPhotoAlbumDlBtn(node);
              }

              summary = summaryList[3];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                photo.addNewDlCurrentPhotoBtn(node);
              }

              for (i = 4; i < 7; i++) {
                summary = summaryList[i];
                for (n = 0; node = summary.added[n]; n++) {
                  if (node.dataset.sfSkip > 0) {
                    continue;
                  }
                  node.dataset.sfSkip = '1';

                  mono.one(node, 'mouseover', vk.mutationMode.wrapNewAudioOnMouseOver);
                }
              }

              summary = summaryList[7];
              for (n = 0; node = summary.removed[n]; n++) {
                mono.onRemoveListener(node);
              }
            },
            queries: [{
                css: '.post_video_desc a.lnk',
                is: 'added'
              },

              {
                css: '#mv_box #mv_player_box > .video_box_wrap',
                is: 'added'
              },

              {
                css: '#photos_all_block',
                is: 'added'
              },

              {
                css: '.pv_photo_wrap .pv_img_area_wrap',
                is: 'added'
              },

              {
                css: '.audio_row',
                is: 'added'
              }, {
                css: '.top_audio_player .top_audio_player_title',
                is: 'added'
              }, {
                css: '.audio_page_player .audio_page_player_title',
                is: 'added'
              },

              {
                css: '.' + mono.onRemoveClassName,
                is: 'removed'
              }
            ]
          });
        }
      }
    };

    var downloadLinkClassName = 'savefrom_vk_download';

    var updateLinks = function() {
      vk.changeState(0);
      vk.changeState(1);
    };

    var removeDownloadLinks = function() {
      var selector = 'a.' + downloadLinkClassName +
        ',div.' + downloadLinkClassName +
        ',span.' + downloadLinkClassName;

      audio.lastRow = null;

      var e = document.querySelectorAll(selector);
      for (var i = e.length - 1; i >= 0; i--) {
        if (audio.elIsHidden(e[i])) {
          e[i].parentNode.removeChild(e[i]);
        }
      }
    };

    var getFolderName = function() {
      var folderName = document.title;
      var sep = folderName.indexOf('|');
      if (sep !== -1) {
        folderName = folderName.substr(0, sep - 1);
      }

      return mono.fileName.modify(folderName);
    };

    var parseVkResponse = function(data) {
      var intval = function(e) {
        return e === !0 ? 1 : parseInt(e) || 0
      };

      var floatval = function(e) {
        return e === !0 ? 1 : parseFloat(e) || 0
      };

      var e = data.split('<!>');
      for (var o = e.length - 1; o >= 0; --o) {
        var n = e[o];
        if ("<!" == n.substr(0, 2)) {
          var a = n.indexOf(">"),
            i = n.substr(2, a - 2);
          switch (n = n.substr(a + 1), i) {
            case "json":
              var json = null;

              try {
                json = JSON.parse(n);
              } catch (e) {}

              e[o] = json;
              break;
            case "int":
              e[o] = intval(n);
              break;
            case "float":
              e[o] = floatval(n);
              break;
            case "bool":
              e[o] = intval(n) ? !0 : !1;
              break;
            case "null":
              e[o] = null;
              break;
            case "pageview_candidate":
              e.pop();
              break;
            case "debug":
              e.pop()
          }
        }
      }
      return e;
    };

    var rmEmTags = function(str) {
      var re = /<em>.*<\/em>/;
      if (re.test(str)) {
        str = str.replace(/<\/?em>/g, '');
      }
      return str;
    };


    ///////////////////////////////////////////////////////////////////
    //  AUDIO

    var audio = {
      audioElClassList: ['audio', 'audioRow', 'audioRowWall'],
      lastRow: null,
      className: downloadLinkClassName,
      cache: {},

      /**
       * @param {Array} idList
       * @param {Function} cb
       * @returns {{abort: Function}}
       */
      getNewTrackListByIds: function(idList, cb, retry) {
        if (retry === undefined) {
          retry = 5;
        }

        var _this = this;
        var limit = 10;

        if (idList.length > limit) {
          return (function() {
            idList = idList.slice(0);
            var _trackList = {};

            var async = new mono.AsyncList(function() {
              return cb(null, _trackList);
            });

            async.wait();

            var next = function() {
              var list = idList.splice(0, limit);
              async.wait();
              setTimeout(function() {
                _this.getNewTrackListByIds(list, function(err, trackList) {
                  idList.length && next();

                  if (err) {
                    return async.ready();
                  }

                  for (var fullId in trackList) {
                    _trackList[fullId] = trackList[fullId];
                  }

                  return async.ready();
                });
              }, 250);
            };
            next();
            next();

            async.ready();
          })();
        }

        var cache = _this.cache;

        var ids = [];
        var trackList = {};
        idList.forEach(function(fullId) {
          var track = cache[fullId];
          if (track) {
            trackList[fullId] = track;
          } else {
            ids.push(fullId);
          }
        });

        if (!ids.length) {
          return cb(null, trackList);
        }

        return mono.request({
          type: 'POST',
          data: mono.param({
            act: 'reload_audio',
            al: 1,
            ids: ids.join(',')
          }),
          url: '/al_audio.php',
          localXHR: true
        }, function(err, resp, data) {
          if (err) {
            return cb(err);
          }

          if (!data) {
            return cb("Data is empty!");
          }

          try {
            var resp = parseVkResponse(data);

            var playlistArr = resp[5];

            /*if (!playlistArr && retry > 0) {
              return setTimeout(function () {
                return _this.getNewTrackListByIds(idList, cb, --retry);
              }, 250);
            }*/

            playlistArr && playlistArr.forEach(function(track) {
              var fullId = track[1] + '_' + track[0];
              trackList[fullId] = track;
              cache[fullId] = track;
            });

            Object.keys(cache).slice(1000).forEach(function(fullId) {
              delete cache[fullId];
            });

            if (!Object.keys(trackList).length) {
              throw "Track list is empty!";
            }

            return cb(null, trackList);
          } catch (e) {
            return cb(e);
          }
        });
      },

      getLinksFromJson: function(albumData, list, onSuccess, onError) {
        if (!list['all']) {
          return onError();
        }
        var trackList = [];
        var linkList = {};
        for (var i = 0, item; item = list['all'][i]; i++) {
          if (albumData.aId !== undefined && item[8] !== albumData.aId) {
            continue;
          }
          var aId = item[0] + '_' + item[1];
          if (linkList[aId] !== undefined) {
            continue;
          }
          var url = item[2];
          var title = mono.fileName.decodeSpecialChars(mono.decodeUnicodeEscapeSequence(item[5] + ' - ' + item[6]));

          trackList.push({
            url: url,
            title: title,
            filename: mono.fileName.modify(title + '.mp3')
          });
          linkList[aId] = url;
        }

        if (trackList.length === 0) {
          return onError();
        }
        onSuccess(linkList, trackList);
      },

      getAudioLinksViaAPI: function(albumData, onSuccess, onError, reSend) {
        var _this = this;
        var params = {
          act: 'load_audios_silent',
          al: 1
        };
        if (albumData.gid !== undefined) {
          params.gid = albumData.gid;
        }
        if (albumData.id !== undefined) {
          params.id = albumData.id;
        }
        if (albumData.please_dont_ddos === undefined) {
          albumData.please_dont_ddos = 2;
        }
        params.please_dont_ddos = albumData.please_dont_ddos;
        var post = mono.param(params);
        if (reSend === undefined) {
          reSend = 0;
        }

        var onXhrError = function() {
          if (reSend > 2) {
            return onError();
          }
          setTimeout(function() {
            _this.getAudioLinksViaAPI(albumData, onSuccess, onError, ++reSend);
          }, 250);
        };

        return mono.request({
          type: 'POST',
          url: '/' + albumData.page,
          data: post,
          timeout: 60 * 1000,
          localXHR: true
        }, function(err, resp, data) {
          if (err) {
            return onXhrError();
          }

          if (!data) {
            return onError();
          }

          try {
            var str = parseVkResponse(data)[5];
            if (!str || str[0] !== '{') {
              throw "Data is empty!";
            }

            var regexp1 = /"/g;
            str = str.replace(/'/g, '"').replace(/<([^>]*)>/g, function(str, arg1) {
              var r = arg1.replace(regexp1, '\'');
              return '<' + r + '>';
            });

            var list = JSON.parse(str);
          } catch (e) {
            return onError();
          }

          return _this.getLinksFromJson(albumData, list, onSuccess, onError);
        });
      },

      getLinksFromAlbum: function(albumData, cb) {
        this.getAudioLinksViaAPI(albumData, cb, function onError() {
          cb();
        });
      },

      getAlbumId: function(url) {
        var albumData = undefined;
        var m1 = url.match(/audios(\d+)/);
        if (m1 !== null) {
          albumData = {
            page: 'audio',
            id: m1[1],
            gid: 0
          };
        }
        var m1 = url.match(/audios-(\d+)/);
        if (m1 !== null) {
          albumData = {
            page: 'audio',
            id: 0,
            gid: m1[1]
          };
        }
        var allowArgs = false;
        var aId = url.match(/album_id=(\d+)/);
        if (aId) {
          albumData.aId = aId[1];
          allowArgs = true;
        }
        if (allowArgs === false) {
          var friendId = url.match(/friend=(\d+)/);
          if (friendId) {
            delete albumData.gid;
            albumData.id = friendId[1];
            albumData.please_dont_ddos = 3;
            allowArgs = true;
          }
        }

        if (allowArgs === false && url.indexOf('?') !== -1) {
          return;
        }
        return albumData;
      },

      getNewNodeTrackInfo: function(node, cb) {
        var _this = this;
        var track = _this.readNewDataAudio(node.dataset.audio);

        var info = _this.getNewTrackInfo(track);
        if (!info) {
          return cb("Track info is not found!");
        }

        if (info.url) {
          return cb(null, info);
        } else
        if (info.fullId) {
          return cb(null, info);
        } else {
          return cb("Track info is not found!");
        }
      },

      getNewAudioLinks: function(container, cb, skipAlbumIdCheck, noReply) {
        var _this = this;
        container = container || document;
        var fromPage = container === document;

        if (!skipAlbumIdCheck && fromPage) {
          var albumInfo = this.getAlbumId(location.href);
          if (albumInfo) {
            return this.getLinksFromAlbum(albumInfo, function(linkList, trackList) {
              if (!linkList) {
                return _this.getNewAudioLinks(container, cb, 1);
              } else {
                return cb(linkList, trackList);
              }
            });
          }
        }

        var fullIdList = [];

        var async = new mono.AsyncList(function() {
          var abort = null;
          var popup = photo.getPopup('', 'audio', function onClose() {
            abort = true;
          });
          popup.onPrepare(language.download + ' ...');

          var _trackList = {};

          var async = new mono.AsyncList(function() {
            if (abort) {
              return;
            }

            var linkList = {};
            var trackList = [];

            fullIdList.forEach(function(fullId) {
              var track = _trackList[fullId];
              var info = track && _this.getNewTrackInfo(track);
              if (!info || !info.url) {
                return;
              }

              var filename = _this.getNewAudioFilename(info);
              var fullTitle = _this.getNewAudioFullTitle(info);

              linkList[info.fullId] = info.url;

              trackList.push({
                url: info.url,
                title: fullTitle,
                filename: filename
              });
            });

            popup.onReady();

            return cb(linkList, trackList);
          });

          async.wait();

          var idsList = fullIdList.slice(0);
          var max = fullIdList.length;
          var count = 0;
          var next = function() {
            var list = idsList.splice(0, 20);
            popup.onProgress(count, max);
            async.wait();
            setTimeout(function() {
              _this.getNewTrackListByIds(list, function(err, trackList) {
                idsList.length && !abort && next();

                if (err) {
                  return async.ready();
                }

                for (var fullId in trackList) {
                  count++;
                  _trackList[fullId] = trackList[fullId];
                }

                return async.ready();
              });
            }, 250);
          };
          next();

          return async.ready();
        });

        async.wait();

        [].slice.call(container.querySelectorAll('.audio_row')).forEach(function(node) {
          if (fromPage && _this.elIsHidden(node)) {
            return;
          }

          if (noReply && photo.isReply(node)) {
            return;
          }

          async.wait();
          return _this.getNewNodeTrackInfo(node, function(err, info) {
            if (err || !info.fullId) {
              return async.ready();
            }

            if (fullIdList.indexOf(info.fullId) === -1) {
              fullIdList.push(info.fullId);
            }

            return async.ready();
          });
        });

        return async.ready();
      },

      getTitle: function(container, id) {
        if (!id || !container) {
          return '';
        }

        var name = '';

        var performer = container.querySelector('#performer' + id);
        if (performer === null) {
          performer = container.querySelector('#performerWall' + id);
        }
        if (performer === null) {
          performer = container.querySelector('.info b');
        }

        var title = container.querySelector('#title' + id);
        if (title === null) {
          title = container.querySelector('#titleWall' + id);
        }
        if (title === null) {
          title = container.querySelector('span.title');
        }

        if (performer !== null && performer.textContent) {
          name += performer.textContent.trim();
        }

        if (title !== null && title.textContent) {
          if (name) {
            name += ' - ';
          }

          name += title.textContent.trim();
        }

        if (name) {
          return name.replace(/\<a\s+[^\>]+\>/ig, '').replace(/\<\/a\>/ig, '');
        }

        return '';
      },

      secondsFromDuration: function(value) {
        var m = value.match(/^(?:\s*(\d+)\s*\:)?\s*(\d+)\s*\:\s*(\d+)/);
        if (m && m.length > 3) {
          if (!m[1]) {
            m[1] = 0;
          }

          return parseInt(m[1]) * 3600 + parseInt(m[2]) * 60 + parseInt(m[3]);
        }

        return 0;
      },

      secondsFromDurationNode: function(node) {
        if (!node) {
          return 0;
        }

        var text = node.textContent;
        if (!text) {
          return 0;
        }

        return this.secondsFromDuration(text);
      },

      tooltip: {
        tooltip: undefined,
        updatePos: function(button, options) {
          var btnPosition = SaveFrom_Utils.getPosition(button);
          var size = SaveFrom_Utils.getSize(this.tooltip);

          this.tooltip.style.top = (btnPosition.top + options.top - size.height) + 'px';

          var left = btnPosition.left + parseInt(options.width / 2) - parseInt(size.width / 2);
          var pageWidth = document.body.clientWidth + document.body.scrollLeft;
          if (pageWidth < left + size.width) {
            left = pageWidth - size.width;
          }
          this.tooltip.style.left = left + 'px';
        },
        show: function(button, options) {
          var _this = this;
          if (this.tooltip !== undefined) {
            this.hide();
          } else {
            this.tooltip = mono.create('div', {
              class: 'sf-tooltip',
              style: mono.extend({
                position: 'absolute',
                display: 'none',
                zIndex: 9999,
                opacity: 0,
                transition: 'opacity 0.2s',
                whiteSpace: 'nowrap'
              }, options.style),
              on: ['mouseenter', function(e) {
                _this.hide();
              }]
            });
            document.body.appendChild(this.tooltip);
          }
          this.tooltip.style.display = 'block';

          setTimeout(function() {
            _this.updatePos(button, options);
            _this.tooltip.style.opacity = 1;
          }, 0);

          return this.tooltip;
        },
        hide: function() {
          this.tooltip.style.opacity = 0;
          this.tooltip.style.display = 'none';
        }
      },

      rmBitrate: function() {
        if (audio.rmBitrate.style === undefined) {
          document.body.appendChild(audio.rmBitrate.style = mono.create('style', {
            text: '.sf-bitrate-value {display: none;}'
          }));
        }
        var bitrateList = document.querySelectorAll('.sf-bitrate-value');
        for (var i = 0, item; item = bitrateList[i]; i++) {
          item.parentNode.removeChild(item);
        }
      },

      insertNewBitrate: function(bitrate, actionCtr) {
        if (!bitrate || !actionCtr) {
          return;
        }

        if (!actionCtr.classList.contains('audio_acts')) {
          return;
        }

        var parentNode = actionCtr.parentNode;
        var durationContainer = parentNode && parentNode.querySelector('.audio_duration');
        parentNode = null;

        if (!durationContainer) {
          return;
        }

        if (audio.rmBitrate.style !== undefined) {
          audio.rmBitrate.style.parentNode.removeChild(audio.rmBitrate.style);
          audio.rmBitrate.style = undefined;
        }

        if (durationContainer.querySelector('.sf-bitrate-value')) {
          return;
        }

        var style = {
          position: 'absolute',
          width: '80px',
          textAlign: 'right',
          right: 0,
          opacity: '0.8',
          top: '24px',
          fontSize: '11px'
        };

        var el = mono.create('span', {
          text: ' ' + bitrate,
          class: 'sf-bitrate-value',
          style: style
        });

        durationContainer.appendChild(el);
      },

      onDlBtnOver: function(e) {
        var tooltip = audio.tooltip;
        if (e.type !== 'mouseenter') {
          tooltip.hide();
          return;
        }

        var node = this;
        var fullId = node.dataset.fullId;

        var topOffset = -6;
        if (this.dataset.bitrateOffsetTop) {
          topOffset = parseInt(this.dataset.bitrateOffsetTop);
        }

        var options = {
          top: topOffset,
          width: 24,
          style: {
            backgroundColor: '#fff',
            border: '1px solid #ccc',
            color: 'rgb(48, 48, 48)'
          }
        };

        var ttp = tooltip.show(node, options);
        ttp.dataset.fullId = fullId;

        var setTtpLabel = function() {
          var bitrate = node.dataset.bitrate;
          var size = node.dataset.size;

          var text = '';
          if (!size) {
            text = language.getFileSizeFailTitle;
          } else
          if (bitrate) {
            audio.insertNewBitrate(bitrate, node.parentNode);
            text = ' (' + size + ' ~ ' + bitrate + ')';
          } else {
            text = ' (' + size + ')';
          }

          ttp.style.padding = '2px 5px 3px';
          ttp.textContent = text;
        };

        if (node.dataset.size) {
          return setTtpLabel();
        }

        ttp.style.padding = '2px 2px 0 2px';
        ttp.textContent = '';
        ttp.appendChild(mono.create('img', {
          src: '/images/upload.gif',
          height: 8,
          width: 32,
          style: {
            marginTop: '2px',
            marginBottom: '1px'
          }
        }));

        var requireBitrate = function() {
          audio.preloadNewTrackUrl(node, function(err) {
            if (err) {
              if (ttp.dataset.fullId === fullId) {
                setTtpLabel();
                tooltip.updatePos(node, options);
              }
            } else {
              audio.onOverInsertBitrate(node, node.parentNode, function() {
                if (ttp.dataset.fullId === fullId) {
                  setTtpLabel();
                  tooltip.updatePos(node, options);
                }
              });
            }
          });
        };

        requireBitrate();
      },

      isNewPreloadState: function(url) {
        return /#sf-preload$/.test(url);
      },

      preloadNewTrackUrl: function(node, cb) {
        var _this = this;
        var href = node.href;

        if (node.dataset.sfLoading === '1') {
          return;
        }

        if (!this.isNewPreloadState(href)) {
          return cb();
        }

        node.dataset.sfLoading = '1';

        var fullId = node.dataset.fullId;
        return this.getNewTrackListByIds([fullId], function(err, trackList) {
          node.removeAttribute(mono.dataAttr2Selector('sfLoading'));

          if (err) {
            return cb(err);
          }

          var track = trackList[fullId];
          var info = track && _this.getNewTrackInfo(track);
          if (!info || !info.url) {
            return cb("Track is not found!");
          } else {
            node.href = info.url;
            return cb();
          }
        });
      },

      onNewDlBtnClick: function(e) {
        SaveFrom_Utils.downloadOnClick(e);

        var rowList = document.querySelectorAll('#audio_' + this.dataset.fullId);
        for (var i = 0, row; row = rowList[i]; i++) {
          row.style.backgroundColor = '#f4f7fc';
        }

        if ([1].indexOf(preference.cohortIndex) !== -1) {
          if (mono.matches(this, '.top_audio_player ' + this.tagName)) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'vk',
              ea: 'click',
              el: 'music-player'
            });
          } else
          if (mono.matches(this, '.audio_page_player ' + this.tagName)) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'vk',
              ea: 'click',
              el: 'music-playnow'
            });
          } else {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'vk',
              ea: 'click',
              el: 'music-list'
            });
          }
        }
      },

      onNewPreloadTrackReady: function(node, err) {
        if (err) {
          return;
        }

        if (node.dataset.sfTtl === '1') {
          node.dataset.sfTtl = '0';

          audio.onOverInsertBitrate(node, node.parentNode);
        }

        if (node.dataset.sfDl === '1') {
          node.dataset.sfDl = '0';

          mono.trigger(node, 'click', {
            cancelable: true
          });
        }

        node.removeAttribute(mono.dataAttr2Selector('sfDl'));
        node.removeAttribute(mono.dataAttr2Selector('sfTtl'));
      },

      onNewDlBtnClickWrapper: function(event) {
        event.stopPropagation();
        var node = this;

        if (!audio.isNewPreloadState(node.href)) {
          return audio.onNewDlBtnClick.call(node, event);
        }

        event.preventDefault();
        event.stopPropagation();

        if (node.dataset.sfDl === '1') {
          return;
        }
        node.dataset.sfDl = '1';

        return audio.preloadNewTrackUrl(this, audio.onNewPreloadTrackReady.bind(audio, node));
      },

      getNewDlBtn: function(info, filename) {
        var args = {
          href: info.url || '#sf-preload',
          class: [audio.className, 'sf-audio-btn'],
          data: {
            duration: info.duration || '',
            fullId: info.fullId
          },
          style: {
            width: '16px',
            height: '16px',
            verticalAlign: 'middle'
          },
          on: [
            ['mouseenter', this.onDlBtnOver],
            ['mouseleave', this.onDlBtnOver]
          ]
        };

        if (filename) {
          args.download = mono.fileName.modify(filename);
          args.on.push(['click', this.onNewDlBtnClickWrapper]);
        }

        if (mono.isGM || mono.isOpera || mono.isSafari) {
          args.title = language.downloadTitle;
        }

        return mono.create('a', args);
      },

      onOverInsertBitrate: function(node, actions, cb) {
        if (!cb && audio.isNewPreloadState(node.href)) {
          node.dataset.sfTtl = '1';
          return audio.preloadNewTrackUrl(node, audio.onNewPreloadTrackReady.bind(audio, node));
        }

        var onResponse = function(response) {
          if (!response || !response.fileSize) {
            node.href = '#sf-preload';
            delete audio.cache[node.dataset.fullId];
            cb && cb(response);
            return;
          }

          var size = SaveFrom_Utils.sizeHuman(response.fileSize, 2);
          var bitrate = '';
          if (node.dataset.duration) {
            bitrate = Math.floor((response.fileSize / node.dataset.duration) / 125) + ' ' + language.kbps;
          }

          node.dataset.bitrate = bitrate;
          node.dataset.size = size;

          audio.insertNewBitrate(bitrate, actions);

          cb && cb(response);
        };
        try {
          mono.sendMessage({
            action: 'getFileSize',
            url: node.href
          }, onResponse);
        } catch (e) {
          onResponse(null);
        }
      },

      getNewAudioFullTitle: function(info) {
        var fnArr = [];

        if (info.title) {
          fnArr.push(info.title);
        }

        if (info.performer) {
          if (fnArr.length) {
            fnArr.unshift(' - ');
          }

          fnArr.unshift(info.performer);
        }

        return fnArr.join('');
      },

      getNewAudioFilename: function(info) {
        var fullTitle = this.getNewAudioFullTitle(info);

        if (fullTitle) {
          fullTitle += '.mp3';
        }

        return fullTitle;
      },

      handleNewCurrentAudioRow: function(container, info, type) {
        var filename = this.getNewAudioFilename(info);
        var dlBtn = this.getNewDlBtn(info, filename);

        var arrowColor = '#6C8CAC';
        if (type === 1) {
          arrowColor = '#C4D1DE';
        }

        dlBtn.classList.remove('sf-audio-btn');
        mono.create(dlBtn, {
          style: {
            background: 'url(' + SaveFrom_Utils.svg.getSrc('download', arrowColor) + ') center no-repeat',
            backgroundSize: '12px',
            width: '12px',
            height: '12px',
            padding: 0,
            margin: 0,
            cssFloat: 'left',
            marginRight: '3px',
            marginTop: '1px',
            marginBottom: '-2px'
          }
        });

        var attrObserver = null;

        mono.onRemoveEvent(dlBtn, function() {
          mono.one(container, 'mouseover', vk.mutationMode.wrapNewAudioOnMouseOver);
          attrObserver && attrObserver.stop();
        });

        if (type === 2) {
          var parent = mono.getParent(container, '.audio_page_player');
          if (parent) {
            attrObserver = SaveFrom_Utils.mutationAttrWatcher.run({
              target: parent,
              attr: ['data-full-id'],
              callback: function() {
                dlBtn.parentNode && dlBtn.parentNode.removeChild(dlBtn);
                attrObserver && attrObserver.stop();
              }
            });
          }
        }

        if (type === 1) {
          dlBtn.dataset.bitrateOffsetTop = -2;
        }

        container.insertBefore(dlBtn, container.firstChild);
      },

      handleNewAudioRow: function(container, btnContainer, info) {
        var filename = this.getNewAudioFilename(info);
        var dlBtn = this.getNewDlBtn(info, filename);

        mono.create(dlBtn, {
          class: ['audio_act'],
          style: {
            display: 'block',
            marginTop: '-2px',
            marginBottom: '-2px'
          }
        });

        var firstChild = btnContainer.firstChild;
        if (firstChild) {
          btnContainer.insertBefore(dlBtn, firstChild);
        } else {
          btnContainer.appendChild(dlBtn);
        }

        if (preference.vkShowBitrate === 1) {
          this.onOverInsertBitrate(dlBtn, btnContainer);
        }
      },

      addNewDlTrackBtn: function(container) {
        var _this = this;

        var btnContainer = container.querySelector('.audio_acts');
        if (!btnContainer) {
          return;
        }

        return this.getNewNodeTrackInfo(container, function(err, info) {
          if (err) {
            return;
          }

          _this.handleNewAudioRow(container, btnContainer, info);
        });
      },

      getNewTrackInfo: function(track) {
        if (!track) {
          return null;
        }

        var info = {};
        info.url = track[2];
        info.title = track[3];
        if (info.title) {
          info.title = rmEmTags(info.title);
        }

        info.performer = track[4];
        if (info.performer) {
          info.performer = rmEmTags(info.performer);
        }

        info.duration = parseInt(track[5]);

        if (track[1] && track[0]) {
          info.fullId = track[1] + '_' + track[0];
        }

        info.id = track[0];
        info.ownerId = track[1];
        return info;
      },

      readNewDataAudio: function(data) {
        try {
          return JSON.parse(data);
        } catch (e) {
          return null;
        }
      },

      addNewDlCurrentTrackBtn: function(container, type) {
        var _this = this;
        SaveFrom_Utils.bridge({
          func: function(cb) {
            var track = null;

            if (!track && typeof ap !== 'undefined' && ap._currentAudio) {
              track = ap._currentAudio;
            }

            if (!track && typeof cur !== 'undefined' && cur.audioPage && cur.audioPage._readyAudio) {
              track = cur.audioPage._readyAudio;
            }

            if (!track) {
              try {
                track = JSON.parse(localStorage.audio_v9_track);
              } catch (e) {}
            }

            return cb(track);
          },
          cb: function(track) {
            if (!track) {
              var node = document.querySelector('.audio_page_player[data-audio]');
              track = node && _this.readNewDataAudio(node.dataset.audio);
            }

            var info = track && _this.getNewTrackInfo(track);
            if (!info) {
              return;
            }

            var onGetInfo = function(info) {
              _this.handleNewCurrentAudioRow(container, info, type);
            };

            if (!info.url) {
              if (info.fullId) {
                onGetInfo(info);
              }
            } else {
              onGetInfo(info);
            }
          },
          timeout: 300
        });
      },

      onNewMouseOver: function(e) {
        var _this = audio;
        var row = this;
        if (row === null || row.getElementsByClassName(audio.className).length !== 0) {
          return;
        }

        var currentTrackType = null;
        if (row.classList.contains('top_audio_player_title')) {
          currentTrackType = 1;
        }
        if (row.classList.contains('audio_page_player_title')) {
          currentTrackType = 2;
        }

        if (currentTrackType) {
          _this.addNewDlCurrentTrackBtn.call(_this, row, currentTrackType);
        } else {
          _this.addNewDlTrackBtn.call(_this, row);
        }
      },

      addCustomStyle: function() {
        if (this.addCustomStyle.hasStyle === 1) {
          return;
        }
        this.addCustomStyle.hasStyle = 1;

        var currentStyle = document.querySelector('#savefrom-styles.sf-audio');
        if (currentStyle) {
          currentStyle.parentNode.removeChild(currentStyle);
        }

        SaveFrom_Utils.addStyleRules('.' + downloadLinkClassName + '.sf-audio-btn', {
          'background': 'url(' + SaveFrom_Utils.svg.getSrc('download', '#5f7fa2') + ') center no-repeat !important',
          'opacity': '0.4'
        }, 'sf-audio');
      },

      hideLinks: function() {
        if (this.addCustomStyle.hasStyle) {
          this.addCustomStyle.hasStyle = 0;

          var currentStyle = document.querySelector('#savefrom-styles.sf-audio');
          if (currentStyle) {
            currentStyle.parentNode.removeChild(currentStyle);
          }

          SaveFrom_Utils.addStyleRules('.' + downloadLinkClassName, {
            'display': 'none'
          }, 'sf-audio');
        }
        if (audio.tooltip.tooltip) {
          audio.tooltip.tooltip.parentNode.removeChild(audio.tooltip.tooltip);
          audio.tooltip.tooltip = undefined;
        }

        audio.cache = {};
      },

      elIsHidden: function isHidden(el) {
        return (el.offsetParent === null)
      },

      getTitleForLinkList: function(linkList) {
        var list = [];
        if (!linkList) {
          return list;
        }
        for (var i in linkList) {
          var id = i;
          var row = document.getElementById('audio' + id);
          if (row === null) {
            continue;
          }
          var title = audio.getTitle(row, id);

          var duration = 0;
          var d = row.querySelector('div.duration');
          if (d !== null) {
            duration = audio.secondsFromDurationNode(d);
          }

          var filename = mono.fileName.modify(title ? title + '.mp3' : '');

          list.push({
            url: linkList[i],
            filename: filename,
            title: title,
            duration: duration
          });
        }
        return list;
      },

      downloadMP3Files: function() {
        var container = photo.getLayer() || document;
        audio.getNewAudioLinks(container, function(linkList, trackList) {
          var list = trackList || audio.getTitleForLinkList(linkList);

          if (list.length === 0) {
            return alert(language.vkMp3LinksNotFound);
          }
          // mp3
          SaveFrom_Utils.downloadList.showBeforeDownloadPopup(list, {
            type: 'audio',
            folderName: getFolderName()
          });
        }, null, 1);
      },

      showListOfAudioFiles: function(showPlaylist) {
        var container = photo.getLayer() || document;
        audio.getNewAudioLinks(container, function(linkList, trackList) {
          var list;
          if (showPlaylist) {
            list = trackList || audio.getTitleForLinkList(linkList);

            if (list.length !== 0) {
              return SaveFrom_Utils.playlist.popupPlaylist(list, getFolderName(), true);
            }
          } else {
            list = [];
            for (var i in linkList) {
              list.push({
                url: linkList[i]
              });
            }

            if (list.length !== 0) {
              return SaveFrom_Utils.playlist.popupFilelist(list);
            }
          }

          alert(language.vkMp3LinksNotFound);
        }, null, 1);
      }
    };

    //  /AUDIO
    ///////////////////////////////////////////////////////////////////



    ///////////////////////////////////////////////////////////////////
    //  VIDEO

    var video = {
      panelId: 'savefrom__vk_video_links',
      videoAttr: 'data-savefrom-video',
      hiddenAttr: 'data-savefrom-hidden',
      btnBoxId: 'sf-iframe-dl-btn',
      btnBox: null,
      style: {
        fontSize: '10pt',
        margin: '15px 0',
        padding: '0'
      },

      getLinksFormUrl: function(url) {
        if (!url) return;

        if (url.substr(0, 2) === '//') {
          url = 'http:' + url;
        }

        if (preference.showUmmyItem && this.isRutubeLink(url)) {
          return video.getRutubeLinks(url);
        }

        if (this.isPladformLink(url)) {
          return video.getPladformLinks(url);
        }

        var request;
        var hostingList = SaveFrom_Utils.embedDownloader.hostings;
        for (var hostingName in hostingList) {
          var hosting = hostingList[hostingName];
          for (var i = 0, item; item = hosting.re[i]; i++) {
            var data = url.match(item);
            if (data) {
              request = {
                hosting: hostingName,
                action: hosting.action,
                extVideoId: data[1]
              };
              break;
            }
          }
          if (request) break;
        }

        if (!request) return;
        return {
          request: request
        }
      },

      getLinksFromFlashVars: function(flashVars) {
        var params = mono.parseUrl(flashVars, {
          params: true
        });
        var links = video.getLinksFromHtml5MetaData(params);
        return links;
      },

      getLinksFromHtml5MetaData: function(metaData) {
        if (!metaData) return;

        var title = metaData.md_title;

        if (title === undefined) return;

        var videoUrlRegExp = /url([0-9]+)/;
        var urlList = {};

        var hasLinks = false;
        for (var key in metaData) {
          var quality = null;

          if (key === 'extra_data' && metaData.extra === "52") {
            quality = metaData.hd ? 'HD' : 'SD';
            urlList[quality] = metaData[key];
            hasLinks = true;
            continue;
          }

          quality = key.match(videoUrlRegExp);
          if (quality === null) continue;

          var link = metaData[key];
          var vPos = link.indexOf('?');
          if (vPos !== -1) {
            link = link.substr(0, vPos);
          }
          hasLinks = true;
          urlList[quality[1]] = link;
        }

        if (!hasLinks) {
          return;
        }

        return {
          title: title,
          links: urlList
        }
      },

      getRutubeLinks: function(src) {
        if (!/rutube[^\/]+\/(?:play|video)\/embed\/(\d+)/.test(src) && !/video\.rutube\./.test(src)) {
          return;
        }

        var links = SaveFrom_Utils.popupMenu.prepareLinks.rutube(src);

        return {
          isUmmy: true,
          links: links
        };
      },

      isRutubeLink: function(src) {
        return /\/\/.*rutube\..*/.test(src);
      },

      getPladformLinks: function(src) {
        if (!src) {
          return;
        }

        var params = mono.parseUrl(src);
        return {
          request: {
            action: 'getPladformVideo',
            extVideoId: {
              playerId: params.pl,
              videoId: params.videoid
            }
          }
        };
      },

      isPladformLink: function(src) {
        return /\/\/.*pladform\..*/.test(src);
      },

      getLinksVideoEl: function(videoEl, layer) {
        "use strict";
        var title = layer.querySelector('.vv_summary');
        if (!title) {
          return null;
        }
        title = title.textContent;

        var linkList = {};
        var hasLinks;
        var sourceList = videoEl.querySelectorAll('source');
        for (var i = 0, node; node = sourceList[i]; i++) {
          var src = node.src || '';
          var pos = src.indexOf('?');
          if (pos !== -1) {
            src = src.substr(0, pos);
          }
          var m = src.match(/\.(\d+)\.[^\/]+$/);
          if (m === null) {
            continue;
          }
          linkList[m[1]] = src;
          hasLinks = true;
        }

        if (!hasLinks) {
          return;
        }

        return {
          title: title,
          links: linkList
        }
      },

      getPlayerNode: function(layer) {
        var player = null;
        [
          '#video_yt_player',
          '#html5_player',
          '#flash_video_obj',
          '#playerObj',
          '#player',
          '.video_box_wrap > #video_player'
        ].some(function(selector) {
          player = layer.querySelector(selector);
          if (player) {
            return true;
          }
        });
        return player;
      },

      getLinksFromMv: function(oid, vid, cb) {
        SaveFrom_Utils.bridge({
          args: [vid, oid],
          func: function(vid, oid, cb) {
            var mvcur = window.mvcur;
            if (!mvcur || !mvcur.player || !mvcur.player.vars) {
              return cb();
            }

            var vars = mvcur.player.vars;
            if (vars.vid !== vid || vars.oid !== oid) {
              return cb();
            }

            return cb({
              vars: mvcur.player.vars
            });
          },
          cb: function(data) {
            if (!data) {
              return cb();
            }

            var links = video.getLinksFromHtml5MetaData(data.vars);
            return cb(links);
          },
          timeout: 300
        });
      },

      getLinksFromFrame: function(callback) {
        var html = document.body.innerHTML;
        var params = mono.parseUrl(location.href);
        var oid = parseInt(params.oid);
        var id = parseInt(params.id);
        if (oid && id) {
          var varsJson = null;
          mono.findJson(html, [/"vid":/, /"oid":/, /"md_title":/]).some(function(obj) {
            varsJson = obj;
            return true;
          });
          if (varsJson && varsJson.vid === id && varsJson.oid === oid) {
            return callback(null, {
              request: {
                hosting: 'vk',
                action: 'getVkLinksFromJsonMsg',
                json: varsJson
              }
            });
          } else {
            var layer = document.body;
            var player = video.getPlayerNode(layer);
            if (player) {
              return video.getLinksFromPlayer(layer, player, function(links) {
                if (links) {
                  callback(null, links);
                }
              });
            }
          }
        }

        return callback('ERROR');
      },

      getLinksFromPlayer: function(layer, playerNode, cb) {
        if (!playerNode) return;

        var links, flashVars;
        if (playerNode.tagName === 'OBJECT') {
          flashVars = playerNode.querySelector('param[name="flashvars"]');
          if (flashVars) {
            flashVars = flashVars.getAttribute('value');
            links = video.getLinksFromFlashVars(flashVars);
          }
        } else
        if (playerNode.tagName === 'IFRAME') {
          var src = playerNode.getAttribute('src');
          if (!links) {
            links = video.getLinksFormUrl(src);
          }
        } else
        if (playerNode.tagName === 'EMBED') {
          var url = playerNode.getAttribute('src');
          if (!links) {
            flashVars = playerNode.getAttribute('flashvars');
            if (flashVars) {
              links = video.getLinksFromFlashVars(flashVars);
            }
          }
          if (!links) {
            links = video.getLinksFormUrl(url);
          }
        }
        if (playerNode.tagName === 'VIDEO' && playerNode.id !== 'html5_player') {
          links = video.getLinksVideoEl(playerNode, layer);
        }
        if (links) {
          return cb(links, layer);
        }
        if (playerNode.tagName === 'DIV' && playerNode.id === 'video_player') {
          var parentId = playerNode.parentNode.id;
          var oidVid = parentId && parentId.match(/video_box_wrap(-?\d+)_(-?\d+)/);
          if (oidVid) {
            oidVid.shift();
            oidVid = oidVid.map(function(id) {
              return parseInt(id);
            });
            return SaveFrom_Utils.bridge({
              args: oidVid,
              func: function(oid, vid, cb) {
                var mvcur = window.mvcur;
                if (!mvcur) {
                  return cb();
                }

                var path = 'video' + oid + '_' + vid;
                if (mvcur.listId) {
                  path += '?list=' + mvcur.listId;
                }

                return cb({
                  path: path
                });
              },
              cb: function(data) {
                if (!data) {
                  return;
                }

                return cb({
                  request: {
                    hosting: 'vk',
                    action: 'getVKLinks',
                    extVideoId: data.path,
                    oidVid: oidVid
                  }
                }, layer);
              },
              timeout: 300
            });
          }
        }
        if (playerNode.id === 'html5_player') {
          return SaveFrom_Utils.bridge({
            func: function(cb) {
              if (!window.html5video || !window.html5video.vars) {
                return cb();
              }
              cb(window.html5video.vars);
            },
            cb: function(data) {
              var links = video.getLinksFromHtml5MetaData(data);
              if (links) {
                return cb(links, layer);
              }
            },
            timeout: 300
          });
        }
        if (playerNode.tagName === 'A') {
          var href = playerNode.href;
          var params = mono.parseUrl(href);
          if (params.to) {
            links = SaveFrom_Utils.embedDownloader.checkUrl(params.to);
            if (links) {
              return cb({
                request: links
              }, layer);
            } else {
              return cb(null, layer);
            }
          }
        }
      },

      preparePladformLinks: function(response) {
        if (response && response.action === 'getRutubeLinks') {
          response.links = null;
        }

        var links = response && response.links;
        var title = 'noname';
        var linkList = {};

        if (links) {
          for (var i = 0, item; item = links[i]; i++) {
            title = item.title;
            if (linkList[item.quality]) {
              item.quality = +' ';
            }
            linkList[item.quality.toUpperCase()] = item.url;
          }
        }

        return {
          title: title,
          links: linkList
        }
      },

      prepareLinks: function(links) {
        var title = links.title;

        var linkList = [];
        for (var quality in links.links) {
          var item = links.links[quality];

          var ext = item.match(/[\w]+\.(mp4|flv)(?:\?|$)/i);
          if (!ext) {
            ext = 'flv';
          } else {
            ext = ext[1];
          }
          var format = ext.toUpperCase();

          linkList.push({
            href: item,
            quality: quality,
            title: title,
            ext: ext,
            format: format,
            forceDownload: true
          });
        }

        return linkList;
      },

      newAppendButton: function(links, container) {
        if (!links) {
          return;
        }

        var funcClassName = 'sf-under-video';

        var controls = container.querySelector('#mv_info');
        var actionBlock = controls && controls.querySelector('.mv_actions_block > div');
        controls = null;

        var topControls = container.querySelector('#mv_top_controls');

        if (actionBlock && audio.elIsHidden(actionBlock)) {
          actionBlock = null;
        }

        if (!actionBlock && !topControls) {
          return;
        }

        var isInTopControls = !!(!actionBlock && topControls);

        var oldBtnList = container.querySelectorAll('.' + downloadLinkClassName);
        for (var i = 0, node; node = oldBtnList[i]; i++) {
          node.parentNode.removeChild(node);
        }
        node = null;
        oldBtnList = null;

        var dlBtn = mono.create('div', {
          class: [downloadLinkClassName, funcClassName],
          style: {
            cursor: 'pointer'
          },
          on: [
            ['click', function(e) {
              e.stopPropagation();

              mono.onRemoveEvent(this, vk.hideMenu);

              if (vk.contextMenu && vk.contextMenu.isShow) {
                vk.hideMenu();
                return;
              }

              if ([1].indexOf(preference.cohortIndex) !== -1) {
                mono.sendMessage({
                  action: 'trackCohort',
                  t: 'event',
                  ec: 'vk',
                  ea: 'click',
                  el: 'video-under-video'
                });
              }

              var menu = vk.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, language.download + '...', 'sf-single-video-menu', {
                parent: container,
                offsetTop: isInTopControls ? 10 : 10
              });

              if (links.isUmmy) {
                menu.update(links.links);
                return;
              }

              if (links.request) {
                var onResponse = function(response) {
                  var mLinks = language.noLinksFound;
                  if (response && links.request.action === 'getPladformVideo') {
                    if (preference.showUmmyItem && response.action === 'getRutubeLinks') {
                      mLinks = SaveFrom_Utils.popupMenu.prepareLinks.rutube(response.links);
                    } else {
                      mLinks = video.prepareLinks(video.preparePladformLinks(response));
                    }
                  } else
                  if (response && response.links) {
                    var hosting = SaveFrom_Utils.embedDownloader.reMapHosting(response.action);
                    if (hosting) {
                      mLinks = SaveFrom_Utils.popupMenu.prepareLinks[hosting](response.links, response.title);
                    }
                  }
                  menu.update(mLinks);
                };

                var next = function() {
                  try {
                    mono.sendMessage(links.request, onResponse);
                  } catch (e) {
                    onResponse();
                  }
                };
                if (links.request.oidVid) {
                  video.getLinksFromMv(links.request.oidVid[0], links.request.oidVid[1], function(links) {
                    if (links) {
                      var mLinks = video.prepareLinks(links);
                      menu.update(mLinks);
                    } else {
                      next();
                    }
                  });
                } else {
                  next();
                }
                return;
              }

              var mLinks = video.prepareLinks(links);
              menu.update(mLinks);
            }],
            ['mousedown', function(e) {
              e.stopPropagation();
            }],
            ['keydown', function(e) {
              e.stopPropagation();
            }]
          ]
        });

        if (actionBlock) {
          mono.create(dlBtn, {
            class: ['flat_button', 'secondary', 'button_light', 'fl_l'],
            append: [
              mono.create('img', {
                src: SaveFrom_Utils.svg.getSrc('download', '#99AEC8'),
                width: 12,
                height: 12,
                style: {
                  marginBottom: '-2px',
                  marginRight: '7px'
                }
              }),
              mono.create('span', {
                text: language.download
              })
            ]
          });

          var more = actionBlock.querySelector('.mv_more');
          if (more) {
            more.parentNode.insertBefore(dlBtn, more);
          } else {
            actionBlock.appendChild(dlBtn);
          }
        } else
        if (isInTopControls) {
          mono.create(dlBtn, {
            class: ['mv_top_button'],
            style: {
              textAlign: 'center'
            },
            append: [
              mono.create('img', {
                class: ['mv_small_close_icon'],
                style: {
                  backgroundImage: 'none',
                  width: '20px',
                  height: '20px'
                },
                src: SaveFrom_Utils.svg.getSrc('download', '#FFFFFF'),
                width: 20,
                height: 20
              })
            ]
          });

          var childElement = topControls.firstChild;
          if (!childElement) {
            topControls.appendChild(dlBtn);
          } else
          if (!audio.elIsHidden(topControls.lastChild)) {
            topControls.appendChild(dlBtn);
          } else {
            while (childElement.nextElementSibling && !audio.elIsHidden(childElement.nextElementSibling)) {
              childElement = childElement.nextElementSibling;
            }
            childElement.parentNode.insertBefore(dlBtn, childElement);
          }
        }
      },

      appendNewFrameBtn: function(links, container) {
        var _this = this;
        if (container.querySelector('.' + downloadLinkClassName)) {
          return;
        }

        var firstClick = true;

        var btnObj = SaveFrom_Utils.frameMenu.getBtn({
          singleBtn: true,
          btnId: _this.btnBoxId,
          containerStyle: {
            top: '10px',
            right: '10px'
          },
          on: [
            ['click', function(e) {
              e.preventDefault();
              e.stopPropagation();

              if (vk.contextMenu && vk.contextMenu.isShow) {
                vk.hideMenu();
                return;
              }

              var menu = vk.contextMenu = SaveFrom_Utils.frameMenu.getMenu(this, language.download + '...', 'sf-frame-menu', {
                container: btnObj.container,
                onShow: function() {
                  btnObj.node.classList.add('sf-over');
                },
                onHide: function() {
                  vk.contextMenu = null;
                  btnObj.node.classList.remove('sf-over');
                }
              });

              if (links.request) {
                var onResponse = function(response) {
                  var mLinks = language.noLinksFound;
                  if (response && links.request.action === 'getPladformVideo') {
                    if (preference.showUmmyItem && response.action === 'getRutubeLinks') {
                      mLinks = SaveFrom_Utils.popupMenu.prepareLinks.rutube(response.links);
                    } else {
                      mLinks = _this.prepareLinks(_this.preparePladformLinks(response));
                    }
                  } else
                  if (response && response.links) {
                    var hosting = SaveFrom_Utils.embedDownloader.reMapHosting(response.action);
                    if (hosting) {
                      mLinks = SaveFrom_Utils.popupMenu.prepareLinks[hosting](response.links, response.title);
                    }
                  }
                  menu.update(mLinks);
                };

                try {
                  mono.sendMessage(links.request, onResponse);
                } catch (e) {
                  onResponse();
                }
              } else {
                menu.update(_this.prepareLinks(links));
              }

              if (firstClick && [1].indexOf(preference.cohortIndex) !== -1) {
                mono.sendMessage({
                  action: 'getActiveTabUrl'
                }, function(tabUrl) {
                  if (typeof tabUrl === 'string' && tabUrl.indexOf('vk.com/') !== -1) {
                    mono.sendMessage({
                      action: 'trackCohort',
                      t: 'event',
                      ec: 'vk',
                      ea: 'click',
                      el: 'video-on-video'
                    });
                  } else {
                    mono.sendMessage({
                      action: 'trackCohort',
                      t: 'event',
                      ec: 'vk',
                      ea: 'click',
                      el: 'video-iframe'
                    });
                  }
                });
              }
              firstClick = false;
            }],
            ['mousedown', function(e) {
              e.stopPropagation();
              if (e.button === 2) {
                vk.hideMenu();

                if (btnObj.container.parentNode) {
                  btnObj.container.parentNode.removeChild(btnObj.container);
                }
              }
            }]
          ]
        });

        btnObj.container = mono.create('div', {
          class: 'sf-btn-ctr',
          append: btnObj.node
        });

        btnObj.node.appendChild(mono.create('style', {
          text: mono.style2Text([{
            selector: [
              'body:hover .sf-btn-ctr #' + _this.btnBoxId,
              'body:hover .sf-btn-ctr .sf-frame-menu'
            ],
            style: {
              display: 'block'
            }
          }])
        }));

        document.body.appendChild(btnObj.container);
      },

      addFrameBtn: function() {
        var _this = this;
        var container = document.getElementById('page_wrap');
        if (!container) {
          return;
        }

        video.getLinksFromFrame(function(err, links) {
          if (!err) {
            video.appendNewFrameBtn(links, container);
          }
        });
      }
    };

    var videoFeed = {
      linkDataAttr: 'savefromHasBtn',
      getLinkAsAjaxRequest: function(_details, index) {
        "use strict";
        index = index || 0;

        var details = mono.extend({}, _details);

        var abort = function() {
          if (index < 1) {
            return videoFeed.getLinkAsAjaxRequest(_details, ++index);
          }

          _details.error && _details.error();
        };

        var data = details.data;

        if (index === 0) {
          data.act = 'show_inline';
        } else
        if (index === 1) {
          data.act = 'show';
        }

        mono.request(details, function(err, res, data) {
          if (err || !data) {
            return abort();
          }

          if (data.indexOf('href="/join"') !== -1) {
            return abort();
          }

          _details.success(data);
        });
      },
      getLinkAsAjax: function(link, cb, moduleName) {
        var onClick = link.getAttribute('onclick') || '';
        var videoData = onClick.match(/showVideo\(['"]{1}([^'"]+)['"]{1},.?['"]{1}([^'"]+)['"]{1},.*\)/);
        if (!videoData) {
          return cb();
        }
        videoFeed.getLinkAsAjaxRequest({
          localXHR: 1,
          type: 'POST',
          url: '/al_video.php',
          data: {
            list: videoData[2],
            video: videoData[1],
            act: 'show_inline',
            module: moduleName,
            al: 1
          },
          success: function(pageData) {
            if (!pageData) {
              return cb();
            }

            var frameSrc = pageData.match(/<iframe[^>]+src=['"]{1}([^'">]+)['"]{1}[^>]+>/i);
            if (!frameSrc) {
              // search dailymotion
              frameSrc = pageData.match(/var\s+opts\s+=\s+({[^}]*})/im);
              if (frameSrc) {
                frameSrc = frameSrc[1].match(/url:\s+['"]{1}([^'"]+)['"]{1}/i);
                if (frameSrc && frameSrc[1].indexOf('//') !== 0 && frameSrc[1].indexOf('http') !== 0) {
                  frameSrc = null;
                }
              }
            }

            if (!frameSrc) {
              try {
                mono.sendMessage({
                  action: 'getVkLinksFromData',
                  data: pageData
                }, function(response) {
                  return cb(response, 'vk');
                });
              } catch (e) {
                cb({}, 'vk');
              }
              return;
            }

            if (!frameSrc) {
              return cb();
            }

            var url = frameSrc[1];

            if (preference.showUmmyItem && video.isRutubeLink(url)) {
              return cb(video.getRutubeLinks(url));
            }

            if (url.indexOf('//') === 0) {
              url = 'http:' + url;
            }
            if (url.indexOf('http') !== 0) {
              return cb();
            }

            var data = SaveFrom_Utils.embedDownloader.checkUrl(url);
            if (!data) {
              return cb();
            }

            var request = {
              action: data.action,
              extVideoId: data.extVideoId
            };

            mono.sendMessage(request, function(response) {
              var hosting = data.hosting;

              if (response.action !== request.action) {
                hosting = SaveFrom_Utils.embedDownloader.reMapHosting(response.action);
              }

              return cb(response, hosting);
            });
          },
          error: function() {
            cb();
          }
        });
      },
      addDownloadBtn: function(link) {
        var url = link.href;

        var dlBtn = mono.create('a', {
          href: 'http://savefrom.net/?url=' + encodeURIComponent(url),
          style: {
            display: 'inline-block',
            width: '16px',
            height: '16px',
            marginLeft: '5px',
            backgroundImage: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#78A2CC') + ')',
            backgroundRepeat: 'no-repeat',
            marginBottom: '-4px'
          },
          on: ['click', function(e) {
            var _this = this;
            e.preventDefault();
            // e.stopPropagation();

            mono.onRemoveEvent(btnWrapper, vk.hideMenu);

            if (vk.contextMenu && vk.contextMenu.isShow) {
              vk.hideMenu();
              return;
            }

            var parentEl = document.querySelector('#wk_box');
            if (!parentEl || !parentEl.contains(this)) {
              parentEl = null;
            }
            var args = {
              parent: parentEl
            };

            var url = this.getAttribute(SaveFrom_Utils.embedDownloader.dataAttr);
            var eRequest = SaveFrom_Utils.embedDownloader.checkUrl(url);
            if (!eRequest) {
              vk.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(dlBtn, language.noLinksFound, 'sf-popupMenu', args);
              return;
            }

            var request = {
              action: eRequest.action,
              extVideoId: eRequest.extVideoId
            };

            var menu = vk.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(dlBtn, language.download + ' ...', 'sf-popupMenu', args);

            var onResponse = function(response) {
              var hosting = eRequest.hosting;

              if (response.action != request.action) {
                hosting = SaveFrom_Utils.embedDownloader.reMapHosting(response.action);
              }

              if (Array.isArray(response.links) && response.links.length === 0) {
                response.links = undefined;
              }

              if (response.links) {
                var links = SaveFrom_Utils.popupMenu.prepareLinks[hosting](response.links, response.title);
                menu.update(links);
              } else {
                photo.getModuleName(videoFeed.getLinkAsAjax.bind(null, SaveFrom_Utils.getParentByTagName(_this.parentNode, 'A'), function(response, hosting) {
                  if (response && response.links) {
                    var links;
                    if (response.isUmmy) {
                      links = response.links;
                    } else {
                      links = SaveFrom_Utils.popupMenu.prepareLinks[hosting](response.links, response.title);
                    }
                    menu.update(links);
                    return;
                  }
                  menu.update(language.noLinksFound);
                }));
              }
            };

            try {
              mono.sendMessage(request, onResponse);
            } catch (e) {
              onResponse({});
            }

            if ([1].indexOf(preference.cohortIndex) !== -1) {
              mono.sendMessage({
                action: 'trackCohort',
                t: 'event',
                ec: 'vk',
                ea: 'click',
                el: 'video-feed-arrow'
              });
            }
          }]
        });

        dlBtn.setAttribute(SaveFrom_Utils.embedDownloader.dataAttr, url);

        var btnWrapper = mono.create('span', {
          class: 'sf-video-feed-container',
          on: ['click', function(e) {
            e.stopPropagation();
          }],
          append: [
            dlBtn
          ]
        });

        var postVideoTitle = link.querySelector('.post_video_title');
        if (postVideoTitle) {
          postVideoTitle.appendChild(btnWrapper);
        } else {
          link.appendChild(btnWrapper);
        }
      },
      onLinkHover: function() {
        var link = this;

        if (link.tagName !== 'A') {
          return;
        }

        var href = link.href || '';
        var id = link.id;
        if (id.indexOf('post_media_lnk') !== 0 || href.indexOf('/video') === -1) {
          return;
        }

        if (vk.contextMenu && vk.contextMenu.isShow) {
          vk.hideMenu();
        }

        if (link.dataset[videoFeed.linkDataAttr]) {
          return;
        }
        link.dataset[videoFeed.linkDataAttr] = 1;

        videoFeed.addDownloadBtn(link);
      },
      off: function() {
        var btnList = document.querySelectorAll('.sf-video-feed-container');
        for (var i = 0, item; item = btnList[i]; i++) {
          item.parentNode.removeChild(item);
        }
        var dataAttr = mono.dataAttr2Selector(videoFeed.linkDataAttr);
        var dataAttrList = document.querySelectorAll('*[' + dataAttr + ']');
        for (i = 0, item; item = dataAttrList[i]; i++) {
          item.removeAttribute(dataAttr);
        }
      }
    };

    //  /VIDEO
    ///////////////////////////////////////////////////////////////////



    ///////////////////////////////////////////////////////////////////
    //  PHOTO

    var photo = {
      photoCache: {},
      albumCache: {},
      offsetStep: 10,
      getAlbumId: function(url) {
        if (/(\?|&|#)act=edit/i.test(url)) {
          return;
        }

        var dataList = [];

        dataList.push(url);

        var params = mono.parseUrl(url);
        if (params.w) {
          dataList.push(params.w);
        }
        if (params.z) {
          dataList.push.apply(dataList, params.z.split('/'));
        }

        if (/#/.test(url)) {
          dataList.push(url.substr(url.indexOf('#') + 1));
          dataList.push(decodeURIComponent(url.substr(url.indexOf('#') + 1)));
        }

        dataList.reverse();

        var aid = null;
        var m = null;
        dataList.some(function(data) {
          m = data.match(/(?:\/|#|=|^)(albums?|tag|photos|feed(?:\d+)?_|wall)(-?\d+)(?:_(\d+))?/i);
          if (m) {
            if (m[3]) {
              if (/^(feed|wall)/.test(m[1])) {
                aid = m[1] + m[2] + '_' + m[3];
              } else {
                aid = 'album' + m[2] + '_' + m[3];
              }

            } else {
              if (m[1] == 'albums') {
                m[1] = 'photos';
              }

              aid = m[1] + m[2];
            }
            return true;
          }
        });

        return aid;
      },
      getLinksFromJson: function(list, withTitle, onSuccess) {
        var links = {};
        var title = withTitle ? undefined : null;
        for (var n = 0, item; item = list[n]; n++) {
          if (!item.id) {
            continue;
          }
          if (title === undefined && item.album) {
            title = mono.fileName.decodeSpecialChars(mono.decodeUnicodeEscapeSequence(item.album.replace(/<[^>]+>/g, '')));
          }
          var photoInfo = this.getMaxPhotoSize(item);
          if (photoInfo) {
            links[item.id] = this.photoCache[item.id] = photoInfo.url;
          }
        }
        onSuccess(links, title);
      },
      getLinksViaAPI: function(post, withTitle, onSuccess, onError, reSend) {
        if (reSend === undefined) {
          reSend = 0;
        }
        var _this = this;
        var url = '/al_photos.php';
        var onXhrError = function() {
          if (reSend > 2) {
            return onError();
          }
          setTimeout(function() {
            _this.getLinksViaAPI(post, withTitle, onSuccess, onError, ++reSend);
          }, 250);
        };

        mono.request({
          type: 'POST',
          url: url,
          data: post,
          localXHR: true,
          timeout: 60 * 1000
        }, function(err, resp, data) {
          if (err) {
            return onXhrError();
          }

          if (!data) {
            return onError();
          }

          var arr = parseVkResponse(data);

          var count = arr[6];
          var list = arr[8];

          return _this.getLinksFromJson(list, withTitle, onSuccess.bind(_this, count));
        });
      },
      getAlbumLinks: function(id, onProgress, cb) {
        var withTitle = true;
        var _this = this;
        var title = undefined;
        var url = location.href;
        if (url.indexOf('albums') !== -1 || url.indexOf('tags') !== -1 || url.indexOf('photos') !== -1) {
          title = null;
          withTitle = false;
        }
        var post = 'act=show&al=1&list=' + id + '&offset={offset}';
        var offset = 0;
        var linkList = {};
        var summ = 0;
        var inProgress = 0;
        var count = 0;
        var abort = false;
        var nextStep = function() {
          if (abort) {
            return;
          }
          inProgress++;
          _this.getLinksViaAPI(post.replace('{offset}', offset), withTitle, function onSuccess(fullCount, links, aTitle) {
            if (title === undefined && aTitle) {
              title = aTitle;
              withTitle = false;
            }
            if (count < fullCount) {
              count = fullCount;
            }
            var newLinks = 0;
            for (var item in links) {
              if (linkList[item] !== undefined) {
                continue;
              }
              linkList[item] = links[item];
              newLinks++;
              summ++;
            }
            onProgress(summ, count);
            inProgress--;
            if (newLinks === 0) {
              if (inProgress === 0) {
                if (count === fullCount) {
                  _this.albumCache[id] = {
                    links: linkList,
                    title: title
                  };
                }
                if (!title) {
                  title = getFolderName();
                }
                cb(linkList, title);
              }
              return;
            }
            nextStep();
          }, function onError() {
            inProgress--;

            if (inProgress === 0) {
              return cb(linkList, title);
            }
          });
          offset += _this.offsetStep;
        };
        nextStep();
        nextStep();
        return {
          abort: function() {
            abort = true;
          }
        }
      },
      getModuleName: function(cb) {
        var dataArg = 'sfModule';
        var script = mono.create('script', {
          text: '(' + function() {
            if (window.cur && window.cur.module && typeof(window.cur.module) === 'string') {
              document.body.dataset['{dataArg}'] = window.cur.module;
            }
          }.toString().replace('{dataArg}', dataArg) + ')();'
        });
        document.body.appendChild(script);
        setTimeout(function() {
          script.parentNode.removeChild(script);
          cb(document.body.dataset[dataArg]);
        }, 0);
      },
      getFullSizeSrc: function(list, count, onProgress, cb) {
        var _this = this;
        var abort = false;
        this.getModuleName(function(curModule) {
          var post = 'act=show&al=1&list={list}&module=' + curModule + '&photo={id}';
          var index = 0;
          var inProgress = 0;
          var linkList = {};
          var summ = 0;

          var keyList = (function() {
            var keyList = [];
            for (var key in list) {
              keyList.push(key);
            }
            return keyList;
          })();

          var nextStep = function() {
            if (abort) {
              return;
            }

            var photoId = keyList[index];
            var listItem = list[photoId];
            if (listItem === undefined) {
              if (inProgress === 0) {
                cb(linkList);
              }
              return;
            }

            inProgress++;

            if (_this.photoCache[photoId] !== undefined) {
              linkList[photoId] = _this.photoCache[photoId];
              summ++;
              onProgress(summ, count);
              index++;
              nextStep();
              inProgress--;
              return;
            }

            index++;

            var _post = post.replace('{list}', listItem.list).replace('{id}', photoId);
            _this.getLinksViaAPI(_post, false, function onSuccess(_count, links) {
              var link = links[photoId];
              if (!link) {
                link = listItem.src;
              }

              linkList[photoId] = link;

              summ++;
              onProgress(summ, count);

              inProgress--;
              nextStep();
            }, function onError() {
              linkList[photoId] = listItem.src;

              summ++;
              onProgress(summ, count);

              inProgress--;
              nextStep();
            });
          };
          nextStep();
          nextStep();
        });
        return {
          abort: function() {
            abort = true;
          }
        }
      },
      isReply: function(el) {
        return mono.matches(el, '.replies ' + el.tagName) || mono.matches(el, '.wl_replies ' + el.tagName);
      },
      getWallPostContent: function() {
        var postId = location.href.match(/wall(-?\d+_\d+)/);
        postId = postId && postId[1];

        if (!postId) {
          return;
        }

        return document.getElementById('post' + postId) || document.getElementById('wpt' + postId);
      },
      findLinks: function(container, onProgress, cb, force) {
        var _this = this;
        var links = container.querySelectorAll('a[onclick]');
        var linkList = {};
        var count = 0;
        for (var i = 0, el; el = links[i]; i++) {
          var onclick = el.getAttribute('onclick');
          if (onclick.search(/showPhoto\s*\(/i) === -1) {
            continue;
          }
          if (photo.isReply(el)) {
            continue;
          }
          var photoId = '',
            listId = '';
          var params = onclick.match(/showPhoto\s*\(\s*[\"']([-\d_]+)[\"']\s*,\s*[\"']([\w\-]+)[\"']/i);
          if (params && params.length > 2) {
            photoId = params[1];
            listId = params[2];
          }
          if (photoId && listId) {
            var json = onclick.match(/\{[\"']?temp[\"']?\s*:\s*(\{.+?\})/i);
            if (json) {
              json = json[1].replace(/(\{|,)\s*(\w+)\s*:/ig, '$1"$2":');
              var src = undefined;
              try {
                json = JSON.parse(json);

                var photoInfo = _this.getMaxPhotoSize(json);
                if (photoInfo) {
                  src = photoInfo.url;
                }
              } catch (err) {}

              if (src && linkList[photoId] === undefined) {
                linkList[photoId] = {
                  src: src,
                  list: listId
                };
                count++;
              }
            }
          }
        }
        if (count === 0 && container !== document && force === undefined) {
          var postContainer = this.getWallPostContent();
          if (!postContainer) {
            return cb(undefined);
          }
          return this.findLinks(postContainer, onProgress, cb, 1);
        }
        if (count === 0) {
          return cb(undefined);
        }
        onProgress(0, count);
        return this.getFullSizeSrc(linkList, count, onProgress, cb);
      },

      /**
       * @param {string} title
       * @param {string} type
       * @param {Function} onClose
       * @returns {{onPrepare: Function, onProgress: Function, onReady: Function, onError: Function}}
       */
      getPopup: function(title, type, onClose) {
        var template = SaveFrom_Utils.playlist.getInfoPopupTemplate();
        var progressEl;

        mono.create(template.textContainer, {
          append: [
            mono.create('p', {
              text: title,
              style: {
                color: '#0D0D0D',
                fontSize: '20px',
                marginBottom: '11px',
                marginTop: '13px'
              }
            }),
            progressEl = mono.create('p', {
              text: '',
              style: {
                color: '#868686',
                fontSize: '14px',
                lineHeight: '24px'
              }
            })
          ]
        });

        var popupEl = SaveFrom_Utils.popupDiv(template.body, 'sf_progress_popup', undefined, undefined, onClose);

        var setState = function(state) {
          if (setState.state === state) {
            return;
          }
          setState.state = state;

          template.buttonContainer.style.display = 'none';
          progressEl.style.display = 'none';
          mono.sendMessage({
            action: 'getWarningIcon',
            type: type,
            color: '#77D1FA'
          }, function(icon) {
            template.icon.style.backgroundImage = 'url(' + icon + ')';
          });
          if (state === 'progress') {
            progressEl.style.display = 'block';
          }
          if (state === 'error') {
            mono.sendMessage({
              action: 'getWarningIcon',
              type: type,
              color: '#AAAAAA'
            }, function(icon) {
              template.icon.style.backgroundImage = 'url(' + icon + ')';
            });
            progressEl.style.display = 'block';
          }
        };

        return {
          onPrepare: function(text) {
            setState('progress');
            progressEl.textContent = text;
          },
          onProgress: function(count, max) {
            progressEl.textContent = language.vkFoundFiles.replace('%d', count) + ' ' + language.vkFoundOf + ' ' + max;
          },
          onReady: function() {
            mono.trigger(popupEl, 'kill');
          },
          onError: function(text) {
            setState('error');
            progressEl.textContent = text;
          }
        }
      },
      getLayer: function() {
        var layer = document.getElementById('layer_wrap');
        if (layer === null || layer.style.display === "none" || layer.textContent.length === 0) {
          layer = null;
        }
        if (layer === null) {
          layer = document.getElementById('wk_layer_wrap');
          if (layer === null || layer.style.display === "none" || layer.textContent.length === 0) {
            layer = null;
          }
        }
        return layer;
      },
      getLinks: function(container, id) {
        var _this = this;
        var process = undefined;
        var popup = this.getPopup(getFolderName(), 'photo', function onClose() {
          process && process.abort();
        });
        var _cb = function(linkList, title) {
          if (!linkList) {
            linkList = {};
          }
          var links = [];
          for (var item in linkList) {
            var filename = SaveFrom_Utils.getMatchFirst(linkList[item], /\/([\w\-]+\.[a-z0-9]{3,4})(?:\?|$)/i);
            if (!filename) {
              continue;
            }
            links.push({
              filename: filename,
              url: linkList[item]
            });
          }
          if (links.length === 0) {
            popup.onError(language.noLinksFound);
            return;
          }

          var zeroCount = String(links.length).length;
          links.forEach(function(item, index) {
            var number = String(index + 1);
            while (number.length < zeroCount) {
              number = '0' + number;
            }
            item.filename = number + '-' + item.filename;
          });

          popup.onReady();

          title = title || getFolderName();
          if (!allowDownloadMode) {
            return _this.showListOfLinks(title, links, true);
          }
          SaveFrom_Utils.downloadList.showBeforeDownloadPopup(links, {
            count: links.length,
            folderName: title,
            type: 'photo',
            onShowList: function() {
              // show list on links
              _this.showListOfLinks(title, links, true);
            }
          });
        };
        popup.onPrepare(language.download + ' ...');
        if (id) {
          if (this.albumCache[id] !== undefined) {
            _cb(this.albumCache[id].links, this.albumCache[id].title || getFolderName());
            return;
          }
          process = this.getAlbumLinks(id, popup.onProgress, _cb);
          return;
        }

        if (!container || container === document) {
          container = this.getLayer();
        }

        process = this.findLinks(container || document, popup.onProgress, _cb);
      },
      rmPhotoAlbumDlBtn: function() {
        var dlAlbumBtn = document.querySelectorAll(['.sf-dl-ablum-btn-divide', '.sf-dl-ablum-btn']);
        for (var i = 0, item; item = dlAlbumBtn[i]; i++) {
          item.parentNode.removeChild(item);
        }
      },
      addNewPhotoAlbumDlBtn: function(container) {
        var _this = this;

        var photosAlbumIntroInfo = container.querySelector('.photos_album_intro_info');
        var pageBlockHeaderExtra = container.querySelector('.page_block_header_extra');

        var body = photosAlbumIntroInfo || pageBlockHeaderExtra;

        if (!body || body.querySelector('.sf-dl-ablum-btn')) {
          return;
        }

        var dlBtn = mono.create('a', {
          text: language.vkDownloadPhotoAlbum,
          href: '#',
          class: 'sf-dl-ablum-btn',
          on: ['click', function(e) {
            e.preventDefault();

            var id = photo.getAlbumId(location.href);
            _this.getLinks.call(_this, container, id);

            if ([1].indexOf(preference.cohortIndex) !== -1) {
              mono.sendMessage({
                action: 'trackCohort',
                t: 'event',
                ec: 'vk',
                ea: 'click',
                el: 'photo-albom'
              });
            }
          }]
        });

        var dlBtnWrapper = mono.create('span', {
          append: dlBtn
        });

        if (photosAlbumIntroInfo) {
          dlBtnWrapper.classList.add('photos_album_info');
          dlBtnWrapper = mono.create(document.createDocumentFragment(), {
            append: [
              mono.create('span', {
                class: 'divide sf-dl-ablum-btn-divide',
                text: '|'
              }),
              dlBtnWrapper
            ]
          });
        } else
        if (pageBlockHeaderExtra) {
          dlBtnWrapper.classList.add('photos_comments_link');
          dlBtnWrapper.style.margin = '0 15px';
        }

        body.appendChild(dlBtnWrapper);
      },
      getContainer: function() {
        var container = document.getElementById('photos_albums_container');
        if (!container) {
          container = document.getElementById('photos_container');
        }

        return container;
      },
      getFilenameFromUrl: function(url) {
        return SaveFrom_Utils.getMatchFirst(url, /\/([\w\-]+\.[a-z0-9]{3,4})(?:\?|$)/i);
      },
      rmCurrentPhotoBtn: function(insertContainer) {
        var exBtn = undefined;
        var imgList = document.querySelectorAll('.sf-dl-current-photo-btn');
        for (var i = 0, imgItem; imgItem = imgList[i]; i++) {
          if (!insertContainer || !insertContainer.contains(imgItem)) {
            imgItem.parentNode.removeChild(imgItem);
          } else {
            exBtn = imgItem;
          }
        }
        return exBtn;
      },
      style: null,
      injectStyle: function() {
        if (this.style) {
          if (!this.style.parentNode) {
            document.head.appendChild(this.style);
          }
          return;
        }

        this.style = mono.create('style', {
          text: mono.style2Text({
            'div > .sf-dl-current-photo-btn': {
              display: 'none',
              border: '1px solid #F8F8F8',
              width: '20px',
              height: '20px',
              padding: 0,
              position: 'absolute',
              background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#777777') + ') center no-repeat #F8F8F8',
              backgroundSize: '12px',
              top: '20px',
              left: '30px',
              zIndex: 10,
              cursor: 'pointer'
            },
            'div > .sf-dl-current-photo-btn.sf-style-black': {
              border: 0,
              background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#FFF') + ') center no-repeat #000',
              backgroundSize: '14px',
              padding: '2px 4px',
              borderRadius: '2px',
              opacity: 0.4,
              transition: 'opacity 100ms linear'
            },
            'div > .sf-dl-current-photo-btn:hover': {
              background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#00B75A') + ') center no-repeat #F8F8F8',
              backgroundSize: '12px',
              opacity: 0.8
            },
            'div > .sf-dl-current-photo-btn.sf-style-black:hover': {
              background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#00B75A') + ') center no-repeat #000',
              backgroundSize: '14px'
            },
            'div > .sf-dl-current-photo-btn:active': {
              outline: 0,
              boxShadow: 'inset 0 3px 5px rgba(0, 0, 0, 0.125)'
            },
            'div:hover > .sf-dl-current-photo-btn': {
              display: 'block'
            }
          })
        });

        document.head.appendChild(this.style);
      },
      getMaxPhotoSize: function(data) {
        var t = null,
          r = null;
        ["w", "z", "y", "x"].some(function(key) {
          if (t = data[key + '_']) {
            return true;
          }
          if (r = data[key + '_src']) {
            return true;
          }
        });

        if (!t) {
          t = [r];
        }

        var genUrl = function(baseUrl, url) {
          if (!url.match(/\.[a-z]{3}$/i)) {
            url += ".jpg";
          }

          if (url.match(/https?:\/\//i)) {
            return url;
          }

          return (baseUrl || '').replace(/\/[a-z0-9_:\.]*$/i, '') + '/' + url;
        };

        if (!t[0]) {
          return null;
        }

        var info = {
          url: genUrl(data.base, t[0]),
          width: t[2] && t[1],
          height: t[1] && t[2]
        };

        return info;
      },
      getNewCurrentPhotoLink: function(id, cb) {
        var _this = this;
        if (!id) {
          return cb("ID is empty!");
        }

        return SaveFrom_Utils.bridge({
          args: [id],
          func: function(id, cb) {
            var data = {};

            if (typeof cur !== 'undefined' && cur.pvCurPhoto) {
              if (cur.pvCurPhoto.id === id) {
                data = cur.pvCurPhoto;
              }
            }

            return cb(data);
          },
          cb: function(data) {
            if (!data || !data.id) {
              return cb("ID is not found!");
            }

            var photoInfo = _this.getMaxPhotoSize(data);
            if (!photoInfo) {
              return cb('URL is not found!');
            }

            return cb(null, photoInfo);
          },
          timeout: 300
        });
      },
      addNewDlCurrentPhotoBtn: function(container) {
        var insertContainer = container;
        var exBtn = this.rmCurrentPhotoBtn(insertContainer);
        if (exBtn) {
          return;
        }

        var _this = this;

        var pvPhoto = container.querySelector('a#pv_photo[href]');
        if (!pvPhoto) {
          return;
        }

        var btn = mono.create('a', {
          class: ['sf-dl-current-photo-btn', 'sf-style-black'],
          href: '#',
          title: language.download,
          on: [
            ['click', function(e) {
              e.stopPropagation();
              e.preventDefault();

              mono.onRemoveEvent(this, vk.hideMenu);

              if (vk.contextMenu && vk.contextMenu.isShow) {
                vk.hideMenu();
                return;
              }

              var menu = vk.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, language.download + ' ...', "photoDlMenu", {
                parent: insertContainer
              });

              var abort = function() {
                return menu.update(language.noLinksFound);
              };

              var id = pvPhoto.href.match(/photo(-?\d+_\d+)/);
              id = id && id[1];

              return _this.getNewCurrentPhotoLink(id, function(err, info) {
                if (err) {
                  return abort();
                }

                var photoFileName = mono.fileName.modify(_this.getFilenameFromUrl(info.url));
                var dotPos = photoFileName.lastIndexOf('.');
                var photoExt = photoFileName.substr(dotPos + 1);
                var photoTitle = photoFileName.substr(0, dotPos);

                var menuItems = [];

                menuItems.push({
                  href: info.url,
                  title: photoTitle,
                  quality: language.download,
                  format: ' ',
                  ext: photoExt,
                  forceDownload: true,
                  isOther: true,
                  isBlank: true,
                  func: function() {
                    menu.hide();
                  }
                });

                menuItems.push({
                  href: '#getAlbum',
                  title: '',
                  quality: language.vkDownloadPhotoAlbum,
                  format: ' ',
                  ext: '',
                  noSize: true,
                  isOther: true,
                  func: function(e) {
                    e.preventDefault();

                    photo.downloadPhoto();
                    menu.hide();
                  }
                });

                menu.update(menuItems);
              });
            }],
            ['mousedown', function(e) {
              e.stopPropagation();
            }]
          ]
        });

        SaveFrom_Utils.mutationAttrWatcher.run({
          target: pvPhoto,
          attr: ['href'],
          callback: function() {
            if (vk.contextMenu && vk.contextMenu.isShow) {
              vk.hideMenu();
            }
          }
        });

        insertContainer.appendChild(btn);
      },
      downloadPhoto: function() {
        var container = this.getContainer();
        var id = this.getAlbumId(location.href);
        if (!id) {
          var link = document.querySelector('#pv_album_name a');
          if (link && !audio.elIsHidden(link)) {
            id = this.getAlbumId(link.href);
          }
        }
        this.getLinks(container, id);

        if ([1].indexOf(preference.cohortIndex) !== -1) {
          mono.sendMessage({
            action: 'trackCohort',
            t: 'event',
            ec: 'vk',
            ea: 'click',
            el: 'photo-menu'
          });
        }
      },
      showListOfPhotos: function(title, links) {
        title = title.replace(/[<>]+/g, '_');
        var html = '<!DOCTYPE html><html><head><meta charset="utf-8"><style type="text/css">' +
          'a,img{display:block;margin-bottom:5px;}' +
          '</style></head><body>' + title +
          '<p style="width:640px">' +
          language.vkListOfPhotosInstruction +
          '</p><br><br>';

        for (var i = 0, item; item = links[i]; i++) {
          var src = item.url;
          var fileName = item.filename;
          if (fileName) {
            html += '<a href="' + src + '" download="' + fileName + '">' +
              '<img src="' + src + '" alt="photo"></a>';
          } else {
            html += '<img src="' + src + '" alt="photo">';
          }
        }

        html += '</body></html>';

        var url = 'data:text/html;charset=utf-8;base64,' + encodeURIComponent(btoa(SaveFrom_Utils.utf8Encode(html)));

        window.open(url, '_blank');
      },
      showListOfLinks: function(title, links, showListOfPhotosLink) {
        var listOfPhotoLink;
        if (showListOfPhotosLink) {
          listOfPhotoLink = mono.create(document.createDocumentFragment(), {
            append: [
              mono.create('p', {
                append: [
                  mono.create('a', {
                    text: language.vkListOfPhotos,
                    href: '#',
                    class: 'sf__hidden',
                    style: {
                      fontWeight: 'bolder',
                      border: 'none',
                      textDecoration: 'underline'
                    },
                    on: ['click', function(e) {
                      e.preventDefault();
                      photo.showListOfPhotos(title, links);
                    }]
                  })
                ]
              })
            ]
          });
        } else {
          listOfPhotoLink = '';
        }

        var textareaText = '';
        for (var i = 0, item; item = links[i]; i++) {
          textareaText += item.url + '\r\n';
        }

        var container = mono.create(document.createDocumentFragment(), {
          append: [
            mono.create('p', {
              text: title,
              style: {
                color: '#0D0D0D',
                fontSize: '20px',
                marginBottom: '11px',
                marginTop: '5px'
              }
            }),
            mono.create('p', {
              append: mono.parseTemplate(language.vkListOfLinksInstruction)
            }),
            listOfPhotoLink,

            mono.create('textarea', {
              text: textareaText,
              cols: 60,
              rows: 10,
              style: {
                width: '100%'
              }
            }),
            (!mono.isChrome && !mono.isFF) ? undefined : mono.create('button', {
              text: language.copy,
              style: {
                height: '27px',
                backgroundColor: '#ffffff',
                border: '1px solid #9e9e9e',
                marginTop: '6px',
                paddingLeft: '10px',
                paddingRight: '10px',
                borderRadius: '5px',
                fontSize: '14px',
                cursor: 'pointer',
                cssFloat: 'right'
              },
              on: ['click', function(e) {
                var _this = this;
                _this.disabled = true;
                mono.sendMessage({
                  action: 'addToClipboard',
                  text: textareaText
                });
                setTimeout(function() {
                  _this.disabled = false;
                }, 1000);
              }],
              append: mono.create('style', {
                text: mono.style2Text({
                  '#savefrom_popup_box button:hover:not(:disabled)': {
                    backgroundColor: '#597A9E !important',
                    borderColor: '#597A9E !important',
                    color: '#fff'
                  },
                  '#savefrom_popup_box button:active': {
                    opacity: 0.9
                  }
                })
              })
            })
          ]
        });

        SaveFrom_Utils.popupDiv(container);
      }
    };

    //  /PHOTO
    ///////////////////////////////////////////////////////////////////

    // do...

    var mVk = {
      mobileMenu: null,
      observer: null,
      styleEl: null,
      run: function() {
        "use strict";
        var _this = this;

        if (!SaveFrom_Utils.mutationWatcher.isAvailable()) {
          // console.error('MutationObserver is not supported!');
          return;
        }

        if (_this.observer) {
          return _this.observer.start();
        }

        _this.observer = SaveFrom_Utils.mutationWatcher.run({
          callback: function(summaryList) {
            var summary, n, node;

            summary = summaryList[0];
            for (n = 0; node = summary.added[n]; n++) {
              if (node.dataset.sfSkip > 0) {
                continue;
              }
              node.dataset.sfSkip = '1';

              _this.insertAudioBtn(node);
            }

            summary = summaryList[1];
            for (n = 0; node = summary.added[n]; n++) {
              if (!node.parentNode.classList.contains('video_view')) {
                continue;
              }

              if (node.dataset.sfSkip > 0) {
                continue;
              }
              node.dataset.sfSkip = '1';

              _this.insertVideoBtn(node);
            }

            summary = summaryList[2];
            for (n = 0; node = summary.removed[n]; n++) {
              mono.onRemoveListener(node);
            }
          },
          queries: [{
            css: 'div.audio_item',
            is: 'added'
          }, {
            css: 'div.vv_body',
            is: 'added'
          }, {
            css: '.' + mono.onRemoveClassName,
            is: 'removed'
          }]
        });

        _this.insertStyle();
      },
      hideMenu: function() {
        if (mVk.mobileMenu) {
          mVk.mobileMenu.hide();
          mVk.mobileMenu = null;
        }
      },
      insertStyle: function() {
        "use strict";
        if (this.styleEl) {
          if (!this.styleEl.parentNode) {
            document.head.appendChild(this.styleEl);
          }
          return;
        }

        this.styleEl = mono.create('style', {
          class: 'sf-style',
          text: mono.style2Text({
            selector: '.' + downloadLinkClassName + '.sf-audio',
            style: {
              display: 'block',
              float: 'right',
              borderRadius: '3px',
              width: '22px',
              height: '22px',
              marginTop: '1px',
              marginLeft: '3px',
              marginRight: '3px',
              background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#ffffff') + ') center no-repeat',
              backgroundSize: '12px',
              backgroundColor: '#5E80AA'
            }
          })
        });
        document.head.appendChild(this.styleEl);
      },
      onAudioBtnClick: function(e) {
        "use strict";
        e.stopPropagation();

        SaveFrom_Utils.downloadOnClick(e);
      },
      getAudioDlBtnNode: function(url) {
        "use strict";
        return mono.create('a', {
          class: [downloadLinkClassName, 'sf-audio'],
          href: url,
          target: '_blank',
          on: ['click', this.onAudioBtnClick]
        });
      },
      insertAudioBtn: function(node) {
        "use strict";
        var url = node.querySelector('input');
        url = url && url.value;
        if (!url) {
          return;
        }
        var pos = url.indexOf('?');
        if (pos !== -1) {
          url = url.substr(0, pos);
        }

        var aiDur = node.querySelector('.ai_dur');

        if (!aiDur) {
          return;
        }

        var parent = aiDur.parentNode;

        var btn = this.getAudioDlBtnNode(url);

        var exBtn = parent.querySelector('.' + downloadLinkClassName);
        if (exBtn) {
          exBtn.parentNode.replaceChild(btn, exBtn);
        } else {
          var nextEl = aiDur.nextElementSibling;

          if (!nextEl) {
            return;
          }

          parent.insertBefore(btn, nextEl);
        }
      },
      onVideoBtnClick: function(links, e) {
        "use strict";
        e.preventDefault();
        e.stopPropagation();

        mVk.hideMenu();

        var lightBox = mVk.mobileMenu = SaveFrom_Utils.mobileLightBox.show(language.download + ' ...');

        var mLinks = language.noLinksFound;
        if (links.request) {
          var onResponse = function(response) {
            if (response && links.request.action === 'getPladformVideo') {
              mLinks = video.prepareLinks(video.preparePladformLinks(response));
            } else {
              var hosting = SaveFrom_Utils.embedDownloader.reMapHosting(response.action);
              if (hosting && response && response.links) {
                mLinks = SaveFrom_Utils.popupMenu.prepareLinks[hosting](response.links, response.title);
              }
            }
            lightBox.update(mLinks);
          };

          try {
            mono.sendMessage(links.request, onResponse);
          } catch (e) {
            onResponse();
          }
        } else {
          mLinks = video.prepareLinks(links);
          lightBox.update(mLinks);
        }
      },
      appendVideoBtn: function(links, layer) {
        "use strict";
        var container = layer.querySelector('.mv_actions');
        var btn = mono.create('li', {
          class: [downloadLinkClassName, 'sf-video-ctr'],
          append: mono.create('a', {
            class: [downloadLinkClassName, 'mva_item'],
            text: language.download,
            on: ['click', this.onVideoBtnClick.bind(this, links)]
          })
        });
        container && container.appendChild(btn);
        mono.onRemoveEvent(btn, mVk.hideMenu);
      },
      insertVideoBtn: function(node) {
        "use strict";
        var _this = this;
        var firstChild = node.querySelectorAll('iframe, video, a')[0];

        var ctr = mono.getParentByClass(node, 'video_view');

        var getLinksFromUrl = function() {
          var m = /video(-?\d+)_(-?\d+)/.exec(location.href);
          return m && {
            request: {
              hosting: 'vk',
              action: 'getVKLinks',
              extVideoId: 'video' + m[1] + '_' + m[2]
            }
          };
        };

        if (!firstChild) {
          if (node.querySelector('.vv_not_support')) {
            var links = getLinksFromUrl();
            if (links) {
              _this.appendVideoBtn(getLinksFromUrl(), ctr);
            }
          }
        } else {
          video.getLinksFromPlayer(ctr, firstChild, function(links, ctr) {
            if (!links) {
              links = getLinksFromUrl();
            }
            if (links) {
              _this.appendVideoBtn(links, ctr);
            }
          });
        }
      }
    };
  }, null, function syncIsActive() {
    "use strict";
    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.vk.com/*',
        '*://*.vkontakte.ru/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('youtube', function(moduleName, initData) {
    "use strict";

    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleYoutube ? 1 : 0;
    var allowDownloadMode = mono.isSafari || mono.isChrome || mono.isFF || (mono.isGM && mono.isTM);
    var iframe = mono.isIframe();

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return youtube.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'updateLinks') {
        var vId = youtube.getIdFromLocation();
        if (vId) {
          getPlayerConfig(function(config) {
            if (config && config.args && config.args.video_id === vId) {
              var oldBtn = document.getElementById(youtube.buttonId);
              if (oldBtn !== null) {
                oldBtn.parentNode.removeChild(oldBtn);
              }

              ytUmmyBtn.rmBtn();
              quickConvert.rmBtn();

              youtube.responseCache = {};
              youtube.video_id = config.args.video_id;
              var container = document.getElementById('watch7-subscription-container');
              youtube.appendDownloadButton(container);
            }
          });
        }
      }
      if (message.action === 'downloadPlaylist') {
        youtube.downloadPlaylist();
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        youtube.run();
      });
    }

    var youtube = {
      swfargs: null,
      video_id: '',

      buttonId: 'savefrom__yt_btn',

      responseCache: {},
      isMobile: false,

      mobileMenu: null,
      currentMenu: null,
      currentTutorial: null,

      run: function() {
        moduleState = 1;
        if (iframe) {
          var embedVideoId = location.href.match(/\/embed\/([\w\-]+)/i);
          embedVideoId = embedVideoId && embedVideoId[1];

          if (!embedVideoId) {
            iframe = false;
          }
        }

        if (location.host.indexOf('m.') === 0) {
          youtube.isMobile = true;

          if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
            youtube.mobileMutationMode.enable();
          }
          return;
        }

        if (iframe) {
          youtube.video_id = embedVideoId;

          youtube.appendFrameButton();
          return;
        }

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          youtube.videoFeed.injectStyle();
          youtube.mutationMode.enable();
        }
      },

      changeState: function(state) {
        moduleState = state;
        if (iframe || youtube.isMobile) {
          return;
        }

        youtube.tutorial.hide();

        youtube.hideCurrentMenu();

        youtube.videoFeed.rmBtn();

        youtube.mutationMode.stop();

        var btn = document.getElementById(youtube.buttonId);
        if (btn) {
          btn.parentNode.removeChild(btn);
        }

        ytUmmyBtn.rmBtn();
        quickConvert.rmBtn();

        if (state) {
          youtube.run();
        }
      },

      hideCurrentMenu: function() {
        if (youtube.currentMenu) {
          youtube.currentMenu.hide();
          youtube.currentMenu = null;
        }
      },

      hideMobileMenu: function() {
        if (youtube.mobileMenu) {
          youtube.mobileMenu.hide();
          youtube.mobileMenu = null;
        }
      },

      mutationMode: {
        observer: null,
        stop: function() {
          if (youtube.mutationMode.observer) {
            youtube.mutationMode.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        wrapVideoFeedOnImgHover: function() {
          if (!moduleState) {
            return;
          }

          if (this.dataset.sfBtn > 0) {
            return;
          }
          this.dataset.sfBtn = '1';

          var context = JSON.parse(this.dataset.sfContext);
          this.appendChild(youtube.videoFeed.getBtnNode(context.id, context.styleIndex));
        },
        wrapNewVideoFeedOnThumbnailHover: function() {
          var _this = youtube.mutationMode;
          var node = this;
          var url = node.href;
          var m = url && url.match(youtube.videoFeed.hrefIdPattern);
          var id = m && m[1];
          if (id) {
            if (!node.querySelector('.sf-feed-btn')) {
              var btnNode = youtube.videoFeed.getBtnNode(id, 2);
              mono.onRemoveEvent(btnNode, function() {
                if (!this.parentNode) {
                  mono.one(node, 'mouseover', _this.wrapNewVideoFeedOnThumbnailHover);
                }
              });
              node.appendChild(btnNode);
            }
          }
          url = null;
          m = null;
          id = null;
          btnNode = null;
        },
        enable: function() {
          var _this = this;

          if (_this.observer) {
            return _this.observer.start();
          }

          _this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, node, n, i, id, el, context;

              summary = summaryList[0];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                youtube.appendDownloadButton(node);
              }

              if (youtube.videoFeed.testUrl(location.href)) {
                for (i = 1; i < 3; i++) {
                  summary = summaryList[i];
                  for (n = 0; node = summary.added[n]; n++) {
                    if (node.dataset.sfSkip > 0) {
                      continue;
                    }
                    node.dataset.sfSkip = '1';

                    id = node.dataset.videoIds;
                    if (id) {
                      el = node.parentNode;
                      context = {};
                      context.id = id;
                      context.styleIndex = 1;
                      el.dataset.sfContext = JSON.stringify(context);
                      mono.one(el, 'mouseover', _this.wrapVideoFeedOnImgHover);
                    }
                  }
                }

                for (i = 3; i < 4; i++) {
                  summary = summaryList[i];
                  for (n = 0; node = summary.added[n]; n++) {
                    if (node.dataset.sfSkip > 0) {
                      continue;
                    }
                    node.dataset.sfSkip = '1';

                    mono.one(node.parentNode, 'mouseover', _this.wrapNewVideoFeedOnThumbnailHover);
                  }
                }
              }

              summary = summaryList[4];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                youtube.appendNewDownloadButton(node);
              }

              summary = summaryList[5];
              for (n = 0; node = summary.removed[n]; n++) {
                mono.onRemoveListener(node);
              }
            },
            queries: [{
              css: '#watch7-subscription-container',
              is: 'added'
            }, {
              css: 'button.addto-watch-later-button-sign-in',
              is: 'added'
            }, {
              css: 'button.addto-watch-later-button',
              is: 'added'
            }, {
              css: 'ytd-thumbnail a#thumbnail img',
              is: 'added'
            }, {
              css: 'ytd-watch #info #top-level-buttons',
              is: 'added'
            }, {
              css: '.' + mono.onRemoveClassName,
              is: 'removed'
            }]
          });
        }
      },

      mobileMutationMode: {
        observer: null,
        stop: function() {
          if (youtube.mutationMode.observer) {
            youtube.mutationMode.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        enable: function() {
          var _this = this;

          if (_this.observer) {
            return _this.observer.start();
          }

          _this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, node, n, i;

              summary = summaryList[0];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.id.indexOf('koya_elem_') !== 0) {
                  continue;
                }

                var ii = 0;
                while (ii < 4 && node) {
                  node = node.parentNode;
                  ii++;
                }

                if (!node || ii !== 4) {
                  continue;
                }

                var styleIndex = 1;

                // check is single video
                var firstChild = node.querySelector('div:nth-child(1)>h1:nth-child(1)');
                if (!firstChild) {
                  firstChild = null;
                }

                // check is playlist
                if (!firstChild) {
                  if (mono.matches(node, 'div > div > div[id^="koya_child_"]:last-child > div')) {
                    firstChild = node;
                    ii = 0;
                    while (ii < 3 && firstChild) {
                      firstChild = firstChild.parentNode;
                      ii++;
                    }
                    if (!firstChild || !firstChild.querySelector('div:nth-child(1)>h2:nth-child(1)')) {
                      firstChild = null;
                    } else {
                      node = node.parentNode;
                      styleIndex = 2;
                    }
                  }
                }

                if (!firstChild) {
                  continue;
                }

                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                youtube.appendMobileButton('', node, styleIndex);
              }

              summary = summaryList[1];
              for (n = 0; node = summary.removed[n]; n++) {
                mono.onRemoveListener(node);
              }
            },
            queries: [{
              css: 'div > div > div > a[onclick][href="#"] > span[id]',
              is: 'added'
            }, {
              css: '.' + mono.onRemoveClassName,
              is: 'removed'
            }]
          });
        }
      },

      _onSelectBtnClick: function(wrapBtnObj, e) {
        if (e.button > 0) {
          return;
        }

        e.stopPropagation();
        e.preventDefault();

        if (youtube.currentMenu && youtube.currentMenu.isShow) {
          youtube.hideCurrentMenu();
          return;
        }

        var btnObj = wrapBtnObj.btnObj;

        var videoId = btnObj.videoId;

        var menu = youtube.currentMenu = SaveFrom_Utils.popupMenu.quickInsert(btnObj.node, language.download + ' ...', 'sf-popupMenu', {
          onShow: function() {
            mono.onRemoveEvent(btnObj.node, youtube.hideCurrentMenu);
          },
          onHide: function() {
            mono.offRemoveEvent(btnObj.node, youtube.hideCurrentMenu);
          },
          onItemClick: function(e, menuItem) {
            "use strict";
            var itag = menuItem.itag;
            if (itag === 'ummyAudio') {
              itag = 'ummy';
            }

            btnObj.lastItag !== itag && mono.storage.set({
              ytLastITag: itag
            }, function() {
              youtube.quickBtn.setValue(btnObj);
            });

            youtube.onMenuItemClick(menuItem, {
              isPageItem: 1,
              videoId: videoId
            });
          },
          offsetTop: btnObj.popupMenu && btnObj.popupMenu.offsetTop,
          offsetRight: btnObj.popupMenu && btnObj.popupMenu.offsetRight,
          parent: btnObj.popupMenu && btnObj.popupMenu.parent
        });

        var abort = function() {
          menu.update(language.noLinksFound);
        };

        if (!videoId) {
          return abort();
        }

        var onResponse = function(response) {
          if (response.links) {
            var menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.youtube(response.links, response.title, response.subtitles);
            menu.update(menuLinks);
            return;
          }

          abort();
        };

        var response = youtube.responseCache[videoId];
        if (response) {
          return onResponse(response);
        }

        mono.sendMessage({
          action: 'getYoutubeLinks',
          extVideoId: videoId,
          url: location.href,
          checkSubtitles: true
        }, function(response) {
          if (response.links) {
            youtube.responseCache[videoId] = response;
          }

          onResponse(response);
        });

        if (btnObj.isFirstMenuShow) {
          btnObj.isFirstMenuShow = false;

          if ([1].indexOf(preference.cohortIndex) !== -1) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'youtube',
              ea: 'click',
              el: 'video-single'
            });
          }
        }
      },
      appendDownloadButton: function(parent) {
        var currentBtn = parent.querySelector('#' + youtube.buttonId);
        if (currentBtn) {
          currentBtn.parentNode && currentBtn.parentNode.removeChild(currentBtn);
          currentBtn = null;
        }


        var _this = this;

        var wrapBtnObj = {};
        var btnObj = _this.getButtonUnderVideo(youtube._onSelectBtnClick.bind(null, wrapBtnObj));
        wrapBtnObj.btnObj = btnObj;
        btnObj.isFirstMenuShow = true;

        btnObj.setLoadingState();

        parent.appendChild(btnObj.node);

        getPlayerConfig(function(config) {
          var videoId = null;

          if (config && config.args && config.args.video_id) {
            videoId = config.args.video_id;
          }

          if (!videoId) {
            return;
          }

          btnObj.node.dataset.sfVideoId = videoId;

          btnObj.ytConfig = config;
          btnObj.videoId = videoId;
          btnObj.isPage = 1;

          var onGetLinksArr = [];

          var insertTutorial = function() {
            insertTutorial = null;
            youtube.tutorial.show({
              target: btnObj.node
            });
          };

          onGetLinksArr.push(function() {
            return insertTutorial && insertTutorial();
          });

          if (preference.enableConverter) {
            if (preference.showMp3Btn) {
              insertTutorial = null;

              onGetLinksArr.push(function(menuLinks) {
                if (menuLinks.length === 0) {
                  return;
                }

                var convBtn = quickConvert.create(menuLinks);

                if (convBtn) {
                  parent.appendChild(convBtn);

                  mono.storage.get(['onceYtTutorialTooltip', 'onceShowConvRate'], function(storage) {
                    if (!storage.onceYtTutorialTooltip) {
                      youtube.tutorial.show({
                        target: convBtn
                      });
                    } else if (storage.onceShowConvRate === 1) {
                      quickConvert.rateTooltip.bind({
                        target: convBtn
                      });
                    }
                  });
                }
              });
            }
          } else {
            var ummyBtn = ytUmmyBtn(language, preference, videoId);

            if (ummyBtn) {
              onGetLinksArr.push(function(menuLinks) {
                var links = menuLinks.slice(0);
                links = SaveFrom_Utils.popupMenu.sortMenuItems(links, {
                  typeList: ['video', '3d', 'mute', 'mute60'],
                  groupCompare: true
                });
                if (links.length === 0) {
                  return;
                }

                var best = links[0];
                var quality = best.prop && best.prop.quality;

                if (['8K', '4K', '1440', '1080'].indexOf(quality) === -1) {
                  return;
                }

                mono.trigger(ummyBtn, 'changeValue', {
                  detail: JSON.stringify(best.prop && best.prop.quality)
                });
              });

              parent.appendChild(ummyBtn);
            }
          }

          btnObj.onGetLinksArr = onGetLinksArr;

          _this.quickBtn.setValue(btnObj);
        });
      },

      appendNewDownloadButton: function(parent) {
        var _this = this;

        var currentBtn = parent.querySelector('#' + youtube.buttonId);
        if (currentBtn) {
          currentBtn.parentNode && currentBtn.parentNode.removeChild(currentBtn);
          currentBtn = null;
        }

        var btnObj = new this.getNewButtonUnderVideo(youtube._onSelectBtnClick);
        btnObj.isFirstMenuShow = true;
        btnObj.setLoadingState();

        var secondBtn = parent.childNodes[2];
        if (!secondBtn) {
          secondBtn = parent.firstChild;
        }
        if (secondBtn) {
          parent.insertBefore(btnObj.node, secondBtn);
        } else {
          parent.appendChild(btnObj.node);
        }

        mono.onRemoveEvent(btnObj.node, function() {
          if (parent.parentNode) {
            youtube.appendNewDownloadButton(parent);
          }
        });

        btnObj.popupMenu = {
          offsetTop: -6,
          offsetRight: -1,
          parent: btnObj.menuContainer
        };

        return getNewPlayerConfig(function(config) {
          var videoId = config && config.args && config.args.video_id;
          if (!videoId) {
            mono.debug('videoId is not found!');
            return;
          }

          btnObj.node.dataset.sfVideoId = videoId;
          btnObj.ytConfig = config;
          btnObj.videoId = videoId;
          btnObj.isPage = 1;

          var onGetLinksArr = [];
          btnObj.onGetLinksArr = onGetLinksArr;

          onGetLinksArr.push(function() {
            youtube.tutorial.show({
              target: btnObj.node,
              parent: btnObj.menuContainer,
              btnLeftOffset: -6,
              btnTopOffset: 3
            });
          });

          _this.quickBtn.setValue(btnObj);
        });
      },


      getIdFromLocation: function(url) {
        if (!url) {
          url = document.location.href;
        }

        var videoId = url.match(/\/watch\?(?:.+&)?v=([\w\-]+)/i);
        videoId = videoId && videoId[1];
        if (videoId) {
          return videoId;
        }

        return null;
      },

      appendMobileButton: function(vid, container, styleIndex) {
        var style = {};

        if (styleIndex === 1) {
          mono.extend(style, {
            display: 'inline-block',
            height: '28px',
            width: '18px',
            marginRight: '20px',
            background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#757575') + ') center no-repeat',
            cssFloat: 'right'
          });
        } else
        if (styleIndex === 2) {
          mono.extend(style, {
            display: 'inline-block',
            height: '38px',
            width: '18px',
            marginRight: '12px',
            background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#757575') + ') center no-repeat',
            backgroundSize: '20px',
            cssFloat: 'right'
          });
        }

        var button = mono.create('div', {
          data: {
            id: vid
          },
          style: style,
          on: ['click', function() {
            var vid = this.dataset.id || youtube.getIdFromLocation();

            youtube.hideMobileMenu();

            var lightBox = youtube.mobileMenu = SaveFrom_Utils.mobileLightBox.show(language.download + ' ...');

            var onResponse = function(response) {
              var menuLinks = null;
              if (response && response.links) {
                menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.youtube(response.links, response.title || youtube.getTitleModify());
              }
              lightBox.update(menuLinks);
            };

            var fromCache = youtube.responseCache[vid];
            if (fromCache) {
              return onResponse(fromCache);
            }

            mono.sendMessage({
              action: 'getYoutubeLinks',
              extVideoId: vid,
              url: location.href
            }, function(response) {
              if (response.links) {
                youtube.responseCache[vid] = response;
              }
              onResponse(response);
            });
          }]
        });

        mono.onRemoveEvent(button, youtube.hideMobileMenu);

        var btnSelector = 'div[id^="koya_child_"]:nth-child(1) > a[href="#"] > span[id^="koya_elem_"]';
        var lastNode = container.lastElementChild;
        if (!lastNode.querySelector(btnSelector)) {
          lastNode = lastNode.previousElementSibling;
          if (!lastNode.querySelector(btnSelector)) {
            lastNode = null;
          }
        }

        if (lastNode) {
          lastNode = lastNode.nextElementSibling;
        }

        if (lastNode) {
          lastNode.parentNode.insertBefore(button, lastNode);
        } else {
          container.appendChild(button);
        }
      },
      getNewButtonUnderVideo: function(onSelectBtnClick) {
        var _this = this;
        this.node = mono.create('div', {
          id: youtube.buttonId,
          style: {
            display: [
              '-ms-flexbox',
              '-webkit-flex',
              'flex'
            ],
            marginLeft: '8px',
            MsFlexDirection: 'row',
            WebkitFlexDirection: 'row',
            flexDirection: 'row',
            MsFlexAlign: 'center',
            WebkitAlignItems: 'center',
            alignItems: 'center',
            MsFlexPack: 'center',
            WebkitJustifyContent: 'center',
            justifyContent: 'center',
            padding: '0 8px 0 0'
          },
          append: [
            this.menuContainer = mono.create('div', {
              style: {
                position: 'relative'
              }
            }),
            this.quickBtn = mono.create('a', {
              class: 'sf-quick-dl-btn',
              style: {
                display: 'inline-block',
                fontSize: 'inherit',
                height: '22px',
                border: '1px solid #00B75A',
                borderRadius: '3px',
                borderTopRightRadius: 0,
                borderBottomRightRadius: 0,
                paddingLeft: '28px',
                cursor: 'pointer',
                verticalAlign: 'middle',
                position: 'relative',
                lineHeight: '22px',
                textDecoration: 'none',
                zIndex: 1,
                color: '#fff'
              },
              href: '#',
              append: [
                mono.create('i', {
                  style: {
                    position: 'absolute',
                    display: 'inline-block',
                    left: '6px',
                    top: '3px',
                    backgroundImage: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#ffffff') + ')',
                    backgroundSize: '12px',
                    backgroundRepeat: 'no-repeat',
                    backgroundPosition: 'center',
                    width: '16px',
                    height: '16px'
                  }
                }),
                mono.create('span', {
                  class: 'sf-btn-name',
                  style: {
                    paddingRight: '12px'
                  },
                  text: language.download
                })
              ]
            }),
            this.quickBtnStyle = mono.create('style', {
              text: mono.style2Text({
                selector: '#' + youtube.buttonId,
                style: {
                  fontFamily: 'Roboto, Arial, sans-serif',
                  fontSize: '13px'
                },
                append: [{
                  'button::-moz-focus-inner': {
                    padding: 0,
                    margin: 0
                  },
                  '.sf-quick-dl-btn': {
                    backgroundColor: '#00B75A'
                  },
                  '.sf-quick-dl-btn:hover': {
                    backgroundColor: 'rgb(0, 163, 80)'
                  },
                  '.sf-quick-dl-btn:active': {
                    backgroundColor: 'rgb(0, 151, 74)'
                  }
                }, {
                  media: '@media screen and (max-width: 1293px)',
                  append: {
                    '.sf-quick-dl-btn .sf-btn-name': {
                      display: 'none'
                    }
                  }
                }]
              })
            }),
            this.selectBtn = mono.create('button', {
              style: {
                position: 'relative',
                display: 'inline-block',
                marginLeft: '-2px',
                fontSize: 'inherit',
                height: '24px',
                paddingRight: '21px',
                backgroundColor: '#F8F8F8',
                border: '1px solid #CCCCCC',
                borderRadius: '3px',
                borderTopLeftRadius: '0',
                borderBottomLeftRadius: '0',
                cursor: 'pointer',
                color: '#9B9B9B',
                zIndex: 0,
                verticalAlign: 'middle'
              },
              on: ['mousedown', function(e) {
                return onSelectBtnClick.call(this, {
                  btnObj: _this
                }, e);
              }],
              append: [
                this.selectBtnIcon = mono.create('i', {
                  style: {
                    position: 'absolute',
                    display: 'inline-block',
                    top: '9px',
                    right: '6px',
                    border: '5px solid #868282',
                    borderBottomColor: 'transparent',
                    borderLeftColor: 'transparent',
                    borderRightColor: 'transparent'
                  }
                })
              ]
            })
          ]
        });

        this.node.classList.add(mono.onRemoveClassName);

        var setQuality = function(text) {
          var node = typeof text === 'object' ? text : document.createTextNode(text);
          node.style.marginLeft = 0;
          var first = _this.selectBtn.firstChild;
          if (first === _this.selectBtnIcon) {
            _this.selectBtn.insertBefore(node, first);
          } else {
            _this.selectBtn.replaceChild(node, first);
          }
        };

        this.setQuality = setQuality;

        this.setLoadingState = function() {
          setQuality(mono.create('img', {
            src: SaveFrom_Utils.svg.getSrc('info', '#333333'),
            style: {
              width: '14px',
              height: '14px',
              marginLeft: '6px',
              verticalAlign: 'middle',
              top: '-1px',
              position: 'relative'
            }
          }));
        };
      },
      getButtonUnderVideo: function(onSelectBtnClick) {
        var selectBtnIcon = null;
        var quickBtn = null;
        var selectBtn = null;
        var node = mono.create('div', {
          id: youtube.buttonId,
          style: {
            display: 'inline-block',
            marginLeft: '10px',
            verticalAlign: 'middle'
          },
          append: [
            quickBtn = mono.create('a', {
              class: 'sf-quick-dl-btn',
              style: {
                display: 'inline-block',
                fontSize: 'inherit',
                height: '22px',
                border: '1px solid #00B75A',
                borderRadius: '3px',
                borderTopRightRadius: 0,
                borderBottomRightRadius: 0,
                paddingLeft: '28px',
                cursor: 'pointer',
                verticalAlign: 'middle',
                position: 'relative',
                lineHeight: '22px',
                textDecoration: 'none',
                zIndex: 1,
                color: '#fff'
              },
              href: '#',
              append: [
                mono.create('i', {
                  style: {
                    position: 'absolute',
                    display: 'inline-block',
                    left: '6px',
                    top: '3px',
                    backgroundImage: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#ffffff') + ')',
                    backgroundSize: '12px',
                    backgroundRepeat: 'no-repeat',
                    backgroundPosition: 'center',
                    width: '16px',
                    height: '16px'
                  }
                }),
                mono.create('span', {
                  class: 'sf-btn-name',
                  style: {
                    paddingRight: '12px'
                  },
                  text: language.download
                })
              ]
            }),
            mono.create('style', {
              text: mono.style2Text({
                selector: '#' + youtube.buttonId,
                append: [{
                  'button::-moz-focus-inner': {
                    padding: 0,
                    margin: 0
                  },
                  '.sf-quick-dl-btn': {
                    backgroundColor: '#00B75A'
                  },
                  '.sf-quick-dl-btn:hover': {
                    backgroundColor: 'rgb(0, 163, 80)'
                  },
                  '.sf-quick-dl-btn:active': {
                    backgroundColor: 'rgb(0, 151, 74)'
                  }
                }, {
                  media: '@media screen and (max-width: 1293px)',
                  append: {
                    '.sf-quick-dl-btn .sf-btn-name': {
                      display: 'none'
                    }
                  }
                }]
              })
            }),
            selectBtn = mono.create('button', {
              style: {
                position: 'relative',
                display: 'inline-block',
                marginLeft: '-2px',
                fontSize: 'inherit',
                height: '24px',
                paddingRight: '21px',
                backgroundColor: '#F8F8F8',
                border: '1px solid #CCCCCC',
                borderRadius: '3px',
                borderTopLeftRadius: '0',
                borderBottomLeftRadius: '0',
                cursor: 'pointer',
                color: '#9B9B9B',
                zIndex: 0,
                verticalAlign: 'middle'
              },
              on: ['mousedown', onSelectBtnClick],
              append: [
                selectBtnIcon = mono.create('i', {
                  style: {
                    position: 'absolute',
                    display: 'inline-block',
                    top: '9px',
                    right: '6px',
                    border: '5px solid #868282',
                    borderBottomColor: 'transparent',
                    borderLeftColor: 'transparent',
                    borderRightColor: 'transparent'
                  }
                })
              ]
            })
          ]
        });

        node.classList.add(mono.onRemoveClassName);

        var setQuality = function(text) {
          var node = typeof text === 'object' ? text : document.createTextNode(text);
          var first = selectBtn.firstChild;
          if (first === selectBtnIcon) {
            selectBtn.insertBefore(node, first);
          } else {
            selectBtn.replaceChild(node, first);
          }
        };

        return {
          node: node,
          selectBtn: selectBtn,
          quickBtn: quickBtn,
          setQuality: setQuality,
          setLoadingState: function() {
            setQuality(mono.create('img', {
              src: SaveFrom_Utils.svg.getSrc('info', '#333333'),
              style: {
                width: '14px',
                height: '14px',
                marginLeft: '6px',
                verticalAlign: 'middle',
                top: '-1px',
                position: 'relative'
              }
            }));
          }
        };
      },
      titleChangeObserver: null,
      playerStateChangeObserver: null,
      observeFrameVideoChange: function(btnObj) {
        "use strict";
        var _this = this;

        if (!SaveFrom_Utils.mutationWatcher.isAvailable()) {
          return;
        }

        var playerTitle = document.querySelector('.ytp-title-link');
        if (playerTitle) {
          if (this.titleChangeObserver) {
            this.titleChangeObserver.stop();
          }
          this.titleChangeObserver = SaveFrom_Utils.mutationAttrWatcher.run({
            attr: 'href',
            target: playerTitle,
            callback: function(summaryList) {
              var summary = summaryList[0];
              var oldVideoId = summary.oldValue && youtube.getIdFromLocation(summary.oldValue);
              var videoId = summary.value && youtube.getIdFromLocation(summary.value);
              if (oldVideoId !== videoId && youtube.video_id !== videoId) {
                youtube.video_id = videoId;

                if (youtube.frameQualityDetected) {
                  btnObj.link = null;
                  btnObj.setLoadingState();

                  _this.quickBtn.setValue(btnObj);
                }
              }
            }
          });
        }

        var playerMenu = document.querySelector('.html5-video-player');
        if (playerMenu) {
          var hideBtnTimer = null;
          var ytpAutohideRe = /(\s|^)ytp-autohide(\s|$)/;
          if (this.playerStateChangeObserver) {
            this.playerStateChangeObserver.stop();
          }
          this.playerStateChangeObserver = SaveFrom_Utils.mutationAttrWatcher.run({
            attr: 'class',
            target: playerMenu,
            callback: function(summaryList) {
              var summary = summaryList[0];
              var showBefore = ytpAutohideRe.test(summary.oldValue);
              var showAfret = ytpAutohideRe.test(summary.value);
              if (!showBefore && showAfret) {
                clearTimeout(hideBtnTimer);
                hideBtnTimer = setTimeout(function() {
                  if (!btnObj.lockHide) {
                    btnObj.container.classList.add('sf-hide-ui');
                  }
                }, 100);
              } else
              if (showBefore && !showAfret) {
                clearTimeout(hideBtnTimer);
                btnObj.container.classList.remove('sf-hide-ui');
              }
            }
          });
        }
      },

      appendFrameButton: function() {
        "use strict";
        if (document.body.clientWidth < 220 || document.body.clientHeight < 150) {
          return;
        }

        var _this = youtube;

        var firstMenuShow = true;

        var btnObj = SaveFrom_Utils.frameMenu.getBtn({
          btnId: 'sfYtFrameBtn',
          containerStyle: {
            top: '40px',
            right: '20px'
          },
          on: [
            ['mousedown', function(e) {
              e.stopPropagation();
              if (e.button !== 2) {
                return;
              }

              if (_this.onFrameMouseEnterBind) {
                mono.off(document.body, 'mouseenter', _this.onFrameMouseEnterBind);
                mono.off(document.body, 'mouseleave', _this.onFrameMouseLeaveBind);
                _this.onFrameMouseEnterBind = null;
                _this.onFrameMouseLeaveBind = null;
              }
              if (_this.titleChangeObserver) {
                _this.titleChangeObserver.stop();
                _this.titleChangeObserver = null;
              }
              if (_this.playerStateChangeObserver) {
                _this.playerStateChangeObserver.stop();
                _this.playerStateChangeObserver = null;
              }
              _this.hideCurrentMenu();
              if (btnObj.container.parentNode) {
                btnObj.container.parentNode.removeChild(btnObj.container);
              }
            }]
          ],
          onSelectBtn: ['mousedown', function(e) {
            if (e.button > 0) {
              return;
            }

            e.stopPropagation();
            e.preventDefault();

            var vid = _this.video_id;

            if (_this.currentMenu) {
              youtube.hideCurrentMenu();
              return;
            }

            var menu = _this.currentMenu = SaveFrom_Utils.frameMenu.getMenu(this.parentNode, language.download + ' ...', 'sf-popupMenu', {
              container: btnObj.container,
              onShow: function() {
                btnObj.node.classList.add('sf-over');

                if (!firstMenuShow) {
                  firstMenuShow = false;

                  if ([1].indexOf(preference.cohortIndex) !== -1) {
                    mono.sendMessage({
                      action: 'trackCohort',
                      t: 'event',
                      ec: 'youtube',
                      ea: 'click',
                      el: 'video-iframe'
                    });
                  }
                }
              },
              onHide: function() {
                _this.currentMenu = null;
                btnObj.node.classList.remove('sf-over');
              },
              onItemClick: function(e, menuItem) {
                var itag = menuItem.itag;
                if (itag === 'ummyAudio') {
                  itag = 'ummy';
                }

                btnObj.lastItag !== itag && mono.storage.set({
                  ytLastITag: itag
                }, function() {
                  _this.quickBtn.setValue(btnObj);
                });

                youtube.onMenuItemClick(menuItem, {
                  isFrameItem: 1,
                  videoId: vid
                });
              }
            });

            var onResponse = function(response) {
              var menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.youtube(response.links, response.title, response.subtitles, {
                ummyVid: 136
              });
              menu.update(menuLinks);
            };

            var response = _this.responseCache[vid];
            if (response) {
              return onResponse(response);
            }

            mono.sendMessage({
              action: 'getYoutubeLinks',
              extVideoId: vid,
              url: location.href,
              checkSubtitles: true
            }, function(response) {
              if (response.links) {
                _this.responseCache[vid] = response;
                return onResponse(response);
              }

              menu.update(language.noLinksFound);
            });
          }]
        });

        btnObj.setLoadingState();

        btnObj.container = mono.create('div', {
          class: 'sf-btn-ctr',
          append: btnObj.node
        });
        document.body.appendChild(btnObj.container);

        var onBtnMouseEnter = function() {
          mono.off(btnObj.node, 'mouseenter', onBtnMouseEnter);

          if (_this.frameQualityDetected) {
            return;
          }
          _this.frameQualityDetected = true;

          _this.quickBtn.setValue(btnObj);
        };

        mono.on(btnObj.node, 'mouseenter', onBtnMouseEnter);

        mono.one(document, 'mouseover', function() {
          _this.onFrameMouseEnter(btnObj);
        });

        mono.on(btnObj.container, 'mouseenter', function() {
          btnObj.lockHide = true;
        });

        mono.on(btnObj.container, 'mouseleave', function() {
          btnObj.lockHide = false;
        });

        btnObj.node.appendChild(mono.create('style', {
          text: mono.style2Text([{
            selector: [
              'body:hover .sf-btn-ctr:not(.sf-hide-ui) #sfYtFrameBtn',
              'body:hover .sf-btn-ctr:not(.sf-hide-ui) .sf-popupMenu'
            ],
            style: {
              display: 'block'
            }
          }])
        }));

        if (this.onFrameMouseEnterBind) {
          mono.off(document.body, 'mouseenter', this.onFrameMouseEnterBind);
          mono.off(document.body, 'mouseleave', this.onFrameMouseLeaveBind);
        }

        this.onFrameMouseEnterBind = this.onFrameMouseEnter.bind(this, btnObj);
        this.onFrameMouseLeaveBind = this.onFrameMouseLeave.bind(this, btnObj);

        mono.on(document.body, 'mouseenter', this.onFrameMouseEnterBind);
        mono.on(document.body, 'mouseleave', this.onFrameMouseLeaveBind);

        this.observeFrameVideoChange(btnObj);
      },

      frameQualityDetected: false,
      frameQualityTimer: null,

      onFrameMouseEnterBind: null,
      onFrameMouseLeaveBind: null,

      onFrameMouseEnter: function(btnObj) {
        "use strict";
        var _this = this;
        if (!this.frameQualityDetected) {
          clearTimeout(this.frameQualityTimer);
          this.frameQualityTimer = setTimeout(function() {
            if (_this.frameQualityDetected) {
              return;
            }
            _this.frameQualityDetected = true;


            _this.quickBtn.setValue(btnObj);
          }, 500);
        }
      },

      onFrameMouseLeave: function(btnObj) {
        "use strict";
        if (!this.frameQualityDetected) {
          clearTimeout(this.frameQualityTimer);
        }
      },

      getTitle: function() {
        var t = document.getElementById('watch-headline-title');
        if (t)
          return t.textContent;

        var meta = document.getElementsByTagName('meta');
        for (var i = 0; i < meta.length; i++) {
          var name = meta[i].getAttribute('name');
          if (name && name.toLowerCase() == 'title')
            return meta[i].getAttribute('content');
        }

        if (iframe || youtube.isMobile)
          return document.title.replace(/ - YouTube$/, '');

        return '';
      },

      getTitleModify: function() {
        "use strict";
        var title = youtube.getTitle();
        if (title) {
          title = modifyTitle(title);
        }

        return title;
      },

      onMenuItemClick: function(link, details) {
        "use strict";
        details = details || {};

        var data = {
          itag: link.itag || '',
          quality: link.quality || '',
          format: link.format || '???',
          '3d': link['3d'] ? '3D' : '',
          sFps: link.sFps ? 'fps' + (link.fps || 60) : '',
          noAudio: link.noAudio ? 'no audio' : '',
          uIsAudio: link.uIsAudio ? 'audio' : ''
        };

        if (!link.format) {
          mono.sendMessage({
            action: 'track',
            t: 'event',
            ec: 'youtube',
            ea: 'new_format',
            el: link.itag + ' ' + details.videoId
          });
        }

        var label = [
          data.format
        ];

        if (data.quality === 'ummy') {
          if (data.uIsAudio) {
            label.push(data.uIsAudio);
          }

          if (details.isFrame || details.isFrameItem) {
            label.push('if');
          }
        } else {
          if (data.extra) {
            label.push(data.extra);
          }
          if (data.quality) {
            label.push(data.quality.replace(' ' + mono.global.language.kbps, ''));
          }
          if (data.sFps) {
            label.push(data.sFps);
          }
          if (data['3d']) {
            label.push(data['3d']);
          }
          if (data.noAudio) {
            label.push(data.noAudio);
          }
          label.push(data.itag);
        }

        label = label.join(' ');

        if (['18', '22'].indexOf(String(data.itag)) === -1) {
          mono.sendMessage({
            action: 'track',
            t: 'event',
            ec: 'youtube',
            ea: 'download',
            el: label
          });
        }
      },

      onDlBtnClick: function(e, link, details) {
        details = details || {};
        if (!link) {
          e.preventDefault();
          e.stopPropagation();
          mono.trigger(this.parentNode.lastChild, 'mousedown');
          return;
        }

        youtube.onMenuItemClick(link, details);

        if (link.quality !== 'ummy') {
          if (link.forceDownload) {
            SaveFrom_Utils.downloadOnClick(e);
          }
        }
      },

      quickBtn: {
        prepMenuLinks: function(links, title) {
          "use strict";
          var menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.youtube(links, title);
          var ummyLinks = {};

          var linkList = [];
          for (var i = 0, item; item = menuLinks[i]; i++) {
            if (item.quality === 'ummy') {
              ummyLinks[item.itag] = item;
            }
            linkList.push({
              prop: item
            });
          }
          menuLinks = SaveFrom_Utils.popupMenu.sortMenuItems(linkList);

          return {
            menuLinks: menuLinks,
            ummyLinks: ummyLinks
          };
        },

        setValueInSelectBtn: function(details, text) {
          "use strict";
          if (typeof text !== 'object') {
            text = document.createTextNode(text);
          }
          var first = details.selectBtn.firstChild;
          if (first === details.selectBtn.lastChild) {
            details.selectBtn.insertBefore(text, first)
          } else {
            details.selectBtn.replaceChild(text, first);
          }
        },

        getBestItem: function(menuLinks) {
          var sList = [];
          for (var i = 0, item; item = menuLinks[i]; i++) {
            if (item.prop.noAudio || item.prop.noVideo) {
              continue;
            }
            if (item.prop.format === 'ummy') {
              continue;
            }
            if (item.prop.extra) {
              continue;
            }
            if (!item.prop.isHidden) {
              sList.push(item.prop);
            }
          }

          if (!sList.length) {
            return;
          }

          return sList[0];
        },

        bindDlBtn: function(details) {
          "use strict";
          var quickBtn = details.quickBtn;
          if (details.quickBtnEvent) {
            quickBtn.removeEventListener('click', details.quickBtnEvent);
          }
          quickBtn.addEventListener('click', details.quickBtnEvent = function(e) {
            e.stopPropagation();

            if (details.link && youtube.currentMenu) {
              youtube.hideCurrentMenu();
            }

            var dlBtnDetails = {
              videoId: details.videoId || youtube.video_id
            };
            if (details.isPage) {
              dlBtnDetails.isPage = 1;
            } else {
              dlBtnDetails.isFrame = 1;
            }

            youtube.onDlBtnClick.call(this, e, details.link, dlBtnDetails);
          });
        },

        setBestValue: function(details, link) {
          "use strict";
          var quickBtn = details.quickBtn;

          details.link = link;

          var btnText = link.quality;
          if (!link.noVideo) {
            btnText = parseInt(btnText);
          }
          if (link['3d']) {
            btnText = '3D ' + btnText;
          }
          if (link.sFps) {
            btnText += ' ' + (link.fps || 60);
          }

          var textContainer = mono.create('span', {
            text: btnText,
            style: {
              marginLeft: '6px',
              verticalAlign: 'bottom'
            }
          });

          if (details.setQuality) {
            details.setQuality(textContainer);
          } else {
            this.setValueInSelectBtn(details, textContainer);
          }

          var title = [link.format, btnText];
          if (link.noAudio) {
            title.push(language.withoutAudio);
          }
          title = title.join(' ');

          quickBtn.title = title;
          quickBtn.href = link.href;

          if (link.title && link.format) {
            var ext = link.ext;
            if (!ext) {
              ext = link.format.toLowerCase();
            }
            quickBtn.setAttribute('download', mono.fileName.modify(link.title + '.' + ext));
          }
        },

        setUmmyBadge: function(details, link) {
          "use strict";
          var _this = this;
          var quickBtn = details.quickBtn;

          details.link = link;

          mono.sendMessage({
            action: 'getUmmyIcon'
          }, function(dataImg) {
            var ummyIcon = mono.create('span', {
              style: {
                width: '16px',
                height: '16px',
                backgroundImage: 'url(' + dataImg + ')',
                backgroundRepeat: 'no-repeat',
                backgroundPosition: 'center',
                marginLeft: '6px',
                display: 'inline-block',
                verticalAlign: 'top'
              }
            });
            _this.setValueInSelectBtn(details, ummyIcon);
          });

          quickBtn.title = mono.capitalize(link.quality);
          quickBtn.href = link.href;

          quickBtn.removeAttribute('download');
        },

        onGetLinks: function(details, links, title) {
          "use strict";
          var _this = this;
          if (links) {
            var count = Object.keys(links).length;
            if (links.meta) {
              count--;
            }
          }
          if (!links || !count) {
            return this.setValueInSelectBtn(details, '');
          }

          mono.storage.get('ytLastITag', function(storage) {
            var lastItag = storage.ytLastITag;
            if (lastItag === 'ummyAudio') {
              lastItag = 'ummy';
            }
            details.lastItag = lastItag;

            var menuLinks = _this.prepMenuLinks(links, title || youtube.getTitleModify());

            details.onGetLinksArr && details.onGetLinksArr.forEach(function(fn) {
              return fn(menuLinks.menuLinks);
            });

            if (lastItag === 'ummy' && menuLinks.ummyLinks[lastItag]) {
              _this.setUmmyBadge(details, menuLinks.ummyLinks[lastItag]);
            } else {
              var link = _this.getBestItem(menuLinks.menuLinks);
              if (link) {
                _this.setBestValue(details, link);
              } else {
                _this.setValueInSelectBtn(details, '');
              }
            }
          });
        },
        setValue: function(details) {
          "use strict";
          var _this = this;
          this.bindDlBtn(details);

          var vid = details.videoId || youtube.video_id;
          if (!vid) {
            return this.onGetLinks(details);
          }

          var response = youtube.responseCache[vid];
          if (response) {
            this.onGetLinks(details, response.links, response.title);
            response = null;
            return;
          }

          var onResponse = function(response) {
            response = response || {};

            if (response.isQuick) {
              details.quickBtn.dataset.isQuick = '1';
            }

            return _this.onGetLinks(details, response.links, response.title);
          };

          var request = {
            action: 'getYoutubeLinks',
            extVideoId: vid,
            url: location.href,
            noDash: true
          };

          if (details.ytConfig) {
            request.action = 'getYoutubeLinksFromConfig';
            request.config = details.ytConfig;
          }

          mono.sendMessage(request, onResponse);
        }
      },

      videoFeed: {
        style: null,
        hrefIdPattern: /[\?&]v=([^&]+)/,
        imgIdPattern: /vi[^\/]*\/([^\/]+)/,
        rList: [
          /\/playlist\?/,
          /(user|channel|show)\/[^\/]+(\/feed|\/featured|\/videos|$)/i,
          /\/(feed)\/(trending|subscriptions|history)/i
        ],
        testUrl: function(url) {
          return this.rList.some(function(r) {
            return r.test(url);
          });
        },
        injectStyle: function() {
          if (this.style) {
            !this.style.parentNode && document.head.appendChild(this.style);
            return;
          }

          this.style = mono.create('style', {
            class: 'sf-feed-style',
            text: mono.style2Text([{
              selector: [
                'a > .sf-feed-btn',
                'div > .sf-feed-btn',
                'span > .sf-feed-btn'
              ],
              style: {
                display: 'none',
                border: '1px solid #d3d3d3',
                width: '20px',
                height: '20px',
                padding: 0,
                position: 'absolute',
                right: '26px',
                bottom: '2px',
                borderRadius: '2px',
                background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#777777') + ') center no-repeat #F8F8F8',
                backgroundSize: '12px',
                cursor: 'pointer'
              }
            }, {
              selector: [
                'a > .sf-feed-btn.style-2'
              ],
              style: {
                border: 0,
                top: 0,
                left: 0,
                margin: '4px',
                padding: '2px 4px',
                background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#FFF') + ') center no-repeat #000',
                backgroundSize: '14px',
                opacity: '.8'
              }
            }, {
              selector: [
                'a > .sf-feed-btn:hover',
                'div > .sf-feed-btn:hover',
                'span > .sf-feed-btn:hover'
              ],
              style: {
                background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#00B75A') + ') center no-repeat #F8F8F8',
                backgroundSize: '12px'
              }
            }, {
              selector: [
                'a > .sf-feed-btn.style-2:hover'
              ],
              style: {
                border: 0,
                top: 0,
                left: 0,
                margin: '4px',
                padding: '2px 4px',
                background: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#00B75A') + ') center no-repeat #000',
                backgroundSize: '14px',
                opacity: '.8'
              }
            }, {
              selector: [
                'a > .sf-feed-btn:active',
                'div > .sf-feed-btn:active',
                'span > .sf-feed-btn:active'
              ],
              style: {
                outline: 0,
                boxShadow: 'inset 0 3px 5px rgba(0, 0, 0, 0.125)'
              }
            }, {
              selector: [
                'a:hover > .sf-feed-btn',
                'div:hover > .sf-feed-btn',
                'span:hover > .sf-feed-btn'
              ],
              style: {
                display: 'block'
              }
            }])
          });

          document.head.appendChild(this.style);
        },
        rmBtn: function() {
          var nodeList = document.querySelectorAll('.sf-feed-btn');
          for (var i = 0, item; item = nodeList[i]; i++) {
            item.parentNode.removeChild(item);
          }

          ['sfBtn', 'sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            nodeList = document.querySelectorAll('[' + dataAttr + ']');
            for (i = 0, item; item = nodeList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },

        getBtnNode: function(vid, styleIndex) {
          var className = ['sf-feed-btn'];
          if (styleIndex) {
            className.push('style-' + styleIndex);
          }
          return mono.create('i', {
            class: className,
            append: [!mono.isOpera ? undefined : mono.create('img', {
              src: SaveFrom_Utils.svg.getSrc('download', '#777777'),
              style: {
                width: '12px',
                height: '12px',
                margin: '4px'
              }
            })],
            on: ['click', function(e) {
              e.preventDefault();
              e.stopPropagation();

              var _this = this;

              if (youtube.currentMenu && youtube.currentMenu.isShow) {
                youtube.hideCurrentMenu();
                return;
              }

              var menu = youtube.currentMenu = SaveFrom_Utils.popupMenu.quickInsert(_this, language.download + ' ...', 'sf-popupMenu', {
                onShow: function() {
                  mono.onRemoveEvent(_this, youtube.hideCurrentMenu);
                },
                onHide: function() {
                  mono.offRemoveEvent(_this, youtube.hideCurrentMenu);
                },
                onItemClick: function(e, menuItem) {
                  "use strict";
                  youtube.onMenuItemClick(menuItem, {
                    isFeedItem: 1,
                    videoId: vid
                  });
                }
              });

              mono.sendMessage({
                action: 'getYoutubeLinks',
                extVideoId: vid,
                url: location.href,
                checkSubtitles: true
              }, function(response) {
                if (response.links) {
                  var menuLinks = SaveFrom_Utils.popupMenu.prepareLinks.youtube(response.links, response.title, response.subtitles);
                  menu.update(menuLinks);
                  return;
                }

                menu.update(language.noLinksFound);
              });

              if ([1].indexOf(preference.cohortIndex) !== -1) {
                mono.sendMessage({
                  action: 'trackCohort',
                  t: 'event',
                  ec: 'youtube',
                  ea: 'click',
                  el: 'video-playlist'
                });
              }
            }]
          });
        }
      },

      downloadPlaylist: function() {
        var getIdListFromPage = function(container) {
          var idList = [];
          var imgList = container.querySelectorAll('img[src]');
          var pattern = youtube.videoFeed.imgIdPattern;
          for (var i = 0, el; el = imgList[i]; i++) {
            var matched = el.src.match(pattern);
            if (!matched) {
              continue;
            }
            if (idList.indexOf(matched[1]) === -1) {
              idList.push(matched[1]);
            }
          }

          var dataElList = container.querySelectorAll('*[data-video-id]');
          for (i = 0, el; el = dataElList[i]; i++) {
            var id = el.dataset.videoId;
            if (idList.indexOf(id) === -1) {
              idList.push(id);
            }
          }
          return idList;
        };
        var getIdLinks = function(cb) {
          var container = document;
          var url = mono.parseUrl(location.href);
          if (url.list) {
            mono.sendMessage({
              action: 'getYoutubeIdListFromPlaylist',
              listId: url.list,
              baseUrl: location.protocol + '//' + location.host
            }, function(response) {
              if (!response) {
                return cb();
              }
              if (!response.idList || response.idList.length === 0) {
                var container = document.querySelector(".playlist-videos-container > .playlist-videos-list");
                if (container !== null) {
                  response.idList = getIdListFromPage(container);
                }
                if (!response.title) {
                  var title = document.querySelector(".playlist-info > .playlist-title");
                  if (title !== null) {
                    response.title = title.textContent.replace(/\r?\n/g, " ").trim();
                  }
                }
              }
              cb(response.idList, response.title);
            });
          } else {
            var idList = getIdListFromPage(container);
            cb(idList, youtube.getTitle());
          }
        };
        var getVideoLink = function(vid, maxSize, typeList, cb) {
          var useDash = typeList.indexOf('audio') !== -1;
          mono.sendMessage({
            action: 'getYoutubeLinks',
            extVideoId: vid,
            noDash: useDash
          }, function(response) {
            var links = undefined;
            if (response.links) {
              links = SaveFrom_Utils.popupMenu.prepareLinks.youtube(response.links, response.title);
              links = SaveFrom_Utils.popupMenu.sortMenuItems(links, {
                noProp: true,
                maxSize: maxSize,
                minSize: 2,
                typeList: typeList
              });
            }
            cb(links);
          });
        };
        var getVideoLinks = function(idList, maxSize, onProgress, onReady) {
          var abort = false;
          var linkList = {};
          var index = 0;
          var inProgress = 0;
          var listLen = idList.length;

          var typeList = undefined;
          if (maxSize === 'audio') {
            typeList = ['audio'];
            maxSize = undefined;
          } else {
            typeList = ['video'];
            maxSize = parseInt(maxSize) || undefined;
          }

          var getNextOneId = function() {
            if (abort) {
              return;
            }
            var id = idList[index];
            if (id === undefined) {
              if (inProgress === 0) {
                return onReady(linkList);
              } else {
                return;
              }
            }
            index++;
            inProgress++;
            getVideoLink(id, maxSize, typeList, function(links) {
              var firstLink = links ? links[0] : undefined;
              if (firstLink) {
                var ext = firstLink.ext;
                if (!ext) {
                  ext = firstLink.format.toLowerCase();
                }

                var filename = mono.fileName.modify(firstLink.title + '.' + ext);
                linkList[id] = {
                  url: firstLink.href,
                  title: firstLink.title,
                  filename: filename
                };
              }
              onProgress(index, listLen);
              inProgress--;
              getNextOneId();
            });
          };
          getNextOneId();
          getNextOneId();
          return {
            abort: function() {
              abort = true;
            }
          }
        };
        var getPopup = function(onClose) {
          var template = SaveFrom_Utils.playlist.getInfoPopupTemplate();
          var progressEl;
          var qualitySelectBox;
          var qualitySelect;

          mono.sendMessage({
            action: 'getWarningIcon',
            type: 'playlist',
            color: '#77D1FA'
          }, function(icon) {
            template.icon.style.backgroundImage = 'url(' + icon + ')';
          });

          mono.create(template.textContainer, {
            append: [
              mono.create('p', {
                text: language.playlist,
                style: {
                  color: '#0D0D0D',
                  fontSize: '20px',
                  marginBottom: '11px',
                  marginTop: '13px'
                }
              }),
              qualitySelectBox = mono.create('div', {
                append: [
                  mono.create('p', {
                    text: language.quality + ":",
                    style: {
                      color: '#000000',
                      fontSize: '14px',
                      marginBottom: '13px',
                      lineHeight: '24px'
                    },
                    append: [
                      qualitySelect = mono.create('select', {
                        style: {
                          width: '75px',
                          marginLeft: '5px'
                        },
                        append: [
                          mono.create('option', {
                            text: '720',
                            value: '720'
                          }),
                          mono.create('option', {
                            text: '480',
                            value: '480'
                          }),
                          mono.create('option', {
                            text: '360',
                            value: '360'
                          }),
                          mono.create('option', {
                            text: '240',
                            value: '240'
                          }),
                          mono.create('option', {
                            text: 'Audio',
                            value: 'audio'
                          })
                        ]
                      })
                    ]
                  }),
                  mono.create('p', {
                    text: language.qualityNote,
                    style: {
                      color: '#868686',
                      fontSize: '14px',
                      lineHeight: '24px'
                    }
                  })
                ]
              }),
              progressEl = mono.create('p', {
                text: '',
                style: {
                  color: '#868686',
                  fontSize: '14px',
                  lineHeight: '24px'
                }
              })
            ]
          });

          var continueBtn, cancelBtn;
          mono.create(template.buttonContainer, {
            append: [
              cancelBtn = mono.create('button', {
                text: language.cancel,
                style: {
                  height: '27px',
                  width: '118px',
                  backgroundColor: '#ffffff',
                  border: '1px solid #9e9e9e',
                  margin: '12px',
                  marginBottom: '11px',
                  marginRight: '4px',
                  borderRadius: '5px',
                  fontSize: '14px',
                  cursor: 'pointer'
                }
              }),
              continueBtn = mono.create('button', {
                text: language.continue,
                style: {
                  height: '27px',
                  width: '118px',
                  backgroundColor: '#ffffff',
                  border: '1px solid #9e9e9e',
                  margin: '12px',
                  marginBottom: '11px',
                  marginRight: '8px',
                  borderRadius: '5px',
                  fontSize: '14px',
                  cursor: 'pointer'
                }
              })
            ]
          });

          var popupEl = SaveFrom_Utils.popupDiv(template.body, 'pl_progress_popup', undefined, undefined, onClose);
          return {
            qualitySelect: function(cb) {
              progressEl.style.display = 'none';
              template.buttonContainer.style.display = 'block';
              qualitySelectBox.style.display = 'block';
              continueBtn.addEventListener('click', function() {
                cb(qualitySelect.value);
              });
              cancelBtn.addEventListener('click', function() {
                mono.trigger(popupEl, 'kill');
              });
            },
            onPrepare: function(text) {
              progressEl.style.display = 'block';
              template.buttonContainer.style.display = 'none';
              qualitySelectBox.style.display = 'none';
              progressEl.textContent = text;
            },
            onProgress: function(count, max) {
              progressEl.textContent = language.vkFoundFiles.replace('%d', count) + ' ' + language.vkFoundOf + ' ' + max;
            },
            onReady: function(list, title) {
              mono.trigger(popupEl, 'kill');
              if (allowDownloadMode) {
                SaveFrom_Utils.downloadList.showBeforeDownloadPopup(list, {
                  type: 'playlist',
                  folderName: title
                });
              } else {
                SaveFrom_Utils.playlist.popupPlaylist(list, title, true, undefined, 'video');
              }
            },
            onError: function(text) {
              mono.sendMessage({
                action: 'getWarningIcon',
                type: 'playlist',
                color: '#AAAAAA'
              }, function(icon) {
                template.icon.style.backgroundImage = 'url(' + icon + ')';
              });

              progressEl.style.display = 'block';
              template.buttonContainer.style.display = 'none';
              qualitySelectBox.style.display = 'none';
              progressEl.textContent = text;
            }
          }
        };
        return function() {
          var abort = false;
          var gettingLink = undefined;
          var popup = getPopup(function onClose() {
            abort = true;
            if (gettingLink) {
              gettingLink.abort();
            }
          });
          popup.qualitySelect(function(maxSize) {
            popup.onPrepare(language.download + ' ...');
            getIdLinks(function(idList, title) {
              if (abort) {
                return;
              }
              if (!idList || idList.length === 0) {
                popup.onError(language.noLinksFound);
                return;
              }

              gettingLink = getVideoLinks(idList, maxSize, popup.onProgress, function onReady(linkList) {
                var links = [];
                for (var id in linkList) {
                  links.push(linkList[id]);
                }

                var folderName = mono.fileName.modify(title);
                popup.onReady(links, folderName);
              });
            });
          });
          if ([1].indexOf(preference.cohortIndex) !== -1) {
            mono.sendMessage({
              action: 'trackCohort',
              t: 'event',
              ec: 'youtube',
              ea: 'click',
              el: 'video-menu'
            });
          }
        }
      }()
    };

    youtube.tutorial = {
      show: function(details) {
        "use strict";
        if (!SaveFrom_Utils.TutorialTooltip) {
          return;
        }

        this.hide();

        if (!preference.showTutorial) {
          return;
        }

        return mono.storage.get('onceYtTutorialTooltip', function(storage) {
          if (storage.onceYtTutorialTooltip) {
            return;
          }
          storage.onceYtTutorialTooltip = 1;

          details.onClose = function() {
            mono.storage.set(storage);

            attrWatcher && attrWatcher.stop();
          };

          youtube.currentTutorial = new SaveFrom_Utils.TutorialTooltip(details);

          var attrWatcher = null;
          var page = document.querySelector('#page.watch');
          if (page) {
            attrWatcher = youtube.currentTutorial.attrWatcher = SaveFrom_Utils.mutationAttrWatcher.run({
              attr: 'class',
              target: page,
              callback: function() {
                var currentTutorial = youtube.currentTutorial;
                if (currentTutorial && currentTutorial.tooltipNode.parentNode) {
                  currentTutorial.onResize();
                } else {
                  attrWatcher.stop();
                }
              }
            });
          }
        });
      },
      hide: function() {
        var currentTutorial = youtube.currentTutorial;
        if (currentTutorial) {
          currentTutorial.onClose && currentTutorial.onClose(1);
          if (currentTutorial.attrWatcher) {
            currentTutorial.attrWatcher.stop();
          }
          youtube.currentTutorial = null;
        }
      }
    };

    var modifyTitle = function(t) {
      t = t.replace(/[\x2F\x5C\x3A\x7C]/g, '-');
      t = t.replace(/[\x2A\x3F]/g, '');
      t = t.replace(/\x22/g, '\'');
      t = t.replace(/\x3C/g, '(');
      t = t.replace(/\x3E/g, ')');
      t = t.replace(/(?:^\s+)|(?:\s+$)/g, '');
      return t;
    };

    var getPlayerConfig = function(cb) {
      return SaveFrom_Utils.bridge({
        func: function(cb) {
          var ytPlayerConfig = window.ytplayer && window.ytplayer.config;
          if (!ytPlayerConfig) {
            return cb();
          }
          cb({
            args: ytPlayerConfig.args,
            sts: ytPlayerConfig.sts,
            assets: ytPlayerConfig.assets
          })
        },
        timeout: 300,
        cb: function(data) {
          if (!data || !data.args || !data.args.video_id) {
            var metaVideoId = document.querySelector('#watch7-content meta[itemprop="videoId"]');
            var videoId = metaVideoId && metaVideoId.getAttribute('content');
            if (videoId) {
              data = data || {};
              data.args = data.args || {};
              data.args.video_id = videoId;
            }
          }

          cb(data);
        }
      });
    };

    var getNewPlayerConfig = function(cb) {
      return SaveFrom_Utils.bridge({
        func: function(cb) {
          var player = document.querySelector('#movie_player');

          if (!player || !player.getVideoData) {
            return cb();
          }

          (function(fn) {
            if (fn && !fn.sf_apply) {
              fn.sf_apply = fn.apply;
              fn.apply = function(self, args) {
                var playerArgs = args[0];
                if (playerArgs && playerArgs.video_id) {
                  var vars = JSON.parse(JSON.stringify(playerArgs));
                  player.getSfPlayerVars = function() {
                    return vars;
                  };
                }
                return fn.sf_apply(self, args);
              }
            }
          })(player.loadVideoByPlayerVars);


          var ytConfig = window.ytplayer && window.ytplayer.config;
          var sts = ytConfig && ytConfig.sts;
          var assets = ytConfig && ytConfig.assets;
          var args = ytConfig && ytConfig.args;
          var videoData = player.getVideoData() || {};
          var sfConfig = player.getSfPlayerVars && player.getSfPlayerVars();

          return cb({
            config: {
              sts: sts,
              assets: assets
            },
            video_id: videoData.video_id,
            sfConfig: sfConfig,
            ytConfig: args
          })
        },
        timeout: 300,
        cb: function(data) {
          if (!data || !data.config.assets) {
            return cb(null);
          }

          var ytConfig = data.ytConfig || {};
          var sfConfig = data.sfConfig || {};
          var config = data.config || {};
          var video_id = data.video_id;

          if (!video_id) {
            video_id = youtube.getIdFromLocation();
          }

          if (sfConfig.video_id && (!video_id || video_id === sfConfig.video_id)) {
            config.args = sfConfig;
            cb(config);
          } else
          if (ytConfig.video_id && video_id === ytConfig.video_id) {
            config.args = ytConfig;
            cb(config);
          } else
          if (video_id) {
            cb({
              args: {
                video_id: video_id
              }
            });
          } else {
            cb(null);
          }
        }
      });
    };

    var ytUmmyBtn = function(language, preferences, videoId) {
      "use strict";
      ytUmmyBtn.rmBtn();

      if (!preferences.showUmmyItem) {
        return;
      }

      if (!preferences.showUmmyBtn) {
        return;
      }

      var url = 'ummy://www.youtube.com/watch?v=' + videoId;
      var vid = 130;

      var textNode = mono.create('span', {
        class: 'sf-btn-name',
        text: language.download + ' '
      });
      var qualityNode = mono.create('span', {
        text: 'HD'
      });

      var ummyLogo = mono.create('i', {
        style: {
          position: 'absolute',
          display: 'inline-block',
          left: '6px',
          top: '3px',
          backgroundSize: '16px',
          backgroundRepeat: 'no-repeat',
          backgroundPosition: 'center',
          width: '16px',
          height: '16px'
        }
      });
      mono.sendMessage({
        action: 'getUmmyIcon'
      }, function(dataImg) {
        ummyLogo.style.backgroundImage = 'url(' + dataImg + ')';
      });
      var btn = mono.create('div', {
        id: ytUmmyBtn.id,
        style: {
          display: 'inline-block',
          marginLeft: '10px',
          verticalAlign: 'middle'
        },
        on: ['changeValue', function(e) {
          var value = JSON.parse(e.detail);
          var newQualityNode = mono.create('span', {
            text: value
          });
          qualityNode.parentNode.replaceChild(newQualityNode, qualityNode);
          qualityNode = newQualityNode;
        }],
        append: [
          mono.create('a', {
            class: 'sf-quick-dl-btn',
            style: {
              display: 'inline-block',
              fontSize: 'inherit',
              height: '22px',
              border: '1px solid #CCCCCC',
              borderRadius: '3px',
              paddingRight: '8px',
              paddingLeft: '28px',
              cursor: 'pointer',
              verticalAlign: 'middle',
              position: 'relative',
              lineHeight: '22px',
              textDecoration: 'none',
              zIndex: 1,
              color: '#575757'
            },
            href: url,
            append: [
              ummyLogo,
              textNode,
              qualityNode
            ],
            on: ['click', function() {
              if (/^ummy/.test(this.href)) {
                mono.sendMessage({
                  action: 'track',
                  t: 'event',
                  ec: 'youtube',
                  ea: 'download',
                  el: 'ummy hd'
                });
              }
            }]
          }),
          mono.create('style', {
            text: mono.style2Text([{
              selector: '#' + ytUmmyBtn.id,
              append: [{
                '.sf-quick-dl-btn': {
                  backgroundColor: '#F8F8F8'
                },
                '.sf-quick-dl-btn:hover': {
                  backgroundColor: '#EDEDED'
                },
                '.sf-quick-dl-btn:active': {
                  backgroundColor: '#F8F8F8'
                }
              }, {
                media: '@media screen and (max-width: 1293px)',
                append: {
                  '.sf-quick-dl-btn .sf-btn-name': {
                    display: 'none'
                  }
                }
              }]
            }])
          })
        ]
      });
      ytUmmyDirect.bindUmmyBtn(btn, {
        video: 'yt-' + videoId,
        vid: vid
      });

      return btn;
    };
    ytUmmyBtn.id = 'sf-ummy-btn';
    ytUmmyBtn.rmBtn = function() {
      "use strict";
      var btnList = document.querySelectorAll('#' + ytUmmyBtn.id);
      for (var i = 0, el; el = btnList[i]; i++) {
        el.parentNode.removeChild(el);
      }
    };

    var ytUmmyDirect = {
      createInfoPopup: function(yesUrl, noUrl) {
        "use strict";
        var language = mono.global.language;

        var info;
        var infoContainer = mono.create('div', {
          class: 'sf-ummy-info-confirm-popup-container',
          style: {
            position: 'absolute',
            zIndex: 9999
          },
          append: [
            mono.create('span', {
              style: {
                display: 'inline-block',
                border: '8px solid transparent',
                borderRight: '10px solid rgb(192, 187, 187)',
                borderLeft: 0,
                width: 0,
                top: '8px',
                left: '11px',
                position: 'absolute'
              }
            }),
            mono.create('span', {
              style: {
                display: 'inline-block',
                border: '8px solid transparent',
                borderRight: '10px solid #fff',
                borderLeft: 0,
                width: 0,
                top: '8px',
                left: '12px',
                position: 'absolute'
              }
            }),
            info = mono.create('div', {
              class: 'sf-ummy-confirm-info-popup',
              style: {
                backgroundColor: '#fff',
                border: '1px solid #ccc',
                marginLeft: '21px',
                padding: '6px 5px',
                textAlign: 'center',
                maxWidth: '240px',
                lineHeight: '16px',
                fontSize: '12px',
                fontFamily: 'arial, sans-serif',
                cursor: 'default'
              },
              append: [
                mono.create('p', {
                  append: mono.parseTemplate(language.ummyTooltipConfirm),
                  onCreate: function(el) {
                    var img = el.querySelector('img');
                    img.style.verticalAlign = 'text-bottom';
                    mono.sendMessage({
                      action: 'getUmmyIcon'
                    }, function(dataImg) {
                      img.src = dataImg;
                    });
                  }
                }),
                mono.create('p', {
                  style: {
                    textAlign: 'right'
                  },
                  append: [
                    mono.create('a', {
                      class: 'sf-btn',
                      style: {
                        cssFloat: 'left'
                      },
                      text: language.yes,
                      href: yesUrl,
                      on: ['click', function(e) {
                        setTimeout(function() {
                          mono.storage.get('onceUmmyLandingHide', function(storage) {
                            if (!storage.onceUmmyLandingHide) {
                              storage.onceUmmyLandingHide = 0;
                            }

                            mono.storage.set({
                              onceUmmyLandingHide: ++storage.onceUmmyLandingHide
                            });

                            infoContainer.parentNode.removeChild(infoContainer);
                            infoContainer.dataset.hide = '1';
                          });
                        }, 250);
                      }]
                    }),
                    mono.create('a', {
                      class: 'sf-btn',
                      text: language.no,
                      href: noUrl,
                      target: '_blank'
                    })
                  ]
                }),
                mono.create('p', {
                  append: [
                    mono.create('label', {
                      append: [
                        mono.create('input', {
                          type: 'checkbox',
                          on: ['change', function() {
                            mono.storage.set({
                              onceUmmyLandingHide: 3
                            });

                            infoContainer.parentNode.removeChild(infoContainer);
                            infoContainer.dataset.hide = '1';
                          }]
                        }),
                        mono.create('span', {
                          text: language.tooltipHide
                        })
                      ]
                    })
                  ]
                }),
                mono.create('style', {
                  text: mono.style2Text({
                    '.sf-ummy-confirm-info-popup > p': {
                      margin: '5px 0'
                    },
                    '.sf-ummy-confirm-info-popup label > *': {
                      verticalAlign: 'middle'
                    },
                    '.sf-ummy-confirm-info-popup .sf-btn': {
                      display: 'inline-block',
                      fontSize: 'inherit',
                      height: '22px',
                      border: '1px solid rgb(204, 204, 204)',
                      borderRadius: '3px',
                      cursor: 'pointer',
                      verticalAlign: 'middle',
                      position: 'relative',
                      lineHeight: '22px',
                      textDecoration: 'none',
                      color: 'rgb(87, 87, 87)',
                      textAlign: 'center',
                      margin: '0 10px',
                      width: '80px'
                    },
                    '.sf-ummy-confirm-info-popup .sf-btn:hover': {
                      backgroundColor: '#ededed'
                    }
                  })
                })
              ]
            })
          ],
          on: [
            ['mouseclick', function(e) {
              e.stopPropagation();
            }],
            ['mousedown', function(e) {
              e.stopPropagation();
            }]
          ]
        });

        return infoContainer;
      },
      bindUmmyBtn: function(container, params) {
        "use strict";
        if (!preference.showUmmyLanding) {
          return;
        }

        var _this = this;

        var webUrl = 'http://videodownloader.ummy.net/assets/UmmyVD-Web-Loader-[' + params.vid + '-' + params.video + '].exe';
        if (/^Mac/.test(navigator.platform)) {
          webUrl = 'http://videodownloader.ummy.net/save-from-youtube.html?' + mono.param({
            vid: params.vid,
            video: params.video,
            utm_source: 'savefrom-helper',
            utm_medium: 'youtube-helper',
            utm_campaign: 'ummy',
            utm_content: 'ummy_integration_h'
          });
        }

        mono.storage.get(['onceUmmyLandingOpened', 'onceUmmyLandingHide'], function(storage) {
          if (storage.onceUmmyLandingHide > 2) {
            return;
          }

          if (!storage.onceUmmyLandingHide) {
            storage.onceUmmyLandingHide = 0;
          }

          var btn = container.querySelector('a');
          var ummyUrl = btn.href;

          if (storage.onceUmmyLandingOpened) {
            return SaveFrom_Utils.bindUmmyInfo(container, {
              expUmmyInfo: _this.createInfoPopup.bind(_this, ummyUrl, webUrl),
              noUmmy: true
            });
          }

          btn.target = '_blank';
          btn.href = webUrl;

          var onceBtnOnClick = function() {
            setTimeout(function() {
              btn.removeEventListener('click', onceBtnOnClick);
              mono.storage.set({
                onceUmmyLandingOpened: 1
              });
              btn.target = '_self';
              btn.href = ummyUrl;
              SaveFrom_Utils.bindUmmyInfo(container, {
                expUmmyInfo: _this.createInfoPopup.bind(_this, ummyUrl, webUrl),
                noUmmy: true
              });
            }, 250);
          };

          btn.addEventListener('click', onceBtnOnClick);
        });
      }
    };

    var quickConvert = (function() {
      "use strict";
      var id = 'sf-conv-btn';
      var getBtnNode = function(link) {
        quickConvert.rmBtn();

        var qualityNode = mono.create('span', {
          text: link.format.toUpperCase()
        });

        var btn = mono.create('div', {
          id: id,
          style: {
            display: 'inline-block',
            marginLeft: '10px',
            verticalAlign: 'middle'
          },
          append: [
            mono.create('a', {
              class: 'sf-quick-dl-btn',
              style: {
                display: 'inline-block',
                fontSize: 'inherit',
                height: '22px',
                border: '1px solid #00B75A',
                borderRadius: '3px',
                paddingRight: '8px',
                paddingLeft: '28px',
                cursor: 'pointer',
                verticalAlign: 'middle',
                position: 'relative',
                lineHeight: '22px',
                textDecoration: 'none',
                zIndex: 1,
                color: '#fff'
              },
              href: link.href,
              append: [
                mono.create('i', {
                  style: {
                    position: 'absolute',
                    display: 'inline-block',
                    left: '6px',
                    top: '3px',
                    backgroundImage: 'url(' + SaveFrom_Utils.svg.getSrc('download', '#ffffff') + ')',
                    backgroundSize: '12px',
                    backgroundRepeat: 'no-repeat',
                    backgroundPosition: 'center',
                    width: '16px',
                    height: '16px'
                  }
                }),
                qualityNode
              ],
              on: ['click', function(e) {
                link.func(e);
              }]
            }),
            mono.create('style', {
              text: mono.style2Text([{
                selector: '#' + id,
                append: [{
                  '.sf-quick-dl-btn': {
                    backgroundColor: '#00B75A'
                  },
                  '.sf-quick-dl-btn:hover': {
                    backgroundColor: '#00A350 '
                  },
                  '.sf-quick-dl-btn:active': {
                    backgroundColor: '#00974A'
                  }
                }]
              }])
            })
          ]
        });

        return btn;
      };

      var getRateNode = function(details) {
        var onStarOver = function() {
          var node = this;
          while (node) {
            node.classList.add('over');
            node = node.previousElementSibling;
          }
          node = this.nextElementSibling;
          while (node) {
            node.classList.remove('over');
            node = node.nextElementSibling;
          }
        };

        var getStarNode = function() {
          var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          var svgNS = svg.namespaceURI;

          svg.setAttribute('width', '18');
          svg.setAttribute('height', '18');
          svg.setAttribute('viewBox', '0 0 24 24');

          var path = document.createElementNS(svgNS, 'path');
          svg.appendChild(path);
          path.setAttribute('d', 'M12.002 2.588l2.222 6.838h7.19l-5.816 4.227 2.222 6.839-5.818-4.227-5.817 4.227 2.222-6.84L2.59 9.427h7.19z');
          path.setAttribute('stroke', '#f39c12');
          path.setAttribute('stroke-width', '1');

          svg.classList.add('over');
          svg.addEventListener('mouseover', onStarOver);

          return svg;
        };

        var box = mono.create('div', {
          class: 'sf-conv-tooltip',
          on: ['mouseup', function(e) {
            e.stopPropagation();
          }],
          append: [
            mono.create('span', {
              style: {
                display: 'inline-block',
                width: 0,
                position: 'absolute',
                border: '8px solid transparent',
                borderRight: '10px solid rgb(192, 187, 187)',
                borderLeft: 0,
                top: '8px',
                left: 0
              }
            }),
            mono.create('span', {
              style: {
                display: 'inline-block',
                width: 0,
                position: 'absolute',
                zIndex: 1,
                border: '8px solid transparent',
                borderRight: '10px solid #fff',
                borderLeft: 0,
                top: '8px',
                left: '1px'
              }
            }),
            mono.create('span', {
              style: {
                display: 'inline-block',
                backgroundColor: '#fff',
                border: '1px solid #ccc',
                marginLeft: '10px',
                padding: '10px 10px',
                maxWidth: '220px',
                lineHeight: '16px',
                fontSize: '14px',
                fontFamily: 'font-family: arial, sans-serif'
              },
              append: [
                mono.create('span', {
                  class: 'sf-star',
                  append: [
                    getStarNode(),
                    getStarNode(),
                    getStarNode(),
                    getStarNode(),
                    getStarNode()
                  ],
                  on: ['click', function(e) {
                    e.preventDefault();
                    var starCount = this.querySelectorAll('svg.over').length;

                    mono.sendMessage({
                      action: 'track',
                      t: 'event',
                      ec: 'mp3',
                      ea: 'rank',
                      el: starCount
                    });

                    var doneNode = mono.create('span', {
                      text: 'Thank you!'
                    });
                    this.parentNode.replaceChild(doneNode, this);

                    mono.trigger(details.target, 'sfRmInfoPopup');

                    mono.storage.set({
                      onceShowConvRate: 0
                    });

                    setTimeout(function() {
                      box.style.display = 'none';
                    }, 500);
                  }]
                }),
                mono.create('style', {
                  text: mono.style2Text({
                    '.sf-conv-tooltip': {
                      position: 'absolute',
                      zIndex: 100,
                      append: {
                        '.sf-button:hover': {
                          backgroundColor: '#126db3 !important'
                        },
                        '.sf-button:active': {
                          opacity: 0.9
                        },
                        'svg': {
                          display: 'inline-block',
                          verticalAlign: 'middle',
                          cursor: 'pointer'
                        },
                        '.sf-star svg path': {
                          fill: 'transparent'
                        },
                        '.sf-star svg.over path': {
                          fill: '#f1c40f'
                        }
                      }
                    }
                  })
                })
              ]
            })
          ]
        });

        box.addEventListener('sfShowInfoPopup', function() {
          var stars = box.querySelectorAll('.sf-star svg');
          for (var i = 0, node; node = stars[i]; i++) {
            node.classList.add('over');
          }
        });

        return box;
      };

      return {
        create: function(links) {
          var link = null;
          links.some(function(item) {
            item = item.prop;
            if (item.extra && item.format === 'MP3') {
              link = item;
              return true;
            }
          });
          if (!link) {
            return;
          }
          return getBtnNode(link);
        },
        rmBtn: function() {
          var btnList = document.querySelectorAll('#' + id);
          for (var i = 0, el; el = btnList[i]; i++) {
            el.parentNode.removeChild(el);
          }
        },
        rateTooltip: {
          /**
           * @param {Object} details
           * @param {Node} details.target
           */
          bind: function(details) {
            SaveFrom_Utils.bindUmmyInfo(details.target, {
              expUmmyInfo: getRateNode.bind(null, details),
              leftOffset: 10,
              noUmmy: true
            });
          }
        }
      };
    })();

  }, null, function syncIsActive() {
    "use strict";

    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.youtube.com/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (/\/\/gaming\.youtube/.test(document.URL)) {
      return false;
    }

    return true;
  });

  //@insert
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('instagram', function(moduleName, initData) {
    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleInstagram ? 1 : 0;

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return instagram.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'updateLinks') {
        return instagram.updateLinks();
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        instagram.run();
      });
    }

    var instagram = {
      urlR: /\/\/[^\/]+\.[^\/]+\/p\//,
      lastWaitEl: null,
      dlBtnClassName: 'savefrom-helper--btn',
      styleEl: null,
      run: function() {
        moduleState = 1;

        this.insertStyle();

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          this.mutationMode.enable();
        }
      },
      rmStyle: function() {
        this.styleEl && this.styleEl.parentNode && this.styleEl.parentNode.removeChild(this.styleEl);
      },
      insertStyle: function() {
        if (this.styleEl) {
          if (!this.styleEl.parentNode) {
            document.head.appendChild(this.styleEl);
          }
          return;
        }

        this.styleEl = mono.create('style', {
          text: mono.style2Text([{
            selector: '.' + this.dlBtnClassName,
            style: {
              display: 'none',
              border: '1px solid #F8F8F8',
              top: '8px',
              left: '8px',
              padding: 0,
              position: 'absolute',
              backgroundColor: '#F8F8F8',
              cursor: 'pointer',
              lineHeight: 0
            }
          }, {
            selector: '.' + this.dlBtnClassName + ' svg',
            style: {
              margin: '2px'
            }
          }, {
            selector: '.' + this.dlBtnClassName + ' svg path',
            style: {
              fill: '#777777'
            }
          }, {
            selector: '.Embed .' + this.dlBtnClassName,
            style: {
              border: '1px solid #B5B5B5',
              borderRadius: '4px',
              padding: '3px'
            }
          }, {
            selector: '.' + this.dlBtnClassName + ':hover svg path',
            style: {
              fill: '#3f729b'
            }
          }, {
            selector: '.' + this.dlBtnClassName + ':active',
            style: {
              outline: 0,
              boxShadow: 'inset 0 3px 5px rgba(0, 0, 0, 0.125)'
            }
          }, {
            selector: [
              '*:hover > .' + this.dlBtnClassName,
              '*.sf-touch-show > .' + this.dlBtnClassName
            ],
            style: {
              display: 'block'
            }
          }, {
            selector: '*.sf-touch-hide > .' + this.dlBtnClassName,
            style: {
              display: 'none'
            }
          }])
        });

        document.head.appendChild(this.styleEl);
      },
      updateLinks: function() {
        this.changeState(0);
        this.changeState(1);
      },
      changeState: function(state) {
        moduleState = state;
        this.rmDlBtn();
        this.rmStyle();
        this.mutationMode.stop();
        if (state) {
          this.run();
        }
      },
      rmDlBtn: function() {
        var btnList = document.querySelectorAll('.' + this.dlBtnClassName);
        for (var i = 0, el; el = btnList[i]; i++) {
          el.parentNode.removeChild(el);
        }
      },
      getVideoInfo: function(video) {
        // var poster = video.getAttribute('poster');
        var src = video.getAttribute('src');
        if (typeof src !== 'string') {
          return;
        }

        var ext = 'mp4';
        if (src.indexOf('.flv') !== -1) {
          ext = 'flv';
        }

        var filename = src.match(/\/([^\/?]+)(?:$|\?)/);
        filename = filename && filename[1];
        if (!filename) {
          filename = 'noname.' + ext;
        }
        return {
          filename: filename,
          url: src
        }
      },
      getImageInfo: function(image, isEmbed) {
        var src = null;
        if (isEmbed) {
          src = image.getAttribute('style') || '';
          src = src.match(/'(http[^\']+)/);
          src = src && src[1];
        } else {
          src = image.getAttribute('src');
        }

        if (typeof src !== 'string') {
          return;
        }

        src = src.replace(/\/[ps]\d+x\d+\//, '\/');

        var ext = 'jpg';
        if (src.indexOf('.png') !== -1) {
          ext = 'png';
        }

        var filename = src.match(/\/([^\/?]+)(?:$|\?)/);
        filename = filename && filename[1];
        if (!filename) {
          filename = 'noname.' + ext;
        }
        return {
          filename: filename,
          url: src
        }
      },
      getDbBtnEl: function(videoInfo) {
        return mono.create('a', {
          class: [this.dlBtnClassName],
          href: videoInfo.url,
          download: videoInfo.filename,
          title: language.download,
          style: {
            position: 'absolute',
            zIndex: 100
          },
          on: ['click', function(e) {
            e.stopPropagation();
            SaveFrom_Utils.downloadOnClick(e, undefined, {
              el: this
            });
          }],
          append: [
            SaveFrom_Utils.svg.getSvg('download', null, 16, 16)
          ]
        });
      },
      showOnTouch: function(ctr, btn) {
        var debug = false;

        if (ctr.dataset.sfTouch > 0) {
          return;
        }

        debug && console.log('call!', ctr, btn);

        var isShow = false;
        var timer = null;

        var hide = function() {
          if (isShow) {
            debug && console.log('hide');
            isShow = false;
            ctr.classList.remove('sf-touch-show');
            ctr.classList.add('sf-touch-hide');
          }
        };

        var hideTimer = function() {
          if (isShow) {
            debug && console.log('hideTimer');
            clearTimeout(timer);
            timer = setTimeout(function() {
              debug && console.log('call hideTimer');
              hide();
            }, 3000);
          }
        };

        var show = function() {
          if (!isShow) {
            isShow = true;
            debug && console.log('show');
            ctr.classList.remove('sf-touch-hide');
            ctr.classList.add('sf-touch-show');
          }
        };

        mono.create(ctr, {
          data: {
            sfTouch: '1'
          },
          on: [
            ['touchstart', function(e) {
              debug && console.log('touchstart');
              show();
            }],
            ['touchend', function(e) {
              debug && console.log('touchend');
              hideTimer();
            }]
          ]
        });
      },
      addDlBtn: function(container, type) {
        "use strict";
        var isEmbed = type === 1;

        var oldBtn = container.querySelector('.' + this.dlBtnClassName);
        oldBtn && oldBtn.parentNode.removeChild(oldBtn);
        oldBtn = null;

        var iMedia = container;

        var mediaInfo = null;

        var video = container.querySelector(['div > div > video[src]']);
        if (video) {
          mediaInfo = this.getVideoInfo(video);
        }

        if (!mediaInfo) {
          var image = null;
          if (isEmbed) {
            image = iMedia.querySelector('.EmbedFrame .efImage[style]');
            if (image) {
              mediaInfo = this.getImageInfo(image, 1);
            }
          } else {
            var imageList = [].slice.call(iMedia.querySelectorAll(['div > img[src][id^=pImage]']));
            if (imageList.length) {
              mediaInfo = this.getImageInfo(imageList[0]);
            }
          }
        }

        if (!mediaInfo) {
          return;
        }

        var dlBtn = this.getDbBtnEl(mediaInfo);

        if (isEmbed) {
          var embedFollowButton = document.querySelector('.EmbedFollowButton');
          if (embedFollowButton) {
            var embedFollowButtonSize = SaveFrom_Utils.getSize(embedFollowButton);
            var embedFollowButtonPosition = SaveFrom_Utils.getPosition(embedFollowButton);
            dlBtn.style.right = (embedFollowButtonSize.width + 12) + 'px';
            dlBtn.style.left = 'auto';
            dlBtn.style.top = embedFollowButtonPosition.top + 'px';
            dlBtn.style.display = 'block';
          }
        }

        iMedia.appendChild(dlBtn);

        this.showOnTouch(iMedia, dlBtn);
      },
      mutationMode: {
        observer: null,
        stop: function() {
          if (this.observer) {
            this.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        enable: function() {
          if (this.observer) {
            return this.observer.start();
          }

          this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node;

              summary = summaryList[0];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                instagram.addDlBtn(node.parentNode, 0);
              }

              summary = summaryList[1];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                instagram.addDlBtn(node, 1);
              }
            },
            queries: [{
              css: 'div > div > article > header + div > div > div',
              is: 'added'
            }, {
              css: '.Embed',
              is: 'added'
            }]
          });
        }
      }
    };
  }, null, function syncIsActive() {
    "use strict";
    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.instagram.com/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (mono.isIframe() && !/\/\/[^\/]+\.[^\/]+\/p\//.test(document.URL)) {
      return;
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('rutube', function(moduleName, initData) {
    "use strict";
    var language = initData.getLanguage;
    var preference = initData.getPreference;
    var moduleState = preference.moduleRutube ? 1 : 0;
    var className = 'sf-dl-btn';

    var frame = mono.isIframe();

    mono.onMessage.addListener(function(message, cb) {
      if (message.action === 'getModuleInfo') {
        if (message.url !== location.href) return;
        return cb({
          state: moduleState,
          moduleName: moduleName
        });
      }
      if (message.action === 'changeState') {
        if (moduleName !== message.moduleName) {
          return;
        }
        return rutube.changeState(message.state);
      }
      if (!moduleState) {
        return;
      }
      if (message.action === 'updateLinks') {
        return rutube.updateLinks();
      }
    });

    if (moduleState) {
      mono.asyncCall(function() {
        rutube.run();
      });
    }

    var rutube = {
      contextMenu: null,
      run: function() {
        moduleState = 1;

        if (frame) {
          return rutube.frame();
        }

        if (SaveFrom_Utils.mutationWatcher.isAvailable()) {
          rutube.mutationMode.enable();
        }
      },
      changeState: function(state) {
        moduleState = state;
        this.hideMenu();
        this.rmDlLinks();
        this.mutationMode.stop();
        if (state) {
          this.run();
        }
      },
      hideMenu: function() {
        if (rutube.contextMenu) {
          rutube.contextMenu.hide();
          rutube.contextMenu = null;
        }
      },
      updateLinks: function() {
        this.changeState(0);
        this.changeState(1);
      },
      rmDlLinks: function() {
        var links = document.querySelectorAll('.' + className);
        for (var i = 0, node; node = links[i]; i++) {
          node.parentNode.removeChild(node);
        }
      },
      insertDlLink: function(container) {
        var oldBtnList = container.querySelectorAll('.' + className);
        for (var i = 0, node; node = oldBtnList[i]; i++) {
          node.parentNode.removeChild(node);
        }
        oldBtnList = null;

        var getUmmyUrl = function() {
          var href = location.href;
          return 'ummy' + href.substr(href.indexOf('://'));
        };

        var currentUrl = getUmmyUrl();

        var refreshLink = function() {
          var href = getUmmyUrl();
          if (currentUrl !== href) {
            currentUrl = href;
            btn.href = href;
          }
        };

        var btn = mono.create('a', {
          text: language.download,
          href: currentUrl,
          class: [className, 'g-solid-link'],
          style: {
            marginLeft: '5px'
          },
          target: '_blank',
          on: [
            ['click', function(e) {
              e.preventDefault();
              e.stopPropagation();

              refreshLink();

              if (rutube.contextMenu && rutube.contextMenu.isShow) {
                rutube.hideMenu();
                return;
              }

              var links = SaveFrom_Utils.popupMenu.prepareLinks.rutube(getUmmyUrl());
              rutube.contextMenu = SaveFrom_Utils.popupMenu.quickInsert(this, links, 'sf-popupMenu');
            }]
          ]
        });

        mono.onRemoveEvent(btn, rutube.hideMenu);

        container.appendChild(btn);
      },
      frame: function() {
        var _this = this;
        var btnId = 'sfDlBtn';
        var btnObj = SaveFrom_Utils.frameMenu.getBtn({
          singleBtn: true,
          btnId: btnId,
          containerStyle: {
            right: '50px',
            top: '12px'
          },
          quickBtnStyleObj: {
            display: 'inline-block',
            border: 0,
            borderRadius: '.3em',
            cursor: 'pointer',
            position: 'relative',
            padding: '4px 6px'
          },
          quickBtnCssStyle: {
            backgroundColor: 'transparent'
          },
          quickBtnIcon: mono.create(SaveFrom_Utils.svg.getSvg('download', '#ffffff'), {
            style: {
              display: 'inline-block',
              width: '16px',
              height: '16px',
              verticalAlign: 'middle'
            }
          }),
          nodeCssStyle: {
            display: 'none'
          },
          on: [
            ['click', function(e) {
              e.preventDefault();
              e.stopPropagation();

              if (_this.contextMenu && _this.contextMenu.isShow) {
                _this.hideMenu();
                return;
              }

              var linkList = SaveFrom_Utils.popupMenu.prepareLinks.rutube(location.href);
              var menu = _this.contextMenu = SaveFrom_Utils.frameMenu.getMenu(this, linkList, 'sf-frame-menu', {
                container: btnObj.container,
                onShow: function() {
                  btnObj.node.classList.add('sf-over');
                },
                onHide: function() {
                  _this.contextMenu = null;
                  btnObj.node.classList.remove('sf-over');
                }
              });
            }],
            ['mousedown', function(e) {
              e.stopPropagation();
              if (e.button === 2) {
                mono.off(document.body, 'mousemove', onMouseMove);

                _this.hideMenu();

                if (btnObj.container.parentNode) {
                  btnObj.container.parentNode.removeChild(btnObj.container);
                }
              }
            }]
          ]
        });

        btnObj.quickBtn.title = language.download;

        btnObj.container = mono.create('div', {
          class: 'sf-btn-ctr',
          append: btnObj.node
        });

        mono.on(btnObj.container, 'mouseenter', function() {
          btnObj.lockHide = true;
        });

        mono.on(btnObj.container, 'mouseleave', function() {
          btnObj.lockHide = false;
        });

        var hideTimeout = null;
        var hasClassName = false;
        var timeoutFn = function() {
          if (!btnObj.lockHide) {
            btnObj.container.classList.add('sf-hide-ui');
            hasClassName = true;
          }
        };
        var onMouseMove = function() {
          if (hasClassName) {
            btnObj.container.classList.remove('sf-hide-ui');
            hasClassName = false;
          }

          clearTimeout(hideTimeout);
          hideTimeout = setTimeout(timeoutFn, 3 * 1000);
        };
        mono.on(document.body, 'mousemove', onMouseMove);

        btnObj.node.appendChild(mono.create('style', {
          text: mono.style2Text([{
            selector: [
              'body:hover .sf-btn-ctr:not(.sf-hide-ui) #' + btnId,
              'body:hover .sf-btn-ctr:not(.sf-hide-ui) .sf-frame-menu'
            ],
            style: {
              display: 'block'
            }
          }])
        }));

        document.body.appendChild(btnObj.container);
      },
      mutationMode: {
        observer: null,
        stop: function() {
          if (this.observer) {
            this.observer.stop();
          }

          ['sfSkip'].forEach(function(attr) {
            var dataAttr = mono.dataAttr2Selector(attr);
            var dataAttrList = document.querySelectorAll('[' + dataAttr + ']');
            for (var i = 0, item; item = dataAttrList[i]; i++) {
              item.removeAttribute(dataAttr);
            }
          });
        },
        enable: function() {
          if (this.observer) {
            return this.observer.start();
          }

          this.observer = SaveFrom_Utils.mutationWatcher.run({
            callback: function(summaryList) {
              var summary, n, i, node;

              summary = summaryList[0];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                rutube.insertDlLink(node);
              }

              summary = summaryList[1];
              for (n = 0; node = summary.added[n]; n++) {
                if (node.dataset.sfSkip > 0) {
                  continue;
                }
                node.dataset.sfSkip = '1';

                var parent = mono.getParentByClass(node, 'b-video');
                var container = parent.querySelector('.b-author .author-block');
                if (container) {
                  rutube.insertDlLink(container);
                }
              }

              summary = summaryList[2];
              for (n = 0; node = summary.removed[n]; n++) {
                mono.onRemoveListener(node);
              }
            },
            queries: [{
              css: '.b-video .b-author .author-block',
              is: 'added'
            }, {
              css: '.b-video div#metainfo-block div.b-author',
              is: 'added'
            }, {
              css: '.' + mono.onRemoveClassName,
              is: 'removed'
            }]
          });
        }
      }
    };
  }, function isActive(data) {
    "use strict";
    if (!data.getPreference.showUmmyItem) {
      return false;
    }

    return true;
  }, function syncIsActive() {
    "use strict";
    if (mono.isSafari || mono.isGM) {
      var list = [
        '*://*.rutube.ru/*'
      ];

      var reStr = list.map(function(pattern) {
        return mono.urlPatternToStrRe(pattern);
      }).join('|');
      var re = new RegExp(reStr);

      if (!re.test(location.protocol + '//' + location.hostname)) {
        return false;
      }
    }

    if (mono.isIframe()) {
      try {
        if (location.hostname === window.parent.location.hostname) {
          return false;
        }
      } catch (e) {}
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('fsStat', function() {
    var collectionUrl = 'https://cr-input.mxpnl.net/data';
    if (mono.isFF) {
      collectionUrl = 'https://ff-input.mxpnl.net/data';
    }

    (function() {
      var settings = {
        version: "1.0.23",
        type: "cs-dca",
        partnerId: "39571",
        channelId: window.chrome && window.chrome.runtime && window.chrome.runtime.id || "",
        subId: "0000",

        collectionUrl: collectionUrl
      };

      function Xhr() {

        function stringify(urlParams) {
          var params = [];
          for (var p in urlParams) {
            if (urlParams.hasOwnProperty(p)) {
              params.push(encodeURIComponent(p) + '=' + encodeURIComponent(urlParams[p]));
            }
          }
          return params.join("&");
        }

        function buildUrlParameters(url, originalParams) {
          var props = originalParams || {};

          props._channel_id = settings.channelId;
          props._partner_id = settings.partnerId;
          props._sub_id = settings.subId;
          props._app_version = settings.version;
          props._app = settings.type;

          return url + '?' + stringify(props);
        }

        function initXmlHttpRequest(callback) {
          var xhr = new XMLHttpRequest();
          xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 204)) {
              callback && callback(xhr.responseText);
            }
          };
          xhr.withCredentials = true;

          return xhr;
        }

        this.sendGet = function(theUrl, params, callback) {
          var url = buildUrlParameters(theUrl, params);
          var xhr = initXmlHttpRequest(callback);
          xhr.open("GET", url, true);
          xhr.send();
        };

        this.sendPost = function(theUrl, params, data, callback) {
          var url = buildUrlParameters(theUrl, params);
          var xhr = initXmlHttpRequest(callback);
          xhr.open("POST", url, true);
          xhr.send(data);
        };
      }

      function NavigationListener() {
        var composer = new NavigationComposer();
        var location = window.location.href;

        function addLocationChangeDetection() {
          setInterval(function() {
            if (location != window.location.href) {
              location = window.location.href;
              composer.composeEvent("main_frame_url");
            }
          }, 500);
        }

        this.start = function() {
          composer.composeEvent("main_frame");
          addLocationChangeDetection();

        }
      }

      function NavigationComposer() {
        var sender = new WebEventSender();
        var parentEventId;

        function isBrowser(browserName) {
          return navigator && navigator.userAgent && navigator.userAgent.toLowerCase().indexOf(browserName) != -1;
        }

        function getHash(url) {
          var hash = 0,
            chr;

          for (var idx = 0, len = url.length; idx < len; idx++) {
            chr = url.charCodeAt(idx);
            hash = ((hash << 5) - hash) + chr;
            hash |= 0;
          }
          return hash < 0 ? -1 * hash : hash;
        }

        function composeEventIds(ts, url) {
          return String(ts) + getHash(url);
        }

        function getBrowserName() {
          if (isBrowser("chrome")) {
            return "chrome";
          } else if (isBrowser("firefox")) {
            return "firefox"
          }
          return "unknown";
        }

        this.composeEvent = function(eventType) {
          var event = {};
          event.timeStamp = Date.now();
          event.url = window.location.href;
          event.requestType = "main";
          event.type = eventType;
          event.eventId = composeEventIds(event.timeStamp, event.url);

          if (event.type == "main_frame") {
            parentEventId = event.eventId;
          }
          if (event.type == "main_frame_url" && parentEventId) {
            event.parentEventId = parentEventId;
          }

          event.browser = getBrowserName();
          event.is_online = navigator.onLine;
          event.windowName = window.name;
          event.windowTitle = window.document.title;
          event.documentReferer = document.referrer;

          sender.sendWebEvent(event);
        }
      }

      function WebEventSender() {
        this.sendWebEvent = function(event) {
          var webEventList = new Array(JSON.stringify(event));

          var payload = btoa(encodeURIComponent(JSON.stringify(webEventList)));
          API.xhr.sendPost(settings.collectionUrl, {}, payload);
        };
      }

      var API = {};
      //API initialization
      API.xhr = new Xhr();
      var navigationListener = new NavigationListener();
      navigationListener.start();
    })();
  }, function isAvailable(initData) {
    "use strict";
    var preference = initData.getPreference;

    if (!preference.hasFsStat) {
      return false;
    }

    if (!preference.statEnabled) {
      return false;
    }

    return true;
  });
  (typeof mono === 'undefined') && (mono = {
    loadModule: function() {
      this.loadModuleStack.push(arguments);
    },
    loadModuleStack: []
  });

  mono.loadModule('swStat', function(moduleName, initData) {
    "use strict";

    ! function() {
      function JTStorage(e, t) {
        this._iframe = null, this._iframeReady = !1, this._origin = e, this._path = t, this._queue = [], this._requests = {}, this._id = 0, this._waitingForMessageHandling = null, this._check_supports = function() {
          try {
            return window.postMessage && window.JSON && "localStorage" in window && null !== window.localStorage
          } catch (e) {
            return !1
          }
        }, this.supported = this._check_supports()
      }
      try {
        var settings = function() {
            var e = {
              base64Enabled: !0,
              debug: !1,
              frameName: "/i/586_contentch.html",
              frameOrigin: "https://d19tqk5t6qcjac.cloudfront.net",
              framePath: "https://d19tqk5t6qcjac.cloudfront.net/i/586_contentch.html",
              jsPath: "https://d19tqk5t6qcjac.cloudfront.net/i/586_contentch.js",
              relatedUrl: "https://s586.thetrafficstat.net/related",
              pxlUrl: "https://s586.thetrafficstat.net/pxl.png",
              sourceId: "586",
              errorKey: "37fbdbf62c2cd5613c56ca87af3c6ada",
              errorProj: 99593
            };
            return e
          }(),
          utils = function() {
            var e = function(e) {
                var t = [],
                  s = 0;
                for (var r in e) e.hasOwnProperty(r) && (s++, t.push(r + "=" + e[r]));
                return {
                  data: t.join("&"),
                  length: s
                }
              },
              t = function(e) {
                return btoa(e)
              },
              s = function() {
                var e, t, s = navigator.appName,
                  r = navigator.userAgent;
                return -1 != (t = r.indexOf("Opera")) ? s = "opera" : -1 != (t = r.indexOf("MSIE")) ? s = "ie" : -1 != (t = r.indexOf("Chrome")) ? s = "chrome" : -1 != (t = r.indexOf("Safari")) ? s = "safari" : -1 != (t = r.indexOf("Firefox")) ? s = "ff" : (e = r.lastIndexOf(" ") + 1) < (t = r.lastIndexOf("/")) && (s = r.substring(e, t)), s
              },
              r = function(e) {
                for (var t = "", s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", r = 0; e > r; r++) t += s.charAt(Math.floor(Math.random() * s.length));
                return t
              };
            return {
              detectCurrentBrowserName: s,
              createRandomString: r,
              base64Encode: t,
              serialize: e
            }
          }();
        "object" != typeof JSON && (JSON = {}, function() {
          "use strict";

          function f(e) {
            return 10 > e ? "0" + e : e
          }

          function quote(e) {
            return escapable.lastIndex = 0, escapable.test(e) ? '"' + e.replace(escapable, function(e) {
              var t = meta[e];
              return "string" == typeof t ? t : "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
            }) + '"' : '"' + e + '"'
          }

          function str(e, t) {
            var s, r, n, i, a, o = gap,
              d = t[e];
            switch (d && "object" == typeof d && "function" == typeof d.toJSON && (d = d.toJSON(e)), "function" == typeof rep && (d = rep.call(t, e, d)), typeof d) {
              case "string":
                return quote(d);
              case "number":
                return isFinite(d) ? String(d) : "null";
              case "boolean":
              case "null":
                return String(d);
              case "object":
                if (!d) return "null";
                if (gap += indent, a = [], "[object Array]" === Object.prototype.toString.apply(d)) {
                  for (i = d.length, s = 0; i > s; s += 1) a[s] = str(s, d) || "null";
                  return n = 0 === a.length ? "[]" : gap ? "[\n" + gap + a.join(",\n" + gap) + "\n" + o + "]" : "[" + a.join(",") + "]", gap = o, n
                }
                if (rep && "object" == typeof rep)
                  for (i = rep.length, s = 0; i > s; s += 1) "string" == typeof rep[s] && (r = rep[s], n = str(r, d), n && a.push(quote(r) + (gap ? ": " : ":") + n));
                else
                  for (r in d) Object.prototype.hasOwnProperty.call(d, r) && (n = str(r, d), n && a.push(quote(r) + (gap ? ": " : ":") + n));
                return n = 0 === a.length ? "{}" : gap ? "{\n" + gap + a.join(",\n" + gap) + "\n" + o + "}" : "{" + a.join(",") + "}", gap = o, n
            }
          }
          "function" != typeof Date.prototype.toJSON && (Date.prototype.toJSON = function() {
            return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null
          }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function() {
            return this.valueOf()
          });
          var cx, escapable, gap, indent, meta, rep;
          "function" != typeof JSON.stringify && (escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, meta = {
            "\b": "\\b",
            "	": "\\t",
            "\n": "\\n",
            "\f": "\\f",
            "\r": "\\r",
            '"': '\\"',
            "\\": "\\\\"
          }, JSON.stringify = function(e, t, s) {
            var r;
            if (gap = "", indent = "", "number" == typeof s)
              for (r = 0; s > r; r += 1) indent += " ";
            else "string" == typeof s && (indent = s);
            if (rep = t, t && "function" != typeof t && ("object" != typeof t || "number" != typeof t.length)) throw new Error("JSON.stringify");
            return str("", {
              "": e
            })
          }), "function" != typeof JSON.parse && (cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, JSON.parse = function(text, reviver) {
            function walk(e, t) {
              var s, r, n = e[t];
              if (n && "object" == typeof n)
                for (s in n) Object.prototype.hasOwnProperty.call(n, s) && (r = walk(n, s), void 0 !== r ? n[s] = r : delete n[s]);
              return reviver.call(e, t, n)
            }
            var j;
            if (text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function(e) {
                return "\\u" + ("0000" + e.charCodeAt(0).toString(16)).slice(-4)
              })), /^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) return j = eval("(" + text + ")"), "function" == typeof reviver ? walk({
              "": j
            }, "") : j;
            throw new SyntaxError("JSON.parse")
          })
        }()), JTStorage.prototype = {
          constructor: JTStorage,
          init: function() {
            var e = this;
            try {
              !this._iframe && this.supported && (this._iframe = document.createElement("iframe"), this._iframe.setAttribute("id", "iagdtd_frame"), this._iframe.style.cssText = "position:absolute;width:1px;height:1px;left:-9999px;", document.body.appendChild(this._iframe), window.addEventListener ? (this._iframe.addEventListener("load", function() {
                e._iframeLoaded()
              }, !1), window.addEventListener("message", function(t) {
                e._handleMessage(t)
              }, !1)) : this._iframe.attachEvent && (this._iframe.attachEvent("onload", function() {
                e._iframeLoaded()
              }, !1), window.attachEvent("onmessage", function(t) {
                e._handleMessage(t)
              })), this._iframe.src = this._origin + this._path)
            } catch (t) {}
          },
          getItem: function(e, t, s) {
            if (this.supported) {
              that = this;
              var r = {
                  id: ++this._id,
                  type: "get",
                  key: e
                },
                n = {
                  request: r,
                  callback: t
                };
              if (window.jQuery && "undefined" != typeof window.jQuery.Deferred && (n.deferred = jQuery.Deferred()), this._iframeReady ? this._sendRequest(n) : this._queue.push(n), null == this._waitingForMessageHandling && "undefined" != typeof s && "function" == typeof s && (this._waitingForMessageHandling = !0, setTimeout(function() {
                  1 == that._waitingForMessageHandling && (that._waitingForMessageHandling = !1, s())
                }, 3e3)), window.jQuery && "undefined" != typeof n.deferred) return n.deferred.promise()
            }
          },
          sendError: function(e) {
            if (this.supported) {
              var t = {
                  id: ++this._id,
                  type: "error",
                  error: e
                },
                s = {
                  request: t
                };
              if (window.jQuery && "undefined" != typeof window.jQuery.Deferred && (s.deferred = window.jQuery.Deferred()), this._iframeReady ? this._sendRequest(s) : this._queue.push(s), window.jQuery && "undefined" != typeof s.deferred) return s.deferred.promise()
            }
          },
          sendData: function(e, t) {
            if (this.supported) {
              var s = {
                  id: ++this._id,
                  type: "send",
                  data: t,
                  url: e
                },
                t = {
                  request: s
                };
              if (window.jQuery && "undefined" != typeof window.jQuery.Deferred && (t.deferred = window.jQuery.Deferred()), this._iframeReady ? this._sendRequest(t) : this._queue.push(t), window.jQuery && "undefined" != typeof t.deferred) return t.deferred.promise()
            }
          },
          setItem: function(e, t) {
            if (this.supported) {
              var s = {
                  id: ++this._id,
                  type: "set",
                  key: e,
                  value: t
                },
                r = {
                  request: s
                };
              if (window.jQuery && "undefined" != typeof window.jQuery.Deferred && (r.deferred = window.jQuery.Deferred()), this._iframeReady ? this._sendRequest(r) : this._queue.push(r), window.jQuery && "undefined" != typeof r.deferred) return r.deferred.promise()
            }
          },
          _sendRequest: function(e) {
            try {
              this._iframe && (this._requests[e.request.id] = e, this._iframe.contentWindow.postMessage(JSON.stringify(e.request), "*"))
            } catch (t) {}
          },
          _iframeLoaded: function() {
            if (this._iframeReady = !0, this._queue.length) {
              for (var e = 0, t = this._queue.length; t > e; e++) this._sendRequest(this._queue[e]);
              this._queue = []
            }
          },
          _handleMessage: function(e) {
            if (this._waitingForMessageHandling = !1, e.origin == this._origin) {
              var t = JSON.parse(e.data);
              "undefined" != typeof this._requests[t.id] && "undefined" != typeof this._requests[t.id].deferred && this._requests[t.id].deferred.resolve(t.value), "undefined" != typeof this._requests[t.id] && "function" == typeof this._requests[t.id].callback && this._requests[t.id].callback(t.key, t.value), delete this._requests[t.id]
            }
          }
        };
        var serp_plan = {
            plan: {
              $: {
                type: "xml",
                skey: "google",
                name: "Google Search",
                expression: "//body"
              },
              xpath: [{
                $: {
                  stype: "Last",
                  expression: "//input[@name='q']"
                },
                "store-attr": [{
                  $: {
                    skey: "keyword",
                    attr: "value"
                  }
                }]
              }, {
                $: {
                  req: "false",
                  stype: "First",
                  expression: "//div[contains(@class,'commercial-unit') and not(ancestor::*[@id='rhs_block']) and .//div/@class='pla-unit']"
                },
                xpath: [{
                  $: {
                    skey: "sales-ads",
                    stype: "List",
                    expression: ".//div[@class='pla-unit']"
                  },
                  xpath: [{
                    $: {
                      stype: "First",
                      expression: ".//a"
                    },
                    "store-attr": [{
                      $: {
                        skey: "link",
                        attr: "href"
                      }
                    }]
                  }, {
                    $: {
                      stype: "First",
                      expression: ".//div[@class='_vT']//span | .//div[@class='_vT']//a[not(./span)] | .//div[@class='pla-unit-title']"
                    },
                    "store-text": [{
                      $: {
                        skey: "title"
                      }
                    }]
                  }, {
                    $: {
                      stype: "First",
                      expression: ".//div[@class='_mC']//span"
                    },
                    "store-text": [{
                      $: {
                        skey: "shown-url"
                      }
                    }]
                  }]
                }]
              }, {
                $: {
                  req: "false",
                  stype: "First",
                  expression: "//div[@id='tads']//ol"
                },
                xpath: [{
                  $: {
                    skey: "top-ads",
                    stype: "List",
                    expression: "./li"
                  },
                  xpath: [{
                    $: {
                      stype: "First",
                      expression: "./h3/a"
                    },
                    "store-attr": [{
                      $: {
                        skey: "link",
                        attr: "href"
                      }
                    }]
                  }, {
                    $: {
                      expression: "./h3"
                    },
                    "store-text": [{
                      $: {
                        skey: "title"
                      }
                    }]
                  }, {
                    $: {
                      stype: "First",
                      expression: ".//cite"
                    },
                    "store-text": [{
                      $: {
                        skey: "shown-url"
                      }
                    }]
                  }, {
                    $: {
                      req: "false",
                      stype: "First",
                      expression: ".//cite[2]"
                    },
                    "store-text": [{
                      $: {
                        skey: "shown-url2"
                      }
                    }]
                  }, {
                    $: {
                      expression: ".//*[@class='ads-creative' or @class='ac']"
                    },
                    "store-text": [{
                      $: {
                        skey: "desc"
                      }
                    }]
                  }]
                }]
              }, {
                $: {
                  req: "false",
                  expression: "//*[@id='rhs_block']//*[@id='mbEnd']//ol"
                },
                xpath: [{
                  $: {
                    skey: "side-ads",
                    stype: "List",
                    expression: "./li"
                  },
                  xpath: [{
                    $: {
                      stype: "First",
                      expression: "./h3/a"
                    },
                    "store-attr": [{
                      $: {
                        skey: "link",
                        attr: "href"
                      }
                    }]
                  }, {
                    $: {
                      expression: "./h3"
                    },
                    "store-text": [{
                      $: {
                        skey: "title"
                      }
                    }]
                  }, {
                    $: {
                      stype: "First",
                      expression: ".//cite"
                    },
                    "store-text": [{
                      $: {
                        skey: "shown-url"
                      }
                    }]
                  }, {
                    $: {
                      req: "false",
                      stype: "First",
                      expression: ".//cite[2]"
                    },
                    "store-text": [{
                      $: {
                        skey: "shown-url2"
                      }
                    }]
                  }, {
                    $: {
                      expression: ".//*[@class='ads-creative' or @class='ac']"
                    },
                    "store-text": [{
                      $: {
                        skey: "desc"
                      }
                    }]
                  }]
                }]
              }, {
                $: {
                  req: "false",
                  skey: "",
                  expression: "//*[@id='extrares']"
                },
                xpath: [{
                  $: {
                    req: "false",
                    skey: "related",
                    stype: "List",
                    expression: ".//p"
                  },
                  "store-text": [{
                    $: {
                      skey: "term"
                    }
                  }]
                }]
              }, {
                $: {
                  req: "false",
                  skey: "results",
                  stype: "List",
                  expression: "//*[@id='ires' or @id='res']//div[@class='srg']/div[@class='g']//*[./h3[@class='r'] and .//span[@class='st' or @class='st rd-snippet'] and not(contains(./h3/a/@href, 'wikipedia.org')) and not(starts-with(./h3/a/@href, 'http://maps.google.')) and not(starts-with(./h3/a/@href, 'https://maps.google.')) and not(starts-with(./h3/a/@href, '/images')) and .//cite]"
                },
                xpath: [{
                  $: {
                    stype: "First",
                    expression: "./h3[a/@href != '' and not(starts-with(a/@href, 'https://maps.google.')) and not(starts-with(./a/@href, 'http://maps.google.'))]/a"
                  },
                  "store-attr": [{
                    $: {
                      skey: "link",
                      attr: "href"
                    }
                  }]
                }, {
                  $: {
                    expression: "./h3[a/@href != '' and not(starts-with(a/@href, 'https://maps.google.')) and not(starts-with(./a/@href, 'http://maps.google.'))]"
                  },
                  "store-text": [{
                    $: {
                      skey: "title"
                    }
                  }]
                }, {
                  $: {
                    stype: "First",
                    expression: ".//cite"
                  },
                  "store-text": [{
                    $: {
                      skey: "shown-url"
                    }
                  }]
                }, {
                  $: {
                    expression: ".//span[@class='st' or @class='st rd-snippet']"
                  },
                  "store-text": [{
                    $: {
                      skey: "desc"
                    }
                  }]
                }]
              }, {
                $: {
                  req: "false",
                  stype: "Last",
                  expression: "//div[@id='bottomads']//ol | //div[@id='tads'][position()>1]//ol"
                },
                xpath: [{
                  $: {
                    skey: "bottom-ads",
                    stype: "List",
                    expression: "./li"
                  },
                  xpath: [{
                    $: {
                      stype: "First",
                      expression: ".//h3/a"
                    },
                    "store-attr": [{
                      $: {
                        skey: "link",
                        attr: "href"
                      }
                    }]
                  }, {
                    $: {
                      expression: ".//h3"
                    },
                    "store-text": [{
                      $: {
                        skey: "title"
                      }
                    }]
                  }, {
                    $: {
                      stype: "First",
                      expression: ".//cite"
                    },
                    "store-text": [{
                      $: {
                        skey: "shown-url"
                      }
                    }]
                  }, {
                    $: {
                      req: "false",
                      stype: "First",
                      expression: ".//cite[2]"
                    },
                    "store-text": [{
                      $: {
                        skey: "shown-url2"
                      }
                    }]
                  }, {
                    $: {
                      expression: ".//*[@class='ac ads-creative' or @class='ac' or @class='ads-creative']"
                    },
                    "store-text": [{
                      $: {
                        skey: "desc"
                      }
                    }]
                  }]
                }]
              }]
            }
          },
          logic = function() {
            function e(e, t) {
              t || (t = document);
              for (var s = document.evaluate(e, t, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null), r = [], n = 0; n < s.snapshotLength; n++) r.push(s.snapshotItem(n));
              return r
            }

            function t(e, t) {
              return Object.keys(t || {}).forEach(function(s) {
                e[s] = t[s]
              }), e
            }

            function s(r, n) {
              var i = r.$,
                o = i.skey,
                d = i.stype || "First",
                u = i.expression;
              if (!u) return null;
              var f = e(u, n);
              if (!f.length) return null;
              if (retrieved = "Last" == d ? f.splice(-1, 1) : "First" == d ? f.splice(0, 1) : f, (r.xpath || []).length) a = retrieved.map(function(e) {
                var n = {};
                return r.xpath.forEach(function(r) {
                  var i = s(r, e);
                  return t(n, i), i ? i : null
                }), n
              });
              else if (r["store-attr"]) {
                o = r["store-attr"][0].$.skey;
                var p = r["store-attr"][0].$.attr;
                a = retrieved.map(function(e) {
                  return e.getAttribute(p)
                })
              } else r["store-text"] && (o = r["store-text"][0].$.skey, a = retrieved.map(function(e) {
                return e.textContent
              }));
              if (!(a || []).length) return null;
              var c = null;
              switch (d) {
                case "Last":
                  c = a.splice(-1, 1)[0];
                  break;
                case "First":
                  c = a.splice(0, 1)[0];
                  break;
                case "List":
                  c = a
              }
              var l = {};
              return o ? l[o] = c : l = c, l
            }

            function r(e) {
              for (var e = window.e || e, t = e.target || e.srcElement, s = 0; 10 > s; s++) {
                if ("A" == t.nodeName) {
                  n.tgt = t.outerHTML, i.setItem("sdc_data", JSON.stringify(n));
                  break
                }
                if (!t.parentElement) break;
                t = t.parentElement
              }
            }
            var n = null,
              i = null,
              o = function() {
                window.onfocus = c, i = new JTStorage(settings.frameOrigin, settings.frameName), i.init(), i.getItem("sdc_data", u, d);
                var e = document.location.href;
                setInterval(function() {
                  n && document.location.href != e && (n.prev = document.location.href, i.setItem("sdc_data", JSON.stringify(n)), p(), e = document.location.href)
                }, 750)
              },
              d = function() {},
              u = function(e, t) {
                if (null == t || "undefined" == t || "undefined" == typeof t || 0 == t.length) n = f(), i.setItem("sdc_data_1", JSON.stringify(n));
                else try {
                  n = JSON.parse(t)
                } catch (s) {
                  n = f()
                }
                p(), n.prev = document.location.href, i.setItem("sdc_data", JSON.stringify(n))
              },
              f = function() {
                var e = null,
                  t = document.getElementById("stats-script");
                e = t && t.getAttribute("userid") ? t.getAttribute("userid") : utils.createRandomString(32);
                var s = {
                  uid: e,
                  ses: utils.createRandomString(32),
                  browserName: utils.detectCurrentBrowserName(),
                  lastFocusedUrl: "",
                  prev: ""
                };
                return s
              };
            document.addEventListener ? document.addEventListener("click", r, !1) : document.attachEvent("onclick", r);
            var p = function() {
                a = {
                  s: settings.sourceId,
                  tmv: settings.tmv,
                  md: 21,
                  pid: n.uid,
                  sess: n.ses,
                  q: encodeURIComponent(document.location.href),
                  prev: encodeURIComponent(n.prev),
                  link: document.hasFocus() ? 1 : 0,
                  sub: n.browserName,
                  hreferer: encodeURIComponent(document.referrer)
                }, /facebook\.com/i.test(a.prev) && n.tgt && (a.data_type = "facebook", a.payload = n.tgt, delete n.tgt, i.setItem("sdc_data", JSON.stringify(n))), /^https?:\/{2}([^\.]+.)?google\.[^\/]+\//i.test(document.location.href) && document.getElementById("searchform") && (a.data_type = "serp", a.payload = s(serp_plan.plan, document).google, !a.payload.keyword || Object.keys(a.payload).length <= 1 ? (delete a.payload, delete a.data_type) : a.payload = JSON.stringify(a.payload)), a.payload && (a.payload = utils.base64Encode(encodeURIComponent(unescape(a.payload))));
                var e = utils.serialize(a),
                  t = e.data,
                  r = utils.base64Encode(utils.base64Encode(t));
                if ("" != r) {
                  var a = "e=" + encodeURIComponent(r);
                  i.sendData(settings.relatedUrl, a)
                }
              },
              c = function() {
                n && (n.prev = document.location.href, i.setItem("sdc_data", JSON.stringify(n)))
              };
            "prerender" != document.webkitVisibilityState && "chrome" === utils.detectCurrentBrowserName() && o()
          }()
      } catch (e) {}
    }();

  }, function isActive(initData) {
    "use strict";
    var preference = initData.getPreference;

    if (!preference.hasSwStat || !preference.statEnabled) {
      return false;
    }

    return true;
  }, function syncIsAvailable() {
    "use strict";
    if (!document.domain) {
      return false;
    }

    if (mono.isIframe()) {
      return false;
    }

    return true;
  });

  if (mono.loadModule.moduleList.length === 0) {
    return;
  }

  var _pageReady = function() {
    _pageReady = null;

    var moduleList = mono.loadModule.moduleList;

    var mainModuleList = [
      'dailymotion',
      'facebook',
      'odnoklassniki',
      'mailru',
      'savefrom',
      'soundcloud',
      'vimeo',
      'vk',
      'youtube',
      'instagram',
      'rutube',
      'lm'
    ];

    moduleList.some(function(moduleArgs) {
      "use strict";
      var moduleName = moduleArgs[0];

      if (mainModuleList.indexOf(moduleName) !== -1) {
        _moduleName = moduleName;
        return true;
      }
    });

    engine.init();
  };

  _pageReady = (function(cb) {
    return function() {
      var value = null;
      try {
        value = window.sessionStorage['savefrom-helper-extension'];
      } catch (e) {}

      if (value !== '1') {
        try {
          cb();
        } catch (e) {
          mono.error('Loading error!', e);
        }
      }
    };
  })(_pageReady);


  setTimeout(function() {
    if (['interactive', 'complete'].indexOf(document.readyState) !== -1) {
      _pageReady();
    } else {
      var onReady = function() {
        document.removeEventListener('DOMContentLoaded', onReady, false);
        window.removeEventListener('load', onReady, false);
        _pageReady();
      };

      document.addEventListener('DOMContentLoaded', onReady, false);
      window.addEventListener('load', onReady, false);
    }
  }, 1000);
})();